# Issue 21058: recognizable series (a base for k-regular sequences)

archive/issues_021058.json:
```json
{
    "body": "CC:  galipnik\n\nImplement recognizable series, which are formal series, whose coefficients (each belongs to a word over an alphabet) satisfy a certain linear representation. (This linear representation is based on a monoid morphism into matrices.)\n\nSee also meta ticket #21202.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21295\n\n",
    "created_at": "2016-08-19T11:39:22Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "recognizable series (a base for k-regular sequences)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21058",
    "user": "dkrenn"
}
```
CC:  galipnik

Implement recognizable series, which are formal series, whose coefficients (each belongs to a word over an alphabet) satisfy a certain linear representation. (This linear representation is based on a monoid morphism into matrices.)

See also meta ticket #21202.

Issue created by migration from https://trac.sagemath.org/ticket/21295





---

archive/issue_comments_291758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-19T12:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291758",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291759.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-19T12:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291759",
    "user": "dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_291760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T12:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291760",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-22T12:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291761",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291762.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-22T15:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291762",
    "user": "dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291763.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T10:59:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291763",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291764.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-25T11:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291764",
    "user": "dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291765.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T11:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291765",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291766.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-05T12:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291766",
    "user": "cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291767.json:
```json
{
    "body": "patchbot python3 plugin failure",
    "created_at": "2017-01-05T12:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291767",
    "user": "cheuberg"
}
```

patchbot python3 plugin failure



---

archive/issue_comments_291768.json:
```json
{
    "body": "6 of the 9 commits of #21200 are in this branch here, so #21200 should probably a dependency.",
    "created_at": "2017-01-05T16:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291768",
    "user": "cheuberg"
}
```

6 of the 9 commits of #21200 are in this branch here, so #21200 should probably a dependency.



---

archive/issue_comments_291769.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-12T15:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291769",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291770.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-12T15:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291770",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291771.json:
```json
{
    "body": "Replying to [comment:10 cheuberg]:\n> patchbot python3 plugin failure\n\nFixed. Merged in 7.5\n----\nNew commits:",
    "created_at": "2017-01-24T12:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291771",
    "user": "dkrenn"
}
```

Replying to [comment:10 cheuberg]:
> patchbot python3 plugin failure

Fixed. Merged in 7.5
----
New commits:



---

archive/issue_comments_291772.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-24T12:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291772",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291773.json:
```json
{
    "body": "Replying to [comment:11 cheuberg]:\n> 6 of the 9 commits of #21200 are in this branch here, so #21200 should probably a dependency.\n\nYes, indeed. Thank you",
    "created_at": "2017-01-24T12:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291773",
    "user": "dkrenn"
}
```

Replying to [comment:11 cheuberg]:
> 6 of the 9 commits of #21200 are in this branch here, so #21200 should probably a dependency.

Yes, indeed. Thank you



---

archive/issue_comments_291774.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-01-24T12:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291774",
    "user": "dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291775.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-11T15:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291775",
    "user": "slabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291776.json:
```json
{
    "body": "Some remarks.\n\n1. Document keyword `infinite` in the list of inputs of `RecognizableSeriesSpace??`.\n\n2. Add an example of use of keyword `category` in doc of `RecognizableSeriesSpace??`.\n\n2. When I do\n\n\n```\nsage: S = RecognizableSeriesSpace(ZZ, (0,1))\nsage: S?\n```\n\n\nI would like to see examples of how to create an object in this space, but there is no.\n\n3. There is an error on the repr of s recognizable series:\n\n\n```\nsage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\nsage: S = Rec((M0,M1), (0,1), (1,1))\nsage: S\n<repr(<sage.combinat.recognizable_series.RecognizableSeriesSpace_with_category.element_class at 0x7fd8f6d68640>) failed: TypeError: unsupported operand parent(s) for *: '<type 'tuple'>' and 'Full MatrixSpace of 2 by 2 dense matrices over Integer Ring'>\n```\n\n\n\n4. \"The indices of this family are the alphabet.\" -> is the alphabet or -> are elements of the alphabet\n\n5. There is a ReST indentation problem in the paragraph of \"transpose\" of `RecognizableSeries?`\t\n\n6.\n\n\n```\n        When created via the parent :class:`RecognizableSeriesSpace`, then\n        the following option is available.\n```\n\n\nThen why should it be mentionned there? Is this option really necessary? I prefer\n\n\n```\nsage: S = Rec(inputs).transposed()\n```\n\n\nto\n\n\n```\nsage: S = Rec(inputs, transpose=False)\n```\n\n\n\n7. How to access to the coefficient of some word? This should be documented\n   soon, like in the top level module or in the constructors of series.\n\n\n```\nsage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\nsage: S\n[] + [0] + 3*[1] + [00] + 3*[01] + 3*[10] + 5*[11] + [000] + 3*[001] + 3*[010] + ...\nsage: S([0,0,1])\nTraceback (most recent call last)\n...\nTypeError: 'RecognizableSeriesSpace_with_category.element_class' object is not callable\n```\n\n\n8. The documentation of the class `RecognizableSeriesSpace` does not contains any details relative to what `_element_constructor_` is doing.\n\n\n```\n    def _element_constructor_(self, data,\n                              left=None, right=None,\n                              transpose=False):\n        r\"\"\"\n        Return a recognizable series.\n\n        See :class:`RecognizableSeriesSpace` for details.\n```\n\n\nI would rather document `left`, `right` and `transpose` here.\nAgain, I do not know whether `transpose` is really necessary here. Unless there\nis an argument, I would just delete it.\n\n9. I would remove this space, no?\n\n\n```\nclass RecognizableSeries(Element):\n\n    def __init__(self, parent, mu, left, right):\n```\n\n\n10. In the book of Berstel and Reutenauer, the notation of the coefficient of a word w in a series S is (S,w). In Python, this gives a tuple which is not what we want. I agree that using `__getitem__` is the way to go.\n\n\n```\nsage: M0 = matrix(2,[1,2,3,4])\nsage: M1 = matrix(2,[-2,1,3,-7])\nsage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\nsage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\nsage: F = S.parent().indices()\nsage: S[F((0,0,1))]\n-103\n```\n\n\nWould it be possible and desirable that the following also works?\n\n\n```\nsage: M0 = matrix(2,[1,2,3,4])\nsage: M1 = matrix(2,[-2,1,3,-7])\nsage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\nsage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\nsage: S[(0,0,1)]\n-103\n```\n\n\n\n11.\n\n\n```diff\n    - return prod(tuple(self.mu[a] for a in w), z=self._mu_of_empty_word_())\n    + return prod((self.mu[a] for a in w), z=self._mu_of_empty_word_())\n```\n\n\n12. This calls `self[w]` twice which is not good:\n\n    {{{\n        return iter((w, self[w])\n                    for w in self.parent().indices() if self[w] != 0)\n    }}}\n\n    You may want to do a for loop with yields statements and replace `return iter([])` by a `raise StopIteration`.\n\n23. While reading chapter on Recognizable series of Berstel and Reutenauer, one\n    sees that `is_proper`, `S+S`, `S^+`, `S^*`, `S+1`, `2*S`,\n    `hadamard_product`, `a^-1*S`, `S.dimension()` are not implemented. Are\n    these intended to be coded? Why not in this ticket?\n \n34. I do not understand what this means:\n\n\n```\n    def populate_interactive(self):\n        r\"\"\"\n        Return an iterator over possible new elements.\n```\n\n\nIs the code equivalent to the following?\n\n\n```\n        return (p + a\n                for p in self.elements\n                for a in self.words.iterate_by_length(1))\n```\n\n\n15. What should `__eq__` return?\n\n\n```\nsage: M0 = matrix(2,[1,2,3,4])\nsage: M1 = matrix(2,[-2,1,3,-7])\nsage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\nsage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\nsage: S == S.minimized()\nFalse\n```\n\n\nShould it be `self.minimized() == other.minimized()` ?\n\n16. There should be an example in the top level module doc showing a nice aspect of what this module do. The most important code for now seems to be (1) Creation of a recognizable series and (2) the minimization of a recognizable series.\n\n27. I would add a method `linear_representation` which would return the 3-tuple `(left, mu, right)`. From Berstel and Reutenauer: \"the triple (\u03bb, \u03bc, \u03b3) is called a linear representation of S\", because print does not says much.\n\nThis review was done during https://wiki.sagemath.org/thursdays_bordeaux",
    "created_at": "2017-05-11T15:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291776",
    "user": "slabbe"
}
```

Some remarks.

1. Document keyword `infinite` in the list of inputs of `RecognizableSeriesSpace??`.

2. Add an example of use of keyword `category` in doc of `RecognizableSeriesSpace??`.

2. When I do


```
sage: S = RecognizableSeriesSpace(ZZ, (0,1))
sage: S?
```


I would like to see examples of how to create an object in this space, but there is no.

3. There is an error on the repr of s recognizable series:


```
sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
sage: S = Rec((M0,M1), (0,1), (1,1))
sage: S
<repr(<sage.combinat.recognizable_series.RecognizableSeriesSpace_with_category.element_class at 0x7fd8f6d68640>) failed: TypeError: unsupported operand parent(s) for *: '<type 'tuple'>' and 'Full MatrixSpace of 2 by 2 dense matrices over Integer Ring'>
```



4. "The indices of this family are the alphabet." -> is the alphabet or -> are elements of the alphabet

5. There is a ReST indentation problem in the paragraph of "transpose" of `RecognizableSeries?`	

6.


```
        When created via the parent :class:`RecognizableSeriesSpace`, then
        the following option is available.
```


Then why should it be mentionned there? Is this option really necessary? I prefer


```
sage: S = Rec(inputs).transposed()
```


to


```
sage: S = Rec(inputs, transpose=False)
```



7. How to access to the coefficient of some word? This should be documented
   soon, like in the top level module or in the constructors of series.


```
sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
sage: S
[] + [0] + 3*[1] + [00] + 3*[01] + 3*[10] + 5*[11] + [000] + 3*[001] + 3*[010] + ...
sage: S([0,0,1])
Traceback (most recent call last)
...
TypeError: 'RecognizableSeriesSpace_with_category.element_class' object is not callable
```


8. The documentation of the class `RecognizableSeriesSpace` does not contains any details relative to what `_element_constructor_` is doing.


```
    def _element_constructor_(self, data,
                              left=None, right=None,
                              transpose=False):
        r"""
        Return a recognizable series.

        See :class:`RecognizableSeriesSpace` for details.
```


I would rather document `left`, `right` and `transpose` here.
Again, I do not know whether `transpose` is really necessary here. Unless there
is an argument, I would just delete it.

9. I would remove this space, no?


```
class RecognizableSeries(Element):

    def __init__(self, parent, mu, left, right):
```


10. In the book of Berstel and Reutenauer, the notation of the coefficient of a word w in a series S is (S,w). In Python, this gives a tuple which is not what we want. I agree that using `__getitem__` is the way to go.


```
sage: M0 = matrix(2,[1,2,3,4])
sage: M1 = matrix(2,[-2,1,3,-7])
sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
sage: F = S.parent().indices()
sage: S[F((0,0,1))]
-103
```


Would it be possible and desirable that the following also works?


```
sage: M0 = matrix(2,[1,2,3,4])
sage: M1 = matrix(2,[-2,1,3,-7])
sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
sage: S[(0,0,1)]
-103
```



11.


```diff
    - return prod(tuple(self.mu[a] for a in w), z=self._mu_of_empty_word_())
    + return prod((self.mu[a] for a in w), z=self._mu_of_empty_word_())
```


12. This calls `self[w]` twice which is not good:

    {{{
        return iter((w, self[w])
                    for w in self.parent().indices() if self[w] != 0)
    }}}

    You may want to do a for loop with yields statements and replace `return iter([])` by a `raise StopIteration`.

23. While reading chapter on Recognizable series of Berstel and Reutenauer, one
    sees that `is_proper`, `S+S`, `S^+`, `S^*`, `S+1`, `2*S`,
    `hadamard_product`, `a^-1*S`, `S.dimension()` are not implemented. Are
    these intended to be coded? Why not in this ticket?
 
34. I do not understand what this means:


```
    def populate_interactive(self):
        r"""
        Return an iterator over possible new elements.
```


Is the code equivalent to the following?


```
        return (p + a
                for p in self.elements
                for a in self.words.iterate_by_length(1))
```


15. What should `__eq__` return?


```
sage: M0 = matrix(2,[1,2,3,4])
sage: M1 = matrix(2,[-2,1,3,-7])
sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
sage: S == S.minimized()
False
```


Should it be `self.minimized() == other.minimized()` ?

16. There should be an example in the top level module doc showing a nice aspect of what this module do. The most important code for now seems to be (1) Creation of a recognizable series and (2) the minimization of a recognizable series.

27. I would add a method `linear_representation` which would return the 3-tuple `(left, mu, right)`. From Berstel and Reutenauer: "the triple (λ, μ, γ) is called a linear representation of S", because print does not says much.

This review was done during https://wiki.sagemath.org/thursdays_bordeaux



---

archive/issue_comments_291777.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2017-05-11T15:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291777",
    "user": "slabbe"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_291778.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-06T07:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291778",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-29T08:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291779",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291780.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-02-10T10:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291780",
    "user": "cheuberg"
}
```

New commits:



---

archive/issue_comments_291781.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-18T17:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291781",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291782.json:
```json
{
    "body": "I now had a look at the code and a few comments:\n\n18. Please move reference `BR2010` to `src/doc/en/reference/references/index.rst` as per the developer's guide https://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content\n\n29. The examples in the developer's guide do not have a closing punctuation for INPUT and OUTPUT items\n\n20. `PrefixClosedSet.__init__`: I suggest to clarify in the docstring that the parameters `alphabet` and `words` are mutually exclusive and to also throw an error if this is not the case (currently, the `words` parameter is silently discarded if `alphabet` is set).\n\n21. `PrefixClosedSet.__init__`: When first reading this, I was confused by the parameter `words` because I assumed that it actually contains words, and then the test shows a rather empty output. Therefore, I think it would be helpful if either the name of the parameter or the description clarifies that it is a *class* of words.\n\n22. `PrefixClosedSet.populate_interactive`: from the name, I would guess that this method will actually add something to the set, but it is a mere iterator. Only the example then turns towards adding elements. Would a method name like  `iterate_possible_additions` be a better name?\n\n23. `PrefixClosedSet.populate_interactive`: from the description and the example, I thought it might only list *new* elements. However, \n    {{{\n    sage: P = PrefixClosedSet(alphabet=[0, 1])\n    sage: P.add(P.words([0]))\n    sage: list(P.populate_interactive())\n    [word: 0, word: 1, word: 00, word: 01]\n    }}}\n    Please clarify. \n\n24. `PrefixClosedSet.prefix_set`: For me, the description does not explain what the method does; it is only understandible in the context of BR2010, Proposition 2.3.1. Something like \"the set of minimal (with respect to prefix ordering) elements of the complement of self\"?\n\n25. `RecognizableSeries.__init__`: The docstring promises that the documentation of `left` and `right` will give more details. I do not think that this is the case. I appreciate providing a link, but suggest to adapt the wording.\n\n26. `RecognizableSeries.__iter__`: please document explicitly that the empty word is not included.\n\n27. `RecognizableSeries.__bool__`: what is the role of `sage: S  # not tested` in the tests?\n\n28. `RecognizableSeries.transposed`: replace the `map` function by a list comprehension to avoid Python3 issues\n\n29. In the algorithm described in Chapter 2 of BR2010, K is assumed to be a field (it is not stated in the description of the algorithm, but before the crucial Proposition 2.2.1 as well as the crucial theorem 3.2. As far as I can see, this is not mentioned in the documentation or the code here (and `__bool__` calls `minimized`).\n\n30. `RecognizableSeries._minimized_left_`: the tests demonstrate that the zero sequence has no consistent minimized representation: sometimes, it is a 1x1 representation with 0 entries; sometimes, a 0x0 representation.\n\n31. `RecognizableSeries._minimized_left_`: one could start with `ML = matrix(0, self.left.degree())` and then use `ML = ML.stack(vector(left))` and get rid of the local variable `Left`. No extra treatment for `pcs.element(0)` would be necessary (as long as `PrefixClosedSet.populate_interactive` includes the empty word, which I would consider to be more consistent).\n\n32. `RecognizableSeries._minimized_left_`: it seems that `alpha(c)` is called repeatedly for all entries of the row corresponding to p with p+a in C. So I suggest to either cache the value alpha(c) or to construct the matrix row by row (either as `alpha(c)` or as `[ZZ(c==q) for q in P]`, depending on whether `c in C`).",
    "created_at": "2021-04-18T17:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291782",
    "user": "cheuberg"
}
```

I now had a look at the code and a few comments:

18. Please move reference `BR2010` to `src/doc/en/reference/references/index.rst` as per the developer's guide https://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content

29. The examples in the developer's guide do not have a closing punctuation for INPUT and OUTPUT items

20. `PrefixClosedSet.__init__`: I suggest to clarify in the docstring that the parameters `alphabet` and `words` are mutually exclusive and to also throw an error if this is not the case (currently, the `words` parameter is silently discarded if `alphabet` is set).

21. `PrefixClosedSet.__init__`: When first reading this, I was confused by the parameter `words` because I assumed that it actually contains words, and then the test shows a rather empty output. Therefore, I think it would be helpful if either the name of the parameter or the description clarifies that it is a *class* of words.

22. `PrefixClosedSet.populate_interactive`: from the name, I would guess that this method will actually add something to the set, but it is a mere iterator. Only the example then turns towards adding elements. Would a method name like  `iterate_possible_additions` be a better name?

23. `PrefixClosedSet.populate_interactive`: from the description and the example, I thought it might only list *new* elements. However, 
    {{{
    sage: P = PrefixClosedSet(alphabet=[0, 1])
    sage: P.add(P.words([0]))
    sage: list(P.populate_interactive())
    [word: 0, word: 1, word: 00, word: 01]
    }}}
    Please clarify. 

24. `PrefixClosedSet.prefix_set`: For me, the description does not explain what the method does; it is only understandible in the context of BR2010, Proposition 2.3.1. Something like "the set of minimal (with respect to prefix ordering) elements of the complement of self"?

25. `RecognizableSeries.__init__`: The docstring promises that the documentation of `left` and `right` will give more details. I do not think that this is the case. I appreciate providing a link, but suggest to adapt the wording.

26. `RecognizableSeries.__iter__`: please document explicitly that the empty word is not included.

27. `RecognizableSeries.__bool__`: what is the role of `sage: S  # not tested` in the tests?

28. `RecognizableSeries.transposed`: replace the `map` function by a list comprehension to avoid Python3 issues

29. In the algorithm described in Chapter 2 of BR2010, K is assumed to be a field (it is not stated in the description of the algorithm, but before the crucial Proposition 2.2.1 as well as the crucial theorem 3.2. As far as I can see, this is not mentioned in the documentation or the code here (and `__bool__` calls `minimized`).

30. `RecognizableSeries._minimized_left_`: the tests demonstrate that the zero sequence has no consistent minimized representation: sometimes, it is a 1x1 representation with 0 entries; sometimes, a 0x0 representation.

31. `RecognizableSeries._minimized_left_`: one could start with `ML = matrix(0, self.left.degree())` and then use `ML = ML.stack(vector(left))` and get rid of the local variable `Left`. No extra treatment for `pcs.element(0)` would be necessary (as long as `PrefixClosedSet.populate_interactive` includes the empty word, which I would consider to be more consistent).

32. `RecognizableSeries._minimized_left_`: it seems that `alpha(c)` is called repeatedly for all entries of the row corresponding to p with p+a in C. So I suggest to either cache the value alpha(c) or to construct the matrix row by row (either as `alpha(c)` or as `[ZZ(c==q) for q in P]`, depending on whether `c in C`).



---

archive/issue_comments_291783.json:
```json
{
    "body": "Resolved conflict with current version (9.3.rc3)\n----\nNew commits:",
    "created_at": "2021-04-20T15:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291783",
    "user": "dkrenn"
}
```

Resolved conflict with current version (9.3.rc3)
----
New commits:



---

archive/issue_comments_291784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-05-03T16:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291784",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_291785.json:
```json
{
    "body": "Replying to [comment:20 slabbe]:\n> 1. Document keyword `infinite` in the list of inputs of `RecognizableSeriesSpace??`.\n\nThere is no keyword \"infinite\".\n\n> 2. Add an example of use of keyword `category` in doc of `RecognizableSeriesSpace??`.\n\nCategories can be added as with any other SageMath-Parent.\n\n> 2. When I do\n> \n> {{{\n> sage: S = RecognizableSeriesSpace(ZZ, (0,1))\n> sage: S?\n> }}}\n> \n> I would like to see examples of how to create an object in this space, but there is no.\n\nExample added.\n\n> 3. There is an error on the repr of s recognizable series:\n> \n> {{{\n> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\n> sage: S = Rec((M0,M1), (0,1), (1,1))\n> sage: S\n> <repr(<sage.combinat.recognizable_series.RecognizableSeriesSpace_with_category.element_class at 0x7fd8f6d68640>) failed: TypeError: unsupported operand parent(s) for *: '<type 'tuple'>' and 'Full MatrixSpace of 2 by 2 dense matrices over Integer Ring'>\n> }}}\n\nFixed.\n\n> 4. \"The indices of this family are the alphabet.\" -> is the alphabet or -> are elements of the alphabet\n\nChanged.\n\n\n> 5. There is a ReST indentation problem in the paragraph of \"transpose\" of `RecognizableSeries?`\t\n\nFixed.\n\n> 6.\n> \n> {{{\n>         When created via the parent :class:`RecognizableSeriesSpace`, then\n>         the following option is available.\n> }}}\n> \n> Then why should it be mentionned there? Is this option really necessary? I prefer\n> \n> {{{\n> sage: S = Rec(inputs).transposed()\n> }}}\n> \n> to\n> \n> {{{\n> sage: S = Rec(inputs, transpose=False)\n> }}}\n\nIndeed, this seems to be more natural to me now as well. Removed.\n\n> 7. How to access to the coefficient of some word? This should be documented\n>    soon, like in the top level module or in the constructors of series.\n> \n> {{{\n> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\n> sage: S\n> [] + [0] + 3*[1] + [00] + 3*[01] + 3*[10] + 5*[11] + [000] + 3*[001] + 3*[010] + ...\n> sage: S([0,0,1])\n> Traceback (most recent call last)\n> ...\n> TypeError: 'RecognizableSeriesSpace_with_category.element_class' object is not callable\n> }}}\n\nThe input needs to be a word.\n\n> 8. The documentation of the class `RecognizableSeriesSpace` does not contains any details relative to what `_element_constructor_` is doing.\n> \n> {{{\n>     def _element_constructor_(self, data,\n>                               left=None, right=None,\n>                               transpose=False):\n>         r\"\"\"\n>         Return a recognizable series.\n> \n>         See :class:`RecognizableSeriesSpace` for details.\n> }}}\n> \n> I would rather document `left`, `right` and `transpose` here.\n> Again, I do not know whether `transpose` is really necessary here. Unless there\n> is an argument, I would just delete it.\n\nTranspose was removed (see above).\n\n> 9. I would remove this space, no?\n> \n> {{{\n> class RecognizableSeries(Element):\n> \n>     def __init__(self, parent, mu, left, right):\n> }}}\n\nRemoved.\n\n> 10. In the book of Berstel and Reutenauer, the notation of the coefficient of a word w in a series S is (S,w). In Python, this gives a tuple which is not what we want. I agree that using `__getitem__` is the way to go.\n> \n> {{{\n> sage: M0 = matrix(2,[1,2,3,4])\n> sage: M1 = matrix(2,[-2,1,3,-7])\n> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\n> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\n> sage: F = S.parent().indices()\n> sage: S[F((0,0,1))]\n> -103\n> }}}\n> \n> Would it be possible and desirable that the following also works?\n> \n> {{{\n> sage: M0 = matrix(2,[1,2,3,4])\n> sage: M1 = matrix(2,[-2,1,3,-7])\n> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\n> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\n> sage: S[(0,0,1)]\n> -103\n> }}}\n\nYes, this is desirable; I'll open a follow-up ticket for it. (See #31769)\n\n> 11.\n> \n> {{{\n> #!diff\n>     - return prod(tuple(self.mu[a] for a in w), z=self._mu_of_empty_word_())\n>     + return prod((self.mu[a] for a in w), z=self._mu_of_empty_word_())\n> }}}\n\nDone.\n\n> 12. This calls `self[w]` twice which is not good:\n> \n>     {{{\n>         return iter((w, self[w])\n>                     for w in self.parent().indices() if self[w] != 0)\n>     }}}\n> \n>     You may want to do a for loop with yields statements and replace `return iter([])` by a `raise StopIteration`.\n\nThe iter-method as inconsistent, as an \"empty\" sequence was handled differently than a finite sequence. So this been rewritten and is now quite easy.\n(As a side note: Raising StopIteration in a generator expression will raise a RuntimeError; I believe a simple return should do the trick in this case.)\n\n> 13. While reading chapter on Recognizable series of Berstel and Reutenauer, one\n>     sees that `is_proper`, `S+S`, `S^+`, `S^*`, `S+1`, `2*S`,\n>     `hadamard_product`, `a^-1*S`, `S.dimension()` are not implemented. Are\n>     these intended to be coded? Why not in this ticket?\n\nArithmetic is done on follow-up tickets. (See meta ticket #21202)\n\n\n> 14. I do not understand what this means:\n> \n> {{{\n>     def populate_interactive(self):\n>         r\"\"\"\n>         Return an iterator over possible new elements.\n> }}}\n> \n> Is the code equivalent to the following?\n> \n> {{{\n>         return (p + a\n>                 for p in self.elements\n>                 for a in self.words.iterate_by_length(1))\n> }}}\n\nSee issue below. Now this method is called iterate_possible_additions. Indeed\nit is roughly equivalent to the above, but iterate_possible_additions\nalso works correctly, when elements are extended in-between.\n\nDocumented now.\n\n> 15. What should `__eq__` return?\n> \n> {{{\n> sage: M0 = matrix(2,[1,2,3,4])\n> sage: M1 = matrix(2,[-2,1,3,-7])\n> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))\n> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))\n> sage: S == S.minimized()\n> False\n> }}}\n> \n> Should it be `self.minimized() == other.minimized()` ?\n\nEquality testing is not straight forward as it might be that two equal sequences\nhave different minimal representations. One can build the difference\nand then minimize to see if it is the zero sequence.\nThis will also be done on a follow-up ticket, once arithmethic is ready.\n\n> 16. There should be an example in the top level module doc showing a nice aspect of what this module do. The most important code for now seems to be (1) Creation of a recognizable series and (2) the minimization of a recognizable series.\n\nThe interesting stuff begins with regular sequences which is done on\nthe successor ticket of this ticket. A ref will be added then.\n\n> 17. I would add a method `linear_representation` which would return the 3-tuple `(left, mu, right)`. From Berstel and Reutenauer: \"the triple (\u03bb, \u03bc, \u03b3) is called a linear representation of S\", because print does not says much.\n\nAdded.",
    "created_at": "2021-05-03T16:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291785",
    "user": "dkrenn"
}
```

Replying to [comment:20 slabbe]:
> 1. Document keyword `infinite` in the list of inputs of `RecognizableSeriesSpace??`.

There is no keyword "infinite".

> 2. Add an example of use of keyword `category` in doc of `RecognizableSeriesSpace??`.

Categories can be added as with any other SageMath-Parent.

> 2. When I do
> 
> {{{
> sage: S = RecognizableSeriesSpace(ZZ, (0,1))
> sage: S?
> }}}
> 
> I would like to see examples of how to create an object in this space, but there is no.

Example added.

> 3. There is an error on the repr of s recognizable series:
> 
> {{{
> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
> sage: S = Rec((M0,M1), (0,1), (1,1))
> sage: S
> <repr(<sage.combinat.recognizable_series.RecognizableSeriesSpace_with_category.element_class at 0x7fd8f6d68640>) failed: TypeError: unsupported operand parent(s) for *: '<type 'tuple'>' and 'Full MatrixSpace of 2 by 2 dense matrices over Integer Ring'>
> }}}

Fixed.

> 4. "The indices of this family are the alphabet." -> is the alphabet or -> are elements of the alphabet

Changed.


> 5. There is a ReST indentation problem in the paragraph of "transpose" of `RecognizableSeries?`	

Fixed.

> 6.
> 
> {{{
>         When created via the parent :class:`RecognizableSeriesSpace`, then
>         the following option is available.
> }}}
> 
> Then why should it be mentionned there? Is this option really necessary? I prefer
> 
> {{{
> sage: S = Rec(inputs).transposed()
> }}}
> 
> to
> 
> {{{
> sage: S = Rec(inputs, transpose=False)
> }}}

Indeed, this seems to be more natural to me now as well. Removed.

> 7. How to access to the coefficient of some word? This should be documented
>    soon, like in the top level module or in the constructors of series.
> 
> {{{
> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
> sage: S
> [] + [0] + 3*[1] + [00] + 3*[01] + 3*[10] + 5*[11] + [000] + 3*[001] + 3*[010] + ...
> sage: S([0,0,1])
> Traceback (most recent call last)
> ...
> TypeError: 'RecognizableSeriesSpace_with_category.element_class' object is not callable
> }}}

The input needs to be a word.

> 8. The documentation of the class `RecognizableSeriesSpace` does not contains any details relative to what `_element_constructor_` is doing.
> 
> {{{
>     def _element_constructor_(self, data,
>                               left=None, right=None,
>                               transpose=False):
>         r"""
>         Return a recognizable series.
> 
>         See :class:`RecognizableSeriesSpace` for details.
> }}}
> 
> I would rather document `left`, `right` and `transpose` here.
> Again, I do not know whether `transpose` is really necessary here. Unless there
> is an argument, I would just delete it.

Transpose was removed (see above).

> 9. I would remove this space, no?
> 
> {{{
> class RecognizableSeries(Element):
> 
>     def __init__(self, parent, mu, left, right):
> }}}

Removed.

> 10. In the book of Berstel and Reutenauer, the notation of the coefficient of a word w in a series S is (S,w). In Python, this gives a tuple which is not what we want. I agree that using `__getitem__` is the way to go.
> 
> {{{
> sage: M0 = matrix(2,[1,2,3,4])
> sage: M1 = matrix(2,[-2,1,3,-7])
> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
> sage: F = S.parent().indices()
> sage: S[F((0,0,1))]
> -103
> }}}
> 
> Would it be possible and desirable that the following also works?
> 
> {{{
> sage: M0 = matrix(2,[1,2,3,4])
> sage: M1 = matrix(2,[-2,1,3,-7])
> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
> sage: S[(0,0,1)]
> -103
> }}}

Yes, this is desirable; I'll open a follow-up ticket for it. (See #31769)

> 11.
> 
> {{{
> #!diff
>     - return prod(tuple(self.mu[a] for a in w), z=self._mu_of_empty_word_())
>     + return prod((self.mu[a] for a in w), z=self._mu_of_empty_word_())
> }}}

Done.

> 12. This calls `self[w]` twice which is not good:
> 
>     {{{
>         return iter((w, self[w])
>                     for w in self.parent().indices() if self[w] != 0)
>     }}}
> 
>     You may want to do a for loop with yields statements and replace `return iter([])` by a `raise StopIteration`.

The iter-method as inconsistent, as an "empty" sequence was handled differently than a finite sequence. So this been rewritten and is now quite easy.
(As a side note: Raising StopIteration in a generator expression will raise a RuntimeError; I believe a simple return should do the trick in this case.)

> 13. While reading chapter on Recognizable series of Berstel and Reutenauer, one
>     sees that `is_proper`, `S+S`, `S^+`, `S^*`, `S+1`, `2*S`,
>     `hadamard_product`, `a^-1*S`, `S.dimension()` are not implemented. Are
>     these intended to be coded? Why not in this ticket?

Arithmetic is done on follow-up tickets. (See meta ticket #21202)


> 14. I do not understand what this means:
> 
> {{{
>     def populate_interactive(self):
>         r"""
>         Return an iterator over possible new elements.
> }}}
> 
> Is the code equivalent to the following?
> 
> {{{
>         return (p + a
>                 for p in self.elements
>                 for a in self.words.iterate_by_length(1))
> }}}

See issue below. Now this method is called iterate_possible_additions. Indeed
it is roughly equivalent to the above, but iterate_possible_additions
also works correctly, when elements are extended in-between.

Documented now.

> 15. What should `__eq__` return?
> 
> {{{
> sage: M0 = matrix(2,[1,2,3,4])
> sage: M1 = matrix(2,[-2,1,3,-7])
> sage: Rec = RecognizableSeriesSpace(ZZ, (0,1))
> sage: S = Rec((M0,M1), vector((0,1)), vector((1,1)))
> sage: S == S.minimized()
> False
> }}}
> 
> Should it be `self.minimized() == other.minimized()` ?

Equality testing is not straight forward as it might be that two equal sequences
have different minimal representations. One can build the difference
and then minimize to see if it is the zero sequence.
This will also be done on a follow-up ticket, once arithmethic is ready.

> 16. There should be an example in the top level module doc showing a nice aspect of what this module do. The most important code for now seems to be (1) Creation of a recognizable series and (2) the minimization of a recognizable series.

The interesting stuff begins with regular sequences which is done on
the successor ticket of this ticket. A ref will be added then.

> 17. I would add a method `linear_representation` which would return the 3-tuple `(left, mu, right)`. From Berstel and Reutenauer: "the triple (λ, μ, γ) is called a linear representation of S", because print does not says much.

Added.



---

archive/issue_comments_291786.json:
```json
{
    "body": "Replying to [comment:27 cheuberg]:\n> 18. Please move reference `BR2010` to `src/doc/en/reference/references/index.rst` as per the developer's guide https://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content\n\nDone.\n\n> 19. The examples in the developer's guide do not have a closing punctuation for INPUT and OUTPUT items\n\nDone.\n\n> 20. `PrefixClosedSet.__init__`: I suggest to clarify in the docstring that the parameters `alphabet` and `words` are mutually exclusive and to also throw an error if this is not the case (currently, the `words` parameter is silently discarded if `alphabet` is set).\n\n__init__ rewritten.\n\n> 21. `PrefixClosedSet.__init__`: When first reading this, I was confused by the parameter `words` because I assumed that it actually contains words, and then the test shows a rather empty output. Therefore, I think it would be helpful if either the name of the parameter or the description clarifies that it is a *class* of words.\n\n__init__ rewritten.\n\n> 22. `PrefixClosedSet.populate_interactive`: from the name, I would guess that this method will actually add something to the set, but it is a mere iterator. Only the example then turns towards adding elements. Would a method name like  `iterate_possible_additions` be a better name?\n\nRenamed.\n\n> 23. `PrefixClosedSet.populate_interactive`: from the description and the example, I thought it might only list *new* elements. However, \n>     {{{\n>     sage: P = PrefixClosedSet(alphabet=[0, 1])\n>     sage: P.add(P.words([0]))\n>     sage: list(P.populate_interactive())\n>     [word: 0, word: 1, word: 00, word: 01]\n>     }}}\n>     Please clarify. \n\nClarified and example added.\n\n> 24. `PrefixClosedSet.prefix_set`: For me, the description does not explain what the method does; it is only understandible in the context of BR2010, Proposition 2.3.1. Something like \"the set of minimal (with respect to prefix ordering) elements of the complement of self\"?\n\nDescription rewritten and reference added.\n\n> 25. `RecognizableSeries.__init__`: The docstring promises that the documentation of `left` and `right` will give more details. I do not think that this is the case. I appreciate providing a link, but suggest to adapt the wording.\n\nWording adapted.\n\n> 26. `RecognizableSeries.__iter__`: please document explicitly that the empty word is not included.\n\nThis is included; example added.\n\n> 27. `RecognizableSeries.__bool__`: what is the role of `sage: S  # not tested` in the tests?\n\nNo idea anymore; I've removed it.\n\n> 28. `RecognizableSeries.transposed`: replace the `map` function by a list comprehension to avoid Python3 issues\n\nThis map is actually the map method of sage.sets.family.AbstractFamily, so I don't think it should be replaced.\n\n> 29. In the algorithm described in Chapter 2 of BR2010, K is assumed to be a field (it is not stated in the description of the algorithm, but before the crucial Proposition 2.2.1 as well as the crucial theorem 3.2. As far as I can see, this is not mentioned in the documentation or the code here (and `__bool__` calls `minimized`).\n\nYes, indeed. Minimization uses solve_left, this is a place, where it is hidden (did not find any others right now.)\nNow documented.\n\nSee also follow-up ticket #31770\n\n> 30. `RecognizableSeries._minimized_left_`: the tests demonstrate that the zero sequence has no consistent minimized representation: sometimes, it is a 1x1 representation with 0 entries; sometimes, a 0x0 representation.\n\nI believe, this is not true. The 1x1 representation is not the zero sequence; it has a nonzero constant coefficient. This is (I hope; for sure so in the examples) also the reason why the minimization algorithm is returning this.\n\n> 31. `RecognizableSeries._minimized_left_`: one could start with `ML = matrix(0, self.left.degree())` and then use `ML = ML.stack(vector(left))` and get rid of the local variable `Left`. No extra treatment for `pcs.element(0)` would be necessary (as long as `PrefixClosedSet.populate_interactive` includes the empty word, which I would consider to be more consistent).\n\nI believe that populate_interactive should not include the empty word. It is renamed now to iterate_possible_additions which makes its purpose more obvious. The empty word is not something you want to add. (I agree, however, that with your above idea, including the empty word would be worth it; maybe renaming the method once more.)\n\n> 32. `RecognizableSeries._minimized_left_`: it seems that `alpha(c)` is called repeatedly for all entries of the row corresponding to p with p+a in C. So I suggest to either cache the value alpha(c) or to construct the matrix row by row (either as `alpha(c)` or as `[ZZ(c==q) for q in P]`, depending on whether `c in C`).\n\nRewritten to row by row constuction; this seem much more readable now.",
    "created_at": "2021-05-03T16:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291786",
    "user": "dkrenn"
}
```

Replying to [comment:27 cheuberg]:
> 18. Please move reference `BR2010` to `src/doc/en/reference/references/index.rst` as per the developer's guide https://doc.sagemath.org/html/en/developer/coding_basics.html#the-docstring-of-a-function-content

Done.

> 19. The examples in the developer's guide do not have a closing punctuation for INPUT and OUTPUT items

Done.

> 20. `PrefixClosedSet.__init__`: I suggest to clarify in the docstring that the parameters `alphabet` and `words` are mutually exclusive and to also throw an error if this is not the case (currently, the `words` parameter is silently discarded if `alphabet` is set).

__init__ rewritten.

> 21. `PrefixClosedSet.__init__`: When first reading this, I was confused by the parameter `words` because I assumed that it actually contains words, and then the test shows a rather empty output. Therefore, I think it would be helpful if either the name of the parameter or the description clarifies that it is a *class* of words.

__init__ rewritten.

> 22. `PrefixClosedSet.populate_interactive`: from the name, I would guess that this method will actually add something to the set, but it is a mere iterator. Only the example then turns towards adding elements. Would a method name like  `iterate_possible_additions` be a better name?

Renamed.

> 23. `PrefixClosedSet.populate_interactive`: from the description and the example, I thought it might only list *new* elements. However, 
>     {{{
>     sage: P = PrefixClosedSet(alphabet=[0, 1])
>     sage: P.add(P.words([0]))
>     sage: list(P.populate_interactive())
>     [word: 0, word: 1, word: 00, word: 01]
>     }}}
>     Please clarify. 

Clarified and example added.

> 24. `PrefixClosedSet.prefix_set`: For me, the description does not explain what the method does; it is only understandible in the context of BR2010, Proposition 2.3.1. Something like "the set of minimal (with respect to prefix ordering) elements of the complement of self"?

Description rewritten and reference added.

> 25. `RecognizableSeries.__init__`: The docstring promises that the documentation of `left` and `right` will give more details. I do not think that this is the case. I appreciate providing a link, but suggest to adapt the wording.

Wording adapted.

> 26. `RecognizableSeries.__iter__`: please document explicitly that the empty word is not included.

This is included; example added.

> 27. `RecognizableSeries.__bool__`: what is the role of `sage: S  # not tested` in the tests?

No idea anymore; I've removed it.

> 28. `RecognizableSeries.transposed`: replace the `map` function by a list comprehension to avoid Python3 issues

This map is actually the map method of sage.sets.family.AbstractFamily, so I don't think it should be replaced.

> 29. In the algorithm described in Chapter 2 of BR2010, K is assumed to be a field (it is not stated in the description of the algorithm, but before the crucial Proposition 2.2.1 as well as the crucial theorem 3.2. As far as I can see, this is not mentioned in the documentation or the code here (and `__bool__` calls `minimized`).

Yes, indeed. Minimization uses solve_left, this is a place, where it is hidden (did not find any others right now.)
Now documented.

See also follow-up ticket #31770

> 30. `RecognizableSeries._minimized_left_`: the tests demonstrate that the zero sequence has no consistent minimized representation: sometimes, it is a 1x1 representation with 0 entries; sometimes, a 0x0 representation.

I believe, this is not true. The 1x1 representation is not the zero sequence; it has a nonzero constant coefficient. This is (I hope; for sure so in the examples) also the reason why the minimization algorithm is returning this.

> 31. `RecognizableSeries._minimized_left_`: one could start with `ML = matrix(0, self.left.degree())` and then use `ML = ML.stack(vector(left))` and get rid of the local variable `Left`. No extra treatment for `pcs.element(0)` would be necessary (as long as `PrefixClosedSet.populate_interactive` includes the empty word, which I would consider to be more consistent).

I believe that populate_interactive should not include the empty word. It is renamed now to iterate_possible_additions which makes its purpose more obvious. The empty word is not something you want to add. (I agree, however, that with your above idea, including the empty word would be worth it; maybe renaming the method once more.)

> 32. `RecognizableSeries._minimized_left_`: it seems that `alpha(c)` is called repeatedly for all entries of the row corresponding to p with p+a in C. So I suggest to either cache the value alpha(c) or to construct the matrix row by row (either as `alpha(c)` or as `[ZZ(c==q) for q in P]`, depending on whether `c in C`).

Rewritten to row by row constuction; this seem much more readable now.



---

archive/issue_comments_291787.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-03T17:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291787",
    "user": "dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-04T18:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291789.json:
```json
{
    "body": "Thank you for your changes and comments. I added a reviewer commit.\n\nI still have three comments:\n\n7. I would also appreciate having an example in a very visible spot on how to access a coefficient.\n   I think that unless someone guesses the `__getitem__` method, they might have some hard time,\n   in particular in view of the fact that the documentation of `__getitem__` is not visible\n   in the reference manual.\n\n29. In the module description, `K` is supposed to be a semiring. I fear that something bad might happen if that semiring is not a domain; \"coefficients are automatically coerced to their fraction field.\" might then be inappropriate. As `minimized` is called by `__bool__`, the explanation added in `minimized` might not be enough.\n\n33. `RecognizableSeries._repr_.all_coefficients`: I think that the variable name `number_of_nonzeros` is misleading: it seems to count the number of zeros since the last zero. So I think that `number_of_zeros` would be more appropriate.",
    "created_at": "2021-05-04T18:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291789",
    "user": "cheuberg"
}
```

Thank you for your changes and comments. I added a reviewer commit.

I still have three comments:

7. I would also appreciate having an example in a very visible spot on how to access a coefficient.
   I think that unless someone guesses the `__getitem__` method, they might have some hard time,
   in particular in view of the fact that the documentation of `__getitem__` is not visible
   in the reference manual.

29. In the module description, `K` is supposed to be a semiring. I fear that something bad might happen if that semiring is not a domain; "coefficients are automatically coerced to their fraction field." might then be inappropriate. As `minimized` is called by `__bool__`, the explanation added in `minimized` might not be enough.

33. `RecognizableSeries._repr_.all_coefficients`: I think that the variable name `number_of_nonzeros` is misleading: it seems to count the number of zeros since the last zero. So I think that `number_of_zeros` would be more appropriate.



---

archive/issue_comments_291790.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-05-04T18:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291790",
    "user": "cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_291791.json:
```json
{
    "body": "For the record: the findings by the linters do not concern the files changed in this ticket.",
    "created_at": "2021-05-04T18:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291791",
    "user": "cheuberg"
}
```

For the record: the findings by the linters do not concern the files changed in this ticket.



---

archive/issue_comments_291792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-06T18:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291792",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_291793.json:
```json
{
    "body": "Replying to [comment:37 cheuberg]:\n> 7. I would also appreciate having an example in a very visible spot on how to access a coefficient.\n>    I think that unless someone guesses the `__getitem__` method, they might have some hard time,\n>    in particular in view of the fact that the documentation of `__getitem__` is not visible\n>    in the reference manual.\n\nAdded.\n\n> 29. In the module description, `K` is supposed to be a semiring. I fear that something bad might happen if that semiring is not a domain; \"coefficients are automatically coerced to their fraction field.\" might then be inappropriate. As `minimized` is called by `__bool__`, the explanation added in `minimized` might not be enough.\n\nNote added.\n\n> 33. `RecognizableSeries._repr_.all_coefficients`: I think that the variable name `number_of_nonzeros` is misleading: it seems to count the number of zeros since the last zero. So I think that `number_of_zeros` would be more appropriate.\n\nIndeed; renamed.\n----\nNew commits:",
    "created_at": "2021-05-06T18:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291793",
    "user": "dkrenn"
}
```

Replying to [comment:37 cheuberg]:
> 7. I would also appreciate having an example in a very visible spot on how to access a coefficient.
>    I think that unless someone guesses the `__getitem__` method, they might have some hard time,
>    in particular in view of the fact that the documentation of `__getitem__` is not visible
>    in the reference manual.

Added.

> 29. In the module description, `K` is supposed to be a semiring. I fear that something bad might happen if that semiring is not a domain; "coefficients are automatically coerced to their fraction field." might then be inappropriate. As `minimized` is called by `__bool__`, the explanation added in `minimized` might not be enough.

Note added.

> 33. `RecognizableSeries._repr_.all_coefficients`: I think that the variable name `number_of_nonzeros` is misleading: it seems to count the number of zeros since the last zero. So I think that `number_of_zeros` would be more appropriate.

Indeed; renamed.
----
New commits:



---

archive/issue_comments_291794.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-05-06T18:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291794",
    "user": "dkrenn"
}
```

Last 10 new commits:



---

archive/issue_comments_291795.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-06T18:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291795",
    "user": "dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_291796.json:
```json
{
    "body": "Thank you for your changes and comments. I have no further comments, feel free to set to positive once the patchbot is happy.",
    "created_at": "2021-05-06T19:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291796",
    "user": "cheuberg"
}
```

Thank you for your changes and comments. I have no further comments, feel free to set to positive once the patchbot is happy.



---

archive/issue_comments_291797.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-07T04:16:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291797",
    "user": "cheuberg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291798.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-05-10T11:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291798",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_291799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-05-10T11:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291799",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_291800.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-11T13:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291800",
    "user": "dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_291801.json:
```json
{
    "body": "I add dependency #30551 (Drop python 3.6 support): this ticket introduces occurrences of `islice` with an sage integer as an argument; this does not work with python 3.6.\n\nAn alternative would be to explicitly convert to an integer, but as #30551 is positively reviewed, this does not seem to be necessary.",
    "created_at": "2021-05-17T04:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291801",
    "user": "cheuberg"
}
```

I add dependency #30551 (Drop python 3.6 support): this ticket introduces occurrences of `islice` with an sage integer as an argument; this does not work with python 3.6.

An alternative would be to explicitly convert to an integer, but as #30551 is positively reviewed, this does not seem to be necessary.



---

archive/issue_comments_291802.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21058#issuecomment-291802",
    "user": "vbraun"
}
```

Resolution: fixed
