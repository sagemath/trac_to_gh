# Issue 25099: Feature check for bliss is broken

Issue created by migration from https://trac.sagemath.org/ticket/25336

Original creator: jdemeyer

Original creation time: 2018-05-10 18:45:32

See #25332


---

Comment by fbissey created at 2018-05-10 23:32:25

This is strange, I am getting different problems in doctests and sage itself

```
fbissey@moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py 
Running doctests with ID 2018-05-11-11-27-05-bcb5cc37.
Git branch: develop
Using --optional=bliss
Doctesting 1 file.
sage -t --warn-long 81.0 src/sage/features/bliss.py
**********************************************************************
File "src/sage/features/bliss.py", line 31, in sage.features.bliss.BlissLibrary
Failed example:
    BlissLibrary().require()  # optional: bliss
Exception raised:
    Traceback (most recent call last):
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.bliss.BlissLibrary[0]>", line 1, in <module>
        BlissLibrary().require()  # optional: bliss
    NameError: name 'BlissLibrary' is not defined
**********************************************************************
File "src/sage/features/bliss.py", line 53, in sage.features.bliss.Bliss
Failed example:
    Bliss().require()  # optional: bliss
Exception raised:
    Traceback (most recent call last):
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.bliss.Bliss[0]>", line 1, in <module>
        Bliss().require()  # optional: bliss
    NameError: name 'Bliss' is not defined
**********************************************************************
2 items had failures:
   1 of   2 in sage.features.bliss.Bliss
   1 of   2 in sage.features.bliss.BlissLibrary
    [2 tests, 2 failures, 0.29 s]
----------------------------------------------------------------------
sage -t --warn-long 81.0 src/sage/features/bliss.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.3 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
```

But running those failing tests from sage

```
sage: from sage.features.bliss import BlissLibrary
sage: BlissLibrary().require()
---------------------------------------------------------------------------
FeatureNotPresentError                    Traceback (most recent call last)
<ipython-input-3-0ff2f4e6e422> in <module>()
----> 1 BlissLibrary().require()

/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/features/__init__.pyc in require(self)
    156         presence = self.is_present()
    157         if not presence:
--> 158             raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    159 
    160     def __repr__(self):

FeatureNotPresentError: Bliss is not available.
Failed to run test code.
To install Bliss you can try to run 'sage -i bliss'.
Further installation instructions might be available at http://www.tcs.hut.fi/Software/bliss/.
sage: from sage.features.bliss import Bliss
sage: Bliss().require()
sage: BlissLibrary()
Feature('Bliss')
```

I get one failure that is different. Cannot run the cython code. And the other test is actually successful.


---

Comment by vdelecroix created at 2018-05-13 09:02:19

Replying to [comment:1 fbissey]:
> This is strange, I am getting different problems in doctests and sage itself
> {{{
> fbissey`@`moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py 
> <SNIP>
> }}}

This should be tested with `sage -t --optional=sage,bliss`.


---

Comment by vdelecroix created at 2018-05-13 09:06:54

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-05-13 09:06:54

New commits:


---

Comment by fbissey created at 2018-05-13 09:21:10

Replying to [comment:2 vdelecroix]:
> Replying to [comment:1 fbissey]:
> > This is strange, I am getting different problems in doctests and sage itself
> > {{{
> > fbissey`@`moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py 
> > <SNIP>
> > }}}
> 
> This should be tested with `sage -t --optional=sage,bliss`.

I see. A rather stupid requirement, but it can't be helped and it explains why things seem to turn to custard when I try to test optional packages.

I'll be ready to review this stuff in the morning in my time zone.


---

Comment by fbissey created at 2018-05-13 22:01:31

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2018-05-13 22:01:31

Fixes all the problems for me.


---

Comment by vbraun created at 2018-05-15 22:34:03

Resolution: fixed
