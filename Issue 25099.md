# Issue 25099: Feature check for bliss is broken

archive/issues_025099.json:
```json
{
    "body": "See #25332\n\nIssue created by migration from https://trac.sagemath.org/ticket/25336\n\n",
    "created_at": "2018-05-10T18:45:32Z",
    "labels": [
        "misc",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Feature check for bliss is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25099",
    "user": "jdemeyer"
}
```
See #25332

Issue created by migration from https://trac.sagemath.org/ticket/25336





---

archive/issue_comments_353186.json:
```json
{
    "body": "This is strange, I am getting different problems in doctests and sage itself\n\n```\nfbissey@moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py \nRunning doctests with ID 2018-05-11-11-27-05-bcb5cc37.\nGit branch: develop\nUsing --optional=bliss\nDoctesting 1 file.\nsage -t --warn-long 81.0 src/sage/features/bliss.py\n**********************************************************************\nFile \"src/sage/features/bliss.py\", line 31, in sage.features.bliss.BlissLibrary\nFailed example:\n    BlissLibrary().require()  # optional: bliss\nException raised:\n    Traceback (most recent call last):\n      File \"/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.features.bliss.BlissLibrary[0]>\", line 1, in <module>\n        BlissLibrary().require()  # optional: bliss\n    NameError: name 'BlissLibrary' is not defined\n**********************************************************************\nFile \"src/sage/features/bliss.py\", line 53, in sage.features.bliss.Bliss\nFailed example:\n    Bliss().require()  # optional: bliss\nException raised:\n    Traceback (most recent call last):\n      File \"/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 562, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 972, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.features.bliss.Bliss[0]>\", line 1, in <module>\n        Bliss().require()  # optional: bliss\n    NameError: name 'Bliss' is not defined\n**********************************************************************\n2 items had failures:\n   1 of   2 in sage.features.bliss.Bliss\n   1 of   2 in sage.features.bliss.BlissLibrary\n    [2 tests, 2 failures, 0.29 s]\n----------------------------------------------------------------------\nsage -t --warn-long 81.0 src/sage/features/bliss.py  # 2 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.3 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.3 seconds\n```\n\nBut running those failing tests from sage\n\n```\nsage: from sage.features.bliss import BlissLibrary\nsage: BlissLibrary().require()\n---------------------------------------------------------------------------\nFeatureNotPresentError                    Traceback (most recent call last)\n<ipython-input-3-0ff2f4e6e422> in <module>()\n----> 1 BlissLibrary().require()\n\n/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/features/__init__.pyc in require(self)\n    156         presence = self.is_present()\n    157         if not presence:\n--> 158             raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    159 \n    160     def __repr__(self):\n\nFeatureNotPresentError: Bliss is not available.\nFailed to run test code.\nTo install Bliss you can try to run 'sage -i bliss'.\nFurther installation instructions might be available at http://www.tcs.hut.fi/Software/bliss/.\nsage: from sage.features.bliss import Bliss\nsage: Bliss().require()\nsage: BlissLibrary()\nFeature('Bliss')\n```\n\nI get one failure that is different. Cannot run the cython code. And the other test is actually successful.",
    "created_at": "2018-05-10T23:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353186",
    "user": "fbissey"
}
```

This is strange, I am getting different problems in doctests and sage itself

```
fbissey@moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py 
Running doctests with ID 2018-05-11-11-27-05-bcb5cc37.
Git branch: develop
Using --optional=bliss
Doctesting 1 file.
sage -t --warn-long 81.0 src/sage/features/bliss.py
**********************************************************************
File "src/sage/features/bliss.py", line 31, in sage.features.bliss.BlissLibrary
Failed example:
    BlissLibrary().require()  # optional: bliss
Exception raised:
    Traceback (most recent call last):
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.bliss.BlissLibrary[0]>", line 1, in <module>
        BlissLibrary().require()  # optional: bliss
    NameError: name 'BlissLibrary' is not defined
**********************************************************************
File "src/sage/features/bliss.py", line 53, in sage.features.bliss.Bliss
Failed example:
    Bliss().require()  # optional: bliss
Exception raised:
    Traceback (most recent call last):
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 562, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 972, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.features.bliss.Bliss[0]>", line 1, in <module>
        Bliss().require()  # optional: bliss
    NameError: name 'Bliss' is not defined
**********************************************************************
2 items had failures:
   1 of   2 in sage.features.bliss.Bliss
   1 of   2 in sage.features.bliss.BlissLibrary
    [2 tests, 2 failures, 0.29 s]
----------------------------------------------------------------------
sage -t --warn-long 81.0 src/sage/features/bliss.py  # 2 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.3 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.3 seconds
```

But running those failing tests from sage

```
sage: from sage.features.bliss import BlissLibrary
sage: BlissLibrary().require()
---------------------------------------------------------------------------
FeatureNotPresentError                    Traceback (most recent call last)
<ipython-input-3-0ff2f4e6e422> in <module>()
----> 1 BlissLibrary().require()

/home/fbissey/sandbox/git-fork/sage-8.3.b0/local/lib/python2.7/site-packages/sage/features/__init__.pyc in require(self)
    156         presence = self.is_present()
    157         if not presence:
--> 158             raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    159 
    160     def __repr__(self):

FeatureNotPresentError: Bliss is not available.
Failed to run test code.
To install Bliss you can try to run 'sage -i bliss'.
Further installation instructions might be available at http://www.tcs.hut.fi/Software/bliss/.
sage: from sage.features.bliss import Bliss
sage: Bliss().require()
sage: BlissLibrary()
Feature('Bliss')
```

I get one failure that is different. Cannot run the cython code. And the other test is actually successful.



---

archive/issue_comments_353187.json:
```json
{
    "body": "Replying to [comment:1 fbissey]:\n> This is strange, I am getting different problems in doctests and sage itself\n> {{{\n> fbissey`@`moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py \n> <SNIP>\n> }}}\n\nThis should be tested with `sage -t --optional=sage,bliss`.",
    "created_at": "2018-05-13T09:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353187",
    "user": "vdelecroix"
}
```

Replying to [comment:1 fbissey]:
> This is strange, I am getting different problems in doctests and sage itself
> {{{
> fbissey`@`moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py 
> <SNIP>
> }}}

This should be tested with `sage -t --optional=sage,bliss`.



---

archive/issue_comments_353188.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-13T09:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353188",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_353189.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-13T09:06:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353189",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_353190.json:
```json
{
    "body": "Replying to [comment:2 vdelecroix]:\n> Replying to [comment:1 fbissey]:\n> > This is strange, I am getting different problems in doctests and sage itself\n> > {{{\n> > fbissey`@`moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py \n> > <SNIP>\n> > }}}\n> \n> This should be tested with `sage -t --optional=sage,bliss`.\n\nI see. A rather stupid requirement, but it can't be helped and it explains why things seem to turn to custard when I try to test optional packages.\n\nI'll be ready to review this stuff in the morning in my time zone.",
    "created_at": "2018-05-13T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353190",
    "user": "fbissey"
}
```

Replying to [comment:2 vdelecroix]:
> Replying to [comment:1 fbissey]:
> > This is strange, I am getting different problems in doctests and sage itself
> > {{{
> > fbissey`@`moonloop ~/sandbox/git-fork/sage-8.3.b0 $ ./sage -t --optional=bliss src/sage/features/bliss.py 
> > <SNIP>
> > }}}
> 
> This should be tested with `sage -t --optional=sage,bliss`.

I see. A rather stupid requirement, but it can't be helped and it explains why things seem to turn to custard when I try to test optional packages.

I'll be ready to review this stuff in the morning in my time zone.



---

archive/issue_comments_353191.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-13T22:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353191",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_353192.json:
```json
{
    "body": "Fixes all the problems for me.",
    "created_at": "2018-05-13T22:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353192",
    "user": "fbissey"
}
```

Fixes all the problems for me.



---

archive/issue_comments_353193.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-15T22:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25099",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25099#issuecomment-353193",
    "user": "vbraun"
}
```

Resolution: fixed
