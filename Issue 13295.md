# Issue 13295: Update TOPCOM to 0.17.4

Issue created by migration from https://trac.sagemath.org/ticket/13499

Original creator: vbraun

Original creation time: 2012-09-17 09:38:14

Assignee: mhampton

CC:  mhampton novoselt

The optional TOPCOM spkg doesn't build with newer gcc due to stricter C++ compliance of the compiler. Upstream has fixed this. This is a simple rebase of the spkg, all I did was

* extract the new source
* add names of newly-added programs to patches/src/Makefile.am
* regenerate the auto-generated files

New spkg is at http://www.stp.dias.ie/~vbraun/Sage/spkg/TOPCOM-0.17.4.spkg


---

Comment by vbraun created at 2012-09-17 10:05:08

Changing status from new to needs_review.


---

Comment by mhampton created at 2012-09-19 13:07:55

This installed fine on my mac (10.6.8) but failed on a linux machine.  It is Kubuntu 11.10, with gcc 4.6.1.  I can report other specs if they are helpful.  The tail of the TOPCOM install is:


```
Making all in src-reg
make[1]: Entering directory `/media/T3b/sagestuff/sage-5.3.beta2/spkg/build/TOPCOM-0.17.4/src/src-reg'
g++ -DPACKAGE_NAME=\"TOPCOM\" -DPACKAGE_TARNAME=\"topcom\" -DPACKAGE_VERSION=\"0.17.4\" -DPACKAGE_STRING=\"TOPCOM\ 0.17.4\" -DPACKAGE_BUGREPORT=\"\" -DPACKAGE_URL=\"\" -DPACKAGE=\"topcom\" -DVERSION=\"0.17.4\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -DSTDC_HEADERS=1 -I. -I/media/T3b/sagestuff/sage-5.3.beta2/local/include -I/media/T3b/sagestuff/sage-5.3.beta2/local/include -I../wrap-gmp-gmpxx -I../lib-src -I../lib-src-reg -DVERBOSE -DGMPRATIONAL -ftemplate-depth-30    -MT checkregularity.o -MD -MP -MF .deps/checkregularity.Tpo -c -o checkregularity.o checkregularity.cc
mv -f .deps/checkregularity.Tpo .deps/checkregularity.Po
/bin/bash ../libtool --tag=CXX   --mode=link g++   -L/media/T3b/sagestuff/sage-5.3.beta2/local/lib -lcddgmp -L/media/T3b/sagestuff/sage-5.3.beta2/local/lib -lgmp -lgmpxx  -o checkregularity checkregularity.o ../lib-src-reg/libCHECKREG.la ../lib-src/libTOPCOM.la   
libtool: link: g++ -o .libs/checkregularity checkregularity.o  -L/media/T3b/sagestuff/sage-5.3.beta2/local/lib /media/T3b/sagestuff/sage-5.3.beta2/local/lib/libcddgmp.so /media/T3b/sagestuff/sage-5.3.beta2/local/lib/libgmpxx.so /media/T3b/sagestuff/sage-5.3.beta2/local/lib/libgmp.so ../lib-src-reg/.libs/libCHECKREG.so ../lib-src/.libs/libTOPCOM.so -Wl,-rpath -Wl,/media/T3b/sagestuff/sage-5.3.beta2/local/lib
make[1]: Leaving directory `/media/T3b/sagestuff/sage-5.3.beta2/spkg/build/TOPCOM-0.17.4/src/src-reg'
Making all in src
make[1]: Entering directory `/media/T3b/sagestuff/sage-5.3.beta2/spkg/build/TOPCOM-0.17.4/src/src'
g++ -DPACKAGE_NAME=\"TOPCOM\" -DPACKAGE_TARNAME=\"topcom\" -DPACKAGE_VERSION=\"0.17.4\" -DPACKAGE_STRING=\"TOPCOM\ 0.17.4\" -DPACKAGE_BUGREPORT=\"\" -DPACKAGE_URL=\"\" -DPACKAGE=\"topcom\" -DVERSION=\"0.17.4\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -DSTDC_HEADERS=1 -I. -I/media/T3b/sagestuff/sage-5.3.beta2/local/include -I/media/T3b/sagestuff/sage-5.3.beta2/local/include -I../wrap-gmp-gmpxx -I../lib-src -I../lib-src-reg -DVERBOSE -DGMPRATIONAL -ftemplate-depth-30    -MT bench.o -MD -MP -MF .deps/bench.Tpo -c -o bench.o bench.cc
mv -f .deps/bench.Tpo .deps/bench.Po
/bin/bash ../libtool --tag=CXX   --mode=link g++   -L/media/T3b/sagestuff/sage-5.3.beta2/local/lib -lcddgmp -L/media/T3b/sagestuff/sage-5.3.beta2/local/lib -lgmp -lgmpxx  -o bench bench.o ../lib-src/libTOPCOM.la ../lib-src-reg/libCHECKREG.la  
libtool: link: g++ -o .libs/bench bench.o  -L/media/T3b/sagestuff/sage-5.3.beta2/local/lib /media/T3b/sagestuff/sage-5.3.beta2/local/lib/libcddgmp.so /media/T3b/sagestuff/sage-5.3.beta2/local/lib/libgmpxx.so /media/T3b/sagestuff/sage-5.3.beta2/local/lib/libgmp.so ../lib-src/.libs/libTOPCOM.so ../lib-src-reg/.libs/libCHECKREG.so -Wl,-rpath -Wl,/media/T3b/sagestuff/sage-5.3.beta2/local/lib
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_EqualToZero'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_LPSolve'
../lib-src/.libs/libTOPCOM.so: undefined reference to `dd_FreeLPSolution'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_set_global_constants'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_CopyLPSolution'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_MakeLPforInteriorFinding'
../lib-src/.libs/libTOPCOM.so: undefined reference to `dd_free_global_constants'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_Negative'
../lib-src/.libs/libTOPCOM.so: undefined reference to `dd_FreeMatrix'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_CreateMatrix'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_Positive'
../lib-src/.libs/libTOPCOM.so: undefined reference to `operator>>(std::basic_istream<char, std::char_traits<char> >&, __mpq_struct*)'
../lib-src/.libs/libTOPCOM.so: undefined reference to `dd_FreeLPData'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_WriteNumber'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_WriteErrorMessages'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_Matrix2LP'
../lib-src/.libs/libTOPCOM.so: undefined reference to `operator<<(std::basic_ostream<char, std::char_traits<char> >&, __mpq_struct const*)'
../lib-src-reg/.libs/libCHECKREG.so: undefined reference to `dd_WriteMatrix'
collect2: ld returned 1 exit status
make[1]: *** [bench] Error 1
make[1]: Leaving directory `/media/T3b/sagestuff/sage-5.3.beta2/spkg/build/TOPCOM-0.17.4/src/src'
make: *** [all-recursive] Error 1
Error building TOPCOM.

```



---

Comment by vbraun created at 2012-09-19 13:55:54

I've added the missing libcddgmp library dependency and updated the SPKG (same location). This should fix the issue. Can you try again?


---

Comment by mhampton created at 2012-09-19 17:43:22

That seems to have fixed it.  The new package also still works on my mac.  Considering this is fixing a broken optional package I think that is enough for a positive review.


---

Comment by mhampton created at 2012-09-19 17:43:43

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-09-20 06:42:29

Changing component from geometry to optional packages.


---

Comment by schilly created at 2012-09-25 14:05:33

I just put the spkg on the server and mirrors.


---

Comment by jdemeyer created at 2012-09-25 21:53:38

Resolution: fixed
