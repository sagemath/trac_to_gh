# Issue 29734: Make categories doctests ready for random seeds

Issue created by migration from https://trac.sagemath.org/ticket/29971

Original creator: @kliem

Original creation time: 2020-06-24 20:40:51

This ticket makes

```
sage -t --long --random-seed=n src/sage/categories/
```

pass for different values `n` than just `0`.



---

Comment by @kliem created at 2020-06-24 20:45:54

New commits:


---

Comment by @kliem created at 2020-06-24 20:45:54

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-06-25 18:45:31

I'm not sure if this is a good way to update the doctests. Essentially you are disabling a test by marking it random; the only way it can fail is if it raises an error.

I think it would be better to invent a new doctest tag such as "# random_seed=0" or whatever is syntactically convenient.


---

Comment by @kliem created at 2020-06-25 18:51:30

To advertise my point about testing this stuff random #29961. In this instance, the `get_random_element` thing really failed sometimes. It wasn't discovered before, because only seed 0 is tested.

What's the point about testing this only at seed 0. This doesn't tell us anything about how stable the method is.

But I should add a test that illustrates that this is an element of the correct thing.


---

Comment by git created at 2020-06-25 20:31:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-06-25 20:33:13

Is this better? I would say the test is now more valuable than the old tests. It tells us that `random_element` will give us an element (not just on random seed 0 and not just something that looks like an element).


---

Comment by mkoeppe created at 2020-06-25 21:45:23

Replying to [comment:3 gh-kliem]:
> To advertise my point about testing this stuff random #29961. In this instance, the `get_random_element` thing really failed sometimes. It wasn't discovered before, because only seed 0 is tested.
> 
> What's the point about testing this only at seed 0.

Well, my main point is that test coverage before and after this ticket are really incomparable.  The change 
 - drops the test for seed 0 giving a specific element (or, as you say, what looks like an element); 
 - adds a test for an arbitrary seed giving no error and passing the `__contains__` test


---

Comment by @kliem created at 2020-06-26 06:16:08

The other thing that one could do, if you really want to keep the old test, is add the old test in the `TESTS` block (starting with `set_random_seed(0)`).

This way one could keep the old test.


---

Comment by mkoeppe created at 2020-06-26 16:44:28

I'm not sure if I like explicit `set_random_seed` calls in the doctests because they affect all following doctests in the same block. 

I would prefer a solution as proposed in comment 2 above if this can be done easily.


---

Comment by @kliem created at 2020-06-26 20:40:15

How will the solution as in comment two work out if all testings are done with random seed. That would basically mean, it is never tested as well.

I know that `set_random_seed(0)` will affect all other tests in the same block. This is why I propsed having it in the tests section (as last thing being run). Than it wouldn't affect anything.


---

Comment by jhpalmieri created at 2020-06-26 23:41:44

How about a Makefile target that runs tests with `random_seed=0`, or maybe a Makefile target that runs tests twice, once with `seed=0` and once with a random seed? Then make sure that people start thinking of that as the new default.

Or as `@`gh-kliem suggests, double up on some doctests:

```
    sage: test1
    sage: test2

End of test block::

    sage: test1 # random-seed=0
    sage: test2 # random-seed=0
```



---

Comment by @kliem created at 2020-06-27 08:39:40

I feel like the discussion is on the wrong ticket.

This ticket is merely about making tests in categories pass with a different random seed than `0`.

In principal a new flag `random-seed=0` sounds fine, but shouldn't be introduced here. That should be introduced in #29962 I think, or in a seperate follow up ticket that this here is based on.

The discussion about the big pictures mainly happened on sage-devel and on #29935 so far.

I mean there are 23 tickets like this and we should really come up with a uniform way to do them all. I'm fine with doing those 23 tickets, but if the general set up should be different, I might need some help with #29962 or #29935 (one introduces random seed, one makes them default after 23 tickets made all parts of sage compatible to it).


---

Comment by mkoeppe created at 2020-06-27 17:34:29

I agree, discussing this on sage-devel and #29935 would probably be best.


---

Comment by @kliem created at 2020-07-12 18:16:04

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2020-07-12 18:16:04

Merge conflict.

I also need to go through it again and check I respected the design decision in #29935.


---

Comment by @kliem created at 2020-07-20 04:42:48

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-07-20 04:42:48

New commits:


---

Comment by @kliem created at 2020-07-20 04:43:59

Note that elements of `C = FiniteEnumeratedSets().example()` are not elements of `C`, but integers.


---

Comment by @mwageringel created at 2020-08-13 20:15:41

This seems to work.


---

Comment by @mwageringel created at 2020-08-13 20:15:41

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-08-14 05:13:07

Thank you.


---

Comment by vbraun created at 2020-08-16 22:33:03

Resolution: fixed
