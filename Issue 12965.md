# Issue 12965: upgrade MPIR to 2.5.1

archive/issues_012965.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jpflori\n\nKeywords: mpir\n\nAs the summary says. Also, mpir-2.4.0.p5.spkg fails self-tests, and upgrading should fix this.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13137\n\n",
    "created_at": "2012-06-19T20:32:40Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "upgrade MPIR to 2.5.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12965",
    "user": "https://github.com/jhpalmieri"
}
```
Assignee: tbd

CC:  jpflori

Keywords: mpir

As the summary says. Also, mpir-2.4.0.p5.spkg fails self-tests, and upgrading should fix this.

Issue created by migration from https://trac.sagemath.org/ticket/13137





---

archive/issue_comments_156280.json:
```json
{
    "body": "Attachment [trac_13137-stopgap.patch](tarball://root/attachments/some-uuid/ticket13137/trac_13137-stopgap.patch) by @jhpalmieri created at 2012-06-19 20:37:37\n\nroot repo",
    "created_at": "2012-06-19T20:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156280",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13137-stopgap.patch](tarball://root/attachments/some-uuid/ticket13137/trac_13137-stopgap.patch) by @jhpalmieri created at 2012-06-19 20:37:37

root repo



---

archive/issue_comments_156281.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-19T20:59:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156281",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_156282.json:
```json
{
    "body": "This causes the libm4rie test suite to fail, as well as breaks the building of linbox (both have the same errors):\n\n```\nIn file included from .../local/include/gmp++/gmp++.h:20:0,\n                 from ../../linbox/integer.h:22,\n                 from ../../linbox/randiter/abstract.h:30,\n                 from ../../linbox/field/abstract.h:32,\n                 from ../../linbox/field/archetype.h:42,\n                 from ../../linbox/vector/vector-traits.h:35,\n                 from ../../linbox/blackbox/factory.h:17,\n                 from ../../linbox/matrix/sparse.h:54,\n                 from ../../linbox/blackbox/sparse.h:41,\n                 from linbox-sage.C:35:\n.../local/include/gmpxx.h:1566:3: error: \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(intmax_t)\u2019 cannot be overloaded\n.../local/include/gmpxx.h:1562:3: error: with \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(long int)\u2019\n.../local/include/gmpxx.h:1567:3: error: \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(uintmax_t)\u2019 cannot be overloaded\n.../local/include/gmpxx.h:1563:3: error: with \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(long unsigned int)\u2019\n.../local/include/gmpxx.h:1635:16: error: \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(intmax_t)\u2019 cannot be overloaded\n.../local/include/gmpxx.h:1629:16: error: with \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(long int)\u2019\n.../local/include/gmpxx.h:1636:16: error: \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(uintmax_t)\u2019 cannot be overloaded\n.../local/include/gmpxx.h:1631:16: error: with \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(long unsigned int)\u2019\n.../local/include/gmpxx.h: In constructor \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(intmax_t)\u2019:\n.../local/include/gmpxx.h:1566:49: error: \u2018mpz_init_set_sx\u2019 was not declared in this scope\n.../local/include/gmpxx.h: In constructor \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(uintmax_t)\u2019:\n.../local/include/gmpxx.h:1567:50: error: \u2018mpz_init_set_ux\u2019 was not declared in this scope\n.../local/include/gmpxx.h: In member function \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(intmax_t)\u2019:\n.../local/include/gmpxx.h:1635:56: error: \u2018mpz_set_sx\u2019 was not declared in this scope\n.../local/include/gmpxx.h: In member function \u2018__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(uintmax_t)\u2019:\n.../local/include/gmpxx.h:1636:57: error: \u2018mpz_set_ux\u2019 was not declared in this scope\n.../local/include/gmpxx.h: In member function \u2018intmax_t __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::get_sx() const\u2019:\n.../local/include/gmpxx.h:1677:49: error: \u2018mpz_get_sx\u2019 was not declared in this scope\n.../local/include/gmpxx.h: In member function \u2018uintmax_t __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::get_ux() const\u2019:\n.../local/include/gmpxx.h:1678:50: error: \u2018mpz_get_ux\u2019 was not declared in this scope\n```\n\n\nThere may be other issues, but I haven't encountered them yet.",
    "created_at": "2012-06-20T03:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156282",
    "user": "https://github.com/ohanar"
}
```

This causes the libm4rie test suite to fail, as well as breaks the building of linbox (both have the same errors):

```
In file included from .../local/include/gmp++/gmp++.h:20:0,
                 from ../../linbox/integer.h:22,
                 from ../../linbox/randiter/abstract.h:30,
                 from ../../linbox/field/abstract.h:32,
                 from ../../linbox/field/archetype.h:42,
                 from ../../linbox/vector/vector-traits.h:35,
                 from ../../linbox/blackbox/factory.h:17,
                 from ../../linbox/matrix/sparse.h:54,
                 from ../../linbox/blackbox/sparse.h:41,
                 from linbox-sage.C:35:
.../local/include/gmpxx.h:1566:3: error: ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(intmax_t)’ cannot be overloaded
.../local/include/gmpxx.h:1562:3: error: with ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(long int)’
.../local/include/gmpxx.h:1567:3: error: ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(uintmax_t)’ cannot be overloaded
.../local/include/gmpxx.h:1563:3: error: with ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(long unsigned int)’
.../local/include/gmpxx.h:1635:16: error: ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(intmax_t)’ cannot be overloaded
.../local/include/gmpxx.h:1629:16: error: with ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(long int)’
.../local/include/gmpxx.h:1636:16: error: ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(uintmax_t)’ cannot be overloaded
.../local/include/gmpxx.h:1631:16: error: with ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(long unsigned int)’
.../local/include/gmpxx.h: In constructor ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(intmax_t)’:
.../local/include/gmpxx.h:1566:49: error: ‘mpz_init_set_sx’ was not declared in this scope
.../local/include/gmpxx.h: In constructor ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>::__gmp_expr(uintmax_t)’:
.../local/include/gmpxx.h:1567:50: error: ‘mpz_init_set_ux’ was not declared in this scope
.../local/include/gmpxx.h: In member function ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(intmax_t)’:
.../local/include/gmpxx.h:1635:56: error: ‘mpz_set_sx’ was not declared in this scope
.../local/include/gmpxx.h: In member function ‘__gmp_expr<__mpz_struct [1], __mpz_struct [1]>& __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::operator=(uintmax_t)’:
.../local/include/gmpxx.h:1636:57: error: ‘mpz_set_ux’ was not declared in this scope
.../local/include/gmpxx.h: In member function ‘intmax_t __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::get_sx() const’:
.../local/include/gmpxx.h:1677:49: error: ‘mpz_get_sx’ was not declared in this scope
.../local/include/gmpxx.h: In member function ‘uintmax_t __gmp_expr<__mpz_struct [1], __mpz_struct [1]>::get_ux() const’:
.../local/include/gmpxx.h:1678:50: error: ‘mpz_get_ux’ was not declared in this scope
```


There may be other issues, but I haven't encountered them yet.



---

archive/issue_comments_156283.json:
```json
{
    "body": "There is an mpir-2.4.0.p6 at #12751, probably the new spkg should be based on that.\n\nAlso, I guess the patch `patches/yasm__tools__re2c__code.c.patch` can be removed completely (then also remove it from `SPKG.txt`)",
    "created_at": "2012-06-20T07:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156283",
    "user": "https://github.com/jdemeyer"
}
```

There is an mpir-2.4.0.p6 at #12751, probably the new spkg should be based on that.

Also, I guess the patch `patches/yasm__tools__re2c__code.c.patch` can be removed completely (then also remove it from `SPKG.txt`)



---

archive/issue_comments_156284.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-12T21:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156284",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156285.json:
```json
{
    "body": "See comment [comment:3]\n\n#12751 has been merged, so this spkg must certainly be rebased.",
    "created_at": "2012-08-12T21:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156285",
    "user": "https://github.com/jdemeyer"
}
```

See comment [comment:3]

#12751 has been merged, so this spkg must certainly be rebased.



---

archive/issue_comments_156286.json:
```json
{
    "body": "Attachment [trac_13137-mpir.patch](tarball://root/attachments/some-uuid/ticket13137/trac_13137-mpir.patch) by @jhpalmieri created at 2012-08-20 18:56:57\n\npatch for mpir spkg; for review only",
    "created_at": "2012-08-20T18:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156286",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13137-mpir.patch](tarball://root/attachments/some-uuid/ticket13137/trac_13137-mpir.patch) by @jhpalmieri created at 2012-08-20 18:56:57

patch for mpir spkg; for review only



---

archive/issue_comments_156287.json:
```json
{
    "body": "I've rebased the spkg. I haven't investigated the issues in [comment:2 the comment above]. I'll take a look, but I may not know enough to be able to fix them.",
    "created_at": "2012-08-20T18:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156287",
    "user": "https://github.com/jhpalmieri"
}
```

I've rebased the spkg. I haven't investigated the issues in [comment:2 the comment above]. I'll take a look, but I may not know enough to be able to fix them.



---

archive/issue_comments_156288.json:
```json
{
    "body": "On hawk (OpenSolaris): linbox fails to build, as mentioned above, and the new spkg from #12883 doesn't help. libm4rie passes its test suite, though.\n\nOn sage.math (linux, Sage's gcc): the ppl build fails to configure (\"checking which instantiations are enabled... configure: error: invalid instantiation Polyhedron Error configuring the Parma Polyhedra Library.\"). linbox fails to build, and libm4rie fails its test suite.\n\nOn taurus (linux, gcc 4.7.0): same as with sage.math, and also pari fails its test suite.\n\nI'm still building on OS X; I'll report the results when they're available.\n\nI don't know enough to troubleshoot these. If someone else wants to work on this, please go ahead.",
    "created_at": "2012-08-20T21:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156288",
    "user": "https://github.com/jhpalmieri"
}
```

On hawk (OpenSolaris): linbox fails to build, as mentioned above, and the new spkg from #12883 doesn't help. libm4rie passes its test suite, though.

On sage.math (linux, Sage's gcc): the ppl build fails to configure ("checking which instantiations are enabled... configure: error: invalid instantiation Polyhedron Error configuring the Parma Polyhedra Library."). linbox fails to build, and libm4rie fails its test suite.

On taurus (linux, gcc 4.7.0): same as with sage.math, and also pari fails its test suite.

I'm still building on OS X; I'll report the results when they're available.

I don't know enough to troubleshoot these. If someone else wants to work on this, please go ahead.



---

archive/issue_comments_156289.json:
```json
{
    "body": "OS X is similar to sage.math: linbox and ppl fail to build, libm4rie fails its test suite.",
    "created_at": "2012-08-21T00:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156289",
    "user": "https://github.com/jhpalmieri"
}
```

OS X is similar to sage.math: linbox and ppl fail to build, libm4rie fails its test suite.



---

archive/issue_comments_156290.json:
```json
{
    "body": "I created an spkg out of the just-released version 2.5.2. It was more or less straightforward, except that it refuses to build using clang on OS X, so spkg-install required a little modification.\n\nWith this spkg, givaro no longer builds on sage.math or OS X, and I am seeing the same problems with ppl. Since givaro won't build, I'm not even getting to libm4rie or linbox.",
    "created_at": "2012-10-03T21:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156290",
    "user": "https://github.com/jhpalmieri"
}
```

I created an spkg out of the just-released version 2.5.2. It was more or less straightforward, except that it refuses to build using clang on OS X, so spkg-install required a little modification.

With this spkg, givaro no longer builds on sage.math or OS X, and I am seeing the same problems with ppl. Since givaro won't build, I'm not even getting to libm4rie or linbox.



---

archive/issue_comments_156291.json:
```json
{
    "body": "Attachment [trac_13137-mpir-2.5.2.patch](tarball://root/attachments/some-uuid/ticket13137/trac_13137-mpir-2.5.2.patch) by @jhpalmieri created at 2012-10-03 21:52:48\n\npatch for mpir 2.5.2 spkg",
    "created_at": "2012-10-03T21:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156291",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_13137-mpir-2.5.2.patch](tarball://root/attachments/some-uuid/ticket13137/trac_13137-mpir-2.5.2.patch) by @jhpalmieri created at 2012-10-03 21:52:48

patch for mpir 2.5.2 spkg



---

archive/issue_comments_156292.json:
```json
{
    "body": "MPIR 2.6.0 is out and will be needed for FLINT 2.3.\nShould we cope with this upgrade here? Or in a subsequent ticket?\n\nBy the way, it would be nice to integrate the easy Cygwin fix of #12115 while upgrading MPIR.",
    "created_at": "2012-11-19T10:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156292",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

MPIR 2.6.0 is out and will be needed for FLINT 2.3.
Should we cope with this upgrade here? Or in a subsequent ticket?

By the way, it would be nice to integrate the easy Cygwin fix of #12115 while upgrading MPIR.



---

archive/issue_comments_156293.json:
```json
{
    "body": "I have no objections to trying to upgrade to 2.6.0 instead of 2.5.2. Maybe it will fix some of the issues mentioned on this ticket. If someone else wants to put together an spkg, please go ahead.",
    "created_at": "2012-11-20T20:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156293",
    "user": "https://github.com/jhpalmieri"
}
```

I have no objections to trying to upgrade to 2.6.0 instead of 2.5.2. Maybe it will fix some of the issues mentioned on this ticket. If someone else wants to put together an spkg, please go ahead.



---

archive/issue_comments_156294.json:
```json
{
    "body": "I gave MPIR 2.6.0 a shot, and the problem with linbox remains.\nThat's really strange, because somehow in gmpxx.h the member function get_sx is defined to invoke the C mpz_get_sx function, conditionally on the fact that stdint.h is included, and the mpz_get_sx is prototyped in mpir.h conditionally on the same fact.\nBut somehow, the mpz_get_sx is not found.\nI'm asking that on mpir-devel as well because I have no clue.\n\nAnyway, these functions are not necessary, so badly removing the definition of the member functions in gmpxx.h let you compile linbox and go on with other bits of Sage, as long as a proper solution is not found.",
    "created_at": "2012-11-25T00:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156294",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I gave MPIR 2.6.0 a shot, and the problem with linbox remains.
That's really strange, because somehow in gmpxx.h the member function get_sx is defined to invoke the C mpz_get_sx function, conditionally on the fact that stdint.h is included, and the mpz_get_sx is prototyped in mpir.h conditionally on the same fact.
But somehow, the mpz_get_sx is not found.
I'm asking that on mpir-devel as well because I have no clue.

Anyway, these functions are not necessary, so badly removing the definition of the member functions in gmpxx.h let you compile linbox and go on with other bits of Sage, as long as a proper solution is not found.



---

archive/issue_comments_156295.json:
```json
{
    "body": "Maybe the problem is that mpir.h gets first included withtout stdint.h inlcuded so that when gmpxx.h gets included mpir.h is not included again and the C functions get_sx and get_ux are not defined.",
    "created_at": "2012-11-25T14:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156295",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Maybe the problem is that mpir.h gets first included withtout stdint.h inlcuded so that when gmpxx.h gets included mpir.h is not included again and the C functions get_sx and get_ux are not defined.



---

archive/issue_comments_156296.json:
```json
{
    "body": "Ok that's it:\n\n```\nIn file included from linbox-sage.C:28:0:\n/home/jp/boulot/sage/sage-5.5.rc0/local/include/gmp.h:1228:17: note: #pragma message: gmp wo stdint\nIn file included from /home/jp/boulot/sage/sage-5.5.rc0/local/include/gmp++/gmp++.h:33:0,\n                 from ../../linbox/integer.h:57,\n                 from ../../linbox/randiter/abstract.h:31,\n                 from ../../linbox/field/abstract.h:33,\n                 from ../../linbox/field/archetype.h:49,\n                 from ../../linbox/vector/vector-traits.h:57,\n                 from ../../linbox/blackbox/factory.h:33,\n                 from ../../linbox/matrix/sparse.h:72,\n                 from ../../linbox/blackbox/sparse.h:57,\n                 from linbox-sage.C:38:\n/home/jp/boulot/sage/sage-5.5.rc0/local/include/gmpxx.h:1710:17: note: #pragma message: gmpxx w stdint\n```\n",
    "created_at": "2012-11-25T14:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156296",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok that's it:

```
In file included from linbox-sage.C:28:0:
/home/jp/boulot/sage/sage-5.5.rc0/local/include/gmp.h:1228:17: note: #pragma message: gmp wo stdint
In file included from /home/jp/boulot/sage/sage-5.5.rc0/local/include/gmp++/gmp++.h:33:0,
                 from ../../linbox/integer.h:57,
                 from ../../linbox/randiter/abstract.h:31,
                 from ../../linbox/field/abstract.h:33,
                 from ../../linbox/field/archetype.h:49,
                 from ../../linbox/vector/vector-traits.h:57,
                 from ../../linbox/blackbox/factory.h:33,
                 from ../../linbox/matrix/sparse.h:72,
                 from ../../linbox/blackbox/sparse.h:57,
                 from linbox-sage.C:38:
/home/jp/boulot/sage/sage-5.5.rc0/local/include/gmpxx.h:1710:17: note: #pragma message: gmpxx w stdint
```




---

archive/issue_comments_156297.json:
```json
{
    "body": "New spkg at http://boxen.math.washington.edu/home/jpflori/mpir-2.6.0.p0.spkg.\nIt also includes the changes from #12115.",
    "created_at": "2012-11-25T15:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156297",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

New spkg at http://boxen.math.washington.edu/home/jpflori/mpir-2.6.0.p0.spkg.
It also includes the changes from #12115.



---

archive/issue_comments_156298.json:
```json
{
    "body": "On my linux install (Debian/experimental/gcc 4.7.?) the new MPIR spkg builds and passes its testsuite.\nI've upped a fixed LinBox spkg at #13755 which should get merged with this one.\nI'll now have a look at libm4rie where the problem should be similar.\nI'll also try to build on sage.math.\nI don't have access to skynet, so won't try on more exotic archs.",
    "created_at": "2012-11-25T15:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156298",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

On my linux install (Debian/experimental/gcc 4.7.?) the new MPIR spkg builds and passes its testsuite.
I've upped a fixed LinBox spkg at #13755 which should get merged with this one.
I'll now have a look at libm4rie where the problem should be similar.
I'll also try to build on sage.math.
I don't have access to skynet, so won't try on more exotic archs.



---

archive/issue_comments_156299.json:
```json
{
    "body": "With this ticket and #13755 I have no problem with libm4rie test suite, nor with PPl or pari, on the same setup as before.\nI'm now launching a clean build on sage.math.\n\nAnd by the way, I've not put the clang changes in the spkg yet, as I cannot test if they are still needed.",
    "created_at": "2012-11-25T16:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156299",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

With this ticket and #13755 I have no problem with libm4rie test suite, nor with PPl or pari, on the same setup as before.
I'm now launching a clean build on sage.math.

And by the way, I've not put the clang changes in the spkg yet, as I cannot test if they are still needed.



---

archive/issue_comments_156300.json:
```json
{
    "body": "On sage.math I get\n\n```\n../../lib/libR.so: undefined reference to `rl_sort_completion_matches'\n```\n\nwhile building the R spkg.",
    "created_at": "2012-11-25T16:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156300",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

On sage.math I get

```
../../lib/libR.so: undefined reference to `rl_sort_completion_matches'
```

while building the R spkg.



---

archive/issue_comments_156301.json:
```json
{
    "body": "Apart from that the rest seems fine on sage.math (with Sage'gcc spkg).\nMPIR passes its test suite as PARI and libm4rie.",
    "created_at": "2012-11-25T17:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156301",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Apart from that the rest seems fine on sage.math (with Sage'gcc spkg).
MPIR passes its test suite as PARI and libm4rie.



---

archive/issue_comments_156302.json:
```json
{
    "body": "No problem with PPl and its testsuite as well (by the way the spkg-check from ppl lacks a nice \"eerything got well, bye\" message).\n\nI'm still confused by the R issue.\nThe problematic symbol is from readline, not sure how MPIR has influence on it.",
    "created_at": "2012-11-25T17:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156302",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

No problem with PPl and its testsuite as well (by the way the spkg-check from ppl lacks a nice "eerything got well, bye" message).

I'm still confused by the R issue.
The problematic symbol is from readline, not sure how MPIR has influence on it.



---

archive/issue_comments_156303.json:
```json
{
    "body": "In fact I get the same R error with a stock sage 5.5.rc0 so this is unrelated as expected.",
    "created_at": "2012-11-25T22:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156303",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

In fact I get the same R error with a stock sage 5.5.rc0 so this is unrelated as expected.



---

archive/issue_comments_156304.json:
```json
{
    "body": "The discussion about headers inclusion at mpir-devel can be read at:\nhttps://groups.google.com/d/topic/mpir-devel/m__z0PR_wBw/discussion\n\nAnyway, even if MPIR puts in a solution at some point, I think LinBox must be fixed anyway.\nSo #13755 makes sense and I'll put it as a dependency here.\n\nThe discussion about sage.math.washington.edu failure (which is highly likely to be unrelated):\nhttps://groups.google.com/d/topic/sage-devel/Tmg6nA1eWGk/discussion\n\nI guess what must be done now is to retry some builds on different archs/compilers combinations (to check the clang thing for example) because this spkg is highly sensitive to that, and then we could launch the patchbots (or launch them directly but I don't know how to do that, nor how to get their results), so I put this as need_info now.\n\nWe should also decide what to do with the \"history\" of the spkg.\nFor now, I've based the spkg on the one from #12115, mentionned in SPKG.txt with an hg commit plus an hg tag done by myself (if #12115 gets merged before that one, I guess we'll do a \"proper\" rebasing), then added mentionned of 2.5.2.p0 by John in SPKG.txt but without hg commit or hg tag, and finally mention of 2.6.0.p0 in SPKG.txt with an hg commit but no hg tag, assuming it will be automagically by Jeroen scripts.",
    "created_at": "2012-11-26T12:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156304",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The discussion about headers inclusion at mpir-devel can be read at:
https://groups.google.com/d/topic/mpir-devel/m__z0PR_wBw/discussion

Anyway, even if MPIR puts in a solution at some point, I think LinBox must be fixed anyway.
So #13755 makes sense and I'll put it as a dependency here.

The discussion about sage.math.washington.edu failure (which is highly likely to be unrelated):
https://groups.google.com/d/topic/sage-devel/Tmg6nA1eWGk/discussion

I guess what must be done now is to retry some builds on different archs/compilers combinations (to check the clang thing for example) because this spkg is highly sensitive to that, and then we could launch the patchbots (or launch them directly but I don't know how to do that, nor how to get their results), so I put this as need_info now.

We should also decide what to do with the "history" of the spkg.
For now, I've based the spkg on the one from #12115, mentionned in SPKG.txt with an hg commit plus an hg tag done by myself (if #12115 gets merged before that one, I guess we'll do a "proper" rebasing), then added mentionned of 2.5.2.p0 by John in SPKG.txt but without hg commit or hg tag, and finally mention of 2.6.0.p0 in SPKG.txt with an hg commit but no hg tag, assuming it will be automagically by Jeroen scripts.



---

archive/issue_comments_156305.json:
```json
{
    "body": "Changing keywords from \"mpir\" to \"mpir spkg\".",
    "created_at": "2012-11-26T12:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156305",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing keywords from "mpir" to "mpir spkg".



---

archive/issue_comments_156306.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2012-11-26T12:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156306",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_156307.json:
```json
{
    "body": "On my OS X 10.8 box, I have the same problems with clang. Trying again with the clang changes from my earlier spkg applied to jpflori's spkg: it builds and passes self-tests. Now I'm proceeding with the rest of the Sage build. I'm also trying it on the skynet machine taurus (linux, GCC 4.7.0, referred to [comment:7 above]). I'll post results when I know more.",
    "created_at": "2012-11-28T23:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156307",
    "user": "https://github.com/jhpalmieri"
}
```

On my OS X 10.8 box, I have the same problems with clang. Trying again with the clang changes from my earlier spkg applied to jpflori's spkg: it builds and passes self-tests. Now I'm proceeding with the rest of the Sage build. I'm also trying it on the skynet machine taurus (linux, GCC 4.7.0, referred to [comment:7 above]). I'll post results when I know more.



---

archive/issue_comments_156308.json:
```json
{
    "body": "Thanks for the report, I'll put the clang patch back in and report upstream.",
    "created_at": "2012-11-28T23:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156308",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Thanks for the report, I'll put the clang patch back in and report upstream.



---

archive/issue_comments_156309.json:
```json
{
    "body": "No problems on either OS X (with modifications for clang) or taurus: with `SAGE_CHECK=yes`, all packages built and passed their tests. I ran `make ptestlong` and all tests passed on both platforms.\n\nI think that this is probably ready to go, once the clang changes are reinstated. I also think what you've done with the history is fine.",
    "created_at": "2012-11-29T06:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156309",
    "user": "https://github.com/jhpalmieri"
}
```

No problems on either OS X (with modifications for clang) or taurus: with `SAGE_CHECK=yes`, all packages built and passed their tests. I ran `make ptestlong` and all tests passed on both platforms.

I think that this is probably ready to go, once the clang changes are reinstated. I also think what you've done with the history is fine.



---

archive/issue_comments_156310.json:
```json
{
    "body": "Ok, I'm putting back the clang stuff.\n\nAbout the ,asm files, I think it's just a typo introduced here:\nhttps://github.com/wbhart/mpir/commit/295967cd2b11f7b964283c1e1bf8dd154e388af4\nWaiting for confirmation here:\nhttps://groups.google.com/d/topic/mpir-devel/0uhskYIbRII/discussion\nAs I have little doubt about this I'll add a patch to move the files and update the quote_patch patch.\n\n(I cannot put the ticket directly as needs_work, so I'm leaving it in its current state and will put it as needs_review when the new spkg is posted.)",
    "created_at": "2012-11-29T10:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156310",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok, I'm putting back the clang stuff.

About the ,asm files, I think it's just a typo introduced here:
https://github.com/wbhart/mpir/commit/295967cd2b11f7b964283c1e1bf8dd154e388af4
Waiting for confirmation here:
https://groups.google.com/d/topic/mpir-devel/0uhskYIbRII/discussion
As I have little doubt about this I'll add a patch to move the files and update the quote_patch patch.

(I cannot put the ticket directly as needs_work, so I'm leaving it in its current state and will put it as needs_review when the new spkg is posted.)



---

archive/issue_comments_156311.json:
```json
{
    "body": "As it seems diff/patch lack the ability of properly detecting filename changes, I propose to manually move the ,asm files to .asm files before patching.\nThis takes something like ten lines rather than more 1264 with a patch file which just - the *,asm and + the *.asm ones.\n\nWith the mv solution, I intend to hardcode the filenames in spkg-install, anyway this should get upstream and this part can (and will have to) then be removed.\nI'll report the quoting part as well while I'm at it.\n\nDoes this seem ok to everyone?",
    "created_at": "2012-11-29T11:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156311",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

As it seems diff/patch lack the ability of properly detecting filename changes, I propose to manually move the ,asm files to .asm files before patching.
This takes something like ten lines rather than more 1264 with a patch file which just - the *,asm and + the *.asm ones.

With the mv solution, I intend to hardcode the filenames in spkg-install, anyway this should get upstream and this part can (and will have to) then be removed.
I'll report the quoting part as well while I'm at it.

Does this seem ok to everyone?



---

archive/issue_comments_156312.json:
```json
{
    "body": "I've upped a new spkg.\nIt includes the fix mentioned above and I updated the patches in a minimal way in order to minimize mercurial history.\nI've also added a commit and a tag for 2.5.2.p0 spkg.\n\nI've asked about the quoting stuff on mpir-devel and it should get integrated upstream at some point.",
    "created_at": "2012-11-29T13:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156312",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I've upped a new spkg.
It includes the fix mentioned above and I updated the patches in a minimal way in order to minimize mercurial history.
I've also added a commit and a tag for 2.5.2.p0 spkg.

I've asked about the quoting stuff on mpir-devel and it should get integrated upstream at some point.



---

archive/issue_comments_156313.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-11-29T13:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156313",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_156314.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-29T13:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156314",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_156315.json:
```json
{
    "body": "Oops, it seems we should update the remove_32_bit_assembly_code function in spkg-install because the asm files names changed.\nMaybe there are new files as well which need removing, not sure about that.",
    "created_at": "2012-11-29T13:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156315",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Oops, it seems we should update the remove_32_bit_assembly_code function in spkg-install because the asm files names changed.
Maybe there are new files as well which need removing, not sure about that.



---

archive/issue_comments_156316.json:
```json
{
    "body": "The files themselves does not seem to have been modified so the problem must still exist.\nI was not able to find relevant information on what kind of instructions cause this problem at #5315, so if this needs to be extended to new files (in addition to the renamed files).\n\n\nBut who still uses such old computers...",
    "created_at": "2012-11-29T17:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156316",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The files themselves does not seem to have been modified so the problem must still exist.
I was not able to find relevant information on what kind of instructions cause this problem at #5315, so if this needs to be extended to new files (in addition to the renamed files).


But who still uses such old computers...



---

archive/issue_comments_156317.json:
```json
{
    "body": "Ok it seems this is because of `@`GOT.\nSee http://lists.apple.com/archives/scitech/2006/Dec/msg00004.html which is more informative.\n\nBut now MPIR ships with YASM so I guess all of this is not needed anymore?\nCould someone who has access to a OS X 10.4 running on 64 bits intel processor test the spkg without the call to remove_32... function?",
    "created_at": "2012-11-29T17:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156317",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok it seems this is because of `@`GOT.
See http://lists.apple.com/archives/scitech/2006/Dec/msg00004.html which is more informative.

But now MPIR ships with YASM so I guess all of this is not needed anymore?
Could someone who has access to a OS X 10.4 running on 64 bits intel processor test the spkg without the call to remove_32... function?



---

archive/issue_comments_156318.json:
```json
{
    "body": "Thinking about it, I definitely think the fix is not needed anymore, or at least nobody encountered it for a couple of years because we don't delete the renamed problematic files since a couple of years.\n(the rename commit is here:\nhttps://github.com/wbhart/mpir/commit/5dad96491ba4d63613539a3124a7b63721bf4892\n)",
    "created_at": "2012-11-29T17:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156318",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Thinking about it, I definitely think the fix is not needed anymore, or at least nobody encountered it for a couple of years because we don't delete the renamed problematic files since a couple of years.
(the rename commit is here:
https://github.com/wbhart/mpir/commit/5dad96491ba4d63613539a3124a7b63721bf4892
)



---

archive/issue_comments_156319.json:
```json
{
    "body": "Ok and according to http://trac.sagemath.org/sage_trac/ticket/10188#comment:19\nthe noexecstack thing is upstream now.",
    "created_at": "2012-11-29T17:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156319",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok and according to http://trac.sagemath.org/sage_trac/ticket/10188#comment:19
the noexecstack thing is upstream now.



---

archive/issue_comments_156320.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-29T18:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156320",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_156321.json:
```json
{
    "body": "So goes an updated spkg removing all the (hopefully) obsolete fixes.\n\nTo get the old one replace spkg by bak at the end of the file url.",
    "created_at": "2012-11-29T18:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156321",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

So goes an updated spkg removing all the (hopefully) obsolete fixes.

To get the old one replace spkg by bak at the end of the file url.



---

archive/issue_comments_156322.json:
```json
{
    "body": "A minor comment: in spkg-install, perhaps the following change would be a good idea:\n\n```diff\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -19,8 +19,7 @@ cd src/\n # detecting filename changes. See Trac #13137.\n # This fix can (and will have to) be removed once integrated upstream.\n echo \"Renaming *,asm files to *.asm...\"\n-mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm\n-mv mpn/x86/p6/submul_1,asm mpn/x86/p6/submul_1.asm\n+mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm && mv mpn/x86/p6/submul_1,asm mpn/x86/p6/submul_1.asm\n if [ $? -ne 0 ]; then\n     echo >&2 \"Error: moving *,asm files failed.\"\n     exit 1\n```\n",
    "created_at": "2012-11-29T19:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156322",
    "user": "https://github.com/jhpalmieri"
}
```

A minor comment: in spkg-install, perhaps the following change would be a good idea:

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -19,8 +19,7 @@ cd src/
 # detecting filename changes. See Trac #13137.
 # This fix can (and will have to) be removed once integrated upstream.
 echo "Renaming *,asm files to *.asm..."
-mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm
-mv mpn/x86/p6/submul_1,asm mpn/x86/p6/submul_1.asm
+mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm && mv mpn/x86/p6/submul_1,asm mpn/x86/p6/submul_1.asm
 if [ $? -ne 0 ]; then
     echo >&2 "Error: moving *,asm files failed."
     exit 1
```




---

archive/issue_comments_156323.json:
```json
{
    "body": "Updated spkg at same address.",
    "created_at": "2012-11-29T19:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156323",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Updated spkg at same address.



---

archive/issue_comments_156324.json:
```json
{
    "body": "This also builds and passes tests on skynet machine iras, which often has problems not found on other platforms. (Actually, gsl fails its self-tests, but it does that with the old mpir and linbox spkgs, so no regression there. I couldn't find a ticket for this, though...)\n\nSo I think this is pretty close. What else should be checked?",
    "created_at": "2012-11-30T17:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156324",
    "user": "https://github.com/jhpalmieri"
}
```

This also builds and passes tests on skynet machine iras, which often has problems not found on other platforms. (Actually, gsl fails its self-tests, but it does that with the old mpir and linbox spkgs, so no regression there. I couldn't find a ticket for this, though...)

So I think this is pretty close. What else should be checked?



---

archive/issue_comments_156325.json:
```json
{
    "body": "Maybe explicitely run tests on Fedora where the fix I removed is supposed to not be needed anymore.\nApart from that and the OSX 10.4 (and or 10.5) on 64 intel processors (not sure it will actually be tested by anyone so let's forget OS 10.4 unless someone raises its hand), I guess this is it if you agree with all the changes made to the spkg (I do agree with the one you did before).",
    "created_at": "2012-11-30T17:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156325",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Maybe explicitely run tests on Fedora where the fix I removed is supposed to not be needed anymore.
Apart from that and the OSX 10.4 (and or 10.5) on 64 intel processors (not sure it will actually be tested by anyone so let's forget OS 10.4 unless someone raises its hand), I guess this is it if you agree with all the changes made to the spkg (I do agree with the one you did before).



---

archive/issue_comments_156326.json:
```json
{
    "body": "By the way, I (potentially again) reported all the patches we still ship upstream and they should get integrated at some point.",
    "created_at": "2012-11-30T17:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156326",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

By the way, I (potentially again) reported all the patches we still ship upstream and they should get integrated at some point.



---

archive/issue_comments_156327.json:
```json
{
    "body": "Reintroduced fix for Mac OS 10.4 on intel hardware as it's still needed.\nSame address as before.",
    "created_at": "2012-12-03T10:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156327",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Reintroduced fix for Mac OS 10.4 on intel hardware as it's still needed.
Same address as before.



---

archive/issue_comments_156328.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-12-03T10:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156328",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_156329.json:
```json
{
    "body": "Waiting for feedback from Mac Os X user on sage-devel:\nhttps://groups.google.com/d/topic/sage-devel/R43tQAKI8gA/discussion",
    "created_at": "2012-12-03T10:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156329",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Waiting for feedback from Mac Os X user on sage-devel:
https://groups.google.com/d/topic/sage-devel/R43tQAKI8gA/discussion



---

archive/issue_comments_156330.json:
```json
{
    "body": "Replying to [comment:41 jpflori]:\n> Waiting for feedback from Mac Os X user on sage-devel:\n> https://groups.google.com/d/topic/sage-devel/R43tQAKI8gA/discussion\n\nI'd suggest changing the relevant lines in `configure[.in]` to\n\n\n```sh\n\n    # 32bit apple darwin doesn't like our PIC format asm code\n    case $host in\n        i[34567]86-apple-darwin*|\n        pentium*-apple-darwin*|\n        prescott-apple-darwin*|\n        core-apple-darwin*)\n            path=\"x86/applenopic\" ;;\n        *-apple-darwin*) # assume Core2 or later\n            path=\"x86/applenopic/core2 x86/applenopic\" ;;\n        *)                                                      ;;\n    esac\n```\n\n\n(Cf. mpir-devel)",
    "created_at": "2012-12-03T19:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156330",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:41 jpflori]:
> Waiting for feedback from Mac Os X user on sage-devel:
> https://groups.google.com/d/topic/sage-devel/R43tQAKI8gA/discussion

I'd suggest changing the relevant lines in `configure[.in]` to


```sh

    # 32bit apple darwin doesn't like our PIC format asm code
    case $host in
        i[34567]86-apple-darwin*|
        pentium*-apple-darwin*|
        prescott-apple-darwin*|
        core-apple-darwin*)
            path="x86/applenopic" ;;
        *-apple-darwin*) # assume Core2 or later
            path="x86/applenopic/core2 x86/applenopic" ;;
        *)                                                      ;;
    esac
```


(Cf. mpir-devel)



---

archive/issue_comments_156331.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-12-04T10:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156331",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_156332.json:
```json
{
    "body": "New spkg with the solution from mpir-devel.\n(The discussion is at\nhttps://groups.google.com/d/topic/mpir-devel/hsxEc_69lBo/discussion\n)\n\nBack to needs_review, I think everything is sorted out now.",
    "created_at": "2012-12-04T10:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156332",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

New spkg with the solution from mpir-devel.
(The discussion is at
https://groups.google.com/d/topic/mpir-devel/hsxEc_69lBo/discussion
)

Back to needs_review, I think everything is sorted out now.



---

archive/issue_comments_156333.json:
```json
{
    "body": "Still a bit weird he now gets `-march=nocona -mtune=nocona` (instead of `-march=nehalem ...` as previously, with `-m32` of course); haven't looked at his full logs yet...\n\n[Perhaps this was just with Apple's GCC 4.**0.1**, which presumably doesn't know Core i7.]",
    "created_at": "2012-12-04T11:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156333",
    "user": "https://github.com/nexttime"
}
```

Still a bit weird he now gets `-march=nocona -mtune=nocona` (instead of `-march=nehalem ...` as previously, with `-m32` of course); haven't looked at his full logs yet...

[Perhaps this was just with Apple's GCC 4.**0.1**, which presumably doesn't know Core i7.]



---

archive/issue_comments_156334.json:
```json
{
    "body": "A priori, I did not modify the configure file except for the few lines involved by the fix, so this is strange.",
    "created_at": "2012-12-04T11:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156334",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

A priori, I did not modify the configure file except for the few lines involved by the fix, so this is strange.



---

archive/issue_comments_156335.json:
```json
{
    "body": "Replying to [comment:45 jpflori]:\n> A priori, I did not modify the configure file except for the few lines involved by the fix, so this is strange.\n\nAll files in the p2 except `configure` are vanilla 2.6.0 again (especially `config.guess`)?\n\nAnother reason for the difference *might* be him setting `ABI=32` manually inbetween (which should matter only in the plain MPIR builds, as `spkg-install` does this as well, always on MacOS < 10.6 I think).",
    "created_at": "2012-12-04T11:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156335",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:45 jpflori]:
> A priori, I did not modify the configure file except for the few lines involved by the fix, so this is strange.

All files in the p2 except `configure` are vanilla 2.6.0 again (especially `config.guess`)?

Another reason for the difference *might* be him setting `ABI=32` manually inbetween (which should matter only in the plain MPIR builds, as `spkg-install` does this as well, always on MacOS < 10.6 I think).



---

archive/issue_comments_156336.json:
```json
{
    "body": "Replying to [comment:46 leif]:\n> Replying to [comment:45 jpflori]:\n> > A priori, I did not modify the configure file except for the few lines involved by the fix, so this is strange.\n> \n> All files in the p2 except `configure` are vanilla 2.6.0 again (especially `config.guess`)?\n> \n> Another reason for the difference *might* be him setting `ABI=32` manually inbetween (which should matter only in the plain MPIR builds, as `spkg-install` does this as well, always on MacOS < 10.6 I think).\n\nI probably just confused the output of `config.guess` and `-march=...`; in his recent logs we have:\n\n`configure` run \"manually\", Apple GCC 4.0.1:\n\n```\nchecking build system type... nehalem-apple-darwin9.8.0\n...\nchecking ABI=32\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer ... yes\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer has sizeof(long)==4... yes\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=corei7... no\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=core2... no\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=nocona... yes\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=nocona  -march=corei7... no\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=nocona  -march=core2... no\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=nocona  -march=nocona... yes\n...\nusing ABI=\"32\"\n      CC=\"gcc -std=gnu99\"\n      CFLAGS=\"-m32 -O2 -fomit-frame-pointer -mtune=nocona -march=nocona\"\n      CPPFLAGS=\"\"\n      MPN_PATH=\" x86/applenopic generic\"\n...\n```\n\n\n`configure` run \"manually\", Apple GCC 4.2.1:\n\n```\nchecking build system type... nehalem-apple-darwin9.8.0\n...\nchecking ABI=32\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer ... yes\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer has sizeof(long)==4... yes\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=corei7... no\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=core2... yes\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=core2  -march=corei7... no\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=core2  -march=core2... yes\n...\nusing ABI=\"32\"\n      CC=\"gcc -std=gnu99\"\n      CFLAGS=\"-m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2\"\n      CPPFLAGS=\"\"\n      MPN_PATH=\" x86/applenopic generic\"\n...\n```\n\n\nMPIR 2.6.0.p2 (with `sage -i ...`, Apple GCC 4.2.1, build 5577):\n\n```\n...\nSettings chosen by MPIR when configuring with CFLAGS unset:\n  CC:      gcc -std=gnu99\n  CFLAGS:  -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2\n...\nFinally using the following settings:\n  CC=gcc\n  CFLAGS=-m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -g \n...\nchecking build system type... nehalem-apple-darwin9.8.0\n...\nchecking ABI=32\nchecking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -g  ... yes\n...\nusing ABI=\"32\"\n      CC=\"gcc -std=gnu99\"\n      CFLAGS=\"-m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -g \"\n      CPPFLAGS=\"\"\n      CXX=\"g++\"\n      CXXFLAGS=\"\"\n      MPN_PATH=\" x86/applenopic generic\"\n...\n```\n\n\n(Looks like our first \"dry\" `configure` run influences the second; we should probably delete some more cache files...)\n\nAnd FWIW, the `-std=gnu99` still(?) gets dropped in the first place at least, for whatever reason.  (It was a long-lasting MPIR bug that `gmp.h` -- in contrast to `mpir.h` -- was lacking this in the definition of `__GMP_CC`.)\n\nAlso, IMHO `CXXFLAGS` shouldn't be empty.  And it doesn't look like yasm's `configure` would pick up the settings from MPIR's...",
    "created_at": "2012-12-04T12:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156336",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:46 leif]:
> Replying to [comment:45 jpflori]:
> > A priori, I did not modify the configure file except for the few lines involved by the fix, so this is strange.
> 
> All files in the p2 except `configure` are vanilla 2.6.0 again (especially `config.guess`)?
> 
> Another reason for the difference *might* be him setting `ABI=32` manually inbetween (which should matter only in the plain MPIR builds, as `spkg-install` does this as well, always on MacOS < 10.6 I think).

I probably just confused the output of `config.guess` and `-march=...`; in his recent logs we have:

`configure` run "manually", Apple GCC 4.0.1:

```
checking build system type... nehalem-apple-darwin9.8.0
...
checking ABI=32
checking compiler gcc -m32 -O2 -fomit-frame-pointer ... yes
checking compiler gcc -m32 -O2 -fomit-frame-pointer has sizeof(long)==4... yes
checking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=corei7... no
checking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=core2... no
checking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=nocona... yes
checking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=nocona  -march=corei7... no
checking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=nocona  -march=core2... no
checking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=nocona  -march=nocona... yes
...
using ABI="32"
      CC="gcc -std=gnu99"
      CFLAGS="-m32 -O2 -fomit-frame-pointer -mtune=nocona -march=nocona"
      CPPFLAGS=""
      MPN_PATH=" x86/applenopic generic"
...
```


`configure` run "manually", Apple GCC 4.2.1:

```
checking build system type... nehalem-apple-darwin9.8.0
...
checking ABI=32
checking compiler gcc -m32 -O2 -fomit-frame-pointer ... yes
checking compiler gcc -m32 -O2 -fomit-frame-pointer has sizeof(long)==4... yes
checking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=corei7... no
checking compiler gcc -m32 -O2 -fomit-frame-pointer  -mtune=core2... yes
checking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=core2  -march=corei7... no
checking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=core2  -march=core2... yes
...
using ABI="32"
      CC="gcc -std=gnu99"
      CFLAGS="-m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2"
      CPPFLAGS=""
      MPN_PATH=" x86/applenopic generic"
...
```


MPIR 2.6.0.p2 (with `sage -i ...`, Apple GCC 4.2.1, build 5577):

```
...
Settings chosen by MPIR when configuring with CFLAGS unset:
  CC:      gcc -std=gnu99
  CFLAGS:  -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2
...
Finally using the following settings:
  CC=gcc
  CFLAGS=-m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -g 
...
checking build system type... nehalem-apple-darwin9.8.0
...
checking ABI=32
checking compiler gcc -m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -g  ... yes
...
using ABI="32"
      CC="gcc -std=gnu99"
      CFLAGS="-m32 -O2 -fomit-frame-pointer -mtune=core2 -march=core2  -g "
      CPPFLAGS=""
      CXX="g++"
      CXXFLAGS=""
      MPN_PATH=" x86/applenopic generic"
...
```


(Looks like our first "dry" `configure` run influences the second; we should probably delete some more cache files...)

And FWIW, the `-std=gnu99` still(?) gets dropped in the first place at least, for whatever reason.  (It was a long-lasting MPIR bug that `gmp.h` -- in contrast to `mpir.h` -- was lacking this in the definition of `__GMP_CC`.)

Also, IMHO `CXXFLAGS` shouldn't be empty.  And it doesn't look like yasm's `configure` would pick up the settings from MPIR's...



---

archive/issue_comments_156337.json:
```json
{
    "body": "Maybe we can do this in a follow up ticket \"Fix spkg-install of mpir spkg\"?\nAnd merge this asap, as it looks functional everywhere (I know there is some fuzz for one patch as well because of the last fix included, but I got no time to fix it once again).",
    "created_at": "2012-12-04T13:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156337",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Maybe we can do this in a follow up ticket "Fix spkg-install of mpir spkg"?
And merge this asap, as it looks functional everywhere (I know there is some fuzz for one patch as well because of the last fix included, but I got no time to fix it once again).



---

archive/issue_comments_156338.json:
```json
{
    "body": "I reread your message above.\n\nThe p0 is the one targeted for inclusion. It should have pristine src directory, except some useless dir for us are deleted.\nThe patches modify configure for this apple problem, and for some fortran things which were here before.\nI also move \"by hand\" the wrongly name *,asm files.\n\nA priori, the p2 was based on p0, with editing in a sligthly more dirty way configure (i.e. I put somethign at the end of the swith case, that's the only difference as far as configure is concerned) and adding some asm files to the applenopic.\nNonetheless I don't expect that to have any influence on config.guess.",
    "created_at": "2012-12-04T16:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156338",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I reread your message above.

The p0 is the one targeted for inclusion. It should have pristine src directory, except some useless dir for us are deleted.
The patches modify configure for this apple problem, and for some fortran things which were here before.
I also move "by hand" the wrongly name *,asm files.

A priori, the p2 was based on p0, with editing in a sligthly more dirty way configure (i.e. I put somethign at the end of the swith case, that's the only difference as far as configure is concerned) and adding some asm files to the applenopic.
Nonetheless I don't expect that to have any influence on config.guess.



---

archive/issue_comments_156339.json:
```json
{
    "body": "Replying to [comment:48 jpflori]:\n> Maybe we can do this in a follow up ticket \"Fix spkg-install of mpir spkg\"?\n\nSure, but then we should probably add some comments to `SPKG.txt`.  (I haven't yet looked at the new spkg itself at all, just read Greg's logs and comments and upstream source.)\n\n> And merge this asap, as it looks functional everywhere (I know there is some fuzz for one patch as well because of the last fix included, but I got no time to fix it once again).\n\n:-) Unfortunately we first need new FLINT and GMP-ECM spkgs as well, AFAIK; not sure what else...\n\n(Or does just the *new* FLINT spkg require MPIR 2.6, but not vice versa?  I only know at least GMP-ECM currently won't build with MPIR 2.6.)",
    "created_at": "2012-12-05T01:47:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156339",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:48 jpflori]:
> Maybe we can do this in a follow up ticket "Fix spkg-install of mpir spkg"?

Sure, but then we should probably add some comments to `SPKG.txt`.  (I haven't yet looked at the new spkg itself at all, just read Greg's logs and comments and upstream source.)

> And merge this asap, as it looks functional everywhere (I know there is some fuzz for one patch as well because of the last fix included, but I got no time to fix it once again).

:-) Unfortunately we first need new FLINT and GMP-ECM spkgs as well, AFAIK; not sure what else...

(Or does just the *new* FLINT spkg require MPIR 2.6, but not vice versa?  I only know at least GMP-ECM currently won't build with MPIR 2.6.)



---

archive/issue_comments_156340.json:
```json
{
    "body": "Replying to [comment:50 leif]:\n> Replying to [comment:48 jpflori]:\n> > Maybe we can do this in a follow up ticket \"Fix spkg-install of mpir spkg\"?\n> \n> Sure, but then we should probably add some comments to `SPKG.txt`.  (I haven't yet looked at the new spkg itself at all, just read Greg's logs and comments and upstream source.)\nI think there are already some mentions of CC and CXXFLAGS in SPKG.txt, so this does not seem new.\n> \n> > And merge this asap, as it looks functional everywhere (I know there is some fuzz for one patch as well because of the last fix included, but I got no time to fix it once again).\n> \n> :-) Unfortunately we first need new FLINT and GMP-ECM spkgs as well, AFAIK; not sure what else...\n> \n> (Or does just the *new* FLINT spkg require MPIR 2.6, but not vice versa?  I only know at least GMP-ECM currently won't build with MPIR 2.6.)\nIts the new FLINT which depends on the new MPIR.\nThe old one should build which whatever version.\nIn fact the new FLINT release \"officially\" depends on MPIR 2.6.0.\nThe real deal is that there are symbols conflicts with MPIR 2.5.x, but as Sage still ships MPIR 2.4.x, there is no problem.\n\nI'll have a look at the GMP-ECM problems, but it indeed reminds me of something, thanks for the hint.",
    "created_at": "2012-12-05T08:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156340",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:50 leif]:
> Replying to [comment:48 jpflori]:
> > Maybe we can do this in a follow up ticket "Fix spkg-install of mpir spkg"?
> 
> Sure, but then we should probably add some comments to `SPKG.txt`.  (I haven't yet looked at the new spkg itself at all, just read Greg's logs and comments and upstream source.)
I think there are already some mentions of CC and CXXFLAGS in SPKG.txt, so this does not seem new.
> 
> > And merge this asap, as it looks functional everywhere (I know there is some fuzz for one patch as well because of the last fix included, but I got no time to fix it once again).
> 
> :-) Unfortunately we first need new FLINT and GMP-ECM spkgs as well, AFAIK; not sure what else...
> 
> (Or does just the *new* FLINT spkg require MPIR 2.6, but not vice versa?  I only know at least GMP-ECM currently won't build with MPIR 2.6.)
Its the new FLINT which depends on the new MPIR.
The old one should build which whatever version.
In fact the new FLINT release "officially" depends on MPIR 2.6.0.
The real deal is that there are symbols conflicts with MPIR 2.5.x, but as Sage still ships MPIR 2.4.x, there is no problem.

I'll have a look at the GMP-ECM problems, but it indeed reminds me of something, thanks for the hint.



---

archive/issue_comments_156341.json:
```json
{
    "body": "This builds on Cygwin on XP.",
    "created_at": "2012-12-05T13:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156341",
    "user": "https://github.com/kcrisman"
}
```

This builds on Cygwin on XP.



---

archive/issue_comments_156342.json:
```json
{
    "body": "No problem on 64 bits Windows 7 as well.\n\nIs there really a problem with gmp-ecm-6.4? it seems to build perfectly with MPIR 2.6.0.\n\nI'm aware of\nhttps://groups.google.com/forum/?fromgroups=#!searchin/mpir-devel/ecm/mpir-devel/Ba5Jl_XOSHM/pciuA7eN7dQJ\nbut doesn't it concern later svn version?\nThe latest svn version is still broken, a fix was commited but seems only partial.",
    "created_at": "2012-12-05T13:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156342",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

No problem on 64 bits Windows 7 as well.

Is there really a problem with gmp-ecm-6.4? it seems to build perfectly with MPIR 2.6.0.

I'm aware of
https://groups.google.com/forum/?fromgroups=#!searchin/mpir-devel/ecm/mpir-devel/Ba5Jl_XOSHM/pciuA7eN7dQJ
but doesn't it concern later svn version?
The latest svn version is still broken, a fix was commited but seems only partial.



---

archive/issue_comments_156343.json:
```json
{
    "body": "> No problem on 64 bits Windows 7 as well.\n> \n> Is there really a problem with gmp-ecm-6.4? it seems to build perfectly with MPIR 2.6.0.\n\nOn Cygwin on XP ecm-6.3.p8 (the current one) builds fine with this mpir spkg.",
    "created_at": "2012-12-12T16:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156343",
    "user": "https://github.com/kcrisman"
}
```

> No problem on 64 bits Windows 7 as well.
> 
> Is there really a problem with gmp-ecm-6.4? it seems to build perfectly with MPIR 2.6.0.

On Cygwin on XP ecm-6.3.p8 (the current one) builds fine with this mpir spkg.



---

archive/issue_comments_156344.json:
```json
{
    "body": "For me everything looks fine here, any other concern from anybody?",
    "created_at": "2012-12-17T10:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156344",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

For me everything looks fine here, any other concern from anybody?



---

archive/issue_comments_156345.json:
```json
{
    "body": "I'm not having any problems with `SAGE_CHECK=yes` on sage.math or OS X 10.7.  On Mac,\n\n```\nGMP-ECM's test suite passed.\n```\n\nand so unless I encounter problems on either of those machines (which I'd report), let's get this in.  I *will* point out that\n\n```\npatching file configure.in\nHunk #1 succeeded at 1918 (offset -2 lines).\npatching file yasm/Makefile.in\npatching file configure\nHunk #2 succeeded at 5265 (offset -2 lines).\nHunk #3 succeeded at 5315 (offset -2 lines).\nHunk #4 succeeded at 5322 (offset -2 lines).\nHunk #5 succeeded at 5369 (offset -2 lines).\nHunk #6 succeeded at 5377 (offset -2 lines).\nHunk #7 succeeded at 5424 (offset -2 lines).\nHunk #8 succeeded at 6579 (offset -2 lines).\nHunk #9 succeeded at 6629 (offset -2 lines).\nHunk #10 succeeded at 6636 (offset -2 lines).\nHunk #11 succeeded at 6683 (offset -2 lines).\nHunk #12 succeeded at 6691 (offset -2 lines).\nHunk #13 succeeded at 6738 (offset -2 lines).\nHunk #14 succeeded at 11749 (offset -2 lines).\nHunk #15 succeeded at 14632 (offset -2 lines).\nHunk #16 succeeded at 21785 (offset -2 lines).\nHunk #17 succeeded at 26677 (offset -2 lines).\nHunk #18 succeeded at 26812 (offset -2 lines).\nHunk #19 succeeded at 26868 (offset -2 lines).\nHunk #20 succeeded at 26910 (offset -2 lines).\nHunk #21 succeeded at 27623 (offset -2 lines).\nHunk #22 succeeded at 28377 (offset -2 lines).\nHunk #23 succeeded at 29455 (offset -2 lines).\nHunk #24 succeeded at 29590 (offset -2 lines).\nHunk #25 succeeded at 29646 (offset -2 lines).\nHunk #26 succeeded at 29685 (offset -2 lines).\nHunk #27 succeeded at 30403 (offset -2 lines).\nHunk #28 succeeded at 31157 (offset -2 lines).\nHunk #29 succeeded at 32239 (offset -2 lines).\nHunk #30 succeeded at 32374 (offset -2 lines).\nHunk #31 succeeded at 32430 (offset -2 lines).\nHunk #32 succeeded at 32469 (offset -2 lines).\nHunk #33 succeeded at 33189 (offset -2 lines).\nHunk #34 succeeded at 33943 (offset -2 lines).\n```\n\nBut I'm not exactly worried about this, though the release manager may balk at it.",
    "created_at": "2013-01-04T17:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156345",
    "user": "https://github.com/kcrisman"
}
```

I'm not having any problems with `SAGE_CHECK=yes` on sage.math or OS X 10.7.  On Mac,

```
GMP-ECM's test suite passed.
```

and so unless I encounter problems on either of those machines (which I'd report), let's get this in.  I *will* point out that

```
patching file configure.in
Hunk #1 succeeded at 1918 (offset -2 lines).
patching file yasm/Makefile.in
patching file configure
Hunk #2 succeeded at 5265 (offset -2 lines).
Hunk #3 succeeded at 5315 (offset -2 lines).
Hunk #4 succeeded at 5322 (offset -2 lines).
Hunk #5 succeeded at 5369 (offset -2 lines).
Hunk #6 succeeded at 5377 (offset -2 lines).
Hunk #7 succeeded at 5424 (offset -2 lines).
Hunk #8 succeeded at 6579 (offset -2 lines).
Hunk #9 succeeded at 6629 (offset -2 lines).
Hunk #10 succeeded at 6636 (offset -2 lines).
Hunk #11 succeeded at 6683 (offset -2 lines).
Hunk #12 succeeded at 6691 (offset -2 lines).
Hunk #13 succeeded at 6738 (offset -2 lines).
Hunk #14 succeeded at 11749 (offset -2 lines).
Hunk #15 succeeded at 14632 (offset -2 lines).
Hunk #16 succeeded at 21785 (offset -2 lines).
Hunk #17 succeeded at 26677 (offset -2 lines).
Hunk #18 succeeded at 26812 (offset -2 lines).
Hunk #19 succeeded at 26868 (offset -2 lines).
Hunk #20 succeeded at 26910 (offset -2 lines).
Hunk #21 succeeded at 27623 (offset -2 lines).
Hunk #22 succeeded at 28377 (offset -2 lines).
Hunk #23 succeeded at 29455 (offset -2 lines).
Hunk #24 succeeded at 29590 (offset -2 lines).
Hunk #25 succeeded at 29646 (offset -2 lines).
Hunk #26 succeeded at 29685 (offset -2 lines).
Hunk #27 succeeded at 30403 (offset -2 lines).
Hunk #28 succeeded at 31157 (offset -2 lines).
Hunk #29 succeeded at 32239 (offset -2 lines).
Hunk #30 succeeded at 32374 (offset -2 lines).
Hunk #31 succeeded at 32430 (offset -2 lines).
Hunk #32 succeeded at 32469 (offset -2 lines).
Hunk #33 succeeded at 33189 (offset -2 lines).
Hunk #34 succeeded at 33943 (offset -2 lines).
```

But I'm not exactly worried about this, though the release manager may balk at it.



---

archive/issue_comments_156346.json:
```json
{
    "body": "In both cases,\n\n```\nThe MPIR test suite passed successfully.\nGMP-ECM's test suite passed.\n```\n\nSo I think we're okay with respect to all that.\n\nHowever, possibly related, on Mac, is\n\n```\nAll tests passed.\nzn_poly's *quick* test suite passed.\n\nNow building and installing zn_poly's shared library...\ngcc  -single_module -fPIC -dynamiclib -o libzn_poly.dylib src/array.o src/inver$\n\nNow installing zn_poly's header files...\nFinished installing zn_poly.\n\nreal    1m25.136s\nuser    1m21.802s\nsys     0m1.354s\nSuccessfully installed zn_poly-0.9.p9\nRunning the test suite for zn_poly-0.9.p9...\n\nNow building zn_poly's extensive test suite (if not already built)...\nmake[3]: Nothing to be done for `test'.\n<snip>\nzn_array_mulmid_KS1()... ok\nzn_array_mulmid_KS2()... ok\nzn_array_mulmid_KS3()... ok\nzn_array_mulmid_KS4()... ok\nnuss_mul()... FAIL!\n\nAt least one test FAILED!\nError: zn_poly failed to pass its extensive test suite.\n\nreal    13m48.475s\nuser    13m47.253s\nsys     0m0.748s\n************************************************************************\nError testing package zn_poly-0.9.p9\n************************************************************************\n```\n\nCould be a race condition, I'm seeing what happens.  On sage.math,\n\n```\nzn_poly has passed its extensive test suite.\n```\n",
    "created_at": "2013-01-04T17:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156346",
    "user": "https://github.com/kcrisman"
}
```

In both cases,

```
The MPIR test suite passed successfully.
GMP-ECM's test suite passed.
```

So I think we're okay with respect to all that.

However, possibly related, on Mac, is

```
All tests passed.
zn_poly's *quick* test suite passed.

Now building and installing zn_poly's shared library...
gcc  -single_module -fPIC -dynamiclib -o libzn_poly.dylib src/array.o src/inver$

Now installing zn_poly's header files...
Finished installing zn_poly.

real    1m25.136s
user    1m21.802s
sys     0m1.354s
Successfully installed zn_poly-0.9.p9
Running the test suite for zn_poly-0.9.p9...

Now building zn_poly's extensive test suite (if not already built)...
make[3]: Nothing to be done for `test'.
<snip>
zn_array_mulmid_KS1()... ok
zn_array_mulmid_KS2()... ok
zn_array_mulmid_KS3()... ok
zn_array_mulmid_KS4()... ok
nuss_mul()... FAIL!

At least one test FAILED!
Error: zn_poly failed to pass its extensive test suite.

real    13m48.475s
user    13m47.253s
sys     0m0.748s
************************************************************************
Error testing package zn_poly-0.9.p9
************************************************************************
```

Could be a race condition, I'm seeing what happens.  On sage.math,

```
zn_poly has passed its extensive test suite.
```




---

archive/issue_comments_156347.json:
```json
{
    "body": "Just FYI, it seems to me that we should quite quickly get rid of zn_poly spkg.\nNot sure the spkg will be used at all when FLINT gets updated to 2.3, see #12173 which is definitely more than ready for review.",
    "created_at": "2013-01-04T17:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156347",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Just FYI, it seems to me that we should quite quickly get rid of zn_poly spkg.
Not sure the spkg will be used at all when FLINT gets updated to 2.3, see #12173 which is definitely more than ready for review.



---

archive/issue_comments_156348.json:
```json
{
    "body": "> {{{\n> nuss_mul()... FAIL!\n> > }}}\nRepeatable.  And when I `./sage -f zn_poly` on a normal build of the same machine,\n\n```\nAll tests passed.\nzn_poly has passed its extensive test suite.\n```\n\nSo I'm not sure what's up, but it seems to be related to this ticket.  (Mac only.)  Note that both sage.math and my Mac use the gcc-4.6.3 spkg, so that's not the problem.",
    "created_at": "2013-01-04T18:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156348",
    "user": "https://github.com/kcrisman"
}
```

> {{{
> nuss_mul()... FAIL!
> > }}}
Repeatable.  And when I `./sage -f zn_poly` on a normal build of the same machine,

```
All tests passed.
zn_poly has passed its extensive test suite.
```

So I'm not sure what's up, but it seems to be related to this ticket.  (Mac only.)  Note that both sage.math and my Mac use the gcc-4.6.3 spkg, so that's not the problem.



---

archive/issue_comments_156349.json:
```json
{
    "body": "Notwithstanding, Sage passes all (not long) tests even with that on my Mac, as well as on sage.math.  Maybe that's good enough for this ticket.\n\n----\n\n> Just FYI, it seems to me that we should quite quickly get rid of zn_poly spkg.\n> Not sure the spkg will be used at all when FLINT gets updated to 2.3, see #12173 which is definitely more than ready for review.\nI don't notice any talk there about getting rid of it, though I see the name changes.  That said, there are only three files in `module_list.py` which include `zn_poly` in their library list, and then there is the whole sage/schemes/hyperelliptic_curves/hypellfrob/ folder, also by David Harvey, which definitely depends on it.  It does appear that \"zn_poly is no longer maintained\" and the latest version was included in FLINT - has been since 2009, huh.  I assume its functionality is still in the \"complete rewrite\" of FLINT 2.x?",
    "created_at": "2013-01-04T19:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156349",
    "user": "https://github.com/kcrisman"
}
```

Notwithstanding, Sage passes all (not long) tests even with that on my Mac, as well as on sage.math.  Maybe that's good enough for this ticket.

----

> Just FYI, it seems to me that we should quite quickly get rid of zn_poly spkg.
> Not sure the spkg will be used at all when FLINT gets updated to 2.3, see #12173 which is definitely more than ready for review.
I don't notice any talk there about getting rid of it, though I see the name changes.  That said, there are only three files in `module_list.py` which include `zn_poly` in their library list, and then there is the whole sage/schemes/hyperelliptic_curves/hypellfrob/ folder, also by David Harvey, which definitely depends on it.  It does appear that "zn_poly is no longer maintained" and the latest version was included in FLINT - has been since 2009, huh.  I assume its functionality is still in the "complete rewrite" of FLINT 2.x?



---

archive/issue_comments_156350.json:
```json
{
    "body": "> > nuss_mul()... FAIL!\nAlso with one thread and this MPIR.  So it's not a race condition.  Bummer.",
    "created_at": "2013-01-05T13:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156350",
    "user": "https://github.com/kcrisman"
}
```

> > nuss_mul()... FAIL!
Also with one thread and this MPIR.  So it's not a race condition.  Bummer.



---

archive/issue_comments_156351.json:
```json
{
    "body": "Looks like I should take a look at the Clang changes we have so far (I currently don't recall any of them...), but we apparently have a \"new\" issue (which is present in at least MPIR 2.4.0, but presumably 2.6.0 and *any older version* as well), namely `configure` failing with `clang` and `-O0` (which gets added if `SAGE_DEBUG=yes`; `-O1` doesn't work either).\n\nIvan Andrus reported this (for Sage 5.6.beta2) on sage-release, I've cc'ed mpir-devel in my [preliminary] reply.",
    "created_at": "2013-01-06T06:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156351",
    "user": "https://github.com/nexttime"
}
```

Looks like I should take a look at the Clang changes we have so far (I currently don't recall any of them...), but we apparently have a "new" issue (which is present in at least MPIR 2.4.0, but presumably 2.6.0 and *any older version* as well), namely `configure` failing with `clang` and `-O0` (which gets added if `SAGE_DEBUG=yes`; `-O1` doesn't work either).

Ivan Andrus reported this (for Sage 5.6.beta2) on sage-release, I've cc'ed mpir-devel in my [preliminary] reply.



---

archive/issue_comments_156352.json:
```json
{
    "body": "Also, is the `.p0` in the description still current?\n\nI do have different versions, i.e., older and newer versions of a `.p1` (from JP IIRC), as well as of \"the\"(?) `.p0`.",
    "created_at": "2013-01-06T06:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156352",
    "user": "https://github.com/nexttime"
}
```

Also, is the `.p0` in the description still current?

I do have different versions, i.e., older and newer versions of a `.p1` (from JP IIRC), as well as of "the"(?) `.p0`.



---

archive/issue_comments_156353.json:
```json
{
    "body": "Replying to [comment:64 leif]:\n> Also, is the `.p0` in the description still current?\n> \n> I do have different versions, i.e., older and newer versions of a `.p1` (from JP IIRC), as well as of \"the\"(?) `.p0`.\n>  \n\nOne of my \"old\" `.p0`s (fetched around December 4th) is (still) identical to the one linked to in the description, md5sum:\n\n```\n2fc787c7ad53fee4d921d2f387b0dfca  mpir-2.6.0.p0.spkg\n```\n",
    "created_at": "2013-01-06T06:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156353",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:64 leif]:
> Also, is the `.p0` in the description still current?
> 
> I do have different versions, i.e., older and newer versions of a `.p1` (from JP IIRC), as well as of "the"(?) `.p0`.
>  

One of my "old" `.p0`s (fetched around December 4th) is (still) identical to the one linked to in the description, md5sum:

```
2fc787c7ad53fee4d921d2f387b0dfca  mpir-2.6.0.p0.spkg
```




---

archive/issue_comments_156354.json:
```json
{
    "body": "`patches/configure.patch` is pretty unreadable, and as far as I can see `SPKG.txt` doesn't mention Clang at all (except for John's changelog entry, which says we shouldn't [or now do not] use it...?).",
    "created_at": "2013-01-06T07:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156354",
    "user": "https://github.com/nexttime"
}
```

`patches/configure.patch` is pretty unreadable, and as far as I can see `SPKG.txt` doesn't mention Clang at all (except for John's changelog entry, which says we shouldn't [or now do not] use it...?).



---

archive/issue_comments_156355.json:
```json
{
    "body": "Replying to [comment:66 leif]:\n> `patches/configure.patch` is pretty unreadable, and as far as I can see `SPKG.txt` doesn't mention Clang at all (except for John's changelog entry, which says we shouldn't [or now do not] use it...?).\n> \n\nIn `spkg-install`, we have:\n\n```sh\n\n    Darwin)\n        # In some cases (see SAGE_ROOT/spkg/bin/sage-env), on Darwin,\n        # CC might be set to clang, but MPIR doesn't seem to build\n        # with clang.\n        CLANG=`command -v clang`\n        GCC=`command -v gcc`\n        if [ -n \"$CC\" ] && [ \"$CC\" = \"$CLANG\" ] && [ -n \"$GCC\" ] ; then\n            export CC=\"$GCC\"\n        fi\n```\n\n\nWhich means we use `$GCC` even if `CC` is set to `clang` (actually, the output of `command -v clang`) *if GCC is available* (more precisely, if `command -v gcc` is non-empty).\n\nApart from that these tests are pretty limited [to not say broken] (and `CC` is always set btw.), that doesn't prevent the use of Clang.  So we should either issue an error message if GCC is not available (while `command -v gcc` might actually give a link to `clang` :-) ), or we should fix the build(?) issues with Clang...",
    "created_at": "2013-01-06T07:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156355",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:66 leif]:
> `patches/configure.patch` is pretty unreadable, and as far as I can see `SPKG.txt` doesn't mention Clang at all (except for John's changelog entry, which says we shouldn't [or now do not] use it...?).
> 

In `spkg-install`, we have:

```sh

    Darwin)
        # In some cases (see SAGE_ROOT/spkg/bin/sage-env), on Darwin,
        # CC might be set to clang, but MPIR doesn't seem to build
        # with clang.
        CLANG=`command -v clang`
        GCC=`command -v gcc`
        if [ -n "$CC" ] && [ "$CC" = "$CLANG" ] && [ -n "$GCC" ] ; then
            export CC="$GCC"
        fi
```


Which means we use `$GCC` even if `CC` is set to `clang` (actually, the output of `command -v clang`) *if GCC is available* (more precisely, if `command -v gcc` is non-empty).

Apart from that these tests are pretty limited [to not say broken] (and `CC` is always set btw.), that doesn't prevent the use of Clang.  So we should either issue an error message if GCC is not available (while `command -v gcc` might actually give a link to `clang` :-) ), or we should fix the build(?) issues with Clang...



---

archive/issue_comments_156356.json:
```json
{
    "body": "FWIW, with vanilla MPIR 2.6.0, after fixing only the first (yet another) `configure` issue, so far MPIR builds, although a 32-bit version (due to another broken test; I'll fix that later), with Clang 3.1, and passes its test suite.  (This is on a Linux x86_64 box.)",
    "created_at": "2013-01-06T08:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156356",
    "user": "https://github.com/nexttime"
}
```

FWIW, with vanilla MPIR 2.6.0, after fixing only the first (yet another) `configure` issue, so far MPIR builds, although a 32-bit version (due to another broken test; I'll fix that later), with Clang 3.1, and passes its test suite.  (This is on a Linux x86_64 box.)



---

archive/issue_comments_156357.json:
```json
{
    "body": "Replying to [comment:67 leif]:\n> Replying to [comment:66 leif]:\n> > `patches/configure.patch` is pretty unreadable, and as far as I can see `SPKG.txt` \nYup, IIRC that's just autocrap diff.\n>doesn't mention Clang at all (except for John's changelog entry, which says we shouldn't [or now do not] use it...?).\nI don't think we support clang so that comes as no surprise.\nBy the way I've reportd some time ago the clang problem upstream but I saw you even proposed fixes, that's great.\n> > \n> \n> In `spkg-install`, we have:\n> {{{\n> #!sh\n> \n>     Darwin)\n>         # In some cases (see SAGE_ROOT/spkg/bin/sage-env), on Darwin,\n>         # CC might be set to clang, but MPIR doesn't seem to build\n>         # with clang.\n>         CLANG=`command -v clang`\n>         GCC=`command -v gcc`\n>         if [ -n \"$CC\" ] && [ \"$CC\" = \"$CLANG\" ] && [ -n \"$GCC\" ] ; then\n>             export CC=\"$GCC\"\n>         fi\n> }}}\n> \n> Which means we use `$GCC` even if `CC` is set to `clang` (actually, the output of `command -v clang`) *if GCC is available* (more precisely, if `command -v gcc` is non-empty).\nIndeed.\n> \n> Apart from that these tests are pretty limited [to not say broken] (and `CC` is always set btw.), that doesn't prevent the use of Clang.  So we should either issue an error message if GCC is not available (while `command -v gcc` might actually give a link to `clang` :-) ), or we should fix the build(?) issues with Clang...\nI don't really know what the best solution is.\nPersonally I don't use Apple stuff, so I would be inclined to merge the current spkg with minimal changes and deal with the clang nightmare in a later ticket.",
    "created_at": "2013-01-06T23:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156357",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:67 leif]:
> Replying to [comment:66 leif]:
> > `patches/configure.patch` is pretty unreadable, and as far as I can see `SPKG.txt` 
Yup, IIRC that's just autocrap diff.
>doesn't mention Clang at all (except for John's changelog entry, which says we shouldn't [or now do not] use it...?).
I don't think we support clang so that comes as no surprise.
By the way I've reportd some time ago the clang problem upstream but I saw you even proposed fixes, that's great.
> > 
> 
> In `spkg-install`, we have:
> {{{
> #!sh
> 
>     Darwin)
>         # In some cases (see SAGE_ROOT/spkg/bin/sage-env), on Darwin,
>         # CC might be set to clang, but MPIR doesn't seem to build
>         # with clang.
>         CLANG=`command -v clang`
>         GCC=`command -v gcc`
>         if [ -n "$CC" ] && [ "$CC" = "$CLANG" ] && [ -n "$GCC" ] ; then
>             export CC="$GCC"
>         fi
> }}}
> 
> Which means we use `$GCC` even if `CC` is set to `clang` (actually, the output of `command -v clang`) *if GCC is available* (more precisely, if `command -v gcc` is non-empty).
Indeed.
> 
> Apart from that these tests are pretty limited [to not say broken] (and `CC` is always set btw.), that doesn't prevent the use of Clang.  So we should either issue an error message if GCC is not available (while `command -v gcc` might actually give a link to `clang` :-) ), or we should fix the build(?) issues with Clang...
I don't really know what the best solution is.
Personally I don't use Apple stuff, so I would be inclined to merge the current spkg with minimal changes and deal with the clang nightmare in a later ticket.



---

archive/issue_comments_156358.json:
```json
{
    "body": "> > > nuss_mul()... FAIL!\n> Also with one thread and this MPIR.  So it's not a race condition.  Bummer.\nThis is not 100% platform independent; I get the same failure on Cygwin on XP, with gcc 4.5.3, with this MPIR spkg.  The Mac one is of course with the Sage-provided gcc.",
    "created_at": "2013-01-07T19:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156358",
    "user": "https://github.com/kcrisman"
}
```

> > > nuss_mul()... FAIL!
> Also with one thread and this MPIR.  So it's not a race condition.  Bummer.
This is not 100% platform independent; I get the same failure on Cygwin on XP, with gcc 4.5.3, with this MPIR spkg.  The Mac one is of course with the Sage-provided gcc.



---

archive/issue_comments_156359.json:
```json
{
    "body": "Replying to [comment:61 kcrisman]:\n> Notwithstanding, Sage passes all (not long) tests even with that on my Mac, as well as on sage.math.  Maybe that's good enough for this ticket.\n> \n> ----\n> \n> > Just FYI, it seems to me that we should quite quickly get rid of zn_poly spkg.\n> > Not sure the spkg will be used at all when FLINT gets updated to 2.3, see #12173 which is definitely more than ready for review.\n> I don't notice any talk there about getting rid of it, though I see the name changes.  That said, there are only three files in `module_list.py` which include `zn_poly` in their library list, and then \nFor the first file, linking to zn_poly should not be needed anymore and should be fixed at #12173.\nIn fact I'm not really sure anyway it was, there is no direct reference to zn_poly there and it must in fact use it through FLINT 1.5.2 (which ships zn_poly...).\n\nFor the second file, the sole function which still really directly use is some \"experimental preview\"...\nThe real deal is operated through FLINT (which then use its own zn_poly).\nI think this should be removed as well and the preview function deleted (I don't think it used anywhere).\n> there is the whole sage/schemes/hyperelliptic_curves/hypellfrob/ folder, also by David Harvey, which definitely depends on it.  It does appear that \"zn_poly is no longer maintained\" and the latest version was included in FLINT - has been since 2009, huh.  I assume its functionality is still in the \"complete rewrite\" of FLINT 2.x?\nIndeed the hypellfrob spkg will still depend on zn_poly.\nAlthough I think all functionalities of zn_poly should be given by FLINT 2.3 (and even 1.5.2 which ships zn_poly remember).\nThis is more problematic as we would need to patch hyperellfrob to use what is exposed by FLINT 1.5.2 or rather 2.3...",
    "created_at": "2013-01-09T16:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156359",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:61 kcrisman]:
> Notwithstanding, Sage passes all (not long) tests even with that on my Mac, as well as on sage.math.  Maybe that's good enough for this ticket.
> 
> ----
> 
> > Just FYI, it seems to me that we should quite quickly get rid of zn_poly spkg.
> > Not sure the spkg will be used at all when FLINT gets updated to 2.3, see #12173 which is definitely more than ready for review.
> I don't notice any talk there about getting rid of it, though I see the name changes.  That said, there are only three files in `module_list.py` which include `zn_poly` in their library list, and then 
For the first file, linking to zn_poly should not be needed anymore and should be fixed at #12173.
In fact I'm not really sure anyway it was, there is no direct reference to zn_poly there and it must in fact use it through FLINT 1.5.2 (which ships zn_poly...).

For the second file, the sole function which still really directly use is some "experimental preview"...
The real deal is operated through FLINT (which then use its own zn_poly).
I think this should be removed as well and the preview function deleted (I don't think it used anywhere).
> there is the whole sage/schemes/hyperelliptic_curves/hypellfrob/ folder, also by David Harvey, which definitely depends on it.  It does appear that "zn_poly is no longer maintained" and the latest version was included in FLINT - has been since 2009, huh.  I assume its functionality is still in the "complete rewrite" of FLINT 2.x?
Indeed the hypellfrob spkg will still depend on zn_poly.
Although I think all functionalities of zn_poly should be given by FLINT 2.3 (and even 1.5.2 which ships zn_poly remember).
This is more problematic as we would need to patch hyperellfrob to use what is exposed by FLINT 1.5.2 or rather 2.3...



---

archive/issue_comments_156360.json:
```json
{
    "body": "Replying to [comment:70 kcrisman]:\n> > > > nuss_mul()... FAIL!\n> > Also with one thread and this MPIR.  So it's not a race condition.  Bummer.\n> This is not 100% platform independent; I get the same failure on Cygwin on XP, with gcc 4.5.3, with this MPIR spkg.  The Mac one is of course with the Sage-provided gcc.\nJust for info as it is surely unrelated, I have also always had random segfaults while building zn_poly on my 64 bits Windows 7 Cygwin install, with the old or the new MPIR.\nIt occured while doing some timings for multiplications.\nAfter a few tries it could go through though.\n\nThere is also a problem mentioned on the zn_poly page about GCC 4.6.3 and make tune, but I don't think we use that target anyway.",
    "created_at": "2013-01-09T16:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156360",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:70 kcrisman]:
> > > > nuss_mul()... FAIL!
> > Also with one thread and this MPIR.  So it's not a race condition.  Bummer.
> This is not 100% platform independent; I get the same failure on Cygwin on XP, with gcc 4.5.3, with this MPIR spkg.  The Mac one is of course with the Sage-provided gcc.
Just for info as it is surely unrelated, I have also always had random segfaults while building zn_poly on my 64 bits Windows 7 Cygwin install, with the old or the new MPIR.
It occured while doing some timings for multiplications.
After a few tries it could go through though.

There is also a problem mentioned on the zn_poly page about GCC 4.6.3 and make tune, but I don't think we use that target anyway.



---

archive/issue_comments_156361.json:
```json
{
    "body": "In fact the spkg-install calls make tune so we should be affected by the problems with GCC 4.6.3 onward Drew Sutherland mentioned, strange.",
    "created_at": "2013-01-09T16:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156361",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

In fact the spkg-install calls make tune so we should be affected by the problems with GCC 4.6.3 onward Drew Sutherland mentioned, strange.



---

archive/issue_comments_156362.json:
```json
{
    "body": "For future reference:\nhttps://groups.google.com/forum/?fromgroups=#!topic/sage-devel/gXBK78hstIc",
    "created_at": "2013-01-09T16:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156362",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

For future reference:
https://groups.google.com/forum/?fromgroups=#!topic/sage-devel/gXBK78hstIc



---

archive/issue_comments_156363.json:
```json
{
    "body": "Replying to [comment:70 kcrisman]:\n> > > > nuss_mul()... FAIL!\n> > Also with one thread and this MPIR.  So it's not a race condition.  Bummer.\n> This is not 100% platform independent; I get the same failure on Cygwin on XP, with gcc 4.5.3, with this MPIR spkg.  The Mac one is of course with the Sage-provided gcc.\nIn fact this might indeed be a bug in the new MPIR FFT, so I'm reporting that upstream.",
    "created_at": "2013-01-09T17:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156363",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:70 kcrisman]:
> > > > nuss_mul()... FAIL!
> > Also with one thread and this MPIR.  So it's not a race condition.  Bummer.
> This is not 100% platform independent; I get the same failure on Cygwin on XP, with gcc 4.5.3, with this MPIR spkg.  The Mac one is of course with the Sage-provided gcc.
In fact this might indeed be a bug in the new MPIR FFT, so I'm reporting that upstream.



---

archive/issue_comments_156364.json:
```json
{
    "body": "On what exact Mac was the test failing?",
    "created_at": "2013-01-09T18:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156364",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

On what exact Mac was the test failing?



---

archive/issue_comments_156365.json:
```json
{
    "body": "And could you please try rebuildong MPIR and then zn_poly with other GCC versions on both Cygwin and the Mac?\nSo both Sages GCC 4.6.3 and 4.7.2 (from #13913 I advise, much smaller) and 4.7.2 on Mac?",
    "created_at": "2013-01-09T20:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156365",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

And could you please try rebuildong MPIR and then zn_poly with other GCC versions on both Cygwin and the Mac?
So both Sages GCC 4.6.3 and 4.7.2 (from #13913 I advise, much smaller) and 4.7.2 on Mac?



---

archive/issue_comments_156366.json:
```json
{
    "body": "> On what exact Mac was the test failing?\nOS X 10.7 building the Sage gcc package.\n> And could you please try rebuildong MPIR and then zn_poly with other GCC versions on both Cygwin and the Mac?\n> So both Sages GCC 4.6.3 and 4.7.2 (from #13913 I advise, much smaller) and 4.7.2 on Mac?\nNo, I can't, I'm sorry - or to be more accurate, it's just too much time on the Cygwin.  It really takes me a *long* time to get things going on there, what with rebasing and only having occasional access to that computer.  Waiting for it to compile gcc spkgs... with the semester starting, I know that would be unwise.",
    "created_at": "2013-01-10T04:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156366",
    "user": "https://github.com/kcrisman"
}
```

> On what exact Mac was the test failing?
OS X 10.7 building the Sage gcc package.
> And could you please try rebuildong MPIR and then zn_poly with other GCC versions on both Cygwin and the Mac?
> So both Sages GCC 4.6.3 and 4.7.2 (from #13913 I advise, much smaller) and 4.7.2 on Mac?
No, I can't, I'm sorry - or to be more accurate, it's just too much time on the Cygwin.  It really takes me a *long* time to get things going on there, what with rebasing and only having occasional access to that computer.  Waiting for it to compile gcc spkgs... with the semester starting, I know that would be unwise.



---

archive/issue_comments_156367.json:
```json
{
    "body": "Replying to [comment:78 kcrisman]:\n> > On what exact Mac was the test failing?\n> OS X 10.7 building the Sage gcc package.\nI guess this is on top of recent Mac, so Intel 64 bits CPU?\n> > And could you please try rebuildong MPIR and then zn_poly with other GCC versions on both Cygwin and the Mac?\n> > So both Sages GCC 4.6.3 and 4.7.2 (from #13913 I advise, much smaller) and 4.7.2 on Mac?\n> No, I can't, I'm sorry - or to be more accurate, it's just too much time on the Cygwin.  It really takes me a *long* time to get things going on there, what with rebasing and only having occasional access to that computer.  Waiting for it to compile gcc spkgs... with the semester starting, I know that would be unwise.\nNo problem, I should have some WinXP installs at my old workplace and at home on a laptop (with broken screen...).\nThat's not the best, but I should be able to try to reproduce it.\n\nCould you also specify the CPU used on this WinXP install? So far I assumed it was a 32 bits CPU and the install is 32 bits but I'm not sure about the former fact anymore.",
    "created_at": "2013-01-10T09:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156367",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:78 kcrisman]:
> > On what exact Mac was the test failing?
> OS X 10.7 building the Sage gcc package.
I guess this is on top of recent Mac, so Intel 64 bits CPU?
> > And could you please try rebuildong MPIR and then zn_poly with other GCC versions on both Cygwin and the Mac?
> > So both Sages GCC 4.6.3 and 4.7.2 (from #13913 I advise, much smaller) and 4.7.2 on Mac?
> No, I can't, I'm sorry - or to be more accurate, it's just too much time on the Cygwin.  It really takes me a *long* time to get things going on there, what with rebasing and only having occasional access to that computer.  Waiting for it to compile gcc spkgs... with the semester starting, I know that would be unwise.
No problem, I should have some WinXP installs at my old workplace and at home on a laptop (with broken screen...).
That's not the best, but I should be able to try to reproduce it.

Could you also specify the CPU used on this WinXP install? So far I assumed it was a 32 bits CPU and the install is 32 bits but I'm not sure about the former fact anymore.



---

archive/issue_comments_156368.json:
```json
{
    "body": "ROFL.\n\n\n```\n...\nxmlto -o . man ./frontends/yasm/yasm.xml\n/usr/bin/xmlto: line 522:   917 Segmentation fault      \"$XMLLINT_PATH\" --noout --nonet --xinclude --postvalid --noent \"$INPUT_FILE\" 2> \"${VALIDATION}\"\nxmlto: .../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm/./frontends/yasm/yasm.xml does not validate (status 139)\nxmlto: Fix document syntax or use --skip-validation option\nmake[4]: *** [yasm.1] Error 149\nmake[4]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm'\nmake[3]: *** [all-recursive] Error 1\nmake[3]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm'\nmake[2]: *** [all] Error 2\nmake[2]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm'\nmake[1]: *** [all-recursive] Error 1\nmake[1]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src'\nmake: *** [all] Error 2\nError building MPIR.\n\nreal    10m31.056s\nuser    4m9.180s\nsys     1m23.737s\n************************************************************************\n```\n",
    "created_at": "2013-01-10T16:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156368",
    "user": "https://github.com/nexttime"
}
```

ROFL.


```
...
xmlto -o . man ./frontends/yasm/yasm.xml
/usr/bin/xmlto: line 522:   917 Segmentation fault      "$XMLLINT_PATH" --noout --nonet --xinclude --postvalid --noent "$INPUT_FILE" 2> "${VALIDATION}"
xmlto: .../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm/./frontends/yasm/yasm.xml does not validate (status 139)
xmlto: Fix document syntax or use --skip-validation option
make[4]: *** [yasm.1] Error 149
make[4]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm'
make[3]: *** [all-recursive] Error 1
make[3]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm'
make[2]: *** [all] Error 2
make[2]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src/yasm'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `.../sage-5.6.beta1-scratch-gcc-4.4.3/spkg/build/mpir-2.6.0.p0/src'
make: *** [all] Error 2
Error building MPIR.

real    10m31.056s
user    4m9.180s
sys     1m23.737s
************************************************************************
```




---

archive/issue_comments_156369.json:
```json
{
    "body": "P.S.: FWIW, this didn't happen with the MPIR 2.4.0.p6 spkg... :-)",
    "created_at": "2013-01-10T16:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156369",
    "user": "https://github.com/nexttime"
}
```

P.S.: FWIW, this didn't happen with the MPIR 2.4.0.p6 spkg... :-)



---

archive/issue_comments_156370.json:
```json
{
    "body": "I think this Mac is one of the sort-of 64-bit ones (potential, not everything is).  XP must be 32 bit, the computer is ancient.  But I really don't know for sure even how to check, and I wouldn't worry about it.\n\nLeif, what kind of computer are you on - some kind of Linux?",
    "created_at": "2013-01-10T16:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156370",
    "user": "https://github.com/kcrisman"
}
```

I think this Mac is one of the sort-of 64-bit ones (potential, not everything is).  XP must be 32 bit, the computer is ancient.  But I really don't know for sure even how to check, and I wouldn't worry about it.

Leif, what kind of computer are you on - some kind of Linux?



---

archive/issue_comments_156371.json:
```json
{
    "body": "Replying to [comment:82 kcrisman]:\n> Leif, what kind of computer are you on - some kind of Linux?\n\nYes.  But you probably meant the machine `xmlto` is failing on... ;-)\n\nThat's a 32-bit Linux box I was trying to reproduce the zn_poly error on.  (I've so far only built several versions of *vanilla* MPIR 2.6.0 on that, with different GCC versions, and at least MPIR's test suite always passed.)",
    "created_at": "2013-01-10T16:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156371",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:82 kcrisman]:
> Leif, what kind of computer are you on - some kind of Linux?

Yes.  But you probably meant the machine `xmlto` is failing on... ;-)

That's a 32-bit Linux box I was trying to reproduce the zn_poly error on.  (I've so far only built several versions of *vanilla* MPIR 2.6.0 on that, with different GCC versions, and at least MPIR's test suite always passed.)



---

archive/issue_comments_156372.json:
```json
{
    "body": "Replying to [comment:83 leif]:\n> That's a 32-bit Linux box I was trying to reproduce the zn_poly error on.  (I've so far only built several versions of *vanilla* MPIR 2.6.0 on that, with different GCC versions, and at least MPIR's test suite always passed.)\n\nI'm not sure whether `xmlto` was installed when testing the betas and RCs of MPIR 2.6.0, can't find the build logs right now.  Our MPIR 2.4.0 does look for `xmlto` as well, finds it, but apparently doesn't try to build yasm's man pages with it, in contrast to 2.6.0.",
    "created_at": "2013-01-10T17:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156372",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:83 leif]:
> That's a 32-bit Linux box I was trying to reproduce the zn_poly error on.  (I've so far only built several versions of *vanilla* MPIR 2.6.0 on that, with different GCC versions, and at least MPIR's test suite always passed.)

I'm not sure whether `xmlto` was installed when testing the betas and RCs of MPIR 2.6.0, can't find the build logs right now.  Our MPIR 2.4.0 does look for `xmlto` as well, finds it, but apparently doesn't try to build yasm's man pages with it, in contrast to 2.6.0.



---

archive/issue_comments_156373.json:
```json
{
    "body": "zn_poly's quick as well as its extensive test suite passed for me with the MPIR 2.6.0.p0 spkg; Pentium4 Prescott, Ubuntu GCC 4.4.3, `-march=native`, `-O3`, ...\n\nWill retry with FSF GCC 4.7.2 later...",
    "created_at": "2013-01-10T18:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156373",
    "user": "https://github.com/nexttime"
}
```

zn_poly's quick as well as its extensive test suite passed for me with the MPIR 2.6.0.p0 spkg; Pentium4 Prescott, Ubuntu GCC 4.4.3, `-march=native`, `-O3`, ...

Will retry with FSF GCC 4.7.2 later...



---

archive/issue_comments_156374.json:
```json
{
    "body": "Replying to [comment:85 leif]:\n> zn_poly's quick as well as its extensive test suite passed for me with the MPIR 2.6.0.p0 spkg; Pentium4 Prescott, Ubuntu GCC 4.4.3, `-march=native`, `-O3`, ...\n\nSame with FSF GCC 4.7.2;  same machine, same flags.\n\n[I didn't build or run the tests in parallel though.]",
    "created_at": "2013-01-10T19:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156374",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:85 leif]:
> zn_poly's quick as well as its extensive test suite passed for me with the MPIR 2.6.0.p0 spkg; Pentium4 Prescott, Ubuntu GCC 4.4.3, `-march=native`, `-O3`, ...

Same with FSF GCC 4.7.2;  same machine, same flags.

[I didn't build or run the tests in parallel though.]



---

archive/issue_comments_156375.json:
```json
{
    "body": "Replying to [comment:86 leif]:\n> Replying to [comment:85 leif]:\n> > zn_poly's quick as well as its extensive test suite passed for me with the MPIR 2.6.0.p0 spkg; Pentium4 Prescott, Ubuntu GCC 4.4.3, `-march=native`, `-O3`, ...\n> \n> Same with FSF GCC 4.7.2;  same machine, same flags.\n> \n> [I didn't build or run the tests in parallel though.]\n\nSame with `{C,CPP,CXX}FLAGS` unset (only in the shell of course);  Ubuntu GCC 4.4.3 and FSF GCC 4.7.2.",
    "created_at": "2013-01-10T21:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156375",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:86 leif]:
> Replying to [comment:85 leif]:
> > zn_poly's quick as well as its extensive test suite passed for me with the MPIR 2.6.0.p0 spkg; Pentium4 Prescott, Ubuntu GCC 4.4.3, `-march=native`, `-O3`, ...
> 
> Same with FSF GCC 4.7.2;  same machine, same flags.
> 
> [I didn't build or run the tests in parallel though.]

Same with `{C,CPP,CXX}FLAGS` unset (only in the shell of course);  Ubuntu GCC 4.4.3 and FSF GCC 4.7.2.



---

archive/issue_comments_156376.json:
```json
{
    "body": "So I've run zn_poly's (quick) test suite (built with MPIR 2.6.0.p0, Ubuntu GCC 4.4.3) 50 times on the already heavily-loaded 32-bit Linux box -- without any failures.",
    "created_at": "2013-01-11T00:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156376",
    "user": "https://github.com/nexttime"
}
```

So I've run zn_poly's (quick) test suite (built with MPIR 2.6.0.p0, Ubuntu GCC 4.4.3) 50 times on the already heavily-loaded 32-bit Linux box -- without any failures.



---

archive/issue_comments_156377.json:
```json
{
    "body": "Replying to [comment:88 leif]:\n> So I've run zn_poly's (quick) test suite (built with MPIR 2.6.0.p0, Ubuntu GCC 4.4.3) 50 times on the already heavily-loaded 32-bit Linux box -- without any failures.\n\n... and same for the version built with GCC 4.7.2.",
    "created_at": "2013-01-11T01:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156377",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:88 leif]:
> So I've run zn_poly's (quick) test suite (built with MPIR 2.6.0.p0, Ubuntu GCC 4.4.3) 50 times on the already heavily-loaded 32-bit Linux box -- without any failures.

... and same for the version built with GCC 4.7.2.



---

archive/issue_comments_156378.json:
```json
{
    "body": "From at I've read on sage-devel it is not clear that the zn_poly failure is MPIR 2.6.0 specific, waiting for feedback there, we should also try on top of GMP to gather more intel.\n\nFor leif: if you want to package a clang enabled spkg, please ase it on #12115 which was closed as we thought the one here would quickly get in.",
    "created_at": "2013-01-11T08:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156378",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

From at I've read on sage-devel it is not clear that the zn_poly failure is MPIR 2.6.0 specific, waiting for feedback there, we should also try on top of GMP to gather more intel.

For leif: if you want to package a clang enabled spkg, please ase it on #12115 which was closed as we thought the one here would quickly get in.



---

archive/issue_comments_156379.json:
```json
{
    "body": "Ok it failed with older MPIR as well, please have a look at build logs here:\nhttps://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion",
    "created_at": "2013-01-11T09:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156379",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok it failed with older MPIR as well, please have a look at build logs here:
https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion



---

archive/issue_comments_156380.json:
```json
{
    "body": "Replying to [comment:91 jpflori]:\n> Ok it failed with older MPIR as well, please have a look at build logs here:\n> https://groups.google.com/d/topic/sagei-release/ngw_EiBaY0Q/discussion\n\nWell, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)\n\nOne would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...",
    "created_at": "2013-01-11T09:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156380",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:91 jpflori]:
> Ok it failed with older MPIR as well, please have a look at build logs here:
> https://groups.google.com/d/topic/sagei-release/ngw_EiBaY0Q/discussion

Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)

One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...



---

archive/issue_comments_156381.json:
```json
{
    "body": "Replying to [comment:92 leif]:\n> Replying to [comment:91 jpflori]:\n> > Ok it failed with older MPIR as well, please have a look at build logs here:\n> > https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion\n> \n> Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)\n> \nHmmm, the reports on sage-release for 5.6.beta3 also point that there is a problem with zn_poly on top of MPIR 2.4.x [on OS X], and I don't know why but I have strong suspicion it could be in nuss_mul [as well].\n> One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...\nThe problem is not during the tuning phase but during the quick test one.\n\nThe testing code is quite simple, it multiplies two (large) polys using FFT:\n* first with the zn_poly code,\n* then with the underlying MPIR/GMP code (using KS)\nand compare the results.\n\nSo a potential culprit was the new MPIR FFT, but as the [same] bug seemed to happen with older version of MPIR and the FFT code was completely changed inbeetween, we can mostly rule out that MPIR is to blame.\nIt looks like we have to blame zn_poly, which is unfortunate because it is unmaintained.\n\nAnd remember I mentioned I get segfaults quite often in different places as well on Cygwin when building zn_poly during the tuning phase (and tuning the threshold for FFT IIRC).\nSo it does not seem completely crazy to blame zn_poly rather than MPIR for the other problem as well.\n\nOf course a good test would be to try to reproduce the error on the problematic systems but on top of GMP.\nIf the problem persists, I guess we can definitely rule out that MPIR is buggy.\n>",
    "created_at": "2013-01-11T09:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156381",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:92 leif]:
> Replying to [comment:91 jpflori]:
> > Ok it failed with older MPIR as well, please have a look at build logs here:
> > https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion
> 
> Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)
> 
Hmmm, the reports on sage-release for 5.6.beta3 also point that there is a problem with zn_poly on top of MPIR 2.4.x [on OS X], and I don't know why but I have strong suspicion it could be in nuss_mul [as well].
> One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...
The problem is not during the tuning phase but during the quick test one.

The testing code is quite simple, it multiplies two (large) polys using FFT:
* first with the zn_poly code,
* then with the underlying MPIR/GMP code (using KS)
and compare the results.

So a potential culprit was the new MPIR FFT, but as the [same] bug seemed to happen with older version of MPIR and the FFT code was completely changed inbeetween, we can mostly rule out that MPIR is to blame.
It looks like we have to blame zn_poly, which is unfortunate because it is unmaintained.

And remember I mentioned I get segfaults quite often in different places as well on Cygwin when building zn_poly during the tuning phase (and tuning the threshold for FFT IIRC).
So it does not seem completely crazy to blame zn_poly rather than MPIR for the other problem as well.

Of course a good test would be to try to reproduce the error on the problematic systems but on top of GMP.
If the problem persists, I guess we can definitely rule out that MPIR is buggy.
>



---

archive/issue_comments_156382.json:
```json
{
    "body": "Other previous problems report:\nhttps://groups.google.com/d/msg/sage-devel/FP96-mDGkxE/hlcfcZksGZMJ\n(this one is quite scarce I admit).\n\nSo nobody with a Mac wants to test this with GMP, MPIR 2.4.x and MPIR 2.6.0?\nI think bsd.math is but i don't have access to it.",
    "created_at": "2013-01-11T10:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156382",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Other previous problems report:
https://groups.google.com/d/msg/sage-devel/FP96-mDGkxE/hlcfcZksGZMJ
(this one is quite scarce I admit).

So nobody with a Mac wants to test this with GMP, MPIR 2.4.x and MPIR 2.6.0?
I think bsd.math is but i don't have access to it.



---

archive/issue_comments_156383.json:
```json
{
    "body": "Other problems reports here:\nhttps://groups.google.com/d/msg/sage-devel/2ulJLgc6-ao/zrzZZ7_uOikJ\n\nThe last one is similar to the one I evoked on Cygwin.\nSo I guess I'll have to gdb/valgrind it on Cygwin.\nBut I'm ok with Bill's cosmic ray explanation as well.",
    "created_at": "2013-01-11T10:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156383",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Other problems reports here:
https://groups.google.com/d/msg/sage-devel/2ulJLgc6-ao/zrzZZ7_uOikJ

The last one is similar to the one I evoked on Cygwin.
So I guess I'll have to gdb/valgrind it on Cygwin.
But I'm ok with Bill's cosmic ray explanation as well.



---

archive/issue_comments_156384.json:
```json
{
    "body": "Replying to [comment:93 jpflori]:\n> Replying to [comment:92 leif]:\n> > Replying to [comment:91 jpflori]:\n> > > Ok it failed with older MPIR as well, please have a look at build logs here:\n> > > https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion\n> > \n> > Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)\n> > \n> Hmmm, the reports on sage-release for 5.6.beta3 also point that there is a problem with zn_poly on top of MPIR 2.4.x [on OS X], and I don't know why but I have strong suspicion it could be in nuss_mul [as well].\n\nI didn't mean to say it was MPIR's fault.  (I agree it's something with zn_poly['s tuning], perhaps in conjunction with a specific GCC version [and probably also the OS].  Note that the MacOSs most probably have GCC 4.6.3 [from our spkg] in common.]\n\n\n\n\n> > One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...\n> The problem is not during the tuning phase but during the quick test one.\n\nWell, it shows up during the tests, but presumably the tuning generates invalid code (or code triggering a compiler bug) under certain circumstances, like perhaps heavy load.",
    "created_at": "2013-01-11T10:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156384",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:93 jpflori]:
> Replying to [comment:92 leif]:
> > Replying to [comment:91 jpflori]:
> > > Ok it failed with older MPIR as well, please have a look at build logs here:
> > > https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion
> > 
> > Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)
> > 
> Hmmm, the reports on sage-release for 5.6.beta3 also point that there is a problem with zn_poly on top of MPIR 2.4.x [on OS X], and I don't know why but I have strong suspicion it could be in nuss_mul [as well].

I didn't mean to say it was MPIR's fault.  (I agree it's something with zn_poly['s tuning], perhaps in conjunction with a specific GCC version [and probably also the OS].  Note that the MacOSs most probably have GCC 4.6.3 [from our spkg] in common.]




> > One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...
> The problem is not during the tuning phase but during the quick test one.

Well, it shows up during the tests, but presumably the tuning generates invalid code (or code triggering a compiler bug) under certain circumstances, like perhaps heavy load.



---

archive/issue_comments_156385.json:
```json
{
    "body": "I agree, my point is that the zn_poly problem should not be dealt with here and should not prevent the upgrade of MPIR if it is unrelated.",
    "created_at": "2013-01-11T10:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156385",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I agree, my point is that the zn_poly problem should not be dealt with here and should not prevent the upgrade of MPIR if it is unrelated.



---

archive/issue_comments_156386.json:
```json
{
    "body": "Nor should the clang stuff in my opinion, it should be on a follow-up ticket.\n\nBut we should fix the xmlto problem\n\nAnd patch the patches so that there is no offset, only changing the line numbers (but not the timestamps et al. in order to keep the hg history small if possible), if someone wants to write a script to do that automatically I'll be more than happy.",
    "created_at": "2013-01-11T10:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156386",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Nor should the clang stuff in my opinion, it should be on a follow-up ticket.

But we should fix the xmlto problem

And patch the patches so that there is no offset, only changing the line numbers (but not the timestamps et al. in order to keep the hg history small if possible), if someone wants to write a script to do that automatically I'll be more than happy.



---

archive/issue_comments_156387.json:
```json
{
    "body": "Replying to [comment:73 jpflori]:\n> In fact the spkg-install calls make tune so we should be affected by the problems with GCC 4.6.3 onward Drew Sutherland mentioned, strange.\nOk, we don't have that one because we fixed it at #8771.",
    "created_at": "2013-01-11T10:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156387",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:73 jpflori]:
> In fact the spkg-install calls make tune so we should be affected by the problems with GCC 4.6.3 onward Drew Sutherland mentioned, strange.
Ok, we don't have that one because we fixed it at #8771.



---

archive/issue_comments_156388.json:
```json
{
    "body": "Replying to [comment:96 leif]:\n> Replying to [comment:93 jpflori]:\n> > Replying to [comment:92 leif]:\n> > > Replying to [comment:91 jpflori]:\n> > > > Ok it failed with older MPIR as well, please have a look at build logs here:\n> > > > https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion\n> > > \n> > > Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)\n> > > \n> > Hmmm, the reports on sage-release for 5.6.beta3 also point that there is a problem with zn_poly on top of MPIR 2.4.x [on OS X], and I don't know why but I have strong suspicion it could be in nuss_mul [as well].\n> \n> I didn't mean to say it was MPIR's fault.  (I agree it's something with zn_poly['s tuning], perhaps in conjunction with a specific GCC version [and probably also the OS].  Note that the MacOSs most probably have GCC 4.6.3 [from our spkg] in common.]\n> \n> \n\n> \n> > > One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...\n> > The problem is not during the tuning phase but during the quick test one.\n> \n> Well, it shows up during the tests, but presumably the tuning generates invalid code (or code triggering a compiler bug) under certain circumstances, like perhaps heavy load.\n> \nFrom what I see after a quick look, the tuning process only chooses thresholds, and does not generates code.\nSo maybe the code is genuinely buggy for certain random values, or there is a compiler bug (but from what we gathered I wouldn't say we always use the same GCC, bugs appear at least with FSF GCC 4.6.3 on different Os X and with Cywgin GCC 4.5.3 (maybe with later FSF GCC don't remember) on ... Cygwin) that generates code which fails on certain random values.\n\nOr maybe under heavy load, the thresholds get chosen so that code is called on value ranges it is not meant for and boom (but only on Os X and Cygwin, if that was to be true on Linuces I guess we would have seen it before).",
    "created_at": "2013-01-11T10:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156388",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:96 leif]:
> Replying to [comment:93 jpflori]:
> > Replying to [comment:92 leif]:
> > > Replying to [comment:91 jpflori]:
> > > > Ok it failed with older MPIR as well, please have a look at build logs here:
> > > > https://groups.google.com/d/topic/sage-release/ngw_EiBaY0Q/discussion
> > > 
> > > Well, that's a single failure, [although] in `nuss_mul()`[too] (and on an Apple *of course<sup>TM</sup>*)... ;-)
> > > 
> > Hmmm, the reports on sage-release for 5.6.beta3 also point that there is a problem with zn_poly on top of MPIR 2.4.x [on OS X], and I don't know why but I have strong suspicion it could be in nuss_mul [as well].
> 
> I didn't mean to say it was MPIR's fault.  (I agree it's something with zn_poly['s tuning], perhaps in conjunction with a specific GCC version [and probably also the OS].  Note that the MacOSs most probably have GCC 4.6.3 [from our spkg] in common.]
> 
> 

> 
> > > One would probably have to run *the tuning* multiple times under heavy load to reproduce this; haven't at all looked at the code...
> > The problem is not during the tuning phase but during the quick test one.
> 
> Well, it shows up during the tests, but presumably the tuning generates invalid code (or code triggering a compiler bug) under certain circumstances, like perhaps heavy load.
> 
From what I see after a quick look, the tuning process only chooses thresholds, and does not generates code.
So maybe the code is genuinely buggy for certain random values, or there is a compiler bug (but from what we gathered I wouldn't say we always use the same GCC, bugs appear at least with FSF GCC 4.6.3 on different Os X and with Cywgin GCC 4.5.3 (maybe with later FSF GCC don't remember) on ... Cygwin) that generates code which fails on certain random values.

Or maybe under heavy load, the thresholds get chosen so that code is called on value ranges it is not meant for and boom (but only on Os X and Cygwin, if that was to be true on Linuces I guess we would have seen it before).



---

archive/issue_comments_156389.json:
```json
{
    "body": "Replying to [comment:100 jpflori]:\n> Or maybe under heavy load, the thresholds get chosen so that code is called on value ranges it is not meant for and boom (but only on Os X and Cygwin, if that was to be true on Linuces I guess we would have seen it before).\n\nI just did\n\n```sh\nfor ((r=1;r<=100;r=r+1)); do\n    tune/tune > src/tuning.c && make && test/test -quick nuss_mul || break\ndone\n```\n\non bsd.math, with an older version of Sage (but GCC 4.6.3) though, and also zn_poly-0.9.**p5** (not sure whether that matters...).\n\nSince \"unfortunately\" the sysload happened to be low, I started building Sage in parallel during the 50th run, but that didn't \"help\" either. 8-)\n\nI'll probably retry with the `.p9`...\n\nCeterum censeo we should open another ticket for the zn_poly issue.",
    "created_at": "2013-01-11T12:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156389",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:100 jpflori]:
> Or maybe under heavy load, the thresholds get chosen so that code is called on value ranges it is not meant for and boom (but only on Os X and Cygwin, if that was to be true on Linuces I guess we would have seen it before).

I just did

```sh
for ((r=1;r<=100;r=r+1)); do
    tune/tune > src/tuning.c && make && test/test -quick nuss_mul || break
done
```

on bsd.math, with an older version of Sage (but GCC 4.6.3) though, and also zn_poly-0.9.**p5** (not sure whether that matters...).

Since "unfortunately" the sysload happened to be low, I started building Sage in parallel during the 50th run, but that didn't "help" either. 8-)

I'll probably retry with the `.p9`...

Ceterum censeo we should open another ticket for the zn_poly issue.



---

archive/issue_comments_156390.json:
```json
{
    "body": "Replying to [comment:101 leif]:\n> I just did\n> {{{\n> #!sh\n> for ((r=1;r<=100;r=r+1)); do\n>     tune/tune > src/tuning.c && make && test/test -quick nuss_mul || break\n> done\n> }}}\n> on bsd.math, with an older version of Sage (but GCC 4.6.3) though, and also zn_poly-0.9.**p5** (not sure whether that matters...).\n> \n> Since \"unfortunately\" the sysload happened to be low, I started building Sage in parallel during the 50th run, but that didn't \"help\" either. 8-)\n\nI retried with Sage 5.5 (which comes with zn_poly 0.9.p9), `.../test -quick all` and a higher sysload, but couldn't reproduce the test failure either.  (Perhaps bsd.math is still too fast...)",
    "created_at": "2013-01-11T15:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156390",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:101 leif]:
> I just did
> {{{
> #!sh
> for ((r=1;r<=100;r=r+1)); do
>     tune/tune > src/tuning.c && make && test/test -quick nuss_mul || break
> done
> }}}
> on bsd.math, with an older version of Sage (but GCC 4.6.3) though, and also zn_poly-0.9.**p5** (not sure whether that matters...).
> 
> Since "unfortunately" the sysload happened to be low, I started building Sage in parallel during the 50th run, but that didn't "help" either. 8-)

I retried with Sage 5.5 (which comes with zn_poly 0.9.p9), `.../test -quick all` and a higher sysload, but couldn't reproduce the test failure either.  (Perhaps bsd.math is still too fast...)



---

archive/issue_comments_156391.json:
```json
{
    "body": "Updated spkg fixing the offset of configure.patch.\n\nFrom my point of view the last thing to fix in this ticket is the xmlto one.\n\nI'd prefer to postpone the clang one to another ticket and the zn_poly as well.",
    "created_at": "2013-01-11T15:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156391",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Updated spkg fixing the offset of configure.patch.

From my point of view the last thing to fix in this ticket is the xmlto one.

I'd prefer to postpone the clang one to another ticket and the zn_poly as well.



---

archive/issue_comments_156392.json:
```json
{
    "body": "Attachment [mpir-2.6.0.p0.diff](tarball://root/attachments/some-uuid/ticket13137/mpir-2.6.0.p0.diff) by jpflori created at 2013-01-11 15:44:04\n\nSpkg diff, for review only.",
    "created_at": "2013-01-11T15:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156392",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [mpir-2.6.0.p0.diff](tarball://root/attachments/some-uuid/ticket13137/mpir-2.6.0.p0.diff) by jpflori created at 2013-01-11 15:44:04

Spkg diff, for review only.



---

archive/issue_comments_156393.json:
```json
{
    "body": "About xmlto, I cannot reproduce the problem on my Ubuntu 12.04.1 x86_64.\nI did not have installed before, what was correctly detected, so I just installed it and it is detected by configure but it does not get used when I just issue make in a fresh MPIR dir or through Sage's spkg mecanism.",
    "created_at": "2013-01-11T15:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156393",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

About xmlto, I cannot reproduce the problem on my Ubuntu 12.04.1 x86_64.
I did not have installed before, what was correctly detected, so I just installed it and it is detected by configure but it does not get used when I just issue make in a fresh MPIR dir or through Sage's spkg mecanism.



---

archive/issue_comments_156394.json:
```json
{
    "body": "I spoke too fast, it gets used when installing with Sage's spkg mechanism and just works, but not in a plain upstream dir...",
    "created_at": "2013-01-11T15:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156394",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I spoke too fast, it gets used when installing with Sage's spkg mechanism and just works, but not in a plain upstream dir...



---

archive/issue_comments_156395.json:
```json
{
    "body": "That must be some timestamp autotools magic because we patch some autotools file...",
    "created_at": "2013-01-11T16:01:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156395",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

That must be some timestamp autotools magic because we patch some autotools file...



---

archive/issue_comments_156396.json:
```json
{
    "body": "Or not, patching upstream with our patches and then configuring and building does not trigger the use of xmlto (although it is detected).",
    "created_at": "2013-01-11T16:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156396",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Or not, patching upstream with our patches and then configuring and building does not trigger the use of xmlto (although it is detected).



---

archive/issue_comments_156397.json:
```json
{
    "body": "Ok, my bad, I must have changed some timestamp while tarring untarring stuff whence the rebuild of the man pages with the spkg (and not with upstream correctly untarred).\nCorrected spkg coming soon.",
    "created_at": "2013-01-11T16:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156397",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Ok, my bad, I must have changed some timestamp while tarring untarring stuff whence the rebuild of the man pages with the spkg (and not with upstream correctly untarred).
Corrected spkg coming soon.



---

archive/issue_comments_156398.json:
```json
{
    "body": "The just uploaded spkg should avoid using xmlto even if it's installed (and broken :)).",
    "created_at": "2013-01-11T16:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156398",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The just uploaded spkg should avoid using xmlto even if it's installed (and broken :)).



---

archive/issue_comments_156399.json:
```json
{
    "body": "With the old versions of the spkgs (the ones included in 5.6.beta3), on an OS X 10.8.2 machine: in one window, I can load the system by running `./sage -tp devel/sage/sage`. Then in another window, I can build zn_poly, or test it by running `./test nuss_mul` from `spkg/build/zn_poly-0.9.p9/src/test/`.\n\n- if the system is loaded *when zn_poly is built* (using `./sage -f -s spkg/standard/zn_poly-0.9.p9`), then the test fails frequently. It doesn't matter whether the system is loaded while running the test, only if it was loaded while installing the spkg.\n\n- on the other hand, if the system is not loaded when installing the spkg, the test seems to pass consistently (regardless of the load while the test is being run).\n\nI haven't tried this with any new versions of the spkgs.",
    "created_at": "2013-01-11T19:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156399",
    "user": "https://github.com/jhpalmieri"
}
```

With the old versions of the spkgs (the ones included in 5.6.beta3), on an OS X 10.8.2 machine: in one window, I can load the system by running `./sage -tp devel/sage/sage`. Then in another window, I can build zn_poly, or test it by running `./test nuss_mul` from `spkg/build/zn_poly-0.9.p9/src/test/`.

- if the system is loaded *when zn_poly is built* (using `./sage -f -s spkg/standard/zn_poly-0.9.p9`), then the test fails frequently. It doesn't matter whether the system is loaded while running the test, only if it was loaded while installing the spkg.

- on the other hand, if the system is not loaded when installing the spkg, the test seems to pass consistently (regardless of the load while the test is being run).

I haven't tried this with any new versions of the spkgs.



---

archive/issue_comments_156400.json:
```json
{
    "body": "John, could you please save the tuning parameters (`.../zn_poly-0.9.p9/src/src/tuning.c`) from [a] failing test[s]?",
    "created_at": "2013-01-11T19:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156400",
    "user": "https://github.com/nexttime"
}
```

John, could you please save the tuning parameters (`.../zn_poly-0.9.p9/src/src/tuning.c`) from [a] failing test[s]?



---

archive/issue_comments_156401.json:
```json
{
    "body": "Replying to [comment:111 leif]:\n> John, could you please save the tuning parameters (`.../zn_poly-0.9.p9/src/src/tuning.c`) from [a] failing test[s]?\n\nI saved it. Did you want me to do anything with it?  ;)\n\n- from a passing test (built on a lightly loaded system): [http://sage.math.washington.edu/home/palmieri/misc/tuning.c-PASSED](http://sage.math.washington.edu/home/palmieri/misc/tuning.c-PASSED)\n- from a failing test (heavily loaded): [http://sage.math.washington.edu/home/palmieri/misc/tuning.c-FAILED](http://sage.math.washington.edu/home/palmieri/misc/tuning.c-FAILED)\n- the difference: [http://sage.math.washington.edu/home/palmieri/misc/tuning.c.diff](http://sage.math.washington.edu/home/palmieri/misc/tuning.c.diff)",
    "created_at": "2013-01-11T20:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156401",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:111 leif]:
> John, could you please save the tuning parameters (`.../zn_poly-0.9.p9/src/src/tuning.c`) from [a] failing test[s]?

I saved it. Did you want me to do anything with it?  ;)

- from a passing test (built on a lightly loaded system): [http://sage.math.washington.edu/home/palmieri/misc/tuning.c-PASSED](http://sage.math.washington.edu/home/palmieri/misc/tuning.c-PASSED)
- from a failing test (heavily loaded): [http://sage.math.washington.edu/home/palmieri/misc/tuning.c-FAILED](http://sage.math.washington.edu/home/palmieri/misc/tuning.c-FAILED)
- the difference: [http://sage.math.washington.edu/home/palmieri/misc/tuning.c.diff](http://sage.math.washington.edu/home/palmieri/misc/tuning.c.diff)



---

archive/issue_comments_156402.json:
```json
{
    "body": "I opened #13947 for the zn_poly issue, I suggest we continue to investigate the issue there.\n\nSame at #13948 for the clang issue.",
    "created_at": "2013-01-11T22:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156402",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I opened #13947 for the zn_poly issue, I suggest we continue to investigate the issue there.

Same at #13948 for the clang issue.



---

archive/issue_comments_156403.json:
```json
{
    "body": "Jean-Pierre, do you intend to make any further changes to the spkg here?  (Or, is there anything left which has to be done here, as of now?)",
    "created_at": "2013-01-12T08:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156403",
    "user": "https://github.com/nexttime"
}
```

Jean-Pierre, do you intend to make any further changes to the spkg here?  (Or, is there anything left which has to be done here, as of now?)



---

archive/issue_comments_156404.json:
```json
{
    "body": "I don't see anything to change now, but I may have missed something.",
    "created_at": "2013-01-12T10:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156404",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I don't see anything to change now, but I may have missed something.



---

archive/issue_comments_156405.json:
```json
{
    "body": "Replying to [comment:115 jpflori]:\n> I don't see anything to change now, but I may have missed something.\n\nI'll repeat some tests with the \"final\" spkg (although I can't on Cygwin), do some checks, then I'll give it positive review I think.",
    "created_at": "2013-01-12T10:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156405",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:115 jpflori]:
> I don't see anything to change now, but I may have missed something.

I'll repeat some tests with the "final" spkg (although I can't on Cygwin), do some checks, then I'll give it positive review I think.



---

archive/issue_comments_156406.json:
```json
{
    "body": "A few (IMHO minor) things:\n\n```diff\n\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -19,7 +19,7 @@\n # detecting filename changes. See Trac #13137.\n # This fix can (and will have to) be removed once integrated upstream.\n echo \"Renaming *,asm files to *.asm...\"\n-mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm\n+mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm &&\n mv mpn/x86/p6/submul_1,asm mpn/x86/p6/submul_1.asm\n if [ $? -ne 0 ]; then\n     echo >&2 \"Error: moving *,asm files failed.\"\n@@ -202,15 +202,15 @@\n     echo \"Building a reduced version of MPIR to bootstrap GCC.\"\n     echo \"MPIR will later get rebuilt (with the C++ interface and static libraries\"\n     echo \"enabled) using the new compiler.\"\n-    MPIR_CONFIGURE=\"--disable-cxx --disable-static $MPIR_CONFIGURE\"\n+    MPIR_CONFIGURE=\"$MPIR_CONFIGURE --disable-cxx --disable-static\"\n     SAGE_FAT_BINARY=no\n else\n     # Also build the static library to be used by e.g. ECM\n     # unless we are on Cygwin where we can only build a shared\n-    # or a static library but not both\n+    # or a static library but not both:\n     if [ \"$UNAME\" = \"CYGWIN\" ]; then\n-        echo \"Building MPIR with the C++ interface.\"\n-        MPIR_CONFIGURE=\"--enable-cxx --disable-static $MPIR_CONFIGURE\"\n+        echo \"Building MPIR with the C++ interface and (only) shared libraries.\"\n+        MPIR_CONFIGURE=\"--enable-cxx $MPIR_CONFIGURE --disable-static\"\n     else\n         echo \"Building MPIR with the C++ interface and (also) static libraries.\"\n         MPIR_CONFIGURE=\"--enable-cxx --enable-static $MPIR_CONFIGURE\"\n```\n\n\n* The date of the changelog entry. ;-)\n\n* The current treatment of `clang` in `spkg-install` (as mentioned earlier), but we can postpone changes to that to #13948 (although pretty unrelated, as it is only necessary to slightly patch `acinclude.m4` and `configure`).",
    "created_at": "2013-01-12T13:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156406",
    "user": "https://github.com/nexttime"
}
```

A few (IMHO minor) things:

```diff

diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -19,7 +19,7 @@
 # detecting filename changes. See Trac #13137.
 # This fix can (and will have to) be removed once integrated upstream.
 echo "Renaming *,asm files to *.asm..."
-mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm
+mv mpn/x86/p6/addmul_1,asm mpn/x86/p6/addmul_1.asm &&
 mv mpn/x86/p6/submul_1,asm mpn/x86/p6/submul_1.asm
 if [ $? -ne 0 ]; then
     echo >&2 "Error: moving *,asm files failed."
@@ -202,15 +202,15 @@
     echo "Building a reduced version of MPIR to bootstrap GCC."
     echo "MPIR will later get rebuilt (with the C++ interface and static libraries"
     echo "enabled) using the new compiler."
-    MPIR_CONFIGURE="--disable-cxx --disable-static $MPIR_CONFIGURE"
+    MPIR_CONFIGURE="$MPIR_CONFIGURE --disable-cxx --disable-static"
     SAGE_FAT_BINARY=no
 else
     # Also build the static library to be used by e.g. ECM
     # unless we are on Cygwin where we can only build a shared
-    # or a static library but not both
+    # or a static library but not both:
     if [ "$UNAME" = "CYGWIN" ]; then
-        echo "Building MPIR with the C++ interface."
-        MPIR_CONFIGURE="--enable-cxx --disable-static $MPIR_CONFIGURE"
+        echo "Building MPIR with the C++ interface and (only) shared libraries."
+        MPIR_CONFIGURE="--enable-cxx $MPIR_CONFIGURE --disable-static"
     else
         echo "Building MPIR with the C++ interface and (also) static libraries."
         MPIR_CONFIGURE="--enable-cxx --enable-static $MPIR_CONFIGURE"
```


* The date of the changelog entry. ;-)

* The current treatment of `clang` in `spkg-install` (as mentioned earlier), but we can postpone changes to that to #13948 (although pretty unrelated, as it is only necessary to slightly patch `acinclude.m4` and `configure`).



---

archive/issue_comments_156407.json:
```json
{
    "body": "P.S.:  The spkg is otherwise clean. :-)",
    "created_at": "2013-01-12T13:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156407",
    "user": "https://github.com/nexttime"
}
```

P.S.:  The spkg is otherwise clean. :-)



---

archive/issue_comments_156408.json:
```json
{
    "body": "For completeness:\n\n```diff\n\ndiff --git a/SPKG.txt b/SPKG.txt\n--- a/SPKG.txt\n+++ b/SPKG.txt\n@@ -50,11 +50,11 @@\n \n == Changelog ==\n \n-=== mpir-2.6.0.p0 (Jean-Pierre Flori, 25 November 2012) ===\n+=== mpir-2.6.0.p0 (Jean-Pierre Flori, 12 January 2013) ===\n  * Trac #13137: Update to MPIR 2.6.0.\n  * Modify spkg-install to rename *,asm files to *.asm files.\n  * Remove -Wl,-z,noexecstack fix which has been integrated upstream.\n- * Remove old code about 32 bits Apple Darwin and use upstream fix.\n+ * Remove old code about 32 bits Apple Darwin and use slightly modified upstream fix.\n \n === mpir-2.5.2.p0 (John Palmieri, 3 October 2012) ===\n  * Trac #13137: Update to MPIR 2.5.2.\n```\n\n\nAn updated spkg with the above changes (to `spkg-install` and `SPKG.txt`) is [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.6.0.p0.spkg), md5sum `ec21b55dce699d3c8ddf0492e1413107`.",
    "created_at": "2013-01-12T14:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156408",
    "user": "https://github.com/nexttime"
}
```

For completeness:

```diff

diff --git a/SPKG.txt b/SPKG.txt
--- a/SPKG.txt
+++ b/SPKG.txt
@@ -50,11 +50,11 @@
 
 == Changelog ==
 
-=== mpir-2.6.0.p0 (Jean-Pierre Flori, 25 November 2012) ===
+=== mpir-2.6.0.p0 (Jean-Pierre Flori, 12 January 2013) ===
  * Trac #13137: Update to MPIR 2.6.0.
  * Modify spkg-install to rename *,asm files to *.asm files.
  * Remove -Wl,-z,noexecstack fix which has been integrated upstream.
- * Remove old code about 32 bits Apple Darwin and use upstream fix.
+ * Remove old code about 32 bits Apple Darwin and use slightly modified upstream fix.
 
 === mpir-2.5.2.p0 (John Palmieri, 3 October 2012) ===
  * Trac #13137: Update to MPIR 2.5.2.
```


An updated spkg with the above changes (to `spkg-install` and `SPKG.txt`) is [here](http://boxen.math.washington.edu/home/leif/Sage/spkgs/mpir-2.6.0.p0.spkg), md5sum `ec21b55dce699d3c8ddf0492e1413107`.



---

archive/issue_comments_156409.json:
```json
{
    "body": "I've put the link to the spkg with my minor corrections into the description.",
    "created_at": "2013-01-13T16:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156409",
    "user": "https://github.com/nexttime"
}
```

I've put the link to the spkg with my minor corrections into the description.



---

archive/issue_comments_156410.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-13T16:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156410",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_156411.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-21T21:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12965#issuecomment-156411",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_012906.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2013-01-21T21:07:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12965",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12965#event-12906"
}
```
