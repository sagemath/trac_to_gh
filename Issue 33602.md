# Issue 33602: Edge connectivity of digraphs

Issue created by migration from https://trac.sagemath.org/ticket/33839

Original creator: dcoudert

Original creation time: 2022-05-11 13:53:18

CC:  @kliem @davewittemorris tscrim @enjeck

As announced in [32169#comment:40](https://trac.sagemath.org/ticket/32169#comment:40), thanks to the help of Loukas Georgiadis [1] for providing an experimental C code, we implement in Cython the algorithm proposed by Gabow [2] for computing the edge connectivity of directed graphs.

----
[1] Loukas Georgiadis, Dionysios Kefallinos, Luigi Laura, Nikos Parotsidis: An Experimental Study of Algorithms for Computing the Edge Connectivity of a Directed Graph. SIAM Symposium on Algorithm Engineering and Experiments (ALENEX), pp 85-97, 2021.

[2] Harold N. Gabow: A Matroid Approach to Finding Edge Connectivity and Packing Arborescences. Journal of Computer and System Sciences, 50(2):259-273 (1995)



---

Comment by dcoudert created at 2022-05-11 14:38:04

Changing status from new to needs_review.


---

Comment by dcoudert created at 2022-05-11 14:38:04

Suggestions for adding more tests and documentation are more than welcome.

The code is quite fast

```
sage: D = digraphs.Complete(10)
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 388 µs, sys: 18 µs, total: 406 µs
Wall time: 412 µs
9
sage: D = digraphs.Complete(100)
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 35.6 ms, sys: 1.23 ms, total: 36.8 ms
Wall time: 36.3 ms
99
sage: from sage.graphs.edge_connectivity import GabowEdgeConnectivity
sage: D = DiGraph(graphs.RandomRegular(6, 10000))
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 227 ms, sys: 6.94 ms, total: 234 ms
Wall time: 234 ms
6
sage: D = DiGraph(graphs.RandomRegular(30, 10000))
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 3.42 s, sys: 44.2 ms, total: 3.47 s
Wall time: 3.49 s
30
```

----
New commits:


---

Comment by @kliem created at 2022-05-12 07:41:31

A few comments for now.

- You introduced a leading space here:


```diff
+ .. [BHS2008] Robert Bradshaw, David Harvey and William
              Stein. strassen_window_multiply_c. strassen.pyx, Sage
              3.0, 2008. http://www.sagemath.org
```


- What is happening here? Is this for a follow up ticket?


```diff
+        sage: GabowEdgeConnectivity(D).edge_disjoint_spanning_trees()
+        Traceback (most recent call last):
+        ...
+        NotImplementedError: this method has not been implemented yet
...
+        sage: GabowEdgeConnectivity(D).edge_connectivity()
+        Traceback (most recent call last):
+        ...
+        ValueError: This method is not known to work on graphs with multiedges. ...
```


- To avoid segmentation faults in case one calls `GabowEdgeConnectivity`

- You can call `MemoryAllocator.calloc`, to skip the following lines:

```diff
+        for i in range(self.max_ec):
+            self.labeled[i] = NULL
+            self.parent_1[i] = NULL
+            self.parent_2[i] = NULL
+            self.parent_edge_id_1[i] = NULL
+            self.parent_edge_id_2[i] = NULL
+            self.depth_1[i] = NULL
+            self.depth_2[i] = NULL
```


- You are raising some errors in methods without exception value, e.g.
  `raise ValueError("did not find the right edge")` in `cdef int fundamental_cycle_step(self, int e_id, int tree)`. This should instead be declared as

```
cdef int fundamental_cycle_step(self, int e_id, int tree) except -1:
```

  (maybe the return value should be explained in the documenation)
  
  Then dependendent methods should get exception values as well.

- The code lacks interrupts. Could you add them with `sig_check` maybe? The nice thing is that `compute_edge_connectivity` is called during `__init__`, so in case of interruption the initialization gets interrupted and we don't have to worry about an inconsistent object, right?
- To my knowledge the following code is redundant:

```diff
+        for i in range(self.n):
+            self.g_out[i].clear()
+            self.g_in[i].clear()
```

  See https://en.cppreference.com/w/cpp/container/vector/resize.
  The objects inserted by `resize` are defaults and the default for `vector[int]` is just the empty vector.


---

Comment by git created at 2022-05-12 12:19:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-05-12 12:31:18

1. Method  `edge_disjoint_spanning_trees()` is for a follow up ticket (I hope with a GSoC student)
1. I have changed `allocarray` to `calloc`
1. I'm reluctant to remove `self.g_out[i].clear()`. I agree with you with the specification of the `resize` method, but I already had some issues in a C++ code. If you really think it's safe, I can do the change
1. I tried to add some checked for signals and errors.
  - I think that the `raise ValueError(..)` statements in `fundamental_cycle_step` should never be called unless there is a bug in the code.
  - I added an extra binary variable to ensure that the edge connectivity has effectively been computed. I'm not sure this is needed with all the `sig_check`.

Thank you for this first round of comments.


---

Comment by git created at 2022-07-06 14:04:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-07-08 06:32:35

Jonathan, any additional comments? I am prepared to set this to a positive review.


---

Comment by @kliem created at 2022-07-13 17:23:44

Go ahead. But looks like it needs a rebase for now.


---

Comment by git created at 2022-07-13 17:43:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-07-13 17:45:08

I fixed the merge conflict.


---

Comment by tscrim created at 2022-07-13 23:57:30

Thanks. LGTM.


---

Comment by tscrim created at 2022-07-13 23:57:30

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2022-07-14 06:44:27

Thank you for the review !


---

Comment by dcoudert created at 2022-07-20 11:59:02

I checked that the errors reported by the patchbot are independent from this ticket, and I have reported them to #32544.


---

Comment by vbraun created at 2022-07-21 21:12:09

Resolution: fixed
