# Issue 33602: Edge connectivity of digraphs

archive/issues_033602.json:
```json
{
    "body": "CC:  @kliem @davewittemorris @tscrim @enjeck\n\nAs announced in [32169#comment:40](https://trac.sagemath.org/ticket/32169#comment:40), thanks to the help of Loukas Georgiadis [1] for providing an experimental C code, we implement in Cython the algorithm proposed by Gabow [2] for computing the edge connectivity of directed graphs.\n\n---\n[1] Loukas Georgiadis, Dionysios Kefallinos, Luigi Laura, Nikos Parotsidis: An Experimental Study of Algorithms for Computing the Edge Connectivity of a Directed Graph. SIAM Symposium on Algorithm Engineering and Experiments (ALENEX), pp 85-97, 2021.\n\n[2] Harold N. Gabow: A Matroid Approach to Finding Edge Connectivity and Packing Arborescences. Journal of Computer and System Sciences, 50(2):259-273 (1995)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33839\n\n",
    "created_at": "2022-05-11T13:53:18Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Edge connectivity of digraphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33602",
    "user": "https://github.com/dcoudert"
}
```
CC:  @kliem @davewittemorris @tscrim @enjeck

As announced in [32169#comment:40](https://trac.sagemath.org/ticket/32169#comment:40), thanks to the help of Loukas Georgiadis [1] for providing an experimental C code, we implement in Cython the algorithm proposed by Gabow [2] for computing the edge connectivity of directed graphs.

---
[1] Loukas Georgiadis, Dionysios Kefallinos, Luigi Laura, Nikos Parotsidis: An Experimental Study of Algorithms for Computing the Edge Connectivity of a Directed Graph. SIAM Symposium on Algorithm Engineering and Experiments (ALENEX), pp 85-97, 2021.

[2] Harold N. Gabow: A Matroid Approach to Finding Edge Connectivity and Packing Arborescences. Journal of Computer and System Sciences, 50(2):259-273 (1995)


Issue created by migration from https://trac.sagemath.org/ticket/33839





---

archive/issue_comments_477696.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-11T14:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477696",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477697.json:
```json
{
    "body": "Suggestions for adding more tests and documentation are more than welcome.\n\nThe code is quite fast\n\n```\nsage: D = digraphs.Complete(10)\nsage: %time GabowEdgeConnectivity(D).edge_connectivity()\nCPU times: user 388 \u00b5s, sys: 18 \u00b5s, total: 406 \u00b5s\nWall time: 412 \u00b5s\n9\nsage: D = digraphs.Complete(100)\nsage: %time GabowEdgeConnectivity(D).edge_connectivity()\nCPU times: user 35.6 ms, sys: 1.23 ms, total: 36.8 ms\nWall time: 36.3 ms\n99\nsage: from sage.graphs.edge_connectivity import GabowEdgeConnectivity\nsage: D = DiGraph(graphs.RandomRegular(6, 10000))\nsage: %time GabowEdgeConnectivity(D).edge_connectivity()\nCPU times: user 227 ms, sys: 6.94 ms, total: 234 ms\nWall time: 234 ms\n6\nsage: D = DiGraph(graphs.RandomRegular(30, 10000))\nsage: %time GabowEdgeConnectivity(D).edge_connectivity()\nCPU times: user 3.42 s, sys: 44.2 ms, total: 3.47 s\nWall time: 3.49 s\n30\n```\n\n---\nNew commits:",
    "created_at": "2022-05-11T14:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477697",
    "user": "https://github.com/dcoudert"
}
```

Suggestions for adding more tests and documentation are more than welcome.

The code is quite fast

```
sage: D = digraphs.Complete(10)
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 388 µs, sys: 18 µs, total: 406 µs
Wall time: 412 µs
9
sage: D = digraphs.Complete(100)
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 35.6 ms, sys: 1.23 ms, total: 36.8 ms
Wall time: 36.3 ms
99
sage: from sage.graphs.edge_connectivity import GabowEdgeConnectivity
sage: D = DiGraph(graphs.RandomRegular(6, 10000))
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 227 ms, sys: 6.94 ms, total: 234 ms
Wall time: 234 ms
6
sage: D = DiGraph(graphs.RandomRegular(30, 10000))
sage: %time GabowEdgeConnectivity(D).edge_connectivity()
CPU times: user 3.42 s, sys: 44.2 ms, total: 3.47 s
Wall time: 3.49 s
30
```

---
New commits:



---

archive/issue_comments_477698.json:
```json
{
    "body": "A few comments for now.\n\n- You introduced a leading space here:\n\n```diff\n+ .. [BHS2008] Robert Bradshaw, David Harvey and William\n              Stein. strassen_window_multiply_c. strassen.pyx, Sage\n              3.0, 2008. http://www.sagemath.org\n```\n\n- What is happening here? Is this for a follow up ticket?\n\n```diff\n+        sage: GabowEdgeConnectivity(D).edge_disjoint_spanning_trees()\n+        Traceback (most recent call last):\n+        ...\n+        NotImplementedError: this method has not been implemented yet\n...\n+        sage: GabowEdgeConnectivity(D).edge_connectivity()\n+        Traceback (most recent call last):\n+        ...\n+        ValueError: This method is not known to work on graphs with multiedges. ...\n```\n\n- To avoid segmentation faults in case one calls `GabowEdgeConnectivity`\n\n- You can call `MemoryAllocator.calloc`, to skip the following lines:\n\n```diff\n+        for i in range(self.max_ec):\n+            self.labeled[i] = NULL\n+            self.parent_1[i] = NULL\n+            self.parent_2[i] = NULL\n+            self.parent_edge_id_1[i] = NULL\n+            self.parent_edge_id_2[i] = NULL\n+            self.depth_1[i] = NULL\n+            self.depth_2[i] = NULL\n```\n\n- You are raising some errors in methods without exception value, e.g.\n  `raise ValueError(\"did not find the right edge\")` in `cdef int fundamental_cycle_step(self, int e_id, int tree)`. This should instead be declared as\n\n```\ncdef int fundamental_cycle_step(self, int e_id, int tree) except -1:\n```\n  (maybe the return value should be explained in the documenation)\n  \n  Then dependendent methods should get exception values as well.\n\n- The code lacks interrupts. Could you add them with `sig_check` maybe? The nice thing is that `compute_edge_connectivity` is called during `__init__`, so in case of interruption the initialization gets interrupted and we don't have to worry about an inconsistent object, right?\n- To my knowledge the following code is redundant:\n\n```diff\n+        for i in range(self.n):\n+            self.g_out[i].clear()\n+            self.g_in[i].clear()\n```\n  See https://en.cppreference.com/w/cpp/container/vector/resize.\n  The objects inserted by `resize` are defaults and the default for `vector[int]` is just the empty vector.",
    "created_at": "2022-05-12T07:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477698",
    "user": "https://github.com/kliem"
}
```

A few comments for now.

- You introduced a leading space here:

```diff
+ .. [BHS2008] Robert Bradshaw, David Harvey and William
              Stein. strassen_window_multiply_c. strassen.pyx, Sage
              3.0, 2008. http://www.sagemath.org
```

- What is happening here? Is this for a follow up ticket?

```diff
+        sage: GabowEdgeConnectivity(D).edge_disjoint_spanning_trees()
+        Traceback (most recent call last):
+        ...
+        NotImplementedError: this method has not been implemented yet
...
+        sage: GabowEdgeConnectivity(D).edge_connectivity()
+        Traceback (most recent call last):
+        ...
+        ValueError: This method is not known to work on graphs with multiedges. ...
```

- To avoid segmentation faults in case one calls `GabowEdgeConnectivity`

- You can call `MemoryAllocator.calloc`, to skip the following lines:

```diff
+        for i in range(self.max_ec):
+            self.labeled[i] = NULL
+            self.parent_1[i] = NULL
+            self.parent_2[i] = NULL
+            self.parent_edge_id_1[i] = NULL
+            self.parent_edge_id_2[i] = NULL
+            self.depth_1[i] = NULL
+            self.depth_2[i] = NULL
```

- You are raising some errors in methods without exception value, e.g.
  `raise ValueError("did not find the right edge")` in `cdef int fundamental_cycle_step(self, int e_id, int tree)`. This should instead be declared as

```
cdef int fundamental_cycle_step(self, int e_id, int tree) except -1:
```
  (maybe the return value should be explained in the documenation)
  
  Then dependendent methods should get exception values as well.

- The code lacks interrupts. Could you add them with `sig_check` maybe? The nice thing is that `compute_edge_connectivity` is called during `__init__`, so in case of interruption the initialization gets interrupted and we don't have to worry about an inconsistent object, right?
- To my knowledge the following code is redundant:

```diff
+        for i in range(self.n):
+            self.g_out[i].clear()
+            self.g_in[i].clear()
```
  See https://en.cppreference.com/w/cpp/container/vector/resize.
  The objects inserted by `resize` are defaults and the default for `vector[int]` is just the empty vector.



---

archive/issue_comments_477699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-12T12:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477700.json:
```json
{
    "body": "1. Method  `edge_disjoint_spanning_trees()` is for a follow up ticket (I hope with a GSoC student)\n2. I have changed `allocarray` to `calloc`\n3. I'm reluctant to remove `self.g_out[i].clear()`. I agree with you with the specification of the `resize` method, but I already had some issues in a C++ code. If you really think it's safe, I can do the change\n4. I tried to add some checked for signals and errors.\n   - I think that the `raise ValueError(..)` statements in `fundamental_cycle_step` should never be called unless there is a bug in the code.\n   - I added an extra binary variable to ensure that the edge connectivity has effectively been computed. I'm not sure this is needed with all the `sig_check`.\n\nThank you for this first round of comments.",
    "created_at": "2022-05-12T12:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477700",
    "user": "https://github.com/dcoudert"
}
```

1. Method  `edge_disjoint_spanning_trees()` is for a follow up ticket (I hope with a GSoC student)
2. I have changed `allocarray` to `calloc`
3. I'm reluctant to remove `self.g_out[i].clear()`. I agree with you with the specification of the `resize` method, but I already had some issues in a C++ code. If you really think it's safe, I can do the change
4. I tried to add some checked for signals and errors.
   - I think that the `raise ValueError(..)` statements in `fundamental_cycle_step` should never be called unless there is a bug in the code.
   - I added an extra binary variable to ensure that the edge connectivity has effectively been computed. I'm not sure this is needed with all the `sig_check`.

Thank you for this first round of comments.



---

archive/issue_comments_477701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-06T14:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477702.json:
```json
{
    "body": "Jonathan, any additional comments? I am prepared to set this to a positive review.",
    "created_at": "2022-07-08T06:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477702",
    "user": "https://github.com/tscrim"
}
```

Jonathan, any additional comments? I am prepared to set this to a positive review.



---

archive/issue_comments_477703.json:
```json
{
    "body": "Go ahead. But looks like it needs a rebase for now.",
    "created_at": "2022-07-13T17:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477703",
    "user": "https://github.com/kliem"
}
```

Go ahead. But looks like it needs a rebase for now.



---

archive/issue_comments_477704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-07-13T17:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477705.json:
```json
{
    "body": "I fixed the merge conflict.",
    "created_at": "2022-07-13T17:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477705",
    "user": "https://github.com/dcoudert"
}
```

I fixed the merge conflict.



---

archive/issue_comments_477706.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2022-07-13T23:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477706",
    "user": "https://github.com/tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_477707.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-13T23:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477707",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477708.json:
```json
{
    "body": "Thank you for the review !",
    "created_at": "2022-07-14T06:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477708",
    "user": "https://github.com/dcoudert"
}
```

Thank you for the review !



---

archive/issue_comments_477709.json:
```json
{
    "body": "I checked that the errors reported by the patchbot are independent from this ticket, and I have reported them to #32544.",
    "created_at": "2022-07-20T11:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477709",
    "user": "https://github.com/dcoudert"
}
```

I checked that the errors reported by the patchbot are independent from this ticket, and I have reported them to #32544.



---

archive/issue_comments_477710.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-21T21:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33602#issuecomment-477710",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_088828.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-21T21:12:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33602",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33602#event-88828"
}
```
