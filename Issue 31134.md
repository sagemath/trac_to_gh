# Issue 31134: product of manifolds

archive/issues_031134.json:
```json
{
    "body": "CC:  @mjungmath @egourgoulhon @tscrim @tobiasdiez\n\nTaking the cartesian product of differentiable manifolds treats them as merely topological spaces.\n\n```\nsage: I = manifolds.OpenInterval(0, 1)                                                                                                                                            \nsage: I                                                                                                                                                                           \nReal interval (0, 1)\nsage: II = I.cartesian_product(I)                                                                                                                                                 \nsage: II.category()                                                                                                                                                               \nCategory of Cartesian products of connected topological spaces\n```\n\nThis can be improved.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31371\n\n",
    "created_at": "2021-02-10T03:05:16Z",
    "labels": [
        "manifolds",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "product of manifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31134",
    "user": "@mkoeppe"
}
```
CC:  @mjungmath @egourgoulhon @tscrim @tobiasdiez

Taking the cartesian product of differentiable manifolds treats them as merely topological spaces.

```
sage: I = manifolds.OpenInterval(0, 1)                                                                                                                                            
sage: I                                                                                                                                                                           
Real interval (0, 1)
sage: II = I.cartesian_product(I)                                                                                                                                                 
sage: II.category()                                                                                                                                                               
Category of Cartesian products of connected topological spaces
```

This can be improved.



Issue created by migration from https://trac.sagemath.org/ticket/31371





---

archive/issue_comments_444774.json:
```json
{
    "body": "See `Algebras` for an example of how to do this. I am leaving for today right now and can push this tomorrow if someone else doesn't do it before then.",
    "created_at": "2021-02-10T08:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444774",
    "user": "@tscrim"
}
```

See `Algebras` for an example of how to do this. I am leaving for today right now and can push this tomorrow if someone else doesn't do it before then.



---

archive/issue_comments_444775.json:
```json
{
    "body": "It's not just that the category needs adjusting; but actually we should add specific `cartesian_product` methods that take products of charts etc",
    "created_at": "2021-02-10T17:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444775",
    "user": "@mkoeppe"
}
```

It's not just that the category needs adjusting; but actually we should add specific `cartesian_product` methods that take products of charts etc



---

archive/issue_comments_444776.json:
```json
{
    "body": "Replying to [comment:2 mkoeppe]:\n> It's not just that the category needs adjusting; but actually we should add specific `cartesian_product` methods that take products of charts etc\n\nIndeed, Cartesian products of manifolds are not implemented yet. The method `cartesian_product` inherited from the category framework works somehow:\n\n```\nsage: I = manifolds.OpenInterval(0, 1)                                                              \nsage: II = I.cartesian_product(I)                                                                   \nsage: II.an_element()                                                                               \n(Point on the Real interval (0, 1), Point on the Real interval (0, 1))\n```\n\nHowever the outcome is not a manifold:\n\n```\nsage: II.atlas()\n...\nAttributeError: 'CartesianProduct_with_category' object has no attribute 'atlas'\n```\n\nI guess the outcome shall belong to a subclass of a manifold class, keeping track of the fact it is a Cartesian product. What is the usage in Sage? For instance, we have\n\n```\nsage: V = QQ^2                                                                                      \nsage: V                                                                                             \nVector space of dimension 2 over Rational Field\nsage: VV = V.cartesian_product(V)                                                                   \nsage: VV                                                                                            \nThe Cartesian product of (Vector space of dimension 2 over Rational Field, \n Vector space of dimension 2 over Rational Field)\nsage: dim(V)                                                                                        \n2\nsage: dim(VV)                                                                                       \n...\nAttributeError: 'CartesianProduct_with_category' object has no attribute '_indices'\n```\n\nSo it seems that the Cartesian product of vector spaces is not considered as a vector space.",
    "created_at": "2021-02-10T20:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444776",
    "user": "@egourgoulhon"
}
```

Replying to [comment:2 mkoeppe]:
> It's not just that the category needs adjusting; but actually we should add specific `cartesian_product` methods that take products of charts etc

Indeed, Cartesian products of manifolds are not implemented yet. The method `cartesian_product` inherited from the category framework works somehow:

```
sage: I = manifolds.OpenInterval(0, 1)                                                              
sage: II = I.cartesian_product(I)                                                                   
sage: II.an_element()                                                                               
(Point on the Real interval (0, 1), Point on the Real interval (0, 1))
```

However the outcome is not a manifold:

```
sage: II.atlas()
...
AttributeError: 'CartesianProduct_with_category' object has no attribute 'atlas'
```

I guess the outcome shall belong to a subclass of a manifold class, keeping track of the fact it is a Cartesian product. What is the usage in Sage? For instance, we have

```
sage: V = QQ^2                                                                                      
sage: V                                                                                             
Vector space of dimension 2 over Rational Field
sage: VV = V.cartesian_product(V)                                                                   
sage: VV                                                                                            
The Cartesian product of (Vector space of dimension 2 over Rational Field, 
 Vector space of dimension 2 over Rational Field)
sage: dim(V)                                                                                        
2
sage: dim(VV)                                                                                       
...
AttributeError: 'CartesianProduct_with_category' object has no attribute '_indices'
```

So it seems that the Cartesian product of vector spaces is not considered as a vector space.



---

archive/issue_comments_444777.json:
```json
{
    "body": "That's right, also vector spaces are missing a specialization of this method. However, combinatorial free modules have an implementation:\n\n```\nsage: W = QQ^[1,2]                                                                                                                                                                 \nsage: W                                                                                                                                                                            \nFree module generated by {1, 2} over Rational Field\nsage: WW = W.cartesian_product(W)                                                                                                                                                  \nsage: WW                                                                                                                                                                           \nFree module generated by {1, 2} over Rational Field (+) Free module generated by {1, 2} over Rational Field\nsage: dim(WW)                                                                                                                                                                      \n4\n```\n",
    "created_at": "2021-02-10T22:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444777",
    "user": "@mkoeppe"
}
```

That's right, also vector spaces are missing a specialization of this method. However, combinatorial free modules have an implementation:

```
sage: W = QQ^[1,2]                                                                                                                                                                 
sage: W                                                                                                                                                                            
Free module generated by {1, 2} over Rational Field
sage: WW = W.cartesian_product(W)                                                                                                                                                  
sage: WW                                                                                                                                                                           
Free module generated by {1, 2} over Rational Field (+) Free module generated by {1, 2} over Rational Field
sage: dim(WW)                                                                                                                                                                      
4
```




---

archive/issue_comments_444778.json:
```json
{
    "body": "I know this is out of scope of this ticket, but I wanted to just say that for normal vector spaces, one way to do it would be to simply redirect to `direct_sum`.",
    "created_at": "2021-02-10T22:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444778",
    "user": "@tscrim"
}
```

I know this is out of scope of this ticket, but I wanted to just say that for normal vector spaces, one way to do it would be to simply redirect to `direct_sum`.



---

archive/issue_comments_444779.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444779",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_444780.json:
```json
{
    "body": "It's about time that product manifolds will be added to the inventory. Shouldn't be too hard, at least on the level of charts. Question is: do we want to implement a whole new class such as `CartesianProductManifold` that also has projection maps?",
    "created_at": "2021-02-14T17:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444780",
    "user": "@mjungmath"
}
```

It's about time that product manifolds will be added to the inventory. Shouldn't be too hard, at least on the level of charts. Question is: do we want to implement a whole new class such as `CartesianProductManifold` that also has projection maps?



---

archive/issue_comments_444781.json:
```json
{
    "body": "Yes, it should support the protocol of cartesian products of sets defined in `sage.categories.sets_cat`, including `cartesian_factors` and `cartesian_projection`",
    "created_at": "2021-02-14T17:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444781",
    "user": "@mkoeppe"
}
```

Yes, it should support the protocol of cartesian products of sets defined in `sage.categories.sets_cat`, including `cartesian_factors` and `cartesian_projection`



---

archive/issue_comments_444782.json:
```json
{
    "body": "Maybe it's a good idea to directly implement the more general case of a fibred product $M \\times_N M'$ for smooth maps $f, f': M \\to N$ (one of them being a submersion). The charts are a bit more complicated, but this more general situation occurs quite often.\n\n(Not sure if sage has an implementation of categorical pullbacks.)",
    "created_at": "2021-02-14T17:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444782",
    "user": "@tobiasdiez"
}
```

Maybe it's a good idea to directly implement the more general case of a fibred product $M \times_N M'$ for smooth maps $f, f': M \to N$ (one of them being a submersion). The charts are a bit more complicated, but this more general situation occurs quite often.

(Not sure if sage has an implementation of categorical pullbacks.)



---

archive/issue_comments_444783.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Yes, it should support the protocol of cartesian products of sets defined in `sage.categories.sets_cat`, including `cartesian_factors` and `cartesian_projection`\n\nThanks for the reference.\n\nReplying to [comment:9 gh-tobiasdiez]:\n> Maybe it's a good idea to directly implement the more general case of a fibred product $M \\times_N M'$ for smooth maps $f, f': M \\to N$ (one of them being a submersion). The charts are a bit more complicated, but this more general situation occurs quite often.\n\nSounds good.\n\nStill, one question remains: should our new manifold keep track of changes in the factors or not? The former could result in quite annoying code-writing.",
    "created_at": "2021-02-14T18:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444783",
    "user": "@mjungmath"
}
```

Replying to [comment:8 mkoeppe]:
> Yes, it should support the protocol of cartesian products of sets defined in `sage.categories.sets_cat`, including `cartesian_factors` and `cartesian_projection`

Thanks for the reference.

Replying to [comment:9 gh-tobiasdiez]:
> Maybe it's a good idea to directly implement the more general case of a fibred product $M \times_N M'$ for smooth maps $f, f': M \to N$ (one of them being a submersion). The charts are a bit more complicated, but this more general situation occurs quite often.

Sounds good.

Still, one question remains: should our new manifold keep track of changes in the factors or not? The former could result in quite annoying code-writing.



---

archive/issue_comments_444784.json:
```json
{
    "body": "Replying to [comment:10 gh-mjungmath]:\n> Still, one question remains: should our new manifold keep track of changes in the factors or not? The former could result in quite annoying code-writing.\n\nYou could consider making it an error if the user tries to take the product of mutable manifolds.",
    "created_at": "2021-02-14T22:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444784",
    "user": "@mkoeppe"
}
```

Replying to [comment:10 gh-mjungmath]:
> Still, one question remains: should our new manifold keep track of changes in the factors or not? The former could result in quite annoying code-writing.

You could consider making it an error if the user tries to take the product of mutable manifolds.



---

archive/issue_comments_444785.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> You could consider making it an error if the user tries to take the product of mutable manifolds. \n\nGood idea. We should make it possible to turn (mutable) manifolds into immutable objects anyway. But I assume that needs a refactoring of the current use of `UniqueRepresentation`.\n\nSimilarly for vector bundles (and their tensor products) btw.",
    "created_at": "2021-02-15T09:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444785",
    "user": "@mjungmath"
}
```

Replying to [comment:11 mkoeppe]:
> You could consider making it an error if the user tries to take the product of mutable manifolds. 

Good idea. We should make it possible to turn (mutable) manifolds into immutable objects anyway. But I assume that needs a refactoring of the current use of `UniqueRepresentation`.

Similarly for vector bundles (and their tensor products) btw.



---

archive/issue_comments_444786.json:
```json
{
    "body": "The immutability would likely require a fairly big refactoring of the manifolds code to have checks when performing \"mutations\" of the manifold, such as adding a chart, frame, transition map, etc.",
    "created_at": "2021-02-16T03:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444786",
    "user": "@tscrim"
}
```

The immutability would likely require a fairly big refactoring of the manifolds code to have checks when performing "mutations" of the manifold, such as adding a chart, frame, transition map, etc.



---

archive/issue_comments_444787.json:
```json
{
    "body": "Replying to [comment:13 tscrim]:\n> The immutability would likely require a fairly big refactoring of the manifolds code to have checks when performing \"mutations\" of the manifold, such as adding a chart, frame, transition map, etc.\n\nDoes it? At least for the latter, one could use the mutability wrappers or `_require_(im)mutable` method. That's fairly doable I'd say.\n\nAs for the `UniqueRepresentation` part, I honestly don't know. That might be effortful.",
    "created_at": "2021-02-16T10:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444787",
    "user": "@mjungmath"
}
```

Replying to [comment:13 tscrim]:
> The immutability would likely require a fairly big refactoring of the manifolds code to have checks when performing "mutations" of the manifold, such as adding a chart, frame, transition map, etc.

Does it? At least for the latter, one could use the mutability wrappers or `_require_(im)mutable` method. That's fairly doable I'd say.

As for the `UniqueRepresentation` part, I honestly don't know. That might be effortful.



---

archive/issue_comments_444788.json:
```json
{
    "body": "Replying to [comment:14 gh-mjungmath]:\n> \n> As for the `UniqueRepresentation` part, I honestly don't know. That might be effortful.\n\nYes it would be desirable to get rid of `UniqueRepresentation` for manifolds. If I am correct, `UniqueRepresentation` is used only to provide an effective pickling, which is mandatory for parallel computations.",
    "created_at": "2021-02-16T12:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444788",
    "user": "@egourgoulhon"
}
```

Replying to [comment:14 gh-mjungmath]:
> 
> As for the `UniqueRepresentation` part, I honestly don't know. That might be effortful.

Yes it would be desirable to get rid of `UniqueRepresentation` for manifolds. If I am correct, `UniqueRepresentation` is used only to provide an effective pickling, which is mandatory for parallel computations.



---

archive/issue_comments_444789.json:
```json
{
    "body": "Replying to [comment:15 egourgoulhon]:\n> Replying to [comment:14 gh-mjungmath]:\n> > \n> > As for the `UniqueRepresentation` part, I honestly don't know. That might be effortful.\n> \n> Yes it would be desirable to get rid of `UniqueRepresentation` for manifolds. If I am correct, `UniqueRepresentation` is used only to provide an effective pickling, which is mandatory for parallel computations. \n\nStill on my to-do list........\n\n`@`gh-mjungmath There are a lot of things that \"change\" the manifold. Thus, there would be a lot of methods that need to be altered to have immutability checks. There are also questions like, \"Does creating a new k-form change the manifold?\" In many ways, no, but it becomes tied to the manifold as it changes `_vector_field_modules` attribute. Plus it is something you would want to naturally lift up to the product manifold.",
    "created_at": "2021-02-16T23:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444789",
    "user": "@tscrim"
}
```

Replying to [comment:15 egourgoulhon]:
> Replying to [comment:14 gh-mjungmath]:
> > 
> > As for the `UniqueRepresentation` part, I honestly don't know. That might be effortful.
> 
> Yes it would be desirable to get rid of `UniqueRepresentation` for manifolds. If I am correct, `UniqueRepresentation` is used only to provide an effective pickling, which is mandatory for parallel computations. 

Still on my to-do list........

`@`gh-mjungmath There are a lot of things that "change" the manifold. Thus, there would be a lot of methods that need to be altered to have immutability checks. There are also questions like, "Does creating a new k-form change the manifold?" In many ways, no, but it becomes tied to the manifold as it changes `_vector_field_modules` attribute. Plus it is something you would want to naturally lift up to the product manifold.



---

archive/issue_comments_444790.json:
```json
{
    "body": "A general question about this ticket: to what extent do we want the outcome of `cartesian_product` keep track that it has been generated as a product? For instance, if\n\n```\nsage: S1 = manifolds.Sphere(1)                                                                      \nsage: T2 = S1.cartesian_product(S1)                                                                 \n```\n\ndo we want\n\n```\nsage: T2.an_element()                                                                               \n(Point on the 1-sphere S^1 of radius 1 smoothly embedded in the Euclidean plane E^2, \n Point on the 1-sphere S^1 of radius 1 smoothly embedded in the Euclidean plane E^2)\n```\n\nor something like\n\n```\nsage: T2.an_element()                                                                               \nPoint on S^1 x S^1\n```\n",
    "created_at": "2021-02-17T08:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444790",
    "user": "@egourgoulhon"
}
```

A general question about this ticket: to what extent do we want the outcome of `cartesian_product` keep track that it has been generated as a product? For instance, if

```
sage: S1 = manifolds.Sphere(1)                                                                      
sage: T2 = S1.cartesian_product(S1)                                                                 
```

do we want

```
sage: T2.an_element()                                                                               
(Point on the 1-sphere S^1 of radius 1 smoothly embedded in the Euclidean plane E^2, 
 Point on the 1-sphere S^1 of radius 1 smoothly embedded in the Euclidean plane E^2)
```

or something like

```
sage: T2.an_element()                                                                               
Point on S^1 x S^1
```




---

archive/issue_comments_444791.json:
```json
{
    "body": "No preference here, as long as `cartesian_projection` is implemented",
    "created_at": "2021-02-17T18:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444791",
    "user": "@mkoeppe"
}
```

No preference here, as long as `cartesian_projection` is implemented



---

archive/issue_comments_444792.json:
```json
{
    "body": "I don't care so much either. Though, I think the latter is a bit neater.",
    "created_at": "2021-02-18T07:58:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31134",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31134#issuecomment-444792",
    "user": "@mjungmath"
}
```

I don't care so much either. Though, I think the latter is a bit neater.
