# Issue 30092: Graphs: last unbounded diameter distance-regular graphs

Issue created by migration from https://trac.sagemath.org/ticket/30329

Original creator: @Ivo-Maffei

Original creation time: 2020-08-10 14:07:13

CC:  dimpase

Keywords: drg




---

Comment by @Ivo-Maffei created at 2020-08-10 14:12:37

Changing status from new to needs_review.


---

Comment by @Ivo-Maffei created at 2020-08-10 14:12:37

Last 10 new commits:


---

Comment by @Ivo-Maffei created at 2020-08-11 10:23:17

Changing status from needs_review to needs_work.


---

Comment by @Ivo-Maffei created at 2020-08-11 10:23:17

Remainder to update once #30312 is sorted


---

Comment by git created at 2020-08-12 13:56:13

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2020-08-26 08:09:36

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by @Ivo-Maffei created at 2020-08-26 08:13:32

#30312 should be sorted out now, so this is ready


---

Comment by @Ivo-Maffei created at 2020-08-26 08:13:32

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-08-26 14:37:18

there is a bit of inconsistency with type hints - sometimes `const` is missing where it can well be added.


---

Comment by dimpase created at 2020-08-26 14:38:32

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-08-26 14:38:32

feel free to fix these and turn back to positive review


---

Comment by git created at 2020-08-26 14:57:32

Changing status from positive_review to needs_review.


---

Comment by git created at 2020-08-26 14:57:32

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by @Ivo-Maffei created at 2020-08-26 14:58:52

Changing status from needs_review to positive_review.


---

Comment by @Ivo-Maffei created at 2020-08-26 14:59:06

If you find another, please let me know


---

Comment by vbraun created at 2020-08-30 08:37:05


```
**********************************************************************
File "src/sage/graphs/generators/distance_regular.pyx", line 629, in sage.graphs.generators.distance_regular.BilinearFormsGraph
Failed example:
    G = graphs.BilinearFormsGraph(3,3,3)  # long time (20 s)
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 715, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/buildbot/slave/sage_git/build/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1139, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generators.distance_regular.BilinearFormsGraph[2]>", line 1, in <module>
        G = graphs.BilinearFormsGraph(Integer(3),Integer(3),Integer(3))  # long time (20 s)
      File "sage/graphs/generators/distance_regular.pyx", line 679, in sage.graphs.generators.distance_regular.BilinearFormsGraph (build/cythonized/sage/graphs/generators/distance_regular.c:11665)
        m3 = tuple([m1[i] + m2[i] for i in range(d*e)])
    MemoryError
**********************************************************************
File "src/sage/graphs/generators/distance_regular.pyx", line 630, in sage.graphs.generators.distance_regular.BilinearFormsGraph
Failed example:
    G.order()  # long time (due to above)
Expected:
    19683
Got:
    512
**********************************************************************
```



---

Comment by vbraun created at 2020-08-30 08:37:05

Changing status from positive_review to needs_work.


---

Comment by git created at 2020-08-30 14:18:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-08-30 14:19:14

Changing status from needs_work to needs_review.


---

Comment by @Ivo-Maffei created at 2020-08-30 14:19:14

Merged the fix on branch #30312


---

Comment by dimpase created at 2020-09-04 09:41:05

rebased over latest #30312
----
New commits:


---

Comment by @Ivo-Maffei created at 2020-09-04 09:42:13

I've actually merged it 30s ago and I'm now running the tests


---

Comment by @Ivo-Maffei created at 2020-09-04 09:45:35

Last 10 new commits:


---

Comment by git created at 2020-09-04 20:21:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-04 21:14:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-09-04 21:14:41

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-09-04 21:14:41

OK, done


---

Comment by dcoudert created at 2020-09-05 10:49:49

in `HalfCube`:
- typo: `calssical`
- the hamming distance function could be rewritten like `sum(1 for a, b in zip(v, w) if a != b)`
- The following construction is way faster when `n` is large (e.g., 12), but for small dimensions the running time is similar. Indeed, the time complexity is in `O(2 ^ (n-1) * (n - 1) ^ 2)` while your version is in `O(2 ^ (2 * (n - 1)))`.

```
def HalfCubeBest(const int n):
    """
    """
    if n < 2:
        raise ValueError("the dimension must be n > 1")

    from sage.graphs.graph_generators import graphs
    G = graphs.CubeGraph(n - 1)
    G.relabel()

    cdef int u, uu, v, i, j
    cdef list E = []
    for u in G:
        # flip 2 bits to get vertices at distance 2
        for i in range(n - 1):
            uu = u ^ (1 << i)
            for j in range(i + 1, n - 1):
                v = uu ^ (1 << j)
                if u < v:
                    E.append((u, v))
    G.add_edges(E)
    G.name("Half %d Cube"%n)
    return G
```



---

Comment by dcoudert created at 2020-09-05 10:49:49

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2020-09-05 11:48:42

the code in comment:20 depends upon the ordering produced by `G.relabel()` ? 
How do we know that number of a vertex `u` corresponds naturally to the binary representation
of the number `u`, this is more of a luck that it does.

I propose to do optimisation on a followup ticket, and just fix the typo here.


---

Comment by dcoudert created at 2020-09-05 11:56:07

Right, I have to improve the mapping from binary representation to int, and the optimization can be done later.


---

Comment by git created at 2020-09-05 12:05:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-09-05 13:55:30

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2020-09-15 21:58:28

Resolution: fixed
