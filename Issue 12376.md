# Issue 12376: In MPIR and MPFR, don't delete old libraries

Issue created by migration from https://trac.sagemath.org/ticket/12548

Original creator: jdemeyer

Original creation time: 2012-02-20 08:22:03

Assignee: tbd

CC:  jpflori

libmpir and libmpfr (and libmpc, #12515) are run-time dependencies of `gcc`.  With #12369, these therefore become build-time dependencies of Sage.  When these libraries are deleted during installation of mpir or mpfr, gcc stops working, causing build failures in parallel builds.

Since there is no clear reason why the old libraries should be deleted, we simply don't delete them.


---

Comment by jdemeyer created at 2012-02-20 09:54:51

Diff for the mpfr spkg, for review only


---

Attachment


---

Comment by jdemeyer created at 2012-02-21 10:31:20

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-02-23 19:33:41

Looks good to me. Why even delete the headers?


---

Comment by jhpalmieri created at 2012-02-23 19:33:41

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2012-02-24 11:18:44

Isn't the point of deleting the old librairies to not have tons of old librairies inside lib/ if Sage keeps on getting updated?

You might argue that it's not a big deal, because Sage is already so big, but...

And wasn't #12366 sufficient for building gcc?


---

Comment by jdemeyer created at 2012-02-24 13:50:05

Replying to [comment:5 jpflori]:
> Isn't the point of deleting the old librairies to not have tons of old librairies inside lib/ if Sage keeps on getting updated?
Probably.  But this wouldn't work here, as deleting the old mpir/mpfr/mpc libraries would mean that gcc stops working.  There are work-arounds, but they would make the build/upgrade process a lot more complicated.

> And wasn't #12366 sufficient for building gcc?
For _serial_ builds, #12366 is sufficient.  The problem with _parallel_ builds is that there is a cerain time between the deleting of the old mpfr libraries and the installation of the new mpfr libraries.  During that time, a gcc in a parallel build wouldn't work anymore.


---

Comment by jdemeyer created at 2012-02-27 11:23:25

Resolution: fixed
