# Issue 20685: Update Flask(-babel)

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2016-07-02 11:49:30

CC:  jdemeyer kcrisman dimpase @timokau mkoeppe




---

Comment by vbraun created at 2016-07-02 11:51:37

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2016-07-02 11:51:37

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by git created at 2016-07-02 11:58:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2016-07-02 16:40:34

A bunch of sagenb failures with the new flask/babel:

```
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/cell.py  # 11 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/worksheet.py  # 11 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/notebook.py  # 17 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py  # 8 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/template.py  # 8 doctests failed
```

because some stuff in flask was moved around:

```
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb/notebook/challenge.py", line 451, in sagenb.notebook.challenge.reCAPTCHAChallenge.html
Failed example:
    from sagenb.flask_version import base # random output -- depends on warnings issued by other sage packages
Exception raised:
    Traceback (most recent call last):
      File "/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sagenb.notebook.challenge.reCAPTCHAChallenge.html[0]>", line 1, in <module>
        from sagenb.flask_version import base # random output -- depends on warnings issued by other sage packages
      File "/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sagenb/flask_version/base.py", line 4, in <module>
        from flask import Flask, Module, url_for, request, session, redirect, g, make_response, current_app, render_template
    ImportError: cannot import name Module
**********************************************************************
```



---

Comment by chapoton created at 2017-02-26 10:08:55

The replacement for "Module" may be "Blueprint", but the syntax is not quite the same.


---

Comment by chapoton created at 2017-03-02 14:15:51

rebased on 7.6.b5
----
New commits:


---

Comment by chapoton created at 2017-03-02 14:36:23

Change from Module to Blueprint looks like that:

```
    class Module()
    def __init__(self, import_name, name=None, url_prefix=None,
                 static_path=None, subdomain=None):
        Blueprint.__init__(self, name, import_name, url_prefix=url_prefix,
                           subdomain=subdomain, template_folder='templates')
```



---

Comment by chapoton created at 2018-01-23 16:53:01

should we try to update ?


---

Comment by kcrisman created at 2018-01-23 17:07:40

Sure, if the notebook will still work.  Is the code you have in comment:7 pretty standard as a workaround?


---

Comment by chapoton created at 2018-01-23 19:09:19

A priori, the changes suggested in comment:7 are included in the notebook since a long time, and should already be in the notebook version inside sage.

So indeed, the matter is just now to see if updating flask breaks sagenb or not..


---

Comment by fbissey created at 2018-01-23 22:04:21

Dear me. I opened https://github.com/sagemath/sagenb/issues/437 because gentoo made a newer flask-babel stable. But then I have stuck sagenb with a dependency to an older version of flask.
After updating flask and getting click I still get the stuff I posted in the github issue however. Plus I now have a deprecation warning that in `sagenb/notebook/conf.py` at line 13 `flask.ext.babel` should be changed to `flask_babel`.


---

Comment by fbissey created at 2018-01-23 22:07:23

Also #20627


---

Comment by git created at 2018-01-24 08:58:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2018-01-24 09:03:46

Until https://github.com/sagemath/sagenb/issues/437 is resolved, this cannot go ahead.


---

Comment by chapoton created at 2018-01-24 09:11:57

Notebook has now a pull request to change some imports:

https://github.com/sagemath/sagenb/pull/438


---

Comment by chapoton created at 2018-07-12 12:03:55

see https://github.com/sagemath/sagenb/pull/450


---

Comment by chapoton created at 2018-07-12 12:57:16

For this ticket, one has to first update to a new release of sagenb. Some pull requests in sagenb should probably be merged before this new release.


---

Comment by chapoton created at 2021-03-05 07:33:14

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-03-05 07:33:14

obsolete, probably. Sagenb is gone, and flask is no longer a package.

see #29754


---

Comment by mkoeppe created at 2021-03-05 16:35:56

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2021-03-05 17:24:57

Resolution: invalid
