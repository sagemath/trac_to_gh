# Issue 20685: Update Flask(-babel)

archive/issues_020685.json:
```json
{
    "body": "CC:  jdemeyer kcrisman dimpase @timokau mkoeppe\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20922\n\n",
    "created_at": "2016-07-02T11:49:30Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Update Flask(-babel)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20685",
    "user": "vbraun"
}
```
CC:  jdemeyer kcrisman dimpase @timokau mkoeppe



Issue created by migration from https://trac.sagemath.org/ticket/20922





---

archive/issue_comments_285777.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2016-07-02T11:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285777",
    "user": "vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_285778.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2016-07-02T11:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285778",
    "user": "vbraun"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_285779.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-02T11:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285779",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285780.json:
```json
{
    "body": "A bunch of sagenb failures with the new flask/babel:\n\n```\nsage -t --long local/lib/python2.7/site-packages/sagenb/notebook/cell.py  # 11 doctests failed\nsage -t --long local/lib/python2.7/site-packages/sagenb/notebook/worksheet.py  # 11 doctests failed\nsage -t --long local/lib/python2.7/site-packages/sagenb/notebook/notebook.py  # 17 doctests failed\nsage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py  # 8 doctests failed\nsage -t --long local/lib/python2.7/site-packages/sagenb/notebook/template.py  # 8 doctests failed\n```\n\nbecause some stuff in flask was moved around:\n\n```\nsage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py\n**********************************************************************\nFile \"local/lib/python2.7/site-packages/sagenb/notebook/challenge.py\", line 451, in sagenb.notebook.challenge.reCAPTCHAChallenge.html\nFailed example:\n    from sagenb.flask_version import base # random output -- depends on warnings issued by other sage packages\nException raised:\n    Traceback (most recent call last):\n      File \"/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sagenb.notebook.challenge.reCAPTCHAChallenge.html[0]>\", line 1, in <module>\n        from sagenb.flask_version import base # random output -- depends on warnings issued by other sage packages\n      File \"/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sagenb/flask_version/base.py\", line 4, in <module>\n        from flask import Flask, Module, url_for, request, session, redirect, g, make_response, current_app, render_template\n    ImportError: cannot import name Module\n**********************************************************************\n```\n",
    "created_at": "2016-07-02T16:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285780",
    "user": "vbraun"
}
```

A bunch of sagenb failures with the new flask/babel:

```
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/cell.py  # 11 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/worksheet.py  # 11 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/notebook.py  # 17 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py  # 8 doctests failed
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/template.py  # 8 doctests failed
```

because some stuff in flask was moved around:

```
sage -t --long local/lib/python2.7/site-packages/sagenb/notebook/challenge.py
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb/notebook/challenge.py", line 451, in sagenb.notebook.challenge.reCAPTCHAChallenge.html
Failed example:
    from sagenb.flask_version import base # random output -- depends on warnings issued by other sage packages
Exception raised:
    Traceback (most recent call last):
      File "/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sagenb.notebook.challenge.reCAPTCHAChallenge.html[0]>", line 1, in <module>
        from sagenb.flask_version import base # random output -- depends on warnings issued by other sage packages
      File "/home/vbraun/Sage/git-develop/local/lib/python2.7/site-packages/sagenb/flask_version/base.py", line 4, in <module>
        from flask import Flask, Module, url_for, request, session, redirect, g, make_response, current_app, render_template
    ImportError: cannot import name Module
**********************************************************************
```




---

archive/issue_comments_285781.json:
```json
{
    "body": "The replacement for \"Module\" may be \"Blueprint\", but the syntax is not quite the same.",
    "created_at": "2017-02-26T10:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285781",
    "user": "chapoton"
}
```

The replacement for "Module" may be "Blueprint", but the syntax is not quite the same.



---

archive/issue_comments_285782.json:
```json
{
    "body": "rebased on 7.6.b5\n----\nNew commits:",
    "created_at": "2017-03-02T14:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285782",
    "user": "chapoton"
}
```

rebased on 7.6.b5
----
New commits:



---

archive/issue_comments_285783.json:
```json
{
    "body": "Change from Module to Blueprint looks like that:\n\n```\n    class Module()\n    def __init__(self, import_name, name=None, url_prefix=None,\n                 static_path=None, subdomain=None):\n        Blueprint.__init__(self, name, import_name, url_prefix=url_prefix,\n                           subdomain=subdomain, template_folder='templates')\n```\n",
    "created_at": "2017-03-02T14:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285783",
    "user": "chapoton"
}
```

Change from Module to Blueprint looks like that:

```
    class Module()
    def __init__(self, import_name, name=None, url_prefix=None,
                 static_path=None, subdomain=None):
        Blueprint.__init__(self, name, import_name, url_prefix=url_prefix,
                           subdomain=subdomain, template_folder='templates')
```




---

archive/issue_comments_285784.json:
```json
{
    "body": "should we try to update ?",
    "created_at": "2018-01-23T16:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285784",
    "user": "chapoton"
}
```

should we try to update ?



---

archive/issue_comments_285785.json:
```json
{
    "body": "Sure, if the notebook will still work.  Is the code you have in comment:7 pretty standard as a workaround?",
    "created_at": "2018-01-23T17:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285785",
    "user": "kcrisman"
}
```

Sure, if the notebook will still work.  Is the code you have in comment:7 pretty standard as a workaround?



---

archive/issue_comments_285786.json:
```json
{
    "body": "A priori, the changes suggested in comment:7 are included in the notebook since a long time, and should already be in the notebook version inside sage.\n\nSo indeed, the matter is just now to see if updating flask breaks sagenb or not..",
    "created_at": "2018-01-23T19:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285786",
    "user": "chapoton"
}
```

A priori, the changes suggested in comment:7 are included in the notebook since a long time, and should already be in the notebook version inside sage.

So indeed, the matter is just now to see if updating flask breaks sagenb or not..



---

archive/issue_comments_285787.json:
```json
{
    "body": "Dear me. I opened https://github.com/sagemath/sagenb/issues/437 because gentoo made a newer flask-babel stable. But then I have stuck sagenb with a dependency to an older version of flask.\nAfter updating flask and getting click I still get the stuff I posted in the github issue however. Plus I now have a deprecation warning that in `sagenb/notebook/conf.py` at line 13 `flask.ext.babel` should be changed to `flask_babel`.",
    "created_at": "2018-01-23T22:04:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285787",
    "user": "fbissey"
}
```

Dear me. I opened https://github.com/sagemath/sagenb/issues/437 because gentoo made a newer flask-babel stable. But then I have stuck sagenb with a dependency to an older version of flask.
After updating flask and getting click I still get the stuff I posted in the github issue however. Plus I now have a deprecation warning that in `sagenb/notebook/conf.py` at line 13 `flask.ext.babel` should be changed to `flask_babel`.



---

archive/issue_comments_285788.json:
```json
{
    "body": "Also #20627",
    "created_at": "2018-01-23T22:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285788",
    "user": "fbissey"
}
```

Also #20627



---

archive/issue_comments_285789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-24T08:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285790.json:
```json
{
    "body": "Until https://github.com/sagemath/sagenb/issues/437 is resolved, this cannot go ahead.",
    "created_at": "2018-01-24T09:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285790",
    "user": "dimpase"
}
```

Until https://github.com/sagemath/sagenb/issues/437 is resolved, this cannot go ahead.



---

archive/issue_comments_285791.json:
```json
{
    "body": "Notebook has now a pull request to change some imports:\n\nhttps://github.com/sagemath/sagenb/pull/438",
    "created_at": "2018-01-24T09:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285791",
    "user": "chapoton"
}
```

Notebook has now a pull request to change some imports:

https://github.com/sagemath/sagenb/pull/438



---

archive/issue_comments_285792.json:
```json
{
    "body": "see https://github.com/sagemath/sagenb/pull/450",
    "created_at": "2018-07-12T12:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285792",
    "user": "chapoton"
}
```

see https://github.com/sagemath/sagenb/pull/450



---

archive/issue_comments_285793.json:
```json
{
    "body": "For this ticket, one has to first update to a new release of sagenb. Some pull requests in sagenb should probably be merged before this new release.",
    "created_at": "2018-07-12T12:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285793",
    "user": "chapoton"
}
```

For this ticket, one has to first update to a new release of sagenb. Some pull requests in sagenb should probably be merged before this new release.



---

archive/issue_comments_285794.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-03-05T07:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285794",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285795.json:
```json
{
    "body": "obsolete, probably. Sagenb is gone, and flask is no longer a package.\n\nsee #29754",
    "created_at": "2021-03-05T07:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285795",
    "user": "chapoton"
}
```

obsolete, probably. Sagenb is gone, and flask is no longer a package.

see #29754



---

archive/issue_comments_285796.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-05T16:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285796",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285797.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-03-05T17:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20685",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20685#issuecomment-285797",
    "user": "chapoton"
}
```

Resolution: invalid
