# Issue 13743: zn_poly segfaults during tuning and tests on OS X and Cygwin when built on a busy system

archive/issues_013743.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @nexttime @jhpalmieri @jdemeyer @kcrisman @kwankyu\n\nKeywords: zn_poly spkg cygwin osx\n\nSee #13137 for more info.\nThis is true with different versions of MPIR so seems to be because of zn_poly and not of MPIR.\nNo problems where spotted on Linuces.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13947\n\n",
    "created_at": "2013-01-11T22:56:56Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "zn_poly segfaults during tuning and tests on OS X and Cygwin when built on a busy system",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13743",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```
Assignee: tbd

CC:  @nexttime @jhpalmieri @jdemeyer @kcrisman @kwankyu

Keywords: zn_poly spkg cygwin osx

See #13137 for more info.
This is true with different versions of MPIR so seems to be because of zn_poly and not of MPIR.
No problems where spotted on Linuces.

Issue created by migration from https://trac.sagemath.org/ticket/13947





---

archive/issue_comments_170204.json:
```json
{
    "body": "Does it really segfault, and especially does *the tuning* segfault?\n\nI thought zn_poly would just occasionally generate \"unexpected<sup>TM</sup>\" values during tuning on MacOS X and Cygwin (presumably only under heavy system load), such that afterwards *some tests* (with zn_poly rebuilt, or more precisely, relinked with these paramaters) would deterministically fail.\n\n(This might still depend on the compiler as well, at least *the way* it fails.)",
    "created_at": "2013-01-12T08:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170204",
    "user": "https://github.com/nexttime"
}
```

Does it really segfault, and especially does *the tuning* segfault?

I thought zn_poly would just occasionally generate "unexpected<sup>TM</sup>" values during tuning on MacOS X and Cygwin (presumably only under heavy system load), such that afterwards *some tests* (with zn_poly rebuilt, or more precisely, relinked with these paramaters) would deterministically fail.

(This might still depend on the compiler as well, at least *the way* it fails.)



---

archive/issue_comments_170205.json:
```json
{
    "body": "P.S.:  I was actually going to create a zn_poly spkg which simply saves the tuning parameters in case the tests fail, asking the user for submitting them to sage-devel or sage-release... (and probably doing a few more attempts to get working tuning parameters, and/or inform the user that he/she should reinstall the spkg when the sysload is lower).  :-)",
    "created_at": "2013-01-12T08:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170205",
    "user": "https://github.com/nexttime"
}
```

P.S.:  I was actually going to create a zn_poly spkg which simply saves the tuning parameters in case the tests fail, asking the user for submitting them to sage-devel or sage-release... (and probably doing a few more attempts to get working tuning parameters, and/or inform the user that he/she should reinstall the spkg when the sysload is lower).  :-)



---

archive/issue_comments_170206.json:
```json
{
    "body": "P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?",
    "created_at": "2013-01-12T08:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170206",
    "user": "https://github.com/nexttime"
}
```

P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?



---

archive/issue_comments_170207.json:
```json
{
    "body": "I also reproduced it on bsd.math.",
    "created_at": "2013-01-12T08:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170207",
    "user": "https://github.com/jdemeyer"
}
```

I also reproduced it on bsd.math.



---

archive/issue_comments_170208.json:
```json
{
    "body": "Also reproduced on hawk (OpenSolaris i386).",
    "created_at": "2013-01-12T08:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170208",
    "user": "https://github.com/jdemeyer"
}
```

Also reproduced on hawk (OpenSolaris i386).



---

archive/issue_comments_170209.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> I also reproduced it on bsd.math.\n\n\nHow?  I tried hard yesterday, but didn't manage.\n\nEven with [John's tuning parameters](http://sage.math.washington.edu/home/palmieri/misc/tuning.c-FAILED) that made the test(s) fail for him, still all tests (quick as well as extensive) pass for me on bsd.math (with Sage 5.6.beta3 [with GCC 4.6.3 built], and the included MPIR 2.4.0, FWIW).\n\nI was actually hoping we could reproduce the test failures on e.g. Linux as well with such \"failing\" parameters, although probably depending on the GCC version, too.",
    "created_at": "2013-01-12T10:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170209",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:4 jdemeyer]:
> I also reproduced it on bsd.math.


How?  I tried hard yesterday, but didn't manage.

Even with [John's tuning parameters](http://sage.math.washington.edu/home/palmieri/misc/tuning.c-FAILED) that made the test(s) fail for him, still all tests (quick as well as extensive) pass for me on bsd.math (with Sage 5.6.beta3 [with GCC 4.6.3 built], and the included MPIR 2.4.0, FWIW).

I was actually hoping we could reproduce the test failures on e.g. Linux as well with such "failing" parameters, although probably depending on the GCC version, too.



---

archive/issue_comments_170210.json:
```json
{
    "body": "Replying to [comment:6 leif]:\n> Replying to [comment:4 jdemeyer]:\n> > I also reproduced it on bsd.math.\n\n> \n> How?  I tried hard yesterday, but didn't manage.\n\n\nHmmm, I probably forgot to run `make test` (which rebuilds `test/test` with a *debug version* of `src/tuning.c`) in addition to `make` (which apparently just rebuilds the static library, not used by `test`; IMHO a flaw in the Makefiles).\n\nBut still, I cannot reproduce the failure with John's parameters.",
    "created_at": "2013-01-12T10:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170210",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:6 leif]:
> Replying to [comment:4 jdemeyer]:
> > I also reproduced it on bsd.math.

> 
> How?  I tried hard yesterday, but didn't manage.


Hmmm, I probably forgot to run `make test` (which rebuilds `test/test` with a *debug version* of `src/tuning.c`) in addition to `make` (which apparently just rebuilds the static library, not used by `test`; IMHO a flaw in the Makefiles).

But still, I cannot reproduce the failure with John's parameters.



---

archive/issue_comments_170211.json:
```json
{
    "body": "Replying to [comment:7 leif]:\n> Replying to [comment:6 leif]:\n> > Replying to [comment:4 jdemeyer]:\n> > > I also reproduced it on bsd.math.\n\n> > \n> > How?  I tried hard yesterday, but didn't manage.\n\n> \n> Hmmm, I probably forgot to run `make test` (which rebuilds `test/test` with a *debug version* of `src/tuning.c`) in addition to `make` (which apparently just rebuilds the static library, not used by `test`; IMHO a flaw in the Makefiles).\n> \n> But still, I cannot reproduce the failure with John's parameters.\n\n\nOoops, not true.  In the last attempt, I missed that `nuss_mul()` failed, but only when tested \"extensively\":\n\n```\n(sage-sh) leif@bsd:src$ test/test -quick all\nmpn_smp_basecase()... ok\nmpn_smp_kara()... ok\nmpn_smp()... ok\nmpn_mulmid()... ok\nzn_array_recover_reduce()... ok\nzn_array_pack()... ok\nzn_array_unpack()... ok\nzn_array_mul_KS1()... ok\nzn_array_mul_KS2()... ok\nzn_array_mul_KS3()... ok\nzn_array_mul_KS4()... ok\nzn_array_sqr_KS1()... ok\nzn_array_sqr_KS2()... ok\nzn_array_sqr_KS3()... ok\nzn_array_sqr_KS4()... ok\nzn_array_mulmid_KS1()... ok\nzn_array_mulmid_KS2()... ok\nzn_array_mulmid_KS3()... ok\nzn_array_mulmid_KS4()... ok\nnuss_mul()... ok\npmfvec_fft_dc()... ok\npmfvec_fft_huge()... ok\npmfvec_ifft_dc()... ok\npmfvec_ifft_huge()... ok\npmfvec_tpfft_dc()... ok\npmfvec_tpfft_huge()... ok\npmfvec_tpifft_dc()... ok\npmfvec_tpifft_huge()... ok\nzn_array_mul_fft()... ok\nzn_array_sqr_fft()... ok\nzn_array_mulmid_fft()... ok\nzn_array_mul_fft_dft()... ok\nzn_array_invert()... ok\n\nAll tests passed.\n(sage-sh) leif@bsd:src$ time test/test all\nmpn_smp_basecase()... ok\nmpn_smp_kara()... ok\nmpn_smp()... ok\nmpn_mulmid()... ok\nzn_array_recover_reduce()... ok\nzn_array_pack()... ok\nzn_array_unpack()... ok\nzn_array_mul_KS1()... ok\nzn_array_mul_KS2()... ok\nzn_array_mul_KS3()... ok\nzn_array_mul_KS4()... ok\nzn_array_sqr_KS1()... ok\nzn_array_sqr_KS2()... ok\nzn_array_sqr_KS3()... ok\nzn_array_sqr_KS4()... ok\nzn_array_mulmid_KS1()... ok\nzn_array_mulmid_KS2()... ok\nzn_array_mulmid_KS3()... ok\nzn_array_mulmid_KS4()... ok\nnuss_mul()... FAIL!\n\nAt least one test FAILED!\n```\n\nPresumably because those tests take a pretty long time... ;-)",
    "created_at": "2013-01-12T10:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170211",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:7 leif]:
> Replying to [comment:6 leif]:
> > Replying to [comment:4 jdemeyer]:
> > > I also reproduced it on bsd.math.

> > 
> > How?  I tried hard yesterday, but didn't manage.

> 
> Hmmm, I probably forgot to run `make test` (which rebuilds `test/test` with a *debug version* of `src/tuning.c`) in addition to `make` (which apparently just rebuilds the static library, not used by `test`; IMHO a flaw in the Makefiles).
> 
> But still, I cannot reproduce the failure with John's parameters.


Ooops, not true.  In the last attempt, I missed that `nuss_mul()` failed, but only when tested "extensively":

```
(sage-sh) leif@bsd:src$ test/test -quick all
mpn_smp_basecase()... ok
mpn_smp_kara()... ok
mpn_smp()... ok
mpn_mulmid()... ok
zn_array_recover_reduce()... ok
zn_array_pack()... ok
zn_array_unpack()... ok
zn_array_mul_KS1()... ok
zn_array_mul_KS2()... ok
zn_array_mul_KS3()... ok
zn_array_mul_KS4()... ok
zn_array_sqr_KS1()... ok
zn_array_sqr_KS2()... ok
zn_array_sqr_KS3()... ok
zn_array_sqr_KS4()... ok
zn_array_mulmid_KS1()... ok
zn_array_mulmid_KS2()... ok
zn_array_mulmid_KS3()... ok
zn_array_mulmid_KS4()... ok
nuss_mul()... ok
pmfvec_fft_dc()... ok
pmfvec_fft_huge()... ok
pmfvec_ifft_dc()... ok
pmfvec_ifft_huge()... ok
pmfvec_tpfft_dc()... ok
pmfvec_tpfft_huge()... ok
pmfvec_tpifft_dc()... ok
pmfvec_tpifft_huge()... ok
zn_array_mul_fft()... ok
zn_array_sqr_fft()... ok
zn_array_mulmid_fft()... ok
zn_array_mul_fft_dft()... ok
zn_array_invert()... ok

All tests passed.
(sage-sh) leif@bsd:src$ time test/test all
mpn_smp_basecase()... ok
mpn_smp_kara()... ok
mpn_smp()... ok
mpn_mulmid()... ok
zn_array_recover_reduce()... ok
zn_array_pack()... ok
zn_array_unpack()... ok
zn_array_mul_KS1()... ok
zn_array_mul_KS2()... ok
zn_array_mul_KS3()... ok
zn_array_mul_KS4()... ok
zn_array_sqr_KS1()... ok
zn_array_sqr_KS2()... ok
zn_array_sqr_KS3()... ok
zn_array_sqr_KS4()... ok
zn_array_mulmid_KS1()... ok
zn_array_mulmid_KS2()... ok
zn_array_mulmid_KS3()... ok
zn_array_mulmid_KS4()... ok
nuss_mul()... FAIL!

At least one test FAILED!
```

Presumably because those tests take a pretty long time... ;-)



---

archive/issue_comments_170212.json:
```json
{
    "body": "The (extensive) tests that didn't get run because `test` exits upon the first failure (`nuss_mul()`) all pass for me:\n\n```\n(sage-sh) leif@bsd:src$ time test/test pmfvec_fft_dc pmfvec_fft_huge pmfvec_ifft_dc pmfvec_ifft_huge pmfvec_tpfft_dc pmfvec_tpfft_huge pmfvec_tpifft_dc pmfvec_tpifft_huge zn_array_mul_fft zn_array_sqr_fft zn_array_mulmid_fft zn_array_mul_fft_dft zn_array_invert && echo OK\npmfvec_fft_dc()... ok\npmfvec_fft_huge()... ok\npmfvec_ifft_dc()... ok\npmfvec_ifft_huge()... ok\npmfvec_tpfft_dc()... ok\npmfvec_tpfft_huge()... ok\npmfvec_tpifft_dc()... ok\npmfvec_tpifft_huge()... ok\nzn_array_mul_fft()... ok\nzn_array_sqr_fft()... ok\nzn_array_mulmid_fft()... ok\nzn_array_mul_fft_dft()... ok\nzn_array_invert()... ok\n\nAll tests passed.\n\nreal\t1m15.127s\nuser\t1m15.054s\nsys\t0m0.027s\nOK\n```\n\n(This is with John's \"failing\" tuning parameters, bsd.math.)",
    "created_at": "2013-01-12T11:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170212",
    "user": "https://github.com/nexttime"
}
```

The (extensive) tests that didn't get run because `test` exits upon the first failure (`nuss_mul()`) all pass for me:

```
(sage-sh) leif@bsd:src$ time test/test pmfvec_fft_dc pmfvec_fft_huge pmfvec_ifft_dc pmfvec_ifft_huge pmfvec_tpfft_dc pmfvec_tpfft_huge pmfvec_tpifft_dc pmfvec_tpifft_huge zn_array_mul_fft zn_array_sqr_fft zn_array_mulmid_fft zn_array_mul_fft_dft zn_array_invert && echo OK
pmfvec_fft_dc()... ok
pmfvec_fft_huge()... ok
pmfvec_ifft_dc()... ok
pmfvec_ifft_huge()... ok
pmfvec_tpfft_dc()... ok
pmfvec_tpfft_huge()... ok
pmfvec_tpifft_dc()... ok
pmfvec_tpifft_huge()... ok
zn_array_mul_fft()... ok
zn_array_sqr_fft()... ok
zn_array_mulmid_fft()... ok
zn_array_mul_fft_dft()... ok
zn_array_invert()... ok

All tests passed.

real	1m15.127s
user	1m15.054s
sys	0m0.027s
OK
```

(This is with John's "failing" tuning parameters, bsd.math.)



---

archive/issue_comments_170213.json:
```json
{
    "body": "Replying to [comment:3 leif]:\n> P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?\n\n\nThat's my recollection. In my experiment yesterday, I only ran that test (using `./test nuss_mull`).",
    "created_at": "2013-01-12T16:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170213",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:3 leif]:
> P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?


That's my recollection. In my experiment yesterday, I only ran that test (using `./test nuss_mull`).



---

archive/issue_comments_170214.json:
```json
{
    "body": "Replying to [comment:10 jhpalmieri]:\n> Replying to [comment:3 leif]:\n> > P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?\n\n> \n> That's my recollection. In my experiment yesterday, I only ran that test (using `./test nuss_mull`).\n\n\nWith your tuning parameters, I also only get the extensive test of `nuss_mul()` failing.  Reproducible on Linux, with GCC 4.7.0.  (Haven't tried other versions yet, but this shows at least it's not limited to GCC 4.6.3.)",
    "created_at": "2013-01-12T17:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170214",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:10 jhpalmieri]:
> Replying to [comment:3 leif]:
> > P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?

> 
> That's my recollection. In my experiment yesterday, I only ran that test (using `./test nuss_mull`).


With your tuning parameters, I also only get the extensive test of `nuss_mul()` failing.  Reproducible on Linux, with GCC 4.7.0.  (Haven't tried other versions yet, but this shows at least it's not limited to GCC 4.6.3.)



---

archive/issue_comments_170215.json:
```json
{
    "body": "IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE=\"make -j4\" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.\n\nThe segfaults happened while tuning KS/FFT things, mostly the last one which is mulmid, but I seem to tremember it also happened during the previous KS/FFT things sometimes.\n\nOf course I tried to reproduce that this morning and could not (I let ATLAS build in parallel to keep the system busy but that did not seem to do the trick).\n\nI'll give it another shot in the next couple of days.",
    "created_at": "2013-01-12T19:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170215",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE="make -j4" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.

The segfaults happened while tuning KS/FFT things, mostly the last one which is mulmid, but I seem to tremember it also happened during the previous KS/FFT things sometimes.

Of course I tried to reproduce that this morning and could not (I let ATLAS build in parallel to keep the system busy but that did not seem to do the trick).

I'll give it another shot in the next couple of days.



---

archive/issue_comments_170216.json:
```json
{
    "body": "Replying to [comment:11 leif]:\n> Replying to [comment:10 jhpalmieri]:\n> > Replying to [comment:3 leif]:\n> > > P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?\n\n> > \n> > That's my recollection. In my experiment yesterday, I only ran that test (using `./test nuss_mull`).\n\n> \n> With your tuning parameters, I also only get the extensive test of `nuss_mul()` failing.  Reproducible on Linux, with GCC 4.7.0.  (Haven't tried other versions yet, but this shows at least it's not limited to GCC 4.6.3.)\n> \n>  \n\nCould you give it a shot by only testing the MPIR part and disabling the comparison in the test code?\nAnd do the same with zn_poly code only?\nSo if it's really a bug in MPIR, or calling a function on invalid (let's say really too small) parameters we'll be settled.",
    "created_at": "2013-01-12T19:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170216",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:11 leif]:
> Replying to [comment:10 jhpalmieri]:
> > Replying to [comment:3 leif]:
> > > P.P.S.:  John, is it always (just) `nuss_mul()` that fails the test?

> > 
> > That's my recollection. In my experiment yesterday, I only ran that test (using `./test nuss_mull`).

> 
> With your tuning parameters, I also only get the extensive test of `nuss_mul()` failing.  Reproducible on Linux, with GCC 4.7.0.  (Haven't tried other versions yet, but this shows at least it's not limited to GCC 4.6.3.)
> 
>  

Could you give it a shot by only testing the MPIR part and disabling the comparison in the test code?
And do the same with zn_poly code only?
So if it's really a bug in MPIR, or calling a function on invalid (let's say really too small) parameters we'll be settled.



---

archive/issue_comments_170217.json:
```json
{
    "body": "Replying to [comment:13 jpflori]:\n> Could you give it a shot by only testing the MPIR part and disabling the comparison in the test code?\n> And do the same with zn_poly code only?\n\n\n???\n\nIt's just the comparison that fails (or, more precisely, the tests make the \"success\" depend on the comparison only); no segfaults, no failed assertions.\n\nI removed the \"exit on first failure\" and got 5 failures (from the \"extensive\" `nuss_mul()` test; all other tests passed, as mentioned).\n\n> So if it's really a bug in MPIR, or calling a function on invalid (let's say really too small) parameters we'll be settled.\n\n\nWell, since the failure depends on **zn_poly's thresholds** (for *zn_poly's* functions), it's IMHO clearly in zn_poly, not MPIR.  (Unless zn_poly was right only with the \"failing\" tuning parameters, and incidentally MPIR [2.4.0 and 2.6.0] and zn_poly would give the same wrong results otherwise.  Or am I missing something?)\n\nThere are still random numbers involved though, so the tests may pass or fail under different circumstances.",
    "created_at": "2013-01-12T19:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170217",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:13 jpflori]:
> Could you give it a shot by only testing the MPIR part and disabling the comparison in the test code?
> And do the same with zn_poly code only?


???

It's just the comparison that fails (or, more precisely, the tests make the "success" depend on the comparison only); no segfaults, no failed assertions.

I removed the "exit on first failure" and got 5 failures (from the "extensive" `nuss_mul()` test; all other tests passed, as mentioned).

> So if it's really a bug in MPIR, or calling a function on invalid (let's say really too small) parameters we'll be settled.


Well, since the failure depends on **zn_poly's thresholds** (for *zn_poly's* functions), it's IMHO clearly in zn_poly, not MPIR.  (Unless zn_poly was right only with the "failing" tuning parameters, and incidentally MPIR [2.4.0 and 2.6.0] and zn_poly would give the same wrong results otherwise.  Or am I missing something?)

There are still random numbers involved though, so the tests may pass or fail under different circumstances.



---

archive/issue_comments_170218.json:
```json
{
    "body": "The offending parameter in John's `tuning.c` seems to be `tuning_info[62].mul_fft_thresh` (=90, which is extraordinarily low), i.e., that's the one that (for me) causes the `nuss_mul()` test failures here.\n\n(There are others, but those aren't relevant for the tests, apparently.)",
    "created_at": "2013-01-12T22:49:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170218",
    "user": "https://github.com/nexttime"
}
```

The offending parameter in John's `tuning.c` seems to be `tuning_info[62].mul_fft_thresh` (=90, which is extraordinarily low), i.e., that's the one that (for me) causes the `nuss_mul()` test failures here.

(There are others, but those aren't relevant for the tests, apparently.)



---

archive/issue_comments_170219.json:
```json
{
    "body": "Replying to [comment:15 leif]:\n> The offending parameter in John's `tuning.c` seems to be `tuning_info[62].mul_fft_thresh` (=90, which is extraordinarily low), i.e., that's the one that (for me) causes the `nuss_mul()` test failures here.\n\n\nWhen I set all `mul_fft_thresh`s to 1, I get a lot more failures (although not all tests/comparisons fail).\n\nMore interestingly, the failures only happen when squaring.  If I use *separate* \"buffers\" for both operands (in `test/nuss-test.c`), all failures vanish, so this seems to be an aliasing problem.  (Still strange the error doesn't happen for all inputs; *someone<sup>TM</sup>* should investigate further... ;-) )",
    "created_at": "2013-01-13T00:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170219",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 leif]:
> The offending parameter in John's `tuning.c` seems to be `tuning_info[62].mul_fft_thresh` (=90, which is extraordinarily low), i.e., that's the one that (for me) causes the `nuss_mul()` test failures here.


When I set all `mul_fft_thresh`s to 1, I get a lot more failures (although not all tests/comparisons fail).

More interestingly, the failures only happen when squaring.  If I use *separate* "buffers" for both operands (in `test/nuss-test.c`), all failures vanish, so this seems to be an aliasing problem.  (Still strange the error doesn't happen for all inputs; *someone<sup>TM</sup>* should investigate further... ;-) )



---

archive/issue_comments_170220.json:
```json
{
    "body": "Replying to [comment:16 leif]:\n> Replying to [comment:15 leif]:\n> > The offending parameter in John's `tuning.c` seems to be `tuning_info[62].mul_fft_thresh` (=90, which is extraordinarily low), i.e., that's the one that (for me) causes the `nuss_mul()` test failures here.\n\n> \n> When I set all `mul_fft_thresh`s to 1, I get a lot more failures (although not all tests/comparisons fail).\n> \n> More interestingly, the failures only happen when squaring.\n\n\nI also get the quick test to fail with all (2...64 bits) `mul_fft_thresh` entries set to 1.\n\nAnd I meanwhile managed to get \"invalid\" tuning parameters on Linux x86_64, too (although just once, but unintentionally).\n\nI don't think the bug (or test failure) is in any way related to the compiler / GCC version or compilation options, as I've so far been able to force it with every GCC version I tried (4.4.3, 4.6.3, 4.7.0, 4.7.2), regardless of whether I used e.g. `-O0` or `-O3`, or `-fno-strict-aliasing`.\n\nStill don't know whether (just) `testcase_nuss_mul()` is broken (in violating preconditions by using the same array for both [identical] operands when squaring [`sqr==1`], although assertion checking is enabled when compiling for the `test` program), or whether it actually triggers a real bug by doing so.  Someone more knowledgable than me should probably check this.\n\n[As mentioned, all failures vanish when `buf1 != buf2`, i.e., when they don't alias even if `sqr==1`.]",
    "created_at": "2013-01-13T20:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170220",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:16 leif]:
> Replying to [comment:15 leif]:
> > The offending parameter in John's `tuning.c` seems to be `tuning_info[62].mul_fft_thresh` (=90, which is extraordinarily low), i.e., that's the one that (for me) causes the `nuss_mul()` test failures here.

> 
> When I set all `mul_fft_thresh`s to 1, I get a lot more failures (although not all tests/comparisons fail).
> 
> More interestingly, the failures only happen when squaring.


I also get the quick test to fail with all (2...64 bits) `mul_fft_thresh` entries set to 1.

And I meanwhile managed to get "invalid" tuning parameters on Linux x86_64, too (although just once, but unintentionally).

I don't think the bug (or test failure) is in any way related to the compiler / GCC version or compilation options, as I've so far been able to force it with every GCC version I tried (4.4.3, 4.6.3, 4.7.0, 4.7.2), regardless of whether I used e.g. `-O0` or `-O3`, or `-fno-strict-aliasing`.

Still don't know whether (just) `testcase_nuss_mul()` is broken (in violating preconditions by using the same array for both [identical] operands when squaring [`sqr==1`], although assertion checking is enabled when compiling for the `test` program), or whether it actually triggers a real bug by doing so.  Someone more knowledgable than me should probably check this.

[As mentioned, all failures vanish when `buf1 != buf2`, i.e., when they don't alias even if `sqr==1`.]



---

archive/issue_comments_170221.json:
```json
{
    "body": "Ok, leif, can you put your recipe to trigger the failure in the summary?",
    "created_at": "2013-02-25T00:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170221",
    "user": "https://github.com/kiwifb"
}
```

Ok, leif, can you put your recipe to trigger the failure in the summary?



---

archive/issue_comments_170222.json:
```json
{
    "body": "Replying to [comment:19 fbissey]:\n> Ok, leif, can you put your recipe to trigger the failure in the summary?\n\n\nOh, I don't recall right now (searching logs ...), but I think I just faked the values in `tuning.c` (generated by `tune/tune[.c]`) by modifying `test/test.c` (i.e., added something like `{ int i; for (i=2;i<=64;i++) tuning_info[i].mul_fft_thresh=1; }` to the beginning of `test/test.c`(?)'s `main()`).\n\nAfter running `sage -f -s zn_poly`, start a Sage subshell and enter the build directory.\n\nThen you can play with it, i.e., modify the code (or tuning values), and run `make test && test/test [-quick] [tests_to_run]*` (in `$SAGE_ROOT/spkg/build/zn_poly-0.9.p{9,10}/src/`) IIRC.\n\n(More to come if I find the logs, otherwise also see the comments above for more info.)",
    "created_at": "2013-02-25T02:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170222",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:19 fbissey]:
> Ok, leif, can you put your recipe to trigger the failure in the summary?


Oh, I don't recall right now (searching logs ...), but I think I just faked the values in `tuning.c` (generated by `tune/tune[.c]`) by modifying `test/test.c` (i.e., added something like `{ int i; for (i=2;i<=64;i++) tuning_info[i].mul_fft_thresh=1; }` to the beginning of `test/test.c`(?)'s `main()`).

After running `sage -f -s zn_poly`, start a Sage subshell and enter the build directory.

Then you can play with it, i.e., modify the code (or tuning values), and run `make test && test/test [-quick] [tests_to_run]*` (in `$SAGE_ROOT/spkg/build/zn_poly-0.9.p{9,10}/src/`) IIRC.

(More to come if I find the logs, otherwise also see the comments above for more info.)



---

archive/issue_comments_170223.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> (More to come if I find the logs, otherwise also see the comments above for more info.)\n\n\nHmmm, sorry, cannot find any.  I vaguely remember I had a power outage before I saved anything... 8-/",
    "created_at": "2013-02-25T02:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170223",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:20 leif]:
> (More to come if I find the logs, otherwise also see the comments above for more info.)


Hmmm, sorry, cannot find any.  I vaguely remember I had a power outage before I saved anything... 8-/



---

archive/issue_comments_170224.json:
```json
{
    "body": "Replying to [comment:20 leif]:\n> Replying to [comment:19 fbissey]:\n> > Ok, leif, can you put your recipe to trigger the failure in the summary?\n\n> \n> Oh, I don't recall right now (searching logs ...), but I think I just faked the values in `tuning.c` (generated by `tune/tune[.c]`) by modifying `test/test.c` (i.e., added something like `{ int i; for (i=2;i<=64;i++) tuning_info[i].mul_fft_thresh=1; }` to the beginning of `test/test.c`(?)'s `main()`).\n\n\nYep:\n\n```patch\n--- zn_poly-0.9.p5/src/test/test.c.orig\t2008-09-19 17:37:47.000000000 +0200\n+++ zn_poly-0.9.p5/src/test/test.c\t2013-01-13 20:33:11.919633442 +0100\n@@ -209,6 +209,11 @@\n    \n    int all_success = 1, any_targets = 0, quick = 0, success, i, j;\n \n+#if 1 || defined(FAKE_THRESHOLDS)\n+   for(i=2;i<=64;i++)\n+     tuning_info[i].mul_fft_thresh=1; // always (I think)\n+#endif\n+\n    for (j = 1; j < argc; j++)\n    {\n       if (!strcmp (argv[j], \"-quick\"))\n```\n\n\nI've also found\n\n```patch\n\n--- zn_poly-0.9.p5/src/test/nuss-test.c.orig\t2008-09-19 17:37:47.000000000 +0200\n+++ zn_poly-0.9.p5/src/test/nuss-test.c\t2013-01-13 20:25:40.629633300 +0100\n@@ -59,6 +59,16 @@\n    ref_zn_array_scalar_mul (res, res, n, x, mod);\n    int success = !zn_array_cmp (ref, res, n);\n    \n+#if 1 || defined(TEST_VERBOSE)\n+   if(!success)\n+   {\n+     fprintf(stderr,\n+       \"testcase_nuss_mul(): comparison FAILED: lgL=%u (n=%lu) sqr=%d mod.m=%lu mod.bits=%d\\n\",\n+       lgL, n, sqr,\n+       mod->m, mod->bits);\n+   }\n+#endif\n+   \n    pmfvec_clear (vec2);\n    pmfvec_clear (vec1);\n    \n@@ -67,7 +77,7 @@\n    if (!sqr)\n       free (buf2);\n    free (buf1);\n-   \n+\n    return success;\n }\n \n@@ -84,6 +94,7 @@\n    zn_mod_t mod;\n \n    for (i = 0; i < num_test_bitsizes; i++)\n+#if 0\n    for (lgL = 2; lgL <= (quick ? 11 : 13) && success; lgL++)\n    for (trial = 0; trial < (quick ? 1 : 5) && success; trial++)\n    {\n@@ -92,6 +103,16 @@\n       success = success && testcase_nuss_mul (lgL, 1, mod);\n       zn_mod_clear (mod);\n    }\n+#else\t/* don't stop upon first failure: */\n+   for (lgL = 2; lgL <= (quick ? 11 : 13) /* && success */; lgL++)\n+   for (trial = 0; trial < (quick ? 1 : 5) /* && success */; trial++)\n+   {\n+      zn_mod_init (mod, random_modulus (test_bitsizes[i], 1));\n+      success &= testcase_nuss_mul (lgL, 0, mod);\n+      success &= testcase_nuss_mul (lgL, 1, mod);\n+      zn_mod_clear (mod);\n+   }\n+#endif\n    \n    return success;\n }\n```\n\nto not stop at the first test failure in `nuss-test.c`.  (The patches here are against the `.p5`, but that shouldn't matter if you just strip the first folder name with `patch -p1`.)",
    "created_at": "2013-02-25T03:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170224",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:20 leif]:
> Replying to [comment:19 fbissey]:
> > Ok, leif, can you put your recipe to trigger the failure in the summary?

> 
> Oh, I don't recall right now (searching logs ...), but I think I just faked the values in `tuning.c` (generated by `tune/tune[.c]`) by modifying `test/test.c` (i.e., added something like `{ int i; for (i=2;i<=64;i++) tuning_info[i].mul_fft_thresh=1; }` to the beginning of `test/test.c`(?)'s `main()`).


Yep:

```patch
--- zn_poly-0.9.p5/src/test/test.c.orig	2008-09-19 17:37:47.000000000 +0200
+++ zn_poly-0.9.p5/src/test/test.c	2013-01-13 20:33:11.919633442 +0100
@@ -209,6 +209,11 @@
    
    int all_success = 1, any_targets = 0, quick = 0, success, i, j;
 
+#if 1 || defined(FAKE_THRESHOLDS)
+   for(i=2;i<=64;i++)
+     tuning_info[i].mul_fft_thresh=1; // always (I think)
+#endif
+
    for (j = 1; j < argc; j++)
    {
       if (!strcmp (argv[j], "-quick"))
```


I've also found

```patch

--- zn_poly-0.9.p5/src/test/nuss-test.c.orig	2008-09-19 17:37:47.000000000 +0200
+++ zn_poly-0.9.p5/src/test/nuss-test.c	2013-01-13 20:25:40.629633300 +0100
@@ -59,6 +59,16 @@
    ref_zn_array_scalar_mul (res, res, n, x, mod);
    int success = !zn_array_cmp (ref, res, n);
    
+#if 1 || defined(TEST_VERBOSE)
+   if(!success)
+   {
+     fprintf(stderr,
+       "testcase_nuss_mul(): comparison FAILED: lgL=%u (n=%lu) sqr=%d mod.m=%lu mod.bits=%d\n",
+       lgL, n, sqr,
+       mod->m, mod->bits);
+   }
+#endif
+   
    pmfvec_clear (vec2);
    pmfvec_clear (vec1);
    
@@ -67,7 +77,7 @@
    if (!sqr)
       free (buf2);
    free (buf1);
-   
+
    return success;
 }
 
@@ -84,6 +94,7 @@
    zn_mod_t mod;
 
    for (i = 0; i < num_test_bitsizes; i++)
+#if 0
    for (lgL = 2; lgL <= (quick ? 11 : 13) && success; lgL++)
    for (trial = 0; trial < (quick ? 1 : 5) && success; trial++)
    {
@@ -92,6 +103,16 @@
       success = success && testcase_nuss_mul (lgL, 1, mod);
       zn_mod_clear (mod);
    }
+#else	/* don't stop upon first failure: */
+   for (lgL = 2; lgL <= (quick ? 11 : 13) /* && success */; lgL++)
+   for (trial = 0; trial < (quick ? 1 : 5) /* && success */; trial++)
+   {
+      zn_mod_init (mod, random_modulus (test_bitsizes[i], 1));
+      success &= testcase_nuss_mul (lgL, 0, mod);
+      success &= testcase_nuss_mul (lgL, 1, mod);
+      zn_mod_clear (mod);
+   }
+#endif
    
    return success;
 }
```

to not stop at the first test failure in `nuss-test.c`.  (The patches here are against the `.p5`, but that shouldn't matter if you just strip the first folder name with `patch -p1`.)



---

archive/issue_comments_170225.json:
```json
{
    "body": "attached by request (my dual quad-core 10.7.5 mac is having this problem)",
    "created_at": "2013-02-25T23:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170225",
    "user": "https://github.com/wdjoyner"
}
```

attached by request (my dual quad-core 10.7.5 mac is having this problem)



---

archive/issue_comments_170226.json:
```json
{
    "body": "Attachment [tuning.c](tarball://root/attachments/some-uuid/ticket13947/tuning.c) by @kcrisman created at 2013-03-12 02:42:58\n\nReplying to [comment:12 jpflori]:\n> IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE=\"make -j4\" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.\n> \n\n\nJust as a data point, I can confirm this, even with `make -j2`, on Cygwin Win 7.",
    "created_at": "2013-03-12T02:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170226",
    "user": "https://github.com/kcrisman"
}
```

Attachment [tuning.c](tarball://root/attachments/some-uuid/ticket13947/tuning.c) by @kcrisman created at 2013-03-12 02:42:58

Replying to [comment:12 jpflori]:
> IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE="make -j4" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.
> 


Just as a data point, I can confirm this, even with `make -j2`, on Cygwin Win 7.



---

archive/issue_comments_170227.json:
```json
{
    "body": "Replying to [comment:23 kcrisman]:\n> Replying to [comment:12 jpflori]:\n> > IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE=\"make -j4\" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.\n> > \n\n> \n> Just as a data point, I can confirm this, even with `make -j2`, on Cygwin Win 7.\n\n\nConfirm what exactly?\n\nTuning fails if the box is too busy?  And if so, how?\n\nBuilding itself (before and/or after tuning) can also fail?\n\nOr does just the quick test after \"successfully\" building zn_poly fail (due to failing comparisons, as intended, or with a segfault or whatever)?",
    "created_at": "2013-03-12T05:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170227",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:23 kcrisman]:
> Replying to [comment:12 jpflori]:
> > IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE="make -j4" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.
> > 

> 
> Just as a data point, I can confirm this, even with `make -j2`, on Cygwin Win 7.


Confirm what exactly?

Tuning fails if the box is too busy?  And if so, how?

Building itself (before and/or after tuning) can also fail?

Or does just the quick test after "successfully" building zn_poly fail (due to failing comparisons, as intended, or with a segfault or whatever)?



---

archive/issue_comments_170228.json:
```json
{
    "body": "> > > IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE=\"make -j4\" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.\n\n> > Just as a data point, I can confirm this, even with `make -j2`, on Cygwin Win 7.\n> Confirm what exactly?\n> Tuning fails if the box is too busy?  And if so, how?\n\nCorrect; with one other spkg being built it was too much.  Segfault during tuning in KS/FFT mul, repeatable.  No problems during short self-test, though of course I couldn't try that without using just one thread in any case.\n> Building itself (before and/or after tuning) can also fail?\n\nI guess not.",
    "created_at": "2013-03-12T13:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170228",
    "user": "https://github.com/kcrisman"
}
```

> > > IIRC (and I'm quite sure I am) I got segfault as well during the tuning itself on Cygwin (64bits Windows 7), mostly when issuing make with MAKE="make -j4" so the system must have been busy as well, but IIRC (less sure) it also happened when building zn_poly alone.

> > Just as a data point, I can confirm this, even with `make -j2`, on Cygwin Win 7.
> Confirm what exactly?
> Tuning fails if the box is too busy?  And if so, how?

Correct; with one other spkg being built it was too much.  Segfault during tuning in KS/FFT mul, repeatable.  No problems during short self-test, though of course I couldn't try that without using just one thread in any case.
> Building itself (before and/or after tuning) can also fail?

I guess not.



---

archive/issue_comments_170229.json:
```json
{
    "body": "#14268 contains a patched zn_poly spkg for a totally unrelated problem. Just pointing this out in case somebody here plans to patch zn_poly.",
    "created_at": "2013-03-14T17:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170229",
    "user": "https://github.com/jdemeyer"
}
```

#14268 contains a patched zn_poly spkg for a totally unrelated problem. Just pointing this out in case somebody here plans to patch zn_poly.



---

archive/issue_comments_170230.json:
```json
{
    "body": "ping",
    "created_at": "2013-04-30T16:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170230",
    "user": "https://github.com/nexttime"
}
```

ping



---

archive/issue_comments_170231.json:
```json
{
    "body": "pong",
    "created_at": "2013-04-30T18:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170231",
    "user": "https://github.com/jhpalmieri"
}
```

pong



---

archive/issue_comments_170232.json:
```json
{
    "body": "Changing keywords from \"zn_poly spkg cygwin osx\" to \"zn_poly spkg cygwin osx nuss_mul fail\".",
    "created_at": "2013-04-30T19:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170232",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "zn_poly spkg cygwin osx" to "zn_poly spkg cygwin osx nuss_mul fail".



---

archive/issue_comments_170233.json:
```json
{
    "body": "Tracebacks of segfaults, anyone?\n\n(As mentioned, I can only reproduce *failing comparisons* -- with *faked* tuning parameters.)",
    "created_at": "2013-04-30T19:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170233",
    "user": "https://github.com/nexttime"
}
```

Tracebacks of segfaults, anyone?

(As mentioned, I can only reproduce *failing comparisons* -- with *faked* tuning parameters.)



---

archive/issue_comments_170234.json:
```json
{
    "body": "Replying to [comment:30 leif]:\n> Tracebacks of segfaults, anyone?\n> \n> (As mentioned, I can only reproduce *failing comparisons* -- with *faked* tuning parameters.)\n\n\nI consistently get this failure installing latest versions of Sage. Where (or how) can I get the tracebacks?",
    "created_at": "2013-05-01T01:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170234",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:30 leif]:
> Tracebacks of segfaults, anyone?
> 
> (As mentioned, I can only reproduce *failing comparisons* -- with *faked* tuning parameters.)


I consistently get this failure installing latest versions of Sage. Where (or how) can I get the tracebacks?



---

archive/issue_comments_170235.json:
```json
{
    "body": "Hi, I am the original author.\n\nI have debugged this issue outside of sage, using the version of zn_poly 0.9 on my web page. I can reproduce the issue with \"test/test nuss_mul\" on sage.math (or maybe I've logged into boxen?), using the tuning file provided by wdj above.\n\nAfter some debugging, I have found a genuine bug in the test code. In nuss-test.c, line 60 currently reads\n\n```\n   ulong x = nuss_mul_fudge (lgL, 0, mod);\n```\nIt should be\n\n``` \n   ulong x = nuss_mul_fudge (lgL, sqr, mod);\n```\n\nBasically what's happening is that `nuss_mul` returns its results multiplied by a fudge factor, and the test code has to undo that fudge factor to compare the results. The current version always uses the thresholds from the \"multiplication\" version of the code to figure out the fudge factor. But when sqr == 1, it should be using the \"squaring\" thresholds.\n\nPlease let me know if that solves the problem.",
    "created_at": "2013-05-24T05:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170235",
    "user": "https://trac.sagemath.org/admin/accounts/users/dmharvey"
}
```

Hi, I am the original author.

I have debugged this issue outside of sage, using the version of zn_poly 0.9 on my web page. I can reproduce the issue with "test/test nuss_mul" on sage.math (or maybe I've logged into boxen?), using the tuning file provided by wdj above.

After some debugging, I have found a genuine bug in the test code. In nuss-test.c, line 60 currently reads

```
   ulong x = nuss_mul_fudge (lgL, 0, mod);
```
It should be

``` 
   ulong x = nuss_mul_fudge (lgL, sqr, mod);
```

Basically what's happening is that `nuss_mul` returns its results multiplied by a fudge factor, and the test code has to undo that fudge factor to compare the results. The current version always uses the thresholds from the "multiplication" version of the code to figure out the fudge factor. But when sqr == 1, it should be using the "squaring" thresholds.

Please let me know if that solves the problem.



---

archive/issue_comments_170236.json:
```json
{
    "body": "So the problem is only in the *testing* code?\n\nWe should really try to fix this ASAP.",
    "created_at": "2013-05-24T06:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170236",
    "user": "https://github.com/jdemeyer"
}
```

So the problem is only in the *testing* code?

We should really try to fix this ASAP.



---

archive/issue_comments_170237.json:
```json
{
    "body": "Thanks David.\n\nHaven't tested the fix yet, but that wouldn't explain *segfaults* others mentioned (I couldn't reproduce myself).\n\nAnother issue is that the self-tuning under heavy load apparently yields unreasonable thresholds, on MacOS X and Cygwin at least.",
    "created_at": "2013-05-24T06:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170237",
    "user": "https://github.com/nexttime"
}
```

Thanks David.

Haven't tested the fix yet, but that wouldn't explain *segfaults* others mentioned (I couldn't reproduce myself).

Another issue is that the self-tuning under heavy load apparently yields unreasonable thresholds, on MacOS X and Cygwin at least.



---

archive/issue_comments_170238.json:
```json
{
    "body": "Ok, I've created a quick-and-dirty spkg just for testing your patch:\n\n```diff\n--- src/test/nuss-test.c\t2008-09-19 17:37:47.000000000 +0200\n+++ src/test/nuss-test.c\t2013-05-24 08:53:44.133597843 +0200\n@@ -55,7 +55,7 @@\n    // compare target implementation against reference implementation\n    ref_zn_array_negamul (ref, buf1, buf2, n, mod);\n    nuss_mul (res, buf1, buf2, vec1, vec2);\n-   ulong x = nuss_mul_fudge (lgL, 0, mod);\n+   ulong x = nuss_mul_fudge (lgL, sqr, mod);\n    ref_zn_array_scalar_mul (res, res, n, x, mod);\n    int success = !zn_array_cmp (ref, res, n);\n    \n```\n\nhttp://boxen.math.washington.edu/home/leif/Sage/spkgs/zn_poly-0.9.p11-testing.spkg\n\n(No update of `SPKG.txt`, nothing committed.)",
    "created_at": "2013-05-24T07:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170238",
    "user": "https://github.com/nexttime"
}
```

Ok, I've created a quick-and-dirty spkg just for testing your patch:

```diff
--- src/test/nuss-test.c	2008-09-19 17:37:47.000000000 +0200
+++ src/test/nuss-test.c	2013-05-24 08:53:44.133597843 +0200
@@ -55,7 +55,7 @@
    // compare target implementation against reference implementation
    ref_zn_array_negamul (ref, buf1, buf2, n, mod);
    nuss_mul (res, buf1, buf2, vec1, vec2);
-   ulong x = nuss_mul_fudge (lgL, 0, mod);
+   ulong x = nuss_mul_fudge (lgL, sqr, mod);
    ref_zn_array_scalar_mul (res, res, n, x, mod);
    int success = !zn_array_cmp (ref, res, n);
    
```

http://boxen.math.washington.edu/home/leif/Sage/spkgs/zn_poly-0.9.p11-testing.spkg

(No update of `SPKG.txt`, nothing committed.)



---

archive/issue_comments_170239.json:
```json
{
    "body": "P.S.:  I'll probably update it later to allow conditional faking of thresholds...  (as I don't get \"appropriate\" thresholds on Linux, and only rarely on the MacOS X box I have access to).",
    "created_at": "2013-05-24T07:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170239",
    "user": "https://github.com/nexttime"
}
```

P.S.:  I'll probably update it later to allow conditional faking of thresholds...  (as I don't get "appropriate" thresholds on Linux, and only rarely on the MacOS X box I have access to).



---

archive/issue_comments_170240.json:
```json
{
    "body": "Replying to [comment:36 leif]:\n> P.S.:  I'll probably update it later to allow conditional faking of thresholds...  (as I don't get \"appropriate\" thresholds on Linux, and only rarely on the MacOS X box I have access to).\n\n\nOk, did so.\n\nYou can now install the spkg with `ZN_POLY_FAKE_THRESHOLDS` set to something non-empty to set all `mul_fft_thresh`s to 1, [comment:22 as I previously did to provoke failures].\n\n(Even) with this, the \"quick\" test suite (still) passes for me now.\n\nFurther changes for debugging:  Failures in `test_nuss_mul()` now get reported, and the test suite doesn't exit on the first failure, but continues testing.  (Especially `test_nuss_mul()` now performs all tests regardless of failures.)\n\nFeel free to change `patches/conditionally_fake_mul_fft_threshs.patch` to fake other tuning parameters as well; as the name says, I'm only changing `tuning_info[2..64].mul_fft_thresh` since doing so previously triggered failures for me.",
    "created_at": "2013-05-24T09:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170240",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:36 leif]:
> P.S.:  I'll probably update it later to allow conditional faking of thresholds...  (as I don't get "appropriate" thresholds on Linux, and only rarely on the MacOS X box I have access to).


Ok, did so.

You can now install the spkg with `ZN_POLY_FAKE_THRESHOLDS` set to something non-empty to set all `mul_fft_thresh`s to 1, [comment:22 as I previously did to provoke failures].

(Even) with this, the "quick" test suite (still) passes for me now.

Further changes for debugging:  Failures in `test_nuss_mul()` now get reported, and the test suite doesn't exit on the first failure, but continues testing.  (Especially `test_nuss_mul()` now performs all tests regardless of failures.)

Feel free to change `patches/conditionally_fake_mul_fft_threshs.patch` to fake other tuning parameters as well; as the name says, I'm only changing `tuning_info[2..64].mul_fft_thresh` since doing so previously triggered failures for me.



---

archive/issue_comments_170241.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2013-05-24T09:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170241",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_170242.json:
```json
{
    "body": "leif: can you make a proper spkg and put a link to that spkg in the ticket description?",
    "created_at": "2013-05-24T09:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170242",
    "user": "https://github.com/jdemeyer"
}
```

leif: can you make a proper spkg and put a link to that spkg in the ticket description?



---

archive/issue_comments_170243.json:
```json
{
    "body": "Replying to [comment:38 jdemeyer]:\n> leif: can you make a proper spkg and put a link to that spkg in the ticket description?\n\n\nShould I just include David's patch or also add some debugging in case we still get failures?",
    "created_at": "2013-05-24T09:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170243",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:38 jdemeyer]:
> leif: can you make a proper spkg and put a link to that spkg in the ticket description?


Should I just include David's patch or also add some debugging in case we still get failures?



---

archive/issue_comments_170244.json:
```json
{
    "body": "(I could leave it as is and just update `SPKG.txt` accordingly, of course also committing the changes.)",
    "created_at": "2013-05-24T09:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170244",
    "user": "https://github.com/nexttime"
}
```

(I could leave it as is and just update `SPKG.txt` accordingly, of course also committing the changes.)



---

archive/issue_comments_170245.json:
```json
{
    "body": "I would just include the patch and see if people still report problems.",
    "created_at": "2013-05-24T09:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170245",
    "user": "https://github.com/jdemeyer"
}
```

I would just include the patch and see if people still report problems.



---

archive/issue_comments_170246.json:
```json
{
    "body": "Diff between the `.p10` and the `.p11`.  For reference / review only.",
    "created_at": "2013-05-24T10:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170246",
    "user": "https://github.com/nexttime"
}
```

Diff between the `.p10` and the `.p11`.  For reference / review only.



---

archive/issue_comments_170247.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-24T10:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170247",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_170248.json:
```json
{
    "body": "Attachment [zn_poly-0.9.p10-p11.diff](tarball://root/attachments/some-uuid/ticket13947/zn_poly-0.9.p10-p11.diff) by @nexttime created at 2013-05-24 10:36:11",
    "created_at": "2013-05-24T10:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170248",
    "user": "https://github.com/nexttime"
}
```

Attachment [zn_poly-0.9.p10-p11.diff](tarball://root/attachments/some-uuid/ticket13947/zn_poly-0.9.p10-p11.diff) by @nexttime created at 2013-05-24 10:36:11



---

archive/issue_comments_170249.json:
```json
{
    "body": "Replying to [comment:41 jdemeyer]:\n> I would just include the patch and see if people still report problems.\n\n\nOk, did so, see [attachment:zn_poly-0.9.p10-p11.diff attached diff].\n\nThe `-testing` spkg is still there, in case anybody wants to play with it.",
    "created_at": "2013-05-24T10:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170249",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:41 jdemeyer]:
> I would just include the patch and see if people still report problems.


Ok, did so, see [attachment:zn_poly-0.9.p10-p11.diff attached diff].

The `-testing` spkg is still there, in case anybody wants to play with it.



---

archive/issue_comments_170250.json:
```json
{
    "body": "Somebody should take a look at tuning on MacOS X and Cygwin though, as the failures were apparently triggered by *\"random\" tuning parameters*... (which the patch obviously doesn't affect).",
    "created_at": "2013-05-24T10:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170250",
    "user": "https://github.com/nexttime"
}
```

Somebody should take a look at tuning on MacOS X and Cygwin though, as the failures were apparently triggered by *"random" tuning parameters*... (which the patch obviously doesn't affect).



---

archive/issue_comments_170251.json:
```json
{
    "body": "`@`David - thank you so much for helping track this down in \"stable\" code!  I hope this is the only one...\n\n> Somebody should take a look at tuning on MacOS X and Cygwin though\nAgreed.  I may be able to do this on OS X today, but not Cygwin until later.",
    "created_at": "2013-05-24T12:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170251",
    "user": "https://github.com/kcrisman"
}
```

`@`David - thank you so much for helping track this down in "stable" code!  I hope this is the only one...

> Somebody should take a look at tuning on MacOS X and Cygwin though
Agreed.  I may be able to do this on OS X today, but not Cygwin until later.



---

archive/issue_comments_170252.json:
```json
{
    "body": "I can't reproduce it on my Mac box, but I don't think I ever did.  Maybe John can try it on bsd again...",
    "created_at": "2013-05-24T15:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170252",
    "user": "https://github.com/kcrisman"
}
```

I can't reproduce it on my Mac box, but I don't think I ever did.  Maybe John can try it on bsd again...



---

archive/issue_comments_170253.json:
```json
{
    "body": "I agree that tuning on heavily loaded OS X systems has not been addressed.\n\nI also don't know about any segfaults.\n\nAnyway, I tried building the old and new spkgs on a loaded OS X system. I could not reproduce any failures in the quick test suite, but the old spkg reliably failed its full test-suite, while the new spkg reliably passed its full test suite.\n\nklee, can you test it out, too?",
    "created_at": "2013-05-24T19:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170253",
    "user": "https://github.com/jhpalmieri"
}
```

I agree that tuning on heavily loaded OS X systems has not been addressed.

I also don't know about any segfaults.

Anyway, I tried building the old and new spkgs on a loaded OS X system. I could not reproduce any failures in the quick test suite, but the old spkg reliably failed its full test-suite, while the new spkg reliably passed its full test suite.

klee, can you test it out, too?



---

archive/issue_comments_170254.json:
```json
{
    "body": "Interim report:\n\n1) Making Sage 5.10.beta2 again, I checked it fails at the same spot, zn_poly's quick test suite, with \"null_mul()... FAIL!\".\n\n2) I installed the new spkg with the command \"./sage -f http://boxen.math.washington.edu/home/leif/Sage/spkgs/zn_poly-0.9.p11.spkg\" and succeeded. It passed the zn_poly's quick test suite smoothly!\n\n3) Now my machine is making Sage 5.10.beta2. \n\n4) Then I downloaded Sage 5.10.beta4, the latest, and replaced zn_poly-0.9.p10.spkg with zn_poly-0.9.p11.spkg in the directory spkg/standard. Then I started making Sage 5.10.beta4. So now my machine is making both beta2 and beta4 at the same time. Perhaps this makes sure the machine is quite loaded. Also the machine is running two virtual machines and some usual applications like Chrome browser.\n\nI will report the final result as soon as the machin finishes building!\n\nBy the way, thank you all so much.",
    "created_at": "2013-05-25T03:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170254",
    "user": "https://github.com/kwankyu"
}
```

Interim report:

1) Making Sage 5.10.beta2 again, I checked it fails at the same spot, zn_poly's quick test suite, with "null_mul()... FAIL!".

2) I installed the new spkg with the command "./sage -f http://boxen.math.washington.edu/home/leif/Sage/spkgs/zn_poly-0.9.p11.spkg" and succeeded. It passed the zn_poly's quick test suite smoothly!

3) Now my machine is making Sage 5.10.beta2. 

4) Then I downloaded Sage 5.10.beta4, the latest, and replaced zn_poly-0.9.p10.spkg with zn_poly-0.9.p11.spkg in the directory spkg/standard. Then I started making Sage 5.10.beta4. So now my machine is making both beta2 and beta4 at the same time. Perhaps this makes sure the machine is quite loaded. Also the machine is running two virtual machines and some usual applications like Chrome browser.

I will report the final result as soon as the machin finishes building!

By the way, thank you all so much.



---

archive/issue_comments_170255.json:
```json
{
    "body": "Report on making Sage 5.10.beta2:\n\nBuilt successfully. Tested successfully except one failure, which seems unrelated with the current issue.\n\n```\nsage -t devel/sage/sage/calculus/calculus.py\n**********************************************************************\nFile \"devel/sage/sage/calculus/calculus.py\", line 1309, in sage.calculus.calculus.laplace\nFailed example:\n    (p1+p2).save(os.path.join(SAGE_TMP, \"de_plot.png\"))\nExpected nothing\nGot:\n    dyld: Library not loaded: /usr/X11/lib/libfreetype.6.dylib\n      Referenced from: /usr/X11/bin/fc-list\n      Reason: Incompatible library version: fc-list requires version 14.0.0 or later, but libfreetype.6.dylib provides version 10.0.0\n    dyld: Library not loaded: /usr/X11/lib/libfreetype.6.dylib\n      Referenced from: /usr/X11/bin/fc-list\n      Reason: Incompatible library version: fc-list requires version 14.0.0 or later, but libfreetype.6.dylib provides version 10.0.0\n**********************************************************************\n```",
    "created_at": "2013-05-25T06:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170255",
    "user": "https://github.com/kwankyu"
}
```

Report on making Sage 5.10.beta2:

Built successfully. Tested successfully except one failure, which seems unrelated with the current issue.

```
sage -t devel/sage/sage/calculus/calculus.py
**********************************************************************
File "devel/sage/sage/calculus/calculus.py", line 1309, in sage.calculus.calculus.laplace
Failed example:
    (p1+p2).save(os.path.join(SAGE_TMP, "de_plot.png"))
Expected nothing
Got:
    dyld: Library not loaded: /usr/X11/lib/libfreetype.6.dylib
      Referenced from: /usr/X11/bin/fc-list
      Reason: Incompatible library version: fc-list requires version 14.0.0 or later, but libfreetype.6.dylib provides version 10.0.0
    dyld: Library not loaded: /usr/X11/lib/libfreetype.6.dylib
      Referenced from: /usr/X11/bin/fc-list
      Reason: Incompatible library version: fc-list requires version 14.0.0 or later, but libfreetype.6.dylib provides version 10.0.0
**********************************************************************
```



---

archive/issue_comments_170256.json:
```json
{
    "body": "Yes, this is a very occasional OS X error that I haven't been able to track down, and that has nothing to do with this ticket.",
    "created_at": "2013-05-25T13:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170256",
    "user": "https://github.com/kcrisman"
}
```

Yes, this is a very occasional OS X error that I haven't been able to track down, and that has nothing to do with this ticket.



---

archive/issue_comments_170257.json:
```json
{
    "body": "Report on making Sage 5.10.beta4:\n\nWell... Building failed with \"Error installing package sage-5.10.beta4\". So I tried \"./sage -i spkg/standard/zn_poly-0.9.p11.spkg\", and it was installed successfully. \n\nSo my overall impression is that the patch corrects the issue, and the issue seems unrelated with the heavy loadedness of my machine (Mac Pro quad-core intel xeon with Mac OS X 10.7.5).",
    "created_at": "2013-05-25T16:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170257",
    "user": "https://github.com/kwankyu"
}
```

Report on making Sage 5.10.beta4:

Well... Building failed with "Error installing package sage-5.10.beta4". So I tried "./sage -i spkg/standard/zn_poly-0.9.p11.spkg", and it was installed successfully. 

So my overall impression is that the patch corrects the issue, and the issue seems unrelated with the heavy loadedness of my machine (Mac Pro quad-core intel xeon with Mac OS X 10.7.5).



---

archive/issue_comments_170258.json:
```json
{
    "body": "> Report on making Sage 5.10.beta4:\n> Well... Building failed with \"Error installing package sage-5.10.beta4\". So I tried \"./sage -i spkg/standard/zn_poly-0.9.p11.spkg\", and it was installed successfully.\n  \nBut what was the failure in installing beta4?  If it was still `zn_poly` then just installing this spkg wouldn't address the underlying issue.\n\nTo really test this, assuming the failure was `zn_poly`, can you unpack the beta4 tarball again, but replace `spkg/standard/zn_poly<old>.spkg` with this spkg *before compiling* and then compile under heavy load (maybe even just `make -j4`) and see if the problem persists.",
    "created_at": "2013-05-25T16:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170258",
    "user": "https://github.com/kcrisman"
}
```

> Report on making Sage 5.10.beta4:
> Well... Building failed with "Error installing package sage-5.10.beta4". So I tried "./sage -i spkg/standard/zn_poly-0.9.p11.spkg", and it was installed successfully.
  
But what was the failure in installing beta4?  If it was still `zn_poly` then just installing this spkg wouldn't address the underlying issue.

To really test this, assuming the failure was `zn_poly`, can you unpack the beta4 tarball again, but replace `spkg/standard/zn_poly<old>.spkg` with this spkg *before compiling* and then compile under heavy load (maybe even just `make -j4`) and see if the problem persists.



---

archive/issue_comments_170259.json:
```json
{
    "body": "Replying to [comment:52 kcrisman]:\n> > Report on making Sage 5.10.beta4:\n> > Well... Building failed with \"Error installing package sage-5.10.beta4\". So I tried \"./sage -i spkg/standard/zn_poly-0.9.p11.spkg\", and it was installed successfully.\n  \n> But what was the failure in installing beta4?  If it was still `zn_poly` then just installing this spkg wouldn't address the underlying issue.\n\n**package** `sage-5.10.beta4` = the Sage library spkg failed to install, so apparently zn_poly did install successfully, as the former depends on the latter.\n\nOn the other hand, (re)installing zn_poly afterwards (with just `sage -i ...`) should have just told you that it's already installed, which you at least did not explicitly mention.\n\n(But you said you copied the `.p11` into `spkg/standard/` before building Sage 5.10.beta4.)",
    "created_at": "2013-05-25T16:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170259",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:52 kcrisman]:
> > Report on making Sage 5.10.beta4:
> > Well... Building failed with "Error installing package sage-5.10.beta4". So I tried "./sage -i spkg/standard/zn_poly-0.9.p11.spkg", and it was installed successfully.
  
> But what was the failure in installing beta4?  If it was still `zn_poly` then just installing this spkg wouldn't address the underlying issue.

**package** `sage-5.10.beta4` = the Sage library spkg failed to install, so apparently zn_poly did install successfully, as the former depends on the latter.

On the other hand, (re)installing zn_poly afterwards (with just `sage -i ...`) should have just told you that it's already installed, which you at least did not explicitly mention.

(But you said you copied the `.p11` into `spkg/standard/` before building Sage 5.10.beta4.)



---

archive/issue_comments_170260.json:
```json
{
    "body": "... where \"you\" addresses Kwankyu, in case that wasn't clear.",
    "created_at": "2013-05-25T16:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170260",
    "user": "https://github.com/nexttime"
}
```

... where "you" addresses Kwankyu, in case that wasn't clear.



---

archive/issue_comments_170261.json:
```json
{
    "body": "Replying to [comment:53 leif]:\n> Replying to [comment:52 kcrisman]:\n> > > Report on making Sage 5.10.beta4:\n> > > Well... Building failed with \"Error installing package sage-5.10.beta4\". So I tried \"./sage -i spkg/standard/zn_poly-0.9.p11.spkg\", and it was installed successfully.\n  \n> > But what was the failure in installing beta4?  If it was still `zn_poly` then just installing this spkg wouldn't address the underlying issue.\n> \n> **package** `sage-5.10.beta4` = the Sage library spkg failed to install, so apparently zn_poly did install successfully, as the former depends on the latter.\n> \n> On the other hand, (re)installing zn_poly afterwards (with just `sage -i ...`) should have just told you that it's already installed, which you at least did not explicitly mention.\n> \n> (But you said you copied the `.p11` into `spkg/standard/` before building Sage 5.10.beta4.)\n\n\nYes, I copied `.p11` into `spkg/standard/` and removed `.p10` before I started building Sage 5.10.beta4.\n\nSorry that I don't remember the reason of the failure of beta4. The message was somewhat unclear to me, but seemed unrelated with zn_poly. Now I am building beta4 to reproduce the failure.\n\nI used \"sage -i\" rather than \"sage -f\", and remember the installation of the spkg started as if it was not done before. On this point, I am not so confident of my own memory though. Anyway, the installation was successful.",
    "created_at": "2013-05-25T19:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170261",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:53 leif]:
> Replying to [comment:52 kcrisman]:
> > > Report on making Sage 5.10.beta4:
> > > Well... Building failed with "Error installing package sage-5.10.beta4". So I tried "./sage -i spkg/standard/zn_poly-0.9.p11.spkg", and it was installed successfully.
  
> > But what was the failure in installing beta4?  If it was still `zn_poly` then just installing this spkg wouldn't address the underlying issue.
> 
> **package** `sage-5.10.beta4` = the Sage library spkg failed to install, so apparently zn_poly did install successfully, as the former depends on the latter.
> 
> On the other hand, (re)installing zn_poly afterwards (with just `sage -i ...`) should have just told you that it's already installed, which you at least did not explicitly mention.
> 
> (But you said you copied the `.p11` into `spkg/standard/` before building Sage 5.10.beta4.)


Yes, I copied `.p11` into `spkg/standard/` and removed `.p10` before I started building Sage 5.10.beta4.

Sorry that I don't remember the reason of the failure of beta4. The message was somewhat unclear to me, but seemed unrelated with zn_poly. Now I am building beta4 to reproduce the failure.

I used "sage -i" rather than "sage -f", and remember the installation of the spkg started as if it was not done before. On this point, I am not so confident of my own memory though. Anyway, the installation was successful.



---

archive/issue_comments_170262.json:
```json
{
    "body": "Rebuilding beta4 now succeeded, but when I started the just-built Sage, I got\n\n```\nAthena:sage-5.10.beta4$ ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n---------------------------------------------------------------------------\nImportError                               Traceback (most recent call last)\n<ipython-input-1-e91e614a7080> in <module>()\n      2 sys.path.append(os.environ['HOME'] + '/Workplace/sage')\n      3 \n----> 4 from lib import *\n| Sage Version 5.10.beta4, Release Date: 2013-05-20                  |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n/Users/Kwankyu/Workplace/sage/lib/__init__.py in <module>()\n----> 1 from curve.simple_curve import SimpleCurve\n\n/Users/Kwankyu/Workplace/sage/lib/curve/simple_curve.py in <module>()\n     22 from sage.matrix.constructor import matrix, vector\n     23 \n---> 24 from lib.curve import affine_curve\n     25 from affine_curve import AffinePlaneCurve, CoordinateRing\n     26 \n\n/Users/Kwankyu/Workplace/sage/lib/curve/affine_curve.py in <module>()\n      9 from sage.categories.morphism import Morphism\n     10 from sage.categories.finite_fields import FiniteFields\n---> 11 from sage.schemes.generic.projective_space import ProjectiveSpace\n     12 from sage.rings.fraction_field import FractionField\n     13 from sage.rings.infinity import infinity\n\nImportError: No module named projective_space\nsage: \n```\n\nStill \"./sage -f spkg/standard/zn_poly-0.9.p11.spkg\" succeeds.",
    "created_at": "2013-05-26T00:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170262",
    "user": "https://github.com/kwankyu"
}
```

Rebuilding beta4 now succeeded, but when I started the just-built Sage, I got

```
Athena:sage-5.10.beta4$ ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
---------------------------------------------------------------------------
ImportError                               Traceback (most recent call last)
<ipython-input-1-e91e614a7080> in <module>()
      2 sys.path.append(os.environ['HOME'] + '/Workplace/sage')
      3 
----> 4 from lib import *
| Sage Version 5.10.beta4, Release Date: 2013-05-20                  |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
/Users/Kwankyu/Workplace/sage/lib/__init__.py in <module>()
----> 1 from curve.simple_curve import SimpleCurve

/Users/Kwankyu/Workplace/sage/lib/curve/simple_curve.py in <module>()
     22 from sage.matrix.constructor import matrix, vector
     23 
---> 24 from lib.curve import affine_curve
     25 from affine_curve import AffinePlaneCurve, CoordinateRing
     26 

/Users/Kwankyu/Workplace/sage/lib/curve/affine_curve.py in <module>()
      9 from sage.categories.morphism import Morphism
     10 from sage.categories.finite_fields import FiniteFields
---> 11 from sage.schemes.generic.projective_space import ProjectiveSpace
     12 from sage.rings.fraction_field import FractionField
     13 from sage.rings.infinity import infinity

ImportError: No module named projective_space
sage: 
```

Still "./sage -f spkg/standard/zn_poly-0.9.p11.spkg" succeeds.



---

archive/issue_comments_170263.json:
```json
{
    "body": "Replying to [comment:56 klee]:\n> Rebuilding beta4 now succeeded, but when I started the just-built Sage, I got\n> \n> \n> ```\n> Athena:sage-5.10.beta4$ ./sage\n> ----------------------------------------------------------------------\n> | Sage Version 5.10.beta4, Release Date: 2013-05-20                  |\n> | Type \"notebook()\" for the browser-based notebook interface.        |\n> | Type \"help()\" for help.                                            |\n> ----------------------------------------------------------------------\n> **********************************************************************\n> *                                                                    *\n> * Warning: this is a prerelease version, and it may be unstable.     *\n> *                                                                    *\n> **********************************************************************\n> ---------------------------------------------------------------------------\n> ImportError                               Traceback (most recent call last)\n> <ipython-input-1-e91e614a7080> in <module>()\n>       2 sys.path.append(os.environ['HOME'] + '/Workplace/sage')\n>       3 \n> ----> 4 from lib import *\n> \n> /Users/Kwankyu/Workplace/sage/lib/__init__.py in <module>()\n> ----> 1 from curve.simple_curve import SimpleCurve\n> \n> /Users/Kwankyu/Workplace/sage/lib/curve/simple_curve.py in <module>()\n>      22 from sage.matrix.constructor import matrix, vector\n>      23 \n> ---> 24 from lib.curve import affine_curve\n>      25 from affine_curve import AffinePlaneCurve, CoordinateRing\n>      26 \n> \n> /Users/Kwankyu/Workplace/sage/lib/curve/affine_curve.py in <module>()\n>       9 from sage.categories.morphism import Morphism\n>      10 from sage.categories.finite_fields import FiniteFields\n> ---> 11 from sage.schemes.generic.projective_space import ProjectiveSpace\n>      12 from sage.rings.fraction_field import FractionField\n>      13 from sage.rings.infinity import infinity\n> \n> ImportError: No module named projective_space\n> sage: \n> ```\n\n\nThis is both unrelated to zn_poly and hardly related to Sage 5.10.beta4.\n\nOutdated `init.sage`?  Cf. #14217, merged into Sage 5.10.beta3.",
    "created_at": "2013-05-26T01:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170263",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:56 klee]:
> Rebuilding beta4 now succeeded, but when I started the just-built Sage, I got
> 
> 
> ```
> Athena:sage-5.10.beta4$ ./sage
> ----------------------------------------------------------------------
> | Sage Version 5.10.beta4, Release Date: 2013-05-20                  |
> | Type "notebook()" for the browser-based notebook interface.        |
> | Type "help()" for help.                                            |
> ----------------------------------------------------------------------
> **********************************************************************
> *                                                                    *
> * Warning: this is a prerelease version, and it may be unstable.     *
> *                                                                    *
> **********************************************************************
> ---------------------------------------------------------------------------
> ImportError                               Traceback (most recent call last)
> <ipython-input-1-e91e614a7080> in <module>()
>       2 sys.path.append(os.environ['HOME'] + '/Workplace/sage')
>       3 
> ----> 4 from lib import *
> 
> /Users/Kwankyu/Workplace/sage/lib/__init__.py in <module>()
> ----> 1 from curve.simple_curve import SimpleCurve
> 
> /Users/Kwankyu/Workplace/sage/lib/curve/simple_curve.py in <module>()
>      22 from sage.matrix.constructor import matrix, vector
>      23 
> ---> 24 from lib.curve import affine_curve
>      25 from affine_curve import AffinePlaneCurve, CoordinateRing
>      26 
> 
> /Users/Kwankyu/Workplace/sage/lib/curve/affine_curve.py in <module>()
>       9 from sage.categories.morphism import Morphism
>      10 from sage.categories.finite_fields import FiniteFields
> ---> 11 from sage.schemes.generic.projective_space import ProjectiveSpace
>      12 from sage.rings.fraction_field import FractionField
>      13 from sage.rings.infinity import infinity
> 
> ImportError: No module named projective_space
> sage: 
> ```


This is both unrelated to zn_poly and hardly related to Sage 5.10.beta4.

Outdated `init.sage`?  Cf. #14217, merged into Sage 5.10.beta3.



---

archive/issue_comments_170264.json:
```json
{
    "body": "Replying to [comment:57 leif]:\n> Replying to [comment:56 klee]:\n> > {{{\n> > ---> 11 from sage.schemes.generic.projective_space import ProjectiveSpace\n> > \n> > ImportError: No module named projective_space\n> > }}}\n\n> \n> This is both unrelated to zn_poly and hardly related to Sage 5.10.beta4.\n> \n> Outdated `init.sage`?  Cf. #14217, merged into Sage 5.10.beta3.\n\n\nP.S.:  The relevant \"layout\" change was announced (or suggested) on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/56f410b9f5bd9eac#) a while ago.",
    "created_at": "2013-05-26T01:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170264",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:57 leif]:
> Replying to [comment:56 klee]:
> > {{{
> > ---> 11 from sage.schemes.generic.projective_space import ProjectiveSpace
> > 
> > ImportError: No module named projective_space
> > }}}

> 
> This is both unrelated to zn_poly and hardly related to Sage 5.10.beta4.
> 
> Outdated `init.sage`?  Cf. #14217, merged into Sage 5.10.beta3.


P.S.:  The relevant "layout" change was announced (or suggested) on [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/56f410b9f5bd9eac#) a while ago.



---

archive/issue_comments_170265.json:
```json
{
    "body": "At least this spkg fixes *some* bug, so it's good to have.",
    "created_at": "2013-05-26T19:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170265",
    "user": "https://github.com/jdemeyer"
}
```

At least this spkg fixes *some* bug, so it's good to have.



---

archive/issue_comments_170266.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-26T19:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170266",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_039178.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-26T19:53:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13743#event-39178"
}
```



---

archive/issue_comments_170267.json:
```json
{
    "body": "> At least this spkg fixes *some* bug, so it's good to have.\n\nTrue!  But did you open a new ticket for the original bug, which is probably not resolved by this?  (JP, I assume that on a loaded Cygwin system we still get the original issue.)",
    "created_at": "2013-05-28T02:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170267",
    "user": "https://github.com/kcrisman"
}
```

> At least this spkg fixes *some* bug, so it's good to have.

True!  But did you open a new ticket for the original bug, which is probably not resolved by this?  (JP, I assume that on a loaded Cygwin system we still get the original issue.)



---

archive/issue_comments_170268.json:
```json
{
    "body": "I successfully installed Sage-5.10.rc0 without the zn_poly failure issue. (the error after starting Sage as reported in a previous comment was just because of my own out-dated scripts, and is irrelevant with this ticket. Sorry for the noise.)\n\nThanks a lot!",
    "created_at": "2013-05-30T08:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13743",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13743#issuecomment-170268",
    "user": "https://github.com/kwankyu"
}
```

I successfully installed Sage-5.10.rc0 without the zn_poly failure issue. (the error after starting Sage as reported in a previous comment was just because of my own out-dated scripts, and is irrelevant with this ticket. Sorry for the noise.)

Thanks a lot!
