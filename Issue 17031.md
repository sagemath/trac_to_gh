# Issue 17031: Doctest failures in sagenb

Issue created by migration from https://trac.sagemath.org/ticket/17268

Original creator: jdemeyer

Original creation time: 2014-10-31 13:07:32

With sage-6.4.rc0:


```
$ ./sage -tp --long --sagenb
too many failed tests, not using stored timings
Running doctests with ID 2014-10-31-14-01-49-cac56b83.
Doctesting the Sage notebook.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 51 files using 4 threads.
sage -t --long local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py", line 69, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('A test')
Expected:
    '\n<div class="docstring">\n    \n  <p>A test</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p>A test</p>\n\n\n</div>'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py", line 71, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('**Testing**\n`monospace`')
Expected:
    '\n<div class="docstring"...<strong>Testing</strong>\n<span class="math"...</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><strong>Testing</strong>\n<span class="math">monospace</span></p>\n\n\n</div>'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py", line 73, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('`x=y`')
Expected:
    '\n<div class="docstring">\n    \n  <p><span class="math">x=y</span></p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><span class="math">x=y</span></p>\n\n\n</div>'
**********************************************************************
```



---

Comment by jdemeyer created at 2014-10-31 13:24:15

Changing keywords from "" to "setuptools, sagenb".


---

Comment by jdemeyer created at 2014-10-31 13:24:15

Changing component from notebook to build.


---

Comment by vbraun created at 2014-10-31 14:02:04

maybe the best solution is to switch everything to pip and get rid of easy_install ...


---

Comment by jdemeyer created at 2014-10-31 14:09:31

I have a simple patch ready which simply locks `easy_install.pth` all the time.


---

Comment by jdemeyer created at 2014-10-31 16:36:43

New commits:


---

Comment by jdemeyer created at 2014-10-31 16:36:43

Changing status from new to needs_review.


---

Comment by git created at 2014-10-31 16:38:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2014-10-31 16:44:18

Replying to [comment:4 vbraun]:
> maybe the best solution is to switch everything to pip and get rid of easy_install ...
Does `pip` not have such a race condition?


---

Comment by vbraun created at 2014-10-31 22:56:29

Afaik if you are doing it right (not using editable mode)...


---

Comment by vbraun created at 2014-10-31 22:56:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-11-01 18:36:15

Resolution: fixed


---

Comment by gagern created at 2014-12-19 10:11:29

Hmmâ€¦ I'm seeing the same error messages from `sphinxify`, even without the `--sagenb` flag, and even after manually removing `./sagenb-0.10.8.2-py2.7.egg` from my `easy-install.pth`. Is this some kind of legacy from this bug here, or is this a separate bug in its own right?


---

Comment by jdemeyer created at 2014-12-19 12:18:33

Obvious question: did you run `make`?


---

Comment by jdemeyer created at 2014-12-19 12:19:10

...or are you working on an old branch which doesn't have this patch?


---

Comment by gagern created at 2014-12-19 12:37:43

TL;DR: Found my mistake.

OK, I am on 6.5.beta2 which contains this since it got merged for 6.4.rc1. I guess my main problem was the following: I encountered the problem on a feature branch, then checked whether I could reproduce on develop. To do that, I copied the command line as printed by the test suite runner, The one to execute the test from one single file:


```
sage -t --warn-long 22.0 local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/misc/sphinxify.py
```


I copied that line without really reading it, so I didn't realize that it was referring to the file in the version-specific sagenb directory. Then I started searching for it, found this one here, removed the old sagenb from my pth file, but the executed that same command line.

I guess I had somehow assumed that the error message was due to a bug in the code, and that bug in the code had been fixed by now. The fact that the doctest itself might have been updated didn't occur to me.

Sorry for the noise.
