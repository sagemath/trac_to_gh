# Issue 17031: Doctest failures in sagenb

archive/issues_017031.json:
```json
{
    "body": "With sage-6.4.rc0:\n\n\n```\n$ ./sage -tp --long --sagenb\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2014-10-31-14-01-49-cac56b83.\nDoctesting the Sage notebook.\nSorting sources by runtime so that slower doctests are run first....\nDoctesting 51 files using 4 threads.\nsage -t --long local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py\n**********************************************************************\nFile \"local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py\", line 69, in sagenb.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('A test')\nExpected:\n    '\\n<div class=\"docstring\">\\n    \\n  <p>A test</p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p>A test</p>\\n\\n\\n</div>'\n**********************************************************************\nFile \"local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py\", line 71, in sagenb.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('**Testing**\\n`monospace`')\nExpected:\n    '\\n<div class=\"docstring\"...<strong>Testing</strong>\\n<span class=\"math\"...</p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><strong>Testing</strong>\\n<span class=\"math\">monospace</span></p>\\n\\n\\n</div>'\n**********************************************************************\nFile \"local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py\", line 73, in sagenb.misc.sphinxify.sphinxify\nFailed example:\n    sphinxify('`x=y`')\nExpected:\n    '\\n<div class=\"docstring\">\\n    \\n  <p><span class=\"math\">x=y</span></p>\\n\\n\\n</div>'\nGot:\n    '<div class=\"docstring\">\\n    \\n  <p><span class=\"math\">x=y</span></p>\\n\\n\\n</div>'\n**********************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17268\n\n",
    "created_at": "2014-10-31T13:07:32Z",
    "labels": [
        "component: notebook",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Doctest failures in sagenb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17031",
    "user": "https://github.com/jdemeyer"
}
```
With sage-6.4.rc0:


```
$ ./sage -tp --long --sagenb
too many failed tests, not using stored timings
Running doctests with ID 2014-10-31-14-01-49-cac56b83.
Doctesting the Sage notebook.
Sorting sources by runtime so that slower doctests are run first....
Doctesting 51 files using 4 threads.
sage -t --long local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py", line 69, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('A test')
Expected:
    '\n<div class="docstring">\n    \n  <p>A test</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p>A test</p>\n\n\n</div>'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py", line 71, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('**Testing**\n`monospace`')
Expected:
    '\n<div class="docstring"...<strong>Testing</strong>\n<span class="math"...</p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><strong>Testing</strong>\n<span class="math">monospace</span></p>\n\n\n</div>'
**********************************************************************
File "local/lib/python2.7/site-packages/sagenb-0.10.7.2-py2.7.egg/sagenb/misc/sphinxify.py", line 73, in sagenb.misc.sphinxify.sphinxify
Failed example:
    sphinxify('`x=y`')
Expected:
    '\n<div class="docstring">\n    \n  <p><span class="math">x=y</span></p>\n\n\n</div>'
Got:
    '<div class="docstring">\n    \n  <p><span class="math">x=y</span></p>\n\n\n</div>'
**********************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/17268





---

archive/issue_comments_226179.json:
```json
{
    "body": "Changing keywords from \"\" to \"setuptools, sagenb\".",
    "created_at": "2014-10-31T13:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226179",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "" to "setuptools, sagenb".



---

archive/issue_comments_226180.json:
```json
{
    "body": "Changing component from notebook to build.",
    "created_at": "2014-10-31T13:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226180",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from notebook to build.



---

archive/issue_comments_226181.json:
```json
{
    "body": "maybe the best solution is to switch everything to pip and get rid of easy_install ...",
    "created_at": "2014-10-31T14:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226181",
    "user": "https://github.com/vbraun"
}
```

maybe the best solution is to switch everything to pip and get rid of easy_install ...



---

archive/issue_comments_226182.json:
```json
{
    "body": "I have a simple patch ready which simply locks `easy_install.pth` all the time.",
    "created_at": "2014-10-31T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226182",
    "user": "https://github.com/jdemeyer"
}
```

I have a simple patch ready which simply locks `easy_install.pth` all the time.



---

archive/issue_comments_226183.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-31T16:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226183",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_226184.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-31T16:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226184",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_226185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-31T16:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_226186.json:
```json
{
    "body": "Replying to [comment:4 vbraun]:\n> maybe the best solution is to switch everything to pip and get rid of easy_install ...\nDoes `pip` not have such a race condition?",
    "created_at": "2014-10-31T16:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226186",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 vbraun]:
> maybe the best solution is to switch everything to pip and get rid of easy_install ...
Does `pip` not have such a race condition?



---

archive/issue_comments_226187.json:
```json
{
    "body": "Afaik if you are doing it right (not using editable mode)...",
    "created_at": "2014-10-31T22:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226187",
    "user": "https://github.com/vbraun"
}
```

Afaik if you are doing it right (not using editable mode)...



---

archive/issue_comments_226188.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-31T22:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226188",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_016463.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-11-01T18:36:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17031#event-16463"
}
```



---

archive/issue_comments_226189.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-11-01T18:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226189",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_226190.json:
```json
{
    "body": "Hmm\u2026 I'm seeing the same error messages from `sphinxify`, even without the `--sagenb` flag, and even after manually removing `./sagenb-0.10.8.2-py2.7.egg` from my `easy-install.pth`. Is this some kind of legacy from this bug here, or is this a separate bug in its own right?",
    "created_at": "2014-12-19T10:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226190",
    "user": "https://github.com/gagern"
}
```

Hmm… I'm seeing the same error messages from `sphinxify`, even without the `--sagenb` flag, and even after manually removing `./sagenb-0.10.8.2-py2.7.egg` from my `easy-install.pth`. Is this some kind of legacy from this bug here, or is this a separate bug in its own right?



---

archive/issue_comments_226191.json:
```json
{
    "body": "Obvious question: did you run `make`?",
    "created_at": "2014-12-19T12:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226191",
    "user": "https://github.com/jdemeyer"
}
```

Obvious question: did you run `make`?



---

archive/issue_comments_226192.json:
```json
{
    "body": "...or are you working on an old branch which doesn't have this patch?",
    "created_at": "2014-12-19T12:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226192",
    "user": "https://github.com/jdemeyer"
}
```

...or are you working on an old branch which doesn't have this patch?



---

archive/issue_comments_226193.json:
```json
{
    "body": "TL;DR: Found my mistake.\n\nOK, I am on 6.5.beta2 which contains this since it got merged for 6.4.rc1. I guess my main problem was the following: I encountered the problem on a feature branch, then checked whether I could reproduce on develop. To do that, I copied the command line as printed by the test suite runner, The one to execute the test from one single file:\n\n\n```\nsage -t --warn-long 22.0 local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/misc/sphinxify.py\n```\n\n\nI copied that line without really reading it, so I didn't realize that it was referring to the file in the version-specific sagenb directory. Then I started searching for it, found this one here, removed the old sagenb from my pth file, but the executed that same command line.\n\nI guess I had somehow assumed that the error message was due to a bug in the code, and that bug in the code had been fixed by now. The fact that the doctest itself might have been updated didn't occur to me.\n\nSorry for the noise.",
    "created_at": "2014-12-19T12:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17031",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17031#issuecomment-226193",
    "user": "https://github.com/gagern"
}
```

TL;DR: Found my mistake.

OK, I am on 6.5.beta2 which contains this since it got merged for 6.4.rc1. I guess my main problem was the following: I encountered the problem on a feature branch, then checked whether I could reproduce on develop. To do that, I copied the command line as printed by the test suite runner, The one to execute the test from one single file:


```
sage -t --warn-long 22.0 local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/misc/sphinxify.py
```


I copied that line without really reading it, so I didn't realize that it was referring to the file in the version-specific sagenb directory. Then I started searching for it, found this one here, removed the old sagenb from my pth file, but the executed that same command line.

I guess I had somehow assumed that the error message was due to a bug in the code, and that bug in the code had been fixed by now. The fact that the doctest itself might have been updated didn't occur to me.

Sorry for the noise.
