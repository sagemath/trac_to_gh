# Issue 25398: enhanced make_onic in heegner.py

Issue created by migration from https://trac.sagemath.org/ticket/25635

Original creator: chapoton

Original creation time: 2018-06-22 19:57:05

CC:  cremona

by being more subtle, getting simpler results.

but maybe slower as using radical instead of gcd ?


---

Comment by chapoton created at 2018-06-22 19:57:38

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-06-22 19:57:38

New commits:


---

Comment by chapoton created at 2018-06-24 09:49:01

see also `clear_denominators(poly)` in qqbar.py


---

Comment by chapoton created at 2018-06-24 12:29:35

note that `clear_denominators` assumes that its input is monic

and also the output are in reversed order.

timing comparison with th branch here:

```
sage: %timeit make_monic(x^2 + x/2 + 1/4)
10000 loops, best of 3: 96.6 µs per loop
sage: %timeit clear_denominators(x^2 + x/2 + 1/4)
10000 loops, best of 3: 109 µs per loop
sage: make_monic(3*x^3 + 14*x^2 - 7*x + 5)

sage: %timeit make_monic((3*x^3 + 14*x^2 - 7*x + 5)/3)
10000 loops, best of 3: 112 µs per loop
sage: %timeit clear_denominators((3*x^3 + 14*x^2 - 7*x + 5)/3)
10000 loops, best of 3: 155 µs per loop
```



---

Comment by jdemeyer created at 2018-07-09 07:34:10

Replying to [ticket:25635 chapoton]:
> By being more subtle, getting simpler results.
> 
> but maybe slower because it is using radical instead of gcd ?

It is certainly slower when the denominators are large: computing the radical of N means factoring N.


---

Comment by jdemeyer created at 2018-07-09 07:35:42

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-07-09 07:35:42

I'll make an improvement using trivial division only.


---

Comment by chapoton created at 2018-07-09 08:24:48

Thanks for having a look. This has rather low priority, in my opinion.

Something unrelated : I wonder if you could have a look at a specific failure involving `__div__` in element.pyx in the python3-pdf-docbuild : the full log is here :

https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-07-08%2021:25:52?plugin=docbuild_pdf
----
New commits:


---

Comment by jdemeyer created at 2018-07-09 08:30:58

I also enabled `__future__.division`.


---

Comment by jdemeyer created at 2018-07-09 08:30:58

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-07-09 08:33:32

maybe `for i in range(n)` can start from 1 ?


---

Comment by jdemeyer created at 2018-07-09 12:07:48

Replying to [comment:10 chapoton]:
> maybe `for i in range(n)` can start from 1 ?

What do you mean? Surely we need to look at the constant coefficient too (image the polynomial is `x + 1/2`).


---

Comment by chapoton created at 2018-07-09 12:25:06

But i=0 is for the leading coefficient, no ?

If I run in my mind the code when i=0, I got den=1, and nothing happens..

EDIT: I mean, not in the final creation of the polynomial, but in the main loop.

And maybe the main loop should use range(1,n+1) in fact ?


---

Comment by jdemeyer created at 2018-07-10 14:40:37

Replying to [comment:12 chapoton]:
> But i=0 is for the leading coefficient, no ?

No, the constant coefficient, the coefficient of degree 0.


---

Comment by chapoton created at 2018-07-10 15:12:59

ok, indeed. Sorry for the noise.


---

Comment by chapoton created at 2018-07-10 15:12:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-05 08:18:08

Resolution: fixed
