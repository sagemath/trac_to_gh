# Issue 31339: Projective points over rings with zero divisors

Issue created by migration from https://trac.sagemath.org/ticket/31576

Original creator: wuthrich

Original creation time: 2021-03-28 21:02:14

CC:  bhutz jdefaria slelievre

Keywords: projective points

Currently a point of a projective space over a ring is an accepted input unless all coordinates are zero. For instance,

```
sage: P2 = ProjectiveSpace(Integers(15),2)      
sage: P2(3,3,3)                                                                                                                                        
(3 : 3 : 3)
```

is allowed.
That is a bad convention as they should only be allowed if they generate the ring. Here, at least one entry must be a unit.

The equality between points is tested by the equations `x[i]*y[j]=x[j]*y[i]`
With the troublesome entries above this results in errors like

```
sage: a = P2(3,3,3)
sage: a2 = P2(1,1,1)                                                                                                                                   
sage: b = P2(5,-5,5)                                                                                                                                   
sage: b2 = P2(1,-1,1)
sage: [a2==a,a==b,b==b2,b2==a2]    
[True, True, True, False]
```

    
It seems this code was last modified in #17433, so I CC these authors there.


---

Comment by lorenz created at 2022-01-28 08:00:09

Changing status from new to needs_review.


---

Comment by lorenz created at 2022-01-28 08:00:09

New commits:


---

Comment by slelievre created at 2022-01-28 09:43:45

I disagree with the ticket's summary.

The projective space over `Z/m`, with m composite,
has two types of points:

- points whose coordinates generate the ring
- points whose coordinates do not generate the ring

Both types of points are valid. See

- [Wikipedia: Projective line over a ring](https://en.wikipedia.org/wiki/Projective_line_over_a_ring)

Phrased otherwise, not all lines in `(Z/m)^n`
have the same number of points.

Sometimes only points of the first type matter,
other times both types are useful.


---

Comment by wuthrich created at 2022-01-28 10:04:04

Replying to [comment:5 slelievre]:
> The projective space over `Z/m`, with m composite,
> has two types of points:
> 
> - points whose coordinates generate the ring
> - points whose coordinates do not generate the ring

No, I disagree and the linked page as well! A point in `P^n` over a ring `R` is `(x_0:..x_n)` with `x_0R+...+x_nR = R` quotient by the equivalence relation which is scaling by units in `R`.
Your second kind is not a point. This agrees with viewing `P^n` as a scheme over R and taking its `R`-valued points. It follows that `P^1(Z/pq)` is `P^1(Z/p) x P^1(Z/q)`, that it is the union of affine patches as usual, etc.

Your confusion may stem from the following: Not every equivalence class has the same number of elements in `R^(n+1)`. But that is not the issue here (or ever when dealing projective geometry, I believe).


---

Comment by slelievre created at 2022-01-29 11:36:38

You are of course right. Thanks for unconfusing me.

Does the documentation have examples such as the following?

```
sage: P1 = ProjectiveSpace(Zmod(6), 1)
sage: P1(2, 3)
```



---

Comment by slelievre created at 2022-01-29 11:44:06

Looks good.

Optionally, wrap long lines, e.g. as follows.


```diff
-                    raise ValueError(f"{v} does not define a point in {X.codomain()} since all entries are zero")
+                    raise ValueError(f"{v} does not define a point "
+                                     f"in {X.codomain()} "
+                                     "since all entries are zero")
```



```diff
-                    raise ValueError(f"{v} does not define a point in {X.codomain()} since it is a multiple of a zero divisor")
+                    raise ValueError(f"{v} does not define a point "
+                                     f"in {X.codomain()} since it is "
+                                     "a multiple of a zero divisor")
```



---

Comment by git created at 2022-01-29 17:05:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-01-29 17:13:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-01-29 17:14:56

Done, and also fixed some more doctests. The remaining failures should disappear with #33237.


---

Comment by git created at 2022-02-21 05:51:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-22 05:02:07

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-02-22 05:02:07

The latest changes LGTM. Given comment:8, I am setting a positive review.


---

Comment by vbraun created at 2022-02-27 22:00:45

Resolution: fixed
