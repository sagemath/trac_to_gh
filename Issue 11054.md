# Issue 11054: Sympow spkg fails with gcc 4.6.0

archive/issues_011054.json:
```json
{
    "body": "Assignee: tbd\n\nKeywords: sympow\n\nOn Linux Itanium (ia64) systems, sympow builds with gcc 4.6.0 but fails doctests.\nExample from cleo (RHEL 5.3 ia64 Itanium 2):\n\n```\nsage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/devel/sage-main/sage/lfunctions/sympow.py\", line 213:\n    sage: sympow.modular_degree(EllipticCurve('11a'))\nException raised:\n    Traceback (most recent call last):\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_6[2]>\", line 1, in <module>\n        sympow.modular_degree(EllipticCurve('11a'))###line 213:\n    sage: sympow.modular_degree(EllipticCurve('11a'))\n      File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/lib/python/site-packages/sage/lfunctions/sympow.py\", line 229, in modular_degree\n        raise RuntimeError, \"failed to compute modular degree\"\n    RuntimeError: failed to compute modular degree\n**********************************************************************\n\n[...]\n\nThe following tests failed:\n\n\tsage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed\n\tsage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed\n\tsage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed\n\tsage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed\n----------------------------------------------------------------------\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11226\n\n",
    "created_at": "2011-04-20T15:57:03Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "Sympow spkg fails with gcc 4.6.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11054",
    "user": "jdemeyer"
}
```
Assignee: tbd

Keywords: sympow

On Linux Itanium (ia64) systems, sympow builds with gcc 4.6.0 but fails doctests.
Example from cleo (RHEL 5.3 ia64 Itanium 2):

```
sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/devel/sage-main/sage/lfunctions/sympow.py", line 213:
    sage: sympow.modular_degree(EllipticCurve('11a'))
Exception raised:
    Traceback (most recent call last):
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_6[2]>", line 1, in <module>
        sympow.modular_degree(EllipticCurve('11a'))###line 213:
    sage: sympow.modular_degree(EllipticCurve('11a'))
      File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-4.7.alpha5/local/lib/python/site-packages/sage/lfunctions/sympow.py", line 229, in modular_degree
        raise RuntimeError, "failed to compute modular degree"
    RuntimeError: failed to compute modular degree
**********************************************************************

[...]

The following tests failed:

	sage -t -long  -force_lib devel/sage/sage/modular/hecke/submodule.py # 1 doctests failed
	sage -t -long  -force_lib devel/sage/sage/modular/abvar/abvar.py # 1 doctests failed
	sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py # 13 doctests failed
	sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 17 doctests failed
----------------------------------------------------------------------
```


Issue created by migration from https://trac.sagemath.org/ticket/11226





---

archive/issue_comments_120450.json:
```json
{
    "body": "On first sight, it looks like compiling with `-O1` solves the problem.",
    "created_at": "2011-04-20T16:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120450",
    "user": "jdemeyer"
}
```

On first sight, it looks like compiling with `-O1` solves the problem.



---

archive/issue_comments_120451.json:
```json
{
    "body": "Can't say I am surprised. Any clues from the build log?",
    "created_at": "2011-04-24T01:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120451",
    "user": "fbissey"
}
```

Can't say I am surprised. Any clues from the build log?



---

archive/issue_comments_120452.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> Can't say I am surprised. \n\nMe neither! \n\nDave",
    "created_at": "2011-04-24T02:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120452",
    "user": "drkirkby"
}
```

Replying to [comment:4 fbissey]:
> Can't say I am surprised. 

Me neither! 

Dave



---

archive/issue_comments_120453.json:
```json
{
    "body": "Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?",
    "created_at": "2011-04-27T13:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120453",
    "user": "drkirkby"
}
```

Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?



---

archive/issue_comments_120454.json:
```json
{
    "body": "Replying to [comment:6 drkirkby]:\n> Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?\n\nYes.  I tried compiling with `-O3 -fno-ivopts`, but sadly\nthe reported problem still exists.",
    "created_at": "2011-04-27T19:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120454",
    "user": "mariah"
}
```

Replying to [comment:6 drkirkby]:
> Has the '`-fno-ivopts`' option, (which has fixed several gcc-4.6.0 specific issues), been tried?

Yes.  I tried compiling with `-O3 -fno-ivopts`, but sadly
the reported problem still exists.



---

archive/issue_comments_120455.json:
```json
{
    "body": "If src/QD.c is compiled with -O1 (and the rest with -O3) then\n`sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`\nno longer fails.  \n\nI am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.",
    "created_at": "2011-04-27T20:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120455",
    "user": "mariah"
}
```

If src/QD.c is compiled with -O1 (and the rest with -O3) then
`sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`
no longer fails.  

I am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.



---

archive/issue_comments_120456.json:
```json
{
    "body": "Replying to [comment:8 mariah]:\n> If src/QD.c is compiled with -O1 (and the rest with -O3) then\n> `sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`\n> no longer fails.  \n> \n> I am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.\n\nYou are a brave lady Mariah - any code in SYMPOW is difficult to understand. Bill  Hart described it as \"virtually obfuscated\". Unfortunately, since it not actually standard C (the Sun compiler wont compile it), it can't be entered into The International Obfuscated C Code Contest\n\nhttp://www.ioccc.org/\n\nI particualry like SYMPOW's Configure script\n\nhttp://boxen.math.washington.edu/home/kirkby/bad-code/sympow-1.018.1.p7/src/Configure\n\nwhich starts off\n\n\n```/bin/sh\n```\n\n\nthen later has a test to see if sh exists on the system!\n\n\n```\nSH=`whichexe sh` && echo \"#define SH \\\"$SH\\\"\" >> $CONFIG\nif [ -z \"$SH\" ]; then\n  echo \"**ERROR**: Could not find sh\"; exit 1;\nelse\n  echo \"SH = $SH\"\nfi\n```\n\n\nGood luck Mariah - I don't envy you. \n\nDave",
    "created_at": "2011-04-27T21:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120456",
    "user": "drkirkby"
}
```

Replying to [comment:8 mariah]:
> If src/QD.c is compiled with -O1 (and the rest with -O3) then
> `sage -t -long  -force_lib devel/sage/sage/lfunctions/sympow.py`
> no longer fails.  
> 
> I am working on isolating the code in QD.c that demonstrates the gcc-4.6.0 optimization bug.

You are a brave lady Mariah - any code in SYMPOW is difficult to understand. Bill  Hart described it as "virtually obfuscated". Unfortunately, since it not actually standard C (the Sun compiler wont compile it), it can't be entered into The International Obfuscated C Code Contest

http://www.ioccc.org/

I particualry like SYMPOW's Configure script

http://boxen.math.washington.edu/home/kirkby/bad-code/sympow-1.018.1.p7/src/Configure

which starts off


```/bin/sh
```


then later has a test to see if sh exists on the system!


```
SH=`whichexe sh` && echo "#define SH \"$SH\"" >> $CONFIG
if [ -z "$SH" ]; then
  echo "**ERROR**: Could not find sh"; exit 1;
else
  echo "SH = $SH"
fi
```


Good luck Mariah - I don't envy you. 

Dave



---

archive/issue_comments_120457.json:
```json
{
    "body": "Changing assignee from tbd to mariah.",
    "created_at": "2011-04-29T14:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120457",
    "user": "mariah"
}
```

Changing assignee from tbd to mariah.



---

archive/issue_comments_120458.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-29T16:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120458",
    "user": "mariah"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120459.json:
```json
{
    "body": "gcc-4.6.0 optimization regression of src/QD.c reported to gcc bugzilla [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)",
    "created_at": "2011-04-29T16:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120459",
    "user": "mariah"
}
```

gcc-4.6.0 optimization regression of src/QD.c reported to gcc bugzilla [http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823](http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48823)



---

archive/issue_comments_120460.json:
```json
{
    "body": "Hi Mariah, \n\nthe test in the code \n\n\n```\nif [ \"`uname -m`\" = \"ia64\" ] && [ $CC = \"gcc\" ]; then \n```\n\n\nwill fail if CC is set to something like /usr/local/bin/gcc. In this case, $CC is not just gcc. \n\nI would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that __GNU__ is defined. Then use something like the following, which I'm doing from memory and have not tested. \n\n\n```\nif [ \"x$UNAME\" = xLinux ] && [ \"x`$SAGE_LOCAL/bin/testcc.sh $CC`\" = xGCC ] && [ \"x`$CC -dumpversion 2>/dev/null`\" = x4.6.0 ] ; then  \n```\n\n\nThat will\n* Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor. \n* Since the first test uses $UNAME, it should be faster on non-Linux systems, as there is no need to call any external scripts or programs. \n* $CC really is a GNU-like compiler. \n\nYou might want to review #11169 which changes the exit code of the script testcc.sh if it fails. But it wont effect your code here, as you are checking the text output. \n\nDave",
    "created_at": "2011-04-29T23:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120460",
    "user": "drkirkby"
}
```

Hi Mariah, 

the test in the code 


```
if [ "`uname -m`" = "ia64" ] && [ $CC = "gcc" ]; then 
```


will fail if CC is set to something like /usr/local/bin/gcc. In this case, $CC is not just gcc. 

I would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that __GNU__ is defined. Then use something like the following, which I'm doing from memory and have not tested. 


```
if [ "x$UNAME" = xLinux ] && [ "x`$SAGE_LOCAL/bin/testcc.sh $CC`" = xGCC ] && [ "x`$CC -dumpversion 2>/dev/null`" = x4.6.0 ] ; then  
```


That will
* Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor. 
* Since the first test uses $UNAME, it should be faster on non-Linux systems, as there is no need to call any external scripts or programs. 
* $CC really is a GNU-like compiler. 

You might want to review #11169 which changes the exit code of the script testcc.sh if it fails. But it wont effect your code here, as you are checking the text output. 

Dave



---

archive/issue_comments_120461.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-29T23:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120461",
    "user": "drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120462.json:
```json
{
    "body": "Replying to [comment:12 drkirkby]:\n>  * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.\n\nI would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).",
    "created_at": "2011-04-30T10:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120462",
    "user": "jdemeyer"
}
```

Replying to [comment:12 drkirkby]:
>  * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.

I would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).



---

archive/issue_comments_120463.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> Replying to [comment:12 drkirkby]:\n> >  * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.\n> \n> I would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).\n\nFair enough, so change the test to something like:\n\n\n```\nif [ \"x`$SAGE_LOCAL/bin/testcc.sh $CC`\" = xGCC ] && [ \"x`$CC -dumpversion 2>/dev/null`\" = x4.6.0 ] ; then  \n```\n\n\nthen we will know it is gcc, even if someone sets the environment variable CC to be {{{/usr/local/bin/gcc}}\n\nThis release of gcc seems to have caused a fair number of problems for Sage. I'm not aware of any other gcc \"upgrade\" which has caused so much trouble. \n\nDave",
    "created_at": "2011-05-01T17:50:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120463",
    "user": "drkirkby"
}
```

Replying to [comment:13 jdemeyer]:
> Replying to [comment:12 drkirkby]:
> >  * Ensure the test only gets performed on Linux. We currently have no evidence to assume this will be an issue on HP-UX, which also runs on the Itanium processor.
> 
> I would prefer to be on the safe side and lower the optimization on *any* ia64 machine (Linux or not).

Fair enough, so change the test to something like:


```
if [ "x`$SAGE_LOCAL/bin/testcc.sh $CC`" = xGCC ] && [ "x`$CC -dumpversion 2>/dev/null`" = x4.6.0 ] ; then  
```


then we will know it is gcc, even if someone sets the environment variable CC to be {{{/usr/local/bin/gcc}}

This release of gcc seems to have caused a fair number of problems for Sage. I'm not aware of any other gcc "upgrade" which has caused so much trouble. 

Dave



---

archive/issue_comments_120464.json:
```json
{
    "body": "Replying to [comment:12 drkirkby]:\n\n> I would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that __GNU!__ is defined.\n\nThe trac formatting has screwed that up a bit. The script `$SAGE_ROOT/local/bin/testcc.sh` checks if !__GNU!__ is defined (I have to put a couple of exclamation marks to escape the formatting, as two underscores causes the text to be underlined).\n\nDave",
    "created_at": "2011-05-01T18:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120464",
    "user": "drkirkby"
}
```

Replying to [comment:12 drkirkby]:

> I would suggest making use of the script `$SAGE_ROOT/local/bin/testcc.sh`, which actually compiles a bit of code and checks that __GNU!__ is defined.

The trac formatting has screwed that up a bit. The script `$SAGE_ROOT/local/bin/testcc.sh` checks if !__GNU!__ is defined (I have to put a couple of exclamation marks to escape the formatting, as two underscores causes the text to be underlined).

Dave



---

archive/issue_comments_120465.json:
```json
{
    "body": "I simplified the testcase and came up with the following minimal code to demonstrate the problem:\n\n```\nextern int printf (__const char *__restrict __format, ...);\n\ndouble p0 = 2.718281828459045091e+00;\ndouble p1 = 1.445646891729250158e-16;\ndouble q0 = 3.141592653589793116e+00;\ndouble q1 = 1.224646799147353207e-16;\n\nint main()\n{\n  double x;\n  x = p0*q1 + p1*q0 + p0*q0;\n  printf(\"%a\\n\", x);\n\n  return 0;\n}\n```\n\n\nAlso, `-fno-expensive-optimizations` solves this problem.",
    "created_at": "2011-05-02T09:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120465",
    "user": "jdemeyer"
}
```

I simplified the testcase and came up with the following minimal code to demonstrate the problem:

```
extern int printf (__const char *__restrict __format, ...);

double p0 = 2.718281828459045091e+00;
double p1 = 1.445646891729250158e-16;
double q0 = 3.141592653589793116e+00;
double q1 = 1.224646799147353207e-16;

int main()
{
  double x;
  x = p0*q1 + p1*q0 + p0*q0;
  printf("%a\n", x);

  return 0;
}
```


Also, `-fno-expensive-optimizations` solves this problem.



---

archive/issue_comments_120466.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2011-05-02T10:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120466",
    "user": "jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_120467.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-02T10:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120467",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120468.json:
```json
{
    "body": "New spkg (with uncommitted changes) needs review: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)",
    "created_at": "2011-05-02T10:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120468",
    "user": "jdemeyer"
}
```

New spkg (with uncommitted changes) needs review: [http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/sympow-1.018.1.p9.spkg)



---

archive/issue_comments_120469.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-03T12:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120469",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120470.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-03T12:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120470",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120471.json:
```json
{
    "body": "Changing keywords from \"sympow\" to \"sympow spkg\".",
    "created_at": "2011-05-03T12:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120471",
    "user": "jdemeyer"
}
```

Changing keywords from "sympow" to "sympow spkg".



---

archive/issue_comments_120472.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-05-03T15:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120472",
    "user": "drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120473.json:
```json
{
    "body": "The changes are not checked in\n\n\n```\ndrkirkby@hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status\nM SPKG.txt\nM spkg-install\n```\n\n\nThat obviously needs fixing. A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *\"Working around problems with gcc 4.6.0 on Itanium systems\"*\n\nDave",
    "created_at": "2011-05-03T15:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120473",
    "user": "drkirkby"
}
```

The changes are not checked in


```
drkirkby@hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status
M SPKG.txt
M spkg-install
```


That obviously needs fixing. A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *"Working around problems with gcc 4.6.0 on Itanium systems"*

Dave



---

archive/issue_comments_120474.json:
```json
{
    "body": "I recommend that the patch only apply to gcc-4.6.0.  It might\nbe fixed in later gcc versions.",
    "created_at": "2011-05-03T20:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120474",
    "user": "mariah"
}
```

I recommend that the patch only apply to gcc-4.6.0.  It might
be fixed in later gcc versions.



---

archive/issue_comments_120475.json:
```json
{
    "body": "Replying to [comment:23 mariah]:\n> I recommend that the patch only apply to gcc-4.6.0.  It might\n> be fixed in later gcc versions.\n\nI think that having the workaround for all versions 4.6.x doesn't really hurt. It is certainly a safer alternative than applying the workaround only for gcc 4.6.0. If at some point, this bug is fixed in a later gcc 4.6.x, then we can still change the spkg accordingly.",
    "created_at": "2011-05-04T07:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120475",
    "user": "jdemeyer"
}
```

Replying to [comment:23 mariah]:
> I recommend that the patch only apply to gcc-4.6.0.  It might
> be fixed in later gcc versions.

I think that having the workaround for all versions 4.6.x doesn't really hurt. It is certainly a safer alternative than applying the workaround only for gcc 4.6.0. If at some point, this bug is fixed in a later gcc 4.6.x, then we can still change the spkg accordingly.



---

archive/issue_comments_120476.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-05-04T09:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120476",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120477.json:
```json
{
    "body": "Replying to [comment:22 drkirkby]:\n> The changes are not checked in\n> \n> {{{\n> drkirkby`@`hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status\n> M SPKG.txt\n> M spkg-install\n> }}}\n> \n> That obviously needs fixing.\nNever mind this, it will be fixed after positive_review.\n\n> A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *\"Working around problems with gcc 4.6.0 on Itanium systems\"*\nI have changed the comment slightly to:\n\n```\n        echo \"Detected GCC version `$CC -dumpversion` on Itanium. Adding\"\n        echo \"work-around to fix a bug when sympow is compiled with gcc 4.6.0\"\n```\n",
    "created_at": "2011-05-04T09:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120477",
    "user": "jdemeyer"
}
```

Replying to [comment:22 drkirkby]:
> The changes are not checked in
> 
> {{{
> drkirkby`@`hawk:~/sage-4.7.rc0/spkg/standard/sympow-1.018.1.p9$ hg status
> M SPKG.txt
> M spkg-install
> }}}
> 
> That obviously needs fixing.
Never mind this, it will be fixed after positive_review.

> A minor point, gcc 4.6.1 will cause the patch to be applied too, despite the comment saying *"Working around problems with gcc 4.6.0 on Itanium systems"*
I have changed the comment slightly to:

```
        echo "Detected GCC version `$CC -dumpversion` on Itanium. Adding"
        echo "work-around to fix a bug when sympow is compiled with gcc 4.6.0"
```




---

archive/issue_comments_120478.json:
```json
{
    "body": "Diff for the sympow spkg, for reviewing only",
    "created_at": "2011-05-04T09:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120478",
    "user": "jdemeyer"
}
```

Diff for the sympow spkg, for reviewing only



---

archive/issue_comments_120479.json:
```json
{
    "body": "Attachment [sympow-1.018.1.p8-p9.diff](tarball://root/attachments/some-uuid/ticket11226/sympow-1.018.1.p8-p9.diff) by jdemeyer created at 2011-05-05 13:37:16",
    "created_at": "2011-05-05T13:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120479",
    "user": "jdemeyer"
}
```

Attachment [sympow-1.018.1.p8-p9.diff](tarball://root/attachments/some-uuid/ticket11226/sympow-1.018.1.p8-p9.diff) by jdemeyer created at 2011-05-05 13:37:16



---

archive/issue_comments_120480.json:
```json
{
    "body": "That looks fine, so positive review, though don't forget to commit the changes.",
    "created_at": "2011-05-05T21:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120480",
    "user": "drkirkby"
}
```

That looks fine, so positive review, though don't forget to commit the changes.



---

archive/issue_comments_120481.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-05-05T21:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120481",
    "user": "drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120482.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-05-06T07:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120482",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_120483.json:
```json
{
    "body": "According to gcc, it's okay to violate the floating-point standard with `-O3`.  They also say the correct workaround is the **undocumented** option\n\n```\n-ffp-contract=on\n```\n",
    "created_at": "2011-10-13T19:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120483",
    "user": "jdemeyer"
}
```

According to gcc, it's okay to violate the floating-point standard with `-O3`.  They also say the correct workaround is the **undocumented** option

```
-ffp-contract=on
```




---

archive/issue_comments_120484.json:
```json
{
    "body": "Sorry, it is documented.  I was looking at documentation of an older gcc.",
    "created_at": "2011-10-13T19:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120484",
    "user": "jdemeyer"
}
```

Sorry, it is documented.  I was looking at documentation of an older gcc.



---

archive/issue_comments_120485.json:
```json
{
    "body": "From [http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html):\n\n```\n-ffp-contract=style\n    -ffp-contract=off disables floating-point expression contraction. -ffp-contract=fast enables floating-point expression contraction such as forming of fused multiply-add operations if the target has native support for them. -ffp-contract=on enables floating-point expression contraction if allowed by the language standard. This is currently not implemented and treated equal to -ffp-contract=off.\n\n    The default is -ffp-contract=fast.\n```\n",
    "created_at": "2011-10-13T19:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11054#issuecomment-120485",
    "user": "jdemeyer"
}
```

From [http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html](http://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html):

```
-ffp-contract=style
    -ffp-contract=off disables floating-point expression contraction. -ffp-contract=fast enables floating-point expression contraction such as forming of fused multiply-add operations if the target has native support for them. -ffp-contract=on enables floating-point expression contraction if allowed by the language standard. This is currently not implemented and treated equal to -ffp-contract=off.

    The default is -ffp-contract=fast.
```

