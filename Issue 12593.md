# Issue 12593: MPIR doesn't compile with GCC-4.7.0 on ia64

archive/issues_012593.json:
```json
{
    "body": "Assignee: tbd\n\nSee #12751 for the GCC-4.7.0 metaticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12765\n\n",
    "created_at": "2012-03-28T06:58:31Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "MPIR doesn't compile with GCC-4.7.0 on ia64",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12593",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: tbd

See #12751 for the GCC-4.7.0 metaticket.

Issue created by migration from https://trac.sagemath.org/ticket/12765





---

archive/issue_comments_149525.json:
```json
{
    "body": "Doesn't look like they've already fixed this upstream, they only work around the problem in libffi.\n\nOr did you test some svn version?",
    "created_at": "2012-04-04T20:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149525",
    "user": "https://github.com/nexttime"
}
```

Doesn't look like they've already fixed this upstream, they only work around the problem in libffi.

Or did you test some svn version?



---

archive/issue_comments_149526.json:
```json
{
    "body": "Replying to [comment:4 leif]:\n> Doesn't look like they've already fixed this upstream, they only work around the problem in libffi.\n> \n> Or did you test some svn version?\nI haven't tested anything, I just believed the GCC Bugzilla.",
    "created_at": "2012-04-04T20:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149526",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 leif]:
> Doesn't look like they've already fixed this upstream, they only work around the problem in libffi.
> 
> Or did you test some svn version?
I haven't tested anything, I just believed the GCC Bugzilla.



---

archive/issue_comments_149527.json:
```json
{
    "body": "The MPIR 2.4.0.**p2** spkg at #11616 now includes a work-around for this bug (*almost* completely disabling optimization on Linux ia64 with GCC 4.7.**x**).",
    "created_at": "2012-04-05T15:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149527",
    "user": "https://github.com/nexttime"
}
```

The MPIR 2.4.0.**p2** spkg at #11616 now includes a work-around for this bug (*almost* completely disabling optimization on Linux ia64 with GCC 4.7.**x**).



---

archive/issue_comments_149528.json:
```json
{
    "body": "Looks like we'd have the same problem with NTL:\n\n```\n...\ng++ -I../include -I.  -O2 -g -O3 -g -DHONORS_CXXFLAGS  -fPIC -c  FFT.c\nIn file included from ../include/NTL/ZZ.h:1804:0,\n                 from ../include/NTL/FFT.h:7,\n                 from FFT.c:3:\n../include/NTL/SPMM_ASM.h: In function \u2018void NTL::FFT(long int*, const long int*, long int, long int, const long int*)\u2019:\n../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\nmake[3]: *** [FFT.o] Error 1\nmake[3]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'\nmake[2]: *** [libntl.so] Error 2\nmake[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'\nError creating ntl shared library.\n...\n```\n",
    "created_at": "2012-04-05T17:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149528",
    "user": "https://github.com/nexttime"
}
```

Looks like we'd have the same problem with NTL:

```
...
g++ -I../include -I.  -O2 -g -O3 -g -DHONORS_CXXFLAGS  -fPIC -c  FFT.c
In file included from ../include/NTL/ZZ.h:1804:0,
                 from ../include/NTL/FFT.h:7,
                 from FFT.c:3:
../include/NTL/SPMM_ASM.h: In function ‘void NTL::FFT(long int*, const long int*, long int, long int, const long int*)’:
../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
make[3]: *** [FFT.o] Error 1
make[3]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'
make[2]: *** [libntl.so] Error 2
make[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'
Error creating ntl shared library.
...
```




---

archive/issue_comments_149529.json:
```json
{
    "body": "... also zn_poly.",
    "created_at": "2012-04-05T18:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149529",
    "user": "https://github.com/nexttime"
}
```

... also zn_poly.



---

archive/issue_comments_149530.json:
```json
{
    "body": "Replying to [comment:8 leif]:\n> ... also zn_poly.\n\nAnd overrides `-O0 ...` in `CFLAGS` with `-O3`... >8(",
    "created_at": "2012-04-05T18:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149530",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:8 leif]:
> ... also zn_poly.

And overrides `-O0 ...` in `CFLAGS` with `-O3`... >8(



---

archive/issue_comments_149531.json:
```json
{
    "body": "Replying to [comment:7 leif]:\n> Looks like we'd have the same problem with NTL:\n> {{{\n> ...\n> g++ -I../include -I.  -O2 -g -O3 -g -DHONORS_CXXFLAGS  -fPIC -c  FFT.c\n> In file included from ../include/NTL/ZZ.h:1804:0,\n>                  from ../include/NTL/FFT.h:7,\n>                  from FFT.c:3:\n> ../include/NTL/SPMM_ASM.h: In function \u2018void NTL::FFT(long int*, const long int*, long int, long int, const long int*)\u2019:\n> ../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n> ../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n> ../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n> ../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n> ../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n> ../include/NTL/SPMM_ASM.h:103:69: error: \u2018asm\u2019 operand requires impossible reload\n> make[3]: *** [FFT.o] Error 1\n> make[3]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'\n> make[2]: *** [libntl.so] Error 2\n> make[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'\n> Error creating ntl shared library.\n> ...\n> }}}\n\nDespite that, after a second try with `-fno-strict-aliasing -O3` (and again at least parts of these errors), the spkg is reported to have successfully been installed... ?",
    "created_at": "2012-04-05T18:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149531",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:7 leif]:
> Looks like we'd have the same problem with NTL:
> {{{
> ...
> g++ -I../include -I.  -O2 -g -O3 -g -DHONORS_CXXFLAGS  -fPIC -c  FFT.c
> In file included from ../include/NTL/ZZ.h:1804:0,
>                  from ../include/NTL/FFT.h:7,
>                  from FFT.c:3:
> ../include/NTL/SPMM_ASM.h: In function ‘void NTL::FFT(long int*, const long int*, long int, long int, const long int*)’:
> ../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
> ../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
> ../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
> ../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
> ../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
> ../include/NTL/SPMM_ASM.h:103:69: error: ‘asm’ operand requires impossible reload
> make[3]: *** [FFT.o] Error 1
> make[3]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'
> make[2]: *** [libntl.so] Error 2
> make[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/ntl-5.5.2/src/src'
> Error creating ntl shared library.
> ...
> }}}

Despite that, after a second try with `-fno-strict-aliasing -O3` (and again at least parts of these errors), the spkg is reported to have successfully been installed... ?



---

archive/issue_comments_149532.json:
```json
{
    "body": "Replying to [comment:9 leif]:\n> Replying to [comment:8 leif]:\n> > ... also zn_poly.\n> \n> And overrides `-O0 ...` in `CFLAGS` with `-O3`... >8(\n\nAnd that's *not* upstream.  From `spkg-install` (which is a mess):\n\n```sh\n...\nCFLAGS=\"$CFLAGS -g -fPIC -O3 -L.\"; export CFLAGS\nLDFLAGS=\"$LDFLAGS\"; export LDFLAGS\n...\n```\n\n\nOMG.",
    "created_at": "2012-04-05T18:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149532",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:9 leif]:
> Replying to [comment:8 leif]:
> > ... also zn_poly.
> 
> And overrides `-O0 ...` in `CFLAGS` with `-O3`... >8(

And that's *not* upstream.  From `spkg-install` (which is a mess):

```sh
...
CFLAGS="$CFLAGS -g -fPIC -O3 -L."; export CFLAGS
LDFLAGS="$LDFLAGS"; export LDFLAGS
...
```


OMG.



---

archive/issue_comments_149533.json:
```json
{
    "body": "Furthermore: GMP-ECM, FLINT, MPFR and PARI.",
    "created_at": "2012-04-05T19:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149533",
    "user": "https://github.com/nexttime"
}
```

Furthermore: GMP-ECM, FLINT, MPFR and PARI.



---

archive/issue_comments_149534.json:
```json
{
    "body": "Jeroen, should I open separate (GCC 4.7 on ia64) tickets for these, or perhaps just one meta-ticket?\n\nFLINT and zn_poly are currently \"under construction\" anyway; Andrew Ohana slightly fixed these just to respect `CC` and `CXX` for the `clang` port, so we could also do (little) changes on those open tickets.\n\n(For FLINT there's also the ARM port ticket, which upgrades to 1.5.2 and thereby makes a couple of changes unnecessary, or at least different, with less effort.  I also have an old, broadly cleaned-up FLINT 1.5.2 spkg, which I believe would need some work, at least some rebasing.)\n\n[GMP-ECM, MPFR and PARI seem to build with `-O0 [-finline-functions -fschedule-insns]` in `C/CPP/CXXFLAGS`, without further changes to their `spkg-install` or Makefiles etc.; haven't yet tried with `SAGE_CHECK=yes` though.]",
    "created_at": "2012-04-05T20:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149534",
    "user": "https://github.com/nexttime"
}
```

Jeroen, should I open separate (GCC 4.7 on ia64) tickets for these, or perhaps just one meta-ticket?

FLINT and zn_poly are currently "under construction" anyway; Andrew Ohana slightly fixed these just to respect `CC` and `CXX` for the `clang` port, so we could also do (little) changes on those open tickets.

(For FLINT there's also the ARM port ticket, which upgrades to 1.5.2 and thereby makes a couple of changes unnecessary, or at least different, with less effort.  I also have an old, broadly cleaned-up FLINT 1.5.2 spkg, which I believe would need some work, at least some rebasing.)

[GMP-ECM, MPFR and PARI seem to build with `-O0 [-finline-functions -fschedule-insns]` in `C/CPP/CXXFLAGS`, without further changes to their `spkg-install` or Makefiles etc.; haven't yet tried with `SAGE_CHECK=yes` though.]



---

archive/issue_comments_149535.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> Jeroen, should I open separate (GCC 4.7 on ia64) tickets for these, or perhaps just one meta-ticket?\nTo be honest, I don't care too much about these issues...  It makes more sense to open a ticket to blacklist GCC-4.7.0 on ia64, i.e. build Sage's GCC-4.6.3 in this case.\n\nI'm currently building an svn version of GCC-4.7.x to see whether the problem is fixed.",
    "created_at": "2012-04-05T20:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149535",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 leif]:
> Jeroen, should I open separate (GCC 4.7 on ia64) tickets for these, or perhaps just one meta-ticket?
To be honest, I don't care too much about these issues...  It makes more sense to open a ticket to blacklist GCC-4.7.0 on ia64, i.e. build Sage's GCC-4.6.3 in this case.

I'm currently building an svn version of GCC-4.7.x to see whether the problem is fixed.



---

archive/issue_comments_149536.json:
```json
{
    "body": "MPFR though is a dependency for GCC, so that's more important.",
    "created_at": "2012-04-05T20:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149536",
    "user": "https://github.com/jdemeyer"
}
```

MPFR though is a dependency for GCC, so that's more important.



---

archive/issue_comments_149537.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> MPFR though is a dependency for GCC, so that's more important.\n\nYep.",
    "created_at": "2012-04-05T20:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149537",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 jdemeyer]:
> MPFR though is a dependency for GCC, so that's more important.

Yep.



---

archive/issue_comments_149538.json:
```json
{
    "body": "This one is more funny:\n\n```\n...\ng++: error: unrecognized command line option \u2018-m64\u2019\nmake[2]: *** [gfan] Error 1\nmake[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/gfan-0.4plus.p2/src'\nError building gfan.\n...\n```\n",
    "created_at": "2012-04-05T21:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149538",
    "user": "https://github.com/nexttime"
}
```

This one is more funny:

```
...
g++: error: unrecognized command line option ‘-m64’
make[2]: *** [gfan] Error 1
make[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/gfan-0.4plus.p2/src'
Error building gfan.
...
```




---

archive/issue_comments_149539.json:
```json
{
    "body": "That's weird because GCC on ia64 never supported `-m64` AFAIK.  So it should fail with any GCC version.",
    "created_at": "2012-04-05T21:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149539",
    "user": "https://github.com/jdemeyer"
}
```

That's weird because GCC on ia64 never supported `-m64` AFAIK.  So it should fail with any GCC version.



---

archive/issue_comments_149540.json:
```json
{
    "body": "Replying to [comment:17 leif]:\n> This one is more funny:\n> {{{\n> ...\n> g++: error: unrecognized command line option \u2018-m64\u2019\n> make[2]: *** [gfan] Error 1\n> make[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/gfan-0.4plus.p2/src'\n> Error building gfan.\n> ...\n> }}}\n\nThe funniest thing being that **that is my fault**... B)\n\n(since I made the p2, apparently without looking at the patched Makefile, and without testing on non-x86_64 systems)",
    "created_at": "2012-04-05T21:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149540",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:17 leif]:
> This one is more funny:
> {{{
> ...
> g++: error: unrecognized command line option ‘-m64’
> make[2]: *** [gfan] Error 1
> make[2]: Leaving directory `/home/leif/Sage/release/build/iras/sage-5.0.beta12-gcc-4.7.0/spkg/build/gfan-0.4plus.p2/src'
> Error building gfan.
> ...
> }}}

The funniest thing being that **that is my fault**... B)

(since I made the p2, apparently without looking at the patched Makefile, and without testing on non-x86_64 systems)



---

archive/issue_comments_149541.json:
```json
{
    "body": "Replying to [comment:4 leif]:\n> Doesn't look like they've already fixed this upstream, they only work around the problem in libffi.\n\nYou are right, it is not fixed upsteam (I tried the latest svn version of the 4.7 branch on cleo).",
    "created_at": "2012-04-06T14:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149541",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:4 leif]:
> Doesn't look like they've already fixed this upstream, they only work around the problem in libffi.

You are right, it is not fixed upsteam (I tried the latest svn version of the 4.7 branch on cleo).



---

archive/issue_comments_149542.json:
```json
{
    "body": "Replying to [comment:11 leif]:\n> Replying to [comment:9 leif]:\n> > Replying to [comment:8 leif]:\n> > > ... also zn_poly.\n> > \n> > And overrides `-O0 ...` in `CFLAGS` with `-O3`... >8(\n> \n> And that's *not* upstream.  From `spkg-install` (which is a mess):\n> {{{\n> #!sh\n> ...\n> CFLAGS=\"$CFLAGS -g -fPIC -O3 -L.\"; export CFLAGS\n> LDFLAGS=\"$LDFLAGS\"; export LDFLAGS\n> ...\n> }}}\n> \n> OMG.\n\nForgot: A fixed zn_poly spkg (not yet taking care of GCC 4.7.0 on ia64 IIRC) is available at #12433, still needing review.  (The main purpose of that ticket was to make zn_poly respect `CC` etc.; it now also does a major clean-up.)",
    "created_at": "2012-04-14T21:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149542",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:11 leif]:
> Replying to [comment:9 leif]:
> > Replying to [comment:8 leif]:
> > > ... also zn_poly.
> > 
> > And overrides `-O0 ...` in `CFLAGS` with `-O3`... >8(
> 
> And that's *not* upstream.  From `spkg-install` (which is a mess):
> {{{
> #!sh
> ...
> CFLAGS="$CFLAGS -g -fPIC -O3 -L."; export CFLAGS
> LDFLAGS="$LDFLAGS"; export LDFLAGS
> ...
> }}}
> 
> OMG.

Forgot: A fixed zn_poly spkg (not yet taking care of GCC 4.7.0 on ia64 IIRC) is available at #12433, still needing review.  (The main purpose of that ticket was to make zn_poly respect `CC` etc.; it now also does a major clean-up.)



---

archive/issue_comments_149543.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-04-30T10:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12593#issuecomment-149543",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
