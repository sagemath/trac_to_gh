# Issue 28176: Add .h_star_vector to compact rational polytopes

archive/issues_028176.json:
```json
{
    "body": "CC:  selia chapoton winfried vdelecroix mkoeppe\n\nKeywords: polytopes, normaliz\n\nSince #25091 is merged, we can compute a few more things with normaliz. One important object is the so-called `h^*`-vector, see https://en.wikipedia.org/wiki/Ehrhart_polynomial#Ehrhart_series for details.\n\nThis ticket implements this method. Currently, one has to do the following:\n\n\n```\nsage: C = polytopes.hypercube(3, backend=\"normaliz\")\nsage: C.ehrhart_series().numerator().coefficients()\n[1, 23, 23, 1]\n```\n\n\nwhich would now become:\n\n\n```\nsage: C.h_star_vector()\n```\n\n\nand return an error if the backend is not `'normaliz'`...\n\nSee the related SageAsk question: https://ask.sagemath.org/question/32505/can-sage-compute-the-h-vector-of-a-polytope/\n\nEventually, it would be nice to also make this possible for polymake too (it would be interesting to know if they use `'normaliz'` for that).\n\nIssue created by migration from https://trac.sagemath.org/ticket/28413\n\n",
    "created_at": "2019-08-27T14:19:11Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Add .h_star_vector to compact rational polytopes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28176",
    "user": "jipilab"
}
```
CC:  selia chapoton winfried vdelecroix mkoeppe

Keywords: polytopes, normaliz

Since #25091 is merged, we can compute a few more things with normaliz. One important object is the so-called `h^*`-vector, see https://en.wikipedia.org/wiki/Ehrhart_polynomial#Ehrhart_series for details.

This ticket implements this method. Currently, one has to do the following:


```
sage: C = polytopes.hypercube(3, backend="normaliz")
sage: C.ehrhart_series().numerator().coefficients()
[1, 23, 23, 1]
```


which would now become:


```
sage: C.h_star_vector()
```


and return an error if the backend is not `'normaliz'`...

See the related SageAsk question: https://ask.sagemath.org/question/32505/can-sage-compute-the-h-vector-of-a-polytope/

Eventually, it would be nice to also make this possible for polymake too (it would be interesting to know if they use `'normaliz'` for that).

Issue created by migration from https://trac.sagemath.org/ticket/28413





---

archive/issue_comments_397773.json:
```json
{
    "body": "For the h<sup>*</sup>-vector o be well-defined, the polytope should have integral vertices. Otherwise there is no canonical choice for the denominator and, hence, the numerator of the Ehrhart series (as a rational function).\n\nAt least one should check that the denominator is a power of 1-t.",
    "created_at": "2019-08-27T14:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397773",
    "user": "@w-bruns"
}
```

For the h<sup>*</sup>-vector o be well-defined, the polytope should have integral vertices. Otherwise there is no canonical choice for the denominator and, hence, the numerator of the Ehrhart series (as a rational function).

At least one should check that the denominator is a power of 1-t.



---

archive/issue_comments_397774.json:
```json
{
    "body": "Replying to [comment:1 gh-w-bruns]:\n> For the h<sup>*</sup>-vector o be well-defined, the polytope should have integral vertices. Otherwise there is no canonical choice for the denominator and, hence, the numerator of the Ehrhart series (as a rational function).\n> \n> At least one should check that the denominator is a power of 1-t.\n\nOkay! great, good to know. We'll put this check into the function.",
    "created_at": "2019-08-27T15:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397774",
    "user": "jipilab"
}
```

Replying to [comment:1 gh-w-bruns]:
> For the h<sup>*</sup>-vector o be well-defined, the polytope should have integral vertices. Otherwise there is no canonical choice for the denominator and, hence, the numerator of the Ehrhart series (as a rational function).
> 
> At least one should check that the denominator is a power of 1-t.

Okay! great, good to know. We'll put this check into the function.



---

archive/issue_comments_397775.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-09-10T07:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397775",
    "user": "selia"
}
```

New commits:



---

archive/issue_comments_397776.json:
```json
{
    "body": "A few comments:\n\n\n```diff\n\n+ - ``self`` -- A lattice polytope with ``backend`` = 'normaliz'.\n```\n\n\nI would put the backend comment in a NOTE environment, although I am not completely sure. It would be to be checked in the guidelines.\n\nJust a suggestion:\n\n\n```diff\n- The h*-vector as a list.\n+ A list whose entries give the h*-vector.\n```\n\n\n- `simplicies` -> `simplices`\n\nIn the examples, you are only testing one of the 4 and not the four of them.\n\nThe method `_h_star_vector_normaliz(self)` in base should return a `TypeError` (as the volume_normaliz for example) and the function in backend_normaliz should be appended with `_normaliz`.\n\nI would also add a less trivial example, like the 0,1 cube and perhaps hypersimplex? This would be good to get sanity checks. Further, I would include an example that uses a different backend to show even further that it requires normaliz...\n\nOtherwise, looks good!",
    "created_at": "2019-09-11T15:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397776",
    "user": "jipilab"
}
```

A few comments:


```diff

+ - ``self`` -- A lattice polytope with ``backend`` = 'normaliz'.
```


I would put the backend comment in a NOTE environment, although I am not completely sure. It would be to be checked in the guidelines.

Just a suggestion:


```diff
- The h*-vector as a list.
+ A list whose entries give the h*-vector.
```


- `simplicies` -> `simplices`

In the examples, you are only testing one of the 4 and not the four of them.

The method `_h_star_vector_normaliz(self)` in base should return a `TypeError` (as the volume_normaliz for example) and the function in backend_normaliz should be appended with `_normaliz`.

I would also add a less trivial example, like the 0,1 cube and perhaps hypersimplex? This would be good to get sanity checks. Further, I would include an example that uses a different backend to show even further that it requires normaliz...

Otherwise, looks good!



---

archive/issue_comments_397777.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-20T14:20:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397777",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397778.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-24T08:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397778",
    "user": "selia"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_397779.json:
```json
{
    "body": "It seems there is a merge conflict... Rebase?\n\nIn the `h_star_vector` function, I would not say\n\n\n```diff\n+        - ``self`` -- A lattice polytope with ``backend`` = 'normaliz'.\n```\n\n\nbut use a NOTE to say that the backend should be normaliz.\n\nOnce we have the ticket #28880 and follow-up related to double description in normaliz, it will be possible to ignore the backend and simply obtain the relevant information in order to obtain the h_star_vector using normaliz.\n\nThe syntax for math printing should be corrected in:\n\n\n```diff\n+        The h*-vector of a unimodular simplex S (a simplex with \n-        volume = $\\frac{1}{dim(S)!} ) is always 1. Here we test this on \n-        simplicies up to dimension 4:\n+        volume = `\\frac{1}{(\\dim S)!}`) is always 1. Here we test this on \n+        simplices up to dimension 4::\n```\n\n\nOnly one of the simplices is tested below:\n\n\n```diff\n+            sage: s1 = polytopes.simplex(1,backend = 'normaliz')\n+            sage: s2 = polytopes.simplex(2,backend = 'normaliz')\n+            sage: s3 = polytopes.simplex(3,backend = 'normaliz')\n+            sage: s4 = polytopes.simplex(4,backend = 'normaliz')\n+            sage: s3.h_star_vector()\n+            [1]        \n```\n\n\nWhy not something like:\n\n\n```\nsage: [polytopes.simplex(i,backend='normaliz').h_star_vector() for i in [1,2,3,4]]\nsage: [[1], [1], [1], [1]]\n```\n\n\nThe function `_h_star_vector` in `backend_normaliz.py` should be renamed `_h_star_vector_normaliz` and the function `_h_star_vector_normaliz` in `base.py` should return `raise TypeError(\"the backend should be normaliz\")`.\n\nI would also add some more examples that involve known examples where values can be relevant to check the validity.",
    "created_at": "2020-01-24T10:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397779",
    "user": "jipilab"
}
```

It seems there is a merge conflict... Rebase?

In the `h_star_vector` function, I would not say


```diff
+        - ``self`` -- A lattice polytope with ``backend`` = 'normaliz'.
```


but use a NOTE to say that the backend should be normaliz.

Once we have the ticket #28880 and follow-up related to double description in normaliz, it will be possible to ignore the backend and simply obtain the relevant information in order to obtain the h_star_vector using normaliz.

The syntax for math printing should be corrected in:


```diff
+        The h*-vector of a unimodular simplex S (a simplex with 
-        volume = $\frac{1}{dim(S)!} ) is always 1. Here we test this on 
-        simplicies up to dimension 4:
+        volume = `\frac{1}{(\dim S)!}`) is always 1. Here we test this on 
+        simplices up to dimension 4::
```


Only one of the simplices is tested below:


```diff
+            sage: s1 = polytopes.simplex(1,backend = 'normaliz')
+            sage: s2 = polytopes.simplex(2,backend = 'normaliz')
+            sage: s3 = polytopes.simplex(3,backend = 'normaliz')
+            sage: s4 = polytopes.simplex(4,backend = 'normaliz')
+            sage: s3.h_star_vector()
+            [1]        
```


Why not something like:


```
sage: [polytopes.simplex(i,backend='normaliz').h_star_vector() for i in [1,2,3,4]]
sage: [[1], [1], [1], [1]]
```


The function `_h_star_vector` in `backend_normaliz.py` should be renamed `_h_star_vector_normaliz` and the function `_h_star_vector_normaliz` in `base.py` should return `raise TypeError("the backend should be normaliz")`.

I would also add some more examples that involve known examples where values can be relevant to check the validity.



---

archive/issue_comments_397780.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-01-24T10:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397780",
    "user": "jipilab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_397781.json:
```json
{
    "body": "I addressed many of these comments in the commit b9df545.",
    "created_at": "2020-01-24T10:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397781",
    "user": "selia"
}
```

I addressed many of these comments in the commit b9df545.



---

archive/issue_comments_397782.json:
```json
{
    "body": "I see. Great!\n\nI only looked at the first commit and started writing. Since there's a merge conflict, I couldn't see the final product.\n\nOk, so now it would need a rebase in any case.",
    "created_at": "2020-01-25T11:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397782",
    "user": "jipilab"
}
```

I see. Great!

I only looked at the first commit and started writing. Since there's a merge conflict, I couldn't see the final product.

Ok, so now it would need a rebase in any case.



---

archive/issue_comments_397783.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-31T14:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397783",
    "user": "selia"
}
```

New commits:



---

archive/issue_comments_397784.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-31T15:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397784",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397785.json:
```json
{
    "body": "You should also add a line in the tutorials to link to this function.",
    "created_at": "2020-02-04T14:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397785",
    "user": "jipilab"
}
```

You should also add a line in the tutorials to link to this function.



---

archive/issue_comments_397786.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-14T12:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397786",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397787.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-14T12:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397787",
    "user": "selia"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_397788.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-02-15T12:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397788",
    "user": "jipilab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_397789.json:
```json
{
    "body": "- There are no doctests in the function `_h_star_vector_normaliz` in `backend_normaliz.py`.\n\n  - The documentation does not build:\n   \n   [dochtml] docstring of sage.geometry.polyhedron.base.Polyhedron_base.h_star_vector:22: WARNING: Inline interpreted text or phrase reference start-string without end-string.\n\n   this is caused by the missing space:\n\n\n```diff\n        OUTPUT:\n\n        The h*-vector as a list.\n\n-        ..NOTE:\n+        .. NOTE:\n\n        The ``backend`` of ``self`` should be ``'normaliz'``.\n```\n\n\n\nI also suggest to remove the two backticks around the word backend in the docstrings as it is not a parameter of the functions.",
    "created_at": "2020-02-15T12:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397789",
    "user": "jipilab"
}
```

- There are no doctests in the function `_h_star_vector_normaliz` in `backend_normaliz.py`.

  - The documentation does not build:
   
   [dochtml] docstring of sage.geometry.polyhedron.base.Polyhedron_base.h_star_vector:22: WARNING: Inline interpreted text or phrase reference start-string without end-string.

   this is caused by the missing space:


```diff
        OUTPUT:

        The h*-vector as a list.

-        ..NOTE:
+        .. NOTE:

        The ``backend`` of ``self`` should be ``'normaliz'``.
```



I also suggest to remove the two backticks around the word backend in the docstrings as it is not a parameter of the functions.



---

archive/issue_comments_397790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-28T10:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397791.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-28T10:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397791",
    "user": "selia"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_397792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-28T12:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397792",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_397793.json:
```json
{
    "body": "Looks good to me now. Tests are passing and the documentation now seems to builds too.",
    "created_at": "2020-02-28T22:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397793",
    "user": "jipilab"
}
```

Looks good to me now. Tests are passing and the documentation now seems to builds too.



---

archive/issue_comments_397794.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-28T22:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397794",
    "user": "jipilab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_397795.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-03-01T23:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28176",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28176#issuecomment-397795",
    "user": "vbraun"
}
```

Resolution: fixed
