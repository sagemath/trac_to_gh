# Issue 13042: Frobenius endomorphism over finite fields

archive/issues_013042.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  tfeulner @xcaruso @darijgr jpflori @pjbruin @defeo jcooley dfesti\n\nKeywords: frobenius finite fields\n\nHere is a patch implementing:\n\n1. Frobenius endomorphisms over finite fields (generic implementation, plus special implementations for prime finite fields and givaro finite fields)\n2. embeddings between finite fields (with again a special implementation for givaro finite fields)\n3. hashing and rich comparisons for general morphisms\n\nIssue created by migration from https://trac.sagemath.org/ticket/13214\n\n",
    "created_at": "2012-07-09T08:26:03Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.13",
    "title": "Frobenius endomorphism over finite fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13042",
    "user": "https://github.com/xcaruso"
}
```
Assignee: @aghitza

CC:  tfeulner @xcaruso @darijgr jpflori @pjbruin @defeo jcooley dfesti

Keywords: frobenius finite fields

Here is a patch implementing:

1. Frobenius endomorphisms over finite fields (generic implementation, plus special implementations for prime finite fields and givaro finite fields)
2. embeddings between finite fields (with again a special implementation for givaro finite fields)
3. hashing and rich comparisons for general morphisms

Issue created by migration from https://trac.sagemath.org/ticket/13214





---

archive/issue_comments_157873.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-07-09T08:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157873",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157874.json:
```json
{
    "body": "I guess your patch should also contain some *.pxd files since I receive the following error message.\n\n\n```\nBuilding modified file sage/rings/finite_rings/hom_finite_field.pyx.\nTraceback (most recent call last):\n  File \"setup.py\", line 829, in <module>\n    queue = compile_command_list(ext_modules, deps)\n  File \"setup.py\", line 789, in compile_command_list\n    dep_file, dep_time = deps.newest_dep(f,m)\n  File \"setup.py\", line 696, in newest_dep\n    for f in self.all_deps(filename, ext_module):\n  File \"setup.py\", line 677, in all_deps\n    for f in self.immediate_deps(filename, ext_module):\n  File \"setup.py\", line 659, in immediate_deps\n    self._deps[filename] = self.parse_deps(filename, ext_module)\n  File \"setup.py\", line 647, in parse_deps\n    raise IOError, msg\nIOError: could not find dependency sage/rings/finite_rings/hom_finite_field.pxd included in sage/rings/finite_rings/hom_prime_finite_field.pyx.\nError installing modified sage library code.\n```\n",
    "created_at": "2012-07-25T07:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157874",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

I guess your patch should also contain some *.pxd files since I receive the following error message.


```
Building modified file sage/rings/finite_rings/hom_finite_field.pyx.
Traceback (most recent call last):
  File "setup.py", line 829, in <module>
    queue = compile_command_list(ext_modules, deps)
  File "setup.py", line 789, in compile_command_list
    dep_file, dep_time = deps.newest_dep(f,m)
  File "setup.py", line 696, in newest_dep
    for f in self.all_deps(filename, ext_module):
  File "setup.py", line 677, in all_deps
    for f in self.immediate_deps(filename, ext_module):
  File "setup.py", line 659, in immediate_deps
    self._deps[filename] = self.parse_deps(filename, ext_module)
  File "setup.py", line 647, in parse_deps
    raise IOError, msg
IOError: could not find dependency sage/rings/finite_rings/hom_finite_field.pxd included in sage/rings/finite_rings/hom_prime_finite_field.pyx.
Error installing modified sage library code.
```




---

archive/issue_comments_157875.json:
```json
{
    "body": "Xavier, if I define an element of GF(q<sup>2</sup>) which is in fact an element of GF(q), will this patch enable to convert it efficiently to the smaller field? If so, please can you tell me how?\n\nPaul",
    "created_at": "2012-07-25T16:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157875",
    "user": "https://github.com/zimmermann6"
}
```

Xavier, if I define an element of GF(q<sup>2</sup>) which is in fact an element of GF(q), will this patch enable to convert it efficiently to the smaller field? If so, please can you tell me how?

Paul



---

archive/issue_comments_157876.json:
```json
{
    "body": "Oh sorry, I forgot *.pxd files. Thanks!\n\n\nPaul, the answer to your question is probably yes... at least if q is small enough so that you can work with givaro fields (otherwise, it won't be so efficient).\n\nActually, I have not implemented automatic coercions between finite fields (essentially because embeddings between finite fields are not canonical). As a consequence it's not so easy to create embeddings. Nevertheless, here is what you can do:\n\n\n```\nsage: K.<x> = GF(5^3)\nsage: L.<y> = GF(5^6)\nsage: from sage.rings.finite_rings.hom_finite_field_givaro import FiniteFieldEmbedding_givaro\nsage: f = FiniteFieldEmbedding_givaro(K,L); f\nEmbedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6\nsage: g = f.section(); g\nSection of Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6\nsage: g(y^126)\n3*x^2 + 1\nsage: g(y)\nTraceback (most recent call last):\n...\nValueError: y is not in the image of Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6\n```\n\n\nIf you are sure that you won't never use another embedding of K into L, you can even define f as a coerce map as follows:\n\n\n```\nsage: K._unset_coercions_used()\nsage: K._populate_coercion_lists_(embedding=f)\n```\n\n\nThen the following will work:\n\n\n```\nsage: L(x)\n2*y^5 + 3*y^4 + 3*y^2 + y + 2\nsage: z = x*y; z\n3*y^5 + 3*y^4 + 4*y^2 + 2*y + 1\nsage: K(z/y)\nx\nsage: K(y)\nTraceback (most recent call last):\n...\nValueError: y is not in the image of Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6\n```\n",
    "created_at": "2012-07-25T22:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157876",
    "user": "https://github.com/xcaruso"
}
```

Oh sorry, I forgot *.pxd files. Thanks!


Paul, the answer to your question is probably yes... at least if q is small enough so that you can work with givaro fields (otherwise, it won't be so efficient).

Actually, I have not implemented automatic coercions between finite fields (essentially because embeddings between finite fields are not canonical). As a consequence it's not so easy to create embeddings. Nevertheless, here is what you can do:


```
sage: K.<x> = GF(5^3)
sage: L.<y> = GF(5^6)
sage: from sage.rings.finite_rings.hom_finite_field_givaro import FiniteFieldEmbedding_givaro
sage: f = FiniteFieldEmbedding_givaro(K,L); f
Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6
sage: g = f.section(); g
Section of Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6
sage: g(y^126)
3*x^2 + 1
sage: g(y)
Traceback (most recent call last):
...
ValueError: y is not in the image of Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6
```


If you are sure that you won't never use another embedding of K into L, you can even define f as a coerce map as follows:


```
sage: K._unset_coercions_used()
sage: K._populate_coercion_lists_(embedding=f)
```


Then the following will work:


```
sage: L(x)
2*y^5 + 3*y^4 + 3*y^2 + y + 2
sage: z = x*y; z
3*y^5 + 3*y^4 + 4*y^2 + 2*y + 1
sage: K(z/y)
x
sage: K(y)
Traceback (most recent call last):
...
ValueError: y is not in the image of Embedding of Finite Field in x of size 5^3 into Finite Field in y of size 5^6
```




---

archive/issue_comments_157877.json:
```json
{
    "body": "Please fill in your real name as Author.",
    "created_at": "2012-07-27T20:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157877",
    "user": "https://github.com/jdemeyer"
}
```

Please fill in your real name as Author.



---

archive/issue_comments_157878.json:
```json
{
    "body": "Xavier, I tried to apply the patch on top of Sage 5.1 but got:\n\n```\nsage: hg_sage.import_patch(\"trac_13214_hom_finite_field.patch\")\ncd \"/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/devel/sage\" && sage --hg import   \"/tmp/trac_13214_hom_finite_field.patch\"\napplying /tmp/trac_13214_hom_finite_field.patch\n** unknown exception encountered, please report by visiting\n**  http://mercurial.selenic.com/wiki/BugTracker\n** Python 2.7.3 (default, Jul  9 2012, 15:05:17) [GCC 4.6.3]\n** Mercurial Distributed SCM (version 1.8.4)\n** Extensions loaded: color, mq, pager, rebase, relink\nTraceback (most recent call last):\n  File \"/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/bin/hg\", line 38, in <module>\n    mercurial.dispatch.run()\n  File \"/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python/mercurial/dispatch.py\", line 16, in run\n    sys.exit(dispatch(sys.argv[1:]))\n  File \"/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python/mercurial/dispatch.py\", line 36, in dispatch\n    return _runcatch(u, args)\n...\n  File \"/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python/mercurial/patch.py\", line 339, in readgitpatch\n    gp.setmode(int(line[-6:], 8))\nValueError: invalid literal for int() with base 8: '</pre>'\n```\n\nShould I apply it on top of Sage 5.2 or later?\n\nPaul",
    "created_at": "2012-07-31T12:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157878",
    "user": "https://github.com/zimmermann6"
}
```

Xavier, I tried to apply the patch on top of Sage 5.1 but got:

```
sage: hg_sage.import_patch("trac_13214_hom_finite_field.patch")
cd "/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/devel/sage" && sage --hg import   "/tmp/trac_13214_hom_finite_field.patch"
applying /tmp/trac_13214_hom_finite_field.patch
** unknown exception encountered, please report by visiting
**  http://mercurial.selenic.com/wiki/BugTracker
** Python 2.7.3 (default, Jul  9 2012, 15:05:17) [GCC 4.6.3]
** Mercurial Distributed SCM (version 1.8.4)
** Extensions loaded: color, mq, pager, rebase, relink
Traceback (most recent call last):
  File "/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/bin/hg", line 38, in <module>
    mercurial.dispatch.run()
  File "/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python/mercurial/dispatch.py", line 16, in run
    sys.exit(dispatch(sys.argv[1:]))
  File "/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python/mercurial/dispatch.py", line 36, in dispatch
    return _runcatch(u, args)
...
  File "/usr/local/sage-5.1-linux-64bit-ubuntu_12.04_lts-x86_64-Linux/local/lib/python/mercurial/patch.py", line 339, in readgitpatch
    gp.setmode(int(line[-6:], 8))
ValueError: invalid literal for int() with base 8: '</pre>'
```

Should I apply it on top of Sage 5.2 or later?

Paul



---

archive/issue_comments_157879.json:
```json
{
    "body": "please discard my last comment, I downloaded the patch in html form...\n\nPaul",
    "created_at": "2012-08-01T06:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157879",
    "user": "https://github.com/zimmermann6"
}
```

please discard my last comment, I downloaded the patch in html form...

Paul



---

archive/issue_comments_157880.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-01T11:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157880",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157881.json:
```json
{
    "body": "on top of Sage 5.1 I get the following failures with this patch:\n\n```\nsage -t  devel/sage-13214/sage/categories/modules_with_basis.py # 3 doctests failed\nsage -t  devel/sage-13214/sage/rings/finite_rings/finite_field_base.pyx # 2 doctests failed\nsage -t  devel/sage-13214/sage/rings/finite_rings/finite_field_givaro.py # 2 doctests failed\nsage -t  devel/sage-13214/sage/rings/finite_rings/hom_finite_field.pyx # 2 doctests failed\n```\n\nPaul",
    "created_at": "2012-08-01T11:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157881",
    "user": "https://github.com/zimmermann6"
}
```

on top of Sage 5.1 I get the following failures with this patch:

```
sage -t  devel/sage-13214/sage/categories/modules_with_basis.py # 3 doctests failed
sage -t  devel/sage-13214/sage/rings/finite_rings/finite_field_base.pyx # 2 doctests failed
sage -t  devel/sage-13214/sage/rings/finite_rings/finite_field_givaro.py # 2 doctests failed
sage -t  devel/sage-13214/sage/rings/finite_rings/hom_finite_field.pyx # 2 doctests failed
```

Paul



---

archive/issue_comments_157882.json:
```json
{
    "body": "Dear Paul,\n\nI cannot reproduce the three last failures on my computer[*]. Could you please give me the complete output of 'sage -t'?\n\n[*] I'm currently working with sage 5.1.rc0; it's probably the reason.",
    "created_at": "2012-08-09T20:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157882",
    "user": "https://github.com/xcaruso"
}
```

Dear Paul,

I cannot reproduce the three last failures on my computer[*]. Could you please give me the complete output of 'sage -t'?

[*] I'm currently working with sage 5.1.rc0; it's probably the reason.



---

archive/issue_comments_157883.json:
```json
{
    "body": "These are the failures Paul observed (here on Sage 5.3) with this patch:\n\n```\nsage -t  \"devel/sage-codecan/sage/categories/modules_with_basis.py\"\n**********************************************************************\nFile \"devel/sage-codecan/sage/categories/modules_with_basis.py\", line 1149:\n    sage: TestSuite(phi).run() # known issue\nExpected:\n    Failure in _test_category:\n    ...\n    The following tests failed: _test_category\nGot:\n    Failure in _test_category:\n    Traceback (most recent call last):\n      File \"local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"element.pyx\", line 499, in sage.structure.element.Element._test_category (sage/structure/element.c:4702)\n      File \"local/lib/python2.7/unittest/case.py\", line 420, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: False is not true\n    ------------------------------------------------------------\n    Failure in _test_eq:\n    Traceback (most recent call last):\n      File \"local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"element.pyx\", line 545, in sage.structure.element.Element._test_eq (sage/structure/element.c:4907)\n      File \"morphism.pyx\", line 214, in sage.categories.morphism.Morphism.__richcmp__ (sage/categories/morphism.c:3398)\n      File \"element.pyx\", line 876, in sage.structure.element.Element._richcmp (sage/structure/element.c:8370)\n      File \"element.pyx\", line 923, in sage.structure.element.Element._richcmp_c_impl (sage/structure/element.c:8671)\n      File \"morphism.pyx\", line 228, in sage.categories.morphism.Morphism._cmp_c_impl (sage/categories/morphism.c:3708)\n    NotImplementedError\n    ------------------------------------------------------------\n    The following tests failed: _test_category, _test_eq\n**********************************************************************\nFile \"devel/sage-codecan/sage/categories/modules_with_basis.py\", line 1384:\n    sage: TestSuite(phi).run() # known issue; see ModuleMorphism above\nExpected:\n    Failure in _test_category:\n    ...\n    The following tests failed: _test_category\nGot:\n    Failure in _test_category:\n    Traceback (most recent call last):\n      File \"local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"element.pyx\", line 499, in sage.structure.element.Element._test_category (sage/structure/element.c:4702)\n      File \"local/lib/python2.7/unittest/case.py\", line 420, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: False is not true\n    ------------------------------------------------------------\n    Failure in _test_eq:\n    Traceback (most recent call last):\n      File \"local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"element.pyx\", line 545, in sage.structure.element.Element._test_eq (sage/structure/element.c:4907)\n      File \"morphism.pyx\", line 214, in sage.categories.morphism.Morphism.__richcmp__ (sage/categories/morphism.c:3398)\n      File \"element.pyx\", line 876, in sage.structure.element.Element._richcmp (sage/structure/element.c:8370)\n      File \"element.pyx\", line 923, in sage.structure.element.Element._richcmp_c_impl (sage/structure/element.c:8671)\n      File \"morphism.pyx\", line 228, in sage.categories.morphism.Morphism._cmp_c_impl (sage/categories/morphism.c:3708)\n    NotImplementedError\n    ------------------------------------------------------------\n    The following tests failed: _test_category, _test_eq\n**********************************************************************\nFile \"devel/sage-codecan/sage/categories/modules_with_basis.py\", line 1762:\n    sage: TestSuite(phi).run() # known issue; see ModuleMorphismByLinearity.__init__\nExpected:\n    Failure in _test_category:\n    ...\n    The following tests failed: _test_category\nGot:\n    Failure in _test_category:\n    Traceback (most recent call last):\n      File \"local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"element.pyx\", line 499, in sage.structure.element.Element._test_category (sage/structure/element.c:4702)\n      File \"local/lib/python2.7/unittest/case.py\", line 420, in assertTrue\n        raise self.failureException(msg)\n    AssertionError: False is not true\n    ------------------------------------------------------------\n    Failure in _test_eq:\n    Traceback (most recent call last):\n      File \"local/lib/python/site-packages/sage/misc/sage_unittest.py\", line 275, in run\n        test_method(tester = tester)\n      File \"element.pyx\", line 545, in sage.structure.element.Element._test_eq (sage/structure/element.c:4907)\n      File \"morphism.pyx\", line 214, in sage.categories.morphism.Morphism.__richcmp__ (sage/categories/morphism.c:3398)\n      File \"element.pyx\", line 876, in sage.structure.element.Element._richcmp (sage/structure/element.c:8370)\n      File \"element.pyx\", line 923, in sage.structure.element.Element._richcmp_c_impl (sage/structure/element.c:8671)\n      File \"morphism.pyx\", line 228, in sage.categories.morphism.Morphism._cmp_c_impl (sage/categories/morphism.c:3708)\n    NotImplementedError\n    ------------------------------------------------------------\n    The following tests failed: _test_category, _test_eq\n**********************************************************************\n3 items had failures:\n   1 of   8 in __main__.example_40\n   1 of   9 in __main__.example_45\n   1 of   9 in __main__.example_55\n***Test Failed*** 3 failures.\n```\n\n\n\n```\nsage -t  \"devel/sage-codecan/sage/rings/finite_rings/finite_field_base.pyx\"\n**********************************************************************\nFile \"devel/sage-codecan/sage/rings/finite_rings/finite_field_base.pyx\", line 793:\n    sage: k.frobenius_endomorphism(6) == Frob\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"devel/sage-codecan/sage/rings/finite_rings/finite_field_base.pyx\", line 796:\n    sage: k.frobenius_endomorphism(5) == IdentityMorphism(k)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   2 of  13 in __main__.example_38\n```\n\n\n\n```\nsage -t  \"devel/sage-codecan/sage/rings/finite_rings/finite_field_givaro.py\"\n**********************************************************************\nFile \"devel/sage-codecan/sage/rings/finite_rings/finite_field_givaro.py\", line 651:\n    sage: k.frobenius_endomorphism(6) == Frob\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"devel/sage-codecan/sage/rings/finite_rings/finite_field_givaro.py\", line 654:\n    sage: k.frobenius_endomorphism(5) == IdentityMorphism(k)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   2 of  13 in __main__.example_21\n***Test Failed*** 2 failures.\n```\n\n\n\n```\nsage -t  \"devel/sage-codecan/sage/rings/finite_rings/hom_finite_field.pyx\"\n**********************************************************************\nFile \"devel/sage-codecan/sage/rings/finite_rings/hom_finite_field.pyx\", line 74:\n    sage: Frob == Frob^15\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"devel/sage-codecan/sage/rings/finite_rings/hom_finite_field.pyx\", line 76:\n    sage: Frob^14 == Hom(k,k).identity()\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   2 of  26 in __main__.example_0\n***Test Failed*** 2 failures.\n```\n",
    "created_at": "2012-10-15T07:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157883",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

These are the failures Paul observed (here on Sage 5.3) with this patch:

```
sage -t  "devel/sage-codecan/sage/categories/modules_with_basis.py"
**********************************************************************
File "devel/sage-codecan/sage/categories/modules_with_basis.py", line 1149:
    sage: TestSuite(phi).run() # known issue
Expected:
    Failure in _test_category:
    ...
    The following tests failed: _test_category
Got:
    Failure in _test_category:
    Traceback (most recent call last):
      File "local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "element.pyx", line 499, in sage.structure.element.Element._test_category (sage/structure/element.c:4702)
      File "local/lib/python2.7/unittest/case.py", line 420, in assertTrue
        raise self.failureException(msg)
    AssertionError: False is not true
    ------------------------------------------------------------
    Failure in _test_eq:
    Traceback (most recent call last):
      File "local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "element.pyx", line 545, in sage.structure.element.Element._test_eq (sage/structure/element.c:4907)
      File "morphism.pyx", line 214, in sage.categories.morphism.Morphism.__richcmp__ (sage/categories/morphism.c:3398)
      File "element.pyx", line 876, in sage.structure.element.Element._richcmp (sage/structure/element.c:8370)
      File "element.pyx", line 923, in sage.structure.element.Element._richcmp_c_impl (sage/structure/element.c:8671)
      File "morphism.pyx", line 228, in sage.categories.morphism.Morphism._cmp_c_impl (sage/categories/morphism.c:3708)
    NotImplementedError
    ------------------------------------------------------------
    The following tests failed: _test_category, _test_eq
**********************************************************************
File "devel/sage-codecan/sage/categories/modules_with_basis.py", line 1384:
    sage: TestSuite(phi).run() # known issue; see ModuleMorphism above
Expected:
    Failure in _test_category:
    ...
    The following tests failed: _test_category
Got:
    Failure in _test_category:
    Traceback (most recent call last):
      File "local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "element.pyx", line 499, in sage.structure.element.Element._test_category (sage/structure/element.c:4702)
      File "local/lib/python2.7/unittest/case.py", line 420, in assertTrue
        raise self.failureException(msg)
    AssertionError: False is not true
    ------------------------------------------------------------
    Failure in _test_eq:
    Traceback (most recent call last):
      File "local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "element.pyx", line 545, in sage.structure.element.Element._test_eq (sage/structure/element.c:4907)
      File "morphism.pyx", line 214, in sage.categories.morphism.Morphism.__richcmp__ (sage/categories/morphism.c:3398)
      File "element.pyx", line 876, in sage.structure.element.Element._richcmp (sage/structure/element.c:8370)
      File "element.pyx", line 923, in sage.structure.element.Element._richcmp_c_impl (sage/structure/element.c:8671)
      File "morphism.pyx", line 228, in sage.categories.morphism.Morphism._cmp_c_impl (sage/categories/morphism.c:3708)
    NotImplementedError
    ------------------------------------------------------------
    The following tests failed: _test_category, _test_eq
**********************************************************************
File "devel/sage-codecan/sage/categories/modules_with_basis.py", line 1762:
    sage: TestSuite(phi).run() # known issue; see ModuleMorphismByLinearity.__init__
Expected:
    Failure in _test_category:
    ...
    The following tests failed: _test_category
Got:
    Failure in _test_category:
    Traceback (most recent call last):
      File "local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "element.pyx", line 499, in sage.structure.element.Element._test_category (sage/structure/element.c:4702)
      File "local/lib/python2.7/unittest/case.py", line 420, in assertTrue
        raise self.failureException(msg)
    AssertionError: False is not true
    ------------------------------------------------------------
    Failure in _test_eq:
    Traceback (most recent call last):
      File "local/lib/python/site-packages/sage/misc/sage_unittest.py", line 275, in run
        test_method(tester = tester)
      File "element.pyx", line 545, in sage.structure.element.Element._test_eq (sage/structure/element.c:4907)
      File "morphism.pyx", line 214, in sage.categories.morphism.Morphism.__richcmp__ (sage/categories/morphism.c:3398)
      File "element.pyx", line 876, in sage.structure.element.Element._richcmp (sage/structure/element.c:8370)
      File "element.pyx", line 923, in sage.structure.element.Element._richcmp_c_impl (sage/structure/element.c:8671)
      File "morphism.pyx", line 228, in sage.categories.morphism.Morphism._cmp_c_impl (sage/categories/morphism.c:3708)
    NotImplementedError
    ------------------------------------------------------------
    The following tests failed: _test_category, _test_eq
**********************************************************************
3 items had failures:
   1 of   8 in __main__.example_40
   1 of   9 in __main__.example_45
   1 of   9 in __main__.example_55
***Test Failed*** 3 failures.
```



```
sage -t  "devel/sage-codecan/sage/rings/finite_rings/finite_field_base.pyx"
**********************************************************************
File "devel/sage-codecan/sage/rings/finite_rings/finite_field_base.pyx", line 793:
    sage: k.frobenius_endomorphism(6) == Frob
Expected:
    True
Got:
    False
**********************************************************************
File "devel/sage-codecan/sage/rings/finite_rings/finite_field_base.pyx", line 796:
    sage: k.frobenius_endomorphism(5) == IdentityMorphism(k)
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   2 of  13 in __main__.example_38
```



```
sage -t  "devel/sage-codecan/sage/rings/finite_rings/finite_field_givaro.py"
**********************************************************************
File "devel/sage-codecan/sage/rings/finite_rings/finite_field_givaro.py", line 651:
    sage: k.frobenius_endomorphism(6) == Frob
Expected:
    True
Got:
    False
**********************************************************************
File "devel/sage-codecan/sage/rings/finite_rings/finite_field_givaro.py", line 654:
    sage: k.frobenius_endomorphism(5) == IdentityMorphism(k)
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   2 of  13 in __main__.example_21
***Test Failed*** 2 failures.
```



```
sage -t  "devel/sage-codecan/sage/rings/finite_rings/hom_finite_field.pyx"
**********************************************************************
File "devel/sage-codecan/sage/rings/finite_rings/hom_finite_field.pyx", line 74:
    sage: Frob == Frob^15
Expected:
    True
Got:
    False
**********************************************************************
File "devel/sage-codecan/sage/rings/finite_rings/hom_finite_field.pyx", line 76:
    sage: Frob^14 == Hom(k,k).identity()
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   2 of  26 in __main__.example_0
***Test Failed*** 2 failures.
```




---

archive/issue_comments_157884.json:
```json
{
    "body": "Attachment [trac_13214_hom_finite_field.2.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214_hom_finite_field.2.patch) by tfeulner created at 2012-10-16 11:58:58",
    "created_at": "2012-10-16T11:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157884",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

Attachment [trac_13214_hom_finite_field.2.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214_hom_finite_field.2.patch) by tfeulner created at 2012-10-16 11:58:58



---

archive/issue_comments_157885.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-16T12:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157885",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157886.json:
```json
{
    "body": "I changed the coercion in sage/rings/finite_rings/homset.py. Now, this patch passes all doctests except for the one documented in sage/categories/modules_with_basis.py. I did not change the error messages there, because I wanted to discuss the failure first.",
    "created_at": "2012-10-16T12:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157886",
    "user": "https://trac.sagemath.org/admin/accounts/users/tfeulner"
}
```

I changed the coercion in sage/rings/finite_rings/homset.py. Now, this patch passes all doctests except for the one documented in sage/categories/modules_with_basis.py. I did not change the error messages there, because I wanted to discuss the failure first.



---

archive/issue_comments_157887.json:
```json
{
    "body": "Thanks for catching this!\n\nI now understand why I didn't see this failure: it's just because this patch actually depends on #13184 and that the corresponding patch was applied on my computer. Sorry for this!\n\nI also attach a new version of my patch fixing the problem in modules_with_basis.py; I'm not really happy with my solution (but it has the advantage to be very short). Please let me now if you have some comment!",
    "created_at": "2012-10-22T13:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157887",
    "user": "https://github.com/xcaruso"
}
```

Thanks for catching this!

I now understand why I didn't see this failure: it's just because this patch actually depends on #13184 and that the corresponding patch was applied on my computer. Sorry for this!

I also attach a new version of my patch fixing the problem in modules_with_basis.py; I'm not really happy with my solution (but it has the advantage to be very short). Please let me now if you have some comment!



---

archive/issue_comments_157888.json:
```json
{
    "body": "for the bot:\n\nApply trac_13214_hom_finite_field.2.patch",
    "created_at": "2013-03-20T16:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157888",
    "user": "https://github.com/fchapoton"
}
```

for the bot:

Apply trac_13214_hom_finite_field.2.patch



---

archive/issue_comments_157889.json:
```json
{
    "body": "let me remove the dependency to #13184 from the ticket description and see what happens (waiting for the bot to run)",
    "created_at": "2013-03-20T19:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157889",
    "user": "https://github.com/fchapoton"
}
```

let me remove the dependency to #13184 from the ticket description and see what happens (waiting for the bot to run)



---

archive/issue_comments_157890.json:
```json
{
    "body": "let us now try with dependency to #13184 put back\n\nfor the bot:\n\napply trac_13214_hom_finite_field.patch",
    "created_at": "2013-03-28T21:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157890",
    "user": "https://github.com/fchapoton"
}
```

let us now try with dependency to #13184 put back

for the bot:

apply trac_13214_hom_finite_field.patch



---

archive/issue_comments_157891.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-05T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157891",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157892.json:
```json
{
    "body": "please provide a patch that applies, builds and pass all tests",
    "created_at": "2013-04-05T15:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157892",
    "user": "https://github.com/fchapoton"
}
```

please provide a patch that applies, builds and pass all tests



---

archive/issue_comments_157893.json:
```json
{
    "body": "Not sure how this relates to #8335, but it might be worth having a look there.",
    "created_at": "2013-06-04T09:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157893",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Not sure how this relates to #8335, but it might be worth having a look there.



---

archive/issue_comments_157894.json:
```json
{
    "body": "Attachment [trac_13214_hom_finite_field.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214_hom_finite_field.patch) by @xcaruso created at 2013-06-26 08:20:37",
    "created_at": "2013-06-26T08:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157894",
    "user": "https://github.com/xcaruso"
}
```

Attachment [trac_13214_hom_finite_field.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214_hom_finite_field.patch) by @xcaruso created at 2013-06-26 08:20:37



---

archive/issue_comments_157895.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-06-26T08:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157895",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157896.json:
```json
{
    "body": "I've just posted a patch that should apply on sage-5.10 (let's wait and see).\n\nJean-Pierre, I was actually not aware about your work with David Roe on lattices of finite fields. I had a quick look at what you have implemented. Unfortunately, it seems to me that our philosophy is a bit different: if I understand correctly, you are trying to make all finite fields canonical whereas my idea was to ask explicitely to the user which embeddings (between finite fields) are canonical and which ones are not.\n\nBut, you're right. We should definitely understand precisely how our respective patches relate and merge them if necessary (or discard one of them, i.e. mine).\n\nNote: Actually, my main motivation for this patch was to implement Frobenius endomorphisms. I think you patch does not provide this functionality. Is that correct?",
    "created_at": "2013-06-26T08:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157896",
    "user": "https://github.com/xcaruso"
}
```

I've just posted a patch that should apply on sage-5.10 (let's wait and see).

Jean-Pierre, I was actually not aware about your work with David Roe on lattices of finite fields. I had a quick look at what you have implemented. Unfortunately, it seems to me that our philosophy is a bit different: if I understand correctly, you are trying to make all finite fields canonical whereas my idea was to ask explicitely to the user which embeddings (between finite fields) are canonical and which ones are not.

But, you're right. We should definitely understand precisely how our respective patches relate and merge them if necessary (or discard one of them, i.e. mine).

Note: Actually, my main motivation for this patch was to implement Frobenius endomorphisms. I think you patch does not provide this functionality. Is that correct?



---

archive/issue_comments_157897.json:
```json
{
    "body": "I agree that the purposes of both patches are quite orthogonal: the point of our patch is a first step toward having compatible embeddings in lattices of finite fields automatically, i.e. mimic what Magma does where the user does not have to pay attention to such things and it just works.\n\nAnd I feel we should merge both patches if possible, even if at some later point it could make sense to refactor some pieces of code.",
    "created_at": "2013-06-26T08:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157897",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I agree that the purposes of both patches are quite orthogonal: the point of our patch is a first step toward having compatible embeddings in lattices of finite fields automatically, i.e. mimic what Magma does where the user does not have to pay attention to such things and it just works.

And I feel we should merge both patches if possible, even if at some later point it could make sense to refactor some pieces of code.



---

archive/issue_comments_157898.json:
```json
{
    "body": "This looks interesting.  One question at the moment: it does not appear to relate to the basic functionality that currently exists (in `sage/rings/finite_rings/homset.py`).  Is that intentional?  I can already type, for example,\n\n```\nsage: F9.<a>=GF(3^2)         \nsage: F81.<b>=GF(3^4)\nsage: f=F9.hom((b^10,))        \nsage: f\nRing morphism:\n  From: Finite Field in a of size 3^2\n  To:   Finite Field in b of size 3^4\n  Defn: a |--> 2*b^3 + 2*b^2 + 1\nsage: f(a^2+a)\nb^3 + b^2\nsage: type(f)\n<class 'sage.rings.finite_rings.homset.FiniteFieldHomomorphism_im_gens'>\n```\n",
    "created_at": "2013-06-26T14:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157898",
    "user": "https://github.com/pjbruin"
}
```

This looks interesting.  One question at the moment: it does not appear to relate to the basic functionality that currently exists (in `sage/rings/finite_rings/homset.py`).  Is that intentional?  I can already type, for example,

```
sage: F9.<a>=GF(3^2)         
sage: F81.<b>=GF(3^4)
sage: f=F9.hom((b^10,))        
sage: f
Ring morphism:
  From: Finite Field in a of size 3^2
  To:   Finite Field in b of size 3^4
  Defn: a |--> 2*b^3 + 2*b^2 + 1
sage: f(a^2+a)
b^3 + b^2
sage: type(f)
<class 'sage.rings.finite_rings.homset.FiniteFieldHomomorphism_im_gens'>
```




---

archive/issue_comments_157899.json:
```json
{
    "body": "As for the differing purposes of the two approaches, there should probably be two categories into which a finite field can be put:\n\n- the category of all finite fields.  In this category, between any two objects there are either several morphisms or none at all, but no canonical one.\n\n- the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.",
    "created_at": "2013-06-26T14:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157899",
    "user": "https://github.com/pjbruin"
}
```

As for the differing purposes of the two approaches, there should probably be two categories into which a finite field can be put:

- the category of all finite fields.  In this category, between any two objects there are either several morphisms or none at all, but no canonical one.

- the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.



---

archive/issue_comments_157900.json:
```json
{
    "body": "Replying to [comment:26 pbruin]:\n> As for the differing purposes of the two approaches, there should probably be two categories into which a finite field can be put:\n> \n> - the category of all finite fields.  In this category, between any two objects there are either several morphisms or none at all, but no canonical one.\nWhich is basically what we currently have and also what this ticket does.\n> \n> - the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.\nI would like this to be the default at some point, just like in Magma, not because I want to replicate Magma but for usual computations it seems a more practical choice.\n#8335 provides such an imlementation, though it not really practical for large fields and there is no proper categorical framework as you suggest.\n\nThis framework could be implemented in an independent ticket (and should if we want to be able to merge some tickets in a finite amount of time).",
    "created_at": "2013-06-26T14:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157900",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Replying to [comment:26 pbruin]:
> As for the differing purposes of the two approaches, there should probably be two categories into which a finite field can be put:
> 
> - the category of all finite fields.  In this category, between any two objects there are either several morphisms or none at all, but no canonical one.
Which is basically what we currently have and also what this ticket does.
> 
> - the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.
I would like this to be the default at some point, just like in Magma, not because I want to replicate Magma but for usual computations it seems a more practical choice.
#8335 provides such an imlementation, though it not really practical for large fields and there is no proper categorical framework as you suggest.

This framework could be implemented in an independent ticket (and should if we want to be able to merge some tickets in a finite amount of time).



---

archive/issue_comments_157901.json:
```json
{
    "body": "Replying to [comment:27 jpflori]:\n\n> Which is basically what we currently have and also what this ticket does.\n\nYes, and precisely for this reason I think it is important to have a clear picture of what belongs in the \"category of all finite fields\" framework, what belongs in the future \"finite subfields of a given algebraic closure\" framework, and what is independent of the framework.  Among the category-independent things would certainly be the various classes implementing the interfaces to FLINT, Givaro, NTL and PARI, and to a large extent the `FiniteField` base class itself.\n\n> > - the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.\n> I would like this to be the default at some point, just like in Magma, not because I want to replicate Magma but for usual computations it seems a more practical choice.\n\nThat probably depends strongly on the application.  Often one just needs to work with a single finite field.  In such cases it would be nicer if creating this field would give you a sparse polynomial for efficiency, not one that has been constructed to fit in an algebraic closure that you are unlikely to use.\n\nOf course it would be best if one could do both at the same time, like Magma (see references at #8751), by having an implementation that allows using sparse polynomials while still being able to put the fields in a compatible system/algebraic closure.  However, that should probably be done on top of the distinction between the two categories mentioned above, not by muddling this distinction.",
    "created_at": "2013-06-26T16:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157901",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:27 jpflori]:

> Which is basically what we currently have and also what this ticket does.

Yes, and precisely for this reason I think it is important to have a clear picture of what belongs in the "category of all finite fields" framework, what belongs in the future "finite subfields of a given algebraic closure" framework, and what is independent of the framework.  Among the category-independent things would certainly be the various classes implementing the interfaces to FLINT, Givaro, NTL and PARI, and to a large extent the `FiniteField` base class itself.

> > - the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.
> I would like this to be the default at some point, just like in Magma, not because I want to replicate Magma but for usual computations it seems a more practical choice.

That probably depends strongly on the application.  Often one just needs to work with a single finite field.  In such cases it would be nicer if creating this field would give you a sparse polynomial for efficiency, not one that has been constructed to fit in an algebraic closure that you are unlikely to use.

Of course it would be best if one could do both at the same time, like Magma (see references at #8751), by having an implementation that allows using sparse polynomials while still being able to put the fields in a compatible system/algebraic closure.  However, that should probably be done on top of the distinction between the two categories mentioned above, not by muddling this distinction.



---

archive/issue_comments_157902.json:
```json
{
    "body": "Replying to [comment:25 pbruin]:\n> This looks interesting.  One question at the moment: it does not appear to relate to the basic functionality that currently exists (in `sage/rings/finite_rings/homset.py`).  Is that intentional?\n\nYes, more or less.\n\nActually, my first motivation was to implement Frobenius endomorphism and, according to me, FrobeniusEndomorphism should not derive from RingHomomorphism_im_gens. Indeed, defining Frobenius endomorphisms by giving its value on the generator is not really appropriate for many operations we would like to perform (i.e. evaluation if the field has a small characteristic and a big size, composition, computation of the order or of the subfield of fixed points).\n\nOn the other hand, I agree that it makes sense to derive the various classes of embeddings from FiniteFieldHomomorphism_im_gens. I can actually change this if you think that it is better.\n\n\n> As for the differing purposes of the two approaches, there should probably be two categories into which a finite field can be put:\n> \n> - the category of all finite fields.  In this category, between any two objects there are either several morphisms or none at all, but no canonical one.\n> \n> - the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.\n\nThis sounds good.\nAnd the second category should be a subcategory of the first one, right (a finite subfield of a given algebraic closure of **F**<sub>*p*</sub> is in particular a finite field)? If so, all category-independant functions should go to the first category (even if the second one is the default, as suggested by Jean-Pierre). This is the case in particular for Frobenius endomorphisms.",
    "created_at": "2013-06-26T19:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157902",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:25 pbruin]:
> This looks interesting.  One question at the moment: it does not appear to relate to the basic functionality that currently exists (in `sage/rings/finite_rings/homset.py`).  Is that intentional?

Yes, more or less.

Actually, my first motivation was to implement Frobenius endomorphism and, according to me, FrobeniusEndomorphism should not derive from RingHomomorphism_im_gens. Indeed, defining Frobenius endomorphisms by giving its value on the generator is not really appropriate for many operations we would like to perform (i.e. evaluation if the field has a small characteristic and a big size, composition, computation of the order or of the subfield of fixed points).

On the other hand, I agree that it makes sense to derive the various classes of embeddings from FiniteFieldHomomorphism_im_gens. I can actually change this if you think that it is better.


> As for the differing purposes of the two approaches, there should probably be two categories into which a finite field can be put:
> 
> - the category of all finite fields.  In this category, between any two objects there are either several morphisms or none at all, but no canonical one.
> 
> - the category of finite subfields of a given algebraic closure of **F**<sub>*p*</sub>.  In this category there is at most one morphism beteen any two objects, namely the inclusion qua subfields of the given algebraic closure.

This sounds good.
And the second category should be a subcategory of the first one, right (a finite subfield of a given algebraic closure of **F**<sub>*p*</sub> is in particular a finite field)? If so, all category-independant functions should go to the first category (even if the second one is the default, as suggested by Jean-Pierre). This is the case in particular for Frobenius endomorphisms.



---

archive/issue_comments_157903.json:
```json
{
    "body": "Changing keywords from \"frobenius finite fields\" to \"frobenius finite fields sd51\".",
    "created_at": "2013-07-13T19:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157903",
    "user": "https://github.com/pjbruin"
}
```

Changing keywords from "frobenius finite fields" to "frobenius finite fields sd51".



---

archive/issue_comments_157904.json:
```json
{
    "body": "This might be a good target for Sage Days 51 (22-26 July, [http://wiki.sagemath.org/sagedaysleiden](http://wiki.sagemath.org/sagedaysleiden)).  For now I just checked that the patch applies to 5.11.beta3 (with some fuzz) and passes doctests.  I got one failure (a different embedding than expected is generated), probably because I am working under #14888.",
    "created_at": "2013-07-13T19:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157904",
    "user": "https://github.com/pjbruin"
}
```

This might be a good target for Sage Days 51 (22-26 July, [http://wiki.sagemath.org/sagedaysleiden](http://wiki.sagemath.org/sagedaysleiden)).  For now I just checked that the patch applies to 5.11.beta3 (with some fuzz) and passes doctests.  I got one failure (a different embedding than expected is generated), probably because I am working under #14888.



---

archive/issue_comments_157905.json:
```json
{
    "body": "Apply trac_13214_hom_finite_field.patch\u200b\n\n(for patchbot)",
    "created_at": "2013-07-25T11:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157905",
    "user": "https://github.com/loefflerd"
}
```

Apply trac_13214_hom_finite_field.patch

(for patchbot)



---

archive/issue_comments_157906.json:
```json
{
    "body": "for the bot:\n\napply only trac_13214_hom_finite_field.patch",
    "created_at": "2013-08-02T09:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157906",
    "user": "https://github.com/fchapoton"
}
```

for the bot:

apply only trac_13214_hom_finite_field.patch



---

archive/issue_comments_157907.json:
```json
{
    "body": "Attachment [trac_13214-reviewer.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214-reviewer.patch) by @pjbruin created at 2013-08-13 08:37:47\n\n(long) reviewer patch",
    "created_at": "2013-08-13T08:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157907",
    "user": "https://github.com/pjbruin"
}
```

Attachment [trac_13214-reviewer.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214-reviewer.patch) by @pjbruin created at 2013-08-13 08:37:47

(long) reviewer patch



---

archive/issue_comments_157908.json:
```json
{
    "body": "Changing component from basic arithmetic to finite rings.",
    "created_at": "2013-08-13T08:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157908",
    "user": "https://github.com/pjbruin"
}
```

Changing component from basic arithmetic to finite rings.



---

archive/issue_comments_157909.json:
```json
{
    "body": "In principle I am giving this a positive review, but since the reviewer patch I just uploaded contains some non-trivial changes, I think it is best if someone else reviews those changes first.\n\nSummary of changes in [attachment:trac_13214-reviewer.patch]:\n- Do not add `inverse()` method to `Section`; it is currently not used and does not seem to be the best name, since its return value (the original map) is only a one-sided inverse.\n- Add method `gens()` to `CombinatorialFreeModule` to fix a doctest failure in `modules_with_basis.py`.  I guess this is the same failure discussed in comment:14 above.\n- Rename `[Section]FiniteFieldEmbedding_*` to `[Section]FiniteFieldHomomorphism_*`; even though finite field homomorphisms are automatically injective, I think \"homomorphism\" fits better with existing code.  Furthermore, to me \"embedding\" makes it sound too much like finite field homomorphisms are canonical.\n- Derive `FiniteFieldHomomorphism_generic` from `RingHomomorphism_im_gens` as suggested above.\n- Replace the existing `FiniteFieldHomomorphism_im_gens` by the new `FiniteFieldHomomorphism_generic`.\n- Better integration of the new code into the existing finite field code.\n- Remove the `_repr_()` method of `FiniteFieldHomomorphism_generic`, so that the output is the same as for the old `FiniteFieldHomomorphism_im_gens`.\n- Do not automatically generate a section for every finite field homomorphism.\n- Numerous whitespace edits and some other typographical changes.",
    "created_at": "2013-08-13T08:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157909",
    "user": "https://github.com/pjbruin"
}
```

In principle I am giving this a positive review, but since the reviewer patch I just uploaded contains some non-trivial changes, I think it is best if someone else reviews those changes first.

Summary of changes in [attachment:trac_13214-reviewer.patch]:
- Do not add `inverse()` method to `Section`; it is currently not used and does not seem to be the best name, since its return value (the original map) is only a one-sided inverse.
- Add method `gens()` to `CombinatorialFreeModule` to fix a doctest failure in `modules_with_basis.py`.  I guess this is the same failure discussed in comment:14 above.
- Rename `[Section]FiniteFieldEmbedding_*` to `[Section]FiniteFieldHomomorphism_*`; even though finite field homomorphisms are automatically injective, I think "homomorphism" fits better with existing code.  Furthermore, to me "embedding" makes it sound too much like finite field homomorphisms are canonical.
- Derive `FiniteFieldHomomorphism_generic` from `RingHomomorphism_im_gens` as suggested above.
- Replace the existing `FiniteFieldHomomorphism_im_gens` by the new `FiniteFieldHomomorphism_generic`.
- Better integration of the new code into the existing finite field code.
- Remove the `_repr_()` method of `FiniteFieldHomomorphism_generic`, so that the output is the same as for the old `FiniteFieldHomomorphism_im_gens`.
- Do not automatically generate a section for every finite field homomorphism.
- Numerous whitespace edits and some other typographical changes.



---

archive/issue_comments_157910.json:
```json
{
    "body": "Attachment [trac_13214-folded.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214-folded.patch) by @pjbruin created at 2013-08-13 08:58:29\n\nfor convenience: unified patch combining trac_13214_hom_finite_field.patch and trac_13214-reviewer.patch",
    "created_at": "2013-08-13T08:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157910",
    "user": "https://github.com/pjbruin"
}
```

Attachment [trac_13214-folded.patch](tarball://root/attachments/some-uuid/ticket13214/trac_13214-folded.patch) by @pjbruin created at 2013-08-13 08:58:29

for convenience: unified patch combining trac_13214_hom_finite_field.patch and trac_13214-reviewer.patch



---

archive/issue_events_036430.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13042#event-36430"
}
```



---

archive/issue_comments_157911.json:
```json
{
    "body": "apply only trac_13214-folded.patch",
    "created_at": "2013-08-21T08:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157911",
    "user": "https://github.com/fchapoton"
}
```

apply only trac_13214-folded.patch



---

archive/issue_events_036431.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-06T09:11:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13042#event-36431"
}
```



---

archive/issue_events_036432.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2013-09-06T09:11:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "milestone": "sage-5.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13042#event-36432"
}
```



---

archive/issue_comments_157912.json:
```json
{
    "body": "I'm currently at Sage Days 53 and could spare some time on this one... unless Luca is nearing completion of his review?\n\nIf I understand correctly, what needs to be done is to check Peter's changes as he already went over what Xavier did?",
    "created_at": "2013-09-24T13:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157912",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I'm currently at Sage Days 53 and could spare some time on this one... unless Luca is nearing completion of his review?

If I understand correctly, what needs to be done is to check Peter's changes as he already went over what Xavier did?



---

archive/issue_comments_157913.json:
```json
{
    "body": "Replying to [comment:38 jpflori]:\n> I'm currently at Sage Days 53 and could spare some time on this one... unless Luca is nearing completion of his review?\n\nI'm rather nearing completion of the new class I'm starting next week... so feel free to go ahead :)",
    "created_at": "2013-09-24T13:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157913",
    "user": "https://github.com/defeo"
}
```

Replying to [comment:38 jpflori]:
> I'm currently at Sage Days 53 and could spare some time on this one... unless Luca is nearing completion of his review?

I'm rather nearing completion of the new class I'm starting next week... so feel free to go ahead :)



---

archive/issue_comments_157914.json:
```json
{
    "body": "Replying to [comment:38 jpflori]:\n> I'm currently at Sage Days 53 and could spare some time on this one... unless Luca is nearing completion of his review?\n> \n> If I understand correctly, what needs to be done is to check Peter's changes as he already went over what Xavier did?\nYes, it would be nice if you could take a look either at my reviewer patch or at the combined one (the combined patch is only a little larger and probably easier to review).",
    "created_at": "2013-09-24T14:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157914",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:38 jpflori]:
> I'm currently at Sage Days 53 and could spare some time on this one... unless Luca is nearing completion of his review?
> 
> If I understand correctly, what needs to be done is to check Peter's changes as he already went over what Xavier did?
Yes, it would be nice if you could take a look either at my reviewer patch or at the combined one (the combined patch is only a little larger and probably easier to review).



---

archive/issue_comments_157915.json:
```json
{
    "body": "patchbot: only\n\nApply trac_13214-folded.patch\u200b",
    "created_at": "2013-10-23T09:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157915",
    "user": "https://github.com/vbraun"
}
```

patchbot: only

Apply trac_13214-folded.patch



---

archive/issue_comments_157916.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-10-25T11:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157916",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157917.json:
```json
{
    "body": "The review patch looks good to me.",
    "created_at": "2013-10-25T11:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157917",
    "user": "https://github.com/vbraun"
}
```

The review patch looks good to me.



---

archive/issue_events_036433.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-31T19:16:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13042#event-36433"
}
```



---

archive/issue_comments_157918.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-31T19:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13042",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13042#issuecomment-157918",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
