# Issue 17508: typo causes latex error in indexed generators

archive/issues_017508.json:
```json
{
    "body": "CC:  @tscrim @nthiery\n\nSee http://ask.sagemath.org/question/25763/incorrect-parsing-of-docstring-of-sagestructureindexed_generatorsindexedgenerators/\n> where a \\left is displayed as <=ft. It seems that \\le in \\left gets replaced by <=.\nThis is from #15289.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17745\n\n",
    "created_at": "2015-02-08T02:43:43Z",
    "labels": [
        "component: documentation",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "typo causes latex error in indexed generators",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17508",
    "user": "https://github.com/kcrisman"
}
```
CC:  @tscrim @nthiery

See http://ask.sagemath.org/question/25763/incorrect-parsing-of-docstring-of-sagestructureindexed_generatorsindexedgenerators/
> where a \left is displayed as <=ft. It seems that \le in \left gets replaced by <=.
This is from #15289.

Issue created by migration from https://trac.sagemath.org/ticket/17745





---

archive/issue_comments_233553.json:
```json
{
    "body": "I believe this is a general issue with the parsing of latex docstrings to a more ascii version just being too greedy (because I saw it somewhere else IIRC). Do you happen to know where the code that does this substitution is?",
    "created_at": "2015-02-08T07:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233553",
    "user": "https://github.com/tscrim"
}
```

I believe this is a general issue with the parsing of latex docstrings to a more ascii version just being too greedy (because I saw it somewhere else IIRC). Do you happen to know where the code that does this substitution is?



---

archive/issue_comments_233554.json:
```json
{
    "body": "Problem seems to be in `src/sage/misc/sagedoc.py`\n\n\n```\nmath_substitutes = [\n    ...\n    ('\\\\le', '<='),\n    ...\n]\n```\n",
    "created_at": "2015-02-08T10:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233554",
    "user": "https://github.com/a-andre"
}
```

Problem seems to be in `src/sage/misc/sagedoc.py`


```
math_substitutes = [
    ...
    ('\\le', '<='),
    ...
]
```




---

archive/issue_comments_233555.json:
```json
{
    "body": "One solution might be to replace `'\\\\left'` and `'\\\\right'` by `''` before replacing `\\\\le`.",
    "created_at": "2015-02-08T10:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233555",
    "user": "https://github.com/a-andre"
}
```

One solution might be to replace `'\\left'` and `'\\right'` by `''` before replacing `\\le`.



---

archive/issue_comments_233556.json:
```json
{
    "body": "I agree, along with perhaps:\n\n- `'\\\\lvert'` and `'\\\\rvert'` by `'|'`,\n- `'\\\\ast'` by `*`,\n- `'\\\\bigr'`, `'\\\\bigl'`, etc. by `''`.",
    "created_at": "2015-02-08T12:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233556",
    "user": "https://github.com/tscrim"
}
```

I agree, along with perhaps:

- `'\\lvert'` and `'\\rvert'` by `'|'`,
- `'\\ast'` by `*`,
- `'\\bigr'`, `'\\bigl'`, etc. by `''`.



---

archive/issue_comments_233557.json:
```json
{
    "body": "Here's an attempt at a fix, along the lines suggested.\n----\nNew commits:",
    "created_at": "2015-02-08T20:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233557",
    "user": "https://github.com/jhpalmieri"
}
```

Here's an attempt at a fix, along the lines suggested.
----
New commits:



---

archive/issue_comments_233558.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-02-08T20:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233558",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233559.json:
```json
{
    "body": "LGTM, but could you add one more test with a `\\\\left`, a `\\\\le`, and a `\\\\leq` to make sure all 3 get converted correctly? Thanks.",
    "created_at": "2015-02-09T00:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233559",
    "user": "https://github.com/tscrim"
}
```

LGTM, but could you add one more test with a `\\left`, a `\\le`, and a `\\leq` to make sure all 3 get converted correctly? Thanks.



---

archive/issue_comments_233560.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-09T16:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233561.json:
```json
{
    "body": "Sure, here you go. Eventually, we might run into the same problem with `\\\\to` or `\\\\ge`; at some point we might want to change the whole system so it uses regular expressions instead of just a plain text `replace`.\n----\nNew commits:",
    "created_at": "2015-02-09T16:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233561",
    "user": "https://github.com/jhpalmieri"
}
```

Sure, here you go. Eventually, we might run into the same problem with `\\to` or `\\ge`; at some point we might want to change the whole system so it uses regular expressions instead of just a plain text `replace`.
----
New commits:



---

archive/issue_comments_233562.json:
```json
{
    "body": "Thanks. Probably, but we'll cross that bridge if we come to it.",
    "created_at": "2015-02-09T18:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233562",
    "user": "https://github.com/tscrim"
}
```

Thanks. Probably, but we'll cross that bridge if we come to it.



---

archive/issue_comments_233563.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-09T18:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233563",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233564.json:
```json
{
    "body": "I realized that this won't work: it will turn `\\\\leftarrow` and `\\\\rightarrow` into `arrow`. I think regular expressions are the way to go.",
    "created_at": "2015-02-09T18:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233564",
    "user": "https://github.com/jhpalmieri"
}
```

I realized that this won't work: it will turn `\\leftarrow` and `\\rightarrow` into `arrow`. I think regular expressions are the way to go.



---

archive/issue_comments_233565.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-02-09T18:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233565",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_233566.json:
```json
{
    "body": "How about then just putting `\\\\leftarrow` and `\\\\rightarrow` before `\\left` and `\\right` (sending them to `<--` and `-->` respectively?",
    "created_at": "2015-02-09T18:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233566",
    "user": "https://github.com/tscrim"
}
```

How about then just putting `\\leftarrow` and `\\rightarrow` before `\left` and `\right` (sending them to `<--` and `-->` respectively?



---

archive/issue_comments_233567.json:
```json
{
    "body": "Because I don't think we should actually be trying to run a serious LaTeX-to-text conversion here, and that's what this is in danger of becoming. What about `\\leftrightarrow`, `\\leftleftarrows`, etc.?",
    "created_at": "2015-02-09T18:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233567",
    "user": "https://github.com/jhpalmieri"
}
```

Because I don't think we should actually be trying to run a serious LaTeX-to-text conversion here, and that's what this is in danger of becoming. What about `\leftrightarrow`, `\leftleftarrows`, etc.?



---

archive/issue_comments_233568.json:
```json
{
    "body": "I'm not so familiar with using regular expressions, so if you can make it more elegant that way, then +1 from me.",
    "created_at": "2015-02-09T19:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233568",
    "user": "https://github.com/tscrim"
}
```

I'm not so familiar with using regular expressions, so if you can make it more elegant that way, then +1 from me.



---

archive/issue_comments_233569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-09T20:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233570.json:
```json
{
    "body": "Here's a regular expression version.",
    "created_at": "2015-02-09T20:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233570",
    "user": "https://github.com/jhpalmieri"
}
```

Here's a regular expression version.



---

archive/issue_comments_233571.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-09T20:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233571",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233572.json:
```json
{
    "body": "The current implementation replaces LaTeX commands in the examples section, too.\nSee for example\n\n```\nsage: from sage.structure.indexed_generators import IndexedGenerators\nsage: IndexedGenerators?\n```\n\nThat's bad. Users might complain, that they don't get the results show in the examples.\n\nP.S. The ticket description should be updated.",
    "created_at": "2015-02-09T21:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233572",
    "user": "https://github.com/a-andre"
}
```

The current implementation replaces LaTeX commands in the examples section, too.
See for example

```
sage: from sage.structure.indexed_generators import IndexedGenerators
sage: IndexedGenerators?
```

That's bad. Users might complain, that they don't get the results show in the examples.

P.S. The ticket description should be updated.



---

archive/issue_comments_233573.json:
```json
{
    "body": "Replying to [comment:19 aapitzsch]:\n> The current implementation replaces LaTeX commands in the examples section, too.\n\nI think that's complicated to fix. We would need to detect when we're in an EXAMPLES or TESTS block and ignore the output, but otherwise process the output. I guess we can do that, but it's a little annoying to do perfectly. This really should be done for each of `detex`, `process_dollars`, `process_extlinks`, `process_mathtt`. So maybe it should actually be done in `format`:\n\n```\nif not in examples block:\n    detex(next line)\n    process_dollars(next_lines)\n    ...\n```\n\nSo everything would need to be rewritten with this logic in mind. Alternatively, each of those functions will duplicate some code which keeps track of whether it's processing a line in an examples block.\n\nI think that really, functions which have LaTeX output in their EXAMPLES (or elsewhere in their docstrings), and if that LaTeX should not be processed, then they should have their docstrings decorated with `nodetex`. That's why `nodetex` is available. Maybe we should add it to the IndexedGenerators docstring.\n\n> P.S. The ticket description should be updated.\n\nPlease go ahead. What did you have in mind?",
    "created_at": "2015-02-10T04:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233573",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:19 aapitzsch]:
> The current implementation replaces LaTeX commands in the examples section, too.

I think that's complicated to fix. We would need to detect when we're in an EXAMPLES or TESTS block and ignore the output, but otherwise process the output. I guess we can do that, but it's a little annoying to do perfectly. This really should be done for each of `detex`, `process_dollars`, `process_extlinks`, `process_mathtt`. So maybe it should actually be done in `format`:

```
if not in examples block:
    detex(next line)
    process_dollars(next_lines)
    ...
```

So everything would need to be rewritten with this logic in mind. Alternatively, each of those functions will duplicate some code which keeps track of whether it's processing a line in an examples block.

I think that really, functions which have LaTeX output in their EXAMPLES (or elsewhere in their docstrings), and if that LaTeX should not be processed, then they should have their docstrings decorated with `nodetex`. That's why `nodetex` is available. Maybe we should add it to the IndexedGenerators docstring.

> P.S. The ticket description should be updated.

Please go ahead. What did you have in mind?



---

archive/issue_comments_233574.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-10T04:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233574",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233575.json:
```json
{
    "body": "Probably this will also fix the followup comment at the ask.sagemath question:\n\n```\nsage: timeit(\"a = 2nb=131nfactor(a^b-1)\", number=25)\n  25 loops, best of 3: ... per loop\n```\n",
    "created_at": "2015-02-15T02:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233575",
    "user": "https://github.com/kcrisman"
}
```

Probably this will also fix the followup comment at the ask.sagemath question:

```
sage: timeit("a = 2nb=131nfactor(a^b-1)", number=25)
  25 loops, best of 3: ... per loop
```




---

archive/issue_comments_233576.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-15T17:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233576",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233577.json:
```json
{
    "body": "And even more examples from the same place:\n\n```\nAnother such issues appear for dirac_delta, heaviside, unit_step. A \\left gets replaced by <=ft\n```\n",
    "created_at": "2015-02-21T21:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233577",
    "user": "https://github.com/kcrisman"
}
```

And even more examples from the same place:

```
Another such issues appear for dirac_delta, heaviside, unit_step. A \left gets replaced by <=ft
```




---

archive/issue_comments_233578.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-02-22T01:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233578",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233579.json:
```json
{
    "body": "I think this is a good step in the right direction; most importantly, it fixes the issue at hand. So I'm going to give this a positive review.",
    "created_at": "2015-02-22T01:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233579",
    "user": "https://github.com/tscrim"
}
```

I think this is a good step in the right direction; most importantly, it fixes the issue at hand. So I'm going to give this a positive review.



---

archive/issue_comments_233580.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-02-24T00:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17508#issuecomment-233580",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_050745.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-02-24T00:39:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17508",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17508#event-50745"
}
```
