# Issue 31778: _sympy_ methods for Set_object_binary subclasses

Issue created by migration from https://trac.sagemath.org/ticket/32015

Original creator: mkoeppe

Original creation time: 2021-06-20 20:34:13

CC:  tscrim kcrisman egourgoulhon




---

Comment by mkoeppe created at 2021-06-21 21:02:00

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-06-21 21:02:00

Last 10 new commits:


---

Comment by git created at 2021-07-01 22:50:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-07-02 05:57:15

I am not sure about caching the output of `_sympy_`? It creates a clone of the set and ties it to the Sage object. Can you give some reasoning for this?


---

Comment by mkoeppe created at 2021-07-02 06:07:01

If one makes one computation with the sympy version of a set, it's likely that another computation will be made -- so saving the result seemed a good idea.


---

Comment by tscrim created at 2021-07-02 06:58:12

I would expect someone to store said Sympy version if they were going to use it again. Granted, I expect this to not be a problem either way. My instinct is to err on the side of not caching, but I don't have a strong opinion on this. So you either change it or not; once decided, you can set a positive review.


---

Comment by mkoeppe created at 2021-07-02 07:01:01

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-07-02 07:01:01

Thanks! I'm keeping it as is.


---

Comment by vbraun created at 2021-07-08 21:14:48


```
[docpdf] 
[docpdf] Overfull \hbox (22.51231p
[docpdf] ! Missing { inserted.
[docpdf] <to be read again> 
[docpdf]                    _
[docpdf] l.1488 ...n{}in class providing the operators \(__
[docpdf]                                                   add__\) and \(__sub__\).
[docpdf] ? 
[docpdf] [809
[docpdf] ! Emergency stop.
[docpdf] <to be read again> 
[docpdf]                    _
[docpdf] l.1488 ...n{}in class providing the operators \(__
[docpdf]                                                   add__\) and \(__sub__\).
[docpdf] !  ==> Fatal error occurred, no output PDF file produced!
```



---

Comment by vbraun created at 2021-07-08 21:14:48

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-08 21:39:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-08 21:39:39

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-07-09 23:17:13

Tests fail


---

Comment by vbraun created at 2021-07-09 23:17:13

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-09 23:33:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-09 23:38:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-09 23:39:12

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-07-10 03:45:31

LGTM.


---

Comment by tscrim created at 2021-07-10 03:45:31

Changing status from needs_review to positive_review.


---

Comment by @mjungmath created at 2021-07-13 00:32:57


```
File "src/sage/categories/sets_cat.py", line 1720, in sage.categories.sets_cat.Sets.ParentMethods._sympy_
Failed example:
    sF = F._sympy_(); sF
Expected:
    SageSet({1, 2})
Got:
    Set(1, 2)
```


and


```
File "src/sage/categories/sets_cat.py", line 1722, in sage.categories.sets_cat.Sets.ParentMethods._sympy_
Failed example:
    sF._sage_() is F
Exception raised:
    Traceback (most recent call last):
      File "/data/pell/lipnik/patchbot/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 718, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/data/pell/lipnik/patchbot/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1137, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.sets_cat.Sets.ParentMethods._sympy_[12]>", line 1, in <module>
        sF._sage_() is F
    AttributeError: 'Set' object has no attribute '_sage_'
```



---

Comment by @mjungmath created at 2021-07-13 00:32:57

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-13 00:57:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-13 00:57:37

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-07-13 01:01:34

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-07-13 01:01:34

Thanks for catching that.


---

Comment by @mjungmath created at 2021-07-13 01:12:41


```
sage -t --random-seed=0 src/sage/categories/sets_cat.py
    [478 tests, 0.52 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

Comment by mkoeppe created at 2021-07-13 01:36:29

Thanks!


---

Comment by git created at 2021-07-19 01:57:32

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-07-19 01:57:32

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2021-07-19 01:57:42

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-23 20:11:09

Resolution: fixed
