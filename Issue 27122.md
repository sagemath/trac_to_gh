# Issue 27122: Test for sage_makedirs breaks Sage on Windows

Issue created by migration from https://trac.sagemath.org/ticket/27359

Original creator: embray

Original creation time: 2019-02-26 10:52:26

#27196 modified a test for `sage_makedirs` to try to make a directory in place of the actual Python executable (`sys.executable`).

This test has a number of problems, not the least of which being that it will fail for permission reasons when run in a distro like Python.

But it actually breaks Sage on Windows because it _succeeds_ in creating a directory called "python2" alongside the actual executable "python2.exe".

I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`, but if we want to keep it for example purposes I would rewrite it to actually use a temp file and not try to overwrite a real file used by the system.


---

Comment by embray created at 2019-02-26 11:25:04

Still confirming that the updated test works on Python 3, but I believe it will.
----
New commits:


---

Comment by embray created at 2019-02-26 11:25:04

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2019-02-26 11:53:45

`tmp_filename()` already creates the file. There is no need to open and close it a second time.


---

Comment by jdemeyer created at 2019-02-26 11:59:59

Replying to [ticket:27359 embray]:
> I think the test itself is a bit silly since it's just testing standard functionality of the stdlib's `os.makedirs`

Not really, as `os.makedirs` fails if the directory already exists. (In Python 3, this was improved by adding support for an `exist_ok=True` flag)


---

Comment by embray created at 2019-02-26 12:10:04

Confirmed this passes for me on Python 3.


---

Comment by embray created at 2019-02-26 12:10:20

Replying to [comment:2 jdemeyer]:
> `tmp_filename()` already creates the file. There is no need to open and close it a second time.

Ah, so it does.  I'll just fix that real quick.


---

Comment by git created at 2019-02-26 12:14:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-03-11 11:19:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-13 18:29:37

Resolution: fixed
