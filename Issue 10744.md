# Issue 10744: singular-3-1-1-4.p3 doesn't build on ARM

Issue created by migration from Trac.

Original creator: Snark

Original creation time: 2011-02-21 07:13:35

Assignee: drkirkby

CC:  leif snark

I have made a patch to make singular build on ARM ; that patch made its way upstream in singular-3-1-3, which isn't in sage yet.

So I'm attaching my patch here, in hope sage will either use my patch or use a newer upstream.

PS: the upstream report is:
http://www.singular.uni-kl.de:8002/trac/ticket/299


---

Attachment

Patch to make singular work on ARM


---

Comment by leif created at 2011-08-06 18:20:49

Changing assignee from drkirkby to tbd.


---

Comment by leif created at 2011-08-06 18:20:49

Changing keywords from "" to "ELF Singular spkg".


---

Comment by leif created at 2011-08-06 18:20:49

Changing component from porting to packages.


---

Comment by Snark created at 2011-08-21 19:26:41

sage 4.7.1 has shipped with a singular which doesn't build on ARM. When will a new (hence fixed) singular make its way into sage?


---

Comment by leif created at 2011-08-22 05:58:15

Replying to [comment:2 Snark]:
> sage 4.7.1 has shipped with a singular which doesn't build on ARM. When will a new (hence fixed) singular make its way into sage?

Hopefully during the Sage/Singular Days (SD34) at the end of September, cf. #10903.

Otherwise you could make a new Singular spkg with your patch, based on Sage's latest one, which is singular-3-1-1-4.p13 from #11550 (merged into Sage 4.7.2.alpha0).


---

Comment by leif created at 2011-10-06 12:14:34

Julien, can you confirm that this ticket can be closed when #10903 gets merged?


---

Comment by leif created at 2011-10-06 12:14:34

Changing status from new to needs_review.


---

Comment by Snark created at 2011-10-06 14:06:40

If nothing was broken since my work with [upstream](http://www.singular.uni-kl.de:8002/trac/ticket/299), then indeed that ticket can be closed.

If a new problem arises, then that will be a separate issue.

I have to say that the discussion in bug #10903 where HAVE_ELF_SYSTEM shows up makes me nervous... that looks so wrong when you see the patch "Patch to directly detect ELF support" I gave upstream!


---

Comment by AlexanderDreyer created at 2011-10-10 19:05:19

Replying to [comment:5 Snark]:
> I have to say that the discussion in bug #10903 where HAVE_ELF_SYSTEM shows up makes me nervous... that looks so wrong when you see the patch "Patch to directly detect ELF support" I gave upstream!
It's not that easy: the platforms in question do not define `__ELF__`. In fact, they aren't fully ELF compatible, (it's about Macs), but Singular just needs an ELF-compatible dlopen here.


---

Comment by Snark created at 2011-10-10 19:21:44

Then perhaps I should consider providing a patch basically doing s/HAVE_ELF_SYSTEM/HAVE_DLOPEN/g...


---

Comment by jdemeyer created at 2011-10-15 13:05:30

Can anyone test this on ARM now that #10903 has been merged?


---

Comment by jdemeyer created at 2011-10-15 13:06:14

I meant: test the new singular spkg from #10903 (merged in sage-4.7.2.alpha4) on ARM?


---

Comment by Snark created at 2011-10-15 16:23:18

Is the spkg attached to the bug report the one to use, or am I supposed to also add the patches?


---

Comment by jdemeyer created at 2011-10-15 16:37:05

Replying to [comment:10 Snark]:
> Is the spkg attached to the bug report the one to use, or am I supposed to also add the patches?

It seems the problem was _building_ the spkg on ARM.  So it should be sufficient to _build_ the spkg from #10903 on ARM.

Of course, if you want to test that it actually works, you also need the patches.  But instead you can also download and build [sage-4.7.2.alpha4](http://boxen.math.washington.edu/home/release/sage-4.7.2.alpha4/), which includes the new Singular spkg.


---

Comment by Snark created at 2011-10-15 18:23:48

I downloaded :
http://boxen.math.washington.edu/home/release/sage-4.7.2.alpha4/sage-4.7.2.alpha4/spkg/standard/singular-3-1-3-3.p1.spkg

and tried to build it ; it fails with undefined references in the final linking phase :
g++   -o libsingular.so \
        iparith.o mpsr_Tok.o claptmpl.o \
        grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o bbcone.o bbfan.o denom_list.o minpoly.o  slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -lkernel -L../kernel -L../factory -L../libfac -L/home/jpuydt/sage-4.7.1/local/lib -lsingfac -lsingcf -lntl -lreadline -lgmp -lomalloc
/usr/lib/gcc/arm-linux-gnueabi/4.4.5/../../../crt1.o: In function `_start':
(.text+0x30): undefined reference to `main'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetnum'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetent'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetstr'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgoto'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `UP'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `BC'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tputs'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `PC'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetflag'
collect2: ld returned 1 exit status
make[1]: *** [libsingular] Erreur 1

From those the first one worries me most : why is it trying to find main in a lib!? I think that last linking line lacks something like "-shared" !


---

Comment by jdemeyer created at 2012-05-02 09:30:54

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-05-02 09:30:54

Julien reported that Singular works fine with sage-5.0.beta14.


---

Comment by jdemeyer created at 2012-05-03 12:08:04

Resolution: duplicate
