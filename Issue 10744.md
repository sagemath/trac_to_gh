# Issue 10744: singular-3-1-1-4.p3 doesn't build on ARM

archive/issues_010744.json:
```json
{
    "body": "Assignee: drkirkby\n\nCC:  @nexttime snark\n\nI have made a patch to make singular build on ARM ; that patch made its way upstream in singular-3-1-3, which isn't in sage yet.\n\nSo I'm attaching my patch here, in hope sage will either use my patch or use a newer upstream.\n\nPS: the upstream report is:\nhttp://www.singular.uni-kl.de:8002/trac/ticket/299\n\nIssue created by migration from https://trac.sagemath.org/ticket/10810\n\n",
    "created_at": "2011-02-21T07:13:35Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "singular-3-1-1-4.p3 doesn't build on ARM",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10744",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
Assignee: drkirkby

CC:  @nexttime snark

I have made a patch to make singular build on ARM ; that patch made its way upstream in singular-3-1-3, which isn't in sage yet.

So I'm attaching my patch here, in hope sage will either use my patch or use a newer upstream.

PS: the upstream report is:
http://www.singular.uni-kl.de:8002/trac/ticket/299

Issue created by migration from https://trac.sagemath.org/ticket/10810





---

archive/issue_comments_113230.json:
```json
{
    "body": "Attachment [singular.diff](tarball://root/attachments/some-uuid/ticket10810/singular.diff) by Snark created at 2011-02-21 07:14:17\n\nPatch to make singular work on ARM",
    "created_at": "2011-02-21T07:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113230",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Attachment [singular.diff](tarball://root/attachments/some-uuid/ticket10810/singular.diff) by Snark created at 2011-02-21 07:14:17

Patch to make singular work on ARM



---

archive/issue_comments_113231.json:
```json
{
    "body": "Changing assignee from drkirkby to tbd.",
    "created_at": "2011-08-06T18:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113231",
    "user": "https://github.com/nexttime"
}
```

Changing assignee from drkirkby to tbd.



---

archive/issue_comments_113232.json:
```json
{
    "body": "Changing keywords from \"\" to \"ELF Singular spkg\".",
    "created_at": "2011-08-06T18:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113232",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "" to "ELF Singular spkg".



---

archive/issue_comments_113233.json:
```json
{
    "body": "Changing component from porting to packages.",
    "created_at": "2011-08-06T18:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113233",
    "user": "https://github.com/nexttime"
}
```

Changing component from porting to packages.



---

archive/issue_comments_113234.json:
```json
{
    "body": "sage 4.7.1 has shipped with a singular which doesn't build on ARM. When will a new (hence fixed) singular make its way into sage?",
    "created_at": "2011-08-21T19:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113234",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

sage 4.7.1 has shipped with a singular which doesn't build on ARM. When will a new (hence fixed) singular make its way into sage?



---

archive/issue_comments_113235.json:
```json
{
    "body": "Replying to [comment:2 Snark]:\n> sage 4.7.1 has shipped with a singular which doesn't build on ARM. When will a new (hence fixed) singular make its way into sage?\n\nHopefully during the Sage/Singular Days (SD34) at the end of September, cf. #10903.\n\nOtherwise you could make a new Singular spkg with your patch, based on Sage's latest one, which is singular-3-1-1-4.p13 from #11550 (merged into Sage 4.7.2.alpha0).",
    "created_at": "2011-08-22T05:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113235",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:2 Snark]:
> sage 4.7.1 has shipped with a singular which doesn't build on ARM. When will a new (hence fixed) singular make its way into sage?

Hopefully during the Sage/Singular Days (SD34) at the end of September, cf. #10903.

Otherwise you could make a new Singular spkg with your patch, based on Sage's latest one, which is singular-3-1-1-4.p13 from #11550 (merged into Sage 4.7.2.alpha0).



---

archive/issue_comments_113236.json:
```json
{
    "body": "Julien, can you confirm that this ticket can be closed when #10903 gets merged?",
    "created_at": "2011-10-06T12:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113236",
    "user": "https://github.com/nexttime"
}
```

Julien, can you confirm that this ticket can be closed when #10903 gets merged?



---

archive/issue_comments_113237.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-06T12:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113237",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113238.json:
```json
{
    "body": "If nothing was broken since my work with [upstream](http://www.singular.uni-kl.de:8002/trac/ticket/299), then indeed that ticket can be closed.\n\nIf a new problem arises, then that will be a separate issue.\n\nI have to say that the discussion in bug #10903 where HAVE_ELF_SYSTEM shows up makes me nervous... that looks so wrong when you see the patch \"Patch to directly detect ELF support\" I gave upstream!",
    "created_at": "2011-10-06T14:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113238",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

If nothing was broken since my work with [upstream](http://www.singular.uni-kl.de:8002/trac/ticket/299), then indeed that ticket can be closed.

If a new problem arises, then that will be a separate issue.

I have to say that the discussion in bug #10903 where HAVE_ELF_SYSTEM shows up makes me nervous... that looks so wrong when you see the patch "Patch to directly detect ELF support" I gave upstream!



---

archive/issue_comments_113239.json:
```json
{
    "body": "Replying to [comment:5 Snark]:\n> I have to say that the discussion in bug #10903 where HAVE_ELF_SYSTEM shows up makes me nervous... that looks so wrong when you see the patch \"Patch to directly detect ELF support\" I gave upstream!\nIt's not that easy: the platforms in question do not define `__ELF__`. In fact, they aren't fully ELF compatible, (it's about Macs), but Singular just needs an ELF-compatible dlopen here.",
    "created_at": "2011-10-10T19:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113239",
    "user": "https://github.com/alexanderdreyer"
}
```

Replying to [comment:5 Snark]:
> I have to say that the discussion in bug #10903 where HAVE_ELF_SYSTEM shows up makes me nervous... that looks so wrong when you see the patch "Patch to directly detect ELF support" I gave upstream!
It's not that easy: the platforms in question do not define `__ELF__`. In fact, they aren't fully ELF compatible, (it's about Macs), but Singular just needs an ELF-compatible dlopen here.



---

archive/issue_comments_113240.json:
```json
{
    "body": "Then perhaps I should consider providing a patch basically doing s/HAVE_ELF_SYSTEM/HAVE_DLOPEN/g...",
    "created_at": "2011-10-10T19:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113240",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Then perhaps I should consider providing a patch basically doing s/HAVE_ELF_SYSTEM/HAVE_DLOPEN/g...



---

archive/issue_comments_113241.json:
```json
{
    "body": "Can anyone test this on ARM now that #10903 has been merged?",
    "created_at": "2011-10-15T13:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113241",
    "user": "https://github.com/jdemeyer"
}
```

Can anyone test this on ARM now that #10903 has been merged?



---

archive/issue_comments_113242.json:
```json
{
    "body": "I meant: test the new singular spkg from #10903 (merged in sage-4.7.2.alpha4) on ARM?",
    "created_at": "2011-10-15T13:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113242",
    "user": "https://github.com/jdemeyer"
}
```

I meant: test the new singular spkg from #10903 (merged in sage-4.7.2.alpha4) on ARM?



---

archive/issue_comments_113243.json:
```json
{
    "body": "Is the spkg attached to the bug report the one to use, or am I supposed to also add the patches?",
    "created_at": "2011-10-15T16:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113243",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Is the spkg attached to the bug report the one to use, or am I supposed to also add the patches?



---

archive/issue_comments_113244.json:
```json
{
    "body": "Replying to [comment:10 Snark]:\n> Is the spkg attached to the bug report the one to use, or am I supposed to also add the patches?\n\nIt seems the problem was *building* the spkg on ARM.  So it should be sufficient to *build* the spkg from #10903 on ARM.\n\nOf course, if you want to test that it actually works, you also need the patches.  But instead you can also download and build [sage-4.7.2.alpha4](http://boxen.math.washington.edu/home/release/sage-4.7.2.alpha4/), which includes the new Singular spkg.",
    "created_at": "2011-10-15T16:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113244",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 Snark]:
> Is the spkg attached to the bug report the one to use, or am I supposed to also add the patches?

It seems the problem was *building* the spkg on ARM.  So it should be sufficient to *build* the spkg from #10903 on ARM.

Of course, if you want to test that it actually works, you also need the patches.  But instead you can also download and build [sage-4.7.2.alpha4](http://boxen.math.washington.edu/home/release/sage-4.7.2.alpha4/), which includes the new Singular spkg.



---

archive/issue_comments_113245.json:
```json
{
    "body": "I downloaded :\nhttp://boxen.math.washington.edu/home/release/sage-4.7.2.alpha4/sage-4.7.2.alpha4/spkg/standard/singular-3-1-3-3.p1.spkg\n\nand tried to build it ; it fails with undefined references in the final linking phase :\ng++   -o libsingular.so \\\n        iparith.o mpsr_Tok.o claptmpl.o \\\n        grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o bbcone.o bbfan.o denom_list.o minpoly.o  slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -lkernel -L../kernel -L../factory -L../libfac -L/home/jpuydt/sage-4.7.1/local/lib -lsingfac -lsingcf -lntl -lreadline -lgmp -lomalloc\n/usr/lib/gcc/arm-linux-gnueabi/4.4.5/../../../crt1.o: In function `_start':\n(.text+0x30): undefined reference to `main'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetnum'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetent'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetstr'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgoto'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `UP'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `BC'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tputs'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `PC'\n/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetflag'\ncollect2: ld returned 1 exit status\nmake[1]: *** [libsingular] Erreur 1\n\nFrom those the first one worries me most : why is it trying to find main in a lib!? I think that last linking line lacks something like \"-shared\" !",
    "created_at": "2011-10-15T18:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113245",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

I downloaded :
http://boxen.math.washington.edu/home/release/sage-4.7.2.alpha4/sage-4.7.2.alpha4/spkg/standard/singular-3-1-3-3.p1.spkg

and tried to build it ; it fails with undefined references in the final linking phase :
g++   -o libsingular.so \
        iparith.o mpsr_Tok.o claptmpl.o \
        grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o bbcone.o bbfan.o denom_list.o minpoly.o  slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -lkernel -L../kernel -L../factory -L../libfac -L/home/jpuydt/sage-4.7.1/local/lib -lsingfac -lsingcf -lntl -lreadline -lgmp -lomalloc
/usr/lib/gcc/arm-linux-gnueabi/4.4.5/../../../crt1.o: In function `_start':
(.text+0x30): undefined reference to `main'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetnum'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetent'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetstr'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgoto'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `UP'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `BC'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tputs'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `PC'
/home/jpuydt/sage-4.7.1/local/lib/libreadline.so: undefined reference to `tgetflag'
collect2: ld returned 1 exit status
make[1]: *** [libsingular] Erreur 1

From those the first one worries me most : why is it trying to find main in a lib!? I think that last linking line lacks something like "-shared" !



---

archive/issue_comments_113246.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-02T09:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113246",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113247.json:
```json
{
    "body": "Julien reported that Singular works fine with sage-5.0.beta14.",
    "created_at": "2012-05-02T09:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113247",
    "user": "https://github.com/jdemeyer"
}
```

Julien reported that Singular works fine with sage-5.0.beta14.



---

archive/issue_comments_113248.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2012-05-03T12:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10744#issuecomment-113248",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_events_010860.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-03T12:08:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10744",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10744#event-10860"
}
```
