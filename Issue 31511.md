# Issue 31511: PolyhedralComplex

Issue created by migration from https://trac.sagemath.org/ticket/31748

Original creator: yzh

Original creation time: 2021-04-28 14:32:30

CC:  mkoeppe jhpalmieri jipilab tscrim

Keywords: polyhedral complex

Create (geometric) PolyhedralComplex, whose cells are Sage Polyhedra.


---

Comment by mkoeppe created at 2021-04-28 15:22:07

New commits:


---

Comment by git created at 2021-04-28 15:33:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-29 06:39:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-04-29 06:42:24

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-04-29 19:50:34

add author name so that the patchbot runs


---

Comment by git created at 2021-04-29 21:12:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-01 06:51:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-04 22:33:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-06 00:45:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-05-06 01:06:44

Ready for review.

I don't have much experience with abstract complexes. I'd like to know if this is going in the right direction with Sage homology.

I'm also wondering what other methods of `PolyhedralComplex` could be interesting. Maybe interactions between `PolyhedralComplex` and `SimplicialComplex` such as `PolyhedralComplex.subdivide()` and `SimplicialComplex.geometric_realization()`? And interactions between `PolyhedralComplex` and rational polyhedral fan?

Note that the methods `wedge`, `chain_complex` and `alexander_whitney` are currently missing, as I don't know how to implement them.

Any advice or comment is greatly appreciated! Thanks.


---

Comment by git created at 2021-05-09 17:34:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-13 21:00:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-05-27 23:30:07

Replying to [comment:12 yzh]:
> Ready for review.
> 
> I don't have much experience with abstract complexes. I'd like to know if this is going in the right direction with Sage homology.

It looks good to me so far, thank you for all of the work you've done.

> Note that the methods `wedge`, `chain_complex` and `alexander_whitney` are currently missing, as I don't know how to implement them.

I don't know anything about polyhedral complexes. The wedge is the one-point union, and to construct this, you're going to have to translate the two complexes so that they share a point. Is that acceptable? I could imagine taking a complex which has a point (x_1, x_2) and another complex which has a point (y_1, y_2), and forming the join by embedding both in a larger ambient space so that (x_1, x_2) -> (x_1, x_2, y_1, y_2) <- (y_1, y_2) — the first complex lies in the first coordinates, the second in the last coordinates. I don't know if that's a sensible construction from the point of view of people who actually work with these objects.

`chain_complex` — is there a standard way to produce a chain complex from a polyhedral complex? I would hope so, and I would hope that it's written down somewhere. We shouldn't invent something from scratch. Can we have a method that triangulates the complex and produces a simplicial complex? How hard would that be? I found this: https://sites.millersville.edu/rumble/slides/Seville-Feb-2018.pdf. Is it helpful?

`alexander_whitney` — I don't know how to handle this (although maybe the Umble slides describe it), and in any case, it's tied to a map of chain complexes, so there is no need to worry about it until the chain complex situation is resolved.


---

Comment by jhpalmieri created at 2021-05-27 23:38:19

By the way, is it possible to have a class of abstract polyhedral complexes, in addition to these more concrete complexes? Maybe it would be nice to view the product of two simplicial complexes as an "abstract" polyhedral complex without having to choose embeddings of the simplicial complexes.


---

Comment by mkoeppe created at 2021-05-27 23:42:18

That would be #31842 - `CombinatorialPolyhedralComplex`


---

Comment by mkoeppe created at 2021-05-27 23:43:09

I am also wondering where delta complexes fit in this story. Is every abstract polyhedral complex a delta complex?


---

Comment by tscrim created at 2021-05-27 23:59:27

Replying to [comment:16 jhpalmieri]:
> `chain_complex` — is there a standard way to produce a chain complex from a polyhedral complex? I would hope so, and I would hope that it's written down somewhere. We shouldn't invent something from scratch. Can we have a method that triangulates the complex and produces a simplicial complex? How hard would that be? I found this: https://sites.millersville.edu/rumble/slides/Seville-Feb-2018.pdf. Is it helpful?

My quick thought for the case of a *polytope* complex this is you could take any simplicial complex equivalent to the top-dimensional polytopes to get an equivalent simplicial complex. Then the generalized Stokes theorem would allow you to compute a differential via that simplicial decomposition. Moreover, we should be able to do this with a combinatorial description (i.e., just using the vertices of the polytope complex).

For a polyhedral complex, then we have issues with noncompactness to address. Although in the notes John linked to, they define a polyhedral complex to be with polytope faces. So I think we should be slightly careful about naming to distinguish which objects we allow.

There's a wikipedia stub page about this as well: https://en.wikipedia.org/wiki/Polyhedral_complex The ability to plot [tropical varieties](https://en.wikipedia.org/wiki/Tropical_geometry) would be great to have. (Reminder to myself, I still need to implement tropical polynomials...) It might be good to also link this to special cases such as fans.


---

Comment by yzh created at 2021-05-28 00:46:51

`@`tscrim `@`jhpalmieri Thank you very much for the feedback! I have yet to study those references.

Replying to [comment:16 jhpalmieri]:
>
> Can we have a method that triangulates the complex and produces a simplicial complex? 
>
Do you mean the method `PolyhedralComplex.subdivide(make_simplicial=True)`? It produces a **geometric** simplicial complex. 
Then, #31842 - `CombinatorialPolyhedralComplex` will take care of making it abstract.


---

Comment by yzh created at 2021-05-28 00:54:16

Replying to [comment:20 tscrim]:
> It might be good to also link this to special cases such as fans.
I considered to link between `PolyhedralComplex` and `RationalPolyhedralFan`. However, I really didn't want to restrict to the rational case only.


---

Comment by jhpalmieri created at 2021-05-28 00:58:25

Replying to [comment:19 mkoeppe]:
> I am also wondering where delta complexes fit in this story. Is every abstract polyhedral complex a delta complex?

The cells in a Delta-complex are all simplices, but maybe any triangulation of an abstract polyhedral complex will always be a Delta-complex. The boundary of a simplex in a Delta-complex is not determined by its vertices: you can make a Delta-complex model of a 2-sphere out of two triangles with a common boundary. Is that allowed in an abstract polyhedral complex?


---

Comment by jhpalmieri created at 2021-05-28 23:29:38

In my opinion, we can merge this and then refine later. What do others think?


---

Comment by mkoeppe created at 2021-05-28 23:57:44

No objection here. It looks great to me!

Minor comment: Shouldn't `disjoint_union` raise an error if the input is not disjoint?

Typos: interoir->interior, complexe->complex


---

Comment by yzh created at 2021-05-29 01:44:03

> Minor comment: Shouldn't `disjoint_union` raise an error if the input is not disjoint?
It does.

```
sage: pc = PolyhedralComplex([Polyhedron(vertices=[(1, 1), (0, 0), (1, 2)])])                     
sage: pc2 = PolyhedralComplex([Polyhedron(vertices=[(1, 1), (0, 0), (0, 1)])])                    
sage: pc.disjoint_union(pc2) 
ValueError: The given cells are not face-to-face
```



---

Comment by mkoeppe created at 2021-05-29 01:48:16

But

```
sage: pc3 = PolyhedralComplex([Polyhedron(vertices=[(1, 1), (0, 0), (1, 0)])])
sage: pc2.disjoint_union(pc3)
Polyhedral complex with 2 maximal cells
```



---

Comment by git created at 2021-05-29 01:51:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-05-29 01:54:41

Replying to [comment:27 mkoeppe]:
> But
> {{{
> sage: pc3 = PolyhedralComplex([Polyhedron(vertices=[(1, 1), (0, 0), (1, 0)])])
> sage: pc2.disjoint_union(pc3)
> Polyhedral complex with 2 maximal cells
> }}}
That looks correct to me.


---

Comment by yzh created at 2021-05-29 01:55:31

Ah, do you mean that `pc2.disjoint_union(pc2)` should raise an error?


---

Comment by mkoeppe created at 2021-05-29 01:56:23

pc2 and pc3 are not disjoint, so this should be an error


---

Comment by mkoeppe created at 2021-05-29 01:59:14


```
sage: pc0 = PolyhedralComplex()
sage: pc0.ambient_dimension()
-1
sage: pc0.add_cell(Polyhedron(vertices=[(1, 1), (0, 0), (1, 0)]))
ValueError: The given cell is not a polyhedron in the same ambient space.
```

I think it would be better to add a keyword argument `ambient_dim` to `__init__` so that one can set up an empty complex in the intended ambient space


---

Comment by yzh created at 2021-05-29 02:12:59

Good point! What I implemented in `disjoint_union` is actually the union, but not the disjoint union.
Replying to [comment:31 mkoeppe]:
> pc2 and pc3 are not disjoint, so this should be an error


---

Comment by git created at 2021-05-29 03:08:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-29 03:46:08

My comments have all been addressed, thanks!


---

Comment by tscrim created at 2021-05-29 09:10:29

I agree that we can merge this without implementing the homology stuff. I have a few comments that should be addressed first:

- It feels like there is a lot of overlap with the `SimplicialComplex` code. Do we want to refactor things to common base classes and/or use inheritance?
- The bullet points for `backend` in `PolyhedralComplex`'s doc are over-indented (back them up 2 spaces).
- Not every method has a doctest, even if all they currently do is raise a `NotImplementedError`.
- It would be good to include a message when you raise an error (see, e.g., the `ValueError` in `PolyhedralComplex.__init__`).
- Error messages should start with a lowercase and not end with a period/full-stop. This is a Python convention we generally try to follow
- Be consistent with how you do your documentation. I would not use the `:param` format personally.
- I think the `_an_element_` should raise an `EmptySetError` if it has no elements.


---

Comment by git created at 2021-05-30 01:54:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-05-30 02:01:18

Thanks, Travis! I revised the code according to your comments (expect for 1). 

I agree that `PolyhedralComplex` and `SimplicialComplex` have many overlapping methods. As you may have noticed, these are methods required by the parent class `GenericCellComplex`. However, as one is geometric and the other is abstract, and due to the different ways that cells are stored inside the two complexes, I don't see how one can easily factor out a common base class etc.


---

Comment by jhpalmieri created at 2021-05-30 02:16:51

Typo: "poyhedron" on about line 8.

I might change `has_maximal_cell` to `is_maximal_cell`. What do you think?

As far as refactoring goes, I see similar code but not identical code, so it would some work to reorganize things. That can be done on another ticket, in my opinion.


---

Comment by yzh created at 2021-05-30 02:55:43

Replying to [comment:39 jhpalmieri]:
> Typo: "poyhedron" on about line 8.
Thanks for catching that!
> I might change `has_maximal_cell` to `is_maximal_cell`. What do you think?
I once heard that `self.is_xxx(other)` means that "`self` is xxx of `other`". Therefore, in this case, I would think that `cell.is_maximal_cell(polyhedralcomplex)` and `polyhedralcomplex.has_maximal_cell(cell)`. If this is not the convention in `sage/homology`, I'm happy to change the name to `is_maximal_cell`.
> As far as refactoring goes, I see similar code but not identical code, so it would some work to reorganize things. That can be done on another ticket, in my opinion.
:)


---

Comment by git created at 2021-05-30 02:56:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-05-31 03:57:23

Replying to [comment:40 yzh]:
> Replying to [comment:39 jhpalmieri]:
> > I might change `has_maximal_cell` to `is_maximal_cell`. What do you think?
> I once heard that `self.is_xxx(other)` means that "`self` is xxx of `other`". Therefore, in this case, I would think that `cell.is_maximal_cell(polyhedralcomplex)` and `polyhedralcomplex.has_maximal_cell(cell)`. If this is not the convention in `sage/homology`, I'm happy to change the name to `is_maximal_cell`.

In `simplicial_complex.py`, the methods `is_face` and `is_shelling_order` use `is...` the way I'm suggesting. It's common for `is_xxx(self)` to be used the way you say, but not universal, and absolutely not universal for `is_xxx(self, x, y, z)`, with more arguments.


---

Comment by tscrim created at 2021-06-05 08:22:37

A few things to do before I would set a positive review:

- Add doctests for the `NotImplementedError` raising methods.
- Change `has_maximal_cell` to `is_maximal_cell` because that is what the docstring is saying. If this was `has_maximal_cell`, I would expect it not to take any other arguments.
- You can test plotting:
  {{{
sage: poset.plot(element_labels=d)                    # not tested
  }}}
- Change:
  {{{#!diff
-TESTS on nonbounded polyhedral complex::
+For a nonbounded polyhedral complex::
  }}}
- Add a `TestSuite(foo).run()` to the `__init__` doctests. (Not really necessary, but I like to see such a test there.)


---

Comment by jhpalmieri created at 2021-06-07 21:44:23

Also under discussion at #30400 and #31925: create a new directory `sage/topology` and move all files which deal with topological spaces there, leaving `sage/homology` for chain complexes and related tools. So perhaps this could be placed in `sage/topology` as well.


---

Comment by mkoeppe created at 2021-06-23 02:17:11

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-06-23 02:17:11

In light of #31925 I would actually suggest to move `PolyhedralComplex` to `sage.geometry.polyhedral_complex` -- where already similar modules exist: `fan`, `triangulation`, `voronoi_diagram`, `hyperplane_arrangement`.


---

Comment by git created at 2021-07-11 18:33:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-11 20:19:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-07-11 20:20:08

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-07-12 00:45:34

I made some reviewer changes to the documentation to standardize it a bit. If my changes are good, then I think we can set a positive review.
----
New commits:


---

Comment by chapoton created at 2021-07-12 07:18:27

there is a red patchbot plugin (pyflakes)


---

Comment by jhpalmieri created at 2021-07-12 15:44:48

Replying to [comment:50 chapoton]:
> there is a red patchbot plugin (pyflakes)

In particular:

```
src/sage/geometry/polyhedral_complex.py:117:1 'sage.structure.sage_object.SageObject' imported but unused
src/sage/geometry/polyhedral_complex.py:119:1 'sage.rings.rational_field.QQ' imported but unused
src/sage/geometry/polyhedral_complex.py:326:13 local variable 'cells' is assigned to but never used
src/sage/geometry/polyhedral_complex.py:967:13 local variable 'cells' is assigned to but never used
```



---

Comment by jhpalmieri created at 2021-07-12 19:56:33

These changes should fix those problems. Should I push a branch? What do you think of just calling `self.cells()` instead of `cells = self.cells()`?

```diff
diff --git a/src/sage/geometry/polyhedral_complex.py b/src/sage/geometry/polyhedral_complex.py
index 351bfe65b3..06dc60380c 100644
--- a/src/sage/geometry/polyhedral_complex.py
+++ b/src/sage/geometry/polyhedral_complex.py
@@ -114,9 +114,7 @@ from sage.topology.cell_complex import GenericCellComplex
 from sage.geometry.polyhedron.constructor import Polyhedron
 from sage.geometry.polyhedron.base import is_Polyhedron
 from sage.modules.free_module_element import vector
-from sage.structure.sage_object import SageObject
 from sage.rings.integer_ring import ZZ
-from sage.rings.rational_field import QQ
 from sage.graphs.graph import Graph
 from sage.combinat.posets.posets import Poset
 from sage.misc.misc import powerset
@@ -323,7 +321,7 @@ class PolyhedralComplex(GenericCellComplex):
         self._face_poset = None
 
         if maximality_check:
-            cells = self.cells()    # compute self._cells and self._face_poset
+            self.cells()    # compute self._cells and self._face_poset
             self._maximal_cells = cells_list_to_cells_dict(
                                       self._face_poset.maximal_elements())
         if face_to_face_check:
@@ -964,7 +962,7 @@ class PolyhedralComplex(GenericCellComplex):
             Finite poset containing 9 elements
         """
         if self._face_poset is None:
-            cells = self.cells()    # poset is obtained and cached in cells()
+            self.cells()    # poset is obtained and cached in cells()
         return self._face_poset
 
     def is_subcomplex(self, other):
```



---

Comment by yzh created at 2021-07-12 21:41:12

Thanks for the fixes! Calling `self.cells()` looks good to me.


---

Comment by git created at 2021-07-12 21:46:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-07-12 22:37:39

I'm happy. Positive review from everyone else?


---

Comment by tscrim created at 2021-07-12 22:46:22

LGTM.


---

Comment by tscrim created at 2021-07-12 22:46:22

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-07-22 21:23:46

On 32-bit:

```
**********************************************************************
File "src/sage/geometry/polyhedral_complex.py", line 1407, in sage.geometry.polyhedral_complex.PolyhedralComplex.relative_boundary_cells
Failed example:
    [p.vertices() for p in pc_lower_dim.relative_boundary_cells()]
Expected:
    [(A vertex at (0, 2),), (A vertex at (1, 2),)]
Got:
    [(A vertex at (1, 2),), (A vertex at (0, 2),)]
**********************************************************************
1 item had failures:
   1 of  17 in sage.geometry.polyhedral_complex.PolyhedralComplex.relative_boundary_cells
    [451 tests, 1 failure, 14.88 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/geometry/polyhedral_complex.py  # 1 doctest failed
----------------------------------------------------------------------

```



---

Comment by vbraun created at 2021-07-22 21:23:46

Changing status from positive_review to needs_work.


---

Comment by git created at 2021-07-22 22:53:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-07-22 22:53:22

Trivial fix of added `sorted` to doctest.


---

Comment by tscrim created at 2021-07-22 22:53:22

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-07-24 15:28:35

Resolution: fixed
