# Issue 18369: p-adic extensions created with "the same" polynomials may not be the same

Issue created by migration from Trac.

Original creator: mmasdeu

Original creation time: 2015-06-04 10:17:49

CC:  roed cremona

Keywords: padics, extensions, hash

The follow snippet of code shows the bug:


```
sage: x = QQ['x'].gen()
sage: F = Qp(5,20)
sage: K = F.extension(x^2-F(13),names = 'g')
sage: R = MatrixSpace(K,1,1)
sage: K1 = F.extension(x^2-13,names = 'g')
sage: Matrix(K1,1,1,[K1(0)])
```


You would expect the last line to *never* fail, but it does in this case, and the exception raised is not informative:


```
NotImplementedError: Conversion from different p-adic extensions not yet supported
```


The reason is the following:

```
sage: K is K1
False
sage: hash(K) == hash(K1)
True
```


Since MatrixSpace has unique representation, the second time that it is called it returns the space over K, not over K1 (this uses the hash of the key values). In the same initialization, it refuses to see K1(0) as an element of K, and the exception is raised.

I think that what should be done to avoid this problem is to convert the defining polynomial of the extension to a polynomial over the base when sanitising the keys.



---

Comment by roed created at 2017-07-17 17:40:01

Changing keywords from "padics, extensions, hash" to "padics, extensions, hash, sd87".


---

Comment by roed created at 2017-07-17 17:40:01

Also see #23331


---

Comment by roed created at 2017-09-20 17:30:51

New commits:


---

Comment by roed created at 2017-09-20 17:30:51

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-09-22 18:51:11

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-09-22 18:51:11

ok


---

Comment by vbraun created at 2017-09-24 13:13:34

Resolution: fixed
