# Issue 17975: fix NameError in mathematica_free integration

Issue created by migration from Trac.

Original creator: github/bukzor

Original creation time: 2015-04-15 20:32:41

It seems like the purpose was to normalize the variable of integration to `x`.

The line in question substitutes x for `dvar` rather than the variable of integration passed in, `v`.

https://github.com/sagemath/sage/pull/37


---

Comment by github created at 2015-04-15 20:32:41

Changing status from new to needs_review.


---

Comment by git created at 2015-04-15 20:34:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2015-05-12 19:25:18

Changing component from PLEASE CHANGE to interfaces.


---

Comment by kcrisman created at 2015-05-12 19:25:18

Changing type from PLEASE CHANGE to defect.


---

Comment by kcrisman created at 2015-05-29 04:29:56

Can you give an example of where this `NameError` occurs?  It would make little sense to change this without somehow doctesting what it was that went wrong.  In the most recent Sage devel version I get

```
sage: integral(sin(x)^2, x, algorithm='mathematica_free')
-1/2*cos(x)*sin(x) + 1/2*x
```



---

Comment by kcrisman created at 2015-05-29 04:30:13

Changing status from needs_review to needs_work.


---

Comment by github created at 2015-05-29 04:31:25

github/kcrisman wrote:

Hi!  Let's continue the discussion at http://trac.sagemath.org/ticket/18212.


---

Comment by kcrisman created at 2015-05-29 04:31:48

> Can you give an example of where this `NameError` occurs?  It would make little sense to change this without somehow doctesting what it was that went wrong.  In the most recent Sage devel version I get
Figured it out.

```
sage: var('y')
y
sage: integral(sin(y)^2, y, algorithm='mathematica_free')
---------------------------------------------------------------------------
NameError: global name 'dvar' is not defined
```



---

Comment by kcrisman created at 2015-05-29 04:51:48

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2015-05-29 04:51:48

I'm pushing a branch with doctests, and in doing this made a few more optional for internet so one doesn't have the `optional=internet,sage` problem as usual, then I replicated a different test elsewhere so it still gets tested ordinarily.  Basically just needs review that this all works.
----
New commits:


---

Comment by jdemeyer created at 2015-06-19 19:51:52

Why are these tests marked `# optional`?

```
sage: _ = var('x, y, z') # optional - internet
sage: f = sin(x^2) + y^z # optional - internet
```



---

Comment by jdemeyer created at 2015-06-19 19:51:52

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2015-06-19 19:52:58

Same question here:

```
sage: from sage.symbolic.integration.external import mma_free_integrator # optional - internet
```


If importing the module requires internet, you're doing it wrong...


---

Comment by jdemeyer created at 2015-06-19 19:54:59

And there is this oddity:

```
Test a few imports, without internet::
```

???


---

Comment by kcrisman created at 2015-06-19 20:06:47

> I'm pushing a branch with doctests, and in doing this made a few more optional for internet so one doesn't have the `optional=internet,sage` problem as usual, then I replicated a different test elsewhere so it still gets tested ordinarily. 

I hope that this quote from comment:9 answers your questions.  It's very annoying to do `--optional=internet` and then have tests fail because the "prereq" lines weren't evaluated.  So that is my philosophy, to avoid `--optional=sage,internet` which I view as more than annoying to remember.


---

Comment by jdemeyer created at 2015-06-19 20:59:45

Ah, I see now.


---

Comment by jdemeyer created at 2015-06-19 21:09:37

If you really have problems with the fact that `./sage -t --optional=internet` tests do not work, the proper fix would simply be to change the doctest framework (after sending a message to sage-devel of course). As far as I know, when we rewrote the doctest framework in #12415, we implemented `--optional` the way it is simply to emulate historical behaviour, I don't think it was a conscious choice.


---

Comment by jdemeyer created at 2015-06-19 21:10:17

The fact that your patch actually needs to duplicate a doctest (once with `# optional` and once without) shows to me that your solution is not good.


---

Comment by kcrisman created at 2015-06-20 13:29:44

Well, I only do that so that it's 100% sure to be doctested.  Submit a change you like and I'll review it, this isn't that horrible in any case, the key is to fix the error.


---

Comment by jdemeyer created at 2015-06-23 13:49:26

Changing component from interfaces to interfaces: optional.


---

Comment by chapoton created at 2017-05-11 18:50:56

New commits:


---

Comment by chapoton created at 2017-05-11 18:52:33

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2017-05-13 01:17:31

While I agree with Jeroen that we should have the minimal amount of `# optional` tags as needed, I see this as essentially bikeshedding. So I'm setting this to a positive review.


---

Comment by tscrim created at 2017-05-13 01:17:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-05-14 08:20:11

Resolution: fixed
