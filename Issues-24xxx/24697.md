# Issue 24697: Upgrade MPFR to 4.0.1

archive/issues_024460.json:
```json
{
    "body": "MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.\n\n**Tarball**: http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2\n\nCC:  @kiwifb\n\nBranch/Commit: f9772bc2aa7b6603b551cc49250f9335201456e5\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24697\n\n",
    "closed_at": "2018-02-12T22:30:11Z",
    "created_at": "2018-02-09T16:34:35Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Upgrade MPFR to 4.0.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24697",
    "user": "https://github.com/fredrik-johansson"
}
```
MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.

**Tarball**: http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2

CC:  @kiwifb

Branch/Commit: f9772bc2aa7b6603b551cc49250f9335201456e5

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24697





---

archive/issue_comments_463048.json:
```json
{
    "body": "Replying to [ticket:24697 fredrik.johansson]:\n> In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac.\n\n\nThat is not an MPFR bug at all. It's just because you have the old MPFR and new MPFR installed. Some libraries that GCC links against are using the old MPFR and some are using the new MPFR. The solution is to recompile GCC.",
    "created_at": "2018-02-09T16:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463048",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:24697 fredrik.johansson]:
> In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac.


That is not an MPFR bug at all. It's just because you have the old MPFR and new MPFR installed. Some libraries that GCC links against are using the old MPFR and some are using the new MPFR. The solution is to recompile GCC.



---

archive/issue_comments_463049.json:
```json
{
    "body": "<a id='comment:2'></a>\nThat being said, we should still upgrade to 4.0.1 but it won't fix your library versioning issues.",
    "created_at": "2018-02-09T16:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463049",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
That being said, we should still upgrade to 4.0.1 but it won't fix your library versioning issues.



---

archive/issue_comments_463050.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1 @@\n MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.\n-\n-There are also some versioning issues in 4.0.0. In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac. I don't know if it's exactly the same problem, but it looks very similar to what is reported at https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=888422 which suggests upgrading MPFR to 4.0.1 is a fix.\n-\n-\n``````\n",
    "created_at": "2018-02-09T16:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463050",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1 @@
 MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.
-
-There are also some versioning issues in 4.0.0. In fact, I'm currently unable to build recent branches of Sage due to a getting an MPFR assertion error in gcc when building giac. I don't know if it's exactly the same problem, but it looks very similar to what is reported at https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=888422 which suggests upgrading MPFR to 4.0.1 is a fix.
-
-
``````




---

archive/issue_comments_463051.json:
```json
{
    "body": "<a id='comment:3'></a>\nIf the error in `mpfr_div` is serious, this should be a blocker.",
    "created_at": "2018-02-09T16:43:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463051",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
If the error in `mpfr_div` is serious, this should be a blocker.



---

archive/issue_comments_463052.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.\n+\n+**Tarball**: http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2\n``````\n",
    "created_at": "2018-02-09T16:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463052",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 MPFR should be upgraded to 4.0.1 as 4.0.0 has a serious bug in mpfr_div affecting correctness.
+
+**Tarball**: http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2
``````




---

archive/issue_comments_463053.json:
```json
{
    "body": "<a id='comment:6'></a>\n> That is not an MPFR bug at all.\n\n\nYou're right, thanks for the correction, although I was puzzled by seeing the error messages pointing to Sage's copy of MPC. I was able to build Sage by switching to gcc-7.\n\n> If the error in mpfr_div is serious, this should be a blocker.\n\n\nI don't know if it's likely to cause trouble in real computations, but it did break Arb's test suite (which is how it was discovered). In any case, it makes sense to do the upgrade sooner rather than later.",
    "created_at": "2018-02-09T19:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463053",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:6'></a>
> That is not an MPFR bug at all.


You're right, thanks for the correction, although I was puzzled by seeing the error messages pointing to Sage's copy of MPC. I was able to build Sage by switching to gcc-7.

> If the error in mpfr_div is serious, this should be a blocker.


I don't know if it's likely to cause trouble in real computations, but it did break Arb's test suite (which is how it was discovered). In any case, it makes sense to do the upgrade sooner rather than later.



---

archive/issue_comments_463054.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/upgrade_mpfr_to_4_0_1\"",
    "created_at": "2018-02-10T09:38:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463054",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/upgrade_mpfr_to_4_0_1"



---

archive/issue_comments_463055.json:
```json
{
    "body": "<a id='comment:8'></a>\nNew commits:\n|                                                                                                                                          |                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[f9772bc](https://github.com/sagemath/sagetrac-mirror/commit/f9772bc2aa7b6603b551cc49250f9335201456e5)|`Upgrade to MPFR-4.0.1`|",
    "created_at": "2018-02-10T09:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463055",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
New commits:
|                                                                                                                                          |                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[f9772bc](https://github.com/sagemath/sagetrac-mirror/commit/f9772bc2aa7b6603b551cc49250f9335201456e5)|`Upgrade to MPFR-4.0.1`|



---

archive/issue_comments_463056.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-02-10T09:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463056",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_463057.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-10T09:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463057",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_463058.json:
```json
{
    "body": "Changing commit from \"\" to \"f9772bc2aa7b6603b551cc49250f9335201456e5\"",
    "created_at": "2018-02-10T09:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463058",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "f9772bc2aa7b6603b551cc49250f9335201456e5"



---

archive/issue_comments_463059.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-10T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463059",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_463060.json:
```json
{
    "body": "<a id='comment:9'></a>\nMay the buildbots be with you.",
    "created_at": "2018-02-10T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463060",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
May the buildbots be with you.



---

archive/issue_comments_463061.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-02-10T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463061",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_events_078531.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-12T22:30:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24697#event-78531"
}
```



---

archive/issue_comments_463062.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-12T22:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463062",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_463063.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/upgrade_mpfr_to_4_0_1\" to \"f9772bc2aa7b6603b551cc49250f9335201456e5\"",
    "created_at": "2018-02-12T22:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24697",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24697#issuecomment-463063",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/upgrade_mpfr_to_4_0_1" to "f9772bc2aa7b6603b551cc49250f9335201456e5"
