# Issue 24627: Use arb 2.6+ comparison functions instead of custom implementation

archive/issues_024390.json:
```json
{
    "body": "CC:  @jdemeyer @videlec @cheuberg @fredrik-johansson\n\nThis ticket also makes a small (and safe) change to comparison semantics:\n\nSage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a breach of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24627\n\n",
    "closed_at": "2018-03-04T23:29:00Z",
    "created_at": "2018-01-31T18:44:13Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Use arb 2.6+ comparison functions instead of custom implementation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24627",
    "user": "https://github.com/mezzarobba"
}
```
CC:  @jdemeyer @videlec @cheuberg @fredrik-johansson

This ticket also makes a small (and safe) change to comparison semantics:

Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a breach of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.

Issue created by migration from https://trac.sagemath.org/ticket/24627





---

archive/issue_comments_341296.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-31T18:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341296",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_341297.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-01-31T18:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341297",
    "user": "https://github.com/mezzarobba"
}
```

New commits:



---

archive/issue_comments_341298.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-01T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341298",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341299.json:
```json
{
    "body": "Good move.\n\nHowever, i got a failing doctest in `src/sage/rings/polynomial/polynomial_element.pyx`, that reveals a criminal (though documented) failure in the previous behaviour of `RBF`, that `x = RBF(1.0, 0.1) ; x == x` returns `True`. The doctest seems to have been introduced in #22087 without complain.\n\nLet me suggest to:\n\n- move the doctest `x = RBF(1.0, 0.1) ; x == x` to something specific to ARB (it has nothing to do with polynomials actually)\n- add the doctest that triggered #22087 proposed at [/22076#comment:5 #22076:comment:5] in `src/sage/rings/polynomial/polynomial_element.pyx`\n- adapt the doctests corresponding to `RIF` in `src/sage/rings/polynomial/polynomial_element.pyx` (the block just above) to the `RBF` case.",
    "created_at": "2018-02-01T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341299",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Good move.

However, i got a failing doctest in `src/sage/rings/polynomial/polynomial_element.pyx`, that reveals a criminal (though documented) failure in the previous behaviour of `RBF`, that `x = RBF(1.0, 0.1) ; x == x` returns `True`. The doctest seems to have been introduced in #22087 without complain.

Let me suggest to:

- move the doctest `x = RBF(1.0, 0.1) ; x == x` to something specific to ARB (it has nothing to do with polynomials actually)
- add the doctest that triggered #22087 proposed at [/22076#comment:5 #22076:comment:5] in `src/sage/rings/polynomial/polynomial_element.pyx`
- adapt the doctests corresponding to `RIF` in `src/sage/rings/polynomial/polynomial_element.pyx` (the block just above) to the `RBF` case.



---

archive/issue_comments_341300.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-12T13:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341300",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_341301.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-12T13:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341301",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_341302.json:
```json
{
    "body": "Replying to [ticket:24627 mmezzarobba]:\n> This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. \n\n\nIf you are changing semantics, don't hide that information in the commit message!",
    "created_at": "2018-02-12T14:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341302",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:24627 mmezzarobba]:
> This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. 


If you are changing semantics, don't hide that information in the commit message!



---

archive/issue_comments_341303.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-02-12T14:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341303",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_341304.json:
```json
{
    "body": "?!?\n\nThat's why I mentioned it here... Commit messages are both more durable and easier to access than trac tickets, aren't they? But I can copy the commit message here if you prefer:\n\n  Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.",
    "created_at": "2018-02-12T14:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341304",
    "user": "https://github.com/mezzarobba"
}
```

?!?

That's why I mentioned it here... Commit messages are both more durable and easier to access than trac tickets, aren't they? But I can copy the commit message here if you prefer:

  Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.



---

archive/issue_comments_341305.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-02-12T14:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341305",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_341306.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-02-12T14:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341306",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_341307.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-26T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341307",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_341308.json:
```json
{
    "body": "All tests pass. This is a great improvement (that is blocking many other tickets).",
    "created_at": "2018-02-26T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341308",
    "user": "https://github.com/videlec"
}
```

All tests pass. This is a great improvement (that is blocking many other tickets).



---

archive/issue_comments_341309.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-04T23:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-341309",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062034.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-04T23:29:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24627#event-62034"
}
```
