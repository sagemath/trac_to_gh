# Issue 24627: Use arb 2.6+ comparison functions instead of custom implementation

archive/issues_024390.json:
```json
{
    "body": "This ticket also makes a small (and safe) change to comparison semantics:\n\nSage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a breach of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.\n\nCC:  @jdemeyer @videlec @cheuberg @fredrik-johansson\n\nBranch/Commit: b55e3c2b7223da4044d43d9c0ca523455be6c117\n\nReviewer: Thierry Monteil, Vincent Delecroix\n\nAuthor: Marc Mezzarobba\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24627\n\n",
    "closed_at": "2018-03-04T23:29:00Z",
    "created_at": "2018-01-31T18:44:13Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Use arb 2.6+ comparison functions instead of custom implementation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24627",
    "user": "https://github.com/mezzarobba"
}
```
This ticket also makes a small (and safe) change to comparison semantics:

Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a breach of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.

CC:  @jdemeyer @videlec @cheuberg @fredrik-johansson

Branch/Commit: b55e3c2b7223da4044d43d9c0ca523455be6c117

Reviewer: Thierry Monteil, Vincent Delecroix

Author: Marc Mezzarobba

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24627





---

archive/issue_comments_468982.json:
```json
{
    "body": "Changing commit from \"\" to \"fc38d7f440e4f66f3099dde60794310e8a23a303\"",
    "created_at": "2018-01-31T18:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468982",
    "user": "https://github.com/mezzarobba"
}
```

Changing commit from "" to "fc38d7f440e4f66f3099dde60794310e8a23a303"



---

archive/issue_comments_468983.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mmezzarobba/arb_cmp\"",
    "created_at": "2018-01-31T18:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468983",
    "user": "https://github.com/mezzarobba"
}
```

Changing branch from "" to "u/mmezzarobba/arb_cmp"



---

archive/issue_comments_468984.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-31T18:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468984",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_468985.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[fc38d7f](https://github.com/sagemath/sagetrac-mirror/commit/fc38d7f440e4f66f3099dde60794310e8a23a303)|`real_arb: use arb 2.6+ comparison functions`|",
    "created_at": "2018-01-31T18:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468985",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[fc38d7f](https://github.com/sagemath/sagetrac-mirror/commit/fc38d7f440e4f66f3099dde60794310e8a23a303)|`real_arb: use arb 2.6+ comparison functions`|



---

archive/issue_comments_468986.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-01T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468986",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_468987.json:
```json
{
    "body": "<a id='comment:2'></a>\nGood move.\n\nHowever, i got a failing doctest in `src/sage/rings/polynomial/polynomial_element.pyx`, that reveals a criminal (though documented) failure in the previous behaviour of `RBF`, that `x = RBF(1.0, 0.1) ; x == x` returns `True`. The doctest seems to have been introduced in #22087 without complain.\n\nLet me suggest to:\n\n- move the doctest `x = RBF(1.0, 0.1) ; x == x` to something specific to ARB (it has nothing to do with polynomials actually)\n- add the doctest that triggered #22087 proposed at [/22076#comment:5 #22076:comment:5] in `src/sage/rings/polynomial/polynomial_element.pyx`\n- adapt the doctests corresponding to `RIF` in `src/sage/rings/polynomial/polynomial_element.pyx` (the block just above) to the `RBF` case.",
    "created_at": "2018-02-01T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468987",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>
Good move.

However, i got a failing doctest in `src/sage/rings/polynomial/polynomial_element.pyx`, that reveals a criminal (though documented) failure in the previous behaviour of `RBF`, that `x = RBF(1.0, 0.1) ; x == x` returns `True`. The doctest seems to have been introduced in #22087 without complain.

Let me suggest to:

- move the doctest `x = RBF(1.0, 0.1) ; x == x` to something specific to ARB (it has nothing to do with polynomials actually)
- add the doctest that triggered #22087 proposed at [/22076#comment:5 #22076:comment:5] in `src/sage/rings/polynomial/polynomial_element.pyx`
- adapt the doctests corresponding to `RIF` in `src/sage/rings/polynomial/polynomial_element.pyx` (the block just above) to the `RBF` case.



---

archive/issue_comments_468988.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Thierry Monteil\"",
    "created_at": "2018-02-01T00:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468988",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing reviewer from "" to "Thierry Monteil"



---

archive/issue_comments_468989.json:
```json
{
    "body": "Changing commit from \"fc38d7f440e4f66f3099dde60794310e8a23a303\" to \"b55e3c2b7223da4044d43d9c0ca523455be6c117\"",
    "created_at": "2018-02-12T13:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468989",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fc38d7f440e4f66f3099dde60794310e8a23a303" to "b55e3c2b7223da4044d43d9c0ca523455be6c117"



---

archive/issue_comments_468990.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[16962e5](https://github.com/sagemath/sagetrac-mirror/commit/16962e59411391b5695960f3303af63e16ab6442)|`real_arb: use arb 2.6+ comparison functions`|\n|[ac4ba37](https://github.com/sagemath/sagetrac-mirror/commit/ac4ba373f073f08dc80c4b70e0d91642f51365cd)|`complex_arb: use arb 2.6+ comparison functions`|\n|[b55e3c2](https://github.com/sagemath/sagetrac-mirror/commit/b55e3c2b7223da4044d43d9c0ca523455be6c117)|`stop considering inexact balls equal to themselves`|",
    "created_at": "2018-02-12T13:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468990",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[16962e5](https://github.com/sagemath/sagetrac-mirror/commit/16962e59411391b5695960f3303af63e16ab6442)|`real_arb: use arb 2.6+ comparison functions`|
|[ac4ba37](https://github.com/sagemath/sagetrac-mirror/commit/ac4ba373f073f08dc80c4b70e0d91642f51365cd)|`complex_arb: use arb 2.6+ comparison functions`|
|[b55e3c2](https://github.com/sagemath/sagetrac-mirror/commit/b55e3c2b7223da4044d43d9c0ca523455be6c117)|`stop considering inexact balls equal to themselves`|



---

archive/issue_comments_468991.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-12T13:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468991",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_468992.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. \n``````\n",
    "created_at": "2018-02-12T13:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468992",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. 
``````




---

archive/issue_comments_468993.json:
```json
{
    "body": "Replying to [ticket:24627 mmezzarobba]:\n> This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. \n\n\nIf you are changing semantics, don't hide that information in the commit message!",
    "created_at": "2018-02-12T14:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468993",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:24627 mmezzarobba]:
> This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. 


If you are changing semantics, don't hide that information in the commit message!



---

archive/issue_comments_468994.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-02-12T14:02:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468994",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_468995.json:
```json
{
    "body": "<a id='comment:6'></a>\n?!?\n\nThat's why I mentioned it here... Commit messages are both more durable and easier to access than trac tickets, aren't they? But I can copy the commit message here if you prefer:\n\n  Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.",
    "created_at": "2018-02-12T14:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468995",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>
?!?

That's why I mentioned it here... Commit messages are both more durable and easier to access than trac tickets, aren't they? But I can copy the commit message here if you prefer:

  Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.



---

archive/issue_comments_468996.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-02-12T14:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468996",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_468997.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-02-12T14:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468997",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_468998.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. \n+This ticket also makes a small (and safe) change to comparison semantics:\n+\n+Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.\n``````\n",
    "created_at": "2018-02-12T14:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468998",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-This ticket also makes a small (and safe) change to comparison semantics, see the commit messages for details. 
+This ticket also makes a small (and safe) change to comparison semantics:
+
+Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.
``````




---

archive/issue_comments_468999.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n This ticket also makes a small (and safe) change to comparison semantics:\n \n-Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.\n+Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that \u201cIdentical pointers are understood to give permission for algebraic simplification\u201d. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a breach of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.\n``````\n",
    "created_at": "2018-02-12T14:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-468999",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 This ticket also makes a small (and safe) change to comparison semantics:
 
-Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a break of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.
+Sage's implementation of comparison in real and complex ball fields used to make all elements (even non-point intervals) equal to themselves, because the documentation of arb specifies that “Identical pointers are understood to give permission for algebraic simplification”. In spite of this provisio, arb itself now provides comparison functions with x != x for inexact x. This commit makes the corresponding change in Sage for consistency. I wouldn't consider this a breach of compatibility since, in geneal, x != y returning False for two balls x, y does not guarantee that the corresponding reals are distinct.
``````




---

archive/issue_comments_469000.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-26T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-469000",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_469001.json:
```json
{
    "body": "<a id='comment:11'></a>\nAll tests pass. This is a great improvement (that is blocking many other tickets).",
    "created_at": "2018-02-26T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-469001",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
All tests pass. This is a great improvement (that is blocking many other tickets).



---

archive/issue_comments_469002.json:
```json
{
    "body": "Changing reviewer from \"Thierry Monteil\" to \"Thierry Monteil, Vincent Delecroix\"",
    "created_at": "2018-02-26T13:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-469002",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "Thierry Monteil" to "Thierry Monteil, Vincent Delecroix"



---

archive/issue_comments_469003.json:
```json
{
    "body": "Changing branch from \"u/mmezzarobba/arb_cmp\" to \"b55e3c2b7223da4044d43d9c0ca523455be6c117\"",
    "created_at": "2018-03-04T23:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-469003",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mmezzarobba/arb_cmp" to "b55e3c2b7223da4044d43d9c0ca523455be6c117"



---

archive/issue_comments_469004.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-04T23:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24627#issuecomment-469004",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_070548.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-04T23:29:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24627",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24627#event-70548"
}
```
