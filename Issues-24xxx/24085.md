# Issue 24085: mpir-3.0.0 does not compile on skylake chips on OSX

archive/issues_023848.json:
```json
{
    "body": "As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n\n> We know what the problem is now, but don't have a working patch to fix it.\n> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n> on 64 bit OSX. Details of the issue can be found\n> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n\n\nIn the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   \n\n**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.tar.bz2\n\nCC:  wbhart @kiwifb\n\nKeywords: skylake, mpir\n\nUpstream: Completely fixed; Fix reported upstream\n\nReviewer: David Roe, Andrew Mathas, Dima Pasechnik\n\nAuthor: Dima Pasechnik, Jeroen Demeyer\n\nBranch: c2384a70ba09c3acb8e8f2b948cba0ea2985a5b1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24085\n\n",
    "closed_at": "2017-12-02T14:53:23Z",
    "created_at": "2017-10-22T04:42:35Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "mpir-3.0.0 does not compile on skylake chips on OSX",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24085",
    "user": "https://github.com/AndrewAtLarge"
}
```
As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,

> We know what the problem is now, but don't have a working patch to fix it.
> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
> on 64 bit OSX. Details of the issue can be found
> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).


In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   

**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.tar.bz2

CC:  wbhart @kiwifb

Keywords: skylake, mpir

Upstream: Completely fixed; Fix reported upstream

Reviewer: David Roe, Andrew Mathas, Dima Pasechnik

Author: Dima Pasechnik, Jeroen Demeyer

Branch: c2384a70ba09c3acb8e8f2b948cba0ea2985a5b1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24085





---

archive/issue_comments_355586.json:
```json
{
    "body": "<a id='comment:1'></a>making this a blocker - we do want skylake in, no?",
    "created_at": "2017-11-18T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355586",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>making this a blocker - we do want skylake in, no?



---

archive/issue_comments_355587.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2017-11-18T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355587",
    "user": "https://github.com/dimpase"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_355588.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-18T22:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355588",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_355589.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-11-18T22:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355589",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_355590.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,16 +1,21 @@\n-As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build skylake chips. As reported by Bill Hart,\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n \n-    We know what the problem is now, but don't have a working patch to fix it. It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work on 64 bit OSX. Details of the issue can be found [https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html here.\n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n \n-A work around is to:\n-* unpack $SAGE_ROOT/upstream/mpir-3.0.0.tar.bz2\n+\n+A workaround is to:\n+* unpack `$SAGE_ROOT/upstream/mpir-3.0.0.tar.bz2`\n * delete the three files:\n-  - mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.as\n-  - mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm\n-  - mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm\n-* recreate mpir-3.0.0.tar.bz2\n-* Fix thepackage  checksums: ./sage --package fix-checksum\n-* Rebuild mpri with: ./sage -f mpir\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.as`\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm`\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm`\n+* recreate `mpir-3.0.0.tar.bz2`\n+* fix the package checksums: `./sage --package fix-checksum`\n+* rebuild mpir with: `./sage -f mpir`\n+\n \n Upstream: Workaround found; Bug reported upstream.\n \n```\n",
    "created_at": "2017-11-18T22:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355590",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,16 +1,21 @@
-As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build skylake chips. As reported by Bill Hart,
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
 
-    We know what the problem is now, but don't have a working patch to fix it. It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work on 64 bit OSX. Details of the issue can be found [https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html here.
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
 
-A work around is to:
-* unpack $SAGE_ROOT/upstream/mpir-3.0.0.tar.bz2
+
+A workaround is to:
+* unpack `$SAGE_ROOT/upstream/mpir-3.0.0.tar.bz2`
 * delete the three files:
-  - mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.as
-  - mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm
-  - mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm
-* recreate mpir-3.0.0.tar.bz2
-* Fix thepackage  checksums: ./sage --package fix-checksum
-* Rebuild mpri with: ./sage -f mpir
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.as`
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm`
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm`
+* recreate `mpir-3.0.0.tar.bz2`
+* fix the package checksums: `./sage --package fix-checksum`
+* rebuild mpir with: `./sage -f mpir`
+
 
 Upstream: Workaround found; Bug reported upstream.
 
```




---

archive/issue_comments_355591.json:
```json
{
    "body": "<a id='comment:3'></a>(Minor typo fixes and reformatting of ticket description.)",
    "created_at": "2017-11-18T22:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355591",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>(Minor typo fixes and reformatting of ticket description.)



---

archive/issue_comments_355592.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n+\n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n+\n+\n+the branch:\n+* deletes the three files:\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.as`\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm`\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm`\n+* bumps up the version to p1.\n \n \n Upstream: Workaround found; Bug reported upstream.\n```\n",
    "created_at": "2017-11-18T22:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355592",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
+
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
+
+
+the branch:
+* deletes the three files:
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.as`
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm`
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm`
+* bumps up the version to p1.
 
 
 Upstream: Workaround found; Bug reported upstream.
```




---

archive/issue_comments_355593.json:
```json
{
    "body": "<a id='comment:4'></a>the actual state of the ticket reflected in the descr. now.",
    "created_at": "2017-11-18T22:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355593",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>the actual state of the ticket reflected in the descr. now.



---

archive/issue_comments_355594.json:
```json
{
    "body": "<a id='comment:5'></a>When I pull this change to a build that failed before, I get\n\n```\n[mpir-3.0.0.p0] libtool: link: /usr/bin/gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libmpir.23.dylib  .libs/assert.o .libs/compat.o .libs/errno.o .libs/extract-dbl.o .libs/invalid.o .libs/memory.o .li\n[mpir-3.0.0.p0] ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64\n[mpir-3.0.0.p0] clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\nFull log posted at http://www.pitt.edu/~roed/mpir-24085.log.\n\nI'll try starting from a fresh sage-8.1.rc2.",
    "created_at": "2017-11-19T04:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355594",
    "user": "https://github.com/roed314"
}
```

<a id='comment:5'></a>When I pull this change to a build that failed before, I get

```
[mpir-3.0.0.p0] libtool: link: /usr/bin/gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libmpir.23.dylib  .libs/assert.o .libs/compat.o .libs/errno.o .libs/extract-dbl.o .libs/invalid.o .libs/memory.o .li
[mpir-3.0.0.p0] ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64
[mpir-3.0.0.p0] clang: error: linker command failed with exit code 1 (use -v to see invocation)
```
Full log posted at http://www.pitt.edu/~roed/mpir-24085.log.

I'll try starting from a fresh sage-8.1.rc2.



---

archive/issue_comments_355595.json:
```json
{
    "body": "<a id='comment:6'></a>Very similar looking error when trying with a fresh Sage.  Log posted at http://www.pitt.edu/~roed/mpir-24085_2.log",
    "created_at": "2017-11-19T04:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355595",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>Very similar looking error when trying with a fresh Sage.  Log posted at http://www.pitt.edu/~roed/mpir-24085_2.log



---

archive/issue_comments_355596.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-19T07:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355596",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_355597.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n+\n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n+\n+\n+the branch:\n+* deletes the three files:\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.asm`\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm`\n+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm`\n+* bumps up the version to p1.\n \n \n Upstream: Workaround found; Bug reported upstream.\n```\n",
    "created_at": "2017-11-19T08:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355597",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
+
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
+
+
+the branch:
+* deletes the three files:
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/addmul_1.asm`
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/mul_basecase.asm`
+  - `mpir-3.0.0/mpn/x86_64w/skylake/avx/sqr_basecase.asm`
+* bumps up the version to p1.
 
 
 Upstream: Workaround found; Bug reported upstream.
```




---

archive/issue_comments_355598.json:
```json
{
    "body": "<a id='comment:8'></a>Well, I merely presented in a patch form what was reported by Andrew to be a working workaround. Without access to the corresponding OS/arch combo, I can't do much.",
    "created_at": "2017-11-19T08:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355598",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>Well, I merely presented in a patch form what was reported by Andrew to be a working workaround. Without access to the corresponding OS/arch combo, I can't do much.



---

archive/issue_comments_355599.json:
```json
{
    "body": "<a id='comment:9'></a>David, could you post the output of MPIR's ./config.guess for your system?\n\nI'm thinking about a better way to fix this: detect skylake+OSX combo and\npass a different (working) arch to the MPIR build system.",
    "created_at": "2017-11-19T14:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355599",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>David, could you post the output of MPIR's ./config.guess for your system?

I'm thinking about a better way to fix this: detect skylake+OSX combo and
pass a different (working) arch to the MPIR build system.



---

archive/issue_comments_355600.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 dimpase]:\n> David, could you post the output of MPIR's ./config.guess for your system?\n\n\nIt's at http://www.pitt.edu/~roed/config.guess",
    "created_at": "2017-11-19T17:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355600",
    "user": "https://github.com/roed314"
}
```

<a id='comment:10'></a>Replying to [comment:9 dimpase]:
> David, could you post the output of MPIR's ./config.guess for your system?


It's at http://www.pitt.edu/~roed/config.guess



---

archive/issue_comments_355601.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 roed]:\n> Replying to [comment:9 dimpase]:\n> > David, could you post the output of MPIR's ./config.guess for your system?\n\n> \n> It's at http://www.pitt.edu/~roed/config.guess\n\n\nthis looks like a script. I meant: `cd $SAGE_ROOT/upstream; tar xf mpir-3.0.0.tar.gz; cd mpir-3.0.0; ./config.guess`\n\ne.g. on my laptop I get the output\n`skylakeavx-unknown-linux-gnu`",
    "created_at": "2017-11-19T17:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355601",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:10 roed]:
> Replying to [comment:9 dimpase]:
> > David, could you post the output of MPIR's ./config.guess for your system?

> 
> It's at http://www.pitt.edu/~roed/config.guess


this looks like a script. I meant: `cd $SAGE_ROOT/upstream; tar xf mpir-3.0.0.tar.gz; cd mpir-3.0.0; ./config.guess`

e.g. on my laptop I get the output
`skylakeavx-unknown-linux-gnu`



---

archive/issue_comments_355602.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dimpase]:\n> Replying to [comment:10 roed]:\n> > Replying to [comment:9 dimpase]:\n> > > David, could you post the output of MPIR's ./config.guess for your system?\n\n> > \n> > It's at http://www.pitt.edu/~roed/config.guess\n\n> \n> this looks like a script. I meant: `cd $SAGE_ROOT/upstream; tar xf mpir-3.0.0.tar.gz; cd mpir-3.0.0; ./config.guess`\n\n\nAh, thanks.\n \n> e.g. on my laptop I get the output\n> `skylakeavx-unknown-linux-gnu`\n\n\nI get `skylakeavx-apple-darwin16.7.0`",
    "created_at": "2017-11-19T17:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355602",
    "user": "https://github.com/roed314"
}
```

<a id='comment:12'></a>Replying to [comment:11 dimpase]:
> Replying to [comment:10 roed]:
> > Replying to [comment:9 dimpase]:
> > > David, could you post the output of MPIR's ./config.guess for your system?

> > 
> > It's at http://www.pitt.edu/~roed/config.guess

> 
> this looks like a script. I meant: `cd $SAGE_ROOT/upstream; tar xf mpir-3.0.0.tar.gz; cd mpir-3.0.0; ./config.guess`


Ah, thanks.
 
> e.g. on my laptop I get the output
> `skylakeavx-unknown-linux-gnu`


I get `skylakeavx-apple-darwin16.7.0`



---

archive/issue_comments_355603.json:
```json
{
    "body": "<a id='comment:13'></a>So I also don't have the set up to test this, but it looks like deleting the files in x86_64w is the wrong place. the 64w folder is for windows code and wouldn't be used by osx? Perhaps deleting the files just in x86_64 will work.\n(If we look at David's log it does config.status: linking mpn/x86_64/skylake/avx/addmul_1.asm to mpn/addmul_1.asm so osx is using the x86_64 code)",
    "created_at": "2017-11-19T18:09:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355603",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:13'></a>So I also don't have the set up to test this, but it looks like deleting the files in x86_64w is the wrong place. the 64w folder is for windows code and wouldn't be used by osx? Perhaps deleting the files just in x86_64 will work.
(If we look at David's log it does config.status: linking mpn/x86_64/skylake/avx/addmul_1.asm to mpn/addmul_1.asm so osx is using the x86_64 code)



---

archive/issue_comments_355604.json:
```json
{
    "body": "<a id='comment:14'></a>Deleting the files in x86_64 or x86_64w?  There's also x86w....",
    "created_at": "2017-11-20T03:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355604",
    "user": "https://github.com/roed314"
}
```

<a id='comment:14'></a>Deleting the files in x86_64 or x86_64w?  There's also x86w....



---

archive/issue_comments_355605.json:
```json
{
    "body": "<a id='comment:15'></a>x86_64 is 64bit *nix abi, x86_64w is 64bit windows, x86(w) is older 32-bit stuff for linux (resp. windows) . mpn/x86_64/ is what's being linked on your machine.",
    "created_at": "2017-11-20T03:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355605",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:15'></a>x86_64 is 64bit *nix abi, x86_64w is 64bit windows, x86(w) is older 32-bit stuff for linux (resp. windows) . mpn/x86_64/ is what's being linked on your machine.



---

archive/issue_comments_355606.json:
```json
{
    "body": "<a id='comment:16'></a>I tried\n\n```\ncd upstream/mpir-3.0.0/mpn/x86_64\nrm -rf *\ncd $SAGE_ROOT && make\n```\n\nI still get\n\n```\n[mpir-3.0.0.p1] libtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libmpir.23.dylib  .libs/assert.o .libs/compat.o .libs/errno.o .libs/extract-dbl.o .libs/invalid.o .libs/memory.o .libs/mp_bpi\n[mpir-3.0.0.p1] ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64\n[mpir-3.0.0.p1] clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n\nLet me know if you have any other ideas....",
    "created_at": "2017-11-20T04:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355606",
    "user": "https://github.com/roed314"
}
```

<a id='comment:16'></a>I tried

```
cd upstream/mpir-3.0.0/mpn/x86_64
rm -rf *
cd $SAGE_ROOT && make
```

I still get

```
[mpir-3.0.0.p1] libtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libmpir.23.dylib  .libs/assert.o .libs/compat.o .libs/errno.o .libs/extract-dbl.o .libs/invalid.o .libs/memory.o .libs/mp_bpi
[mpir-3.0.0.p1] ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64
[mpir-3.0.0.p1] clang: error: linker command failed with exit code 1 (use -v to see invocation)
```

Let me know if you have any other ideas....



---

archive/issue_comments_355607.json:
```json
{
    "body": "<a id='comment:17'></a>Sorry I was being lazy you don't want to remove all the x86_64 code just the 3 from before just from the right folder:\nmpir-3.0.0/mpn/x86_64/skylake/avx/addmul_1.asm\nmpir-3.0.0/mpn/x86_64/skylake/avx/mul_basecase.asm\nmpir-3.0.0/mpn/x86_64/skylake/avx/sqr_basecase.asm\nalso you need to re-run ./configure after this, is sage make doing that?",
    "created_at": "2017-11-20T04:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355607",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:17'></a>Sorry I was being lazy you don't want to remove all the x86_64 code just the 3 from before just from the right folder:
mpir-3.0.0/mpn/x86_64/skylake/avx/addmul_1.asm
mpir-3.0.0/mpn/x86_64/skylake/avx/mul_basecase.asm
mpir-3.0.0/mpn/x86_64/skylake/avx/sqr_basecase.asm
also you need to re-run ./configure after this, is sage make doing that?



---

archive/issue_comments_355608.json:
```json
{
    "body": "<a id='comment:18'></a>I downloaded a fresh copy of sage and deleted the files.   At first I didn't see your comment about `./configure`, but after getting an error, I ran `./configure && make`, to no avail:\n\n```\n[mpir-3.0.0.p0] /bin/sh ./libtool  --tag=CC   --mode=link gcc  -m64 -O2 -march=skylake -mtune=skylake  -g    -version-info 23:3:0 -L/Users/roed/sage/sage-8.1.rc2/local/lib -Wl,-rpath,/Users/roed/sage/sage-8.1.rc2/ls\n[mpir-3.0.0.p0] libtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libmpir.23.dylib  .libs/assert.o .libs/compat.o .libs/errno.o .libs/extract-dbl.o .libs/invalid.o .libs/memory.o .libs/mp_bps\n[mpir-3.0.0.p0] ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64\n[mpir-3.0.0.p0] clang: error: linker command failed with exit code 1 (use -v to see invocation)\n```",
    "created_at": "2017-11-20T05:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355608",
    "user": "https://github.com/roed314"
}
```

<a id='comment:18'></a>I downloaded a fresh copy of sage and deleted the files.   At first I didn't see your comment about `./configure`, but after getting an error, I ran `./configure && make`, to no avail:

```
[mpir-3.0.0.p0] /bin/sh ./libtool  --tag=CC   --mode=link gcc  -m64 -O2 -march=skylake -mtune=skylake  -g    -version-info 23:3:0 -L/Users/roed/sage/sage-8.1.rc2/local/lib -Wl,-rpath,/Users/roed/sage/sage-8.1.rc2/ls
[mpir-3.0.0.p0] libtool: link: gcc -dynamiclib -Wl,-undefined -Wl,dynamic_lookup -o .libs/libmpir.23.dylib  .libs/assert.o .libs/compat.o .libs/errno.o .libs/extract-dbl.o .libs/invalid.o .libs/memory.o .libs/mp_bps
[mpir-3.0.0.p0] ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64
[mpir-3.0.0.p0] clang: error: linker command failed with exit code 1 (use -v to see invocation)
```



---

archive/issue_comments_355609.json:
```json
{
    "body": "<a id='comment:19'></a>Following a tip from Bill, I am able to reproduce the issue on a non-skylake OSX 10.12 machine (with XCode 9). To do this (in MPIR source dir), do \n\n```\n./configure --host=skylakeavx-apple-darwin16.7.0\nmake\n```\nand get the familiar\n\n```\nld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64\n```\n\n(This should also work on Travis CI, if you are so inclined (although in my experience Travis is quite slow on OSX).\n\nNow the plan is to lift the fix for the responsible m4 off GMP...",
    "created_at": "2017-11-20T08:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355609",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>Following a tip from Bill, I am able to reproduce the issue on a non-skylake OSX 10.12 machine (with XCode 9). To do this (in MPIR source dir), do 

```
./configure --host=skylakeavx-apple-darwin16.7.0
make
```
and get the familiar

```
ld: in section __DATA,__const reloc 0: X86_64_RELOC_SUBTRACTOR must have r_extern=1 file 'mpn/.libs/addmul_1.o' for architecture x86_64
```

(This should also work on Travis CI, if you are so inclined (although in my experience Travis is quite slow on OSX).

Now the plan is to lift the fix for the responsible m4 off GMP...



---

archive/issue_comments_355610.json:
```json
{
    "body": "<a id='comment:20'></a>I am trying the following patch, basically taken from GMP\n\n```\ndiff --git a/mpn/x86_64/x86_64-defs.m4 b/mpn/x86_64/x86_64-defs.m4\nindex 120efc7..0f65e55 100644\n--- a/mpn/x86_64/x86_64-defs.m4\n+++ b/mpn/x86_64/x86_64-defs.m4\n@@ -129,9 +129,10 @@ dnl  Usage: JMPENT(targlabel,tablabel)\n \n define(`JMPENT',`dnl\n ifdef(`PIC',\n-    `.long  $1-$2'\n+        `.set   $1_tmp, $1-$2\n+        .long   $1_tmp'\n ,\n-    `.quad  $1'\n+        `.quad  $1'\n )')\n \n dnl  Usage: call_mcount\n@@ -666,7 +667,7 @@ define(`R8',\n                 $1,`%r14',`%r14b',\n                 $1,`%r15',`%r15b')')\n \n-define(`JUMPTABSECT', `.section .data.rel.ro.local,\"aw\",@progbits')\n+define(`JUMPTABSECT', `.text')\n \n \n dnl  Usage: JMPENT(targlabel,tablabel)\n```\nbut it does not work, neither with the native (clang) toolchain, nor with gcc-7.2. (Same error with `addmul_1.o` as above).\nCould it be something to do with internal vs non-internal assembly?",
    "created_at": "2017-11-20T16:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355610",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>I am trying the following patch, basically taken from GMP

```
diff --git a/mpn/x86_64/x86_64-defs.m4 b/mpn/x86_64/x86_64-defs.m4
index 120efc7..0f65e55 100644
--- a/mpn/x86_64/x86_64-defs.m4
+++ b/mpn/x86_64/x86_64-defs.m4
@@ -129,9 +129,10 @@ dnl  Usage: JMPENT(targlabel,tablabel)
 
 define(`JMPENT',`dnl
 ifdef(`PIC',
-    `.long  $1-$2'
+        `.set   $1_tmp, $1-$2
+        .long   $1_tmp'
 ,
-    `.quad  $1'
+        `.quad  $1'
 )')
 
 dnl  Usage: call_mcount
@@ -666,7 +667,7 @@ define(`R8',
                 $1,`%r14',`%r14b',
                 $1,`%r15',`%r15b')')
 
-define(`JUMPTABSECT', `.section .data.rel.ro.local,"aw",@progbits')
+define(`JUMPTABSECT', `.text')
 
 
 dnl  Usage: JMPENT(targlabel,tablabel)
```
but it does not work, neither with the native (clang) toolchain, nor with gcc-7.2. (Same error with `addmul_1.o` as above).
Could it be something to do with internal vs non-internal assembly?



---

archive/issue_comments_355611.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-21T14:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355611",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355612.json:
```json
{
    "body": "<a id='comment:21'></a>Please try this on the \"real\" skylake. It builds on the fake one (i.e. with `--host=skylakeavx-apple-darwin16.7.0`).\n\nIn the previous attempt I missed that JMPENT and JUMPTABSECT are defined twice...\n\n---\nNew commits:",
    "created_at": "2017-11-21T14:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355612",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Please try this on the "real" skylake. It builds on the fake one (i.e. with `--host=skylakeavx-apple-darwin16.7.0`).

In the previous attempt I missed that JMPENT and JUMPTABSECT are defined twice...

---
New commits:



---

archive/issue_comments_355613.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n \n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n+\n+\n+the branch patches the relevant m4 macros. It is for testing purposes only - a proper fix should make it conditional for OSX.\n \n Upstream: Workaround found; Bug reported upstream.\n \n```\n",
    "created_at": "2017-11-21T15:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355613",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
 
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
+
+
+the branch patches the relevant m4 macros. It is for testing purposes only - a proper fix should make it conditional for OSX.
 
 Upstream: Workaround found; Bug reported upstream.
 
```




---

archive/issue_comments_355614.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-11-21T16:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355614",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_355615.json:
```json
{
    "body": "<a id='comment:23'></a>The ticket says \"Workaround found; Bug reported upstream.\" but where is the upstream report?\n\nAnd please add a link to this ticket in the patch file.",
    "created_at": "2017-11-21T16:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355615",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>The ticket says "Workaround found; Bug reported upstream." but where is the upstream report?

And please add a link to this ticket in the patch file.



---

archive/issue_comments_355616.json:
```json
{
    "body": "<a id='comment:24'></a>I'm past the mpir compilation: looking good so far.  I'll report once it's done and I've run tests.",
    "created_at": "2017-11-21T16:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355616",
    "user": "https://github.com/roed314"
}
```

<a id='comment:24'></a>I'm past the mpir compilation: looking good so far.  I'll report once it's done and I've run tests.



---

archive/issue_comments_355617.json:
```json
{
    "body": "<a id='comment:25'></a>I'm getting an error building gcc:\n\n```\n[gcc-7.2.0] /Users/roed/sage/sage-8.1.rc2/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/Users/roed/sage/sage-8.1.rc2/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -nostdinc -x c /dev/null -S -o /d\n[gcc-7.2.0] <built-in>: internal compiler error: Bus error: 10\n[gcc-7.2.0] libbacktrace could not find executable to open\n[gcc-7.2.0] Please submit a full bug report,\n[gcc-7.2.0] with preprocessed source if appropriate.\n[gcc-7.2.0] See <https://gcc.gnu.org/bugs/> for instructions.\n[gcc-7.2.0] make[6]: *** [s-selftest] Error 1\n[gcc-7.2.0] rm gcc.pod\n[gcc-7.2.0] make[5]: *** [all-stage1-gcc] Error 2\n[gcc-7.2.0] make[4]: *** [stage1-bubble] Error 2\n[gcc-7.2.0] make[3]: *** [all] Error 2\n```\nFull log at http://www.pitt.edu/~roed/gcc_24085.log",
    "created_at": "2017-11-21T17:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355617",
    "user": "https://github.com/roed314"
}
```

<a id='comment:25'></a>I'm getting an error building gcc:

```
[gcc-7.2.0] /Users/roed/sage/sage-8.1.rc2/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/xgcc -B/Users/roed/sage/sage-8.1.rc2/local/var/tmp/sage/build/gcc-7.2.0/gcc-build/./gcc/ -nostdinc -x c /dev/null -S -o /d
[gcc-7.2.0] <built-in>: internal compiler error: Bus error: 10
[gcc-7.2.0] libbacktrace could not find executable to open
[gcc-7.2.0] Please submit a full bug report,
[gcc-7.2.0] with preprocessed source if appropriate.
[gcc-7.2.0] See <https://gcc.gnu.org/bugs/> for instructions.
[gcc-7.2.0] make[6]: *** [s-selftest] Error 1
[gcc-7.2.0] rm gcc.pod
[gcc-7.2.0] make[5]: *** [all-stage1-gcc] Error 2
[gcc-7.2.0] make[4]: *** [stage1-bubble] Error 2
[gcc-7.2.0] make[3]: *** [all] Error 2
```
Full log at http://www.pitt.edu/~roed/gcc_24085.log



---

archive/issue_comments_355618.json:
```json
{
    "body": "<a id='comment:26'></a>OK, now I see that on my machine MPIR with this patch fails standalone tests. :-(\n\nThat's probably why gcc can't be built (mpir is used )\nLet me try few variations to see if I can make it work.",
    "created_at": "2017-11-21T17:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355618",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>OK, now I see that on my machine MPIR with this patch fails standalone tests. :-(

That's probably why gcc can't be built (mpir is used )
Let me try few variations to see if I can make it work.



---

archive/issue_comments_355619.json:
```json
{
    "body": "<a id='comment:27'></a>In fact, it's linking errors that I get; the MPIR tests fail with the following:\n\n```\n$ less tests/t-constants.log \ndyld: Symbol not found: .Ll0m4_tmp\n  Referenced from: /Volumes/Sage/sage/upstream/mpir-3.0.0/.libs/libmpir.23.dylib\n  Expected in: flat namespace\n in /Volumes/Sage/sage/upstream/mpir-3.0.0/.libs/libmpir.23.dylib\n```",
    "created_at": "2017-11-21T17:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355619",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>In fact, it's linking errors that I get; the MPIR tests fail with the following:

```
$ less tests/t-constants.log 
dyld: Symbol not found: .Ll0m4_tmp
  Referenced from: /Volumes/Sage/sage/upstream/mpir-3.0.0/.libs/libmpir.23.dylib
  Expected in: flat namespace
 in /Volumes/Sage/sage/upstream/mpir-3.0.0/.libs/libmpir.23.dylib
```



---

archive/issue_comments_355620.json:
```json
{
    "body": "<a id='comment:28'></a>Right, the problem turns out to be that some assembler code in MPIR does not work with the new version of the JMPENT macro.\nUpdating it still leads to two errors in MPIR testsuite. See https://github.com/wbhart/mpir/issues/232\n\nIt would be great if someone can tell how to write an m4 macro that is conditional on the OS type (we only need to change JMPENT on OSX).",
    "created_at": "2017-11-22T12:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355620",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>Right, the problem turns out to be that some assembler code in MPIR does not work with the new version of the JMPENT macro.
Updating it still leads to two errors in MPIR testsuite. See https://github.com/wbhart/mpir/issues/232

It would be great if someone can tell how to write an m4 macro that is conditional on the OS type (we only need to change JMPENT on OSX).



---

archive/issue_comments_355621.json:
```json
{
    "body": "<a id='comment:29'></a>This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?",
    "created_at": "2017-11-22T17:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355621",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?



---

archive/issue_comments_355622.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:29 vbraun]:\n> This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?\n\n\nI hope to have a working version by the end of today... But it's up to you, I think Apple should not slow Sage down (without paying us, for sure :-))",
    "created_at": "2017-11-22T17:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355622",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Replying to [comment:29 vbraun]:
> This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?


I hope to have a working version by the end of today... But it's up to you, I think Apple should not slow Sage down (without paying us, for sure :-))



---

archive/issue_comments_355623.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 dimpase]:\n> Replying to [comment:29 vbraun]:\n> > This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?\n\n> \n> I hope to have a working version by the end of today... But it's up to you, I think Apple should not slow Sage down (without paying us, for sure :-))\n\n\nI can't help with the fix itself, but I'm happy to keep helping with testing.",
    "created_at": "2017-11-22T19:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355623",
    "user": "https://github.com/roed314"
}
```

<a id='comment:31'></a>Replying to [comment:30 dimpase]:
> Replying to [comment:29 vbraun]:
> > This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?

> 
> I hope to have a working version by the end of today... But it's up to you, I think Apple should not slow Sage down (without paying us, for sure :-))


I can't help with the fix itself, but I'm happy to keep helping with testing.



---

archive/issue_comments_355624.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 roed]:\n> Replying to [comment:30 dimpase]:\n> > Replying to [comment:29 vbraun]:\n> > > This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?\n\n> > \n> > I hope to have a working version by the end of today... But it's up to you, I think Apple should not slow Sage down (without paying us, for sure :-))\n\n> \n> I can't help with the fix itself, but I'm happy to keep helping with testing.\n\n\nCould you try out (the master of) https://github.com/dimpase/mpir.git ?\nthat is, \n\n```\ngit clone https://github.com/dimpase/mpir.git\ncd mpir\n./autogen.sh\n./configure CC=cc --prefix=/tmp/blah && make -j8 && make -j8 check\n```\n(assuming you have `yasm` installed)\nThis fails 2 tests on non-skylake, perhaps it would work on skylake?",
    "created_at": "2017-11-23T15:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355624",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>Replying to [comment:31 roed]:
> Replying to [comment:30 dimpase]:
> > Replying to [comment:29 vbraun]:
> > > This ticket doesn't look like it'll be ready any time soon, skip it for 8.1?

> > 
> > I hope to have a working version by the end of today... But it's up to you, I think Apple should not slow Sage down (without paying us, for sure :-))

> 
> I can't help with the fix itself, but I'm happy to keep helping with testing.


Could you try out (the master of) https://github.com/dimpase/mpir.git ?
that is, 

```
git clone https://github.com/dimpase/mpir.git
cd mpir
./autogen.sh
./configure CC=cc --prefix=/tmp/blah && make -j8 && make -j8 check
```
(assuming you have `yasm` installed)
This fails 2 tests on non-skylake, perhaps it would work on skylake?



---

archive/issue_comments_355625.json:
```json
{
    "body": "<a id='comment:33'></a>I'm running xcode Version 9.0 (9A235) on on mscox 10.12.16. I got the following errors:\n\n```\nPASS: t-addadd_n\nPASS: t-addsub_n\nPASS: t-aors_1\n../../test-driver: line 107: 94805 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 94803 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-dc_bdiv_q\nPASS: t-asmtype\nFAIL: t-dc_bdiv_q_n\n../../test-driver: line 107: 94861 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 94862 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 94863 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-dc_div_q\nFAIL: t-dc_bdiv_qr\nFAIL: t-dc_bdiv_qr_n\n../../test-driver: line 107: 94918 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 94920 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 94919 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-dc_div_qr_n\nFAIL: t-dc_divappr_q\nFAIL: t-dc_div_qr\nPASS: t-divrem_1\nPASS: t-divebyff\nPASS: t-divebyfobm1\n../../test-driver: line 107: 95028 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 95027 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-gcdext\nFAIL: t-fat\nPASS: t-get_d\nPASS: t-instrument\n../../test-driver: line 107: 95085 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-hgcd\n../../test-driver: line 107: 95115 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_div_q\n../../test-driver: line 107: 95141 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 95142 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_div_qr\nFAIL: t-inv_div_qr_n\n../../test-driver: line 107: 95174 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_divappr_q\n../../test-driver: line 107: 95199 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 95198 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-invert\nFAIL: t-inv_divappr_q_n\nPASS: t-iord_u\n../../test-driver: line 107: 95255 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-matrix22\nPASS: t-mp_bases\n../../test-driver: line 107: 95307 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mullow_basecase\n../../test-driver: line 107: 95326 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mullowhigh\n../../test-driver: line 107: 95364 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mulmod_2expm1\nPASS: t-lorrshift1\n../../test-driver: line 107: 95383 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mulmod_2expp1\n../../test-driver: line 107: 95345 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mulmid\nPASS: t-perfsqr\n../../test-driver: line 107: 95441 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-redc_1\nPASS: t-neg\n../../test-driver: line 107: 95455 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_bdiv_q\n../../test-driver: line 107: 95479 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_bdiv_qr\n../../test-driver: line 107: 95495 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_div_q\n../../test-driver: line 107: 95499 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_div_qr\n../../test-driver: line 107: 95536 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_divappr_q\nPASS: t-scan\n../../test-driver: line 107: 95558 Segmentation fault: 11  \"$@\" > $log_file 2>&1\nFAIL: t-sizeinbase\nPASS: t-subadd_n\n../../test-driver: line 107: 95609 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-tdiv_q\n../../test-driver: line 107: 95614 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-tdiv_qr\nPASS: st_fat\nPASS: st_instrument\n```\nHappy to upload the log but I couldn't find it...",
    "created_at": "2017-11-23T17:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355625",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:33'></a>I'm running xcode Version 9.0 (9A235) on on mscox 10.12.16. I got the following errors:

```
PASS: t-addadd_n
PASS: t-addsub_n
PASS: t-aors_1
../../test-driver: line 107: 94805 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 94803 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-dc_bdiv_q
PASS: t-asmtype
FAIL: t-dc_bdiv_q_n
../../test-driver: line 107: 94861 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 94862 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 94863 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-dc_div_q
FAIL: t-dc_bdiv_qr
FAIL: t-dc_bdiv_qr_n
../../test-driver: line 107: 94918 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 94920 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 94919 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-dc_div_qr_n
FAIL: t-dc_divappr_q
FAIL: t-dc_div_qr
PASS: t-divrem_1
PASS: t-divebyff
PASS: t-divebyfobm1
../../test-driver: line 107: 95028 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 95027 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-gcdext
FAIL: t-fat
PASS: t-get_d
PASS: t-instrument
../../test-driver: line 107: 95085 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-hgcd
../../test-driver: line 107: 95115 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_div_q
../../test-driver: line 107: 95141 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 95142 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_div_qr
FAIL: t-inv_div_qr_n
../../test-driver: line 107: 95174 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_divappr_q
../../test-driver: line 107: 95199 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 95198 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-invert
FAIL: t-inv_divappr_q_n
PASS: t-iord_u
../../test-driver: line 107: 95255 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-matrix22
PASS: t-mp_bases
../../test-driver: line 107: 95307 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mullow_basecase
../../test-driver: line 107: 95326 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mullowhigh
../../test-driver: line 107: 95364 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mulmod_2expm1
PASS: t-lorrshift1
../../test-driver: line 107: 95383 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mulmod_2expp1
../../test-driver: line 107: 95345 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mulmid
PASS: t-perfsqr
../../test-driver: line 107: 95441 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-redc_1
PASS: t-neg
../../test-driver: line 107: 95455 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_bdiv_q
../../test-driver: line 107: 95479 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_bdiv_qr
../../test-driver: line 107: 95495 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_div_q
../../test-driver: line 107: 95499 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_div_qr
../../test-driver: line 107: 95536 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_divappr_q
PASS: t-scan
../../test-driver: line 107: 95558 Segmentation fault: 11  "$@" > $log_file 2>&1
FAIL: t-sizeinbase
PASS: t-subadd_n
../../test-driver: line 107: 95609 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-tdiv_q
../../test-driver: line 107: 95614 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-tdiv_qr
PASS: st_fat
PASS: st_instrument
```
Happy to upload the log but I couldn't find it...



---

archive/issue_comments_355626.json:
```json
{
    "body": "<a id='comment:34'></a>Could we get the `./configure` log?",
    "created_at": "2017-11-23T17:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355626",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>Could we get the `./configure` log?



---

archive/issue_comments_355627.json:
```json
{
    "body": "<a id='comment:35'></a>I get similar errors; my log is at http://www.pitt.edu/~roed/config_24085.log",
    "created_at": "2017-11-23T18:10:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355627",
    "user": "https://github.com/roed314"
}
```

<a id='comment:35'></a>I get similar errors; my log is at http://www.pitt.edu/~roed/config_24085.log



---

archive/issue_comments_355628.json:
```json
{
    "body": "Attachment [config.log](tarball://root/attachments/some-uuid/ticket24085/config.log) by @AndrewAtLarge created at 2017-11-23 19:19:09\n\nLog file for failed build",
    "created_at": "2017-11-23T19:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355628",
    "user": "https://github.com/AndrewAtLarge"
}
```

Attachment [config.log](tarball://root/attachments/some-uuid/ticket24085/config.log) by @AndrewAtLarge created at 2017-11-23 19:19:09

Log file for failed build



---

archive/issue_comments_355629.json:
```json
{
    "body": "<a id='comment:36'></a>Please try the latest updates: do `git pull` in the mpir git repo, then\n`make distclean` followed by `./autogen.sh` etc.",
    "created_at": "2017-11-23T19:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355629",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>Please try the latest updates: do `git pull` in the mpir git repo, then
`make distclean` followed by `./autogen.sh` etc.



---

archive/issue_comments_355630.json:
```json
{
    "body": "<a id='comment:37'></a>Still similar looking failures.  I've uploaded the new log to http://www.pitt.edu/~roed/config_24085_2.log",
    "created_at": "2017-11-24T04:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355630",
    "user": "https://github.com/roed314"
}
```

<a id='comment:37'></a>Still similar looking failures.  I've uploaded the new log to http://www.pitt.edu/~roed/config_24085_2.log



---

archive/issue_comments_355631.json:
```json
{
    "body": "<a id='comment:38'></a>The test output is\n\n```\n/Library/Developer/CommandLineTools/usr/bin/make  check-TESTS\n../../test-driver: line 107: 31065 Bus error: 10           \"$@\" > $log_file 2>&1\nPASS: t-asmtype\nFAIL: t-dc_bdiv_q\nPASS: t-aors_1\n../../test-driver: line 107: 31068 Bus error: 10           \"$@\" > $log_file 2>&1\nPASS: t-addsub_n\nFAIL: t-dc_bdiv_q_n\n../../test-driver: line 107: 31067 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 31069 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-dc_bdiv_qr\nFAIL: t-dc_bdiv_qr_n\nPASS: t-addadd_n\n../../test-driver: line 107: 31217 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 31214 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 31218 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-dc_div_qr\nFAIL: t-dc_div_qr_n\nFAIL: t-dc_divappr_q\n../../test-driver: line 107: 31215 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-dc_div_q\nPASS: t-divebyff\nPASS: t-divrem_1\n../../test-driver: line 107: 31225 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-fat\n../../test-driver: line 107: 31352 Bus error: 10           \"$@\" > $log_file 2>&1\nPASS: t-instrument\n../../test-driver: line 107: 31350 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 31346 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_div_q\nFAIL: t-hgcd\nFAIL: t-gcdext\nPASS: t-get_d\nPASS: t-divebyfobm1\n../../test-driver: line 107: 31423 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_div_qr\n../../test-driver: line 107: 31442 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_div_qr_n\n../../test-driver: line 107: 31480 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-inv_divappr_q\n../../test-driver: line 107: 31484 Bus error: 10           \"$@\" > $log_file 2>&1\n../../test-driver: line 107: 31482 Bus error: 10           \"$@\" > $log_file 2>&1\nPASS: t-iord_u\nFAIL: t-invert\nFAIL: t-inv_divappr_q_n\n../../test-driver: line 107: 31489 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-matrix22\nPASS: t-mp_bases\n../../test-driver: line 107: 31591 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mullow_basecase\n../../test-driver: line 107: 31628 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mullowhigh\n../../test-driver: line 107: 31632 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mulmod_2expm1\nPASS: t-perfsqr\n../../test-driver: line 107: 31709 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-redc_1\n../../test-driver: line 107: 31730 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_bdiv_q\n../../test-driver: line 107: 31750 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_bdiv_qr\n../../test-driver: line 107: 31762 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_div_q\n../../test-driver: line 107: 31781 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_div_qr\n../../test-driver: line 107: 31806 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-sb_divappr_q\nPASS: t-scan\nPASS: t-neg\n../../test-driver: line 107: 31839 Segmentation fault: 11  \"$@\" > $log_file 2>&1\nFAIL: t-sizeinbase\nPASS: t-subadd_n\nPASS: st_fat\nPASS: st_instrument\n../../test-driver: line 107: 31881 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-tdiv_q\n../../test-driver: line 107: 31907 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-tdiv_qr\n../../test-driver: line 107: 31631 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mulmid\n../../test-driver: line 107: 31933 Bus error: 10           \"$@\" > $log_file 2>&1\nFAIL: t-mulmod_2expp1\nPASS: t-lorrshift1\n============================================================================\nTestsuite summary for MPIR 3.0.0\n============================================================================\n# TOTAL: 50\n# PASS:  18\n# SKIP:  0\n# XFAIL: 0\n# FAIL:  32\n# XPASS: 0\n# ERROR: 0\n============================================================================\nSee tests/mpn/test-suite.log\nPlease report to http://groups.google.co.uk/group/mpir-devel/\n============================================================================\nmake[5]: *** [test-suite.log] Error 1\nmake[4]: *** [check-TESTS] Error 2\nmake[3]: *** [check-am] Error 2\nmake[2]: *** [check-recursive] Error 1\nmake[1]: *** [check-recursive] Error 1\nmake: *** [check] Error 2\n```",
    "created_at": "2017-11-24T04:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355631",
    "user": "https://github.com/roed314"
}
```

<a id='comment:38'></a>The test output is

```
/Library/Developer/CommandLineTools/usr/bin/make  check-TESTS
../../test-driver: line 107: 31065 Bus error: 10           "$@" > $log_file 2>&1
PASS: t-asmtype
FAIL: t-dc_bdiv_q
PASS: t-aors_1
../../test-driver: line 107: 31068 Bus error: 10           "$@" > $log_file 2>&1
PASS: t-addsub_n
FAIL: t-dc_bdiv_q_n
../../test-driver: line 107: 31067 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 31069 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-dc_bdiv_qr
FAIL: t-dc_bdiv_qr_n
PASS: t-addadd_n
../../test-driver: line 107: 31217 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 31214 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 31218 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-dc_div_qr
FAIL: t-dc_div_qr_n
FAIL: t-dc_divappr_q
../../test-driver: line 107: 31215 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-dc_div_q
PASS: t-divebyff
PASS: t-divrem_1
../../test-driver: line 107: 31225 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-fat
../../test-driver: line 107: 31352 Bus error: 10           "$@" > $log_file 2>&1
PASS: t-instrument
../../test-driver: line 107: 31350 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 31346 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_div_q
FAIL: t-hgcd
FAIL: t-gcdext
PASS: t-get_d
PASS: t-divebyfobm1
../../test-driver: line 107: 31423 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_div_qr
../../test-driver: line 107: 31442 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_div_qr_n
../../test-driver: line 107: 31480 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-inv_divappr_q
../../test-driver: line 107: 31484 Bus error: 10           "$@" > $log_file 2>&1
../../test-driver: line 107: 31482 Bus error: 10           "$@" > $log_file 2>&1
PASS: t-iord_u
FAIL: t-invert
FAIL: t-inv_divappr_q_n
../../test-driver: line 107: 31489 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-matrix22
PASS: t-mp_bases
../../test-driver: line 107: 31591 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mullow_basecase
../../test-driver: line 107: 31628 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mullowhigh
../../test-driver: line 107: 31632 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mulmod_2expm1
PASS: t-perfsqr
../../test-driver: line 107: 31709 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-redc_1
../../test-driver: line 107: 31730 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_bdiv_q
../../test-driver: line 107: 31750 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_bdiv_qr
../../test-driver: line 107: 31762 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_div_q
../../test-driver: line 107: 31781 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_div_qr
../../test-driver: line 107: 31806 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-sb_divappr_q
PASS: t-scan
PASS: t-neg
../../test-driver: line 107: 31839 Segmentation fault: 11  "$@" > $log_file 2>&1
FAIL: t-sizeinbase
PASS: t-subadd_n
PASS: st_fat
PASS: st_instrument
../../test-driver: line 107: 31881 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-tdiv_q
../../test-driver: line 107: 31907 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-tdiv_qr
../../test-driver: line 107: 31631 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mulmid
../../test-driver: line 107: 31933 Bus error: 10           "$@" > $log_file 2>&1
FAIL: t-mulmod_2expp1
PASS: t-lorrshift1
============================================================================
Testsuite summary for MPIR 3.0.0
============================================================================
# TOTAL: 50
# PASS:  18
# SKIP:  0
# XFAIL: 0
# FAIL:  32
# XPASS: 0
# ERROR: 0
============================================================================
See tests/mpn/test-suite.log
Please report to http://groups.google.co.uk/group/mpir-devel/
============================================================================
make[5]: *** [test-suite.log] Error 1
make[4]: *** [check-TESTS] Error 2
make[3]: *** [check-am] Error 2
make[2]: *** [check-recursive] Error 1
make[1]: *** [check-recursive] Error 1
make: *** [check] Error 2
```



---

archive/issue_comments_355632.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-11-24T12:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355632",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_355633.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2017-11-24T12:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355633",
    "user": "https://github.com/dimpase"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_355634.json:
```json
{
    "body": "<a id='comment:39'></a>OK, I give up on trying to fix the assembler code there. This needs debugging on an actual box.",
    "created_at": "2017-11-24T12:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355634",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>OK, I give up on trying to fix the assembler code there. This needs debugging on an actual box.



---

archive/issue_comments_355635.json:
```json
{
    "body": "<a id='comment:40'></a>OK, please try the latest\nhttps://github.com/dimpase/mpir \n\n[this commit](https://github.com/dimpase/mpir/commit/65bb82fdf65765e6edfbbbf8edb47c726413b8da) should hopefully suffice.",
    "created_at": "2017-11-24T16:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355635",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:40'></a>OK, please try the latest
https://github.com/dimpase/mpir 

[this commit](https://github.com/dimpase/mpir/commit/65bb82fdf65765e6edfbbbf8edb47c726413b8da) should hopefully suffice.



---

archive/issue_comments_355636.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-24T16:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355636",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355637.json:
```json
{
    "body": "<a id='comment:42'></a>The commit passes all tests in\n\n```\n./configure CC=cc --prefix=/tmp/blah && make -j8 && make -j8 check\n```\nWonderful!\n\nNow I'm trying the Sage fix.",
    "created_at": "2017-11-24T17:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355637",
    "user": "https://github.com/roed314"
}
```

<a id='comment:42'></a>The commit passes all tests in

```
./configure CC=cc --prefix=/tmp/blah && make -j8 && make -j8 check
```
Wonderful!

Now I'm trying the Sage fix.



---

archive/issue_comments_355638.json:
```json
{
    "body": "<a id='comment:43'></a>OK, great.\n\nOops, sorry, there is no Sage patch up yet. I was waiting for a confirmation that this fix works. Now I need to make a patch against mpir 3.0.0. Please bear with me.",
    "created_at": "2017-11-24T18:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355638",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>OK, great.

Oops, sorry, there is no Sage patch up yet. I was waiting for a confirmation that this fix works. Now I need to make a patch against mpir 3.0.0. Please bear with me.



---

archive/issue_comments_355639.json:
```json
{
    "body": "<a id='comment:44'></a>No problem!  Thanks for your work on this; debugging assembler without access to the architecture+OS sounds hard....\n\nI could also have noticed that there was no new patch, but I'd just woken up. :-)",
    "created_at": "2017-11-24T18:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355639",
    "user": "https://github.com/roed314"
}
```

<a id='comment:44'></a>No problem!  Thanks for your work on this; debugging assembler without access to the architecture+OS sounds hard....

I could also have noticed that there was no new patch, but I'd just woken up. :-)



---

archive/issue_comments_355640.json:
```json
{
    "body": "<a id='comment:45'></a>Just asked upstream for a new release - packaging all these changes since 3.0.0 is\na pain.",
    "created_at": "2017-11-24T19:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355640",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>Just asked upstream for a new release - packaging all these changes since 3.0.0 is
a pain.



---

archive/issue_comments_355641.json:
```json
{
    "body": "<a id='comment:46'></a>get the non-official tarball from http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2\nPlease test.\n\nThe upstream promises a release, but it's not instant.\n\n---\nNew commits:",
    "created_at": "2017-11-24T19:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355641",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:46'></a>get the non-official tarball from http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2
Please test.

The upstream promises a release, but it's not instant.

---
New commits:



---

archive/issue_comments_355642.json:
```json
{
    "body": "<a id='comment:47'></a>I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.  It resulted in the following error:\n\n```\nsage-logger -p 'sage-spkg mpir-3.0.1.p0' '/Users/roed/sage/sage-8.1.rc3/logs/pkgs/mpir-3.0.1.p0.log'\n[mpir-3.0.1.p0] Found local metadata for mpir-3.0.1.p0\n[mpir-3.0.1.p0] Using cached file /Users/roed/sage/sage-8.1.rc3/upstream/mpir-3.0.1.tar.bz2\n[mpir-3.0.1.p0] mpir-3.0.1.p0\n[mpir-3.0.1.p0] ====================================================\n[mpir-3.0.1.p0] Setting up build directory for mpir-3.0.1.p0\n[mpir-3.0.1.p0] Finished extraction\n[mpir-3.0.1.p0] No patch files found in ../patches\n[mpir-3.0.1.p0] ****************************************************\n[mpir-3.0.1.p0] Host system:\n[mpir-3.0.1.p0] Darwin Davids-MBP.home.int.hackorp.com 16.7.0 Darwin Kernel Version 16.7.0: Thu Jun 15 17:36:27 PDT 2017; root:xnu-3789.70.16~2/RELEASE_X86_64 x86_64\n[mpir-3.0.1.p0] ****************************************************\n[mpir-3.0.1.p0] C compiler: gcc\n[mpir-3.0.1.p0] C compiler version:\n[mpir-3.0.1.p0] Configured with: --prefix=/Library/Developer/CommandLineTools/usr --with-gxx-include-dir=/usr/include/c++/4.2.1\n[mpir-3.0.1.p0] Apple LLVM version 9.0.0 (clang-900.0.37)\n[mpir-3.0.1.p0] Target: x86_64-apple-darwin16.7.0\n[mpir-3.0.1.p0] Thread model: posix\n[mpir-3.0.1.p0] InstalledDir: /Library/Developer/CommandLineTools/usr/bin\n[mpir-3.0.1.p0] ****************************************************\n[mpir-3.0.1.p0] Machine type (default): x86_64-apple-darwin16.7.0\n[mpir-3.0.1.p0] Machine type (mpir): skylakeavx-apple-darwin16.7.0\n[mpir-3.0.1.p0] Building a 64-bit version of MPIR, which is the default.\n[mpir-3.0.1.p0] Building a reduced version of MPIR to bootstrap GCC.\n[mpir-3.0.1.p0] MPIR will later get rebuilt (with the C++ interface and static libraries\n[mpir-3.0.1.p0] enabled) using the new compiler.\n[mpir-3.0.1.p0] ------------------------------------------------------------------------\n[mpir-3.0.1.p0] Configuring MPIR with empty CFLAGS to determine the defaults:\n[mpir-3.0.1.p0] configure: error: cannot find install-sh, install.sh, or shtool in \".\" \"./..\" \"./../..\"\n[mpir-3.0.1.p0] Error configuring MPIR (with CFLAGS unset).\n[mpir-3.0.1.p0] Consult /Users/roed/sage/sage-8.1.rc3/local/var/tmp/sage/build/mpir-3.0.1.p0/src/config.log for for details.\n[mpir-3.0.1.p0] \n[mpir-3.0.1.p0] real\t0m0.695s\n[mpir-3.0.1.p0] user\t0m0.240s\n[mpir-3.0.1.p0] sys\t0m0.343s\n[mpir-3.0.1.p0] ************************************************************************\n[mpir-3.0.1.p0] Error installing package mpir-3.0.1.p0\n[mpir-3.0.1.p0] ************************************************************************\n[mpir-3.0.1.p0] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[mpir-3.0.1.p0] explaining the problem and including the log file\n[mpir-3.0.1.p0]   /Users/roed/sage/sage-8.1.rc3/logs/pkgs/mpir-3.0.1.p0.log\n[mpir-3.0.1.p0] Describe your computer, operating system, etc.\n[mpir-3.0.1.p0] If you want to try to fix the problem yourself, *don't* just cd to\n[mpir-3.0.1.p0] /Users/roed/sage/sage-8.1.rc3/local/var/tmp/sage/build/mpir-3.0.1.p0 and type 'make' or whatever is appropriate.\n[mpir-3.0.1.p0] Instead, the following commands setup all environment variables\n[mpir-3.0.1.p0] correctly and load a subshell for you to debug the error:\n[mpir-3.0.1.p0]   (cd '/Users/roed/sage/sage-8.1.rc3/local/var/tmp/sage/build/mpir-3.0.1.p0' && '/Users/roed/sage/sage-8.1.rc3/sage' --sh)\n[mpir-3.0.1.p0] When you are done debugging, you can type \"exit\" to leave the subshell.\n[mpir-3.0.1.p0] ************************************************************************\nmake[2]: *** [/Users/roed/sage/sage-8.1.rc3/local/var/lib/sage/installed/mpir-3.0.1.p0] Error 1\nmake[1]: *** [all-toolchain] Error 2\n```\nI've posted `local/var/tmp/sage/build/mpir-3.0.1.p0/src/config.log` at http://www.pitt.edu/~roed/config_24085_3.log",
    "created_at": "2017-11-24T21:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355642",
    "user": "https://github.com/roed314"
}
```

<a id='comment:47'></a>I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.  It resulted in the following error:

```
sage-logger -p 'sage-spkg mpir-3.0.1.p0' '/Users/roed/sage/sage-8.1.rc3/logs/pkgs/mpir-3.0.1.p0.log'
[mpir-3.0.1.p0] Found local metadata for mpir-3.0.1.p0
[mpir-3.0.1.p0] Using cached file /Users/roed/sage/sage-8.1.rc3/upstream/mpir-3.0.1.tar.bz2
[mpir-3.0.1.p0] mpir-3.0.1.p0
[mpir-3.0.1.p0] ====================================================
[mpir-3.0.1.p0] Setting up build directory for mpir-3.0.1.p0
[mpir-3.0.1.p0] Finished extraction
[mpir-3.0.1.p0] No patch files found in ../patches
[mpir-3.0.1.p0] ****************************************************
[mpir-3.0.1.p0] Host system:
[mpir-3.0.1.p0] Darwin Davids-MBP.home.int.hackorp.com 16.7.0 Darwin Kernel Version 16.7.0: Thu Jun 15 17:36:27 PDT 2017; root:xnu-3789.70.16~2/RELEASE_X86_64 x86_64
[mpir-3.0.1.p0] ****************************************************
[mpir-3.0.1.p0] C compiler: gcc
[mpir-3.0.1.p0] C compiler version:
[mpir-3.0.1.p0] Configured with: --prefix=/Library/Developer/CommandLineTools/usr --with-gxx-include-dir=/usr/include/c++/4.2.1
[mpir-3.0.1.p0] Apple LLVM version 9.0.0 (clang-900.0.37)
[mpir-3.0.1.p0] Target: x86_64-apple-darwin16.7.0
[mpir-3.0.1.p0] Thread model: posix
[mpir-3.0.1.p0] InstalledDir: /Library/Developer/CommandLineTools/usr/bin
[mpir-3.0.1.p0] ****************************************************
[mpir-3.0.1.p0] Machine type (default): x86_64-apple-darwin16.7.0
[mpir-3.0.1.p0] Machine type (mpir): skylakeavx-apple-darwin16.7.0
[mpir-3.0.1.p0] Building a 64-bit version of MPIR, which is the default.
[mpir-3.0.1.p0] Building a reduced version of MPIR to bootstrap GCC.
[mpir-3.0.1.p0] MPIR will later get rebuilt (with the C++ interface and static libraries
[mpir-3.0.1.p0] enabled) using the new compiler.
[mpir-3.0.1.p0] ------------------------------------------------------------------------
[mpir-3.0.1.p0] Configuring MPIR with empty CFLAGS to determine the defaults:
[mpir-3.0.1.p0] configure: error: cannot find install-sh, install.sh, or shtool in "." "./.." "./../.."
[mpir-3.0.1.p0] Error configuring MPIR (with CFLAGS unset).
[mpir-3.0.1.p0] Consult /Users/roed/sage/sage-8.1.rc3/local/var/tmp/sage/build/mpir-3.0.1.p0/src/config.log for for details.
[mpir-3.0.1.p0] 
[mpir-3.0.1.p0] real	0m0.695s
[mpir-3.0.1.p0] user	0m0.240s
[mpir-3.0.1.p0] sys	0m0.343s
[mpir-3.0.1.p0] ************************************************************************
[mpir-3.0.1.p0] Error installing package mpir-3.0.1.p0
[mpir-3.0.1.p0] ************************************************************************
[mpir-3.0.1.p0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[mpir-3.0.1.p0] explaining the problem and including the log file
[mpir-3.0.1.p0]   /Users/roed/sage/sage-8.1.rc3/logs/pkgs/mpir-3.0.1.p0.log
[mpir-3.0.1.p0] Describe your computer, operating system, etc.
[mpir-3.0.1.p0] If you want to try to fix the problem yourself, *don't* just cd to
[mpir-3.0.1.p0] /Users/roed/sage/sage-8.1.rc3/local/var/tmp/sage/build/mpir-3.0.1.p0 and type 'make' or whatever is appropriate.
[mpir-3.0.1.p0] Instead, the following commands setup all environment variables
[mpir-3.0.1.p0] correctly and load a subshell for you to debug the error:
[mpir-3.0.1.p0]   (cd '/Users/roed/sage/sage-8.1.rc3/local/var/tmp/sage/build/mpir-3.0.1.p0' && '/Users/roed/sage/sage-8.1.rc3/sage' --sh)
[mpir-3.0.1.p0] When you are done debugging, you can type "exit" to leave the subshell.
[mpir-3.0.1.p0] ************************************************************************
make[2]: *** [/Users/roed/sage/sage-8.1.rc3/local/var/lib/sage/installed/mpir-3.0.1.p0] Error 1
make[1]: *** [all-toolchain] Error 2
```
I've posted `local/var/tmp/sage/build/mpir-3.0.1.p0/src/config.log` at http://www.pitt.edu/~roed/config_24085_3.log



---

archive/issue_comments_355643.json:
```json
{
    "body": "<a id='comment:48'></a>I think I should clarify that there is no \"upstream\". I am happy to advise on what needs to be done and upload tarballs to the website, but MPIR is a community supported project now. I am of course merging patches, and my repository is still the official repository, but that is the limit of my contribution, unless I personally need something myself.",
    "created_at": "2017-11-24T21:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355643",
    "user": "https://trac.sagemath.org/admin/accounts/users/wbhart"
}
```

<a id='comment:48'></a>I think I should clarify that there is no "upstream". I am happy to advise on what needs to be done and upload tarballs to the website, but MPIR is a community supported project now. I am of course merging patches, and my repository is still the official repository, but that is the limit of my contribution, unless I personally need something myself.



---

archive/issue_comments_355644.json:
```json
{
    "body": "<a id='comment:49'></a>I'm not sure how the tarball was created, but in general you can't make a tarball from the MPIR repository without running make dist, since it does some post changes. And make dist should only be run if all the paperwork is up-to-date, version numbers have been updated and the .so versioning is taken care of.",
    "created_at": "2017-11-24T21:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355644",
    "user": "https://trac.sagemath.org/admin/accounts/users/wbhart"
}
```

<a id='comment:49'></a>I'm not sure how the tarball was created, but in general you can't make a tarball from the MPIR repository without running make dist, since it does some post changes. And make dist should only be run if all the paperwork is up-to-date, version numbers have been updated and the .so versioning is taken care of.



---

archive/issue_comments_355645.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:47 roed]:\n> I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.\n\n\n\nIMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...\n\nThe tarball worked for me on an installation of Sage, where I \ndropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...",
    "created_at": "2017-11-24T21:55:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355645",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>Replying to [comment:47 roed]:
> I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.



IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...

The tarball worked for me on an installation of Sage, where I 
dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...



---

archive/issue_comments_355646.json:
```json
{
    "body": "<a id='comment:51'></a>Replying to [comment:49 wbhart]:\n> I'm not sure how the tarball was created, but in general you can't make a tarball from the MPIR repository without running make dist, since it does some post changes. And make dist should only be run if all the paperwork is up-to-date, version numbers have been updated and the .so versioning is taken care of.\n\n\nHereby, in regard of allegations of fragrant tarball paperwork forgery, I invoke the 5th.\n\nWhereas, there is no direct connection between Sage package numbers and versions of the library. Thus the tarball will pretend to be mpir 3.0.0, I think...",
    "created_at": "2017-11-24T22:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355646",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>Replying to [comment:49 wbhart]:
> I'm not sure how the tarball was created, but in general you can't make a tarball from the MPIR repository without running make dist, since it does some post changes. And make dist should only be run if all the paperwork is up-to-date, version numbers have been updated and the .so versioning is taken care of.


Hereby, in regard of allegations of fragrant tarball paperwork forgery, I invoke the 5th.

Whereas, there is no direct connection between Sage package numbers and versions of the library. Thus the tarball will pretend to be mpir 3.0.0, I think...



---

archive/issue_comments_355647.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:50 dimpase]:\n> Replying to [comment:47 roed]:\n> > I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.\n\n> \n> \n> IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...\n\n\nI tried `./configure && make`, with no success. \n \n> The tarball worked for me on an installation of Sage, where I \n> dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...\n\n\nI didn't pull anything, but I wouldn't expect that to be necessary given that you made a tarball with the changes.  I'm not sure how to proceed....",
    "created_at": "2017-11-24T23:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355647",
    "user": "https://github.com/roed314"
}
```

<a id='comment:52'></a>Replying to [comment:50 dimpase]:
> Replying to [comment:47 roed]:
> > I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.

> 
> 
> IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...


I tried `./configure && make`, with no success. 
 
> The tarball worked for me on an installation of Sage, where I 
> dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...


I didn't pull anything, but I wouldn't expect that to be necessary given that you made a tarball with the changes.  I'm not sure how to proceed....



---

archive/issue_comments_355648.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:52 roed]:\n> Replying to [comment:50 dimpase]:\n> > Replying to [comment:47 roed]:\n> > > I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.\n\n> > \n> > \n> > IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...\n\n> \n> I tried `./configure && make`, with no success. \n>  \n> > The tarball worked for me on an installation of Sage, where I \n> > dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...\n\n> \n> I didn't pull anything, but I wouldn't expect that to be necessary given that you made a tarball with the changes.  I'm not sure how to proceed....\n\n\nYou do need to pull the branch `u/dimpase/skylakefix`.  It is very short:\n\n```\ndiff --git a/build/pkgs/mpir/checksums.ini b/build/pkgs/mpir/checksums.ini\nindex 185e5ca..d2acf76 100644\n--- a/build/pkgs/mpir/checksums.ini\n+++ b/build/pkgs/mpir/checksums.ini\n@@ -1,4 +1,4 @@\n tarball=mpir-VERSION.tar.bz2\n-sha1=8300b351b730891dfb9cb1e411a5ca39eee73fda\n-md5=4e5d16676e0cd6773f43bbbeb5cb0016\n-cksum=2173521258\n+sha1=1f7081c2f4a83fb4e9e3453bbafb6aa18f1c5d5a\n+md5=308f4a981c0a2e796aa41ff3ac805b81\n+cksum=2473237225\ndiff --git a/build/pkgs/mpir/package-version.txt b/build/pkgs/mpir/package-version.txt\nindex e3e3689..a7590f2 100644\n--- a/build/pkgs/mpir/package-version.txt\n+++ b/build/pkgs/mpir/package-version.txt\n@@ -1 +1 @@\n-3.0.0.p0\n+3.0.1.p0\n```\n\nThere are no patches to MPIR in the branch, they are indeed packaged in the tarball.\n \nTarballs are matched by `package-version.txt`, which gives you `VERSION`\nin `tarball=mpir-VERSION.tar.bz2`, and checked for authenticity using sha1 and md5.",
    "created_at": "2017-11-24T23:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355648",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:53'></a>Replying to [comment:52 roed]:
> Replying to [comment:50 dimpase]:
> > Replying to [comment:47 roed]:
> > > I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.

> > 
> > 
> > IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...

> 
> I tried `./configure && make`, with no success. 
>  
> > The tarball worked for me on an installation of Sage, where I 
> > dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...

> 
> I didn't pull anything, but I wouldn't expect that to be necessary given that you made a tarball with the changes.  I'm not sure how to proceed....


You do need to pull the branch `u/dimpase/skylakefix`.  It is very short:

```
diff --git a/build/pkgs/mpir/checksums.ini b/build/pkgs/mpir/checksums.ini
index 185e5ca..d2acf76 100644
--- a/build/pkgs/mpir/checksums.ini
+++ b/build/pkgs/mpir/checksums.ini
@@ -1,4 +1,4 @@
 tarball=mpir-VERSION.tar.bz2
-sha1=8300b351b730891dfb9cb1e411a5ca39eee73fda
-md5=4e5d16676e0cd6773f43bbbeb5cb0016
-cksum=2173521258
+sha1=1f7081c2f4a83fb4e9e3453bbafb6aa18f1c5d5a
+md5=308f4a981c0a2e796aa41ff3ac805b81
+cksum=2473237225
diff --git a/build/pkgs/mpir/package-version.txt b/build/pkgs/mpir/package-version.txt
index e3e3689..a7590f2 100644
--- a/build/pkgs/mpir/package-version.txt
+++ b/build/pkgs/mpir/package-version.txt
@@ -1 +1 @@
-3.0.0.p0
+3.0.1.p0
```

There are no patches to MPIR in the branch, they are indeed packaged in the tarball.
 
Tarballs are matched by `package-version.txt`, which gives you `VERSION`
in `tarball=mpir-VERSION.tar.bz2`, and checked for authenticity using sha1 and md5.



---

archive/issue_comments_355649.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [comment:53 dimpase]:\n> Replying to [comment:52 roed]:\n> > Replying to [comment:50 dimpase]:\n> > > Replying to [comment:47 roed]:\n> > > > I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.\n\n> > > \n> > > \n> > > IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...\n\n> > \n> > I tried `./configure && make`, with no success. \n> >  \n> > > The tarball worked for me on an installation of Sage, where I \n> > > dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...\n\n> > \n> > I didn't pull anything, but I wouldn't expect that to be necessary given that you made a tarball with the changes.  I'm not sure how to proceed....\n\n> \n> You do need to pull the branch `u/dimpase/skylakefix`. \n\n\nOh, I misunderstood you: I thought you meant pull from the mpir repo.  I did pull the branch on this ticket, so I'm using the correct tarball.\n\n> There are no patches to MPIR in the branch, they are indeed packaged in the tarball.\n>  \n> Tarballs are matched by `package-version.txt`, which gives you `VERSION`\n> in `tarball=mpir-VERSION.tar.bz2`, and checked for authenticity using sha1 and md5.\n> \n\n>",
    "created_at": "2017-11-24T23:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355649",
    "user": "https://github.com/roed314"
}
```

<a id='comment:54'></a>Replying to [comment:53 dimpase]:
> Replying to [comment:52 roed]:
> > Replying to [comment:50 dimpase]:
> > > Replying to [comment:47 roed]:
> > > > I downloaded a fresh sage-8.1.rc3, downloaded the mpir tarball and put it in `upstream`, deleted `mpir-3.0.0.tar.bz2`, applied the branch on this ticket and then ran `make`.

> > > 
> > > 
> > > IMHO you might need to run `./configure` before running `make`. It could be that the install procedure got confused about the package versions...

> > 
> > I tried `./configure && make`, with no success. 
> >  
> > > The tarball worked for me on an installation of Sage, where I 
> > > dropped it to upstream/, pulled the branch, and ran `./sage -f mpir` followed by make...

> > 
> > I didn't pull anything, but I wouldn't expect that to be necessary given that you made a tarball with the changes.  I'm not sure how to proceed....

> 
> You do need to pull the branch `u/dimpase/skylakefix`. 


Oh, I misunderstood you: I thought you meant pull from the mpir repo.  I did pull the branch on this ticket, so I'm using the correct tarball.

> There are no patches to MPIR in the branch, they are indeed packaged in the tarball.
>  
> Tarballs are matched by `package-version.txt`, which gives you `VERSION`
> in `tarball=mpir-VERSION.tar.bz2`, and checked for authenticity using sha1 and md5.
> 

>



---

archive/issue_comments_355650.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-25T01:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355651.json:
```json
{
    "body": "<a id='comment:56'></a>I've updated the tarball and the branch, hopefully it works now...\n\n---\nNew commits:",
    "created_at": "2017-11-25T01:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355651",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:56'></a>I've updated the tarball and the branch, hopefully it works now...

---
New commits:



---

archive/issue_comments_355652.json:
```json
{
    "body": "<a id='comment:57'></a>It's looking good: the build has made it to compiling the Sage library.  I'm going to run tests, but need to go to sleep now.  Assuming tests pass, positive review from me (probably in about 8 hours).",
    "created_at": "2017-11-25T09:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355652",
    "user": "https://github.com/roed314"
}
```

<a id='comment:57'></a>It's looking good: the build has made it to compiling the Sage library.  I'm going to run tests, but need to go to sleep now.  Assuming tests pass, positive review from me (probably in about 8 hours).



---

archive/issue_comments_355653.json:
```json
{
    "body": "<a id='comment:58'></a>So, the build finished, but Sage doesn't start.  The error that it gives doesn't seem particularly related to mpir though....\n\nI've put the crash report at http://www.pitt.edu/~roed/crash_report_24085.txt in case anyone wants to take a look.  I'm going to sleep now; I'll try to take a look tomorrow.",
    "created_at": "2017-11-25T10:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355653",
    "user": "https://github.com/roed314"
}
```

<a id='comment:58'></a>So, the build finished, but Sage doesn't start.  The error that it gives doesn't seem particularly related to mpir though....

I've put the crash report at http://www.pitt.edu/~roed/crash_report_24085.txt in case anyone wants to take a look.  I'm going to sleep now; I'll try to take a look tomorrow.



---

archive/issue_comments_355654.json:
```json
{
    "body": "<a id='comment:59'></a>at the bottom of your log one sees certain looking dodgy `~/.venvburrito/` directory reference\n\n```\n/Users/roed/.venvburrito/lib/python2.7/site-packages/six.pyc in with_metaclass(meta=<type 'sage.misc.classcall_metaclass.ClasscallMetaclass'>, *bases=())\n```\n\nI would have moved it out of the way and tried to start Sage again. If you still have issues like this afterwards, I'd have moved `~/.sage/` too.",
    "created_at": "2017-11-25T10:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355654",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:59'></a>at the bottom of your log one sees certain looking dodgy `~/.venvburrito/` directory reference

```
/Users/roed/.venvburrito/lib/python2.7/site-packages/six.pyc in with_metaclass(meta=<type 'sage.misc.classcall_metaclass.ClasscallMetaclass'>, *bases=())
```

I would have moved it out of the way and tried to start Sage again. If you still have issues like this afterwards, I'd have moved `~/.sage/` too.



---

archive/issue_comments_355655.json:
```json
{
    "body": "<a id='comment:60'></a>Thanks.  I had to use Homebrew to install autotools; I think that's where the `~/.venvburrito` came from. I've moved it, and now tests are running.",
    "created_at": "2017-11-25T19:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355655",
    "user": "https://github.com/roed314"
}
```

<a id='comment:60'></a>Thanks.  I had to use Homebrew to install autotools; I think that's where the `~/.venvburrito` came from. I've moved it, and now tests are running.



---

archive/issue_comments_355656.json:
```json
{
    "body": "<a id='comment:61'></a>on my museum (7.y.o.) MacBookAir I get a timeout in one test:\n\n```\nsage -t --long --warn-long 1000.9 src/sage/rings/padics/padic_generic_element.pyx\n...\nsage: R = Zp(17,10^6) ## line 2626 ##\nsage: a = 17 * R.random_element() ## line 2627 ##\nsage: b = a.exp()    # should be rather fast ## line 2628 ##\n------------------------------------------------------------------------\n0   signals.so                          0x000000010995b2d8 print_backtrace + 40\n1   ???                                 0x98c0d8bd7ba6be0e 0x0 + 11007035797628435982\n------------------------------------------------------------------------\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --long --warn-long 1000.9 src/sage/rings/padics/padic_generic_element.pyx  # Timed out\nTotal time for all tests: 1800.1 seconds\n...\n```\nIf I try this `b=a.exp()` at the Sage prompt it keeps running seemingly forever.\nPerhaps knowing concrete values (not random `a`) to test would help here...\n\nIf I use `10^5` instead of `10^6` in the definition of `R`, it still seems to return in about 10 sec.",
    "created_at": "2017-11-25T22:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355656",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:61'></a>on my museum (7.y.o.) MacBookAir I get a timeout in one test:

```
sage -t --long --warn-long 1000.9 src/sage/rings/padics/padic_generic_element.pyx
...
sage: R = Zp(17,10^6) ## line 2626 ##
sage: a = 17 * R.random_element() ## line 2627 ##
sage: b = a.exp()    # should be rather fast ## line 2628 ##
------------------------------------------------------------------------
0   signals.so                          0x000000010995b2d8 print_backtrace + 40
1   ???                                 0x98c0d8bd7ba6be0e 0x0 + 11007035797628435982
------------------------------------------------------------------------

**********************************************************************
----------------------------------------------------------------------
sage -t --long --warn-long 1000.9 src/sage/rings/padics/padic_generic_element.pyx  # Timed out
Total time for all tests: 1800.1 seconds
...
```
If I try this `b=a.exp()` at the Sage prompt it keeps running seemingly forever.
Perhaps knowing concrete values (not random `a`) to test would help here...

If I use `10^5` instead of `10^6` in the definition of `R`, it still seems to return in about 10 sec.



---

archive/issue_comments_355657.json:
```json
{
    "body": "<a id='comment:62'></a>Thanks for this! Once I moved `mpir-3.0.1.tar.bz2` into upstream sage built without any problem (macbook pro with a skylake chip running 10.12.6). I'm currently running the tests and so far they have all passed, up to `src/sage/plot/plot3d/shapes.pyx` but it's time for me to crash...",
    "created_at": "2017-11-25T23:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355657",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:62'></a>Thanks for this! Once I moved `mpir-3.0.1.tar.bz2` into upstream sage built without any problem (macbook pro with a skylake chip running 10.12.6). I'm currently running the tests and so far they have all passed, up to `src/sage/plot/plot3d/shapes.pyx` but it's time for me to crash...



---

archive/issue_comments_355658.json:
```json
{
    "body": "<a id='comment:63'></a>Oh, and for me the tests pass with `sage -t --long --warn-long 1000.9 src/sage/rings/padics/padic_generic_element.pyx` but I get the same problems with:\n\n```\nsage: R = Zp(17,10^6) ## line 2626 ##\nsage: a = 17 * R.random_element() ## line 2627 ##\nsage: b = a.exp()    # should be rather fast ## line 2628 ##\n```",
    "created_at": "2017-11-25T23:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355658",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:63'></a>Oh, and for me the tests pass with `sage -t --long --warn-long 1000.9 src/sage/rings/padics/padic_generic_element.pyx` but I get the same problems with:

```
sage: R = Zp(17,10^6) ## line 2626 ##
sage: a = 17 * R.random_element() ## line 2627 ##
sage: b = a.exp()    # should be rather fast ## line 2628 ##
```



---

archive/issue_comments_355659.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-26T05:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355659",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355660.json:
```json
{
    "body": "<a id='comment:64'></a>All tests pass on my machine.  Given that 8.1 is about to be released and this change makes Sage buildable on a Skylake Mac, I think it's reasonable to try to get it in and worry about any potential slowdowns on another ticket.\n\nI'm not seeing issues with `src/sage/rings/padics/padic_generic_element.pyx`, but note that changes in mpir could affect that code.  The code that's eventually getting called is the `padicexp` function in `src/sage/rings/padics/transcendental.c`.",
    "created_at": "2017-11-26T05:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355660",
    "user": "https://github.com/roed314"
}
```

<a id='comment:64'></a>All tests pass on my machine.  Given that 8.1 is about to be released and this change makes Sage buildable on a Skylake Mac, I think it's reasonable to try to get it in and worry about any potential slowdowns on another ticket.

I'm not seeing issues with `src/sage/rings/padics/padic_generic_element.pyx`, but note that changes in mpir could affect that code.  The code that's eventually getting called is the `padicexp` function in `src/sage/rings/padics/transcendental.c`.



---

archive/issue_comments_355661.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n+\n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n+\n+\n+In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   \n+\n+The tarball: http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2\n+\n \n \n Upstream: Workaround found; Bug reported upstream.\n```\n",
    "created_at": "2017-11-26T07:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355661",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,15 @@
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
+
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
+
+
+In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   
+
+The tarball: http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2
+
 
 
 Upstream: Workaround found; Bug reported upstream.
```




---

archive/issue_comments_355662.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2017-11-28T10:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355662",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_355663.json:
```json
{
    "body": "<a id='comment:66'></a>Could you better document where you obtained this tarball? I can't find it on http://mpir.org/downloads.html",
    "created_at": "2017-11-28T10:20:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355663",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'></a>Could you better document where you obtained this tarball? I can't find it on http://mpir.org/downloads.html



---

archive/issue_comments_355664.json:
```json
{
    "body": "<a id='comment:67'></a>See also [comment:23]",
    "created_at": "2017-11-28T10:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355664",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:67'></a>See also [comment:23]



---

archive/issue_comments_355665.json:
```json
{
    "body": "<a id='comment:68'></a>There's not an official release: Dima made a tarball which is available at \u200bhttp://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2",
    "created_at": "2017-11-28T10:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355665",
    "user": "https://github.com/roed314"
}
```

<a id='comment:68'></a>There's not an official release: Dima made a tarball which is available at http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2



---

archive/issue_comments_355666.json:
```json
{
    "body": "<a id='comment:69'></a>The tarball has been made from https://github.com/dimpase/mpir/commit/65bb82fdf65765e6edfbbbf8edb47c726413b8da\n(now merged in https://github.com/wbhart/mpir/pull/234)\nby following (already outdated, as Billa says) https://github.com/wbhart/mpir/commit/1b3d5976292c6308c3f121c5ea2c406da0324bc8\nand running `make dist`.\n\nBill is planning a new release, I gather.",
    "created_at": "2017-11-28T10:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355666",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:69'></a>The tarball has been made from https://github.com/dimpase/mpir/commit/65bb82fdf65765e6edfbbbf8edb47c726413b8da
(now merged in https://github.com/wbhart/mpir/pull/234)
by following (already outdated, as Billa says) https://github.com/wbhart/mpir/commit/1b3d5976292c6308c3f121c5ea2c406da0324bc8
and running `make dist`.

Bill is planning a new release, I gather.



---

archive/issue_comments_355667.json:
```json
{
    "body": "<a id='comment:70'></a>Replying to [comment:69 dimpase]:\n> The tarball has been made from https://github.com/dimpase/mpir/commit/65bb82fdf65765e6edfbbbf8edb47c726413b8da\n> (now merged in https://github.com/wbhart/mpir/pull/234)\n> by following (already outdated, as Billa says) https://github.com/wbhart/mpir/commit/1b3d5976292c6308c3f121c5ea2c406da0324bc8\n> and running `make dist`.\n\n\n1. What does \"made from X by following Y mean\"?\n\n2. Can you please document this in `SPKG.txt` or somewhere where people will find it?",
    "created_at": "2017-11-28T10:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355667",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:70'></a>Replying to [comment:69 dimpase]:
> The tarball has been made from https://github.com/dimpase/mpir/commit/65bb82fdf65765e6edfbbbf8edb47c726413b8da
> (now merged in https://github.com/wbhart/mpir/pull/234)
> by following (already outdated, as Billa says) https://github.com/wbhart/mpir/commit/1b3d5976292c6308c3f121c5ea2c406da0324bc8
> and running `make dist`.


1. What does "made from X by following Y mean"?

2. Can you please document this in `SPKG.txt` or somewhere where people will find it?



---

archive/issue_comments_355668.json:
```json
{
    "body": "<a id='comment:71'></a>3. Do not call it `mpir-3.0.1`. Call it `mpir-3.0.0-dima` or `mpir-3.0.0-1b3d5976292c6308c3f121c5ea2c406da0324bc8` or whatever.",
    "created_at": "2017-11-28T10:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355668",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:71'></a>3. Do not call it `mpir-3.0.1`. Call it `mpir-3.0.0-dima` or `mpir-3.0.0-1b3d5976292c6308c3f121c5ea2c406da0324bc8` or whatever.



---

archive/issue_comments_355669.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:68 roed]:\n> There's not an official release: Dima made a tarball which is available at \u200bhttp://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2\n\n\nFine for me, but how you expect people to know this?\n\nI don't mind custom tarballs, as long as it is absolutely clear what is going on.",
    "created_at": "2017-11-28T10:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355669",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'></a>Replying to [comment:68 roed]:
> There's not an official release: Dima made a tarball which is available at http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1.tar.bz2


Fine for me, but how you expect people to know this?

I don't mind custom tarballs, as long as it is absolutely clear what is going on.



---

archive/issue_comments_355670.json:
```json
{
    "body": "<a id='comment:73'></a>MPIR used to have a convoluted way to make releases, involving modifying  version numbers some files, running autoconf, editing generated configure, running configure, and then running `make dist` to make a tarball. And the said tarball needs to be pruned for heaps of MSVC-specific config files, that take 10 times more space than the code...\n\nRiding trains Oxford-London-Paris, might be unable to do much before evening.",
    "created_at": "2017-11-28T10:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355670",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:73'></a>MPIR used to have a convoluted way to make releases, involving modifying  version numbers some files, running autoconf, editing generated configure, running configure, and then running `make dist` to make a tarball. And the said tarball needs to be pruned for heaps of MSVC-specific config files, that take 10 times more space than the code...

Riding trains Oxford-London-Paris, might be unable to do much before evening.



---

archive/issue_comments_355671.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:73 dimpase]:\n> MPIR used to have a convoluted way to make releases, involving modifying  version numbers some files, running autoconf, editing generated configure, running configure, and then running `make dist` to make a tarball. And the said tarball needs to be pruned for heaps of MSVC-specific config files, that take 10 times more space than the code...\n\n\nThen are you sure that simply adding a patch isn't simpler?",
    "created_at": "2017-11-28T10:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355671",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:74'></a>Replying to [comment:73 dimpase]:
> MPIR used to have a convoluted way to make releases, involving modifying  version numbers some files, running autoconf, editing generated configure, running configure, and then running `make dist` to make a tarball. And the said tarball needs to be pruned for heaps of MSVC-specific config files, that take 10 times more space than the code...


Then are you sure that simply adding a patch isn't simpler?



---

archive/issue_comments_355672.json:
```json
{
    "body": "<a id='comment:75'></a>Replying to [comment:74 jdemeyer]:\n> Replying to [comment:73 dimpase]:\n> > MPIR used to have a convoluted way to make releases, involving modifying  version numbers some files, running autoconf, editing generated configure, running configure, and then running `make dist` to make a tarball. And the said tarball needs to be pruned for heaps of MSVC-specific config files, that take 10 times more space than the code...\n\n> \n> Then are you sure that simply adding a patch isn't simpler?\n\n\nbecause my patches are not against mpir 3.0.0, they are against last week's master.\nAnd there is a hundred of commits in between, and also 3.0.0 is a different branch, in fact.\nI tried created a patch against 3.0.0, but it would have been magabytes in size and a lot of time to create.",
    "created_at": "2017-11-28T11:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355672",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:75'></a>Replying to [comment:74 jdemeyer]:
> Replying to [comment:73 dimpase]:
> > MPIR used to have a convoluted way to make releases, involving modifying  version numbers some files, running autoconf, editing generated configure, running configure, and then running `make dist` to make a tarball. And the said tarball needs to be pruned for heaps of MSVC-specific config files, that take 10 times more space than the code...

> 
> Then are you sure that simply adding a patch isn't simpler?


because my patches are not against mpir 3.0.0, they are against last week's master.
And there is a hundred of commits in between, and also 3.0.0 is a different branch, in fact.
I tried created a patch against 3.0.0, but it would have been magabytes in size and a lot of time to create.



---

archive/issue_comments_355673.json:
```json
{
    "body": "<a id='comment:76'></a>anyhow, I can rename the tarball and the corr. different version in the package-version,\nbut don't ask me to do tarball creation from scratch again.",
    "created_at": "2017-11-28T11:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355673",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:76'></a>anyhow, I can rename the tarball and the corr. different version in the package-version,
but don't ask me to do tarball creation from scratch again.



---

archive/issue_comments_355674.json:
```json
{
    "body": "<a id='comment:77'></a>Replying to [comment:76 dimpase]:\n> anyhow, I can rename the tarball and the corr. different version in the package-version,\n> but don't ask me to do tarball creation from scratch again.\n\n\nI am asking you to *document* what you did, not to do it again.",
    "created_at": "2017-11-28T11:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355674",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:77'></a>Replying to [comment:76 dimpase]:
> anyhow, I can rename the tarball and the corr. different version in the package-version,
> but don't ask me to do tarball creation from scratch again.


I am asking you to *document* what you did, not to do it again.



---

archive/issue_comments_355675.json:
```json
{
    "body": "<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-28T12:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355676.json:
```json
{
    "body": "<a id='comment:79'></a>I've renamed the tarball.\n\n---\nNew commits:",
    "created_at": "2017-11-28T12:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355676",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:79'></a>I've renamed the tarball.

---
New commits:



---

archive/issue_comments_355677.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-11-28T12:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355677",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_355678.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,15 @@\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n+\n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n+\n+\n+In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   \n+\n+The tarball: http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1prerelease.tar.bz2\n+\n \n \n Upstream: Workaround found; Bug reported upstream.\n```\n",
    "created_at": "2017-11-28T12:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355678",
    "user": "https://github.com/dimpase"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,15 @@
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
+
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
+
+
+In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   
+
+The tarball: http://users.ox.ac.uk/~coml0531/sage/mpir-3.0.1prerelease.tar.bz2
+
 
 
 Upstream: Workaround found; Bug reported upstream.
```




---

archive/issue_comments_355679.json:
```json
{
    "body": "<a id='comment:80'></a>> 3.0.1prerelease is built from https://github.com/wbhart/mpir/pull/234\n\n\nCan you instead refer to an exact commit on the git repo?\n\n> following the (outdated) procedure outlined in https://github.com/wbhart/mpir/commit/1b3d5976292c6308c3f121c5ea2c406da0324bc8\n\n\nThat's also not clear. How does this commit outline a procedure?",
    "created_at": "2017-11-28T13:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355679",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:80'></a>> 3.0.1prerelease is built from https://github.com/wbhart/mpir/pull/234


Can you instead refer to an exact commit on the git repo?

> following the (outdated) procedure outlined in https://github.com/wbhart/mpir/commit/1b3d5976292c6308c3f121c5ea2c406da0324bc8


That's also not clear. How does this commit outline a procedure?



---

archive/issue_comments_355680.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-28T13:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355680",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_355681.json:
```json
{
    "body": "<a id='comment:82'></a>Perhaps you have not had a look at the commit I mention? There are files to edit, scripts to run, and it is outdated. I am not going to spend time describing details- I am sure anyone with an idea on how mpir tarballs are made will manage to reproduce this.",
    "created_at": "2017-11-28T13:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355681",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:82'></a>Perhaps you have not had a look at the commit I mention? There are files to edit, scripts to run, and it is outdated. I am not going to spend time describing details- I am sure anyone with an idea on how mpir tarballs are made will manage to reproduce this.



---

archive/issue_comments_355682.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-28T13:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355682",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355683.json:
```json
{
    "body": "<a id='comment:84'></a>Release or not release, that is the question ;-)\n\nI'm hesitant to ship some half-baked tarball. On the plus side, it does pass on the buildbot....",
    "created_at": "2017-11-29T00:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355683",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:84'></a>Release or not release, that is the question ;-)

I'm hesitant to ship some half-baked tarball. On the plus side, it does pass on the buildbot....



---

archive/issue_comments_355684.json:
```json
{
    "body": "<a id='comment:85'></a>I have followed the master tarball baker's instructions, as close as  I could, short of writing my own cookbook, that is.\nIf you really insist I could write a hacky spkg-src, although I would rather not at this  point.",
    "created_at": "2017-11-29T00:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355684",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:85'></a>I have followed the master tarball baker's instructions, as close as  I could, short of writing my own cookbook, that is.
If you really insist I could write a hacky spkg-src, although I would rather not at this  point.



---

archive/issue_comments_355685.json:
```json
{
    "body": "<a id='comment:86'></a>Replying to [comment:84 vbraun]:\n> Release or not release, that is the question ;-)\n> \n> I'm hesitant to ship some half-baked tarball. On the plus side, it does pass on the buildbot....\n\n\nI understand the hesitancy, especially since this change includes a bunch of additional changes to mpir between 3.0.0 and master.  But Skylake + OS X seems like a fairly common combination: it would be good to be able to build Sage again on my machine.",
    "created_at": "2017-11-29T00:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355685",
    "user": "https://github.com/roed314"
}
```

<a id='comment:86'></a>Replying to [comment:84 vbraun]:
> Release or not release, that is the question ;-)
> 
> I'm hesitant to ship some half-baked tarball. On the plus side, it does pass on the buildbot....


I understand the hesitancy, especially since this change includes a bunch of additional changes to mpir between 3.0.0 and master.  But Skylake + OS X seems like a fairly common combination: it would be good to be able to build Sage again on my machine.



---

archive/issue_comments_355686.json:
```json
{
    "body": "<a id='comment:87'></a>Replying to [comment:82 dimpase]:\n> I am sure anyone with an idea on how mpir tarballs are made will manage to reproduce this.\n\n\nThat's essentially a tautology. This docs are not for the people \"with an idea on how mpir tarballs are made\". They are for the people without such an idea.",
    "created_at": "2017-11-29T08:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355686",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:87'></a>Replying to [comment:82 dimpase]:
> I am sure anyone with an idea on how mpir tarballs are made will manage to reproduce this.


That's essentially a tautology. This docs are not for the people "with an idea on how mpir tarballs are made". They are for the people without such an idea.



---

archive/issue_comments_355687.json:
```json
{
    "body": "<a id='comment:88'></a>Replying to [comment:82 dimpase]:\n> Perhaps you have not had a look at the commit I mention? There are files to edit\n\n\nYou mean the files edited on that commit? Most of that seems to be related to changing the version number. That shouldn't be needed here. \n\n> scripts to run\n\n\nYou mean `autogen.sh`? But Bill says (in a comment on that commit) that this might not work...\n\n> and it is outdated.\n\n\nIn that case, it can serve even less as documentation.",
    "created_at": "2017-11-29T14:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355687",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:88'></a>Replying to [comment:82 dimpase]:
> Perhaps you have not had a look at the commit I mention? There are files to edit


You mean the files edited on that commit? Most of that seems to be related to changing the version number. That shouldn't be needed here. 

> scripts to run


You mean `autogen.sh`? But Bill says (in a comment on that commit) that this might not work...

> and it is outdated.


In that case, it can serve even less as documentation.



---

archive/issue_comments_355688.json:
```json
{
    "body": "<a id='comment:89'></a>Replying to [comment:75 dimpase]:\n> I tried created a patch against 3.0.0, but it would have been magabytes in size and a lot of time to create.\n\n\nWhy would running `git diff commit1 commit2` take a lot of time?\n\nAnd why would it be so large? Are there any auto-generated files in the git repo?",
    "created_at": "2017-11-29T14:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355688",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:89'></a>Replying to [comment:75 dimpase]:
> I tried created a patch against 3.0.0, but it would have been magabytes in size and a lot of time to create.


Why would running `git diff commit1 commit2` take a lot of time?

And why would it be so large? Are there any auto-generated files in the git repo?



---

archive/issue_comments_355689.json:
```json
{
    "body": "<a id='comment:90'></a>Replying to [comment:89 jdemeyer]:\n> Replying to [comment:75 dimpase]:\n> > I tried created a patch against 3.0.0, but it would have been magabytes in size and a lot of time to create.\n\n> \n> Why would running `git diff commit1 commit2` take a lot of time?\n\n\nbecause many patches created this way do not apply to the 3.0.0 branch.\nAnd there was about 80 patches to look at.\nI have better things to do than manually deal with 80 non-applying patches.",
    "created_at": "2017-11-29T14:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355689",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:90'></a>Replying to [comment:89 jdemeyer]:
> Replying to [comment:75 dimpase]:
> > I tried created a patch against 3.0.0, but it would have been magabytes in size and a lot of time to create.

> 
> Why would running `git diff commit1 commit2` take a lot of time?


because many patches created this way do not apply to the 3.0.0 branch.
And there was about 80 patches to look at.
I have better things to do than manually deal with 80 non-applying patches.



---

archive/issue_comments_355690.json:
```json
{
    "body": "<a id='comment:91'></a>And they are big, big, as may of them involve big changes to assembler code, or just new assembler code, not in 3.0.0.\n\nEven my changes to the assembler code run into many thousands of lines\n(they are almost all about renaming jumplabels, though).",
    "created_at": "2017-11-29T14:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355690",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:91'></a>And they are big, big, as may of them involve big changes to assembler code, or just new assembler code, not in 3.0.0.

Even my changes to the assembler code run into many thousands of lines
(they are almost all about renaming jumplabels, though).



---

archive/issue_comments_355691.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:90 dimpase]:\n> because many patches created this way do not apply to the 3.0.0 branch.\n\n\nIf you diff against the 3.0.0 branch, they will surely apply.",
    "created_at": "2017-11-29T14:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355691",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:92'></a>Replying to [comment:90 dimpase]:
> because many patches created this way do not apply to the 3.0.0 branch.


If you diff against the 3.0.0 branch, they will surely apply.



---

archive/issue_comments_355692.json:
```json
{
    "body": "<a id='comment:93'></a>Replying to [comment:88 jdemeyer]:\n> Replying to [comment:82 dimpase]:\n> > Perhaps you have not had a look at the commit I mention? There are files to edit\n\n> \n> You mean the files edited on that commit? Most of that seems to be related to changing the version number. That shouldn't be needed here. \n\n\nI don't understand. We need to bump up version numbers of the package, and of the libraries built.\n \n> \n> > scripts to run\n\n> \n> You mean `autogen.sh`? But Bill says (in a comment on that commit) that this might not work...\n\n\n\nOh Holy Jesus, I have done a job. It is a unique one-off job, why do you want a full\ndocumentation of the process? Nobody won't need to redo it, ever.\nA new way of making MPIR releases is underway.\n\n> \n> > and it is outdated.\n\n> \n> In that case, it can serve even less as documentation.\n\nYou do not need this documentation, noone needs it. See above.",
    "created_at": "2017-11-29T14:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355692",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:93'></a>Replying to [comment:88 jdemeyer]:
> Replying to [comment:82 dimpase]:
> > Perhaps you have not had a look at the commit I mention? There are files to edit

> 
> You mean the files edited on that commit? Most of that seems to be related to changing the version number. That shouldn't be needed here. 


I don't understand. We need to bump up version numbers of the package, and of the libraries built.
 
> 
> > scripts to run

> 
> You mean `autogen.sh`? But Bill says (in a comment on that commit) that this might not work...



Oh Holy Jesus, I have done a job. It is a unique one-off job, why do you want a full
documentation of the process? Nobody won't need to redo it, ever.
A new way of making MPIR releases is underway.

> 
> > and it is outdated.

> 
> In that case, it can serve even less as documentation.

You do not need this documentation, noone needs it. See above.



---

archive/issue_comments_355693.json:
```json
{
    "body": "<a id='comment:94'></a>Replying to [comment:92 jdemeyer]:\n> Replying to [comment:90 dimpase]:\n> > because many patches created this way do not apply to the 3.0.0 branch.\n\n> \n> If you diff against the 3.0.0 branch, they will surely apply.\n\n\nWhatever. You will not want to review these megabytes.\n\nWhat is the problem? I do solemnly swear that I do not work for any 3-letter orgs, and I have not sneaked in anything dodgy.",
    "created_at": "2017-11-29T14:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355693",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:94'></a>Replying to [comment:92 jdemeyer]:
> Replying to [comment:90 dimpase]:
> > because many patches created this way do not apply to the 3.0.0 branch.

> 
> If you diff against the 3.0.0 branch, they will surely apply.


Whatever. You will not want to review these megabytes.

What is the problem? I do solemnly swear that I do not work for any 3-letter orgs, and I have not sneaked in anything dodgy.



---

archive/issue_comments_355694.json:
```json
{
    "body": "<a id='comment:95'></a>Replying to [comment:94 dimpase]:\n> What is the problem?\n\n\nI see at least these issues:\n\n(A) you could have done some wrong in creating the tarball, subtly breaking it somehow. Usually, when I review a ticket creating a custom tarball, then checking the tarball distribution process is part of the review because things can go wrong there.\n\n(B) distros will not be happy to package this unofficial version of MPIR (see [ODK D3.10](https://github.com/OpenDreamKit/OpenDreamKit/issues/59)). If the changes only involve Skylake support, then there is no issue here. However, you seem to imply that there are a lot of other unrelated changes too.",
    "created_at": "2017-11-29T15:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355694",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:95'></a>Replying to [comment:94 dimpase]:
> What is the problem?


I see at least these issues:

(A) you could have done some wrong in creating the tarball, subtly breaking it somehow. Usually, when I review a ticket creating a custom tarball, then checking the tarball distribution process is part of the review because things can go wrong there.

(B) distros will not be happy to package this unofficial version of MPIR (see [ODK D3.10](https://github.com/OpenDreamKit/OpenDreamKit/issues/59)). If the changes only involve Skylake support, then there is no issue here. However, you seem to imply that there are a lot of other unrelated changes too.



---

archive/issue_comments_355695.json:
```json
{
    "body": "<a id='comment:96'></a>Distros use gmp not mpir in the general case. Otherwise I may have complained too. Sometimes it is hard to isolate the changes you want, so long as nothing else but skylake om OS X is affected (in that they now build) then this is neutral.\n\nIf it changes doctests and behavior, then sure it is not neutral and things become very hard. But it is not the case here I believe.",
    "created_at": "2017-11-29T17:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355695",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:96'></a>Distros use gmp not mpir in the general case. Otherwise I may have complained too. Sometimes it is hard to isolate the changes you want, so long as nothing else but skylake om OS X is affected (in that they now build) then this is neutral.

If it changes doctests and behavior, then sure it is not neutral and things become very hard. But it is not the case here I believe.



---

archive/issue_comments_355696.json:
```json
{
    "body": "<a id='comment:97'></a>The diff between the MPIR 3.0.0 and the current master is about 700K in size, or which about 50% is various Windows-only stuff and can be ignored, but the rest is still many times bigger than any other Sage patch (and commit by commit it is much bigger, still).\nFurther untangling this to make patch smaller is not something we should spend time on, I think.\n\nThis makes (B) pretty much unfixable. As to (A), well, as Volker says, buildbots are happy with the tarball.\nI attach the git diff between the MPIR master and the tarball (this is naturally only the git-tracked files that show in that very small patch; one naturally can get the rest by running ./autogen)",
    "created_at": "2017-11-29T22:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355696",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:97'></a>The diff between the MPIR 3.0.0 and the current master is about 700K in size, or which about 50% is various Windows-only stuff and can be ignored, but the rest is still many times bigger than any other Sage patch (and commit by commit it is much bigger, still).
Further untangling this to make patch smaller is not something we should spend time on, I think.

This makes (B) pretty much unfixable. As to (A), well, as Volker says, buildbots are happy with the tarball.
I attach the git diff between the MPIR master and the tarball (this is naturally only the git-tracked files that show in that very small patch; one naturally can get the rest by running ./autogen)



---

archive/issue_comments_355697.json:
```json
{
    "body": "the tarball vs the MPIR master",
    "created_at": "2017-11-29T22:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355697",
    "user": "https://github.com/dimpase"
}
```

the tarball vs the MPIR master



---

archive/issue_comments_355698.json:
```json
{
    "body": "<a id='comment:98'></a>Attachment [01.patch](tarball://root/attachments/some-uuid/ticket24085/01.patch) by git created at 2017-11-29 23:13:20\n\nBranch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-29T23:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:98'></a>Attachment [01.patch](tarball://root/attachments/some-uuid/ticket24085/01.patch) by git created at 2017-11-29 23:13:20

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_355699.json:
```json
{
    "body": "<a id='comment:99'></a>Replying to [comment:93 dimpase]:\n> > You mean `autogen.sh`? But Bill says (in a comment on that commit) that this might not work...\n\n> \n> \n> Oh Holy Jesus, I have done a job. It is a unique one-off job, why do you want a full\n> documentation of the process?\n\n\nWhy so offensive? You say that you did X and Bill isn't sure whether X will work. Given that the official maintainer of MPIR questions your procedure, I feel that I am right to ask this question.",
    "created_at": "2017-11-30T08:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355699",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:99'></a>Replying to [comment:93 dimpase]:
> > You mean `autogen.sh`? But Bill says (in a comment on that commit) that this might not work...

> 
> 
> Oh Holy Jesus, I have done a job. It is a unique one-off job, why do you want a full
> documentation of the process?


Why so offensive? You say that you did X and Bill isn't sure whether X will work. Given that the official maintainer of MPIR questions your procedure, I feel that I am right to ask this question.



---

archive/issue_comments_355700.json:
```json
{
    "body": "<a id='comment:0'></a>Anyway, let me try to recreate the tarball (without the patch, we don't need that).",
    "created_at": "2017-11-30T08:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355700",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:0'></a>Anyway, let me try to recreate the tarball (without the patch, we don't need that).



---

archive/issue_comments_355701.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-30T09:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355701",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_355702.json:
```json
{
    "body": "<a id='comment:102'></a>Replying to [comment:100 jdemeyer]:\n> Anyway, let me try to recreate the tarball (without the patch, we don't need that).\n\n\nWhy? Surely distributions need libraries' versions to be bumped up.",
    "created_at": "2017-11-30T09:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355702",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:102'></a>Replying to [comment:100 jdemeyer]:
> Anyway, let me try to recreate the tarball (without the patch, we don't need that).


Why? Surely distributions need libraries' versions to be bumped up.



---

archive/issue_comments_355703.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-30T09:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355703",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_355704.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,\n \n+> We know what the problem is now, but don't have a working patch to fix it.\n+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work\n+> on 64 bit OSX. Details of the issue can be found\n+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).\n+\n+\n+In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   \n+\n+**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.tar.bz2\n \n Upstream: Workaround found; Bug reported upstream.\n \n```\n",
    "created_at": "2017-11-30T09:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355704",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+As discussed on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/P4GtTf2zo8k), mpir does not build on Skylake chips. As reported by Bill Hart,
 
+> We know what the problem is now, but don't have a working patch to fix it.
+> It's the JMPENT macro in mpn/x86_64/x86_64-defs.m4 that doesn't work
+> on 64 bit OSX. Details of the issue can be found
+> [here](https://gmplib.org/list-archives/gmp-bugs/2012-December/002836.html).
+
+
+In the end, the fix was to edit jump labels in a (large) number of MPIR's asm files, and change the `.section` type of jumptables, while leaving `JMPENT` macros intact. The changes are way too big for Sage patches (and done against the master rather than against meanwhile a bit outdated 3.0.0 version), thus a new tarball.   
+
+**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.tar.bz2
 
 Upstream: Workaround found; Bug reported upstream.
 
```




---

archive/issue_comments_355705.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2017-11-30T09:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355705",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_355706.json:
```json
{
    "body": "<a id='comment:105'></a>Replying to [comment:98 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                                    |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n> |[9764442](https://git.sagemath.org/sage.git/commit/?id=9764442aa3bddc303a32ccc808c80c96a3130bc4)|`simplified detailed instruction to produce tarball`|\n\n\nThat wasn't so hard. I put those instructions in a `spkg-src` script and created a new tarball using that script.\n\nPlease review.",
    "created_at": "2017-11-30T09:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355706",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:105'></a>Replying to [comment:98 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                                    |
> |-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
> |[9764442](https://git.sagemath.org/sage.git/commit/?id=9764442aa3bddc303a32ccc808c80c96a3130bc4)|`simplified detailed instruction to produce tarball`|


That wasn't so hard. I put those instructions in a `spkg-src` script and created a new tarball using that script.

Please review.



---

archive/issue_comments_355707.json:
```json
{
    "body": "<a id='comment:106'></a>Replying to [comment:102 dimpase]:\n> Why? Surely distributions need libraries' versions to be bumped up.\n\n\nThis is answered adequately in [comment:96]",
    "created_at": "2017-11-30T09:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355707",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:106'></a>Replying to [comment:102 dimpase]:
> Why? Surely distributions need libraries' versions to be bumped up.


This is answered adequately in [comment:96]



---

archive/issue_comments_355708.json:
```json
{
    "body": "<a id='comment:7'></a>Please also remove `mpir.net/` from the tarball.",
    "created_at": "2017-11-30T09:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355708",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Please also remove `mpir.net/` from the tarball.



---

archive/issue_comments_355709.json:
```json
{
    "body": "<a id='comment:108'></a>Replying to [comment:106 jdemeyer]:\n> Replying to [comment:102 dimpase]:\n> > Why? Surely distributions need libraries' versions to be bumped up.\n\n> \n> This is answered adequately in [comment:96]\n\n\nnot really - we are shipping 350K of diffs to MPIR 3.0.0, not a little skylake/OSX-only fix.",
    "created_at": "2017-11-30T09:57:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355709",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:108'></a>Replying to [comment:106 jdemeyer]:
> Replying to [comment:102 dimpase]:
> > Why? Surely distributions need libraries' versions to be bumped up.

> 
> This is answered adequately in [comment:96]


not really - we are shipping 350K of diffs to MPIR 3.0.0, not a little skylake/OSX-only fix.



---

archive/issue_comments_355710.json:
```json
{
    "body": "<a id='comment:109'></a>Replying to [comment:107 dimpase]:\n> Please also remove `mpir.net/` from the tarball.\n\n\nThat wasn't in your instructions :-)",
    "created_at": "2017-11-30T10:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355710",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:109'></a>Replying to [comment:107 dimpase]:
> Please also remove `mpir.net/` from the tarball.


That wasn't in your instructions :-)



---

archive/issue_comments_355711.json:
```json
{
    "body": "<a id='comment:110'></a>Replying to [comment:107 dimpase]:\n> Please also remove `mpir.net/` from the tarball.\n\n\nI don't know what you mean... there is no such file/directory in the tarball.",
    "created_at": "2017-11-30T10:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355711",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:110'></a>Replying to [comment:107 dimpase]:
> Please also remove `mpir.net/` from the tarball.


I don't know what you mean... there is no such file/directory in the tarball.



---

archive/issue_comments_355712.json:
```json
{
    "body": "<a id='comment:111'></a>Replying to [comment:110 jdemeyer]:\n> Replying to [comment:107 dimpase]:\n> > Please also remove `mpir.net/` from the tarball.\n\n> \n> I don't know what you mean... there is no such file/directory in the tarball.\n\nOK, sorry - I actually did it the other way around:\nremoved directories and edited the dist target of the makefile\nand ran make dist only then. I didn't notice they don't package mpir.net.",
    "created_at": "2017-11-30T10:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355712",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:111'></a>Replying to [comment:110 jdemeyer]:
> Replying to [comment:107 dimpase]:
> > Please also remove `mpir.net/` from the tarball.

> 
> I don't know what you mean... there is no such file/directory in the tarball.

OK, sorry - I actually did it the other way around:
removed directories and edited the dist target of the makefile
and ran make dist only then. I didn't notice they don't package mpir.net.



---

archive/issue_comments_355713.json:
```json
{
    "body": "<a id='comment:2'></a>Well, I tried to follow your instructions as literally as possible (apart from changing the version number)...",
    "created_at": "2017-11-30T10:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355713",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Well, I tried to follow your instructions as literally as possible (apart from changing the version number)...



---

archive/issue_comments_355714.json:
```json
{
    "body": "<a id='comment:113'></a>Replying to [comment:112 jdemeyer]:\n> Well, I tried to follow your instructions as literally as possible (apart from changing the version number)...\n\nI can only say https://github.com/wbhart/mpir/issues/237",
    "created_at": "2017-11-30T10:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355714",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:113'></a>Replying to [comment:112 jdemeyer]:
> Well, I tried to follow your instructions as literally as possible (apart from changing the version number)...

I can only say https://github.com/wbhart/mpir/issues/237



---

archive/issue_comments_355715.json:
```json
{
    "body": "<a id='comment:114'></a>Replying to [comment:102 dimpase]:\n> Why? Surely distributions need libraries' versions to be bumped up.\n\n\nDistributions are not going to ship this tarball anyway. So it is simply not relevant.",
    "created_at": "2017-11-30T10:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355715",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:114'></a>Replying to [comment:102 dimpase]:
> Why? Surely distributions need libraries' versions to be bumped up.


Distributions are not going to ship this tarball anyway. So it is simply not relevant.



---

archive/issue_comments_355716.json:
```json
{
    "body": "<a id='comment:115'></a>Replying to [comment:114 jdemeyer]:\n> Replying to [comment:102 dimpase]:\n> > Why? Surely distributions need libraries' versions to be bumped up.\n\n> \n> Distributions are not going to ship this tarball anyway. So it is simply not relevant.\n\n\nI think it is relevant, as it's simply misleading not to bump up versions in this case.",
    "created_at": "2017-11-30T11:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355716",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:115'></a>Replying to [comment:114 jdemeyer]:
> Replying to [comment:102 dimpase]:
> > Why? Surely distributions need libraries' versions to be bumped up.

> 
> Distributions are not going to ship this tarball anyway. So it is simply not relevant.


I think it is relevant, as it's simply misleading not to bump up versions in this case.



---

archive/issue_comments_355717.json:
```json
{
    "body": "<a id='comment:116'></a>Replying to [comment:115 dimpase]:\n> I think it is relevant, as it's simply misleading not to bump up versions in this case.\n\n\nWe typically do not change `.so` version numbers if we patch. And the difference between adding a patch or using a new tarball is purely technical. So if we don't change versions for patches, we shouldn't change the version number for this either.",
    "created_at": "2017-11-30T11:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355717",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:116'></a>Replying to [comment:115 dimpase]:
> I think it is relevant, as it's simply misleading not to bump up versions in this case.


We typically do not change `.so` version numbers if we patch. And the difference between adding a patch or using a new tarball is purely technical. So if we don't change versions for patches, we shouldn't change the version number for this either.



---

archive/issue_comments_355718.json:
```json
{
    "body": "<a id='comment:7'></a>this is not a typical case. we basically do a prerelease of 3.0.1 here. the difference is too big to be a patch.",
    "created_at": "2017-11-30T11:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355718",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>this is not a typical case. we basically do a prerelease of 3.0.1 here. the difference is too big to be a patch.



---

archive/issue_comments_355719.json:
```json
{
    "body": "<a id='comment:8'></a>I think I should have been clearer about two things: Firstly, I (Bill) am not performing all the functions of an official maintainer any more. I am merely accepting pull requests on [GitHub](GitHub), uploading tarballs to the website and answering questions as the community takes over the project. Secondly, I did not promise to \"do\" a new release. I said that I think a new release is the best way forward and that I am happy to advise on how to accomplish that.\n\nMore specifically, I think a patch release to fix some of the issues with the previous release is in order here. This includes all updates to the Windows build files that Brian Gladman has made, the inclusion of mpir.net, which was accidentally left out of the last tarball. And there have also been some additional patches merged to fix various reported issues, which I accepted since the last release.\n\nThe new release should be called 3.0.1. There is no reason to go through an alpha/beta cycle for a patch release, so long as everything is passing on Travis/Appveyor and the bugs that are meant to be fixed are confirmed to be fixed (which appears to be the case).\n\nThe steps remaining for a release are: checking that all FSF copyright notices were updated correctly by Dima (i.e. review), update the Changelog, NEWS, Authors, change the version and .so numbers, make the tarballs, test them on at least one Linux machine and ask Brian to test them on a Windows box, and at least make a brief announcement on mpir-devel about the release and what it is for. I will put the tarballs up on the website, update the website and accept any PR's needed.\n\nWe cannot do a full (minor) release, since Flint is broken on Windows due to changes that were made to the interface in the last release, and this needs fixing. Also, Jens Nurmann and David Cleaver were working on Broadwell support. I think I have some patches from them that would need to go into a minor release to support Broadwell, but this includes a nontrivial amount of work, since the patches would need to be tested and profiled to check they are faster than what was there (Jens did not have access to a Broadwell machine). Also, there is a slowdown reported by someone that Jens Nurmann tried to fix, but the original person who reported it produced a better fix. I don't know the status of this, since I have not heard anything about it since. But those are the current blockers for a new minor release of MPIR, which is why I would advocate doing a patch release for Sage (update to 3.0.1) instead of a minor release (update to 3.1.0).",
    "created_at": "2017-11-30T19:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355719",
    "user": "https://trac.sagemath.org/admin/accounts/users/wbhart"
}
```

<a id='comment:8'></a>I think I should have been clearer about two things: Firstly, I (Bill) am not performing all the functions of an official maintainer any more. I am merely accepting pull requests on [GitHub](GitHub), uploading tarballs to the website and answering questions as the community takes over the project. Secondly, I did not promise to "do" a new release. I said that I think a new release is the best way forward and that I am happy to advise on how to accomplish that.

More specifically, I think a patch release to fix some of the issues with the previous release is in order here. This includes all updates to the Windows build files that Brian Gladman has made, the inclusion of mpir.net, which was accidentally left out of the last tarball. And there have also been some additional patches merged to fix various reported issues, which I accepted since the last release.

The new release should be called 3.0.1. There is no reason to go through an alpha/beta cycle for a patch release, so long as everything is passing on Travis/Appveyor and the bugs that are meant to be fixed are confirmed to be fixed (which appears to be the case).

The steps remaining for a release are: checking that all FSF copyright notices were updated correctly by Dima (i.e. review), update the Changelog, NEWS, Authors, change the version and .so numbers, make the tarballs, test them on at least one Linux machine and ask Brian to test them on a Windows box, and at least make a brief announcement on mpir-devel about the release and what it is for. I will put the tarballs up on the website, update the website and accept any PR's needed.

We cannot do a full (minor) release, since Flint is broken on Windows due to changes that were made to the interface in the last release, and this needs fixing. Also, Jens Nurmann and David Cleaver were working on Broadwell support. I think I have some patches from them that would need to go into a minor release to support Broadwell, but this includes a nontrivial amount of work, since the patches would need to be tested and profiled to check they are faster than what was there (Jens did not have access to a Broadwell machine). Also, there is a slowdown reported by someone that Jens Nurmann tried to fix, but the original person who reported it produced a better fix. I don't know the status of this, since I have not heard anything about it since. But those are the current blockers for a new minor release of MPIR, which is why I would advocate doing a patch release for Sage (update to 3.0.1) instead of a minor release (update to 3.1.0).



---

archive/issue_comments_355720.json:
```json
{
    "body": "<a id='comment:9'></a>OK, I am actually OK with Jeroen's version, as he's certainly more stubborn than me.\nWe probably should arrange for another way to resolve this between us, like riding an wielertoerist version of Ronde van Vlaanderen and see who wins ;-)\n  \nThe only complaint is that the tarball name is way too long, the longest in upstream/. For all practical purposes it would be fine to shorten the commit string in PACKAGEVERSION to the first 7 characters.",
    "created_at": "2017-11-30T19:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355720",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>OK, I am actually OK with Jeroen's version, as he's certainly more stubborn than me.
We probably should arrange for another way to resolve this between us, like riding an wielertoerist version of Ronde van Vlaanderen and see who wins ;-)
  
The only complaint is that the tarball name is way too long, the longest in upstream/. For all practical purposes it would be fine to shorten the commit string in PACKAGEVERSION to the first 7 characters.



---

archive/issue_comments_355721.json:
```json
{
    "body": "<a id='comment:120'></a>Replying to [comment:117 dimpase]:\n> this is not a typical case. we basically do a prerelease of 3.0.1 here.\n\n\nI don't think that we are in a position to call something a prerelease of 3.0.1. Who knows how that version will look like or whether there will even be such a version.",
    "created_at": "2017-11-30T20:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:120'></a>Replying to [comment:117 dimpase]:
> this is not a typical case. we basically do a prerelease of 3.0.1 here.


I don't think that we are in a position to call something a prerelease of 3.0.1. Who knows how that version will look like or whether there will even be such a version.



---

archive/issue_comments_355722.json:
```json
{
    "body": "<a id='comment:1'></a>So are we good?\n\nIf Bill wants to release a 3.0.1 in the future then we shouldn't produce a 3.0.1 ourselves, this one should be obvious.",
    "created_at": "2017-11-30T22:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355722",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>So are we good?

If Bill wants to release a 3.0.1 in the future then we shouldn't produce a 3.0.1 ourselves, this one should be obvious.



---

archive/issue_comments_355723.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-30T23:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355723",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_355724.json:
```json
{
    "body": "<a id='comment:2'></a>OK, let it have the longest tarball name in Sage history :-)",
    "created_at": "2017-11-30T23:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355724",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>OK, let it have the longest tarball name in Sage history :-)



---

archive/issue_comments_355725.json:
```json
{
    "body": "<a id='comment:3'></a>Volker, is this merged?",
    "created_at": "2017-12-02T14:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355725",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>Volker, is this merged?



---

archive/issue_comments_355726.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-02T14:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355726",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061161.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-02T14:53:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24085#event-61161"
}
```



---

archive/issue_comments_355727.json:
```json
{
    "body": "<a id='comment:5'></a>yes, its all good",
    "created_at": "2017-12-02T14:55:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24085",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24085#issuecomment-355727",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>yes, its all good
