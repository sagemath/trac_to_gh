# Issue 24686: Integration of piecewise analytic complex functions using arb

archive/issues_024449.json:
```json
{
    "body": "\n\nCC:  @fredrik-johansson @videlec @cheuberg\n\nKeywords: thursdaysbdx\n\nReviewer: Vincent Delecroix\n\nAuthor: Vincent Delecroix, Fredrik Johansson, Marc Mezzarobba\n\nBranch: 251ca50cbaae8e3750759ef62893c818c1243d65\n\nDependencies: #24369\n\nCommit: 251ca50cbaae8e3750759ef62893c818c1243d65\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24686\n\n",
    "closed_at": "2018-02-20T23:08:22Z",
    "created_at": "2018-02-07T16:58:07Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Integration of piecewise analytic complex functions using arb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24686",
    "user": "https://github.com/mezzarobba"
}
```


CC:  @fredrik-johansson @videlec @cheuberg

Keywords: thursdaysbdx

Reviewer: Vincent Delecroix

Author: Vincent Delecroix, Fredrik Johansson, Marc Mezzarobba

Branch: 251ca50cbaae8e3750759ef62893c818c1243d65

Dependencies: #24369

Commit: 251ca50cbaae8e3750759ef62893c818c1243d65

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24686





---

archive/issue_comments_342540.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-02-07T17:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342540",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_342541.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-07T17:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342541",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342542.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-07T17:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342543.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T07:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342544.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-08T08:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342545.json:
```json
{
    "body": "<a id='comment:7'></a>Sorry, I wrongly included a commit from another ticket... cleaner now!",
    "created_at": "2018-02-08T08:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342545",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>Sorry, I wrongly included a commit from another ticket... cleaner now!



---

archive/issue_comments_342546.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2018-02-08T10:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342546",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_342547.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T16:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342548.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T16:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342549.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T17:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342550.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T17:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342551.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-09T17:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342551",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342552.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T17:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342553.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T17:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342554.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-09T21:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342555.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-09T23:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342556.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-10T12:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342557.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-12T09:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342558.json:
```json
{
    "body": "<a id='comment:21'></a>I am not sure it is wise to have all of\n\n```\n    cdef IntegrationContext ctx = <IntegrationContext>param\n    if ctx.exn_type is not None or order >= 2:\n        acb_indeterminate(out)\n        return 0\n    cdef ComplexBall x = ComplexBall.__new__(ComplexBall)\n    assert prec == ctx.parent._prec\n```\ninside `sig_on`/`sig_off`.",
    "created_at": "2018-02-13T19:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342558",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>I am not sure it is wise to have all of

```
    cdef IntegrationContext ctx = <IntegrationContext>param
    if ctx.exn_type is not None or order >= 2:
        acb_indeterminate(out)
        return 0
    cdef ComplexBall x = ComplexBall.__new__(ComplexBall)
    assert prec == ctx.parent._prec
```
inside `sig_on`/`sig_off`.



---

archive/issue_comments_342559.json:
```json
{
    "body": "<a id='comment:22'></a>What is the point of\n\n```\n        if isinstance(a, (RealBall, ComplexBall)):\n            ca = <ComplexBall> self(a)\n        else:\n            ca = <ComplexBall> self.coerce(a)\n```\ninstead of the direct `<ComplexBall> self.coerce(a)`?",
    "created_at": "2018-02-13T19:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342559",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>What is the point of

```
        if isinstance(a, (RealBall, ComplexBall)):
            ca = <ComplexBall> self(a)
        else:
            ca = <ComplexBall> self.coerce(a)
```
instead of the direct `<ComplexBall> self.coerce(a)`?



---

archive/issue_comments_342560.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 vdelecroix]:\n> I am not sure it is wise to have all of\n> \n> ```\n>     cdef IntegrationContext ctx = <IntegrationContext>param\n>     if ctx.exn_type is not None or order >= 2:\n>         acb_indeterminate(out)\n>         return 0\n>     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)\n>     assert prec == ctx.parent._prec\n> ```\n> inside `sig_on`/`sig_off`.\n\n\nI guess you are right, the `__new__` probably shouldn't be inside, thanks!",
    "created_at": "2018-02-14T08:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342560",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:23'></a>Replying to [comment:21 vdelecroix]:
> I am not sure it is wise to have all of
> 
> ```
>     cdef IntegrationContext ctx = <IntegrationContext>param
>     if ctx.exn_type is not None or order >= 2:
>         acb_indeterminate(out)
>         return 0
>     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)
>     assert prec == ctx.parent._prec
> ```
> inside `sig_on`/`sig_off`.


I guess you are right, the `__new__` probably shouldn't be inside, thanks!



---

archive/issue_comments_342561.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 vdelecroix]:\n> What is the point of\n> \n> ```\n>         if isinstance(a, (RealBall, ComplexBall)):\n>             ca = <ComplexBall> self(a)\n>         else:\n>             ca = <ComplexBall> self.coerce(a)\n> ```\n> instead of the direct `<ComplexBall> self.coerce(a)`?\n\n\nIt accepts balls of lower precision.",
    "created_at": "2018-02-14T08:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342561",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:24'></a>Replying to [comment:22 vdelecroix]:
> What is the point of
> 
> ```
>         if isinstance(a, (RealBall, ComplexBall)):
>             ca = <ComplexBall> self(a)
>         else:
>             ca = <ComplexBall> self.coerce(a)
> ```
> instead of the direct `<ComplexBall> self.coerce(a)`?


It accepts balls of lower precision.



---

archive/issue_comments_342562.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 mmezzarobba]:\n> Replying to [comment:22 vdelecroix]:\n> > What is the point of\n> > \n> > ```\n> >         if isinstance(a, (RealBall, ComplexBall)):\n> >             ca = <ComplexBall> self(a)\n> >         else:\n> >             ca = <ComplexBall> self.coerce(a)\n> > ```\n> > instead of the direct `<ComplexBall> self.coerce(a)`?\n\n> \n> It accepts balls of lower precision.\n\n\nDo we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?",
    "created_at": "2018-02-14T11:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342562",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>Replying to [comment:24 mmezzarobba]:
> Replying to [comment:22 vdelecroix]:
> > What is the point of
> > 
> > ```
> >         if isinstance(a, (RealBall, ComplexBall)):
> >             ca = <ComplexBall> self(a)
> >         else:
> >             ca = <ComplexBall> self.coerce(a)
> > ```
> > instead of the direct `<ComplexBall> self.coerce(a)`?

> 
> It accepts balls of lower precision.


Do we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?



---

archive/issue_comments_342563.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:23 mmezzarobba]:\n> Replying to [comment:21 vdelecroix]:\n> > I am not sure it is wise to have all of\n> > \n> > ```\n> >     cdef IntegrationContext ctx = <IntegrationContext>param\n> >     if ctx.exn_type is not None or order >= 2:\n> >         acb_indeterminate(out)\n> >         return 0\n> >     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)\n> >     assert prec == ctx.parent._prec\n> > ```\n> > inside `sig_on`/`sig_off`.\n\n> \n> I guess you are right, the `__new__` probably shouldn't be inside, thanks!\n\n\nThe cast `cdef IntegrationContext ctx = <IntegrationContext>param` and the `assert` are also concerned.",
    "created_at": "2018-02-14T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342563",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>Replying to [comment:23 mmezzarobba]:
> Replying to [comment:21 vdelecroix]:
> > I am not sure it is wise to have all of
> > 
> > ```
> >     cdef IntegrationContext ctx = <IntegrationContext>param
> >     if ctx.exn_type is not None or order >= 2:
> >         acb_indeterminate(out)
> >         return 0
> >     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)
> >     assert prec == ctx.parent._prec
> > ```
> > inside `sig_on`/`sig_off`.

> 
> I guess you are right, the `__new__` probably shouldn't be inside, thanks!


The cast `cdef IntegrationContext ctx = <IntegrationContext>param` and the `assert` are also concerned.



---

archive/issue_comments_342564.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-14T13:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342564",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342565.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 vdelecroix]:\n> Do we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?\n\n\nI think we do. It stays exactly the same ball.",
    "created_at": "2018-02-14T13:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342565",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:28'></a>Replying to [comment:25 vdelecroix]:
> Do we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?


I think we do. It stays exactly the same ball.



---

archive/issue_comments_342566.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-18T20:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342566",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342567.json:
```json
{
    "body": "<a id='comment:30'></a>I just reread the code. I believe we did enough cross review to have a decent version!",
    "created_at": "2018-02-18T20:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342567",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'></a>I just reread the code. I believe we did enough cross review to have a decent version!



---

archive/issue_events_062145.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-20T23:08:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24686#event-62145"
}
```



---

archive/issue_comments_342568.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-20T23:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24686#issuecomment-342568",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
