# Issue 24784: search_doc broken with jupyter notebook

archive/issues_024547.json:
```json
{
    "assignees": [],
    "body": "First reported at https://ask.sagemath.org/question/41170/search_doc-readable-format/. Running a command like `search_doc(\"curl\", whole_word=True)` opens a window containing garbage. On my machine, a long string that starts:\n\n```\naHRtbC9lbi9yZWZlcmVuY2UvZ2VuaW5kZXgtYWxsLmh0bWw6MTM5MTA6ICAgICAgPGxpPjxhIGhyZWY\n```\n\nThe issue is that `search_src` frequently includes the non-ascii character \"\u00b6\" in its results, and this breaks the Jupyter notebook pager. This character appears in lines without useful matches, so discard those matches.\n\nKeywords: **jupyter**\n\nBranch: **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24784_\n\n",
    "closed_at": "2018-08-26T09:38:08Z",
    "created_at": "2018-02-19T17:23:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20notebook",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "search_doc broken with jupyter notebook",
    "type": "issue",
    "updated_at": "2019-04-14T00:11:01Z",
    "url": "https://github.com/sagemath/sage/issues/24784",
    "user": "https://github.com/jhpalmieri"
}
```
First reported at https://ask.sagemath.org/question/41170/search_doc-readable-format/. Running a command like `search_doc("curl", whole_word=True)` opens a window containing garbage. On my machine, a long string that starts:

```
aHRtbC9lbi9yZWZlcmVuY2UvZ2VuaW5kZXgtYWxsLmh0bWw6MTM5MTA6ICAgICAgPGxpPjxhIGhyZWY
```

The issue is that `search_src` frequently includes the non-ascii character "¶" in its results, and this breaks the Jupyter notebook pager. This character appears in lines without useful matches, so discard those matches.

Keywords: **jupyter**

Branch: **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)**

Reviewer: **John Palmieri**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/24784_





---

archive/issue_events_313330.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-02-19T17:23:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313330"
}
```



---

archive/issue_events_313331.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-02-19T17:23:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20notebook",
    "label_color": "000080",
    "label_name": "component: notebook",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313331"
}
```



---

archive/issue_events_313332.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-02-19T17:23:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313332"
}
```



---

archive/issue_events_313333.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-02-19T17:23:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313333"
}
```



---

archive/issue_comments_379517.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThe problem is that the output from `search_doc` regularly contains non-ascii characters, like \"\u00b6\", and the IPython pager does not handle these well. We can catch the error and then remove the offending character, or we can try to skip those search matches altogether (\"Permalink to this definition: \u00b6\" is probably not a useful search result).",
    "created_at": "2018-08-20T21:30:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379517",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'>Comment 1:</a>
The problem is that the output from `search_doc` regularly contains non-ascii characters, like "¶", and the IPython pager does not handle these well. We can catch the error and then remove the offending character, or we can try to skip those search matches altogether ("Permalink to this definition: ¶" is probably not a useful search result).



---

archive/issue_comments_379518.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/search_doc_non_ascii](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/search_doc_non_ascii)**",
    "created_at": "2018-08-20T21:40:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379518",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/search_doc_non_ascii](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/search_doc_non_ascii)**



---

archive/issue_comments_379519.json:
```json
{
    "body": "Commit: **[5fef0b3](https://github.com/sagemath/sagetrac-mirror/commit/5fef0b3239f63aa523773af96d876aa4bace2220)**",
    "created_at": "2018-08-20T21:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379519",
    "user": "https://github.com/jhpalmieri"
}
```

Commit: **[5fef0b3](https://github.com/sagemath/sagetrac-mirror/commit/5fef0b3239f63aa523773af96d876aa4bace2220)**



---

archive/issue_comments_379520.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fef0b3239f63aa523773af96d876aa4bace2220\">5fef0b3</a></td><td><code>trac 24784: if the results of search_doc contain non-ascii characters,</code></td></tr></table>\n",
    "created_at": "2018-08-20T21:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379520",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fef0b3239f63aa523773af96d876aa4bace2220">5fef0b3</a></td><td><code>trac 24784: if the results of search_doc contain non-ascii characters,</code></td></tr></table>




---

archive/issue_events_313334.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-20T21:44:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313334"
}
```



---

archive/issue_comments_379521.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2018-08-20T21:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379521",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_comments_379522.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,4 +3,5 @@\n ```\n aHRtbC9lbi9yZWZlcmVuY2UvZ2VuaW5kZXgtYWxsLmh0bWw6MTM5MTA6ICAgICAgPGxpPjxhIGhyZWY\n ```\n-`search_src` works, for what that's worth.\n+\n+The issue is that `search_src` frequently includes the non-ascii character \"\u00b6\" in its results, and this breaks the Jupyter notebook pager. This character appears in lines without useful matches, so discard those matches.\n``````\n",
    "created_at": "2018-08-20T21:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379522",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,4 +3,5 @@
 ```
 aHRtbC9lbi9yZWZlcmVuY2UvZ2VuaW5kZXgtYWxsLmh0bWw6MTM5MTA6ICAgICAgPGxpPjxhIGhyZWY
 ```
-`search_src` works, for what that's worth.
+
+The issue is that `search_src` frequently includes the non-ascii character "¶" in its results, and this breaks the Jupyter notebook pager. This character appears in lines without useful matches, so discard those matches.
``````




---

archive/issue_comments_379523.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThanks much John for investigating!\nI confirm that the above search now displays non garbage with the above \nsearch on \"curl\".\n\nHowever it still break on e.g.:\n\n```\n    search_doc(\"combinat\")\n```\n\nAlso, the rendering is still not as nice as in \nthe old notebook where you get an itemized list of clickable links rather\nthan the plain text:\n\n```\nhtml/en/reference/genindex-all.html:14283:      <li><a href=\"manifolds/sage/manifolds/operators.html#sage.manifolds.operators.curl\">curl() (in module sage.manifolds.operators)</a>\nhtml/en/reference/genindex-all.html:14286:        <li><a href=\"manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.curl\">(sage.manifolds.differentiable.vectorfield.VectorField method)</a>\n```\nThis could be for a latter ticket though (to be mentioned in #25837).\n\n\nSome minor additional suggestions:\n- use `\"XXX\" not in line` rather than find\n- add a doctest",
    "created_at": "2018-08-21T07:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379523",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'>Comment 4:</a>
Thanks much John for investigating!
I confirm that the above search now displays non garbage with the above 
search on "curl".

However it still break on e.g.:

```
    search_doc("combinat")
```

Also, the rendering is still not as nice as in 
the old notebook where you get an itemized list of clickable links rather
than the plain text:

```
html/en/reference/genindex-all.html:14283:      <li><a href="manifolds/sage/manifolds/operators.html#sage.manifolds.operators.curl">curl() (in module sage.manifolds.operators)</a>
html/en/reference/genindex-all.html:14286:        <li><a href="manifolds/sage/manifolds/differentiable/vectorfield.html#sage.manifolds.differentiable.vectorfield.VectorField.curl">(sage.manifolds.differentiable.vectorfield.VectorField method)</a>
```
This could be for a latter ticket though (to be mentioned in #25837).


Some minor additional suggestions:
- use `"XXX" not in line` rather than find
- add a doctest



---

archive/issue_events_313335.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2018-08-21T07:55:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313335"
}
```



---

archive/issue_events_313336.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2018-08-21T07:55:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313336"
}
```



---

archive/issue_comments_379524.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nWhen you say \"IPython pager\" I'm confused, because I thought we were talking about the notebook.  Why would anything in the notebook not properly handle non-ASCII characters?  And if so, I think that's something we should patch upstream rather than make our output worse.  Maybe I'm missing something though.",
    "created_at": "2018-08-21T08:55:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379524",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>Comment 6:</a>
When you say "IPython pager" I'm confused, because I thought we were talking about the notebook.  Why would anything in the notebook not properly handle non-ASCII characters?  And if so, I think that's something we should patch upstream rather than make our output worse.  Maybe I'm missing something though.



---

archive/issue_comments_379525.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nNevermind; I reproduced the issue and I see it now.  Nevertheless, it's a bit surprising that this works for me fine at the command line and that it's broken in the notebook.  What's weirder is I don't know why containing non-ASCII characters should have anything to do with it.\n\nThe \"garbage\" that is displayed in the notebook is the base64-encoding of the expected output.  If I copy/paste the whole thing and wrap it in `print(base64.b64decode())`, the output from *that* displays just fine in the notebook, including the paragraph symbol.\n\nI think something a little deeper to do with IPython output formatting is going on here.  I don't think we want a hack workaround; especially since there can be non-ASCII characters in other search results, and sometimes we'll want those too.\n\n(Incidentally, the output of `search_doc` is pretty atrocious to begin with.  Why does it output all this HTML instead of searching and returning results from the plain-text docs?  What use is having search results from the auto-generated index, for that matter? Anyways,  that's a separate issue; it just surprises me every time I see it...)",
    "created_at": "2018-08-21T09:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379525",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'>Comment 7:</a>
Nevermind; I reproduced the issue and I see it now.  Nevertheless, it's a bit surprising that this works for me fine at the command line and that it's broken in the notebook.  What's weirder is I don't know why containing non-ASCII characters should have anything to do with it.

The "garbage" that is displayed in the notebook is the base64-encoding of the expected output.  If I copy/paste the whole thing and wrap it in `print(base64.b64decode())`, the output from *that* displays just fine in the notebook, including the paragraph symbol.

I think something a little deeper to do with IPython output formatting is going on here.  I don't think we want a hack workaround; especially since there can be non-ASCII characters in other search results, and sometimes we'll want those too.

(Incidentally, the output of `search_doc` is pretty atrocious to begin with.  Why does it output all this HTML instead of searching and returning results from the plain-text docs?  What use is having search results from the auto-generated index, for that matter? Anyways,  that's a separate issue; it just surprises me every time I see it...)



---

archive/issue_comments_379526.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@nthiery](#comment%3A4):\n> Also, the rendering is still not as nice as in \n> the old notebook where you get an itemized list of clickable links rather\n> than the plain text:\n\nIt seems that `search_doc` checks a global variable called `EMBEDDED_MODE`, which I guess is set somehow when running in the sage notebook.  If `EMBDEDDED_MODE` then it HTML-formats the results.  Whereas otherwise it just calls `IPython.core.page.page`.\n\nI think I might understand the problem now: Although `search_doc` contains unicode characters, it's just returning the raw UTF-8 byte strings.  Your terminal knows how to display these.  But Jupyter is just treating this as a binary blob and displaying it in the notebook as base64.  We need to instead pass an actual unicode string (I'm guessing).  Further, I need to look into whether it's possible to pass HTML to the pager in supported contexts; I wonder if it supports multi-part MIME data like other Jupyter output contexts...",
    "created_at": "2018-08-21T09:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379526",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@nthiery](#comment%3A4):
> Also, the rendering is still not as nice as in 
> the old notebook where you get an itemized list of clickable links rather
> than the plain text:

It seems that `search_doc` checks a global variable called `EMBEDDED_MODE`, which I guess is set somehow when running in the sage notebook.  If `EMBDEDDED_MODE` then it HTML-formats the results.  Whereas otherwise it just calls `IPython.core.page.page`.

I think I might understand the problem now: Although `search_doc` contains unicode characters, it's just returning the raw UTF-8 byte strings.  Your terminal knows how to display these.  But Jupyter is just treating this as a binary blob and displaying it in the notebook as base64.  We need to instead pass an actual unicode string (I'm guessing).  Further, I need to look into whether it's possible to pass HTML to the pager in supported contexts; I wonder if it supports multi-part MIME data like other Jupyter output contexts...



---

archive/issue_comments_379527.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI've almost got it working--the HTML-formatted results are currently only formatted in a way that makes sense for the legacy notebook, so it needs two formatting modes.",
    "created_at": "2018-08-21T09:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379527",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'>Comment 9:</a>
I've almost got it working--the HTML-formatted results are currently only formatted in a way that makes sense for the legacy notebook, so it needs two formatting modes.



---

archive/issue_comments_379528.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nYikes.  A `<font>` tag.",
    "created_at": "2018-08-21T09:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379528",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'>Comment 10:</a>
Yikes.  A `<font>` tag.



---

archive/issue_comments_379529.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThis is turning out to be something of a rabbit hole, as the old-style HTML-formatted results are...not great.  And as I pointed out above, broken in Jupyter, since the URLs to the results are only meaningful inside the legacy notebook.\n\nShould I attach just an interim patch for the immediate issue, and push off updating the HTML results for another ticket, or just do it all at once?",
    "created_at": "2018-08-21T10:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379529",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'>Comment 11:</a>
This is turning out to be something of a rabbit hole, as the old-style HTML-formatted results are...not great.  And as I pointed out above, broken in Jupyter, since the URLs to the results are only meaningful inside the legacy notebook.

Should I attach just an interim patch for the immediate issue, and push off updating the HTML results for another ticket, or just do it all at once?



---

archive/issue_comments_379530.json:
```json
{
    "body": "Changed commit from **[5fef0b3](https://github.com/sagemath/sagetrac-mirror/commit/5fef0b3239f63aa523773af96d876aa4bace2220)** to **[5c0d0a3](https://github.com/sagemath/sagetrac-mirror/commit/5c0d0a398cafd54072a05d534da52d4fbb9f1ab8)**",
    "created_at": "2018-08-21T11:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379530",
    "user": "https://github.com/embray"
}
```

Changed commit from **[5fef0b3](https://github.com/sagemath/sagetrac-mirror/commit/5fef0b3239f63aa523773af96d876aa4bace2220)** to **[5c0d0a3](https://github.com/sagemath/sagetrac-mirror/commit/5c0d0a398cafd54072a05d534da52d4fbb9f1ab8)**



---

archive/issue_comments_379531.json:
```json
{
    "body": "Changed author from **John Palmieri** to **John Palmieri, Erik Bray**",
    "created_at": "2018-08-21T11:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379531",
    "user": "https://github.com/embray"
}
```

Changed author from **John Palmieri** to **John Palmieri, Erik Bray**



---

archive/issue_comments_379532.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nHow's this look for a start?  Aside from a few other minor code updates this doesn't change any functionality, but just improves support for unicode text in the existing behavior.  I will create a follow-up ticket for improving the HTML-formatted search results and making them work in the Jupyter Notebook.\n\nThanks again John to pointing out in the first place that the issue had to do with unicode characters, which is what led me in the right direction.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c0d0a398cafd54072a05d534da52d4fbb9f1ab8\">5c0d0a3</a></td><td><code>Partially fixes #24784 by ensuring that text passed to the IPython pager that contains non-ASCII characters is an actual unicode text object</code></td></tr></table>\n",
    "created_at": "2018-08-21T11:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379532",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'>Comment 12:</a>
How's this look for a start?  Aside from a few other minor code updates this doesn't change any functionality, but just improves support for unicode text in the existing behavior.  I will create a follow-up ticket for improving the HTML-formatted search results and making them work in the Jupyter Notebook.

Thanks again John to pointing out in the first place that the issue had to do with unicode characters, which is what led me in the right direction.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c0d0a398cafd54072a05d534da52d4fbb9f1ab8">5c0d0a3</a></td><td><code>Partially fixes #24784 by ensuring that text passed to the IPython pager that contains non-ASCII characters is an actual unicode text object</code></td></tr></table>




---

archive/issue_events_313337.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-21T11:26:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313337"
}
```



---

archive/issue_events_313338.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-21T11:26:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313338"
}
```



---

archive/issue_comments_379533.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/search_doc_non_ascii](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/search_doc_non_ascii)** to **[u/embray/ticket-24784](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-24784)**",
    "created_at": "2018-08-21T11:26:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379533",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/jhpalmieri/search_doc_non_ascii](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/search_doc_non_ascii)** to **[u/embray/ticket-24784](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-24784)**



---

archive/issue_comments_379534.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nI created a follow-up #26104 for improving the HTML search results.",
    "created_at": "2018-08-21T11:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379534",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'>Comment 13:</a>
I created a follow-up #26104 for improving the HTML search results.



---

archive/issue_events_313339.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-21T12:03:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313339"
}
```



---

archive/issue_events_313340.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-21T12:03:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313340"
}
```



---

archive/issue_comments_379535.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n\n```\nsage: search_src('Steenrod')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n...\n\nTypeError: format_search_as_html() got an unexpected keyword argument 'whole_word'\n```\nMaybe it should be\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 2576cf9090..7b3c2630ed 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -958,8 +958,7 @@ You can build this with 'sage -docbuild {} html'.\"\"\".format(s))\n     if not interact:\n         return format_text_results()\n \n-    html_results = format_search_as_html(title, results, [string] + extras,\n-                                         whole_word=whole_word)\n+    html_results = format_search_as_html(title, results, string)\n \n     from sage.server.support import EMBEDDED_MODE\n     if EMBEDDED_MODE:\n```\n\nEdit: no, looking at the old code, you're right that we need to use `[string] + extras`. But I think `whole_word` does not belong there.",
    "created_at": "2018-08-21T17:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379535",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'>Comment 15:</a>

```
sage: search_src('Steenrod')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

...

TypeError: format_search_as_html() got an unexpected keyword argument 'whole_word'
```
Maybe it should be

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 2576cf9090..7b3c2630ed 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -958,8 +958,7 @@ You can build this with 'sage -docbuild {} html'.""".format(s))
     if not interact:
         return format_text_results()
 
-    html_results = format_search_as_html(title, results, [string] + extras,
-                                         whole_word=whole_word)
+    html_results = format_search_as_html(title, results, string)
 
     from sage.server.support import EMBEDDED_MODE
     if EMBEDDED_MODE:
```

Edit: no, looking at the old code, you're right that we need to use `[string] + extras`. But I think `whole_word` does not belong there.



---

archive/issue_comments_379536.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nI don't quite see the point behind `format_text_results`. This looks a little simpler to me:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 2576cf9090..36c5928efd 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -936,7 +936,7 @@ You can build this with 'sage -docbuild {} html'.\"\"\".format(s))\n                                 if not re.search(extra, match_list):\n                                     match_list = None\n                         if match_list:\n-                            append(filename[strip:].lstrip(\"/\"))\n+                            append(filename[strip:].lstrip(\"/\") + \"\\n\")\n                     else:\n                         match_list = [(lineno, line) for lineno, line in\n                                       enumerate(open(filename).read().splitlines(True))\n@@ -949,14 +949,9 @@ You can build this with 'sage -docbuild {} html'.\"\"\".format(s))\n                             append(':'.join([filename[strip:].lstrip(\"/\"),\n                                              str(num + 1), line]))\n \n-    def format_text_results():\n-        if multiline:\n-            return '\\n'.join(results)\n-        else:\n-            return ''.join(results)\n-\n+    text_results = ''.join(results)\n     if not interact:\n-        return format_text_results()\n+        return text_results\n \n     html_results = format_search_as_html(title, results, [string] + extras,\n                                          whole_word=whole_word)\n@@ -968,7 +963,6 @@ You can build this with 'sage -docbuild {} html'.\"\"\".format(s))\n     else:\n         # Pass through the IPython pager in a mime bundle\n         from IPython.core.page import page\n-        text_results = format_text_results()\n         if not isinstance(text_results, text_type):\n             text_results = text_results.decode('utf-8', 'replace')\n \n                                     # formatted for Jupyter use\n```\n(N.B. This diff doesn't include the previous one for `format_search_as_html`.)",
    "created_at": "2018-08-21T17:51:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379536",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'>Comment 16:</a>
I don't quite see the point behind `format_text_results`. This looks a little simpler to me:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 2576cf9090..36c5928efd 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -936,7 +936,7 @@ You can build this with 'sage -docbuild {} html'.""".format(s))
                                 if not re.search(extra, match_list):
                                     match_list = None
                         if match_list:
-                            append(filename[strip:].lstrip("/"))
+                            append(filename[strip:].lstrip("/") + "\n")
                     else:
                         match_list = [(lineno, line) for lineno, line in
                                       enumerate(open(filename).read().splitlines(True))
@@ -949,14 +949,9 @@ You can build this with 'sage -docbuild {} html'.""".format(s))
                             append(':'.join([filename[strip:].lstrip("/"),
                                              str(num + 1), line]))
 
-    def format_text_results():
-        if multiline:
-            return '\n'.join(results)
-        else:
-            return ''.join(results)
-
+    text_results = ''.join(results)
     if not interact:
-        return format_text_results()
+        return text_results
 
     html_results = format_search_as_html(title, results, [string] + extras,
                                          whole_word=whole_word)
@@ -968,7 +963,6 @@ You can build this with 'sage -docbuild {} html'.""".format(s))
     else:
         # Pass through the IPython pager in a mime bundle
         from IPython.core.page import page
-        text_results = format_text_results()
         if not isinstance(text_results, text_type):
             text_results = text_results.decode('utf-8', 'replace')
 
                                     # formatted for Jupyter use
```
(N.B. This diff doesn't include the previous one for `format_search_as_html`.)



---

archive/issue_comments_379537.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nSee also #26102 for a speed-up for `search_doc`: mainly, don't search the `_static` directories.",
    "created_at": "2018-08-21T17:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379537",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'>Comment 17:</a>
See also #26102 for a speed-up for `search_doc`: mainly, don't search the `_static` directories.



---

archive/issue_comments_379538.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nI personally find that the change `append = results.append` makes the code harder to read without much benefit, but I won't argue about it.",
    "created_at": "2018-08-21T17:54:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379538",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'>Comment 18:</a>
I personally find that the change `append = results.append` makes the code harder to read without much benefit, but I won't argue about it.



---

archive/issue_comments_379539.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nWith the legacy Sage notebook, searches with `multiline=True` don't print anything with this branch. (To get it to work at all, I removed the `whole_word=whole_word` from the call to `format_results_as_html`, but I made no other changes.) It also prints the output in a slightly funny way: when I evaluate `search_src('Steenrod', multiline=True)`, the old header said `Search Source Code: \"Steenrod\"`. The new header says `Search Source Code: \"Steenrod\", \"\", \"\", \"\", \"\", \"\"` \u2013 it's printing the `extra` terms separately. I can upload screenshots if you want. This is not the highest priority since we're working on deprecating the legacy notebook, but I suppose we shouldn't actively make things worse for it.",
    "created_at": "2018-08-21T18:24:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379539",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'>Comment 19:</a>
With the legacy Sage notebook, searches with `multiline=True` don't print anything with this branch. (To get it to work at all, I removed the `whole_word=whole_word` from the call to `format_results_as_html`, but I made no other changes.) It also prints the output in a slightly funny way: when I evaluate `search_src('Steenrod', multiline=True)`, the old header said `Search Source Code: "Steenrod"`. The new header says `Search Source Code: "Steenrod", "", "", "", "", ""` – it's printing the `extra` terms separately. I can upload screenshots if you want. This is not the highest priority since we're working on deprecating the legacy notebook, but I suppose we shouldn't actively make things worse for it.



---

archive/issue_events_313341.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-21T18:25:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313341"
}
```



---

archive/issue_events_313342.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-21T18:25:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313342"
}
```



---

archive/issue_comments_379540.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nOops, I left in a change that I meant to omit (I had started down a path down #26104 but decided to separate off those changes).  That's where all of those reported problems came from.",
    "created_at": "2018-08-22T09:10:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379540",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'>Comment 21:</a>
Oops, I left in a change that I meant to omit (I had started down a path down #26104 but decided to separate off those changes).  That's where all of those reported problems came from.



---

archive/issue_comments_379541.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@jhpalmieri](#comment%3A16):\n> I don't quite see the point behind `format_text_results`. This looks a little simpler to me:\n\nI think that's probably fine , yeah.  I think when I first added that I didn't fully understand what was going on with `if multiline`.  This code is still a bit confusing in general and should probably be rewritten but that's for another time.",
    "created_at": "2018-08-22T09:13:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379541",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@jhpalmieri](#comment%3A16):
> I don't quite see the point behind `format_text_results`. This looks a little simpler to me:

I think that's probably fine , yeah.  I think when I first added that I didn't fully understand what was going on with `if multiline`.  This code is still a bit confusing in general and should probably be rewritten but that's for another time.



---

archive/issue_comments_379542.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@jhpalmieri](#comment%3A18):\n> I personally find that the change `append = results.append` makes the code harder to read without much benefit, but I won't argue about it.\n\nThis can be a useful optimization in a loop, but in retrospect it will only be called in this case where there is a search match, which is relatively infrequent, so I agree there's not much benefit in this case.",
    "created_at": "2018-08-22T09:20:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379542",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@jhpalmieri](#comment%3A18):
> I personally find that the change `append = results.append` makes the code harder to read without much benefit, but I won't argue about it.

This can be a useful optimization in a loop, but in retrospect it will only be called in this case where there is a search match, which is relatively infrequent, so I agree there's not much benefit in this case.



---

archive/issue_comments_379543.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7c4a65a210ee254f1ee8724145954ef245aef8c\">f7c4a65</a></td><td><code>Partially fixes #24784 by ensuring that text passed to the IPython pager that contains non-ASCII characters is an actual unicode text object</code></td></tr></table>\n",
    "created_at": "2018-08-22T09:24:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379543",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>Comment 24:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7c4a65a210ee254f1ee8724145954ef245aef8c">f7c4a65</a></td><td><code>Partially fixes #24784 by ensuring that text passed to the IPython pager that contains non-ASCII characters is an actual unicode text object</code></td></tr></table>




---

archive/issue_comments_379544.json:
```json
{
    "body": "Changed commit from **[5c0d0a3](https://github.com/sagemath/sagetrac-mirror/commit/5c0d0a398cafd54072a05d534da52d4fbb9f1ab8)** to **[f7c4a65](https://github.com/sagemath/sagetrac-mirror/commit/f7c4a65a210ee254f1ee8724145954ef245aef8c)**",
    "created_at": "2018-08-22T09:24:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379544",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5c0d0a3](https://github.com/sagemath/sagetrac-mirror/commit/5c0d0a398cafd54072a05d534da52d4fbb9f1ab8)** to **[f7c4a65](https://github.com/sagemath/sagetrac-mirror/commit/f7c4a65a210ee254f1ee8724145954ef245aef8c)**



---

archive/issue_events_313343.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-22T09:24:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313343"
}
```



---

archive/issue_events_313344.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-22T09:24:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313344"
}
```



---

archive/issue_comments_379545.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\n\n```\nsage: search_src('IdealMonoid')\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n\n  ...\n\nNameError: global name 'format_text_results' is not defined\n```\nYou forgot to delete a line:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex c77f76f2a5..64f4b8afaa 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -961,7 +961,6 @@ You can build this with 'sage -docbuild {} html'.\"\"\".format(s))\n     else:\n         # Pass through the IPython pager in a mime bundle\n         from IPython.core.page import page\n-        text_results = format_text_results()\n         if not isinstance(text_results, text_type):\n             text_results = text_results.decode('utf-8', 'replace')\n \n```\nI would encourage you to actually try a few simple cases before marking it as `needs_review`  ;) \n\nI wonder if we should put an example with `interact=True` in the doctests to catch this sort of thing; for example:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex c77f76f2a5..ff8021ffff 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -1143,6 +1143,13 @@ def search_src(string, extra1='', extra2='', extra3='', extra4='',\n         matrix/matrix0.pyx:924:        Set the 2 x 2 submatrix of M, starting at row index and column\n         matrix/matrix0.pyx:933:        Set the 2 x 3 submatrix of M starting at row index and column\n \n+    One example with ``interact=True``::\n+\n+        sage: search_src('IdealMonoid') # random\n+        misc/sagedoc.py:1145:        sage: search_src('IdealMonoid')\n+        algebras/letterplace/free_algebra_letterplace.pyx:110:from sage.rings.noncommutative_ideals import IdealMonoid_ncalgebras/letterplace/free_algebra_letterplace.pyx:556:            self.__monoid = IdealMonoid_nc(self)\n+        rings/ideal_monoid.py:12:def IdealMonoid(R):\n+        ...\n     \"\"\"\n     return _search_src_or_doc('src', string, extra1=extra1, extra2=extra2,\n                               extra3=extra3, extra4=extra4, extra5=extra5,\n```\n\nAlso, with `multiline=True`, it still doesn't work with the legacy notebook. The colons which used to be inserted seem to be necessary. You could keep the old code and defer any changes involving `html_results` to #26104.",
    "created_at": "2018-08-22T18:57:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379545",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'>Comment 26:</a>

```
sage: search_src('IdealMonoid')
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)

  ...

NameError: global name 'format_text_results' is not defined
```
You forgot to delete a line:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index c77f76f2a5..64f4b8afaa 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -961,7 +961,6 @@ You can build this with 'sage -docbuild {} html'.""".format(s))
     else:
         # Pass through the IPython pager in a mime bundle
         from IPython.core.page import page
-        text_results = format_text_results()
         if not isinstance(text_results, text_type):
             text_results = text_results.decode('utf-8', 'replace')
 
```
I would encourage you to actually try a few simple cases before marking it as `needs_review`  ;) 

I wonder if we should put an example with `interact=True` in the doctests to catch this sort of thing; for example:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index c77f76f2a5..ff8021ffff 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -1143,6 +1143,13 @@ def search_src(string, extra1='', extra2='', extra3='', extra4='',
         matrix/matrix0.pyx:924:        Set the 2 x 2 submatrix of M, starting at row index and column
         matrix/matrix0.pyx:933:        Set the 2 x 3 submatrix of M starting at row index and column
 
+    One example with ``interact=True``::
+
+        sage: search_src('IdealMonoid') # random
+        misc/sagedoc.py:1145:        sage: search_src('IdealMonoid')
+        algebras/letterplace/free_algebra_letterplace.pyx:110:from sage.rings.noncommutative_ideals import IdealMonoid_ncalgebras/letterplace/free_algebra_letterplace.pyx:556:            self.__monoid = IdealMonoid_nc(self)
+        rings/ideal_monoid.py:12:def IdealMonoid(R):
+        ...
     """
     return _search_src_or_doc('src', string, extra1=extra1, extra2=extra2,
                               extra3=extra3, extra4=extra4, extra5=extra5,
```

Also, with `multiline=True`, it still doesn't work with the legacy notebook. The colons which used to be inserted seem to be necessary. You could keep the old code and defer any changes involving `html_results` to #26104.



---

archive/issue_events_313345.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-22T18:57:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313345"
}
```



---

archive/issue_events_313346.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-22T18:57:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313346"
}
```



---

archive/issue_comments_379546.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@jhpalmieri](#comment%3A26):\n> I would encourage you to actually try a few simple cases before marking it as `needs_review`  ;) \n\nI'm actually now going to have to review the doctests for this code, because I *did* run the doctests and somehow it passed.  That obviously can't be good.",
    "created_at": "2018-08-22T19:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379546",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@jhpalmieri](#comment%3A26):
> I would encourage you to actually try a few simple cases before marking it as `needs_review`  ;) 

I'm actually now going to have to review the doctests for this code, because I *did* run the doctests and somehow it passed.  That obviously can't be good.



---

archive/issue_comments_379547.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nA related, but actually different problem, is that many of the tests in this module are (unsurprisingly) marked `# long time`, and I wasn't testing with `--long`.",
    "created_at": "2018-08-22T19:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379547",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'>Comment 28:</a>
A related, but actually different problem, is that many of the tests in this module are (unsurprisingly) marked `# long time`, and I wasn't testing with `--long`.



---

archive/issue_comments_379548.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@embray](#comment%3A27):\n> Replying to [@jhpalmieri](#comment%3A26):\n> > I would encourage you to actually try a few simple cases before marking it as `needs_review`  ;) \n\n> \n> I'm actually now going to have to review the doctests for this code, because I *did* run the doctests and somehow it passed.  That obviously can't be good.\n\nThe issue is that (I think) the doctests all use `interact=False`, so they bypass parts of the code. Hence my suggestion for a new doctest.",
    "created_at": "2018-08-22T19:35:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379548",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@embray](#comment%3A27):
> Replying to [@jhpalmieri](#comment%3A26):
> > I would encourage you to actually try a few simple cases before marking it as `needs_review`  ;) 

> 
> I'm actually now going to have to review the doctests for this code, because I *did* run the doctests and somehow it passed.  That obviously can't be good.

The issue is that (I think) the doctests all use `interact=False`, so they bypass parts of the code. Hence my suggestion for a new doctest.



---

archive/issue_comments_379549.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@jhpalmieri](#comment%3A26):\n> Also, with `multiline=True`, it still doesn't work with the legacy notebook. The colons which used to be inserted seem to be necessary. You could keep the old code and defer any changes involving `html_results` to #26104.\n\nI'll fix that.  Just another symptom of the bad interface for `format_search_as_html`.",
    "created_at": "2018-08-22T19:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379549",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@jhpalmieri](#comment%3A26):
> Also, with `multiline=True`, it still doesn't work with the legacy notebook. The colons which used to be inserted seem to be necessary. You could keep the old code and defer any changes involving `html_results` to #26104.

I'll fix that.  Just another symptom of the bad interface for `format_search_as_html`.



---

archive/issue_comments_379550.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@embray](#comment%3A28):\n> A related, but actually different problem, is that many of the tests in this module are (unsurprisingly) marked `# long time`, and I wasn't testing with `--long`.\n\nAnother issue is that some doctests are marked `# optional - dochtml`, and they are not run by default, although I was led to believe in #25345 that they would be. To verify this, I added\n\n```\n    sage: 1+1==5 # optional - dochtml\n    True\n```\nto the file, and doctests pass unless I explicitly use the `--optional dochtml` flag. I'll open a new ticket for that: #26110.",
    "created_at": "2018-08-22T19:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379550",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@embray](#comment%3A28):
> A related, but actually different problem, is that many of the tests in this module are (unsurprisingly) marked `# long time`, and I wasn't testing with `--long`.

Another issue is that some doctests are marked `# optional - dochtml`, and they are not run by default, although I was led to believe in #25345 that they would be. To verify this, I added

```
    sage: 1+1==5 # optional - dochtml
    True
```
to the file, and doctests pass unless I explicitly use the `--optional dochtml` flag. I'll open a new ticket for that: #26110.



---

archive/issue_comments_379551.json:
```json
{
    "body": "Changed commit from **[f7c4a65](https://github.com/sagemath/sagetrac-mirror/commit/f7c4a65a210ee254f1ee8724145954ef245aef8c)** to **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)**",
    "created_at": "2018-08-22T20:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379551",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f7c4a65](https://github.com/sagemath/sagetrac-mirror/commit/f7c4a65a210ee254f1ee8724145954ef245aef8c)** to **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)**



---

archive/issue_comments_379552.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2a2aa03b34cdd91d8409b08e2024aa298abf3b5\">c2a2aa0</a></td><td><code>Partially fixes #24784 by ensuring that text passed to the IPython pager that contains non-ASCII characters is an actual unicode text object</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/691a22456a4eadecf00bd0ada87510f6022db1d8\">691a224</a></td><td><code>cleaned up argument handling in this function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a\">603d5a0</a></td><td><code>fixed a bug when passiing a list of multiline=True results to format_search_as_html</code></td></tr></table>\n",
    "created_at": "2018-08-22T20:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379552",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2a2aa03b34cdd91d8409b08e2024aa298abf3b5">c2a2aa0</a></td><td><code>Partially fixes #24784 by ensuring that text passed to the IPython pager that contains non-ASCII characters is an actual unicode text object</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/691a22456a4eadecf00bd0ada87510f6022db1d8">691a224</a></td><td><code>cleaned up argument handling in this function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a">603d5a0</a></td><td><code>fixed a bug when passiing a list of multiline=True results to format_search_as_html</code></td></tr></table>




---

archive/issue_comments_379553.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nShould be fixed.\n\nGiven more time, I would like to redo the tests for this module.  While maybe it's OK to have one or two tests that go over all of the sage sources, most of the `# long time` tests in this module should be done away with.  The tests can instead run the search over just a small subset of docs/source to speed them up.",
    "created_at": "2018-08-22T20:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379553",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'>Comment 33:</a>
Should be fixed.

Given more time, I would like to redo the tests for this module.  While maybe it's OK to have one or two tests that go over all of the sage sources, most of the `# long time` tests in this module should be done away with.  The tests can instead run the search over just a small subset of docs/source to speed them up.



---

archive/issue_events_313347.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-22T20:51:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313347"
}
```



---

archive/issue_events_313348.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-22T20:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313348"
}
```



---

archive/issue_comments_379554.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nNot a big deal, but in the code\n\n```\n    for L in results:\n        filename = L.strip().split(':', 1)[0]\n        if filename:\n            files.add(filename)\n```\nas long as `L` is nonempty and doesn't start with a colon, `filename` will be nonempty as well. Do you expect `L` to start with a colon? I tried a few cases and didn't see that come up.",
    "created_at": "2018-08-22T21:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379554",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'>Comment 35:</a>
Not a big deal, but in the code

```
    for L in results:
        filename = L.strip().split(':', 1)[0]
        if filename:
            files.add(filename)
```
as long as `L` is nonempty and doesn't start with a colon, `filename` will be nonempty as well. Do you expect `L` to start with a colon? I tried a few cases and didn't see that come up.



---

archive/issue_comments_379555.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nReplying to [@embray](#comment%3A33):\n> Should be fixed.\n> \n> Given more time, I would like to redo the tests for this module.  While maybe it's OK to have one or two tests that go over all of the sage sources, most of the `# long time` tests in this module should be done away with.  The tests can instead run the search over just a small subset of docs/source to speed them up.\n\nThis can wait for another ticket, but if you are thinking about changes like this, then that sounds like a good idea:\n\n```diff\ndiff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py\nindex 94fe79bd6c..539f7420fd 100644\n--- a/src/sage/misc/sagedoc.py\n+++ b/src/sage/misc/sagedoc.py\n@@ -782,10 +782,9 @@ def _search_src_or_doc(what, string, extra1='', extra2='', extra3='',\n     EXAMPLES::\n \n         sage: from sage.misc.sagedoc import _search_src_or_doc\n-        sage: print(_search_src_or_doc('src', r'matrix\\(',  # long time random\n+        sage: print(_search_src_or_doc('src', r'matrix\\(',  # random\n         ....:       'incidence_structures', 'self',\n-        ....:       '^combinat', interact=False))\n-        misc/sagedoc.py:        sage: _search_src_or_doc('src', 'matrix(', 'incidence_structures', 'self', '^combinat', interact=False)\n+        ....:       '^combinat', module='sage.combinat', interact=False))\n         combinat/designs/incidence_structures.py:        M1 = self.incidence_matrix()\n         combinat/designs/incidence_structures.py:        A = self.incidence_matrix()\n         combinat/designs/incidence_structures.py:        M = transpose(self.incidence_matrix())\n@@ -818,7 +817,7 @@ def _search_src_or_doc(what, string, extra1='', extra2='', extra3='',\n \n         sage: from sage.misc.sagedoc import _search_src_or_doc\n         sage: _search_src_or_doc('src', r'def _search_src_or_doc\\(',\n-        ....:                    interact=True)  # long time\n+        ....:                    module='sage.misc', interact=True)\n         misc/sagedoc.py:...:        def _search_src_or_doc(what, string, extra1='', extra2='', extra3='',\n     \"\"\"\n \n@@ -1061,18 +1060,18 @@ def search_src(string, extra1='', extra2='', extra3='', extra4='',\n     The following produces an error because the string 'fetch(' is a\n     malformed regular expression::\n \n-        sage: print(search_src(\" fetch(\", \"def\", interact=False))\n+        sage: print(search_src(\" fetch(\", \"def\", module=\"sage.matrix\", interact=False))\n         Traceback (most recent call last):\n         ...\n         error: unbalanced parenthesis\n \n     To fix this, *escape* the parenthesis with a backslash::\n \n-        sage: print(search_src(\" fetch\\(\", \"def\", interact=False)) # random # long time\n+        sage: print(search_src(\" fetch\\(\", \"def\", module=\"sage.matrix\", interact=False)) # random\n         matrix/matrix0.pyx:    cdef fetch(self, key):\n         matrix/matrix0.pxd:    cdef fetch(self, key)\n \n-        sage: print(search_src(\" fetch\\(\", \"def\", \"pyx\", interact=False)) # random # long time\n+        sage: print(search_src(\" fetch\\(\", \"def\", \"pyx\", module=\"sage.matrix\", interact=False)) # random\n         matrix/matrix0.pyx:    cdef fetch(self, key):\n \n     As noted above, the search is case-insensitive, but you can make it\n```",
    "created_at": "2018-08-22T21:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379555",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'>Comment 36:</a>
Replying to [@embray](#comment%3A33):
> Should be fixed.
> 
> Given more time, I would like to redo the tests for this module.  While maybe it's OK to have one or two tests that go over all of the sage sources, most of the `# long time` tests in this module should be done away with.  The tests can instead run the search over just a small subset of docs/source to speed them up.

This can wait for another ticket, but if you are thinking about changes like this, then that sounds like a good idea:

```diff
diff --git a/src/sage/misc/sagedoc.py b/src/sage/misc/sagedoc.py
index 94fe79bd6c..539f7420fd 100644
--- a/src/sage/misc/sagedoc.py
+++ b/src/sage/misc/sagedoc.py
@@ -782,10 +782,9 @@ def _search_src_or_doc(what, string, extra1='', extra2='', extra3='',
     EXAMPLES::
 
         sage: from sage.misc.sagedoc import _search_src_or_doc
-        sage: print(_search_src_or_doc('src', r'matrix\(',  # long time random
+        sage: print(_search_src_or_doc('src', r'matrix\(',  # random
         ....:       'incidence_structures', 'self',
-        ....:       '^combinat', interact=False))
-        misc/sagedoc.py:        sage: _search_src_or_doc('src', 'matrix(', 'incidence_structures', 'self', '^combinat', interact=False)
+        ....:       '^combinat', module='sage.combinat', interact=False))
         combinat/designs/incidence_structures.py:        M1 = self.incidence_matrix()
         combinat/designs/incidence_structures.py:        A = self.incidence_matrix()
         combinat/designs/incidence_structures.py:        M = transpose(self.incidence_matrix())
@@ -818,7 +817,7 @@ def _search_src_or_doc(what, string, extra1='', extra2='', extra3='',
 
         sage: from sage.misc.sagedoc import _search_src_or_doc
         sage: _search_src_or_doc('src', r'def _search_src_or_doc\(',
-        ....:                    interact=True)  # long time
+        ....:                    module='sage.misc', interact=True)
         misc/sagedoc.py:...:        def _search_src_or_doc(what, string, extra1='', extra2='', extra3='',
     """
 
@@ -1061,18 +1060,18 @@ def search_src(string, extra1='', extra2='', extra3='', extra4='',
     The following produces an error because the string 'fetch(' is a
     malformed regular expression::
 
-        sage: print(search_src(" fetch(", "def", interact=False))
+        sage: print(search_src(" fetch(", "def", module="sage.matrix", interact=False))
         Traceback (most recent call last):
         ...
         error: unbalanced parenthesis
 
     To fix this, *escape* the parenthesis with a backslash::
 
-        sage: print(search_src(" fetch\(", "def", interact=False)) # random # long time
+        sage: print(search_src(" fetch\(", "def", module="sage.matrix", interact=False)) # random
         matrix/matrix0.pyx:    cdef fetch(self, key):
         matrix/matrix0.pxd:    cdef fetch(self, key)
 
-        sage: print(search_src(" fetch\(", "def", "pyx", interact=False)) # random # long time
+        sage: print(search_src(" fetch\(", "def", "pyx", module="sage.matrix", interact=False)) # random
         matrix/matrix0.pyx:    cdef fetch(self, key):
 
     As noted above, the search is case-insensitive, but you can make it
```



---

archive/issue_comments_379556.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nI get one doctest failure when run with `sage -t --long --optional=sage,dochtml`:\n\n```\n**********************************************************************\nFile \"src/sage/misc/sagedoc.py\", line 1179, in sage.misc.sagedoc.?\nFailed example:\n    len(search_doc('tree', whole_word=True, interact=False).splitlines()) < 2000  # optional - dochtml, long time\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\nIs this fixed by #26017? If so, should that ticket be a dependency of this one?",
    "created_at": "2018-08-22T21:44:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379556",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:37'>Comment 37:</a>
I get one doctest failure when run with `sage -t --long --optional=sage,dochtml`:

```
**********************************************************************
File "src/sage/misc/sagedoc.py", line 1179, in sage.misc.sagedoc.?
Failed example:
    len(search_doc('tree', whole_word=True, interact=False).splitlines()) < 2000  # optional - dochtml, long time
Expected:
    True
Got:
    False
**********************************************************************
```
Is this fixed by #26017? If so, should that ticket be a dependency of this one?



---

archive/issue_comments_379557.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nThat's fixed by #26017.  Also, I don't get that failure, but as I wrote there that failure can also happen if you just have \"junk\" in your doc build and goes away with doc-clean.  I don't think it's related to this ticket.",
    "created_at": "2018-08-23T09:26:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379557",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'>Comment 38:</a>
That's fixed by #26017.  Also, I don't get that failure, but as I wrote there that failure can also happen if you just have "junk" in your doc build and goes away with doc-clean.  I don't think it's related to this ticket.



---

archive/issue_comments_379558.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nReplying to [@jhpalmieri](#comment%3A35):\n> Not a big deal, but in the code\n> \n> ```\n>     for L in results:\n>         filename = L.strip().split(':', 1)[0]\n>         if filename:\n>             files.add(filename)\n> ```\n> as long as `L` is nonempty and doesn't start with a colon, `filename` will be nonempty as well. Do you expect `L` to start with a colon? I tried a few cases and didn't see that come up.\n\nThat's a good point.  The original code also would have broken if a filename started with a colon.  This should never be the case though so I'm not worried about it.",
    "created_at": "2018-08-23T09:34:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379558",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'>Comment 39:</a>
Replying to [@jhpalmieri](#comment%3A35):
> Not a big deal, but in the code
> 
> ```
>     for L in results:
>         filename = L.strip().split(':', 1)[0]
>         if filename:
>             files.add(filename)
> ```
> as long as `L` is nonempty and doesn't start with a colon, `filename` will be nonempty as well. Do you expect `L` to start with a colon? I tried a few cases and didn't see that come up.

That's a good point.  The original code also would have broken if a filename started with a colon.  This should never be the case though so I'm not worried about it.



---

archive/issue_comments_379559.json:
```json
{
    "body": "Changed author from **John Palmieri, Erik Bray** to **Erik Bray**",
    "created_at": "2018-08-23T17:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379559",
    "user": "https://github.com/jhpalmieri"
}
```

Changed author from **John Palmieri, Erik Bray** to **Erik Bray**



---

archive/issue_comments_379560.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nOkay, let's close this one. Cleaning up the doctests can happen on another ticket.",
    "created_at": "2018-08-23T17:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379560",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:40'>Comment 40:</a>
Okay, let's close this one. Cleaning up the doctests can happen on another ticket.



---

archive/issue_events_313349.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-23T17:40:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313349"
}
```



---

archive/issue_events_313350.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-23T17:40:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313350"
}
```



---

archive/issue_comments_379561.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2018-08-23T17:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379561",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_comments_379562.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nAgreed--thank you for filling the gap of my shoddy self-review.",
    "created_at": "2018-08-24T13:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379562",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'>Comment 41:</a>
Agreed--thank you for filling the gap of my shoddy self-review.



---

archive/issue_comments_379563.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-24784](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-24784)** to **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)**",
    "created_at": "2018-08-26T09:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379563",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-24784](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-24784)** to **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)**



---

archive/issue_events_313351.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T09:38:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313351"
}
```



---

archive/issue_events_313352.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "97fa049c77cb22d53aaf45eb8f50886f9c83bcfc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-26T09:38:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24784#event-313352"
}
```



---

archive/issue_comments_379564.json:
```json
{
    "body": "Changed commit from **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)** to none",
    "created_at": "2019-04-14T00:11:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379564",
    "user": "https://github.com/slel"
}
```

Changed commit from **[603d5a0](https://github.com/sagemath/sagetrac-mirror/commit/603d5a025ace47b19186007da8d48a5142f2848a)** to none



---

archive/issue_comments_379565.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nNote: similar issue with \"table\" at #27656.",
    "created_at": "2019-04-14T00:11:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24784#issuecomment-379565",
    "user": "https://github.com/slel"
}
```

<a id='comment:43'>Comment 43:</a>
Note: similar issue with "table" at #27656.
