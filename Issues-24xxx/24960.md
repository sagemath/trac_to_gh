# Issue 24960: Fix prime_pi errors and make primecount standard

archive/issues_024723.json:
```json
{
    "assignees": [],
    "body": "The prime_pi function sometimes computes a wrong result. In particular, I found the following errors:\n\n* prime_pi(14783545363230719)\n  returns 408351706116074, it should be 408351706116078\n* prime_pi(5685979153167559)\n  returns 161319877461134, it should be 161319877461136\n* prime_pi(642763101936913)\n  returns 19439675999018, it should be 19439675999019\n\nThe correct countings are computed using Kim Walisch's [primecount](https://github.com/kimwalisch/primecount/) library, with different algorithms: Deleglise-Rivat, Lagarias-Miller-Odlyzko and Lehmer's formula. All of them return the same result.\n\nNote that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning (\"computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values\"), the argument  of the last example is within the range of inputs considered to be safe.\n\nActually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The table below compares the execution times (in seconds) of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.\n\nAll results have been obtained with an Intel i5-2500K. For primecount, a single thread has been used.\n\n| ||| argument |\n|-|||:----------:|\n| algorithm | 642763101936913 | 5685979153167559 | 14783545363230719 |\n| primecount | 2.99|  11.168| 20.052|\n| primecount --lmo | 5.287| 21.883| 41.286|\n| prime_pi | 331| 2489| 6083|\n\n---\n\nHere we take the route of replacing Cython code in `sage.functions.prime_pi`\nwith calls to functions in `sage.interface.primecount`\n\nWill be fixed by #32894\n\n\n\n\n\n\nDepends on #25009\n\nCC:  @slel\n\nKeywords: **primes prime_pi primecount**\n\nBranch/Commit: **[u/dimpase/functions/prime_pi-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/functions/prime_pi-fix) @ [`4f77073`](https://github.com/sagemath/sagetrac-mirror/commit/4f77073aa914209c508cb80d74d3dd4ec52c2c60)**\n\nComponent: **number theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24960_\n\n",
    "closed_at": "2021-12-03T18:41:01Z",
    "created_at": "2018-03-12T19:14:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix prime_pi errors and make primecount standard",
    "type": "issue",
    "updated_at": "2021-12-03T18:41:01Z",
    "url": "https://github.com/sagemath/sage/issues/24960",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```
The prime_pi function sometimes computes a wrong result. In particular, I found the following errors:

* prime_pi(14783545363230719)
  returns 408351706116074, it should be 408351706116078
* prime_pi(5685979153167559)
  returns 161319877461134, it should be 161319877461136
* prime_pi(642763101936913)
  returns 19439675999018, it should be 19439675999019

The correct countings are computed using Kim Walisch's [primecount](https://github.com/kimwalisch/primecount/) library, with different algorithms: Deleglise-Rivat, Lagarias-Miller-Odlyzko and Lehmer's formula. All of them return the same result.

Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning ("computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values"), the argument  of the last example is within the range of inputs considered to be safe.

Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The table below compares the execution times (in seconds) of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.

All results have been obtained with an Intel i5-2500K. For primecount, a single thread has been used.

| ||| argument |
|-|||:----------:|
| algorithm | 642763101936913 | 5685979153167559 | 14783545363230719 |
| primecount | 2.99|  11.168| 20.052|
| primecount --lmo | 5.287| 21.883| 41.286|
| prime_pi | 331| 2489| 6083|

---

Here we take the route of replacing Cython code in `sage.functions.prime_pi`
with calls to functions in `sage.interface.primecount`

Will be fixed by #32894






Depends on #25009

CC:  @slel

Keywords: **primes prime_pi primecount**

Branch/Commit: **[u/dimpase/functions/prime_pi-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/functions/prime_pi-fix) @ [`4f77073`](https://github.com/sagemath/sagetrac-mirror/commit/4f77073aa914209c508cb80d74d3dd4ec52c2c60)**

Component: **number theory**

_Issue created by migration from https://trac.sagemath.org/ticket/24960_





---

archive/issue_events_345293.json:
```json
{
    "actor": "https://github.com/sagetrac-gianluca-amato-74",
    "created_at": "2018-03-12T19:14:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345293"
}
```



---

archive/issue_events_345294.json:
```json
{
    "actor": "https://github.com/sagetrac-gianluca-amato-74",
    "created_at": "2018-03-12T19:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345294"
}
```



---

archive/issue_events_345295.json:
```json
{
    "actor": "https://github.com/sagetrac-gianluca-amato-74",
    "created_at": "2018-03-12T19:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345295"
}
```



---

archive/issue_events_345296.json:
```json
{
    "actor": "https://github.com/sagetrac-gianluca-amato-74",
    "created_at": "2018-03-12T19:14:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345296"
}
```



---

archive/issue_comments_380073.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nCould you add timings in the ticket description? Did you check with PARI/GP?\n\nFirst step would be to make primecount a proper optional package and interface it. In a second time it can be discussed whether this needs to be a standard package (ie coming with default Sage installation). As a parallel task, the fact that `prime_pi` is wrong is really bad and could be temporarilly fixed with a [stopgap http://doc.sagemath.org/html/en/reference/misc/sage/misc/stopgap.html].",
    "created_at": "2018-03-13T08:24:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380073",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1" align="right">comment:1</div>

Could you add timings in the ticket description? Did you check with PARI/GP?

First step would be to make primecount a proper optional package and interface it. In a second time it can be discussed whether this needs to be a standard package (ie coming with default Sage installation). As a parallel task, the fact that `prime_pi` is wrong is really bad and could be temporarilly fixed with a [stopgap http://doc.sagemath.org/html/en/reference/misc/sage/misc/stopgap.html].



---

archive/issue_comments_380074.json:
```json
{
    "body": "Dependencies: **#24966**",
    "created_at": "2018-03-13T16:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380074",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#24966**



---

archive/issue_comments_380075.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nSee #24966 for actually packaging primecount.",
    "created_at": "2018-03-13T16:20:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380075",
    "user": "https://github.com/videlec"
}
```

<div id="comment:2" align="right">comment:2</div>

See #24966 for actually packaging primecount.



---

archive/issue_comments_380076.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI changed the description of the ticket adding execution times. I did not try using Pari/GP because Pari primepi function is very very slow (at least until the latest release, there is some minor improvement in the development code). It works by enumerating one by one all prime numbers, together with a table of pre-computed values. Just to give an example, although primepi(200000000507)=8007105083 is pre-computed. computing primepi(251000000000) requires 372 seconds, while [SageMath](../wiki/SageMath) and primecount only take less than a second.",
    "created_at": "2018-03-14T08:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380076",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

<div id="comment:3" align="right">comment:3</div>

I changed the description of the ticket adding execution times. I did not try using Pari/GP because Pari primepi function is very very slow (at least until the latest release, there is some minor improvement in the development code). It works by enumerating one by one all prime numbers, together with a table of pre-computed values. Just to give an example, although primepi(200000000507)=8007105083 is pre-computed. computing primepi(251000000000) requires 372 seconds, while [SageMath](../wiki/SageMath) and primecount only take less than a second.



---

archive/issue_comments_380077.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,16 @@\n \n Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning (\"computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values\"), the argument  of the last example is within the range of inputs considered to be safe.\n \n-Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code.\n+Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The following table compares the execution times of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.\n \n+| ||| argument |\n+|-|||:----------:|\n+| algorithm | 642763101936913 | 5685979153167559 | 14783545363230719 |\n+| primecount | 2.99|  11.168| 20.052|\n+| primecount --lmo | 5.287| 21.883| 41.286|\n+| primepi | 331| 2489| 6083|\n+\n+\n+\n+\n+\n``````\n",
    "created_at": "2018-03-14T08:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380077",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,16 @@
 
 Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning ("computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values"), the argument  of the last example is within the range of inputs considered to be safe.
 
-Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code.
+Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The following table compares the execution times of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.
 
+| ||| argument |
+|-|||:----------:|
+| algorithm | 642763101936913 | 5685979153167559 | 14783545363230719 |
+| primecount | 2.99|  11.168| 20.052|
+| primecount --lmo | 5.287| 21.883| 41.286|
+| primepi | 331| 2489| 6083|
+
+
+
+
+
``````




---

archive/issue_comments_380078.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,9 @@\n \n Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning (\"computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values\"), the argument  of the last example is within the range of inputs considered to be safe.\n \n-Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The following table compares the execution times of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.\n+Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The table below compares the execution times (in seconds) of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.\n+\n+All results have been obtained with an Intel i5-2500K. For primecount, a single thread has been used.\n \n | ||| argument |\n |-|||:----------:|\n``````\n",
    "created_at": "2018-03-14T08:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380078",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,9 @@
 
 Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning ("computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values"), the argument  of the last example is within the range of inputs considered to be safe.
 
-Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The following table compares the execution times of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.
+Actually, instead of fixing the current code, it could be easier to rewrite the prime_pi function and let it use the primecount library. This would have the additional advantage of being much faster than the current code. The table below compares the execution times (in seconds) of primecount with Deleglise-Rivat, primecount with Lagarias-Miller-Odlyzko and [SageMath](../wiki/SageMath) prime_pi function.
+
+All results have been obtained with an Intel i5-2500K. For primecount, a single thread has been used.
 
 | ||| argument |
 |-|||:----------:|
``````




---

archive/issue_comments_380079.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAdded some context information to the ticket description.",
    "created_at": "2018-03-14T08:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380079",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

<div id="comment:4" align="right">comment:4</div>

Added some context information to the ticket description.



---

archive/issue_comments_380080.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWhen I wrote the current `prime_pi` code, there was no open source implementations of fast prime counting. I agree that the best long term solution is to use the `primecount` library.",
    "created_at": "2018-03-14T22:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380080",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:5" align="right">comment:5</div>

When I wrote the current `prime_pi` code, there was no open source implementations of fast prime counting. I agree that the best long term solution is to use the `primecount` library.



---

archive/issue_comments_380081.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFixed typos.",
    "created_at": "2018-03-14T23:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380081",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

<div id="comment:6" align="right">comment:6</div>

Fixed typos.



---

archive/issue_comments_380082.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n * prime_pi(642763101936913)\n   returns 19439675999018, it should be 19439675999019\n \n-The correct countings are computed using Kim Walisch's [primecount](https://github.com/kimwalisch/primecount/) library, with different algorithms: Deleglise-Rivat, Lagarias-Miller-Odlyzko and Lehmer's formula. (not. All of them return the same result.\n+The correct countings are computed using Kim Walisch's [primecount](https://github.com/kimwalisch/primecount/) library, with different algorithms: Deleglise-Rivat, Lagarias-Miller-Odlyzko and Lehmer's formula. All of them return the same result.\n \n Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning (\"computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values\"), the argument  of the last example is within the range of inputs considered to be safe.\n \n@@ -20,7 +20,7 @@\n | algorithm | 642763101936913 | 5685979153167559 | 14783545363230719 |\n | primecount | 2.99|  11.168| 20.052|\n | primecount --lmo | 5.287| 21.883| 41.286|\n-| primepi | 331| 2489| 6083|\n+| prime_pi | 331| 2489| 6083|\n \n \n \n``````\n",
    "created_at": "2018-03-14T23:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380082",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 * prime_pi(642763101936913)
   returns 19439675999018, it should be 19439675999019
 
-The correct countings are computed using Kim Walisch's [primecount](https://github.com/kimwalisch/primecount/) library, with different algorithms: Deleglise-Rivat, Lagarias-Miller-Odlyzko and Lehmer's formula. (not. All of them return the same result.
+The correct countings are computed using Kim Walisch's [primecount](https://github.com/kimwalisch/primecount/) library, with different algorithms: Deleglise-Rivat, Lagarias-Miller-Odlyzko and Lehmer's formula. All of them return the same result.
 
 Note that while the arguments to prime_pi in the first two examples exceed the value 2!^50, causing the appearance of a warning ("computation of prime_pi for x >= 2!^50 has not been as thoroughly tested as for smaller values"), the argument  of the last example is within the range of inputs considered to be safe.
 
@@ -20,7 +20,7 @@
 | algorithm | 642763101936913 | 5685979153167559 | 14783545363230719 |
 | primecount | 2.99|  11.168| 20.052|
 | primecount --lmo | 5.287| 21.883| 41.286|
-| primepi | 331| 2489| 6083|
+| prime_pi | 331| 2489| 6083|
 
 
 
``````




---

archive/issue_comments_380083.json:
```json
{
    "body": "Changed dependencies from **#24966** to **#24966, #25009**",
    "created_at": "2018-03-18T21:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380083",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#24966** to **#24966, #25009**



---

archive/issue_comments_380084.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI can confirm the behavior of the last example\n\n```\nsage: %time prime_pi(642763101936913)\nCPU times: user 4min 29s, sys: 16.1 ms, total: 4min 29s\nWall time: 4min 29s\n19439675999018\n```\nand thanks to #24966 this can be checked with\n\n```\nsage: from sage.interfaces import primecount\nsage: %time primecount.prime_pi(642763101936913)\nCPU times: user 4.88 s, sys: 61.8 ms, total: 4.94 s\nWall time: 1.24 s\n19439675999019\n```",
    "created_at": "2018-06-09T12:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380084",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

I can confirm the behavior of the last example

```
sage: %time prime_pi(642763101936913)
CPU times: user 4min 29s, sys: 16.1 ms, total: 4min 29s
Wall time: 4min 29s
19439675999018
```
and thanks to #24966 this can be checked with

```
sage: from sage.interfaces import primecount
sage: %time primecount.prime_pi(642763101936913)
CPU times: user 4.88 s, sys: 61.8 ms, total: 4.94 s
Wall time: 1.24 s
19439675999019
```



---

archive/issue_comments_380085.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSince primecount has been an optional package for several years, maybe it would be a good idea to upgrade it to standard and just call it?",
    "created_at": "2021-11-12T20:44:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380085",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:9" align="right">comment:9</div>

Since primecount has been an optional package for several years, maybe it would be a good idea to upgrade it to standard and just call it?



---

archive/issue_comments_380086.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOr if nobody has time to work on this, maybe somebody could replace the message \"\"computation of prime_pi for `x >= 2^50` has not been as thoroughly tested as for smaller values\", which is only triggered for large input, by a similar message triggered by any `x >= 10^6` say?  The message could be \"computation of prime_pi has known bugs (see #24960)\".",
    "created_at": "2021-11-12T20:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380086",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:10" align="right">comment:10</div>

Or if nobody has time to work on this, maybe somebody could replace the message ""computation of prime_pi for `x >= 2^50` has not been as thoroughly tested as for smaller values", which is only triggered for large input, by a similar message triggered by any `x >= 10^6` say?  The message could be "computation of prime_pi has known bugs (see #24960)".



---

archive/issue_comments_380087.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@miguelmarco](#comment:9):\n> Since primecount has been an optional package for several years, maybe it would be a good idea to upgrade it to standard and just call it?\n\n\nOf course, in that case we should reconsider #32412",
    "created_at": "2021-11-12T20:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380087",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@miguelmarco](#comment:9):
> Since primecount has been an optional package for several years, maybe it would be a good idea to upgrade it to standard and just call it?


Of course, in that case we should reconsider #32412



---

archive/issue_comments_380088.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI think we should upgrade `primecount` spkg and use it in `prime_pi`. And revert #32412",
    "created_at": "2021-11-12T22:34:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380088",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

I think we should upgrade `primecount` spkg and use it in `prime_pi`. And revert #32412



---

archive/issue_comments_380089.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSee [#32412 comment:7](https://github.com/sagemath/sage/issues/32412#comment:7) for how to do the primecount Cython interfaces properly",
    "created_at": "2021-11-12T22:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380089",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

See [#32412 comment:7](https://github.com/sagemath/sage/issues/32412#comment:7) for how to do the primecount Cython interfaces properly



---

archive/issue_comments_380090.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@dimpase](#comment:12):\n> I think we should upgrade `primecount` spkg and use it in `prime_pi`. And revert #32412\n\n+1\n\nThe difference in speed in huge. Not to mention the correctness.\n\nIs the cmake dependency really a no-go for making it standard?",
    "created_at": "2021-11-12T23:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380090",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@dimpase](#comment:12):
> I think we should upgrade `primecount` spkg and use it in `prime_pi`. And revert #32412

+1

The difference in speed in huge. Not to mention the correctness.

Is the cmake dependency really a no-go for making it standard?



---

archive/issue_comments_380091.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@miguelmarco](#comment:14):\n> Is the cmake dependency really a no-go for making it standard?\n\nNo, that's outdated. `cmake` is a standard package now.",
    "created_at": "2021-11-12T23:24:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380091",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@miguelmarco](#comment:14):
> Is the cmake dependency really a no-go for making it standard?

No, that's outdated. `cmake` is a standard package now.



---

archive/issue_comments_380092.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@mkoeppe](#comment:13):\n> See [#32412 comment:7](https://github.com/sagemath/sage/issues/32412#comment:7) for how to do the primecount Cython interfaces properly\n\nSo we should move the current cython code to a pip package, and then instruct sage to pip-install it instead of using a sage SPKG?",
    "created_at": "2021-11-14T16:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380092",
    "user": "https://github.com/miguelmarco"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@mkoeppe](#comment:13):
> See [#32412 comment:7](https://github.com/sagemath/sage/issues/32412#comment:7) for how to do the primecount Cython interfaces properly

So we should move the current cython code to a pip package, and then instruct sage to pip-install it instead of using a sage SPKG?



---

archive/issue_comments_380093.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYes, either the current cython code should become a pip-installable package; or switch to using https://pypi.org/project/primecount/ (but see https://github.com/hearot/primecount-python/issues/3).\n\nThe pip-installable package can then become an SPKG.",
    "created_at": "2021-11-14T17:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380093",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Yes, either the current cython code should become a pip-installable package; or switch to using https://pypi.org/project/primecount/ (but see https://github.com/hearot/primecount-python/issues/3).

The pip-installable package can then become an SPKG.



---

archive/issue_comments_380094.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI think it's more urgent to provide a bug-free `prime_pi` than to package the implementation nicely.",
    "created_at": "2021-11-14T22:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380094",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

I think it's more urgent to provide a bug-free `prime_pi` than to package the implementation nicely.



---

archive/issue_comments_380095.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIt's 10 minutes of work to package it.",
    "created_at": "2021-11-14T22:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380095",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

It's 10 minutes of work to package it.



---

archive/issue_comments_380096.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nif you know what to do, yes. \nif not, who knows.",
    "created_at": "2021-11-14T23:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380096",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

if you know what to do, yes. 
if not, who knows.



---

archive/issue_comments_380097.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nIn this case, one copies and adjusts something that works, such as https://github.com/sagemath/memory_allocator",
    "created_at": "2021-11-14T23:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380097",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

In this case, one copies and adjusts something that works, such as https://github.com/sagemath/memory_allocator



---

archive/issue_comments_380098.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI've posted some not yet complete thing on #25009",
    "created_at": "2021-11-15T11:33:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380098",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

I've posted some not yet complete thing on #25009



---

archive/issue_comments_380099.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nA quick thing would be to put a deprecation warning in `prime_pi` et al., telling users to use `prime_pi` from `primecount` instead. Would this be acceptable way to resolve this ticket?\n(note that also `prime_pi` has 2nd optional parameter, and providing an implementation for it would be work...)\n\nAnd then it can be just removed, witin a year or so.",
    "created_at": "2021-11-16T11:17:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380099",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

A quick thing would be to put a deprecation warning in `prime_pi` et al., telling users to use `prime_pi` from `primecount` instead. Would this be acceptable way to resolve this ticket?
(note that also `prime_pi` has 2nd optional parameter, and providing an implementation for it would be work...)

And then it can be just removed, witin a year or so.



---

archive/issue_events_345297.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-16T11:18:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345297"
}
```



---

archive/issue_events_345298.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-16T11:18:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345298"
}
```



---

archive/issue_events_345299.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-16T11:18:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345299"
}
```



---

archive/issue_events_345300.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-16T11:18:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345300"
}
```



---

archive/issue_comments_380100.json:
```json
{
    "body": "Changed dependencies from **#24966, #25009** to **#25009**",
    "created_at": "2021-11-16T11:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380100",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#24966, #25009** to **#25009**



---

archive/issue_comments_380101.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI don't understand in all the details what the second parameter of `prime_pi` does, but in any case it just changes the inner workings of the function, not its input/output behavior. Therefore, I think that, when implemented trough `primecount`, it would be possible to just keep the second parameter for compatibility reasons but ignore its value.",
    "created_at": "2021-11-16T11:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380101",
    "user": "https://github.com/sagetrac-gianluca-amato-74"
}
```

<div id="comment:25" align="right">comment:25</div>

I don't understand in all the details what the second parameter of `prime_pi` does, but in any case it just changes the inner workings of the function, not its input/output behavior. Therefore, I think that, when implemented trough `primecount`, it would be possible to just keep the second parameter for compatibility reasons but ignore its value.



---

archive/issue_comments_380102.json:
```json
{
    "body": "Commit: **[`398748d`](https://github.com/sagemath/sagetrac-mirror/commit/398748df0e0f85a26779043ac6720d6e64576d5e)**",
    "created_at": "2021-11-16T14:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380102",
    "user": "https://github.com/dimpase"
}
```

Commit: **[`398748d`](https://github.com/sagemath/sagetrac-mirror/commit/398748df0e0f85a26779043ac6720d6e64576d5e)**



---

archive/issue_comments_380103.json:
```json
{
    "body": "Branch: **[u/dimpase/functions/prime_pi-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/functions/prime_pi-fix)**",
    "created_at": "2021-11-16T14:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380103",
    "user": "https://github.com/dimpase"
}
```

Branch: **[u/dimpase/functions/prime_pi-fix](https://github.com/sagemath/sagetrac-mirror/tree/u/dimpase/functions/prime_pi-fix)**



---

archive/issue_comments_380104.json:
```json
{
    "body": "Author: **Dima Pasechnik**",
    "created_at": "2021-11-16T14:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380104",
    "user": "https://github.com/dimpase"
}
```

Author: **Dima Pasechnik**



---

archive/issue_events_345301.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-16T14:12:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345301"
}
```



---

archive/issue_comments_380105.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\none has to decide what to do with the optional (usless) 2nd parameter to `prime_pi()`\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1e24a4a159f79bd3c3e18b819951caa7282eb925\">1e24a4a</a></td><td><code>bump primecount to ver. 7.1, and standard</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a660ee48e378dae2a21212c165709ae7d4d88304\">a660ee4</a></td><td><code>removed deprecations</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/398748df0e0f85a26779043ac6720d6e64576d5e\">398748d</a></td><td><code>prime_pi and legendre_phi calling primecount</code></td></tr></table>\n",
    "created_at": "2021-11-16T14:12:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380105",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

one has to decide what to do with the optional (usless) 2nd parameter to `prime_pi()`

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1e24a4a159f79bd3c3e18b819951caa7282eb925">1e24a4a</a></td><td><code>bump primecount to ver. 7.1, and standard</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a660ee48e378dae2a21212c165709ae7d4d88304">a660ee4</a></td><td><code>removed deprecations</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/398748df0e0f85a26779043ac6720d6e64576d5e">398748d</a></td><td><code>prime_pi and legendre_phi calling primecount</code></td></tr></table>




---

archive/issue_events_345302.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-16T19:56:58Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "title_is": "Fix prime_pi errors and make primecount standard",
    "title_was": "prime_pi errors",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345302"
}
```



---

archive/issue_comments_380106.json:
```json
{
    "body": "Changed keywords from **primes prime_pi** to **primes prime_pi primecount**",
    "created_at": "2021-11-16T19:56:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380106",
    "user": "https://github.com/slel"
}
```

Changed keywords from **primes prime_pi** to **primes prime_pi primecount**



---

archive/issue_comments_380107.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nshould `primecount` to be added to dependencies of, hmm, `sagelib` ? \nBecause on a slow 32-bit machine I see how building docs is failing (if I start `make ptest` right after `./configure`), as it needs `prime_pi`, which in turn depends on `primecount`, or, more precisely, on `sage.interfaces.primecount`.",
    "created_at": "2021-11-16T20:33:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380107",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

should `primecount` to be added to dependencies of, hmm, `sagelib` ? 
Because on a slow 32-bit machine I see how building docs is failing (if I start `make ptest` right after `./configure`), as it needs `prime_pi`, which in turn depends on `primecount`, or, more precisely, on `sage.interfaces.primecount`.



---

archive/issue_comments_380108.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,7 +22,12 @@\n | primecount --lmo | 5.287| 21.883| 41.286|\n | prime_pi | 331| 2489| 6083|\n \n+---\n+\n+Here we take the route of replacing Cython code in `sage.functions.prime_pi`\n+with calls to functions in `sage.interface.primecount`\n \n \n \n \n+\n``````\n",
    "created_at": "2021-11-16T20:36:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380108",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,7 +22,12 @@
 | primecount --lmo | 5.287| 21.883| 41.286|
 | prime_pi | 331| 2489| 6083|
 
+---
+
+Here we take the route of replacing Cython code in `sage.functions.prime_pi`
+with calls to functions in `sage.interface.primecount`
 
 
 
 
+
``````




---

archive/issue_comments_380109.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\ncomment:21.",
    "created_at": "2021-11-16T20:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380109",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

comment:21.



---

archive/issue_comments_380110.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI finally built and tested this on a 32-bit host, the only one test error there, it is due to a different error message, `int is too big` vs `Python int is too big`.\n\nNeeds some dots to be added.",
    "created_at": "2021-11-16T20:58:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380110",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:31" align="right">comment:31</div>

I finally built and tested this on a 32-bit host, the only one test error there, it is due to a different error message, `int is too big` vs `Python int is too big`.

Needs some dots to be added.



---

archive/issue_comments_380111.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@mkoeppe](#comment:30):\n> comment:21.\n\nI don't understand, do you mean that `primecount` is the only package that needs this treatment?",
    "created_at": "2021-11-16T20:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380111",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@mkoeppe](#comment:30):
> comment:21.

I don't understand, do you mean that `primecount` is the only package that needs this treatment?



---

archive/issue_comments_380112.json:
```json
{
    "body": "Changed commit from **[`398748d`](https://github.com/sagemath/sagetrac-mirror/commit/398748df0e0f85a26779043ac6720d6e64576d5e)** to **[`0c3be43`](https://github.com/sagemath/sagetrac-mirror/commit/0c3be437a657f16af6190d5b14bcbfffbeeeefa9)**",
    "created_at": "2021-11-16T21:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380112",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`398748d`](https://github.com/sagemath/sagetrac-mirror/commit/398748df0e0f85a26779043ac6720d6e64576d5e)** to **[`0c3be43`](https://github.com/sagemath/sagetrac-mirror/commit/0c3be437a657f16af6190d5b14bcbfffbeeeefa9)**



---

archive/issue_comments_380113.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c3be437a657f16af6190d5b14bcbfffbeeeefa9\">0c3be43</a></td><td><code>allow for slightly different Overflow messages in doctest</code></td></tr></table>\n",
    "created_at": "2021-11-16T21:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380113",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c3be437a657f16af6190d5b14bcbfffbeeeefa9">0c3be43</a></td><td><code>allow for slightly different Overflow messages in doctest</code></td></tr></table>




---

archive/issue_comments_380114.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nDo we also need\n\n```diff\n--- a/build/pkgs/sagelib/dependencies\n+++ b/build/pkgs/sagelib/dependencies\n@@ -1,4 +1,4 @@\n-FORCE $(SCRIPTS) arb boost_cropped $(BLAS) brial cliquer cypari cysignals cython ecl eclib ecm flint libgd gap giac givaro glpk gmpy2 gsl iml jinja2 jupyter_core lcalc lrcalc libbraiding libhomfly libpng linbox m4ri m4rie memory_allocator mpc mpfi mpfr $(MP_LIBRARY) ntl numpy pari pip pkgconfig planarity ppl pplpy pycygwin $(PYTHON) ratpoints rw sage_conf singular symmetrica zn_poly $(PCFILES) | $(PYTHON_TOOLCHAIN) sage_setup\n+FORCE $(SCRIPTS) arb boost_cropped $(BLAS) brial cliquer cypari cysignals cython ecl eclib ecm flint libgd gap giac givaro glpk gmpy2 gsl iml jinja2 jupyter_core lcalc lrcalc libbraiding libhomfly libpng linbox m4ri m4rie memory_allocator mpc mpfi mpfr $(MP_LIBRARY) ntl numpy pari pip pkgconfig planarity ppl pplpy primecount pycygwin $(PYTHON) ratpoints rw sage_conf singular symmetrica zn_poly $(PCFILES) | $(PYTHON_TOOLCHAIN) sage_setup\n \n ----------\n All lines of this file are ignored except the first.\ndiff --git a/src/pyproject.toml.m4 b/src/pyproject.toml.m4\nindex 125da7ac1c..6b6402884a 100644\n--- a/src/pyproject.toml.m4\n+++ b/src/pyproject.toml.m4\n@@ -18,6 +18,7 @@ requires = [\n         numpy          \\\n         pkgconfig      \\\n         pplpy          \\\n+        primecount     \\\n         memory_allocator \\\n                     ')]\n build-backend = \"setuptools.build_meta\"\n```\nto avoid possible races? Still, this does not seem to be relevant for the issue in [comment:28](#comment:28).",
    "created_at": "2021-11-16T21:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380114",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:34" align="right">comment:34</div>

Do we also need

```diff
--- a/build/pkgs/sagelib/dependencies
+++ b/build/pkgs/sagelib/dependencies
@@ -1,4 +1,4 @@
-FORCE $(SCRIPTS) arb boost_cropped $(BLAS) brial cliquer cypari cysignals cython ecl eclib ecm flint libgd gap giac givaro glpk gmpy2 gsl iml jinja2 jupyter_core lcalc lrcalc libbraiding libhomfly libpng linbox m4ri m4rie memory_allocator mpc mpfi mpfr $(MP_LIBRARY) ntl numpy pari pip pkgconfig planarity ppl pplpy pycygwin $(PYTHON) ratpoints rw sage_conf singular symmetrica zn_poly $(PCFILES) | $(PYTHON_TOOLCHAIN) sage_setup
+FORCE $(SCRIPTS) arb boost_cropped $(BLAS) brial cliquer cypari cysignals cython ecl eclib ecm flint libgd gap giac givaro glpk gmpy2 gsl iml jinja2 jupyter_core lcalc lrcalc libbraiding libhomfly libpng linbox m4ri m4rie memory_allocator mpc mpfi mpfr $(MP_LIBRARY) ntl numpy pari pip pkgconfig planarity ppl pplpy primecount pycygwin $(PYTHON) ratpoints rw sage_conf singular symmetrica zn_poly $(PCFILES) | $(PYTHON_TOOLCHAIN) sage_setup
 
 ----------
 All lines of this file are ignored except the first.
diff --git a/src/pyproject.toml.m4 b/src/pyproject.toml.m4
index 125da7ac1c..6b6402884a 100644
--- a/src/pyproject.toml.m4
+++ b/src/pyproject.toml.m4
@@ -18,6 +18,7 @@ requires = [
         numpy          \
         pkgconfig      \
         pplpy          \
+        primecount     \
         memory_allocator \
                     ')]
 build-backend = "setuptools.build_meta"
```
to avoid possible races? Still, this does not seem to be relevant for the issue in [comment:28](#comment:28).



---

archive/issue_comments_380115.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@dimpase](#comment:32):\n> Replying to [@mkoeppe](#comment:30):\n> > comment:21.\n\n> I don't understand, do you mean that `primecount` is the only package that needs this treatment?\n\nYou were asking how to do dependencies right. The answer is: The bindings need to go into a separate Python package -- that will look just like `memory_allocator`. In this way, `sagelib` will not acquire another compile-time dependency. Modularization = do not pile on additional compile-time dependencies.",
    "created_at": "2021-11-16T22:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380115",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@dimpase](#comment:32):
> Replying to [@mkoeppe](#comment:30):
> > comment:21.

> I don't understand, do you mean that `primecount` is the only package that needs this treatment?

You were asking how to do dependencies right. The answer is: The bindings need to go into a separate Python package -- that will look just like `memory_allocator`. In this way, `sagelib` will not acquire another compile-time dependency. Modularization = do not pile on additional compile-time dependencies.



---

archive/issue_comments_380116.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI think we're talking about different issues. I saw an error during docbuild stage which came from\n`src/sage/interfaces/primecount.pyx` not yet built at that moment. The external library spkg `primecount` was already built at that moment.",
    "created_at": "2021-11-16T22:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380116",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

I think we're talking about different issues. I saw an error during docbuild stage which came from
`src/sage/interfaces/primecount.pyx` not yet built at that moment. The external library spkg `primecount` was already built at that moment.



---

archive/issue_comments_380117.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nAs I have explained, `src/sage/interfaces/primecount.pyx` should not be part of sagelib. This is why it was deprecated!",
    "created_at": "2021-11-16T22:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380117",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

As I have explained, `src/sage/interfaces/primecount.pyx` should not be part of sagelib. This is why it was deprecated!



---

archive/issue_comments_380118.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI asked you whether it's the only Cython file out there left that should not be a part of sagelib.\nYou didn't reply - I assume this means it is not. \n\nI don't have mental capacity now to learn the ideal modern design, I just want this ticket done in the most direct way.\nModularisation can be done on another ticket.",
    "created_at": "2021-11-16T22:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380118",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:38" align="right">comment:38</div>

I asked you whether it's the only Cython file out there left that should not be a part of sagelib.
You didn't reply - I assume this means it is not. 

I don't have mental capacity now to learn the ideal modern design, I just want this ticket done in the most direct way.
Modularisation can be done on another ticket.



---

archive/issue_comments_380119.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI was relieved today from teaching computer graphics next term, so I have some spare mental capacity now :-)\n\nNote that `src/sage/functions/prime_pi.pyx` relies heavily on `sagelib` (e.g. on SR). \n\nWhat does not rely on sagelib (or on Sage at all) is  `src/sage/interfaces/primecount.pyx`, \nwhich is not even touched by this ticket (it's touched by  #25009).\n \nThe latter indeed can be spun off, modelling on `memory_allocator`\n(I suppose after it's done, one would only need to change one import statement in `src/sage/functions/prime_pi.pyx`.)",
    "created_at": "2021-11-17T14:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380119",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:39" align="right">comment:39</div>

I was relieved today from teaching computer graphics next term, so I have some spare mental capacity now :-)

Note that `src/sage/functions/prime_pi.pyx` relies heavily on `sagelib` (e.g. on SR). 

What does not rely on sagelib (or on Sage at all) is  `src/sage/interfaces/primecount.pyx`, 
which is not even touched by this ticket (it's touched by  #25009).
 
The latter indeed can be spun off, modelling on `memory_allocator`
(I suppose after it's done, one would only need to change one import statement in `src/sage/functions/prime_pi.pyx`.)



---

archive/issue_comments_380120.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29447182575cb8d7adaa5d4a6f7858f98131c83e\">2944718</a></td><td><code>check version of primesieve in the  config of primecount</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8dbc402fe944247f79ba32faca93f561f336d21\">e8dbc40</a></td><td><code>distros info for primecount/sieve, correct m4s</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6551362711bd09e8d21baf7fd477542eeddf5e5\">c655136</a></td><td><code>remove sagemath-primecount declaration</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ca1f677371aa9834b2094fe56e73b8f4c7f93f2\">9ca1f67</a></td><td><code>misc config changes for primesieve</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8e2cda4f1efb33cfc028e24e6f6869226408ba5\">d8e2cda</a></td><td><code>adjust deps,remove stuff from cfg and toml</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f1e441ba8bf1972d2d02e0f0e7f2313d69037b3\">3f1e441</a></td><td><code>no need for CMAKE_INSTALL_PREFIX (it's in sdh_cmake)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abce309cd4ae20219c220ebd00a0c954146915fe\">abce309</a></td><td><code>flyby patch: remove CMAKE_INSTALL_PREFIX, as it's set in sdh_cmake</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6de7f427004aac442e177d58ad47a2ef2b637e8\">a6de7f4</a></td><td><code>check external primesieve with cmake</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/733cebc8ad9dc3ea011a8e4ab46e2a1d72860678\">733cebc</a></td><td><code>prime_pi and legendre_phi calling primecount</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f77073aa914209c508cb80d74d3dd4ec52c2c60\">4f77073</a></td><td><code>allow for slightly different Overflow messages in doctest</code></td></tr></table>\n",
    "created_at": "2021-11-25T12:16:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380120",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29447182575cb8d7adaa5d4a6f7858f98131c83e">2944718</a></td><td><code>check version of primesieve in the  config of primecount</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8dbc402fe944247f79ba32faca93f561f336d21">e8dbc40</a></td><td><code>distros info for primecount/sieve, correct m4s</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6551362711bd09e8d21baf7fd477542eeddf5e5">c655136</a></td><td><code>remove sagemath-primecount declaration</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ca1f677371aa9834b2094fe56e73b8f4c7f93f2">9ca1f67</a></td><td><code>misc config changes for primesieve</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8e2cda4f1efb33cfc028e24e6f6869226408ba5">d8e2cda</a></td><td><code>adjust deps,remove stuff from cfg and toml</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f1e441ba8bf1972d2d02e0f0e7f2313d69037b3">3f1e441</a></td><td><code>no need for CMAKE_INSTALL_PREFIX (it's in sdh_cmake)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abce309cd4ae20219c220ebd00a0c954146915fe">abce309</a></td><td><code>flyby patch: remove CMAKE_INSTALL_PREFIX, as it's set in sdh_cmake</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6de7f427004aac442e177d58ad47a2ef2b637e8">a6de7f4</a></td><td><code>check external primesieve with cmake</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/733cebc8ad9dc3ea011a8e4ab46e2a1d72860678">733cebc</a></td><td><code>prime_pi and legendre_phi calling primecount</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f77073aa914209c508cb80d74d3dd4ec52c2c60">4f77073</a></td><td><code>allow for slightly different Overflow messages in doctest</code></td></tr></table>




---

archive/issue_comments_380121.json:
```json
{
    "body": "Changed commit from **[`0c3be43`](https://github.com/sagemath/sagetrac-mirror/commit/0c3be437a657f16af6190d5b14bcbfffbeeeefa9)** to **[`4f77073`](https://github.com/sagemath/sagetrac-mirror/commit/4f77073aa914209c508cb80d74d3dd4ec52c2c60)**",
    "created_at": "2021-11-25T12:16:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380121",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0c3be43`](https://github.com/sagemath/sagetrac-mirror/commit/0c3be437a657f16af6190d5b14bcbfffbeeeefa9)** to **[`4f77073`](https://github.com/sagemath/sagetrac-mirror/commit/4f77073aa914209c508cb80d74d3dd4ec52c2c60)**



---

archive/issue_comments_380122.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,7 +27,9 @@\n Here we take the route of replacing Cython code in `sage.functions.prime_pi`\n with calls to functions in `sage.interface.primecount`\n \n+Will be fixed by #32894\n \n \n \n \n+\n``````\n",
    "created_at": "2021-11-25T13:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380122",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,7 +27,9 @@
 Here we take the route of replacing Cython code in `sage.functions.prime_pi`
 with calls to functions in `sage.interface.primecount`
 
+Will be fixed by #32894
 
 
 
 
+
``````




---

archive/issue_events_345303.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-25T13:47:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345303"
}
```



---

archive/issue_events_345304.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-25T13:47:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345304"
}
```



---

archive/issue_events_345305.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-11-25T13:47:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345305"
}
```



---

archive/issue_comments_380123.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nwe will proceed with this on #32894, which includes commits on this ticket's branch.",
    "created_at": "2021-11-25T13:47:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380123",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:41" align="right">comment:41</div>

we will proceed with this on #32894, which includes commits on this ticket's branch.



---

archive/issue_comments_380124.json:
```json
{
    "body": "Changed author from **Dima Pasechnik** to none",
    "created_at": "2021-12-02T18:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24960#issuecomment-380124",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Dima Pasechnik** to none



---

archive/issue_events_345306.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-02T18:57:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345306"
}
```



---

archive/issue_events_345307.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-02T18:57:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345307"
}
```



---

archive/issue_events_345308.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-03T18:41:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345308"
}
```



---

archive/issue_events_345309.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-03T18:41:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24960",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24960#event-345309"
}
```
