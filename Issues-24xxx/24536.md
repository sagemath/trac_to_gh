# Issue 24536: find_local_maximum/minimum() fails with expressions containing complex numbers

archive/issues_024299.json:
```json
{
    "assignees": [],
    "body": "\n```\nsage: find_local_maximum(abs(x+I),-1,1)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-3-f0919e050ec5> in <module>()\n----> 1 find_local_maximum(abs(x+I),-Integer(1),Integer(1))\n\n/home/ralf/sage/src/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3703)()\n    352             True\n    353         \"\"\"\n--> 354         return self.get_object()(*args, **kwds)\n    355 \n    356     def __repr__(self):\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/numerical/optimize.pyc in find_local_maximum(f, a, b, tol, maxfun)\n    143     \"\"\"\n    144     try:\n--> 145         return f.find_local_maximum(a=a, b=b, tol=tol, maxfun=maxfun)\n    146     except AttributeError:\n    147         pass\n\n/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_maximum (build/cythonized/sage/symbolic/expression.cpp:66056)()\n  11680             (0.561090323458081..., 0.857926501456...)\n  11681         \"\"\"\n> 11682         minval, x = (-self).find_local_minimum(a, b, var=var, tol=tol,\n  11683                                                      maxfun=maxfun)\n  11684         return -minval, x\n\n/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_minimum (build/cythonized/sage/symbolic/expression.cpp:66379)()\n  11739         if var is None:\n  11740             var = self.default_variable()\n> 11741         return find_local_minimum(self._fast_float_(var),\n  11742                                         a=a, b=b, tol=tol, maxfun=maxfun )\n  11743 \n\n/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._fast_float_ (build/cythonized/sage/symbolic/expression.cpp:66543)()\n  11762         \"\"\"\n  11763         from sage.symbolic.expression_conversions import fast_float\n> 11764         return fast_float(self, *vars)\n  11765 \n  11766     def _fast_callable_(self, etb):\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in fast_float(ex, *vars)\n   1572         1.4142135623730951\n   1573     \"\"\"\n-> 1574     return FastFloatConverter(ex, *vars)()\n   1575 \n   1576 #################\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n    215             if getattr(self, 'use_fake_div', False) and (operator is _operator.mul or operator is mul_vararg):\n    216                 div = self.get_fake_div(ex)\n--> 217                 return self.arithmetic(div, div.operator())\n    218             return self.arithmetic(ex, operator)\n    219         elif operator in relation_operators:\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)\n   1513         operands = ex.operands()\n   1514         if operator is _operator.neg:\n-> 1515             return operator(self(operands[0]))\n   1516 \n   1517         from sage.rings.all import Rational\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n    224             return self.tuple(ex)\n    225         else:\n--> 226             return self.composition(ex, operator)\n    227 \n    228     def get_fake_div(self, ex):\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in composition(self, ex, operator)\n   1547         \"\"\"\n   1548         f = operator\n-> 1549         g = [self(_) for _ in ex.operands()]\n   1550         try:\n   1551             return f(*g)\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n    216                 div = self.get_fake_div(ex)\n    217                 return self.arithmetic(div, div.operator())\n--> 218             return self.arithmetic(ex, operator)\n    219         elif operator in relation_operators:\n    220             return self.relation(ex, operator)\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)\n   1519             from sage.functions.all import sqrt\n   1520             return sqrt(self(operands[0]))\n-> 1521         fops = map(self, operands)\n   1522         if operator == add_vararg:\n   1523             operator = _operator.add\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n    206         except TypeError as err:\n    207             if 'self must be a numeric expression' not in err.args:\n--> 208                 raise err\n    209 \n    210         operator = ex.operator()\n\nTypeError: unable to coerce to a real number\n```\nThe rethrown error comes from an attempt to do `float(I)`.\n\nThe find_local functions use `FastFloatConverter` to compute values.\n\nAssignee: **@orlitzky**\n\nCC:  @orlitzky\n\nBranch/Commit: **[1fe5795](https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Michael Orlitzky**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24536_\n\n",
    "closed_at": "2022-03-12T15:11:19Z",
    "created_at": "2018-01-14T07:02:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "find_local_maximum/minimum() fails with expressions containing complex numbers",
    "type": "issue",
    "updated_at": "2022-03-12T15:11:19Z",
    "url": "https://github.com/sagemath/sage/issues/24536",
    "user": "https://github.com/rwst"
}
```

```
sage: find_local_maximum(abs(x+I),-1,1)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-f0919e050ec5> in <module>()
----> 1 find_local_maximum(abs(x+I),-Integer(1),Integer(1))

/home/ralf/sage/src/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3703)()
    352             True
    353         """
--> 354         return self.get_object()(*args, **kwds)
    355 
    356     def __repr__(self):

/home/ralf/sage/local/lib/python2.7/site-packages/sage/numerical/optimize.pyc in find_local_maximum(f, a, b, tol, maxfun)
    143     """
    144     try:
--> 145         return f.find_local_maximum(a=a, b=b, tol=tol, maxfun=maxfun)
    146     except AttributeError:
    147         pass

/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_maximum (build/cythonized/sage/symbolic/expression.cpp:66056)()
  11680             (0.561090323458081..., 0.857926501456...)
  11681         """
> 11682         minval, x = (-self).find_local_minimum(a, b, var=var, tol=tol,
  11683                                                      maxfun=maxfun)
  11684         return -minval, x

/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_minimum (build/cythonized/sage/symbolic/expression.cpp:66379)()
  11739         if var is None:
  11740             var = self.default_variable()
> 11741         return find_local_minimum(self._fast_float_(var),
  11742                                         a=a, b=b, tol=tol, maxfun=maxfun )
  11743 

/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._fast_float_ (build/cythonized/sage/symbolic/expression.cpp:66543)()
  11762         """
  11763         from sage.symbolic.expression_conversions import fast_float
> 11764         return fast_float(self, *vars)
  11765 
  11766     def _fast_callable_(self, etb):

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in fast_float(ex, *vars)
   1572         1.4142135623730951
   1573     """
-> 1574     return FastFloatConverter(ex, *vars)()
   1575 
   1576 #################

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
    215             if getattr(self, 'use_fake_div', False) and (operator is _operator.mul or operator is mul_vararg):
    216                 div = self.get_fake_div(ex)
--> 217                 return self.arithmetic(div, div.operator())
    218             return self.arithmetic(ex, operator)
    219         elif operator in relation_operators:

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)
   1513         operands = ex.operands()
   1514         if operator is _operator.neg:
-> 1515             return operator(self(operands[0]))
   1516 
   1517         from sage.rings.all import Rational

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
    224             return self.tuple(ex)
    225         else:
--> 226             return self.composition(ex, operator)
    227 
    228     def get_fake_div(self, ex):

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in composition(self, ex, operator)
   1547         """
   1548         f = operator
-> 1549         g = [self(_) for _ in ex.operands()]
   1550         try:
   1551             return f(*g)

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
    216                 div = self.get_fake_div(ex)
    217                 return self.arithmetic(div, div.operator())
--> 218             return self.arithmetic(ex, operator)
    219         elif operator in relation_operators:
    220             return self.relation(ex, operator)

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)
   1519             from sage.functions.all import sqrt
   1520             return sqrt(self(operands[0]))
-> 1521         fops = map(self, operands)
   1522         if operator == add_vararg:
   1523             operator = _operator.add

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
    206         except TypeError as err:
    207             if 'self must be a numeric expression' not in err.args:
--> 208                 raise err
    209 
    210         operator = ex.operator()

TypeError: unable to coerce to a real number
```
The rethrown error comes from an attempt to do `float(I)`.

The find_local functions use `FastFloatConverter` to compute values.

Assignee: **@orlitzky**

CC:  @orlitzky

Branch/Commit: **[1fe5795](https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870)**

Reviewer: **Matthias Koeppe**

Author: **Michael Orlitzky**

_Issue created by migration from https://trac.sagemath.org/ticket/24536_





---

archive/issue_events_321809.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-14T07:02:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321809"
}
```



---

archive/issue_events_321810.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-14T07:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "component: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321810"
}
```



---

archive/issue_events_321811.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-14T07:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321811"
}
```



---

archive/issue_events_321812.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-14T07:02:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321812"
}
```



---

archive/issue_comments_374212.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n \n ```\n sage: from sage.symbolic.expression_conversions import FastFloatConverter\n-sage: f = FastFloatConverter(I)\n+sage: f = FastFloatConverter(x + I)\n /home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)\n See http://trac.sagemath.org/5930 for details.\n   #!/usr/bin/env python\n@@ -16,3 +16,4 @@\n \n TypeError: unable to coerce to a real number\n ```\n+There is an expression() call somewhere intending substitution which should be replaced in this ticket, as well.\n``````\n",
    "created_at": "2018-01-14T07:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374212",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 
 ```
 sage: from sage.symbolic.expression_conversions import FastFloatConverter
-sage: f = FastFloatConverter(I)
+sage: f = FastFloatConverter(x + I)
 /home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)
 See http://trac.sagemath.org/5930 for details.
   #!/usr/bin/env python
@@ -16,3 +16,4 @@
 
 TypeError: unable to coerce to a real number
 ```
+There is an expression() call somewhere intending substitution which should be replaced in this ticket, as well.
``````




---

archive/issue_comments_374213.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nApparently \"Float\" literally means Python (real) \"float\" not floating-point. Of course then expressions containing `I` raise errors, even if the outcome is real. The original case was the usage by `find_local_maximum`---so that never worked, and the restriction was undocumented.",
    "created_at": "2018-01-14T07:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374213",
    "user": "https://github.com/rwst"
}
```

<div id="comment:2" align="right">Comment 2</div>

Apparently "Float" literally means Python (real) "float" not floating-point. Of course then expressions containing `I` raise errors, even if the outcome is real. The original case was the usage by `find_local_maximum`---so that never worked, and the restriction was undocumented.



---

archive/issue_comments_374214.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,95 @@\n \n ```\n-sage: from sage.symbolic.expression_conversions import FastFloatConverter\n-sage: f = FastFloatConverter(x + I)\n-/home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)\n-See http://trac.sagemath.org/5930 for details.\n-  #!/usr/bin/env python\n-<sage.symbolic.expression_conversions.FastFloatConverter object at 0x7fdec25cf110>\n-sage: f()\n+sage: find_local_maximum(abs(x+I),-1,1)\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-3-f0919e050ec5> in <module>()\n+----> 1 find_local_maximum(abs(x+I),-Integer(1),Integer(1))\n+\n+/home/ralf/sage/src/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3703)()\n+    352             True\n+    353         \"\"\"\n+--> 354         return self.get_object()(*args, **kwds)\n+    355 \n+    356     def __repr__(self):\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/numerical/optimize.pyc in find_local_maximum(f, a, b, tol, maxfun)\n+    143     \"\"\"\n+    144     try:\n+--> 145         return f.find_local_maximum(a=a, b=b, tol=tol, maxfun=maxfun)\n+    146     except AttributeError:\n+    147         pass\n+\n+/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_maximum (build/cythonized/sage/symbolic/expression.cpp:66056)()\n+  11680             (0.561090323458081..., 0.857926501456...)\n+  11681         \"\"\"\n+> 11682         minval, x = (-self).find_local_minimum(a, b, var=var, tol=tol,\n+  11683                                                      maxfun=maxfun)\n+  11684         return -minval, x\n+\n+/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_minimum (build/cythonized/sage/symbolic/expression.cpp:66379)()\n+  11739         if var is None:\n+  11740             var = self.default_variable()\n+> 11741         return find_local_minimum(self._fast_float_(var),\n+  11742                                         a=a, b=b, tol=tol, maxfun=maxfun )\n+  11743 \n+\n+/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._fast_float_ (build/cythonized/sage/symbolic/expression.cpp:66543)()\n+  11762         \"\"\"\n+  11763         from sage.symbolic.expression_conversions import fast_float\n+> 11764         return fast_float(self, *vars)\n+  11765 \n+  11766     def _fast_callable_(self, etb):\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in fast_float(ex, *vars)\n+   1572         1.4142135623730951\n+   1573     \"\"\"\n+-> 1574     return FastFloatConverter(ex, *vars)()\n+   1575 \n+   1576 #################\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n+    215             if getattr(self, 'use_fake_div', False) and (operator is _operator.mul or operator is mul_vararg):\n+    216                 div = self.get_fake_div(ex)\n+--> 217                 return self.arithmetic(div, div.operator())\n+    218             return self.arithmetic(ex, operator)\n+    219         elif operator in relation_operators:\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)\n+   1513         operands = ex.operands()\n+   1514         if operator is _operator.neg:\n+-> 1515             return operator(self(operands[0]))\n+   1516 \n+   1517         from sage.rings.all import Rational\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n+    224             return self.tuple(ex)\n+    225         else:\n+--> 226             return self.composition(ex, operator)\n+    227 \n+    228     def get_fake_div(self, ex):\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in composition(self, ex, operator)\n+   1547         \"\"\"\n+   1548         f = operator\n+-> 1549         g = [self(_) for _ in ex.operands()]\n+   1550         try:\n+   1551             return f(*g)\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n+    216                 div = self.get_fake_div(ex)\n+    217                 return self.arithmetic(div, div.operator())\n+--> 218             return self.arithmetic(ex, operator)\n+    219         elif operator in relation_operators:\n+    220             return self.relation(ex, operator)\n+\n+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)\n+   1519             from sage.functions.all import sqrt\n+   1520             return sqrt(self(operands[0]))\n+-> 1521         fops = map(self, operands)\n+   1522         if operator == add_vararg:\n+   1523             operator = _operator.add\n+\n /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n     206         except TypeError as err:\n     207             if 'self must be a numeric expression' not in err.args:\n@@ -16,4 +99,6 @@\n \n TypeError: unable to coerce to a real number\n ```\n-There is an expression() call somewhere intending substitution which should be replaced in this ticket, as well.\n+The rethrown error comes from an attempt to do `float(I)`.\n+\n+The find_local functions use `FastFloatConverter` to compute values.\n``````\n",
    "created_at": "2018-01-14T07:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374214",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,95 @@
 
 ```
-sage: from sage.symbolic.expression_conversions import FastFloatConverter
-sage: f = FastFloatConverter(x + I)
-/home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)
-See http://trac.sagemath.org/5930 for details.
-  #!/usr/bin/env python
-<sage.symbolic.expression_conversions.FastFloatConverter object at 0x7fdec25cf110>
-sage: f()
+sage: find_local_maximum(abs(x+I),-1,1)
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-3-f0919e050ec5> in <module>()
+----> 1 find_local_maximum(abs(x+I),-Integer(1),Integer(1))
+
+/home/ralf/sage/src/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3703)()
+    352             True
+    353         """
+--> 354         return self.get_object()(*args, **kwds)
+    355 
+    356     def __repr__(self):
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/numerical/optimize.pyc in find_local_maximum(f, a, b, tol, maxfun)
+    143     """
+    144     try:
+--> 145         return f.find_local_maximum(a=a, b=b, tol=tol, maxfun=maxfun)
+    146     except AttributeError:
+    147         pass
+
+/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_maximum (build/cythonized/sage/symbolic/expression.cpp:66056)()
+  11680             (0.561090323458081..., 0.857926501456...)
+  11681         """
+> 11682         minval, x = (-self).find_local_minimum(a, b, var=var, tol=tol,
+  11683                                                      maxfun=maxfun)
+  11684         return -minval, x
+
+/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.find_local_minimum (build/cythonized/sage/symbolic/expression.cpp:66379)()
+  11739         if var is None:
+  11740             var = self.default_variable()
+> 11741         return find_local_minimum(self._fast_float_(var),
+  11742                                         a=a, b=b, tol=tol, maxfun=maxfun )
+  11743 
+
+/home/ralf/sage/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._fast_float_ (build/cythonized/sage/symbolic/expression.cpp:66543)()
+  11762         """
+  11763         from sage.symbolic.expression_conversions import fast_float
+> 11764         return fast_float(self, *vars)
+  11765 
+  11766     def _fast_callable_(self, etb):
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in fast_float(ex, *vars)
+   1572         1.4142135623730951
+   1573     """
+-> 1574     return FastFloatConverter(ex, *vars)()
+   1575 
+   1576 #################
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
+    215             if getattr(self, 'use_fake_div', False) and (operator is _operator.mul or operator is mul_vararg):
+    216                 div = self.get_fake_div(ex)
+--> 217                 return self.arithmetic(div, div.operator())
+    218             return self.arithmetic(ex, operator)
+    219         elif operator in relation_operators:
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)
+   1513         operands = ex.operands()
+   1514         if operator is _operator.neg:
+-> 1515             return operator(self(operands[0]))
+   1516 
+   1517         from sage.rings.all import Rational
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
+    224             return self.tuple(ex)
+    225         else:
+--> 226             return self.composition(ex, operator)
+    227 
+    228     def get_fake_div(self, ex):
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in composition(self, ex, operator)
+   1547         """
+   1548         f = operator
+-> 1549         g = [self(_) for _ in ex.operands()]
+   1550         try:
+   1551             return f(*g)
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
+    216                 div = self.get_fake_div(ex)
+    217                 return self.arithmetic(div, div.operator())
+--> 218             return self.arithmetic(ex, operator)
+    219         elif operator in relation_operators:
+    220             return self.relation(ex, operator)
+
+/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)
+   1519             from sage.functions.all import sqrt
+   1520             return sqrt(self(operands[0]))
+-> 1521         fops = map(self, operands)
+   1522         if operator == add_vararg:
+   1523             operator = _operator.add
+
 /home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
     206         except TypeError as err:
     207             if 'self must be a numeric expression' not in err.args:
@@ -16,4 +99,6 @@
 
 TypeError: unable to coerce to a real number
 ```
-There is an expression() call somewhere intending substitution which should be replaced in this ticket, as well.
+The rethrown error comes from an attempt to do `float(I)`.
+
+The find_local functions use `FastFloatConverter` to compute values.
``````




---

archive/issue_events_321813.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-01-14T07:33:53Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "title_is": "find_local_maximum/minimum() fails with expressions containing complex numbers",
    "title_was": "FastFloatConverter fails to convert complex I",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321813"
}
```



---

archive/issue_comments_374215.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nThe documentation of `fast_float` states\n\n```\ndef fast_float(ex, *vars):\n    \"\"\"\n    Returns an object which provides fast floating point evaluation of\n    the symbolic expression *ex*.\n```\nbut\n\n```\nsage: from sage.symbolic.expression_conversions import fast_float\nsage: ff = fast_float(abs(x+I))\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py:1574: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)\nSee http://trac.sagemath.org/5930 for details.\n  return FastFloatConverter(ex, *vars)()\n```\ngives the ticket error.",
    "created_at": "2018-01-14T07:43:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374215",
    "user": "https://github.com/rwst"
}
```

<div id="comment:4" align="right">Comment 4</div>

The documentation of `fast_float` states

```
def fast_float(ex, *vars):
    """
    Returns an object which provides fast floating point evaluation of
    the symbolic expression *ex*.
```
but

```
sage: from sage.symbolic.expression_conversions import fast_float
sage: ff = fast_float(abs(x+I))
/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.py:1574: DeprecationWarning: Substitution using function-call syntax and unnamed arguments is deprecated and will be removed from a future release of Sage; you can use named arguments instead, like EXPR(x=..., y=...)
See http://trac.sagemath.org/5930 for details.
  return FastFloatConverter(ex, *vars)()
```
gives the ticket error.



---

archive/issue_comments_374216.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nRelevant: #5572. Somewhat related: #13559, #16899.",
    "created_at": "2018-01-14T07:57:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374216",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">Comment 5</div>

Relevant: #5572. Somewhat related: #13559, #16899.



---

archive/issue_comments_374217.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nNote that changing the call from `find_local_maximum(abs(x+I),-1,1)` to\n\n```\nfind_local_maximum(lambda x: abs(x+I),-1,1)\n```\n\nThen everything works fine.",
    "created_at": "2019-02-13T14:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374217",
    "user": "https://github.com/johanrosenkilde"
}
```

<div id="comment:6" align="right">Comment 6</div>

Note that changing the call from `find_local_maximum(abs(x+I),-1,1)` to

```
find_local_maximum(lambda x: abs(x+I),-1,1)
```

Then everything works fine.



---

archive/issue_comments_374218.json:
```json
{
    "body": "Dependencies: **#32234**",
    "created_at": "2021-07-22T00:52:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374218",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#32234**



---

archive/issue_events_321814.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-22T00:52:29Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321814"
}
```



---

archive/issue_events_321815.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-22T00:52:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321815"
}
```



---

archive/issue_events_321816.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-22T00:52:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321816"
}
```



---

archive/issue_comments_374219.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nThe fix for this will be similar to the one in #8450. After #32234, we're using `fast_callable()` on these expressions with `domain=float`, which converts all *intermediate* expression-evaluation results to `float`. Obviously that causes problems with the `x+I` in `abs(x+I)`. To work around that, we can probably just run the computation with `domain=CDF` and then convert the answer to `float` if its imaginary part is small enough. (But we don't want to return NaN if the end result has a nontrivial imaginary part, like we do when plotting.)",
    "created_at": "2021-07-29T13:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374219",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:8" align="right">Comment 8</div>

The fix for this will be similar to the one in #8450. After #32234, we're using `fast_callable()` on these expressions with `domain=float`, which converts all *intermediate* expression-evaluation results to `float`. Obviously that causes problems with the `x+I` in `abs(x+I)`. To work around that, we can probably just run the computation with `domain=CDF` and then convert the answer to `float` if its imaginary part is small enough. (But we don't want to return NaN if the end result has a nontrivial imaginary part, like we do when plotting.)



---

archive/issue_comments_374220.json:
```json
{
    "body": "Assignee: **@orlitzky**",
    "created_at": "2021-07-29T13:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374220",
    "user": "https://github.com/orlitzky"
}
```

Assignee: **@orlitzky**



---

archive/issue_comments_374221.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nI'll deal with it once the prereqs start to settle.",
    "created_at": "2021-07-29T13:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374221",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:9" align="right">Comment 9</div>

I'll deal with it once the prereqs start to settle.



---

archive/issue_events_321817.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-29T13:24:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321817"
}
```



---

archive/issue_events_321818.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2021-07-29T13:24:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321818"
}
```



---

archive/issue_events_321819.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321819"
}
```



---

archive/issue_events_321820.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321820"
}
```



---

archive/issue_events_321821.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321821"
}
```



---

archive/issue_events_321822.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321822"
}
```



---

archive/issue_comments_374222.json:
```json
{
    "body": "Branch: **[u/mjo/ticket/24536](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/24536)**",
    "created_at": "2022-02-24T17:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374222",
    "user": "https://github.com/orlitzky"
}
```

Branch: **[u/mjo/ticket/24536](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/24536)**



---

archive/issue_events_321823.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-24T17:17:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321823"
}
```



---

archive/issue_events_321824.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-02-24T17:17:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321824"
}
```



---

archive/issue_comments_374223.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nAs promised, I've factored out a superclass of the `FastCallablePlotWrapper` that won't ignore complex results and will instead raise an error. This is more suitable for functions like `find_root()` and `find_local_minimum()` where a complex result can't really be ignored.\n\nThose two functions (and the \"maximum\" alias) have been updated, but I'm sure there are others where the same strategy can easily be applied.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/925dcf072be7a639e7932319f8ddbdb7bd63f59b\">925dcf0</a></td><td><code>Trac #24536: factor out a FastCallableFloatWrapper class from plots.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b8364b53778d61613c2a1134b540a056251138a\">3b8364b</a></td><td><code>Trac #24536: support complex expressions in find_{root,local_minimum}.</code></td></tr></table>\n",
    "created_at": "2022-02-24T17:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374223",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:13" align="right">Comment 13</div>

As promised, I've factored out a superclass of the `FastCallablePlotWrapper` that won't ignore complex results and will instead raise an error. This is more suitable for functions like `find_root()` and `find_local_minimum()` where a complex result can't really be ignored.

Those two functions (and the "maximum" alias) have been updated, but I'm sure there are others where the same strategy can easily be applied.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/925dcf072be7a639e7932319f8ddbdb7bd63f59b">925dcf0</a></td><td><code>Trac #24536: factor out a FastCallableFloatWrapper class from plots.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b8364b53778d61613c2a1134b540a056251138a">3b8364b</a></td><td><code>Trac #24536: support complex expressions in find_{root,local_minimum}.</code></td></tr></table>




---

archive/issue_comments_374224.json:
```json
{
    "body": "Changed dependencies from **#32234** to none",
    "created_at": "2022-02-24T17:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374224",
    "user": "https://github.com/orlitzky"
}
```

Changed dependencies from **#32234** to none



---

archive/issue_comments_374225.json:
```json
{
    "body": "Commit: **[3b8364b](https://github.com/sagemath/sagetrac-mirror/commit/3b8364b53778d61613c2a1134b540a056251138a)**",
    "created_at": "2022-02-24T17:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374225",
    "user": "https://github.com/orlitzky"
}
```

Commit: **[3b8364b](https://github.com/sagemath/sagetrac-mirror/commit/3b8364b53778d61613c2a1134b540a056251138a)**



---

archive/issue_comments_374226.json:
```json
{
    "body": "Author: **Michael Orlitzky**",
    "created_at": "2022-02-24T17:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374226",
    "user": "https://github.com/orlitzky"
}
```

Author: **Michael Orlitzky**



---

archive/issue_comments_374227.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\n\n```\n+      * ``CDF`` has none of the other issues, because ``CDF`` has its\n+        own specialized interpreter, a lexicographic ordering (for\n+        min/max),\n```\n\nShould we (in a separate ticket) get rid of this ordering? It's in contrast to python3's built-in `complex`:\n\n```\nsage: CDF(1+2*I) < CDF(1-2*I)\nFalse\nsage: complex(1+2*I) < complex(1-2*I)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-3575b3aa8341> in <module>\n----> 1 complex(Integer(1)+Integer(2)*I) < complex(Integer(1)-Integer(2)*I)\n\nTypeError: '<' not supported between instances of 'complex' and 'complex'\n```",
    "created_at": "2022-02-24T18:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374227",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">Comment 14</div>


```
+      * ``CDF`` has none of the other issues, because ``CDF`` has its
+        own specialized interpreter, a lexicographic ordering (for
+        min/max),
```

Should we (in a separate ticket) get rid of this ordering? It's in contrast to python3's built-in `complex`:

```
sage: CDF(1+2*I) < CDF(1-2*I)
False
sage: complex(1+2*I) < complex(1-2*I)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-3575b3aa8341> in <module>
----> 1 complex(Integer(1)+Integer(2)*I) < complex(Integer(1)-Integer(2)*I)

TypeError: '<' not supported between instances of 'complex' and 'complex'
```



---

archive/issue_comments_374228.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@mkoeppe](#comment%3A14):\n> \n> Should we (in a separate ticket) get rid of this ordering? It's in contrast to python3's built-in `complex`:\n\nI wonder why it was added? Someone had to go to the trouble. In any case, we'd have to find some other solution for these wrappers if the ordering was removed. Right now we're fortunate that CDF reasonably handles everything that people want to do with real numbers, so long as the imaginary parts are small.",
    "created_at": "2022-02-24T18:54:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374228",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@mkoeppe](#comment%3A14):
> 
> Should we (in a separate ticket) get rid of this ordering? It's in contrast to python3's built-in `complex`:

I wonder why it was added? Someone had to go to the trouble. In any case, we'd have to find some other solution for these wrappers if the ordering was removed. Right now we're fortunate that CDF reasonably handles everything that people want to do with real numbers, so long as the imaginary parts are small.



---

archive/issue_comments_374229.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nI think it's just a leftover of python 2 semantics in which everything could be compared with everything",
    "created_at": "2022-02-24T18:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374229",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">Comment 16</div>

I think it's just a leftover of python 2 semantics in which everything could be compared with everything



---

archive/issue_comments_374230.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nSimilar issue for number field elements - in ticket #20028",
    "created_at": "2022-02-25T06:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374230",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">Comment 17</div>

Similar issue for number field elements - in ticket #20028



---

archive/issue_comments_374231.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nI've opened #33417",
    "created_at": "2022-02-25T18:26:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374231",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">Comment 18</div>

I've opened #33417



---

archive/issue_comments_374232.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40a7012da23bc5fa2beee1418ed81e8a35d7218d\">40a7012</a></td><td><code>Trac #24536: add backwards-compatibility case for \"complex nan.\"</code></td></tr></table>\n",
    "created_at": "2022-02-25T22:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374232",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19" align="right">Comment 19</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40a7012da23bc5fa2beee1418ed81e8a35d7218d">40a7012</a></td><td><code>Trac #24536: add backwards-compatibility case for "complex nan."</code></td></tr></table>




---

archive/issue_comments_374233.json:
```json
{
    "body": "Changed commit from **[3b8364b](https://github.com/sagemath/sagetrac-mirror/commit/3b8364b53778d61613c2a1134b540a056251138a)** to **[40a7012](https://github.com/sagemath/sagetrac-mirror/commit/40a7012da23bc5fa2beee1418ed81e8a35d7218d)**",
    "created_at": "2022-02-25T22:22:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374233",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3b8364b](https://github.com/sagemath/sagetrac-mirror/commit/3b8364b53778d61613c2a1134b540a056251138a)** to **[40a7012](https://github.com/sagemath/sagetrac-mirror/commit/40a7012da23bc5fa2beee1418ed81e8a35d7218d)**



---

archive/issue_comments_374234.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nMaybe a better name can be found for `FastCallablePlotWrapper` that expresses better what it does?",
    "created_at": "2022-02-26T17:49:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374234",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">Comment 20</div>

Maybe a better name can be found for `FastCallablePlotWrapper` that expresses better what it does?



---

archive/issue_comments_374235.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI haven't looked at the code in much detail yet, but `FastCallablePlotWrapper` inherits from `FastCallableFloatWrapper`, but also you are double-wrapping `var` here:\n\n```\n+        from sage.ext.fast_callable import FastCallableFloatWrapper\n+        f = self._plot_fast_callable(var)\n+        ff = FastCallableFloatWrapper(f, imag_tol=imaginary_tolerance)\n```\nIs this needed?",
    "created_at": "2022-02-26T17:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374235",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">Comment 21</div>

I haven't looked at the code in much detail yet, but `FastCallablePlotWrapper` inherits from `FastCallableFloatWrapper`, but also you are double-wrapping `var` here:

```
+        from sage.ext.fast_callable import FastCallableFloatWrapper
+        f = self._plot_fast_callable(var)
+        ff = FastCallableFloatWrapper(f, imag_tol=imaginary_tolerance)
```
Is this needed?



---

archive/issue_comments_374236.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nReplying to [@mkoeppe](#comment%3A21):\n> I haven't looked at the code in much detail yet, but `FastCallablePlotWrapper` inherits from `FastCallableFloatWrapper`, but also you are double-wrapping `var` here:\n> \n> ```\n> +        from sage.ext.fast_callable import FastCallableFloatWrapper\n> +        f = self._plot_fast_callable(var)\n> +        ff = FastCallableFloatWrapper(f, imag_tol=imaginary_tolerance)\n> ```\n> Is this needed?\n\nThe `_plot_fast_callable()` method returns only a fast-callable over CDF, not a wrapper. When plotting, the wrapper is added during `setup_for_eval_on_grid()` to support fast-callables that don't arise from `expr.plot()`. Given that, if `_plot_fast_callable()` returned a wrapper, 'we would eventually try to wrap it twice during `expr.plot()`.",
    "created_at": "2022-02-26T21:30:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374236",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:22" align="right">Comment 22</div>

Replying to [@mkoeppe](#comment%3A21):
> I haven't looked at the code in much detail yet, but `FastCallablePlotWrapper` inherits from `FastCallableFloatWrapper`, but also you are double-wrapping `var` here:
> 
> ```
> +        from sage.ext.fast_callable import FastCallableFloatWrapper
> +        f = self._plot_fast_callable(var)
> +        ff = FastCallableFloatWrapper(f, imag_tol=imaginary_tolerance)
> ```
> Is this needed?

The `_plot_fast_callable()` method returns only a fast-callable over CDF, not a wrapper. When plotting, the wrapper is added during `setup_for_eval_on_grid()` to support fast-callables that don't arise from `expr.plot()`. Given that, if `_plot_fast_callable()` returned a wrapper, 'we would eventually try to wrap it twice during `expr.plot()`.



---

archive/issue_comments_374237.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@mkoeppe](#comment%3A20):\n> Maybe a better name can be found for `FastCallablePlotWrapper` that expresses better what it does?\n\nSo you're not satisfied with solving easy problems all day? =)\n\nIt's awkward, and I'm open to suggestions.\n\nI think the original name that I chose for the plotting wrapper was `FastCallableOutputWrapper`, which is more or less what it does. It wraps a fast-callable, and converts its output to... something else. But I was already aware that this ticket was going to require a different wrapping behavior. Since the behavior of the plot wrapper (returning `NaN` when it gets a complex answer) is so unique to plotting, I settled on `FastCallablePlotWrapper`.\n\nThe class for this ticket then sits beneath an abstract `FastCallableOutputWrapper` in my head. Unlike the plot wrapper, it doesn't do anything unusual during conversion, so it would rightly sit beside sibling classes such as `FastCallableComplexWrapper` or `FastCallableIntWrapper`.\n\nI thought about naming this class `FastCallableFloatOutputWrapper`, and maybe that's a better choice, since \"Plot\" isn't what the \"Plot\" wrapper outputs. It's just so looooooooong.",
    "created_at": "2022-02-26T21:42:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374237",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@mkoeppe](#comment%3A20):
> Maybe a better name can be found for `FastCallablePlotWrapper` that expresses better what it does?

So you're not satisfied with solving easy problems all day? =)

It's awkward, and I'm open to suggestions.

I think the original name that I chose for the plotting wrapper was `FastCallableOutputWrapper`, which is more or less what it does. It wraps a fast-callable, and converts its output to... something else. But I was already aware that this ticket was going to require a different wrapping behavior. Since the behavior of the plot wrapper (returning `NaN` when it gets a complex answer) is so unique to plotting, I settled on `FastCallablePlotWrapper`.

The class for this ticket then sits beneath an abstract `FastCallableOutputWrapper` in my head. Unlike the plot wrapper, it doesn't do anything unusual during conversion, so it would rightly sit beside sibling classes such as `FastCallableComplexWrapper` or `FastCallableIntWrapper`.

I thought about naming this class `FastCallableFloatOutputWrapper`, and maybe that's a better choice, since "Plot" isn't what the "Plot" wrapper outputs. It's just so looooooooong.



---

archive/issue_comments_374238.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nIn the implementation of `FastCallableFloatWrapper` I don't really see anything that is specific to using a fast callable. Perhaps it would make sense to generalize the concept, to get to a more manageable naming scheme?",
    "created_at": "2022-02-26T22:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374238",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">Comment 24</div>

In the implementation of `FastCallableFloatWrapper` I don't really see anything that is specific to using a fast callable. Perhaps it would make sense to generalize the concept, to get to a more manageable naming scheme?



---

archive/issue_comments_374239.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReplying to [@mkoeppe](#comment%3A24):\n> In the implementation of `FastCallableFloatWrapper` I don't really see anything that is specific to using a fast callable. Perhaps it would make sense to generalize the concept, to get to a more manageable naming scheme?\n\nHow about `UnembedFloatFromCDF` and `UnembedPlotFloatFromCDF`?\n\nFor now we could also do `UnembedFloatFromCDF(nan_on_error=<bool>)` to cover both cases, but then if the class hierarchy is ever extended upwards or laterally, the `nan_on_error` parameter isn't going to be consistent.",
    "created_at": "2022-02-27T15:24:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374239",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:25" align="right">Comment 25</div>

Replying to [@mkoeppe](#comment%3A24):
> In the implementation of `FastCallableFloatWrapper` I don't really see anything that is specific to using a fast callable. Perhaps it would make sense to generalize the concept, to get to a more manageable naming scheme?

How about `UnembedFloatFromCDF` and `UnembedPlotFloatFromCDF`?

For now we could also do `UnembedFloatFromCDF(nan_on_error=<bool>)` to cover both cases, but then if the class hierarchy is ever extended upwards or laterally, the `nan_on_error` parameter isn't going to be consistent.



---

archive/issue_comments_374240.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nSo this should be `CDF.coerce_map_from(float).section()`?",
    "created_at": "2022-02-27T17:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374240",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">Comment 26</div>

So this should be `CDF.coerce_map_from(float).section()`?



---

archive/issue_comments_374241.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nNumPy has https://numpy.org/doc/stable/reference/generated/numpy.real_if_close.html",
    "created_at": "2022-02-27T18:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374241",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">Comment 27</div>

NumPy has https://numpy.org/doc/stable/reference/generated/numpy.real_if_close.html



---

archive/issue_comments_374242.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nReplying to [@mkoeppe](#comment%3A26):\n> So this should be `CDF.coerce_map_from(float).section()`?\n\nIn spirit, but with a tolerance, so that the the underlying routine doesn't crash when numerical issues cause a `0.0000000000001*I` to appear. Additionally, in the plotting class, we choose to return `nan` upon encountering a complex result so that the corresponding point is \"skipped.\"",
    "created_at": "2022-02-27T18:24:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374242",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:28" align="right">Comment 28</div>

Replying to [@mkoeppe](#comment%3A26):
> So this should be `CDF.coerce_map_from(float).section()`?

In spirit, but with a tolerance, so that the the underlying routine doesn't crash when numerical issues cause a `0.0000000000001*I` to appear. Additionally, in the plotting class, we choose to return `nan` upon encountering a complex result so that the corresponding point is "skipped."



---

archive/issue_comments_374243.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nYes, so we would have a signaling and a non-signaling version of it",
    "created_at": "2022-02-27T18:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374243",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">Comment 29</div>

Yes, so we would have a signaling and a non-signaling version of it



---

archive/issue_comments_374244.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nSome more random facts:\n\n```\nsage: numpy.real(complex(CDF(1,1)))\n1.0\nsage: numpy.real(CDF(1,1))\n<built-in method real of sage.rings.complex_double.ComplexDoubleElement object at 0x1526bc8c0>\n```\n:(",
    "created_at": "2022-02-27T18:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374244",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">Comment 30</div>

Some more random facts:

```
sage: numpy.real(complex(CDF(1,1)))
1.0
sage: numpy.real(CDF(1,1))
<built-in method real of sage.rings.complex_double.ComplexDoubleElement object at 0x1526bc8c0>
```
:(



---

archive/issue_comments_374245.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nReplying to [@mkoeppe](#comment%3A27):\n> NumPy has https://numpy.org/doc/stable/reference/generated/numpy.real_if_close.html\n\nThat would basically work here, although I think it might be slower to go from CDF through numpy and back. The main downside to that though is that the error message will be thrown deep in some plotting or optimization routine when it receives a complex number. In the current branch I've chosen to raise an error immediately, in the wrapper, \"ValueError: complex fast-callable function result...\" that is usually going to better explain the problem.",
    "created_at": "2022-02-27T18:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374245",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:31" align="right">Comment 31</div>

Replying to [@mkoeppe](#comment%3A27):
> NumPy has https://numpy.org/doc/stable/reference/generated/numpy.real_if_close.html

That would basically work here, although I think it might be slower to go from CDF through numpy and back. The main downside to that though is that the error message will be thrown deep in some plotting or optimization routine when it receives a complex number. In the current branch I've chosen to raise an error immediately, in the wrapper, "ValueError: complex fast-callable function result..." that is usually going to better explain the problem.



---

archive/issue_comments_374246.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nI didn't mean to say that we should use this numpy function. Just collecting existing idioms and interfaces.\n\nI was looking for a name for this operation (\"convert to float if close to a real number, NaN otherwise) - and so far haven't found anything in Python, NumPy, C++ reference, ...",
    "created_at": "2022-02-27T18:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374246",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">Comment 32</div>

I didn't mean to say that we should use this numpy function. Just collecting existing idioms and interfaces.

I was looking for a name for this operation ("convert to float if close to a real number, NaN otherwise) - and so far haven't found anything in Python, NumPy, C++ reference, ...



---

archive/issue_comments_374247.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nI guess one would need to figure out what complex infinities should convert to.",
    "created_at": "2022-02-27T18:46:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374247",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">Comment 33</div>

I guess one would need to figure out what complex infinities should convert to.



---

archive/issue_comments_374248.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nAlso relevant: https://docs.python.org/3/library/cmath.html#cmath.isclose (which accepts both `rel_tol` and `abs_tol`). \"The IEEE 754 special values of NaN, inf, and -inf will be handled according to IEEE rules. Specifically, [...] inf and -inf are only considered close to themselves.\" - this forgets to talk about complex infinities.",
    "created_at": "2022-02-27T18:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374248",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">Comment 34</div>

Also relevant: https://docs.python.org/3/library/cmath.html#cmath.isclose (which accepts both `rel_tol` and `abs_tol`). "The IEEE 754 special values of NaN, inf, and -inf will be handled according to IEEE rules. Specifically, [...] inf and -inf are only considered close to themselves." - this forgets to talk about complex infinities.



---

archive/issue_comments_374249.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nNot sure how well developed the built-in `complex` type is:\n\n```\nsage: cmath.inf + float(1e-16)*cmath.infj\n(nan+infj)\n```\n??",
    "created_at": "2022-02-27T18:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374249",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">Comment 35</div>

Not sure how well developed the built-in `complex` type is:

```
sage: cmath.inf + float(1e-16)*cmath.infj
(nan+infj)
```
??



---

archive/issue_comments_374250.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nOK that's https://bugs.python.org/issue25453, open since 2015",
    "created_at": "2022-02-27T19:10:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374250",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">Comment 36</div>

OK that's https://bugs.python.org/issue25453, open since 2015



---

archive/issue_comments_374251.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nHere's another one:\n\n```\nsage: cmath.rect(math.inf, 0)\n(inf+0j)\nsage: cmath.rect(1, math.pi/4)\n(0.7071067811865476+0.7071067811865475j)\nsage: cmath.rect(math.inf, math.pi/4)\n(inf+infj)\nsage: cmath.rect(math.inf, pi/2)\n(inf+infj)                             # What?\nsage: cmath.rect(math.inf, 2*pi)\n(inf-infj)                             # Help?!\n```\nhttps://docs.python.org/3/library/cmath.html#cmath.rect",
    "created_at": "2022-02-27T19:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374251",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">Comment 37</div>

Here's another one:

```
sage: cmath.rect(math.inf, 0)
(inf+0j)
sage: cmath.rect(1, math.pi/4)
(0.7071067811865476+0.7071067811865475j)
sage: cmath.rect(math.inf, math.pi/4)
(inf+infj)
sage: cmath.rect(math.inf, pi/2)
(inf+infj)                             # What?
sage: cmath.rect(math.inf, 2*pi)
(inf-infj)                             # Help?!
```
https://docs.python.org/3/library/cmath.html#cmath.rect



---

archive/issue_comments_374252.json:
```json
{
    "body": "Changed commit from **[40a7012](https://github.com/sagemath/sagetrac-mirror/commit/40a7012da23bc5fa2beee1418ed81e8a35d7218d)** to **[5ef827c](https://github.com/sagemath/sagetrac-mirror/commit/5ef827c6725a5a92303ce257ced4acdbeb75fa8b)**",
    "created_at": "2022-02-28T15:06:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374252",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[40a7012](https://github.com/sagemath/sagetrac-mirror/commit/40a7012da23bc5fa2beee1418ed81e8a35d7218d)** to **[5ef827c](https://github.com/sagemath/sagetrac-mirror/commit/5ef827c6725a5a92303ce257ced4acdbeb75fa8b)**



---

archive/issue_comments_374253.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5ef827c6725a5a92303ce257ced4acdbeb75fa8b\">5ef827c</a></td><td><code>Trac #24536: post-refactoring example wording.</code></td></tr></table>\n",
    "created_at": "2022-02-28T15:06:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374253",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38" align="right">Comment 38</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5ef827c6725a5a92303ce257ced4acdbeb75fa8b">5ef827c</a></td><td><code>Trac #24536: post-refactoring example wording.</code></td></tr></table>




---

archive/issue_events_321825.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-03T06:38:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321825"
}
```



---

archive/issue_events_321826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-03T06:38:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321826"
}
```



---

archive/issue_comments_374254.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nReplying to [@orlitzky](#comment%3A23):\n> Replying to [@mkoeppe](#comment%3A20):\n> > Maybe a better name can be found for `FastCallablePlotWrapper` that expresses better what it does?\n\n> \n> So you're not satisfied with solving easy problems all day? =)\n> \n> It's awkward, and I'm open to suggestions.\n\nLet's postpone this to another ticket. The current branch certainly does what it promises, the implementation looks fine, and tests pass.",
    "created_at": "2022-03-03T06:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374254",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">Comment 39</div>

Replying to [@orlitzky](#comment%3A23):
> Replying to [@mkoeppe](#comment%3A20):
> > Maybe a better name can be found for `FastCallablePlotWrapper` that expresses better what it does?

> 
> So you're not satisfied with solving easy problems all day? =)
> 
> It's awkward, and I'm open to suggestions.

Let's postpone this to another ticket. The current branch certainly does what it promises, the implementation looks fine, and tests pass.



---

archive/issue_comments_374255.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2022-03-03T06:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374255",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_321827.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-06T23:35:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321827"
}
```



---

archive/issue_events_321828.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-06T23:35:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321828"
}
```



---

archive/issue_comments_374256.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nOn OSX:\n\n```\n**********************************************************************\nFile \"src/doc/de/thematische_anleitungen/sage_gymnasium.rst\", line 534, in doc.de.thematische_anleitungen.sage_gymnasium\nFailed example:\n    find_root(f, 0.5, 5)\nExpected:\n    0.6299605249475858\nGot:\n    0.6299605249475857\n**********************************************************************\n1 item had failures:\n   1 of 294 in doc.de.thematische_anleitungen.sage_gymnasium\n    [207 tests, 1 failure, 5.86 s]\n**********************************************************************\n```",
    "created_at": "2022-03-06T23:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374256",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:40" align="right">Comment 40</div>

On OSX:

```
**********************************************************************
File "src/doc/de/thematische_anleitungen/sage_gymnasium.rst", line 534, in doc.de.thematische_anleitungen.sage_gymnasium
Failed example:
    find_root(f, 0.5, 5)
Expected:
    0.6299605249475858
Got:
    0.6299605249475857
**********************************************************************
1 item had failures:
   1 of 294 in doc.de.thematische_anleitungen.sage_gymnasium
    [207 tests, 1 failure, 5.86 s]
**********************************************************************
```



---

archive/issue_comments_374257.json:
```json
{
    "body": "Changed commit from **[5ef827c](https://github.com/sagemath/sagetrac-mirror/commit/5ef827c6725a5a92303ce257ced4acdbeb75fa8b)** to **[1fe5795](https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870)**",
    "created_at": "2022-03-08T23:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374257",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5ef827c](https://github.com/sagemath/sagetrac-mirror/commit/5ef827c6725a5a92303ce257ced4acdbeb75fa8b)** to **[1fe5795](https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870)**



---

archive/issue_comments_374258.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/beca5590ee0f49fe299265385b63300a609306f8\">beca559</a></td><td><code>Trac #24536: factor out a FastCallableFloatWrapper class from plots.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d5cb78f8be30072a31f4be05c0217e5623bb882\">9d5cb78</a></td><td><code>Trac #24536: support complex expressions in find_{root,local_minimum}.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9c338ea309da15ddea7327287d10f5f6f49b120\">b9c338e</a></td><td><code>Trac #24536: add backwards-compatibility case for \"complex nan.\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b786f529b5c72b0efec2ca08c29e95e89ad0d3c2\">b786f52</a></td><td><code>Trac #24536: post-refactoring example wording.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870\">1fe5795</a></td><td><code>Trac #24536: add \"abs tol\" to a finicky doctest.</code></td></tr></table>\n",
    "created_at": "2022-03-08T23:36:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374258",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41" align="right">Comment 41</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/beca5590ee0f49fe299265385b63300a609306f8">beca559</a></td><td><code>Trac #24536: factor out a FastCallableFloatWrapper class from plots.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d5cb78f8be30072a31f4be05c0217e5623bb882">9d5cb78</a></td><td><code>Trac #24536: support complex expressions in find_{root,local_minimum}.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9c338ea309da15ddea7327287d10f5f6f49b120">b9c338e</a></td><td><code>Trac #24536: add backwards-compatibility case for "complex nan."</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b786f529b5c72b0efec2ca08c29e95e89ad0d3c2">b786f52</a></td><td><code>Trac #24536: post-refactoring example wording.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870">1fe5795</a></td><td><code>Trac #24536: add "abs tol" to a finicky doctest.</code></td></tr></table>




---

archive/issue_events_321829.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-03-08T23:38:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321829"
}
```



---

archive/issue_events_321830.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2022-03-08T23:38:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321830"
}
```



---

archive/issue_comments_374259.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nUntested (no macOS), but that should take care of it.",
    "created_at": "2022-03-08T23:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374259",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:42" align="right">Comment 42</div>

Untested (no macOS), but that should take care of it.



---

archive/issue_events_321831.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-08T23:55:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321831"
}
```



---

archive/issue_events_321832.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-08T23:55:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321832"
}
```



---

archive/issue_comments_374260.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/24536](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/24536)** to **[1fe5795](https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870)**",
    "created_at": "2022-03-12T15:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24536#issuecomment-374260",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mjo/ticket/24536](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/24536)** to **[1fe5795](https://github.com/sagemath/sagetrac-mirror/commit/1fe579508146d7b20dda6aac2c4beeca6d335870)**



---

archive/issue_events_321833.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-03-12T15:11:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321833"
}
```



---

archive/issue_events_321834.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4842b3b99048c3c6c0ab3c222dd52dc275809fff",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2022-03-12T15:11:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24536",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24536#event-321834"
}
```
