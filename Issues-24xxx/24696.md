# Issue 24696: giac fails to compile with clang-3.8 on OpenSuSE

archive/issues_024459.json:
```json
{
    "body": "`hash_map` is not part of the C++ standard library. Some compilers like GCC implement it anyway. However clang does not have it, leading to compile failure with `CC=clang` on OpenSuSE Leap 42.3:\n\n```\nIn file included from input_lexer.ll:48:\nIn file included from ./giacPCH.h:8:\n./index.h:571:11: error: no template named 'hash_map' in namespace 'std'; did yo\nu mean '__gnu_cxx::hash_map'?\n  typedef std::hash_map< index_t,index_m,hash_function_object > hash_index ;\n          ^~~~~~~~~~~~~\n          `__gnu_`cxx::hash_map\n/usr/bin/../lib64/gcc/x86_64-suse-linux/4.8/../../../../include/c++/4.8/backward\n/hash_map:83:11: note: '__gnu_cxx::hash_map' declared here\n    class hash_map\n          ^\n```\nInstead `unordered_map` should be used.\n\nSee also https://stackoverflow.com/questions/5908581/is-hash-map-part-of-the-stl\n\n**CC:**  @frederichan-IMJPRG\n\n**Branch/Commit:** [0c38a837152312c3b2c79f287812805dd91673df](https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Ralf Stephan\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24696\n\n",
    "closed_at": "2018-02-13T08:10:52Z",
    "created_at": "2018-02-09T15:28:22Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "giac fails to compile with clang-3.8 on OpenSuSE",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24696",
    "user": "https://github.com/rwst"
}
```
`hash_map` is not part of the C++ standard library. Some compilers like GCC implement it anyway. However clang does not have it, leading to compile failure with `CC=clang` on OpenSuSE Leap 42.3:

```
In file included from input_lexer.ll:48:
In file included from ./giacPCH.h:8:
./index.h:571:11: error: no template named 'hash_map' in namespace 'std'; did yo
u mean '__gnu_cxx::hash_map'?
  typedef std::hash_map< index_t,index_m,hash_function_object > hash_index ;
          ^~~~~~~~~~~~~
          `__gnu_`cxx::hash_map
/usr/bin/../lib64/gcc/x86_64-suse-linux/4.8/../../../../include/c++/4.8/backward
/hash_map:83:11: note: '__gnu_cxx::hash_map' declared here
    class hash_map
          ^
```
Instead `unordered_map` should be used.

See also https://stackoverflow.com/questions/5908581/is-hash-map-part-of-the-stl

**CC:**  @frederichan-IMJPRG

**Branch/Commit:** [0c38a837152312c3b2c79f287812805dd91673df](https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df)

**Reviewer:** Jeroen Demeyer

**Author:** Ralf Stephan

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/24696





---

archive/issue_comments_471124.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-`hash_map` was deprecated with C++11 but is still available with gcc installations, e.g., in `/usr/bin/../lib64/gcc/x86_64-suse-linux/4.8/../../../../include/c++/4.8/backward/hash_map:83`. That's presumably why there was no need for giac authors to switch to `unordered_map`. However clang installations do not have it or pick it out of gcc include paths, leading to compile failure with `CC=clang` on OpenSuSE Leap 42.3:\n+`hash_map` is not part of the C++ standard library. Some compilers like GCC implement it anyway. However clang does not have it, leading to compile failure with `CC=clang` on OpenSuSE Leap 42.3:\n \n ```\n In file included from input_lexer.ll:48:\n@@ -13,4 +13,6 @@\n     class hash_map\n           ^\n ```\n-Possibly a missing system package should be installed, or a shell compile option be added? Ultimately however `unordered_map` should be used.\n+Instead `unordered_map` should be used.\n+\n+See also https://stackoverflow.com/questions/5908581/is-hash-map-part-of-the-stl\n``````\n",
    "created_at": "2018-02-09T15:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471124",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-`hash_map` was deprecated with C++11 but is still available with gcc installations, e.g., in `/usr/bin/../lib64/gcc/x86_64-suse-linux/4.8/../../../../include/c++/4.8/backward/hash_map:83`. That's presumably why there was no need for giac authors to switch to `unordered_map`. However clang installations do not have it or pick it out of gcc include paths, leading to compile failure with `CC=clang` on OpenSuSE Leap 42.3:
+`hash_map` is not part of the C++ standard library. Some compilers like GCC implement it anyway. However clang does not have it, leading to compile failure with `CC=clang` on OpenSuSE Leap 42.3:
 
 ```
 In file included from input_lexer.ll:48:
@@ -13,4 +13,6 @@
     class hash_map
           ^
 ```
-Possibly a missing system package should be installed, or a shell compile option be added? Ultimately however `unordered_map` should be used.
+Instead `unordered_map` should be used.
+
+See also https://stackoverflow.com/questions/5908581/is-hash-map-part-of-the-stl
``````




---

archive/attachments_021028.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "giac-1.4.9.45.p1.log",
    "asset_url": "tarball://root/attachments/some-uuid/ticket24696/giac-1.4.9.45.p1.log",
    "created_at": "2018-02-09T15:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.log",
    "user": "https://github.com/rwst"
}
```



---

archive/issue_comments_471125.json:
```json
{
    "body": "",
    "created_at": "2018-02-09T15:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471125",
    "user": "https://github.com/rwst"
}
```





---

archive/issue_comments_471126.json:
```json
{
    "body": "<a id='comment:2'></a>\nActually giac has involved configure detection of `hash_map`/`unordered_map` presence which just fails here. Part of the log (attached):\n\n```\nchecking for clock_gettime in -lrt... yes\nchecking unordered_map usability... no\nchecking unordered_map presence... no\nchecking for unordered_map... no\nchecking ext/hash_map usability... yes\nchecking ext/hash_map presence... yes\nchecking for ext/hash_map... yes\nchecking tr1/unordered_map usability... yes\nchecking tr1/unordered_map presence... yes\nchecking for tr1/unordered_map... yes\nchecking hash_map usability... yes\nchecking hash_map presence... yes\nchecking for hash_map... yes\nchecking pwd.h usability... yes\n```",
    "created_at": "2018-02-09T15:45:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471126",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
Actually giac has involved configure detection of `hash_map`/`unordered_map` presence which just fails here. Part of the log (attached):

```
checking for clock_gettime in -lrt... yes
checking unordered_map usability... no
checking unordered_map presence... no
checking for unordered_map... no
checking ext/hash_map usability... yes
checking ext/hash_map presence... yes
checking for ext/hash_map... yes
checking tr1/unordered_map usability... yes
checking tr1/unordered_map presence... yes
checking for tr1/unordered_map... yes
checking hash_map usability... yes
checking hash_map presence... yes
checking for hash_map... yes
checking pwd.h usability... yes
```



---

archive/issue_comments_471127.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis snippet in `index.h`:\n\n```\n#if defined UNORDERED_MAP  && !defined(__clang__) && !defined(VISUALC) // && !defined(__APPLE__)\n#include <tr1/unordered_map>\n#define HASH_MAP_NAMESPACE std::tr1\n#define hash_map unordered_map\n#else // UNORDERED_MAP\n```\nand the code in the same file giving the error:\n\n```\n  typedef HASH_MAP_NAMESPACE::hash_map< index_t,index_m,hash_function_object > hash_index ;  \n```",
    "created_at": "2018-02-09T15:52:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471127",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
This snippet in `index.h`:

```
#if defined UNORDERED_MAP  && !defined(__clang__) && !defined(VISUALC) // && !defined(__APPLE__)
#include <tr1/unordered_map>
#define HASH_MAP_NAMESPACE std::tr1
#define hash_map unordered_map
#else // UNORDERED_MAP
```
and the code in the same file giving the error:

```
  typedef HASH_MAP_NAMESPACE::hash_map< index_t,index_m,hash_function_object > hash_index ;  
```



---

archive/issue_comments_471128.json:
```json
{
    "body": "<a id='comment:4'></a>\nThese days, it would be better to just assume C++11 and use `unordered_map`.",
    "created_at": "2018-02-09T16:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471128",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
These days, it would be better to just assume C++11 and use `unordered_map`.



---

archive/issue_comments_471129.json:
```json
{
    "body": "**Branch:** [u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse)",
    "created_at": "2018-02-09T16:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471129",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse)



---

archive/issue_comments_471130.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-02-09T16:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471130",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_471131.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2018-02-09T16:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471131",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_471132.json:
```json
{
    "body": "<a id='comment:6'></a>\nShould be tested on other clang systems.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df\">0c38a83</a></td><td><code>24696: fix hash_map logic</code></td></tr></table>\n",
    "created_at": "2018-02-09T16:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471132",
    "user": "https://github.com/rwst"
}
```

<a id='comment:6'></a>
Should be tested on other clang systems.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df">0c38a83</a></td><td><code>24696: fix hash_map logic</code></td></tr></table>




---

archive/issue_comments_471133.json:
```json
{
    "body": "**Commit:** [0c38a837152312c3b2c79f287812805dd91673df](https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df)",
    "created_at": "2018-02-09T16:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471133",
    "user": "https://github.com/rwst"
}
```

**Commit:** [0c38a837152312c3b2c79f287812805dd91673df](https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df)



---

archive/issue_comments_471134.json:
```json
{
    "body": "<a id='comment:7'></a>\nIf this works for you, I'm willing to set this to positive_review.",
    "created_at": "2018-02-09T16:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471134",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
If this works for you, I'm willing to set this to positive_review.



---

archive/issue_comments_471135.json:
```json
{
    "body": "<a id='comment:8'></a>\nI guess it wasn't seen because we haven't tested a clang that old for some time. Also I think your clang uses libstdc++ from gcc-4.8 while all we made a point of testing with clang's own libstdc++.\nThe fix looks OK but it is really stuff that should be tested in configure, with c++11 you don't need tr1 for unordered map, I battled that in `brial`.",
    "created_at": "2018-02-09T18:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471135",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
I guess it wasn't seen because we haven't tested a clang that old for some time. Also I think your clang uses libstdc++ from gcc-4.8 while all we made a point of testing with clang's own libstdc++.
The fix looks OK but it is really stuff that should be tested in configure, with c++11 you don't need tr1 for unordered map, I battled that in `brial`.



---

archive/issue_comments_471136.json:
```json
{
    "body": "<a id='comment:9'></a>\nJeroen, it works fine, I assume I can set positive?\n\nReplying to [fbissey](#comment%3A8):\n> I guess it wasn't seen because we haven't tested a clang that old for some time. Also I think your clang uses libstdc++ from gcc-4.8 while all we made a point of testing with clang's own libstdc++.\n\n\nRight, they have no official clang libstdc++ package on OpenSuSE.\n\n> The fix looks OK but it is really stuff that should be tested in configure, with c++11 you don't need tr1 for unordered map, I battled that in `brial`.\n\n\nWell, I think it's clearly a giac problem and the patch should be applied upstream. Could you please, @frederichan-IMJPRG?",
    "created_at": "2018-02-10T07:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471136",
    "user": "https://github.com/rwst"
}
```

<a id='comment:9'></a>
Jeroen, it works fine, I assume I can set positive?

Replying to [fbissey](#comment%3A8):
> I guess it wasn't seen because we haven't tested a clang that old for some time. Also I think your clang uses libstdc++ from gcc-4.8 while all we made a point of testing with clang's own libstdc++.


Right, they have no official clang libstdc++ package on OpenSuSE.

> The fix looks OK but it is really stuff that should be tested in configure, with c++11 you don't need tr1 for unordered map, I battled that in `brial`.


Well, I think it's clearly a giac problem and the patch should be applied upstream. Could you please, @frederichan-IMJPRG?



---

archive/issue_comments_471137.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-02-10T07:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471137",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_471138.json:
```json
{
    "body": "<a id='comment:10'></a>\nTo be honest this patch is a band aid. A proper fix is to detect hash_map properly from configure rather applying pragma trying to find compilers you think will support such and such form of the feature. Something a bit like this [https://github.com/BRiAl/BRiAl/commit/510694f702ae074288e2c3fda16fbf49dabb9c36#diff-67e997bcfdac55191033d57a16d1408a](https://github.com/BRiAl/BRiAl/commit/510694f702ae074288e2c3fda16fbf49dabb9c36#diff-67e997bcfdac55191033d57a16d1408a)",
    "created_at": "2018-02-10T07:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471138",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>
To be honest this patch is a band aid. A proper fix is to detect hash_map properly from configure rather applying pragma trying to find compilers you think will support such and such form of the feature. Something a bit like this [https://github.com/BRiAl/BRiAl/commit/510694f702ae074288e2c3fda16fbf49dabb9c36#diff-67e997bcfdac55191033d57a16d1408a](https://github.com/BRiAl/BRiAl/commit/510694f702ae074288e2c3fda16fbf49dabb9c36#diff-67e997bcfdac55191033d57a16d1408a)



---

archive/issue_comments_471139.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [rws](#comment%3A9):\n> Jeroen, it works fine, I assume I can set positive?\n> \n> Replying to [fbissey](#comment%3A8):\n> > I guess it wasn't seen because we haven't tested a clang that old for some time. Also I think your clang uses libstdc++ from gcc-4.8 while all we made a point of testing with clang's own libstdc++.\n\n> \n> Right, they have no official clang libstdc++ package on OpenSuSE.\n\n\nthey do have it: https://software.opensuse.org/package/libc++1\n\n(libstdc++ is the name for the GNU c++ library)\n\n> \n> > The fix looks OK but it is really stuff that should be tested in configure, with c++11 you don't need tr1 for unordered map, I battled that in `brial`.\n\n> \n> Well, I think it's clearly a giac problem and the patch should be applied upstream. Could you please, @frederichan-IMJPRG?\n",
    "created_at": "2018-02-10T08:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471139",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Replying to [rws](#comment%3A9):
> Jeroen, it works fine, I assume I can set positive?
> 
> Replying to [fbissey](#comment%3A8):
> > I guess it wasn't seen because we haven't tested a clang that old for some time. Also I think your clang uses libstdc++ from gcc-4.8 while all we made a point of testing with clang's own libstdc++.

> 
> Right, they have no official clang libstdc++ package on OpenSuSE.


they do have it: https://software.opensuse.org/package/libc++1

(libstdc++ is the name for the GNU c++ library)

> 
> > The fix looks OK but it is really stuff that should be tested in configure, with c++11 you don't need tr1 for unordered map, I battled that in `brial`.

> 
> Well, I think it's clearly a giac problem and the patch should be applied upstream. Could you please, @frederichan-IMJPRG?




---

archive/issue_comments_471140.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [dimpase](#comment%3A11):\n> Replying to [rws](#comment%3A9):\n> > Right, they have no official clang libstdc++ package on OpenSuSE.\n\n> \n> they do have it: https://software.opensuse.org/package/libc++1\n> \n> (libstdc++ is the name for the GNU c++ library)\n\n\nMaybe but the ones for Leap 42.3 are all unstable (not official in my reading).",
    "created_at": "2018-02-10T08:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471140",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
Replying to [dimpase](#comment%3A11):
> Replying to [rws](#comment%3A9):
> > Right, they have no official clang libstdc++ package on OpenSuSE.

> 
> they do have it: https://software.opensuse.org/package/libc++1
> 
> (libstdc++ is the name for the GNU c++ library)


Maybe but the ones for Leap 42.3 are all unstable (not official in my reading).



---

archive/issue_comments_471141.json:
```json
{
    "body": "<a id='comment:13'></a>\nI installed clang-5 and libc++-5 but couldn't deinstall libstdc++ because even clang depends on it. With both libs installed `sage -f giac` still fails, so libc++ needs to be specified on build.",
    "created_at": "2018-02-10T09:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471141",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
I installed clang-5 and libc++-5 but couldn't deinstall libstdc++ because even clang depends on it. With both libs installed `sage -f giac` still fails, so libc++ needs to be specified on build.



---

archive/issue_comments_471142.json:
```json
{
    "body": "<a id='comment:14'></a>\nRemoving libstdc++ would destroy your g++ and everything in your system built with it. So it is kind of important. Try `CXX=\"clang++ -stdlib=libc++\"`. Provided that `clang++` is the right name to use, would you have `clang-5` and `clang++-5` from those rpms?",
    "created_at": "2018-02-10T09:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471142",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
Removing libstdc++ would destroy your g++ and everything in your system built with it. So it is kind of important. Try `CXX="clang++ -stdlib=libc++"`. Provided that `clang++` is the right name to use, would you have `clang-5` and `clang++-5` from those rpms?



---

archive/issue_comments_471143.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [fbissey](#comment%3A14):\n> Removing libstdc++ would destroy your g++ and everything in your system built with it. So it is kind of important. Try `CXX=\"clang++ -stdlib=libc++\"`. Provided that `clang++` is the right name to use, would you have `clang-5` and `clang++-5` from those rpms?\n\n\nYes everything up to `clang++-5.0.0`. Now I get\n\n```\n[giac-1.4.9.45.p1] /home/ralf/sage/local/var/tmp/sage/build/giac-1.4.9.45.p1/src/src/.libs/libgiac.so: undefined reference to `NTL::operator<<(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, NTL::GF2X const&)'\n[giac-1.4.9.45.p1] /home/ralf/sage/local/var/tmp/sage/build/giac-1.4.9.45.p1/src/src/.libs/libgiac.so: undefined reference to `NTL::operator<<(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, NTL::ZZ_pX const&)'\n[giac-1.4.9.45.p1] clang-5.0.0: error: linker command failed with exit code 1 (use -v to see invocation)\n[giac-1.4.9.45.p1] Makefile:582: recipe for target 'xcas' failed\n[giac-1.4.9.45.p1] make[4]: *** [xcas] Error 1\n```",
    "created_at": "2018-02-10T09:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471143",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>
Replying to [fbissey](#comment%3A14):
> Removing libstdc++ would destroy your g++ and everything in your system built with it. So it is kind of important. Try `CXX="clang++ -stdlib=libc++"`. Provided that `clang++` is the right name to use, would you have `clang-5` and `clang++-5` from those rpms?


Yes everything up to `clang++-5.0.0`. Now I get

```
[giac-1.4.9.45.p1] /home/ralf/sage/local/var/tmp/sage/build/giac-1.4.9.45.p1/src/src/.libs/libgiac.so: undefined reference to `NTL::operator<<(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, NTL::GF2X const&)'
[giac-1.4.9.45.p1] /home/ralf/sage/local/var/tmp/sage/build/giac-1.4.9.45.p1/src/src/.libs/libgiac.so: undefined reference to `NTL::operator<<(std::__1::basic_ostream<char, std::__1::char_traits<char> >&, NTL::ZZ_pX const&)'
[giac-1.4.9.45.p1] clang-5.0.0: error: linker command failed with exit code 1 (use -v to see invocation)
[giac-1.4.9.45.p1] Makefile:582: recipe for target 'xcas' failed
[giac-1.4.9.45.p1] make[4]: *** [xcas] Error 1
```



---

archive/issue_comments_471144.json:
```json
{
    "body": "<a id='comment:16'></a>\nAh I should build NTL with that as well...",
    "created_at": "2018-02-10T09:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471144",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'></a>
Ah I should build NTL with that as well...



---

archive/issue_comments_471145.json:
```json
{
    "body": "<a id='comment:17'></a>\nYou may want to `make distclean` libc++ and libstdc++ are not compatible.",
    "created_at": "2018-02-10T10:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471145",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
You may want to `make distclean` libc++ and libstdc++ are not compatible.



---

archive/issue_comments_471146.json:
```json
{
    "body": "<a id='comment:18'></a>\nHello, I am reporting this here:\nhttp://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=2010",
    "created_at": "2018-02-11T10:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471146",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:18'></a>
Hello, I am reporting this here:
http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=2010



---

archive/issue_comments_471147.json:
```json
{
    "body": "<a id='comment:19'></a>\nReviewer name...",
    "created_at": "2018-02-11T13:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471147",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
Reviewer name...



---

archive/issue_comments_471148.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2018-02-11T13:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471148",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_471149.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2018-02-11T20:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471149",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_471150.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2018-02-11T20:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471150",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_471151.json:
```json
{
    "body": "<a id='comment:21'></a>\nIt looks like this is also necessary with clang-4.0.1 if no CXXFLAGS and LDFLAGS are set for libc++ but CLANG_DEFAULT_CXX_STDLIB=libc++ is set.",
    "created_at": "2018-02-12T06:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471151",
    "user": "https://github.com/rwst"
}
```

<a id='comment:21'></a>
It looks like this is also necessary with clang-4.0.1 if no CXXFLAGS and LDFLAGS are set for libc++ but CLANG_DEFAULT_CXX_STDLIB=libc++ is set.



---

archive/issue_comments_471152.json:
```json
{
    "body": "<a id='comment:22'></a>\nNB: upstream is testing if there are no side effects on some other configurations:\n\nhttp://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=2010",
    "created_at": "2018-02-12T10:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471152",
    "user": "https://github.com/frederichan-IMJPRG"
}
```

<a id='comment:22'></a>
NB: upstream is testing if there are no side effects on some other configurations:

http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=4&t=2010



---

archive/issue_comments_471153.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-02-13T08:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471153",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_471154.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse)\" to \"[0c38a837152312c3b2c79f287812805dd91673df](https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df)\".",
    "created_at": "2018-02-13T08:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24696#issuecomment-471154",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/giac_fails_to_compile_with_clang_3_8_on_opensuse)" to "[0c38a837152312c3b2c79f287812805dd91673df](https://github.com/sagemath/sagetrac-mirror/commit/0c38a837152312c3b2c79f287812805dd91673df)".



---

archive/issue_events_070701.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-13T08:10:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24696",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24696#event-70701"
}
```
