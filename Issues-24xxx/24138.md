# Issue 24138: Improve sparse matrix constructions in _right_kernel_matrix_over_*

archive/issues_023901.json:
```json
{
    "body": "They currently assume a dense matrix and set a lot of 0 values if the matrix sparse. We can give a better construction.\n\nBranch/Commit: 0f2f76eb2e4624c25ee532046a7ee461c5ff8527\n\nReviewer: Daniel Krenn\n\nAuthor: Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24138\n\n",
    "closed_at": "2019-04-18T19:56:53Z",
    "created_at": "2017-11-01T06:23:09Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Improve sparse matrix constructions in _right_kernel_matrix_over_*",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24138",
    "user": "https://github.com/tscrim"
}
```
They currently assume a dense matrix and set a lot of 0 values if the matrix sparse. We can give a better construction.

Branch/Commit: 0f2f76eb2e4624c25ee532046a7ee461c5ff8527

Reviewer: Daniel Krenn

Author: Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24138





---

archive/issue_comments_456713.json:
```json
{
    "body": "<a id='comment:1'></a>I just added this into #24122. This ticket can be recycled if anyone wants it.",
    "created_at": "2017-11-01T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456713",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>I just added this into #24122. This ticket can be recycled if anyone wants it.



---

archive/issue_events_061234.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-01T06:31:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24138#event-61234"
}
```



---

archive/issue_comments_456714.json:
```json
{
    "body": "Changing author from \"Travis Scrimshaw\" to \"\"",
    "created_at": "2017-11-01T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456714",
    "user": "https://github.com/tscrim"
}
```

Changing author from "Travis Scrimshaw" to ""



---

archive/issue_comments_456715.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-01T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456715",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_456716.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-01T06:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456716",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_456717.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-We do not need to create another copy of `M` as it was created locally to keep memory usage down (including putting it in a cache) and because it is faster.\n+They currently assume a dense matrix and set a lot of 0 values if the matrix sparse. We can give a better construction.\n``````\n",
    "created_at": "2017-11-01T07:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456717",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-We do not need to create another copy of `M` as it was created locally to keep memory usage down (including putting it in a cache) and because it is faster.
+They currently assume a dense matrix and set a lot of 0 values if the matrix sparse. We can give a better construction.
``````




---

archive/issue_events_061235.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-01T07:09:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24138#event-61235"
}
```



---

archive/issue_events_061236.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-01T07:09:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24138#event-61236"
}
```



---

archive/issue_comments_456718.json:
```json
{
    "body": "<a id='comment:3'></a>Actually, I can recycle this.",
    "created_at": "2017-11-01T07:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456718",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Actually, I can recycle this.



---

archive/issue_comments_456719.json:
```json
{
    "body": "Changing author from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2017-11-01T07:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456719",
    "user": "https://github.com/tscrim"
}
```

Changing author from "" to "Travis Scrimshaw"



---

archive/issue_comments_456720.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-11-01T07:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456720",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_456721.json:
```json
{
    "body": "<a id='comment:4'></a>I am making an assumption, that the kernel of a sparse matrix will still generally be sparse. It will probably increase in density, but I do not think by enough in general to warrant the result being a dense matrix. On an example I tested:\n\n```\n0.000136661807580175\n0.00566007653061225\n```\nwhere the top is the original density and the bottom is the density of the `right_kernel_matrix`.\n\n---\nNew commits:",
    "created_at": "2017-11-01T07:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456721",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>I am making an assumption, that the kernel of a sparse matrix will still generally be sparse. It will probably increase in density, but I do not think by enough in general to warrant the result being a dense matrix. On an example I tested:

```
0.000136661807580175
0.00566007653061225
```
where the top is the original density and the bottom is the density of the `right_kernel_matrix`.

---
New commits:



---

archive/issue_comments_456722.json:
```json
{
    "body": "Changing branch from \"\" to \"public/linear_algebra/improve_sparse_right_kernel-24138\"",
    "created_at": "2017-11-01T07:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456722",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "" to "public/linear_algebra/improve_sparse_right_kernel-24138"



---

archive/issue_comments_456723.json:
```json
{
    "body": "Changing commit from \"\" to \"430e0850d4582ce556e188d8d1728d860684f05c\"",
    "created_at": "2017-11-01T07:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456723",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "" to "430e0850d4582ce556e188d8d1728d860684f05c"



---

archive/issue_comments_456724.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-01T07:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456724",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_456725.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-27T14:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456725",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_456726.json:
```json
{
    "body": "<a id='comment:5'></a>1. Some doctests are failing.\n2. The code itself looks good. As always, I tend to say blank after a comma (PEP8)\n\n```diff\n+                    entries[cur_row,i] = one\n[...]\n+                    for r,p in enumerate(pivots):\n[...]\n+            if i >= nrows or d[i,i] == 0:\n```\n\nSummary: LGTM once the failing doctests are investigated.",
    "created_at": "2019-03-27T14:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456726",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:5'></a>1. Some doctests are failing.
2. The code itself looks good. As always, I tend to say blank after a comma (PEP8)

```diff
+                    entries[cur_row,i] = one
[...]
+                    for r,p in enumerate(pivots):
[...]
+            if i >= nrows or d[i,i] == 0:
```

Summary: LGTM once the failing doctests are investigated.



---

archive/issue_comments_456727.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Daniel Krenn\"",
    "created_at": "2019-03-27T14:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456727",
    "user": "https://github.com/dkrenn"
}
```

Changing reviewer from "" to "Daniel Krenn"



---

archive/issue_comments_456728.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-17T04:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456729.json:
```json
{
    "body": "Changing commit from \"430e0850d4582ce556e188d8d1728d860684f05c\" to \"d3bb9aad028130304bd7c192f016900adc1178a9\"",
    "created_at": "2019-04-17T04:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "430e0850d4582ce556e188d8d1728d860684f05c" to "d3bb9aad028130304bd7c192f016900adc1178a9"



---

archive/issue_comments_456730.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-17T04:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456731.json:
```json
{
    "body": "Changing commit from \"d3bb9aad028130304bd7c192f016900adc1178a9\" to \"0f2f76eb2e4624c25ee532046a7ee461c5ff8527\"",
    "created_at": "2019-04-17T04:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456731",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d3bb9aad028130304bd7c192f016900adc1178a9" to "0f2f76eb2e4624c25ee532046a7ee461c5ff8527"



---

archive/issue_comments_456732.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-04-17T04:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456732",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_456733.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for looking at this.\n\nThis takes care of the failing doctest. So my tacit understanding why simply updating the doctest is okay is because the algorithm is now better and doesn't change those entries, meaning they stay at exactly 0 rather than approximately 0.\n\nI don't entirely agree with the comma space (same reasoning as on #27442), but I added it. I also did a few other little PEP8 and maintenance things.",
    "created_at": "2019-04-17T04:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456733",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>Thanks for looking at this.

This takes care of the failing doctest. So my tacit understanding why simply updating the doctest is okay is because the algorithm is now better and doesn't change those entries, meaning they stay at exactly 0 rather than approximately 0.

I don't entirely agree with the comma space (same reasoning as on #27442), but I added it. I also did a few other little PEP8 and maintenance things.



---

archive/issue_events_061237.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-04-17T04:15:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24138#event-61237"
}
```



---

archive/issue_events_061238.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-04-17T04:15:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24138#event-61238"
}
```



---

archive/issue_comments_456734.json:
```json
{
    "body": "<a id='comment:10'></a>LGTM.",
    "created_at": "2019-04-17T07:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456734",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:10'></a>LGTM.



---

archive/issue_comments_456735.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-17T07:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456735",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_061239.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-18T19:56:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24138#event-61239"
}
```



---

archive/issue_comments_456736.json:
```json
{
    "body": "Changing branch from \"public/linear_algebra/improve_sparse_right_kernel-24138\" to \"0f2f76eb2e4624c25ee532046a7ee461c5ff8527\"",
    "created_at": "2019-04-18T19:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456736",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/linear_algebra/improve_sparse_right_kernel-24138" to "0f2f76eb2e4624c25ee532046a7ee461c5ff8527"



---

archive/issue_comments_456737.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-18T19:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24138",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24138#issuecomment-456737",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
