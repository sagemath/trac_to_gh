# Issue 24984: py3: get rid of some filter in classical geometries

archive/issues_024747.json:
```json
{
    "assignees": [],
    "body": "\n\nDepends on #24460\n\nCC:  @dimpase\n\nBranch/Commit: **[`227760d`](https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865)**\n\nReviewer: **Erik Bray**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24984_\n\n",
    "closed_at": "2018-05-27T17:01:46Z",
    "created_at": "2018-03-15T09:18:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: get rid of some filter in classical geometries",
    "type": "issue",
    "updated_at": "2018-05-27T17:01:46Z",
    "url": "https://github.com/sagemath/sage/issues/24984",
    "user": "https://github.com/fchapoton"
}
```


Depends on #24460

CC:  @dimpase

Branch/Commit: **[`227760d`](https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865)**

Reviewer: **Erik Bray**

Author: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/24984_





---

archive/issue_events_342598.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:18:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342598"
}
```



---

archive/issue_events_342599.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:18:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342599"
}
```



---

archive/issue_events_342600.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:18:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342600"
}
```



---

archive/issue_events_342601.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:18:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342601"
}
```



---

archive/issue_comments_380333.json:
```json
{
    "body": "Branch: **[u/chapoton/24984](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24984)**",
    "created_at": "2018-03-15T09:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380333",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/24984](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24984)**



---

archive/issue_comments_380334.json:
```json
{
    "body": "Commit: **[`7d97127`](https://github.com/sagemath/sagetrac-mirror/commit/7d97127ef05c00db06f12588394f78fb67539697)**",
    "created_at": "2018-03-15T09:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380334",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`7d97127`](https://github.com/sagemath/sagetrac-mirror/commit/7d97127ef05c00db06f12588394f78fb67539697)**



---

archive/issue_comments_380335.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d97127ef05c00db06f12588394f78fb67539697\"><code>7d97127</code></a></td><td><code>get rid of some filter(...) in classical geometries</code></td></tr></table>\n",
    "created_at": "2018-03-15T09:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380335",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d97127ef05c00db06f12588394f78fb67539697"><code>7d97127</code></a></td><td><code>get rid of some filter(...) in classical geometries</code></td></tr></table>




---

archive/issue_events_342602.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:18:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342602"
}
```



---

archive/issue_events_342603.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:37:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342603"
}
```



---

archive/issue_events_342604.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T09:37:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342604"
}
```



---

archive/issue_comments_380336.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis should also be fixed:\n\n```\n    if clique_partition:\n        lines = map(lambda x: filter(lambda t: t[0]+x*t[1]==0, V),\n                     filter(lambda z: z != 0, Fq))\n        return (G, lines, v0)\n```\nDima, could you please take care of that ?",
    "created_at": "2018-03-15T09:37:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380336",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

This should also be fixed:

```
    if clique_partition:
        lines = map(lambda x: filter(lambda t: t[0]+x*t[1]==0, V),
                     filter(lambda z: z != 0, Fq))
        return (G, lines, v0)
```
Dima, could you please take care of that ?



---

archive/issue_comments_380337.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nCode like\n\n```\n        V = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]\n        assert len(V) == 1\n        V = V[0]\n```\ncan better be written as\n\n```\n        (V,) = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]\n```",
    "created_at": "2018-03-15T11:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380337",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Code like

```
        V = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]
        assert len(V) == 1
        V = V[0]
```
can better be written as

```
        (V,) = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]
```



---

archive/issue_comments_380338.json:
```json
{
    "body": "Changed commit from **[`7d97127`](https://github.com/sagemath/sagetrac-mirror/commit/7d97127ef05c00db06f12588394f78fb67539697)** to **[`0e5bc56`](https://github.com/sagemath/sagetrac-mirror/commit/0e5bc56707fb04153aefcb39c3a107b1ab9979fb)**",
    "created_at": "2018-03-15T13:10:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380338",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7d97127`](https://github.com/sagemath/sagetrac-mirror/commit/7d97127ef05c00db06f12588394f78fb67539697)** to **[`0e5bc56`](https://github.com/sagemath/sagetrac-mirror/commit/0e5bc56707fb04153aefcb39c3a107b1ab9979fb)**



---

archive/issue_comments_380339.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e5bc56707fb04153aefcb39c3a107b1ab9979fb\"><code>0e5bc56</code></a></td><td><code>trac 24984 details</code></td></tr></table>\n",
    "created_at": "2018-03-15T13:10:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380339",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e5bc56707fb04153aefcb39c3a107b1ab9979fb"><code>0e5bc56</code></a></td><td><code>trac 24984 details</code></td></tr></table>




---

archive/issue_events_342605.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T13:11:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342605"
}
```



---

archive/issue_events_342606.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-15T13:11:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342606"
}
```



---

archive/issue_comments_380340.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nok, done",
    "created_at": "2018-03-15T13:11:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380340",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

ok, done



---

archive/issue_comments_380341.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2018-03-15T13:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380341",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_380342.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\npositive review if tests pass",
    "created_at": "2018-03-15T13:48:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380342",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

positive review if tests pass



---

archive/issue_comments_380343.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jdemeyer](#comment%3A3):\n> Code like\n> \n> ```\n>         V = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]\n>         assert len(V) == 1\n>         V = V[0]\n> ```\n> can better be written as\n> \n> ```\n>         (V,) = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]\n> ```\n\nSorry, how is this equivalent? The `assert` there means to be an extra guard against a SNAFU, and now it's gone.",
    "created_at": "2018-03-15T14:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380343",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jdemeyer](#comment%3A3):
> Code like
> 
> ```
>         V = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]
>         assert len(V) == 1
>         V = V[0]
> ```
> can better be written as
> 
> ```
>         (V,) = [x for x in libgap.Orbits(g, S, libgap.OnLines) if len(x) == nvert]
> ```

Sorry, how is this equivalent? The `assert` there means to be an extra guard against a SNAFU, and now it's gone.



---

archive/issue_comments_380344.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nthe assignement will protest if the list has not the correct expected length, here 1\n\ntry\n\n(a,) = (4,5)",
    "created_at": "2018-03-15T14:07:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380344",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

the assignement will protest if the list has not the correct expected length, here 1

try

(a,) = (4,5)



---

archive/issue_comments_380345.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nBy the way, what's wrong with `filter()` in the 1st place?",
    "created_at": "2018-03-15T14:10:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380345",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:9" align="right">comment:9</div>

By the way, what's wrong with `filter()` in the 1st place?



---

archive/issue_comments_380346.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nproblem in py3, filter is an iterator, and you cannot ask for V[0]",
    "created_at": "2018-03-15T14:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380346",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

problem in py3, filter is an iterator, and you cannot ask for V[0]



---

archive/issue_comments_380347.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nby the way, did you manage to get a python3-sage up and running ?",
    "created_at": "2018-03-15T14:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380347",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

by the way, did you manage to get a python3-sage up and running ?



---

archive/issue_comments_380348.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@fchapoton](#comment%3A10):\n> problem in py3, filter is an iterator, and you cannot ask for V[0]\n\nand where does one ask for V[0]?\n\nI'd rather apply `list()` to an iterator; e.g. wouldn't this (from comment 2) work in python3?\n\n```\n    if clique_partition:\n        lines = map(lambda x: filter(lambda t: t[0]+x*t[1]==0, V),\n                     filter(lambda z: z != 0, Fq))\n        return (G, list(lines), v0)\n```\n\n---\n\nNo, I'm not python3ised yet, sorry :-)",
    "created_at": "2018-03-15T14:21:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380348",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@fchapoton](#comment%3A10):
> problem in py3, filter is an iterator, and you cannot ask for V[0]

and where does one ask for V[0]?

I'd rather apply `list()` to an iterator; e.g. wouldn't this (from comment 2) work in python3?

```
    if clique_partition:
        lines = map(lambda x: filter(lambda t: t[0]+x*t[1]==0, V),
                     filter(lambda z: z != 0, Fq))
        return (G, list(lines), v0)
```

---

No, I'm not python3ised yet, sorry :-)



---

archive/issue_comments_380349.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@fchapoton](#comment%3A8):\n> the assignement will protest if the list has not the correct expected length, here 1\n> \n> try\n> \n> (a,) = (4,5)\n> \n\nRight, this makes sense, thanks.",
    "created_at": "2018-03-15T14:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380349",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@fchapoton](#comment%3A8):
> the assignement will protest if the list has not the correct expected length, here 1
> 
> try
> 
> (a,) = (4,5)
> 

Right, this makes sense, thanks.



---

archive/issue_comments_380350.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nafter the branch here, one does not longer ask for V[0]. Before, one did\n\nIn principle, vanilla-sage 8.2.b8 should build and start with python3. Instructions:\n(in a separate clone of the git repo)\n\n```\nmake configure\n./configure --with-python=3\nmake build\n```\n\nGive it a try of you can.",
    "created_at": "2018-03-15T14:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380350",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">comment:14</div>

after the branch here, one does not longer ask for V[0]. Before, one did

In principle, vanilla-sage 8.2.b8 should build and start with python3. Instructions:
(in a separate clone of the git repo)

```
make configure
./configure --with-python=3
make build
```

Give it a try of you can.



---

archive/issue_comments_380351.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nthis does not look like a right change \n\n```\n-        lines = map(lambda x: filter(lambda t: t[0]+x*t[1]==0, V),\n-                     filter(lambda z: z != 0, Fq))\n+        lines = [[t for t in V if t[0] + z * t[1] == 0]\n+                 for z in Fq if z]\n```\n`x` from `V` is gone and replaced by `z` from `Fq` in `t[0]+x*t[1]==0`.\n\nThis is why I'd rather retain all the filters, you know...",
    "created_at": "2018-03-15T14:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380351",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:15" align="right">comment:15</div>

this does not look like a right change 

```
-        lines = map(lambda x: filter(lambda t: t[0]+x*t[1]==0, V),
-                     filter(lambda z: z != 0, Fq))
+        lines = [[t for t in V if t[0] + z * t[1] == 0]
+                 for z in Fq if z]
```
`x` from `V` is gone and replaced by `z` from `Fq` in `t[0]+x*t[1]==0`.

This is why I'd rather retain all the filters, you know...



---

archive/issue_comments_380352.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nwell, I did a mistake, please correct it, and let us try to spend only a short time on the ticket, please..",
    "created_at": "2018-03-15T14:34:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380352",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">comment:16</div>

well, I did a mistake, please correct it, and let us try to spend only a short time on the ticket, please..



---

archive/issue_comments_380353.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWould you mind if I try installing sage@py3 and provide a branch I don't have to wrap my poor brain around unnecessarily? \n\nSorry, I am badly jetlagged and still somewhere between Japanese time an GMT...",
    "created_at": "2018-03-15T14:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380353",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Would you mind if I try installing sage@py3 and provide a branch I don't have to wrap my poor brain around unnecessarily? 

Sorry, I am badly jetlagged and still somewhere between Japanese time an GMT...



---

archive/issue_comments_380354.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThis ticket has no urgency, and I like the branch as it is. Please take a rest, a nap, or a good night sleep. We will look at that later.\n\nEDIT: I have double-checked my changes after `if clique_partition:`, and I think that they are correct.",
    "created_at": "2018-03-15T14:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380354",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

This ticket has no urgency, and I like the branch as it is. Please take a rest, a nap, or a good night sleep. We will look at that later.

EDIT: I have double-checked my changes after `if clique_partition:`, and I think that they are correct.



---

archive/issue_comments_380355.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nbefore working on this, we ought to remedy the root cause of most doctest failures there, namely the fact that libgap is broken. Indeed:\n\n```\nsage: libgap.GeneralUnitaryGroup(4, 2)\n------------------------------------------------------------------\nTypeError                        Traceback (most recent call last)\n<ipython-input-1-26e9bcf1ef0f> in <module>()\n----> 1 libgap.GeneralUnitaryGroup(Integer(4), Integer(2))\n\n/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3558)()\n\n/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2210)()\n\n/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2480)()\n\n/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/libs/gap/libgap.pyx in init sage.libs.gap.libgap()\n    785 \n    786 \n--> 787 libgap = Gap()\n\n/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/libs/gap/libgap.pyx in sage.libs.gap.libgap.Gap.__init__ (build/cythonized/sage/libs/gap/libgap.c:5511)()\n    615             <class 'sage.libs.gap.libgap.Gap'>\n    616         \"\"\"\n--> 617         initialize()\n    618         libgap_set_gasman_callback(gasman_callback)\n    619         from sage.rings.integer_ring import ZZ\n\n/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/libs/gap/util.pyx in sage.libs.gap.util.initialize (build/cythonized/sage/libs/gap/util.c:4459)()\n\nTypeError: expected bytes, str found\n```\n\nIt's really baffling kind of errors message...\n\n---\n\nI was able to build sage@py3 capable of doctesting, following comment 14, with added #24343 and #24922.",
    "created_at": "2018-03-15T20:04:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380355",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

before working on this, we ought to remedy the root cause of most doctest failures there, namely the fact that libgap is broken. Indeed:

```
sage: libgap.GeneralUnitaryGroup(4, 2)
------------------------------------------------------------------
TypeError                        Traceback (most recent call last)
<ipython-input-1-26e9bcf1ef0f> in <module>()
----> 1 libgap.GeneralUnitaryGroup(Integer(4), Integer(2))

/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.__getattr__ (build/cythonized/sage/misc/lazy_import.c:3558)()

/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport.get_object (build/cythonized/sage/misc/lazy_import.c:2210)()

/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/misc/lazy_import.pyx in sage.misc.lazy_import.LazyImport._get_object (build/cythonized/sage/misc/lazy_import.c:2480)()

/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/libs/gap/libgap.pyx in init sage.libs.gap.libgap()
    785 
    786 
--> 787 libgap = Gap()

/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/libs/gap/libgap.pyx in sage.libs.gap.libgap.Gap.__init__ (build/cythonized/sage/libs/gap/libgap.c:5511)()
    615             <class 'sage.libs.gap.libgap.Gap'>
    616         """
--> 617         initialize()
    618         libgap_set_gasman_callback(gasman_callback)
    619         from sage.rings.integer_ring import ZZ

/mnt/opt/Sage/local/lib/python3.6/site-packages/sage/libs/gap/util.pyx in sage.libs.gap.util.initialize (build/cythonized/sage/libs/gap/util.c:4459)()

TypeError: expected bytes, str found
```

It's really baffling kind of errors message...

---

I was able to build sage@py3 capable of doctesting, following comment 14, with added #24343 and #24922.



---

archive/issue_comments_380356.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWell, there are maybe thousands of issues remaining, some small and some big. Unicode problems are a large part of that. If we could fix the 3 tiny problems here quickly, I would prefer.\n\nBot is morally green.",
    "created_at": "2018-03-15T20:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380356",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

Well, there are maybe thousands of issues remaining, some small and some big. Unicode problems are a large part of that. If we could fix the 3 tiny problems here quickly, I would prefer.

Bot is morally green.



---

archive/issue_comments_380357.json:
```json
{
    "body": "Dependencies: **#24990**",
    "created_at": "2018-03-15T22:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380357",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **#24990**



---

archive/issue_comments_380358.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI believe we should first be able to test that these fixes actually work on py3, too, hence the dependence. Once libgap works, this should be a breeze to fix everything py3-related here.\n\nMoreover I actually like the code using filters, as it is using iterators (on py3) rather than explicit lists, which might lead to various performance gains.\nSo I am not ready to just give it up, especially as trivial fixes like applying `list()` to an iterator are always possible and are much less intrusive.",
    "created_at": "2018-03-15T22:37:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380358",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

I believe we should first be able to test that these fixes actually work on py3, too, hence the dependence. Once libgap works, this should be a breeze to fix everything py3-related here.

Moreover I actually like the code using filters, as it is using iterators (on py3) rather than explicit lists, which might lead to various performance gains.
So I am not ready to just give it up, especially as trivial fixes like applying `list()` to an iterator are always possible and are much less intrusive.



---

archive/issue_comments_380359.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI do not believe we should wait for any other ticket. *Please* consider seriously the awful amount of remaining work to get sage fully py3-compatible, and accept to let it go. I promise I will not try to remove filter everywhere else.",
    "created_at": "2018-03-16T06:40:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380359",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

I do not believe we should wait for any other ticket. *Please* consider seriously the awful amount of remaining work to get sage fully py3-compatible, and accept to let it go. I promise I will not try to remove filter everywhere else.



---

archive/issue_comments_380360.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI am sorry, but indiscriminate replacing of iterators with eager iterable data structures is code vandalism, as it potentially degrades performance, and does more harm than good.\n\nOnce the ability to properly test the code arrives, it becomes very easy.",
    "created_at": "2018-03-16T07:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380360",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:23" align="right">comment:23</div>

I am sorry, but indiscriminate replacing of iterators with eager iterable data structures is code vandalism, as it potentially degrades performance, and does more harm than good.

Once the ability to properly test the code arrives, it becomes very easy.



---

archive/issue_comments_380361.json:
```json
{
    "body": "Changed dependencies from **#24990** to **#24460**",
    "created_at": "2018-03-16T13:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380361",
    "user": "https://github.com/dimpase"
}
```

Changed dependencies from **#24990** to **#24460**



---

archive/issue_comments_380362.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI'll leave you to it.",
    "created_at": "2018-03-16T13:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380362",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

I'll leave you to it.



---

archive/issue_comments_380363.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to none",
    "created_at": "2018-03-16T13:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380363",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Jeroen Demeyer** to none



---

archive/issue_comments_380364.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a73b040f36d0b221d63708903d04b89258bc7d7\"><code>3a73b04</code></a></td><td><code>Merge branch 'u/chapoton/24984' in 8.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865\"><code>227760d</code></a></td><td><code>make the pyflakes plugin happy</code></td></tr></table>\n",
    "created_at": "2018-05-07T11:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380364",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a73b040f36d0b221d63708903d04b89258bc7d7"><code>3a73b04</code></a></td><td><code>Merge branch 'u/chapoton/24984' in 8.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865"><code>227760d</code></a></td><td><code>make the pyflakes plugin happy</code></td></tr></table>




---

archive/issue_comments_380365.json:
```json
{
    "body": "Changed commit from **[`0e5bc56`](https://github.com/sagemath/sagetrac-mirror/commit/0e5bc56707fb04153aefcb39c3a107b1ab9979fb)** to **[`227760d`](https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865)**",
    "created_at": "2018-05-07T11:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380365",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0e5bc56`](https://github.com/sagemath/sagetrac-mirror/commit/0e5bc56707fb04153aefcb39c3a107b1ab9979fb)** to **[`227760d`](https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865)**



---

archive/issue_events_342607.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-14T12:22:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342607"
}
```



---

archive/issue_events_342608.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-14T12:22:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342608"
}
```



---

archive/issue_comments_380366.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@dimpase](#comment%3A23):\n> I am sorry, but indiscriminate replacing of iterators with eager iterable data structures is code vandalism, as it potentially degrades performance, and does more harm than good.\n\nIt's not \"code vandalism\".  Currently the changes Fr\u00e9d\u00e9ric has made here is just replacing some code with the exact equivalent (on Python 2) code that also works on Python 3.  If you believe these algorithms can be improved by the use of iterators you're welcome to take a stab at it, but as currently written that is not the case.  I can certainly see a couple small opportunities here, but it is not a priority as there is no regression here--the higher priority right now is getting Python 3 working.",
    "created_at": "2018-05-23T13:42:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380366",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@dimpase](#comment%3A23):
> I am sorry, but indiscriminate replacing of iterators with eager iterable data structures is code vandalism, as it potentially degrades performance, and does more harm than good.

It's not "code vandalism".  Currently the changes Frédéric has made here is just replacing some code with the exact equivalent (on Python 2) code that also works on Python 3.  If you believe these algorithms can be improved by the use of iterators you're welcome to take a stab at it, but as currently written that is not the case.  I can certainly see a couple small opportunities here, but it is not a priority as there is no regression here--the higher priority right now is getting Python 3 working.



---

archive/issue_events_342609.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-23T13:42:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342609"
}
```



---

archive/issue_events_342610.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-23T13:42:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342610"
}
```



---

archive/issue_comments_380367.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2018-05-23T13:42:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380367",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_events_342611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-27T17:01:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342611"
}
```



---

archive/issue_events_342612.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "6d1a6ea727ad4eaa024ef00e78d4a6aa491ac1db",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-05-27T17:01:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24984#event-342612"
}
```



---

archive/issue_comments_380368.json:
```json
{
    "body": "Changed branch from **[u/chapoton/24984](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24984)** to **[`227760d`](https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865)**",
    "created_at": "2018-05-27T17:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24984",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24984#issuecomment-380368",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/24984](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24984)** to **[`227760d`](https://github.com/sagemath/sagetrac-mirror/commit/227760ddcce968f82231ea6017eb642e0fd3f865)**
