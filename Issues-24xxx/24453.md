# Issue 24453: narrow_class_group: bug report

archive/issues_024216.json:
```json
{
    "assignees": [],
    "body": "The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.\n\n```\nsage: version()\n'SageMath version 8.1, Release Date: 2017-12-07'\nsage: F.<a> = QuadraticField(2)\nsage: F.narrow_class_group()\nTrivial Abelian group\nsage: F.<a> = QuadraticField(3)\nsage: F.narrow_class_group()\n  File \"<string>\", line 1\n    [2, [2], [[0, -1]~]]\n                     ^\nSyntaxError: invalid syntax\n\nsage: NumberField(x^2-3,'a').narrow_class_group()\n  File \"<string>\", line 1\n    [2, [2], [[0, -1]~]]\n                     ^\nSyntaxError: invalid syntax\n\n```\n\nIf it matters, I was using a pre-built Mac binary.\n\nKeywords: **narrow class group, quadratic field**\n\nBranch/Commit: **[13f3864](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24453_\n\n",
    "closed_at": "2018-01-04T07:59:40Z",
    "created_at": "2017-12-31T04:51:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "narrow_class_group: bug report",
    "type": "issue",
    "updated_at": "2018-01-04T07:59:40Z",
    "url": "https://github.com/sagemath/sage/issues/24453",
    "user": "https://github.com/sagetrac-kimball"
}
```
The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.

```
sage: version()
'SageMath version 8.1, Release Date: 2017-12-07'
sage: F.<a> = QuadraticField(2)
sage: F.narrow_class_group()
Trivial Abelian group
sage: F.<a> = QuadraticField(3)
sage: F.narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

sage: NumberField(x^2-3,'a').narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

```

If it matters, I was using a pre-built Mac binary.

Keywords: **narrow class group, quadratic field**

Branch/Commit: **[13f3864](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**

Reviewer: **Vincent Delecroix**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/24453_





---

archive/issue_events_320780.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320780"
}
```



---

archive/issue_events_320781.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "component: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320781"
}
```



---

archive/issue_events_320782.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320782"
}
```



---

archive/issue_events_320783.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320783"
}
```



---

archive/issue_comments_372887.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nIndeed, there is maybe something strange..\n\n```\nsage: F.<a> = QuadraticField(3)\nsage: F.pari_bnf().bnfnarrow()\n[2, [2], [[0, -1]~]]\nsage: F.<a> = QuadraticField(2)\nsage: F.pari_bnf().bnfnarrow()\n[1, [], []]\nsage: F.<a> = NumberField(x**3-7)\nsage: F.pari_bnf().bnfnarrow()\n[3, [3], [[2, 1, 1; 0, 1, 0; 0, 0, 1]]]\n```",
    "created_at": "2018-01-01T08:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372887",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>Comment 1:</a>
Indeed, there is maybe something strange..

```
sage: F.<a> = QuadraticField(3)
sage: F.pari_bnf().bnfnarrow()
[2, [2], [[0, -1]~]]
sage: F.<a> = QuadraticField(2)
sage: F.pari_bnf().bnfnarrow()
[1, [], []]
sage: F.<a> = NumberField(x**3-7)
sage: F.pari_bnf().bnfnarrow()
[3, [3], [[2, 1, 1; 0, 1, 0; 0, 0, 1]]]
```



---

archive/issue_comments_372888.json:
```json
{
    "body": "Commit: **[13f3864](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372888",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[13f3864](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**



---

archive/issue_comments_372889.json:
```json
{
    "body": "Branch: **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)**",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372889",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)**



---

archive/issue_comments_372890.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372890",
    "user": "https://github.com/fchapoton"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_comments_372891.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f\">13f3864</a></td><td><code>trac 24453 fix narrow class field</code></td></tr></table>\n",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372891",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f">13f3864</a></td><td><code>trac 24453 fix narrow class field</code></td></tr></table>




---

archive/issue_events_320784.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-01T12:53:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320784"
}
```



---

archive/issue_comments_372892.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nWhy did you make it a cached method?",
    "created_at": "2018-01-01T13:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372892",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'>Comment 3:</a>
Why did you make it a cached method?



---

archive/issue_comments_372893.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\noh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..",
    "created_at": "2018-01-01T17:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372893",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'>Comment 4:</a>
oh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..



---

archive/issue_comments_372894.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2018-01-01T18:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372894",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_372895.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nOh! I missed the old cache.",
    "created_at": "2018-01-01T18:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372895",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'>Comment 5:</a>
Oh! I missed the old cache.



---

archive/issue_events_320785.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-01T18:22:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320785"
}
```



---

archive/issue_events_320786.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-01T18:22:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320786"
}
```



---

archive/issue_comments_372896.json:
```json
{
    "body": "Changed branch from **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)** to **[13f3864](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**",
    "created_at": "2018-01-04T07:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-372896",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)** to **[13f3864](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**



---

archive/issue_events_320787.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-04T07:59:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320787"
}
```



---

archive/issue_events_320788.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0b0486e1547acf8e80f2502c81cca251c24a9fe3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-04T07:59:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-320788"
}
```
