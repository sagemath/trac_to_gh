# Issue 24453: narrow_class_group: bug report

archive/issues_024216.json:
```json
{
    "assignees": [],
    "body": "The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.\n\n```\nsage: version()\n'SageMath version 8.1, Release Date: 2017-12-07'\nsage: F.<a> = QuadraticField(2)\nsage: F.narrow_class_group()\nTrivial Abelian group\nsage: F.<a> = QuadraticField(3)\nsage: F.narrow_class_group()\n  File \"<string>\", line 1\n    [2, [2], [[0, -1]~]]\n                     ^\nSyntaxError: invalid syntax\n\nsage: NumberField(x^2-3,'a').narrow_class_group()\n  File \"<string>\", line 1\n    [2, [2], [[0, -1]~]]\n                     ^\nSyntaxError: invalid syntax\n\n```\n\nIf it matters, I was using a pre-built Mac binary.\n\nKeywords: **narrow class group, quadratic field**\n\nBranch/Commit: **[`13f3864`](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **number fields**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24453_\n\n",
    "closed_at": "2018-01-04T07:59:40Z",
    "created_at": "2017-12-31T04:51:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "narrow_class_group: bug report",
    "type": "issue",
    "updated_at": "2018-01-04T07:59:40Z",
    "url": "https://github.com/sagemath/sage/issues/24453",
    "user": "https://github.com/sagetrac-kimball"
}
```
The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.

```
sage: version()
'SageMath version 8.1, Release Date: 2017-12-07'
sage: F.<a> = QuadraticField(2)
sage: F.narrow_class_group()
Trivial Abelian group
sage: F.<a> = QuadraticField(3)
sage: F.narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

sage: NumberField(x^2-3,'a').narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

```

If it matters, I was using a pre-built Mac binary.

Keywords: **narrow class group, quadratic field**

Branch/Commit: **[`13f3864`](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**

Reviewer: **Vincent Delecroix**

Author: **Frédéric Chapoton**

Component: **number fields**

_Issue created by migration from https://trac.sagemath.org/ticket/24453_





---

archive/issue_events_338809.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338809"
}
```



---

archive/issue_events_338810.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338810"
}
```



---

archive/issue_events_338811.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338811"
}
```



---

archive/issue_events_338812.json:
```json
{
    "actor": "https://github.com/sagetrac-kimball",
    "created_at": "2017-12-31T04:51:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338812"
}
```



---

archive/issue_comments_370224.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIndeed, there is maybe something strange..\n\n```\nsage: F.<a> = QuadraticField(3)\nsage: F.pari_bnf().bnfnarrow()\n[2, [2], [[0, -1]~]]\nsage: F.<a> = QuadraticField(2)\nsage: F.pari_bnf().bnfnarrow()\n[1, [], []]\nsage: F.<a> = NumberField(x**3-7)\nsage: F.pari_bnf().bnfnarrow()\n[3, [3], [[2, 1, 1; 0, 1, 0; 0, 0, 1]]]\n```",
    "created_at": "2018-01-01T08:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370224",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">comment:1</div>

Indeed, there is maybe something strange..

```
sage: F.<a> = QuadraticField(3)
sage: F.pari_bnf().bnfnarrow()
[2, [2], [[0, -1]~]]
sage: F.<a> = QuadraticField(2)
sage: F.pari_bnf().bnfnarrow()
[1, [], []]
sage: F.<a> = NumberField(x**3-7)
sage: F.pari_bnf().bnfnarrow()
[3, [3], [[2, 1, 1; 0, 1, 0; 0, 0, 1]]]
```



---

archive/issue_comments_370225.json:
```json
{
    "body": "Commit: **[`13f3864`](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370225",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`13f3864`](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**



---

archive/issue_comments_370226.json:
```json
{
    "body": "Branch: **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)**",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370226",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)**



---

archive/issue_comments_370227.json:
```json
{
    "body": "Author: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370227",
    "user": "https://github.com/fchapoton"
}
```

Author: **Frédéric Chapoton**



---

archive/issue_comments_370228.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f\">13f3864</a></td><td><code>trac 24453 fix narrow class field</code></td></tr></table>\n",
    "created_at": "2018-01-01T12:53:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370228",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f">13f3864</a></td><td><code>trac 24453 fix narrow class field</code></td></tr></table>




---

archive/issue_events_338813.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-01T12:53:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338813"
}
```



---

archive/issue_comments_370229.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWhy did you make it a cached method?",
    "created_at": "2018-01-01T13:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370229",
    "user": "https://github.com/videlec"
}
```

<div id="comment:3" align="right">comment:3</div>

Why did you make it a cached method?



---

archive/issue_comments_370230.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\noh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..",
    "created_at": "2018-01-01T17:40:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370230",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

oh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..



---

archive/issue_comments_370231.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2018-01-01T18:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370231",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_comments_370232.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOh! I missed the old cache.",
    "created_at": "2018-01-01T18:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370232",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

Oh! I missed the old cache.



---

archive/issue_events_338814.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-01T18:22:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338814"
}
```



---

archive/issue_events_338815.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-01T18:22:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338815"
}
```



---

archive/issue_comments_370233.json:
```json
{
    "body": "Changed branch from **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)** to **[`13f3864`](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**",
    "created_at": "2018-01-04T07:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24453#issuecomment-370233",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/24453](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24453)** to **[`13f3864`](https://github.com/sagemath/sagetrac-mirror/commit/13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)**



---

archive/issue_events_338816.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-04T07:59:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338816"
}
```



---

archive/issue_events_338817.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0b0486e1547acf8e80f2502c81cca251c24a9fe3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-04T07:59:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24453",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24453#event-338817"
}
```
