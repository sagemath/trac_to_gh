# Issue 24453: narrow_class_group: bug report

archive/issues_024216.json:
```json
{
    "body": "The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.\n\n```\nsage: version()\n'SageMath version 8.1, Release Date: 2017-12-07'\nsage: F.<a> = QuadraticField(2)\nsage: F.narrow_class_group()\nTrivial Abelian group\nsage: F.<a> = QuadraticField(3)\nsage: F.narrow_class_group()\n  File \"<string>\", line 1\n    [2, [2], [[0, -1]~]]\n                     ^\nSyntaxError: invalid syntax\n\nsage: NumberField(x^2-3,'a').narrow_class_group()\n  File \"<string>\", line 1\n    [2, [2], [[0, -1]~]]\n                     ^\nSyntaxError: invalid syntax\n\n```\n\nIf it matters, I was using a pre-built Mac binary.\n\nKeywords: narrow class group, quadratic field\n\nBranch/Commit: 13f3864c0c0932cc2ee24bd49f38fdcb4207d79f\n\nReviewer: Vincent Delecroix\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24453\n\n",
    "closed_at": "2018-01-04T07:59:40Z",
    "created_at": "2017-12-31T04:51:38Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "narrow_class_group: bug report",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24453",
    "user": "https://trac.sagemath.org/admin/accounts/users/kimball"
}
```
The narrow_class_group function does not even work for some simple real quadratic fields.  Specifically, while it works for Q(sqrt(2)), it does not for Q(sqrt(3)) (I have not tried other number fields).  See snippet below.

```
sage: version()
'SageMath version 8.1, Release Date: 2017-12-07'
sage: F.<a> = QuadraticField(2)
sage: F.narrow_class_group()
Trivial Abelian group
sage: F.<a> = QuadraticField(3)
sage: F.narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

sage: NumberField(x^2-3,'a').narrow_class_group()
  File "<string>", line 1
    [2, [2], [[0, -1]~]]
                     ^
SyntaxError: invalid syntax

```

If it matters, I was using a pre-built Mac binary.

Keywords: narrow class group, quadratic field

Branch/Commit: 13f3864c0c0932cc2ee24bd49f38fdcb4207d79f

Reviewer: Vincent Delecroix

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24453





---

archive/issue_comments_462849.json:
```json
{
    "body": "<a id='comment:1'></a>\nIndeed, there is maybe something strange..\n\n```\nsage: F.<a> = QuadraticField(3)\nsage: F.pari_bnf().bnfnarrow()\n[2, [2], [[0, -1]~]]\nsage: F.<a> = QuadraticField(2)\nsage: F.pari_bnf().bnfnarrow()\n[1, [], []]\nsage: F.<a> = NumberField(x**3-7)\nsage: F.pari_bnf().bnfnarrow()\n[3, [3], [[2, 1, 1; 0, 1, 0; 0, 0, 1]]]\n```",
    "created_at": "2018-01-01T08:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462849",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
Indeed, there is maybe something strange..

```
sage: F.<a> = QuadraticField(3)
sage: F.pari_bnf().bnfnarrow()
[2, [2], [[0, -1]~]]
sage: F.<a> = QuadraticField(2)
sage: F.pari_bnf().bnfnarrow()
[1, [], []]
sage: F.<a> = NumberField(x**3-7)
sage: F.pari_bnf().bnfnarrow()
[3, [3], [[2, 1, 1; 0, 1, 0; 0, 0, 1]]]
```



---

archive/issue_comments_462850.json:
```json
{
    "body": "Changing commit from \"\" to \"13f3864c0c0932cc2ee24bd49f38fdcb4207d79f\"",
    "created_at": "2018-01-01T12:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462850",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "13f3864c0c0932cc2ee24bd49f38fdcb4207d79f"



---

archive/issue_comments_462851.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/24453\"",
    "created_at": "2018-01-01T12:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462851",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/24453"



---

archive/issue_comments_462852.json:
```json
{
    "body": "Changing author from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2018-01-01T12:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462852",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "" to "Frédéric Chapoton"



---

archive/issue_comments_462853.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[13f3864](https://git.sagemath.org/sage.git/commit?id=13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)|`trac 24453 fix narrow class field`|",
    "created_at": "2018-01-01T12:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462853",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[13f3864](https://git.sagemath.org/sage.git/commit?id=13f3864c0c0932cc2ee24bd49f38fdcb4207d79f)|`trac 24453 fix narrow class field`|



---

archive/issue_comments_462854.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-01T12:53:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462854",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462855.json:
```json
{
    "body": "<a id='comment:3'></a>\nWhy did you make it a cached method?",
    "created_at": "2018-01-01T13:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462855",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
Why did you make it a cached method?



---

archive/issue_comments_462856.json:
```json
{
    "body": "<a id='comment:4'></a>\noh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..",
    "created_at": "2018-01-01T17:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462856",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
oh, well, I thought it would be a good idea to replace the custom cache by the usual decorator..



---

archive/issue_comments_462857.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Vincent Delecroix\"",
    "created_at": "2018-01-01T18:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462857",
    "user": "https://github.com/videlec"
}
```

Changing reviewer from "" to "Vincent Delecroix"



---

archive/issue_comments_462858.json:
```json
{
    "body": "<a id='comment:5'></a>\nOh! I missed the old cache.",
    "created_at": "2018-01-01T18:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462858",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Oh! I missed the old cache.



---

archive/issue_comments_462859.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-01T18:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462859",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462860.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-04T07:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462860",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_462861.json:
```json
{
    "body": "Changing branch from \"u/chapoton/24453\" to \"13f3864c0c0932cc2ee24bd49f38fdcb4207d79f\"",
    "created_at": "2018-01-04T07:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24453#issuecomment-462861",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/24453" to "13f3864c0c0932cc2ee24bd49f38fdcb4207d79f"



---

archive/issue_events_061746.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-04T07:59:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24453",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24453#event-61746"
}
```
