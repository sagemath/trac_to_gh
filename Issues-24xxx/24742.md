# Issue 24742: New MatrixArgs object to deal with constructing matrices

archive/issues_024505.json:
```json
{
    "body": "Constructing matrices is a mess currently. There is a lot of code duplication between\n\nA. The global `matrix()` constructor\n\nB. `MatrixSpace.__call__`\n\nC. The various `Matrix.__init__` methods\n\nSince a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).\n\nThese are the changes in this branch:\n\n1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.\n\n2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.\n\n3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.\n\nThis fixes: #8277, #10613, #12778, #20211, #19134, #25076\n\nFollow-up tickets: #23719, #25061\n\nCC:  @tscrim @videlec @embray\n\nBranch/Commit: bf9cefd138bb9fbb19c3c43a778ab230bf962902\n\nReviewer: Marc Mezzarobba\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24742\n\n",
    "closed_at": "2018-05-09T09:49:54Z",
    "created_at": "2018-02-15T15:17:26Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "New MatrixArgs object to deal with constructing matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24742",
    "user": "https://github.com/jdemeyer"
}
```
Constructing matrices is a mess currently. There is a lot of code duplication between

A. The global `matrix()` constructor

B. `MatrixSpace.__call__`

C. The various `Matrix.__init__` methods

Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).

These are the changes in this branch:

1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.

2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.

3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.

This fixes: #8277, #10613, #12778, #20211, #19134, #25076

Follow-up tickets: #23719, #25061

CC:  @tscrim @videlec @embray

Branch/Commit: bf9cefd138bb9fbb19c3c43a778ab230bf962902

Reviewer: Marc Mezzarobba

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24742





---

archive/issue_comments_366109.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -8,7 +8,7 @@\n \n Since a lot of parameters are involved (matrix size, entries, ring, sparseness, implementation), I decided to create a new class just for dealing with inputting matrices.\n \n-Related: #20211, #19134\n+Related: #20211, #19134, #23719\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-02-15T15:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366109",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -8,7 +8,7 @@
 
 Since a lot of parameters are involved (matrix size, entries, ring, sparseness, implementation), I decided to create a new class just for dealing with inputting matrices.
 
-Related: #20211, #19134
+Related: #20211, #19134, #23719
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366110.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+1. The global `matrix()` constructor\n+\n+2. `MatrixSpace.__call__`\n+\n+3. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix size, entries, ring, sparseness, implementation), I decided to create a new class just for dealing with inputting matrices.\n+\n+Related tickets: #20211, #19134, #23719, #15160, #23336, #12778\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-02-15T15:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366110",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+1. The global `matrix()` constructor
+
+2. `MatrixSpace.__call__`
+
+3. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix size, entries, ring, sparseness, implementation), I decided to create a new class just for dealing with inputting matrices.
+
+Related tickets: #20211, #19134, #23719, #15160, #23336, #12778
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366111.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-16T18:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366112.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-17T11:33:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366113.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-19T14:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366114.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-20T13:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366115.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-20T16:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366116.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-21T15:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366116",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366117.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+1. The global `matrix()` constructor\n+\n+2. `MatrixSpace.__call__`\n+\n+3. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. By concentrating all code in this one class, the functions/methods mentioned above become essentially one-liners.\n+\n+Related tickets: #20211, #19134, #23719, #15160, #23336, #12778\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-02-21T16:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366117",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+1. The global `matrix()` constructor
+
+2. `MatrixSpace.__call__`
+
+3. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. By concentrating all code in this one class, the functions/methods mentioned above become essentially one-liners.
+
+Related tickets: #20211, #19134, #23719, #15160, #23336, #12778
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366118.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-21T16:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366119.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-21T16:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366120.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-22T08:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366121.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-22T11:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366122.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+1. The global `matrix()` constructor\n+\n+2. `MatrixSpace.__call__`\n+\n+3. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. By concentrating all code in this one class, the functions/methods mentioned above become essentially one-liners.\n+\n+Related tickets: #20211, #19134, #23719, #23336, #12778\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-02-22T13:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366122",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+1. The global `matrix()` constructor
+
+2. `MatrixSpace.__call__`
+
+3. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. By concentrating all code in this one class, the functions/methods mentioned above become essentially one-liners.
+
+Related tickets: #20211, #19134, #23719, #23336, #12778
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366123.json:
```json
{
    "body": "<a id='comment:17'></a>Haven't ready it 100% yet but I get the idea.  Definitely looks like an improvement.",
    "created_at": "2018-02-22T15:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366123",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Haven't ready it 100% yet but I get the idea.  Definitely looks like an improvement.



---

archive/issue_comments_366124.json:
```json
{
    "body": "<a id='comment:18'></a>One very minor comment:\n\n```\n+    def __repr__(self):\n+        \"\"\"\n+        Print representation for debugging\n+        \"\"\"\n+        t = \"???\"\n```\n\nI know this is mainly just for debugging, but I think instead of \"???\" as the default something more explicit like \"<unfinalized>\" or \"<invalid>\" would be clearer.",
    "created_at": "2018-02-22T15:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366124",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>One very minor comment:

```
+    def __repr__(self):
+        """
+        Print representation for debugging
+        """
+        t = "???"
```

I know this is mainly just for debugging, but I think instead of "???" as the default something more explicit like "<unfinalized>" or "<invalid>" would be clearer.



---

archive/issue_comments_366125.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-22T15:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366125",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366126.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T14:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366127.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T14:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366128.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T16:11:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366129.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-23T21:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366130.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-26T16:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366131.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T06:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366132.json:
```json
{
    "body": "<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T15:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366133.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T16:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366134.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-27T21:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366134",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366135.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T10:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366135",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366136.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T11:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366137.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T16:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366138.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-28T19:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366139.json:
```json
{
    "body": "<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T14:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366140.json:
```json
{
    "body": "<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T16:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366141.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+1. The global `matrix()` constructor\n+\n+2. `MatrixSpace.__call__`\n+\n+3. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. By concentrating all code in this one class, the functions/methods mentioned above become essentially one-liners.\n+\n+This fixes: #8277, #10613, #12778, #20211, #19134\n+\n+Related tickets: #23719, #23336\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-03-01T16:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366141",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,16 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+1. The global `matrix()` constructor
+
+2. `MatrixSpace.__call__`
+
+3. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. By concentrating all code in this one class, the functions/methods mentioned above become essentially one-liners.
+
+This fixes: #8277, #10613, #12778, #20211, #19134
+
+Related tickets: #23719, #23336
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366142.json:
```json
{
    "body": "<a id='comment:41'></a>New commits:",
    "created_at": "2018-03-01T16:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366142",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>New commits:



---

archive/issue_comments_366143.json:
```json
{
    "body": "<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T19:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:42'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366144.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-01T19:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366145.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-02T11:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366146.json:
```json
{
    "body": "<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-02T15:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366147.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,30 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+A. The global `matrix()` constructor\n+\n+B. `MatrixSpace.__call__`\n+\n+C. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).\n+\n+These are the changes in this branch:\n+\n+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.\n+\n+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.\n+\n+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.\n+\n+NOTES for reviewers:\n+\n+- Only the top commit belongs to this ticket, the others are cherry-picked (to avoid huge merges) from the dependencies.\n+\n+- This ticket is not meant to fix all bugs involving matrices. I would appreciate no reviews of the form \"this is good, but you should also fix X\". It's already big enough and follow-up tickets are cheap.\n+\n+This fixes: #8277, #10613, #12778, #20211, #19134\n+\n+Related tickets: #23719, #23336\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-03-02T16:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366147",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,30 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+A. The global `matrix()` constructor
+
+B. `MatrixSpace.__call__`
+
+C. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).
+
+These are the changes in this branch:
+
+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.
+
+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.
+
+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.
+
+NOTES for reviewers:
+
+- Only the top commit belongs to this ticket, the others are cherry-picked (to avoid huge merges) from the dependencies.
+
+- This ticket is not meant to fix all bugs involving matrices. I would appreciate no reviews of the form "this is good, but you should also fix X". It's already big enough and follow-up tickets are cheap.
+
+This fixes: #8277, #10613, #12778, #20211, #19134
+
+Related tickets: #23719, #23336
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366148.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-02T16:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366148",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_366149.json:
```json
{
    "body": "<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-03T08:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:49'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366150.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-06T10:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366151.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-11T08:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366152.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-11T08:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366153.json:
```json
{
    "body": "<a id='comment:55'></a>Very nice work! Though I honestly don't understand the new code in detail, it looks reasonable and I trust the tests more than my own judgment to check that it does the right thing. Even if there are small issues, I think it can only be an improvement compared to what we had before.\n\nI have one significant concern with this ticket though: several simple cases of `matrix(...)` apparently became a lot slower. Compare in particular:\n\nSage 8.1:\n\n```\nsage: %timeit matrix(ZZ,3,3)[0,0] = 1 # used to be a fast way to construct a new mutable matrix\nThe slowest run took 62.41 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 7 \u00b5s per loop\nsage: c = vector(ZZ, [1,2,3])\nsage: %timeit matrix([c])\nThe slowest run took 4.77 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 33.7 \u00b5s per loop\n```\nThis ticket:\n\n```\nsage: %timeit matrix(ZZ,3,3)[0,0] = 1\n10000 loops, best of 3: 110 \u00b5s per loop\nsage: c = vector(ZZ, [1,2,3])\nsage: %timeit matrix([c])\n10000 loops, best of 3: 101 \u00b5s per loop\n```\n\nSome nitpicking while I'm at it: it is perhaps not ideal that\n\n```\nsage: matrix(1,1,[[1,2]])\nValueError: inconsistent number of columns: should be 1 but got 2\n```\nand\n\n```\nsage: matrix(ZZ,1,1,[[1,2]])\nValueError: sequence too long (expected length 1, got more)\n```\nyield different errors.",
    "created_at": "2018-03-11T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366153",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:55'></a>Very nice work! Though I honestly don't understand the new code in detail, it looks reasonable and I trust the tests more than my own judgment to check that it does the right thing. Even if there are small issues, I think it can only be an improvement compared to what we had before.

I have one significant concern with this ticket though: several simple cases of `matrix(...)` apparently became a lot slower. Compare in particular:

Sage 8.1:

```
sage: %timeit matrix(ZZ,3,3)[0,0] = 1 # used to be a fast way to construct a new mutable matrix
The slowest run took 62.41 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 7 µs per loop
sage: c = vector(ZZ, [1,2,3])
sage: %timeit matrix([c])
The slowest run took 4.77 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 33.7 µs per loop
```
This ticket:

```
sage: %timeit matrix(ZZ,3,3)[0,0] = 1
10000 loops, best of 3: 110 µs per loop
sage: c = vector(ZZ, [1,2,3])
sage: %timeit matrix([c])
10000 loops, best of 3: 101 µs per loop
```

Some nitpicking while I'm at it: it is perhaps not ideal that

```
sage: matrix(1,1,[[1,2]])
ValueError: inconsistent number of columns: should be 1 but got 2
```
and

```
sage: matrix(ZZ,1,1,[[1,2]])
ValueError: sequence too long (expected length 1, got more)
```
yield different errors.



---

archive/issue_comments_366154.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-12T00:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366154",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_366155.json:
```json
{
    "body": "<a id='comment:56'></a>There is something very strange going on with the timings:\n\nWith this ticket, constructing a matrix and storing it is an order of magnitude faster than constructing a matrix and *not* storing it:\n\n```\nsage: timeit('matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 117 \u00b5s per loop\nsage: timeit('a=matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 10.7 \u00b5s per loop\n```\nIt doesn't matter if the storing happens inside the `timeit()` or not:\n\n```\nsage: M = matrix(3,3)\nsage: timeit('matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 10.5 \u00b5s per loop\nsage: del M\nsage: timeit('matrix(3, 3)', repeat=5, number=10000)\n10000 loops, best of 5: 115 \u00b5s per loop\n```\nThere must be some caching issue here...\n\nThe current behaviour (without #24742) does not have this.",
    "created_at": "2018-03-12T00:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366155",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:56'></a>There is something very strange going on with the timings:

With this ticket, constructing a matrix and storing it is an order of magnitude faster than constructing a matrix and *not* storing it:

```
sage: timeit('matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 117 µs per loop
sage: timeit('a=matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 10.7 µs per loop
```
It doesn't matter if the storing happens inside the `timeit()` or not:

```
sage: M = matrix(3,3)
sage: timeit('matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 10.5 µs per loop
sage: del M
sage: timeit('matrix(3, 3)', repeat=5, number=10000)
10000 loops, best of 5: 115 µs per loop
```
There must be some caching issue here...

The current behaviour (without #24742) does not have this.



---

archive/issue_comments_366156.json:
```json
{
    "body": "<a id='comment:57'></a>When a previous matrix is \"cached\", the timings with this ticket are actually better than before.\n\n**Before** (8.2.beta8):\n\n```\nsage: M = matrix(ZZ,3,3)\nsage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)\n10000 loops, best of 5: 13.2 \u00b5s per loop\n```\n\n```\nsage: c = vector(ZZ, [1,2,3]); matrix([c])\n[1 2 3]\nsage: timeit('matrix([c])', repeat=5, number=10000)\n10000 loops, best of 5: 46.3 \u00b5s per loop\n```\n\n**After** (#24742):\n\n```\nsage: M = matrix(ZZ,3,3)\nsage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)\n10000 loops, best of 5: 10.7 \u00b5s per loop\n```\n\n```\nsage: c = vector(ZZ, [1,2,3]); matrix([c])\n[1 2 3]\nsage: timeit('matrix([c])', repeat=5, number=10000)\n10000 loops, best of 5: 14.5 \u00b5s per loop\n```",
    "created_at": "2018-03-12T00:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366156",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'></a>When a previous matrix is "cached", the timings with this ticket are actually better than before.

**Before** (8.2.beta8):

```
sage: M = matrix(ZZ,3,3)
sage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)
10000 loops, best of 5: 13.2 µs per loop
```

```
sage: c = vector(ZZ, [1,2,3]); matrix([c])
[1 2 3]
sage: timeit('matrix([c])', repeat=5, number=10000)
10000 loops, best of 5: 46.3 µs per loop
```

**After** (#24742):

```
sage: M = matrix(ZZ,3,3)
sage: timeit('matrix(ZZ,3,3)', repeat=5, number=10000)
10000 loops, best of 5: 10.7 µs per loop
```

```
sage: c = vector(ZZ, [1,2,3]); matrix([c])
[1 2 3]
sage: timeit('matrix([c])', repeat=5, number=10000)
10000 loops, best of 5: 14.5 µs per loop
```



---

archive/issue_comments_366157.json:
```json
{
    "body": "<a id='comment:58'></a>The slowdown within `timeit()` is tracked at #24954.",
    "created_at": "2018-03-13T16:39:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366157",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'></a>The slowdown within `timeit()` is tracked at #24954.



---

archive/issue_comments_366158.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-15T10:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366159.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-15T10:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366159",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_366160.json:
```json
{
    "body": "<a id='comment:61'></a>Replying to [comment:55 mmezzarobba]:\n> Some nitpicking while I'm at it: it is perhaps not ideal that\n> \n> ```\n> sage: matrix(1,1,[[1,2]])\n> ValueError: inconsistent number of columns: should be 1 but got 2\n> ```\n> and\n> \n> ```\n> sage: matrix(ZZ,1,1,[[1,2]])\n> ValueError: sequence too long (expected length 1, got more)\n> ```\n> yield different errors.\n\n\nNot ideal, but it's not clear what the best solution is. The problem is that I'm using different code paths for the case where everything (base ring + matrix dimensions) is known and for when it's not known. In order to determine the base ring, I have to iterate over the entries anyway. It's there that the error \"inconsistent number of columns\" is raised.",
    "created_at": "2018-03-15T10:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366160",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:61'></a>Replying to [comment:55 mmezzarobba]:
> Some nitpicking while I'm at it: it is perhaps not ideal that
> 
> ```
> sage: matrix(1,1,[[1,2]])
> ValueError: inconsistent number of columns: should be 1 but got 2
> ```
> and
> 
> ```
> sage: matrix(ZZ,1,1,[[1,2]])
> ValueError: sequence too long (expected length 1, got more)
> ```
> yield different errors.


Not ideal, but it's not clear what the best solution is. The problem is that I'm using different code paths for the case where everything (base ring + matrix dimensions) is known and for when it's not known. In order to determine the base ring, I have to iterate over the entries anyway. It's there that the error "inconsistent number of columns" is raised.



---

archive/issue_comments_366161.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-23T13:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366161",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_366162.json:
```json
{
    "body": "<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2018-03-29T13:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366162",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_366163.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-03-29T13:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_366164.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366164",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_366165.json:
```json
{
    "body": "<a id='comment:64'></a>Trivially rebased.",
    "created_at": "2018-03-29T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366165",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'></a>Trivially rebased.



---

archive/issue_comments_366166.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+A. The global `matrix()` constructor\n+\n+B. `MatrixSpace.__call__`\n+\n+C. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).\n+\n+These are the changes in this branch:\n+\n+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.\n+\n+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.\n+\n+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.\n+\n+This fixes: #8277, #10613, #12778, #20211, #19134\n+\n+Related tickets: #23719, #23336\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-03-29T13:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366166",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,24 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+A. The global `matrix()` constructor
+
+B. `MatrixSpace.__call__`
+
+C. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).
+
+These are the changes in this branch:
+
+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.
+
+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.
+
+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.
+
+This fixes: #8277, #10613, #12778, #20211, #19134
+
+Related tickets: #23719, #23336
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366167.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+A. The global `matrix()` constructor\n+\n+B. `MatrixSpace.__call__`\n+\n+C. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).\n+\n+These are the changes in this branch:\n+\n+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.\n+\n+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.\n+\n+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.\n+\n+This fixes: #8277, #10613, #12778, #20211, #19134\n+\n+Follow-up tickets: #23719, #25061\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-03-29T13:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366167",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,24 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+A. The global `matrix()` constructor
+
+B. `MatrixSpace.__call__`
+
+C. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).
+
+These are the changes in this branch:
+
+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.
+
+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.
+
+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.
+
+This fixes: #8277, #10613, #12778, #20211, #19134
+
+Follow-up tickets: #23719, #25061
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366168.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,24 @@\n+Constructing matrices is a mess currently. There is a lot of code duplication between\n \n+A. The global `matrix()` constructor\n+\n+B. `MatrixSpace.__call__`\n+\n+C. The various `Matrix.__init__` methods\n+\n+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).\n+\n+These are the changes in this branch:\n+\n+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.\n+\n+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.\n+\n+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.\n+\n+This fixes: #8277, #10613, #12778, #20211, #19134, #25076\n+\n+Follow-up tickets: #23719, #25061\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-02T13:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366168",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,24 @@
+Constructing matrices is a mess currently. There is a lot of code duplication between
 
+A. The global `matrix()` constructor
+
+B. `MatrixSpace.__call__`
+
+C. The various `Matrix.__init__` methods
+
+Since a lot of parameters are involved (matrix space, matrix size, entries, ring, sparseness, implementation), I decided to create a new class `MatrixArgs` just for dealing with inputting matrices. This also makes matrices more consistent: because the same code is used everywhere, constructing matrices should now behave the same independently of the implementation (base ring, sparseness).
+
+These are the changes in this branch:
+
+1. A completely new module `sage.matrix.args`. This module concentrates in one place everything which was scattered in various places before. I tried to reproduce the existing functionality, except where it didn't make sense. I took care to be efficient where efficiency matters, for example by avoiding copies.
+
+2. Enormous simplifications to A, B and C above, typically replacing them with just a few lines of code. In a few cases where the original code was particularly ugly, I mostly left the ugly code in place to be fixed later.
+
+3. Various minor changes here and there. Note that most of these were separated in dependent tickets, but a few are left for this ticket.
+
+This fixes: #8277, #10613, #12778, #20211, #19134, #25076
+
+Follow-up tickets: #23719, #25061
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_366169.json:
```json
{
    "body": "<a id='comment:67'></a>Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370",
    "created_at": "2018-05-07T17:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366169",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:67'></a>Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370



---

archive/issue_comments_366170.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-07T17:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366170",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_366171.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:67 vbraun]:\n> Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370\n\n\nIf #24370 and #24742 conflict, can we instead set #24370 to needs_work?",
    "created_at": "2018-05-07T17:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366171",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:68'></a>Replying to [comment:67 vbraun]:
> Failures in src/sage/schemes/riemann_surfaces/riemann_surface.py, possibly due to 24370


If #24370 and #24742 conflict, can we instead set #24370 to needs_work?



---

archive/issue_comments_366172.json:
```json
{
    "body": "<a id='comment:69'></a>I think that #24370 is the ticket that deserved to be set to needs_work, but I'll hear from you if you disagree.",
    "created_at": "2018-05-07T18:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366172",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:69'></a>I think that #24370 is the ticket that deserved to be set to needs_work, but I'll hear from you if you disagree.



---

archive/issue_comments_366173.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-07T18:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366173",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_366174.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-07T19:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366174",
    "user": "https://github.com/nbruin"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_366175.json:
```json
{
    "body": "<a id='comment:70'></a>Apparently a conflict with #24370. These tickets just need to be calibrated. The fix is clear either way.",
    "created_at": "2018-05-07T19:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366175",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:70'></a>Apparently a conflict with #24370. These tickets just need to be calibrated. The fix is clear either way.



---

archive/issue_comments_366176.json:
```json
{
    "body": "<a id='comment:71'></a>With the updated version of #24370, everything works fine! So *both* tickets can get positive review.",
    "created_at": "2018-05-07T21:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366176",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:71'></a>With the updated version of #24370, everything works fine! So *both* tickets can get positive review.



---

archive/issue_comments_366177.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-07T21:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366177",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_366178.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-09T09:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24742#issuecomment-366178",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062241.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-09T09:49:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24742",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24742#event-62241"
}
```
