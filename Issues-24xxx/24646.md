# Issue 24646: Add support for staged installations in packages that use sdh_pip_install

archive/issues_024409.json:
```json
{
    "body": "This implements #22509 for any Python packages that are installed with `sdh_pip_install`.  Passing `--root=` to pip is essentially the same as using `DESTDIR` with `make install`.\n\nThis required a few additional changes to a small handful of packages for them to work with staged installation.\n\n**Branch/Commit:** [ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)\n\n**Reviewer:** Julian R\u00fcth\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/24646\n\n",
    "closed_at": "2018-08-05T08:43:12Z",
    "created_at": "2018-02-02T13:50:25Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Add support for staged installations in packages that use sdh_pip_install",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24646",
    "user": "https://github.com/embray"
}
```
This implements #22509 for any Python packages that are installed with `sdh_pip_install`.  Passing `--root=` to pip is essentially the same as using `DESTDIR` with `make install`.

This required a few additional changes to a small handful of packages for them to work with staged installation.

**Branch/Commit:** [ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)

**Reviewer:** Julian Rüth

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/24646





---

archive/issue_events_222492.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-02T13:50:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222492"
}
```



---

archive/issue_comments_377951.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a591ffb6a55aa36ca84f105d0ffb304ab66eae48\">a591ffb</a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/599668c1ded51d5603395fe7e328cd5522b3dd0f\">599668c</a></td><td><code>The postinst script should probably be run with SAGE_SUDO if it is set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac34ecbe33d0fec7462374b05698aac4bd52bda7\">ac34ecb</a></td><td><code>Add a paragraph to the docs about spkg-postinst</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6519c3fe185169388743ed7742250c7988df9761\">6519c3f</a></td><td><code>Use $SAGE_SUDO, in case it's set, when moving files from the $SAGE_DESTDIR to $SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/454b75b4a9dbf3a02bedc59392aaa1c875b37eff\">454b75b</a></td><td><code>Don't use SAGE_SUDO in these helpers if SAGE_DESTDIR is set</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56\">fcd6e5d</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>\n",
    "created_at": "2018-03-26T11:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377951",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a591ffb6a55aa36ca84f105d0ffb304ab66eae48">a591ffb</a></td><td><code>Added the ability for packages to have a post-install script called spkg-postinst.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/599668c1ded51d5603395fe7e328cd5522b3dd0f">599668c</a></td><td><code>The postinst script should probably be run with SAGE_SUDO if it is set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac34ecbe33d0fec7462374b05698aac4bd52bda7">ac34ecb</a></td><td><code>Add a paragraph to the docs about spkg-postinst</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6519c3fe185169388743ed7742250c7988df9761">6519c3f</a></td><td><code>Use $SAGE_SUDO, in case it's set, when moving files from the $SAGE_DESTDIR to $SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/454b75b4a9dbf3a02bedc59392aaa1c875b37eff">454b75b</a></td><td><code>Don't use SAGE_SUDO in these helpers if SAGE_DESTDIR is set</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56">fcd6e5d</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>




---

archive/issue_comments_377952.json:
```json
{
    "body": "**Changing commit** from \"[efecbb56eb5e9743f63e0b24a639ae4edddf5c8b](https://github.com/sagemath/sagetrac-mirror/commit/efecbb56eb5e9743f63e0b24a639ae4edddf5c8b)\" to \"[fcd6e5d28644c3f24b01d719b6c422e251701c56](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)\".",
    "created_at": "2018-03-26T11:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377952",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[efecbb56eb5e9743f63e0b24a639ae4edddf5c8b](https://github.com/sagemath/sagetrac-mirror/commit/efecbb56eb5e9743f63e0b24a639ae4edddf5c8b)" to "[fcd6e5d28644c3f24b01d719b6c422e251701c56](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)".



---

archive/issue_comments_377953.json:
```json
{
    "body": "**Changing commit** from \"[fcd6e5d28644c3f24b01d719b6c422e251701c56](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)\" to \"[fd1719e051417e956af06a6fe4e51a09171dd366](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)\".",
    "created_at": "2018-03-26T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377953",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fcd6e5d28644c3f24b01d719b6c422e251701c56](https://github.com/sagemath/sagetrac-mirror/commit/fcd6e5d28644c3f24b01d719b6c422e251701c56)" to "[fd1719e051417e956af06a6fe4e51a09171dd366](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)".



---

archive/issue_comments_377954.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366\">fd1719e</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>\n",
    "created_at": "2018-03-26T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377954",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366">fd1719e</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>




---

archive/issue_events_222493.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222493"
}
```



---

archive/issue_events_222494.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222494"
}
```



---

archive/issue_comments_377955.json:
```json
{
    "body": "<a id='comment:5'></a>\nmerge failure on 8.3.b0",
    "created_at": "2018-05-12T19:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377955",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
merge failure on 8.3.b0



---

archive/issue_events_222495.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-12T19:57:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222495"
}
```



---

archive/issue_events_222496.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-12T19:57:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222496"
}
```



---

archive/issue_comments_377956.json:
```json
{
    "body": "**Changing commit** from \"[fd1719e051417e956af06a6fe4e51a09171dd366](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)\" to \"[d03844b7b3897d837b5370c3e972900cbacc966b](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)\".",
    "created_at": "2018-05-14T15:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fd1719e051417e956af06a6fe4e51a09171dd366](https://github.com/sagemath/sagetrac-mirror/commit/fd1719e051417e956af06a6fe4e51a09171dd366)" to "[d03844b7b3897d837b5370c3e972900cbacc966b](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)".



---

archive/issue_comments_377957.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b\">d03844b</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>\n",
    "created_at": "2018-05-14T15:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b">d03844b</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr></table>




---

archive/issue_comments_377958.json:
```json
{
    "body": "<a id='comment:7'></a>\nRebased since its dependency #24645 has been satisfied.",
    "created_at": "2018-05-14T15:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377958",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Rebased since its dependency #24645 has been satisfied.



---

archive/issue_comments_377959.json:
```json
{
    "body": "**Changing dependencies** from \"#24645\" to \"\".",
    "created_at": "2018-05-14T15:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377959",
    "user": "https://github.com/embray"
}
```

**Changing dependencies** from "#24645" to "".



---

archive/issue_events_222497.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-14T15:35:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222497"
}
```



---

archive/issue_events_222498.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-14T15:35:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222498"
}
```



---

archive/issue_events_222499.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-15T14:44:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222499"
}
```



---

archive/issue_events_222500.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-05-15T14:44:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222500"
}
```



---

archive/issue_comments_377960.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhat's up with `build/pkgs/widgetsnbextension/spkg-postinst`? That should just be removed.",
    "created_at": "2018-05-15T14:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377960",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
What's up with `build/pkgs/widgetsnbextension/spkg-postinst`? That should just be removed.



---

archive/issue_comments_377961.json:
```json
{
    "body": "<a id='comment:9'></a>\nFor `sagenb`, why not keep\n\n```\nif [ ! -d mathjax ]; then\n    echo >&2 \"Error: Cannot symlink mathjax into the SageNB data directory.\"\n    exit 1\nfi\n```\nIt seems like a useful sanity check.",
    "created_at": "2018-05-15T14:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377961",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
For `sagenb`, why not keep

```
if [ ! -d mathjax ]; then
    echo >&2 "Error: Cannot symlink mathjax into the SageNB data directory."
    exit 1
fi
```
It seems like a useful sanity check.



---

archive/issue_comments_377962.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jdemeyer](#comment%3A8):\n> What's up with `build/pkgs/widgetsnbextension/spkg-postinst`?\n\n\nLet me check whether or not that was intended to be in this branch.\n\n> That should just be removed.\n\n\nI don't see how you can assert that without knowing what it is.",
    "created_at": "2018-05-15T14:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377962",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Replying to [jdemeyer](#comment%3A8):
> What's up with `build/pkgs/widgetsnbextension/spkg-postinst`?


Let me check whether or not that was intended to be in this branch.

> That should just be removed.


I don't see how you can assert that without knowing what it is.



---

archive/issue_comments_377963.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jdemeyer](#comment%3A9):\n> For `sagenb`, why not keep\n\n\nYou can see just above that it checks that the directory being symlinked exists before making the symlink.",
    "created_at": "2018-05-15T15:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377963",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>
Replying to [jdemeyer](#comment%3A9):
> For `sagenb`, why not keep


You can see just above that it checks that the directory being symlinked exists before making the symlink.



---

archive/issue_comments_377964.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [embray](#comment%3A11):\n> You can see just above that it checks that the directory being symlinked exists before making the symlink.\n\n\nIt's not at all obvious to me that the check *before* is equivalent to the `ln -s` succeeding. The check after is simpler and therefore safer.",
    "created_at": "2018-05-15T15:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377964",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Replying to [embray](#comment%3A11):
> You can see just above that it checks that the directory being symlinked exists before making the symlink.


It's not at all obvious to me that the check *before* is equivalent to the `ln -s` succeeding. The check after is simpler and therefore safer.



---

archive/issue_comments_377965.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [embray](#comment%3A10):\n> I don't see how you can assert that without knowing what it is.\n\n\nI know what it is because I wrote the original. The code which is in that `spkg-postinst` script used to be in `spkg-install` but it's no longer needed because of Jupyter improvements. At some point, you must have had a merge/rebase conflict with `spkg-install` and this left-over `spkg-postinst` script is fallout from that.",
    "created_at": "2018-05-15T15:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377965",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [embray](#comment%3A10):
> I don't see how you can assert that without knowing what it is.


I know what it is because I wrote the original. The code which is in that `spkg-postinst` script used to be in `spkg-install` but it's no longer needed because of Jupyter improvements. At some point, you must have had a merge/rebase conflict with `spkg-install` and this left-over `spkg-postinst` script is fallout from that.



---

archive/issue_comments_377966.json:
```json
{
    "body": "<a id='comment:14'></a>\nI see, you even removed the `jupyter nbextension` call a while ago (but probably after I first wrote this).  I believe you then, that it's no longer needed.",
    "created_at": "2018-05-15T16:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377966",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
I see, you even removed the `jupyter nbextension` call a while ago (but probably after I first wrote this).  I believe you then, that it's no longer needed.



---

archive/issue_comments_377967.json:
```json
{
    "body": "**Changing commit** from \"[d03844b7b3897d837b5370c3e972900cbacc966b](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)\" to \"[00bd3f3814f22b5d43c8402821f3df893ac380b9](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)\".",
    "created_at": "2018-05-16T09:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d03844b7b3897d837b5370c3e972900cbacc966b](https://github.com/sagemath/sagetrac-mirror/commit/d03844b7b3897d837b5370c3e972900cbacc966b)" to "[00bd3f3814f22b5d43c8402821f3df893ac380b9](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)".



---

archive/issue_comments_377968.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bbff408705de682799229f5d4c6bea3e8d2a044\">6bbff40</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9\">00bd3f3</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-05-16T09:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bbff408705de682799229f5d4c6bea3e8d2a044">6bbff40</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9">00bd3f3</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_377969.json:
```json
{
    "body": "<a id='comment:16'></a>\nOk, I dropped the `spkg-postinst` for `widgetsnbextension` and updated the sagenb install.  I think this is better now.",
    "created_at": "2018-05-16T09:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377969",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Ok, I dropped the `spkg-postinst` for `widgetsnbextension` and updated the sagenb install.  I think this is better now.



---

archive/issue_events_222501.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-16T09:53:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222501"
}
```



---

archive/issue_events_222502.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-16T09:53:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222502"
}
```



---

archive/issue_comments_377970.json:
```json
{
    "body": "<a id='comment:17'></a>\nFor `sagenb`, you still removed the check for a working symlink. Why?",
    "created_at": "2018-05-16T10:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377970",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
For `sagenb`, you still removed the check for a working symlink. Why?



---

archive/issue_comments_377971.json:
```json
{
    "body": "<a id='comment:18'></a>\nThe symlink wouldn't resolve because this is being installed in DESTDIR.",
    "created_at": "2018-05-16T12:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377971",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
The symlink wouldn't resolve because this is being installed in DESTDIR.



---

archive/issue_comments_377972.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe changes to Sphinx conflict with #24935. It is possible to just revert those?",
    "created_at": "2018-05-16T15:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377972",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
The changes to Sphinx conflict with #24935. It is possible to just revert those?



---

archive/issue_comments_377973.json:
```json
{
    "body": "<a id='comment:20'></a>\nUnfortunately they're necessary for the package to install correctly.  You could merge this into #24935.",
    "created_at": "2018-05-16T15:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377973",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
Unfortunately they're necessary for the package to install correctly.  You could merge this into #24935.



---

archive/issue_events_222503.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-06-01T23:40:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222503"
}
```



---

archive/issue_events_222504.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-06-01T23:40:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222504"
}
```



---

archive/issue_comments_377974.json:
```json
{
    "body": "<a id='comment:21'></a>\nthere are merge conflicts",
    "created_at": "2018-06-01T23:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377974",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:21'></a>
there are merge conflicts



---

archive/issue_comments_377975.json:
```json
{
    "body": "**Changing commit** from \"[00bd3f3814f22b5d43c8402821f3df893ac380b9](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)\" to \"[208d754a61850cccb34b6a27afc3553fa7dc3bbb](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)\".",
    "created_at": "2018-06-02T15:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377975",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[00bd3f3814f22b5d43c8402821f3df893ac380b9](https://github.com/sagemath/sagetrac-mirror/commit/00bd3f3814f22b5d43c8402821f3df893ac380b9)" to "[208d754a61850cccb34b6a27afc3553fa7dc3bbb](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)".



---

archive/issue_comments_377976.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cb0a245ebd386bc1fb38d7d46d3bb548d53ad81\">5cb0a24</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb\">208d754</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-06-02T15:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cb0a245ebd386bc1fb38d7d46d3bb548d53ad81">5cb0a24</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb">208d754</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_events_222505.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-06-02T15:12:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222505"
}
```



---

archive/issue_events_222506.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-06-02T15:12:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222506"
}
```



---

archive/issue_comments_377977.json:
```json
{
    "body": "<a id='comment:23'></a>\nI'm surprised this hasn't been merged yet.  It really ought to be.",
    "created_at": "2018-06-02T15:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377977",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
I'm surprised this hasn't been merged yet.  It really ought to be.



---

archive/issue_comments_377978.json:
```json
{
    "body": "**Work_Issues:** merge conflicts",
    "created_at": "2018-07-04T16:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377978",
    "user": "https://github.com/saraedum"
}
```

**Work_Issues:** merge conflicts



---

archive/issue_comments_377979.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49aa08f9840c02b753eb5e92a3ae9ed3fbe8cee4\">49aa08f</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f\">449a6a2</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-07-10T16:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377979",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49aa08f9840c02b753eb5e92a3ae9ed3fbe8cee4">49aa08f</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f">449a6a2</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_377980.json:
```json
{
    "body": "**Changing commit** from \"[208d754a61850cccb34b6a27afc3553fa7dc3bbb](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)\" to \"[449a6a29ff85becfefa9b915a9aa0e56a3ea409f](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)\".",
    "created_at": "2018-07-10T16:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377980",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[208d754a61850cccb34b6a27afc3553fa7dc3bbb](https://github.com/sagemath/sagetrac-mirror/commit/208d754a61850cccb34b6a27afc3553fa7dc3bbb)" to "[449a6a29ff85becfefa9b915a9aa0e56a3ea409f](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)".



---

archive/issue_comments_377981.json:
```json
{
    "body": "<a id='comment:26'></a>\nHere we go again...",
    "created_at": "2018-07-10T16:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377981",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>
Here we go again...



---

archive/issue_comments_377982.json:
```json
{
    "body": "**Changing work_issues** from \"merge conflicts\" to \"\".",
    "created_at": "2018-07-10T16:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377982",
    "user": "https://github.com/embray"
}
```

**Changing work_issues** from "merge conflicts" to "".



---

archive/issue_events_222507.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-11T13:55:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222507"
}
```



---

archive/issue_events_222508.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-11T13:55:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222508"
}
```



---

archive/issue_comments_377983.json:
```json
{
    "body": "**Reviewer:** Julian R\u00fcth",
    "created_at": "2018-07-11T13:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377983",
    "user": "https://github.com/saraedum"
}
```

**Reviewer:** Julian Rüth



---

archive/issue_events_222509.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-15T09:47:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222509"
}
```



---

archive/issue_events_222510.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-15T09:47:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222510"
}
```



---

archive/issue_comments_377984.json:
```json
{
    "body": "<a id='comment:29'></a>\nSee patchbot",
    "created_at": "2018-07-15T09:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377984",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
See patchbot



---

archive/issue_comments_377985.json:
```json
{
    "body": "<a id='comment:30'></a>\nApparently I had asked Jeroen to make this a prerequisite to #24935 (after all, this ticket was opened first and had no reason to wait so long to be merged).  But he forgot about that or ignored it (and I likewise forgot about it).",
    "created_at": "2018-07-16T10:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377985",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
Apparently I had asked Jeroen to make this a prerequisite to #24935 (after all, this ticket was opened first and had no reason to wait so long to be merged).  But he forgot about that or ignored it (and I likewise forgot about it).



---

archive/issue_comments_377986.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1412f50557397b0b7dd78fed5d9e897e8054204\">b1412f5</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887\">4d20506</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>\n",
    "created_at": "2018-07-16T10:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377986",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1412f50557397b0b7dd78fed5d9e897e8054204">b1412f5</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887">4d20506</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr></table>




---

archive/issue_comments_377987.json:
```json
{
    "body": "**Changing commit** from \"[449a6a29ff85becfefa9b915a9aa0e56a3ea409f](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)\" to \"[4d2050677eb89a12bd864f100b601ea3dc586887](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)\".",
    "created_at": "2018-07-16T10:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377987",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[449a6a29ff85becfefa9b915a9aa0e56a3ea409f](https://github.com/sagemath/sagetrac-mirror/commit/449a6a29ff85becfefa9b915a9aa0e56a3ea409f)" to "[4d2050677eb89a12bd864f100b601ea3dc586887](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)".



---

archive/issue_comments_377988.json:
```json
{
    "body": "<a id='comment:32'></a>\nThe `spkg-postinst` for Sphinx was simply no longer necessary so I removed it.",
    "created_at": "2018-07-16T10:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377988",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>
The `spkg-postinst` for Sphinx was simply no longer necessary so I removed it.



---

archive/issue_events_222511.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-16T10:16:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222511"
}
```



---

archive/issue_events_222512.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-16T10:16:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222512"
}
```



---

archive/issue_comments_377989.json:
```json
{
    "body": "<a id='comment:33'></a>\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377989",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>
I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_222513.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222513"
}
```



---

archive/issue_events_222514.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222514"
}
```



---

archive/issue_events_222515.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-30T08:19:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222515"
}
```



---

archive/issue_events_222516.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-30T08:19:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222516"
}
```



---

archive/issue_comments_377990.json:
```json
{
    "body": "<a id='comment:34'></a>\nYou obviously didn't try to build Sage with the ticket\n\n```\nNo record that 'sagenb' was ever installed; skipping uninstall\n./spkg-install: line 33: syntax error near unexpected token `fi'\n./spkg-install: line 33: `fi'\n```",
    "created_at": "2018-07-30T08:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377990",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
You obviously didn't try to build Sage with the ticket

```
No record that 'sagenb' was ever installed; skipping uninstall
./spkg-install: line 33: syntax error near unexpected token `fi'
./spkg-install: line 33: `fi'
```



---

archive/issue_comments_377991.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [vbraun](#comment%3A34):\n> You obviously didn't try to build Sage with the ticket\n\n\nThat's a bit flippant.  Of course I built Sage with this ticket.  It's been opened for 6 months and has had to be rebased many times.  Perhaps there was a small merge error along the way.  But that's not as if it was never tested...",
    "created_at": "2018-07-30T16:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377991",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>
Replying to [vbraun](#comment%3A34):
> You obviously didn't try to build Sage with the ticket


That's a bit flippant.  Of course I built Sage with this ticket.  It's been opened for 6 months and has had to be rebased many times.  Perhaps there was a small merge error along the way.  But that's not as if it was never tested...



---

archive/issue_comments_377992.json:
```json
{
    "body": "<a id='comment:36'></a>\nAlso, the ticket doesn't bump the package versions of the affected packages, so you would only see the issue if rebuilding from scratch.  The \"obviously\" is pretty unnecessary.",
    "created_at": "2018-07-30T16:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377992",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'></a>
Also, the ticket doesn't bump the package versions of the affected packages, so you would only see the issue if rebuilding from scratch.  The "obviously" is pretty unnecessary.



---

archive/issue_comments_377993.json:
```json
{
    "body": "**Changing commit** from \"[4d2050677eb89a12bd864f100b601ea3dc586887](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)\" to \"[ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)\".",
    "created_at": "2018-07-30T16:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4d2050677eb89a12bd864f100b601ea3dc586887](https://github.com/sagemath/sagetrac-mirror/commit/4d2050677eb89a12bd864f100b601ea3dc586887)" to "[ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)".



---

archive/issue_comments_377994.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3\">7643e66</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7\">32f5bbe</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d\">ff1ccd3</a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>\n",
    "created_at": "2018-07-30T16:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377994",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3">7643e66</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7">32f5bbe</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d">ff1ccd3</a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>




---

archive/issue_events_222517.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-30T16:24:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222517"
}
```



---

archive/issue_events_222518.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-30T16:24:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222518"
}
```



---

archive/issue_comments_377995.json:
```json
{
    "body": "<a id='comment:38'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3\">7643e66</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7\">32f5bbe</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d\">ff1ccd3</a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>\n",
    "created_at": "2018-07-30T16:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377995",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7643e6604e42ec4bc86a23f45d4611756923a3f3">7643e66</a></td><td><code>Add support for SAGE_DESTDIR to sdh_pip_install, thus making most Python packages work with staged installation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32f5bbeac804b37776007407eb00b8acd39559e7">32f5bbe</a></td><td><code>try installing the symlink anyways and don't poke around SAGE_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d">ff1ccd3</a></td><td><code>bump package version on sagenb since its spkg-install changes are slightly non-trivial</code></td></tr></table>




---

archive/issue_events_222519.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:43:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222519"
}
```



---

archive/issue_events_222520.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:43:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24646#event-222520"
}
```



---

archive/issue_comments_377996.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/build/destdir-pip](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir-pip)\" to \"[ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)\".",
    "created_at": "2018-08-05T08:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24646",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24646#issuecomment-377996",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/build/destdir-pip](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/destdir-pip)" to "[ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d](https://github.com/sagemath/sagetrac-mirror/commit/ff1ccd3c132a4bd27a36a1c56ecaf171ad3b7a5d)".
