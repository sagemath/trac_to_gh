# Issue 24512: fix plotting of WheelGraph(n) for n<4

archive/issues_024275.json:
```json
{
    "body": "the layout for n<4 needs to be different.\n\nReported [here](https://groups.google.com/d/msg/sage-support/XMaZIaTJdBI/TUvEkelfAAAJ)\n\n**CC:**  Stefan Rudi zgershkoff\n\n**Branch/Commit:** [01f35a35647930d9d8e2f3a044551e4b7ac6f7f6](https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** David Coudert\n\nIssue created by migration from https://trac.sagemath.org/ticket/24512\n\n",
    "closed_at": "2018-01-22T07:58:16Z",
    "created_at": "2018-01-11T09:39:48Z",
    "labels": [
        "component: graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "title": "fix plotting of WheelGraph(n) for n<4",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/24512",
    "user": "https://github.com/dimpase"
}
```
the layout for n<4 needs to be different.

Reported [here](https://groups.google.com/d/msg/sage-support/XMaZIaTJdBI/TUvEkelfAAAJ)

**CC:**  Stefan Rudi zgershkoff

**Branch/Commit:** [01f35a35647930d9d8e2f3a044551e4b7ac6f7f6](https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6)

**Reviewer:** Dima Pasechnik

**Author:** David Coudert

Issue created by migration from https://trac.sagemath.org/ticket/24512





---

archive/issue_events_217329.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-11T09:56:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "minor",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217329"
}
```



---

archive/issue_comments_373665.json:
```json
{
    "body": "<a id='comment:2'></a>\nOn the way to propose a patch, I realized that we have the same issue with \n`G = graphs.CycleGraph(2)`. However, when I set node positions, the edge is visible.\n\n```\nsage: G = graphs.CycleGraph(2)\nsage: G.get_pos()\n{0: (6.123233995736766e-17, 1.0), 1: (-1.8369701987210297e-16, -1.0)}\nsage: G.show()\nsage: G.set_pos({0:(0, 0), 1:(0, 1)})\nsage: G.show()\n```\n\nAn easy solution is to set these positions for cycle graphs and use cycle graphs in wheel graphs when `n < 3`.\n\nDo you have a better suggestion ?",
    "created_at": "2018-01-12T09:43:10Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373665",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>
On the way to propose a patch, I realized that we have the same issue with 
`G = graphs.CycleGraph(2)`. However, when I set node positions, the edge is visible.

```
sage: G = graphs.CycleGraph(2)
sage: G.get_pos()
{0: (6.123233995736766e-17, 1.0), 1: (-1.8369701987210297e-16, -1.0)}
sage: G.show()
sage: G.set_pos({0:(0, 0), 1:(0, 1)})
sage: G.show()
```

An easy solution is to set these positions for cycle graphs and use cycle graphs in wheel graphs when `n < 3`.

Do you have a better suggestion ?



---

archive/issue_comments_373666.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis makes perfect sense, I was planning to propose something like this, only using complete graphs.",
    "created_at": "2018-01-12T12:38:57Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373666",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>
This makes perfect sense, I was planning to propose something like this, only using complete graphs.



---

archive/issue_comments_373667.json:
```json
{
    "body": "<a id='comment:4'></a>\nFix plotting issues in `CycleGraph` and `WheelGraph`. I have also added a control on the input parameter.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62c14676ba1e256b6293f210c2678407b01a7885\">62c1467</a></td><td><code>trac #24512: fix issues in WheelGraph and CycleGraph</code></td></tr></table>\n",
    "created_at": "2018-01-12T14:52:08Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373667",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>
Fix plotting issues in `CycleGraph` and `WheelGraph`. I have also added a control on the input parameter.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62c14676ba1e256b6293f210c2678407b01a7885">62c1467</a></td><td><code>trac #24512: fix issues in WheelGraph and CycleGraph</code></td></tr></table>




---

archive/issue_comments_373668.json:
```json
{
    "body": "**Commit:** [62c14676ba1e256b6293f210c2678407b01a7885](https://github.com/sagemath/sagetrac-mirror/commit/62c14676ba1e256b6293f210c2678407b01a7885)",
    "created_at": "2018-01-12T14:52:08Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373668",
    "user": "https://github.com/dcoudert"
}
```

**Commit:** [62c14676ba1e256b6293f210c2678407b01a7885](https://github.com/sagemath/sagetrac-mirror/commit/62c14676ba1e256b6293f210c2678407b01a7885)



---

archive/issue_comments_373669.json:
```json
{
    "body": "**Branch:** [u/dcoudert/24512](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/24512)",
    "created_at": "2018-01-12T14:52:08Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373669",
    "user": "https://github.com/dcoudert"
}
```

**Branch:** [u/dcoudert/24512](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/24512)



---

archive/issue_comments_373670.json:
```json
{
    "body": "**Author:** David Coudert",
    "created_at": "2018-01-12T14:52:08Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373670",
    "user": "https://github.com/dcoudert"
}
```

**Author:** David Coudert



---

archive/issue_events_217330.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-01-12T14:52:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217330"
}
```



---

archive/issue_comments_373671.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2018-01-12T22:06:37Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373671",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_373672.json:
```json
{
    "body": "<a id='comment:5'></a>\nlooks good to me, thanks!",
    "created_at": "2018-01-12T22:06:37Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373672",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>
looks good to me, thanks!



---

archive/issue_events_217331.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-12T22:06:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217331"
}
```



---

archive/issue_events_217332.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-12T22:06:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217332"
}
```



---

archive/issue_events_217333.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-18T20:11:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217333"
}
```



---

archive/issue_events_217334.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-18T20:11:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217334"
}
```



---

archive/issue_comments_373673.json:
```json
{
    "body": "<a id='comment:6'></a>\nTest failures, see patchbot",
    "created_at": "2018-01-18T20:11:34Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373673",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Test failures, see patchbot



---

archive/issue_comments_373674.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe problem is in `src/sage/matroids/graphic_matroid.py`.\nSome tests are easy to fix, but I don't know how to fix the issue in `graphic_coextension` and `split_vertex`. I don't know these modules, so some help might be helpful here.",
    "created_at": "2018-01-18T23:58:17Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373674",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>
The problem is in `src/sage/matroids/graphic_matroid.py`.
Some tests are easy to fix, but I don't know how to fix the issue in `graphic_coextension` and `split_vertex`. I don't know these modules, so some help might be helpful here.



---

archive/issue_comments_373675.json:
```json
{
    "body": "<a id='comment:8'></a>\nI agree that it is not at all clear why after changing the implementation of `WheelGraph`\nthis fails (and note that these two implementations produce the same edge sets!)\n\n```\n            sage: M = Matroid(range(8), graphs.WheelGraph(5))\n            sage: M1 = M.graphic_coextension(0, X=[1,2], element='a')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-37-4445dc60790d> in <module>()\n      1 M = Matroid(range(Integer(8)), graphs.WheelGraph(Integer(5)))\n----> 2 M1 = M.graphic_coextension(Integer(0), X=[Integer(1),Integer(2)], element='a')\n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/graphic_matroid.pyc in graphic_coextension(self, u, v, X, element)\n   1593         edgelist = self.groundset_to_edges(X)\n   1594 \n-> 1595         split_vertex(G, u, v, edgelist)\n   1596         G.add_edge(u, v, element)\n   1597 \n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/utilities.pyc in split_vertex(G, u, v, edges)\n    773                 G.delete_edge(e)\n    774             else:\n--> 775                 raise ValueError(\"the edges are not all incident with u\")\n    776 \n    777         elif e[0] == u:\n\nValueError: the edges are not all incident with u\n\nsage: graphs.WheelGraph(5).edges()\n[(0, 1, None),\n (0, 2, None),\n (0, 3, None),\n (0, 4, None),\n (1, 2, None),\n (1, 4, None),\n (2, 3, None),\n (3, 4, None)]\n```\n\nand in the old implementation\n\n```\nsage: graphs.WheelGraph(5).edges()\n[(0, 1, None),\n (0, 2, None),\n (0, 3, None),\n (0, 4, None),\n (1, 2, None),\n (1, 4, None),\n (2, 3, None),\n (3, 4, None)]\n```\nStefan, Rudi, Zachary, any idea?",
    "created_at": "2018-01-19T01:09:13Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373675",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
I agree that it is not at all clear why after changing the implementation of `WheelGraph`
this fails (and note that these two implementations produce the same edge sets!)

```
            sage: M = Matroid(range(8), graphs.WheelGraph(5))
            sage: M1 = M.graphic_coextension(0, X=[1,2], element='a')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-37-4445dc60790d> in <module>()
      1 M = Matroid(range(Integer(8)), graphs.WheelGraph(Integer(5)))
----> 2 M1 = M.graphic_coextension(Integer(0), X=[Integer(1),Integer(2)], element='a')

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/graphic_matroid.pyc in graphic_coextension(self, u, v, X, element)
   1593         edgelist = self.groundset_to_edges(X)
   1594 
-> 1595         split_vertex(G, u, v, edgelist)
   1596         G.add_edge(u, v, element)
   1597 

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/utilities.pyc in split_vertex(G, u, v, edges)
    773                 G.delete_edge(e)
    774             else:
--> 775                 raise ValueError("the edges are not all incident with u")
    776 
    777         elif e[0] == u:

ValueError: the edges are not all incident with u

sage: graphs.WheelGraph(5).edges()
[(0, 1, None),
 (0, 2, None),
 (0, 3, None),
 (0, 4, None),
 (1, 2, None),
 (1, 4, None),
 (2, 3, None),
 (3, 4, None)]
```

and in the old implementation

```
sage: graphs.WheelGraph(5).edges()
[(0, 1, None),
 (0, 2, None),
 (0, 3, None),
 (0, 4, None),
 (1, 2, None),
 (1, 4, None),
 (2, 3, None),
 (3, 4, None)]
```
Stefan, Rudi, Zachary, any idea?



---

archive/issue_comments_373676.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe problem might be that in the old implementation `graphs.WheelGraph(5).edges()`\nand `graphs.WheelGraph(5).edges_iterator()` gave the same order, but in the new implementation these are different (which is not a bug AFAIK); namely, one gets\n\n```\nsage: list(wg.edge_iterator())\n[(1, 2, None),\n (1, 4, None),\n (0, 1, None),\n (2, 3, None),\n (0, 2, None),\n (3, 4, None),\n (0, 3, None),\n (0, 4, None)]\n```\n\nI'd say it's a bug in the graphic matroids code, and it is beyond the scope of this ticket. \n\nOn a practical note, could we have a less intrusive branch here, which only touches the plotting positions, but not the underlying graph?\nAnd we'd open another ticket to deal with graphic matroids code, so please keep this branch alive as an illustration of the bug.",
    "created_at": "2018-01-19T10:31:51Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373676",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
The problem might be that in the old implementation `graphs.WheelGraph(5).edges()`
and `graphs.WheelGraph(5).edges_iterator()` gave the same order, but in the new implementation these are different (which is not a bug AFAIK); namely, one gets

```
sage: list(wg.edge_iterator())
[(1, 2, None),
 (1, 4, None),
 (0, 1, None),
 (2, 3, None),
 (0, 2, None),
 (3, 4, None),
 (0, 3, None),
 (0, 4, None)]
```

I'd say it's a bug in the graphic matroids code, and it is beyond the scope of this ticket. 

On a practical note, could we have a less intrusive branch here, which only touches the plotting positions, but not the underlying graph?
And we'd open another ticket to deal with graphic matroids code, so please keep this branch alive as an illustration of the bug.



---

archive/issue_comments_373677.json:
```json
{
    "body": "<a id='comment:10'></a>\n> I'd say it's a bug in the graphic matroids code, and it is beyond the scope of this ticket. \n\nexactly.\n\n> On a practical note, could we have a less intrusive branch here, which only touches the plotting positions, but not the underlying graph?\n\nThe solution is to continue to use `networkx.wheel_graph(n)` and then convert the networkx graph to a sage graph.\n\n> And we'd open another ticket to deal with graphic matroids code, so please keep this branch alive as an illustration of the bug.\n\nSo we let this ticket as is for as long as the graphic matroid code has not been fixed. Right?",
    "created_at": "2018-01-19T10:41:14Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373677",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
> I'd say it's a bug in the graphic matroids code, and it is beyond the scope of this ticket. 

exactly.

> On a practical note, could we have a less intrusive branch here, which only touches the plotting positions, but not the underlying graph?

The solution is to continue to use `networkx.wheel_graph(n)` and then convert the networkx graph to a sage graph.

> And we'd open another ticket to deal with graphic matroids code, so please keep this branch alive as an illustration of the bug.

So we let this ticket as is for as long as the graphic matroid code has not been fixed. Right?



---

archive/issue_comments_373678.json:
```json
{
    "body": "<a id='comment:11'></a>\nI would rather dealt with the layout here, and opened another ticket for the matroid bug.\nOtherwise we have one ticket for two unrelated things, not good...",
    "created_at": "2018-01-19T12:25:39Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373678",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
I would rather dealt with the layout here, and opened another ticket for the matroid bug.
Otherwise we have one ticket for two unrelated things, not good...



---

archive/issue_comments_373679.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe GraphicMatroid issue arises because this line will automatically assign integer labels to the edges:\n\n`sage: M = Matroid(range(8), graphs.WheelGraph(5))`\n\nIf the order of edge_iterator changes, the labeling of the edges will change (sage.matroids.constructor.py line 797).\n\nIt's not a bug in the matroid code, but the test was constructed kind of lazily, where it didn't explicitly specify an edge labeling. I recommend changing the tests to fix this. Easiest is to create the labeled graph explicitly, like so:\n\n```\nsage: G = Graph([(0, 1, 0), (0, 2, 1), (0, 3, 2), (0, 4, 3), (1, 2, 4), (1, 4, 5), (2, 3, 6), (3, 4, 7)])\nsage: M = Matroid(G)\nsage: M1 = M.graphic_coextension(0, X=[1,2], element='a')\nsage: M1.graph().edges()\n[(0, 1, 0),\n (0, 4, 3),\n (0, 5, 'a'),\n (1, 2, 4),\n (1, 4, 5),\n (2, 3, 6),\n (2, 5, 1),\n (3, 4, 7),\n (3, 5, 2)]\n```\n\n\nEdited to add:\n\nI got that edge list in the first line directly from the old doctest code, like this:\n\n```\nM = Matroid(range(8), graphs.WheelGraph(5))\nM.graph().edges()\n```\nso translating the doctests shouldn't be too onerous.",
    "created_at": "2018-01-19T17:20:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373679",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:12'></a>
The GraphicMatroid issue arises because this line will automatically assign integer labels to the edges:

`sage: M = Matroid(range(8), graphs.WheelGraph(5))`

If the order of edge_iterator changes, the labeling of the edges will change (sage.matroids.constructor.py line 797).

It's not a bug in the matroid code, but the test was constructed kind of lazily, where it didn't explicitly specify an edge labeling. I recommend changing the tests to fix this. Easiest is to create the labeled graph explicitly, like so:

```
sage: G = Graph([(0, 1, 0), (0, 2, 1), (0, 3, 2), (0, 4, 3), (1, 2, 4), (1, 4, 5), (2, 3, 6), (3, 4, 7)])
sage: M = Matroid(G)
sage: M1 = M.graphic_coextension(0, X=[1,2], element='a')
sage: M1.graph().edges()
[(0, 1, 0),
 (0, 4, 3),
 (0, 5, 'a'),
 (1, 2, 4),
 (1, 4, 5),
 (2, 3, 6),
 (2, 5, 1),
 (3, 4, 7),
 (3, 5, 2)]
```


Edited to add:

I got that edge list in the first line directly from the old doctest code, like this:

```
M = Matroid(range(8), graphs.WheelGraph(5))
M.graph().edges()
```
so translating the doctests shouldn't be too onerous.



---

archive/issue_comments_373680.json:
```json
{
    "body": "<a id='comment:13'></a>\nI don't see how this is not a bug in matroid code.\n\nI think what happens is that if Matroid is called with 2 arguments, i.e. labels and the graph, this is not always working correctly (i.e. you create a matroid which is subtly broken so that `graphic_coextension` breaks. Indeed, with the new WheelGraph code, the following works:\n\n```\nsage: G=graphs.WheelGraph(5)\nsage: M = Matroid(G)\nsage: M.graphic_coextension(0,X=[(0,2),(0,3)])\nGraphic matroid of rank 5 on 9 elements\n```\nbut the following does not:\n\n```\nsage: G=graphs.WheelGraph(5)\nsage: M = Matroid(range(8),G)\nsage: M.graphic_coextension(0,X=[1,2])\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-34-f3164ab7cc54> in <module>()\n----> 1 M.graphic_coextension(Integer(0),X=[Integer(1),Integer(2)])\n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/graphic_matroid.pyc in graphic_coextension(self, u, v, X, element)\n   1593         edgelist = self.groundset_to_edges(X)\n   1594 \n-> 1595         split_vertex(G, u, v, edgelist)\n   1596         G.add_edge(u, v, element)\n   1597 \n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/utilities.pyc in split_vertex(G, u, v, edges)\n    773                 G.delete_edge(e)\n    774             else:\n--> 775                 raise ValueError(\"the edges are not all incident with u\")\n    776 \n    777         elif e[0] == u:\n\nValueError: the edges are not all incident with u\n```\n\nSo I think here we can simply change the test to\n\n```\nsage: M = Matroid(graphs.WheelGraph(5))\nsage: M.graphic_coextension(0,X=[(0,2),(0,3)])\nGraphic matroid of rank 5 on 9 elements\n```\nand deal with matroids in #24573.",
    "created_at": "2018-01-19T18:39:32Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373680",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
I don't see how this is not a bug in matroid code.

I think what happens is that if Matroid is called with 2 arguments, i.e. labels and the graph, this is not always working correctly (i.e. you create a matroid which is subtly broken so that `graphic_coextension` breaks. Indeed, with the new WheelGraph code, the following works:

```
sage: G=graphs.WheelGraph(5)
sage: M = Matroid(G)
sage: M.graphic_coextension(0,X=[(0,2),(0,3)])
Graphic matroid of rank 5 on 9 elements
```
but the following does not:

```
sage: G=graphs.WheelGraph(5)
sage: M = Matroid(range(8),G)
sage: M.graphic_coextension(0,X=[1,2])
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-34-f3164ab7cc54> in <module>()
----> 1 M.graphic_coextension(Integer(0),X=[Integer(1),Integer(2)])

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/graphic_matroid.pyc in graphic_coextension(self, u, v, X, element)
   1593         edgelist = self.groundset_to_edges(X)
   1594 
-> 1595         split_vertex(G, u, v, edgelist)
   1596         G.add_edge(u, v, element)
   1597 

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/matroids/utilities.pyc in split_vertex(G, u, v, edges)
    773                 G.delete_edge(e)
    774             else:
--> 775                 raise ValueError("the edges are not all incident with u")
    776 
    777         elif e[0] == u:

ValueError: the edges are not all incident with u
```

So I think here we can simply change the test to

```
sage: M = Matroid(graphs.WheelGraph(5))
sage: M.graphic_coextension(0,X=[(0,2),(0,3)])
Graphic matroid of rank 5 on 9 elements
```
and deal with matroids in #24573.



---

archive/issue_comments_373681.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@dimpase](#comment%3A13):\n> I don't see how this is not a bug in matroid code.\n> \n> I think what happens is that if Matroid is called with 2 arguments, i.e. labels and the graph, this is not always working correctly (i.e. you create a matroid which is subtly broken so that `graphic_coextension` breaks. \n\nAh. Yes, if the ground set gets specified both through edge labels and an explicit list, the constructor does not try to match them up. That is a small bug. I disagree that it creates a broken matroid; it simply creates a matroid with an edge labeling different from the one you expect.\n\n> Indeed, with the new WheelGraph code, the following works:\n> \n> ```\n> sage: G=graphs.WheelGraph(5)\n> sage: M = Matroid(G)\n> sage: M.graphic_coextension(0,X=[(0,2),(0,3)])\n> Graphic matroid of rank 5 on 9 elements\n> ```\n> but the following does not:\n> \n> ```\n> sage: G=graphs.WheelGraph(5)\n> sage: M = Matroid(range(8),G)\n> sage: M.graphic_coextension(0,X=[1,2])}}}\n> ```\n\nThis is not an example of the bug you described, though. `G` has no edge labels internally, so the assignment of the labels `range(8)` to the edges should be considered random.",
    "created_at": "2018-01-19T20:38:03Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373681",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:14'></a>
Replying to [@dimpase](#comment%3A13):
> I don't see how this is not a bug in matroid code.
> 
> I think what happens is that if Matroid is called with 2 arguments, i.e. labels and the graph, this is not always working correctly (i.e. you create a matroid which is subtly broken so that `graphic_coextension` breaks. 

Ah. Yes, if the ground set gets specified both through edge labels and an explicit list, the constructor does not try to match them up. That is a small bug. I disagree that it creates a broken matroid; it simply creates a matroid with an edge labeling different from the one you expect.

> Indeed, with the new WheelGraph code, the following works:
> 
> ```
> sage: G=graphs.WheelGraph(5)
> sage: M = Matroid(G)
> sage: M.graphic_coextension(0,X=[(0,2),(0,3)])
> Graphic matroid of rank 5 on 9 elements
> ```
> but the following does not:
> 
> ```
> sage: G=graphs.WheelGraph(5)
> sage: M = Matroid(range(8),G)
> sage: M.graphic_coextension(0,X=[1,2])}}}
> ```

This is not an example of the bug you described, though. `G` has no edge labels internally, so the assignment of the labels `range(8)` to the edges should be considered random.



---

archive/issue_comments_373682.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, I was totally confused by your `G` above. Now I see that indeed, it suffices to adjust X (perhaps this is what you meant to say), by looking at `M.graph().edges()`:\n\n```\nsage: G=graphs.WheelGraph(5)\nsage: M = Matroid(range(8),G)\nsage: M.graph().edges()\n[(0, 1, 2),\n (0, 2, 4),\n (0, 3, 6),\n (0, 4, 7),\n (1, 2, 0),\n (1, 4, 1),\n (2, 3, 3),\n (3, 4, 5)]\nsage: M.graphic_coextension(0,X=[4,6]) # 4,6 are labels of 02 and 03\nGraphic matroid of rank 5 on 9 elements\n```\nSo this is how to fix the doctest - just 1-line change:\n\n```\nsage: M.graphic_coextension(0,X=[4,6])\n```",
    "created_at": "2018-01-19T23:44:39Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373682",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
OK, I was totally confused by your `G` above. Now I see that indeed, it suffices to adjust X (perhaps this is what you meant to say), by looking at `M.graph().edges()`:

```
sage: G=graphs.WheelGraph(5)
sage: M = Matroid(range(8),G)
sage: M.graph().edges()
[(0, 1, 2),
 (0, 2, 4),
 (0, 3, 6),
 (0, 4, 7),
 (1, 2, 0),
 (1, 4, 1),
 (2, 3, 3),
 (3, 4, 5)]
sage: M.graphic_coextension(0,X=[4,6]) # 4,6 are labels of 02 and 03
Graphic matroid of rank 5 on 9 elements
```
So this is how to fix the doctest - just 1-line change:

```
sage: M.graphic_coextension(0,X=[4,6])
```



---

archive/issue_comments_373683.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a45b32c1f1ed2a9e8d1f4b8c5201abf72f389f0\">8a45b32</a></td><td><code>trac #24512: Merged with 8.2.beta3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0\">9a71f1c</a></td><td><code>trac #24512: restore use of networkx for the creation of the graph</code></td></tr></table>\n",
    "created_at": "2018-01-20T10:23:00Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a45b32c1f1ed2a9e8d1f4b8c5201abf72f389f0">8a45b32</a></td><td><code>trac #24512: Merged with 8.2.beta3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0">9a71f1c</a></td><td><code>trac #24512: restore use of networkx for the creation of the graph</code></td></tr></table>




---

archive/issue_comments_373684.json:
```json
{
    "body": "**Changing commit** from \"[62c14676ba1e256b6293f210c2678407b01a7885](https://github.com/sagemath/sagetrac-mirror/commit/62c14676ba1e256b6293f210c2678407b01a7885)\" to \"[9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0](https://github.com/sagemath/sagetrac-mirror/commit/9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0)\".",
    "created_at": "2018-01-20T10:23:00Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373684",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[62c14676ba1e256b6293f210c2678407b01a7885](https://github.com/sagemath/sagetrac-mirror/commit/62c14676ba1e256b6293f210c2678407b01a7885)" to "[9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0](https://github.com/sagemath/sagetrac-mirror/commit/9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0)".



---

archive/issue_comments_373685.json:
```json
{
    "body": "<a id='comment:17'></a>\nI have restored the use of networkx for the creation of the graph to pass the tests in `graphic_matroid`.",
    "created_at": "2018-01-20T10:25:56Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373685",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:17'></a>
I have restored the use of networkx for the creation of the graph to pass the tests in `graphic_matroid`.



---

archive/issue_events_217335.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-01-20T10:25:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217335"
}
```



---

archive/issue_events_217336.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-01-20T10:25:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217336"
}
```



---

archive/issue_comments_373686.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@dcoudert](#comment%3A17):\n> I have restored the use of networkx for the creation of the graph to pass the tests in `graphic_matroid`.\n\nbut why? We don't need networkx, we just have to adjust that tests...",
    "created_at": "2018-01-20T11:29:00Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373686",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Replying to [@dcoudert](#comment%3A17):
> I have restored the use of networkx for the creation of the graph to pass the tests in `graphic_matroid`.

but why? We don't need networkx, we just have to adjust that tests...



---

archive/issue_comments_373687.json:
```json
{
    "body": "<a id='comment:19'></a>\nI thought you wanted to fix what concern matroids in #24573. You confirm that we adjust the test here ?",
    "created_at": "2018-01-20T12:18:04Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373687",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:19'></a>
I thought you wanted to fix what concern matroids in #24573. You confirm that we adjust the test here ?



---

archive/issue_comments_373688.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [@dcoudert](#comment%3A19):\n> I thought you wanted to fix what concern matroids in #24573. You confirm that we adjust the test here ?\n\nThe only thing to fix in matroids is documentation of the function in question, which made it impossible to understand what the input should be. As you see in comment 15, it's the change of edge labelling generated by the matroid code (so edges 1 and 2 are no longer incident to vertex 0).\nOne fix suggested by Stefan in comment 12 is to use graph with edge labelling already generated:\n\n```\nsage: G = Graph([(0, 1, 0), (0, 2, 1), (0, 3, 2), (0, 4, 3), (1, 2, 4), (1, 4, 5), (2, 3, 6), (3, 4, 7)])\nsage: M = Matroid(G)\nsage: M1 = M.graphic_coextension(0, X=[1,2], element='a')\n```\nThis should be the most robust way.\n\nAnother way might be to use the updated labels, just 1-line change:\n\n```\nsage: M.graphic_coextension(0,X=[4,6])\n```\nwhich is potentially flaky, as it relies on the labelling one does not have control over.",
    "created_at": "2018-01-20T12:50:28Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373688",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
Replying to [@dcoudert](#comment%3A19):
> I thought you wanted to fix what concern matroids in #24573. You confirm that we adjust the test here ?

The only thing to fix in matroids is documentation of the function in question, which made it impossible to understand what the input should be. As you see in comment 15, it's the change of edge labelling generated by the matroid code (so edges 1 and 2 are no longer incident to vertex 0).
One fix suggested by Stefan in comment 12 is to use graph with edge labelling already generated:

```
sage: G = Graph([(0, 1, 0), (0, 2, 1), (0, 3, 2), (0, 4, 3), (1, 2, 4), (1, 4, 5), (2, 3, 6), (3, 4, 7)])
sage: M = Matroid(G)
sage: M1 = M.graphic_coextension(0, X=[1,2], element='a')
```
This should be the most robust way.

Another way might be to use the updated labels, just 1-line change:

```
sage: M.graphic_coextension(0,X=[4,6])
```
which is potentially flaky, as it relies on the labelling one does not have control over.



---

archive/issue_comments_373689.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06bd4a39cc55b52a110b4680c652fe76caeb58fb\">06bd4a3</a></td><td><code>trac #24512: stop using networkx in wheelgraph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6\">01f35a3</a></td><td><code>trac #24512: fix doctests in graphic_matroid</code></td></tr></table>\n",
    "created_at": "2018-01-20T14:40:33Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373689",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06bd4a39cc55b52a110b4680c652fe76caeb58fb">06bd4a3</a></td><td><code>trac #24512: stop using networkx in wheelgraph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6">01f35a3</a></td><td><code>trac #24512: fix doctests in graphic_matroid</code></td></tr></table>




---

archive/issue_comments_373690.json:
```json
{
    "body": "**Changing commit** from \"[9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0](https://github.com/sagemath/sagetrac-mirror/commit/9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0)\" to \"[01f35a35647930d9d8e2f3a044551e4b7ac6f7f6](https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6)\".",
    "created_at": "2018-01-20T14:40:33Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373690",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0](https://github.com/sagemath/sagetrac-mirror/commit/9a71f1c203ff4e2e075dc3b0460cdce66fdd90c0)" to "[01f35a35647930d9d8e2f3a044551e4b7ac6f7f6](https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6)".



---

archive/issue_comments_373691.json:
```json
{
    "body": "<a id='comment:22'></a>\nHope it will be ok now.",
    "created_at": "2018-01-20T14:41:14Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373691",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'></a>
Hope it will be ok now.



---

archive/issue_comments_373692.json:
```json
{
    "body": "<a id='comment:23'></a>\nOK, looks good, thanks!",
    "created_at": "2018-01-20T16:31:51Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373692",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
OK, looks good, thanks!



---

archive/issue_events_217337.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-20T16:31:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217337"
}
```



---

archive/issue_events_217338.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-01-20T16:31:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217338"
}
```



---

archive/issue_comments_373693.json:
```json
{
    "body": "**Changing branch** from \"[u/dcoudert/24512](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/24512)\" to \"[01f35a35647930d9d8e2f3a044551e4b7ac6f7f6](https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6)\".",
    "created_at": "2018-01-22T07:58:16Z",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24512#issuecomment-373693",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/dcoudert/24512](https://github.com/sagemath/sagetrac-mirror/tree/u/dcoudert/24512)" to "[01f35a35647930d9d8e2f3a044551e4b7ac6f7f6](https://github.com/sagemath/sagetrac-mirror/commit/01f35a35647930d9d8e2f3a044551e4b7ac6f7f6)".



---

archive/issue_events_217339.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-22T07:58:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217339"
}
```



---

archive/issue_events_217340.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c44a86fc1e1b8bc8aeb11ba253bb85f6adf8b2fd",
    "created_at": "2018-01-22T07:58:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24512",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24512#event-217340"
}
```
