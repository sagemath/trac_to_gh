# Issue 24618: fplll fails to build on SunOS

archive/issues_024381.json:
```json
{
    "body": "On `SunOS xenos-sagetest 5.11 11.3 sun4v sparc sun4v` with GCC 5.4.0:\n\n```\nlibtool: compile:  g++ -std=c++11 -DHAVE_CONFIG_H -I. -I.. -DFPLLL_DEFAULT_STRATEGY_PATH=\\\"/var/export/home/jeroen/sage/local/share/fplll/strategies\\\" -DFPLLL_DEFAULT_STRATEGY=\\\"/var/export/home/jeroen/sage/local/share/fplll/strategies/default.json\\\" -I./.. -I/var/export/home/jeroen/sage/local/include/ -I/include -m64 -O2 -g -D_XPG6 -fPIC -I/var/export/home/jeroen/sage/local/include/ -L/var/export/home/jeroen/sage/local/lib -O3 -MT fplll.lo -MD -MP -MF .deps/fplll.Tpo -c fplll.cpp  -fPIC -DPIC -o .libs/fplll.o\nIn file included from defs.h:56:0,\n                 from bkz_param.h:23,\n                 from bkz.h:21,\n                 from fplll.h:25,\n                 from fplll.cpp:18:\nnr/dpe.h: In function 'void dpe_pow_si(dpe_struct*, const dpe_struct*, unsigned int)':\nnr/dpe.h:718:35: error: call of overloaded 'pow(const double&, const unsigned int&)' is ambiguous\n   DPE_MANT(x) = pow(DPE_MANT(y), k);\n                                   ^\nIn file included from /usr/include/math.h:17:0,\n                 from /usr/gcc/5/include/c++/5.4.0/cmath:44,\n                 from defs.h:33,\n                 from bkz_param.h:23,\n                 from bkz.h:21,\n                 from fplll.h:25,\n                 from fplll.cpp:18:\n/usr/include/iso/math_iso.h:199:21: note: candidate: long double std::pow(long double, int)\n  inline long double pow(long double __X, int __Y) { return\n                     ^\n/usr/include/iso/math_iso.h:197:21: note: candidate: long double std::pow(long double, long double)\n  inline long double pow(long double __X, long double __Y) { return\n                     ^\n/usr/include/iso/math_iso.h:163:16: note: candidate: double std::pow(float, int)\n  inline double pow(float __X, int __Y) { return\n                ^\n/usr/include/iso/math_iso.h:161:15: note: candidate: float std::pow(float, float)\n  inline float pow(float __X, float __Y) { return __powf(__X, __Y); }\n               ^ \n/usr/include/iso/math_iso.h:141:16: note: candidate: double std::pow(double, int)\n  inline double pow(double __X, int __Y) { return\n                ^\n/usr/include/iso/math_iso.h:64:15: note: candidate: double std::pow(double, double)\n extern double pow __P((double, double));\n```\nand\n\n```\nsieve/sieve_gauss_2sieve.cpp:36:14: error: parse error in template argument list\n       if (p->norm < v->norm)\n```\nIt seems that GCC is misparsing `p->norm <` as a template `p->norm<...>` somehow: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=10200\n\n**Reported upstream**: https://github.com/fplll/fplll/pull/348\n\nCC:  @dimpase\n\nBranch/Commit: 3e34cd3b08480d42761cad93b2db51650e54d2cc\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24618\n\n",
    "closed_at": "2018-02-09T08:03:51Z",
    "created_at": "2018-01-31T06:28:03Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "fplll fails to build on SunOS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24618",
    "user": "https://github.com/jdemeyer"
}
```
On `SunOS xenos-sagetest 5.11 11.3 sun4v sparc sun4v` with GCC 5.4.0:

```
libtool: compile:  g++ -std=c++11 -DHAVE_CONFIG_H -I. -I.. -DFPLLL_DEFAULT_STRATEGY_PATH=\"/var/export/home/jeroen/sage/local/share/fplll/strategies\" -DFPLLL_DEFAULT_STRATEGY=\"/var/export/home/jeroen/sage/local/share/fplll/strategies/default.json\" -I./.. -I/var/export/home/jeroen/sage/local/include/ -I/include -m64 -O2 -g -D_XPG6 -fPIC -I/var/export/home/jeroen/sage/local/include/ -L/var/export/home/jeroen/sage/local/lib -O3 -MT fplll.lo -MD -MP -MF .deps/fplll.Tpo -c fplll.cpp  -fPIC -DPIC -o .libs/fplll.o
In file included from defs.h:56:0,
                 from bkz_param.h:23,
                 from bkz.h:21,
                 from fplll.h:25,
                 from fplll.cpp:18:
nr/dpe.h: In function 'void dpe_pow_si(dpe_struct*, const dpe_struct*, unsigned int)':
nr/dpe.h:718:35: error: call of overloaded 'pow(const double&, const unsigned int&)' is ambiguous
   DPE_MANT(x) = pow(DPE_MANT(y), k);
                                   ^
In file included from /usr/include/math.h:17:0,
                 from /usr/gcc/5/include/c++/5.4.0/cmath:44,
                 from defs.h:33,
                 from bkz_param.h:23,
                 from bkz.h:21,
                 from fplll.h:25,
                 from fplll.cpp:18:
/usr/include/iso/math_iso.h:199:21: note: candidate: long double std::pow(long double, int)
  inline long double pow(long double __X, int __Y) { return
                     ^
/usr/include/iso/math_iso.h:197:21: note: candidate: long double std::pow(long double, long double)
  inline long double pow(long double __X, long double __Y) { return
                     ^
/usr/include/iso/math_iso.h:163:16: note: candidate: double std::pow(float, int)
  inline double pow(float __X, int __Y) { return
                ^
/usr/include/iso/math_iso.h:161:15: note: candidate: float std::pow(float, float)
  inline float pow(float __X, float __Y) { return __powf(__X, __Y); }
               ^ 
/usr/include/iso/math_iso.h:141:16: note: candidate: double std::pow(double, int)
  inline double pow(double __X, int __Y) { return
                ^
/usr/include/iso/math_iso.h:64:15: note: candidate: double std::pow(double, double)
 extern double pow __P((double, double));
```
and

```
sieve/sieve_gauss_2sieve.cpp:36:14: error: parse error in template argument list
       if (p->norm < v->norm)
```
It seems that GCC is misparsing `p->norm <` as a template `p->norm<...>` somehow: https://gcc.gnu.org/bugzilla/show_bug.cgi?id=10200

**Reported upstream**: https://github.com/fplll/fplll/pull/348

CC:  @dimpase

Branch/Commit: 3e34cd3b08480d42761cad93b2db51650e54d2cc

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Dima Pasechnik

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24618





---

archive/issue_comments_341142.json:
```json
{
    "body": "<a id='comment:3'></a>Dima: from reading your comments on other tickets, I assume that you have a fix for this. Can you put it on this ticket please?",
    "created_at": "2018-02-03T08:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341142",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Dima: from reading your comments on other tickets, I assume that you have a fix for this. Can you put it on this ticket please?



---

archive/issue_comments_341143.json:
```json
{
    "body": "<a id='comment:4'></a>The \"fix\" is to use gcc 7.2, which compiles fplll just fine.\n\n(by the way, /datapool/dima/Sage/sagetrac-mirror - the SAGEROOT of my build - is world-readable, you may look there for logs and patches...)",
    "created_at": "2018-02-03T10:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341143",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>The "fix" is to use gcc 7.2, which compiles fplll just fine.

(by the way, /datapool/dima/Sage/sagetrac-mirror - the SAGEROOT of my build - is world-readable, you may look there for logs and patches...)



---

archive/issue_comments_341144.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 dimpase]:\n> The \"fix\" is to use gcc 7.2, which compiles fplll just fine.\n\n\nStrange. And GCC 7.2.0 did *not* fix the analogous problems with `pow()` for Singular?",
    "created_at": "2018-02-03T12:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341144",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:4 dimpase]:
> The "fix" is to use gcc 7.2, which compiles fplll just fine.


Strange. And GCC 7.2.0 did *not* fix the analogous problems with `pow()` for Singular?



---

archive/issue_comments_341145.json:
```json
{
    "body": "<a id='comment:6'></a>No, it did not. \nBut Singular's error with pow() is different (the only one that matters with gcc 7.2, anyway), there it's inability to use the templated pow() (failure to instantiate the template for `int pow(int,int)`)\n\nAnd indeed Singular with gcc 7.2 does not need patches for floor() and sqrt(), only the pow() ones are needed.",
    "created_at": "2018-02-03T14:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341145",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>No, it did not. 
But Singular's error with pow() is different (the only one that matters with gcc 7.2, anyway), there it's inability to use the templated pow() (failure to instantiate the template for `int pow(int,int)`)

And indeed Singular with gcc 7.2 does not need patches for floor() and sqrt(), only the pow() ones are needed.



---

archive/issue_comments_341146.json:
```json
{
    "body": "<a id='comment:7'></a>I'll try to fix this anyway with GCC 5.4.0 (unless it's too much trouble).",
    "created_at": "2018-02-03T15:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341146",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I'll try to fix this anyway with GCC 5.4.0 (unless it's too much trouble).



---

archive/issue_comments_341147.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-05T10:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341147",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_341148.json:
```json
{
    "body": "<a id='comment:9'></a>OK, so this is indeed gcc-5-specific, as I gather from your pull request (and from experimental evidence with gcc 7.2).\n\nNeeds review?",
    "created_at": "2018-02-05T10:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341148",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>OK, so this is indeed gcc-5-specific, as I gather from your pull request (and from experimental evidence with gcc 7.2).

Needs review?



---

archive/issue_comments_341149.json:
```json
{
    "body": "<a id='comment:11'></a>New commits:",
    "created_at": "2018-02-05T10:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341149",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>New commits:



---

archive/issue_comments_341150.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:9 dimpase]:\n> Needs review?\n\n\nI haven't tested a complete build of fplll myself (it takes a really long time to build by the way). So it might break for a stupid reason.",
    "created_at": "2018-02-05T10:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341150",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:9 dimpase]:
> Needs review?


I haven't tested a complete build of fplll myself (it takes a really long time to build by the way). So it might break for a stupid reason.



---

archive/issue_comments_341151.json:
```json
{
    "body": "<a id='comment:14'></a>It worked!\n\n```\nreal    30m36.844s\nuser    26m33.734s\nsys     1m19.607s\nCopying package files from temporary location /datapool/jeroen/sage/local/var/tmp/sage/build/fplll-5.2.0.p1/inst to /datapool/jeroen/sage/local\nSuccessfully installed fplll-5.2.0.p1\nDeleting temporary build directory\n/datapool/jeroen/sage/local/var/tmp/sage/build/fplll-5.2.0.p1\nFinished installing fplll-5.2.0.p1.spkg\n```",
    "created_at": "2018-02-05T11:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341151",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>It worked!

```
real    30m36.844s
user    26m33.734s
sys     1m19.607s
Copying package files from temporary location /datapool/jeroen/sage/local/var/tmp/sage/build/fplll-5.2.0.p1/inst to /datapool/jeroen/sage/local
Successfully installed fplll-5.2.0.p1
Deleting temporary build directory
/datapool/jeroen/sage/local/var/tmp/sage/build/fplll-5.2.0.p1
Finished installing fplll-5.2.0.p1.spkg
```



---

archive/issue_comments_341152.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-05T11:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341152",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_341153.json:
```json
{
    "body": "<a id='comment:15'></a>This worked for me as well (with gcc 7.2). Apparently I used bigger X in `-jX`, so it's \"just\" \n\n```\nreal    18m51.454s\nuser    32m32.749s\nsys     1m54.590s\n```",
    "created_at": "2018-02-05T11:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341153",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>This worked for me as well (with gcc 7.2). Apparently I used bigger X in `-jX`, so it's "just" 

```
real    18m51.454s
user    32m32.749s
sys     1m54.590s
```



---

archive/issue_comments_341154.json:
```json
{
    "body": "<a id='comment:16'></a>I'm building with `-j1` just because `-jN` might introduce problems by itself (although maybe not specifically on Solaris).",
    "created_at": "2018-02-05T11:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341154",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>I'm building with `-j1` just because `-jN` might introduce problems by itself (although maybe not specifically on Solaris).



---

archive/issue_comments_341155.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-09T08:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24618#issuecomment-341155",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062023.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-09T08:03:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24618",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24618#event-62023"
}
```
