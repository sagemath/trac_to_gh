# Issue 24699: Coxeter3 is broken

archive/issues_024462.json:
```json
{
    "body": "1. Several patches have been added *without* changing `package-version.txt`. This is obviously asking for trouble since the patches will simply not be applied. In particular, #21759 is required for GCC-7.2.0.\n\n2. It gives doctest failures on ppc64le due to an assumption that `char` == `signed char`. Upstream: https://github.com/tscrim/coxeter/pull/13\n\n3. Several files in `build/pkgs/coxeter3/patches` are simply copied instead of being patches.\n\n4. The package does not respect `CFLAGS` or `CXXFLAGS`, which makes issues harder to debug.\n\nThe attached branch fixes issue 1, 2 and 3. Issue 4 should be fixed upstream first (https://github.com/tscrim/coxeter/issues/2)\n\n**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/coxeter-8ac9c71723c8ca57a836d6381aed125261e44e9e.tar.bz2\n\nCC:  @tscrim\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Jeroen Demeyer\n\nBranch: 350384646c1bc22e07fb987497a4794ab416c2d1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24699\n\n",
    "closed_at": "2018-03-04T23:29:28Z",
    "created_at": "2018-02-09T16:58:07Z",
    "labels": [
        "component: packages: optional",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Coxeter3 is broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24699",
    "user": "https://github.com/jdemeyer"
}
```
1. Several patches have been added *without* changing `package-version.txt`. This is obviously asking for trouble since the patches will simply not be applied. In particular, #21759 is required for GCC-7.2.0.

2. It gives doctest failures on ppc64le due to an assumption that `char` == `signed char`. Upstream: https://github.com/tscrim/coxeter/pull/13

3. Several files in `build/pkgs/coxeter3/patches` are simply copied instead of being patches.

4. The package does not respect `CFLAGS` or `CXXFLAGS`, which makes issues harder to debug.

The attached branch fixes issue 1, 2 and 3. Issue 4 should be fixed upstream first (https://github.com/tscrim/coxeter/issues/2)

**Tarball**: http://sage.ugent.be/www/jdemeyer/sage/coxeter-8ac9c71723c8ca57a836d6381aed125261e44e9e.tar.bz2

CC:  @tscrim

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Frédéric Chapoton

Author: Jeroen Demeyer

Branch: 350384646c1bc22e07fb987497a4794ab416c2d1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24699





---

archive/issue_comments_342785.json:
```json
{
    "body": "<a id='comment:3'></a>I will try to fix this ASAP, but I may not know when that will be. It would be helpful to have access to a machine that can reproduce the failures.",
    "created_at": "2018-02-09T21:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342785",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>I will try to fix this ASAP, but I may not know when that will be. It would be helpful to have access to a machine that can reproduce the failures.



---

archive/issue_comments_342786.json:
```json
{
    "body": "<a id='comment:8'></a>Note that issues 1 and 4 are system-independent, so they should be easy to fix.",
    "created_at": "2018-02-10T12:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342786",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Note that issues 1 and 4 are system-independent, so they should be easy to fix.



---

archive/issue_comments_342787.json:
```json
{
    "body": "<a id='comment:9'></a>I diagnosed issue 2: it's because something is assuming that `char` == `signed char` and this is not the case on ppc64le (and on ARM neither): `char` is unsigned.\n\nCompiling coxeter3 with `-fsigned-char` fixes the problem. Ideally, the source code should be fixed by replacing `char -> signed char` where needed but in the worst case, we can just compile with `-fsigned-char`.",
    "created_at": "2018-02-19T09:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342787",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>I diagnosed issue 2: it's because something is assuming that `char` == `signed char` and this is not the case on ppc64le (and on ARM neither): `char` is unsigned.

Compiling coxeter3 with `-fsigned-char` fixes the problem. Ideally, the source code should be fixed by replacing `char -> signed char` where needed but in the worst case, we can just compile with `-fsigned-char`.



---

archive/issue_comments_342788.json:
```json
{
    "body": "<a id='comment:10'></a>Fixed issue 2\n\n```diff\ndiff -ru src/minroots.h b/minroots.h\n--- src/minroots.h      2013-02-14 18:26:28.000000000 +0100\n+++ b/minroots.h        2018-02-19 10:33:53.388377951 +0100\n@@ -19,7 +19,7 @@\n \n namespace minroots {\n   typedef unsigned MinNbr;\n-  typedef char DotProduct;\n+  typedef signed char DotProduct;\n   class MinTable;\n };\n \n```",
    "created_at": "2018-02-19T09:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342788",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Fixed issue 2

```diff
diff -ru src/minroots.h b/minroots.h
--- src/minroots.h      2013-02-14 18:26:28.000000000 +0100
+++ b/minroots.h        2018-02-19 10:33:53.388377951 +0100
@@ -19,7 +19,7 @@
 
 namespace minroots {
   typedef unsigned MinNbr;
-  typedef char DotProduct;
+  typedef signed char DotProduct;
   class MinTable;
 };
 
```



---

archive/issue_comments_342789.json:
```json
{
    "body": "<a id='comment:11'></a>Travis, did you start working on this? Should I make a branch or will you?",
    "created_at": "2018-02-19T09:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342789",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Travis, did you start working on this? Should I make a branch or will you?



---

archive/issue_comments_342790.json:
```json
{
    "body": "<a id='comment:13'></a>Thank you for figuring out the issue. I have not had any time to devote to this. If you could make a branch, that would be appreciated. Thank you and sorry that you're having to do all the work.",
    "created_at": "2018-02-19T11:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342790",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Thank you for figuring out the issue. I have not had any time to devote to this. If you could make a branch, that would be appreciated. Thank you and sorry that you're having to do all the work.



---

archive/issue_comments_342791.json:
```json
{
    "body": "<a id='comment:14'></a>What is the upstream situation of coxeter3? There is a github repo, but are there releases? If not, how can I know with which \"release\" the Sage package corresponds to?",
    "created_at": "2018-02-19T11:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342791",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>What is the upstream situation of coxeter3? There is a github repo, but are there releases? If not, how can I know with which "release" the Sage package corresponds to?



---

archive/issue_comments_342792.json:
```json
{
    "body": "<a id='comment:15'></a>I currently do not have any releases because I have not put in the necessary time to clean up the code sufficiently and have a testing framework in place to make sure there are no speed regressions. Likely this will not change in the near future.",
    "created_at": "2018-02-19T11:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342792",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>I currently do not have any releases because I have not put in the necessary time to clean up the code sufficiently and have a testing framework in place to make sure there are no speed regressions. Likely this will not change in the near future.



---

archive/issue_comments_342793.json:
```json
{
    "body": "<a id='comment:16'></a>Do you plan to merge the upstream pull request?",
    "created_at": "2018-02-19T13:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342793",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Do you plan to merge the upstream pull request?



---

archive/issue_comments_342794.json:
```json
{
    "body": "<a id='comment:17'></a>Yes, I will merge it upstream.",
    "created_at": "2018-02-20T00:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342794",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>Yes, I will merge it upstream.



---

archive/issue_comments_342795.json:
```json
{
    "body": "<a id='comment:19'></a>I'll work on this today.",
    "created_at": "2018-02-26T09:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342795",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>I'll work on this today.



---

archive/issue_comments_342796.json:
```json
{
    "body": "<a id='comment:20'></a>Thank you. Don't worry about making it a high priority since I will have time to do this on Wednesday too.",
    "created_at": "2018-02-26T10:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342796",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'></a>Thank you. Don't worry about making it a high priority since I will have time to do this on Wednesday too.



---

archive/issue_comments_342797.json:
```json
{
    "body": "<a id='comment:22'></a>New commits:",
    "created_at": "2018-02-26T14:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342797",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>New commits:



---

archive/issue_comments_342798.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-26T15:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342799.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-26T15:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342799",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342800.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-03T08:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342800",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342801.json:
```json
{
    "body": "<a id='comment:25'></a>ok, tested and good to go",
    "created_at": "2018-03-03T08:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342801",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>ok, tested and good to go



---

archive/issue_comments_342802.json:
```json
{
    "body": "<a id='comment:26'></a>I was hoping to make a bugfix release of coxeter3 this upcoming week, but I guess that will just be a followup.",
    "created_at": "2018-03-03T21:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342802",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>I was hoping to make a bugfix release of coxeter3 this upcoming week, but I guess that will just be a followup.



---

archive/issue_events_062168.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-04T23:29:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24699#event-62168"
}
```



---

archive/issue_comments_342803.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-04T23:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342803",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_342804.json:
```json
{
    "body": "<a id='comment:28'></a>See #25321 for a followup.",
    "created_at": "2018-05-09T23:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24699#issuecomment-342804",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>See #25321 for a followup.
