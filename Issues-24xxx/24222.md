# Issue 24222: py3: simplified string conversion utilities

archive/issues_023985.json:
```json
{
    "assignees": [],
    "body": "A possible alternative to #24186, implementing simple conversion from C `char` arrays or `bytes` objects to `str` objects, and of `str` objects to `bytes` objects.  Here \"`str`\" and \"`bytes`\" are to be read exactly for either Python 2 or Python 3, so on Python 2 this means no conversion is performed since `str is bytes == True`.\n\nOne thing this does not do is implement any kind of conversion from Python 2 `unicode` objects to `bytes`.  This functionality might be worth adding, in some form, to `str_to_bytes`.  But this would add a *new* feature on Python 2, whereas for now I'm only trying to preserve the existing functionality on Python 2 exactly, while transparently supporting Python 3 `str`s everywhere that Python 2 `str`s are supported.\n\nCC:  @fchapoton @jdemeyer\n\nBranch/Commit: **[`dec9f3a`](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)**\n\nReviewer: **Jeroen Demeyer, Erik Bray**\n\nAuthor: **Erik Bray, Jeroen Demeyer**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24222_\n\n",
    "closed_at": "2017-12-26T09:25:41Z",
    "created_at": "2017-11-16T11:38:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: simplified string conversion utilities",
    "type": "issue",
    "updated_at": "2017-12-26T09:25:41Z",
    "url": "https://github.com/sagemath/sage/issues/24222",
    "user": "https://github.com/embray"
}
```
A possible alternative to #24186, implementing simple conversion from C `char` arrays or `bytes` objects to `str` objects, and of `str` objects to `bytes` objects.  Here "`str`" and "`bytes`" are to be read exactly for either Python 2 or Python 3, so on Python 2 this means no conversion is performed since `str is bytes == True`.

One thing this does not do is implement any kind of conversion from Python 2 `unicode` objects to `bytes`.  This functionality might be worth adding, in some form, to `str_to_bytes`.  But this would add a *new* feature on Python 2, whereas for now I'm only trying to preserve the existing functionality on Python 2 exactly, while transparently supporting Python 3 `str`s everywhere that Python 2 `str`s are supported.

CC:  @fchapoton @jdemeyer

Branch/Commit: **[`dec9f3a`](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)**

Reviewer: **Jeroen Demeyer, Erik Bray**

Author: **Erik Bray, Jeroen Demeyer**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/24222_





---

archive/issue_events_333091.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333091"
}
```



---

archive/issue_events_333092.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333092"
}
```



---

archive/issue_events_333093.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333093"
}
```



---

archive/issue_events_333094.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333094"
}
```



---

archive/issue_comments_366370.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc\"><code>4c78743</code></a></td><td><code>Add new string conversion utilities.</code></td></tr></table>\n",
    "created_at": "2017-11-16T11:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366370",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc"><code>4c78743</code></a></td><td><code>Add new string conversion utilities.</code></td></tr></table>




---

archive/issue_comments_366371.json:
```json
{
    "body": "Commit: **[`4c78743`](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)**",
    "created_at": "2017-11-16T11:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366371",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`4c78743`](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)**



---

archive/issue_events_333095.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:44:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333095"
}
```



---

archive/issue_events_333096.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-16T11:59:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333096"
}
```



---

archive/issue_events_333097.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-16T11:59:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333097"
}
```



---

archive/issue_comments_366372.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOK, so now we have to discuss encodings... first of all, I really don't like the `encoding` argument in the functions, that will just slow everything down. Better pick one (or a few) good encoding(s) and use those.\n\nI don't see why you would pick `locale.getpreferredencoding()` as default encoding. Relevant encodings should be:\n\n1. `ascii`. In many cases we know that output from a C library is an ASCII string (for example, the string representation of a number). Luckily, ASCII is compatible with most other encodings, so this isn't an issue.\n\n2. `filesystemencoding`. This is the encoding that Python internally uses for most conversions `char*` <-> `str`. For this reason, I think that this is the most important use case and it should be the default when in doubt.\n\n3. `utf-8`. This is good if you just want to store `unicode` as `char*` (say, an internal user-specified name for something) and you don't care about the exact encoding but you do care that round-trip conversion works properly.\n\n4. `locale.getpreferredencoding()`. I believe that this is mainly relevant for subprocesses, provided that those subprocesses also look at the encoding.\n\nFor efficiency, I would rather have several sets of functions, each with a hard-coded encoding.\n\nI would also suggest to implement these functions (or at least the functions where you care about performance) as `cdef inline` functions in the `.pxd` file. That way, they will actually be inlined when calling them from an external Cython module.",
    "created_at": "2017-11-16T11:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366372",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

OK, so now we have to discuss encodings... first of all, I really don't like the `encoding` argument in the functions, that will just slow everything down. Better pick one (or a few) good encoding(s) and use those.

I don't see why you would pick `locale.getpreferredencoding()` as default encoding. Relevant encodings should be:

1. `ascii`. In many cases we know that output from a C library is an ASCII string (for example, the string representation of a number). Luckily, ASCII is compatible with most other encodings, so this isn't an issue.

2. `filesystemencoding`. This is the encoding that Python internally uses for most conversions `char*` <-> `str`. For this reason, I think that this is the most important use case and it should be the default when in doubt.

3. `utf-8`. This is good if you just want to store `unicode` as `char*` (say, an internal user-specified name for something) and you don't care about the exact encoding but you do care that round-trip conversion works properly.

4. `locale.getpreferredencoding()`. I believe that this is mainly relevant for subprocesses, provided that those subprocesses also look at the encoding.

For efficiency, I would rather have several sets of functions, each with a hard-coded encoding.

I would also suggest to implement these functions (or at least the functions where you care about performance) as `cdef inline` functions in the `.pxd` file. That way, they will actually be inlined when calling them from an external Cython module.



---

archive/issue_comments_366373.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nYou don't need `six.PY2`. You can just replace\n\n```\nif six.PY2:\n    from cpython.string cimport PyString_FromString\nelse:\n    from cpython.bytes cimport PyBytes_FromString as PyString_FromString\n```\nby\n\n```\nfrom cpython.bytes cimport PyBytes_FromString as PyString_FromString\n```\nYou could also just use `PyBytes_FromString` in the code.",
    "created_at": "2017-11-16T12:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366373",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

You don't need `six.PY2`. You can just replace

```
if six.PY2:
    from cpython.string cimport PyString_FromString
else:
    from cpython.bytes cimport PyBytes_FromString as PyString_FromString
```
by

```
from cpython.bytes cimport PyBytes_FromString as PyString_FromString
```
You could also just use `PyBytes_FromString` in the code.



---

archive/issue_comments_366374.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@jdemeyer](#comment%3A4):\n> You don't need `six.PY2`. You can just replace\n\nThat's what I thought originally too, but I was having some problems trying to do it as a one-liner.  I'll try your suggestion though and double-check whether it works.",
    "created_at": "2017-11-16T12:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366374",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@jdemeyer](#comment%3A4):
> You don't need `six.PY2`. You can just replace

That's what I thought originally too, but I was having some problems trying to do it as a one-liner.  I'll try your suggestion though and double-check whether it works.



---

archive/issue_comments_366375.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI don't think the \"encoding\" argument slows anything down by any significant amount, especially in cases where it isn't used.  I'd be amenable to encoding-specific functions for some cases, as Python has those as well in its API.  But right now I'm really trying to avoid breadth of API surface.  It *is* good to have generic versions of these functions that accept any encoding, and this is the bare minimum needed to get Python 3 support off the ground.  I think that later we can encoding-specific functions where *specific* use cases for them can be demonstrated.  I don't want to get into the weeds with this right now.\n\nAs for the default encoding, `locale.getpreferredencoding()` makes more sense.  `sys.getfilesystemencoding()` is specifically about guessing (more or less) what encoding the filesystem *specifically* is using for encoding e.g. of filenames, and has nothing to do with encodings of file contents or of arbitrary strings output by software.  (Well, that's not exactly true since on *nix the two are essentially the same, although the former can change if the process's locale is changed, I think).\n\nSo on *NIX platforms like we care about the most it's actually *mostly* a moot point.  But a lot of the software Sage interfaces with is locale-aware, so it's better to take that into account as the default than not.",
    "created_at": "2017-11-16T12:48:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366375",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

I don't think the "encoding" argument slows anything down by any significant amount, especially in cases where it isn't used.  I'd be amenable to encoding-specific functions for some cases, as Python has those as well in its API.  But right now I'm really trying to avoid breadth of API surface.  It *is* good to have generic versions of these functions that accept any encoding, and this is the bare minimum needed to get Python 3 support off the ground.  I think that later we can encoding-specific functions where *specific* use cases for them can be demonstrated.  I don't want to get into the weeds with this right now.

As for the default encoding, `locale.getpreferredencoding()` makes more sense.  `sys.getfilesystemencoding()` is specifically about guessing (more or less) what encoding the filesystem *specifically* is using for encoding e.g. of filenames, and has nothing to do with encodings of file contents or of arbitrary strings output by software.  (Well, that's not exactly true since on *nix the two are essentially the same, although the former can change if the process's locale is changed, I think).

So on *NIX platforms like we care about the most it's actually *mostly* a moot point.  But a lot of the software Sage interfaces with is locale-aware, so it's better to take that into account as the default than not.



---

archive/issue_comments_366376.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n> I would also suggest to implement these functions (or at least the functions where you care about performance) as cdef inline functions in the .pxd file.\n\nI was wondering about that.  But in that case the `.pyx` file will be empty (does it even need to exist at all)?  What about the default encoding variables?",
    "created_at": "2017-11-16T12:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366376",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

> I would also suggest to implement these functions (or at least the functions where you care about performance) as cdef inline functions in the .pxd file.

I was wondering about that.  But in that case the `.pyx` file will be empty (does it even need to exist at all)?  What about the default encoding variables?



---

archive/issue_comments_366377.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nMaybe the best solution would be to not have a default encoding and require users to think what encoding they want?",
    "created_at": "2017-11-16T12:57:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366377",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Maybe the best solution would be to not have a default encoding and require users to think what encoding they want?



---

archive/issue_comments_366378.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@embray](#comment%3A6):\n> I don't think the \"encoding\" argument slows anything down by any significant amount\n\nThe Python 3 C API has specific functions to encode/decode for certainly particular encodings:\n* https://docs.python.org/3/c-api/unicode.html#utf-8-codecs\n* https://docs.python.org/3/c-api/unicode.html#locale-encoding\n* https://docs.python.org/3/c-api/unicode.html#file-system-encoding\n\nI haven't profiled, but I would hope that these are faster than the generic API.",
    "created_at": "2017-11-16T13:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366378",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@embray](#comment%3A6):
> I don't think the "encoding" argument slows anything down by any significant amount

The Python 3 C API has specific functions to encode/decode for certainly particular encodings:
* https://docs.python.org/3/c-api/unicode.html#utf-8-codecs
* https://docs.python.org/3/c-api/unicode.html#locale-encoding
* https://docs.python.org/3/c-api/unicode.html#file-system-encoding

I haven't profiled, but I would hope that these are faster than the generic API.



---

archive/issue_comments_366379.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@embray](#comment%3A7):\n> But in that case the `.pyx` file will be empty (does it even need to exist at all)?\n\nIt doesn't need to exist.\n\n> What about the default encoding variables?\n\nI propose to remove those variables anyway. If you *do* need them for some reason, they must be in the `.pyx` file.",
    "created_at": "2017-11-16T13:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366379",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@embray](#comment%3A7):
> But in that case the `.pyx` file will be empty (does it even need to exist at all)?

It doesn't need to exist.

> What about the default encoding variables?

I propose to remove those variables anyway. If you *do* need them for some reason, they must be in the `.pyx` file.



---

archive/issue_comments_366380.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nTwo more things:\n\n1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like\n\n```\nif (0)\n    nonexisting_function()\n```\nwhen `nonexisting_function()` doesn't actually exist like `PyUnicode_AsUTF8` on Python 2. The only reason that the above code compiles is compiler optimization.\n\nSee also #24215 for Cython-compile-time constants in general.\n\n2. Could you move this to `sage/cpython/string.pxd`? I recently created the `sage/cpython` directory to deal with low-level Python internals and I think that these functions would fit there.",
    "created_at": "2017-11-16T13:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366380",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Two more things:

1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like

```
if (0)
    nonexisting_function()
```
when `nonexisting_function()` doesn't actually exist like `PyUnicode_AsUTF8` on Python 2. The only reason that the above code compiles is compiler optimization.

See also #24215 for Cython-compile-time constants in general.

2. Could you move this to `sage/cpython/string.pxd`? I recently created the `sage/cpython` directory to deal with low-level Python internals and I think that these functions would fit there.



---

archive/issue_comments_366381.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nfails to build, see patchbot report:\n\n```\nfrom string import Template\n```",
    "created_at": "2017-11-16T15:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366381",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

fails to build, see patchbot report:

```
from string import Template
```



---

archive/issue_comments_366382.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\noh, I see. Name conflict between the global \"string\" module and the local \"string\" module..",
    "created_at": "2017-11-16T15:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366382",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:13" align="right">comment:13</div>

oh, I see. Name conflict between the global "string" module and the local "string" module..



---

archive/issue_comments_366383.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jdemeyer](#comment%3A8):\n> Maybe the best solution would be to not have a default encoding and require users to think what encoding they want?\n\nThat's far too onerous and anxiety-provoking for the user :)  Python itself uses default encodings all over the place when in doubt (hence e.g. [PyUnicode_DecodeFSDefault](https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_DecodeFSDefault)).  It's an unfortunate fact that there's isn't always one \"right answer\" here; the best we can do is provide sensible defaults *and* the ability for user-specified encoding where applicable; that is, where we know we want a specific encoding.  Moving forward we can also do more, for example, to ensure that any locale-aware code run by Sage is handled well.\n\nI could definitely agree to adding more encoding-specific helper functions, especially for ASCII and UTF-8.  But as a first pass, for the sake of getting Python 3 support off the ground, I'd prefer to leave this as is and then make adjustments as specific use cases arise.  It will be difficult to even find those specific use cases until and unless we get further along on getting Python 3 working in general (with these functions, plus a few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so that will help expose a lot of interesting cases *quickly*).\n\nI'll look at the rest of your suggestions; they seem reasonable.",
    "created_at": "2017-11-17T14:22:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366383",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jdemeyer](#comment%3A8):
> Maybe the best solution would be to not have a default encoding and require users to think what encoding they want?

That's far too onerous and anxiety-provoking for the user :)  Python itself uses default encodings all over the place when in doubt (hence e.g. [PyUnicode_DecodeFSDefault](https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_DecodeFSDefault)).  It's an unfortunate fact that there's isn't always one "right answer" here; the best we can do is provide sensible defaults *and* the ability for user-specified encoding where applicable; that is, where we know we want a specific encoding.  Moving forward we can also do more, for example, to ensure that any locale-aware code run by Sage is handled well.

I could definitely agree to adding more encoding-specific helper functions, especially for ASCII and UTF-8.  But as a first pass, for the sake of getting Python 3 support off the ground, I'd prefer to leave this as is and then make adjustments as specific use cases arise.  It will be difficult to even find those specific use cases until and unless we get further along on getting Python 3 working in general (with these functions, plus a few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so that will help expose a lot of interesting cases *quickly*).

I'll look at the rest of your suggestions; they seem reasonable.



---

archive/issue_comments_366384.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment%3A11):\n> Two more things:\n> \n> 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like\n\nAh, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?",
    "created_at": "2017-11-17T14:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366384",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment%3A11):
> Two more things:
> 
> 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like

Ah, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?



---

archive/issue_comments_366385.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@embray](#comment%3A15):\n> Replying to [@jdemeyer](#comment%3A11):\n> > Two more things:\n> > \n> > 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like\n\n> \n> Ah, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?\n\nNevermind; I see now that we explicitly pass that in to `cythonize` in the `setup.py`.  For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.",
    "created_at": "2017-11-17T14:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366385",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@embray](#comment%3A15):
> Replying to [@jdemeyer](#comment%3A11):
> > Two more things:
> > 
> > 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like

> 
> Ah, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?

Nevermind; I see now that we explicitly pass that in to `cythonize` in the `setup.py`.  For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.



---

archive/issue_comments_366386.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n>It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).\n> \n\nThis sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.",
    "created_at": "2017-11-17T14:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366386",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

>It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).
> 

This sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.



---

archive/issue_comments_366387.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@fchapoton](#comment%3A17):\n> >It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).\n> > \n\n> \n> This sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.\n\nI had to get it working, in part, so that I could run the doctests for this module :)\n\nI think it will help things go much faster.",
    "created_at": "2017-11-17T15:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366387",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@fchapoton](#comment%3A17):
> >It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).
> > 

> 
> This sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.

I had to get it working, in part, so that I could run the doctests for this module :)

I think it will help things go much faster.



---

archive/issue_comments_366388.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI'm seeing now how wanting to have module-level global variables in conjunction with inline `c(p)def` functions in Cython gets problematic.  It just compiles them as `__Pyx_GetModuleGlobalName(name)`.  I feel like this should be a bug (I *think* not too difficult to fix?) in Cython, since it's really counter to how Python should work in this case.\n\nFor functions inlined from another module--at least if those functions access global variables from their original module--it should import that module during module initialization and use the correct module dict for globals lookups (just as normal Python functions do, basically).\n\nThat's an issue beyond this one though, so I'll rework things for now to get rid use of the global variables by these functions (I still want to have default encodings though).",
    "created_at": "2017-11-17T15:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366388",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

I'm seeing now how wanting to have module-level global variables in conjunction with inline `c(p)def` functions in Cython gets problematic.  It just compiles them as `__Pyx_GetModuleGlobalName(name)`.  I feel like this should be a bug (I *think* not too difficult to fix?) in Cython, since it's really counter to how Python should work in this case.

For functions inlined from another module--at least if those functions access global variables from their original module--it should import that module during module initialization and use the correct module dict for globals lookups (just as normal Python functions do, basically).

That's an issue beyond this one though, so I'll rework things for now to get rid use of the global variables by these functions (I still want to have default encodings though).



---

archive/issue_comments_366389.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSo it turns out `PyUnicode_AsEncodedString` and `PyUnicode_Decode` do allow the `encoding` argument to be `NULL`, in which case they default to UTF-8.  So if it's a good enough default for Python maybe it's a good enough default for us, for now.\n\nPerhaps I'll just stick with that functionality, and take care to use things like `locale.getpreferredencoding()` when necessary, such as interfacing with external software.  To that end it would be good to come up with some list of exactly what software Sage interfaces with *is* locale aware.  Certainly ECL and GAP are strong candidates; probably others.  It will be good to add some tests to that effect but we can worry about it when we come to it.",
    "created_at": "2017-11-17T16:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366389",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

So it turns out `PyUnicode_AsEncodedString` and `PyUnicode_Decode` do allow the `encoding` argument to be `NULL`, in which case they default to UTF-8.  So if it's a good enough default for Python maybe it's a good enough default for us, for now.

Perhaps I'll just stick with that functionality, and take care to use things like `locale.getpreferredencoding()` when necessary, such as interfacing with external software.  To that end it would be good to come up with some list of exactly what software Sage interfaces with *is* locale aware.  Certainly ECL and GAP are strong candidates; probably others.  It will be good to add some tests to that effect but we can worry about it when we come to it.



---

archive/issue_comments_366390.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@embray](#comment%3A14):\n> Python itself uses default encodings all over the place when in doubt\n\nRight, but there are several defaults (each of UTF-8, `sys.getfilesystemencoding()` and `locale.getpreferredencoding()` could be considered as defaults). And I don't think that any of those 3 has the large majority. So I still feel that forcing the user to pick one is the best solution.",
    "created_at": "2017-11-17T16:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366390",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@embray](#comment%3A14):
> Python itself uses default encodings all over the place when in doubt

Right, but there are several defaults (each of UTF-8, `sys.getfilesystemencoding()` and `locale.getpreferredencoding()` could be considered as defaults). And I don't think that any of those 3 has the large majority. So I still feel that forcing the user to pick one is the best solution.



---

archive/issue_comments_366391.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAlso, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.",
    "created_at": "2017-11-17T17:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366391",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

Also, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.



---

archive/issue_comments_366392.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@embray](#comment%3A16):\n> For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.\n\nNo problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.",
    "created_at": "2017-11-17T17:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366392",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@embray](#comment%3A16):
> For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.

No problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.



---

archive/issue_comments_366393.json:
```json
{
    "body": "Changed commit from **[`4c78743`](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)** to **[`bb073e8`](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)**",
    "created_at": "2017-11-20T08:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366393",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4c78743`](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)** to **[`bb073e8`](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)**



---

archive/issue_comments_366394.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1\"><code>bb073e8</code></a></td><td><code>Move sage.misc.string to sage.cpython.string and rework how default encoding is handled</code></td></tr></table>\n",
    "created_at": "2017-11-20T08:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366394",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1"><code>bb073e8</code></a></td><td><code>Move sage.misc.string to sage.cpython.string and rework how default encoding is handled</code></td></tr></table>




---

archive/issue_comments_366395.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jdemeyer](#comment%3A23):\n> Replying to [@embray](#comment%3A16):\n> > For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.\n\n> \n> No problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.\n\nOkay hold on...",
    "created_at": "2017-11-20T08:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366395",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jdemeyer](#comment%3A23):
> Replying to [@embray](#comment%3A16):
> > For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.

> 
> No problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.

Okay hold on...



---

archive/issue_comments_366396.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment%3A22):\n> Also, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.\n\nYeah, I'm inclined to agree here--I think I'll change that.  But in that case I'd also want an optional argument for error handling.",
    "created_at": "2017-11-20T08:39:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366396",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment%3A22):
> Also, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.

Yeah, I'm inclined to agree here--I think I'll change that.  But in that case I'd also want an optional argument for error handling.



---

archive/issue_comments_366397.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@fchapoton](#comment%3A12):\n> fails to build, see patchbot report:\n> \n> ```\n> from string import Template\n> ```\n\nFixed in #24242.",
    "created_at": "2017-11-20T08:42:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366397",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@fchapoton](#comment%3A12):
> fails to build, see patchbot report:
> 
> ```
> from string import Template
> ```

Fixed in #24242.



---

archive/issue_comments_366398.json:
```json
{
    "body": "Changed commit from **[`bb073e8`](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)** to **[`a5d5219`](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)**",
    "created_at": "2017-11-20T09:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366398",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bb073e8`](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)** to **[`a5d5219`](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)**



---

archive/issue_comments_366399.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65\"><code>158d984</code></a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2\"><code>7f06e71</code></a></td><td><code>Fix documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ac146c17ccabbaf53918f874f516909041e82c5\"><code>3ac146c</code></a></td><td><code>Add a Cython compile-time constant for Python major version.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f71fd41b659ea250ec96c0df343c4fe6b2be9289\"><code>f71fd41</code></a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4\"><code>a5d5219</code></a></td><td><code>Add support for optional error handling.</code></td></tr></table>\n",
    "created_at": "2017-11-20T09:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366399",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65"><code>158d984</code></a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2"><code>7f06e71</code></a></td><td><code>Fix documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ac146c17ccabbaf53918f874f516909041e82c5"><code>3ac146c</code></a></td><td><code>Add a Cython compile-time constant for Python major version.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f71fd41b659ea250ec96c0df343c4fe6b2be9289"><code>f71fd41</code></a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4"><code>a5d5219</code></a></td><td><code>Add support for optional error handling.</code></td></tr></table>




---

archive/issue_comments_366400.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI'm pretty happy with this now as-is.  I'm up for minor tweaking but would prefer not to make any other major changes to how this works, for now, since it's proving pretty useful in getting other code working.\n\nI'd be up for adding additional shortcut functions for certain special cases if they come up often enough--we'll see.\n\n(Also, it turns out if you put `cpdef` function definitions into a `.pxd` file it won't generate a module for them unless you also have a corresponding `.pyx` file, even if it's empty--annoying.  That said, it's useful to have a shortcut for `sys.getfilesystemencoding()` which is annoying to write :)",
    "created_at": "2017-11-20T09:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366400",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

I'm pretty happy with this now as-is.  I'm up for minor tweaking but would prefer not to make any other major changes to how this works, for now, since it's proving pretty useful in getting other code working.

I'd be up for adding additional shortcut functions for certain special cases if they come up often enough--we'll see.

(Also, it turns out if you put `cpdef` function definitions into a `.pxd` file it won't generate a module for them unless you also have a corresponding `.pyx` file, even if it's empty--annoying.  That said, it's useful to have a shortcut for `sys.getfilesystemencoding()` which is annoying to write :)



---

archive/issue_comments_366401.json:
```json
{
    "body": "Dependencies: **#24246**",
    "created_at": "2017-11-20T09:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366401",
    "user": "https://github.com/embray"
}
```

Dependencies: **#24246**



---

archive/issue_events_333098.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-20T09:14:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333098"
}
```



---

archive/issue_events_333099.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-20T09:14:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333099"
}
```



---

archive/issue_comments_366402.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI have just noticed that we use a similar kind of function \"from sagenb.misc.misc import encoded_str\" in src/sage/misc/latex.py..",
    "created_at": "2017-11-20T15:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366402",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:30" align="right">comment:30</div>

I have just noticed that we use a similar kind of function "from sagenb.misc.misc import encoded_str" in src/sage/misc/latex.py..



---

archive/issue_comments_366403.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIf you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.",
    "created_at": "2017-11-20T17:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366403",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

If you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.



---

archive/issue_comments_366404.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@embray](#comment%3A29):\n> since it's proving pretty useful in getting other code working.\n\nIf you have such use cases, I'd love to see them.\n\nI'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?",
    "created_at": "2017-11-20T17:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366404",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@embray](#comment%3A29):
> since it's proving pretty useful in getting other code working.

If you have such use cases, I'd love to see them.

I'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?



---

archive/issue_comments_366405.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThe code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).",
    "created_at": "2017-11-20T17:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366405",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

The code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).



---

archive/issue_comments_366406.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@jdemeyer](#comment%3A32):\n> Replying to [@embray](#comment%3A29):\n> > since it's proving pretty useful in getting other code working.\n\n> \n> If you have such use cases, I'd love to see them.\n\nNever mind, I just noticed #24223.",
    "created_at": "2017-11-20T19:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366406",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@jdemeyer](#comment%3A32):
> Replying to [@embray](#comment%3A29):
> > since it's proving pretty useful in getting other code working.

> 
> If you have such use cases, I'd love to see them.

Never mind, I just noticed #24223.



---

archive/issue_comments_366407.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@jdemeyer](#comment%3A31):\n> If you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.\n\nDoesn't that mean that from Python you'd have to pass those arguments in as `bytes` then?\n\nLet's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.",
    "created_at": "2017-11-22T14:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366407",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@jdemeyer](#comment%3A31):
> If you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.

Doesn't that mean that from Python you'd have to pass those arguments in as `bytes` then?

Let's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.



---

archive/issue_comments_366408.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@jdemeyer](#comment%3A32):\n> I'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?\n\nNo, for exactly the reason that in all cases it's not clear what the best choice is.  Anyways the end result is going to be everyone just writing \"utf-8\" everywhere which I'd prefer to avoid.  I'd like to see how far we get with a sensible default for now.  There are some cases where it's definitely good to specify an encoding--for example all files written by sage can be encoded utf-8 in general.  In general that's not the case though.",
    "created_at": "2017-11-22T14:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366408",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@jdemeyer](#comment%3A32):
> I'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?

No, for exactly the reason that in all cases it's not clear what the best choice is.  Anyways the end result is going to be everyone just writing "utf-8" everywhere which I'd prefer to avoid.  I'd like to see how far we get with a sensible default for now.  There are some cases where it's definitely good to specify an encoding--for example all files written by sage can be encoded utf-8 in general.  In general that's not the case though.



---

archive/issue_comments_366409.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@jdemeyer](#comment%3A33):\n> The code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).\n\n\"make them explicit\" I don't know what isn't explicit about specifying the argument type?",
    "created_at": "2017-11-22T14:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366409",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@jdemeyer](#comment%3A33):
> The code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).

"make them explicit" I don't know what isn't explicit about specifying the argument type?



---

archive/issue_comments_366410.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@embray](#comment%3A37):\n> I don't know what isn't explicit about specifying the argument type?\n\nIt's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.",
    "created_at": "2017-11-22T14:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366410",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@embray](#comment%3A37):
> I don't know what isn't explicit about specifying the argument type?

It's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.



---

archive/issue_comments_366411.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@embray](#comment%3A36):\n> Anyways the end result is going to be everyone just writing \"utf-8\" everywhere which I'd prefer to avoid.\n\nAnd now we're in a situation where everybody uses `locale.getpreferredencoding()` which is also not what you want.",
    "created_at": "2017-11-22T14:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366411",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@embray](#comment%3A36):
> Anyways the end result is going to be everyone just writing "utf-8" everywhere which I'd prefer to avoid.

And now we're in a situation where everybody uses `locale.getpreferredencoding()` which is also not what you want.



---

archive/issue_comments_366412.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.",
    "created_at": "2017-11-22T14:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366412",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

I owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.



---

archive/issue_comments_366413.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@jdemeyer](#comment%3A40):\n> I owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.\n\nThat's okay, I'm just going off experience here.  But it's a hazy topic so I don't mind having my assumptions challenged.\n\nWhat's nice about having a sensible default is that, especially starting out, one needs to use a *lot* of these and it's not always immediately obvious what to do.  It's easier to not worry about it until you know you need to (e.g. something produces some text in an encoding you weren't expecting).  The locale encoding is a good bet though since it will *typically* match what the terminal is using.",
    "created_at": "2017-11-22T15:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366413",
    "user": "https://github.com/embray"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@jdemeyer](#comment%3A40):
> I owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.

That's okay, I'm just going off experience here.  But it's a hazy topic so I don't mind having my assumptions challenged.

What's nice about having a sensible default is that, especially starting out, one needs to use a *lot* of these and it's not always immediately obvious what to do.  It's easier to not worry about it until you know you need to (e.g. something produces some text in an encoding you weren't expecting).  The locale encoding is a good bet though since it will *typically* match what the terminal is using.



---

archive/issue_comments_366414.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@embray](#comment%3A35):\n> Let's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.\n\nAnother good point: `PyUnicode_AsUTF8` caches its own representation as UTF-8 string. So the `PyUnicode_AsUTF8()` calls for `encoding` and `errors` should be fast.",
    "created_at": "2017-11-23T14:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366414",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@embray](#comment%3A35):
> Let's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.

Another good point: `PyUnicode_AsUTF8` caches its own representation as UTF-8 string. So the `PyUnicode_AsUTF8()` calls for `encoding` and `errors` should be fast.



---

archive/issue_comments_366415.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-11-23T15:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366415",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_366416.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nYes, especially since they'll likely be interned anyways.\n\nI'm still going to look into your point about argument types.",
    "created_at": "2017-11-23T15:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366416",
    "user": "https://github.com/embray"
}
```

<div id="comment:44" align="right">comment:44</div>

Yes, especially since they'll likely be interned anyways.

I'm still going to look into your point about argument types.



---

archive/issue_comments_366417.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@embray](#comment%3A44):\n> I'm still going to look into your point about argument types.\n\nNo. I'm preparing a small reviewer patch.",
    "created_at": "2017-11-23T16:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366417",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@embray](#comment%3A44):
> I'm still going to look into your point about argument types.

No. I'm preparing a small reviewer patch.



---

archive/issue_comments_366418.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)** to **[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)**",
    "created_at": "2017-11-23T18:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366418",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)** to **[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)**



---

archive/issue_comments_366419.json:
```json
{
    "body": "Changed commit from **[`a5d5219`](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)** to **[`4a209df`](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)**",
    "created_at": "2017-11-23T18:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366419",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`a5d5219`](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)** to **[`4a209df`](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)**



---

archive/issue_comments_366420.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI made some minor changes, please review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c\"><code>4a209df</code></a></td><td><code>Minor fixes to cpython.string</code></td></tr></table>\n",
    "created_at": "2017-11-23T18:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366420",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

I made some minor changes, please review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c"><code>4a209df</code></a></td><td><code>Minor fixes to cpython.string</code></td></tr></table>




---

archive/issue_comments_366421.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nNote that my commit does not affect the API of these functions, so this shouldn't require any changes for tickets depending on this one.",
    "created_at": "2017-11-24T09:23:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366421",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Note that my commit does not affect the API of these functions, so this shouldn't require any changes for tickets depending on this one.



---

archive/issue_comments_366422.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@jdemeyer](#comment%3A38):\n> Replying to [@embray](#comment%3A37):\n> > I don't know what isn't explicit about specifying the argument type?\n\n> \n> It's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.\n\nI'm still not following you here.  Dropping the type specification seems to make things worse, not better.  I do see what you're saying about `None` which is weird.  I don't like that.  But specifying the argument of the type provides some compile-time static checking that's already been helpful a few times.  It's not foolproof of course because in many cases Cython can't be sure what type a Python object will be.  But in cases where it can (e.g. something \"obvious\" like `foo = b'abc'; str_to_bytes(foo)`) you get:\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\n    foo = b'abc'\n    bar = str_to_bytes(foo)\n                      ^\n------------------------------------------------------------\n\nCannot convert 'bytes' object to str implicitly. This is not portable to Py3.\n```\n\nWhile this seems to be specific to bytes -> str, it is very useful in this case.\n\nAlso, without this type check you get much less useful errors if you pass in the wrong type.  With the type specification:\n\n```\n>>> str_to_bytes(b'a')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: Argument 's' has incorrect type (expected str, got bytes)\n```\n\nWithout it\n\n```\n>>> str_to_bytes(b'a')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"sage/cpython/string.pxd\", line 70, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1660)\n  File \"sage/cpython/string.pxd\", line 99, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1523)\nTypeError: bad argument type for built-in operation\n```\n\nThis error happens to be raising from `PyUnicode_EncodeLocale`, but one wouldn't guess that just from looking at it.  It seems sloppy.\n\nOne thing I did recently run into, however, is that `str_to_bytes(str s, ...)` does not allow subclasses of `str` which is inconvenient.  Your version does seem allow `str` subclasses (and I guess likewise `bytes` subclasses for `bytes_to_str`).  It would be nice to have a middle ground between accepting subclasses, but also having better type checking.",
    "created_at": "2017-11-24T09:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366422",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@jdemeyer](#comment%3A38):
> Replying to [@embray](#comment%3A37):
> > I don't know what isn't explicit about specifying the argument type?

> 
> It's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.

I'm still not following you here.  Dropping the type specification seems to make things worse, not better.  I do see what you're saying about `None` which is weird.  I don't like that.  But specifying the argument of the type provides some compile-time static checking that's already been helpful a few times.  It's not foolproof of course because in many cases Cython can't be sure what type a Python object will be.  But in cases where it can (e.g. something "obvious" like `foo = b'abc'; str_to_bytes(foo)`) you get:

```
Error compiling Cython file:
------------------------------------------------------------
...
    foo = b'abc'
    bar = str_to_bytes(foo)
                      ^
------------------------------------------------------------

Cannot convert 'bytes' object to str implicitly. This is not portable to Py3.
```

While this seems to be specific to bytes -> str, it is very useful in this case.

Also, without this type check you get much less useful errors if you pass in the wrong type.  With the type specification:

```
>>> str_to_bytes(b'a')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Argument 's' has incorrect type (expected str, got bytes)
```

Without it

```
>>> str_to_bytes(b'a')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "sage/cpython/string.pxd", line 70, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1660)
  File "sage/cpython/string.pxd", line 99, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1523)
TypeError: bad argument type for built-in operation
```

This error happens to be raising from `PyUnicode_EncodeLocale`, but one wouldn't guess that just from looking at it.  It seems sloppy.

One thing I did recently run into, however, is that `str_to_bytes(str s, ...)` does not allow subclasses of `str` which is inconvenient.  Your version does seem allow `str` subclasses (and I guess likewise `bytes` subclasses for `bytes_to_str`).  It would be nice to have a middle ground between accepting subclasses, but also having better type checking.



---

archive/issue_events_333100.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-24T09:54:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333100"
}
```



---

archive/issue_events_333101.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-24T09:54:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333101"
}
```



---

archive/issue_comments_366423.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nAs you suggested earlier, using explicit type-checking casts like `PyUnicode_EncodeLocale(<str?>s, err)` gets part of the way there--it at least provides better exceptions when the wrong type is passed in.\n\nUnfortunately in the case of `str` Cython wants to use `PyString_CheckExact`, instead of some more generic check, and this disallows `str` subclasses (even though for user-defined types it will use a check that allows subclasses).  I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?  The latter still does the equivalent of the former first as a special case.  This is also especially nicely optimized on Python 3 where they added a `Py_TPFLAGS_UNICODE_SUBCLASS` flag as a special case :)",
    "created_at": "2017-11-24T10:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366423",
    "user": "https://github.com/embray"
}
```

<div id="comment:50" align="right">comment:50</div>

As you suggested earlier, using explicit type-checking casts like `PyUnicode_EncodeLocale(<str?>s, err)` gets part of the way there--it at least provides better exceptions when the wrong type is passed in.

Unfortunately in the case of `str` Cython wants to use `PyString_CheckExact`, instead of some more generic check, and this disallows `str` subclasses (even though for user-defined types it will use a check that allows subclasses).  I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?  The latter still does the equivalent of the former first as a special case.  This is also especially nicely optimized on Python 3 where they added a `Py_TPFLAGS_UNICODE_SUBCLASS` flag as a special case :)



---

archive/issue_comments_366424.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@embray](#comment%3A50):\n> I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?\n\nFeature, not a bug :-)\n\nCython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.",
    "created_at": "2017-11-24T10:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366424",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@embray](#comment%3A50):
> I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?

Feature, not a bug :-)

Cython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.



---

archive/issue_comments_366425.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@jdemeyer](#comment%3A51):\n> Replying to [@embray](#comment%3A50):\n> > I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?\n\n> \n> Feature, not a bug :-)\n\nYep, I just confirmed this myself--although it doesn't really make this explicit the way the code is written definitely implies that it's intentional.\n\n> Cython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.\n\nRight.  It depends.  I feel like one should be able to ask for allowing subtypes explicitly though, if nothing else.  If Cython needs to muck around with the internals it can still make an \"exact\" check...",
    "created_at": "2017-11-24T10:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366425",
    "user": "https://github.com/embray"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@jdemeyer](#comment%3A51):
> Replying to [@embray](#comment%3A50):
> > I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?

> 
> Feature, not a bug :-)

Yep, I just confirmed this myself--although it doesn't really make this explicit the way the code is written definitely implies that it's intentional.

> Cython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.

Right.  It depends.  I feel like one should be able to ask for allowing subtypes explicitly though, if nothing else.  If Cython needs to muck around with the internals it can still make an "exact" check...



---

archive/issue_comments_366426.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nAlso I'd say Cython does use types for checking, not just optimization, for example it obviously won't let you do things like\n\n```\ncdef int i\ni = \"abc\"\n```\n\nI guess it depends on what you mean by \"typing\"--is this referring to Python types or C types?\n\nSo in the mean time what do we do?  Write the explicit checks manually?  Or just not allow `str` subclasses and require a manual `str()` when passing in objects that might be `str` subclasses (ew, very un-Pythonic).",
    "created_at": "2017-11-24T10:44:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366426",
    "user": "https://github.com/embray"
}
```

<div id="comment:53" align="right">comment:53</div>

Also I'd say Cython does use types for checking, not just optimization, for example it obviously won't let you do things like

```
cdef int i
i = "abc"
```

I guess it depends on what you mean by "typing"--is this referring to Python types or C types?

So in the mean time what do we do?  Write the explicit checks manually?  Or just not allow `str` subclasses and require a manual `str()` when passing in objects that might be `str` subclasses (ew, very un-Pythonic).



---

archive/issue_comments_366427.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@embray](#comment%3A53):\n> So in the mean time what do we do?\n\nI would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.",
    "created_at": "2017-11-24T10:46:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366427",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@embray](#comment%3A53):
> So in the mean time what do we do?

I would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.



---

archive/issue_comments_366428.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@embray](#comment%3A53):\n> I guess it depends on what you mean by \"typing\"--is this referring to Python types or C types?\n\nI was specifically talking about builtin Python types (not C types nor `cdef classes`).",
    "created_at": "2017-11-24T10:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366428",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@embray](#comment%3A53):
> I guess it depends on what you mean by "typing"--is this referring to Python types or C types?

I was specifically talking about builtin Python types (not C types nor `cdef classes`).



---

archive/issue_comments_366429.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@jdemeyer](#comment%3A54):\n> Replying to [@embray](#comment%3A53):\n> > So in the mean time what do we do?\n\n> \n> I would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.\n\nOkay--I'm really not happy about that--given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.  I can live with this in the meantime. However, one thing that still needs to be fixed then is to remove the type checks in the Python 2 cases.  I'm not sure what good they're doing, and they are restricting the use of subtypes on Python 2...",
    "created_at": "2017-11-24T10:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366429",
    "user": "https://github.com/embray"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@jdemeyer](#comment%3A54):
> Replying to [@embray](#comment%3A53):
> > So in the mean time what do we do?

> 
> I would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.

Okay--I'm really not happy about that--given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.  I can live with this in the meantime. However, one thing that still needs to be fixed then is to remove the type checks in the Python 2 cases.  I'm not sure what good they're doing, and they are restricting the use of subtypes on Python 2...



---

archive/issue_comments_366430.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@embray](#comment%3A56):\n> given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.\n\nAgain, feature, not a bug. It is meant as \"optimize this code assuming that this is a `str` but check it just in case\". Of course, it is too tempting to use this to replace `isinstance()` checks as I have done. I'll fix it right now.",
    "created_at": "2017-11-24T11:06:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366430",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@embray](#comment%3A56):
> given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.

Again, feature, not a bug. It is meant as "optimize this code assuming that this is a `str` but check it just in case". Of course, it is too tempting to use this to replace `isinstance()` checks as I have done. I'll fix it right now.



---

archive/issue_comments_366431.json:
```json
{
    "body": "Changed commit from **[`4a209df`](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)** to **[`64567aa`](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)**",
    "created_at": "2017-11-24T11:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366431",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a209df`](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)** to **[`64567aa`](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)**



---

archive/issue_comments_366432.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c\"><code>64567aa</code></a></td><td><code>Make type checks explicit</code></td></tr></table>\n",
    "created_at": "2017-11-24T11:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366432",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c"><code>64567aa</code></a></td><td><code>Make type checks explicit</code></td></tr></table>




---

archive/issue_events_333102.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-24T11:26:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333102"
}
```



---

archive/issue_events_333103.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-24T11:26:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333103"
}
```



---

archive/issue_comments_366433.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nOkay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.  Not deliberately of course, it's just unclear.  This is like with `importlib.import_module`--the documentation is unhelpful here, but I'm sure you're right...",
    "created_at": "2017-11-24T12:17:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366433",
    "user": "https://github.com/embray"
}
```

<div id="comment:60" align="right">comment:60</div>

Okay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.  Not deliberately of course, it's just unclear.  This is like with `importlib.import_module`--the documentation is unhelpful here, but I'm sure you're right...



---

archive/issue_comments_366434.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@embray](#comment%3A60):\n> Okay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.\n\nhttps://github.com/cython/cython/pull/2021",
    "created_at": "2017-11-24T13:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366434",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@embray](#comment%3A60):
> Okay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.

https://github.com/cython/cython/pull/2021



---

archive/issue_comments_366435.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nAlright, I'm good with this.",
    "created_at": "2017-11-27T10:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366435",
    "user": "https://github.com/embray"
}
```

<div id="comment:62" align="right">comment:62</div>

Alright, I'm good with this.



---

archive/issue_events_333104.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-27T10:37:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333104"
}
```



---

archive/issue_events_333105.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-27T10:37:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333105"
}
```



---

archive/issue_comments_366436.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Erik Bray**",
    "created_at": "2017-11-27T10:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366436",
    "user": "https://github.com/embray"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Erik Bray**



---

archive/issue_comments_366437.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, Jeroen Demeyer**",
    "created_at": "2017-11-27T10:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366437",
    "user": "https://github.com/embray"
}
```

Changed author from **Erik Bray** to **Erik Bray, Jeroen Demeyer**



---

archive/issue_comments_366438.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI think it would actually be best if `char_to_str` took a `const char *` instead of just `char *`.  I was lazy about that at first, but for the sake of correctness I think this should be updated.",
    "created_at": "2017-12-08T14:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366438",
    "user": "https://github.com/embray"
}
```

<div id="comment:63" align="right">comment:63</div>

I think it would actually be best if `char_to_str` took a `const char *` instead of just `char *`.  I was lazy about that at first, but for the sake of correctness I think this should be updated.



---

archive/issue_events_333106.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T14:31:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333106"
}
```



---

archive/issue_events_333107.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T14:31:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333107"
}
```



---

archive/issue_comments_366439.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nRight. But don't rewrite history, just add a new commit.",
    "created_at": "2017-12-08T14:35:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366439",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Right. But don't rewrite history, just add a new commit.



---

archive/issue_comments_366440.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nSure--I can do it if you want.  I'll just set it back to positive_review then since we're in agreement.",
    "created_at": "2017-12-08T14:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366440",
    "user": "https://github.com/embray"
}
```

<div id="comment:65" align="right">comment:65</div>

Sure--I can do it if you want.  I'll just set it back to positive_review then since we're in agreement.



---

archive/issue_events_333108.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T15:03:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333108"
}
```



---

archive/issue_events_333109.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T15:03:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333109"
}
```



---

archive/issue_comments_366441.json:
```json
{
    "body": "Changed commit from **[`64567aa`](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)** to **[`a358aea`](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)**",
    "created_at": "2017-12-08T15:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366441",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`64567aa`](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)** to **[`a358aea`](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)**



---

archive/issue_comments_366442.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)** to **[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)**",
    "created_at": "2017-12-08T15:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366442",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)** to **[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)**



---

archive/issue_comments_366443.json:
```json
{
    "body": "<div id=\"comment:66\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a\"><code>a358aea</code></a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr></table>\n",
    "created_at": "2017-12-08T15:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366443",
    "user": "https://github.com/embray"
}
```

<div id="comment:66"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a"><code>a358aea</code></a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr></table>




---

archive/issue_events_333110.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T11:28:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333110"
}
```



---

archive/issue_events_333111.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T11:28:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333111"
}
```



---

archive/issue_comments_366444.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nPDF docs don't build",
    "created_at": "2017-12-11T11:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366444",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:67" align="right">comment:67</div>

PDF docs don't build



---

archive/issue_comments_366445.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nIt would be helpful if you linked to a build result page demonstrating the issue.",
    "created_at": "2017-12-11T15:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366445",
    "user": "https://github.com/embray"
}
```

<div id="comment:68" align="right">comment:68</div>

It would be helpful if you linked to a build result page demonstrating the issue.



---

archive/issue_comments_366446.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nThat was before putting it on the buildbot...",
    "created_at": "2017-12-11T15:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366446",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:69" align="right">comment:69</div>

That was before putting it on the buildbot...



---

archive/issue_events_333112.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333112"
}
```



---

archive/issue_events_333113.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333113"
}
```



---

archive/issue_comments_366447.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nWell I have unrelated problems building the PDF docs (is there a list somewhere of the dependencies? I have a pretty big texlive install and it still doesn't seem to have all the necessary fonts or something, even for some characters not related to this ticket).\n\nStill if I had to guess it seems likely the problem is my use of the Snowman character (my favorite go-to unicode character).  I'll just change it to something a little more likely to be already supported...",
    "created_at": "2017-12-12T09:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366447",
    "user": "https://github.com/embray"
}
```

<div id="comment:71" align="right">comment:71</div>

Well I have unrelated problems building the PDF docs (is there a list somewhere of the dependencies? I have a pretty big texlive install and it still doesn't seem to have all the necessary fonts or something, even for some characters not related to this ticket).

Still if I had to guess it seems likely the problem is my use of the Snowman character (my favorite go-to unicode character).  I'll just change it to something a little more likely to be already supported...



---

archive/issue_comments_366448.json:
```json
{
    "body": "<div id=\"comment:72\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658\"><code>64a1c2d</code></a></td><td><code>Use a less unusual character in the tests</code></td></tr></table>\n",
    "created_at": "2017-12-12T09:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366448",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:72"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658"><code>64a1c2d</code></a></td><td><code>Use a less unusual character in the tests</code></td></tr></table>




---

archive/issue_comments_366449.json:
```json
{
    "body": "Changed commit from **[`a358aea`](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)** to **[`64a1c2d`](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)**",
    "created_at": "2017-12-12T09:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366449",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a358aea`](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)** to **[`64a1c2d`](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)**



---

archive/issue_events_333114.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T09:18:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333114"
}
```



---

archive/issue_events_333115.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T09:18:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333115"
}
```



---

archive/issue_comments_366450.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nmaybe you should add `r\"\"\"`} when the doctests contains something that can perturb the pdf doc ?",
    "created_at": "2017-12-12T11:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366450",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:74" align="right">comment:74</div>

maybe you should add `r"""`} when the doctests contains something that can perturb the pdf doc ?



---

archive/issue_comments_366451.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nAh, there are some slashes in there too; I should make it an r-string just in case.",
    "created_at": "2017-12-12T12:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366451",
    "user": "https://github.com/embray"
}
```

<div id="comment:75" align="right">comment:75</div>

Ah, there are some slashes in there too; I should make it an r-string just in case.



---

archive/issue_comments_366452.json:
```json
{
    "body": "Changed commit from **[`64a1c2d`](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)** to **[`1bf6709`](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)**",
    "created_at": "2017-12-12T12:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366452",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`64a1c2d`](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)** to **[`1bf6709`](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)**



---

archive/issue_comments_366453.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b\"><code>1bf6709</code></a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr></table>\n",
    "created_at": "2017-12-12T12:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366453",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b"><code>1bf6709</code></a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr></table>




---

archive/issue_comments_366454.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nHave a look at build/pkgs/texlive/package-list.txt\n\nYou can add custom codepoints in src/doc/common/conf.py",
    "created_at": "2017-12-12T14:53:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366454",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:77" align="right">comment:77</div>

Have a look at build/pkgs/texlive/package-list.txt

You can add custom codepoints in src/doc/common/conf.py



---

archive/issue_comments_366455.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\npdf doc seems to be ok now",
    "created_at": "2017-12-13T13:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366455",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:78" align="right">comment:78</div>

pdf doc seems to be ok now



---

archive/issue_events_333116.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-13T13:40:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333116"
}
```



---

archive/issue_events_333117.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-13T13:40:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333117"
}
```



---

archive/issue_comments_366456.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nBreaks the python 3.6 build for me in sage-on-gentoo\n\n```\n[477/483] Cythonizing sage/symbolic/function.pyx\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n            err = NULL  # implies \"strict\"\n        else:\n            err = PyUnicode_AsUTF8(errors)\n\n        if encoding is None:\n            return PyUnicode_DecodeLocale(c, err)\n                                        ^\n------------------------------------------------------------\n\nsage/cpython/string.pxd:37:41: Cannot convert Unicode string to 'str' implicitly. This is not portable and requires explicit encoding.\nTraceback (most recent call last):\n  File \"/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py\", line 1179, in cythonize_one_helper\n    return cythonize_one(*m)\n  File \"/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py\", line 1161, in cythonize_one\n    raise CompileError(None, pyx_file)\nCython.Compiler.Errors.CompileError: sage/cpython/string.pyx\n```\ncython 0.27.3 and python-3.6.3. \nSince this is from python3 specific section it won't show up on Volker's build bots.",
    "created_at": "2017-12-14T08:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366456",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:79" align="right">comment:79</div>

Breaks the python 3.6 build for me in sage-on-gentoo

```
[477/483] Cythonizing sage/symbolic/function.pyx

Error compiling Cython file:
------------------------------------------------------------
...
            err = NULL  # implies "strict"
        else:
            err = PyUnicode_AsUTF8(errors)

        if encoding is None:
            return PyUnicode_DecodeLocale(c, err)
                                        ^
------------------------------------------------------------

sage/cpython/string.pxd:37:41: Cannot convert Unicode string to 'str' implicitly. This is not portable and requires explicit encoding.
Traceback (most recent call last):
  File "/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py", line 1179, in cythonize_one_helper
    return cythonize_one(*m)
  File "/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py", line 1161, in cythonize_one
    raise CompileError(None, pyx_file)
Cython.Compiler.Errors.CompileError: sage/cpython/string.pyx
```
cython 0.27.3 and python-3.6.3. 
Since this is from python3 specific section it won't show up on Volker's build bots.



---

archive/issue_events_333118.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T10:44:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333118"
}
```



---

archive/issue_events_333119.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T10:44:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333119"
}
```



---

archive/issue_comments_366457.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nHrm. It seems I never actually merged/tested Jeroen's changes on my Python 3 branch.  I assumed he tested it.",
    "created_at": "2017-12-14T10:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366457",
    "user": "https://github.com/embray"
}
```

<div id="comment:80" align="right">comment:80</div>

Hrm. It seems I never actually merged/tested Jeroen's changes on my Python 3 branch.  I assumed he tested it.



---

archive/issue_comments_366458.json:
```json
{
    "body": "<div id=\"comment:81\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265\"><code>2bb8396</code></a></td><td><code>Clean up these declarations:</code></td></tr></table>\n",
    "created_at": "2017-12-14T11:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366458",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:81"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265"><code>2bb8396</code></a></td><td><code>Clean up these declarations:</code></td></tr></table>




---

archive/issue_comments_366459.json:
```json
{
    "body": "Changed commit from **[`1bf6709`](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)** to **[`2bb8396`](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)**",
    "created_at": "2017-12-14T11:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366459",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1bf6709`](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)** to **[`2bb8396`](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)**



---

archive/issue_events_333120.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T11:20:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333120"
}
```



---

archive/issue_events_333121.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T11:20:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333121"
}
```



---

archive/issue_events_333122.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-14T12:41:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333122"
}
```



---

archive/issue_events_333123.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-14T12:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333123"
}
```



---

archive/issue_comments_366460.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nInstead of removing the return type specifications, it would be better to fix them. Replacing the `unicode` return value by `str` should work.",
    "created_at": "2017-12-14T12:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366460",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:83" align="right">comment:83</div>

Instead of removing the return type specifications, it would be better to fix them. Replacing the `unicode` return value by `str` should work.



---

archive/issue_comments_366461.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nFine but it really doesn't make much difference.",
    "created_at": "2017-12-15T10:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366461",
    "user": "https://github.com/embray"
}
```

<div id="comment:84" align="right">comment:84</div>

Fine but it really doesn't make much difference.



---

archive/issue_comments_366462.json:
```json
{
    "body": "Changed commit from **[`2bb8396`](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)** to **[`6d73a41`](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)**",
    "created_at": "2017-12-15T11:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366462",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2bb8396`](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)** to **[`6d73a41`](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)**



---

archive/issue_comments_366463.json:
```json
{
    "body": "<div id=\"comment:85\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a\"><code>6d73a41</code></a></td><td><code>Use more specific type declarations here.</code></td></tr></table>\n",
    "created_at": "2017-12-15T11:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366463",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:85"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a"><code>6d73a41</code></a></td><td><code>Use more specific type declarations here.</code></td></tr></table>




---

archive/issue_events_333124.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T12:29:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333124"
}
```



---

archive/issue_events_333125.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T12:29:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333125"
}
```



---

archive/issue_comments_366464.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nGood for me if it passes testing.",
    "created_at": "2017-12-15T12:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366464",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:87" align="right">comment:87</div>

Good for me if it passes testing.



---

archive/issue_events_333126.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T15:16:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333126"
}
```



---

archive/issue_events_333127.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T15:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333127"
}
```



---

archive/issue_comments_366465.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\none green bot. I am setting to positive this important ticket.",
    "created_at": "2017-12-15T15:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366465",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:88" align="right">comment:88</div>

one green bot. I am setting to positive this important ticket.



---

archive/issue_events_333128.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-17T10:51:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333128"
}
```



---

archive/issue_events_333129.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-17T10:51:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333129"
}
```



---

archive/issue_comments_366466.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nMerge conflict",
    "created_at": "2017-12-17T10:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366466",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:89" align="right">comment:89</div>

Merge conflict



---

archive/issue_comments_366467.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nVolker, do you by chance have any idea about what was the conflicting ticket ?",
    "created_at": "2017-12-20T09:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366467",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:90" align="right">comment:90</div>

Volker, do you by chance have any idea about what was the conflicting ticket ?



---

archive/issue_comments_366468.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nMerge conflict with what?  If there were a normal \"master\" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim \"merge conflict\", and expect me to guess what it conflicts with.",
    "created_at": "2017-12-21T11:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366468",
    "user": "https://github.com/embray"
}
```

<div id="comment:91" align="right">comment:91</div>

Merge conflict with what?  If there were a normal "master" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim "merge conflict", and expect me to guess what it conflicts with.



---

archive/issue_comments_366469.json:
```json
{
    "body": "Changed commit from **[`6d73a41`](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)** to **[`dec9f3a`](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)**",
    "created_at": "2017-12-21T11:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366469",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6d73a41`](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)** to **[`dec9f3a`](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)**



---

archive/issue_comments_366470.json:
```json
{
    "body": "<div id=\"comment:92\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559\"><code>a285af4</code></a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90\"><code>5b3719a</code></a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089\"><code>bf5f893</code></a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646\"><code>1bd27fc</code></a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547\"><code>bd2d931</code></a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f\"><code>b32f000</code></a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b\"><code>ccf7bcd</code></a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867\"><code>dec9f3a</code></a></td><td><code>Use more specific type declarations here.</code></td></tr></table>\n",
    "created_at": "2017-12-21T11:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366470",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:92"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559"><code>a285af4</code></a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90"><code>5b3719a</code></a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089"><code>bf5f893</code></a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646"><code>1bd27fc</code></a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547"><code>bd2d931</code></a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f"><code>b32f000</code></a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b"><code>ccf7bcd</code></a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867"><code>dec9f3a</code></a></td><td><code>Use more specific type declarations here.</code></td></tr></table>




---

archive/issue_comments_366471.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nRebased on current develop branch if it helps, but there was no merge conflict.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559\"><code>a285af4</code></a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90\"><code>5b3719a</code></a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089\"><code>bf5f893</code></a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646\"><code>1bd27fc</code></a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547\"><code>bd2d931</code></a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f\"><code>b32f000</code></a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b\"><code>ccf7bcd</code></a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867\"><code>dec9f3a</code></a></td><td><code>Use more specific type declarations here.</code></td></tr></table>\n",
    "created_at": "2017-12-21T11:17:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366471",
    "user": "https://github.com/embray"
}
```

<div id="comment:93" align="right">comment:93</div>

Rebased on current develop branch if it helps, but there was no merge conflict.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559"><code>a285af4</code></a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90"><code>5b3719a</code></a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089"><code>bf5f893</code></a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646"><code>1bd27fc</code></a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547"><code>bd2d931</code></a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f"><code>b32f000</code></a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b"><code>ccf7bcd</code></a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867"><code>dec9f3a</code></a></td><td><code>Use more specific type declarations here.</code></td></tr></table>




---

archive/issue_comments_366472.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nReplying to [@embray](#comment%3A91):\n> Merge conflict with what?  If there were a normal \"master\" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim \"merge conflict\", and expect me to guess what it conflicts with.\n\nIt's not secret: https://github.com/vbraun/sage/tree/develop",
    "created_at": "2017-12-21T12:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366472",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:94" align="right">comment:94</div>

Replying to [@embray](#comment%3A91):
> Merge conflict with what?  If there were a normal "master" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim "merge conflict", and expect me to guess what it conflicts with.

It's not secret: https://github.com/vbraun/sage/tree/develop



---

archive/issue_events_333130.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-25T02:06:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333130"
}
```



---

archive/issue_events_333131.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-25T02:06:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333131"
}
```



---

archive/issue_comments_366473.json:
```json
{
    "body": "Changed dependencies from **#24246** to none",
    "created_at": "2017-12-25T02:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366473",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24246** to none



---

archive/issue_comments_366474.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nI don't see any conflict...",
    "created_at": "2017-12-25T02:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366474",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:95" align="right">comment:95</div>

I don't see any conflict...



---

archive/issue_events_333132.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-26T09:25:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333132"
}
```



---

archive/issue_events_333133.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "bbd5bdbc0ae84e1e12d43704ace41dee6777a6c2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-26T09:25:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-333133"
}
```



---

archive/issue_comments_366475.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)** to **[`dec9f3a`](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)**",
    "created_at": "2017-12-26T09:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-366475",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)** to **[`dec9f3a`](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)**
