# Issue 24222: py3: simplified string conversion utilities

archive/issues_023985.json:
```json
{
    "assignees": [],
    "body": "A possible alternative to #24186, implementing simple conversion from C `char` arrays or `bytes` objects to `str` objects, and of `str` objects to `bytes` objects.  Here \"`str`\" and \"`bytes`\" are to be read exactly for either Python 2 or Python 3, so on Python 2 this means no conversion is performed since `str is bytes == True`.\n\nOne thing this does not do is implement any kind of conversion from Python 2 `unicode` objects to `bytes`.  This functionality might be worth adding, in some form, to `str_to_bytes`.  But this would add a *new* feature on Python 2, whereas for now I'm only trying to preserve the existing functionality on Python 2 exactly, while transparently supporting Python 3 `str`s everywhere that Python 2 `str`s are supported.\n\n**CC:**  @fchapoton @jdemeyer\n\n**Branch/Commit:** [dec9f3ac79a992d3152366ae266f1065c70c7867](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)\n\n**Reviewer:** Jeroen Demeyer, Erik Bray\n\n**Author:** Erik Bray, Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/24222\n\n",
    "closed_at": "2017-12-26T09:25:41Z",
    "created_at": "2017-11-16T11:38:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: simplified string conversion utilities",
    "type": "issue",
    "updated_at": "2017-12-26T09:25:41Z",
    "url": "https://github.com/sagemath/sage/issues/24222",
    "user": "https://github.com/embray"
}
```
A possible alternative to #24186, implementing simple conversion from C `char` arrays or `bytes` objects to `str` objects, and of `str` objects to `bytes` objects.  Here "`str`" and "`bytes`" are to be read exactly for either Python 2 or Python 3, so on Python 2 this means no conversion is performed since `str is bytes == True`.

One thing this does not do is implement any kind of conversion from Python 2 `unicode` objects to `bytes`.  This functionality might be worth adding, in some form, to `str_to_bytes`.  But this would add a *new* feature on Python 2, whereas for now I'm only trying to preserve the existing functionality on Python 2 exactly, while transparently supporting Python 3 `str`s everywhere that Python 2 `str`s are supported.

**CC:**  @fchapoton @jdemeyer

**Branch/Commit:** [dec9f3ac79a992d3152366ae266f1065c70c7867](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)

**Reviewer:** Jeroen Demeyer, Erik Bray

**Author:** Erik Bray, Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/24222





---

archive/issue_events_292331.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292331"
}
```



---

archive/issue_events_292332.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "08517b",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292332"
}
```



---

archive/issue_events_292333.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:38:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292333"
}
```



---

archive/issue_comments_369003.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc\">4c78743</a></td><td><code>Add new string conversion utilities.</code></td></tr></table>\n",
    "created_at": "2017-11-16T11:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369003",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:1'>**Comment 1:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc">4c78743</a></td><td><code>Add new string conversion utilities.</code></td></tr></table>




---

archive/issue_comments_369004.json:
```json
{
    "body": "**Commit:** [4c787436df8bad6ebf1edac65ba97e080295e3bc](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)",
    "created_at": "2017-11-16T11:38:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369004",
    "user": "https://github.com/sagetrac-git"
}
```

**Commit:** [4c787436df8bad6ebf1edac65ba97e080295e3bc](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)



---

archive/issue_events_292334.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-16T11:44:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292334"
}
```



---

archive/issue_events_292335.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-16T11:59:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292335"
}
```



---

archive/issue_events_292336.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-16T11:59:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292336"
}
```



---

archive/issue_comments_369005.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nOK, so now we have to discuss encodings... first of all, I really don't like the `encoding` argument in the functions, that will just slow everything down. Better pick one (or a few) good encoding(s) and use those.\n\nI don't see why you would pick `locale.getpreferredencoding()` as default encoding. Relevant encodings should be:\n\n1. `ascii`. In many cases we know that output from a C library is an ASCII string (for example, the string representation of a number). Luckily, ASCII is compatible with most other encodings, so this isn't an issue.\n\n2. `filesystemencoding`. This is the encoding that Python internally uses for most conversions `char*` <-> `str`. For this reason, I think that this is the most important use case and it should be the default when in doubt.\n\n3. `utf-8`. This is good if you just want to store `unicode` as `char*` (say, an internal user-specified name for something) and you don't care about the exact encoding but you do care that round-trip conversion works properly.\n\n4. `locale.getpreferredencoding()`. I believe that this is mainly relevant for subprocesses, provided that those subprocesses also look at the encoding.\n\nFor efficiency, I would rather have several sets of functions, each with a hard-coded encoding.\n\nI would also suggest to implement these functions (or at least the functions where you care about performance) as `cdef inline` functions in the `.pxd` file. That way, they will actually be inlined when calling them from an external Cython module.",
    "created_at": "2017-11-16T11:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369005",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'>**Comment 3:**</a>
OK, so now we have to discuss encodings... first of all, I really don't like the `encoding` argument in the functions, that will just slow everything down. Better pick one (or a few) good encoding(s) and use those.

I don't see why you would pick `locale.getpreferredencoding()` as default encoding. Relevant encodings should be:

1. `ascii`. In many cases we know that output from a C library is an ASCII string (for example, the string representation of a number). Luckily, ASCII is compatible with most other encodings, so this isn't an issue.

2. `filesystemencoding`. This is the encoding that Python internally uses for most conversions `char*` <-> `str`. For this reason, I think that this is the most important use case and it should be the default when in doubt.

3. `utf-8`. This is good if you just want to store `unicode` as `char*` (say, an internal user-specified name for something) and you don't care about the exact encoding but you do care that round-trip conversion works properly.

4. `locale.getpreferredencoding()`. I believe that this is mainly relevant for subprocesses, provided that those subprocesses also look at the encoding.

For efficiency, I would rather have several sets of functions, each with a hard-coded encoding.

I would also suggest to implement these functions (or at least the functions where you care about performance) as `cdef inline` functions in the `.pxd` file. That way, they will actually be inlined when calling them from an external Cython module.



---

archive/issue_comments_369006.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nYou don't need `six.PY2`. You can just replace\n\n```\nif six.PY2:\n    from cpython.string cimport PyString_FromString\nelse:\n    from cpython.bytes cimport PyBytes_FromString as PyString_FromString\n```\nby\n\n```\nfrom cpython.bytes cimport PyBytes_FromString as PyString_FromString\n```\nYou could also just use `PyBytes_FromString` in the code.",
    "created_at": "2017-11-16T12:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369006",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>**Comment 4:**</a>
You don't need `six.PY2`. You can just replace

```
if six.PY2:
    from cpython.string cimport PyString_FromString
else:
    from cpython.bytes cimport PyBytes_FromString as PyString_FromString
```
by

```
from cpython.bytes cimport PyBytes_FromString as PyString_FromString
```
You could also just use `PyBytes_FromString` in the code.



---

archive/issue_comments_369007.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nReplying to [@jdemeyer](#comment%3A4):\n> You don't need `six.PY2`. You can just replace\n\nThat's what I thought originally too, but I was having some problems trying to do it as a one-liner.  I'll try your suggestion though and double-check whether it works.",
    "created_at": "2017-11-16T12:31:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369007",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'>**Comment 5:**</a>
Replying to [@jdemeyer](#comment%3A4):
> You don't need `six.PY2`. You can just replace

That's what I thought originally too, but I was having some problems trying to do it as a one-liner.  I'll try your suggestion though and double-check whether it works.



---

archive/issue_comments_369008.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nI don't think the \"encoding\" argument slows anything down by any significant amount, especially in cases where it isn't used.  I'd be amenable to encoding-specific functions for some cases, as Python has those as well in its API.  But right now I'm really trying to avoid breadth of API surface.  It *is* good to have generic versions of these functions that accept any encoding, and this is the bare minimum needed to get Python 3 support off the ground.  I think that later we can encoding-specific functions where *specific* use cases for them can be demonstrated.  I don't want to get into the weeds with this right now.\n\nAs for the default encoding, `locale.getpreferredencoding()` makes more sense.  `sys.getfilesystemencoding()` is specifically about guessing (more or less) what encoding the filesystem *specifically* is using for encoding e.g. of filenames, and has nothing to do with encodings of file contents or of arbitrary strings output by software.  (Well, that's not exactly true since on *nix the two are essentially the same, although the former can change if the process's locale is changed, I think).\n\nSo on *NIX platforms like we care about the most it's actually *mostly* a moot point.  But a lot of the software Sage interfaces with is locale-aware, so it's better to take that into account as the default than not.",
    "created_at": "2017-11-16T12:48:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369008",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>**Comment 6:**</a>
I don't think the "encoding" argument slows anything down by any significant amount, especially in cases where it isn't used.  I'd be amenable to encoding-specific functions for some cases, as Python has those as well in its API.  But right now I'm really trying to avoid breadth of API surface.  It *is* good to have generic versions of these functions that accept any encoding, and this is the bare minimum needed to get Python 3 support off the ground.  I think that later we can encoding-specific functions where *specific* use cases for them can be demonstrated.  I don't want to get into the weeds with this right now.

As for the default encoding, `locale.getpreferredencoding()` makes more sense.  `sys.getfilesystemencoding()` is specifically about guessing (more or less) what encoding the filesystem *specifically* is using for encoding e.g. of filenames, and has nothing to do with encodings of file contents or of arbitrary strings output by software.  (Well, that's not exactly true since on *nix the two are essentially the same, although the former can change if the process's locale is changed, I think).

So on *NIX platforms like we care about the most it's actually *mostly* a moot point.  But a lot of the software Sage interfaces with is locale-aware, so it's better to take that into account as the default than not.



---

archive/issue_comments_369009.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n> I would also suggest to implement these functions (or at least the functions where you care about performance) as cdef inline functions in the .pxd file.\n\nI was wondering about that.  But in that case the `.pyx` file will be empty (does it even need to exist at all)?  What about the default encoding variables?",
    "created_at": "2017-11-16T12:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369009",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'>**Comment 7:**</a>
> I would also suggest to implement these functions (or at least the functions where you care about performance) as cdef inline functions in the .pxd file.

I was wondering about that.  But in that case the `.pyx` file will be empty (does it even need to exist at all)?  What about the default encoding variables?



---

archive/issue_comments_369010.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nMaybe the best solution would be to not have a default encoding and require users to think what encoding they want?",
    "created_at": "2017-11-16T12:57:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369010",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'>**Comment 8:**</a>
Maybe the best solution would be to not have a default encoding and require users to think what encoding they want?



---

archive/issue_comments_369011.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nReplying to [@embray](#comment%3A6):\n> I don't think the \"encoding\" argument slows anything down by any significant amount\n\nThe Python 3 C API has specific functions to encode/decode for certainly particular encodings:\n* https://docs.python.org/3/c-api/unicode.html#utf-8-codecs\n* https://docs.python.org/3/c-api/unicode.html#locale-encoding\n* https://docs.python.org/3/c-api/unicode.html#file-system-encoding\n\nI haven't profiled, but I would hope that these are faster than the generic API.",
    "created_at": "2017-11-16T13:40:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369011",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'>**Comment 9:**</a>
Replying to [@embray](#comment%3A6):
> I don't think the "encoding" argument slows anything down by any significant amount

The Python 3 C API has specific functions to encode/decode for certainly particular encodings:
* https://docs.python.org/3/c-api/unicode.html#utf-8-codecs
* https://docs.python.org/3/c-api/unicode.html#locale-encoding
* https://docs.python.org/3/c-api/unicode.html#file-system-encoding

I haven't profiled, but I would hope that these are faster than the generic API.



---

archive/issue_comments_369012.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nReplying to [@embray](#comment%3A7):\n> But in that case the `.pyx` file will be empty (does it even need to exist at all)?\n\nIt doesn't need to exist.\n\n> What about the default encoding variables?\n\nI propose to remove those variables anyway. If you *do* need them for some reason, they must be in the `.pyx` file.",
    "created_at": "2017-11-16T13:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369012",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>**Comment 10:**</a>
Replying to [@embray](#comment%3A7):
> But in that case the `.pyx` file will be empty (does it even need to exist at all)?

It doesn't need to exist.

> What about the default encoding variables?

I propose to remove those variables anyway. If you *do* need them for some reason, they must be in the `.pyx` file.



---

archive/issue_comments_369013.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nTwo more things:\n\n1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like\n\n```\nif (0)\n    nonexisting_function()\n```\nwhen `nonexisting_function()` doesn't actually exist like `PyUnicode_AsUTF8` on Python 2. The only reason that the above code compiles is compiler optimization.\n\nSee also #24215 for Cython-compile-time constants in general.\n\n2. Could you move this to `sage/cpython/string.pxd`? I recently created the `sage/cpython` directory to deal with low-level Python internals and I think that these functions would fit there.",
    "created_at": "2017-11-16T13:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369013",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>**Comment 11:**</a>
Two more things:

1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like

```
if (0)
    nonexisting_function()
```
when `nonexisting_function()` doesn't actually exist like `PyUnicode_AsUTF8` on Python 2. The only reason that the above code compiles is compiler optimization.

See also #24215 for Cython-compile-time constants in general.

2. Could you move this to `sage/cpython/string.pxd`? I recently created the `sage/cpython` directory to deal with low-level Python internals and I think that these functions would fit there.



---

archive/issue_comments_369014.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nfails to build, see patchbot report:\n\n```\nfrom string import Template\n```",
    "created_at": "2017-11-16T15:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369014",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'>**Comment 12:**</a>
fails to build, see patchbot report:

```
from string import Template
```



---

archive/issue_comments_369015.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\noh, I see. Name conflict between the global \"string\" module and the local \"string\" module..",
    "created_at": "2017-11-16T15:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369015",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'>**Comment 13:**</a>
oh, I see. Name conflict between the global "string" module and the local "string" module..



---

archive/issue_comments_369016.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nReplying to [@jdemeyer](#comment%3A8):\n> Maybe the best solution would be to not have a default encoding and require users to think what encoding they want?\n\nThat's far too onerous and anxiety-provoking for the user :)  Python itself uses default encodings all over the place when in doubt (hence e.g. [PyUnicode_DecodeFSDefault](https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_DecodeFSDefault)).  It's an unfortunate fact that there's isn't always one \"right answer\" here; the best we can do is provide sensible defaults *and* the ability for user-specified encoding where applicable; that is, where we know we want a specific encoding.  Moving forward we can also do more, for example, to ensure that any locale-aware code run by Sage is handled well.\n\nI could definitely agree to adding more encoding-specific helper functions, especially for ASCII and UTF-8.  But as a first pass, for the sake of getting Python 3 support off the ground, I'd prefer to leave this as is and then make adjustments as specific use cases arise.  It will be difficult to even find those specific use cases until and unless we get further along on getting Python 3 working in general (with these functions, plus a few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so that will help expose a lot of interesting cases *quickly*).\n\nI'll look at the rest of your suggestions; they seem reasonable.",
    "created_at": "2017-11-17T14:22:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369016",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>**Comment 14:**</a>
Replying to [@jdemeyer](#comment%3A8):
> Maybe the best solution would be to not have a default encoding and require users to think what encoding they want?

That's far too onerous and anxiety-provoking for the user :)  Python itself uses default encodings all over the place when in doubt (hence e.g. [PyUnicode_DecodeFSDefault](https://docs.python.org/3/c-api/unicode.html#c.PyUnicode_DecodeFSDefault)).  It's an unfortunate fact that there's isn't always one "right answer" here; the best we can do is provide sensible defaults *and* the ability for user-specified encoding where applicable; that is, where we know we want a specific encoding.  Moving forward we can also do more, for example, to ensure that any locale-aware code run by Sage is handled well.

I could definitely agree to adding more encoding-specific helper functions, especially for ASCII and UTF-8.  But as a first pass, for the sake of getting Python 3 support off the ground, I'd prefer to leave this as is and then make adjustments as specific use cases arise.  It will be difficult to even find those specific use cases until and unless we get further along on getting Python 3 working in general (with these functions, plus a few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so that will help expose a lot of interesting cases *quickly*).

I'll look at the rest of your suggestions; they seem reasonable.



---

archive/issue_comments_369017.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@jdemeyer](#comment%3A11):\n> Two more things:\n> \n> 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like\n\nAh, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?",
    "created_at": "2017-11-17T14:22:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369017",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@jdemeyer](#comment%3A11):
> Two more things:
> 
> 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like

Ah, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?



---

archive/issue_comments_369018.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nReplying to [@embray](#comment%3A15):\n> Replying to [@jdemeyer](#comment%3A11):\n> > Two more things:\n> > \n> > 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like\n\n> \n> Ah, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?\n\nNevermind; I see now that we explicitly pass that in to `cythonize` in the `setup.py`.  For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.",
    "created_at": "2017-11-17T14:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369018",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'>**Comment 16:**</a>
Replying to [@embray](#comment%3A15):
> Replying to [@jdemeyer](#comment%3A11):
> > Two more things:
> > 
> > 1. it is safer to use the Cython-compile-time constant `PY_VERSION_HEX` instead of the C-compile-time constant `PY_MAJOR_VERSION`. It is dubious C code to write something like

> 
> Ah, I was actually really looking for something like this but I couldn't find it anywhere in the Cython documentation.  Am I just blind?

Nevermind; I see now that we explicitly pass that in to `cythonize` in the `setup.py`.  For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.



---

archive/issue_comments_369019.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\n>It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).\n> \n\nThis sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.",
    "created_at": "2017-11-17T14:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369019",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:17'>**Comment 17:**</a>
>It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).
> 

This sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.



---

archive/issue_comments_369020.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nReplying to [@fchapoton](#comment%3A17):\n> >It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).\n> > \n\n> \n> This sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.\n\nI had to get it working, in part, so that I could run the doctests for this module :)\n\nI think it will help things go much faster.",
    "created_at": "2017-11-17T15:09:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369020",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'>**Comment 18:**</a>
Replying to [@fchapoton](#comment%3A17):
> >It will be difficult to even find those specific use cases until and unless we get >further along on getting Python 3 working in general (with these functions, plus a >few other fixes I'll be posting soon, I've gotten the Sage doctest runner working, so >that will help expose a lot of interesting cases *quickly*).
> > 

> 
> This sounds great ! I was hoping that the doctest framework could be made to work at some point, but was not expecting it soon.

I had to get it working, in part, so that I could run the doctests for this module :)

I think it will help things go much faster.



---

archive/issue_comments_369021.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nI'm seeing now how wanting to have module-level global variables in conjunction with inline `c(p)def` functions in Cython gets problematic.  It just compiles them as `__Pyx_GetModuleGlobalName(name)`.  I feel like this should be a bug (I *think* not too difficult to fix?) in Cython, since it's really counter to how Python should work in this case.\n\nFor functions inlined from another module--at least if those functions access global variables from their original module--it should import that module during module initialization and use the correct module dict for globals lookups (just as normal Python functions do, basically).\n\nThat's an issue beyond this one though, so I'll rework things for now to get rid use of the global variables by these functions (I still want to have default encodings though).",
    "created_at": "2017-11-17T15:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369021",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'>**Comment 19:**</a>
I'm seeing now how wanting to have module-level global variables in conjunction with inline `c(p)def` functions in Cython gets problematic.  It just compiles them as `__Pyx_GetModuleGlobalName(name)`.  I feel like this should be a bug (I *think* not too difficult to fix?) in Cython, since it's really counter to how Python should work in this case.

For functions inlined from another module--at least if those functions access global variables from their original module--it should import that module during module initialization and use the correct module dict for globals lookups (just as normal Python functions do, basically).

That's an issue beyond this one though, so I'll rework things for now to get rid use of the global variables by these functions (I still want to have default encodings though).



---

archive/issue_comments_369022.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nSo it turns out `PyUnicode_AsEncodedString` and `PyUnicode_Decode` do allow the `encoding` argument to be `NULL`, in which case they default to UTF-8.  So if it's a good enough default for Python maybe it's a good enough default for us, for now.\n\nPerhaps I'll just stick with that functionality, and take care to use things like `locale.getpreferredencoding()` when necessary, such as interfacing with external software.  To that end it would be good to come up with some list of exactly what software Sage interfaces with *is* locale aware.  Certainly ECL and GAP are strong candidates; probably others.  It will be good to add some tests to that effect but we can worry about it when we come to it.",
    "created_at": "2017-11-17T16:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369022",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'>**Comment 20:**</a>
So it turns out `PyUnicode_AsEncodedString` and `PyUnicode_Decode` do allow the `encoding` argument to be `NULL`, in which case they default to UTF-8.  So if it's a good enough default for Python maybe it's a good enough default for us, for now.

Perhaps I'll just stick with that functionality, and take care to use things like `locale.getpreferredencoding()` when necessary, such as interfacing with external software.  To that end it would be good to come up with some list of exactly what software Sage interfaces with *is* locale aware.  Certainly ECL and GAP are strong candidates; probably others.  It will be good to add some tests to that effect but we can worry about it when we come to it.



---

archive/issue_comments_369023.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nReplying to [@embray](#comment%3A14):\n> Python itself uses default encodings all over the place when in doubt\n\nRight, but there are several defaults (each of UTF-8, `sys.getfilesystemencoding()` and `locale.getpreferredencoding()` could be considered as defaults). And I don't think that any of those 3 has the large majority. So I still feel that forcing the user to pick one is the best solution.",
    "created_at": "2017-11-17T16:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369023",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>**Comment 21:**</a>
Replying to [@embray](#comment%3A14):
> Python itself uses default encodings all over the place when in doubt

Right, but there are several defaults (each of UTF-8, `sys.getfilesystemencoding()` and `locale.getpreferredencoding()` could be considered as defaults). And I don't think that any of those 3 has the large majority. So I still feel that forcing the user to pick one is the best solution.



---

archive/issue_comments_369024.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nAlso, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.",
    "created_at": "2017-11-17T17:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369024",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>**Comment 22:**</a>
Also, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.



---

archive/issue_comments_369025.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nReplying to [@embray](#comment%3A16):\n> For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.\n\nNo problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.",
    "created_at": "2017-11-17T17:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369025",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>**Comment 23:**</a>
Replying to [@embray](#comment%3A16):
> For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.

No problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.



---

archive/issue_comments_369026.json:
```json
{
    "body": "**Changing commit** from \"[4c787436df8bad6ebf1edac65ba97e080295e3bc](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)\" to \"[bb073e885eec1eeae8eac4c4776a81d84c2c61c1](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)\".",
    "created_at": "2017-11-20T08:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369026",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4c787436df8bad6ebf1edac65ba97e080295e3bc](https://github.com/sagemath/sagetrac-mirror/commit/4c787436df8bad6ebf1edac65ba97e080295e3bc)" to "[bb073e885eec1eeae8eac4c4776a81d84c2c61c1](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)".



---

archive/issue_comments_369027.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1\">bb073e8</a></td><td><code>Move sage.misc.string to sage.cpython.string and rework how default encoding is handled</code></td></tr></table>\n",
    "created_at": "2017-11-20T08:31:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369027",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>**Comment 24:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1">bb073e8</a></td><td><code>Move sage.misc.string to sage.cpython.string and rework how default encoding is handled</code></td></tr></table>




---

archive/issue_comments_369028.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nReplying to [@jdemeyer](#comment%3A23):\n> Replying to [@embray](#comment%3A16):\n> > For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.\n\n> \n> No problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.\n\nOkay hold on...",
    "created_at": "2017-11-20T08:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369028",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'>**Comment 25:**</a>
Replying to [@jdemeyer](#comment%3A23):
> Replying to [@embray](#comment%3A16):
> > For that matter, any reason not to add simply `PY2` and `PY3` compile-time constants?  Comparing against `PY_VERSION_HEX` is a little annoying.

> 
> No problem for me, although I would prefer `PY_MAJOR_VERSION` then. If you want to do that, please make a new ticket and make it depend on #24215 please.

Okay hold on...



---

archive/issue_comments_369029.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nReplying to [@jdemeyer](#comment%3A22):\n> Also, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.\n\nYeah, I'm inclined to agree here--I think I'll change that.  But in that case I'd also want an optional argument for error handling.",
    "created_at": "2017-11-20T08:39:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369029",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'>**Comment 26:**</a>
Replying to [@jdemeyer](#comment%3A22):
> Also, I feel that error handling should be different for the different cases: if you are communicating with locale-aware software using `locale.getpreferredencoding()` you probably want decoding errors to be actual errors. With the file system encoding on the other hand, `surrogateescape` is typically a better default.

Yeah, I'm inclined to agree here--I think I'll change that.  But in that case I'd also want an optional argument for error handling.



---

archive/issue_comments_369030.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nReplying to [@fchapoton](#comment%3A12):\n> fails to build, see patchbot report:\n> \n> ```\n> from string import Template\n> ```\n\nFixed in #24242.",
    "created_at": "2017-11-20T08:42:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369030",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'>**Comment 27:**</a>
Replying to [@fchapoton](#comment%3A12):
> fails to build, see patchbot report:
> 
> ```
> from string import Template
> ```

Fixed in #24242.



---

archive/issue_comments_369031.json:
```json
{
    "body": "**Changing commit** from \"[bb073e885eec1eeae8eac4c4776a81d84c2c61c1](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)\" to \"[a5d521980e6ce42afc2b127e8f7d892f32488ee4](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)\".",
    "created_at": "2017-11-20T09:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369031",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[bb073e885eec1eeae8eac4c4776a81d84c2c61c1](https://github.com/sagemath/sagetrac-mirror/commit/bb073e885eec1eeae8eac4c4776a81d84c2c61c1)" to "[a5d521980e6ce42afc2b127e8f7d892f32488ee4](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)".



---

archive/issue_comments_369032.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\">34ef6dc</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65\">158d984</a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2\">7f06e71</a></td><td><code>Fix documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ac146c17ccabbaf53918f874f516909041e82c5\">3ac146c</a></td><td><code>Add a Cython compile-time constant for Python major version.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f71fd41b659ea250ec96c0df343c4fe6b2be9289\">f71fd41</a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4\">a5d5219</a></td><td><code>Add support for optional error handling.</code></td></tr></table>\n",
    "created_at": "2017-11-20T09:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369032",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>**Comment 28:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be">34ef6dc</a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65">158d984</a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2">7f06e71</a></td><td><code>Fix documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ac146c17ccabbaf53918f874f516909041e82c5">3ac146c</a></td><td><code>Add a Cython compile-time constant for Python major version.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f71fd41b659ea250ec96c0df343c4fe6b2be9289">f71fd41</a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4">a5d5219</a></td><td><code>Add support for optional error handling.</code></td></tr></table>




---

archive/issue_comments_369033.json:
```json
{
    "body": "<a id='comment:29'>**Comment 29:**</a>\nI'm pretty happy with this now as-is.  I'm up for minor tweaking but would prefer not to make any other major changes to how this works, for now, since it's proving pretty useful in getting other code working.\n\nI'd be up for adding additional shortcut functions for certain special cases if they come up often enough--we'll see.\n\n(Also, it turns out if you put `cpdef` function definitions into a `.pxd` file it won't generate a module for them unless you also have a corresponding `.pyx` file, even if it's empty--annoying.  That said, it's useful to have a shortcut for `sys.getfilesystemencoding()` which is annoying to write :)",
    "created_at": "2017-11-20T09:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369033",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'>**Comment 29:**</a>
I'm pretty happy with this now as-is.  I'm up for minor tweaking but would prefer not to make any other major changes to how this works, for now, since it's proving pretty useful in getting other code working.

I'd be up for adding additional shortcut functions for certain special cases if they come up often enough--we'll see.

(Also, it turns out if you put `cpdef` function definitions into a `.pxd` file it won't generate a module for them unless you also have a corresponding `.pyx` file, even if it's empty--annoying.  That said, it's useful to have a shortcut for `sys.getfilesystemencoding()` which is annoying to write :)



---

archive/issue_comments_369034.json:
```json
{
    "body": "**Dependencies:** #24246",
    "created_at": "2017-11-20T09:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369034",
    "user": "https://github.com/embray"
}
```

**Dependencies:** #24246



---

archive/issue_events_292337.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-20T09:14:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292337"
}
```



---

archive/issue_events_292338.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-20T09:14:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292338"
}
```



---

archive/issue_comments_369035.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nI have just noticed that we use a similar kind of function \"from sagenb.misc.misc import encoded_str\" in src/sage/misc/latex.py..",
    "created_at": "2017-11-20T15:17:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369035",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'>**Comment 30:**</a>
I have just noticed that we use a similar kind of function "from sagenb.misc.misc import encoded_str" in src/sage/misc/latex.py..



---

archive/issue_comments_369036.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\nIf you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.",
    "created_at": "2017-11-20T17:25:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369036",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>**Comment 31:**</a>
If you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.



---

archive/issue_comments_369037.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nReplying to [@embray](#comment%3A29):\n> since it's proving pretty useful in getting other code working.\n\nIf you have such use cases, I'd love to see them.\n\nI'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?",
    "created_at": "2017-11-20T17:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369037",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'>**Comment 32:**</a>
Replying to [@embray](#comment%3A29):
> since it's proving pretty useful in getting other code working.

If you have such use cases, I'd love to see them.

I'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?



---

archive/issue_comments_369038.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nThe code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).",
    "created_at": "2017-11-20T17:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369038",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>**Comment 33:**</a>
The code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).



---

archive/issue_comments_369039.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nReplying to [@jdemeyer](#comment%3A32):\n> Replying to [@embray](#comment%3A29):\n> > since it's proving pretty useful in getting other code working.\n\n> \n> If you have such use cases, I'd love to see them.\n\nNever mind, I just noticed #24223.",
    "created_at": "2017-11-20T19:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369039",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>**Comment 34:**</a>
Replying to [@jdemeyer](#comment%3A32):
> Replying to [@embray](#comment%3A29):
> > since it's proving pretty useful in getting other code working.

> 
> If you have such use cases, I'd love to see them.

Never mind, I just noticed #24223.



---

archive/issue_comments_369040.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nReplying to [@jdemeyer](#comment%3A31):\n> If you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.\n\nDoesn't that mean that from Python you'd have to pass those arguments in as `bytes` then?\n\nLet's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.",
    "created_at": "2017-11-22T14:08:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369040",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'>**Comment 35:**</a>
Replying to [@jdemeyer](#comment%3A31):
> If you want to pass `encoding` and `errors` arguments, can you pass them as the C type `const char*`? That avoids needless slow manipulation of Python objects.

Doesn't that mean that from Python you'd have to pass those arguments in as `bytes` then?

Let's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.



---

archive/issue_comments_369041.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nReplying to [@jdemeyer](#comment%3A32):\n> I'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?\n\nNo, for exactly the reason that in all cases it's not clear what the best choice is.  Anyways the end result is going to be everyone just writing \"utf-8\" everywhere which I'd prefer to avoid.  I'd like to see how far we get with a sensible default for now.  There are some cases where it's definitely good to specify an encoding--for example all files written by sage can be encoded utf-8 in general.  In general that's not the case though.",
    "created_at": "2017-11-22T14:11:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369041",
    "user": "https://github.com/embray"
}
```

<a id='comment:36'>**Comment 36:**</a>
Replying to [@jdemeyer](#comment%3A32):
> I'm not yet convinced that we should use `locale.getpreferredencoding()` as default. Since this is just a preliminary interface, why can't we *require* an encoding argument until we have a clearer idea that most Unicode conversions are indeed using `locale.getpreferredencoding`?

No, for exactly the reason that in all cases it's not clear what the best choice is.  Anyways the end result is going to be everyone just writing "utf-8" everywhere which I'd prefer to avoid.  I'd like to see how far we get with a sensible default for now.  There are some cases where it's definitely good to specify an encoding--for example all files written by sage can be encoded utf-8 in general.  In general that's not the case though.



---

archive/issue_comments_369042.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nReplying to [@jdemeyer](#comment%3A33):\n> The code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).\n\n\"make them explicit\" I don't know what isn't explicit about specifying the argument type?",
    "created_at": "2017-11-22T14:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369042",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'>**Comment 37:**</a>
Replying to [@jdemeyer](#comment%3A33):
> The code is a bit inconsistent in how it checks that the input has the correct type, for example passing non-bytes to `bytes_to_str()`. In any case, I would drop the typing on the argument (`bytes b` -> `b`). If you want checks, make them explicit by using checked casts (`<str?>` instead of `<str>`).

"make them explicit" I don't know what isn't explicit about specifying the argument type?



---

archive/issue_comments_369043.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nReplying to [@embray](#comment%3A37):\n> I don't know what isn't explicit about specifying the argument type?\n\nIt's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.",
    "created_at": "2017-11-22T14:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369043",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'>**Comment 38:**</a>
Replying to [@embray](#comment%3A37):
> I don't know what isn't explicit about specifying the argument type?

It's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.



---

archive/issue_comments_369044.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nReplying to [@embray](#comment%3A36):\n> Anyways the end result is going to be everyone just writing \"utf-8\" everywhere which I'd prefer to avoid.\n\nAnd now we're in a situation where everybody uses `locale.getpreferredencoding()` which is also not what you want.",
    "created_at": "2017-11-22T14:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369044",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'>**Comment 39:**</a>
Replying to [@embray](#comment%3A36):
> Anyways the end result is going to be everyone just writing "utf-8" everywhere which I'd prefer to avoid.

And now we're in a situation where everybody uses `locale.getpreferredencoding()` which is also not what you want.



---

archive/issue_comments_369045.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nI owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.",
    "created_at": "2017-11-22T14:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369045",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'>**Comment 40:**</a>
I owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.



---

archive/issue_comments_369046.json:
```json
{
    "body": "<a id='comment:41'>**Comment 41:**</a>\nReplying to [@jdemeyer](#comment%3A40):\n> I owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.\n\nThat's okay, I'm just going off experience here.  But it's a hazy topic so I don't mind having my assumptions challenged.\n\nWhat's nice about having a sensible default is that, especially starting out, one needs to use a *lot* of these and it's not always immediately obvious what to do.  It's easier to not worry about it until you know you need to (e.g. something produces some text in an encoding you weren't expecting).  The locale encoding is a good bet though since it will *typically* match what the terminal is using.",
    "created_at": "2017-11-22T15:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369046",
    "user": "https://github.com/embray"
}
```

<a id='comment:41'>**Comment 41:**</a>
Replying to [@jdemeyer](#comment%3A40):
> I owe you an apology... I read some Python docs and sources and it turns out that Python uses `locale.getpreferredencoding()` for more things than I thought. So with that in mind, `locale.getpreferredencoding()` might actually be a reasonable default after all.

That's okay, I'm just going off experience here.  But it's a hazy topic so I don't mind having my assumptions challenged.

What's nice about having a sensible default is that, especially starting out, one needs to use a *lot* of these and it's not always immediately obvious what to do.  It's easier to not worry about it until you know you need to (e.g. something produces some text in an encoding you weren't expecting).  The locale encoding is a good bet though since it will *typically* match what the terminal is using.



---

archive/issue_comments_369047.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nReplying to [@embray](#comment%3A35):\n> Let's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.\n\nAnother good point: `PyUnicode_AsUTF8` caches its own representation as UTF-8 string. So the `PyUnicode_AsUTF8()` calls for `encoding` and `errors` should be fast.",
    "created_at": "2017-11-23T14:23:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369047",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'>**Comment 42:**</a>
Replying to [@embray](#comment%3A35):
> Let's please not get too hung up about micro-optimization here.  Compared to actual string decoding (except in some trivial cases) this kind of point is pretty trivial.

Another good point: `PyUnicode_AsUTF8` caches its own representation as UTF-8 string. So the `PyUnicode_AsUTF8()` calls for `encoding` and `errors` should be fast.



---

archive/issue_comments_369048.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2017-11-23T15:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369048",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_369049.json:
```json
{
    "body": "<a id='comment:44'>**Comment 44:**</a>\nYes, especially since they'll likely be interned anyways.\n\nI'm still going to look into your point about argument types.",
    "created_at": "2017-11-23T15:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369049",
    "user": "https://github.com/embray"
}
```

<a id='comment:44'>**Comment 44:**</a>
Yes, especially since they'll likely be interned anyways.

I'm still going to look into your point about argument types.



---

archive/issue_comments_369050.json:
```json
{
    "body": "<a id='comment:45'>**Comment 45:**</a>\nReplying to [@embray](#comment%3A44):\n> I'm still going to look into your point about argument types.\n\nNo. I'm preparing a small reviewer patch.",
    "created_at": "2017-11-23T16:03:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369050",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'>**Comment 45:**</a>
Replying to [@embray](#comment%3A44):
> I'm still going to look into your point about argument types.

No. I'm preparing a small reviewer patch.



---

archive/issue_comments_369051.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)\" to \"[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)\".",
    "created_at": "2017-11-23T18:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369051",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)" to "[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)".



---

archive/issue_comments_369052.json:
```json
{
    "body": "**Changing commit** from \"[a5d521980e6ce42afc2b127e8f7d892f32488ee4](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)\" to \"[4a209df305a721e9c30bc1aa384d128e265c419c](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)\".",
    "created_at": "2017-11-23T18:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369052",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[a5d521980e6ce42afc2b127e8f7d892f32488ee4](https://github.com/sagemath/sagetrac-mirror/commit/a5d521980e6ce42afc2b127e8f7d892f32488ee4)" to "[4a209df305a721e9c30bc1aa384d128e265c419c](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)".



---

archive/issue_comments_369053.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nI made some minor changes, please review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c\">4a209df</a></td><td><code>Minor fixes to cpython.string</code></td></tr></table>\n",
    "created_at": "2017-11-23T18:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369053",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'>**Comment 47:**</a>
I made some minor changes, please review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c">4a209df</a></td><td><code>Minor fixes to cpython.string</code></td></tr></table>




---

archive/issue_comments_369054.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nNote that my commit does not affect the API of these functions, so this shouldn't require any changes for tickets depending on this one.",
    "created_at": "2017-11-24T09:23:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369054",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'>**Comment 48:**</a>
Note that my commit does not affect the API of these functions, so this shouldn't require any changes for tickets depending on this one.



---

archive/issue_comments_369055.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\nReplying to [@jdemeyer](#comment%3A38):\n> Replying to [@embray](#comment%3A37):\n> > I don't know what isn't explicit about specifying the argument type?\n\n> \n> It's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.\n\nI'm still not following you here.  Dropping the type specification seems to make things worse, not better.  I do see what you're saying about `None` which is weird.  I don't like that.  But specifying the argument of the type provides some compile-time static checking that's already been helpful a few times.  It's not foolproof of course because in many cases Cython can't be sure what type a Python object will be.  But in cases where it can (e.g. something \"obvious\" like `foo = b'abc'; str_to_bytes(foo)`) you get:\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\n    foo = b'abc'\n    bar = str_to_bytes(foo)\n                      ^\n------------------------------------------------------------\n\nCannot convert 'bytes' object to str implicitly. This is not portable to Py3.\n```\n\nWhile this seems to be specific to bytes -> str, it is very useful in this case.\n\nAlso, without this type check you get much less useful errors if you pass in the wrong type.  With the type specification:\n\n```\n>>> str_to_bytes(b'a')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: Argument 's' has incorrect type (expected str, got bytes)\n```\n\nWithout it\n\n```\n>>> str_to_bytes(b'a')\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"sage/cpython/string.pxd\", line 70, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1660)\n  File \"sage/cpython/string.pxd\", line 99, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1523)\nTypeError: bad argument type for built-in operation\n```\n\nThis error happens to be raising from `PyUnicode_EncodeLocale`, but one wouldn't guess that just from looking at it.  It seems sloppy.\n\nOne thing I did recently run into, however, is that `str_to_bytes(str s, ...)` does not allow subclasses of `str` which is inconvenient.  Your version does seem allow `str` subclasses (and I guess likewise `bytes` subclasses for `bytes_to_str`).  It would be nice to have a middle ground between accepting subclasses, but also having better type checking.",
    "created_at": "2017-11-24T09:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369055",
    "user": "https://github.com/embray"
}
```

<a id='comment:49'>**Comment 49:**</a>
Replying to [@jdemeyer](#comment%3A38):
> Replying to [@embray](#comment%3A37):
> > I don't know what isn't explicit about specifying the argument type?

> 
> It's explicit but not what you want. Cython always allows `None` to be passed as any type. If you really want `bytes` and not `None`, you need to check for it. And if you do an explicit check, there is no reason for the typing of the argument.

I'm still not following you here.  Dropping the type specification seems to make things worse, not better.  I do see what you're saying about `None` which is weird.  I don't like that.  But specifying the argument of the type provides some compile-time static checking that's already been helpful a few times.  It's not foolproof of course because in many cases Cython can't be sure what type a Python object will be.  But in cases where it can (e.g. something "obvious" like `foo = b'abc'; str_to_bytes(foo)`) you get:

```
Error compiling Cython file:
------------------------------------------------------------
...
    foo = b'abc'
    bar = str_to_bytes(foo)
                      ^
------------------------------------------------------------

Cannot convert 'bytes' object to str implicitly. This is not portable to Py3.
```

While this seems to be specific to bytes -> str, it is very useful in this case.

Also, without this type check you get much less useful errors if you pass in the wrong type.  With the type specification:

```
>>> str_to_bytes(b'a')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: Argument 's' has incorrect type (expected str, got bytes)
```

Without it

```
>>> str_to_bytes(b'a')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "sage/cpython/string.pxd", line 70, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1660)
  File "sage/cpython/string.pxd", line 99, in sage.cpython.string.str_to_bytes (build/cythonized/sage/cpython/string.c:1523)
TypeError: bad argument type for built-in operation
```

This error happens to be raising from `PyUnicode_EncodeLocale`, but one wouldn't guess that just from looking at it.  It seems sloppy.

One thing I did recently run into, however, is that `str_to_bytes(str s, ...)` does not allow subclasses of `str` which is inconvenient.  Your version does seem allow `str` subclasses (and I guess likewise `bytes` subclasses for `bytes_to_str`).  It would be nice to have a middle ground between accepting subclasses, but also having better type checking.



---

archive/issue_events_292339.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-24T09:54:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292339"
}
```



---

archive/issue_events_292340.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-24T09:54:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292340"
}
```



---

archive/issue_comments_369056.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nAs you suggested earlier, using explicit type-checking casts like `PyUnicode_EncodeLocale(<str?>s, err)` gets part of the way there--it at least provides better exceptions when the wrong type is passed in.\n\nUnfortunately in the case of `str` Cython wants to use `PyString_CheckExact`, instead of some more generic check, and this disallows `str` subclasses (even though for user-defined types it will use a check that allows subclasses).  I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?  The latter still does the equivalent of the former first as a special case.  This is also especially nicely optimized on Python 3 where they added a `Py_TPFLAGS_UNICODE_SUBCLASS` flag as a special case :)",
    "created_at": "2017-11-24T10:20:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369056",
    "user": "https://github.com/embray"
}
```

<a id='comment:50'>**Comment 50:**</a>
As you suggested earlier, using explicit type-checking casts like `PyUnicode_EncodeLocale(<str?>s, err)` gets part of the way there--it at least provides better exceptions when the wrong type is passed in.

Unfortunately in the case of `str` Cython wants to use `PyString_CheckExact`, instead of some more generic check, and this disallows `str` subclasses (even though for user-defined types it will use a check that allows subclasses).  I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?  The latter still does the equivalent of the former first as a special case.  This is also especially nicely optimized on Python 3 where they added a `Py_TPFLAGS_UNICODE_SUBCLASS` flag as a special case :)



---

archive/issue_comments_369057.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nReplying to [@embray](#comment%3A50):\n> I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?\n\nFeature, not a bug :-)\n\nCython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.",
    "created_at": "2017-11-24T10:35:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369057",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'>**Comment 51:**</a>
Replying to [@embray](#comment%3A50):
> I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?

Feature, not a bug :-)

Cython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.



---

archive/issue_comments_369058.json:
```json
{
    "body": "<a id='comment:52'>**Comment 52:**</a>\nReplying to [@jdemeyer](#comment%3A51):\n> Replying to [@embray](#comment%3A50):\n> > I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?\n\n> \n> Feature, not a bug :-)\n\nYep, I just confirmed this myself--although it doesn't really make this explicit the way the code is written definitely implies that it's intentional.\n\n> Cython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.\n\nRight.  It depends.  I feel like one should be able to ask for allowing subtypes explicitly though, if nothing else.  If Cython needs to muck around with the internals it can still make an \"exact\" check...",
    "created_at": "2017-11-24T10:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369058",
    "user": "https://github.com/embray"
}
```

<a id='comment:52'>**Comment 52:**</a>
Replying to [@jdemeyer](#comment%3A51):
> Replying to [@embray](#comment%3A50):
> > I feel like this a bug in Cython--why use `PyString_CheckExact` instead of `PyString_Check`?

> 
> Feature, not a bug :-)

Yep, I just confirmed this myself--although it doesn't really make this explicit the way the code is written definitely implies that it's intentional.

> Cython uses this typing as an *optimization* tool, not as a *checking* tool. It happens to do some checking (like assigning `cdef str x = []` will fail) but that is just to avoid segfaults. For certain builtin types, Cython accesses the internals of those types. But accessing those internals is only valid for the exact type, it might not be valid for subtypes.

Right.  It depends.  I feel like one should be able to ask for allowing subtypes explicitly though, if nothing else.  If Cython needs to muck around with the internals it can still make an "exact" check...



---

archive/issue_comments_369059.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\nAlso I'd say Cython does use types for checking, not just optimization, for example it obviously won't let you do things like\n\n```\ncdef int i\ni = \"abc\"\n```\n\nI guess it depends on what you mean by \"typing\"--is this referring to Python types or C types?\n\nSo in the mean time what do we do?  Write the explicit checks manually?  Or just not allow `str` subclasses and require a manual `str()` when passing in objects that might be `str` subclasses (ew, very un-Pythonic).",
    "created_at": "2017-11-24T10:44:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369059",
    "user": "https://github.com/embray"
}
```

<a id='comment:53'>**Comment 53:**</a>
Also I'd say Cython does use types for checking, not just optimization, for example it obviously won't let you do things like

```
cdef int i
i = "abc"
```

I guess it depends on what you mean by "typing"--is this referring to Python types or C types?

So in the mean time what do we do?  Write the explicit checks manually?  Or just not allow `str` subclasses and require a manual `str()` when passing in objects that might be `str` subclasses (ew, very un-Pythonic).



---

archive/issue_comments_369060.json:
```json
{
    "body": "<a id='comment:54'>**Comment 54:**</a>\nReplying to [@embray](#comment%3A53):\n> So in the mean time what do we do?\n\nI would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.",
    "created_at": "2017-11-24T10:46:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369060",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:54'>**Comment 54:**</a>
Replying to [@embray](#comment%3A53):
> So in the mean time what do we do?

I would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.



---

archive/issue_comments_369061.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\nReplying to [@embray](#comment%3A53):\n> I guess it depends on what you mean by \"typing\"--is this referring to Python types or C types?\n\nI was specifically talking about builtin Python types (not C types nor `cdef classes`).",
    "created_at": "2017-11-24T10:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369061",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'>**Comment 55:**</a>
Replying to [@embray](#comment%3A53):
> I guess it depends on what you mean by "typing"--is this referring to Python types or C types?

I was specifically talking about builtin Python types (not C types nor `cdef classes`).



---

archive/issue_comments_369062.json:
```json
{
    "body": "<a id='comment:56'>**Comment 56:**</a>\nReplying to [@jdemeyer](#comment%3A54):\n> Replying to [@embray](#comment%3A53):\n> > So in the mean time what do we do?\n\n> \n> I would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.\n\nOkay--I'm really not happy about that--given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.  I can live with this in the meantime. However, one thing that still needs to be fixed then is to remove the type checks in the Python 2 cases.  I'm not sure what good they're doing, and they are restricting the use of subtypes on Python 2...",
    "created_at": "2017-11-24T10:58:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369062",
    "user": "https://github.com/embray"
}
```

<a id='comment:56'>**Comment 56:**</a>
Replying to [@jdemeyer](#comment%3A54):
> Replying to [@embray](#comment%3A53):
> > So in the mean time what do we do?

> 
> I would argue that the current branch works and that nothing needs to be changed. Even if the error message from `PyUnicode_Decode` is obscure, the traceback would easily point to the right place.

Okay--I'm really not happy about that--given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.  I can live with this in the meantime. However, one thing that still needs to be fixed then is to remove the type checks in the Python 2 cases.  I'm not sure what good they're doing, and they are restricting the use of subtypes on Python 2...



---

archive/issue_comments_369063.json:
```json
{
    "body": "<a id='comment:57'>**Comment 57:**</a>\nReplying to [@embray](#comment%3A56):\n> given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.\n\nAgain, feature, not a bug. It is meant as \"optimize this code assuming that this is a `str` but check it just in case\". Of course, it is too tempting to use this to replace `isinstance()` checks as I have done. I'll fix it right now.",
    "created_at": "2017-11-24T11:06:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369063",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'>**Comment 57:**</a>
Replying to [@embray](#comment%3A56):
> given that the `<str?>` syntax is the programmer explicitly asking for a type *check* it should allow some flexibility in how that's performed.  But that's a Cython issue.

Again, feature, not a bug. It is meant as "optimize this code assuming that this is a `str` but check it just in case". Of course, it is too tempting to use this to replace `isinstance()` checks as I have done. I'll fix it right now.



---

archive/issue_comments_369064.json:
```json
{
    "body": "**Changing commit** from \"[4a209df305a721e9c30bc1aa384d128e265c419c](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)\" to \"[64567aa772d737b6ff052f99a67cc6e8ad72c21c](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)\".",
    "created_at": "2017-11-24T11:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369064",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[4a209df305a721e9c30bc1aa384d128e265c419c](https://github.com/sagemath/sagetrac-mirror/commit/4a209df305a721e9c30bc1aa384d128e265c419c)" to "[64567aa772d737b6ff052f99a67cc6e8ad72c21c](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)".



---

archive/issue_comments_369065.json:
```json
{
    "body": "<a id='comment:58'>**Comment 58:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c\">64567aa</a></td><td><code>Make type checks explicit</code></td></tr></table>\n",
    "created_at": "2017-11-24T11:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369065",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:58'>**Comment 58:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c">64567aa</a></td><td><code>Make type checks explicit</code></td></tr></table>




---

archive/issue_events_292341.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-24T11:26:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292341"
}
```



---

archive/issue_events_292342.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-24T11:26:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292342"
}
```



---

archive/issue_comments_369066.json:
```json
{
    "body": "<a id='comment:60'>**Comment 60:**</a>\nOkay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.  Not deliberately of course, it's just unclear.  This is like with `importlib.import_module`--the documentation is unhelpful here, but I'm sure you're right...",
    "created_at": "2017-11-24T12:17:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369066",
    "user": "https://github.com/embray"
}
```

<a id='comment:60'>**Comment 60:**</a>
Okay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.  Not deliberately of course, it's just unclear.  This is like with `importlib.import_module`--the documentation is unhelpful here, but I'm sure you're right...



---

archive/issue_comments_369067.json:
```json
{
    "body": "<a id='comment:61'>**Comment 61:**</a>\nReplying to [@embray](#comment%3A60):\n> Okay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.\n\nhttps://github.com/cython/cython/pull/2021",
    "created_at": "2017-11-24T13:49:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369067",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:61'>**Comment 61:**</a>
Replying to [@embray](#comment%3A60):
> Okay, I take your word for it, but in that case I think the the [Cython documentation](http://cython.readthedocs.io/en/latest/src/reference/language_basics.html#type-checking) is a little deceptive about how this works / is meant to be used.

https://github.com/cython/cython/pull/2021



---

archive/issue_comments_369068.json:
```json
{
    "body": "<a id='comment:62'>**Comment 62:**</a>\nAlright, I'm good with this.",
    "created_at": "2017-11-27T10:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369068",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'>**Comment 62:**</a>
Alright, I'm good with this.



---

archive/issue_events_292343.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-27T10:37:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292343"
}
```



---

archive/issue_events_292344.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-27T10:37:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292344"
}
```



---

archive/issue_comments_369069.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Erik Bray\".",
    "created_at": "2017-11-27T10:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369069",
    "user": "https://github.com/embray"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Erik Bray".



---

archive/issue_comments_369070.json:
```json
{
    "body": "**Changing author** from \"Erik Bray\" to \"Erik Bray, Jeroen Demeyer\".",
    "created_at": "2017-11-27T10:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369070",
    "user": "https://github.com/embray"
}
```

**Changing author** from "Erik Bray" to "Erik Bray, Jeroen Demeyer".



---

archive/issue_comments_369071.json:
```json
{
    "body": "<a id='comment:63'>**Comment 63:**</a>\nI think it would actually be best if `char_to_str` took a `const char *` instead of just `char *`.  I was lazy about that at first, but for the sake of correctness I think this should be updated.",
    "created_at": "2017-12-08T14:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369071",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'>**Comment 63:**</a>
I think it would actually be best if `char_to_str` took a `const char *` instead of just `char *`.  I was lazy about that at first, but for the sake of correctness I think this should be updated.



---

archive/issue_events_292345.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T14:31:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292345"
}
```



---

archive/issue_events_292346.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T14:31:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292346"
}
```



---

archive/issue_comments_369072.json:
```json
{
    "body": "<a id='comment:64'>**Comment 64:**</a>\nRight. But don't rewrite history, just add a new commit.",
    "created_at": "2017-12-08T14:35:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369072",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'>**Comment 64:**</a>
Right. But don't rewrite history, just add a new commit.



---

archive/issue_comments_369073.json:
```json
{
    "body": "<a id='comment:65'>**Comment 65:**</a>\nSure--I can do it if you want.  I'll just set it back to positive_review then since we're in agreement.",
    "created_at": "2017-12-08T14:58:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369073",
    "user": "https://github.com/embray"
}
```

<a id='comment:65'>**Comment 65:**</a>
Sure--I can do it if you want.  I'll just set it back to positive_review then since we're in agreement.



---

archive/issue_events_292347.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T15:03:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292347"
}
```



---

archive/issue_events_292348.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T15:03:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292348"
}
```



---

archive/issue_comments_369074.json:
```json
{
    "body": "**Changing commit** from \"[64567aa772d737b6ff052f99a67cc6e8ad72c21c](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)\" to \"[a358aeaec8612efe19678482fb510751a1b7b33a](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)\".",
    "created_at": "2017-12-08T15:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369074",
    "user": "https://github.com/embray"
}
```

**Changing commit** from "[64567aa772d737b6ff052f99a67cc6e8ad72c21c](https://github.com/sagemath/sagetrac-mirror/commit/64567aa772d737b6ff052f99a67cc6e8ad72c21c)" to "[a358aeaec8612efe19678482fb510751a1b7b33a](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)".



---

archive/issue_comments_369075.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)\" to \"[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)\".",
    "created_at": "2017-12-08T15:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369075",
    "user": "https://github.com/embray"
}
```

**Changing branch** from "[u/jdemeyer/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/string-conversions)" to "[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)".



---

archive/issue_comments_369076.json:
```json
{
    "body": "<a id='comment:66'>**Comment 66:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a\">a358aea</a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr></table>\n",
    "created_at": "2017-12-08T15:03:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369076",
    "user": "https://github.com/embray"
}
```

<a id='comment:66'>**Comment 66:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a">a358aea</a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr></table>




---

archive/issue_events_292349.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T11:28:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292349"
}
```



---

archive/issue_events_292350.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T11:28:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292350"
}
```



---

archive/issue_comments_369077.json:
```json
{
    "body": "<a id='comment:67'>**Comment 67:**</a>\nPDF docs don't build",
    "created_at": "2017-12-11T11:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369077",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:67'>**Comment 67:**</a>
PDF docs don't build



---

archive/issue_comments_369078.json:
```json
{
    "body": "<a id='comment:68'>**Comment 68:**</a>\nIt would be helpful if you linked to a build result page demonstrating the issue.",
    "created_at": "2017-12-11T15:08:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369078",
    "user": "https://github.com/embray"
}
```

<a id='comment:68'>**Comment 68:**</a>
It would be helpful if you linked to a build result page demonstrating the issue.



---

archive/issue_comments_369079.json:
```json
{
    "body": "<a id='comment:69'>**Comment 69:**</a>\nThat was before putting it on the buildbot...",
    "created_at": "2017-12-11T15:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369079",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:69'>**Comment 69:**</a>
That was before putting it on the buildbot...



---

archive/issue_events_292351.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292351"
}
```



---

archive/issue_events_292352.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292352"
}
```



---

archive/issue_comments_369080.json:
```json
{
    "body": "<a id='comment:71'>**Comment 71:**</a>\nWell I have unrelated problems building the PDF docs (is there a list somewhere of the dependencies? I have a pretty big texlive install and it still doesn't seem to have all the necessary fonts or something, even for some characters not related to this ticket).\n\nStill if I had to guess it seems likely the problem is my use of the Snowman character (my favorite go-to unicode character).  I'll just change it to something a little more likely to be already supported...",
    "created_at": "2017-12-12T09:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369080",
    "user": "https://github.com/embray"
}
```

<a id='comment:71'>**Comment 71:**</a>
Well I have unrelated problems building the PDF docs (is there a list somewhere of the dependencies? I have a pretty big texlive install and it still doesn't seem to have all the necessary fonts or something, even for some characters not related to this ticket).

Still if I had to guess it seems likely the problem is my use of the Snowman character (my favorite go-to unicode character).  I'll just change it to something a little more likely to be already supported...



---

archive/issue_comments_369081.json:
```json
{
    "body": "<a id='comment:72'>**Comment 72:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658\">64a1c2d</a></td><td><code>Use a less unusual character in the tests</code></td></tr></table>\n",
    "created_at": "2017-12-12T09:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369081",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:72'>**Comment 72:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658">64a1c2d</a></td><td><code>Use a less unusual character in the tests</code></td></tr></table>




---

archive/issue_comments_369082.json:
```json
{
    "body": "**Changing commit** from \"[a358aeaec8612efe19678482fb510751a1b7b33a](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)\" to \"[64a1c2d58713636a51c60e3be508204c88513658](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)\".",
    "created_at": "2017-12-12T09:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369082",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a358aeaec8612efe19678482fb510751a1b7b33a](https://github.com/sagemath/sagetrac-mirror/commit/a358aeaec8612efe19678482fb510751a1b7b33a)" to "[64a1c2d58713636a51c60e3be508204c88513658](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)".



---

archive/issue_events_292353.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T09:18:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292353"
}
```



---

archive/issue_events_292354.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T09:18:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292354"
}
```



---

archive/issue_comments_369083.json:
```json
{
    "body": "<a id='comment:74'>**Comment 74:**</a>\nmaybe you should add `r\"\"\"`} when the doctests contains something that can perturb the pdf doc ?",
    "created_at": "2017-12-12T11:01:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369083",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:74'>**Comment 74:**</a>
maybe you should add `r"""`} when the doctests contains something that can perturb the pdf doc ?



---

archive/issue_comments_369084.json:
```json
{
    "body": "<a id='comment:75'>**Comment 75:**</a>\nAh, there are some slashes in there too; I should make it an r-string just in case.",
    "created_at": "2017-12-12T12:54:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369084",
    "user": "https://github.com/embray"
}
```

<a id='comment:75'>**Comment 75:**</a>
Ah, there are some slashes in there too; I should make it an r-string just in case.



---

archive/issue_comments_369085.json:
```json
{
    "body": "**Changing commit** from \"[64a1c2d58713636a51c60e3be508204c88513658](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)\" to \"[1bf6709cb5b256537bab4058ba3fa578996f521b](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)\".",
    "created_at": "2017-12-12T12:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369085",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[64a1c2d58713636a51c60e3be508204c88513658](https://github.com/sagemath/sagetrac-mirror/commit/64a1c2d58713636a51c60e3be508204c88513658)" to "[1bf6709cb5b256537bab4058ba3fa578996f521b](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)".



---

archive/issue_comments_369086.json:
```json
{
    "body": "<a id='comment:76'>**Comment 76:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b\">1bf6709</a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr></table>\n",
    "created_at": "2017-12-12T12:57:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369086",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:76'>**Comment 76:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b">1bf6709</a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr></table>




---

archive/issue_comments_369087.json:
```json
{
    "body": "<a id='comment:77'>**Comment 77:**</a>\nHave a look at build/pkgs/texlive/package-list.txt\n\nYou can add custom codepoints in src/doc/common/conf.py",
    "created_at": "2017-12-12T14:53:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369087",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:77'>**Comment 77:**</a>
Have a look at build/pkgs/texlive/package-list.txt

You can add custom codepoints in src/doc/common/conf.py



---

archive/issue_comments_369088.json:
```json
{
    "body": "<a id='comment:78'>**Comment 78:**</a>\npdf doc seems to be ok now",
    "created_at": "2017-12-13T13:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369088",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:78'>**Comment 78:**</a>
pdf doc seems to be ok now



---

archive/issue_events_292355.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-13T13:40:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292355"
}
```



---

archive/issue_events_292356.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-13T13:40:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292356"
}
```



---

archive/issue_comments_369089.json:
```json
{
    "body": "<a id='comment:79'>**Comment 79:**</a>\nBreaks the python 3.6 build for me in sage-on-gentoo\n\n```\n[477/483] Cythonizing sage/symbolic/function.pyx\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n            err = NULL  # implies \"strict\"\n        else:\n            err = PyUnicode_AsUTF8(errors)\n\n        if encoding is None:\n            return PyUnicode_DecodeLocale(c, err)\n                                        ^\n------------------------------------------------------------\n\nsage/cpython/string.pxd:37:41: Cannot convert Unicode string to 'str' implicitly. This is not portable and requires explicit encoding.\nTraceback (most recent call last):\n  File \"/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py\", line 1179, in cythonize_one_helper\n    return cythonize_one(*m)\n  File \"/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py\", line 1161, in cythonize_one\n    raise CompileError(None, pyx_file)\nCython.Compiler.Errors.CompileError: sage/cpython/string.pyx\n```\ncython 0.27.3 and python-3.6.3. \nSince this is from python3 specific section it won't show up on Volker's build bots.",
    "created_at": "2017-12-14T08:11:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369089",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:79'>**Comment 79:**</a>
Breaks the python 3.6 build for me in sage-on-gentoo

```
[477/483] Cythonizing sage/symbolic/function.pyx

Error compiling Cython file:
------------------------------------------------------------
...
            err = NULL  # implies "strict"
        else:
            err = PyUnicode_AsUTF8(errors)

        if encoding is None:
            return PyUnicode_DecodeLocale(c, err)
                                        ^
------------------------------------------------------------

sage/cpython/string.pxd:37:41: Cannot convert Unicode string to 'str' implicitly. This is not portable and requires explicit encoding.
Traceback (most recent call last):
  File "/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py", line 1179, in cythonize_one_helper
    return cythonize_one(*m)
  File "/usr/lib64/python3.6/site-packages/Cython/Build/Dependencies.py", line 1161, in cythonize_one
    raise CompileError(None, pyx_file)
Cython.Compiler.Errors.CompileError: sage/cpython/string.pyx
```
cython 0.27.3 and python-3.6.3. 
Since this is from python3 specific section it won't show up on Volker's build bots.



---

archive/issue_events_292357.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T10:44:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292357"
}
```



---

archive/issue_events_292358.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T10:44:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292358"
}
```



---

archive/issue_comments_369090.json:
```json
{
    "body": "<a id='comment:80'>**Comment 80:**</a>\nHrm. It seems I never actually merged/tested Jeroen's changes on my Python 3 branch.  I assumed he tested it.",
    "created_at": "2017-12-14T10:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369090",
    "user": "https://github.com/embray"
}
```

<a id='comment:80'>**Comment 80:**</a>
Hrm. It seems I never actually merged/tested Jeroen's changes on my Python 3 branch.  I assumed he tested it.



---

archive/issue_comments_369091.json:
```json
{
    "body": "<a id='comment:81'>**Comment 81:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265\">2bb8396</a></td><td><code>Clean up these declarations:</code></td></tr></table>\n",
    "created_at": "2017-12-14T11:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369091",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:81'>**Comment 81:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265">2bb8396</a></td><td><code>Clean up these declarations:</code></td></tr></table>




---

archive/issue_comments_369092.json:
```json
{
    "body": "**Changing commit** from \"[1bf6709cb5b256537bab4058ba3fa578996f521b](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)\" to \"[2bb839655c50259c8beec273cab5773eb5158265](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)\".",
    "created_at": "2017-12-14T11:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369092",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[1bf6709cb5b256537bab4058ba3fa578996f521b](https://github.com/sagemath/sagetrac-mirror/commit/1bf6709cb5b256537bab4058ba3fa578996f521b)" to "[2bb839655c50259c8beec273cab5773eb5158265](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)".



---

archive/issue_events_292359.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T11:20:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292359"
}
```



---

archive/issue_events_292360.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-14T11:20:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292360"
}
```



---

archive/issue_events_292361.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-14T12:41:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292361"
}
```



---

archive/issue_events_292362.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-14T12:41:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292362"
}
```



---

archive/issue_comments_369093.json:
```json
{
    "body": "<a id='comment:83'>**Comment 83:**</a>\nInstead of removing the return type specifications, it would be better to fix them. Replacing the `unicode` return value by `str` should work.",
    "created_at": "2017-12-14T12:41:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369093",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:83'>**Comment 83:**</a>
Instead of removing the return type specifications, it would be better to fix them. Replacing the `unicode` return value by `str` should work.



---

archive/issue_comments_369094.json:
```json
{
    "body": "<a id='comment:84'>**Comment 84:**</a>\nFine but it really doesn't make much difference.",
    "created_at": "2017-12-15T10:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369094",
    "user": "https://github.com/embray"
}
```

<a id='comment:84'>**Comment 84:**</a>
Fine but it really doesn't make much difference.



---

archive/issue_comments_369095.json:
```json
{
    "body": "**Changing commit** from \"[2bb839655c50259c8beec273cab5773eb5158265](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)\" to \"[6d73a416b18f9d0edec280009495ae77f7b0a49a](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)\".",
    "created_at": "2017-12-15T11:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369095",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[2bb839655c50259c8beec273cab5773eb5158265](https://github.com/sagemath/sagetrac-mirror/commit/2bb839655c50259c8beec273cab5773eb5158265)" to "[6d73a416b18f9d0edec280009495ae77f7b0a49a](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)".



---

archive/issue_comments_369096.json:
```json
{
    "body": "<a id='comment:85'>**Comment 85:**</a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a\">6d73a41</a></td><td><code>Use more specific type declarations here.</code></td></tr></table>\n",
    "created_at": "2017-12-15T11:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369096",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:85'>**Comment 85:**</a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a">6d73a41</a></td><td><code>Use more specific type declarations here.</code></td></tr></table>




---

archive/issue_events_292363.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T12:29:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292363"
}
```



---

archive/issue_events_292364.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T12:29:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292364"
}
```



---

archive/issue_comments_369097.json:
```json
{
    "body": "<a id='comment:87'>**Comment 87:**</a>\nGood for me if it passes testing.",
    "created_at": "2017-12-15T12:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369097",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:87'>**Comment 87:**</a>
Good for me if it passes testing.



---

archive/issue_events_292365.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T15:16:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292365"
}
```



---

archive/issue_events_292366.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-15T15:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292366"
}
```



---

archive/issue_comments_369098.json:
```json
{
    "body": "<a id='comment:88'>**Comment 88:**</a>\none green bot. I am setting to positive this important ticket.",
    "created_at": "2017-12-15T15:16:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369098",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:88'>**Comment 88:**</a>
one green bot. I am setting to positive this important ticket.



---

archive/issue_events_292367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-17T10:51:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292367"
}
```



---

archive/issue_events_292368.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-17T10:51:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292368"
}
```



---

archive/issue_comments_369099.json:
```json
{
    "body": "<a id='comment:89'>**Comment 89:**</a>\nMerge conflict",
    "created_at": "2017-12-17T10:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369099",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:89'>**Comment 89:**</a>
Merge conflict



---

archive/issue_comments_369100.json:
```json
{
    "body": "<a id='comment:90'>**Comment 90:**</a>\nVolker, do you by chance have any idea about what was the conflicting ticket ?",
    "created_at": "2017-12-20T09:13:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369100",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:90'>**Comment 90:**</a>
Volker, do you by chance have any idea about what was the conflicting ticket ?



---

archive/issue_comments_369101.json:
```json
{
    "body": "<a id='comment:91'>**Comment 91:**</a>\nMerge conflict with what?  If there were a normal \"master\" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim \"merge conflict\", and expect me to guess what it conflicts with.",
    "created_at": "2017-12-21T11:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369101",
    "user": "https://github.com/embray"
}
```

<a id='comment:91'>**Comment 91:**</a>
Merge conflict with what?  If there were a normal "master" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim "merge conflict", and expect me to guess what it conflicts with.



---

archive/issue_comments_369102.json:
```json
{
    "body": "**Changing commit** from \"[6d73a416b18f9d0edec280009495ae77f7b0a49a](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)\" to \"[dec9f3ac79a992d3152366ae266f1065c70c7867](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)\".",
    "created_at": "2017-12-21T11:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369102",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[6d73a416b18f9d0edec280009495ae77f7b0a49a](https://github.com/sagemath/sagetrac-mirror/commit/6d73a416b18f9d0edec280009495ae77f7b0a49a)" to "[dec9f3ac79a992d3152366ae266f1065c70c7867](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)".



---

archive/issue_comments_369103.json:
```json
{
    "body": "<a id='comment:92'>**Comment 92:**</a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559\">a285af4</a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90\">5b3719a</a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089\">bf5f893</a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646\">1bd27fc</a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547\">bd2d931</a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f\">b32f000</a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b\">ccf7bcd</a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867\">dec9f3a</a></td><td><code>Use more specific type declarations here.</code></td></tr></table>\n",
    "created_at": "2017-12-21T11:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369103",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:92'>**Comment 92:**</a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559">a285af4</a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90">5b3719a</a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089">bf5f893</a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646">1bd27fc</a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547">bd2d931</a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f">b32f000</a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b">ccf7bcd</a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867">dec9f3a</a></td><td><code>Use more specific type declarations here.</code></td></tr></table>




---

archive/issue_comments_369104.json:
```json
{
    "body": "<a id='comment:93'>**Comment 93:**</a>\nRebased on current develop branch if it helps, but there was no merge conflict.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559\">a285af4</a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90\">5b3719a</a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089\">bf5f893</a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646\">1bd27fc</a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547\">bd2d931</a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f\">b32f000</a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b\">ccf7bcd</a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867\">dec9f3a</a></td><td><code>Use more specific type declarations here.</code></td></tr></table>\n",
    "created_at": "2017-12-21T11:17:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369104",
    "user": "https://github.com/embray"
}
```

<a id='comment:93'>**Comment 93:**</a>
Rebased on current develop branch if it helps, but there was no merge conflict.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a285af48a5bf05ea9db98d268ff8822d93a85559">a285af4</a></td><td><code>Add new string conversion utilities.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b3719a36342fc8a7245e72cc25f993d6e407e90">5b3719a</a></td><td><code>Add support for optional error handling.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5f893c73c224849233e1a400a3e97299615089">bf5f893</a></td><td><code>Make type checks explicit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1bd27fc5a7d14fce1b5d27df3be980f745913646">1bd27fc</a></td><td><code>Require a const char*--this is more consistent for use in cases where</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd2d93183aa4ecc8f541b9407be4829130449547">bd2d931</a></td><td><code>Use a less unusual character in the tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b32f000b55e932039e6284e466888d6e3bfaad6f">b32f000</a></td><td><code>Use r-strings for the docstrings since they contain slashes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b">ccf7bcd</a></td><td><code>Clean up these declarations:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867">dec9f3a</a></td><td><code>Use more specific type declarations here.</code></td></tr></table>




---

archive/issue_comments_369105.json:
```json
{
    "body": "<a id='comment:94'>**Comment 94:**</a>\nReplying to [@embray](#comment%3A91):\n> Merge conflict with what?  If there were a normal \"master\" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim \"merge conflict\", and expect me to guess what it conflicts with.\n\nIt's not secret: https://github.com/vbraun/sage/tree/develop",
    "created_at": "2017-12-21T12:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369105",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:94'>**Comment 94:**</a>
Replying to [@embray](#comment%3A91):
> Merge conflict with what?  If there were a normal "master" branch into which tickets were merged regularly against which I could compare that would be one thing, but you can't just secretly merge a bunch of tickets all at once, claim "merge conflict", and expect me to guess what it conflicts with.

It's not secret: https://github.com/vbraun/sage/tree/develop



---

archive/issue_events_292369.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-25T02:06:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292369"
}
```



---

archive/issue_events_292370.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-25T02:06:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292370"
}
```



---

archive/issue_comments_369106.json:
```json
{
    "body": "**Changing dependencies** from \"#24246\" to \"\".",
    "created_at": "2017-12-25T02:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369106",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#24246" to "".



---

archive/issue_comments_369107.json:
```json
{
    "body": "<a id='comment:95'>**Comment 95:**</a>\nI don't see any conflict...",
    "created_at": "2017-12-25T02:06:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369107",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:95'>**Comment 95:**</a>
I don't see any conflict...



---

archive/issue_events_292371.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-26T09:25:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292371"
}
```



---

archive/issue_events_292372.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "bbd5bdbc0ae84e1e12d43704ace41dee6777a6c2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-26T09:25:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24222#event-292372"
}
```



---

archive/issue_comments_369108.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)\" to \"[dec9f3ac79a992d3152366ae266f1065c70c7867](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)\".",
    "created_at": "2017-12-26T09:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24222#issuecomment-369108",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/python3/string-conversions](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/string-conversions)" to "[dec9f3ac79a992d3152366ae266f1065c70c7867](https://github.com/sagemath/sagetrac-mirror/commit/dec9f3ac79a992d3152366ae266f1065c70c7867)".
