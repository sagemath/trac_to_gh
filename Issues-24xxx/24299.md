# Issue 24299: Systematic doctest for function return type

archive/issues_024062.json:
```json
{
    "body": "\n```\nsage: sinh(CIF(1))\n[1.1752011936438013 .. 1.1752011936438017]\nsage: asinh(CIF(1))\n0.881373587019543\n```\nThe second command should return a (complex) interval.\n\nAlso:\n\n```\nsage: asin(CIF(0.6))\n...\nTypeError: unable to convert '0.59999999999999998?' to a real number\n```\n\n\nCC:  @jdemeyer\n\nReviewer: Paul Zimmermann\n\nAuthor: Ralf Stephan\n\nBranch: u/rws/24299\n\nStatus: needs_work\n\nDependencies: #24318, #24329, #24604\n\nCommit: 0b52ecd01cd3c8aa28f10ef9627276b674aadda6\n\nIssue created by migration from https://trac.sagemath.org/ticket/24299\n\n",
    "created_at": "2017-11-29T16:53:00Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Systematic doctest for function return type",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24299",
    "user": "https://github.com/zimmermann6"
}
```

```
sage: sinh(CIF(1))
[1.1752011936438013 .. 1.1752011936438017]
sage: asinh(CIF(1))
0.881373587019543
```
The second command should return a (complex) interval.

Also:

```
sage: asin(CIF(0.6))
...
TypeError: unable to convert '0.59999999999999998?' to a real number
```


CC:  @jdemeyer

Reviewer: Paul Zimmermann

Author: Ralf Stephan

Branch: u/rws/24299

Status: needs_work

Dependencies: #24318, #24329, #24604

Commit: 0b52ecd01cd3c8aa28f10ef9627276b674aadda6

Issue created by migration from https://trac.sagemath.org/ticket/24299





---

archive/issue_comments_459937.json:
```json
{
    "body": "<a id='comment:2'></a>\nThat's a symbolic function evaluation issue, not the fault of CIF.",
    "created_at": "2017-11-30T08:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459937",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
That's a symbolic function evaluation issue, not the fault of CIF.



---

archive/issue_comments_459938.json:
```json
{
    "body": "Changing component from basic arithmetic to symbolics.",
    "created_at": "2017-11-30T08:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459938",
    "user": "https://github.com/rwst"
}
```

Changing component from basic arithmetic to symbolics.



---

archive/issue_comments_459939.json:
```json
{
    "body": "<a id='comment:3'></a>\nAs an explanation, the handling of inexact function arguments has several layers. The fallback layer (if the arg has no suitable member function and exact evaluation has no tricks) is to call the helper functions in `libs/pynac/pynac.pyx` which use member functions of RR and CC. There is in most cases no automatic back-conversion to the argument type so, as fallback, you at least get `Real/ComplexField` elements.\n\nThere is work ongoing in Pynac to use arb instead of `RR` and `CC` because of speed and ease of conversion to e.g. interval field elements. It's just that inverse hyperbolic functions are still waiting for it. Of course one could state it's the responsibility of CIF to implement inverse hyperbolic functions (and inverse trig functions, for that matter) but I'm not holding my breath. CIF is a math programming exercise, Pynac tries to solve real calculus problems, so we'll implement it in Pynac-0.7.14.",
    "created_at": "2017-12-01T07:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459939",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
As an explanation, the handling of inexact function arguments has several layers. The fallback layer (if the arg has no suitable member function and exact evaluation has no tricks) is to call the helper functions in `libs/pynac/pynac.pyx` which use member functions of RR and CC. There is in most cases no automatic back-conversion to the argument type so, as fallback, you at least get `Real/ComplexField` elements.

There is work ongoing in Pynac to use arb instead of `RR` and `CC` because of speed and ease of conversion to e.g. interval field elements. It's just that inverse hyperbolic functions are still waiting for it. Of course one could state it's the responsibility of CIF to implement inverse hyperbolic functions (and inverse trig functions, for that matter) but I'm not holding my breath. CIF is a math programming exercise, Pynac tries to solve real calculus problems, so we'll implement it in Pynac-0.7.14.



---

archive/issue_comments_459940.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,3 +6,12 @@\n 0.881373587019543\n ```\n The second command should return a (complex) interval.\n+\n+Also:\n+\n+```\n+sage: asin(CIF(0.6))\n+...\n+TypeError: unable to convert '0.59999999999999998?' to a real number\n+```\n+\n``````\n",
    "created_at": "2017-12-02T08:36:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459940",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,3 +6,12 @@
 0.881373587019543
 ```
 The second command should return a (complex) interval.
+
+Also:
+
+```
+sage: asin(CIF(0.6))
+...
+TypeError: unable to convert '0.59999999999999998?' to a real number
+```
+
``````




---

archive/issue_events_061506.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2017-12-02T08:36:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24299#event-61506"
}
```



---

archive/issue_comments_459941.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#24317\"",
    "created_at": "2017-12-04T07:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459941",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "" to "#24317"



---

archive/issue_comments_459942.json:
```json
{
    "body": "Changing dependencies from \"#24317\" to \"#24318, pynac-0.7.14\"",
    "created_at": "2017-12-04T14:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459942",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#24317" to "#24318, pynac-0.7.14"



---

archive/issue_comments_459943.json:
```json
{
    "body": "Changing branch from \"\" to \"u/rws/bugs_with_inverse_trig_and_hyperbolic_functions_of_cif_argument\"",
    "created_at": "2017-12-26T14:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459943",
    "user": "https://github.com/rwst"
}
```

Changing branch from "" to "u/rws/bugs_with_inverse_trig_and_hyperbolic_functions_of_cif_argument"



---

archive/issue_comments_459944.json:
```json
{
    "body": "Changing author from \"\" to \"Ralf Stephan\"",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459944",
    "user": "https://github.com/rwst"
}
```

Changing author from "" to "Ralf Stephan"



---

archive/issue_comments_459945.json:
```json
{
    "body": "<a id='comment:8'></a>\nNew commits:\n|                                                                                                                                          |                                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|\n|[0dad6ad](https://git.sagemath.org/sage.git/commit?id=0dad6addf34653b2dbf55dda93dc22b3ff209a8a)|`24299: Bugs with inverse trig and hyperbolic functions of CIF argument`|",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459945",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>
New commits:
|                                                                                                                                          |                                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
|[0dad6ad](https://git.sagemath.org/sage.git/commit?id=0dad6addf34653b2dbf55dda93dc22b3ff209a8a)|`24299: Bugs with inverse trig and hyperbolic functions of CIF argument`|



---

archive/issue_comments_459946.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459946",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_459947.json:
```json
{
    "body": "Changing commit from \"\" to \"0dad6addf34653b2dbf55dda93dc22b3ff209a8a\"",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459947",
    "user": "https://github.com/rwst"
}
```

Changing commit from "" to "0dad6addf34653b2dbf55dda93dc22b3ff209a8a"



---

archive/issue_comments_459948.json:
```json
{
    "body": "Changing dependencies from \"#24318, pynac-0.7.14\" to \"#24318, #24329\"",
    "created_at": "2017-12-26T14:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459948",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#24318, pynac-0.7.14" to "#24318, #24329"



---

archive/issue_comments_459949.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'd like to review this, but I see only non-regression tests in commit \u200b0dad6ad, and no changes in the source code. How could the results change?",
    "created_at": "2017-12-29T10:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459949",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:9'></a>
I'd like to review this, but I see only non-regression tests in commit ​0dad6ad, and no changes in the source code. How could the results change?



---

archive/issue_comments_459950.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [zimmerma](#comment%3A9):\n> I'd like to review this, but I see only non-regression tests in commit \u200b0dad6ad, and no changes in the source code. How could the results change?\n\n\nFunctions can be either coded in Python (`BuiltinFunction`) or C++ (`GinacFunction` in Pynac). FP evaluation first looks if CIF has a member for `asinh` and, as there isn't, the function's `evalf` member is called. As trig and hyperbolic functions are `GinacFunction`s the changes needed to be done in Pynac, and they became effect with #24329 which was introduced in beta0 I think. So, in order to see the doctests fail you need to go back to 8.1.",
    "created_at": "2017-12-30T06:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459950",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
Replying to [zimmerma](#comment%3A9):
> I'd like to review this, but I see only non-regression tests in commit ​0dad6ad, and no changes in the source code. How could the results change?


Functions can be either coded in Python (`BuiltinFunction`) or C++ (`GinacFunction` in Pynac). FP evaluation first looks if CIF has a member for `asinh` and, as there isn't, the function's `evalf` member is called. As trig and hyperbolic functions are `GinacFunction`s the changes needed to be done in Pynac, and they became effect with #24329 which was introduced in beta0 I think. So, in order to see the doctests fail you need to go back to 8.1.



---

archive/issue_comments_459951.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T18:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459951",
    "user": "https://github.com/zimmermann6"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_459952.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Paul Zimmermann\"",
    "created_at": "2017-12-30T18:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459952",
    "user": "https://github.com/zimmermann6"
}
```

Changing reviewer from "" to "Paul Zimmermann"



---

archive/issue_comments_459953.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm not sure about this:\n\n```\nsage: acoth(CIF(0.6))\n0.693147180559945?\n```\nsince we get with CC:\n\n```\nsage: acoth(CC(0.6))\n0.693147180559945 - 1.57079632679490*I\n```",
    "created_at": "2017-12-30T18:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459953",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:11'></a>
I'm not sure about this:

```
sage: acoth(CIF(0.6))
0.693147180559945?
```
since we get with CC:

```
sage: acoth(CC(0.6))
0.693147180559945 - 1.57079632679490*I
```



---

archive/issue_comments_459954.json:
```json
{
    "body": "<a id='comment:12'></a>\nAgreed, still buggy.",
    "created_at": "2017-12-31T07:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459954",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
Agreed, still buggy.



---

archive/issue_comments_459955.json:
```json
{
    "body": "<a id='comment:13'></a>\nI did a systematic search and found these additional issues:\n\n```\nsage: log_gamma(complex(1.7))\n-0.09580769740706588\nsage: psi(complex(1.7))\n0.2085478748734939\n```\nAlso `dickman_rho` can't handle anything other than float.\n\nThe code I used will go into `tests/symbolic-functions.py`.",
    "created_at": "2018-01-28T09:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459955",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
I did a systematic search and found these additional issues:

```
sage: log_gamma(complex(1.7))
-0.09580769740706588
sage: psi(complex(1.7))
0.2085478748734939
```
Also `dickman_rho` can't handle anything other than float.

The code I used will go into `tests/symbolic-functions.py`.



---

archive/issue_comments_459956.json:
```json
{
    "body": "Changing branch from \"u/rws/bugs_with_inverse_trig_and_hyperbolic_functions_of_cif_argument\" to \"u/rws/24299\"",
    "created_at": "2018-01-29T08:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459956",
    "user": "https://github.com/rwst"
}
```

Changing branch from "u/rws/bugs_with_inverse_trig_and_hyperbolic_functions_of_cif_argument" to "u/rws/24299"



---

archive/issue_comments_459957.json:
```json
{
    "body": "Changing commit from \"0dad6addf34653b2dbf55dda93dc22b3ff209a8a\" to \"0b52ecd01cd3c8aa28f10ef9627276b674aadda6\"",
    "created_at": "2018-01-29T08:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459957",
    "user": "https://github.com/rwst"
}
```

Changing commit from "0dad6addf34653b2dbf55dda93dc22b3ff209a8a" to "0b52ecd01cd3c8aa28f10ef9627276b674aadda6"



---

archive/issue_comments_459958.json:
```json
{
    "body": "Changing dependencies from \"#24318, #24329\" to \"#24318, #24329, #24604\"",
    "created_at": "2018-01-29T08:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459958",
    "user": "https://github.com/rwst"
}
```

Changing dependencies from "#24318, #24329" to "#24318, #24329, #24604"



---

archive/issue_comments_459959.json:
```json
{
    "body": "<a id='comment:15'></a>\nNew commits:\n|                                                                                                                                          |                                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[0b52ecd](https://git.sagemath.org/sage.git/commit?id=0b52ecd01cd3c8aa28f10ef9627276b674aadda6)|`24299: Systematic doctest for function return type`|",
    "created_at": "2018-01-29T08:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459959",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>
New commits:
|                                                                                                                                          |                                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[0b52ecd](https://git.sagemath.org/sage.git/commit?id=0b52ecd01cd3c8aa28f10ef9627276b674aadda6)|`24299: Systematic doctest for function return type`|



---

archive/issue_comments_459960.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [zimmerma](#comment%3A11):\n> I'm not sure about this:\n> \n> ```\n> sage: acoth(CIF(0.6))\n> 0.693147180559945?\n> ```\n\n\nThis one is now fixed in Pynac-0.7.16.",
    "created_at": "2018-02-01T09:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459960",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'></a>
Replying to [zimmerma](#comment%3A11):
> I'm not sure about this:
> 
> ```
> sage: acoth(CIF(0.6))
> 0.693147180559945?
> ```


This one is now fixed in Pynac-0.7.16.



---

archive/issue_comments_459961.json:
```json
{
    "body": "<a id='comment:17'></a>\nNow with Pynac-0.7.16 still failing.",
    "created_at": "2018-02-19T07:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459961",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>
Now with Pynac-0.7.16 still failing.



---

archive/issue_comments_459962.json:
```json
{
    "body": "<a id='comment:18'></a>\nUpdate: the correct `arccoth(RR(0.7))-->CC`, `elliptic_eu(7,CC(1.7))`, `jacobi_am(7,CC(1.7))` are flagged wrong. Still failing: `dickman_rho(all types)`.",
    "created_at": "2018-07-01T07:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24299",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24299#issuecomment-459962",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
Update: the correct `arccoth(RR(0.7))-->CC`, `elliptic_eu(7,CC(1.7))`, `jacobi_am(7,CC(1.7))` are flagged wrong. Still failing: `dickman_rho(all types)`.
