# Issue 24575: on Arch make+guile is broken

archive/issues_024338.json:
```json
{
    "assignees": [],
    "body": "Guile plugin in make under certain not completely clear conditions, likely to do with a version misconfiguration of system libraries,\nmay fail to build a number of Sage packages. For example, while building Sage 8.2.beta3 on latest archlinux one gets\n\n```\nmake: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \nGC_move_disappearing_link\n```\nas libguile looks at the LD_LIBRARY_PATH containing a different version of `libgc.so` than the one it needs.\n\nSee also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).\n\nAfter deactivating the `gc` package, the compilation went fine.\n\nHowever, this cannot be reproduced on other Linux systems.\n\nThe workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to the 2 standard packages `R` and `rpy2`.\n\nThe three other packges `flint`/`arb`/`deformation` fail to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.\n\nUpstream issues\n\n- flint: upstream issue at https://github.com/wbhart/flint2/issues/447\n- arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213\n- deformation: https://github.com/jpflori/pydeformation/issues/5 (for the pie trouble from #24902)\n\nDepends on #24885\n\nCC:  @embray @vbraun @EmmanuelCharpentier @defeo jpflori\n\nBranch/Commit: **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575) @ [0d8a4a9](https://github.com/sagemath/sagetrac-mirror/commit/0d8a4a954cee8958b24ece2067bf5191dcbcd28e)**\n\nUpstream: **Reported upstream. No feedback yet.**\n\nReviewer: **Erik Bray, Vincent Delecroix**\n\nAuthor: **Erik Bray, Vincent Delecroix**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24575_\n\n",
    "created_at": "2018-01-20T11:40:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "on Arch make+guile is broken",
    "type": "issue",
    "updated_at": "2022-12-29T01:40:48Z",
    "url": "https://github.com/sagemath/sage/issues/24575",
    "user": "https://github.com/videlec"
}
```
Guile plugin in make under certain not completely clear conditions, likely to do with a version misconfiguration of system libraries,
may fail to build a number of Sage packages. For example, while building Sage 8.2.beta3 on latest archlinux one gets

```
make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
GC_move_disappearing_link
```
as libguile looks at the LD_LIBRARY_PATH containing a different version of `libgc.so` than the one it needs.

See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).

After deactivating the `gc` package, the compilation went fine.

However, this cannot be reproduced on other Linux systems.

The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to the 2 standard packages `R` and `rpy2`.

The three other packges `flint`/`arb`/`deformation` fail to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.

Upstream issues

- flint: upstream issue at https://github.com/wbhart/flint2/issues/447
- arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213
- deformation: https://github.com/jpflori/pydeformation/issues/5 (for the pie trouble from #24902)

Depends on #24885

CC:  @embray @vbraun @EmmanuelCharpentier @defeo jpflori

Branch/Commit: **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575) @ [0d8a4a9](https://github.com/sagemath/sagetrac-mirror/commit/0d8a4a954cee8958b24ece2067bf5191dcbcd28e)**

Upstream: **Reported upstream. No feedback yet.**

Reviewer: **Erik Bray, Vincent Delecroix**

Author: **Erik Bray, Vincent Delecroix**

_Issue created by migration from https://trac.sagemath.org/ticket/24575_





---

archive/issue_events_310718.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-20T11:40:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310718"
}
```



---

archive/issue_events_310719.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-20T11:40:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310719"
}
```



---

archive/issue_events_310720.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-01-20T11:40:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310720"
}
```



---

archive/issue_comments_374996.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,6 @@\n make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \n GC_move_disappearing_link\n ```\n+After deactivating the `gc` packages, the compilation went fine on this machine.\n \n See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).\n``````\n",
    "created_at": "2018-01-20T11:46:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-374996",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,6 @@
 make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
 GC_move_disappearing_link
 ```
+After deactivating the `gc` packages, the compilation went fine on this machine.
 
 See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).
``````




---

archive/issue_comments_374997.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,6 @@\n make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \n GC_move_disappearing_link\n ```\n-After deactivating the `gc` packages, the compilation went fine on this machine.\n+After deactivating the `gc` package, the compilation went fine on this machine.\n \n See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).\n``````\n",
    "created_at": "2018-01-20T11:47:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-374997",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,6 @@
 make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
 GC_move_disappearing_link
 ```
-After deactivating the `gc` packages, the compilation went fine on this machine.
+After deactivating the `gc` package, the compilation went fine on this machine.
 
 See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).
``````




---

archive/issue_comments_374998.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nA (possibly naive) suggestion is to do (almost) what we already do for gcc and related, but simpler :\n* Depend on gc\n* Test for it (and its version) in the main configure file\n    - If found (and sufficient) : use that (possibly symlinking the relevant header/library files)\n    - Else : install \"our\" version.\n\nDrawback : a newer version might break compatibility. A code review of its use is necessary.\n\nBTW : can one use `pkg-config` in the main configure file ? I think not (alas...).",
    "created_at": "2018-01-20T13:45:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-374998",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:3'>Comment 3:</a>
A (possibly naive) suggestion is to do (almost) what we already do for gcc and related, but simpler :
* Depend on gc
* Test for it (and its version) in the main configure file
    - If found (and sufficient) : use that (possibly symlinking the relevant header/library files)
    - Else : install "our" version.

Drawback : a newer version might break compatibility. A code review of its use is necessary.

BTW : can one use `pkg-config` in the main configure file ? I think not (alas...).



---

archive/issue_comments_374999.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nAt what point do you get this error? While building R? (guessing the latter from the subject of sage-devel post)",
    "created_at": "2018-01-20T15:33:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-374999",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'>Comment 4:</a>
At what point do you get this error? While building R? (guessing the latter from the subject of sage-devel post)



---

archive/issue_comments_375000.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nhow come make depends on guile for you? I don't see it.\n\n```\n$ ldd `which gmake`\n\tlinux-vdso.so.1 (0x00007ffe861ce000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f0e5b6d3000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f0e5b30f000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f0e5b8d7000)\n```\n\nI've just installed gc-7.6.2 systemwide, and things work for me with Sage, so far.",
    "created_at": "2018-01-20T15:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375000",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'>Comment 5:</a>
how come make depends on guile for you? I don't see it.

```
$ ldd `which gmake`
	linux-vdso.so.1 (0x00007ffe861ce000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f0e5b6d3000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f0e5b30f000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f0e5b8d7000)
```

I've just installed gc-7.6.2 systemwide, and things work for me with Sage, so far.



---

archive/issue_comments_375001.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBy the way, there is #23700, which would give you the same major gc version as you apparently need (although I fail to see why).",
    "created_at": "2018-01-20T16:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375001",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'>Comment 6:</a>
By the way, there is #23700, which would give you the same major gc version as you apparently need (although I fail to see why).



---

archive/issue_comments_375002.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nIMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage.",
    "created_at": "2018-01-20T16:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375002",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage.



---

archive/issue_comments_375003.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nI think the \"symbol lookup error\" is just being echoed by make, its not from make not finding a symbol; This happens while R is compiling the MASS package and output is clearly being filtered.\n\nApparently R sets LD_LIBRARY_PATH while compiling packages so Sage's libraries take precedence over system ones. Which inevitably leads to problems, which is why we removed that from the Sage build system a while ago.",
    "created_at": "2018-01-20T17:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375003",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'>Comment 8:</a>
I think the "symbol lookup error" is just being echoed by make, its not from make not finding a symbol; This happens while R is compiling the MASS package and output is clearly being filtered.

Apparently R sets LD_LIBRARY_PATH while compiling packages so Sage's libraries take precedence over system ones. Which inevitably leads to problems, which is why we removed that from the Sage build system a while ago.



---

archive/issue_comments_375004.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nNo, R is not setting `LD_LIBRARY_PATH`, it is merely respecting it. I think we have a case of Sage being built with LD_LIBRARY_PATH set to something, and also `guile` (indeed, it has nothing to do with Sage AFAIK) involved in the environment somehow; and `guile` (perhaps invoked from `.bashrc`?) made to use wrong `gc` version from Sage.    \n\nTo reproduce this one needs to have libgc.so.X have the same X in $SAGE_LOCAL/lib and in /usr/lib. On my system X=1 in the former and X=2 in the latter, \nand libguile is linked to libgc.so.2. So I went and made \n\n```\n$ ln -sf libgc.so.1 libgc.so.2\n```\nin $SAGE_LOCAL/lib. After this I duly get\n\n```\n$ LD_LIBRARY_PATH=./local/lib guile\nguile: symbol lookup error: /usr/lib64/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link\n```\n\nNeedless to say, R still builds just fine for me after this hack.",
    "created_at": "2018-01-20T23:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375004",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'>Comment 9:</a>
No, R is not setting `LD_LIBRARY_PATH`, it is merely respecting it. I think we have a case of Sage being built with LD_LIBRARY_PATH set to something, and also `guile` (indeed, it has nothing to do with Sage AFAIK) involved in the environment somehow; and `guile` (perhaps invoked from `.bashrc`?) made to use wrong `gc` version from Sage.    

To reproduce this one needs to have libgc.so.X have the same X in $SAGE_LOCAL/lib and in /usr/lib. On my system X=1 in the former and X=2 in the latter, 
and libguile is linked to libgc.so.2. So I went and made 

```
$ ln -sf libgc.so.1 libgc.so.2
```
in $SAGE_LOCAL/lib. After this I duly get

```
$ LD_LIBRARY_PATH=./local/lib guile
guile: symbol lookup error: /usr/lib64/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link
```

Needless to say, R still builds just fine for me after this hack.



---

archive/issue_comments_375005.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nFor precision, my `$LD_LIBRARY_PATH` is empty. It should not have anything to do with it. What about the proposition of [charpent [comment:3](#comment%3A3)](https://github.com/sagemath/sage/issues/24575#comment:3)?",
    "created_at": "2018-01-22T07:14:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375005",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'>Comment 10:</a>
For precision, my `$LD_LIBRARY_PATH` is empty. It should not have anything to do with it. What about the proposition of [charpent [comment:3](#comment%3A3)](https://github.com/sagemath/sage/issues/24575#comment:3)?



---

archive/issue_comments_375006.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nYou have a strange setup on your system, which involves guile into building Sage. Perhaps something in shell configurations, I do not know. Or something wrong with your linker settings or its cache. Guile is a system library which you can only make to fail this way by setting LD_LIBRARY_PATH. But Sage does not do it, something else does.",
    "created_at": "2018-01-22T08:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375006",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'>Comment 11:</a>
You have a strange setup on your system, which involves guile into building Sage. Perhaps something in shell configurations, I do not know. Or something wrong with your linker settings or its cache. Guile is a system library which you can only make to fail this way by setting LD_LIBRARY_PATH. But Sage does not do it, something else does.



---

archive/issue_comments_375007.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@dimpase](#comment%3A7):\n> IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. \n\nThat's not what's going on here so please don't mischaracterize it as a \"huge security hole\".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of \"DLL hell\" (albeit less severe).",
    "created_at": "2018-01-22T13:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375007",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@dimpase](#comment%3A7):
> IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. 

That's not what's going on here so please don't mischaracterize it as a "huge security hole".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of "DLL hell" (albeit less severe).



---

archive/issue_comments_375008.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@embray](#comment%3A12):\n> Replying to [@dimpase](#comment%3A7):\n> > IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. \n\n> \n> That's not what's going on here so please don't mischaracterize it as a \"huge security hole\".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of \"DLL hell\" (albeit less severe).\n\nOne needs to set LD_LIBRARY_PATH for this to happen. If on the other hand you succeed in replacing the system library with one at your account *for all the users*, regardless of the environment, then yes, you have hacked the system via a security hole.\n\nAnyhow, there is no Sage bug to fix here, that's what I am trying to say all along.\nUnless I see an meaningful explanation how libguile is relevant to building Sage, I'd tend to set this to `wontfix`.",
    "created_at": "2018-01-22T14:09:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375008",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@embray](#comment%3A12):
> Replying to [@dimpase](#comment%3A7):
> > IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. 

> 
> That's not what's going on here so please don't mischaracterize it as a "huge security hole".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of "DLL hell" (albeit less severe).

One needs to set LD_LIBRARY_PATH for this to happen. If on the other hand you succeed in replacing the system library with one at your account *for all the users*, regardless of the environment, then yes, you have hacked the system via a security hole.

Anyhow, there is no Sage bug to fix here, that's what I am trying to say all along.
Unless I see an meaningful explanation how libguile is relevant to building Sage, I'd tend to set this to `wontfix`.



---

archive/issue_comments_375009.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@dimpase](#comment%3A13):\n> Replying to [@embray](#comment%3A12):\n> > Replying to [@dimpase](#comment%3A7):\n> > > IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. \n\n> > \n> > That's not what's going on here so please don't mischaracterize it as a \"huge security hole\".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of \"DLL hell\" (albeit less severe).\n\n> \n> One needs to set LD_LIBRARY_PATH for this to happen. If on the other hand you succeed in replacing the system library with one at your account *for all the users*, regardless of the environment, then yes, you have hacked the system via a security hole.\n\nI...don't see any evidence that that's happening here.",
    "created_at": "2018-01-22T14:14:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375009",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@dimpase](#comment%3A13):
> Replying to [@embray](#comment%3A12):
> > Replying to [@dimpase](#comment%3A7):
> > > IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. 

> > 
> > That's not what's going on here so please don't mischaracterize it as a "huge security hole".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of "DLL hell" (albeit less severe).

> 
> One needs to set LD_LIBRARY_PATH for this to happen. If on the other hand you succeed in replacing the system library with one at your account *for all the users*, regardless of the environment, then yes, you have hacked the system via a security hole.

I...don't see any evidence that that's happening here.



---

archive/issue_comments_375010.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@embray](#comment%3A14):\n> Replying to [@dimpase](#comment%3A13):\n> > Replying to [@embray](#comment%3A12):\n> > > Replying to [@dimpase](#comment%3A7):\n> > > > IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. \n\n> > > \n> > > That's not what's going on here so please don't mischaracterize it as a \"huge security hole\".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of \"DLL hell\" (albeit less severe).\n\n> > \n> > One needs to set LD_LIBRARY_PATH for this to happen. If on the other hand you succeed in replacing the system library with one at your account *for all the users*, regardless of the environment, then yes, you have hacked the system via a security hole.\n\n> \n> I...don't see any evidence that that's happening here.\n\nI have not said I see this, either. What I see is an unexplained attempt to invoke (lib)guile during the Sage build.",
    "created_at": "2018-01-22T14:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375010",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@embray](#comment%3A14):
> Replying to [@dimpase](#comment%3A13):
> > Replying to [@embray](#comment%3A12):
> > > Replying to [@dimpase](#comment%3A7):
> > > > IMHO, if you can nuke a system utility by installing a library with normal user privileges, then you have a huge security hole. Thus I don't think it's something to fix in Sage. 

> > > 
> > > That's not what's going on here so please don't mischaracterize it as a "huge security hole".  It's quite normal to have a broken setup where one executable is linking at runtime with the wrong version of some shared library.  This is the Linux version of "DLL hell" (albeit less severe).

> > 
> > One needs to set LD_LIBRARY_PATH for this to happen. If on the other hand you succeed in replacing the system library with one at your account *for all the users*, regardless of the environment, then yes, you have hacked the system via a security hole.

> 
> I...don't see any evidence that that's happening here.

I have not said I see this, either. What I see is an unexplained attempt to invoke (lib)guile during the Sage build.



---

archive/issue_comments_375011.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nSomebody who can reproduce the original problem should make the R build more verbose and try again...",
    "created_at": "2018-01-22T15:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375011",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'>Comment 16:</a>
Somebody who can reproduce the original problem should make the R build more verbose and try again...



---

archive/issue_comments_375012.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\naccording to [Vincent](https://groups.google.com/d/msg/sage-devel/5LqXytiF2nQ/rWw82_qOAAAJ) this can happen on his system while building Flint:\n\n```\nI restart a build from scratch and I don't believe that R is responsible \nin any way. This new build stopped on flint pointing at the same library \nissue \n\nmake: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \nGC_move_disappearing_link \n```",
    "created_at": "2018-01-22T15:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375012",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'>Comment 17:</a>
according to [Vincent](https://groups.google.com/d/msg/sage-devel/5LqXytiF2nQ/rWw82_qOAAAJ) this can happen on his system while building Flint:

```
I restart a build from scratch and I don't believe that R is responsible 
in any way. This new build stopped on flint pointing at the same library 
issue 

make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
GC_move_disappearing_link 
```



---

archive/issue_comments_375013.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@vbraun](#comment%3A16):\n> Somebody who can reproduce the original problem should make the R build more verbose and try again...\n\non it",
    "created_at": "2018-01-22T17:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375013",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@vbraun](#comment%3A16):
> Somebody who can reproduce the original problem should make the R build more verbose and try again...

on it



---

archive/issue_comments_375014.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nFailed on flint. But debug mode not very helpful (made in flint source dir)\n\n```\n(sage-sh)$ make --debug\nGNU Make 4.2.1\nBuilt for x86_64-unknown-linux-gnu\nCopyright (C) 1988-2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\nReading makefiles...\nUpdating makefiles....\nUpdating goal targets....\n File 'all' does not exist.\n   File 'library' does not exist.\n  Must remake target 'library'.\nmake: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link\nmake: *** [Makefile:173: library] Error 127\n```",
    "created_at": "2018-01-22T17:20:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375014",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'>Comment 19:</a>
Failed on flint. But debug mode not very helpful (made in flint source dir)

```
(sage-sh)$ make --debug
GNU Make 4.2.1
Built for x86_64-unknown-linux-gnu
Copyright (C) 1988-2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
Reading makefiles...
Updating makefiles....
Updating goal targets....
 File 'all' does not exist.
   File 'library' does not exist.
  Must remake target 'library'.
make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link
make: *** [Makefile:173: library] Error 127
```



---

archive/issue_comments_375015.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nCan you try starting guile at `(sage-sh)$` prompt?",
    "created_at": "2018-01-22T17:25:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375015",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'>Comment 20:</a>
Can you try starting guile at `(sage-sh)$` prompt?



---

archive/issue_comments_375016.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@dimpase](#comment%3A20):\n> Can you try starting guile at `(sage-sh)$` prompt?\n\nIt works fine\n\n```\n(sage-sh) $ guile\nGNU Guile 2.2.3\nCopyright (C) 1995-2017 Free Software Foundation, Inc.\n\nGuile comes with ABSOLUTELY NO WARRANTY; for details type `,show w'.\nThis program is free software, and you are welcome to redistribute it\nunder certain conditions; type `,show c' for details.\n\nEnter `,help' for help.\nscheme@(guile-user)> quit()\n$1 = #<procedure quit args>\nWhile compiling expression:\nSyntax error:\nunknown location: unexpected syntax in form ()\nscheme@(guile-user)> ()\n```",
    "created_at": "2018-01-22T18:01:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375016",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@dimpase](#comment%3A20):
> Can you try starting guile at `(sage-sh)$` prompt?

It works fine

```
(sage-sh) $ guile
GNU Guile 2.2.3
Copyright (C) 1995-2017 Free Software Foundation, Inc.

Guile comes with ABSOLUTELY NO WARRANTY; for details type `,show w'.
This program is free software, and you are welcome to redistribute it
under certain conditions; type `,show c' for details.

Enter `,help' for help.
scheme@(guile-user)> quit()
$1 = #<procedure quit args>
While compiling expression:
Syntax error:
unknown location: unexpected syntax in form ()
scheme@(guile-user)> ()
```



---

archive/issue_comments_375017.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nStill with flint: without any option to `./configure` it succeeds\n\n```\n(sage-sh)$ ./configure --disable-static --prefix=\"$SAGE_LOCAL\"\nConfiguring...x86_64-Linux\nTesting __builtin_popcountl...yes\nTesting native popcount...yes\nTesting __thread...yes\nTesting fenv...yes\nFLINT was successfully configured.\n(sage-sh) $ make\nmkdir -p build\nmake[1]: Entering directory '/opt/sage-bis/local/var/tmp/sage/build/flint-2.5.2.p1/src'\n    CC   build/printf.lo\n    CC   build/fprintf.lo\n    CC   build/sprintf.lo\n    CC   build/scanf.lo\n    CC   build/fscanf.lo\n    CC   build/sscanf.lo\n    CC   build/clz_tab.lo\n    CC   build/memory_manager.lo\n    CC   build/version.lo\n    CC   build/profiler.lo\n    CC   build/thread_support.lo\n...\n```\nBut setting `--with-gmp` it fails\n\n```\n(sage-sh) $ ./configure --disable-static --prefix=\"$SAGE_LOCAL\" --with-gmp=\"$SAGE_LOCAL\"\nConfiguring...x86_64-Linux\nTesting __builtin_popcountl...yes\nTesting native popcount...yes\nTesting __thread...yes\nTesting fenv...yes\nFLINT was successfully configured.\n(sage-sh) $ make\nmake: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link\nmake: *** [Makefile:173: library] Error 127\n```",
    "created_at": "2018-01-22T18:12:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375017",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'>Comment 22:</a>
Still with flint: without any option to `./configure` it succeeds

```
(sage-sh)$ ./configure --disable-static --prefix="$SAGE_LOCAL"
Configuring...x86_64-Linux
Testing __builtin_popcountl...yes
Testing native popcount...yes
Testing __thread...yes
Testing fenv...yes
FLINT was successfully configured.
(sage-sh) $ make
mkdir -p build
make[1]: Entering directory '/opt/sage-bis/local/var/tmp/sage/build/flint-2.5.2.p1/src'
    CC   build/printf.lo
    CC   build/fprintf.lo
    CC   build/sprintf.lo
    CC   build/scanf.lo
    CC   build/fscanf.lo
    CC   build/sscanf.lo
    CC   build/clz_tab.lo
    CC   build/memory_manager.lo
    CC   build/version.lo
    CC   build/profiler.lo
    CC   build/thread_support.lo
...
```
But setting `--with-gmp` it fails

```
(sage-sh) $ ./configure --disable-static --prefix="$SAGE_LOCAL" --with-gmp="$SAGE_LOCAL"
Configuring...x86_64-Linux
Testing __builtin_popcountl...yes
Testing native popcount...yes
Testing __thread...yes
Testing fenv...yes
FLINT was successfully configured.
(sage-sh) $ make
make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link
make: *** [Makefile:173: library] Error 127
```



---

archive/issue_comments_375018.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@dimpase](#comment%3A5):\n> how come make depends on guile for you? I don't see it.\n> \n> ```\n> $ ldd `which gmake`\n> \tlinux-vdso.so.1 (0x00007ffe861ce000)\n> \tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f0e5b6d3000)\n> \tlibc.so.6 => /lib64/libc.so.6 (0x00007f0e5b30f000)\n> \t/lib64/ld-linux-x86-64.so.2 (0x00007f0e5b8d7000)\n> ```\n> \n> I've just installed gc-7.6.2 systemwide, and things work for me with Sage, so far.\n\nWhat is `gmake`? I got\n\n```\n(sage-sh) $ ldd `which make`\n        linux-vdso.so.1 (0x00007fff3ccf6000)\n        libguile-2.2.so.1 => /usr/lib/libguile-2.2.so.1 (0x00007f88df74d000)\n        libdl.so.2 => /usr/lib/libdl.so.2 (0x00007f88df549000)\n        libpthread.so.0 => /usr/lib/libpthread.so.0 (0x00007f88df32b000)\n        libc.so.6 => /usr/lib/libc.so.6 (0x00007f88def74000)\n        libgc.so.1 => /usr/lib/libgc.so.1 (0x00007f88ded0a000)\n        libffi.so.6 => /usr/lib/libffi.so.6 (0x00007f88deb01000)\n        libunistring.so.2 => /usr/lib/libunistring.so.2 (0x00007f88de77f000)\n        libgmp.so.10 => /usr/lib/libgmp.so.10 (0x00007f88de4ec000)\n        libltdl.so.7 => /usr/lib/libltdl.so.7 (0x00007f88de2e2000)\n        libcrypt.so.1 => /usr/lib/libcrypt.so.1 (0x00007f88de0aa000)\n        libm.so.6 => /usr/lib/libm.so.6 (0x00007f88ddd5e000)\n        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f88dfa7a000)\n        libatomic_ops.so.1 => /usr/lib/libatomic_ops.so.1 (0x00007f88ddb5c000)\n```",
    "created_at": "2018-01-22T18:15:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375018",
    "user": "https://github.com/videlec"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@dimpase](#comment%3A5):
> how come make depends on guile for you? I don't see it.
> 
> ```
> $ ldd `which gmake`
> 	linux-vdso.so.1 (0x00007ffe861ce000)
> 	libdl.so.2 => /lib64/libdl.so.2 (0x00007f0e5b6d3000)
> 	libc.so.6 => /lib64/libc.so.6 (0x00007f0e5b30f000)
> 	/lib64/ld-linux-x86-64.so.2 (0x00007f0e5b8d7000)
> ```
> 
> I've just installed gc-7.6.2 systemwide, and things work for me with Sage, so far.

What is `gmake`? I got

```
(sage-sh) $ ldd `which make`
        linux-vdso.so.1 (0x00007fff3ccf6000)
        libguile-2.2.so.1 => /usr/lib/libguile-2.2.so.1 (0x00007f88df74d000)
        libdl.so.2 => /usr/lib/libdl.so.2 (0x00007f88df549000)
        libpthread.so.0 => /usr/lib/libpthread.so.0 (0x00007f88df32b000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007f88def74000)
        libgc.so.1 => /usr/lib/libgc.so.1 (0x00007f88ded0a000)
        libffi.so.6 => /usr/lib/libffi.so.6 (0x00007f88deb01000)
        libunistring.so.2 => /usr/lib/libunistring.so.2 (0x00007f88de77f000)
        libgmp.so.10 => /usr/lib/libgmp.so.10 (0x00007f88de4ec000)
        libltdl.so.7 => /usr/lib/libltdl.so.7 (0x00007f88de2e2000)
        libcrypt.so.1 => /usr/lib/libcrypt.so.1 (0x00007f88de0aa000)
        libm.so.6 => /usr/lib/libm.so.6 (0x00007f88ddd5e000)
        /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f88dfa7a000)
        libatomic_ops.so.1 => /usr/lib/libatomic_ops.so.1 (0x00007f88ddb5c000)
```



---

archive/issue_comments_375019.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@videlec](#comment%3A23):\n> Replying to [@dimpase](#comment%3A5):\n> > how come make depends on guile for you? I don't see it.\n> > \n> > ```\n> > $ ldd `which gmake`\n> > \tlinux-vdso.so.1 (0x00007ffe861ce000)\n> > \tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f0e5b6d3000)\n> > \tlibc.so.6 => /lib64/libc.so.6 (0x00007f0e5b30f000)\n> > \t/lib64/ld-linux-x86-64.so.2 (0x00007f0e5b8d7000)\n> > ```\n> > \n> > I've just installed gc-7.6.2 systemwide, and things work for me with Sage, so far.\n\n> \n> What is `gmake`? \n\nfor me `make` is a link to `gmake`, but it's not important.\nWhat's important is that your `make` is linked with `libguile` (and a slew of its dependencies, including `libgc`), and this is not usual (I never heard of it---\nalthough it is not crazy, see https://www.gnu.org/software/make/manual/html_node/Guile-Integration.html)\n\n> I got\n> \n> ```\n> (sage-sh) $ ldd `which make`\n>         linux-vdso.so.1 (0x00007fff3ccf6000)\n>         libguile-2.2.so.1 => /usr/lib/libguile-2.2.so.1 (0x00007f88df74d000)\n>         libdl.so.2 => /usr/lib/libdl.so.2 (0x00007f88df549000)\n>         libpthread.so.0 => /usr/lib/libpthread.so.0 (0x00007f88df32b000)\n>         libc.so.6 => /usr/lib/libc.so.6 (0x00007f88def74000)\n>         libgc.so.1 => /usr/lib/libgc.so.1 (0x00007f88ded0a000)\n>         libffi.so.6 => /usr/lib/libffi.so.6 (0x00007f88deb01000)\n>         libunistring.so.2 => /usr/lib/libunistring.so.2 (0x00007f88de77f000)\n>         libgmp.so.10 => /usr/lib/libgmp.so.10 (0x00007f88de4ec000)\n>         libltdl.so.7 => /usr/lib/libltdl.so.7 (0x00007f88de2e2000)\n>         libcrypt.so.1 => /usr/lib/libcrypt.so.1 (0x00007f88de0aa000)\n>         libm.so.6 => /usr/lib/libm.so.6 (0x00007f88ddd5e000)\n>         /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f88dfa7a000)\n>         libatomic_ops.so.1 => /usr/lib/libatomic_ops.so.1 (0x00007f88ddb5c000)\n> ```\n\nSo we see that at this point `make` appears to be correctly linked.\n\nWhat do you see if in that directory (at sage-sh prompt) you run `make -v` rather than `make`? (More precisely, I'd like to understand whether it's the generated Flint's Makefile that breaks it, or it's just `make` itself)\n\nAnd what does `ldd /usr/lib/libguile-2.2.so.1` show?",
    "created_at": "2018-01-22T19:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375019",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@videlec](#comment%3A23):
> Replying to [@dimpase](#comment%3A5):
> > how come make depends on guile for you? I don't see it.
> > 
> > ```
> > $ ldd `which gmake`
> > 	linux-vdso.so.1 (0x00007ffe861ce000)
> > 	libdl.so.2 => /lib64/libdl.so.2 (0x00007f0e5b6d3000)
> > 	libc.so.6 => /lib64/libc.so.6 (0x00007f0e5b30f000)
> > 	/lib64/ld-linux-x86-64.so.2 (0x00007f0e5b8d7000)
> > ```
> > 
> > I've just installed gc-7.6.2 systemwide, and things work for me with Sage, so far.

> 
> What is `gmake`? 

for me `make` is a link to `gmake`, but it's not important.
What's important is that your `make` is linked with `libguile` (and a slew of its dependencies, including `libgc`), and this is not usual (I never heard of it---
although it is not crazy, see https://www.gnu.org/software/make/manual/html_node/Guile-Integration.html)

> I got
> 
> ```
> (sage-sh) $ ldd `which make`
>         linux-vdso.so.1 (0x00007fff3ccf6000)
>         libguile-2.2.so.1 => /usr/lib/libguile-2.2.so.1 (0x00007f88df74d000)
>         libdl.so.2 => /usr/lib/libdl.so.2 (0x00007f88df549000)
>         libpthread.so.0 => /usr/lib/libpthread.so.0 (0x00007f88df32b000)
>         libc.so.6 => /usr/lib/libc.so.6 (0x00007f88def74000)
>         libgc.so.1 => /usr/lib/libgc.so.1 (0x00007f88ded0a000)
>         libffi.so.6 => /usr/lib/libffi.so.6 (0x00007f88deb01000)
>         libunistring.so.2 => /usr/lib/libunistring.so.2 (0x00007f88de77f000)
>         libgmp.so.10 => /usr/lib/libgmp.so.10 (0x00007f88de4ec000)
>         libltdl.so.7 => /usr/lib/libltdl.so.7 (0x00007f88de2e2000)
>         libcrypt.so.1 => /usr/lib/libcrypt.so.1 (0x00007f88de0aa000)
>         libm.so.6 => /usr/lib/libm.so.6 (0x00007f88ddd5e000)
>         /lib64/ld-linux-x86-64.so.2 => /usr/lib64/ld-linux-x86-64.so.2 (0x00007f88dfa7a000)
>         libatomic_ops.so.1 => /usr/lib/libatomic_ops.so.1 (0x00007f88ddb5c000)
> ```

So we see that at this point `make` appears to be correctly linked.

What do you see if in that directory (at sage-sh prompt) you run `make -v` rather than `make`? (More precisely, I'd like to understand whether it's the generated Flint's Makefile that breaks it, or it's just `make` itself)

And what does `ldd /usr/lib/libguile-2.2.so.1` show?



---

archive/issue_comments_375020.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@dimpase](#comment%3A24):\n> Replying to [@videlec](#comment%3A23):\n> > Replying to [@dimpase](#comment%3A5):\n\n>\n> What do you see if in that directory (at sage-sh prompt) you run `make -v` rather than `make`? (More precisely, I'd like to understand whether it's the generated Flint's Makefile that breaks it, or it's just `make` itself)\n\n```\n(sage-sh) $ make -v\nGNU Make 4.2.1\nConstruit pour x86_64-unknown-linux-gnu\nCopyright (C) 1988-2016 Free Software Foundation, Inc.\nLicence GPLv3+\u00a0: GNU GPL version 3 ou ult\u00e9rieure <http://gnu.org/licenses/gpl.html>\nCeci est un logiciel libre\u00a0: vous \u00eates autoris\u00e9 \u00e0 le modifier et \u00e0 la redistribuer.\nIl ne comporte AUCUNE GARANTIE, dans la mesure de ce que permet la loi.\n```\n\nPlease read also [comment:22](#comment%3A22): make does not look broken when I do not configure `gmp`.\n\n> And what does `ldd /usr/lib/libguile-2.2.so.1` show?\n\n```\n(sage-sh) $ ldd /usr/lib/libguile-2.2.so.1\n        linux-vdso.so.1 (0x00007fff17387000)\n        libgc.so.1 => /usr/lib/libgc.so.1 (0x00007fed43ae3000)\n        libffi.so.6 => /usr/lib/libffi.so.6 (0x00007fed438da000)\n        libunistring.so.2 => /usr/lib/libunistring.so.2 (0x00007fed43558000)\n        libgmp.so.10 => /usr/lib/libgmp.so.10 (0x00007fed432c5000)\n        libltdl.so.7 => /usr/lib/libltdl.so.7 (0x00007fed430bb000)\n        libcrypt.so.1 => /usr/lib/libcrypt.so.1 (0x00007fed42e83000)\n        libm.so.6 => /usr/lib/libm.so.6 (0x00007fed42b37000)\n        libpthread.so.0 => /usr/lib/libpthread.so.0 (0x00007fed42919000)\n        libc.so.6 => /usr/lib/libc.so.6 (0x00007fed42562000)\n        /usr/lib64/ld-linux-x86-64.so.2 (0x00007fed4407a000)\n        libdl.so.2 => /usr/lib/libdl.so.2 (0x00007fed4235e000)\n        libatomic_ops.so.1 => /usr/lib/libatomic_ops.so.1 (0x00007fed4215c000)\n```",
    "created_at": "2018-01-22T20:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375020",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@dimpase](#comment%3A24):
> Replying to [@videlec](#comment%3A23):
> > Replying to [@dimpase](#comment%3A5):

>
> What do you see if in that directory (at sage-sh prompt) you run `make -v` rather than `make`? (More precisely, I'd like to understand whether it's the generated Flint's Makefile that breaks it, or it's just `make` itself)

```
(sage-sh) $ make -v
GNU Make 4.2.1
Construit pour x86_64-unknown-linux-gnu
Copyright (C) 1988-2016 Free Software Foundation, Inc.
Licence GPLv3+ : GNU GPL version 3 ou ultérieure <http://gnu.org/licenses/gpl.html>
Ceci est un logiciel libre : vous êtes autorisé à le modifier et à la redistribuer.
Il ne comporte AUCUNE GARANTIE, dans la mesure de ce que permet la loi.
```

Please read also [comment:22](#comment%3A22): make does not look broken when I do not configure `gmp`.

> And what does `ldd /usr/lib/libguile-2.2.so.1` show?

```
(sage-sh) $ ldd /usr/lib/libguile-2.2.so.1
        linux-vdso.so.1 (0x00007fff17387000)
        libgc.so.1 => /usr/lib/libgc.so.1 (0x00007fed43ae3000)
        libffi.so.6 => /usr/lib/libffi.so.6 (0x00007fed438da000)
        libunistring.so.2 => /usr/lib/libunistring.so.2 (0x00007fed43558000)
        libgmp.so.10 => /usr/lib/libgmp.so.10 (0x00007fed432c5000)
        libltdl.so.7 => /usr/lib/libltdl.so.7 (0x00007fed430bb000)
        libcrypt.so.1 => /usr/lib/libcrypt.so.1 (0x00007fed42e83000)
        libm.so.6 => /usr/lib/libm.so.6 (0x00007fed42b37000)
        libpthread.so.0 => /usr/lib/libpthread.so.0 (0x00007fed42919000)
        libc.so.6 => /usr/lib/libc.so.6 (0x00007fed42562000)
        /usr/lib64/ld-linux-x86-64.so.2 (0x00007fed4407a000)
        libdl.so.2 => /usr/lib/libdl.so.2 (0x00007fed4235e000)
        libatomic_ops.so.1 => /usr/lib/libatomic_ops.so.1 (0x00007fed4215c000)
```



---

archive/issue_comments_375021.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@dimpase](#comment%3A24):\n> for me `make` is a link to `gmake`, but it's not important.\n> What's important is that your `make` is linked with `libguile` (and a slew of its dependencies, including `libgc`), and this is not usual (I never heard of it---\n\nSince GNU make version 4 you can extend `make` with guile bindings. Building make with such extension is a configuration option. Building those or not is a choice usually made by distro. Usually binary distro include all possible options unless they have \"reservations\". On Gentoo it is an option that is off by default.",
    "created_at": "2018-01-22T21:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375021",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@dimpase](#comment%3A24):
> for me `make` is a link to `gmake`, but it's not important.
> What's important is that your `make` is linked with `libguile` (and a slew of its dependencies, including `libgc`), and this is not usual (I never heard of it---

Since GNU make version 4 you can extend `make` with guile bindings. Building make with such extension is a configuration option. Building those or not is a choice usually made by distro. Usually binary distro include all possible options unless they have "reservations". On Gentoo it is an option that is off by default.



---

archive/issue_comments_375022.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI've built make from source with `--with-guile`, guile version 2.2.\n(which required changing one character in line 171 configure.ac, \n\n```\n[ PKG_CHECK_MODULES([GUILE], [guile-2.2], [have_guile=yes],\n```\n(`2.2` instead of `2.0` - this probably explains why I was unable to build it the gentoo way?), getting\n\n```\n$ ldd `which make`\n\tlinux-vdso.so.1 (0x00007ffc6d3c3000)\n\tlibguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007f932105f000)\n\tlibgc.so.2 => /usr/lib64/libgc.so.2 (0x00007f9320de6000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f9320be2000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f93209c2000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f93205fe000)\n\tlibffi.so.6 => /usr/lib64/libffi.so.6 (0x00007f93203f5000)\n\tlibunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007f932007c000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f931fdf3000)\n\tlibltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007f931fbe9000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007f931f9b1000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f931f66f000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f93213b0000)\n```\nbut I cannot reproduce this.\nIt might be the version difference, but the produced `make` happily builds Flint\neven if I do `$export LD_LIBRARY_PATH=$SAGE_LOCAL/lib; make`.\n\nNeedless to say, this export breaks guile:\n\n```\n$ guile\nguile: symbol lookup error: /usr/lib64/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link\n```\nOr it might be that the generated by Flint Makefile does not trigger guile extension in my case, and does trigger it in Vincent's case?",
    "created_at": "2018-01-22T22:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375022",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'>Comment 27:</a>
I've built make from source with `--with-guile`, guile version 2.2.
(which required changing one character in line 171 configure.ac, 

```
[ PKG_CHECK_MODULES([GUILE], [guile-2.2], [have_guile=yes],
```
(`2.2` instead of `2.0` - this probably explains why I was unable to build it the gentoo way?), getting

```
$ ldd `which make`
	linux-vdso.so.1 (0x00007ffc6d3c3000)
	libguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007f932105f000)
	libgc.so.2 => /usr/lib64/libgc.so.2 (0x00007f9320de6000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f9320be2000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f93209c2000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f93205fe000)
	libffi.so.6 => /usr/lib64/libffi.so.6 (0x00007f93203f5000)
	libunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007f932007c000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f931fdf3000)
	libltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007f931fbe9000)
	libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007f931f9b1000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f931f66f000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f93213b0000)
```
but I cannot reproduce this.
It might be the version difference, but the produced `make` happily builds Flint
even if I do `$export LD_LIBRARY_PATH=$SAGE_LOCAL/lib; make`.

Needless to say, this export breaks guile:

```
$ guile
guile: symbol lookup error: /usr/lib64/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link
```
Or it might be that the generated by Flint Makefile does not trigger guile extension in my case, and does trigger it in Vincent's case?



---

archive/issue_comments_375023.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nThe trigger is just execution. If the symbol is not resolved you get this. There are a couple of things to remember:\n* for the problem to happen the soname of the libgc in sage and on the system need to be the same\n* while the soname are the same libgc in sage doesn't have the same symbols than on the system\n\nSo either libgc shouldn't have the same soname (upstream not bumping the number properly) or libgc is not configured with the same features in sage and on the system.",
    "created_at": "2018-01-22T22:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375023",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:28'>Comment 28:</a>
The trigger is just execution. If the symbol is not resolved you get this. There are a couple of things to remember:
* for the problem to happen the soname of the libgc in sage and on the system need to be the same
* while the soname are the same libgc in sage doesn't have the same symbols than on the system

So either libgc shouldn't have the same soname (upstream not bumping the number properly) or libgc is not configured with the same features in sage and on the system.



---

archive/issue_comments_375024.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@kiwifb](#comment%3A28):\n> The trigger is just execution. If the symbol is not resolved you get this. There are a couple of things to remember:\n> * for the problem to happen the soname of the libgc in sage and on the system need to be the same\n> * while the soname are the same libgc in sage doesn't have the same symbols than on the system\n> \n> So either libgc shouldn't have the same soname (upstream not bumping the number properly) or libgc is not configured with the same features in sage and on the system.\n\nThis does crash guile:\n\n```\n$ ldd `which guile`\n\tlinux-vdso.so.1 (0x00007ffd5e36a000)\n\tlibguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007f4c66c70000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f4c66a50000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f4c6668c000)\n\tlibgc.so.2 => /usr/lib64/libgc.so.2 (0x00007f4c66413000)\n\tlibffi.so.6 => /usr/lib64/libffi.so.6 (0x00007f4c6620a000)\n\tlibunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007f4c65e91000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f4c65c08000)\n\tlibltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007f4c659fe000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f4c657fa000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007f4c655c2000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f4c65280000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f4c66fc1000)\n(sage-sh) dima@hilbert:sage-dev$ LD_LIBRARY_PATH=$SAGE_LOCAL/lib guile\nguile: symbol lookup error: /usr/lib64/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link\n```\nas I created a link to the wrong libgc (see comment 9):\n\n```\n$ ls -l $SAGE_LOCAL/lib/libgc*\n-rw-r--r-- 1 dima dima 946784 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.a\nlrwxrwxrwx 1 dima dima     14 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.so -> libgc.so.1.0.3\nlrwxrwxrwx 1 dima dima     14 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.so.1 -> libgc.so.1.0.3\n-rwxr-xr-x 1 dima dima 702568 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.so.1.0.3\nlrwxrwxrwx 1 dima dima     10 Jan 20 22:54 /home/dima/Sage/sage-dev/local/lib/libgc.so.2 -> libgc.so.1\n```\n(libgc.so.1 is wrong (Sage's gc 7.2)) But make with guile works just fine:\n\n```\n$ LD_LIBRARY_PATH=$SAGE_LOCAL/lib /home/dima/bin/make -v\nGNU Make 4.2.1\nBuilt for x86_64-pc-linux-gnu\nCopyright (C) 1988-2016 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n```\neven though it is linked to the same libguile:\n\n```\n$ ldd /home/dima/bin/make \n\tlinux-vdso.so.1 (0x00007ffd2959e000)\n\tlibguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007fb4e1418000)\n\tlibgc.so.2 => /usr/lib64/libgc.so.2 (0x00007fb4e119f000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007fb4e0f9b000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007fb4e0d7b000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fb4e09b7000)\n\tlibffi.so.6 => /usr/lib64/libffi.so.6 (0x00007fb4e07ae000)\n\tlibunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007fb4e0435000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007fb4e01ac000)\n\tlibltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007fb4dffa2000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fb4dfd6a000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fb4dfa28000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007fb4e1769000)\n```\njust as a sanity check:\n\n```\n$ LD_LIBRARY_PATH=$SAGE_LOCAL/lib ldd /home/dima/bin/make \n\tlinux-vdso.so.1 (0x00007ffccbbfe000)\n\tlibguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007ff033858000)\n\tlibgc.so.2 => /home/dima/Sage/sage-dev/local/lib/libgc.so.2 (0x00007ff0334f9000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007ff0332f5000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007ff0330d5000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007ff032d11000)\n\tlibffi.so.6 => /usr/lib64/libffi.so.6 (0x00007ff032b08000)\n\tlibunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007ff03278f000)\n\tlibgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007ff032506000)\n\tlibltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007ff0322fc000)\n\tlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007ff0320c4000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007ff031d82000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007ff033ba9000)\n```\nSo even though the link ought to be resolved by the linker, it is not done (I can also run actual building, not just `-v` with this setup).",
    "created_at": "2018-01-22T23:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375024",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@kiwifb](#comment%3A28):
> The trigger is just execution. If the symbol is not resolved you get this. There are a couple of things to remember:
> * for the problem to happen the soname of the libgc in sage and on the system need to be the same
> * while the soname are the same libgc in sage doesn't have the same symbols than on the system
> 
> So either libgc shouldn't have the same soname (upstream not bumping the number properly) or libgc is not configured with the same features in sage and on the system.

This does crash guile:

```
$ ldd `which guile`
	linux-vdso.so.1 (0x00007ffd5e36a000)
	libguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007f4c66c70000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f4c66a50000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f4c6668c000)
	libgc.so.2 => /usr/lib64/libgc.so.2 (0x00007f4c66413000)
	libffi.so.6 => /usr/lib64/libffi.so.6 (0x00007f4c6620a000)
	libunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007f4c65e91000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007f4c65c08000)
	libltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007f4c659fe000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f4c657fa000)
	libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007f4c655c2000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f4c65280000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f4c66fc1000)
(sage-sh) dima@hilbert:sage-dev$ LD_LIBRARY_PATH=$SAGE_LOCAL/lib guile
guile: symbol lookup error: /usr/lib64/libguile-2.2.so.1: undefined symbol: GC_move_disappearing_link
```
as I created a link to the wrong libgc (see comment 9):

```
$ ls -l $SAGE_LOCAL/lib/libgc*
-rw-r--r-- 1 dima dima 946784 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.a
lrwxrwxrwx 1 dima dima     14 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.so -> libgc.so.1.0.3
lrwxrwxrwx 1 dima dima     14 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.so.1 -> libgc.so.1.0.3
-rwxr-xr-x 1 dima dima 702568 Dec 30 09:59 /home/dima/Sage/sage-dev/local/lib/libgc.so.1.0.3
lrwxrwxrwx 1 dima dima     10 Jan 20 22:54 /home/dima/Sage/sage-dev/local/lib/libgc.so.2 -> libgc.so.1
```
(libgc.so.1 is wrong (Sage's gc 7.2)) But make with guile works just fine:

```
$ LD_LIBRARY_PATH=$SAGE_LOCAL/lib /home/dima/bin/make -v
GNU Make 4.2.1
Built for x86_64-pc-linux-gnu
Copyright (C) 1988-2016 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
```
even though it is linked to the same libguile:

```
$ ldd /home/dima/bin/make 
	linux-vdso.so.1 (0x00007ffd2959e000)
	libguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007fb4e1418000)
	libgc.so.2 => /usr/lib64/libgc.so.2 (0x00007fb4e119f000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007fb4e0f9b000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007fb4e0d7b000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fb4e09b7000)
	libffi.so.6 => /usr/lib64/libffi.so.6 (0x00007fb4e07ae000)
	libunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007fb4e0435000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007fb4e01ac000)
	libltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007fb4dffa2000)
	libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007fb4dfd6a000)
	libm.so.6 => /lib64/libm.so.6 (0x00007fb4dfa28000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fb4e1769000)
```
just as a sanity check:

```
$ LD_LIBRARY_PATH=$SAGE_LOCAL/lib ldd /home/dima/bin/make 
	linux-vdso.so.1 (0x00007ffccbbfe000)
	libguile-2.2.so.1 => /usr/lib64/libguile-2.2.so.1 (0x00007ff033858000)
	libgc.so.2 => /home/dima/Sage/sage-dev/local/lib/libgc.so.2 (0x00007ff0334f9000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007ff0332f5000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007ff0330d5000)
	libc.so.6 => /lib64/libc.so.6 (0x00007ff032d11000)
	libffi.so.6 => /usr/lib64/libffi.so.6 (0x00007ff032b08000)
	libunistring.so.2 => /usr/lib64/libunistring.so.2 (0x00007ff03278f000)
	libgmp.so.10 => /usr/lib64/libgmp.so.10 (0x00007ff032506000)
	libltdl.so.7 => /usr/lib64/libltdl.so.7 (0x00007ff0322fc000)
	libcrypt.so.1 => /lib64/libcrypt.so.1 (0x00007ff0320c4000)
	libm.so.6 => /lib64/libm.so.6 (0x00007ff031d82000)
	/lib64/ld-linux-x86-64.so.2 (0x00007ff033ba9000)
```
So even though the link ought to be resolved by the linker, it is not done (I can also run actual building, not just `-v` with this setup).



---

archive/issue_comments_375025.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nJust wanted to confirm I'm experiencing the same problem on Arch. I have no more insights than you guys.\n\nHas Antonio Rojas popped up in the discussion yet? He might have already seen this error while packaging for Arch.",
    "created_at": "2018-02-20T14:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375025",
    "user": "https://github.com/defeo"
}
```

<a id='comment:30'>Comment 30:</a>
Just wanted to confirm I'm experiencing the same problem on Arch. I have no more insights than you guys.

Has Antonio Rojas popped up in the discussion yet? He might have already seen this error while packaging for Arch.



---

archive/issue_comments_375026.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nOne trivial way out is to upgrade our gc, see #23700",
    "created_at": "2018-02-20T15:02:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375026",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'>Comment 31:</a>
One trivial way out is to upgrade our gc, see #23700



---

archive/issue_comments_375027.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nReplying to [@defeo](#comment%3A30):\n> Just wanted to confirm I'm experiencing the same problem on Arch. I have no more insights than you guys.\n> \n> Has Antonio Rojas popped up in the discussion yet? He might have already seen this error while packaging for Arch.\n\nI think that Arch guys forgot to bump up the version of libgc, for it is still\nlibgc.so.1 (while on gentoo the same libgc is named libgc.so.2)\ncf comments 25 and 27 above.\n\nNote that Arch most probably uses system libgc in its build of Sage, as it's\nnot listed here https://www.archlinux.org/packages/community/x86_64/sagemath/",
    "created_at": "2018-02-20T16:22:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375027",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'>Comment 32:</a>
Replying to [@defeo](#comment%3A30):
> Just wanted to confirm I'm experiencing the same problem on Arch. I have no more insights than you guys.
> 
> Has Antonio Rojas popped up in the discussion yet? He might have already seen this error while packaging for Arch.

I think that Arch guys forgot to bump up the version of libgc, for it is still
libgc.so.1 (while on gentoo the same libgc is named libgc.so.2)
cf comments 25 and 27 above.

Note that Arch most probably uses system libgc in its build of Sage, as it's
not listed here https://www.archlinux.org/packages/community/x86_64/sagemath/



---

archive/issue_comments_375028.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nCould anyone who can reproduce this check whether #23000 fixes the problem?",
    "created_at": "2018-02-21T10:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375028",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'>Comment 33:</a>
Could anyone who can reproduce this check whether #23000 fixes the problem?



---

archive/issue_comments_375029.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\noops, typo, it should be\n\"Could anyone who can reproduce this check whether #23700 fixes the problem?\"",
    "created_at": "2018-02-21T10:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375029",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'>Comment 34:</a>
oops, typo, it should be
"Could anyone who can reproduce this check whether #23700 fixes the problem?"



---

archive/issue_comments_375030.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nI've [asked](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00013.html) on `bug-make@gnu.org` whether is this a GNU make bug.",
    "created_at": "2018-02-22T10:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375030",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'>Comment 35:</a>
I've [asked](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00013.html) on `bug-make@gnu.org` whether is this a GNU make bug.



---

archive/issue_comments_375031.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2018-02-22T10:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375031",
    "user": "https://github.com/dimpase"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_375032.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers deny it's a bug.**",
    "created_at": "2018-02-22T16:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375032",
    "user": "https://github.com/dimpase"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Reported upstream. Developers deny it's a bug.**



---

archive/issue_comments_375033.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nWell, I am not convinced, and am still waiting for an answer to [this](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00015.html).",
    "created_at": "2018-02-22T16:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375033",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'>Comment 36:</a>
Well, I am not convinced, and am still waiting for an answer to [this](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00015.html).



---

archive/issue_comments_375034.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nReplying to [@dimpase](#comment%3A36):\n> Well, I am not convinced, and am still waiting for an answer to [this](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00015.html).\n\nYour comment about maybe statically linking libguile makes some sense, but then you'd have to also statically link any of its dependencies as well, including libgc or else it wouldn't solve the problem.",
    "created_at": "2018-02-23T16:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375034",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'>Comment 37:</a>
Replying to [@dimpase](#comment%3A36):
> Well, I am not convinced, and am still waiting for an answer to [this](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00015.html).

Your comment about maybe statically linking libguile makes some sense, but then you'd have to also statically link any of its dependencies as well, including libgc or else it wouldn't solve the problem.



---

archive/issue_comments_375035.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nReplying to [@embray](#comment%3A37):\n> Replying to [@dimpase](#comment%3A36):\n> > Well, I am not convinced, and am still waiting for an answer to [this](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00015.html).\n\n> \n> Your comment about maybe statically linking libguile makes some sense, but then you'd have to also statically link any of its dependencies as well, including libgc or else it wouldn't solve the problem.\n\nThey could also load the Guile extension only if they need it.\n(And/or have a configuration option of turning it off).",
    "created_at": "2018-02-23T16:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375035",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:38'>Comment 38:</a>
Replying to [@embray](#comment%3A37):
> Replying to [@dimpase](#comment%3A36):
> > Well, I am not convinced, and am still waiting for an answer to [this](http://lists.gnu.org/archive/html/bug-make/2018-02/msg00015.html).

> 
> Your comment about maybe statically linking libguile makes some sense, but then you'd have to also statically link any of its dependencies as well, including libgc or else it wouldn't solve the problem.

They could also load the Guile extension only if they need it.
(And/or have a configuration option of turning it off).



---

archive/issue_comments_375036.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThat would make sense too.\n\nAnyways, I'm increasingly convinced that the problem here is in the affected distros.  I'm gonna try an Arch VM and see if I can reproduce...",
    "created_at": "2018-02-23T16:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375036",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'>Comment 39:</a>
That would make sense too.

Anyways, I'm increasingly convinced that the problem here is in the affected distros.  I'm gonna try an Arch VM and see if I can reproduce...



---

archive/issue_comments_375037.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nReplying to [@dimpase](#comment%3A34):\n> oops, typo, it should be\n> \"Could anyone who can reproduce this check whether #23700 fixes the problem?\"\n\nNot for me.\n\n1. I checked out the ticket and ran `make`. Same failure.\n\n2. I ran `make distclean`, the `make` again. I got this failure:\n\n```\n[patch-2.7.5] Using cached file /home/defeo/sage/upstream/patch-2.7.5.tar.gz\n[patch-2.7.5] patch-2.7.5\n[patch-2.7.5] ====================================================\n[patch-2.7.5] Setting up build directory for patch-2.7.5\n[patch-2.7.5] Traceback (most recent call last):\n[patch-2.7.5]   File \"/home/defeo/sage/build/bin/sage-uncompress-spkg\", line 23, in <module>\n[patch-2.7.5]     run()\n[patch-2.7.5]   File \"/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/cmdline.py\", line 72, in run\n[patch-2.7.5]     unpack_archive(archive, dirname)\n[patch-2.7.5]   File \"/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/action.py\", line 68, in unpack_archive\n[patch-2.7.5]     archive.extractall(members=archive.names)\n[patch-2.7.5]   File \"/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py\", line 90, in extractall\n[patch-2.7.5]     members=members)\n[patch-2.7.5]   File \"/usr/lib/python3.6/tarfile.py\", line 2007, in extractall\n[patch-2.7.5]     numeric_owner=numeric_owner)\n[patch-2.7.5]   File \"/usr/lib/python3.6/tarfile.py\", line 2049, in extract\n[patch-2.7.5]     numeric_owner=numeric_owner)\n[patch-2.7.5] TypeError: _extract_member() got an unexpected keyword argument 'set_attrs'\n[patch-2.7.5] ************************************************************************\n[patch-2.7.5] Error: failed to extract /home/defeo/sage/upstream/patch-2.7.5.tar.gz\n[patch-2.7.5] ************************************************************************\n```",
    "created_at": "2018-02-23T18:17:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375037",
    "user": "https://github.com/defeo"
}
```

<a id='comment:40'>Comment 40:</a>
Replying to [@dimpase](#comment%3A34):
> oops, typo, it should be
> "Could anyone who can reproduce this check whether #23700 fixes the problem?"

Not for me.

1. I checked out the ticket and ran `make`. Same failure.

2. I ran `make distclean`, the `make` again. I got this failure:

```
[patch-2.7.5] Using cached file /home/defeo/sage/upstream/patch-2.7.5.tar.gz
[patch-2.7.5] patch-2.7.5
[patch-2.7.5] ====================================================
[patch-2.7.5] Setting up build directory for patch-2.7.5
[patch-2.7.5] Traceback (most recent call last):
[patch-2.7.5]   File "/home/defeo/sage/build/bin/sage-uncompress-spkg", line 23, in <module>
[patch-2.7.5]     run()
[patch-2.7.5]   File "/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/cmdline.py", line 72, in run
[patch-2.7.5]     unpack_archive(archive, dirname)
[patch-2.7.5]   File "/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/action.py", line 68, in unpack_archive
[patch-2.7.5]     archive.extractall(members=archive.names)
[patch-2.7.5]   File "/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py", line 90, in extractall
[patch-2.7.5]     members=members)
[patch-2.7.5]   File "/usr/lib/python3.6/tarfile.py", line 2007, in extractall
[patch-2.7.5]     numeric_owner=numeric_owner)
[patch-2.7.5]   File "/usr/lib/python3.6/tarfile.py", line 2049, in extract
[patch-2.7.5]     numeric_owner=numeric_owner)
[patch-2.7.5] TypeError: _extract_member() got an unexpected keyword argument 'set_attrs'
[patch-2.7.5] ************************************************************************
[patch-2.7.5] Error: failed to extract /home/defeo/sage/upstream/patch-2.7.5.tar.gz
[patch-2.7.5] ************************************************************************
```



---

archive/issue_comments_375038.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\na duplicate comment, sorry.",
    "created_at": "2018-02-23T18:47:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375038",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'>Comment 41:</a>
a duplicate comment, sorry.



---

archive/issue_comments_375039.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nReplying to [@defeo](#comment%3A40):\n> Replying to [@dimpase](#comment%3A34):\n> > oops, typo, it should be\n> > \"Could anyone who can reproduce this check whether #23700 fixes the problem?\"\n\n> \n> Not for me.\n> \n> 1. I checked out the ticket and ran `make`. Same failure.\n> \n> 2. I ran `make distclean`, the `make` again. I got this failure:\n> \n> ```\n> [patch-2.7.5] Using cached file /home/defeo/sage/upstream/patch-2.7.5.tar.gz\n> [patch-2.7.5] patch-2.7.5\n> [patch-2.7.5] ====================================================\n> [patch-2.7.5] Setting up build directory for patch-2.7.5\n> [patch-2.7.5] Traceback (most recent call last):\n> [patch-2.7.5]   File \"/home/defeo/sage/build/bin/sage-uncompress-spkg\", line 23, in <module>\n> [patch-2.7.5]     run()\n> [patch-2.7.5]   File \"/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/cmdline.py\", line 72, in run\n> [patch-2.7.5]     unpack_archive(archive, dirname)\n> [patch-2.7.5]   File \"/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/action.py\", line 68, in unpack_archive\n> [patch-2.7.5]     archive.extractall(members=archive.names)\n> [patch-2.7.5]   File \"/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py\", line 90, in extractall\n> [patch-2.7.5]     members=members)\n> [patch-2.7.5]   File \"/usr/lib/python3.6/tarfile.py\", line 2007, in extractall\n> [patch-2.7.5]     numeric_owner=numeric_owner)\n> [patch-2.7.5]   File \"/usr/lib/python3.6/tarfile.py\", line 2049, in extract\n> [patch-2.7.5]     numeric_owner=numeric_owner)\n> [patch-2.7.5] TypeError: _extract_member() got an unexpected keyword argument 'set_attrs'\n> [patch-2.7.5] ************************************************************************\n> [patch-2.7.5] Error: failed to extract /home/defeo/sage/upstream/patch-2.7.5.tar.gz\n> [patch-2.7.5] ************************************************************************\n> ```\n\nthis looks like system's Python is nuked too. Do you have funky stuff in your LD_LIBRARY_PATH or in PATH? Nothing to do with gc, that's certain.",
    "created_at": "2018-02-23T18:51:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375039",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'>Comment 42:</a>
Replying to [@defeo](#comment%3A40):
> Replying to [@dimpase](#comment%3A34):
> > oops, typo, it should be
> > "Could anyone who can reproduce this check whether #23700 fixes the problem?"

> 
> Not for me.
> 
> 1. I checked out the ticket and ran `make`. Same failure.
> 
> 2. I ran `make distclean`, the `make` again. I got this failure:
> 
> ```
> [patch-2.7.5] Using cached file /home/defeo/sage/upstream/patch-2.7.5.tar.gz
> [patch-2.7.5] patch-2.7.5
> [patch-2.7.5] ====================================================
> [patch-2.7.5] Setting up build directory for patch-2.7.5
> [patch-2.7.5] Traceback (most recent call last):
> [patch-2.7.5]   File "/home/defeo/sage/build/bin/sage-uncompress-spkg", line 23, in <module>
> [patch-2.7.5]     run()
> [patch-2.7.5]   File "/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/cmdline.py", line 72, in run
> [patch-2.7.5]     unpack_archive(archive, dirname)
> [patch-2.7.5]   File "/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/action.py", line 68, in unpack_archive
> [patch-2.7.5]     archive.extractall(members=archive.names)
> [patch-2.7.5]   File "/home/defeo/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py", line 90, in extractall
> [patch-2.7.5]     members=members)
> [patch-2.7.5]   File "/usr/lib/python3.6/tarfile.py", line 2007, in extractall
> [patch-2.7.5]     numeric_owner=numeric_owner)
> [patch-2.7.5]   File "/usr/lib/python3.6/tarfile.py", line 2049, in extract
> [patch-2.7.5]     numeric_owner=numeric_owner)
> [patch-2.7.5] TypeError: _extract_member() got an unexpected keyword argument 'set_attrs'
> [patch-2.7.5] ************************************************************************
> [patch-2.7.5] Error: failed to extract /home/defeo/sage/upstream/patch-2.7.5.tar.gz
> [patch-2.7.5] ************************************************************************
> ```

this looks like system's Python is nuked too. Do you have funky stuff in your LD_LIBRARY_PATH or in PATH? Nothing to do with gc, that's certain.



---

archive/issue_comments_375040.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nOr perhaps it's simply due to your `python` being `python3` (or a very new `python3`, which has not been tested...)",
    "created_at": "2018-02-23T18:59:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375040",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'>Comment 43:</a>
Or perhaps it's simply due to your `python` being `python3` (or a very new `python3`, which has not been tested...)



---

archive/issue_comments_375041.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nyep, I have this error if I set my system Python to python3.5, too.\n\nThus, set python to python2, and repeat please.",
    "created_at": "2018-02-23T19:33:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375041",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:44'>Comment 44:</a>
yep, I have this error if I set my system Python to python3.5, too.

Thus, set python to python2, and repeat please.



---

archive/issue_comments_375042.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nReplying to [@dimpase](#comment%3A44):\n> yep, I have this error if I set my system Python to python3.5, too.\n> \n> Thus, set python to python2, and repeat please.\n\nThis tar_file py3 problem is now #24830 (which has nothing to do with the current ticket)",
    "created_at": "2018-02-23T23:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375042",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'>Comment 45:</a>
Replying to [@dimpase](#comment%3A44):
> yep, I have this error if I set my system Python to python3.5, too.
> 
> Thus, set python to python2, and repeat please.

This tar_file py3 problem is now #24830 (which has nothing to do with the current ticket)



---

archive/issue_comments_375043.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nOk, it compiled with Python2. Now, it might be thanks to #23700, or thanks to Python2... who knows? :)",
    "created_at": "2018-02-24T00:57:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375043",
    "user": "https://github.com/defeo"
}
```

<a id='comment:46'>Comment 46:</a>
Ok, it compiled with Python2. Now, it might be thanks to #23700, or thanks to Python2... who knows? :)



---

archive/issue_events_310721.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-02-24T07:49:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310721"
}
```



---

archive/issue_comments_375044.json:
```json
{
    "body": "Dependencies: **#23700**",
    "created_at": "2018-02-24T07:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375044",
    "user": "https://github.com/dimpase"
}
```

Dependencies: **#23700**



---

archive/issue_comments_375045.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\n#23700 is reported to fix this issue. \n\n(As well as using a guile-less make, I presume.)",
    "created_at": "2018-02-24T07:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375045",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'>Comment 47:</a>
#23700 is reported to fix this issue. 

(As well as using a guile-less make, I presume.)



---

archive/issue_comments_375046.json:
```json
{
    "body": "<a id='comment:48'>Comment 48:</a>\nNeat, I was able to reproduce this in an Arch Linux Docker image.  So at least there's that.",
    "created_at": "2018-02-28T14:14:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375046",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'>Comment 48:</a>
Neat, I was able to reproduce this in an Arch Linux Docker image.  So at least there's that.



---

archive/issue_comments_375047.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nDoes #23700 cure it?",
    "created_at": "2018-02-28T14:27:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375047",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:49'>Comment 49:</a>
Does #23700 cure it?



---

archive/issue_comments_375048.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nI haven't tried. But a workaround that did work was to add `LD_PRELOAD=/usr/bin/libgc.so`.  So a full workaround might look something like:\n\n```bash\nif [ \"$UNAME\" = \"Linux\" ]; then\n    LIBGC=\"$(ldd $(which make) | sed -n 's/\\s*libgc\\.so.* => \\(.\\+\\) .*/\\1/p')\"\n    if [ -n \"$LIBGC\" ]; then\n        export LD_PRELOAD=\"$LIBGC\"\n    fi\nfi\n```\n\nThis finds the `libgc` that is needed by `libguile` (and by extension `make`) and ensures it's the one that's used, not the one from Sage.  Sucks, but it works, and is kind of necessary.\n\nA similar `LD_PRELOAD` trick might be able to solve #24605 as well, but I haven't tested that yet.",
    "created_at": "2018-02-28T15:20:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375048",
    "user": "https://github.com/embray"
}
```

<a id='comment:50'>Comment 50:</a>
I haven't tried. But a workaround that did work was to add `LD_PRELOAD=/usr/bin/libgc.so`.  So a full workaround might look something like:

```bash
if [ "$UNAME" = "Linux" ]; then
    LIBGC="$(ldd $(which make) | sed -n 's/\s*libgc\.so.* => \(.\+\) .*/\1/p')"
    if [ -n "$LIBGC" ]; then
        export LD_PRELOAD="$LIBGC"
    fi
fi
```

This finds the `libgc` that is needed by `libguile` (and by extension `make`) and ensures it's the one that's used, not the one from Sage.  Sucks, but it works, and is kind of necessary.

A similar `LD_PRELOAD` trick might be able to solve #24605 as well, but I haven't tested that yet.



---

archive/issue_comments_375049.json:
```json
{
    "body": "Branch: **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)**",
    "created_at": "2018-03-02T10:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375049",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)**



---

archive/issue_comments_375050.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2018-03-02T10:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375050",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_375051.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nI've gone ahead and added my workaround.  I would recommend using this even with #23700, just because really we should always be using the `libgc` from the system when invoking `make` (where applicable), even if the `libgc` in Sage happens, by some luck, to be compatible with the system's version.\n\nIn principle this workaround is needed for any build process that adds `$SAGE_LOCAL/lib` to `$LD_LIBRARY_PATH`.  In general this should not be done at all, but there is at least one other case I know of in Sage: python.  So this might also be worth extracting into a helper function for pre-loading certain libraries when needed...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/71c63fd0d9043a134568ad2a018f65c69888c52a\">71c63fd</a></td><td><code>Add the workaround to #24575</code></td></tr></table>\n",
    "created_at": "2018-03-02T10:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375051",
    "user": "https://github.com/embray"
}
```

<a id='comment:51'>Comment 51:</a>
I've gone ahead and added my workaround.  I would recommend using this even with #23700, just because really we should always be using the `libgc` from the system when invoking `make` (where applicable), even if the `libgc` in Sage happens, by some luck, to be compatible with the system's version.

In principle this workaround is needed for any build process that adds `$SAGE_LOCAL/lib` to `$LD_LIBRARY_PATH`.  In general this should not be done at all, but there is at least one other case I know of in Sage: python.  So this might also be worth extracting into a helper function for pre-loading certain libraries when needed...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/71c63fd0d9043a134568ad2a018f65c69888c52a">71c63fd</a></td><td><code>Add the workaround to #24575</code></td></tr></table>




---

archive/issue_comments_375052.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2018-03-02T10:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375052",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_375053.json:
```json
{
    "body": "Commit: **[71c63fd](https://github.com/sagemath/sagetrac-mirror/commit/71c63fd0d9043a134568ad2a018f65c69888c52a)**",
    "created_at": "2018-03-02T10:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375053",
    "user": "https://github.com/embray"
}
```

Commit: **[71c63fd](https://github.com/sagemath/sagetrac-mirror/commit/71c63fd0d9043a134568ad2a018f65c69888c52a)**



---

archive/issue_comments_375054.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nReplying to [@embray](#comment%3A51):\n> I've gone ahead and added my workaround.  I would recommend using this even with #23700, just because really we should always be using the `libgc` from the system when invoking `make` (where applicable), even if the `libgc` in Sage happens, by some luck, to be compatible with the system's version.\n> \n> In principle this workaround is needed for any build process that adds `$SAGE_LOCAL/lib` to `$LD_LIBRARY_PATH`.  In general this should not be done at all, but there is at least one other case I know of in Sage: python.  So this might also be worth extracting into a helper function for pre-loading certain libraries when needed...\n\nThanks Erik for analyzing the problem and providing the workaround! I definitely did not want to consider #23700 as a solution. (I am now compiling from scratch for checking)\n\nNote that your fix is focused towards libgc so that the same kind of trouble might appear with another library in the future. But I consider this as fine for now. Wouldn't it be possible to exclude libgc from the list of packages to install when already present (and up to date) on the system?",
    "created_at": "2018-03-04T09:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375054",
    "user": "https://github.com/videlec"
}
```

<a id='comment:52'>Comment 52:</a>
Replying to [@embray](#comment%3A51):
> I've gone ahead and added my workaround.  I would recommend using this even with #23700, just because really we should always be using the `libgc` from the system when invoking `make` (where applicable), even if the `libgc` in Sage happens, by some luck, to be compatible with the system's version.
> 
> In principle this workaround is needed for any build process that adds `$SAGE_LOCAL/lib` to `$LD_LIBRARY_PATH`.  In general this should not be done at all, but there is at least one other case I know of in Sage: python.  So this might also be worth extracting into a helper function for pre-loading certain libraries when needed...

Thanks Erik for analyzing the problem and providing the workaround! I definitely did not want to consider #23700 as a solution. (I am now compiling from scratch for checking)

Note that your fix is focused towards libgc so that the same kind of trouble might appear with another library in the future. But I consider this as fine for now. Wouldn't it be possible to exclude libgc from the list of packages to install when already present (and up to date) on the system?



---

archive/issue_comments_375055.json:
```json
{
    "body": "Changed dependencies from **#23700** to none",
    "created_at": "2018-03-04T09:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375055",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#23700** to none



---

archive/issue_comments_375056.json:
```json
{
    "body": "Attachment: **[flint-2.5.2.p2.log](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2.p2.log)**",
    "created_at": "2018-03-04T10:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375056",
    "user": "https://github.com/videlec"
}
```

Attachment: **[flint-2.5.2.p2.log](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2.p2.log)**



---

archive/issue_comments_375057.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nflint build is failing (for the same reason as R did), see [attachment: flint-2.5.2.p2.log](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2.p2.log). Should we apply the same strategy here?",
    "created_at": "2018-03-04T10:25:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375057",
    "user": "https://github.com/videlec"
}
```

<a id='comment:53'>Comment 53:</a>
flint build is failing (for the same reason as R did), see [attachment: flint-2.5.2.p2.log](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2.p2.log). Should we apply the same strategy here?



---

archive/issue_comments_375058.json:
```json
{
    "body": "Attachment: **[rpy2-2.8.2.p0.log](https://github.com/sagemath/sage/files/ticket24575/rpy2-2.8.2.p0.log)**",
    "created_at": "2018-03-04T11:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375058",
    "user": "https://github.com/videlec"
}
```

Attachment: **[rpy2-2.8.2.p0.log](https://github.com/sagemath/sage/files/ticket24575/rpy2-2.8.2.p0.log)**



---

archive/issue_comments_375059.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nReplying to [@videlec](#comment%3A53):\n> flint build is failing (for the same reason as R did), see [attachment: flint-2.5.2.p2.log](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2.p2.log). Should we apply the same strategy here?\n\nSame also with arb and the Python package ryp2 ([attachment: rpy2-2.8.2.p0.log](https://github.com/sagemath/sage/files/ticket24575/rpy2-2.8.2.p0.log)). After adding the workaround to the three spkg-install the build completes.\n\nThough I did not check the optional packages.",
    "created_at": "2018-03-04T11:07:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375059",
    "user": "https://github.com/videlec"
}
```

<a id='comment:54'>Comment 54:</a>
Replying to [@videlec](#comment%3A53):
> flint build is failing (for the same reason as R did), see [attachment: flint-2.5.2.p2.log](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2.p2.log). Should we apply the same strategy here?

Same also with arb and the Python package ryp2 ([attachment: rpy2-2.8.2.p0.log](https://github.com/sagemath/sage/files/ticket24575/rpy2-2.8.2.p0.log)). After adding the workaround to the three spkg-install the build completes.

Though I did not check the optional packages.



---

archive/issue_comments_375060.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f33c5e60c6655d2af7d97047dcba996600f37193\">f33c5e6</a></td><td><code>Same workaround for arb, flint and rpy2</code></td></tr></table>\n",
    "created_at": "2018-03-04T11:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375060",
    "user": "https://github.com/videlec"
}
```

<a id='comment:55'>Comment 55:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f33c5e60c6655d2af7d97047dcba996600f37193">f33c5e6</a></td><td><code>Same workaround for arb, flint and rpy2</code></td></tr></table>




---

archive/issue_comments_375061.json:
```json
{
    "body": "Changed branch from **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)** to **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575)**",
    "created_at": "2018-03-04T11:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375061",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)** to **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575)**



---

archive/issue_comments_375062.json:
```json
{
    "body": "Changed commit from **[71c63fd](https://github.com/sagemath/sagetrac-mirror/commit/71c63fd0d9043a134568ad2a018f65c69888c52a)** to **[f33c5e6](https://github.com/sagemath/sagetrac-mirror/commit/f33c5e60c6655d2af7d97047dcba996600f37193)**",
    "created_at": "2018-03-04T11:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375062",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[71c63fd](https://github.com/sagemath/sagetrac-mirror/commit/71c63fd0d9043a134568ad2a018f65c69888c52a)** to **[f33c5e6](https://github.com/sagemath/sagetrac-mirror/commit/f33c5e60c6655d2af7d97047dcba996600f37193)**



---

archive/issue_comments_375063.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,15 @@\n-Sage has a standard package `gc` which is also available for most operating system. The library creates conflicts with programs that are prerequisite to build Sage such as make.\n-\n-For example, building Sage 8.2.beta3 on archlinux one gets\n+Sage has a standard package `gc` that creates conflicts with programs that are prerequisite to build Sage such as make. For example, building Sage 8.2.beta3 on archlinux one gets\n \n ```\n make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \n GC_move_disappearing_link\n ```\n-After deactivating the `gc` package, the compilation went fine on this machine.\n+See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).\n \n-See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).\n+After deactivating the `gc` package, the compilation went fine.\n+\n+The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to 4 standard packages:\n+- R\n+- rpy2\n+- flint\n+- arb\n``````\n",
    "created_at": "2018-03-04T11:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375063",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,15 @@
-Sage has a standard package `gc` which is also available for most operating system. The library creates conflicts with programs that are prerequisite to build Sage such as make.
-
-For example, building Sage 8.2.beta3 on archlinux one gets
+Sage has a standard package `gc` that creates conflicts with programs that are prerequisite to build Sage such as make. For example, building Sage 8.2.beta3 on archlinux one gets
 
 ```
 make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
 GC_move_disappearing_link
 ```
-After deactivating the `gc` package, the compilation went fine on this machine.
+See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).
 
-See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).
+After deactivating the `gc` package, the compilation went fine.
+
+The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to 4 standard packages:
+- R
+- rpy2
+- flint
+- arb
``````




---

archive/issue_events_310722.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-03-04T13:49:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310722"
}
```



---

archive/issue_events_310723.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-03-04T13:49:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310723"
}
```



---

archive/issue_comments_375064.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nShouldn't we do the `LD_PRELOAD` in the script that calls `spkg-install`, rather than \nrepeat this boilerplate? (And the same for `spkg-check`, by the way).\n\nThis would also take care of all the non-standard packages.",
    "created_at": "2018-03-04T13:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375064",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:57'>Comment 57:</a>
Shouldn't we do the `LD_PRELOAD` in the script that calls `spkg-install`, rather than 
repeat this boilerplate? (And the same for `spkg-check`, by the way).

This would also take care of all the non-standard packages.



---

archive/issue_comments_375065.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nReplying to [@dimpase](#comment%3A57):\n> Shouldn't we do the `LD_PRELOAD` in the script that calls `spkg-install`, rather than \n> repeat this boilerplate? (And the same for `spkg-check`, by the way).\n\n>\n> This would also take care of all the non-standard packages.\n\nI don't think so. This workaround takes care of fragile makefiles until a better solution is found. Having it globally applied would be a nightmare for debugging as well as upstream communication. It is also likely that the workarounds will be removed one by one.",
    "created_at": "2018-03-04T22:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375065",
    "user": "https://github.com/videlec"
}
```

<a id='comment:58'>Comment 58:</a>
Replying to [@dimpase](#comment%3A57):
> Shouldn't we do the `LD_PRELOAD` in the script that calls `spkg-install`, rather than 
> repeat this boilerplate? (And the same for `spkg-check`, by the way).

>
> This would also take care of all the non-standard packages.

I don't think so. This workaround takes care of fragile makefiles until a better solution is found. Having it globally applied would be a nightmare for debugging as well as upstream communication. It is also likely that the workarounds will be removed one by one.



---

archive/issue_comments_375066.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nReplying to [@videlec](#comment%3A58):\n> Replying to [@dimpase](#comment%3A57):\n> > Shouldn't we do the `LD_PRELOAD` in the script that calls `spkg-install`, rather than \n> > repeat this boilerplate? (And the same for `spkg-check`, by the way).\n\n> >\n> > This would also take care of all the non-standard packages.\n\n> \n> I don't think so. This workaround takes care of fragile makefiles until a better solution is found.\n\nA better solution is not to use Guile-enabled make, at least not until it is built in a way ensuring one can use it for hacking on Guile dependencies.\n\n>Having it globally applied would be a nightmare for debugging as well as upstream communication. It is also likely that the workarounds will be removed one by one.\n\nThere is nothing to communicate to package upstream here, I think. You cannot ban their use of LD_LIBRARY_FLAGS. Then, the LD_PRELOAD is a pretty standard way to deal with these issues. It has cured so far all these issues, why do you want to keep getting reports on such and such package mysteriously breaking while Guile-enabled make is used.",
    "created_at": "2018-03-04T22:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375066",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:59'>Comment 59:</a>
Replying to [@videlec](#comment%3A58):
> Replying to [@dimpase](#comment%3A57):
> > Shouldn't we do the `LD_PRELOAD` in the script that calls `spkg-install`, rather than 
> > repeat this boilerplate? (And the same for `spkg-check`, by the way).

> >
> > This would also take care of all the non-standard packages.

> 
> I don't think so. This workaround takes care of fragile makefiles until a better solution is found.

A better solution is not to use Guile-enabled make, at least not until it is built in a way ensuring one can use it for hacking on Guile dependencies.

>Having it globally applied would be a nightmare for debugging as well as upstream communication. It is also likely that the workarounds will be removed one by one.

There is nothing to communicate to package upstream here, I think. You cannot ban their use of LD_LIBRARY_FLAGS. Then, the LD_PRELOAD is a pretty standard way to deal with these issues. It has cured so far all these issues, why do you want to keep getting reports on such and such package mysteriously breaking while Guile-enabled make is used.



---

archive/issue_comments_375067.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nI agree with Vincent here. This workaround should only be used for the known packages with an LD_LIBRARY_PATH problem, and this should be reported as a bug upstream. \n\nFLINT seems to be getting a CMake build system to replace its handwritten one, which will likely eliminate this problem.",
    "created_at": "2018-03-05T03:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375067",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'>Comment 60:</a>
I agree with Vincent here. This workaround should only be used for the known packages with an LD_LIBRARY_PATH problem, and this should be reported as a bug upstream. 

FLINT seems to be getting a CMake build system to replace its handwritten one, which will likely eliminate this problem.



---

archive/issue_comments_375068.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nOver in #24885 I already implemented a more generic solution for this, but I didn't push the branch yet.  That should be used instead.",
    "created_at": "2018-03-05T10:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375068",
    "user": "https://github.com/embray"
}
```

<a id='comment:61'>Comment 61:</a>
Over in #24885 I already implemented a more generic solution for this, but I didn't push the branch yet.  That should be used instead.



---

archive/issue_comments_375069.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nReplying to [@mkoeppe](#comment%3A60):\n> I agree with Vincent here. This workaround should only be used for the known packages with an LD_LIBRARY_PATH problem, and this should be reported as a bug upstream. \n\nThe fact that they use `LD_LIBRARY_PATH` is not a bug IMO, though it would be better, at least in some cases, if they used `LD_PRELOAD` instead for *specific* libraries.",
    "created_at": "2018-03-05T10:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375069",
    "user": "https://github.com/embray"
}
```

<a id='comment:62'>Comment 62:</a>
Replying to [@mkoeppe](#comment%3A60):
> I agree with Vincent here. This workaround should only be used for the known packages with an LD_LIBRARY_PATH problem, and this should be reported as a bug upstream. 

The fact that they use `LD_LIBRARY_PATH` is not a bug IMO, though it would be better, at least in some cases, if they used `LD_PRELOAD` instead for *specific* libraries.



---

archive/issue_comments_375070.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nReworked on top of #24885\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba1b5ee8075c0a03883a42003d19f08983e4e9be\">ba1b5ee</a></td><td><code>Add helper function that implements the workaround from #24575 more generically.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6103df0760a52965e1e4a0b7a430ddc92a8e9ba4\">6103df0</a></td><td><code>Add the workaround to #24575</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ecaa74880298d5496d9a1e3f27dfed629755682\">2ecaa74</a></td><td><code>Replace this with sdh_preload_lib</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/454221ac40ec282c469ff2043465811b7364313b\">454221a</a></td><td><code>Same issue applies to arb, flint, and rpy2</code></td></tr></table>\n",
    "created_at": "2018-03-05T10:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375070",
    "user": "https://github.com/embray"
}
```

<a id='comment:63'>Comment 63:</a>
Reworked on top of #24885

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba1b5ee8075c0a03883a42003d19f08983e4e9be">ba1b5ee</a></td><td><code>Add helper function that implements the workaround from #24575 more generically.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6103df0760a52965e1e4a0b7a430ddc92a8e9ba4">6103df0</a></td><td><code>Add the workaround to #24575</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ecaa74880298d5496d9a1e3f27dfed629755682">2ecaa74</a></td><td><code>Replace this with sdh_preload_lib</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/454221ac40ec282c469ff2043465811b7364313b">454221a</a></td><td><code>Same issue applies to arb, flint, and rpy2</code></td></tr></table>




---

archive/issue_comments_375071.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575)** to **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)**",
    "created_at": "2018-03-05T10:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375071",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575)** to **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)**



---

archive/issue_comments_375072.json:
```json
{
    "body": "Dependencies: **#24885**",
    "created_at": "2018-03-05T10:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375072",
    "user": "https://github.com/embray"
}
```

Dependencies: **#24885**



---

archive/issue_comments_375073.json:
```json
{
    "body": "Changed commit from **[f33c5e6](https://github.com/sagemath/sagetrac-mirror/commit/f33c5e60c6655d2af7d97047dcba996600f37193)** to **[454221a](https://github.com/sagemath/sagetrac-mirror/commit/454221ac40ec282c469ff2043465811b7364313b)**",
    "created_at": "2018-03-05T10:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375073",
    "user": "https://github.com/embray"
}
```

Changed commit from **[f33c5e6](https://github.com/sagemath/sagetrac-mirror/commit/f33c5e60c6655d2af7d97047dcba996600f37193)** to **[454221a](https://github.com/sagemath/sagetrac-mirror/commit/454221ac40ec282c469ff2043465811b7364313b)**



---

archive/issue_events_310724.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-05T10:50:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310724"
}
```



---

archive/issue_events_310725.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-05T10:50:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310725"
}
```



---

archive/issue_comments_375074.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nI am currently testing optional tickets, at least `deformation` has the same symptoms (I will provide a proper commit with all of them once finished).",
    "created_at": "2018-03-05T16:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375074",
    "user": "https://github.com/videlec"
}
```

<a id='comment:65'>Comment 65:</a>
I am currently testing optional tickets, at least `deformation` has the same symptoms (I will provide a proper commit with all of them once finished).



---

archive/issue_events_310726.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-03-05T16:06:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310726"
}
```



---

archive/issue_events_310727.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-03-05T16:06:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310727"
}
```



---

archive/issue_comments_375075.json:
```json
{
    "body": "Changed reviewer from **Erik Bray** to **Erik Bray, Vincent Delecroix**",
    "created_at": "2018-03-05T16:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375075",
    "user": "https://github.com/videlec"
}
```

Changed reviewer from **Erik Bray** to **Erik Bray, Vincent Delecroix**



---

archive/issue_comments_375076.json:
```json
{
    "body": "<a id='comment:66'>Comment 66:</a>\nAll right, for `deformation`, after setting the `sdh_preload_lib` I got a different error that is unrelated\n\n```\n[deformation-d05941b]     CC   ../build/perm/../perm.lo\n[deformation-d05941b] /usr/bin/ld: -r and -pie may not be used together\n[deformation-d05941b] collect2: error: ld returned 1 exit status\n[deformation-d05941b] make[4]: *** [../Makefile.subdirs:55: ../build/perm/../perm.lo] Error 1\n```",
    "created_at": "2018-03-05T16:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375076",
    "user": "https://github.com/videlec"
}
```

<a id='comment:66'>Comment 66:</a>
All right, for `deformation`, after setting the `sdh_preload_lib` I got a different error that is unrelated

```
[deformation-d05941b]     CC   ../build/perm/../perm.lo
[deformation-d05941b] /usr/bin/ld: -r and -pie may not be used together
[deformation-d05941b] collect2: error: ld returned 1 exit status
[deformation-d05941b] make[4]: *** [../Makefile.subdirs:55: ../build/perm/../perm.lo] Error 1
```



---

archive/issue_comments_375077.json:
```json
{
    "body": "Changed commit from **[454221a](https://github.com/sagemath/sagetrac-mirror/commit/454221ac40ec282c469ff2043465811b7364313b)** to **[1ac3afa](https://github.com/sagemath/sagetrac-mirror/commit/1ac3afaefe81fb21c43be7964c07f7cd7d529cb9)**",
    "created_at": "2018-03-05T16:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375077",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[454221a](https://github.com/sagemath/sagetrac-mirror/commit/454221ac40ec282c469ff2043465811b7364313b)** to **[1ac3afa](https://github.com/sagemath/sagetrac-mirror/commit/1ac3afaefe81fb21c43be7964c07f7cd7d529cb9)**



---

archive/issue_comments_375078.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nConcerning optional packages, only deformation needs the workaround (It appears that I also have some unrelated build failures #23533, #24901, #24902 and #24903).\n\nErik, Dima, Matthias: I am considering the branch as ready to be positively reviewed. As I added a commit on top of the branch I let somebody else finishing the review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ac3afaefe81fb21c43be7964c07f7cd7d529cb9\">1ac3afa</a></td><td><code>Same issue applies to optional package deformation</code></td></tr></table>\n",
    "created_at": "2018-03-05T16:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375078",
    "user": "https://github.com/videlec"
}
```

<a id='comment:67'>Comment 67:</a>
Concerning optional packages, only deformation needs the workaround (It appears that I also have some unrelated build failures #23533, #24901, #24902 and #24903).

Erik, Dima, Matthias: I am considering the branch as ready to be positively reviewed. As I added a commit on top of the branch I let somebody else finishing the review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ac3afaefe81fb21c43be7964c07f7cd7d529cb9">1ac3afa</a></td><td><code>Same issue applies to optional package deformation</code></td></tr></table>




---

archive/issue_comments_375079.json:
```json
{
    "body": "Changed branch from **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)** to **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575)**",
    "created_at": "2018-03-05T16:57:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375079",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/embray/build/ticket-24575](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-24575)** to **[u/vdelecroix/24575](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/24575)**



---

archive/issue_events_310728.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-03-05T16:57:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310728"
}
```



---

archive/issue_events_310729.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-03-05T16:57:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310729"
}
```



---

archive/issue_comments_375080.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nOur package `perl_term_readline_gnu` also has some LD_LIBRARY_PATH stuff...",
    "created_at": "2018-03-05T20:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375080",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'>Comment 69:</a>
Our package `perl_term_readline_gnu` also has some LD_LIBRARY_PATH stuff...



---

archive/issue_comments_375081.json:
```json
{
    "body": "<a id='comment:70'>Comment 70:</a>\nI think it's better to patch out this LD_LIBRARY_PATH stuff from the packages' Makefiles. \nLike this: https://github.com/mkoeppe/deformation/commit/0d732b13e901b777aca000ff502a5d5aa8d690bf",
    "created_at": "2018-03-05T20:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375081",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'>Comment 70:</a>
I think it's better to patch out this LD_LIBRARY_PATH stuff from the packages' Makefiles. 
Like this: https://github.com/mkoeppe/deformation/commit/0d732b13e901b777aca000ff502a5d5aa8d690bf



---

archive/issue_comments_375082.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nReplying to [@mkoeppe](#comment%3A70):\n> I think it's better to patch out this LD_LIBRARY_PATH stuff from the packages' Makefiles. \n> Like this: https://github.com/mkoeppe/deformation/commit/0d732b13e901b777aca000ff502a5d5aa8d690bf\n\nNote that flint Makefile contains the [very same lines](https://github.com/wbhart/flint2/blob/flint-2.5/Makefile.in#L1-L5)... would you suggest that the same operation should be applied there?",
    "created_at": "2018-03-05T21:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375082",
    "user": "https://github.com/videlec"
}
```

<a id='comment:72'>Comment 72:</a>
Replying to [@mkoeppe](#comment%3A70):
> I think it's better to patch out this LD_LIBRARY_PATH stuff from the packages' Makefiles. 
> Like this: https://github.com/mkoeppe/deformation/commit/0d732b13e901b777aca000ff502a5d5aa8d690bf

Note that flint Makefile contains the [very same lines](https://github.com/wbhart/flint2/blob/flint-2.5/Makefile.in#L1-L5)... would you suggest that the same operation should be applied there?



---

archive/issue_comments_375083.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nReplying to [@videlec](#comment%3A72):\n> Replying to [@mkoeppe](#comment%3A70):\n> > I think it's better to patch out this LD_LIBRARY_PATH stuff from the packages' Makefiles. \n> > Like this: https://github.com/mkoeppe/deformation/commit/0d732b13e901b777aca000ff502a5d5aa8d690bf\n\n> \n> Note that flint Makefile contains the [very same lines](https://github.com/wbhart/flint2/blob/flint-2.5/Makefile.in#L1-L5)... would you suggest that the same operation should be applied there?\n\nAs well as [arb](https://github.com/fredrik-johansson/arb/blob/master/Makefile.in#L1-L5).",
    "created_at": "2018-03-05T21:21:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375083",
    "user": "https://github.com/videlec"
}
```

<a id='comment:73'>Comment 73:</a>
Replying to [@videlec](#comment%3A72):
> Replying to [@mkoeppe](#comment%3A70):
> > I think it's better to patch out this LD_LIBRARY_PATH stuff from the packages' Makefiles. 
> > Like this: https://github.com/mkoeppe/deformation/commit/0d732b13e901b777aca000ff502a5d5aa8d690bf

> 
> Note that flint Makefile contains the [very same lines](https://github.com/wbhart/flint2/blob/flint-2.5/Makefile.in#L1-L5)... would you suggest that the same operation should be applied there?

As well as [arb](https://github.com/fredrik-johansson/arb/blob/master/Makefile.in#L1-L5).



---

archive/issue_comments_375084.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\n`flint`, `arb` and `deformation` share almost the same build system indeed.\nExcept I did not push the `-r`/`pie` fix to `deformation`.",
    "created_at": "2018-03-05T21:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375084",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<a id='comment:74'>Comment 74:</a>
`flint`, `arb` and `deformation` share almost the same build system indeed.
Except I did not push the `-r`/`pie` fix to `deformation`.



---

archive/issue_comments_375085.json:
```json
{
    "body": "<a id='comment:75'>Comment 75:</a>\nReplying to [@videlec](#comment%3A72):\n> would you suggest that the same operation should be applied there?\n\nYes, probably.",
    "created_at": "2018-03-05T21:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375085",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'>Comment 75:</a>
Replying to [@videlec](#comment%3A72):
> would you suggest that the same operation should be applied there?

Yes, probably.



---

archive/issue_comments_375086.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,5 +11,8 @@\n The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to 4 standard packages:\n - R\n - rpy2\n-- flint\n+- flint: upstream issue at https://github.com/wbhart/flint2/issues/447\n - arb\n+\n+And also to some optional packages\n+- deformation\n``````\n",
    "created_at": "2018-03-05T21:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375086",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,5 +11,8 @@
 The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to 4 standard packages:
 - R
 - rpy2
-- flint
+- flint: upstream issue at https://github.com/wbhart/flint2/issues/447
 - arb
+
+And also to some optional packages
+- deformation
``````




---

archive/issue_comments_375087.json:
```json
{
    "body": "Changed upstream from **Reported upstream. Developers deny it's a bug.** to **Reported upstream. No feedback yet.**",
    "created_at": "2018-03-05T21:53:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375087",
    "user": "https://github.com/videlec"
}
```

Changed upstream from **Reported upstream. Developers deny it's a bug.** to **Reported upstream. No feedback yet.**



---

archive/issue_comments_375088.json:
```json
{
    "body": "<a id='comment:77'>Comment 77:</a>\nAnd for R, it may be enough to remove the bottom lines of `etc/ldpaths.in`.",
    "created_at": "2018-03-05T21:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375088",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'>Comment 77:</a>
And for R, it may be enough to remove the bottom lines of `etc/ldpaths.in`.



---

archive/issue_comments_375089.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n - R\n - rpy2\n - flint: upstream issue at https://github.com/wbhart/flint2/issues/447\n-- arb\n+- arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213\n \n And also to some optional packages\n - deformation\n``````\n",
    "created_at": "2018-03-05T21:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375089",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 - R
 - rpy2
 - flint: upstream issue at https://github.com/wbhart/flint2/issues/447
-- arb
+- arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213
 
 And also to some optional packages
 - deformation
``````




---

archive/issue_comments_375090.json:
```json
{
    "body": "<a id='comment:79'>Comment 79:</a>\nNote for all these packages, it is to be seen whether upstream would accept these changes: Some of these libraries may in fact have valid reasons for adjusting LD_LIBRARY_PATH in the context of their build system quirks. But in our setup, since we make sure that all libraries are installed with a full rpath, none of these LD_LIBRARY_PATH things are necessary.",
    "created_at": "2018-03-05T22:03:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375090",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:79'>Comment 79:</a>
Note for all these packages, it is to be seen whether upstream would accept these changes: Some of these libraries may in fact have valid reasons for adjusting LD_LIBRARY_PATH in the context of their build system quirks. But in our setup, since we make sure that all libraries are installed with a full rpath, none of these LD_LIBRARY_PATH things are necessary.



---

archive/issue_comments_375091.json:
```json
{
    "body": "<a id='comment:80'>Comment 80:</a>\nReplying to [@mkoeppe](#comment%3A79):\n> Note for all these packages, it is to be seen whether upstream would accept these changes: Some of these libraries may in fact have valid reasons for adjusting LD_LIBRARY_PATH in the context of their build system quirks. But in our setup, since we make sure that all libraries are installed with a full rpath, none of these LD_LIBRARY_PATH things are necessary.\n\nAt least I asked for flint/arb (see ticket description). Even if upstream remains unchanged we would have two options\n- adding a patch removing the 5 initial lines of `Makefile.in` (compiles fine on my computer)\n- use the Erik's workaround with `LD_PRELOAD`\nDoes anybody have a preference?",
    "created_at": "2018-03-05T22:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375091",
    "user": "https://github.com/videlec"
}
```

<a id='comment:80'>Comment 80:</a>
Replying to [@mkoeppe](#comment%3A79):
> Note for all these packages, it is to be seen whether upstream would accept these changes: Some of these libraries may in fact have valid reasons for adjusting LD_LIBRARY_PATH in the context of their build system quirks. But in our setup, since we make sure that all libraries are installed with a full rpath, none of these LD_LIBRARY_PATH things are necessary.

At least I asked for flint/arb (see ticket description). Even if upstream remains unchanged we would have two options
- adding a patch removing the 5 initial lines of `Makefile.in` (compiles fine on my computer)
- use the Erik's workaround with `LD_PRELOAD`
Does anybody have a preference?



---

archive/issue_comments_375092.json:
```json
{
    "body": "<a id='comment:81'>Comment 81:</a>\nI (clearly) have a strong preference for patching.",
    "created_at": "2018-03-05T22:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375092",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'>Comment 81:</a>
I (clearly) have a strong preference for patching.



---

archive/issue_comments_375093.json:
```json
{
    "body": "<a id='comment:82'>Comment 82:</a>\nReplying to [@mkoeppe](#comment%3A77):\n> And for R, it may be enough to remove the bottom lines of `etc/ldpaths.in`.\n\n@EmmanuelCharpentier: I see that the sage R package contains various patches from you, in particular regarding directories. Would this change, removing the set up of LD_LIBRARY_PATH (and DYLD_FALLBACK_LIBRARY_PATH on macOS), make sense to you?",
    "created_at": "2018-03-05T23:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375093",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:82'>Comment 82:</a>
Replying to [@mkoeppe](#comment%3A77):
> And for R, it may be enough to remove the bottom lines of `etc/ldpaths.in`.

@EmmanuelCharpentier: I see that the sage R package contains various patches from you, in particular regarding directories. Would this change, removing the set up of LD_LIBRARY_PATH (and DYLD_FALLBACK_LIBRARY_PATH on macOS), make sense to you?



---

archive/issue_comments_375094.json:
```json
{
    "body": "<a id='comment:83'>Comment 83:</a>\nReplying to [@mkoeppe](#comment%3A82):\n> Replying to [@mkoeppe](#comment%3A77):\n> > And for R, it may be enough to remove the bottom lines of `etc/ldpaths.in`.\n\n> @EmmanuelCharpentier: I see that the sage R package contains various patches from you, in particular regarding directories. Would this change, removing the set up of LD_LIBRARY_PATH (and DYLD_FALLBACK_LIBRARY_PATH on macOS), make sense to you?\n\nIMHO this would break the Java support in R (if Java is installed in a non-standard place, which is not very unusual), and probably other R packages that might install or use shared libs.",
    "created_at": "2018-03-06T00:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375094",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:83'>Comment 83:</a>
Replying to [@mkoeppe](#comment%3A82):
> Replying to [@mkoeppe](#comment%3A77):
> > And for R, it may be enough to remove the bottom lines of `etc/ldpaths.in`.

> @EmmanuelCharpentier: I see that the sage R package contains various patches from you, in particular regarding directories. Would this change, removing the set up of LD_LIBRARY_PATH (and DYLD_FALLBACK_LIBRARY_PATH on macOS), make sense to you?

IMHO this would break the Java support in R (if Java is installed in a non-standard place, which is not very unusual), and probably other R packages that might install or use shared libs.



---

archive/issue_comments_375095.json:
```json
{
    "body": "Changed commit from **[1ac3afa](https://github.com/sagemath/sagetrac-mirror/commit/1ac3afaefe81fb21c43be7964c07f7cd7d529cb9)** to **[f4697df](https://github.com/sagemath/sagetrac-mirror/commit/f4697df10175ba42a821f848942d3c174c550d76)**",
    "created_at": "2018-03-08T09:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375095",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1ac3afa](https://github.com/sagemath/sagetrac-mirror/commit/1ac3afaefe81fb21c43be7964c07f7cd7d529cb9)** to **[f4697df](https://github.com/sagemath/sagetrac-mirror/commit/f4697df10175ba42a821f848942d3c174c550d76)**



---

archive/issue_comments_375096.json:
```json
{
    "body": "<a id='comment:84'>Comment 84:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0aaff21d6812356f439a3c5537a2434de6e53097\">0aaff21</a></td><td><code>same issue with rpy2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4697df10175ba42a821f848942d3c174c550d76\">f4697df</a></td><td><code>Patching flint/arb/deformation</code></td></tr></table>\n",
    "created_at": "2018-03-08T09:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375096",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:84'>Comment 84:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0aaff21d6812356f439a3c5537a2434de6e53097">0aaff21</a></td><td><code>same issue with rpy2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4697df10175ba42a821f848942d3c174c550d76">f4697df</a></td><td><code>Patching flint/arb/deformation</code></td></tr></table>




---

archive/issue_comments_375097.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,11 +8,11 @@\n \n After deactivating the `gc` package, the compilation went fine.\n \n-The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to 4 standard packages:\n-- R\n-- rpy2\n+The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to the 2 standard packages `R` and `rpy2`.\n+\n+The three other packges `flint`/`arb`/`deformation` failed to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.\n+\n+Upstream issues\n+\n - flint: upstream issue at https://github.com/wbhart/flint2/issues/447\n - arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213\n-\n-And also to some optional packages\n-- deformation\n``````\n",
    "created_at": "2018-03-08T09:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375097",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,11 +8,11 @@
 
 After deactivating the `gc` package, the compilation went fine.
 
-The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to 4 standard packages:
-- R
-- rpy2
+The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to the 2 standard packages `R` and `rpy2`.
+
+The three other packges `flint`/`arb`/`deformation` failed to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.
+
+Upstream issues
+
 - flint: upstream issue at https://github.com/wbhart/flint2/issues/447
 - arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213
-
-And also to some optional packages
-- deformation
``````




---

archive/issue_comments_375098.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, Vincent Delecroix**",
    "created_at": "2018-03-08T09:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375098",
    "user": "https://github.com/videlec"
}
```

Changed author from **Erik Bray** to **Erik Bray, Vincent Delecroix**



---

archive/issue_comments_375099.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,3 +16,4 @@\n \n - flint: upstream issue at https://github.com/wbhart/flint2/issues/447\n - arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213\n+- deformation: https://github.com/jpflori/pydeformation/issues/5 (for the pie trouble from #24902)\n``````\n",
    "created_at": "2018-03-08T10:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375099",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,3 +16,4 @@
 
 - flint: upstream issue at https://github.com/wbhart/flint2/issues/447
 - arb: upstream issue at https://github.com/fredrik-johansson/arb/issues/213
+- deformation: https://github.com/jpflori/pydeformation/issues/5 (for the pie trouble from #24902)
``````




---

archive/issue_comments_375100.json:
```json
{
    "body": "Changed commit from **[f4697df](https://github.com/sagemath/sagetrac-mirror/commit/f4697df10175ba42a821f848942d3c174c550d76)** to **[f5f25dc](https://github.com/sagemath/sagetrac-mirror/commit/f5f25dc71fa05c4ac81d18392880a3358a9c9957)**",
    "created_at": "2018-03-08T10:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375100",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f4697df](https://github.com/sagemath/sagetrac-mirror/commit/f4697df10175ba42a821f848942d3c174c550d76)** to **[f5f25dc](https://github.com/sagemath/sagetrac-mirror/commit/f5f25dc71fa05c4ac81d18392880a3358a9c9957)**



---

archive/issue_comments_375101.json:
```json
{
    "body": "<a id='comment:88'>Comment 88:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f5f25dc71fa05c4ac81d18392880a3358a9c9957\">f5f25dc</a></td><td><code>specify upstream issues in patches</code></td></tr></table>\n",
    "created_at": "2018-03-08T10:54:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375101",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:88'>Comment 88:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f5f25dc71fa05c4ac81d18392880a3358a9c9957">f5f25dc</a></td><td><code>specify upstream issues in patches</code></td></tr></table>




---

archive/issue_comments_375102.json:
```json
{
    "body": "<a id='comment:89'>Comment 89:</a>\nI'm -1 on patching things out if it isn't necessary to, or if the reason to do so hasn't been fully understood.  Are any of these patches even necessary? And if so, why are these packages manipulating `LD_LIBRARY_PATH`, and how are you sure that it isn't a necessary and valid thing to do in this case?",
    "created_at": "2018-03-08T12:02:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375102",
    "user": "https://github.com/embray"
}
```

<a id='comment:89'>Comment 89:</a>
I'm -1 on patching things out if it isn't necessary to, or if the reason to do so hasn't been fully understood.  Are any of these patches even necessary? And if so, why are these packages manipulating `LD_LIBRARY_PATH`, and how are you sure that it isn't a necessary and valid thing to do in this case?



---

archive/issue_comments_375103.json:
```json
{
    "body": "<a id='comment:90'>Comment 90:</a>\nIn particular, since I already provided a workaround, why not just use that same workaround for those packages as well?",
    "created_at": "2018-03-08T12:03:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375103",
    "user": "https://github.com/embray"
}
```

<a id='comment:90'>Comment 90:</a>
In particular, since I already provided a workaround, why not just use that same workaround for those packages as well?



---

archive/issue_comments_375104.json:
```json
{
    "body": "<a id='comment:91'>Comment 91:</a>\nReplying to [@embray](#comment%3A89):\n> I'm -1 on patching things out if it isn't necessary to, or if the reason to do so hasn't been fully understood.  Are any of these patches even necessary? And if so, why are these packages manipulating `LD_LIBRARY_PATH`, and how are you sure that it isn't a necessary and valid thing to do in this case?\n\nMatthias might be better placed to answer (see [comment:81]). We might also wait for upstream answers (see ticket description for the links). To my mind, keeping `spkg-install` as simple as possible is better (assuming the patch is correct).\n\nI would also like to find a solution so that all these build troubles are merged soon (even if the fix has to change later on). The problem at the origin of this ticket affects all archlinux users.",
    "created_at": "2018-03-08T13:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375104",
    "user": "https://github.com/videlec"
}
```

<a id='comment:91'>Comment 91:</a>
Replying to [@embray](#comment%3A89):
> I'm -1 on patching things out if it isn't necessary to, or if the reason to do so hasn't been fully understood.  Are any of these patches even necessary? And if so, why are these packages manipulating `LD_LIBRARY_PATH`, and how are you sure that it isn't a necessary and valid thing to do in this case?

Matthias might be better placed to answer (see [comment:81]). We might also wait for upstream answers (see ticket description for the links). To my mind, keeping `spkg-install` as simple as possible is better (assuming the patch is correct).

I would also like to find a solution so that all these build troubles are merged soon (even if the fix has to change later on). The problem at the origin of this ticket affects all archlinux users.



---

archive/issue_comments_375105.json:
```json
{
    "body": "<a id='comment:92'>Comment 92:</a>\nHell, we can provide a make spkg. To me, make is a tool that should work, no matter what. Otherwise, patching Sage packages is akin to trying to use a [slot screwdriver on French recess screws](https://en.wikipedia.org/wiki/List_of_screw_drives), and then proceeding to saw slots in screws instead of picking up a correct tool...(sorry, my undergrad was in engineering :-))",
    "created_at": "2018-03-08T13:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375105",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:92'>Comment 92:</a>
Hell, we can provide a make spkg. To me, make is a tool that should work, no matter what. Otherwise, patching Sage packages is akin to trying to use a [slot screwdriver on French recess screws](https://en.wikipedia.org/wiki/List_of_screw_drives), and then proceeding to saw slots in screws instead of picking up a correct tool...(sorry, my undergrad was in engineering :-))



---

archive/issue_comments_375106.json:
```json
{
    "body": "<a id='comment:93'>Comment 93:</a>\nReplying to [@dimpase](#comment%3A92):\n> Hell, we can provide a make spkg. To me, make is a tool that should work, no matter what. Otherwise, patching Sage packages is akin to trying to use a [slot screwdriver on French recess screws](https://en.wikipedia.org/wiki/List_of_screw_drives), and then proceeding to saw slots in screws instead of picking up a correct tool...(sorry, my undergrad was in engineering :-))  \n\n[No problem.](https://www.youtube.com/watch?v=CYUfPTeE0DM) After all, *my* undergrad was even more [remote...](https://upload.wikimedia.org/wikipedia/commons/6/6f/Older_barber-dentist.jpg)",
    "created_at": "2018-03-08T14:15:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375106",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:93'>Comment 93:</a>
Replying to [@dimpase](#comment%3A92):
> Hell, we can provide a make spkg. To me, make is a tool that should work, no matter what. Otherwise, patching Sage packages is akin to trying to use a [slot screwdriver on French recess screws](https://en.wikipedia.org/wiki/List_of_screw_drives), and then proceeding to saw slots in screws instead of picking up a correct tool...(sorry, my undergrad was in engineering :-))  

[No problem.](https://www.youtube.com/watch?v=CYUfPTeE0DM) After all, *my* undergrad was even more [remote...](https://upload.wikimedia.org/wikipedia/commons/6/6f/Older_barber-dentist.jpg)



---

archive/issue_comments_375107.json:
```json
{
    "body": "<a id='comment:94'>Comment 94:</a>\nFor flint and friends another workaround I found was to simply pass `DLPATH_ADD=` when calling `make` in its `spkg-install`.",
    "created_at": "2018-03-08T15:39:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375107",
    "user": "https://github.com/embray"
}
```

<a id='comment:94'>Comment 94:</a>
For flint and friends another workaround I found was to simply pass `DLPATH_ADD=` when calling `make` in its `spkg-install`.



---

archive/issue_comments_375108.json:
```json
{
    "body": "<a id='comment:95'>Comment 95:</a>\nReplying to [@embray](#comment%3A89):\n>  why are these packages manipulating `LD_LIBRARY_PATH`, and how are you sure that it isn't a necessary and valid thing to do in this case?\n\nWe can be sure simply by testing that the build works, just like we do with any other package.",
    "created_at": "2018-03-08T18:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375108",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:95'>Comment 95:</a>
Replying to [@embray](#comment%3A89):
>  why are these packages manipulating `LD_LIBRARY_PATH`, and how are you sure that it isn't a necessary and valid thing to do in this case?

We can be sure simply by testing that the build works, just like we do with any other package.



---

archive/issue_comments_375109.json:
```json
{
    "body": "<a id='comment:96'>Comment 96:</a>\nReplying to [@embray](#comment%3A94):\n> For flint and friends another workaround I found was to simply pass `DLPATH_ADD=` when calling `make` in its `spkg-install`.\n\nThis is a great solution, which I prefer over patching.",
    "created_at": "2018-03-08T18:39:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375109",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:96'>Comment 96:</a>
Replying to [@embray](#comment%3A94):
> For flint and friends another workaround I found was to simply pass `DLPATH_ADD=` when calling `make` in its `spkg-install`.

This is a great solution, which I prefer over patching.



---

archive/issue_comments_375110.json:
```json
{
    "body": "Changed commit from **[f5f25dc](https://github.com/sagemath/sagetrac-mirror/commit/f5f25dc71fa05c4ac81d18392880a3358a9c9957)** to **[21442be](https://github.com/sagemath/sagetrac-mirror/commit/21442be9d659d74e29ce2a3a5dd85f55b7c90475)**",
    "created_at": "2018-03-08T18:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375110",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f5f25dc](https://github.com/sagemath/sagetrac-mirror/commit/f5f25dc71fa05c4ac81d18392880a3358a9c9957)** to **[21442be](https://github.com/sagemath/sagetrac-mirror/commit/21442be9d659d74e29ce2a3a5dd85f55b7c90475)**



---

archive/issue_comments_375111.json:
```json
{
    "body": "<a id='comment:97'>Comment 97:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb4fd11516d994d083efdc52d0d29122ce52df1e\">eb4fd11</a></td><td><code>patch for recent gcc's in deformation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/21442be9d659d74e29ce2a3a5dd85f55b7c90475\">21442be</a></td><td><code>Fix for arb/flint/deformation</code></td></tr></table>\n",
    "created_at": "2018-03-08T18:52:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375111",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:97'>Comment 97:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb4fd11516d994d083efdc52d0d29122ce52df1e">eb4fd11</a></td><td><code>patch for recent gcc's in deformation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/21442be9d659d74e29ce2a3a5dd85f55b7c90475">21442be</a></td><td><code>Fix for arb/flint/deformation</code></td></tr></table>




---

archive/issue_comments_375112.json:
```json
{
    "body": "<a id='comment:98'>Comment 98:</a>\nThank you!\nNext I'd suggest that we also see how exactly `$SAGE_LOCAL/lib` ends up in R's `LD_LIBRARY_PATH`. The relevant file seems to be `$SAGE_LOCAL/lib/R/etc/ldpaths`. But I can't investigate this here on macOS.",
    "created_at": "2018-03-08T19:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375112",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'>Comment 98:</a>
Thank you!
Next I'd suggest that we also see how exactly `$SAGE_LOCAL/lib` ends up in R's `LD_LIBRARY_PATH`. The relevant file seems to be `$SAGE_LOCAL/lib/R/etc/ldpaths`. But I can't investigate this here on macOS.



---

archive/issue_comments_375113.json:
```json
{
    "body": "<a id='comment:99'>Comment 99:</a>\nReplying to [@dimpase](#comment%3A92):\n> we can provide a make spkg. \n\n-1",
    "created_at": "2018-03-08T19:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375113",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:99'>Comment 99:</a>
Replying to [@dimpase](#comment%3A92):
> we can provide a make spkg. 

-1



---

archive/issue_comments_375114.json:
```json
{
    "body": "<a id='comment:0'>Comment 0:</a>\n[EDITED]\n\nAt commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)\n\n- without anything new in `spkg-check` I end up with the same libguile buisness\n- with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).\n- with `sdh_preload_lib` it works fine\n\nI will add a commit in a minute.",
    "created_at": "2018-03-08T19:10:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375114",
    "user": "https://github.com/videlec"
}
```

<a id='comment:0'>Comment 0:</a>
[EDITED]

At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)

- without anything new in `spkg-check` I end up with the same libguile buisness
- with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).
- with `sdh_preload_lib` it works fine

I will add a commit in a minute.



---

archive/issue_comments_375115.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d8a4a954cee8958b24ece2067bf5191dcbcd28e\">0d8a4a9</a></td><td><code>use sdh_preload_lib for flint/arb/deformation test-suites</code></td></tr></table>\n",
    "created_at": "2018-03-08T19:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375115",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:1'>Comment 1:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d8a4a954cee8958b24ece2067bf5191dcbcd28e">0d8a4a9</a></td><td><code>use sdh_preload_lib for flint/arb/deformation test-suites</code></td></tr></table>




---

archive/issue_comments_375116.json:
```json
{
    "body": "Changed commit from **[21442be](https://github.com/sagemath/sagetrac-mirror/commit/21442be9d659d74e29ce2a3a5dd85f55b7c90475)** to **[0d8a4a9](https://github.com/sagemath/sagetrac-mirror/commit/0d8a4a954cee8958b24ece2067bf5191dcbcd28e)**",
    "created_at": "2018-03-08T19:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375116",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[21442be](https://github.com/sagemath/sagetrac-mirror/commit/21442be9d659d74e29ce2a3a5dd85f55b7c90475)** to **[0d8a4a9](https://github.com/sagemath/sagetrac-mirror/commit/0d8a4a954cee8958b24ece2067bf5191dcbcd28e)**



---

archive/issue_comments_375117.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nInteresting; normally `make check` is supposed to test against the non-installed library, rather than the installed library. (The distinction does not matter to us because we run `spkg-check` after `spkg-install`.",
    "created_at": "2018-03-08T20:02:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375117",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
Interesting; normally `make check` is supposed to test against the non-installed library, rather than the installed library. (The distinction does not matter to us because we run `spkg-check` after `spkg-install`.



---

archive/issue_comments_375118.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nVincent, could you try whether passing \n\n```\n$MAKE check DLPATH_ADD=`pwd`\n```\nworks (without using `sdh_preload_lib`)?",
    "created_at": "2018-03-08T20:18:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'>Comment 3:</a>
Vincent, could you try whether passing 

```
$MAKE check DLPATH_ADD=`pwd`
```
works (without using `sdh_preload_lib`)?



---

archive/issue_comments_375119.json:
```json
{
    "body": "Attachment: **[flint-2.5.2-check_on_base.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_on_base.log.gz)**",
    "created_at": "2018-03-08T20:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375119",
    "user": "https://github.com/videlec"
}
```

Attachment: **[flint-2.5.2-check_on_base.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_on_base.log.gz)**



---

archive/issue_comments_375120.json:
```json
{
    "body": "Attachment: **[flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz)**",
    "created_at": "2018-03-08T20:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375120",
    "user": "https://github.com/videlec"
}
```

Attachment: **[flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz)**



---

archive/issue_comments_375121.json:
```json
{
    "body": "Attachment: **[flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz)**",
    "created_at": "2018-03-08T20:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375121",
    "user": "https://github.com/videlec"
}
```

Attachment: **[flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz)**



---

archive/issue_comments_375122.json:
```json
{
    "body": "Attachment: **[flint-2.5.2-check_with_sdh_preload.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_sdh_preload.log.gz)**",
    "created_at": "2018-03-08T20:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375122",
    "user": "https://github.com/videlec"
}
```

Attachment: **[flint-2.5.2-check_with_sdh_preload.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_sdh_preload.log.gz)**



---

archive/issue_comments_375123.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nSee in attachment the full log of the `sage -f -c flint` with the various configurations\n\n- spkg-check as in develop [attachment: flint-2.5.2-check_on_base.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_on_base.log.gz) \n- with `DLPATH_ADD=` [attachment: flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz)\n- with <code>DLPATH_add=\\`pwd\\`</code> as suggested in [comment:103] [attachment: flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz) \n- with `sdh_preload_lib` as in `0d8a4a9` [attachment: flint-2.5.2-check_with_sdh_preload.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_sdh_preload.log.gz)",
    "created_at": "2018-03-08T20:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375123",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'>Comment 4:</a>
See in attachment the full log of the `sage -f -c flint` with the various configurations

- spkg-check as in develop [attachment: flint-2.5.2-check_on_base.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_on_base.log.gz) 
- with `DLPATH_ADD=` [attachment: flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_empty.log.gz)
- with <code>DLPATH_add=\`pwd\`</code> as suggested in [comment:103] [attachment: flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_pwd.log.gz) 
- with `sdh_preload_lib` as in `0d8a4a9` [attachment: flint-2.5.2-check_with_sdh_preload.log.gz.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_sdh_preload.log.gz)



---

archive/issue_comments_375124.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nThank you!\nSeems like FLINT forgets to pass the rpath linker option when it builds its test programs, relying on LD_LIBRARY_PATH instead.",
    "created_at": "2018-03-08T21:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375124",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
Thank you!
Seems like FLINT forgets to pass the rpath linker option when it builds its test programs, relying on LD_LIBRARY_PATH instead.



---

archive/issue_comments_375125.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nOur patch `use_ldflags_in_tests.patch` (for FLINT) does not go far enough; it forgets to patch `Makefile.subdirs`.",
    "created_at": "2018-03-09T01:11:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
Our patch `use_ldflags_in_tests.patch` (for FLINT) does not go far enough; it forgets to patch `Makefile.subdirs`.



---

archive/issue_comments_375126.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nFix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1",
    "created_at": "2018-03-09T01:27:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375126",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1



---

archive/issue_comments_375127.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n-Sage has a standard package `gc` that creates conflicts with programs that are prerequisite to build Sage such as make. For example, building Sage 8.2.beta3 on archlinux one gets\n+Guile plugin in make under certain not completely clear conditions, likely to do with a version misconfiguration of system libraries,\n+may fail to build a number of Sage packages. For example, while building Sage 8.2.beta3 on latest archlinux one gets\n \n ```\n make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \n@@ -8,9 +9,11 @@\n \n After deactivating the `gc` package, the compilation went fine.\n \n+However, this cannot be reproduced on other Linux systems.\n+\n The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to the 2 standard packages `R` and `rpy2`.\n \n-The three other packges `flint`/`arb`/`deformation` failed to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.\n+The three other packges `flint`/`arb`/`deformation` fail to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.\n \n Upstream issues\n \n``````\n",
    "created_at": "2018-03-09T03:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375127",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,5 @@
-Sage has a standard package `gc` that creates conflicts with programs that are prerequisite to build Sage such as make. For example, building Sage 8.2.beta3 on archlinux one gets
+Guile plugin in make under certain not completely clear conditions, likely to do with a version misconfiguration of system libraries,
+may fail to build a number of Sage packages. For example, while building Sage 8.2.beta3 on latest archlinux one gets
 
 ```
 make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
@@ -8,9 +9,11 @@
 
 After deactivating the `gc` package, the compilation went fine.
 
+However, this cannot be reproduced on other Linux systems.
+
 The workaround in the branch consists in declaring the environment variable `LD_PRELOAD` so that make uses the system gc. The workaround has to be applied to the 2 standard packages `R` and `rpy2`.
 
-The three other packges `flint`/`arb`/`deformation` failed to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.
+The three other packges `flint`/`arb`/`deformation` fail to build for the same reason and we apply a small patch to avoid them redefining `LD_LIBRARY_PATH`.
 
 Upstream issues
 
``````




---

archive/issue_comments_375128.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThe ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.\n\nIf you must work on Arch, install make without guile support. Certainly, improving various upstream build systems is a noble goal, but getting totally carried away with this is not a good idea.",
    "created_at": "2018-03-09T03:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375128",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'>Comment 8:</a>
The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.

If you must work on Arch, install make without guile support. Certainly, improving various upstream build systems is a noble goal, but getting totally carried away with this is not a good idea.



---

archive/issue_events_310730.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-03-09T03:34:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310730"
}
```



---

archive/issue_events_310731.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-03-09T03:34:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310731"
}
```



---

archive/issue_events_310732.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-03-09T03:34:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "title_is": "on Arch make+guile is broken",
    "title_was": "conflicts with gc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310732"
}
```



---

archive/issue_comments_375129.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI agree that it's probably not a blocker because it only happens on a relatively obscure configuration.\nBut I don't think your edit to the description was an improvement.",
    "created_at": "2018-03-09T04:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375129",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
I agree that it's probably not a blocker because it only happens on a relatively obscure configuration.
But I don't think your edit to the description was an improvement.



---

archive/issue_comments_375130.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,8 @@\n make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: \n GC_move_disappearing_link\n ```\n+as libguile looks at the LD_LIBRARY_PATH containing a different version of `libgc.so` than the one it needs.\n+\n See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).\n \n After deactivating the `gc` package, the compilation went fine.\n``````\n",
    "created_at": "2018-03-09T04:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375130",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,8 @@
 make: symbol lookup error: /usr/lib/libguile-2.2.so.1: undefined symbol: 
 GC_move_disappearing_link
 ```
+as libguile looks at the LD_LIBRARY_PATH containing a different version of `libgc.so` than the one it needs.
+
 See also [this report on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/5LqXytiF2nQ).
 
 After deactivating the `gc` package, the compilation went fine.
``````




---

archive/issue_comments_375131.json:
```json
{
    "body": "<a id='comment:110'>Comment 110:</a>\nReplying to [@mkoeppe](#comment%3A109):\n> I agree that it's probably not a blocker because it only happens on a relatively obscure configuration.\n> But I don't think your edit to the description was an improvement. \n\nI've added a bit more detail pointing at the root cause of trouble. As well, #23700 will provide `libgc` compatible with the one needed by `libguile`, and the main problem will go away after it is merged.",
    "created_at": "2018-03-09T04:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375131",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:110'>Comment 110:</a>
Replying to [@mkoeppe](#comment%3A109):
> I agree that it's probably not a blocker because it only happens on a relatively obscure configuration.
> But I don't think your edit to the description was an improvement. 

I've added a bit more detail pointing at the root cause of trouble. As well, #23700 will provide `libgc` compatible with the one needed by `libguile`, and the main problem will go away after it is merged.



---

archive/issue_comments_375132.json:
```json
{
    "body": "<a id='comment:111'>Comment 111:</a>\nReplying to [@mkoeppe](#comment%3A107):\n> Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1\n\nWith the patch applied, tests run with `DLPATH_ADD=` in `make check`. Could you make it a proper upstream pull request?",
    "created_at": "2018-03-09T08:22:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375132",
    "user": "https://github.com/videlec"
}
```

<a id='comment:111'>Comment 111:</a>
Replying to [@mkoeppe](#comment%3A107):
> Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1

With the patch applied, tests run with `DLPATH_ADD=` in `make check`. Could you make it a proper upstream pull request?



---

archive/issue_comments_375133.json:
```json
{
    "body": "<a id='comment:112'>Comment 112:</a>\nReplying to [@videlec](#comment%3A100):\n> [EDITED]\n> \n> At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)\n> \n> - without anything new in `spkg-check` I end up with the same libguile buisness\n> - with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).\n\nI didn't get an opportunity to comment on this last night, but FYI you don't need to add `DLPATH_ADD=` to the `make install` call.  Just the first one that says `make verbose`.  That works for me, and the `make check` tests pass.",
    "created_at": "2018-03-09T10:39:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375133",
    "user": "https://github.com/embray"
}
```

<a id='comment:112'>Comment 112:</a>
Replying to [@videlec](#comment%3A100):
> [EDITED]
> 
> At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)
> 
> - without anything new in `spkg-check` I end up with the same libguile buisness
> - with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).

I didn't get an opportunity to comment on this last night, but FYI you don't need to add `DLPATH_ADD=` to the `make install` call.  Just the first one that says `make verbose`.  That works for me, and the `make check` tests pass.



---

archive/issue_comments_375134.json:
```json
{
    "body": "<a id='comment:113'>Comment 113:</a>\nReplying to [@dimpase](#comment%3A108):\n> The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.\n\nIt's not a bug in Arch.  If anything it's a bug in Sage...",
    "created_at": "2018-03-09T10:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375134",
    "user": "https://github.com/embray"
}
```

<a id='comment:113'>Comment 113:</a>
Replying to [@dimpase](#comment%3A108):
> The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.

It's not a bug in Arch.  If anything it's a bug in Sage...



---

archive/issue_comments_375135.json:
```json
{
    "body": "<a id='comment:114'>Comment 114:</a>\nReplying to [@embray](#comment%3A113):\n> Replying to [@dimpase](#comment%3A108):\n> > The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.\n\n> \n> It's not a bug in Arch.  If anything it's a bug in Sage...\n\nAs you cannot reproduce it on anything but the latest Arch, I don't really see how you can say this. The make they ship is not backwards-compatible, and they have not made any announcements to that extent, have not bumped the version up, have they? At least if they insist on this make, they should also provide a guile-less make in another package.",
    "created_at": "2018-03-09T13:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375135",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:114'>Comment 114:</a>
Replying to [@embray](#comment%3A113):
> Replying to [@dimpase](#comment%3A108):
> > The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.

> 
> It's not a bug in Arch.  If anything it's a bug in Sage...

As you cannot reproduce it on anything but the latest Arch, I don't really see how you can say this. The make they ship is not backwards-compatible, and they have not made any announcements to that extent, have not bumped the version up, have they? At least if they insist on this make, they should also provide a guile-less make in another package.



---

archive/issue_comments_375136.json:
```json
{
    "body": "<a id='comment:115'>Comment 115:</a>\nReplying to [@dimpase](#comment%3A114):\n> Replying to [@embray](#comment%3A113):\n> > Replying to [@dimpase](#comment%3A108):\n> > > The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.\n\n> > \n> > It's not a bug in Arch.  If anything it's a bug in Sage...\n\n> \n> As you cannot reproduce it on anything but the latest Arch, I don't really see how you can say this. The make they ship is not backwards-compatible, and they have not made any announcements to that extent, have not bumped the version up, have they? At least if they insist on this make, they should also provide a guile-less make in another package.\n\nI think you're being a tad Sage-centric.  The kind of problem we're encountering here is a normal problem when you have two different versions of a library and you load the wrong version in an executable that expects the different version.  There's certainly nothing wrong with Arch shipping a feature-complete version of GNU make (while it's a rare feature, it's probably used by at least some packages), and I can't blame them for not expecting that somebody might end up with their own copy of libgc on their shared library path, which is a highly unusual thing to be doing.\n\nYou do have a point that being a fundamental build tool, a `make` with additional dependencies is more likely to encounter a problem like this than many other tools, but this same sort of problem can happen with any other part of the build toolchain.  The real problem is that Sage is insisting on using too many of its own packages for low-level dependencies :)",
    "created_at": "2018-03-09T13:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375136",
    "user": "https://github.com/embray"
}
```

<a id='comment:115'>Comment 115:</a>
Replying to [@dimpase](#comment%3A114):
> Replying to [@embray](#comment%3A113):
> > Replying to [@dimpase](#comment%3A108):
> > > The ticket description and the title were misleading. It's a bug in Arch that we are dealing with here, and it should not be a blocker. A broken make is nothing new, e.g. while in theory BSD Make should be able to build Sage, in practice is does not work, and one has to use GNU Make.

> > 
> > It's not a bug in Arch.  If anything it's a bug in Sage...

> 
> As you cannot reproduce it on anything but the latest Arch, I don't really see how you can say this. The make they ship is not backwards-compatible, and they have not made any announcements to that extent, have not bumped the version up, have they? At least if they insist on this make, they should also provide a guile-less make in another package.

I think you're being a tad Sage-centric.  The kind of problem we're encountering here is a normal problem when you have two different versions of a library and you load the wrong version in an executable that expects the different version.  There's certainly nothing wrong with Arch shipping a feature-complete version of GNU make (while it's a rare feature, it's probably used by at least some packages), and I can't blame them for not expecting that somebody might end up with their own copy of libgc on their shared library path, which is a highly unusual thing to be doing.

You do have a point that being a fundamental build tool, a `make` with additional dependencies is more likely to encounter a problem like this than many other tools, but this same sort of problem can happen with any other part of the build toolchain.  The real problem is that Sage is insisting on using too many of its own packages for low-level dependencies :)



---

archive/issue_comments_375137.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nAnother example where this kind of problem can occur (but by luck doesn't seem to), which has nothing to do with make or guile or gc:  Sage ships its own libz for some reason.  Well, libpython has libz as a dependency, and when building Python it also manipulates `LD_LIBRARY_PATH`.  In this case it isn't really a problem, but if you had `$SAGE_LOCAL/lib` on `LD_LIBRARY_PATH`, and Sage's libz were incompatible with the system's libz, you would also have a problem.",
    "created_at": "2018-03-09T13:54:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375137",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>Comment 6:</a>
Another example where this kind of problem can occur (but by luck doesn't seem to), which has nothing to do with make or guile or gc:  Sage ships its own libz for some reason.  Well, libpython has libz as a dependency, and when building Python it also manipulates `LD_LIBRARY_PATH`.  In this case it isn't really a problem, but if you had `$SAGE_LOCAL/lib` on `LD_LIBRARY_PATH`, and Sage's libz were incompatible with the system's libz, you would also have a problem.



---

archive/issue_comments_375138.json:
```json
{
    "body": "<a id='comment:117'>Comment 117:</a>\nReplying to [@embray](#comment%3A116):\n> Another example where this kind of problem can occur (but by luck doesn't seem to), which has nothing to do with make or guile or gc:  Sage ships its own libz for some reason.  Well, libpython has libz as a dependency, and when building Python it also manipulates `LD_LIBRARY_PATH`.  In this case it isn't really a problem, but if you had `$SAGE_LOCAL/lib` on `LD_LIBRARY_PATH`, and Sage's libz were incompatible with the system's libz, you would also have a problem.\n\nplease have a look at comments 27-29 above. The only conclusion I can draw from it that Arch has done something dodgy and very hard to reproduce, the probably screwed up versioning of libgc, by not bumping it up while upgrading, or something similar.\n(or perhaps gentoo has a different build setup for make+libguile, so that the result is not fragile...)\n\nTLDR; manipulating LD_LIBRARY_PATH while building with make+guile on gentoo does not lead to a problem, while on arch it does.",
    "created_at": "2018-03-09T14:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375138",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:117'>Comment 117:</a>
Replying to [@embray](#comment%3A116):
> Another example where this kind of problem can occur (but by luck doesn't seem to), which has nothing to do with make or guile or gc:  Sage ships its own libz for some reason.  Well, libpython has libz as a dependency, and when building Python it also manipulates `LD_LIBRARY_PATH`.  In this case it isn't really a problem, but if you had `$SAGE_LOCAL/lib` on `LD_LIBRARY_PATH`, and Sage's libz were incompatible with the system's libz, you would also have a problem.

please have a look at comments 27-29 above. The only conclusion I can draw from it that Arch has done something dodgy and very hard to reproduce, the probably screwed up versioning of libgc, by not bumping it up while upgrading, or something similar.
(or perhaps gentoo has a different build setup for make+libguile, so that the result is not fragile...)

TLDR; manipulating LD_LIBRARY_PATH while building with make+guile on gentoo does not lead to a problem, while on arch it does.



---

archive/issue_comments_375139.json:
```json
{
    "body": "<a id='comment:118'>Comment 118:</a>\nReplying to [@embray](#comment%3A115):\n\n[ Snip... ]\n\n> The real problem is that Sage is insisting on using too many of its own packages for low-level dependencies :)\n\nHear, hear ! \n\nThis, IMNSHO, is a capital point, that is involved in a *lot* of other parts of Sage. It stems from our insistence to have \"known good\" versions of almost everything we use, hence \"our\" version of Maxima, \"our\" version of R, \"our\" version of Sympy ,etc... and even \"our\" version(s) of Python (!).\n\nThis *modus operandi* greatly simplifies the maintenance of the consistency of Sage with (sometimes wildly) varying versions of other people's software. But the drawback is that Sage ends up being a distribution of mathematics-related software and underlying utilities, which converges to a (not so small) Unix-like distribution.\n\nAn alternative would be to push the version-related variability of interface in specialized interface packages, presenting Sage with a uniform interface and adapting to the \"other side\" variability.\n\nAs far as I can tell, this alternative isn't used because it requires maintenance of the interface for each and every version of the interfaced software that can be met \"in the wild\". Which would be more work than maintaining one \"Sage's own\" version, it seems...\n\nBut at the point where we need \"our\" make, \"our\" gcc, \"our\" python(s), etc..., I wonder if this point of view shouldn't be re-assessed.\n\nThis ticket is probably not the right place to discuss it ; however, I think it should be opened on sage-devel.\n\nOpinions ? Advice ?",
    "created_at": "2018-03-09T14:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375139",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:118'>Comment 118:</a>
Replying to [@embray](#comment%3A115):

[ Snip... ]

> The real problem is that Sage is insisting on using too many of its own packages for low-level dependencies :)

Hear, hear ! 

This, IMNSHO, is a capital point, that is involved in a *lot* of other parts of Sage. It stems from our insistence to have "known good" versions of almost everything we use, hence "our" version of Maxima, "our" version of R, "our" version of Sympy ,etc... and even "our" version(s) of Python (!).

This *modus operandi* greatly simplifies the maintenance of the consistency of Sage with (sometimes wildly) varying versions of other people's software. But the drawback is that Sage ends up being a distribution of mathematics-related software and underlying utilities, which converges to a (not so small) Unix-like distribution.

An alternative would be to push the version-related variability of interface in specialized interface packages, presenting Sage with a uniform interface and adapting to the "other side" variability.

As far as I can tell, this alternative isn't used because it requires maintenance of the interface for each and every version of the interfaced software that can be met "in the wild". Which would be more work than maintaining one "Sage's own" version, it seems...

But at the point where we need "our" make, "our" gcc, "our" python(s), etc..., I wonder if this point of view shouldn't be re-assessed.

This ticket is probably not the right place to discuss it ; however, I think it should be opened on sage-devel.

Opinions ? Advice ?



---

archive/issue_comments_375140.json:
```json
{
    "body": "<a id='comment:119'>Comment 119:</a>\nReplying to [@videlec](#comment%3A111):\n> Replying to [@mkoeppe](#comment%3A107):\n> > Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1\n\n> \n> With the patch applied, tests run with `DLPATH_ADD=` in `make check`. Could you make it a proper upstream pull request?\n\nhttps://github.com/wbhart/flint2/pull/449",
    "created_at": "2018-03-09T14:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375140",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:119'>Comment 119:</a>
Replying to [@videlec](#comment%3A111):
> Replying to [@mkoeppe](#comment%3A107):
> > Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1

> 
> With the patch applied, tests run with `DLPATH_ADD=` in `make check`. Could you make it a proper upstream pull request?

https://github.com/wbhart/flint2/pull/449



---

archive/issue_comments_375141.json:
```json
{
    "body": "<a id='comment:120'>Comment 120:</a>\nReplying to [@embray](#comment%3A116):\n> Another example where this kind of problem can occur (but by luck doesn't seem to) [...] libz [...]\n\nThat's why I would recommend to use `DLPATH_ADD=` in all places where make is used in the spkg scripts for the FLINT-like packages, not just the minimal list of those where the current symptom (make-guile-gc-on-arch) is observed.",
    "created_at": "2018-03-09T14:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375141",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:120'>Comment 120:</a>
Replying to [@embray](#comment%3A116):
> Another example where this kind of problem can occur (but by luck doesn't seem to) [...] libz [...]

That's why I would recommend to use `DLPATH_ADD=` in all places where make is used in the spkg scripts for the FLINT-like packages, not just the minimal list of those where the current symptom (make-guile-gc-on-arch) is observed.



---

archive/issue_comments_375142.json:
```json
{
    "body": "<a id='comment:121'>Comment 121:</a>\nReplying to [@EmmanuelCharpentier](#comment%3A118):\n> Opinions ? Advice ?\n\nThe convenience for users of having a self contained sage distribution (in particular those who are stuck on a system without root access, or distributions without a comprehensive and well-maintained set of mathematical software packages) is important.\n\nUsing the distribution's installed packages instead of our own whenever we can is of course desirable, and in fact there is an ongoing effort to do so. See for example Erik's #24919.\n\nWhether we can use some specific version is often times not a question of \"interfacing\", but to avoid critical bugs; and it seems problematic to build an interface with the purpose of working around bugs. When it is about features rather than bugs, again there is an ongoing effort already, #20382.\n\nThese tickets (and related ones) need technical discussion.",
    "created_at": "2018-03-09T18:11:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375142",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:121'>Comment 121:</a>
Replying to [@EmmanuelCharpentier](#comment%3A118):
> Opinions ? Advice ?

The convenience for users of having a self contained sage distribution (in particular those who are stuck on a system without root access, or distributions without a comprehensive and well-maintained set of mathematical software packages) is important.

Using the distribution's installed packages instead of our own whenever we can is of course desirable, and in fact there is an ongoing effort to do so. See for example Erik's #24919.

Whether we can use some specific version is often times not a question of "interfacing", but to avoid critical bugs; and it seems problematic to build an interface with the purpose of working around bugs. When it is about features rather than bugs, again there is an ongoing effort already, #20382.

These tickets (and related ones) need technical discussion.



---

archive/issue_comments_375143.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nAttachment: **[flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz)**\n\nReplying to [@embray](#comment%3A112):\n> Replying to [@videlec](#comment%3A100):\n> > [EDITED]\n> > \n> > At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)\n> > \n> > - without anything new in `spkg-check` I end up with the same libguile buisness\n> > - with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).\n\n> \n> I didn't get an opportunity to comment on this last night, but FYI you don't need to add `DLPATH_ADD=` to the `make install` call.  Just the first one that says `make verbose`.  That works for me, and the `make check` tests pass.\n\nPerhaps I misunderstood your suggestion but the following does not work on my computer\n\n```diff\ndiff --git a/build/pkgs/flint/spkg-install b/build/pkgs/flint/spkg-install\nindex f6c185433f..29cdbee8f0 100644\n--- a/build/pkgs/flint/spkg-install\n+++ b/build/pkgs/flint/spkg-install\n@@ -38,7 +38,7 @@ if [ $? -ne 0 ]; then\n fi\n \n echo \"Building FLINT shared library.\"\n-$MAKE verbose\n+$MAKE verbose DLPATH_ADD=\n if [ $? -ne 0 ]; then\n     echo >&2 \"Error: Failed to build FLINT shared library.\"\n     exit 1\n```\nThe log of the command `sage -f flint` is [attachment: flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz\u200b.gz](https://github.com/sagemath/sage/files/ticket24575/9ddee2875655dbc26f1851e36e29fa6c.gz).",
    "created_at": "2018-03-09T19:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375143",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'>Comment 2:</a>
Attachment: **[flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz](https://github.com/sagemath/sage/files/ticket24575/flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz)**

Replying to [@embray](#comment%3A112):
> Replying to [@videlec](#comment%3A100):
> > [EDITED]
> > 
> > At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)
> > 
> > - without anything new in `spkg-check` I end up with the same libguile buisness
> > - with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).

> 
> I didn't get an opportunity to comment on this last night, but FYI you don't need to add `DLPATH_ADD=` to the `make install` call.  Just the first one that says `make verbose`.  That works for me, and the `make check` tests pass.

Perhaps I misunderstood your suggestion but the following does not work on my computer

```diff
diff --git a/build/pkgs/flint/spkg-install b/build/pkgs/flint/spkg-install
index f6c185433f..29cdbee8f0 100644
--- a/build/pkgs/flint/spkg-install
+++ b/build/pkgs/flint/spkg-install
@@ -38,7 +38,7 @@ if [ $? -ne 0 ]; then
 fi
 
 echo "Building FLINT shared library."
-$MAKE verbose
+$MAKE verbose DLPATH_ADD=
 if [ $? -ne 0 ]; then
     echo >&2 "Error: Failed to build FLINT shared library."
     exit 1
```
The log of the command `sage -f flint` is [attachment: flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz​.gz](https://github.com/sagemath/sage/files/ticket24575/9ddee2875655dbc26f1851e36e29fa6c.gz).



---

archive/issue_comments_375144.json:
```json
{
    "body": "<a id='comment:123'>Comment 123:</a>\nReplying to [@dimpase](#comment%3A117):\n> The only conclusion I can draw from it that Arch has done something dodgy and very hard to reproduce, the probably screwed up versioning of libgc, by not bumping it up while upgrading, or something similar.\n> (or perhaps gentoo has a different build setup for make+libguile, so that the result is not fragile...)\n\nShared library versioning is certainly a powerful mechanism for a distribution to keep consistency, but it cannot protect against shadowing system libraries by user-installed libraries via LD_LIBRARY_PATH.",
    "created_at": "2018-03-09T22:24:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375144",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:123'>Comment 123:</a>
Replying to [@dimpase](#comment%3A117):
> The only conclusion I can draw from it that Arch has done something dodgy and very hard to reproduce, the probably screwed up versioning of libgc, by not bumping it up while upgrading, or something similar.
> (or perhaps gentoo has a different build setup for make+libguile, so that the result is not fragile...)

Shared library versioning is certainly a powerful mechanism for a distribution to keep consistency, but it cannot protect against shadowing system libraries by user-installed libraries via LD_LIBRARY_PATH.



---

archive/issue_comments_375145.json:
```json
{
    "body": "<a id='comment:124'>Comment 124:</a>\nReplying to [@mkoeppe](#comment%3A119):\n> Replying to [@videlec](#comment%3A111):\n> > Replying to [@mkoeppe](#comment%3A107):\n> > > Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1\n\n> > \n> > With the patch applied, tests run with `DLPATH_ADD=` in `make check`. Could you make it a proper upstream pull request?\n\n> \n> https://github.com/wbhart/flint2/pull/449\n\nSuperseeded by https://github.com/wbhart/flint2/pull/450 (sorry).",
    "created_at": "2018-03-10T16:36:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375145",
    "user": "https://github.com/videlec"
}
```

<a id='comment:124'>Comment 124:</a>
Replying to [@mkoeppe](#comment%3A119):
> Replying to [@videlec](#comment%3A111):
> > Replying to [@mkoeppe](#comment%3A107):
> > > Fix for FLINT is here: https://github.com/mkoeppe/flint2/commit/bd2684891b6da6791ae2f52482a02f5b4cc56bd1

> > 
> > With the patch applied, tests run with `DLPATH_ADD=` in `make check`. Could you make it a proper upstream pull request?

> 
> https://github.com/wbhart/flint2/pull/449

Superseeded by https://github.com/wbhart/flint2/pull/450 (sorry).



---

archive/issue_comments_375146.json:
```json
{
    "body": "<a id='comment:125'>Comment 125:</a>\nReplying to [@EmmanuelCharpentier](#comment%3A118):\n> This ticket is probably not the right place to discuss it ; however, I think it should be opened on sage-devel.\n> \n> Opinions ? Advice ?\n\nWhile I agree with you 100% this is not a new discussion, nor does a discussion really need to be opened on sage-devel (been there done that).  There is already lots of work being done on that from different directions, much of it funded by OpenDreamKit.",
    "created_at": "2018-03-12T15:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375146",
    "user": "https://github.com/embray"
}
```

<a id='comment:125'>Comment 125:</a>
Replying to [@EmmanuelCharpentier](#comment%3A118):
> This ticket is probably not the right place to discuss it ; however, I think it should be opened on sage-devel.
> 
> Opinions ? Advice ?

While I agree with you 100% this is not a new discussion, nor does a discussion really need to be opened on sage-devel (been there done that).  There is already lots of work being done on that from different directions, much of it funded by OpenDreamKit.



---

archive/issue_comments_375147.json:
```json
{
    "body": "<a id='comment:126'>Comment 126:</a>\nReplying to [@videlec](#comment%3A122):\n> Replying to [@embray](#comment%3A112):\n> > Replying to [@videlec](#comment%3A100):\n> > > [EDITED]\n> > > \n> > > At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)\n> > > \n> > > - without anything new in `spkg-check` I end up with the same libguile buisness\n> > > - with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).\n\n> > \n> > I didn't get an opportunity to comment on this last night, but FYI you don't need to add `DLPATH_ADD=` to the `make install` call.  Just the first one that says `make verbose`.  That works for me, and the `make check` tests pass.\n\n> \n> Perhaps I misunderstood your suggestion but the following does not work on my computer\n> \n> ```diff\n> diff --git a/build/pkgs/flint/spkg-install b/build/pkgs/flint/spkg-install\n> index f6c185433f..29cdbee8f0 100644\n> --- a/build/pkgs/flint/spkg-install\n> +++ b/build/pkgs/flint/spkg-install\n> @@ -38,7 +38,7 @@ if [ $? -ne 0 ]; then\n>  fi\n>  \n>  echo \"Building FLINT shared library.\"\n> -$MAKE verbose\n> +$MAKE verbose DLPATH_ADD=\n>  if [ $? -ne 0 ]; then\n>      echo >&2 \"Error: Failed to build FLINT shared library.\"\n>      exit 1\n> ```\n> The log of the command `sage -f flint` is [attachment: flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz\u200b.gz](https://github.com/sagemath/sage/files/ticket24575/9ddee2875655dbc26f1851e36e29fa6c.gz).\n\nExactly this is all I needed for the build to work on arch.",
    "created_at": "2018-03-12T15:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375147",
    "user": "https://github.com/embray"
}
```

<a id='comment:126'>Comment 126:</a>
Replying to [@videlec](#comment%3A122):
> Replying to [@embray](#comment%3A112):
> > Replying to [@videlec](#comment%3A100):
> > > [EDITED]
> > > 
> > > At commit `21442be` flint and arb do not pass their testsuite on my computer (when doing `$ sage -f -c flint` or same with `arb`/`deformation`)
> > > 
> > > - without anything new in `spkg-check` I end up with the same libguile buisness
> > > - with `DLPATH_ADD=` it ends with the tests failing to load `libflint`/`libarb`/`libdeformation` (as I guess they are not installed at the time the tests are run).

> > 
> > I didn't get an opportunity to comment on this last night, but FYI you don't need to add `DLPATH_ADD=` to the `make install` call.  Just the first one that says `make verbose`.  That works for me, and the `make check` tests pass.

> 
> Perhaps I misunderstood your suggestion but the following does not work on my computer
> 
> ```diff
> diff --git a/build/pkgs/flint/spkg-install b/build/pkgs/flint/spkg-install
> index f6c185433f..29cdbee8f0 100644
> --- a/build/pkgs/flint/spkg-install
> +++ b/build/pkgs/flint/spkg-install
> @@ -38,7 +38,7 @@ if [ $? -ne 0 ]; then
>  fi
>  
>  echo "Building FLINT shared library."
> -$MAKE verbose
> +$MAKE verbose DLPATH_ADD=
>  if [ $? -ne 0 ]; then
>      echo >&2 "Error: Failed to build FLINT shared library."
>      exit 1
> ```
> The log of the command `sage -f flint` is [attachment: flint-2.5.2-check_with_DLPATH_ADD_empty_but_not_on_make_install.log.gz​.gz](https://github.com/sagemath/sage/files/ticket24575/9ddee2875655dbc26f1851e36e29fa6c.gz).

Exactly this is all I needed for the build to work on arch.



---

archive/issue_comments_375148.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nDo you actually need any of this, with the new beta merging #23700 ?\nI'm not saying that this branch is not needed, it's merely for understanding the root causes...",
    "created_at": "2018-03-12T15:24:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375148",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'>Comment 7:</a>
Do you actually need any of this, with the new beta merging #23700 ?
I'm not saying that this branch is not needed, it's merely for understanding the root causes...



---

archive/issue_comments_375149.json:
```json
{
    "body": "<a id='comment:128'>Comment 128:</a>\nReplying to [@embray](#comment%3A126):\n> Replying to [@videlec](#comment%3A122):\n> > Perhaps I misunderstood your suggestion but the following does not work on my computer\n\n> Exactly this is all I needed for the build to work on arch.\n\nScratch that--it's not working for me either.  I must have made a mistake when I last tested it (perhaps I forgot to ensure that the `gc` package was installed in sage first).  Now I am getting the same result.",
    "created_at": "2018-03-12T15:50:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375149",
    "user": "https://github.com/embray"
}
```

<a id='comment:128'>Comment 128:</a>
Replying to [@embray](#comment%3A126):
> Replying to [@videlec](#comment%3A122):
> > Perhaps I misunderstood your suggestion but the following does not work on my computer

> Exactly this is all I needed for the build to work on arch.

Scratch that--it's not working for me either.  I must have made a mistake when I last tested it (perhaps I forgot to ensure that the `gc` package was installed in sage first).  Now I am getting the same result.



---

archive/issue_comments_375150.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nThis is going to conflict with #25035: Erik, Vincent, in which order do you think we should handle the two tickets?",
    "created_at": "2018-04-09T08:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375150",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'>Comment 9:</a>
This is going to conflict with #25035: Erik, Vincent, in which order do you think we should handle the two tickets?



---

archive/issue_comments_375151.json:
```json
{
    "body": "<a id='comment:0'>Comment 0:</a>\nI don't have a strong preference. If there is a conflict I can resolve it later.",
    "created_at": "2018-04-09T08:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375151",
    "user": "https://github.com/embray"
}
```

<a id='comment:0'>Comment 0:</a>
I don't have a strong preference. If there is a conflict I can resolve it later.



---

archive/issue_comments_375152.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nLet's finish this ticket by removing the unnecessary `sdh_preload_lib` from the packages with FLINT-like build systems.",
    "created_at": "2018-04-15T11:57:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375152",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'>Comment 1:</a>
Let's finish this ticket by removing the unnecessary `sdh_preload_lib` from the packages with FLINT-like build systems.



---

archive/issue_comments_375153.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nI have created a follow-up ticket for a solution without the `sdh_preload_lib` with R (and rpy2) at #25170.",
    "created_at": "2018-04-15T12:52:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
I have created a follow-up ticket for a solution without the `sdh_preload_lib` with R (and rpy2) at #25170.



---

archive/issue_comments_375154.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBy the way, #24919 provides a prototype for an easy to use (I think) generic mechanism for adding `configure`-time checks for system packages to use in favor of building copies of those packages for sage (just as we currently do for packages like gcc, curl, etc...).\n\nIn the long-term the best solution to this particular issue would be for Sage to not be installing its own libgc unless it absolute has to (which for a modern Arch Linux where this problem is occurring, it probably wouldn't have to, though that also might depend on whether or not one has the develop package installed).  We could also maybe enable header-only installs of some packages.\n\nI'll experiment with adding a configure-time check for libgc on top of #24919.",
    "created_at": "2018-04-18T10:11:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375154",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'>Comment 3:</a>
By the way, #24919 provides a prototype for an easy to use (I think) generic mechanism for adding `configure`-time checks for system packages to use in favor of building copies of those packages for sage (just as we currently do for packages like gcc, curl, etc...).

In the long-term the best solution to this particular issue would be for Sage to not be installing its own libgc unless it absolute has to (which for a modern Arch Linux where this problem is occurring, it probably wouldn't have to, though that also might depend on whether or not one has the develop package installed).  We could also maybe enable header-only installs of some packages.

I'll experiment with adding a configure-time check for libgc on top of #24919.



---

archive/issue_comments_375155.json:
```json
{
    "body": "<a id='comment:134'>Comment 134:</a>\nReplying to [@embray](#comment%3A133):\n> By the way, #24919 provides a prototype for an easy to use (I think) generic mechanism for adding `configure`-time checks for system packages to use in favor of building copies of those packages for sage (just as we currently do for packages like gcc, curl, etc...).\n\nNice!",
    "created_at": "2018-05-01T12:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24575#issuecomment-375155",
    "user": "https://github.com/videlec"
}
```

<a id='comment:134'>Comment 134:</a>
Replying to [@embray](#comment%3A133):
> By the way, #24919 provides a prototype for an easy to use (I think) generic mechanism for adding `configure`-time checks for system packages to use in favor of building copies of those packages for sage (just as we currently do for packages like gcc, curl, etc...).

Nice!



---

archive/issue_events_310733.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-05-30T17:52:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310733"
}
```



---

archive/issue_events_310734.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-05-30T17:52:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310734"
}
```



---

archive/issue_events_310735.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:40:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24575",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24575#event-310735"
}
```
