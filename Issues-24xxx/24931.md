# Issue 24931: py3: get rid of __cmp__ in real_mpfr.pyx

archive/issues_024694.json:
```json
{
    "assignees": [],
    "body": "part of #16537\n\nKeywords: **python3, richcmp**\n\nBranch/Commit: **[b138fe5](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**\n\nReviewer: **Travis Scrimshaw, Jeroen Demeyer**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24931_\n\n",
    "closed_at": "2018-03-22T19:23:33Z",
    "created_at": "2018-03-08T19:50:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: get rid of __cmp__ in real_mpfr.pyx",
    "type": "issue",
    "updated_at": "2018-03-22T19:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/24931",
    "user": "https://github.com/fchapoton"
}
```
part of #16537

Keywords: **python3, richcmp**

Branch/Commit: **[b138fe5](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**

Reviewer: **Travis Scrimshaw, Jeroen Demeyer**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/24931_





---

archive/issue_events_326875.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326875"
}
```



---

archive/issue_events_326876.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "000080",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326876"
}
```



---

archive/issue_events_326877.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326877"
}
```



---

archive/issue_events_326878.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326878"
}
```



---

archive/issue_events_326879.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326879"
}
```



---

archive/issue_comments_382293.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333\">ec67c24</a></td><td><code>get rid of `__cmp__` in real_mpfr.pyx</code></td></tr></table>\n",
    "created_at": "2018-03-08T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382293",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'>Comment 1:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333">ec67c24</a></td><td><code>get rid of `__cmp__` in real_mpfr.pyx</code></td></tr></table>




---

archive/issue_comments_382294.json:
```json
{
    "body": "Commit: **[ec67c24](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)**",
    "created_at": "2018-03-08T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382294",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[ec67c24](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)**



---

archive/issue_comments_382295.json:
```json
{
    "body": "Branch: **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)**",
    "created_at": "2018-03-08T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382295",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)**



---

archive/issue_events_326880.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-03-08T23:16:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326880"
}
```



---

archive/issue_events_326881.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-03-08T23:16:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326881"
}
```



---

archive/issue_comments_382296.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nLGTM.",
    "created_at": "2018-03-08T23:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382296",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'>Comment 2:</a>
LGTM.



---

archive/issue_comments_382297.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-03-08T23:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382297",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_326882.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T07:34:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326882"
}
```



---

archive/issue_events_326883.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T07:34:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326883"
}
```



---

archive/issue_comments_382298.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nHmm, I suspect that one doctest is failing...",
    "created_at": "2018-03-09T07:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382298",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'>Comment 3:</a>
Hmm, I suspect that one doctest is failing...



---

archive/issue_comments_382299.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nSome comments from #24930 apply here too.\n\nAnd it seems that the `__richcmp__` is really only meant to check for equality, so I would add\n\n```\nif op != Py_EQ and op != Py_NE:\n    return NotImplemented\n```",
    "created_at": "2018-03-09T09:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382299",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
Some comments from #24930 apply here too.

And it seems that the `__richcmp__` is really only meant to check for equality, so I would add

```
if op != Py_EQ and op != Py_NE:
    return NotImplemented
```



---

archive/issue_comments_382300.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIndeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.",
    "created_at": "2018-03-09T10:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382300",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'>Comment 5:</a>
Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.



---

archive/issue_comments_382301.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI have:\n\n```diff\ndiff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx\nindex 91d8ad1..e13efa0 100644\n--- a/src/sage/rings/real_mpfr.pyx\n+++ b/src/sage/rings/real_mpfr.pyx\n@@ -737,7 +738,7 @@ cdef class RealField_class(sage.rings.ring.Field):\n             return self.convert_method_map(S, \"_mpfr_\")\n         return self._coerce_map_via([RLF], S)\n\n-    def __cmp__(self, other):\n+    def __eq__(self, other):\n         \"\"\"\n         Compare two real fields, returning ``True`` if they are equivalent\n         and ``False`` if they are not.\n@@ -748,13 +749,13 @@ cdef class RealField_class(sage.rings.ring.Field):\n             False\n             sage: RealField(10) == RealField(10)\n             True\n-            sage: RealField(10,rnd='RNDN') == RealField(10,rnd='RNDZ')\n+            sage: RealField(10, rnd='RNDN') == RealField(10, rnd='RNDZ')\n             False\n\n         Scientific notation affects only printing, not mathematically how\n         the field works, so this does not affect equality testing::\n\n-            sage: RealField(10,sci_not=True) == RealField(10,sci_not=False)\n+            sage: RealField(10, sci_not=True) == RealField(10, sci_not=False)\n             True\n             sage: RealField(10) == IntegerRing()\n             False\n@@ -769,13 +770,11 @@ cdef class RealField_class(sage.rings.ring.Field):\n             True\n         \"\"\"\n         if not isinstance(other, RealField_class):\n-            return -1\n+            return False\n+\n         cdef RealField_class _other\n         _other = other  # to access C structure\n-        if self.__prec == _other.__prec and self.rnd == _other.rnd: \\\n-               #and self.sci_not == _other.sci_not:\n-            return 0\n-        return 1\n+        return self.__prec == _other.__prec and self.rnd == _other.rnd\n```",
    "created_at": "2018-03-09T10:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382301",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'>Comment 6:</a>
I have:

```diff
diff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx
index 91d8ad1..e13efa0 100644
--- a/src/sage/rings/real_mpfr.pyx
+++ b/src/sage/rings/real_mpfr.pyx
@@ -737,7 +738,7 @@ cdef class RealField_class(sage.rings.ring.Field):
             return self.convert_method_map(S, "_mpfr_")
         return self._coerce_map_via([RLF], S)

-    def __cmp__(self, other):
+    def __eq__(self, other):
         """
         Compare two real fields, returning ``True`` if they are equivalent
         and ``False`` if they are not.
@@ -748,13 +749,13 @@ cdef class RealField_class(sage.rings.ring.Field):
             False
             sage: RealField(10) == RealField(10)
             True
-            sage: RealField(10,rnd='RNDN') == RealField(10,rnd='RNDZ')
+            sage: RealField(10, rnd='RNDN') == RealField(10, rnd='RNDZ')
             False

         Scientific notation affects only printing, not mathematically how
         the field works, so this does not affect equality testing::

-            sage: RealField(10,sci_not=True) == RealField(10,sci_not=False)
+            sage: RealField(10, sci_not=True) == RealField(10, sci_not=False)
             True
             sage: RealField(10) == IntegerRing()
             False
@@ -769,13 +770,11 @@ cdef class RealField_class(sage.rings.ring.Field):
             True
         """
         if not isinstance(other, RealField_class):
-            return -1
+            return False
+
         cdef RealField_class _other
         _other = other  # to access C structure
-        if self.__prec == _other.__prec and self.rnd == _other.rnd: \
-               #and self.sci_not == _other.sci_not:
-            return 0
-        return 1
+        return self.__prec == _other.__prec and self.rnd == _other.rnd
```



---

archive/issue_comments_382302.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nReplying to [@embray](#comment%3A5):\n> Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.\n\nFYI: Cython 0.28 is in beta now (#24111).",
    "created_at": "2018-03-09T10:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382302",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Replying to [@embray](#comment%3A5):
> Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.

FYI: Cython 0.28 is in beta now (#24111).



---

archive/issue_comments_382303.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd\">f7cfceb</a></td><td><code>trac 24931 enhancements and corrections</code></td></tr></table>\n",
    "created_at": "2018-03-09T18:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382303",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd">f7cfceb</a></td><td><code>trac 24931 enhancements and corrections</code></td></tr></table>




---

archive/issue_comments_382304.json:
```json
{
    "body": "Changed commit from **[ec67c24](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)** to **[f7cfceb](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)**",
    "created_at": "2018-03-09T18:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382304",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ec67c24](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)** to **[f7cfceb](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)**



---

archive/issue_events_326884.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T18:31:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326884"
}
```



---

archive/issue_events_326885.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T18:31:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326885"
}
```



---

archive/issue_events_326886.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-12T15:32:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326886"
}
```



---

archive/issue_events_326887.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-12T15:32:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326887"
}
```



---

archive/issue_comments_382305.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nIt doesn't make sense to use `rich_to_bool` here at all.  All you need is \n`return (self.__prec == _other.__prec and self.rnd == _other.rnd) == (op == Py_EQ)`",
    "created_at": "2018-03-12T15:32:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382305",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'>Comment 10:</a>
It doesn't make sense to use `rich_to_bool` here at all.  All you need is 
`return (self.__prec == _other.__prec and self.rnd == _other.rnd) == (op == Py_EQ)`



---

archive/issue_comments_382306.json:
```json
{
    "body": "Changed commit from **[f7cfceb](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)** to **[b138fe5](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**",
    "created_at": "2018-03-13T07:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382306",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f7cfceb](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)** to **[b138fe5](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**



---

archive/issue_comments_382307.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4cc1f5caa67b5a296c7f10ce9ee141b9a2b8a16\">b4cc1f5</a></td><td><code>Merge branch 'u/chapoton/24931' in 8.2.b8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39\">b138fe5</a></td><td><code>trac 23931 detail</code></td></tr></table>\n",
    "created_at": "2018-03-13T07:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382307",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4cc1f5caa67b5a296c7f10ce9ee141b9a2b8a16">b4cc1f5</a></td><td><code>Merge branch 'u/chapoton/24931' in 8.2.b8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39">b138fe5</a></td><td><code>trac 23931 detail</code></td></tr></table>




---

archive/issue_events_326888.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-13T07:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326888"
}
```



---

archive/issue_events_326889.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-13T07:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326889"
}
```



---

archive/issue_comments_382308.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nthanks, done",
    "created_at": "2018-03-13T07:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382308",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'>Comment 12:</a>
thanks, done



---

archive/issue_comments_382309.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nRight now you have:\n\n```python\nif not isinstance(other, RealField_class):\n    return NotImplemented\n```\n\nwhich I think was Jeroen's suggestion.  The reason for this is that it will delegate comparison to the class of the right-side object if it is not an instance of `RealField_class`.  So that sort of makes sense.  But I'm concerned about making that the general approach.  \n\nFor example, the tests contain:\n\n```\n    sage: RealField(10) == IntegerRing()\n    False\n```\n\nwhich currently will work.  But why, then, isn't the same logic applied in `IntegerRing`?  Currently its `__richcmp__` is (somewhat arbitrarily?) implemented rather differently:\n\n```python\n    def __richcmp__(left, right, int op):\n        \"\"\"\n        Rich comparison of ``left`` and ``right``.\n\n        TESTS::\n\n            sage: from sage.rings.integer_ring import IntegerRing_class\n            sage: ZZ == ZZ\n            True\n            sage: ZZ != QQ\n            True\n        \"\"\"\n        if left is right:\n            return rich_to_bool(op, 0)\n\n        if isinstance(right, IntegerRing_class):\n            return rich_to_bool(op, 0)\n\n        if isinstance(right, sage.rings.rational_field.RationalField):\n            return rich_to_bool(op, -1)\n\n        return op == Py_NE\n```\n\nThat sort of grew out of the old implementation of `IntegerRing_class._cmp_`, but I don't think this is really right either.  Just as in the case of `RealField_class`, this seems to mostly just care about equality (though it seems it should also return less than `RationalField`? What's that about?).\n\nIf `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.\n\nSo my question becomes, should a class always delegate rich comparison to the other object, and if not when should it and when shouldn't it?",
    "created_at": "2018-03-13T11:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382309",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'>Comment 13:</a>
Right now you have:

```python
if not isinstance(other, RealField_class):
    return NotImplemented
```

which I think was Jeroen's suggestion.  The reason for this is that it will delegate comparison to the class of the right-side object if it is not an instance of `RealField_class`.  So that sort of makes sense.  But I'm concerned about making that the general approach.  

For example, the tests contain:

```
    sage: RealField(10) == IntegerRing()
    False
```

which currently will work.  But why, then, isn't the same logic applied in `IntegerRing`?  Currently its `__richcmp__` is (somewhat arbitrarily?) implemented rather differently:

```python
    def __richcmp__(left, right, int op):
        """
        Rich comparison of ``left`` and ``right``.

        TESTS::

            sage: from sage.rings.integer_ring import IntegerRing_class
            sage: ZZ == ZZ
            True
            sage: ZZ != QQ
            True
        """
        if left is right:
            return rich_to_bool(op, 0)

        if isinstance(right, IntegerRing_class):
            return rich_to_bool(op, 0)

        if isinstance(right, sage.rings.rational_field.RationalField):
            return rich_to_bool(op, -1)

        return op == Py_NE
```

That sort of grew out of the old implementation of `IntegerRing_class._cmp_`, but I don't think this is really right either.  Just as in the case of `RealField_class`, this seems to mostly just care about equality (though it seems it should also return less than `RationalField`? What's that about?).

If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.

So my question becomes, should a class always delegate rich comparison to the other object, and if not when should it and when shouldn't it?



---

archive/issue_comments_382310.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@embray](#comment%3A13): \n> If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.\n\n\nI'm sorry, I was wrong here (though I cannot for the life of me find where this is actually documented).  If both `a.__eq__(b)` and `b.__eq__(a)` return `NotImplemented`, then Python falls back on the default comparison which is by `id()`.  I think that's also the case (in reverse) for `__ne__`.  It's only in the case of the ordering operators where it raises `TypeError`.\n\nI think that clarifies things for me then.  We should probably change `IntegerRing_class.__richcmp__` to be more consistent, but this is fine as is.\n\nEvery time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.",
    "created_at": "2018-03-13T12:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382310",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@embray](#comment%3A13): 
> If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.


I'm sorry, I was wrong here (though I cannot for the life of me find where this is actually documented).  If both `a.__eq__(b)` and `b.__eq__(a)` return `NotImplemented`, then Python falls back on the default comparison which is by `id()`.  I think that's also the case (in reverse) for `__ne__`.  It's only in the case of the ordering operators where it raises `TypeError`.

I think that clarifies things for me then.  We should probably change `IntegerRing_class.__richcmp__` to be more consistent, but this is fine as is.

Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.



---

archive/issue_comments_382311.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nso, positive review ?",
    "created_at": "2018-03-13T12:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382311",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'>Comment 15:</a>
so, positive review ?



---

archive/issue_comments_382312.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@embray](#comment%3A14):\n> Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.\n\nMaybe it's also because it works quite different in Python 2 and Python 3?",
    "created_at": "2018-03-13T13:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382312",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@embray](#comment%3A14):
> Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.

Maybe it's also because it works quite different in Python 2 and Python 3?



---

archive/issue_events_326890.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-13T13:05:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326890"
}
```



---

archive/issue_events_326891.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-13T13:05:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326891"
}
```



---

archive/issue_comments_382313.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Jeroen Demeyer**",
    "created_at": "2018-03-13T13:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382313",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Jeroen Demeyer**



---

archive/issue_comments_382314.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@jdemeyer](#comment%3A16):\n> Replying to [@embray](#comment%3A14):\n> > Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.\n\n> \n> Maybe it's also because it works quite different in Python 2 and Python 3?\n\nIt does, and it's hard to keep straight.  I thought the fallback behavior for equality, for example, was only on Python 2 (when in fact I was probably just thinking about the fallback for ordered comparisons).",
    "created_at": "2018-03-13T13:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382314",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@jdemeyer](#comment%3A16):
> Replying to [@embray](#comment%3A14):
> > Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.

> 
> Maybe it's also because it works quite different in Python 2 and Python 3?

It does, and it's hard to keep straight.  I thought the fallback behavior for equality, for example, was only on Python 2 (when in fact I was probably just thinking about the fallback for ordered comparisons).



---

archive/issue_events_326892.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-22T19:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326892"
}
```



---

archive/issue_events_326893.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "245c41619c7d16a0de11556ac555d7c6254dfded",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-03-22T19:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-326893"
}
```



---

archive/issue_comments_382315.json:
```json
{
    "body": "Changed branch from **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)** to **[b138fe5](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**",
    "created_at": "2018-03-22T19:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-382315",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)** to **[b138fe5](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**
