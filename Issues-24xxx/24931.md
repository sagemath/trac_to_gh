# Issue 24931: py3: get rid of __cmp__ in real_mpfr.pyx

archive/issues_024694.json:
```json
{
    "body": "part of #16537\n\n**Keywords:** python3, richcmp\n\n**Branch/Commit:** [b138fe51eb9302d95b7c4287ebe4510e77bbca39](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)\n\n**Reviewer:** Travis Scrimshaw, Jeroen Demeyer\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/24931\n\n",
    "closed_at": "2018-03-22T19:23:33Z",
    "created_at": "2018-03-08T19:50:01Z",
    "labels": [
        "component: python3",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "py3: get rid of __cmp__ in real_mpfr.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24931",
    "user": "https://github.com/fchapoton"
}
```
part of #16537

**Keywords:** python3, richcmp

**Branch/Commit:** [b138fe51eb9302d95b7c4287ebe4510e77bbca39](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)

**Reviewer:** Travis Scrimshaw, Jeroen Demeyer

**Author:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/24931





---

archive/issue_comments_453153.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-03-08T19:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453153",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_453154.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333\">ec67c24</a></td><td><code>get rid of __cmp__ in real_mpfr.pyx</code></td></tr></table>\n",
    "created_at": "2018-03-08T19:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453154",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333">ec67c24</a></td><td><code>get rid of __cmp__ in real_mpfr.pyx</code></td></tr></table>




---

archive/issue_comments_453155.json:
```json
{
    "body": "**Commit:** [ec67c243b6947ef72514352d582eee0533859333](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)",
    "created_at": "2018-03-08T19:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453155",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [ec67c243b6947ef72514352d582eee0533859333](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)



---

archive/issue_comments_453156.json:
```json
{
    "body": "**Branch:** [u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)",
    "created_at": "2018-03-08T19:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453156",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)



---

archive/issue_comments_453157.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-03-08T23:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453157",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_453158.json:
```json
{
    "body": "<a id='comment:2'></a>\nLGTM.",
    "created_at": "2018-03-08T23:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453158",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
LGTM.



---

archive/issue_comments_453159.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-03-08T23:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453159",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_453160.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2018-03-09T07:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453160",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_453161.json:
```json
{
    "body": "<a id='comment:3'></a>\nHmm, I suspect that one doctest is failing...",
    "created_at": "2018-03-09T07:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453161",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
Hmm, I suspect that one doctest is failing...



---

archive/issue_comments_453162.json:
```json
{
    "body": "<a id='comment:4'></a>\nSome comments from #24930 apply here too.\n\nAnd it seems that the `__richcmp__` is really only meant to check for equality, so I would add\n\n```\nif op != Py_EQ and op != Py_NE:\n    return NotImplemented\n```",
    "created_at": "2018-03-09T09:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453162",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Some comments from #24930 apply here too.

And it seems that the `__richcmp__` is really only meant to check for equality, so I would add

```
if op != Py_EQ and op != Py_NE:
    return NotImplemented
```



---

archive/issue_comments_453163.json:
```json
{
    "body": "<a id='comment:5'></a>\nIndeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.",
    "created_at": "2018-03-09T10:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453163",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.



---

archive/issue_comments_453164.json:
```json
{
    "body": "<a id='comment:6'></a>\nI have:\n\n```diff\ndiff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx\nindex 91d8ad1..e13efa0 100644\n--- a/src/sage/rings/real_mpfr.pyx\n+++ b/src/sage/rings/real_mpfr.pyx\n@@ -737,7 +738,7 @@ cdef class RealField_class(sage.rings.ring.Field):\n             return self.convert_method_map(S, \"_mpfr_\")\n         return self._coerce_map_via([RLF], S)\n\n-    def __cmp__(self, other):\n+    def __eq__(self, other):\n         \"\"\"\n         Compare two real fields, returning ``True`` if they are equivalent\n         and ``False`` if they are not.\n@@ -748,13 +749,13 @@ cdef class RealField_class(sage.rings.ring.Field):\n             False\n             sage: RealField(10) == RealField(10)\n             True\n-            sage: RealField(10,rnd='RNDN') == RealField(10,rnd='RNDZ')\n+            sage: RealField(10, rnd='RNDN') == RealField(10, rnd='RNDZ')\n             False\n\n         Scientific notation affects only printing, not mathematically how\n         the field works, so this does not affect equality testing::\n\n-            sage: RealField(10,sci_not=True) == RealField(10,sci_not=False)\n+            sage: RealField(10, sci_not=True) == RealField(10, sci_not=False)\n             True\n             sage: RealField(10) == IntegerRing()\n             False\n@@ -769,13 +770,11 @@ cdef class RealField_class(sage.rings.ring.Field):\n             True\n         \"\"\"\n         if not isinstance(other, RealField_class):\n-            return -1\n+            return False\n+\n         cdef RealField_class _other\n         _other = other  # to access C structure\n-        if self.__prec == _other.__prec and self.rnd == _other.rnd: \\\n-               #and self.sci_not == _other.sci_not:\n-            return 0\n-        return 1\n+        return self.__prec == _other.__prec and self.rnd == _other.rnd\n```",
    "created_at": "2018-03-09T10:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453164",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I have:

```diff
diff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx
index 91d8ad1..e13efa0 100644
--- a/src/sage/rings/real_mpfr.pyx
+++ b/src/sage/rings/real_mpfr.pyx
@@ -737,7 +738,7 @@ cdef class RealField_class(sage.rings.ring.Field):
             return self.convert_method_map(S, "_mpfr_")
         return self._coerce_map_via([RLF], S)

-    def __cmp__(self, other):
+    def __eq__(self, other):
         """
         Compare two real fields, returning ``True`` if they are equivalent
         and ``False`` if they are not.
@@ -748,13 +749,13 @@ cdef class RealField_class(sage.rings.ring.Field):
             False
             sage: RealField(10) == RealField(10)
             True
-            sage: RealField(10,rnd='RNDN') == RealField(10,rnd='RNDZ')
+            sage: RealField(10, rnd='RNDN') == RealField(10, rnd='RNDZ')
             False

         Scientific notation affects only printing, not mathematically how
         the field works, so this does not affect equality testing::

-            sage: RealField(10,sci_not=True) == RealField(10,sci_not=False)
+            sage: RealField(10, sci_not=True) == RealField(10, sci_not=False)
             True
             sage: RealField(10) == IntegerRing()
             False
@@ -769,13 +770,11 @@ cdef class RealField_class(sage.rings.ring.Field):
             True
         """
         if not isinstance(other, RealField_class):
-            return -1
+            return False
+
         cdef RealField_class _other
         _other = other  # to access C structure
-        if self.__prec == _other.__prec and self.rnd == _other.rnd: \
-               #and self.sci_not == _other.sci_not:
-            return 0
-        return 1
+        return self.__prec == _other.__prec and self.rnd == _other.rnd
```



---

archive/issue_comments_453165.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [embray](#comment%3A5):\n> Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.\n\n\nFYI: Cython 0.28 is in beta now (#24111).",
    "created_at": "2018-03-09T10:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453165",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [embray](#comment%3A5):
> Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.


FYI: Cython 0.28 is in beta now (#24111).



---

archive/issue_comments_453166.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd\">f7cfceb</a></td><td><code>trac 24931 enhancements and corrections</code></td></tr></table>\n",
    "created_at": "2018-03-09T18:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd">f7cfceb</a></td><td><code>trac 24931 enhancements and corrections</code></td></tr></table>




---

archive/issue_comments_453167.json:
```json
{
    "body": "**Changing commit** from \"[ec67c243b6947ef72514352d582eee0533859333](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)\" to \"[f7cfcebdce9a9d9845b88a546616174f80ada9bd](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)\".",
    "created_at": "2018-03-09T18:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453167",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ec67c243b6947ef72514352d582eee0533859333](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)" to "[f7cfcebdce9a9d9845b88a546616174f80ada9bd](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)".



---

archive/issue_comments_453168.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-03-09T18:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453168",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_453169.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-03-12T15:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453169",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_453170.json:
```json
{
    "body": "<a id='comment:10'></a>\nIt doesn't make sense to use `rich_to_bool` here at all.  All you need is \n`return (self.__prec == _other.__prec and self.rnd == _other.rnd) == (op == Py_EQ)`",
    "created_at": "2018-03-12T15:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453170",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
It doesn't make sense to use `rich_to_bool` here at all.  All you need is 
`return (self.__prec == _other.__prec and self.rnd == _other.rnd) == (op == Py_EQ)`



---

archive/issue_comments_453171.json:
```json
{
    "body": "**Changing commit** from \"[f7cfcebdce9a9d9845b88a546616174f80ada9bd](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)\" to \"[b138fe51eb9302d95b7c4287ebe4510e77bbca39](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)\".",
    "created_at": "2018-03-13T07:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453171",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f7cfcebdce9a9d9845b88a546616174f80ada9bd](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)" to "[b138fe51eb9302d95b7c4287ebe4510e77bbca39](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)".



---

archive/issue_comments_453172.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4cc1f5caa67b5a296c7f10ce9ee141b9a2b8a16\">b4cc1f5</a></td><td><code>Merge branch 'u/chapoton/24931' in 8.2.b8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39\">b138fe5</a></td><td><code>trac 23931 detail</code></td></tr></table>\n",
    "created_at": "2018-03-13T07:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4cc1f5caa67b5a296c7f10ce9ee141b9a2b8a16">b4cc1f5</a></td><td><code>Merge branch 'u/chapoton/24931' in 8.2.b8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39">b138fe5</a></td><td><code>trac 23931 detail</code></td></tr></table>




---

archive/issue_comments_453173.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-03-13T07:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453173",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_453174.json:
```json
{
    "body": "<a id='comment:12'></a>\nthanks, done",
    "created_at": "2018-03-13T07:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453174",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
thanks, done



---

archive/issue_comments_453175.json:
```json
{
    "body": "<a id='comment:13'></a>\nRight now you have:\n\n```python\nif not isinstance(other, RealField_class):\n    return NotImplemented\n```\n\nwhich I think was Jeroen's suggestion.  The reason for this is that it will delegate comparison to the class of the right-side object if it is not an instance of `RealField_class`.  So that sort of makes sense.  But I'm concerned about making that the general approach.  \n\nFor example, the tests contain:\n\n```\n    sage: RealField(10) == IntegerRing()\n    False\n```\n\nwhich currently will work.  But why, then, isn't the same logic applied in `IntegerRing`?  Currently its `__richcmp__` is (somewhat arbitrarily?) implemented rather differently:\n\n```python\n    def __richcmp__(left, right, int op):\n        \"\"\"\n        Rich comparison of ``left`` and ``right``.\n\n        TESTS::\n\n            sage: from sage.rings.integer_ring import IntegerRing_class\n            sage: ZZ == ZZ\n            True\n            sage: ZZ != QQ\n            True\n        \"\"\"\n        if left is right:\n            return rich_to_bool(op, 0)\n\n        if isinstance(right, IntegerRing_class):\n            return rich_to_bool(op, 0)\n\n        if isinstance(right, sage.rings.rational_field.RationalField):\n            return rich_to_bool(op, -1)\n\n        return op == Py_NE\n```\n\nThat sort of grew out of the old implementation of `IntegerRing_class._cmp_`, but I don't think this is really right either.  Just as in the case of `RealField_class`, this seems to mostly just care about equality (though it seems it should also return less than `RationalField`? What's that about?).\n\nIf `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.\n\nSo my question becomes, should a class always delegate rich comparison to the other object, and if not when should it and when shouldn't it?",
    "created_at": "2018-03-13T11:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453175",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
Right now you have:

```python
if not isinstance(other, RealField_class):
    return NotImplemented
```

which I think was Jeroen's suggestion.  The reason for this is that it will delegate comparison to the class of the right-side object if it is not an instance of `RealField_class`.  So that sort of makes sense.  But I'm concerned about making that the general approach.  

For example, the tests contain:

```
    sage: RealField(10) == IntegerRing()
    False
```

which currently will work.  But why, then, isn't the same logic applied in `IntegerRing`?  Currently its `__richcmp__` is (somewhat arbitrarily?) implemented rather differently:

```python
    def __richcmp__(left, right, int op):
        """
        Rich comparison of ``left`` and ``right``.

        TESTS::

            sage: from sage.rings.integer_ring import IntegerRing_class
            sage: ZZ == ZZ
            True
            sage: ZZ != QQ
            True
        """
        if left is right:
            return rich_to_bool(op, 0)

        if isinstance(right, IntegerRing_class):
            return rich_to_bool(op, 0)

        if isinstance(right, sage.rings.rational_field.RationalField):
            return rich_to_bool(op, -1)

        return op == Py_NE
```

That sort of grew out of the old implementation of `IntegerRing_class._cmp_`, but I don't think this is really right either.  Just as in the case of `RealField_class`, this seems to mostly just care about equality (though it seems it should also return less than `RationalField`? What's that about?).

If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.

So my question becomes, should a class always delegate rich comparison to the other object, and if not when should it and when shouldn't it?



---

archive/issue_comments_453176.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [embray](#comment%3A13): \n> If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.\n\n\n\nI'm sorry, I was wrong here (though I cannot for the life of me find where this is actually documented).  If both `a.__eq__(b)` and `b.__eq__(a)` return `NotImplemented`, then Python falls back on the default comparison which is by `id()`.  I think that's also the case (in reverse) for `__ne__`.  It's only in the case of the ordering operators where it raises `TypeError`.\n\nI think that clarifies things for me then.  We should probably change `IntegerRing_class.__richcmp__` to be more consistent, but this is fine as is.\n\nEvery time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.",
    "created_at": "2018-03-13T12:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453176",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Replying to [embray](#comment%3A13): 
> If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.



I'm sorry, I was wrong here (though I cannot for the life of me find where this is actually documented).  If both `a.__eq__(b)` and `b.__eq__(a)` return `NotImplemented`, then Python falls back on the default comparison which is by `id()`.  I think that's also the case (in reverse) for `__ne__`.  It's only in the case of the ordering operators where it raises `TypeError`.

I think that clarifies things for me then.  We should probably change `IntegerRing_class.__richcmp__` to be more consistent, but this is fine as is.

Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.



---

archive/issue_comments_453177.json:
```json
{
    "body": "<a id='comment:15'></a>\nso, positive review ?",
    "created_at": "2018-03-13T12:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453177",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
so, positive review ?



---

archive/issue_comments_453178.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [embray](#comment%3A14):\n> Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.\n\n\nMaybe it's also because it works quite different in Python 2 and Python 3?",
    "created_at": "2018-03-13T13:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453178",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [embray](#comment%3A14):
> Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.


Maybe it's also because it works quite different in Python 2 and Python 3?



---

archive/issue_comments_453179.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-03-13T13:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453179",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_453180.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Jeroen Demeyer\".",
    "created_at": "2018-03-13T13:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453180",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, Jeroen Demeyer".



---

archive/issue_comments_453181.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A16):\n> Replying to [embray](#comment%3A14):\n> > Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.\n\n> \n> Maybe it's also because it works quite different in Python 2 and Python 3?\n\n\nIt does, and it's hard to keep straight.  I thought the fallback behavior for equality, for example, was only on Python 2 (when in fact I was probably just thinking about the fallback for ordered comparisons).",
    "created_at": "2018-03-13T13:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453181",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A16):
> Replying to [embray](#comment%3A14):
> > Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.

> 
> Maybe it's also because it works quite different in Python 2 and Python 3?


It does, and it's hard to keep straight.  I thought the fallback behavior for equality, for example, was only on Python 2 (when in fact I was probably just thinking about the fallback for ordered comparisons).



---

archive/issue_events_071469.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-22T19:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24931#event-71469"
}
```



---

archive/issue_comments_453182.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)\" to \"[b138fe51eb9302d95b7c4287ebe4510e77bbca39](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)\".",
    "created_at": "2018-03-22T19:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24931#issuecomment-453182",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)" to "[b138fe51eb9302d95b7c4287ebe4510e77bbca39](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)".
