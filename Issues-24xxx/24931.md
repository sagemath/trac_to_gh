# Issue 24931: py3: get rid of __cmp__ in real_mpfr.pyx

archive/issues_024694.json:
```json
{
    "assignees": [],
    "body": "part of #16537\n\nKeywords: **richcmp**\n\nBranch/Commit: **[`b138fe5`](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**\n\nReviewer: **Travis Scrimshaw, Jeroen Demeyer**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24931_\n\n",
    "closed_at": "2018-03-22T19:23:33Z",
    "created_at": "2018-03-08T19:50:01Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20python3"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: get rid of __cmp__ in real_mpfr.pyx",
    "type": "issue",
    "updated_at": "2018-03-22T19:23:33Z",
    "url": "https://github.com/sagemath/sage/issues/24931",
    "user": "https://github.com/fchapoton"
}
```
part of #16537

Keywords: **richcmp**

Branch/Commit: **[`b138fe5`](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**

Reviewer: **Travis Scrimshaw, Jeroen Demeyer**

Author: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/24931_





---

archive/issue_events_341947.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341947"
}
```



---

archive/issue_events_341948.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341948"
}
```



---

archive/issue_events_341949.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341949"
}
```



---

archive/issue_events_341950.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341950"
}
```



---

archive/issue_events_341951.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341951"
}
```



---

archive/issue_events_341952.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-08T19:50:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341952"
}
```



---

archive/issue_comments_379510.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333\"><code>ec67c24</code></a></td><td><code>get rid of `__cmp__` in real_mpfr.pyx</code></td></tr></table>\n",
    "created_at": "2018-03-08T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379510",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333"><code>ec67c24</code></a></td><td><code>get rid of `__cmp__` in real_mpfr.pyx</code></td></tr></table>




---

archive/issue_comments_379511.json:
```json
{
    "body": "Commit: **[`ec67c24`](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)**",
    "created_at": "2018-03-08T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379511",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`ec67c24`](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)**



---

archive/issue_comments_379512.json:
```json
{
    "body": "Branch: **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)**",
    "created_at": "2018-03-08T19:50:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379512",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)**



---

archive/issue_events_341953.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-03-08T23:16:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341953"
}
```



---

archive/issue_events_341954.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-03-08T23:16:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341954"
}
```



---

archive/issue_comments_379513.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nLGTM.",
    "created_at": "2018-03-08T23:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379513",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

LGTM.



---

archive/issue_comments_379514.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-03-08T23:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379514",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_341955.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T07:34:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341955"
}
```



---

archive/issue_events_341956.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T07:34:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341956"
}
```



---

archive/issue_comments_379515.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHmm, I suspect that one doctest is failing...",
    "created_at": "2018-03-09T07:34:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379515",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

Hmm, I suspect that one doctest is failing...



---

archive/issue_comments_379516.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSome comments from #24930 apply here too.\n\nAnd it seems that the `__richcmp__` is really only meant to check for equality, so I would add\n\n```\nif op != Py_EQ and op != Py_NE:\n    return NotImplemented\n```",
    "created_at": "2018-03-09T09:23:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379516",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Some comments from #24930 apply here too.

And it seems that the `__richcmp__` is really only meant to check for equality, so I would add

```
if op != Py_EQ and op != Py_NE:
    return NotImplemented
```



---

archive/issue_comments_379517.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIndeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.",
    "created_at": "2018-03-09T10:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379517",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.



---

archive/issue_comments_379518.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI have:\n\n```diff\ndiff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx\nindex 91d8ad1..e13efa0 100644\n--- a/src/sage/rings/real_mpfr.pyx\n+++ b/src/sage/rings/real_mpfr.pyx\n@@ -737,7 +738,7 @@ cdef class RealField_class(sage.rings.ring.Field):\n             return self.convert_method_map(S, \"_mpfr_\")\n         return self._coerce_map_via([RLF], S)\n\n-    def __cmp__(self, other):\n+    def __eq__(self, other):\n         \"\"\"\n         Compare two real fields, returning ``True`` if they are equivalent\n         and ``False`` if they are not.\n@@ -748,13 +749,13 @@ cdef class RealField_class(sage.rings.ring.Field):\n             False\n             sage: RealField(10) == RealField(10)\n             True\n-            sage: RealField(10,rnd='RNDN') == RealField(10,rnd='RNDZ')\n+            sage: RealField(10, rnd='RNDN') == RealField(10, rnd='RNDZ')\n             False\n\n         Scientific notation affects only printing, not mathematically how\n         the field works, so this does not affect equality testing::\n\n-            sage: RealField(10,sci_not=True) == RealField(10,sci_not=False)\n+            sage: RealField(10, sci_not=True) == RealField(10, sci_not=False)\n             True\n             sage: RealField(10) == IntegerRing()\n             False\n@@ -769,13 +770,11 @@ cdef class RealField_class(sage.rings.ring.Field):\n             True\n         \"\"\"\n         if not isinstance(other, RealField_class):\n-            return -1\n+            return False\n+\n         cdef RealField_class _other\n         _other = other  # to access C structure\n-        if self.__prec == _other.__prec and self.rnd == _other.rnd: \\\n-               #and self.sci_not == _other.sci_not:\n-            return 0\n-        return 1\n+        return self.__prec == _other.__prec and self.rnd == _other.rnd\n```",
    "created_at": "2018-03-09T10:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379518",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

I have:

```diff
diff --git a/src/sage/rings/real_mpfr.pyx b/src/sage/rings/real_mpfr.pyx
index 91d8ad1..e13efa0 100644
--- a/src/sage/rings/real_mpfr.pyx
+++ b/src/sage/rings/real_mpfr.pyx
@@ -737,7 +738,7 @@ cdef class RealField_class(sage.rings.ring.Field):
             return self.convert_method_map(S, "_mpfr_")
         return self._coerce_map_via([RLF], S)

-    def __cmp__(self, other):
+    def __eq__(self, other):
         """
         Compare two real fields, returning ``True`` if they are equivalent
         and ``False`` if they are not.
@@ -748,13 +749,13 @@ cdef class RealField_class(sage.rings.ring.Field):
             False
             sage: RealField(10) == RealField(10)
             True
-            sage: RealField(10,rnd='RNDN') == RealField(10,rnd='RNDZ')
+            sage: RealField(10, rnd='RNDN') == RealField(10, rnd='RNDZ')
             False

         Scientific notation affects only printing, not mathematically how
         the field works, so this does not affect equality testing::

-            sage: RealField(10,sci_not=True) == RealField(10,sci_not=False)
+            sage: RealField(10, sci_not=True) == RealField(10, sci_not=False)
             True
             sage: RealField(10) == IntegerRing()
             False
@@ -769,13 +770,11 @@ cdef class RealField_class(sage.rings.ring.Field):
             True
         """
         if not isinstance(other, RealField_class):
-            return -1
+            return False
+
         cdef RealField_class _other
         _other = other  # to access C structure
-        if self.__prec == _other.__prec and self.rnd == _other.rnd: \
-               #and self.sci_not == _other.sci_not:
-            return 0
-        return 1
+        return self.__prec == _other.__prec and self.rnd == _other.rnd
```



---

archive/issue_comments_379519.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@embray](#comment:5):\n> Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.\n\nFYI: Cython 0.28 is in beta now (#24111).",
    "created_at": "2018-03-09T10:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379519",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@embray](#comment:5):
> Indeed. I don't think you even need the full `__richcmp__`.  I implemented this just as an `__eq__`, but for that to work requires Cython 0.28 or a patched Cython.

FYI: Cython 0.28 is in beta now (#24111).



---

archive/issue_comments_379520.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd\"><code>f7cfceb</code></a></td><td><code>trac 24931 enhancements and corrections</code></td></tr></table>\n",
    "created_at": "2018-03-09T18:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379520",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd"><code>f7cfceb</code></a></td><td><code>trac 24931 enhancements and corrections</code></td></tr></table>




---

archive/issue_comments_379521.json:
```json
{
    "body": "Changed commit from **[`ec67c24`](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)** to **[`f7cfceb`](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)**",
    "created_at": "2018-03-09T18:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379521",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ec67c24`](https://github.com/sagemath/sagetrac-mirror/commit/ec67c243b6947ef72514352d582eee0533859333)** to **[`f7cfceb`](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)**



---

archive/issue_events_341957.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T18:31:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341957"
}
```



---

archive/issue_events_341958.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-09T18:31:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341958"
}
```



---

archive/issue_events_341959.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-12T15:32:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341959"
}
```



---

archive/issue_events_341960.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-12T15:32:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341960"
}
```



---

archive/issue_comments_379522.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIt doesn't make sense to use `rich_to_bool` here at all.  All you need is \n`return (self.__prec == _other.__prec and self.rnd == _other.rnd) == (op == Py_EQ)`",
    "created_at": "2018-03-12T15:32:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379522",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

It doesn't make sense to use `rich_to_bool` here at all.  All you need is 
`return (self.__prec == _other.__prec and self.rnd == _other.rnd) == (op == Py_EQ)`



---

archive/issue_comments_379523.json:
```json
{
    "body": "Changed commit from **[`f7cfceb`](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)** to **[`b138fe5`](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**",
    "created_at": "2018-03-13T07:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379523",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f7cfceb`](https://github.com/sagemath/sagetrac-mirror/commit/f7cfcebdce9a9d9845b88a546616174f80ada9bd)** to **[`b138fe5`](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**



---

archive/issue_comments_379524.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4cc1f5caa67b5a296c7f10ce9ee141b9a2b8a16\"><code>b4cc1f5</code></a></td><td><code>Merge branch 'u/chapoton/24931' in 8.2.b8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39\"><code>b138fe5</code></a></td><td><code>trac 23931 detail</code></td></tr></table>\n",
    "created_at": "2018-03-13T07:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379524",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4cc1f5caa67b5a296c7f10ce9ee141b9a2b8a16"><code>b4cc1f5</code></a></td><td><code>Merge branch 'u/chapoton/24931' in 8.2.b8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39"><code>b138fe5</code></a></td><td><code>trac 23931 detail</code></td></tr></table>




---

archive/issue_events_341961.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-13T07:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341961"
}
```



---

archive/issue_events_341962.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-03-13T07:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341962"
}
```



---

archive/issue_comments_379525.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nthanks, done",
    "created_at": "2018-03-13T07:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379525",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

thanks, done



---

archive/issue_comments_379526.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nRight now you have:\n\n```python\nif not isinstance(other, RealField_class):\n    return NotImplemented\n```\n\nwhich I think was Jeroen's suggestion.  The reason for this is that it will delegate comparison to the class of the right-side object if it is not an instance of `RealField_class`.  So that sort of makes sense.  But I'm concerned about making that the general approach.  \n\nFor example, the tests contain:\n\n```\n    sage: RealField(10) == IntegerRing()\n    False\n```\n\nwhich currently will work.  But why, then, isn't the same logic applied in `IntegerRing`?  Currently its `__richcmp__` is (somewhat arbitrarily?) implemented rather differently:\n\n```python\n    def __richcmp__(left, right, int op):\n        \"\"\"\n        Rich comparison of ``left`` and ``right``.\n\n        TESTS::\n\n            sage: from sage.rings.integer_ring import IntegerRing_class\n            sage: ZZ == ZZ\n            True\n            sage: ZZ != QQ\n            True\n        \"\"\"\n        if left is right:\n            return rich_to_bool(op, 0)\n\n        if isinstance(right, IntegerRing_class):\n            return rich_to_bool(op, 0)\n\n        if isinstance(right, sage.rings.rational_field.RationalField):\n            return rich_to_bool(op, -1)\n\n        return op == Py_NE\n```\n\nThat sort of grew out of the old implementation of `IntegerRing_class._cmp_`, but I don't think this is really right either.  Just as in the case of `RealField_class`, this seems to mostly just care about equality (though it seems it should also return less than `RationalField`? What's that about?).\n\nIf `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.\n\nSo my question becomes, should a class always delegate rich comparison to the other object, and if not when should it and when shouldn't it?",
    "created_at": "2018-03-13T11:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379526",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

Right now you have:

```python
if not isinstance(other, RealField_class):
    return NotImplemented
```

which I think was Jeroen's suggestion.  The reason for this is that it will delegate comparison to the class of the right-side object if it is not an instance of `RealField_class`.  So that sort of makes sense.  But I'm concerned about making that the general approach.  

For example, the tests contain:

```
    sage: RealField(10) == IntegerRing()
    False
```

which currently will work.  But why, then, isn't the same logic applied in `IntegerRing`?  Currently its `__richcmp__` is (somewhat arbitrarily?) implemented rather differently:

```python
    def __richcmp__(left, right, int op):
        """
        Rich comparison of ``left`` and ``right``.

        TESTS::

            sage: from sage.rings.integer_ring import IntegerRing_class
            sage: ZZ == ZZ
            True
            sage: ZZ != QQ
            True
        """
        if left is right:
            return rich_to_bool(op, 0)

        if isinstance(right, IntegerRing_class):
            return rich_to_bool(op, 0)

        if isinstance(right, sage.rings.rational_field.RationalField):
            return rich_to_bool(op, -1)

        return op == Py_NE
```

That sort of grew out of the old implementation of `IntegerRing_class._cmp_`, but I don't think this is really right either.  Just as in the case of `RealField_class`, this seems to mostly just care about equality (though it seems it should also return less than `RationalField`? What's that about?).

If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.

So my question becomes, should a class always delegate rich comparison to the other object, and if not when should it and when shouldn't it?



---

archive/issue_comments_379527.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment:13): \n> If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.\n\n\nI'm sorry, I was wrong here (though I cannot for the life of me find where this is actually documented).  If both `a.__eq__(b)` and `b.__eq__(a)` return `NotImplemented`, then Python falls back on the default comparison which is by `id()`.  I think that's also the case (in reverse) for `__ne__`.  It's only in the case of the ordering operators where it raises `TypeError`.\n\nI think that clarifies things for me then.  We should probably change `IntegerRing_class.__richcmp__` to be more consistent, but this is fine as is.\n\nEvery time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.",
    "created_at": "2018-03-13T12:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379527",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment:13): 
> If `IntegerRing_class.__richcmp__` also contained something like `if not isinstance(right, IntegerRing_class): return NotImplemented`, and then you attempted the aforementioned comparison, instead of a boolean result you'll get a `TypeError` exception.


I'm sorry, I was wrong here (though I cannot for the life of me find where this is actually documented).  If both `a.__eq__(b)` and `b.__eq__(a)` return `NotImplemented`, then Python falls back on the default comparison which is by `id()`.  I think that's also the case (in reverse) for `__ne__`.  It's only in the case of the ordering operators where it raises `TypeError`.

I think that clarifies things for me then.  We should probably change `IntegerRing_class.__richcmp__` to be more consistent, but this is fine as is.

Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.



---

archive/issue_comments_379528.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nso, positive review ?",
    "created_at": "2018-03-13T12:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379528",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

so, positive review ?



---

archive/issue_comments_379529.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@embray](#comment:14):\n> Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.\n\nMaybe it's also because it works quite different in Python 2 and Python 3?",
    "created_at": "2018-03-13T13:04:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379529",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@embray](#comment:14):
> Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.

Maybe it's also because it works quite different in Python 2 and Python 3?



---

archive/issue_events_341963.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-13T13:05:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341963"
}
```



---

archive/issue_events_341964.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-13T13:05:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341964"
}
```



---

archive/issue_comments_379530.json:
```json
{
    "body": "Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Jeroen Demeyer**",
    "created_at": "2018-03-13T13:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379530",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Travis Scrimshaw** to **Travis Scrimshaw, Jeroen Demeyer**



---

archive/issue_comments_379531.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:16):\n> Replying to [@embray](#comment:14):\n> > Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.\n\n> \n> Maybe it's also because it works quite different in Python 2 and Python 3?\n\nIt does, and it's hard to keep straight.  I thought the fallback behavior for equality, for example, was only on Python 2 (when in fact I was probably just thinking about the fallback for ordered comparisons).",
    "created_at": "2018-03-13T13:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379531",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:16):
> Replying to [@embray](#comment:14):
> > Every time I think I understand Python's rich comparison it turns out I've forgotten half of what I'd learned.

> 
> Maybe it's also because it works quite different in Python 2 and Python 3?

It does, and it's hard to keep straight.  I thought the fallback behavior for equality, for example, was only on Python 2 (when in fact I was probably just thinking about the fallback for ordered comparisons).



---

archive/issue_events_341965.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-22T19:23:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341965"
}
```



---

archive/issue_events_341966.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "245c41619c7d16a0de11556ac555d7c6254dfded",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-03-22T19:23:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24931#event-341966"
}
```



---

archive/issue_comments_379532.json:
```json
{
    "body": "Changed branch from **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)** to **[`b138fe5`](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**",
    "created_at": "2018-03-22T19:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24931",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24931#issuecomment-379532",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/24931](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24931)** to **[`b138fe5`](https://github.com/sagemath/sagetrac-mirror/commit/b138fe51eb9302d95b7c4287ebe4510e77bbca39)**
