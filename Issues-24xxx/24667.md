# Issue 24667: Clean up partitions_c.cc

archive/issues_024430.json:
```json
{
    "body": "1. Remove some unused stuff.\n\n2. Compute the `double` and `long double` constants using MPFR. This makes a lot of sense since we already computed MPFR versions of these constants anyway. For extra safety, we also increase the precision used to compute these constants.\n\n3. No longer use the header file `partitions_c.h`. Instead, include the `.cc` file in Cython.\n\nPoints 2. and 3. above allow to remove some platform-specific hacks.\n\n4. Replace `T(int(x))` by `T(x)` to convert `x` to type `T`.\n\n5. Only one temporary MPFR variable is really needed, call it `mptemp`.\n\n6. Merge `initialize_mpz_and_mpq_variables`, `initialize_mpfr_variables` and `initialize_constants` in one function `initialize_globals`.\n\n7. Use some more specialized MPFR functions like `mpfr_set_prec()` where applicable.\n\n8. Define all internal functions as `static`.\n\n9. Use `MPFR_RNDF` rounding mode where exact rounding is not required.\n\n10. Ensure that the file compiles without compiler warnings.\n\n21. Various style improvements.\n\nCC:  @dimpase\n\nBranch/Commit: 2dba6c8af0c1613b667b37ba17e9520f68f711f8\n\nReviewer: Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24667\n\n",
    "closed_at": "2018-02-16T23:38:45Z",
    "created_at": "2018-02-06T08:50:12Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Clean up partitions_c.cc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24667",
    "user": "https://github.com/jdemeyer"
}
```
1. Remove some unused stuff.

2. Compute the `double` and `long double` constants using MPFR. This makes a lot of sense since we already computed MPFR versions of these constants anyway. For extra safety, we also increase the precision used to compute these constants.

3. No longer use the header file `partitions_c.h`. Instead, include the `.cc` file in Cython.

Points 2. and 3. above allow to remove some platform-specific hacks.

4. Replace `T(int(x))` by `T(x)` to convert `x` to type `T`.

5. Only one temporary MPFR variable is really needed, call it `mptemp`.

6. Merge `initialize_mpz_and_mpq_variables`, `initialize_mpfr_variables` and `initialize_constants` in one function `initialize_globals`.

7. Use some more specialized MPFR functions like `mpfr_set_prec()` where applicable.

8. Define all internal functions as `static`.

9. Use `MPFR_RNDF` rounding mode where exact rounding is not required.

10. Ensure that the file compiles without compiler warnings.

21. Various style improvements.

CC:  @dimpase

Branch/Commit: 2dba6c8af0c1613b667b37ba17e9520f68f711f8

Reviewer: Dima Pasechnik

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24667





---

archive/issue_comments_342264.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-06T11:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342264",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342265.json:
```json
{
    "body": "<a id='comment:15'></a>New commits:",
    "created_at": "2018-02-06T11:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342265",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>New commits:



---

archive/issue_comments_342266.json:
```json
{
    "body": "<a id='comment:16'></a>in this chunk\n\n```\n@@ -83,16 +86,6 @@\n  *      along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  */\n \n-\n-#if defined(__sun) || defined(__CYGWIN__)\n-extern \"C\" long double fabsl (long double);\n-extern \"C\" long double sinl (long double);\n-extern \"C\" long double cosl (long double);\n-extern \"C\" long double sqrtl (long double);\n-extern \"C\" long double coshl (long double);\n-extern \"C\" long double sinhl (long double);\n-#endif\n```\nyou're removing Gygwin stuff. Are you sure it's OK?",
    "created_at": "2018-02-07T14:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342266",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>in this chunk

```
@@ -83,16 +86,6 @@
  *      along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-
-#if defined(__sun) || defined(__CYGWIN__)
-extern "C" long double fabsl (long double);
-extern "C" long double sinl (long double);
-extern "C" long double cosl (long double);
-extern "C" long double sqrtl (long double);
-extern "C" long double coshl (long double);
-extern "C" long double sinhl (long double);
-#endif
```
you're removing Gygwin stuff. Are you sure it's OK?



---

archive/issue_comments_342267.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 dimpase]:\n> Are you sure it's OK?\n\n\nYes because I removed the *calls* to those functions. That is what point 2 in the ticket description achieves.",
    "created_at": "2018-02-07T19:41:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342267",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Replying to [comment:16 dimpase]:
> Are you sure it's OK?


Yes because I removed the *calls* to those functions. That is what point 2 in the ticket description achieves.



---

archive/issue_comments_342268.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-07T19:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342269.json:
```json
{
    "body": "<a id='comment:19'></a>Perhaps a stupid question, sorry, but is there any reason to use this implementation instead of [the one in arb](http://arblib.org/partitions.html#c.partitions_fmpz_fmpz)?",
    "created_at": "2018-02-12T17:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342269",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:19'></a>Perhaps a stupid question, sorry, but is there any reason to use this implementation instead of [the one in arb](http://arblib.org/partitions.html#c.partitions_fmpz_fmpz)?



---

archive/issue_comments_342270.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 mmezzarobba]:\n> Perhaps a stupid question, sorry, but is there any reason to use this implementation instead of [the one in arb](http://arblib.org/partitions.html#c.partitions_fmpz_fmpz)?\n\n\nI don't know. I'm just fixing the existing code.",
    "created_at": "2018-02-12T19:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342270",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 mmezzarobba]:
> Perhaps a stupid question, sorry, but is there any reason to use this implementation instead of [the one in arb](http://arblib.org/partitions.html#c.partitions_fmpz_fmpz)?


I don't know. I'm just fixing the existing code.



---

archive/issue_comments_342271.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:\n> Replying to [comment:19 mmezzarobba]:\n> > Perhaps a stupid question, sorry, but is there any reason to use this implementation instead of [the one in arb](http://arblib.org/partitions.html#c.partitions_fmpz_fmpz)?\n\n> \n> I don't know. I'm just fixing the existing code.\n\n\nIMO, it is not a bad thing to have redundancy checking with independent implementations.",
    "created_at": "2018-02-13T00:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342271",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>Replying to [comment:20 jdemeyer]:
> Replying to [comment:19 mmezzarobba]:
> > Perhaps a stupid question, sorry, but is there any reason to use this implementation instead of [the one in arb](http://arblib.org/partitions.html#c.partitions_fmpz_fmpz)?

> 
> I don't know. I'm just fixing the existing code.


IMO, it is not a bad thing to have redundancy checking with independent implementations.



---

archive/issue_comments_342272.json:
```json
{
    "body": "<a id='comment:22'></a>naturally, we can have several backends to computing a function. Patches are welcome.",
    "created_at": "2018-02-15T13:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342272",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>naturally, we can have several backends to computing a function. Patches are welcome.



---

archive/issue_comments_342273.json:
```json
{
    "body": "<a id='comment:23'></a>looks good to me. Send it to the bots!",
    "created_at": "2018-02-15T14:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342273",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>looks good to me. Send it to the bots!



---

archive/issue_comments_342274.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-15T14:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342274",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342275.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-16T23:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24667#issuecomment-342275",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062100.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-16T23:38:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24667",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24667#event-62100"
}
```
