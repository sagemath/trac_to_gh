# Issue 24425: Fix inherently failing random_expr doctest

archive/issues_024188.json:
```json
{
    "body": "The docs for `random_expr` read:\n\n```\n  This function will often raise an error because it tries to create\n  an erroneous expression (such as a division by zero).\n```\nIt has the following doctest:\n\n```\n        sage: from sage.symbolic.random_tests import *\n        sage: set_random_seed(53)\n        sage: random_expr(50, nvars=3, coeff_generator=CDF.random_element) # random\n        (v1^(0.97134084277 + 0.195868299334*I)/csc(-pi + v1^2 + v3) + sgn(1/\n...\n```\nDespite having a random seed the test run changes with every new builtin function introduced in `sage/functions` because the global function list changes. That's why the test was marked random. The problem however is that the test can even raise an error, as the docs state above. The\"`random`\" keyword does not catch this, and it would make the test useless anyway. \n\nTests are meant to test the functionality of the associated code so the test and perhaps `random_expr` should be rewritten such that it allows a test that does not change with a changed global function list.\n\nReviewer: Marc Mezzarobba\n\nAuthor: Ralf Stephan\n\nBranch: a17755c56a524033d3075a737f4a08facd012dbb\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24425\n\n",
    "closed_at": "2018-06-02T16:11:52Z",
    "created_at": "2017-12-24T07:25:10Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Fix inherently failing random_expr doctest",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24425",
    "user": "https://github.com/rwst"
}
```
The docs for `random_expr` read:

```
  This function will often raise an error because it tries to create
  an erroneous expression (such as a division by zero).
```
It has the following doctest:

```
        sage: from sage.symbolic.random_tests import *
        sage: set_random_seed(53)
        sage: random_expr(50, nvars=3, coeff_generator=CDF.random_element) # random
        (v1^(0.97134084277 + 0.195868299334*I)/csc(-pi + v1^2 + v3) + sgn(1/
...
```
Despite having a random seed the test run changes with every new builtin function introduced in `sage/functions` because the global function list changes. That's why the test was marked random. The problem however is that the test can even raise an error, as the docs state above. The"`random`" keyword does not catch this, and it would make the test useless anyway. 

Tests are meant to test the functionality of the associated code so the test and perhaps `random_expr` should be rewritten such that it allows a test that does not change with a changed global function list.

Reviewer: Marc Mezzarobba

Author: Ralf Stephan

Branch: a17755c56a524033d3075a737f4a08facd012dbb

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24425





---

archive/issue_comments_338433.json:
```json
{
    "body": "<a id='comment:1'></a>The lazy_import is not even necessary for trigger.",
    "created_at": "2017-12-24T07:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338433",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>The lazy_import is not even necessary for trigger.



---

archive/issue_comments_338434.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2017-12-26T08:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338434",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_338435.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-26T08:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338435",
    "user": "https://github.com/rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338436.json:
```json
{
    "body": "<a id='comment:6'></a>I don't fully understand the context, but the change looks reasonable and really unlikely to break anything\u2014and this ticket has been languishing for months.",
    "created_at": "2018-06-01T12:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338436",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:6'></a>I don't fully understand the context, but the change looks reasonable and really unlikely to break anythingâ€”and this ticket has been languishing for months.



---

archive/issue_comments_338437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-01T12:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338437",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_061708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-02T16:11:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24425#event-61708"
}
```



---

archive/issue_comments_338438.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-02T16:11:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338438",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_338439.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks. Oddly enough, #24212 depends on this.",
    "created_at": "2018-06-02T16:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24425",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24425#issuecomment-338439",
    "user": "https://github.com/rwst"
}
```

<a id='comment:8'></a>Thanks. Oddly enough, #24212 depends on this.
