# Issue 24688: implement Faltings height of an elliptic curve

archive/issues_024451.json:
```json
{
    "assignees": [],
    "body": "The goal of this ticket is to be able to determine the Faltings height of an elliptic curve.\n\nCC:  @JohnCremona @nbruin\n\nComponent: **elliptic curves**\n\nKeywords: **faltings height**\n\nAuthor: **Kevin Lui, John Cremona**\n\nBranch/Commit: **[`d3ed53e`](https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51)**\n\nReviewer: **Peter Bruin, John Cremona, Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24688_\n\n",
    "closed_at": "2021-03-20T20:54:51Z",
    "created_at": "2018-02-08T02:03:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "implement Faltings height of an elliptic curve",
    "type": "issue",
    "updated_at": "2021-03-20T20:54:51Z",
    "url": "https://github.com/sagemath/sage/issues/24688",
    "user": "https://github.com/kevinywlui"
}
```
The goal of this ticket is to be able to determine the Faltings height of an elliptic curve.

CC:  @JohnCremona @nbruin

Component: **elliptic curves**

Keywords: **faltings height**

Author: **Kevin Lui, John Cremona**

Branch/Commit: **[`d3ed53e`](https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51)**

Reviewer: **Peter Bruin, John Cremona, Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/24688_





---

archive/issue_events_338849.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T02:03:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338849"
}
```



---

archive/issue_events_338850.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T02:03:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338850"
}
```



---

archive/issue_comments_375058.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The goal of this ticket is to be able to determine the falting height of an elliptic curve.\n+~~ The goal of this ticket is to be able to determine the falting height of an elliptic curve. ~~ Maybe this has already been done?\n``````\n",
    "created_at": "2018-02-08T21:45:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375058",
    "user": "https://github.com/kevinywlui"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-The goal of this ticket is to be able to determine the falting height of an elliptic curve.
+~~ The goal of this ticket is to be able to determine the falting height of an elliptic curve. ~~ Maybe this has already been done?
``````




---

archive/issue_events_338851.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T23:00:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "title_is": "implement faltings height of an elliptic curve",
    "title_was": "implement falting height of an elliptic curve",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338851"
}
```



---

archive/issue_events_338852.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T23:00:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338852"
}
```



---

archive/issue_comments_375059.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-~~ The goal of this ticket is to be able to determine the falting height of an elliptic curve. ~~ Maybe this has already been done?\n+The goal of this ticket is to be able to determine the faltings height of an elliptic curve.\n``````\n",
    "created_at": "2018-02-08T23:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375059",
    "user": "https://github.com/kevinywlui"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-~~ The goal of this ticket is to be able to determine the falting height of an elliptic curve. ~~ Maybe this has already been done?
+The goal of this ticket is to be able to determine the faltings height of an elliptic curve.
``````




---

archive/issue_comments_375060.json:
```json
{
    "body": "Changed keywords from none to **faltings height**",
    "created_at": "2018-02-08T23:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375060",
    "user": "https://github.com/kevinywlui"
}
```

Changed keywords from none to **faltings height**



---

archive/issue_events_338853.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T23:00:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338853"
}
```



---

archive/issue_events_338854.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T23:00:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338854"
}
```



---

archive/issue_events_338855.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-02-08T23:00:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338855"
}
```



---

archive/issue_comments_375061.json:
```json
{
    "body": "Branch: **[u/klui/implement_falting_height_of_an_elliptic_curve](https://github.com/sagemath/sagetrac-mirror/tree/u/klui/implement_falting_height_of_an_elliptic_curve)**",
    "created_at": "2018-02-09T06:01:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375061",
    "user": "https://github.com/kevinywlui"
}
```

Branch: **[u/klui/implement_falting_height_of_an_elliptic_curve](https://github.com/sagemath/sagetrac-mirror/tree/u/klui/implement_falting_height_of_an_elliptic_curve)**



---

archive/issue_comments_375062.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3066ce2220af69343dae716c849e343cbf5778e2\"><code>3066ce2</code></a></td><td><code>changed 1/2 to 0.5 and have the result depend on the models as is done in Magma</code></td></tr></table>\n",
    "created_at": "2018-04-24T19:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375062",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3066ce2220af69343dae716c849e343cbf5778e2"><code>3066ce2</code></a></td><td><code>changed 1/2 to 0.5 and have the result depend on the models as is done in Magma</code></td></tr></table>




---

archive/issue_comments_375063.json:
```json
{
    "body": "Commit: **[`3066ce2`](https://github.com/sagemath/sagetrac-mirror/commit/3066ce2220af69343dae716c849e343cbf5778e2)**",
    "created_at": "2018-04-24T19:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375063",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`3066ce2`](https://github.com/sagemath/sagetrac-mirror/commit/3066ce2220af69343dae716c849e343cbf5778e2)**



---

archive/issue_events_338856.json:
```json
{
    "actor": "https://github.com/kevinywlui",
    "created_at": "2018-04-24T19:20:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338856"
}
```



---

archive/issue_events_338857.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-01T12:33:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338857"
}
```



---

archive/issue_events_338858.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-01T12:33:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338858"
}
```



---

archive/issue_comments_375064.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nYou should fill the `Authors` field with your full name.",
    "created_at": "2018-05-01T12:33:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375064",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

You should fill the `Authors` field with your full name.



---

archive/issue_comments_375065.json:
```json
{
    "body": "Author: **Kevin Lui**",
    "created_at": "2018-05-02T17:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375065",
    "user": "https://github.com/kevinywlui"
}
```

Author: **Kevin Lui**



---

archive/issue_comments_375066.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThanks!",
    "created_at": "2018-05-02T17:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375066",
    "user": "https://github.com/kevinywlui"
}
```

<div id="comment:7" align="right">comment:7</div>

Thanks!



---

archive/issue_comments_375067.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7b76d3eea8a9cf0e7e49e8c6f2f9a9db87db3d4d\"><code>7b76d3e</code></a></td><td><code>Merge branch 't/24688/implement_falting_height_of_an_elliptic_curve' into faltings</code></td></tr></table>\n",
    "created_at": "2018-06-20T22:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375067",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7b76d3eea8a9cf0e7e49e8c6f2f9a9db87db3d4d"><code>7b76d3e</code></a></td><td><code>Merge branch 't/24688/implement_falting_height_of_an_elliptic_curve' into faltings</code></td></tr></table>




---

archive/issue_comments_375068.json:
```json
{
    "body": "Changed commit from **[`3066ce2`](https://github.com/sagemath/sagetrac-mirror/commit/3066ce2220af69343dae716c849e343cbf5778e2)** to **[`7b76d3e`](https://github.com/sagemath/sagetrac-mirror/commit/7b76d3eea8a9cf0e7e49e8c6f2f9a9db87db3d4d)**",
    "created_at": "2018-06-20T22:35:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375068",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3066ce2`](https://github.com/sagemath/sagetrac-mirror/commit/3066ce2220af69343dae716c849e343cbf5778e2)** to **[`7b76d3e`](https://github.com/sagemath/sagetrac-mirror/commit/7b76d3eea8a9cf0e7e49e8c6f2f9a9db87db3d4d)**



---

archive/issue_comments_375069.json:
```json
{
    "body": "Changed commit from **[`7b76d3e`](https://github.com/sagemath/sagetrac-mirror/commit/7b76d3eea8a9cf0e7e49e8c6f2f9a9db87db3d4d)** to **[`f85ec59`](https://github.com/sagemath/sagetrac-mirror/commit/f85ec59b6368fbf16ace238e55581c69d0afc23f)**",
    "created_at": "2018-06-20T23:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375069",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7b76d3e`](https://github.com/sagemath/sagetrac-mirror/commit/7b76d3eea8a9cf0e7e49e8c6f2f9a9db87db3d4d)** to **[`f85ec59`](https://github.com/sagemath/sagetrac-mirror/commit/f85ec59b6368fbf16ace238e55581c69d0afc23f)**



---

archive/issue_comments_375070.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f85ec59b6368fbf16ace238e55581c69d0afc23f\"><code>f85ec59</code></a></td><td><code>removed some trailing whitespaces</code></td></tr></table>\n",
    "created_at": "2018-06-20T23:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375070",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f85ec59b6368fbf16ace238e55581c69d0afc23f"><code>f85ec59</code></a></td><td><code>removed some trailing whitespaces</code></td></tr></table>




---

archive/issue_events_338859.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-06-21T06:13:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338859"
}
```



---

archive/issue_events_338860.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-06-21T06:13:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338860"
}
```



---

archive/issue_events_338861.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-06-21T06:13:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338861"
}
```



---

archive/issue_events_338862.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-06-21T06:13:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338862"
}
```



---

archive/issue_comments_375071.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nMaybe you could do that over any number field, if possible ? using something like\n\n```\nA = self.base_ring()\nemb = A.embeddings(RR)[0]\nreturn -self.period_lattice(emb).complex_area().log() / 2\n```\nbut an expert opinion is required. John ?",
    "created_at": "2018-06-21T19:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375071",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">comment:11</div>

Maybe you could do that over any number field, if possible ? using something like

```
A = self.base_ring()
emb = A.embeddings(RR)[0]
return -self.period_lattice(emb).complex_area().log() / 2
```
but an expert opinion is required. John ?



---

archive/issue_comments_375072.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIs this really ready for review?\nI'm a little confused as to what this is meant to do, is it meant to match Magma's FaltingsHeight? For example in Magma V2.22-6\n\n```c\n> E := EllipticCurve(\"32a\");\n> E;\nElliptic Curve defined by y^2 = x^3 + 4*x over Rational Field\n> FaltingsHeight(E);\n-1.31053292591150951825227508330\n```\nquite different from the output this ticket gives, and the code in Magma is a lot more involved, picks a minimal model, uses the denominator of the j-invariant, discriminant etc.\n\nThe Magma documentation leaves a lot to be desired here I think.",
    "created_at": "2018-06-22T03:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375072",
    "user": "https://github.com/alexjbest"
}
```

<div id="comment:12" align="right">comment:12</div>

Is this really ready for review?
I'm a little confused as to what this is meant to do, is it meant to match Magma's FaltingsHeight? For example in Magma V2.22-6

```c
> E := EllipticCurve("32a");
> E;
Elliptic Curve defined by y^2 = x^3 + 4*x over Rational Field
> FaltingsHeight(E);
-1.31053292591150951825227508330
```
quite different from the output this ticket gives, and the code in Magma is a lot more involved, picks a minimal model, uses the denominator of the j-invariant, discriminant etc.

The Magma documentation leaves a lot to be desired here I think.



---

archive/issue_comments_375073.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI forgot the web calculator exists so I only checked it against MagmaV2.18-5. And in that version, the height was dependent on the model which was rather confusing to me. I always worked with the minimal model anyways so that difference didn't matter to me.\n\nI'm happy to see that that has changed:\n\n```\nE := EllipticCurve(\"32a\");\nFaltingsHeight(E);\nFaltingsHeight(WeierstrassModel(E));\n```\nyields\n\n```\n-1.31053292591150951825227508330\n-1.31053292591150951825227508330\n```\nusing http://magma.maths.usyd.edu.au/calc/ .\n\nMy interest in Faltings height is using Steven's conjecture to identify the J_1(N)-optimal curve in a given isogeny class. So the goal of this ticket was the compute whatever height is used in Steven's conjecture. So I took what was defined in Remark 3.3 here: https://arxiv.org/pdf/math/0404333.pdf and re-normalized it so that it matched with Magma. Though now I'm not sure what Magma is computing anymore. It seems to different than what's documented here: https://magma.maths.usyd.edu.au/magma/handbook/text/1455\n\nIn any case, I should change it so that it uses the minimal model.",
    "created_at": "2018-06-22T04:44:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375073",
    "user": "https://github.com/kevinywlui"
}
```

<div id="comment:13" align="right">comment:13</div>

I forgot the web calculator exists so I only checked it against MagmaV2.18-5. And in that version, the height was dependent on the model which was rather confusing to me. I always worked with the minimal model anyways so that difference didn't matter to me.

I'm happy to see that that has changed:

```
E := EllipticCurve("32a");
FaltingsHeight(E);
FaltingsHeight(WeierstrassModel(E));
```
yields

```
-1.31053292591150951825227508330
-1.31053292591150951825227508330
```
using http://magma.maths.usyd.edu.au/calc/ .

My interest in Faltings height is using Steven's conjecture to identify the J_1(N)-optimal curve in a given isogeny class. So the goal of this ticket was the compute whatever height is used in Steven's conjecture. So I took what was defined in Remark 3.3 here: https://arxiv.org/pdf/math/0404333.pdf and re-normalized it so that it matched with Magma. Though now I'm not sure what Magma is computing anymore. It seems to different than what's documented here: https://magma.maths.usyd.edu.au/magma/handbook/text/1455

In any case, I should change it so that it uses the minimal model.



---

archive/issue_comments_375074.json:
```json
{
    "body": "Changed commit from **[`f85ec59`](https://github.com/sagemath/sagetrac-mirror/commit/f85ec59b6368fbf16ace238e55581c69d0afc23f)** to **[`13f116a`](https://github.com/sagemath/sagetrac-mirror/commit/13f116a516e14eefb2bfb77f3034186e7a597d85)**",
    "created_at": "2018-06-22T04:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375074",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f85ec59`](https://github.com/sagemath/sagetrac-mirror/commit/f85ec59b6368fbf16ace238e55581c69d0afc23f)** to **[`13f116a`](https://github.com/sagemath/sagetrac-mirror/commit/13f116a516e14eefb2bfb77f3034186e7a597d85)**



---

archive/issue_comments_375075.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13f116a516e14eefb2bfb77f3034186e7a597d85\"><code>13f116a</code></a></td><td><code>use the complex area of the minimal model</code></td></tr></table>\n",
    "created_at": "2018-06-22T04:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375075",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13f116a516e14eefb2bfb77f3034186e7a597d85"><code>13f116a</code></a></td><td><code>use the complex area of the minimal model</code></td></tr></table>




---

archive/issue_comments_375076.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nNo time for detailed comment now but it should not depend on model being minimal -- over number fields there is not always a global minimal model -- so there is a formula which is independent of model, though it is simpler (and possible over Q) to use a simpler formula valid only for minimal models.\n\nklui, I like your project.  If you want to do this with no computation at all use the files at https://github.com/JohnCremona/ecdata/tree/master/allbsd (see under \"TABLE FOUR\" at http://johncremona.github.io/ecdata/ for description of their content).",
    "created_at": "2018-06-22T08:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375076",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:15" align="right">comment:15</div>

No time for detailed comment now but it should not depend on model being minimal -- over number fields there is not always a global minimal model -- so there is a formula which is independent of model, though it is simpler (and possible over Q) to use a simpler formula valid only for minimal models.

klui, I like your project.  If you want to do this with no computation at all use the files at https://github.com/JohnCremona/ecdata/tree/master/allbsd (see under "TABLE FOUR" at http://johncremona.github.io/ecdata/ for description of their content).



---

archive/issue_comments_375077.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@JohnCremona](#comment%3A15):\n> No time for detailed comment now but it should not depend on model being minimal -- over number fields there is not always a global minimal model -- so there is a formula which is independent of model, though it is simpler (and possible over Q) to use a simpler formula valid only for minimal models.\n> \n\nThe only model-independent formula I know of requires computing the minimal discriminant anyways so it should be okay to just compute the minimal model, from a speed-perspective as well.\n> klui, I like your project.  If you want to do this with no computation at all use the files at https://github.com/JohnCremona/ecdata/tree/master/allbsd (see under \"TABLE FOUR\" at http://johncremona.github.io/ecdata/ for description of their content).\n\nI think I'm being slow but I don't see how knowing the BSD invariants help with computing the Faltings height.",
    "created_at": "2018-06-22T18:00:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375077",
    "user": "https://github.com/kevinywlui"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@JohnCremona](#comment%3A15):
> No time for detailed comment now but it should not depend on model being minimal -- over number fields there is not always a global minimal model -- so there is a formula which is independent of model, though it is simpler (and possible over Q) to use a simpler formula valid only for minimal models.
> 

The only model-independent formula I know of requires computing the minimal discriminant anyways so it should be okay to just compute the minimal model, from a speed-perspective as well.
> klui, I like your project.  If you want to do this with no computation at all use the files at https://github.com/JohnCremona/ecdata/tree/master/allbsd (see under "TABLE FOUR" at http://johncremona.github.io/ecdata/ for description of their content).

I think I'm being slow but I don't see how knowing the BSD invariants help with computing the Faltings height.



---

archive/issue_events_338863.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-06-26T11:56:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "title_is": "implement Faltings height of an elliptic curve",
    "title_was": "implement faltings height of an elliptic curve",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338863"
}
```



---

archive/issue_comments_375078.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-The goal of this ticket is to be able to determine the faltings height of an elliptic curve.\n+The goal of this ticket is to be able to determine the Faltings height of an elliptic curve.\n``````\n",
    "created_at": "2018-06-26T11:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375078",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-The goal of this ticket is to be able to determine the faltings height of an elliptic curve.
+The goal of this ticket is to be able to determine the Faltings height of an elliptic curve.
``````




---

archive/issue_comments_375079.json:
```json
{
    "body": "Reviewer: **Peter Bruin**",
    "created_at": "2020-01-14T16:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375079",
    "user": "https://github.com/pjbruin"
}
```

Reviewer: **Peter Bruin**



---

archive/issue_events_338864.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2020-01-14T16:47:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338864"
}
```



---

archive/issue_events_338865.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2020-01-14T16:47:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338865"
}
```



---

archive/issue_comments_375080.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nInstead of saying that this uses the same normalisation as Magma, I suggest putting a definition or formula in the documentation.  For the elliptic curve 32a1, the output agrees with the function `ellheight` in PARI but seems to be half of that returned by Magma.\n\nFor a future generalisation to number fields, the PARI function `ellheight` does the same thing as this function over **Q** and also works over number fields.",
    "created_at": "2020-01-14T16:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375080",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:18" align="right">comment:18</div>

Instead of saying that this uses the same normalisation as Magma, I suggest putting a definition or formula in the documentation.  For the elliptic curve 32a1, the output agrees with the function `ellheight` in PARI but seems to be half of that returned by Magma.

For a future generalisation to number fields, the PARI function `ellheight` does the same thing as this function over **Q** and also works over number fields.



---

archive/issue_comments_375081.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI am planning to revise and resubmit this patch, with an option to return either the (unstable) Faltings height as the code now does (-log(A)/2) or the stable height which adds log(denom(j)/abs(disc))/12 -- the result being the same for semistable curves (since denom(j)=abs(disc) for a minimal model of a semistable curve, as then gcd(c4,disc)=1), and independent of the model.",
    "created_at": "2021-03-16T15:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375081",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:19" align="right">comment:19</div>

I am planning to revise and resubmit this patch, with an option to return either the (unstable) Faltings height as the code now does (-log(A)/2) or the stable height which adds log(denom(j)/abs(disc))/12 -- the result being the same for semistable curves (since denom(j)=abs(disc) for a minimal model of a semistable curve, as then gcd(c4,disc)=1), and independent of the model.



---

archive/issue_events_338866.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2021-03-16T17:12:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338866"
}
```



---

archive/issue_events_338867.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2021-03-16T17:12:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338867"
}
```



---

archive/issue_comments_375082.json:
```json
{
    "body": "Changed commit from **[`13f116a`](https://github.com/sagemath/sagetrac-mirror/commit/13f116a516e14eefb2bfb77f3034186e7a597d85)** to **[`d3ed53e`](https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51)**",
    "created_at": "2021-03-16T17:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375082",
    "user": "https://github.com/JohnCremona"
}
```

Changed commit from **[`13f116a`](https://github.com/sagemath/sagetrac-mirror/commit/13f116a516e14eefb2bfb77f3034186e7a597d85)** to **[`d3ed53e`](https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51)**



---

archive/issue_comments_375083.json:
```json
{
    "body": "Changed branch from **[u/klui/implement_falting_height_of_an_elliptic_curve](https://github.com/sagemath/sagetrac-mirror/tree/u/klui/implement_falting_height_of_an_elliptic_curve)** to **[u/cremona/24688-Faltings_height](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24688-Faltings_height)**",
    "created_at": "2021-03-16T17:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375083",
    "user": "https://github.com/JohnCremona"
}
```

Changed branch from **[u/klui/implement_falting_height_of_an_elliptic_curve](https://github.com/sagemath/sagetrac-mirror/tree/u/klui/implement_falting_height_of_an_elliptic_curve)** to **[u/cremona/24688-Faltings_height](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24688-Faltings_height)**



---

archive/issue_comments_375084.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI merged the previous branch with 9.3.beta9, and enhanced the method by having `stable` as an optional parameter (default `False`) and adding a precision parameter.  I added extra tests to show how the stable and unstable heights are the same for semistable curves (but not otherwise) and how the stable height is independent of the model while the unstable one is not.\n\nI included definitions (but no citations).\n\nObviously we'll also want a version of this for number fields too, but I think this is enough for now.  Please re-review!\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/beb25b7a75ac774371735ab2f1083b7eda43a6ed\"><code>beb25b7</code></a></td><td><code>Merge remote-tracking branch 'trac/u/klui/implement_falting_height_of_an_elliptic_curve' into develop</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51\"><code>d3ed53e</code></a></td><td><code>#24688: Faltings height for elliptic curves over QQ</code></td></tr></table>\n",
    "created_at": "2021-03-16T17:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375084",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:20" align="right">comment:20</div>

I merged the previous branch with 9.3.beta9, and enhanced the method by having `stable` as an optional parameter (default `False`) and adding a precision parameter.  I added extra tests to show how the stable and unstable heights are the same for semistable curves (but not otherwise) and how the stable height is independent of the model while the unstable one is not.

I included definitions (but no citations).

Obviously we'll also want a version of this for number fields too, but I think this is enough for now.  Please re-review!

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/beb25b7a75ac774371735ab2f1083b7eda43a6ed"><code>beb25b7</code></a></td><td><code>Merge remote-tracking branch 'trac/u/klui/implement_falting_height_of_an_elliptic_curve' into develop</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51"><code>d3ed53e</code></a></td><td><code>#24688: Faltings height for elliptic curves over QQ</code></td></tr></table>




---

archive/issue_comments_375085.json:
```json
{
    "body": "Changed reviewer from **Peter Bruin** to **Peter Bruin, John Cremona**",
    "created_at": "2021-03-16T17:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375085",
    "user": "https://github.com/JohnCremona"
}
```

Changed reviewer from **Peter Bruin** to **Peter Bruin, John Cremona**



---

archive/issue_comments_375086.json:
```json
{
    "body": "Changed author from **Kevin Lui** to **Kevin Lui, John Cremona**",
    "created_at": "2021-03-16T17:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375086",
    "user": "https://github.com/JohnCremona"
}
```

Changed author from **Kevin Lui** to **Kevin Lui, John Cremona**



---

archive/issue_events_338868.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-19T11:01:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338868"
}
```



---

archive/issue_events_338869.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-19T11:01:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338869"
}
```



---

archive/issue_comments_375087.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nthe bot is green and this looks good, so let it be (not a mathematical review)",
    "created_at": "2021-03-19T11:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375087",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:21" align="right">comment:21</div>

the bot is green and this looks good, so let it be (not a mathematical review)



---

archive/issue_comments_375088.json:
```json
{
    "body": "Changed reviewer from **Peter Bruin, John Cremona** to **Peter Bruin, John Cremona, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2021-03-19T11:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375088",
    "user": "https://github.com/fchapoton"
}
```

Changed reviewer from **Peter Bruin, John Cremona** to **Peter Bruin, John Cremona, Frédéric Chapoton**



---

archive/issue_events_338870.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-19T11:01:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338870"
}
```



---

archive/issue_events_338871.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-19T11:01:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338871"
}
```



---

archive/issue_comments_375089.json:
```json
{
    "body": "Changed branch from **[u/cremona/24688-Faltings_height](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24688-Faltings_height)** to **[`d3ed53e`](https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51)**",
    "created_at": "2021-03-20T20:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24688#issuecomment-375089",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cremona/24688-Faltings_height](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24688-Faltings_height)** to **[`d3ed53e`](https://github.com/sagemath/sagetrac-mirror/commit/d3ed53ee7e48f0a89e03d4026cca4cc59ff95e51)**



---

archive/issue_events_338872.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-20T20:54:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338872"
}
```



---

archive/issue_events_338873.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3071aad95cccb038230d6c56c7b947483f597d56",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-20T20:54:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24688",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24688#event-338873"
}
```
