# Issue 24067: Call sympy_init() at sympy import

archive/issues_023830.json:
```json
{
    "body": "`sympy_init()` enables conversion of SymPy objects. It is called with the first initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any import of SymPy.\n\nWe should also revert the patch added in #24238.\n\n**CC:**  @jdemeyer @isuruf @infinity0 @egourgoulhon\n\n**Branch:** [u/fbissey/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/24067)\n\n**Commit:** [67e6156afccd12253c2c330bff6cb9fdeb11245c](https://github.com/sagemath/sagetrac-mirror/commit/67e6156afccd12253c2c330bff6cb9fdeb11245c)\n\n**Stopgaps:** #24238\n\n**Reviewer:** Fran\u00e7ois Bissey\n\nIssue created by migration from https://trac.sagemath.org/ticket/24067\n\n",
    "closed_at": "2021-08-26T02:08:43Z",
    "created_at": "2017-10-19T13:22:16Z",
    "labels": [
        "component: interfaces",
        "enhancement",
        "invalid"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Call sympy_init() at sympy import",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24067",
    "user": "https://github.com/rwst"
}
```
`sympy_init()` enables conversion of SymPy objects. It is called with the first initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any import of SymPy.

We should also revert the patch added in #24238.

**CC:**  @jdemeyer @isuruf @infinity0 @egourgoulhon

**Branch:** [u/fbissey/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/24067)

**Commit:** [67e6156afccd12253c2c330bff6cb9fdeb11245c](https://github.com/sagemath/sagetrac-mirror/commit/67e6156afccd12253c2c330bff6cb9fdeb11245c)

**Stopgaps:** #24238

**Reviewer:** Fran√ßois Bissey

Issue created by migration from https://trac.sagemath.org/ticket/24067





---

archive/issue_comments_434625.json:
```json
{
    "body": "**Branch:** [u/rws/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24067)",
    "created_at": "2017-10-19T14:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434625",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24067)



---

archive/issue_comments_434626.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-sympy_init() enables conversion of SymPy objects. It is called with every initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any `import sympy`.\n+`sympy_init()` enables conversion of SymPy objects. It is called with the first initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any import of SymPy.\n``````\n",
    "created_at": "2017-10-19T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434626",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-sympy_init() enables conversion of SymPy objects. It is called with every initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any `import sympy`.
+`sympy_init()` enables conversion of SymPy objects. It is called with the first initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any import of SymPy.
``````




---

archive/issue_comments_434627.json:
```json
{
    "body": "**Commit:** [40b3432ff5203b94428f482cf0b51360d9edb738](https://github.com/sagemath/sagetrac-mirror/commit/40b3432ff5203b94428f482cf0b51360d9edb738)",
    "created_at": "2017-10-19T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434627",
    "user": "https://github.com/rwst"
}
```

**Commit:** [40b3432ff5203b94428f482cf0b51360d9edb738](https://github.com/sagemath/sagetrac-mirror/commit/40b3432ff5203b94428f482cf0b51360d9edb738)



---

archive/issue_comments_434628.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8215d37edd3eabc1eb881800e44210f2f77d64bc\">8215d37</a></td><td><code>Merge branch 'develop' into tmp05</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7899ea992d19f75e38e7db5526bb5c311d09d79a\">7899ea9</a></td><td><code>20204: convert SymPy abstract functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f\">b261ec3</a></td><td><code>23923: fix doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01\">5010acf</a></td><td><code>Merge branch 'u/rws/23923' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5\">14b1c52</a></td><td><code>20204: more doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c4119a3feda956846bd1fa78256830aef4739f8\">9c4119a</a></td><td><code>16801: Conversion of psi(x,y) to/from SymPy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5c60e3418468f8b5325f06997646fb4f9bf6ced\">d5c60e3</a></td><td><code>24062: pkg version/chksum</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cbc23e8c18d4d93a19c225bf79cc85e3f37fd01\">1cbc23e</a></td><td><code>24062: remove obsolote patches; adapt remaining</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94f359f5a48696e2b98c346e3f120e9481d89a7c\">94f359f</a></td><td><code>24062: doctest fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40b3432ff5203b94428f482cf0b51360d9edb738\">40b3432</a></td><td><code>24067: Call sympy_init() at sympy import</code></td></tr></table>\n",
    "created_at": "2017-10-19T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434628",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
**Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8215d37edd3eabc1eb881800e44210f2f77d64bc">8215d37</a></td><td><code>Merge branch 'develop' into tmp05</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7899ea992d19f75e38e7db5526bb5c311d09d79a">7899ea9</a></td><td><code>20204: convert SymPy abstract functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b261ec3e671179d04d1922d15d9116e4f6e1d47f">b261ec3</a></td><td><code>23923: fix doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5010acf00b2811420ba1a725deb2351f77eb0c01">5010acf</a></td><td><code>Merge branch 'u/rws/23923' of git://trac.sagemath.org/sage into t/20204/20204</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14b1c523c468bfb304191edfe6e85a5c94e916f5">14b1c52</a></td><td><code>20204: more doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c4119a3feda956846bd1fa78256830aef4739f8">9c4119a</a></td><td><code>16801: Conversion of psi(x,y) to/from SymPy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5c60e3418468f8b5325f06997646fb4f9bf6ced">d5c60e3</a></td><td><code>24062: pkg version/chksum</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cbc23e8c18d4d93a19c225bf79cc85e3f37fd01">1cbc23e</a></td><td><code>24062: remove obsolote patches; adapt remaining</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94f359f5a48696e2b98c346e3f120e9481d89a7c">94f359f</a></td><td><code>24062: doctest fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40b3432ff5203b94428f482cf0b51360d9edb738">40b3432</a></td><td><code>24067: Call sympy_init() at sympy import</code></td></tr></table>




---

archive/issue_comments_434629.json:
```json
{
    "body": "**Dependencies:** #24062",
    "created_at": "2017-10-19T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434629",
    "user": "https://github.com/rwst"
}
```

**Dependencies:** #24062



---

archive/issue_comments_434630.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-10-19T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434630",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_434631.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2017-10-19T14:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434631",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_434632.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24067)\" to \"[u/jdemeyer/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/24067)\".",
    "created_at": "2017-11-19T15:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434632",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/rws/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24067)" to "[u/jdemeyer/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/24067)".



---

archive/issue_comments_434633.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2017-11-19T15:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434633",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_434634.json:
```json
{
    "body": "**Changing dependencies** from \"#24062\" to \"\".",
    "created_at": "2017-11-19T15:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434634",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#24062" to "".



---

archive/issue_comments_434635.json:
```json
{
    "body": "<a id='comment:4'></a>\nRebased to 8.1.rc2 for easier reviewing.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a97c32f65ea9f194abfb801595ffc6a89c825216\">a97c32f</a></td><td><code>24067: Call sympy_init() at sympy import</code></td></tr></table>\n",
    "created_at": "2017-11-19T15:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434635",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Rebased to 8.1.rc2 for easier reviewing.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a97c32f65ea9f194abfb801595ffc6a89c825216">a97c32f</a></td><td><code>24067: Call sympy_init() at sympy import</code></td></tr></table>




---

archive/issue_comments_434636.json:
```json
{
    "body": "**Changing commit** from \"[40b3432ff5203b94428f482cf0b51360d9edb738](https://github.com/sagemath/sagetrac-mirror/commit/40b3432ff5203b94428f482cf0b51360d9edb738)\" to \"[a97c32f65ea9f194abfb801595ffc6a89c825216](https://github.com/sagemath/sagetrac-mirror/commit/a97c32f65ea9f194abfb801595ffc6a89c825216)\".",
    "created_at": "2017-11-19T15:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434636",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[40b3432ff5203b94428f482cf0b51360d9edb738](https://github.com/sagemath/sagetrac-mirror/commit/40b3432ff5203b94428f482cf0b51360d9edb738)" to "[a97c32f65ea9f194abfb801595ffc6a89c825216](https://github.com/sagemath/sagetrac-mirror/commit/a97c32f65ea9f194abfb801595ffc6a89c825216)".



---

archive/issue_comments_434637.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d4f31081c88d16a6b89bcfea09805b675413b7f\">0d4f310</a></td><td><code>Remove explicit sympy_init() calls</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/893b03d4d00ea6566648ed315569a46f4096551b\">893b03d</a></td><td><code>Check that sympy is not imported</code></td></tr></table>\n",
    "created_at": "2017-11-19T16:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434637",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d4f31081c88d16a6b89bcfea09805b675413b7f">0d4f310</a></td><td><code>Remove explicit sympy_init() calls</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/893b03d4d00ea6566648ed315569a46f4096551b">893b03d</a></td><td><code>Check that sympy is not imported</code></td></tr></table>




---

archive/issue_comments_434638.json:
```json
{
    "body": "**Changing commit** from \"[a97c32f65ea9f194abfb801595ffc6a89c825216](https://github.com/sagemath/sagetrac-mirror/commit/a97c32f65ea9f194abfb801595ffc6a89c825216)\" to \"[893b03d4d00ea6566648ed315569a46f4096551b](https://github.com/sagemath/sagetrac-mirror/commit/893b03d4d00ea6566648ed315569a46f4096551b)\".",
    "created_at": "2017-11-19T16:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434638",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a97c32f65ea9f194abfb801595ffc6a89c825216](https://github.com/sagemath/sagetrac-mirror/commit/a97c32f65ea9f194abfb801595ffc6a89c825216)" to "[893b03d4d00ea6566648ed315569a46f4096551b](https://github.com/sagemath/sagetrac-mirror/commit/893b03d4d00ea6566648ed315569a46f4096551b)".



---

archive/issue_comments_434639.json:
```json
{
    "body": "<a id='comment:6'></a>\nPositive review to your first commit. I added two follow-up commits, please review.",
    "created_at": "2017-11-19T17:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434639",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Positive review to your first commit. I added two follow-up commits, please review.



---

archive/issue_comments_434640.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am concerned that the sympy patch cannot be sent upstream as is. It makes sage a dependency of sympy for it to even start. I doubt that's acceptable.",
    "created_at": "2017-11-19T18:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434640",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
I am concerned that the sympy patch cannot be sent upstream as is. It makes sage a dependency of sympy for it to even start. I doubt that's acceptable.



---

archive/issue_comments_434641.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhat about just adding `sympy_init()` to the end of the interface file?",
    "created_at": "2017-11-19T21:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434641",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
What about just adding `sympy_init()` to the end of the interface file?



---

archive/issue_comments_434642.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [tscrim](#comment%3A8):\n> What about just adding `sympy_init()` to the end of the interface file?\n\n\nI would favor an all in sage solution to this. I am not against a push in sympy upstream but it has to be acceptable to them and that will certainly not be.",
    "created_at": "2017-11-19T21:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434642",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Replying to [tscrim](#comment%3A8):
> What about just adding `sympy_init()` to the end of the interface file?


I would favor an all in sage solution to this. I am not against a push in sympy upstream but it has to be acceptable to them and that will certainly not be.



---

archive/issue_comments_434643.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [fbissey](#comment%3A7):\n> I am concerned that the sympy patch cannot be sent upstream as is. It makes sage a dependency of sympy for it to even start. I doubt that's acceptable.\n\n\nTo make it work the `__init__` file needs to know if it is imported from sage. I'm no Python expert but I doubt that's possible. A solution to the design problem would be not to have `_sage_` member functions but a global `sage(...)` method.\n\nAdditions LGTM.",
    "created_at": "2017-11-20T07:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434643",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
Replying to [fbissey](#comment%3A7):
> I am concerned that the sympy patch cannot be sent upstream as is. It makes sage a dependency of sympy for it to even start. I doubt that's acceptable.


To make it work the `__init__` file needs to know if it is imported from sage. I'm no Python expert but I doubt that's possible. A solution to the design problem would be not to have `_sage_` member functions but a global `sage(...)` method.

Additions LGTM.



---

archive/issue_comments_434644.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-11-20T07:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434644",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_434645.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Ralf Stephan\".",
    "created_at": "2017-11-20T07:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434645",
    "user": "https://github.com/rwst"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Ralf Stephan".



---

archive/issue_comments_434646.json:
```json
{
    "body": "<a id='comment:11'></a>\nWhat about guarding it with a `try: expect:` block so it can start gracefully if sage is not present (and therefore not used).",
    "created_at": "2017-11-20T08:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434646",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>
What about guarding it with a `try: expect:` block so it can start gracefully if sage is not present (and therefore not used).



---

archive/issue_comments_434647.json:
```json
{
    "body": "<a id='comment:12'></a>\nfbissey: I am assuming that this ticket would only be merged in some 8.2.beta of Sage. Since this branch here does solve the immediate problem of docbuilding, I suggest to merge this patch as-is and in the mean time work on a solution for upstream.",
    "created_at": "2017-11-20T08:40:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434647",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
fbissey: I am assuming that this ticket would only be merged in some 8.2.beta of Sage. Since this branch here does solve the immediate problem of docbuilding, I suggest to merge this patch as-is and in the mean time work on a solution for upstream.



---

archive/issue_comments_434648.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jdemeyer](#comment%3A12):\n> fbissey: I am assuming that this ticket would only be merged in some 8.2.beta of Sage. Since this branch here does solve the immediate problem of docbuilding, I suggest to merge this patch as-is and in the mean time work on a solution for upstream.\n\n\nI was hoping a more conciliatory attitude and hadn't removed the positive review. This is now back to need_work. This is just un-acceptable to sage-on-distro this close to release. \n\nWe would have to make our own version of the patch that does the \"right thing\" (TM) instead of a \"sloppy job\" (TM) just because we can and feel in too much of a hurry for 3 more lines of code, anyway so let's do it right now instead.",
    "created_at": "2017-11-20T08:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434648",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Replying to [jdemeyer](#comment%3A12):
> fbissey: I am assuming that this ticket would only be merged in some 8.2.beta of Sage. Since this branch here does solve the immediate problem of docbuilding, I suggest to merge this patch as-is and in the mean time work on a solution for upstream.


I was hoping a more conciliatory attitude and hadn't removed the positive review. This is now back to need_work. This is just un-acceptable to sage-on-distro this close to release. 

We would have to make our own version of the patch that does the "right thing" (TM) instead of a "sloppy job" (TM) just because we can and feel in too much of a hurry for 3 more lines of code, anyway so let's do it right now instead.



---

archive/issue_comments_434649.json:
```json
{
    "body": "**Changing commit** from \"[893b03d4d00ea6566648ed315569a46f4096551b](https://github.com/sagemath/sagetrac-mirror/commit/893b03d4d00ea6566648ed315569a46f4096551b)\" to \"[67e6156afccd12253c2c330bff6cb9fdeb11245c](https://github.com/sagemath/sagetrac-mirror/commit/67e6156afccd12253c2c330bff6cb9fdeb11245c)\".",
    "created_at": "2017-11-20T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434649",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[893b03d4d00ea6566648ed315569a46f4096551b](https://github.com/sagemath/sagetrac-mirror/commit/893b03d4d00ea6566648ed315569a46f4096551b)" to "[67e6156afccd12253c2c330bff6cb9fdeb11245c](https://github.com/sagemath/sagetrac-mirror/commit/67e6156afccd12253c2c330bff6cb9fdeb11245c)".



---

archive/issue_comments_434650.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2017-11-20T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434650",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_434651.json:
```json
{
    "body": "<a id='comment:14'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67e6156afccd12253c2c330bff6cb9fdeb11245c\">67e6156</a></td><td><code>Better patch for sympy, that doesn't force sage as a runtime dependency.</code></td></tr></table>\n",
    "created_at": "2017-11-20T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434651",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67e6156afccd12253c2c330bff6cb9fdeb11245c">67e6156</a></td><td><code>Better patch for sympy, that doesn't force sage as a runtime dependency.</code></td></tr></table>




---

archive/issue_comments_434652.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/24067)\" to \"[u/fbissey/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/24067)\".",
    "created_at": "2017-11-20T09:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434652",
    "user": "https://github.com/kiwifb"
}
```

**Changing branch** from "[u/jdemeyer/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/24067)" to "[u/fbissey/24067](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/24067)".



---

archive/issue_comments_434653.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-11-20T09:25:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434653",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_434654.json:
```json
{
    "body": "<a id='comment:16'></a>\n@kiwifb, that last commit, while much better than what was before, will still force all users of sympy to import sage into their python program, as long as sage is installed.\n\nA better method might be something like this instead:\n\n```\nif 'sage.XXXX' in sys.modules:\n    from sage.interfaces.sympy import sympy_init\n    sympy_init()\n```\n\nwhere XXXX is some module that sage always imports. So the patch is only activated if sage is already imported.\n\nThis might be more acceptable to upstream as well.",
    "created_at": "2017-11-20T09:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434654",
    "user": "https://github.com/infinity0"
}
```

<a id='comment:16'></a>
@kiwifb, that last commit, while much better than what was before, will still force all users of sympy to import sage into their python program, as long as sage is installed.

A better method might be something like this instead:

```
if 'sage.XXXX' in sys.modules:
    from sage.interfaces.sympy import sympy_init
    sympy_init()
```

where XXXX is some module that sage always imports. So the patch is only activated if sage is already imported.

This might be more acceptable to upstream as well.



---

archive/issue_comments_434655.json:
```json
{
    "body": "<a id='comment:17'></a>\n`@`infinity0 I agree that is not perfect - for exactly the reason you mention - but that's the best I could come up with without more complication. Feel free to improve it, that's one of the reason I called other packagers on this ticket.",
    "created_at": "2017-11-20T09:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434655",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>
`@`infinity0 I agree that is not perfect - for exactly the reason you mention - but that's the best I could come up with without more complication. Feel free to improve it, that's one of the reason I called other packagers on this ticket.



---

archive/issue_comments_434656.json:
```json
{
    "body": "<a id='comment:18'></a>\nSo what about using `if ... in sys.modules`?\n\nIf you additionally need to support the use-case where a third-party program/library really has to import sympy *then later* import sage (I can't imagine why), then the `if ... in sys.modules` logic needs to also be added to a sage module but in reverse - i.e. check if sympy is already imported, and activate the patch if so.\n\nIn any case, we're unlikely to patch sympy in Debian like this, unless they indicate that they would already accept it. (Someone else maintains it, the situation is outside of my control.) Could you/someone else file a upstream ticket *before* releasing this in Sage?",
    "created_at": "2017-11-20T09:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434656",
    "user": "https://github.com/infinity0"
}
```

<a id='comment:18'></a>
So what about using `if ... in sys.modules`?

If you additionally need to support the use-case where a third-party program/library really has to import sympy *then later* import sage (I can't imagine why), then the `if ... in sys.modules` logic needs to also be added to a sage module but in reverse - i.e. check if sympy is already imported, and activate the patch if so.

In any case, we're unlikely to patch sympy in Debian like this, unless they indicate that they would already accept it. (Someone else maintains it, the situation is outside of my control.) Could you/someone else file a upstream ticket *before* releasing this in Sage?



---

archive/issue_comments_434657.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [infinity0](#comment%3A18):\n> So what about using `if ... in sys.modules`?\n> \n\n\nI can make that change, but I am calling it a night :)\n\n> If you additionally need to support the use-case where a third-party program/library really has to import sympy *then later* import sage (I can't imagine why), then the `if ... in sys.modules` logic needs to also be added to a sage module but in reverse - i.e. check if sympy is already imported, and activate the patch if so.\n> \n> In any case, we're unlikely to patch sympy in Debian like this, unless they indicate that they would already accept it. (Someone else maintains it, the situation is outside of my control.) Could you/someone else file a upstream ticket *before* releasing this in Sage?\n\n\n+1, @rwst do you have an upstream issue for this? There definitely should be.",
    "created_at": "2017-11-20T09:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434657",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>
Replying to [infinity0](#comment%3A18):
> So what about using `if ... in sys.modules`?
> 


I can make that change, but I am calling it a night :)

> If you additionally need to support the use-case where a third-party program/library really has to import sympy *then later* import sage (I can't imagine why), then the `if ... in sys.modules` logic needs to also be added to a sage module but in reverse - i.e. check if sympy is already imported, and activate the patch if so.
> 
> In any case, we're unlikely to patch sympy in Debian like this, unless they indicate that they would already accept it. (Someone else maintains it, the situation is outside of my control.) Could you/someone else file a upstream ticket *before* releasing this in Sage?


+1, @rwst do you have an upstream issue for this? There definitely should be.



---

archive/issue_comments_434658.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [fbissey](#comment%3A19):\n> +1, @rwst do you have an upstream issue for this? There definitely should be.\n\n\nI'll open one if this ticket has code that all agree on. Set at least `needs review` so we have the patchbots.",
    "created_at": "2017-11-20T10:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434658",
    "user": "https://github.com/rwst"
}
```

<a id='comment:20'></a>
Replying to [fbissey](#comment%3A19):
> +1, @rwst do you have an upstream issue for this? There definitely should be.


I'll open one if this ticket has code that all agree on. Set at least `needs review` so we have the patchbots.



---

archive/issue_comments_434659.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [fbissey](#comment%3A13):\n> This is just un-acceptable to sage-on-distro\n\n\nEven for a beta version of Sage? I agree that it would be unacceptable in a released version.",
    "created_at": "2017-11-20T10:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434659",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [fbissey](#comment%3A13):
> This is just un-acceptable to sage-on-distro


Even for a beta version of Sage? I agree that it would be unacceptable in a released version.



---

archive/issue_comments_434660.json:
```json
{
    "body": "<a id='comment:22'></a>\nIf we're going to submit a patch upstream, we shouldn't rush.",
    "created_at": "2017-11-20T11:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434660",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
If we're going to submit a patch upstream, we shouldn't rush.



---

archive/issue_comments_434661.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-11-20T11:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434661",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_434662.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n `sympy_init()` enables conversion of SymPy objects. It is called with the first initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any import of SymPy.\n+\n+We should also revert the patch added in #24238.\n``````\n",
    "created_at": "2017-11-20T11:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434662",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 `sympy_init()` enables conversion of SymPy objects. It is called with the first initialization of a `SympyConverter`, i.e. with `Expression._sympy_()`. Better is to only call it once with any import of SymPy.
+
+We should also revert the patch added in #24238.
``````




---

archive/issue_comments_434663.json:
```json
{
    "body": "**Stopgaps:** #24238",
    "created_at": "2017-11-20T11:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434663",
    "user": "https://github.com/jdemeyer"
}
```

**Stopgaps:** #24238



---

archive/issue_comments_434664.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [jdemeyer](#comment%3A21):\n> Replying to [fbissey](#comment%3A13):\n> > This is just un-acceptable to sage-on-distro\n\n> \n> Even for a beta version of Sage? I agree that it would be unacceptable in a released version.\n\n\nCome on. We are at rc2. We are just ironing bugs, that would end up in the released 8.1 unless you moved the milestone to 8.2.",
    "created_at": "2017-11-20T19:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434664",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
Replying to [jdemeyer](#comment%3A21):
> Replying to [fbissey](#comment%3A13):
> > This is just un-acceptable to sage-on-distro

> 
> Even for a beta version of Sage? I agree that it would be unacceptable in a released version.


Come on. We are at rc2. We are just ironing bugs, that would end up in the released 8.1 unless you moved the milestone to 8.2.



---

archive/issue_comments_434665.json:
```json
{
    "body": "<a id='comment:25'></a>\nI would be surprised if this was positively reviewed it would make it into 8.1 (unless we set it as a blocker).",
    "created_at": "2017-11-20T23:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434665",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:25'></a>
I would be surprised if this was positively reviewed it would make it into 8.1 (unless we set it as a blocker).



---

archive/issue_comments_434666.json:
```json
{
    "body": "<a id='comment:26'></a>\nBecause of the troubles building the documentation reported on sage-release, one of #24238 or this ticket has to be a blocker in my opinion. I came to this ticket after Jeroen commented on #24238 that this ticket should be the one with the fix.",
    "created_at": "2017-11-20T23:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434666",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>
Because of the troubles building the documentation reported on sage-release, one of #24238 or this ticket has to be a blocker in my opinion. I came to this ticket after Jeroen commented on #24238 that this ticket should be the one with the fix.



---

archive/issue_comments_434667.json:
```json
{
    "body": "<a id='comment:27'></a>\nThe third option would be a revert ticket for the manifolds changes that introduced it.",
    "created_at": "2017-11-21T04:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434667",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'></a>
The third option would be a revert ticket for the manifolds changes that introduced it.



---

archive/issue_comments_434668.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [fbissey](#comment%3A26):\n> Because of the troubles building the documentation reported on sage-release, one of #24238 or this ticket has to be a blocker in my opinion. I came to this ticket after Jeroen commented on #24238 that this ticket should be the one with the fix.\n\n\n#24238 is a blocker. That ticket is also simple enough that it shouldn't cause problems.",
    "created_at": "2017-11-21T08:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434668",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [fbissey](#comment%3A26):
> Because of the troubles building the documentation reported on sage-release, one of #24238 or this ticket has to be a blocker in my opinion. I came to this ticket after Jeroen commented on #24238 that this ticket should be the one with the fix.


#24238 is a blocker. That ticket is also simple enough that it shouldn't cause problems.



---

archive/issue_comments_434669.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [fbissey](#comment%3A24):\n> We are just ironing bugs, that would end up in the released 8.1 unless you moved the milestone to 8.2.\n\n\nNo. I'm pretty sure that the release manager only merges \"blocker\" tickets once an rc has been released. The whole point of an \"rc\" is that it should be close to a release and you don't want to merge random tickets at that point.\n\nAnyway, that doesn't matter anymore for this ticket.",
    "created_at": "2017-11-21T08:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434669",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Replying to [fbissey](#comment%3A24):
> We are just ironing bugs, that would end up in the released 8.1 unless you moved the milestone to 8.2.


No. I'm pretty sure that the release manager only merges "blocker" tickets once an rc has been released. The whole point of an "rc" is that it should be close to a release and you don't want to merge random tickets at that point.

Anyway, that doesn't matter anymore for this ticket.



---

archive/issue_comments_434670.json:
```json
{
    "body": "**Changing author** from \"Ralf Stephan\" to \"\".",
    "created_at": "2021-07-06T02:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434670",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Ralf Stephan" to "".



---

archive/issue_comments_434671.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer, Ralf Stephan\" to \"\".",
    "created_at": "2021-07-06T02:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434671",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Jeroen Demeyer, Ralf Stephan" to "".



---

archive/issue_events_069826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-06T02:46:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24067#event-69826"
}
```



---

archive/issue_comments_434672.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2021-07-06T02:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434672",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_434673.json:
```json
{
    "body": "<a id='comment:31'></a>\nTime to close this bizarre ticket",
    "created_at": "2021-07-06T02:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434673",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Time to close this bizarre ticket



---

archive/issue_comments_434674.json:
```json
{
    "body": "<a id='comment:32'></a>\nI am not remembering much about it but obviously it didn't make the cut then.",
    "created_at": "2021-07-06T04:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434674",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
I am not remembering much about it but obviously it didn't make the cut then.



---

archive/issue_comments_434675.json:
```json
{
    "body": "**Reviewer:** Fran\u00e7ois Bissey",
    "created_at": "2021-07-06T04:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434675",
    "user": "https://github.com/kiwifb"
}
```

**Reviewer:** Fran√ßois Bissey



---

archive/issue_comments_434676.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-07-06T04:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24067#issuecomment-434676",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_069827.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T02:08:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24067",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24067#event-69827"
}
```
