# Issue 24705: Do not hardcode the C++ stdlib in setup.py

archive/issues_024468.json:
```json
{
    "assignees": [],
    "body": "sage build with the following flags still uses libstdc++ for some cythonized so files:\n\n```\nexport CC=\"clang\"\nexport CXX=\"clang++ --stdlib=libc++\"\nexport CXXFLAGS=\"$CXXFLAGS --stdlib=libc++\"\nexport LDFLAGS=\"$LDFLAGS -lc++ --stdlib=libc++\"\n```\n\n```\n> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so\n\tlinux-vdso.so.1 (0x00007ffc8f3f1000)\n\tlibntl.so.33 => /home/ralf/sage/local/lib/libntl.so.33 (0x00007f823f6d7000)\n\tlibgmp.so.23 => /home/ralf/sage/local/lib/libgmp.so.23 (0x00007f823f448000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007f823f14b000)\n\tlibstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007f823edc2000)\n\tlibpython2.7.so.1.0 => /home/ralf/sage/local/lib/libpython2.7.so.1.0 (0x00007f823e9d8000)\n\tlibpari-gmp-2.10.so.0 => /home/ralf/sage/local/lib/libpari-gmp-2.10.so.0 (0x00007f823def9000)\n\tlibgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007f823dce2000)\n\tlibpthread.so.0 => /lib64/libpthread.so.0 (0x00007f823dac5000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007f823d724000)\n\tlibgf2x.so.1 => /home/ralf/sage/local/lib/libgf2x.so.1 (0x00007f823d501000)\n\tlibc++.so.1 => /usr/lib64/libc++.so.1 (0x00007f823ff05000)\n\tlibc++abi.so.1 => /usr/lib64/libc++abi.so.1 (0x00007f823fec2000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00007f823fdd6000)\n\tlibdl.so.2 => /lib64/libdl.so.2 (0x00007f823d2fd000)\n\tlibutil.so.1 => /lib64/libutil.so.1 (0x00007f823d0fa000)\n```\n\n\nCC:  @kiwifb @simon-king-jena @jdemeyer\n\nBranch/Commit: **[u/rws/do_not_hardcode_the_c___stdlib_in_setup_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/do_not_hardcode_the_c___stdlib_in_setup_py) @ [`0e4016e`](https://github.com/sagemath/sagetrac-mirror/commit/0e4016e97ff33a4ca0197e0242716c420a24685b)**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24705_\n\n",
    "closed_at": "2018-02-12T13:17:37Z",
    "created_at": "2018-02-10T15:22:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Do not hardcode the C++ stdlib in setup.py",
    "type": "issue",
    "updated_at": "2018-02-12T13:17:37Z",
    "url": "https://github.com/sagemath/sage/issues/24705",
    "user": "https://github.com/rwst"
}
```
sage build with the following flags still uses libstdc++ for some cythonized so files:

```
export CC="clang"
export CXX="clang++ --stdlib=libc++"
export CXXFLAGS="$CXXFLAGS --stdlib=libc++"
export LDFLAGS="$LDFLAGS -lc++ --stdlib=libc++"
```

```
> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so
	linux-vdso.so.1 (0x00007ffc8f3f1000)
	libntl.so.33 => /home/ralf/sage/local/lib/libntl.so.33 (0x00007f823f6d7000)
	libgmp.so.23 => /home/ralf/sage/local/lib/libgmp.so.23 (0x00007f823f448000)
	libm.so.6 => /lib64/libm.so.6 (0x00007f823f14b000)
	libstdc++.so.6 => /usr/lib64/libstdc++.so.6 (0x00007f823edc2000)
	libpython2.7.so.1.0 => /home/ralf/sage/local/lib/libpython2.7.so.1.0 (0x00007f823e9d8000)
	libpari-gmp-2.10.so.0 => /home/ralf/sage/local/lib/libpari-gmp-2.10.so.0 (0x00007f823def9000)
	libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007f823dce2000)
	libpthread.so.0 => /lib64/libpthread.so.0 (0x00007f823dac5000)
	libc.so.6 => /lib64/libc.so.6 (0x00007f823d724000)
	libgf2x.so.1 => /home/ralf/sage/local/lib/libgf2x.so.1 (0x00007f823d501000)
	libc++.so.1 => /usr/lib64/libc++.so.1 (0x00007f823ff05000)
	libc++abi.so.1 => /usr/lib64/libc++abi.so.1 (0x00007f823fec2000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f823fdd6000)
	libdl.so.2 => /lib64/libdl.so.2 (0x00007f823d2fd000)
	libutil.so.1 => /lib64/libutil.so.1 (0x00007f823d0fa000)
```


CC:  @kiwifb @simon-king-jena @jdemeyer

Branch/Commit: **[u/rws/do_not_hardcode_the_c___stdlib_in_setup_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/do_not_hardcode_the_c___stdlib_in_setup_py) @ [`0e4016e`](https://github.com/sagemath/sagetrac-mirror/commit/0e4016e97ff33a4ca0197e0242716c420a24685b)**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/24705_





---

archive/issue_events_342055.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-10T15:22:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342055"
}
```



---

archive/issue_events_342056.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-10T15:22:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342056"
}
```



---

archive/issue_events_342057.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-10T15:22:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342057"
}
```



---

archive/issue_events_342058.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-10T15:22:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342058"
}
```



---

archive/issue_comments_375520.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[ntl-10.3.0.log](https://github.com/sagemath/sage/files/ticket24705/ntl-10.3.0.log)**\n\nsagelib is the culprit. It has libstdc++ hardcoded:\n\n```\n../logs/pkgs/sagelib-8.2.beta5.log:[212/474] [211/474] clang++ -pthread -shared -L/home/ralf/sage/local/lib -Wl,-rpath,/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -Wl,-rpath,/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/ntl/ntl_ZZ_pX.o -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -lntl -lgmp -lm -lstdc++ -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/libs/ntl/ntl_ZZ_pX.so -lpari\n```",
    "created_at": "2018-02-10T15:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375520",
    "user": "https://github.com/rwst"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[ntl-10.3.0.log](https://github.com/sagemath/sage/files/ticket24705/ntl-10.3.0.log)**

sagelib is the culprit. It has libstdc++ hardcoded:

```
../logs/pkgs/sagelib-8.2.beta5.log:[212/474] [211/474] clang++ -pthread -shared -L/home/ralf/sage/local/lib -Wl,-rpath,/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -Wl,-rpath,/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/ntl/ntl_ZZ_pX.o -L/home/ralf/sage/local/lib -L/home/ralf/sage/local/lib -lntl -lgmp -lm -lstdc++ -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/libs/ntl/ntl_ZZ_pX.so -lpari
```



---

archive/issue_events_342059.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-10T15:28:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "title_is": "sagelib build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so",
    "title_was": "NTL build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342059"
}
```



---

archive/issue_comments_375521.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThis is the relevant part of `src/setup.py`:\n\n```\n        # Libraries: add stdc++ if needed and sort them\n        libs = kwds.get('libraries', [])\n        if cplusplus:\n            libs = libs + ['stdc++']\n```",
    "created_at": "2018-02-11T06:47:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375521",
    "user": "https://github.com/rwst"
}
```

<div id="comment:3" align="right">comment:3</div>

This is the relevant part of `src/setup.py`:

```
        # Libraries: add stdc++ if needed and sort them
        libs = kwds.get('libraries', [])
        if cplusplus:
            libs = libs + ['stdc++']
```



---

archive/issue_comments_375522.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+sagelib build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so\n \n ```\n ralf@ark:~/sage/pynac> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so\n``````\n",
    "created_at": "2018-02-11T06:47:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375522",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+sagelib build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so
 
 ```
 ralf@ark:~/sage/pynac> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so
``````




---

archive/issue_events_342060.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-11T06:47:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "title_is": "Do not hardcode the C++ stdlib in setup.py",
    "title_was": "sagelib build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342060"
}
```



---

archive/issue_comments_375523.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt seems best to add `\"--stdlib=libc++\"`(else the libstdc++ is linked) only if it is already in CFLAGS. See also #24705. \n\nTesting this manually works, except for `element_givaro.pyx` which still gets compiled without the `\"--stdlib=libc++\"` directive.",
    "created_at": "2018-02-11T07:10:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375523",
    "user": "https://github.com/rwst"
}
```

<div id="comment:4" align="right">comment:4</div>

It seems best to add `"--stdlib=libc++"`(else the libstdc++ is linked) only if it is already in CFLAGS. See also #24705. 

Testing this manually works, except for `element_givaro.pyx` which still gets compiled without the `"--stdlib=libc++"` directive.



---

archive/issue_comments_375524.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNever mind, I got it compiled, yeah, now testing.",
    "created_at": "2018-02-11T07:15:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375524",
    "user": "https://github.com/rwst"
}
```

<div id="comment:5" align="right">comment:5</div>

Never mind, I got it compiled, yeah, now testing.



---

archive/issue_comments_375525.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@rwst](#comment:4):\n> It seems best to add `\"--stdlib=libc++\"`(else the libstdc++ is linked) only if it is already in CFLAGS. See also #24705. \n\nDo you mean #24707?",
    "created_at": "2018-02-11T08:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375525",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@rwst](#comment:4):
> It seems best to add `"--stdlib=libc++"`(else the libstdc++ is linked) only if it is already in CFLAGS. See also #24705. 

Do you mean #24707?



---

archive/issue_events_342061.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-11T08:56:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342061"
}
```



---

archive/issue_events_342062.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-11T08:56:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342062"
}
```



---

archive/issue_comments_375526.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@rwst](#comment:3):\n> This is the relevant part of `src/setup.py`:\n> \n> ```\n>         # Libraries: add stdc++ if needed and sort them\n>         libs = kwds.get('libraries', [])\n>         if cplusplus:\n>             libs = libs + ['stdc++']\n> ```\n\nSorry, I don't get it: What would you replace it with, so that the sage library will not use `libstdc++` if `--stdlib=libc++` is provided?",
    "created_at": "2018-02-11T13:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375526",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@rwst](#comment:3):
> This is the relevant part of `src/setup.py`:
> 
> ```
>         # Libraries: add stdc++ if needed and sort them
>         libs = kwds.get('libraries', [])
>         if cplusplus:
>             libs = libs + ['stdc++']
> ```

Sorry, I don't get it: What would you replace it with, so that the sage library will not use `libstdc++` if `--stdlib=libc++` is provided?



---

archive/issue_comments_375527.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@simon-king-jena](#comment:10):\n> Replying to [@rwst](#comment:3):\n> > This is the relevant part of `src/setup.py`:\n> > \n> > ```\n> >         # Libraries: add stdc++ if needed and sort them\n> >         libs = kwds.get('libraries', [])\n> >         if cplusplus:\n> >             libs = libs + ['stdc++']\n> > ```\n\n> \n> Sorry, I don't get it: What would you replace it with, so that the sage library will not use `libstdc++` if `--stdlib=libc++` is provided?\n\nAt the moment we're still experimenting with flags, see [#24707 comment:9](https://github.com/sagemath/sage/issues/24707#comment:9). But I already think that the line above needs to be changed to `libs = libs + ['c++']` in order to get `-lc++` in the link command.",
    "created_at": "2018-02-11T14:22:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375527",
    "user": "https://github.com/rwst"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@simon-king-jena](#comment:10):
> Replying to [@rwst](#comment:3):
> > This is the relevant part of `src/setup.py`:
> > 
> > ```
> >         # Libraries: add stdc++ if needed and sort them
> >         libs = kwds.get('libraries', [])
> >         if cplusplus:
> >             libs = libs + ['stdc++']
> > ```

> 
> Sorry, I don't get it: What would you replace it with, so that the sage library will not use `libstdc++` if `--stdlib=libc++` is provided?

At the moment we're still experimenting with flags, see [#24707 comment:9](https://github.com/sagemath/sage/issues/24707#comment:9). But I already think that the line above needs to be changed to `libs = libs + ['c++']` in order to get `-lc++` in the link command.



---

archive/issue_comments_375528.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@rwst](#comment:11):\n> At the moment we're still experimenting with flags, see [#24707 comment:9](https://github.com/sagemath/sage/issues/24707#comment:9). But I already think that the line above needs to be changed to `libs = libs + ['c++']` in order to get `-lc++` in the link command.\n\nBut certainly not unconditionally. Or do we want to build with `-lc++` when using gcc?",
    "created_at": "2018-02-11T14:34:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375528",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@rwst](#comment:11):
> At the moment we're still experimenting with flags, see [#24707 comment:9](https://github.com/sagemath/sage/issues/24707#comment:9). But I already think that the line above needs to be changed to `libs = libs + ['c++']` in order to get `-lc++` in the link command.

But certainly not unconditionally. Or do we want to build with `-lc++` when using gcc?



---

archive/issue_comments_375529.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@simon-king-jena](#comment:12):\n> But certainly not unconditionally. Or do we want to build with `-lc++` when using gcc?\n\nOf course (EDIT: not).",
    "created_at": "2018-02-11T14:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375529",
    "user": "https://github.com/rwst"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@simon-king-jena](#comment:12):
> But certainly not unconditionally. Or do we want to build with `-lc++` when using gcc?

Of course (EDIT: not).



---

archive/issue_comments_375530.json:
```json
{
    "body": "Branch: **[u/rws/do_not_hardcode_the_c___stdlib_in_setup_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/do_not_hardcode_the_c___stdlib_in_setup_py)**",
    "created_at": "2018-02-11T16:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375530",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/do_not_hardcode_the_c___stdlib_in_setup_py](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/do_not_hardcode_the_c___stdlib_in_setup_py)**



---

archive/issue_comments_375531.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis still doesn't catch all ways to smuggle `-lstdc++` in the cython file linking stage of sagelib.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e4016e97ff33a4ca0197e0242716c420a24685b\"><code>0e4016e</code></a></td><td><code>24705: Do not hardcode the C++ stdlib in setup.py</code></td></tr></table>\n",
    "created_at": "2018-02-11T16:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375531",
    "user": "https://github.com/rwst"
}
```

<div id="comment:15" align="right">comment:15</div>

This still doesn't catch all ways to smuggle `-lstdc++` in the cython file linking stage of sagelib.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e4016e97ff33a4ca0197e0242716c420a24685b"><code>0e4016e</code></a></td><td><code>24705: Do not hardcode the C++ stdlib in setup.py</code></td></tr></table>




---

archive/issue_comments_375532.json:
```json
{
    "body": "Commit: **[`0e4016e`](https://github.com/sagemath/sagetrac-mirror/commit/0e4016e97ff33a4ca0197e0242716c420a24685b)**",
    "created_at": "2018-02-11T16:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375532",
    "user": "https://github.com/rwst"
}
```

Commit: **[`0e4016e`](https://github.com/sagemath/sagetrac-mirror/commit/0e4016e97ff33a4ca0197e0242716c420a24685b)**



---

archive/issue_comments_375533.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,14 @@\n-sagelib build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so\n+sage build with the following flags still uses libstdc++ for some cythonized so files:\n \n ```\n-ralf@ark:~/sage/pynac> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so\n+export CC=\"clang\"\n+export CXX=\"clang++ --stdlib=libc++\"\n+export CXXFLAGS=\"$CXXFLAGS --stdlib=libc++\"\n+export LDFLAGS=\"$LDFLAGS -lc++ --stdlib=libc++\"\n+```\n+\n+```\n+> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so\n \tlinux-vdso.so.1 (0x00007ffc8f3f1000)\n \tlibntl.so.33 => /home/ralf/sage/local/lib/libntl.so.33 (0x00007f823f6d7000)\n \tlibgmp.so.23 => /home/ralf/sage/local/lib/libgmp.so.23 (0x00007f823f448000)\n``````\n",
    "created_at": "2018-02-11T16:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375533",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,14 @@
-sagelib build with --stdlib=libc++ still uses libstdc++ for ntl_ZZ.so
+sage build with the following flags still uses libstdc++ for some cythonized so files:
 
 ```
-ralf@ark:~/sage/pynac> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so
+export CC="clang"
+export CXX="clang++ --stdlib=libc++"
+export CXXFLAGS="$CXXFLAGS --stdlib=libc++"
+export LDFLAGS="$LDFLAGS -lc++ --stdlib=libc++"
+```
+
+```
+> ldd /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so
 	linux-vdso.so.1 (0x00007ffc8f3f1000)
 	libntl.so.33 => /home/ralf/sage/local/lib/libntl.so.33 (0x00007f823f6d7000)
 	libgmp.so.23 => /home/ralf/sage/local/lib/libgmp.so.23 (0x00007f823f448000)
``````




---

archive/issue_comments_375534.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAttachment: **[sagelib-8.2.beta5.log](https://github.com/sagemath/sage/files/ticket24705/sagelib-8.2.beta5.log)**\n\nI did\n\n```\nexport CC=\"clang\"\nexport CXX=\"clang++ --stdlib=libc++\nexport CXXFLAGS=\"$CXXFLAGS -I/usr/include/libcxxabi/ --stdlib=libc++\"\nexport LDFLAGS=\"$LDFLAGS -lc++ --stdlib=libc++\"\nmake build\n```\nThe build process goes pretty far, however it hangs (for an hour or so) in sagelib. See the attached log.",
    "created_at": "2018-02-11T20:34:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375534",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Attachment: **[sagelib-8.2.beta5.log](https://github.com/sagemath/sage/files/ticket24705/sagelib-8.2.beta5.log)**

I did

```
export CC="clang"
export CXX="clang++ --stdlib=libc++
export CXXFLAGS="$CXXFLAGS -I/usr/include/libcxxabi/ --stdlib=libc++"
export LDFLAGS="$LDFLAGS -lc++ --stdlib=libc++"
make build
```
The build process goes pretty far, however it hangs (for an hour or so) in sagelib. See the attached log.



---

archive/issue_comments_375535.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI am a bit late to this party - sorry. I don't have this problem at all with my clang configured to use libc++ by default. Is it possible to have `readelf -d /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so` on the object initially posted?",
    "created_at": "2018-02-12T04:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375535",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:18" align="right">comment:18</div>

I am a bit late to this party - sorry. I don't have this problem at all with my clang configured to use libc++ by default. Is it possible to have `readelf -d /home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/ntl/ntl_ZZ.so` on the object initially posted?



---

archive/issue_events_342063.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-12T07:11:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342063"
}
```



---

archive/issue_events_342064.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-12T07:11:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342064"
}
```



---

archive/issue_events_342065.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-12T07:11:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342065"
}
```



---

archive/issue_comments_375536.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nSo this ticket is wontfix. Use these flags:\n\n```\nexport CC=\"clang\"\nexport CXX=\"clang++\"\nexport CLANG_DEFAULT_CXX_STDLIB=\"libc++\"\n```",
    "created_at": "2018-02-12T07:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375536",
    "user": "https://github.com/rwst"
}
```

<div id="comment:19" align="right">comment:19</div>

So this ticket is wontfix. Use these flags:

```
export CC="clang"
export CXX="clang++"
export CLANG_DEFAULT_CXX_STDLIB="libc++"
```



---

archive/issue_events_342066.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-12T07:11:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342066"
}
```



---

archive/issue_events_342067.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-12T07:12:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342067"
}
```



---

archive/issue_events_342068.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-12T07:12:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342068"
}
```



---

archive/issue_events_342069.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-02-12T07:21:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342069"
}
```



---

archive/issue_events_342070.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-02-12T07:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342070"
}
```



---

archive/issue_comments_375537.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@rwst](#comment:19):\n> So this ticket is wontfix. Use these flags:\n> \n> ```\n> export CC=\"clang\"\n> export CXX=\"clang++\"\n> export CLANG_DEFAULT_CXX_STDLIB=\"libc++\"\n> ```\n\nDo you claim that this is enough to override what is written in setup.py???\n\nRecall that Sage's setup.py forces usage of `libstdc++` and not `libc++`.",
    "created_at": "2018-02-12T07:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375537",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@rwst](#comment:19):
> So this ticket is wontfix. Use these flags:
> 
> ```
> export CC="clang"
> export CXX="clang++"
> export CLANG_DEFAULT_CXX_STDLIB="libc++"
> ```

Do you claim that this is enough to override what is written in setup.py???

Recall that Sage's setup.py forces usage of `libstdc++` and not `libc++`.



---

archive/issue_comments_375538.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@simon-king-jena](#comment:21):\n> Do you claim that this is enough to override what is written in setup.py???\n\nPlease let me first test whether the given flags are enough to let the branch from #24710 build on ubuntu. Or do you even claim that with your flags scipy will build without modifications?",
    "created_at": "2018-02-12T07:30:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375538",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@simon-king-jena](#comment:21):
> Do you claim that this is enough to override what is written in setup.py???

Please let me first test whether the given flags are enough to let the branch from #24710 build on ubuntu. Or do you even claim that with your flags scipy will build without modifications?



---

archive/issue_comments_375539.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n`setup.py` adds `-lstdc++` to the flags used for linking but that can still be discarded by the compiler driver used. I can build sage with clang without altering `setup.py` so you should be able to. I am glad that Ralph found that environment variable.",
    "created_at": "2018-02-12T07:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375539",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:23" align="right">comment:23</div>

`setup.py` adds `-lstdc++` to the flags used for linking but that can still be discarded by the compiler driver used. I can build sage with clang without altering `setup.py` so you should be able to. I am glad that Ralph found that environment variable.



---

archive/issue_comments_375540.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@simon-king-jena](#comment:22):\n> Replying to [@simon-king-jena](#comment:21):\n> > Do you claim that this is enough to override what is written in setup.py???\n\n> \n> Please let me first test whether the given flags are enough to let the branch from #24710 build on ubuntu. Or do you even claim that with your flags scipy will build without modifications?\n\nI do not make such claims without testing first.",
    "created_at": "2018-02-12T07:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375540",
    "user": "https://github.com/rwst"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@simon-king-jena](#comment:22):
> Replying to [@simon-king-jena](#comment:21):
> > Do you claim that this is enough to override what is written in setup.py???

> 
> Please let me first test whether the given flags are enough to let the branch from #24710 build on ubuntu. Or do you even claim that with your flags scipy will build without modifications?

I do not make such claims without testing first.



---

archive/issue_comments_375541.json:
```json
{
    "body": "Attachment: **[giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)**",
    "created_at": "2018-02-12T09:15:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375541",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)**



---

archive/issue_comments_375542.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI just tried with the branch from #24710 and with the flags stated in [comment:19](#comment:19). But giac fails to build, see [attachment: giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)",
    "created_at": "2018-02-12T09:16:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375542",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:25" align="right">comment:25</div>

I just tried with the branch from #24710 and with the flags stated in [comment:19](#comment:19). But giac fails to build, see [attachment: giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)



---

archive/issue_comments_375543.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@simon-king-jena](#comment:25):\n> I just tried with the branch from #24710 and with the flags stated in [comment:19](#comment:19). But giac fails to build, see [attachment: giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)\n\nIt looks like you need #24696",
    "created_at": "2018-02-12T09:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375543",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@simon-king-jena](#comment:25):
> I just tried with the branch from #24710 and with the flags stated in [comment:19](#comment:19). But giac fails to build, see [attachment: giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)

It looks like you need #24696



---

archive/issue_comments_375544.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@kiwifb](#comment:26):\n> Replying to [@simon-king-jena](#comment:25):\n> > I just tried with the branch from #24710 and with the flags stated in [comment:19](#comment:19). But giac fails to build, see [attachment: giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)\n\n> \n> It looks like you need #24696\n\nOK, trying again with #24710 and #24696",
    "created_at": "2018-02-12T09:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375544",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@kiwifb](#comment:26):
> Replying to [@simon-king-jena](#comment:25):
> > I just tried with the branch from #24710 and with the flags stated in [comment:19](#comment:19). But giac fails to build, see [attachment: giac-1.4.9.45.p1.log](https://github.com/sagemath/sage/files/ticket24705/giac-1.4.9.45.p1.log)

> 
> It looks like you need #24696

OK, trying again with #24710 and #24696



---

archive/issue_comments_375545.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nHooray, it builds now! I didn't run tests though. Anyway, to summarize what I did on ubuntu:\n\n- install clang, clang-dev, libc++abi-dev\n- checkout/merge #24710 and #24696\n- \n\n  ```\n  export CC=\"clang\"\n  export CXX=\"clang++\"\n  export CLANG_DEFAULT_CXX_STDLIB=\"libc++\"\n  ```\n- make\n\nSo, your finding out about `CLANG_DEFAULT_CXX_STDLIB` was great!\n\nSide-remarks:\n\n- I did not have the impression that building Sage with clang was faster than with gcc.\n- I will now do some small timings to see about the performance of the code generated by clang vs. gcc.",
    "created_at": "2018-02-12T10:45:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375545",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">comment:28</div>

Hooray, it builds now! I didn't run tests though. Anyway, to summarize what I did on ubuntu:

- install clang, clang-dev, libc++abi-dev
- checkout/merge #24710 and #24696
- 

  ```
  export CC="clang"
  export CXX="clang++"
  export CLANG_DEFAULT_CXX_STDLIB="libc++"
  ```
- make

So, your finding out about `CLANG_DEFAULT_CXX_STDLIB` was great!

Side-remarks:

- I did not have the impression that building Sage with clang was faster than with gcc.
- I will now do some small timings to see about the performance of the code generated by clang vs. gcc.



---

archive/issue_events_342071.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-02-12T10:45:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342071"
}
```



---

archive/issue_events_342072.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-02-12T10:45:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342072"
}
```



---

archive/issue_comments_375546.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI just realise that using #24710 was supposed to be not needed (it was closed as invalid).\n\nAnyway, a data point concerning timings, after installing meataxe:\n- With gcc\n\n  ```\n  sage: M = random_matrix(GF(9,'x'), 5000)\n  sage: type(M)\n  <type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\n  sage: N = random_matrix(GF(9,'x'), 5000)\n  sage: %timeit _=M-N\n  10 loops, best of 3: 20.5 ms per loop\n  sage: %timeit _=M*N\n  1 loop, best of 3: 46.5 s per loop\n  ```\n- With clang:\n\n  ```\n  sage: M = random_matrix(GF(9,'x'), 5000)\n  sage: type(M)\n  <type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\n  sage: N = random_matrix(GF(9,'x'), 5000)\n  sage: %timeit _=M-N\n  10 loops, best of 3: 20.5 ms per loop\n  sage: %timeit _=M*N\n  1 loop, best of 3: 53.2 s per loop\n  ```\n\nSince meataxe is heavily used in the computations that I *really* care about (group cohomology), I am not so happy about a slow-down of almost 15%. So, probably I won't use clang in my computations. Nonetheless, it is good for portability that clang can also be used on ubuntu.",
    "created_at": "2018-02-12T11:02:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375546",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:29" align="right">comment:29</div>

I just realise that using #24710 was supposed to be not needed (it was closed as invalid).

Anyway, a data point concerning timings, after installing meataxe:
- With gcc

  ```
  sage: M = random_matrix(GF(9,'x'), 5000)
  sage: type(M)
  <type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
  sage: N = random_matrix(GF(9,'x'), 5000)
  sage: %timeit _=M-N
  10 loops, best of 3: 20.5 ms per loop
  sage: %timeit _=M*N
  1 loop, best of 3: 46.5 s per loop
  ```
- With clang:

  ```
  sage: M = random_matrix(GF(9,'x'), 5000)
  sage: type(M)
  <type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
  sage: N = random_matrix(GF(9,'x'), 5000)
  sage: %timeit _=M-N
  10 loops, best of 3: 20.5 ms per loop
  sage: %timeit _=M*N
  1 loop, best of 3: 53.2 s per loop
  ```

Since meataxe is heavily used in the computations that I *really* care about (group cohomology), I am not so happy about a slow-down of almost 15%. So, probably I won't use clang in my computations. Nonetheless, it is good for portability that clang can also be used on ubuntu.



---

archive/issue_comments_375547.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI get several segfaults when testing sage.homology. Is that to be expected?",
    "created_at": "2018-02-12T11:38:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375547",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">comment:30</div>

I get several segfaults when testing sage.homology. Is that to be expected?



---

archive/issue_comments_375548.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nShould this ticket be closed?",
    "created_at": "2018-02-12T11:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375548",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Should this ticket be closed?



---

archive/issue_comments_375549.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@jdemeyer](#comment:31):\n> Should this ticket be closed?\n\nI think so. Certainly the test failure should be for a different ticket.",
    "created_at": "2018-02-12T12:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24705#issuecomment-375549",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@jdemeyer](#comment:31):
> Should this ticket be closed?

I think so. Certainly the test failure should be for a different ticket.



---

archive/issue_events_342073.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-12T13:17:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342073"
}
```



---

archive/issue_events_342074.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-12T13:17:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342074"
}
```



---

archive/issue_events_342075.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-12T13:17:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24705",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "a6a6a6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24705#event-342075"
}
```
