# Issue 24626: More substantial implementation of matrices over complex ball fields

archive/issues_024389.json:
```json
{
    "body": "\n\nCC:  @fredrik-johansson @videlec @cheuberg\n\nBranch/Commit: 13b8b8ff02008972051f057d76c599564ff9c62a\n\nReviewer: Vincent Delecroix\n\nAuthor: Marc Mezzarobba\n\nDependencies: #24742\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24626\n\n",
    "closed_at": "2018-05-09T09:49:42Z",
    "created_at": "2018-01-31T18:29:40Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "More substantial implementation of matrices over complex ball fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24626",
    "user": "https://github.com/mezzarobba"
}
```


CC:  @fredrik-johansson @videlec @cheuberg

Branch/Commit: 13b8b8ff02008972051f057d76c599564ff9c62a

Reviewer: Vincent Delecroix

Author: Marc Mezzarobba

Dependencies: #24742

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24626





---

archive/issue_comments_363750.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-31T18:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363750",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_363751.json:
```json
{
    "body": "<a id='comment:3'></a>Given that comparison of balls is modified in #24627 to use directly arb, I don't understand the following\n\n```\n+        if op == Py_EQ:\n+            return lt is rt or acb_mat_eq(lt.value, rt.value)\n```",
    "created_at": "2018-02-15T18:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363751",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>Given that comparison of balls is modified in #24627 to use directly arb, I don't understand the following

```
+        if op == Py_EQ:
+            return lt is rt or acb_mat_eq(lt.value, rt.value)
```



---

archive/issue_comments_363752.json:
```json
{
    "body": "<a id='comment:4'></a>What should be the output of the two things below?\n\n```\nsage: a = matrix(CBF, [1/3])\nsage: b = matrix(CBF, [1/3])\nsage: (a == a) == (a[0,0] == a[0,0])\nsage: (a == b) == (a[0,0] == b[0,0])\n```\n(such kind of tests would be good as doctests)",
    "created_at": "2018-02-15T18:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363752",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>What should be the output of the two things below?

```
sage: a = matrix(CBF, [1/3])
sage: b = matrix(CBF, [1/3])
sage: (a == a) == (a[0,0] == a[0,0])
sage: (a == b) == (a[0,0] == b[0,0])
```
(such kind of tests would be good as doctests)



---

archive/issue_comments_363753.json:
```json
{
    "body": "<a id='comment:5'></a>Instead of\n\n```\nelif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:\n```\nyou can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)",
    "created_at": "2018-02-15T18:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363753",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Instead of

```
elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
```
you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)



---

archive/issue_comments_363754.json:
```json
{
    "body": "<a id='comment:6'></a>You would better test `+`, `-`, ...rather than `_add_`, `_sub_`, ...",
    "created_at": "2018-02-15T18:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363754",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>You would better test `+`, `-`, ...rather than `_add_`, `_sub_`, ...



---

archive/issue_comments_363755.json:
```json
{
    "body": "<a id='comment:7'></a>(BTW, why `__invert__(self)` (two underscores, standard Python) and `_neg_(self)` (where does it come from!?))",
    "created_at": "2018-02-15T18:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363755",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>(BTW, why `__invert__(self)` (two underscores, standard Python) and `_neg_(self)` (where does it come from!?))



---

archive/issue_comments_363756.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks for you comments!\n\nReplying to [comment:3 vdelecroix]:\n> Given that comparison of balls is modified in #24627 to use directly arb, I don't understand the following\n> \n> ```\n> +        if op == Py_EQ:\n> +            return lt is rt or acb_mat_eq(lt.value, rt.value)\n> ```\n\n\nGood catch. The explanation is simply that this ticket is older than #24627.\n\nReplying to [comment:5 vdelecroix]:\n> Instead of\n> \n> ```\n> elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:\n> ```\n> you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)\n\n\nYes, but I prefer the current version. (Is there any guarantee that Python won't add more comparison operators, btw?)\n\nReplying to [comment:6 vdelecroix]:\n> You would better test `+`, `-`, ...rather than `_add_`, `_sub_`, ...\n\n\nWhy? What I want in this case in really to test the implementation for this specific parent, not the dispatch done by the coercion framework.\n\nReplying to [comment:7 vdelecroix]:\n> (BTW, why `__invert__(self)` (two underscores, standard Python) and `_neg_(self)` (where does it come from!?))\n\n\n`Element` implements `__neg__()` and not `__invert__()`, probably because abusing `__invert__()` to mean `1/x` like most Sage `Element`s do may not be such a good idea. But I don't think there is any reason to implement `_neg_()` rather than `__neg__()` in the present case, and the latter should be slightly faster.",
    "created_at": "2018-02-16T09:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363756",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:8'></a>Thanks for you comments!

Replying to [comment:3 vdelecroix]:
> Given that comparison of balls is modified in #24627 to use directly arb, I don't understand the following
> 
> ```
> +        if op == Py_EQ:
> +            return lt is rt or acb_mat_eq(lt.value, rt.value)
> ```


Good catch. The explanation is simply that this ticket is older than #24627.

Replying to [comment:5 vdelecroix]:
> Instead of
> 
> ```
> elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
> ```
> you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)


Yes, but I prefer the current version. (Is there any guarantee that Python won't add more comparison operators, btw?)

Replying to [comment:6 vdelecroix]:
> You would better test `+`, `-`, ...rather than `_add_`, `_sub_`, ...


Why? What I want in this case in really to test the implementation for this specific parent, not the dispatch done by the coercion framework.

Replying to [comment:7 vdelecroix]:
> (BTW, why `__invert__(self)` (two underscores, standard Python) and `_neg_(self)` (where does it come from!?))


`Element` implements `__neg__()` and not `__invert__()`, probably because abusing `__invert__()` to mean `1/x` like most Sage `Element`s do may not be such a good idea. But I don't think there is any reason to implement `_neg_()` rather than `__neg__()` in the present case, and the latter should be slightly faster.



---

archive/issue_comments_363757.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-18T20:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363757",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_363758.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-19T09:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363759.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-19T09:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363760.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-19T09:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363760",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_363761.json:
```json
{
    "body": "<a id='comment:13'></a>docstring in charpoly? The rest looks good.",
    "created_at": "2018-04-03T07:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363761",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>docstring in charpoly? The rest looks good.



---

archive/issue_comments_363762.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-03T11:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_363763.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:13 vdelecroix]:\n> docstring in charpoly?\n\n\nFixed, thanks!\n\nI also rebased the branch on top of fac3f5e (#24742) to avoid a merge conflict.",
    "created_at": "2018-04-03T11:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363763",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>Replying to [comment:13 vdelecroix]:
> docstring in charpoly?


Fixed, thanks!

I also rebased the branch on top of fac3f5e (#24742) to avoid a merge conflict.



---

archive/issue_comments_363764.json:
```json
{
    "body": "<a id='comment:17'></a>merge conflicts with #24742 that has changed from `fac3f5e` to `\u200bbf9cefd`. I did the rebase.\n\n---\nNew commits:",
    "created_at": "2018-04-07T09:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363764",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>merge conflicts with #24742 that has changed from `fac3f5e` to `​bf9cefd`. I did the rebase.

---
New commits:



---

archive/issue_comments_363765.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:8 mmezzarobba]:\n> Replying to [comment:3 vdelecroix]:\n> Replying to [comment:5 vdelecroix]:\n> > Instead of\n> > \n> > ```\n> > elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:\n> > ```\n> > you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)\n\n> \n> Yes, but I prefer the current version. (Is there any guarantee that Python won't add more comparison operators, btw?)\n\n\nI don't understand why you would prefer the current version. And if Python does add operators your version will return `None`. You only want to support `EQ` and `NE` here, don't you?",
    "created_at": "2018-04-07T09:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363765",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>Replying to [comment:8 mmezzarobba]:
> Replying to [comment:3 vdelecroix]:
> Replying to [comment:5 vdelecroix]:
> > Instead of
> > 
> > ```
> > elif op == Py_GT or op == Py_GE or op == Py_LT or op == Py_LE:
> > ```
> > you can use `else` (and not import `Py_GT`, `Py_GE`, `Py_LT`, `Py_LE`)

> 
> Yes, but I prefer the current version. (Is there any guarantee that Python won't add more comparison operators, btw?)


I don't understand why you would prefer the current version. And if Python does add operators your version will return `None`. You only want to support `EQ` and `NE` here, don't you?



---

archive/issue_comments_363766.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-07T10:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363767.json:
```json
{
    "body": "<a id='comment:20'></a>waiting for more info on [comment:18]. The rest is ok.",
    "created_at": "2018-04-07T10:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363767",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>waiting for more info on [comment:18]. The rest is ok.



---

archive/issue_comments_363768.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-04-07T10:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363768",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_363769.json:
```json
{
    "body": "<a id='comment:22'></a>Thanks for the rebase.\n\nReplying to [comment:18 vdelecroix]:\n> I don't understand why you would prefer the current version. And if Python does add operators your version will return `None`. You only want to support `EQ` and `NE` here, don't you?\n\n\nYes, probably. Go ahead and change it if you want--I find the version I wrote slightly clearer and I don't see the point of this discussion, but I don't really care.",
    "created_at": "2018-04-07T10:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363769",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:22'></a>Thanks for the rebase.

Replying to [comment:18 vdelecroix]:
> I don't understand why you would prefer the current version. And if Python does add operators your version will return `None`. You only want to support `EQ` and `NE` here, don't you?


Yes, probably. Go ahead and change it if you want--I find the version I wrote slightly clearer and I don't see the point of this discussion, but I don't really care.



---

archive/issue_comments_363770.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-07T10:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_363771.json:
```json
{
    "body": "<a id='comment:24'></a>if you are ok with the current state please set to positive review. I would like to move forward with #24927.",
    "created_at": "2018-04-07T10:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363771",
    "user": "https://github.com/videlec"
}
```

<a id='comment:24'></a>if you are ok with the current state please set to positive review. I would like to move forward with #24927.



---

archive/issue_comments_363772.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-04-07T12:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363772",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_363773.json:
```json
{
    "body": "<a id='comment:25'></a>The failure reported by the patchbot is genuine, but not due to this ticket.",
    "created_at": "2018-04-07T12:32:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363773",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:25'></a>The failure reported by the patchbot is genuine, but not due to this ticket.



---

archive/issue_events_062033.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-09T09:49:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24626#event-62033"
}
```



---

archive/issue_comments_363774.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-09T09:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24626",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24626#issuecomment-363774",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
