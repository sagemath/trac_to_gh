# Issue 24844: Some elliptic curve functions do not set a point's order

archive/issues_024607.json:
```json
{
    "body": "```\nsage: p=next_prime(1000000)\nsage: E=EllipticCurve(GF(p), 123, 456)\nsage: pts = E(0).division_points(3)\nsage: P=pts[1]; P\n(389063 : 124244 : 1)\nsage: \nsage: P._order\n...\nAttributeError: 'EllipticCurvePoint_finite_field' object has no attribute '_order'\nsage: P.order()\n3\nsage: P._order\n3\nsage: \n```\n\nHere one might expect the point P's _order attribute to be set to 3 on construction since this can be deduced from what is known.\n\nCC:  erkan.tairi@gmail.com\n\nKeywords: points order\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: John Cremona\n\nBranch: 5367558b6a6285a7e7f46780486447e9a2787505\n\nCommit: 5367558b6a6285a7e7f46780486447e9a2787505\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24844\n\n",
    "closed_at": "2018-03-06T23:23:50Z",
    "created_at": "2018-02-26T16:49:18Z",
    "labels": [
        "component: elliptic curves",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Some elliptic curve functions do not set a point's order",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24844",
    "user": "https://github.com/JohnCremona"
}
```
```
sage: p=next_prime(1000000)
sage: E=EllipticCurve(GF(p), 123, 456)
sage: pts = E(0).division_points(3)
sage: P=pts[1]; P
(389063 : 124244 : 1)
sage: 
sage: P._order
...
AttributeError: 'EllipticCurvePoint_finite_field' object has no attribute '_order'
sage: P.order()
3
sage: P._order
3
sage: 
```

Here one might expect the point P's _order attribute to be set to 3 on construction since this can be deduced from what is known.

CC:  erkan.tairi@gmail.com

Keywords: points order

Reviewer: Frédéric Chapoton

Author: John Cremona

Branch: 5367558b6a6285a7e7f46780486447e9a2787505

Commit: 5367558b6a6285a7e7f46780486447e9a2787505

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24844





---

archive/issue_comments_344816.json:
```json
{
    "body": "<a id='comment:1'></a>here is a naive tentative for a start, feel free to take over and enhance\n\n---\nNew commits:",
    "created_at": "2018-02-26T20:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344816",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>here is a naive tentative for a start, feel free to take over and enhance

---
New commits:



---

archive/issue_comments_344817.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-26T20:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344817",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344818.json:
```json
{
    "body": "<a id='comment:2'></a>There are more cases where the order can be deduced with no work.  At a minimum therefore I would do these:\n1. nothing if self's order not set;\n2. if self's order is infinity set order to infinity;\n3. if self's order=n and m=1 then set order=n (obvious special case).\nOtherwise the order is n*k where k divides m and all possibilities are possible. [Note that the first version in commit 3ebb1c is not quite correct since one of the returned points is 0.]  It would be possible to find the order k of n*Q for each returned point Q and set the order of Q to n*k, given that k is known to divide m.",
    "created_at": "2018-02-27T09:14:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344818",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>There are more cases where the order can be deduced with no work.  At a minimum therefore I would do these:
1. nothing if self's order not set;
2. if self's order is infinity set order to infinity;
3. if self's order=n and m=1 then set order=n (obvious special case).
Otherwise the order is n*k where k divides m and all possibilities are possible. [Note that the first version in commit 3ebb1c is not quite correct since one of the returned points is 0.]  It would be possible to find the order k of n*Q for each returned point Q and set the order of Q to n*k, given that k is known to divide m.



---

archive/issue_comments_344819.json:
```json
{
    "body": "<a id='comment:3'></a>More thoughts: we currently never set the order of a point computed via addition, subtraction or even negation.  The latter is uncontroversial!  The general case is probably too much since if you add two points of infinite order the result in principle could have any finite order, and even if the summands both have finite order then the sum could have any order dividing the lcm of those.\n\nHence I am now inclined to do less than was suggested in comment 2, but a little more than is in the first commit, namely if you divide E(0) by m then (since it safe to assume that m is easily factorisable when that succeeds) all points returned can have their actual order (dividing m) computed and set, using the generic order_from_multiple() function.",
    "created_at": "2018-02-27T12:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344819",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>More thoughts: we currently never set the order of a point computed via addition, subtraction or even negation.  The latter is uncontroversial!  The general case is probably too much since if you add two points of infinite order the result in principle could have any finite order, and even if the summands both have finite order then the sum could have any order dividing the lcm of those.

Hence I am now inclined to do less than was suggested in comment 2, but a little more than is in the first commit, namely if you divide E(0) by m then (since it safe to assume that m is easily factorisable when that succeeds) all points returned can have their actual order (dividing m) computed and set, using the generic order_from_multiple() function.



---

archive/issue_comments_344820.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-27T16:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344821.json:
```json
{
    "body": "<a id='comment:5'></a>Despite comment 3 I put in an implementation in all cases where the original point's order is already known (or if it 0 in which case we set its order to 1).  This is quite simple and cheap.  Note that m must be small or earlier steps in the division_points() function will already take too long so the additional step is negligible.\n\nI just thought of one more thing to add before setting to \"needs review\".",
    "created_at": "2018-02-27T16:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344821",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>Despite comment 3 I put in an implementation in all cases where the original point's order is already known (or if it 0 in which case we set its order to 1).  This is quite simple and cheap.  Note that m must be small or earlier steps in the division_points() function will already take too long so the additional step is negligible.

I just thought of one more thing to add before setting to "needs review".



---

archive/issue_comments_344822.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-27T16:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344823.json:
```json
{
    "body": "<a id='comment:8'></a>I think you should add a test for the infinite order case, please.",
    "created_at": "2018-02-28T10:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344823",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>I think you should add a test for the infinite order case, please.



---

archive/issue_comments_344824.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-28T10:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344824",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_344825.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 chapoton]:\n> I think you should add a test for the infinite order case, please.\n\nOK -- will do.   (I'll also add you as an author, sorry if I deleted you by mistake.)",
    "created_at": "2018-02-28T10:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344825",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:9'></a>Replying to [comment:8 chapoton]:
> I think you should add a test for the infinite order case, please.

OK -- will do.   (I'll also add you as an author, sorry if I deleted you by mistake.)



---

archive/issue_comments_344826.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-28T11:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344827.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-02T08:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344827",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_344828.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-02T09:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344828",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_344829.json:
```json
{
    "body": "<a id='comment:12'></a>ok, thanks. No need to list me as an author.",
    "created_at": "2018-03-02T09:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344829",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>ok, thanks. No need to list me as an author.



---

archive/issue_events_062437.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-06T23:23:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24844#event-62437"
}
```



---

archive/issue_comments_344830.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-06T23:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24844",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24844#issuecomment-344830",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
