# Issue 24281: Fix comparison of morphisms

archive/issues_024044.json:
```json
{
    "assignees": [],
    "body": "Often, the same morphism can be created as different Python classes. For example, these are two versions of the identity map on `QQ`:\n\n```\nsage: H = End(QQ)\nsage: f = H.identity()\nsage: g = H(1)\nsage: type(f)\n<type 'sage.categories.morphism.IdentityMorphism'>\nsage: type(g)\n<type 'sage.rings.morphism.RingHomomorphism_im_gens'>\n```\n\nThe problem is that these may not compare equal because most comparison functions for morphisms consider morphisms not equal if they have different types:\n\n```\nsage: g == f\nFalse\nsage: f == g\nTrue\n```\n\nThe solution is to implement a generic comparison function for morphisms. We do this by checking whether two maps have the same image on the generators and recursively on the base ring.\n\nCC:  @tscrim\n\nBranch/Commit: **[9be4ba9](https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24281_\n\n",
    "closed_at": "2017-12-13T17:37:55Z",
    "created_at": "2017-11-26T08:38:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix comparison of morphisms",
    "type": "issue",
    "updated_at": "2017-12-13T17:37:55Z",
    "url": "https://github.com/sagemath/sage/issues/24281",
    "user": "https://github.com/jdemeyer"
}
```
Often, the same morphism can be created as different Python classes. For example, these are two versions of the identity map on `QQ`:

```
sage: H = End(QQ)
sage: f = H.identity()
sage: g = H(1)
sage: type(f)
<type 'sage.categories.morphism.IdentityMorphism'>
sage: type(g)
<type 'sage.rings.morphism.RingHomomorphism_im_gens'>
```

The problem is that these may not compare equal because most comparison functions for morphisms consider morphisms not equal if they have different types:

```
sage: g == f
False
sage: f == g
True
```

The solution is to implement a generic comparison function for morphisms. We do this by checking whether two maps have the same image on the generators and recursively on the base ring.

CC:  @tscrim

Branch/Commit: **[9be4ba9](https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b)**

Reviewer: **Travis Scrimshaw**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/24281_





---

archive/issue_events_318801.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-26T08:38:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318801"
}
```



---

archive/issue_events_318802.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-26T08:38:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "component: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318802"
}
```



---

archive/issue_events_318803.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-26T08:38:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318803"
}
```



---

archive/issue_events_318804.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-26T08:38:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318804"
}
```



---

archive/issue_events_318805.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-26T08:44:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "title_is": "Fix comparison of morphisms",
    "title_was": "Fix comparison of RingHomomorphisms",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318805"
}
```



---

archive/issue_comments_370272.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,8 @@\n sage: type(g)\n <type 'sage.rings.morphism.RingHomomorphism_im_gens'>\n ```\n-The problem is that these may not compare equal:\n+\n+The problem is that these may not compare equal because most comparison functions for morphisms consider morphisms not equal if they have different types:\n \n ```\n sage: g == f\n@@ -17,3 +18,5 @@\n sage: f == g\n True\n ```\n+\n+The solution is to implement a generic comparison function for morphisms. We do this by checking whether two maps have the same image on the generators and recursively on the base ring.\n``````\n",
    "created_at": "2017-11-27T08:15:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370272",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,8 @@
 sage: type(g)
 <type 'sage.rings.morphism.RingHomomorphism_im_gens'>
 ```
-The problem is that these may not compare equal:
+
+The problem is that these may not compare equal because most comparison functions for morphisms consider morphisms not equal if they have different types:
 
 ```
 sage: g == f
@@ -17,3 +18,5 @@
 sage: f == g
 True
 ```
+
+The solution is to implement a generic comparison function for morphisms. We do this by checking whether two maps have the same image on the generators and recursively on the base ring.
``````




---

archive/issue_comments_370273.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/24281](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24281)**",
    "created_at": "2017-11-27T11:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370273",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/24281](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24281)**



---

archive/issue_events_318806.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-27T14:52:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318806"
}
```



---

archive/issue_comments_370274.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a34ba807be9c190f987e03d888e64f0064e869ff\">a34ba80</a></td><td><code>Fix comparison of morphisms</code></td></tr></table>\n",
    "created_at": "2017-11-27T14:52:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370274",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a34ba807be9c190f987e03d888e64f0064e869ff">a34ba80</a></td><td><code>Fix comparison of morphisms</code></td></tr></table>




---

archive/issue_comments_370275.json:
```json
{
    "body": "Commit: **[a34ba80](https://github.com/sagemath/sagetrac-mirror/commit/a34ba807be9c190f987e03d888e64f0064e869ff)**",
    "created_at": "2017-11-27T14:52:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370275",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[a34ba80](https://github.com/sagemath/sagetrac-mirror/commit/a34ba807be9c190f987e03d888e64f0064e869ff)**



---

archive/issue_comments_370276.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05cefc179d0cce8083d254ff1f46ca505a497221\">05cefc1</a></td><td><code>Remove `_richcmp_` for MatrixMorphism</code></td></tr></table>\n",
    "created_at": "2017-11-27T15:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370276",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05cefc179d0cce8083d254ff1f46ca505a497221">05cefc1</a></td><td><code>Remove `_richcmp_` for MatrixMorphism</code></td></tr></table>




---

archive/issue_comments_370277.json:
```json
{
    "body": "Changed commit from **[a34ba80](https://github.com/sagemath/sagetrac-mirror/commit/a34ba807be9c190f987e03d888e64f0064e869ff)** to **[05cefc1](https://github.com/sagemath/sagetrac-mirror/commit/05cefc179d0cce8083d254ff1f46ca505a497221)**",
    "created_at": "2017-11-27T15:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370277",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a34ba80](https://github.com/sagemath/sagetrac-mirror/commit/a34ba807be9c190f987e03d888e64f0064e869ff)** to **[05cefc1](https://github.com/sagemath/sagetrac-mirror/commit/05cefc179d0cce8083d254ff1f46ca505a497221)**



---

archive/issue_events_318807.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-27T16:09:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318807"
}
```



---

archive/issue_events_318808.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-27T16:09:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318808"
}
```



---

archive/issue_comments_370278.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI think having the checks that the (co)domains matched was a good first check because that should be very quick (generally, a comparison of `id`s). Moreover, with your code, you can get equality of morphisms when there is a coercion from one codomain into the other that results in equal elements.\n\n```\nsage: D = ZZ['x']\nsage: C1 = ZZ['x']\nsage: C2 = QQ['x']\nsage: phi = D.morphism(C1.gens())\nsage: psi = D.morphism(C2.gens())\nsage: Morphism._richcmp_(psi, phi, 2)  # 2 == Py_EQ\nTrue\n```\nHowever, we do not want these to be equal as we then have an isomorphism equal to a non-surjective map. A more minimal example that directly uses the `Morphism._richcmp_`:\n\n```\nsage: IZZ = Hom(ZZ,ZZ).natural_map()\nsage: IQQ = Hom(QQ,QQ).natural_map()\nsage: IZZ._richcmp_(IQQ, 2)\nTrue\n```\n(Although I do not understand why `==` is returning `False` in both of these cases.)\n\nAlso, why did you remove the `_richcmp_` for `MatrixMorphism`? I know that might generally involve more comparisons, but it still should require less CPU cycles because you do not have to apply the morphisms. Although the same comment about equal (co)domains definitely still applies (and is a current bug).",
    "created_at": "2017-11-28T00:04:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370278",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>Comment 7:</a>
I think having the checks that the (co)domains matched was a good first check because that should be very quick (generally, a comparison of `id`s). Moreover, with your code, you can get equality of morphisms when there is a coercion from one codomain into the other that results in equal elements.

```
sage: D = ZZ['x']
sage: C1 = ZZ['x']
sage: C2 = QQ['x']
sage: phi = D.morphism(C1.gens())
sage: psi = D.morphism(C2.gens())
sage: Morphism._richcmp_(psi, phi, 2)  # 2 == Py_EQ
True
```
However, we do not want these to be equal as we then have an isomorphism equal to a non-surjective map. A more minimal example that directly uses the `Morphism._richcmp_`:

```
sage: IZZ = Hom(ZZ,ZZ).natural_map()
sage: IQQ = Hom(QQ,QQ).natural_map()
sage: IZZ._richcmp_(IQQ, 2)
True
```
(Although I do not understand why `==` is returning `False` in both of these cases.)

Also, why did you remove the `_richcmp_` for `MatrixMorphism`? I know that might generally involve more comparisons, but it still should require less CPU cycles because you do not have to apply the morphisms. Although the same comment about equal (co)domains definitely still applies (and is a current bug).



---

archive/issue_comments_370279.json:
```json
{
    "body": "Changed commit from **[05cefc1](https://github.com/sagemath/sagetrac-mirror/commit/05cefc179d0cce8083d254ff1f46ca505a497221)** to **[25dc2fd](https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1)**",
    "created_at": "2017-11-28T08:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370279",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[05cefc1](https://github.com/sagemath/sagetrac-mirror/commit/05cefc179d0cce8083d254ff1f46ca505a497221)** to **[25dc2fd](https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1)**



---

archive/issue_comments_370280.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1\">25dc2fd</a></td><td><code>Fix comparison of morphisms</code></td></tr></table>\n",
    "created_at": "2017-11-28T08:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370280",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1">25dc2fd</a></td><td><code>Fix comparison of morphisms</code></td></tr></table>




---

archive/issue_events_318809.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T08:45:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318809"
}
```



---

archive/issue_events_318810.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-28T08:45:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318810"
}
```



---

archive/issue_comments_370281.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nOh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.",
    "created_at": "2017-11-28T08:47:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370281",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'>Comment 10:</a>
Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.



---

archive/issue_comments_370282.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nReplying to [@tscrim](#comment%3A10):\n> Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.\n\nExactly. I was going to write you a longer reply, but you figured it out :-)",
    "created_at": "2017-11-28T08:49:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370282",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'>Comment 11:</a>
Replying to [@tscrim](#comment%3A10):
> Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.

Exactly. I was going to write you a longer reply, but you figured it out :-)



---

archive/issue_comments_370283.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@tscrim](#comment%3A7):\n> \n> ```\n> sage: D = ZZ['x']\n> sage: C1 = ZZ['x']\n> sage: C2 = QQ['x']\n> sage: phi = D.morphism(C1.gens())\n> sage: psi = D.morphism(C2.gens())\n> sage: Morphism._richcmp_(psi, phi, 2)  # 2 == Py_EQ\n> True\n> ```\n\nWhat is `D.morphism()` by the way? I get `AttributeError: 'PolynomialRing_integral_domain_with_category' object has no attribute 'morphism'`",
    "created_at": "2017-11-28T08:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370283",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@tscrim](#comment%3A7):
> 
> ```
> sage: D = ZZ['x']
> sage: C1 = ZZ['x']
> sage: C2 = QQ['x']
> sage: phi = D.morphism(C1.gens())
> sage: psi = D.morphism(C2.gens())
> sage: Morphism._richcmp_(psi, phi, 2)  # 2 == Py_EQ
> True
> ```

What is `D.morphism()` by the way? I get `AttributeError: 'PolynomialRing_integral_domain_with_category' object has no attribute 'morphism'`



---

archive/issue_comments_370284.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@tscrim](#comment%3A7):\n> Also, why did you remove the `_richcmp_` for `MatrixMorphism`?\n\nMy initial thought was that for directional comparisons (`<`, `<=`, `>`, `>=`), the code would give a different result from `Morphism._richcmp_`. So I restored the original code but only for `==` and `!=`.",
    "created_at": "2017-11-28T08:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370284",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@tscrim](#comment%3A7):
> Also, why did you remove the `_richcmp_` for `MatrixMorphism`?

My initial thought was that for directional comparisons (`<`, `<=`, `>`, `>=`), the code would give a different result from `Morphism._richcmp_`. So I restored the original code but only for `==` and `!=`.



---

archive/issue_comments_370285.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@tscrim](#comment%3A10):\n> Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.\n\nInterestingly, morphisms are a good example in Sage of `Element` classes where one `Parent` allows many different `Element` classes. And we clearly didn't deal properly with that.",
    "created_at": "2017-11-28T08:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370285",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@tscrim](#comment%3A10):
> Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.

Interestingly, morphisms are a good example in Sage of `Element` classes where one `Parent` allows many different `Element` classes. And we clearly didn't deal properly with that.



---

archive/issue_comments_370286.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@jdemeyer](#comment%3A12):\n> Replying to [@tscrim](#comment%3A7):\n> > \n> > ```\n> > sage: D = ZZ['x']\n> > sage: C1 = ZZ['x']\n> > sage: C2 = QQ['x']\n> > sage: phi = D.morphism(C1.gens())\n> > sage: psi = D.morphism(C2.gens())\n> > sage: Morphism._richcmp_(psi, phi, 2)  # 2 == Py_EQ\n> > True\n> > ```\n\n> \n> What is `D.morphism()` by the way? I get `AttributeError: 'PolynomialRing_integral_domain_with_category' object has no attribute 'morphism'`\n\nSorry, I thought I had copied the code I actually used there. That was pseudocode I wrote while waiting for Sage to recompile. It was suppose to be `phi = Hom(D,C1)(C1.gens())`.",
    "created_at": "2017-11-28T08:54:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370286",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@jdemeyer](#comment%3A12):
> Replying to [@tscrim](#comment%3A7):
> > 
> > ```
> > sage: D = ZZ['x']
> > sage: C1 = ZZ['x']
> > sage: C2 = QQ['x']
> > sage: phi = D.morphism(C1.gens())
> > sage: psi = D.morphism(C2.gens())
> > sage: Morphism._richcmp_(psi, phi, 2)  # 2 == Py_EQ
> > True
> > ```

> 
> What is `D.morphism()` by the way? I get `AttributeError: 'PolynomialRing_integral_domain_with_category' object has no attribute 'morphism'`

Sorry, I thought I had copied the code I actually used there. That was pseudocode I wrote while waiting for Sage to recompile. It was suppose to be `phi = Hom(D,C1)(C1.gens())`.



---

archive/issue_comments_370287.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@jdemeyer](#comment%3A14):\n> Replying to [@tscrim](#comment%3A10):\n> > Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.\n\n> \n> Interestingly, morphisms are a good example in Sage of `Element` classes where one `Parent` allows many different `Element` classes. And we clearly didn't deal properly with that.\n\nThis is currently the biggest example of that general shortcoming and should be addressed at some point. Although I guess in some ways with how we do things with extension classes, it works, but I am fairly certain we loose stuff from the categories when using Python classes.",
    "created_at": "2017-11-28T09:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370287",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@jdemeyer](#comment%3A14):
> Replying to [@tscrim](#comment%3A10):
> > Oh, wait, the reason why we do not need to check the (co)domains match is because by the time we get to `_richcmp_`, we had to have coerced into the same parent. So the (co)domains must match at that point.

> 
> Interestingly, morphisms are a good example in Sage of `Element` classes where one `Parent` allows many different `Element` classes. And we clearly didn't deal properly with that.

This is currently the biggest example of that general shortcoming and should be addressed at some point. Although I guess in some ways with how we do things with extension classes, it works, but I am fairly certain we loose stuff from the categories when using Python classes.



---

archive/issue_comments_370288.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@jdemeyer](#comment%3A13):\n> Replying to [@tscrim](#comment%3A7):\n> > Also, why did you remove the `_richcmp_` for `MatrixMorphism`?\n\n> \n> My initial thought was that for directional comparisons (`<`, `<=`, `>`, `>=`), the code would give a different result from `Morphism._richcmp_`. So I restored the original code but only for `==` and `!=`.\n\nI see.\n\nThe earlier error is making me think a bit more about using `gens` in the general morphism code. I don't think this suffers from the same problem as #15381. Yet, we probably want to return a `NotImplemented` when `gens` is not defined (maybe also catching if it raises some [reasonable] error?).",
    "created_at": "2017-11-28T09:09:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370288",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@jdemeyer](#comment%3A13):
> Replying to [@tscrim](#comment%3A7):
> > Also, why did you remove the `_richcmp_` for `MatrixMorphism`?

> 
> My initial thought was that for directional comparisons (`<`, `<=`, `>`, `>=`), the code would give a different result from `Morphism._richcmp_`. So I restored the original code but only for `==` and `!=`.

I see.

The earlier error is making me think a bit more about using `gens` in the general morphism code. I don't think this suffers from the same problem as #15381. Yet, we probably want to return a `NotImplemented` when `gens` is not defined (maybe also catching if it raises some [reasonable] error?).



---

archive/issue_comments_370289.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@tscrim](#comment%3A17):\n> The earlier error is making me think a bit more about using `gens` in the general morphism code. I don't think this suffers from the same problem as #15381.\n\nI think it does in the sense that I did not fix #15381 or #17768.\n\n> Yet, we probably want to return a `NotImplemented` when `gens` is not defined\n\nNot sure about that. I like explicit errors, such as an `AttributeError` when there is no `gens()`.",
    "created_at": "2017-11-28T09:19:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370289",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@tscrim](#comment%3A17):
> The earlier error is making me think a bit more about using `gens` in the general morphism code. I don't think this suffers from the same problem as #15381.

I think it does in the sense that I did not fix #15381 or #17768.

> Yet, we probably want to return a `NotImplemented` when `gens` is not defined

Not sure about that. I like explicit errors, such as an `AttributeError` when there is no `gens()`.



---

archive/issue_comments_370290.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@jdemeyer](#comment%3A18):\n> Replying to [@tscrim](#comment%3A17):\n> > The earlier error is making me think a bit more about using `gens` in the general morphism code. I don't think this suffers from the same problem as #15381.\n\n> \n> I think it does in the sense that I did not fix #15381 or #17768.\n\nSince it makes the problem no worse than before, we can just let it be.\n\n> > Yet, we probably want to return a `NotImplemented` when `gens` is not defined\n\n> \n> Not sure about that. I like explicit errors, such as an `AttributeError` when there is no `gens()`.\n\nI guess we have a little more freedom with raising errors than `__contains__` (which should never raise an error). However, because of the type of error and how generic this code it suppose to be, I feel such an error strongly suggests that parent classes should implement `gens` in contrast to `*_generators` and having the appropriate category redirect from `gens` or perhaps where it is not a natural construct (say a combinatorial set). I guess since this is post-coercion, having it raise an error is saying something about the implementation of either the underlying object or their morphisms and you don't have any more fragile code by comparing a `X - > Y` and `X' -> Y` morphism, where `X` and `X'` might be in completely different categories. So I guess it is okay.\n\nThe only other thing I would like is a doctest for `_richcmp_`, preferably one that was incorrect before and now succeeds and the `QQ` vs `ZZ` example with something like\n\n```\nWhile this compares by generators (which can use coercion), the coercion model\nis first invoked to guarantee that domains must match in order to have the\nsame parent for the morphisms::\n\n    sage: phi = Hom(ZZ,ZZ).natural_map()\n    sage: psi = Hom(QQ,QQ).natural_map(\n    sage: Morphism._richcmp_(phi, psi, 2)\n    True\n    sage: phi == psi\n    False\n```",
    "created_at": "2017-11-28T12:33:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370290",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@jdemeyer](#comment%3A18):
> Replying to [@tscrim](#comment%3A17):
> > The earlier error is making me think a bit more about using `gens` in the general morphism code. I don't think this suffers from the same problem as #15381.

> 
> I think it does in the sense that I did not fix #15381 or #17768.

Since it makes the problem no worse than before, we can just let it be.

> > Yet, we probably want to return a `NotImplemented` when `gens` is not defined

> 
> Not sure about that. I like explicit errors, such as an `AttributeError` when there is no `gens()`.

I guess we have a little more freedom with raising errors than `__contains__` (which should never raise an error). However, because of the type of error and how generic this code it suppose to be, I feel such an error strongly suggests that parent classes should implement `gens` in contrast to `*_generators` and having the appropriate category redirect from `gens` or perhaps where it is not a natural construct (say a combinatorial set). I guess since this is post-coercion, having it raise an error is saying something about the implementation of either the underlying object or their morphisms and you don't have any more fragile code by comparing a `X - > Y` and `X' -> Y` morphism, where `X` and `X'` might be in completely different categories. So I guess it is okay.

The only other thing I would like is a doctest for `_richcmp_`, preferably one that was incorrect before and now succeeds and the `QQ` vs `ZZ` example with something like

```
While this compares by generators (which can use coercion), the coercion model
is first invoked to guarantee that domains must match in order to have the
same parent for the morphisms::

    sage: phi = Hom(ZZ,ZZ).natural_map()
    sage: psi = Hom(QQ,QQ).natural_map(
    sage: Morphism._richcmp_(phi, psi, 2)
    True
    sage: phi == psi
    False
```



---

archive/issue_comments_370291.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@tscrim](#comment%3A19):\n> \n> ```\n> While this compares by generators (which can use coercion), the coercion model\n> is first invoked to guarantee that domains must match in order to have the\n> same parent for the morphisms::\n> \n>     sage: phi = Hom(ZZ,ZZ).natural_map()\n>     sage: psi = Hom(QQ,QQ).natural_map()\n>     sage: Morphism._richcmp_(phi, psi, 2)\n>     True\n> ```\n\nThat is a horrible test because you should really *never* do that (`_richcmp_` with different parents). Why should I add it?",
    "created_at": "2017-11-28T12:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370291",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@tscrim](#comment%3A19):
> 
> ```
> While this compares by generators (which can use coercion), the coercion model
> is first invoked to guarantee that domains must match in order to have the
> same parent for the morphisms::
> 
>     sage: phi = Hom(ZZ,ZZ).natural_map()
>     sage: psi = Hom(QQ,QQ).natural_map()
>     sage: Morphism._richcmp_(phi, psi, 2)
>     True
> ```

That is a horrible test because you should really *never* do that (`_richcmp_` with different parents). Why should I add it?



---

archive/issue_comments_370292.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@jdemeyer](#comment%3A20):\n> Replying to [@tscrim](#comment%3A19):\n> > \n> > ```\n> > While this compares by generators (which can use coercion), the coercion model\n> > is first invoked to guarantee that domains must match in order to have the\n> > same parent for the morphisms::\n> > \n> >     sage: phi = Hom(ZZ,ZZ).natural_map()\n> >     sage: psi = Hom(QQ,QQ).natural_map()\n> >     sage: Morphism._richcmp_(phi, psi, 2)\n> >     True\n> > ```\n\n> \n> That is a horrible test because you should really *never* do that (`_richcmp_` with different parents). Why should I add it?\n\nYea, right, duh. However, we should document it somewhere that we are (strongly) assuming that the parents, and hence the (co)domains are the same because of the coercion involved.",
    "created_at": "2017-11-28T12:46:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370292",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@jdemeyer](#comment%3A20):
> Replying to [@tscrim](#comment%3A19):
> > 
> > ```
> > While this compares by generators (which can use coercion), the coercion model
> > is first invoked to guarantee that domains must match in order to have the
> > same parent for the morphisms::
> > 
> >     sage: phi = Hom(ZZ,ZZ).natural_map()
> >     sage: psi = Hom(QQ,QQ).natural_map()
> >     sage: Morphism._richcmp_(phi, psi, 2)
> >     True
> > ```

> 
> That is a horrible test because you should really *never* do that (`_richcmp_` with different parents). Why should I add it?

Yea, right, duh. However, we should document it somewhere that we are (strongly) assuming that the parents, and hence the (co)domains are the same because of the coercion involved.



---

archive/issue_comments_370293.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@tscrim](#comment%3A19):\n> However, because of the type of error and how generic this code it suppose to be, I feel such an error strongly suggests that parent classes should implement `gens` in contrast to `*_generators` and having the appropriate category redirect from `gens` or perhaps where it is not a natural construct (say a combinatorial set). I guess since this is post-coercion, having it raise an error is saying something about the implementation of either the underlying object or their morphisms and you don't have any more fragile code by comparing a `X - > Y` and `X' -> Y` morphism, where `X` and `X'` might be in completely different categories. So I guess it is okay.\n\nI don't quite understand what you are trying to say here...\n\nI agree that `gens()` might not be ideal, but that is really an issue for #15381.",
    "created_at": "2017-11-28T15:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370293",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@tscrim](#comment%3A19):
> However, because of the type of error and how generic this code it suppose to be, I feel such an error strongly suggests that parent classes should implement `gens` in contrast to `*_generators` and having the appropriate category redirect from `gens` or perhaps where it is not a natural construct (say a combinatorial set). I guess since this is post-coercion, having it raise an error is saying something about the implementation of either the underlying object or their morphisms and you don't have any more fragile code by comparing a `X - > Y` and `X' -> Y` morphism, where `X` and `X'` might be in completely different categories. So I guess it is okay.

I don't quite understand what you are trying to say here...

I agree that `gens()` might not be ideal, but that is really an issue for #15381.



---

archive/issue_comments_370294.json:
```json
{
    "body": "Changed commit from **[25dc2fd](https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1)** to **[9ef7c4d](https://github.com/sagemath/sagetrac-mirror/commit/9ef7c4dc5e163dbadcbdf9a967f5ba62b5dcc08d)**",
    "created_at": "2017-11-28T15:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370294",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[25dc2fd](https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1)** to **[9ef7c4d](https://github.com/sagemath/sagetrac-mirror/commit/9ef7c4dc5e163dbadcbdf9a967f5ba62b5dcc08d)**



---

archive/issue_comments_370295.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ef7c4dc5e163dbadcbdf9a967f5ba62b5dcc08d\">9ef7c4d</a></td><td><code>Add comment</code></td></tr></table>\n",
    "created_at": "2017-11-28T15:59:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370295",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ef7c4dc5e163dbadcbdf9a967f5ba62b5dcc08d">9ef7c4d</a></td><td><code>Add comment</code></td></tr></table>




---

archive/issue_comments_370296.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ead8a200d1f16b2764b9cd920b202e28be7907f\">8ead8a2</a></td><td><code>Remove redundant methods from RingMap</code></td></tr></table>\n",
    "created_at": "2017-11-28T16:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370296",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>Comment 24:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ead8a200d1f16b2764b9cd920b202e28be7907f">8ead8a2</a></td><td><code>Remove redundant methods from RingMap</code></td></tr></table>




---

archive/issue_comments_370297.json:
```json
{
    "body": "Changed commit from **[9ef7c4d](https://github.com/sagemath/sagetrac-mirror/commit/9ef7c4dc5e163dbadcbdf9a967f5ba62b5dcc08d)** to **[8ead8a2](https://github.com/sagemath/sagetrac-mirror/commit/8ead8a200d1f16b2764b9cd920b202e28be7907f)**",
    "created_at": "2017-11-28T16:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370297",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9ef7c4d](https://github.com/sagemath/sagetrac-mirror/commit/9ef7c4dc5e163dbadcbdf9a967f5ba62b5dcc08d)** to **[8ead8a2](https://github.com/sagemath/sagetrac-mirror/commit/8ead8a200d1f16b2764b9cd920b202e28be7907f)**



---

archive/issue_comments_370298.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cef616470ac8d51a472b64ec744b083d6d38aaf2\">cef6164</a></td><td><code>Remove redundant methods from RingMap</code></td></tr></table>\n",
    "created_at": "2017-11-28T16:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370298",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>Comment 25:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cef616470ac8d51a472b64ec744b083d6d38aaf2">cef6164</a></td><td><code>Remove redundant methods from RingMap</code></td></tr></table>




---

archive/issue_comments_370299.json:
```json
{
    "body": "Changed commit from **[8ead8a2](https://github.com/sagemath/sagetrac-mirror/commit/8ead8a200d1f16b2764b9cd920b202e28be7907f)** to **[cef6164](https://github.com/sagemath/sagetrac-mirror/commit/cef616470ac8d51a472b64ec744b083d6d38aaf2)**",
    "created_at": "2017-11-28T16:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370299",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8ead8a2](https://github.com/sagemath/sagetrac-mirror/commit/8ead8a200d1f16b2764b9cd920b202e28be7907f)** to **[cef6164](https://github.com/sagemath/sagetrac-mirror/commit/cef616470ac8d51a472b64ec744b083d6d38aaf2)**



---

archive/issue_comments_370300.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@jdemeyer](#comment%3A22):\n> Replying to [@tscrim](#comment%3A19):\n> > However, because of the type of error and how generic this code it suppose to be, I feel such an error strongly suggests that parent classes should implement `gens` in contrast to `*_generators` and having the appropriate category redirect from `gens` or perhaps where it is not a natural construct (say a combinatorial set). I guess since this is post-coercion, having it raise an error is saying something about the implementation of either the underlying object or their morphisms and you don't have any more fragile code by comparing a `X - > Y` and `X' -> Y` morphism, where `X` and `X'` might be in completely different categories. So I guess it is okay.\n\n> \n> I don't quite understand what you are trying to say here...\n\nYea, that was perhaps a bit too short and poorly written. There are two things:\n\n1. A category that does not have a natural notation of `gens` such as `EnumeratedSets()`. Then morphisms in that category should override the `_richcmp_` because more information is necessary (it would normally have to provide it anyways).\n\n   The problem I have with having it raise an `AttributeError` on `gens` is that it suggests that the user should implement a `gens` rather than give an (overriding) implementation of `_richcmp_`. So I feel that it sends the wrong message in these cases.\n\n   Also, mostly just to note, this will be a behavior change that might result in code breaking in the wild.\n\n2. Suppose you have `f: X -> Y` and `g: X' -> Y`, where the category of `X` is, e.g., `Algebras(ZZ)` and `X'` is `Modules(ZZ)` with `X'` being `X` under the forgetful functor. However, because this would happen post-coercion (assuming smart enough homsets and coercion code), the object `X` should become `X'` and so `gens` would be the basis rather than the algebra generators.\n\n   Although I do not think our coercion and functor code is smart enough to handle this sort of situation right now anyways. The thought I had is that it really used the algebra generators of `X` to do the comparison, which may result in wrong answers because `g` is not an algebra morphism but matches on the algebra generators.\n\nDoes that clarify things?\n\n> I agree that `gens()` might not be ideal, but that is really an issue for #15381.\n\nI'm not completely sure that #15381 is relevant for not using `gens`, but your changes are no worse than before too. So this is not a blocker for a positive review.",
    "created_at": "2017-11-29T08:07:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370300",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@jdemeyer](#comment%3A22):
> Replying to [@tscrim](#comment%3A19):
> > However, because of the type of error and how generic this code it suppose to be, I feel such an error strongly suggests that parent classes should implement `gens` in contrast to `*_generators` and having the appropriate category redirect from `gens` or perhaps where it is not a natural construct (say a combinatorial set). I guess since this is post-coercion, having it raise an error is saying something about the implementation of either the underlying object or their morphisms and you don't have any more fragile code by comparing a `X - > Y` and `X' -> Y` morphism, where `X` and `X'` might be in completely different categories. So I guess it is okay.

> 
> I don't quite understand what you are trying to say here...

Yea, that was perhaps a bit too short and poorly written. There are two things:

1. A category that does not have a natural notation of `gens` such as `EnumeratedSets()`. Then morphisms in that category should override the `_richcmp_` because more information is necessary (it would normally have to provide it anyways).

   The problem I have with having it raise an `AttributeError` on `gens` is that it suggests that the user should implement a `gens` rather than give an (overriding) implementation of `_richcmp_`. So I feel that it sends the wrong message in these cases.

   Also, mostly just to note, this will be a behavior change that might result in code breaking in the wild.

2. Suppose you have `f: X -> Y` and `g: X' -> Y`, where the category of `X` is, e.g., `Algebras(ZZ)` and `X'` is `Modules(ZZ)` with `X'` being `X` under the forgetful functor. However, because this would happen post-coercion (assuming smart enough homsets and coercion code), the object `X` should become `X'` and so `gens` would be the basis rather than the algebra generators.

   Although I do not think our coercion and functor code is smart enough to handle this sort of situation right now anyways. The thought I had is that it really used the algebra generators of `X` to do the comparison, which may result in wrong answers because `g` is not an algebra morphism but matches on the algebra generators.

Does that clarify things?

> I agree that `gens()` might not be ideal, but that is really an issue for #15381.

I'm not completely sure that #15381 is relevant for not using `gens`, but your changes are no worse than before too. So this is not a blocker for a positive review.



---

archive/issue_comments_370301.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI feel that we should just remove the init test for `RingMap`. I think it was just there to give 100% doctest coverage, and it is not a useful test.",
    "created_at": "2017-11-29T08:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370301",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'>Comment 27:</a>
I feel that we should just remove the init test for `RingMap`. I think it was just there to give 100% doctest coverage, and it is not a useful test.



---

archive/issue_comments_370302.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nReplying to [@tscrim](#comment%3A26):\n>   Also, mostly just to note, this will be a behavior change that might result in code breaking in the wild.\n\nFixing bugs changes behaviour...",
    "created_at": "2017-11-29T08:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370302",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>Comment 28:</a>
Replying to [@tscrim](#comment%3A26):
>   Also, mostly just to note, this will be a behavior change that might result in code breaking in the wild.

Fixing bugs changes behaviour...



---

archive/issue_comments_370303.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@jdemeyer](#comment%3A28):\n> Replying to [@tscrim](#comment%3A26):\n> >   Also, mostly just to note, this will be a behavior change that might result in code breaking in the wild.\n\n> \n> Fixing bugs changes behaviour...\n\nI do not consider this to be a bug. Yet, I don't think it is a spacebar-esqe in the sense there might be someone who is relying on this behavior in a non-horrifying way. However, raising an error in this case will not be a blocker from me either.",
    "created_at": "2017-11-29T08:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370303",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@jdemeyer](#comment%3A28):
> Replying to [@tscrim](#comment%3A26):
> >   Also, mostly just to note, this will be a behavior change that might result in code breaking in the wild.

> 
> Fixing bugs changes behaviour...

I do not consider this to be a bug. Yet, I don't think it is a spacebar-esqe in the sense there might be someone who is relying on this behavior in a non-horrifying way. However, raising an error in this case will not be a blocker from me either.



---

archive/issue_comments_370304.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nReplying to [@tscrim](#comment%3A26):\n> The problem I have with having it raise an `AttributeError` on `gens` is that it suggests that the user should implement a `gens` rather than give an (overriding) implementation of `_richcmp_`. So I feel that it sends the wrong message in these cases.\n\nOK, I changed this to raise `NotImplementedError`. Returning `NotImplemented` seems inappropriate here because the `_richcmp_` method does understand what is asked and it knows that it cannot compute the result.\n\n> 2. Suppose you have `f: X -> Y` and `g: X' -> Y`, where the category of `X` is, e.g., `Algebras(ZZ)` and `X'` is `Modules(ZZ)` with `X'` being `X` under the forgetful functor. However, because this would happen post-coercion (assuming smart enough homsets and coercion code), the object `X` should become `X'` and so `gens` would be the basis rather than the algebra generators.\n\nIt shouldn't be a problem if there are *more* gens. Comparing algebra morphisms using the module generators is safe (but possibly inefficient).",
    "created_at": "2017-11-29T14:09:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370304",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>Comment 30:</a>
Replying to [@tscrim](#comment%3A26):
> The problem I have with having it raise an `AttributeError` on `gens` is that it suggests that the user should implement a `gens` rather than give an (overriding) implementation of `_richcmp_`. So I feel that it sends the wrong message in these cases.

OK, I changed this to raise `NotImplementedError`. Returning `NotImplemented` seems inappropriate here because the `_richcmp_` method does understand what is asked and it knows that it cannot compute the result.

> 2. Suppose you have `f: X -> Y` and `g: X' -> Y`, where the category of `X` is, e.g., `Algebras(ZZ)` and `X'` is `Modules(ZZ)` with `X'` being `X` under the forgetful functor. However, because this would happen post-coercion (assuming smart enough homsets and coercion code), the object `X` should become `X'` and so `gens` would be the basis rather than the algebra generators.

It shouldn't be a problem if there are *more* gens. Comparing algebra morphisms using the module generators is safe (but possibly inefficient).



---

archive/issue_comments_370305.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@tscrim](#comment%3A27):\n> I feel that we should just remove the init test for `RingMap`. I think it was just there to give 100% doctest coverage, and it is not a useful test.\n\nI added a test of the `parent()`. That makes the example do at least something non-trivial.",
    "created_at": "2017-11-29T14:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370305",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@tscrim](#comment%3A27):
> I feel that we should just remove the init test for `RingMap`. I think it was just there to give 100% doctest coverage, and it is not a useful test.

I added a test of the `parent()`. That makes the example do at least something non-trivial.



---

archive/issue_comments_370306.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b\">9be4ba9</a></td><td><code>Further fixes to comparisons of morphisms</code></td></tr></table>\n",
    "created_at": "2017-11-29T14:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370306",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b">9be4ba9</a></td><td><code>Further fixes to comparisons of morphisms</code></td></tr></table>




---

archive/issue_comments_370307.json:
```json
{
    "body": "Changed commit from **[cef6164](https://github.com/sagemath/sagetrac-mirror/commit/cef616470ac8d51a472b64ec744b083d6d38aaf2)** to **[9be4ba9](https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b)**",
    "created_at": "2017-11-29T14:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370307",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cef6164](https://github.com/sagemath/sagetrac-mirror/commit/cef616470ac8d51a472b64ec744b083d6d38aaf2)** to **[9be4ba9](https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b)**



---

archive/issue_comments_370308.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-11-30T01:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370308",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_318811.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-30T01:07:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318811"
}
```



---

archive/issue_events_318812.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-30T01:07:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318812"
}
```



---

archive/issue_comments_370309.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@jdemeyer](#comment%3A30):\n> Replying to [@tscrim](#comment%3A26):\n> > The problem I have with having it raise an `AttributeError` on `gens` is that it suggests that the user should implement a `gens` rather than give an (overriding) implementation of `_richcmp_`. So I feel that it sends the wrong message in these cases.\n\n> \n> OK, I changed this to raise `NotImplementedError`. Returning `NotImplemented` seems inappropriate here because the `_richcmp_` method does understand what is asked and it knows that it cannot compute the result.\n\nThank you.\n\nEverything else LGTM. Positive review.",
    "created_at": "2017-11-30T01:07:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370309",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@jdemeyer](#comment%3A30):
> Replying to [@tscrim](#comment%3A26):
> > The problem I have with having it raise an `AttributeError` on `gens` is that it suggests that the user should implement a `gens` rather than give an (overriding) implementation of `_richcmp_`. So I feel that it sends the wrong message in these cases.

> 
> OK, I changed this to raise `NotImplementedError`. Returning `NotImplemented` seems inappropriate here because the `_richcmp_` method does understand what is asked and it knows that it cannot compute the result.

Thank you.

Everything else LGTM. Positive review.



---

archive/issue_comments_370310.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/24281](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24281)** to **[9be4ba9](https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b)**",
    "created_at": "2017-12-13T17:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24281#issuecomment-370310",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/24281](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24281)** to **[9be4ba9](https://github.com/sagemath/sagetrac-mirror/commit/9be4ba9c2ad39429f083d5b5b0ed9eeda945404b)**



---

archive/issue_events_318813.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-13T17:37:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318813"
}
```



---

archive/issue_events_318814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "83527e8e57f276e16417869e697c04dd8426a4c8",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-13T17:37:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24281",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24281#event-318814"
}
```
