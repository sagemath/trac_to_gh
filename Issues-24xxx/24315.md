# Issue 24315: dancing links: find all solutions using given rows + find first solution in parallel + doc

archive/issues_024078.json:
```json
{
    "assignees": [],
    "body": "\n```\n    sage: from sage.combinat.matrices.dancing_links import dlx_solver\n    sage: rows = [[0,1,2], [3,4,5], [0,1], [2,3,4,5], [0], [1,2,3,4,5]]\n    sage: x = dlx_solver(rows)\n    sage: x\n    Dancing links solver for 6 columns and 6 rows\n```\n\nReturn the first solution found when the computation is done in parallel::\n\n```\n    sage: x.first_solution_found_in_parallel(ncpus=8)\n    [0, 1]\n```\n\nFind all solutions using some specific rows::\n\n```\n    sage: x_using_row_2 = x.restrict([2])\n    sage: x_using_row_2\n    Dancing links solver for 6 columns and 6 rows\n    sage: list(x_using_row_2.solutions_iterator())\n    [[2, 3]]\n```\n\nKeywords: **thursdaysbdx**\n\nBranch: **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24315_\n\n",
    "closed_at": "2017-12-18T19:39:25Z",
    "created_at": "2017-12-02T13:14:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "dancing links: find all solutions using given rows + find first solution in parallel + doc",
    "type": "issue",
    "updated_at": "2017-12-23T16:22:22Z",
    "url": "https://github.com/sagemath/sage/issues/24315",
    "user": "https://github.com/seblabbe"
}
```

```
    sage: from sage.combinat.matrices.dancing_links import dlx_solver
    sage: rows = [[0,1,2], [3,4,5], [0,1], [2,3,4,5], [0], [1,2,3,4,5]]
    sage: x = dlx_solver(rows)
    sage: x
    Dancing links solver for 6 columns and 6 rows
```

Return the first solution found when the computation is done in parallel::

```
    sage: x.first_solution_found_in_parallel(ncpus=8)
    [0, 1]
```

Find all solutions using some specific rows::

```
    sage: x_using_row_2 = x.restrict([2])
    sage: x_using_row_2
    Dancing links solver for 6 columns and 6 rows
    sage: list(x_using_row_2.solutions_iterator())
    [[2, 3]]
```

Keywords: **thursdaysbdx**

Branch: **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)**

Reviewer: **Vincent Delecroix**

Author: **Sébastien Labbé**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/24315_





---

archive/issue_events_334321.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-02T13:14:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334321"
}
```



---

archive/issue_events_334322.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-02T13:14:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334322"
}
```



---

archive/issue_events_334323.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-02T13:14:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334323"
}
```



---

archive/issue_events_334324.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-02T13:14:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334324"
}
```



---

archive/issue_comments_368035.json:
```json
{
    "body": "Commit: **[`d39dc96`](https://github.com/sagemath/sagetrac-mirror/commit/d39dc96af75391c764a934f62a3664cfb346fd7f)**",
    "created_at": "2017-12-02T13:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368035",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[`d39dc96`](https://github.com/sagemath/sagetrac-mirror/commit/d39dc96af75391c764a934f62a3664cfb346fd7f)**



---

archive/issue_comments_368036.json:
```json
{
    "body": "Branch: **[u/slabbe/24315](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/24315)**",
    "created_at": "2017-12-02T13:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368036",
    "user": "https://github.com/seblabbe"
}
```

Branch: **[u/slabbe/24315](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/24315)**



---

archive/issue_comments_368037.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d39dc96af75391c764a934f62a3664cfb346fd7f\"><code>d39dc96</code></a></td><td><code>24315: find all solutions using given rows in dancing links + find first solution in parallel + doc</code></td></tr></table>\n",
    "created_at": "2017-12-02T13:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368037",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d39dc96af75391c764a934f62a3664cfb346fd7f"><code>d39dc96</code></a></td><td><code>24315: find all solutions using given rows in dancing links + find first solution in parallel + doc</code></td></tr></table>




---

archive/issue_events_334325.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-02T13:35:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334325"
}
```



---

archive/issue_comments_368038.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,8 @@\n \n ```\n     sage: x_using_row_2 = x.restrict([2])\n+    sage: x_using_row_2\n+    Dancing links solver for 6 columns and 6 rows\n     sage: list(x_using_row_2.solutions_iterator())\n     [[2, 3]]\n ```\n``````\n",
    "created_at": "2017-12-02T13:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368038",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,8 @@
 
 ```
     sage: x_using_row_2 = x.restrict([2])
+    sage: x_using_row_2
+    Dancing links solver for 6 columns and 6 rows
     sage: list(x_using_row_2.solutions_iterator())
     [[2, 3]]
 ```
``````




---

archive/issue_comments_368039.json:
```json
{
    "body": "Changed keywords from none to **thursdaysbdx**",
    "created_at": "2017-12-02T13:37:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368039",
    "user": "https://github.com/seblabbe"
}
```

Changed keywords from none to **thursdaysbdx**



---

archive/issue_comments_368040.json:
```json
{
    "body": "Changed commit from **[`d39dc96`](https://github.com/sagemath/sagetrac-mirror/commit/d39dc96af75391c764a934f62a3664cfb346fd7f)** to **[`236292e`](https://github.com/sagemath/sagetrac-mirror/commit/236292e6ccc27b0bce1cf81c39231c87373a8dc6)**",
    "created_at": "2017-12-02T14:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368040",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d39dc96`](https://github.com/sagemath/sagetrac-mirror/commit/d39dc96af75391c764a934f62a3664cfb346fd7f)** to **[`236292e`](https://github.com/sagemath/sagetrac-mirror/commit/236292e6ccc27b0bce1cf81c39231c87373a8dc6)**



---

archive/issue_comments_368041.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/236292e6ccc27b0bce1cf81c39231c87373a8dc6\"><code>236292e</code></a></td><td><code>24315: find all solutions using given rows in dancing links + find first solution in parallel + doc</code></td></tr></table>\n",
    "created_at": "2017-12-02T14:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368041",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/236292e6ccc27b0bce1cf81c39231c87373a8dc6"><code>236292e</code></a></td><td><code>24315: find all solutions using given rows in dancing links + find first solution in parallel + doc</code></td></tr></table>




---

archive/issue_comments_368042.json:
```json
{
    "body": "Changed commit from **[`236292e`](https://github.com/sagemath/sagetrac-mirror/commit/236292e6ccc27b0bce1cf81c39231c87373a8dc6)** to **[`a885d49`](https://github.com/sagemath/sagetrac-mirror/commit/a885d49e72b075e13024c3492e00bc65c6baffee)**",
    "created_at": "2017-12-02T14:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368042",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`236292e`](https://github.com/sagemath/sagetrac-mirror/commit/236292e6ccc27b0bce1cf81c39231c87373a8dc6)** to **[`a885d49`](https://github.com/sagemath/sagetrac-mirror/commit/a885d49e72b075e13024c3492e00bc65c6baffee)**



---

archive/issue_comments_368043.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a885d49e72b075e13024c3492e00bc65c6baffee\"><code>a885d49</code></a></td><td><code>24315: find all solutions using given rows in dancing links + find first solution in parallel + doc</code></td></tr></table>\n",
    "created_at": "2017-12-02T14:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368043",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a885d49e72b075e13024c3492e00bc65c6baffee"><code>a885d49</code></a></td><td><code>24315: find all solutions using given rows in dancing links + find first solution in parallel + doc</code></td></tr></table>




---

archive/issue_events_334326.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-02T14:39:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "title_is": "dancing links: find all solutions using given rows + find first solution in parallel + doc",
    "title_was": "find all solutions using given rows + find first solution in parallel in dancing links + doc",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334326"
}
```



---

archive/issue_comments_368044.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cb4f0c9194541c59a7ca783b8977e329d0f9aed\"><code>3cb4f0c</code></a></td><td><code>24315: dancing links: avoid deepcopy</code></td></tr></table>\n",
    "created_at": "2017-12-03T09:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368044",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cb4f0c9194541c59a7ca783b8977e329d0f9aed"><code>3cb4f0c</code></a></td><td><code>24315: dancing links: avoid deepcopy</code></td></tr></table>




---

archive/issue_comments_368045.json:
```json
{
    "body": "Changed commit from **[`a885d49`](https://github.com/sagemath/sagetrac-mirror/commit/a885d49e72b075e13024c3492e00bc65c6baffee)** to **[`3cb4f0c`](https://github.com/sagemath/sagetrac-mirror/commit/3cb4f0c9194541c59a7ca783b8977e329d0f9aed)**",
    "created_at": "2017-12-03T09:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368045",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a885d49`](https://github.com/sagemath/sagetrac-mirror/commit/a885d49e72b075e13024c3492e00bc65c6baffee)** to **[`3cb4f0c`](https://github.com/sagemath/sagetrac-mirror/commit/3cb4f0c9194541c59a7ca783b8977e329d0f9aed)**



---

archive/issue_events_334327.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-03T11:32:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334327"
}
```



---

archive/issue_events_334328.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-03T11:32:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334328"
}
```



---

archive/issue_comments_368046.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2017-12-03T11:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368046",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_events_334329.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-03T11:32:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334329"
}
```



---

archive/issue_events_334330.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-03T11:32:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334330"
}
```



---

archive/issue_comments_368047.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAdding `nrows`, `ncols` and `restrict` is a good idea. However in the doctest I would have used an example with a number of rows different from the number of columns.\n\nI really don't like the name `first_solution_found_in_parallel`. Why should we care that it is in parallel? I would just call it `one_solution` and have a `ncpus` parameter (the very same way it is right now for `number_of_solutions`).\n\nIn the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.\n\nHaving `number_of_solutions` exhausts the iterator but not `first_solution_found_in_parallel` is a mistake in the interface.",
    "created_at": "2017-12-03T11:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368047",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Adding `nrows`, `ncols` and `restrict` is a good idea. However in the doctest I would have used an example with a number of rows different from the number of columns.

I really don't like the name `first_solution_found_in_parallel`. Why should we care that it is in parallel? I would just call it `one_solution` and have a `ncpus` parameter (the very same way it is right now for `number_of_solutions`).

In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.

Having `number_of_solutions` exhausts the iterator but not `first_solution_found_in_parallel` is a mistake in the interface.



---

archive/issue_comments_368048.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nMerci pour ton review Vincent. Je vais me remettre sur \u00e7a dans quelques jours.",
    "created_at": "2017-12-04T23:35:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368048",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:9" align="right">comment:9</div>

Merci pour ton review Vincent. Je vais me remettre sur ça dans quelques jours.



---

archive/issue_comments_368049.json:
```json
{
    "body": "Changed commit from **[`3cb4f0c`](https://github.com/sagemath/sagetrac-mirror/commit/3cb4f0c9194541c59a7ca783b8977e329d0f9aed)** to **[`87a3c95`](https://github.com/sagemath/sagetrac-mirror/commit/87a3c959a0fb2def7afcd1d3fa7c78e48f9cd8a8)**",
    "created_at": "2017-12-11T20:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368049",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3cb4f0c`](https://github.com/sagemath/sagetrac-mirror/commit/3cb4f0c9194541c59a7ca783b8977e329d0f9aed)** to **[`87a3c95`](https://github.com/sagemath/sagetrac-mirror/commit/87a3c959a0fb2def7afcd1d3fa7c78e48f9cd8a8)**



---

archive/issue_comments_368050.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87a3c959a0fb2def7afcd1d3fa7c78e48f9cd8a8\"><code>87a3c95</code></a></td><td><code>24315: fixes following reviewer's comments</code></td></tr></table>\n",
    "created_at": "2017-12-11T20:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368050",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87a3c959a0fb2def7afcd1d3fa7c78e48f9cd8a8"><code>87a3c95</code></a></td><td><code>24315: fixes following reviewer's comments</code></td></tr></table>




---

archive/issue_comments_368051.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@videlec](#comment%3A8):\n> Adding `nrows`, `ncols` and `restrict` is a good idea. However in the doctest I would have used an example with a number of rows different from the number of columns.\n\nDone.\n\n> I really don't like the name `first_solution_found_in_parallel`. Why should we care that it is in parallel? I would just call it `one_solution` and have a `ncpus` parameter (the very same way it is right now for `number_of_solutions`).\n\nokay, I changed it to `one_solution`\n\nShould `some_solution` be better following the idioms used in Sage like `some_element` ...\n\n> In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.\n\nNo I am not sure. I was trusting the `@parallel` decorator. Why should this `terminate` handling not be done inside the `@parallel` code?\n \n> Having `number_of_solutions` exhausts the iterator but not `first_solution_found_in_parallel` is a mistake in the interface.\n\nI know. It has always been like that. I agree to take a look at this. My idea would be to implement a `reset` method inside the wrapped `C` or `C++` code and then call first when needed, like before starting an iteration of solutions... I suggest that this should be done in another independent ticket.",
    "created_at": "2017-12-11T20:42:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368051",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@videlec](#comment%3A8):
> Adding `nrows`, `ncols` and `restrict` is a good idea. However in the doctest I would have used an example with a number of rows different from the number of columns.

Done.

> I really don't like the name `first_solution_found_in_parallel`. Why should we care that it is in parallel? I would just call it `one_solution` and have a `ncpus` parameter (the very same way it is right now for `number_of_solutions`).

okay, I changed it to `one_solution`

Should `some_solution` be better following the idioms used in Sage like `some_element` ...

> In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.

No I am not sure. I was trusting the `@parallel` decorator. Why should this `terminate` handling not be done inside the `@parallel` code?
 
> Having `number_of_solutions` exhausts the iterator but not `first_solution_found_in_parallel` is a mistake in the interface.

I know. It has always been like that. I agree to take a look at this. My idea would be to implement a `reset` method inside the wrapped `C` or `C++` code and then call first when needed, like before starting an iteration of solutions... I suggest that this should be done in another independent ticket.



---

archive/issue_comments_368052.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n> In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.\n\nI just double checked running code on examples (Wang tiling in a 12x12 box). And all cpus stop working at the same time when one solution is found and returned. So to me, the code is okay for this aspect.\n\n```\nsage: dlx\nDancing links solver for 1200 columns and 1872 rows\nsage:\nsage: %time sol = dlx.one_solution(ncpus=8)\nCPU times: user 4 ms, sys: 60 ms, total: 64 ms\nWall time: 6.77 s\n```",
    "created_at": "2017-12-11T21:02:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368052",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:12" align="right">comment:12</div>

> In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.

I just double checked running code on examples (Wang tiling in a 12x12 box). And all cpus stop working at the same time when one solution is found and returned. So to me, the code is okay for this aspect.

```
sage: dlx
Dancing links solver for 1200 columns and 1872 rows
sage:
sage: %time sol = dlx.one_solution(ncpus=8)
CPU times: user 4 ms, sys: 60 ms, total: 64 ms
Wall time: 6.77 s
```



---

archive/issue_events_334331.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-11T21:02:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334331"
}
```



---

archive/issue_events_334332.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2017-12-11T21:02:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334332"
}
```



---

archive/issue_comments_368053.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@seblabbe](#comment%3A11):\n> Replying to [@videlec](#comment%3A8):\n> > In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.\n\n> \n> No I am not sure. I was trusting the `@parallel` decorator. Why should this `terminate` handling not be done inside the `@parallel` code?\n\nI think I do have a problem on my computer (parallel is not working at all). Could you write the following in a file\n\n```\nfrom sage.parallel.decorate import parallel\nfrom time import sleep\nfrom sage.misc.prandom import randint\n\n@parallel\ndef f(n):\n    sleep(randint(0,3))\n    return n\n```\nand check whether the following runs in parallel\n\n```\nsage: from WHERE_IT_IS import f\nsage: list(f(range(10)), ncpus=3)\n```\nOn my computer, only one process is launched at a time.\n\nMoreover, if the iterator is not exhausted and I quit Sage, I got an `OSError`such as\n\n```\nsage: F = f(range(10),ncpus=3)\nsage: next(F)\n(((0,), {}), 0)\nsage: quit\nExiting Sage (CPU time 0m0.30s, Wall time 0m5.49s).\nException OSError: OSError(2, 'No such file or directory') in <generator object __call__ at 0x7f5118bc7410> ignored\n```",
    "created_at": "2017-12-12T07:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368053",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@seblabbe](#comment%3A11):
> Replying to [@videlec](#comment%3A8):
> > In the `first_solution_found_in_parallel` are you sure that the subprocesses are stopped once a solution has been found? (I don't believe it). If you want such a thing to happen you need to explicitely call `terminate()` on the pool. The `@parallel` interface is not nice enough. See [https://docs.python.org/2/library/multiprocessing.html](https://docs.python.org/2/library/multiprocessing.html). And this needs careful doctesting.

> 
> No I am not sure. I was trusting the `@parallel` decorator. Why should this `terminate` handling not be done inside the `@parallel` code?

I think I do have a problem on my computer (parallel is not working at all). Could you write the following in a file

```
from sage.parallel.decorate import parallel
from time import sleep
from sage.misc.prandom import randint

@parallel
def f(n):
    sleep(randint(0,3))
    return n
```
and check whether the following runs in parallel

```
sage: from WHERE_IT_IS import f
sage: list(f(range(10)), ncpus=3)
```
On my computer, only one process is launched at a time.

Moreover, if the iterator is not exhausted and I quit Sage, I got an `OSError`such as

```
sage: F = f(range(10),ncpus=3)
sage: next(F)
(((0,), {}), 0)
sage: quit
Exiting Sage (CPU time 0m0.30s, Wall time 0m5.49s).
Exception OSError: OSError(2, 'No such file or directory') in <generator object __call__ at 0x7f5118bc7410> ignored
```



---

archive/issue_comments_368054.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI see what you mean. I was able to reproduce. Calling next once launches all the processes, and it seems the user is expected to exhaust the generator before exiting. It may be a bug. In my case, I do not use the `next`.\n\nBut if I use it in a for loop, and call `return` inside the loop, then it is okay. Can you confirm?\n\n```\nr\"\"\"\nEXAMPLES:\n\nNot okay::\n\n    sage: %runfile file.sage\n    sage: it = g(range(360,370))\n    sage: next(it)\n    (((360,), {}),\n    3^3 * 5^2 * 7 * 11 * 13 * 17 * 19 * 31 * 37 * 41 * 61 * 73 * 109 * 151 * 181 * 241 * 331 * 433 * 631 * 1321 * 23311 * 38737 * 54001 * 61681 * 18837001 * 29247661 * 4562284561 * 168692292721 * 469775495062434961)\n    sage: exit\n    Exiting Sage (CPU time 0m0.63s, Wall time 0m20.09s).\n    Exception OSError: OSError(2, 'No such file or directory') in <generator object __call__ at 0x7fef19074f00> ignored\n\nThis is okay::\n\n    sage: %runfile file.sage\n    sage: h(range(500, 510))\n    (((504,), {}),\n    3^3 * 5 * 7^2 * 13 * 17 * 19 * 29 * 37 * 43 * 73 * 109 * 113 * 127 * 241 * 337 * 433 * 1009 * 1429 * 3361 * 5419 * 14449 * 21169 * 38737 * 92737 * 649657 * 2627857 * 15790321 * 269389009 * 40388473189 * 77158673929 * 88959882481 * 118750098349 * 1475204679190128571777)\n    sage: exit\n    Exiting Sage (CPU time 0m0.25s, Wall time 0m26.61s).\n\n\"\"\"\nfrom sage.parallel.decorate import parallel\nfrom time import sleep\nfrom sage.misc.prandom import randint\n\n@parallel\ndef f(n):\n    sleep(randint(0,3))\n    return n\n\n@parallel(ncpus=6)\ndef g(n):\n    return factor(2^n-1)\n\ndef h(L):\n    for result in g(L):\n        return result\n\n```",
    "created_at": "2017-12-13T07:47:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368054",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:14" align="right">comment:14</div>

I see what you mean. I was able to reproduce. Calling next once launches all the processes, and it seems the user is expected to exhaust the generator before exiting. It may be a bug. In my case, I do not use the `next`.

But if I use it in a for loop, and call `return` inside the loop, then it is okay. Can you confirm?

```
r"""
EXAMPLES:

Not okay::

    sage: %runfile file.sage
    sage: it = g(range(360,370))
    sage: next(it)
    (((360,), {}),
    3^3 * 5^2 * 7 * 11 * 13 * 17 * 19 * 31 * 37 * 41 * 61 * 73 * 109 * 151 * 181 * 241 * 331 * 433 * 631 * 1321 * 23311 * 38737 * 54001 * 61681 * 18837001 * 29247661 * 4562284561 * 168692292721 * 469775495062434961)
    sage: exit
    Exiting Sage (CPU time 0m0.63s, Wall time 0m20.09s).
    Exception OSError: OSError(2, 'No such file or directory') in <generator object __call__ at 0x7fef19074f00> ignored

This is okay::

    sage: %runfile file.sage
    sage: h(range(500, 510))
    (((504,), {}),
    3^3 * 5 * 7^2 * 13 * 17 * 19 * 29 * 37 * 43 * 73 * 109 * 113 * 127 * 241 * 337 * 433 * 1009 * 1429 * 3361 * 5419 * 14449 * 21169 * 38737 * 92737 * 649657 * 2627857 * 15790321 * 269389009 * 40388473189 * 77158673929 * 88959882481 * 118750098349 * 1475204679190128571777)
    sage: exit
    Exiting Sage (CPU time 0m0.25s, Wall time 0m26.61s).

"""
from sage.parallel.decorate import parallel
from time import sleep
from sage.misc.prandom import randint

@parallel
def f(n):
    sleep(randint(0,3))
    return n

@parallel(ncpus=6)
def g(n):
    return factor(2^n-1)

def h(L):
    for result in g(L):
        return result

```



---

archive/issue_comments_368055.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI guess that because of the two `\u00e9` in S\u00e9bastien Labb\u00e9, the patchbot is not so happy. Could you set the encoding?",
    "created_at": "2017-12-13T23:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368055",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">comment:15</div>

I guess that because of the two `é` in Sébastien Labbé, the patchbot is not so happy. Could you set the encoding?



---

archive/issue_comments_368056.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFor one patchbot result, I read `Error downloading gmpy2-2.1.0a1.tar.gz` and in the other, I read problem compiling `cmake`.",
    "created_at": "2017-12-14T07:29:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368056",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:16" align="right">comment:16</div>

For one patchbot result, I read `Error downloading gmpy2-2.1.0a1.tar.gz` and in the other, I read problem compiling `cmake`.



---

archive/issue_comments_368057.json:
```json
{
    "body": "Changed commit from **[`87a3c95`](https://github.com/sagemath/sagetrac-mirror/commit/87a3c959a0fb2def7afcd1d3fa7c78e48f9cd8a8)** to **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)**",
    "created_at": "2017-12-14T07:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368057",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`87a3c95`](https://github.com/sagemath/sagetrac-mirror/commit/87a3c959a0fb2def7afcd1d3fa7c78e48f9cd8a8)** to **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)**



---

archive/issue_comments_368058.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a\"><code>26a8e68</code></a></td><td><code>24315: adding utf-8 header</code></td></tr></table>\n",
    "created_at": "2017-12-14T07:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368058",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a"><code>26a8e68</code></a></td><td><code>24315: adding utf-8 header</code></td></tr></table>




---

archive/issue_comments_368059.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI added the line\n\n```\n# -*- coding: utf-8 -*-\n```\n\nbut is the following line still necessary in the header?\n\n```\n# distutils: language = c++\n```",
    "created_at": "2017-12-14T19:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368059",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:18" align="right">comment:18</div>

I added the line

```
# -*- coding: utf-8 -*-
```

but is the following line still necessary in the header?

```
# distutils: language = c++
```



---

archive/issue_comments_368060.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe distutils directive is mandatory in the `.pxd`/`.pyx` file when you want Cython to compile C++. This distutils directive for the `.pyx` file can also be manually be put in `module_list.py`. But removing it from a `.pxd` file would break external Cython code using it.",
    "created_at": "2017-12-14T20:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368060",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

The distutils directive is mandatory in the `.pxd`/`.pyx` file when you want Cython to compile C++. This distutils directive for the `.pyx` file can also be manually be put in `module_list.py`. But removing it from a `.pxd` file would break external Cython code using it.



---

archive/issue_comments_368061.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nok",
    "created_at": "2017-12-14T21:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368061",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:20" align="right">comment:20</div>

ok



---

archive/issue_events_334333.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-15T12:05:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334333"
}
```



---

archive/issue_events_334334.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-12-15T12:05:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334334"
}
```



---

archive/issue_events_334335.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-18T19:39:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334335"
}
```



---

archive/issue_events_334336.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b56f7ede5cf98ac38844b872a9fc8dbb666478e2",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-18T19:39:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24315#event-334336"
}
```



---

archive/issue_comments_368062.json:
```json
{
    "body": "Changed branch from **[u/slabbe/24315](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/24315)** to **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)**",
    "created_at": "2017-12-18T19:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368062",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/slabbe/24315](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/24315)** to **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)**



---

archive/issue_comments_368063.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nFollowup at #24424",
    "created_at": "2017-12-23T16:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368063",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

Followup at #24424



---

archive/issue_comments_368064.json:
```json
{
    "body": "Changed commit from **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)** to none",
    "created_at": "2017-12-23T16:22:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24315#issuecomment-368064",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`26a8e68`](https://github.com/sagemath/sagetrac-mirror/commit/26a8e688740204e939ee8ecd69882565fde0b71a)** to none
