# Issue 24178: Make arith versions of some functions default, dispatching to symbolic

archive/issues_023941.json:
```json
{
    "body": "Of many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.\n\nThe logical solution would be for all cases to\n- make the arith version the default by removing the import in `sage/functions/all.py`; the arith version will no longer be overwritten\n- dispatch calls to the arith version with symbolic arguments to the symbolic function version\n- copy some symbolic documentation to arith because that docstring will be shown now \n\nThe issues #22314, #17489 depend on this.\n\n**CC:**  @jdemeyer @videlec\n\n**Branch:** [u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic)\n\n**Commit:** [4bc93d0528041b6db0c3dd556b1cd6da28a0724c](https://github.com/sagemath/sagetrac-mirror/commit/4bc93d0528041b6db0c3dd556b1cd6da28a0724c)\n\n**Author:** Ralf Stephan\n\nIssue created by migration from https://trac.sagemath.org/ticket/24178\n\n",
    "closed_at": "2018-05-18T17:16:26Z",
    "created_at": "2017-11-09T09:17:51Z",
    "labels": [
        "component: basic arithmetic",
        "bug",
        "wontfix"
    ],
    "title": "Make arith versions of some functions default, dispatching to symbolic",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/24178",
    "user": "https://github.com/rwst"
}
```
Of many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.

The logical solution would be for all cases to
- make the arith version the default by removing the import in `sage/functions/all.py`; the arith version will no longer be overwritten
- dispatch calls to the arith version with symbolic arguments to the symbolic function version
- copy some symbolic documentation to arith because that docstring will be shown now 

The issues #22314, #17489 depend on this.

**CC:**  @jdemeyer @videlec

**Branch:** [u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic)

**Commit:** [4bc93d0528041b6db0c3dd556b1cd6da28a0724c](https://github.com/sagemath/sagetrac-mirror/commit/4bc93d0528041b6db0c3dd556b1cd6da28a0724c)

**Author:** Ralf Stephan

Issue created by migration from https://trac.sagemath.org/ticket/24178





---

archive/issue_comments_368310.json:
```json
{
    "body": "<a id='comment:1'></a>\nWhy should there even be two versions of every function in the first place? Shouldn't we be able to support all use cases in one function?",
    "created_at": "2017-11-09T09:33:32Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368310",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Why should there even be two versions of every function in the first place? Shouldn't we be able to support all use cases in one function?



---

archive/issue_comments_368311.json:
```json
{
    "body": "<a id='comment:2'></a>\nI wanted to have the code completely in `functions` but #14723 had its problems. See also #17489.",
    "created_at": "2017-11-09T10:13:24Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368311",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
I wanted to have the code completely in `functions` but #14723 had its problems. See also #17489.



---

archive/issue_comments_368312.json:
```json
{
    "body": "<a id='comment:3'></a>\nI could also naively ask, if everything coerces into SR why can't symbolic functions by default coerce every argument?",
    "created_at": "2017-11-10T06:38:49Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368312",
    "user": "https://github.com/rwst"
}
```

<a id='comment:3'></a>
I could also naively ask, if everything coerces into SR why can't symbolic functions by default coerce every argument?



---

archive/issue_comments_368313.json:
```json
{
    "body": "<a id='comment:4'></a>\nI mean you implemented the symbolic function machinery, and it's fine if you step back and say, let others go ahead now. But you could at least review attempts to fix your design decisions.",
    "created_at": "2017-11-10T06:44:00Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368313",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>
I mean you implemented the symbolic function machinery, and it's fine if you step back and say, let others go ahead now. But you could at least review attempts to fix your design decisions.



---

archive/issue_comments_368314.json:
```json
{
    "body": "<a id='comment:5'></a>\nAlternatively, if NOT everything coerces into SR then the symbolic `binomial` interface is more restricted than the arith `binomial` interface, and thus the arith version should be default, calling the symbolic version.",
    "created_at": "2017-11-10T07:01:54Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368314",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'></a>
Alternatively, if NOT everything coerces into SR then the symbolic `binomial` interface is more restricted than the arith `binomial` interface, and thus the arith version should be default, calling the symbolic version.



---

archive/issue_events_214719.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-04T14:09:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "rename": {
        "from": "Make arith versions of functions default, dispatching to symbolic",
        "to": "Make arith versions of some functions default, dispatching to symbolic"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214719"
}
```



---

archive/issue_comments_368315.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,3 +4,5 @@\n - make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten\n - dispatch calls to the arith version with symbolic arguments to the symbolic function version\n - copy some symbolic documentation to arith because that docstring will be shown now \n+\n+The issues #22314, #17489 depend on this.\n``````\n",
    "created_at": "2018-03-04T14:09:55Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368315",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,3 +4,5 @@
 - make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten
 - dispatch calls to the arith version with symbolic arguments to the symbolic function version
 - copy some symbolic documentation to arith because that docstring will be shown now 
+
+The issues #22314, #17489 depend on this.
``````




---

archive/issue_comments_368316.json:
```json
{
    "body": "<a id='comment:7'></a>\nSee also [#19461 comment:9](https://github.com/sagemath/sage/issues/19461#comment:9)",
    "created_at": "2018-03-04T14:12:24Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368316",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
See also [#19461 comment:9](https://github.com/sagemath/sage/issues/19461#comment:9)



---

archive/issue_comments_368317.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n Of many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.\n \n The logical solution would be for all cases to\n-- make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten\n+- make the arith version the default by removing the import in `sage/functions/all.py`; the arith version will no longer be overwritten\n - dispatch calls to the arith version with symbolic arguments to the symbolic function version\n - copy some symbolic documentation to arith because that docstring will be shown now \n \n``````\n",
    "created_at": "2018-03-15T07:51:30Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368317",
    "user": "https://github.com/rwst"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 Of many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.
 
 The logical solution would be for all cases to
-- make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten
+- make the arith version the default by removing the import in `sage/functions/all.py`; the arith version will no longer be overwritten
 - dispatch calls to the arith version with symbolic arguments to the symbolic function version
 - copy some symbolic documentation to arith because that docstring will be shown now 
 
``````




---

archive/issue_comments_368318.json:
```json
{
    "body": "**Branch:** [u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic)",
    "created_at": "2018-03-15T08:59:54Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368318",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/make_arith_versions_of_some_functions_default__dispatching_to_symbolic)



---

archive/issue_comments_368319.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/669cfff0a419c5f08e010f76ff0d33eea235c97d\">669cfff</a></td><td><code>24178: changes to arith and doctests</code></td></tr></table>\n",
    "created_at": "2018-03-15T16:01:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368319",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/669cfff0a419c5f08e010f76ff0d33eea235c97d">669cfff</a></td><td><code>24178: changes to arith and doctests</code></td></tr></table>




---

archive/issue_comments_368320.json:
```json
{
    "body": "**Commit:** [669cfff0a419c5f08e010f76ff0d33eea235c97d](https://github.com/sagemath/sagetrac-mirror/commit/669cfff0a419c5f08e010f76ff0d33eea235c97d)",
    "created_at": "2018-03-15T16:01:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368320",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [669cfff0a419c5f08e010f76ff0d33eea235c97d](https://github.com/sagemath/sagetrac-mirror/commit/669cfff0a419c5f08e010f76ff0d33eea235c97d)



---

archive/issue_comments_368321.json:
```json
{
    "body": "**Changing commit** from \"[669cfff0a419c5f08e010f76ff0d33eea235c97d](https://github.com/sagemath/sagetrac-mirror/commit/669cfff0a419c5f08e010f76ff0d33eea235c97d)\" to \"[4bc93d0528041b6db0c3dd556b1cd6da28a0724c](https://github.com/sagemath/sagetrac-mirror/commit/4bc93d0528041b6db0c3dd556b1cd6da28a0724c)\".",
    "created_at": "2018-03-15T16:13:36Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[669cfff0a419c5f08e010f76ff0d33eea235c97d](https://github.com/sagemath/sagetrac-mirror/commit/669cfff0a419c5f08e010f76ff0d33eea235c97d)" to "[4bc93d0528041b6db0c3dd556b1cd6da28a0724c](https://github.com/sagemath/sagetrac-mirror/commit/4bc93d0528041b6db0c3dd556b1cd6da28a0724c)".



---

archive/issue_comments_368322.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bc93d0528041b6db0c3dd556b1cd6da28a0724c\">4bc93d0</a></td><td><code>24178: code simplification</code></td></tr></table>\n",
    "created_at": "2018-03-15T16:13:36Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bc93d0528041b6db0c3dd556b1cd6da28a0724c">4bc93d0</a></td><td><code>24178: code simplification</code></td></tr></table>




---

archive/issue_comments_368323.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis should resolve #17489 and #22314 in one go.\n\nDoctests pass in arith and all the  symbolics and function directories but let's see.\n\nRemaining issues like merging of documentation and deprecation of the obscure `binomial._binomial_sym`, `binomial._eval_`, `binomial._evalf_` is stuff for other tickets.\n\nPlease review.",
    "created_at": "2018-03-15T16:14:41Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368323",
    "user": "https://github.com/rwst"
}
```

<a id='comment:12'></a>
This should resolve #17489 and #22314 in one go.

Doctests pass in arith and all the  symbolics and function directories but let's see.

Remaining issues like merging of documentation and deprecation of the obscure `binomial._binomial_sym`, `binomial._eval_`, `binomial._evalf_` is stuff for other tickets.

Please review.



---

archive/issue_events_214720.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-15T16:14:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214720"
}
```



---

archive/issue_comments_368324.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2018-03-15T16:14:41Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368324",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_368325.json:
```json
{
    "body": "<a id='comment:13'></a>\nPlease don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.",
    "created_at": "2018-03-15T17:52:44Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368325",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>
Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.



---

archive/issue_comments_368326.json:
```json
{
    "body": "<a id='comment:14'></a>\nNot changing the arith/ versions means writing a global interface function elsewhere. I'm fine with that.",
    "created_at": "2018-03-15T18:37:46Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368326",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
Not changing the arith/ versions means writing a global interface function elsewhere. I'm fine with that.



---

archive/issue_comments_368327.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [vdelecroix](#comment%3A13):\n> Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.\n\n\nI agree with Vincent. Keep the fast functions as they are now.",
    "created_at": "2018-03-15T19:27:14Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368327",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
Replying to [vdelecroix](#comment%3A13):
> Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.


I agree with Vincent. Keep the fast functions as they are now.



---

archive/issue_comments_368328.json:
```json
{
    "body": "<a id='comment:16'></a>\nNothing wrong with a fast arithmetic function version taking integer arguments, for special needs (and that's why they needed to be imported for some time now). Note that `arith.misc.binomial` does a lot of dispatching attempts and parent queries that do not match what you just argued.\n\nBecause the global entry functions in `functions.other` restrict the argument type, an unrestricted version is needed. Like as in `log` this can be put right next to the function class as a Python function. This would then carry a documentation overview.",
    "created_at": "2018-03-16T07:21:57Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368328",
    "user": "https://github.com/rwst"
}
```

<a id='comment:16'></a>
Nothing wrong with a fast arithmetic function version taking integer arguments, for special needs (and that's why they needed to be imported for some time now). Note that `arith.misc.binomial` does a lot of dispatching attempts and parent queries that do not match what you just argued.

Because the global entry functions in `functions.other` restrict the argument type, an unrestricted version is needed. Like as in `log` this can be put right next to the function class as a Python function. This would then carry a documentation overview.



---

archive/issue_comments_368329.json:
```json
{
    "body": "<a id='comment:17'></a>\nThe original issue won't be fixed.",
    "created_at": "2018-03-16T07:36:11Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368329",
    "user": "https://github.com/rwst"
}
```

<a id='comment:17'></a>
The original issue won't be fixed.



---

archive/issue_events_214721.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T07:36:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214721"
}
```



---

archive/issue_events_214722.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T07:36:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214722"
}
```



---

archive/issue_events_214723.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T07:36:11Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214723"
}
```



---

archive/issue_events_214724.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "label": "wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214724"
}
```



---

archive/issue_comments_368330.json:
```json
{
    "body": "<a id='comment:18'></a>\nclosing positively reviewed duplicates",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24178#issuecomment-368330",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>
closing positively reviewed duplicates



---

archive/issue_events_214725.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214725"
}
```



---

archive/issue_events_214726.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-05-18T17:16:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24178",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24178#event-214726"
}
```
