# Issue 24247: Implement __pow__ in the coercion model

archive/issues_024010.json:
```json
{
    "assignees": [],
    "body": "We implement powering in the coercion model. One important difference between powering and other operators is that the most common use case for powering is powering something to an integer exponent.\n\nTo deal with this integer powering, we implement an action `IntegerPowAction`. This action calls a special method `_pow_int()` on the element. In other words, `x ^ n` for an integer `n` becomes `x._pow_int(n)`. We also provide a default implementation of `_pow_int` for `MonoidElement` and `RingElement` which uses the square-and-multiply algorithm implemented in `generic_power()`.\n\nFor backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here, see #15709.\n\nApart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.\n\nNote that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it. See also #5082.\n\nFixing powering for specific parents is not within the scope of this ticket, except where it was needed to fix doctest failures. For example, we fix various serious bugs in powering for `RDF` such as:\n\n```\nsage: RDF(0) ^ RDF(-1)\n0.0\nsage: RDF(-1) ^ RDF(2)\nNaN\n```\n\nDepends on #24467\n\nBranch/Commit: **[74d6700](https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66)**\n\nReviewer: **Travis Scrimshaw, Vincent Delecroix**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24247_\n\n",
    "closed_at": "2018-01-15T22:29:32Z",
    "created_at": "2017-11-20T09:42:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20coercion",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement __pow__ in the coercion model",
    "type": "issue",
    "updated_at": "2018-01-15T22:29:32Z",
    "url": "https://github.com/sagemath/sage/issues/24247",
    "user": "https://github.com/jdemeyer"
}
```
We implement powering in the coercion model. One important difference between powering and other operators is that the most common use case for powering is powering something to an integer exponent.

To deal with this integer powering, we implement an action `IntegerPowAction`. This action calls a special method `_pow_int()` on the element. In other words, `x ^ n` for an integer `n` becomes `x._pow_int(n)`. We also provide a default implementation of `_pow_int` for `MonoidElement` and `RingElement` which uses the square-and-multiply algorithm implemented in `generic_power()`.

For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here, see #15709.

Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.

Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it. See also #5082.

Fixing powering for specific parents is not within the scope of this ticket, except where it was needed to fix doctest failures. For example, we fix various serious bugs in powering for `RDF` such as:

```
sage: RDF(0) ^ RDF(-1)
0.0
sage: RDF(-1) ^ RDF(2)
NaN
```

Depends on #24467

Branch/Commit: **[74d6700](https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66)**

Reviewer: **Travis Scrimshaw, Vincent Delecroix**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/24247_





---

archive/issue_events_306889.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-20T09:42:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306889"
}
```



---

archive/issue_events_306890.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-20T09:42:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20coercion",
    "label_color": "0000ff",
    "label_name": "component: coercion",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306890"
}
```



---

archive/issue_events_306891.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-20T09:42:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306891"
}
```



---

archive/issue_events_306892.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-20T09:42:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306892"
}
```



---

archive/issue_comments_369628.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n+`__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.\n \n+To solve this, we first check whether the exponent is \"integer-like\". If so, we call `_pow_long`. If not, we do the usual coercion.\n+\n+This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.\n``````\n",
    "created_at": "2017-11-20T11:07:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369628",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
+`__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.
 
+To solve this, we first check whether the exponent is "integer-like". If so, we call `_pow_long`. If not, we do the usual coercion.
+
+This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.
``````




---

archive/issue_comments_369629.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n `__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.\n \n-To solve this, we first check whether the exponent is \"integer-like\". If so, we call `_pow_long`. If not, we do the usual coercion.\n+To solve this, we first check whether the exponent is \"integer-like\". If so, we call `_pow_int`. If not, we do the usual coercion.\n \n This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.\n``````\n",
    "created_at": "2017-11-20T11:33:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369629",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 `__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.
 
-To solve this, we first check whether the exponent is "integer-like". If so, we call `_pow_long`. If not, we do the usual coercion.
+To solve this, we first check whether the exponent is "integer-like". If so, we call `_pow_int`. If not, we do the usual coercion.
 
 This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.
``````




---

archive/issue_comments_369630.json:
```json
{
    "body": "Changed dependencies from **#24244** to **#24248**",
    "created_at": "2017-11-20T12:19:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369630",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24244** to **#24248**



---

archive/issue_comments_369631.json:
```json
{
    "body": "Branch: **[u/jdemeyer/implement___pow___in_the_coercion_model](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/implement___pow___in_the_coercion_model)**",
    "created_at": "2017-11-20T16:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369631",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/implement___pow___in_the_coercion_model](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/implement___pow___in_the_coercion_model)**



---

archive/issue_comments_369632.json:
```json
{
    "body": "Commit: **[a18280f](https://github.com/sagemath/sagetrac-mirror/commit/a18280f20d1a3a9d87300be699b5efa77ac10d8b)**",
    "created_at": "2017-11-20T16:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369632",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[a18280f](https://github.com/sagemath/sagetrac-mirror/commit/a18280f20d1a3a9d87300be699b5efa77ac10d8b)**



---

archive/issue_comments_369633.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ad8983a472674aeb9defb54a2804b8d4df903a1\">9ad8983</a></td><td><code>Fake Integer interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04235be48d4907c95c1b525348c7125558155dfd\">04235be</a></td><td><code>New functions integer_check_long() and integer_check_long_py()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad34554a622a38e3f7e1ad33c51e37800e515fec\">ad34554</a></td><td><code>Fix isinstance(x, int) calls in element.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a18280f20d1a3a9d87300be699b5efa77ac10d8b\">a18280f</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-11-20T16:26:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369633",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:5'>Comment 5:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ad8983a472674aeb9defb54a2804b8d4df903a1">9ad8983</a></td><td><code>Fake Integer interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04235be48d4907c95c1b525348c7125558155dfd">04235be</a></td><td><code>New functions integer_check_long() and integer_check_long_py()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad34554a622a38e3f7e1ad33c51e37800e515fec">ad34554</a></td><td><code>Fix isinstance(x, int) calls in element.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a18280f20d1a3a9d87300be699b5efa77ac10d8b">a18280f</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369634.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb114c91736f48e5854613ae438377ed7f032b7e\">bb114c9</a></td><td><code>Fake Integer interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d76bc133b7b93cf3a3baaad782caedee692ae0a\">4d76bc1</a></td><td><code>New functions integer_check_long() and integer_check_long_py()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c579c7ed1cf09f567c0452352b65d524ad66371\">9c579c7</a></td><td><code>Fix isinstance(x, int) calls in element.pyx</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b194fb82d37eb5036f36ee37cf6b38bc27e0d30\">8b194fb</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-11-20T18:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369634",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb114c91736f48e5854613ae438377ed7f032b7e">bb114c9</a></td><td><code>Fake Integer interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d76bc133b7b93cf3a3baaad782caedee692ae0a">4d76bc1</a></td><td><code>New functions integer_check_long() and integer_check_long_py()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c579c7ed1cf09f567c0452352b65d524ad66371">9c579c7</a></td><td><code>Fix isinstance(x, int) calls in element.pyx</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b194fb82d37eb5036f36ee37cf6b38bc27e0d30">8b194fb</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369635.json:
```json
{
    "body": "Changed commit from **[a18280f](https://github.com/sagemath/sagetrac-mirror/commit/a18280f20d1a3a9d87300be699b5efa77ac10d8b)** to **[8b194fb](https://github.com/sagemath/sagetrac-mirror/commit/8b194fb82d37eb5036f36ee37cf6b38bc27e0d30)**",
    "created_at": "2017-11-20T18:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369635",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a18280f](https://github.com/sagemath/sagetrac-mirror/commit/a18280f20d1a3a9d87300be699b5efa77ac10d8b)** to **[8b194fb](https://github.com/sagemath/sagetrac-mirror/commit/8b194fb82d37eb5036f36ee37cf6b38bc27e0d30)**



---

archive/issue_comments_369636.json:
```json
{
    "body": "Changed commit from **[8b194fb](https://github.com/sagemath/sagetrac-mirror/commit/8b194fb82d37eb5036f36ee37cf6b38bc27e0d30)** to **[54eb896](https://github.com/sagemath/sagetrac-mirror/commit/54eb896167c809daad138588f9bc86b5c5659591)**",
    "created_at": "2017-11-21T13:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369636",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8b194fb](https://github.com/sagemath/sagetrac-mirror/commit/8b194fb82d37eb5036f36ee37cf6b38bc27e0d30)** to **[54eb896](https://github.com/sagemath/sagetrac-mirror/commit/54eb896167c809daad138588f9bc86b5c5659591)**



---

archive/issue_comments_369637.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/54eb896167c809daad138588f9bc86b5c5659591\">54eb896</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-11-21T13:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369637",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/54eb896167c809daad138588f9bc86b5c5659591">54eb896</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369638.json:
```json
{
    "body": "Changed dependencies from **#24248** to **#24248, #24259**",
    "created_at": "2017-11-21T13:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369638",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24248** to **#24248, #24259**



---

archive/issue_comments_369639.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e031351b06fe41b299b1f2fb74cb294f3489fb1\">5e03135</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-11-21T14:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369639",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e031351b06fe41b299b1f2fb74cb294f3489fb1">5e03135</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369640.json:
```json
{
    "body": "Changed commit from **[54eb896](https://github.com/sagemath/sagetrac-mirror/commit/54eb896167c809daad138588f9bc86b5c5659591)** to **[5e03135](https://github.com/sagemath/sagetrac-mirror/commit/5e031351b06fe41b299b1f2fb74cb294f3489fb1)**",
    "created_at": "2017-11-21T14:17:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369640",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[54eb896](https://github.com/sagemath/sagetrac-mirror/commit/54eb896167c809daad138588f9bc86b5c5659591)** to **[5e03135](https://github.com/sagemath/sagetrac-mirror/commit/5e031351b06fe41b299b1f2fb74cb294f3489fb1)**



---

archive/issue_comments_369641.json:
```json
{
    "body": "Changed dependencies from **#24248, #24259** to **#24248, #24259, #24260**",
    "created_at": "2017-11-21T14:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369641",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24248, #24259** to **#24248, #24259, #24260**



---

archive/issue_comments_369642.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88eaed585d8159a4a0763e56caaf3a767d4cb2f0\">88eaed5</a></td><td><code>Declare Integer.value as array</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c1f43f861165ff975616f60cab37c92d36d10f6\">5c1f43f</a></td><td><code>Deprecate str ^ Integer</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70592a850d7677928592c022760d6183bd81364f\">70592a8</a></td><td><code>Fix compiler warning</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3db645373a6cbd7cec52f84b20ee615556d4ca2\">d3db645</a></td><td><code>Merge commit '88eaed585d8159a4a0763e56caaf3a767d4cb2f0'; commit '5c1f43f861165ff975616f60cab37c92d36d10f6'; commit '70592a850d7677928592c022760d6183bd81364f' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d3aa638f654dbc104ec85887eedfdb13e271589\">0d3aa63</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-11-21T17:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369642",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88eaed585d8159a4a0763e56caaf3a767d4cb2f0">88eaed5</a></td><td><code>Declare Integer.value as array</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c1f43f861165ff975616f60cab37c92d36d10f6">5c1f43f</a></td><td><code>Deprecate str ^ Integer</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70592a850d7677928592c022760d6183bd81364f">70592a8</a></td><td><code>Fix compiler warning</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3db645373a6cbd7cec52f84b20ee615556d4ca2">d3db645</a></td><td><code>Merge commit '88eaed585d8159a4a0763e56caaf3a767d4cb2f0'; commit '5c1f43f861165ff975616f60cab37c92d36d10f6'; commit '70592a850d7677928592c022760d6183bd81364f' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d3aa638f654dbc104ec85887eedfdb13e271589">0d3aa63</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369643.json:
```json
{
    "body": "Changed commit from **[5e03135](https://github.com/sagemath/sagetrac-mirror/commit/5e031351b06fe41b299b1f2fb74cb294f3489fb1)** to **[0d3aa63](https://github.com/sagemath/sagetrac-mirror/commit/0d3aa638f654dbc104ec85887eedfdb13e271589)**",
    "created_at": "2017-11-21T17:38:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369643",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5e03135](https://github.com/sagemath/sagetrac-mirror/commit/5e031351b06fe41b299b1f2fb74cb294f3489fb1)** to **[0d3aa63](https://github.com/sagemath/sagetrac-mirror/commit/0d3aa638f654dbc104ec85887eedfdb13e271589)**



---

archive/issue_comments_369644.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,13 @@\n `__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.\n \n-To solve this, we first check whether the exponent is \"integer-like\". If so, we call `_pow_int`. If not, we do the usual coercion.\n+To solve this, we essentially do as follows:\n+\n+1. If the arguments have equal parents, call `_pow_`.\n+\n+2. If the exponent is \"integer-like\", call `_pow_int`.\n+\n+3. If none of the above applies, do the usual coercion to a common parent. That will call `_pow_` unless the coerced arguments have a custom implementation of `__pow__`.\n+\n+Furthermore, the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.\n \n This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.\n``````\n",
    "created_at": "2017-11-22T08:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369644",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,13 @@
 `__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.
 
-To solve this, we first check whether the exponent is "integer-like". If so, we call `_pow_int`. If not, we do the usual coercion.
+To solve this, we essentially do as follows:
+
+1. If the arguments have equal parents, call `_pow_`.
+
+2. If the exponent is "integer-like", call `_pow_int`.
+
+3. If none of the above applies, do the usual coercion to a common parent. That will call `_pow_` unless the coerced arguments have a custom implementation of `__pow__`.
+
+Furthermore, the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.
 
 This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.
``````




---

archive/issue_comments_369645.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/09afe6dd0312ea51fdb636440cab21f3cc6eccd6\">09afe6d</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-11-24T15:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369645",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'>Comment 13:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/09afe6dd0312ea51fdb636440cab21f3cc6eccd6">09afe6d</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369646.json:
```json
{
    "body": "Changed commit from **[0d3aa63](https://github.com/sagemath/sagetrac-mirror/commit/0d3aa638f654dbc104ec85887eedfdb13e271589)** to **[09afe6d](https://github.com/sagemath/sagetrac-mirror/commit/09afe6dd0312ea51fdb636440cab21f3cc6eccd6)**",
    "created_at": "2017-11-24T15:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369646",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[0d3aa63](https://github.com/sagemath/sagetrac-mirror/commit/0d3aa638f654dbc104ec85887eedfdb13e271589)** to **[09afe6d](https://github.com/sagemath/sagetrac-mirror/commit/09afe6dd0312ea51fdb636440cab21f3cc6eccd6)**



---

archive/issue_comments_369647.json:
```json
{
    "body": "Changed dependencies from **#24248, #24259, #24260** to **#24248, #24259, #24260, #24275, #24276**",
    "created_at": "2017-11-24T15:16:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369647",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24248, #24259, #24260** to **#24248, #24259, #24260, #24275, #24276**



---

archive/issue_comments_369648.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cabd346f70c0e0880c1419cf0803fddf878ec12f\">cabd346</a></td><td><code>Merge tag '8.1.rc4' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0b4070a17e0ac455b569e3f37ace754abda7c89\">b0b4070</a></td><td><code>Various fixes</code></td></tr></table>\n",
    "created_at": "2017-12-05T09:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369648",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cabd346f70c0e0880c1419cf0803fddf878ec12f">cabd346</a></td><td><code>Merge tag '8.1.rc4' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0b4070a17e0ac455b569e3f37ace754abda7c89">b0b4070</a></td><td><code>Various fixes</code></td></tr></table>




---

archive/issue_comments_369649.json:
```json
{
    "body": "Changed commit from **[09afe6d](https://github.com/sagemath/sagetrac-mirror/commit/09afe6dd0312ea51fdb636440cab21f3cc6eccd6)** to **[b0b4070](https://github.com/sagemath/sagetrac-mirror/commit/b0b4070a17e0ac455b569e3f37ace754abda7c89)**",
    "created_at": "2017-12-05T09:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369649",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[09afe6d](https://github.com/sagemath/sagetrac-mirror/commit/09afe6dd0312ea51fdb636440cab21f3cc6eccd6)** to **[b0b4070](https://github.com/sagemath/sagetrac-mirror/commit/b0b4070a17e0ac455b569e3f37ace754abda7c89)**



---

archive/issue_comments_369650.json:
```json
{
    "body": "Changed dependencies from **#24248, #24259, #24260, #24275, #24276** to **#24248, #24259, #24260, #24275, #24276, #24328**",
    "created_at": "2017-12-05T09:32:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369650",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24248, #24259, #24260, #24275, #24276** to **#24248, #24259, #24260, #24275, #24276, #24328**



---

archive/issue_comments_369651.json:
```json
{
    "body": "Changed commit from **[b0b4070](https://github.com/sagemath/sagetrac-mirror/commit/b0b4070a17e0ac455b569e3f37ace754abda7c89)** to **[f6d7ba2](https://github.com/sagemath/sagetrac-mirror/commit/f6d7ba296b19249e4b25a014ce5d3b6ea4986a9e)**",
    "created_at": "2017-12-05T10:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369651",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b0b4070](https://github.com/sagemath/sagetrac-mirror/commit/b0b4070a17e0ac455b569e3f37ace754abda7c89)** to **[f6d7ba2](https://github.com/sagemath/sagetrac-mirror/commit/f6d7ba296b19249e4b25a014ce5d3b6ea4986a9e)**



---

archive/issue_comments_369652.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0aca1c0ac92b95d790f39369a683269efbde530\">c0aca1c</a></td><td><code>New module to implement generic_power</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcb70b3aa96e840088bc9a08d24eb7fca0d73b56\">bcb70b3</a></td><td><code>Merge commit '70592a850d7677928592c022760d6183bd81364f'; commit '88eaed585d8159a4a0763e56caaf3a767d4cb2f0'; commit '5c1f43f861165ff975616f60cab37c92d36d10f6'; commit 'c0aca1c0ac92b95d790f39369a683269efbde530' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6d7ba296b19249e4b25a014ce5d3b6ea4986a9e\">f6d7ba2</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-05T10:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369652",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'>Comment 17:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0aca1c0ac92b95d790f39369a683269efbde530">c0aca1c</a></td><td><code>New module to implement generic_power</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcb70b3aa96e840088bc9a08d24eb7fca0d73b56">bcb70b3</a></td><td><code>Merge commit '70592a850d7677928592c022760d6183bd81364f'; commit '88eaed585d8159a4a0763e56caaf3a767d4cb2f0'; commit '5c1f43f861165ff975616f60cab37c92d36d10f6'; commit 'c0aca1c0ac92b95d790f39369a683269efbde530' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6d7ba296b19249e4b25a014ce5d3b6ea4986a9e">f6d7ba2</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369653.json:
```json
{
    "body": "Changed dependencies from **#24248, #24259, #24260, #24275, #24276, #24328** to **#24328, #24259, #24260, #24275, #24276**",
    "created_at": "2017-12-06T14:14:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369653",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24248, #24259, #24260, #24275, #24276, #24328** to **#24328, #24259, #24260, #24275, #24276**



---

archive/issue_comments_369654.json:
```json
{
    "body": "Changed commit from **[f6d7ba2](https://github.com/sagemath/sagetrac-mirror/commit/f6d7ba296b19249e4b25a014ce5d3b6ea4986a9e)** to **[7658aa4](https://github.com/sagemath/sagetrac-mirror/commit/7658aa46f07c76703ff6dc2e5598abd440306f7a)**",
    "created_at": "2017-12-06T16:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369654",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f6d7ba2](https://github.com/sagemath/sagetrac-mirror/commit/f6d7ba296b19249e4b25a014ce5d3b6ea4986a9e)** to **[7658aa4](https://github.com/sagemath/sagetrac-mirror/commit/7658aa46f07c76703ff6dc2e5598abd440306f7a)**



---

archive/issue_comments_369655.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb9a0c2e5a0dd88e82b7b6f1f56846deb696a56b\">fb9a0c2</a></td><td><code>Various fixes related to generic_power()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de1c6f66b3c0a45efe60bd1c2e23ceb86757cbcf\">de1c6f6</a></td><td><code>Merge commit '70592a850d7677928592c022760d6183bd81364f'; commit '88eaed585d8159a4a0763e56caaf3a767d4cb2f0'; commit '5c1f43f861165ff975616f60cab37c92d36d10f6'; commit 'fb9a0c2e5a0dd88e82b7b6f1f56846deb696a56b' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7658aa46f07c76703ff6dc2e5598abd440306f7a\">7658aa4</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-06T16:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369655",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb9a0c2e5a0dd88e82b7b6f1f56846deb696a56b">fb9a0c2</a></td><td><code>Various fixes related to generic_power()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de1c6f66b3c0a45efe60bd1c2e23ceb86757cbcf">de1c6f6</a></td><td><code>Merge commit '70592a850d7677928592c022760d6183bd81364f'; commit '88eaed585d8159a4a0763e56caaf3a767d4cb2f0'; commit '5c1f43f861165ff975616f60cab37c92d36d10f6'; commit 'fb9a0c2e5a0dd88e82b7b6f1f56846deb696a56b' into t/24247/implement___pow___in_the_coercion_model</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7658aa46f07c76703ff6dc2e5598abd440306f7a">7658aa4</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369656.json:
```json
{
    "body": "Changed commit from **[7658aa4](https://github.com/sagemath/sagetrac-mirror/commit/7658aa46f07c76703ff6dc2e5598abd440306f7a)** to **[edca7ab](https://github.com/sagemath/sagetrac-mirror/commit/edca7ab9da69ea2659f48cadbeb4915888f586f5)**",
    "created_at": "2017-12-07T10:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369656",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[7658aa4](https://github.com/sagemath/sagetrac-mirror/commit/7658aa46f07c76703ff6dc2e5598abd440306f7a)** to **[edca7ab](https://github.com/sagemath/sagetrac-mirror/commit/edca7ab9da69ea2659f48cadbeb4915888f586f5)**



---

archive/issue_comments_369657.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edca7ab9da69ea2659f48cadbeb4915888f586f5\">edca7ab</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-07T10:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369657",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:20'>Comment 20:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edca7ab9da69ea2659f48cadbeb4915888f586f5">edca7ab</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369658.json:
```json
{
    "body": "Changed dependencies from **#24328, #24259, #24260, #24275, #24276** to **#24260, #24275, #24350**",
    "created_at": "2017-12-14T12:45:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369658",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24328, #24259, #24260, #24275, #24276** to **#24260, #24275, #24350**



---

archive/issue_comments_369659.json:
```json
{
    "body": "Changed dependencies from **#24260, #24275, #24350** to none",
    "created_at": "2017-12-23T11:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369659",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24260, #24275, #24350** to none



---

archive/issue_comments_369660.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c442dc8a9f88811d0208c9d71f65a07162dd961\">4c442dc</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-23T13:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369660",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c442dc8a9f88811d0208c9d71f65a07162dd961">4c442dc</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369661.json:
```json
{
    "body": "Changed commit from **[edca7ab](https://github.com/sagemath/sagetrac-mirror/commit/edca7ab9da69ea2659f48cadbeb4915888f586f5)** to **[4c442dc](https://github.com/sagemath/sagetrac-mirror/commit/4c442dc8a9f88811d0208c9d71f65a07162dd961)**",
    "created_at": "2017-12-23T13:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369661",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[edca7ab](https://github.com/sagemath/sagetrac-mirror/commit/edca7ab9da69ea2659f48cadbeb4915888f586f5)** to **[4c442dc](https://github.com/sagemath/sagetrac-mirror/commit/4c442dc8a9f88811d0208c9d71f65a07162dd961)**



---

archive/issue_comments_369662.json:
```json
{
    "body": "Changed commit from **[4c442dc](https://github.com/sagemath/sagetrac-mirror/commit/4c442dc8a9f88811d0208c9d71f65a07162dd961)** to **[cd95bbc](https://github.com/sagemath/sagetrac-mirror/commit/cd95bbcace8f654401862748df5158f0f77be0d6)**",
    "created_at": "2017-12-24T09:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369662",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4c442dc](https://github.com/sagemath/sagetrac-mirror/commit/4c442dc8a9f88811d0208c9d71f65a07162dd961)** to **[cd95bbc](https://github.com/sagemath/sagetrac-mirror/commit/cd95bbcace8f654401862748df5158f0f77be0d6)**



---

archive/issue_comments_369663.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cd95bbcace8f654401862748df5158f0f77be0d6\">cd95bbc</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-24T09:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369663",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:24'>Comment 24:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cd95bbcace8f654401862748df5158f0f77be0d6">cd95bbc</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369664.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59a04410c0b0891d8836fe2f4a712cd21d38fa4d\">59a0441</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-24T09:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369664",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'>Comment 25:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59a04410c0b0891d8836fe2f4a712cd21d38fa4d">59a0441</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369665.json:
```json
{
    "body": "Changed commit from **[cd95bbc](https://github.com/sagemath/sagetrac-mirror/commit/cd95bbcace8f654401862748df5158f0f77be0d6)** to **[59a0441](https://github.com/sagemath/sagetrac-mirror/commit/59a04410c0b0891d8836fe2f4a712cd21d38fa4d)**",
    "created_at": "2017-12-24T09:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369665",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cd95bbc](https://github.com/sagemath/sagetrac-mirror/commit/cd95bbcace8f654401862748df5158f0f77be0d6)** to **[59a0441](https://github.com/sagemath/sagetrac-mirror/commit/59a04410c0b0891d8836fe2f4a712cd21d38fa4d)**



---

archive/issue_events_306893.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-24T09:24:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306893"
}
```



---

archive/issue_comments_369666.json:
```json
{
    "body": "Changed commit from **[59a0441](https://github.com/sagemath/sagetrac-mirror/commit/59a04410c0b0891d8836fe2f4a712cd21d38fa4d)** to **[19e671b](https://github.com/sagemath/sagetrac-mirror/commit/19e671bcea9f0e6dc3b3f3a629a7f64c2bd3795f)**",
    "created_at": "2017-12-24T13:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369666",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[59a0441](https://github.com/sagemath/sagetrac-mirror/commit/59a04410c0b0891d8836fe2f4a712cd21d38fa4d)** to **[19e671b](https://github.com/sagemath/sagetrac-mirror/commit/19e671bcea9f0e6dc3b3f3a629a7f64c2bd3795f)**



---

archive/issue_comments_369667.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19e671bcea9f0e6dc3b3f3a629a7f64c2bd3795f\">19e671b</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-24T13:52:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369667",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:27'>Comment 27:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19e671bcea9f0e6dc3b3f3a629a7f64c2bd3795f">19e671b</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369668.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nIsn't `__pow__` just a right action, by either `ZZ` or `RR`?",
    "created_at": "2017-12-25T02:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369668",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:28'>Comment 28:</a>
Isn't `__pow__` just a right action, by either `ZZ` or `RR`?



---

archive/issue_comments_369669.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@nbruin](#comment%3A28):\n> Isn't `__pow__` just a right action, by either `ZZ` or `RR`?\n\nIt could be an action. But I don't really understand what you are trying to say.\n\nAre you saying that it should be an action?\n\nAre you saying that there *should not* be a special method like `_pow_int`?\n\n(Note that these are two independent questions)",
    "created_at": "2017-12-25T09:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369669",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@nbruin](#comment%3A28):
> Isn't `__pow__` just a right action, by either `ZZ` or `RR`?

It could be an action. But I don't really understand what you are trying to say.

Are you saying that it should be an action?

Are you saying that there *should not* be a special method like `_pow_int`?

(Note that these are two independent questions)



---

archive/issue_comments_369670.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nI was really just wondering if there would be a benefit to treating it as an action. There may be other hooks that are already available in the coercion framework, but the standard binary operation code tries (if I recall correctly) to find a *common* parent, and that's not the right thing to do for powering in general. Actions, on the other hand, should come pretty close. I have no feeling for the performance implications, though. I just raised the point because a brief scanning through the contributions here didn't seem to have considered this possibility.\n\nFor `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.",
    "created_at": "2017-12-25T19:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369670",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:30'>Comment 30:</a>
I was really just wondering if there would be a benefit to treating it as an action. There may be other hooks that are already available in the coercion framework, but the standard binary operation code tries (if I recall correctly) to find a *common* parent, and that's not the right thing to do for powering in general. Actions, on the other hand, should come pretty close. I have no feeling for the performance implications, though. I just raised the point because a brief scanning through the contributions here didn't seem to have considered this possibility.

For `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.



---

archive/issue_comments_369671.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nReplying to [@nbruin](#comment%3A30):\n> For `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.\n\nOK good. So we are just talking about the code which calls this method.",
    "created_at": "2017-12-26T10:47:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369671",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>Comment 31:</a>
Replying to [@nbruin](#comment%3A30):
> For `_pow_int`: given the various powering strategies that exist for different types of rings (square-multiply, frobenius, power series expansion), my guess is that it's worth having a hook for it.

OK good. So we are just talking about the code which calls this method.



---

archive/issue_comments_369672.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nClose to the arguments in [comment:30](#comment%3A30), I am not sure that finding a common parent is a good solution to handle powerings. The only reasonable assumption that could be done with powering is `(x<sup>a)</sup>b = x^(a*b)` (that is: it is a multiplicative action).\n\nAlso, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?  With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence\n\n```\nsage: 4**(1/2)\n2\nsage: type(_)\n<type 'sage.rings.rational.Rational'>\nsage: 3**(1/2)\nsqrt(3)\nsage: type(_)\n<type 'sage.symbolic.expression.Expression'>\n```\nNote also that `x^a * y^a = (x*y)^a` is wrong with rational exponents has often there is a **choice** of a root\n\n```\nsage: ((-1)^(1/3))^3\n-1\nsage: ((-1)^3)^(1/3)\n(-1)^(1/3)\n```",
    "created_at": "2017-12-26T16:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369672",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'>Comment 32:</a>
Close to the arguments in [comment:30](#comment%3A30), I am not sure that finding a common parent is a good solution to handle powerings. The only reasonable assumption that could be done with powering is `(x<sup>a)</sup>b = x^(a*b)` (that is: it is a multiplicative action).

Also, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?  With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence

```
sage: 4**(1/2)
2
sage: type(_)
<type 'sage.rings.rational.Rational'>
sage: 3**(1/2)
sqrt(3)
sage: type(_)
<type 'sage.symbolic.expression.Expression'>
```
Note also that `x^a * y^a = (x*y)^a` is wrong with rational exponents has often there is a **choice** of a root

```
sage: ((-1)^(1/3))^3
-1
sage: ((-1)^3)^(1/3)
(-1)^(1/3)
```



---

archive/issue_comments_369673.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nReplying to [@videlec](#comment%3A32):\n> Also, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?\n\nYes, on anything with a real or complex analytic structure one probably wants that `x^y` is a shorthand for `exp(log(x)*y)` (although for serious use the latter is much better for understanding subtleties arising from multi-valuedness)\n\nIt does look like we might want to handle powering action by integers (no multi-valuedness problem, but may need existence or adjunction of inverses), by rationals, by appropriate completions of rationals as different actions, because of their different problems.\n\nIn principle, on a commutative multiplicative group of exponent `N` we'd even have a powering action by `ZZ/N ZZ`. I'm not so sure it's worth supporting that explicitly, though.",
    "created_at": "2017-12-27T19:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369673",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:33'>Comment 33:</a>
Replying to [@videlec](#comment%3A32):
> Also, the command `QQbar.gen()^(1/3)` should not try to coerce `1/3` to `QQbar`. Rational, as integers, should definitely be treated apart. Though, do we have any concrete case where exponents can be something else than integer/rational?

Yes, on anything with a real or complex analytic structure one probably wants that `x^y` is a shorthand for `exp(log(x)*y)` (although for serious use the latter is much better for understanding subtleties arising from multi-valuedness)

It does look like we might want to handle powering action by integers (no multi-valuedness problem, but may need existence or adjunction of inverses), by rationals, by appropriate completions of rationals as different actions, because of their different problems.

In principle, on a commutative multiplicative group of exponent `N` we'd even have a powering action by `ZZ/N ZZ`. I'm not so sure it's worth supporting that explicitly, though.



---

archive/issue_comments_369674.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nA lot of points are raised here.\n\nFirst of all, the point of this ticket is *making possible* various ways of implementing powering in various parents, not to actually implement it that way. For example, I don't plan to re-implement powering for `QQbar` in this ticket. What is within the scope of this ticket is *making it possible* to implement a parent which treats powering by rationals in a specific way (by going through the coercion model which checks for actions and this `QQbar^QQ` powering should be an action).\n\nSecond, I do agree that powering by integers is special enough that there should be a default action (as suggested by Nils) which calls the special method `_pow_int`.\n\nThird, I think that coercing to a common parent does make sense because:\n\n1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.\n\n2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.\n\n3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?",
    "created_at": "2017-12-27T20:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369674",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>Comment 34:</a>
A lot of points are raised here.

First of all, the point of this ticket is *making possible* various ways of implementing powering in various parents, not to actually implement it that way. For example, I don't plan to re-implement powering for `QQbar` in this ticket. What is within the scope of this ticket is *making it possible* to implement a parent which treats powering by rationals in a specific way (by going through the coercion model which checks for actions and this `QQbar^QQ` powering should be an action).

Second, I do agree that powering by integers is special enough that there should be a default action (as suggested by Nils) which calls the special method `_pow_int`.

Third, I think that coercing to a common parent does make sense because:

1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.

2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.

3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?



---

archive/issue_comments_369675.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nReplying to [@videlec](#comment%3A32):\n> With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence\n> \n> ```\n> sage: 4**(1/2)\n> 2\n> sage: type(_)\n> <type 'sage.rings.rational.Rational'>\n> sage: 3**(1/2)\n> sqrt(3)\n> sage: type(_)\n> <type 'sage.symbolic.expression.Expression'>\n> ```\n\nSorry, but that is a question about the implementation of powering for a specific parent, so not within the scope of this ticket.",
    "created_at": "2017-12-27T20:40:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369675",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>Comment 35:</a>
Replying to [@videlec](#comment%3A32):
> With respect to rational powering, this ticket raises an important question: what should be done with this coercion incoherence
> 
> ```
> sage: 4**(1/2)
> 2
> sage: type(_)
> <type 'sage.rings.rational.Rational'>
> sage: 3**(1/2)
> sqrt(3)
> sage: type(_)
> <type 'sage.symbolic.expression.Expression'>
> ```

Sorry, but that is a question about the implementation of powering for a specific parent, so not within the scope of this ticket.



---

archive/issue_comments_369676.json:
```json
{
    "body": "Changed commit from **[19e671b](https://github.com/sagemath/sagetrac-mirror/commit/19e671bcea9f0e6dc3b3f3a629a7f64c2bd3795f)** to **[5b14356](https://github.com/sagemath/sagetrac-mirror/commit/5b1435647c0d84a2a086afaa82e6359e77838b89)**",
    "created_at": "2017-12-30T18:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369676",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[19e671b](https://github.com/sagemath/sagetrac-mirror/commit/19e671bcea9f0e6dc3b3f3a629a7f64c2bd3795f)** to **[5b14356](https://github.com/sagemath/sagetrac-mirror/commit/5b1435647c0d84a2a086afaa82e6359e77838b89)**



---

archive/issue_comments_369677.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d61f9ea30608521b19f1960cfeba9ace61adb51f\">d61f9ea</a></td><td><code>BruhatTitsTree.lift: bail out if matrix is not invertible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d6c831f39eb93b22d13ac564ff9a0b8b09cdc3c\">5d6c831</a></td><td><code>New abstract base class IntegerAction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b1435647c0d84a2a086afaa82e6359e77838b89\">5b14356</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2017-12-30T18:00:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369677",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>Comment 36:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d61f9ea30608521b19f1960cfeba9ace61adb51f">d61f9ea</a></td><td><code>BruhatTitsTree.lift: bail out if matrix is not invertible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d6c831f39eb93b22d13ac564ff9a0b8b09cdc3c">5d6c831</a></td><td><code>New abstract base class IntegerAction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b1435647c0d84a2a086afaa82e6359e77838b89">5b14356</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369678.json:
```json
{
    "body": "Dependencies: **#24450**",
    "created_at": "2017-12-30T18:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369678",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#24450**



---

archive/issue_events_306894.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-30T18:05:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306894"
}
```



---

archive/issue_events_306895.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-30T18:05:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306895"
}
```



---

archive/issue_events_306896.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-30T18:05:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306896"
}
```



---

archive/issue_events_306897.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-30T18:05:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306897"
}
```



---

archive/issue_comments_369679.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/56f2a64fbc0fde6698303bd93b53220c196d7677\">56f2a64</a></td><td><code>New abstract base class IntegerAction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/186f2b88e64401027b9f347061afc0d8632ab345\">186f2b8</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-01T18:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369679",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:39'>Comment 39:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/56f2a64fbc0fde6698303bd93b53220c196d7677">56f2a64</a></td><td><code>New abstract base class IntegerAction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/186f2b88e64401027b9f347061afc0d8632ab345">186f2b8</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369680.json:
```json
{
    "body": "Changed commit from **[5b14356](https://github.com/sagemath/sagetrac-mirror/commit/5b1435647c0d84a2a086afaa82e6359e77838b89)** to **[186f2b8](https://github.com/sagemath/sagetrac-mirror/commit/186f2b88e64401027b9f347061afc0d8632ab345)**",
    "created_at": "2018-01-01T18:48:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369680",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5b14356](https://github.com/sagemath/sagetrac-mirror/commit/5b1435647c0d84a2a086afaa82e6359e77838b89)** to **[186f2b8](https://github.com/sagemath/sagetrac-mirror/commit/186f2b88e64401027b9f347061afc0d8632ab345)**



---

archive/issue_comments_369681.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4443adfe47245fc5c3caf323176780e8a17197d8\">4443adf</a></td><td><code>New abstract base class IntegerAction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec64a0e098309f31d6dc3e1181ccbc989ea6e1f4\">ec64a0e</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-02T17:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369681",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:40'>Comment 40:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4443adfe47245fc5c3caf323176780e8a17197d8">4443adf</a></td><td><code>New abstract base class IntegerAction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec64a0e098309f31d6dc3e1181ccbc989ea6e1f4">ec64a0e</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369682.json:
```json
{
    "body": "Changed commit from **[186f2b8](https://github.com/sagemath/sagetrac-mirror/commit/186f2b88e64401027b9f347061afc0d8632ab345)** to **[ec64a0e](https://github.com/sagemath/sagetrac-mirror/commit/ec64a0e098309f31d6dc3e1181ccbc989ea6e1f4)**",
    "created_at": "2018-01-02T17:50:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369682",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[186f2b8](https://github.com/sagemath/sagetrac-mirror/commit/186f2b88e64401027b9f347061afc0d8632ab345)** to **[ec64a0e](https://github.com/sagemath/sagetrac-mirror/commit/ec64a0e098309f31d6dc3e1181ccbc989ea6e1f4)**



---

archive/issue_comments_369683.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2a59b900c81749b29c3eca97c88fead8aac98dc\">f2a59b9</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-03T11:42:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369683",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:41'>Comment 41:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2a59b900c81749b29c3eca97c88fead8aac98dc">f2a59b9</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369684.json:
```json
{
    "body": "Changed commit from **[ec64a0e](https://github.com/sagemath/sagetrac-mirror/commit/ec64a0e098309f31d6dc3e1181ccbc989ea6e1f4)** to **[f2a59b9](https://github.com/sagemath/sagetrac-mirror/commit/f2a59b900c81749b29c3eca97c88fead8aac98dc)**",
    "created_at": "2018-01-03T11:42:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369684",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ec64a0e](https://github.com/sagemath/sagetrac-mirror/commit/ec64a0e098309f31d6dc3e1181ccbc989ea6e1f4)** to **[f2a59b9](https://github.com/sagemath/sagetrac-mirror/commit/f2a59b900c81749b29c3eca97c88fead8aac98dc)**



---

archive/issue_comments_369685.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85cabe71cb8a3f034b99a71e65c5329b79c2a8b7\">85cabe7</a></td><td><code>Refactor IntegerMulAction</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/457bd56ec78916fb73c17baad7af93b59ab25b56\">457bd56</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-03T16:54:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369685",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:42'>Comment 42:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85cabe71cb8a3f034b99a71e65c5329b79c2a8b7">85cabe7</a></td><td><code>Refactor IntegerMulAction</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/457bd56ec78916fb73c17baad7af93b59ab25b56">457bd56</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369686.json:
```json
{
    "body": "Changed commit from **[f2a59b9](https://github.com/sagemath/sagetrac-mirror/commit/f2a59b900c81749b29c3eca97c88fead8aac98dc)** to **[457bd56](https://github.com/sagemath/sagetrac-mirror/commit/457bd56ec78916fb73c17baad7af93b59ab25b56)**",
    "created_at": "2018-01-03T16:54:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369686",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f2a59b9](https://github.com/sagemath/sagetrac-mirror/commit/f2a59b900c81749b29c3eca97c88fead8aac98dc)** to **[457bd56](https://github.com/sagemath/sagetrac-mirror/commit/457bd56ec78916fb73c17baad7af93b59ab25b56)**



---

archive/issue_comments_369687.json:
```json
{
    "body": "Changed dependencies from **#24450** to **#24467**",
    "created_at": "2018-01-03T16:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369687",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#24450** to **#24467**



---

archive/issue_comments_369688.json:
```json
{
    "body": "Changed commit from **[457bd56](https://github.com/sagemath/sagetrac-mirror/commit/457bd56ec78916fb73c17baad7af93b59ab25b56)** to **[c5b1be1](https://github.com/sagemath/sagetrac-mirror/commit/c5b1be1372141cf3447ea4c28208b60aeaa3ae03)**",
    "created_at": "2018-01-04T16:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369688",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[457bd56](https://github.com/sagemath/sagetrac-mirror/commit/457bd56ec78916fb73c17baad7af93b59ab25b56)** to **[c5b1be1](https://github.com/sagemath/sagetrac-mirror/commit/c5b1be1372141cf3447ea4c28208b60aeaa3ae03)**



---

archive/issue_comments_369689.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5b1be1372141cf3447ea4c28208b60aeaa3ae03\">c5b1be1</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-04T16:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369689",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:44'>Comment 44:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5b1be1372141cf3447ea4c28208b60aeaa3ae03">c5b1be1</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_events_306898.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-04T16:41:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306898"
}
```



---

archive/issue_events_306899.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-04T16:41:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306899"
}
```



---

archive/issue_comments_369690.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,18 @@\n-`__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.\n+We implement powering in the coercion model. One important difference between powering and other operators is that the most common use case for powering is powering something to an integer exponent.\n \n-To solve this, we essentially do as follows:\n+To deal with this integer powering, we implement an action `IntegerPowAction`. This action calls a special method `_pow_int()` on the element. In other words, `x ^ n` for an integer `n` becomes `x._pow_int(n)`. We also provide a default implementation of `_pow_int` for `MonoidElement` and `RingElement` which uses the square-and-multiply algorithm implemented in `generic_power()`.\n \n-1. If the arguments have equal parents, call `_pow_`.\n+For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here.\n \n-2. If the exponent is \"integer-like\", call `_pow_int`.\n+Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.\n \n-3. If none of the above applies, do the usual coercion to a common parent. That will call `_pow_` unless the coerced arguments have a custom implementation of `__pow__`.\n+Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.\n \n-Furthermore, the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.\n+We also fix various serious bugs in powering for `RDF` such as:\n \n-This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.\n+```\n+sage: RDF(0) ^ RDF(-1)\n+0.0\n+sage: RDF(-1) ^ RDF(2)\n+NaN\n+```\n``````\n",
    "created_at": "2018-01-04T16:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369690",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,18 @@
-`__pow__` is harder than most other arithmetic coercions because you sometimes want the exponent to be an integer and sometimes you want full coercion.
+We implement powering in the coercion model. One important difference between powering and other operators is that the most common use case for powering is powering something to an integer exponent.
 
-To solve this, we essentially do as follows:
+To deal with this integer powering, we implement an action `IntegerPowAction`. This action calls a special method `_pow_int()` on the element. In other words, `x ^ n` for an integer `n` becomes `x._pow_int(n)`. We also provide a default implementation of `_pow_int` for `MonoidElement` and `RingElement` which uses the square-and-multiply algorithm implemented in `generic_power()`.
 
-1. If the arguments have equal parents, call `_pow_`.
+For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here.
 
-2. If the exponent is "integer-like", call `_pow_int`.
+Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.
 
-3. If none of the above applies, do the usual coercion to a common parent. That will call `_pow_` unless the coerced arguments have a custom implementation of `__pow__`.
+Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.
 
-Furthermore, the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.
+We also fix various serious bugs in powering for `RDF` such as:
 
-This is related to Python 3 (see #16072) because this check for an integer needs to be changed in light of the changes to the `int`/`long` types.
+```
+sage: RDF(0) ^ RDF(-1)
+0.0
+sage: RDF(-1) ^ RDF(2)
+NaN
+```
``````




---

archive/issue_comments_369691.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2d60efa250eb7806f67f313738d67b3288577d3\">a2d60ef</a></td><td><code>Also verify IntegerAction instances</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a3bd034ff7236457414f11bfe33682fd0bb32ef\">3a3bd03</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>\n",
    "created_at": "2018-01-08T09:15:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369691",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:46'>Comment 46:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2d60efa250eb7806f67f313738d67b3288577d3">a2d60ef</a></td><td><code>Also verify IntegerAction instances</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a3bd034ff7236457414f11bfe33682fd0bb32ef">3a3bd03</a></td><td><code>Implement `__pow__` in the coercion model</code></td></tr></table>




---

archive/issue_comments_369692.json:
```json
{
    "body": "Changed commit from **[c5b1be1](https://github.com/sagemath/sagetrac-mirror/commit/c5b1be1372141cf3447ea4c28208b60aeaa3ae03)** to **[3a3bd03](https://github.com/sagemath/sagetrac-mirror/commit/3a3bd034ff7236457414f11bfe33682fd0bb32ef)**",
    "created_at": "2018-01-08T09:15:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369692",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c5b1be1](https://github.com/sagemath/sagetrac-mirror/commit/c5b1be1372141cf3447ea4c28208b60aeaa3ae03)** to **[3a3bd03](https://github.com/sagemath/sagetrac-mirror/commit/3a3bd034ff7236457414f11bfe33682fd0bb32ef)**



---

archive/issue_comments_369693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n To deal with this integer powering, we implement an action `IntegerPowAction`. This action calls a special method `_pow_int()` on the element. In other words, `x ^ n` for an integer `n` becomes `x._pow_int(n)`. We also provide a default implementation of `_pow_int` for `MonoidElement` and `RingElement` which uses the square-and-multiply algorithm implemented in `generic_power()`.\n \n-For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here.\n+For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here, see #15709.\n \n Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.\n \n``````\n",
    "created_at": "2018-01-08T09:15:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369693",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 To deal with this integer powering, we implement an action `IntegerPowAction`. This action calls a special method `_pow_int()` on the element. In other words, `x ^ n` for an integer `n` becomes `x._pow_int(n)`. We also provide a default implementation of `_pow_int` for `MonoidElement` and `RingElement` which uses the square-and-multiply algorithm implemented in `generic_power()`.
 
-For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here.
+For backward compatibility reasons, we also call this action for elements of `IntegerModRing(m)`. In the future, we may rethink what to do here, see #15709.
 
 Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.
 
``````




---

archive/issue_comments_369694.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,9 +6,9 @@\n \n Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.\n \n-Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.\n+Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it. See also #5082.\n \n-We also fix various serious bugs in powering for `RDF` such as:\n+Fixing powering for specific parents is not within the scope of this ticket, except where it was needed to fix doctest failures. For example, we fix various serious bugs in powering for `RDF` such as:\n \n ```\n sage: RDF(0) ^ RDF(-1)\n``````\n",
    "created_at": "2018-01-08T09:18:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369694",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,9 +6,9 @@
 
 Apart from this, powering behaves like other binary operators: coercion to a common parent is done if no action is defined.
 
-Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it.
+Note that the 3-argument version of `pow()` is not supported in the coercion model. Only specific types like `Integer` implement it. See also #5082.
 
-We also fix various serious bugs in powering for `RDF` such as:
+Fixing powering for specific parents is not within the scope of this ticket, except where it was needed to fix doctest failures. For example, we fix various serious bugs in powering for `RDF` such as:
 
 ```
 sage: RDF(0) ^ RDF(-1)
``````




---

archive/issue_comments_369695.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nI am not sure I agree with this change:\n\n```diff\n@@ -2015,8 +2003,8 @@ cdef class Integer(sage.structure.element.EuclideanDomainElement):\n \n         TESTS::\n \n-            sage: complex(0,1)^2\n-            (-1+0j)\n+            sage: complex(0,1) ^ 2\n+            -1.0\n             sage: R.<t> = QQ[]\n             sage: 2^t\n             Traceback (most recent call last):\n```\nIn Python, we have\n\n```\n>>> complex(0,1)**2\n(-1+0j)\n```\nand generally, I think `x^2` should be the same as `x * x`. In this case, they are equal, but they are different types. While `complex` has all of the methods that `float` has, it is surprising to me that we do not get a `complex` result (in particular, since I thought it was suppose to be considered as an action). Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?\n\nFor those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef` (see `Integer` and `RealDoubleElement`)? Or is the declaration in `ModuleElement` sufficient (but then why for its subclass `RingElement`)?\n\nHave you looked at timings? I think this is almost certainly the way forward, but I am worried about how much of a speed regression this might have on taking integer exponentiation of, e.g., polynomials. (At least something I do in my research is combinatorial generating functions: `sum(q^s(b) for b in B)` for some set `B` and statistic `s`.)",
    "created_at": "2018-01-08T16:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369695",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:49'>Comment 49:</a>
I am not sure I agree with this change:

```diff
@@ -2015,8 +2003,8 @@ cdef class Integer(sage.structure.element.EuclideanDomainElement):
 
         TESTS::
 
-            sage: complex(0,1)^2
-            (-1+0j)
+            sage: complex(0,1) ^ 2
+            -1.0
             sage: R.<t> = QQ[]
             sage: 2^t
             Traceback (most recent call last):
```
In Python, we have

```
>>> complex(0,1)**2
(-1+0j)
```
and generally, I think `x^2` should be the same as `x * x`. In this case, they are equal, but they are different types. While `complex` has all of the methods that `float` has, it is surprising to me that we do not get a `complex` result (in particular, since I thought it was suppose to be considered as an action). Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?

For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef` (see `Integer` and `RealDoubleElement`)? Or is the declaration in `ModuleElement` sufficient (but then why for its subclass `RingElement`)?

Have you looked at timings? I think this is almost certainly the way forward, but I am worried about how much of a speed regression this might have on taking integer exponentiation of, e.g., polynomials. (At least something I do in my research is combinatorial generating functions: `sum(q^s(b) for b in B)` for some set `B` and statistic `s`.)



---

archive/issue_comments_369696.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nReplying to [@tscrim](#comment%3A49):\n> I am not sure I agree with this change:\n> \n> ```diff\n> @@ -2015,8 +2003,8 @@ cdef class Integer(sage.structure.element.EuclideanDomainElement):\n>  \n>          TESTS::\n>  \n> -            sage: complex(0,1)^2\n> -            (-1+0j)\n> +            sage: complex(0,1) ^ 2\n> +            -1.0\n>              sage: R.<t> = QQ[]\n>              sage: 2^t\n>              Traceback (most recent call last):\n> ```\n\nI thought that any operation between a Python type and a Sage parent should coerce everything to Sage. But it seems that this is not done consistently:\n\n```\nsage: parent(float(1) + 1)\n<type 'float'>\n```\n\nFor `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.\n\n> Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?\n\nWhat do you mean here? That wouldn't use any Sage code.",
    "created_at": "2018-01-08T18:26:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369696",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'>Comment 50:</a>
Replying to [@tscrim](#comment%3A49):
> I am not sure I agree with this change:
> 
> ```diff
> @@ -2015,8 +2003,8 @@ cdef class Integer(sage.structure.element.EuclideanDomainElement):
>  
>          TESTS::
>  
> -            sage: complex(0,1)^2
> -            (-1+0j)
> +            sage: complex(0,1) ^ 2
> +            -1.0
>              sage: R.<t> = QQ[]
>              sage: 2^t
>              Traceback (most recent call last):
> ```

I thought that any operation between a Python type and a Sage parent should coerce everything to Sage. But it seems that this is not done consistently:

```
sage: parent(float(1) + 1)
<type 'float'>
```

For `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.

> Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?

What do you mean here? That wouldn't use any Sage code.



---

archive/issue_comments_369697.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nReplying to [@tscrim](#comment%3A49):\n> For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`\n\nIf it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.\n\n> Or is the declaration in `ModuleElement` sufficient\n\nI guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.",
    "created_at": "2018-01-08T18:29:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369697",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'>Comment 51:</a>
Replying to [@tscrim](#comment%3A49):
> For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`

If it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.

> Or is the declaration in `ModuleElement` sufficient

I guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.



---

archive/issue_comments_369698.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nReplying to [@jdemeyer](#comment%3A50):\n> Replying to [@tscrim](#comment%3A49):\n> I thought that any operation between a Python type and a Sage parent should coerce everything to Sage.\n\nI wasn't aware that this was a policy, but I usually don't think too much about Python types.\n\n> But it seems that this is not done consistently:\n> \n> ```\n> sage: parent(float(1) + 1)\n> <type 'float'>\n> ```\n\nWe probably haven't yet implemented the hooks for floats yet.\n\n> For `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.\n\n`CDF` would be a good target. Whatever we decide, we should add the parent as part of the test.\n\n> > Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?\n\n> \n> What do you mean here? That wouldn't use any Sage code.\n\nAh, right, the coercion model should not be called, and we run into similar sort of discrepancies when doing things like `1 / 2` in a `.py` file.",
    "created_at": "2018-01-08T22:04:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369698",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:52'>Comment 52:</a>
Replying to [@jdemeyer](#comment%3A50):
> Replying to [@tscrim](#comment%3A49):
> I thought that any operation between a Python type and a Sage parent should coerce everything to Sage.

I wasn't aware that this was a policy, but I usually don't think too much about Python types.

> But it seems that this is not done consistently:
> 
> ```
> sage: parent(float(1) + 1)
> <type 'float'>
> ```

We probably haven't yet implemented the hooks for floats yet.

> For `complex ^ ZZ`, I think that `CDF` also makes sense as an answer: the Sage coercion model replaces `complex` by `CDF` and then does the powering `CDF ^ ZZ`. However, I understand why you would want it to return a `complex`. I'll think about this.

`CDF` would be a good target. Whatever we decide, we should add the parent as part of the test.

> > Also, can we add a test to check that `complex(0,1) ^ int(2)` is consistent?

> 
> What do you mean here? That wouldn't use any Sage code.

Ah, right, the coercion model should not be called, and we run into similar sort of discrepancies when doing things like `1 / 2` in a `.py` file.



---

archive/issue_comments_369699.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nReplying to [@jdemeyer](#comment%3A51):\n> Replying to [@tscrim](#comment%3A49):\n> > For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`\n\n> \n> If it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.\n\nThen why do you add it for `Expression`?\n\n> > Or is the declaration in `ModuleElement` sufficient\n\n> \n> I guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.\n\nWhoops, yes I do.",
    "created_at": "2018-01-08T22:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369699",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:53'>Comment 53:</a>
Replying to [@jdemeyer](#comment%3A51):
> Replying to [@tscrim](#comment%3A49):
> > For those Cython classes defining a `cpdef _pow_int`, do you need to declare that in the `.pxd` file since you are overwriting a `cdef` with a `cpdef`

> 
> If it inherits directly from `Element` (not `ModuleElement` or `MonoidElement`), then yes.

Then why do you add it for `Expression`?

> > Or is the declaration in `ModuleElement` sufficient

> 
> I guess you mean `MonoidElement` or `RingElement`. But yes, that is sufficient.

Whoops, yes I do.



---

archive/issue_events_306900.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T08:24:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306900"
}
```



---

archive/issue_events_306901.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T08:24:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306901"
}
```



---

archive/issue_comments_369700.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nReplying to [@tscrim](#comment%3A52):\n> I wasn't aware that this was a policy, but I usually don't think too much about Python types.\n\nNow I don't think that there is such a policy either. I *thought* that was such a policy so I *thought* that `CDF` would be the correct parent for `float ^ ZZ`. But I can easily fix that to return a `float` instead, so let's do that.",
    "created_at": "2018-01-09T08:24:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369700",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:54'>Comment 54:</a>
Replying to [@tscrim](#comment%3A52):
> I wasn't aware that this was a policy, but I usually don't think too much about Python types.

Now I don't think that there is such a policy either. I *thought* that was such a policy so I *thought* that `CDF` would be the correct parent for `float ^ ZZ`. But I can easily fix that to return a `float` instead, so let's do that.



---

archive/issue_comments_369701.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nReplying to [@tscrim](#comment%3A53):\n> Then why do you add it for `Expression`?\n\nNo particular reason. Maybe I needed to add it at some point during the development of this ticket. I'll remove it. The `_pow_` needs to stay though since there is no default implementation.",
    "created_at": "2018-01-09T08:26:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369701",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'>Comment 55:</a>
Replying to [@tscrim](#comment%3A53):
> Then why do you add it for `Expression`?

No particular reason. Maybe I needed to add it at some point during the development of this ticket. I'll remove it. The `_pow_` needs to stay though since there is no default implementation.



---

archive/issue_comments_369702.json:
```json
{
    "body": "Changed commit from **[3a3bd03](https://github.com/sagemath/sagetrac-mirror/commit/3a3bd034ff7236457414f11bfe33682fd0bb32ef)** to **[922717d](https://github.com/sagemath/sagetrac-mirror/commit/922717d473c74d5c2fee57ca481c575168ae0739)**",
    "created_at": "2018-01-09T10:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369702",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3a3bd03](https://github.com/sagemath/sagetrac-mirror/commit/3a3bd034ff7236457414f11bfe33682fd0bb32ef)** to **[922717d](https://github.com/sagemath/sagetrac-mirror/commit/922717d473c74d5c2fee57ca481c575168ae0739)**



---

archive/issue_comments_369703.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/922717d473c74d5c2fee57ca481c575168ae0739\">922717d</a></td><td><code>Further fixes for __pow__</code></td></tr></table>\n",
    "created_at": "2018-01-09T10:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369703",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:56'>Comment 56:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/922717d473c74d5c2fee57ca481c575168ae0739">922717d</a></td><td><code>Further fixes for __pow__</code></td></tr></table>




---

archive/issue_events_306902.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T10:23:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306902"
}
```



---

archive/issue_events_306903.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T10:23:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306903"
}
```



---

archive/issue_comments_369704.json:
```json
{
    "body": "<a id='comment:58'>Comment 58:</a>\nReplying to [@tscrim](#comment%3A49):\n> In Python, we have\n> \n> ```\n> >>> complex(0,1)**2\n> (-1+0j)\n> ```\n\nIn the latest commit, I fixed this: now a non-`Element` raised to a `ZZ` power will do the powering with an `int` exponent instead. For consistency, I did this for all base types, such that `int(3) ^ (-3)` now returns a `float` instead of a `QQ` element.",
    "created_at": "2018-01-09T10:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369704",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:58'>Comment 58:</a>
Replying to [@tscrim](#comment%3A49):
> In Python, we have
> 
> ```
> >>> complex(0,1)**2
> (-1+0j)
> ```

In the latest commit, I fixed this: now a non-`Element` raised to a `ZZ` power will do the powering with an `int` exponent instead. For consistency, I did this for all base types, such that `int(3) ^ (-3)` now returns a `float` instead of a `QQ` element.



---

archive/issue_events_306904.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T13:05:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306904"
}
```



---

archive/issue_events_306905.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T13:05:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306905"
}
```



---

archive/issue_comments_369705.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nThe recent change seems to have introduced various doctest failures.",
    "created_at": "2018-01-09T13:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369705",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'>Comment 59:</a>
The recent change seems to have introduced various doctest failures.



---

archive/issue_comments_369706.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66\">74d6700</a></td><td><code>Further fixes for __pow__</code></td></tr></table>\n",
    "created_at": "2018-01-09T13:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369706",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:60'>Comment 60:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66">74d6700</a></td><td><code>Further fixes for __pow__</code></td></tr></table>




---

archive/issue_comments_369707.json:
```json
{
    "body": "Changed commit from **[922717d](https://github.com/sagemath/sagetrac-mirror/commit/922717d473c74d5c2fee57ca481c575168ae0739)** to **[74d6700](https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66)**",
    "created_at": "2018-01-09T13:53:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369707",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[922717d](https://github.com/sagemath/sagetrac-mirror/commit/922717d473c74d5c2fee57ca481c575168ae0739)** to **[74d6700](https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66)**



---

archive/issue_events_306906.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T13:53:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306906"
}
```



---

archive/issue_events_306907.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-09T13:53:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306907"
}
```



---

archive/issue_comments_369708.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nReplying to [@tscrim](#comment%3A49):\n> Have you looked at timings?\n\nFirst of all, it is important to state that this ticket only changes powering for certain parents. It allows to implement powering using the coercion model, but many parents with a custom `__pow__` still have that custom `__pow__` after applying this ticket and won't use the coercion model. This is case for polynomials for example. So we only look at a few parents where the powering actually uses the new code.\n\nNow the timings. The conclusion seems to be that powering for equal parents is slightly faster than before but that powering with non-equal parents is slower than before. This is because the latter goes through the coercion model now.\n\n**ZZ<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 122 ns per loop\n```\n\nAfter:\n\n```\nsage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 110 ns per loop\n```\n\n**GF(2<sup>n</sup>)<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 377 ns per loop\n```\n\nAfter:\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 607 ns per loop\n```\n\n**RDF<sup>RDF</sup>**\n\nBefore:\n\n```\nsage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 139 ns per loop\n```\n\nAfter:\n\n```\nsage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 132 ns per loop\n```\n\n**RDF<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 156 ns per loop\n```\n\nAfter:\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 240 ns per loop\n```\n\n**ideal<sup>ZZ</sup>**\n\nBefore:\n\n```\nsage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)\n10000 loops, best of 20: 13.2 \u00b5s per loop\n```\n\nAfter:\n\n```\nsage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)\n10000 loops, best of 20: 14.6 \u00b5s per loop\n```",
    "created_at": "2018-01-09T14:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369708",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'>Comment 62:</a>
Replying to [@tscrim](#comment%3A49):
> Have you looked at timings?

First of all, it is important to state that this ticket only changes powering for certain parents. It allows to implement powering using the coercion model, but many parents with a custom `__pow__` still have that custom `__pow__` after applying this ticket and won't use the coercion model. This is case for polynomials for example. So we only look at a few parents where the powering actually uses the new code.

Now the timings. The conclusion seems to be that powering for equal parents is slightly faster than before but that powering with non-equal parents is slower than before. This is because the latter goes through the coercion model now.

**ZZ<sup>ZZ</sup>**

Before:

```
sage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 122 ns per loop
```

After:

```
sage: a = ZZ(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 110 ns per loop
```

**GF(2<sup>n</sup>)<sup>ZZ</sup>**

Before:

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 377 ns per loop
```

After:

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 607 ns per loop
```

**RDF<sup>RDF</sup>**

Before:

```
sage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 139 ns per loop
```

After:

```
sage: a = RDF(2); n = RDF(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 132 ns per loop
```

**RDF<sup>ZZ</sup>**

Before:

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 156 ns per loop
```

After:

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 240 ns per loop
```

**ideal<sup>ZZ</sup>**

Before:

```
sage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)
10000 loops, best of 20: 13.2 µs per loop
```

After:

```
sage: a = ZZ.ideal(2); n = ZZ(2); timeit('a ^ n', number=10000, repeat=20)
10000 loops, best of 20: 14.6 µs per loop
```



---

archive/issue_comments_369709.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nPart of the slowdown is caused by `Action.__call__` (see #24500). After optimizing that a bit, I go from\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 607 ns per loop\n```\nto\n\n```\nsage: k.<a> = GF(4, impl=\"ntl\"); n = 2; timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 506 ns per loop\n```\n\nand from\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 240 ns per loop\n```\nto\n\n```\nsage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)\n100000 loops, best of 20: 182 ns per loop\n```",
    "created_at": "2018-01-09T14:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369709",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:63'>Comment 63:</a>
Part of the slowdown is caused by `Action.__call__` (see #24500). After optimizing that a bit, I go from

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 607 ns per loop
```
to

```
sage: k.<a> = GF(4, impl="ntl"); n = 2; timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 506 ns per loop
```

and from

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 240 ns per loop
```
to

```
sage: a = RDF(2); n = ZZ(2); timeit('a ^ n', number=100000, repeat=20)
100000 loops, best of 20: 182 ns per loop
```



---

archive/issue_comments_369710.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nTravis, please let me know what you think of the timings and whether #24500 should be a dependency of this ticket. Personally, I think that #24500 will be non-trivial, so I would rather not make it a dependency.",
    "created_at": "2018-01-09T15:36:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369710",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'>Comment 64:</a>
Travis, please let me know what you think of the timings and whether #24500 should be a dependency of this ticket. Personally, I think that #24500 will be non-trivial, so I would rather not make it a dependency.



---

archive/issue_comments_369711.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nI like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need\n\n```\nApart from this, powering behaves like other binary operators:\ncoercion to a common parent is done if no action is defined. \n```",
    "created_at": "2018-01-09T16:15:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369711",
    "user": "https://github.com/videlec"
}
```

<a id='comment:65'>Comment 65:</a>
I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need

```
Apart from this, powering behaves like other binary operators:
coercion to a common parent is done if no action is defined. 
```



---

archive/issue_comments_369712.json:
```json
{
    "body": "<a id='comment:66'>Comment 66:</a>\nReplying to [@videlec](#comment%3A65):\n> I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need\n> \n> ```\n> Apart from this, powering behaves like other binary operators:\n> coercion to a common parent is done if no action is defined. \n> ```\n\nCopying from [comment:34]:\n\n\nI think that coercing to a common parent does make sense because:\n\n1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.\n\n2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.\n\n3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?",
    "created_at": "2018-01-09T18:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369712",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:66'>Comment 66:</a>
Replying to [@videlec](#comment%3A65):
> I like very much the idea of moving powering inside the coercion model. Though, it is not a binary operator `X x X -> X` (do you have any example of this beyond `NN` or `RR_+`?). I still don't understand why you would need
> 
> ```
> Apart from this, powering behaves like other binary operators:
> coercion to a common parent is done if no action is defined. 
> ```

Copying from [comment:34]:


I think that coercing to a common parent does make sense because:

1. It is consistent with all other operators. Often multiplication is treated as an action too. Still, when no action is found, coercion to a common parent is done.

2. There are several parents where a common parent for powering makes sense, in particular the various incarnations of real/complex numbers and the symbolic ring.

3. If coercion to a common parent shouldn't be done, then what should be done by default if no action is found?



---

archive/issue_comments_369713.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nThank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower as I would expect exponentiation to be a fairly common operation. For me personally, it is not important, but I know for the number theorist using Sage, it could have a much bigger impact. However, you know that area of math/Sage better than I, so if you think it will be okay, then no objection from me.",
    "created_at": "2018-01-09T20:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369713",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:67'>Comment 67:</a>
Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower as I would expect exponentiation to be a fairly common operation. For me personally, it is not important, but I know for the number theorist using Sage, it could have a much bigger impact. However, you know that area of math/Sage better than I, so if you think it will be okay, then no objection from me.



---

archive/issue_comments_369714.json:
```json
{
    "body": "<a id='comment:68'>Comment 68:</a>\nReplying to [@tscrim](#comment%3A67):\n> Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower\n\nIt's actually only a factor 1.61 slower but that will improve significantly after #24500. Possibly, other optimizations in the coercion model are possible.\n\nIt is also important to note that I intentionally took the worst case of `GF(4)` implemented using NTL. The default implementation for that field size is Givaro, which is not affected by this ticket. Only for `GF(2^16)` and larger is NTL the default and then the cost of the coercion becomes a much smaller fraction of the actual computation.",
    "created_at": "2018-01-10T08:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369714",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:68'>Comment 68:</a>
Replying to [@tscrim](#comment%3A67):
> Thank for the timings and explanation. I am the most concerned with the GF(2<sup>n</sup>)<sup>ZZ</sup> timings being ~2x slower

It's actually only a factor 1.61 slower but that will improve significantly after #24500. Possibly, other optimizations in the coercion model are possible.

It is also important to note that I intentionally took the worst case of `GF(4)` implemented using NTL. The default implementation for that field size is Givaro, which is not affected by this ticket. Only for `GF(2^16)` and larger is NTL the default and then the cost of the coercion becomes a much smaller fraction of the actual computation.



---

archive/issue_comments_369715.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nOkay, then positive review from me.\n\nDoes anyone else have any other objections or questions?",
    "created_at": "2018-01-10T16:55:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369715",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:69'>Comment 69:</a>
Okay, then positive review from me.

Does anyone else have any other objections or questions?



---

archive/issue_comments_369716.json:
```json
{
    "body": "<a id='comment:70'>Comment 70:</a>\nfine for me",
    "created_at": "2018-01-11T08:03:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369716",
    "user": "https://github.com/videlec"
}
```

<a id='comment:70'>Comment 70:</a>
fine for me



---

archive/issue_events_306908.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-11T14:52:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306908"
}
```



---

archive/issue_events_306909.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-11T14:52:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306909"
}
```



---

archive/issue_comments_369717.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw, Vincent Delecroix**",
    "created_at": "2018-01-11T14:52:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369717",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Travis Scrimshaw, Vincent Delecroix**



---

archive/issue_events_306910.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-15T22:29:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306910"
}
```



---

archive/issue_events_306911.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "05825d685620313039ca81e23cee17ea3adccc51",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-15T22:29:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24247#event-306911"
}
```



---

archive/issue_comments_369718.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/implement___pow___in_the_coercion_model](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/implement___pow___in_the_coercion_model)** to **[74d6700](https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66)**",
    "created_at": "2018-01-15T22:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24247#issuecomment-369718",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/implement___pow___in_the_coercion_model](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/implement___pow___in_the_coercion_model)** to **[74d6700](https://github.com/sagemath/sagetrac-mirror/commit/74d67006dfbf205f8bd43d25ef2b4eebf695ae66)**
