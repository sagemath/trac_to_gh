# Issue 24359: Turn MeatAxe into a dynamic library

archive/issues_024122.json:
```json
{
    "body": "Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.\n\nSo, purpose of this ticket: Change MeatAxe from static to dynamic.\n\nUnfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.\n\nTherefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)\n- an autotools build system\n- a shared library\n- a test suite that can be run in parallel and passes `make distcheck`\n- some bug fixes\n- a speedup in echelon computation\n- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.\nAlso it fixes some errors in the documentation.\n\nThe tarball of the fork is available at http://users.minet.uni-jena.de/~king/SharedMeatAxe/shared_meataxe-1.0.tar.gz\n\nThe package documentation is at http://users.minet.uni-jena.de/~king/SharedMeatAxe/\n\nCC:  @jdemeyer\n\nKeywords: meataxe static dynamic\n\nBranch/Commit: 13828d1cb042ce03148d3319bdfecee1ec54862f\n\nUpstream: None of the above - read trac for reasoning.\n\nReviewer: Jeroen Demeyer, Dima Pasechnik\n\nAuthor: Simon King\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24359\n\n",
    "closed_at": "2018-01-06T11:30:50Z",
    "created_at": "2017-12-10T09:37:37Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Turn MeatAxe into a dynamic library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24359",
    "user": "https://github.com/simon-king-jena"
}
```
Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.

So, purpose of this ticket: Change MeatAxe from static to dynamic.

Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.

Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)
- an autotools build system
- a shared library
- a test suite that can be run in parallel and passes `make distcheck`
- some bug fixes
- a speedup in echelon computation
- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.
Also it fixes some errors in the documentation.

The tarball of the fork is available at http://users.minet.uni-jena.de/~king/SharedMeatAxe/shared_meataxe-1.0.tar.gz

The package documentation is at http://users.minet.uni-jena.de/~king/SharedMeatAxe/

CC:  @jdemeyer

Keywords: meataxe static dynamic

Branch/Commit: 13828d1cb042ce03148d3319bdfecee1ec54862f

Upstream: None of the above - read trac for reasoning.

Reviewer: Jeroen Demeyer, Dima Pasechnik

Author: Simon King

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24359





---

archive/issue_comments_359637.json:
```json
{
    "body": "<a id='comment:2'></a>Problems:\n- I have no idea what needs to be changed in MeatAxe's Makefile to build a dynamic library.\n- I have no idea what needs to be changed in MeatAxe's Makefile to link against the newly created dynamic library. Is there a syntactical difference for linking against static resp. dynamic libraries? Or is it just `-lmtx` in both cases?\n- Is it a problem when the static `libmtx.a` is still around from a previous installation of meataxe? I.e., is it needed that `spkg-install` removes `libmtx.a` before creation of the dynamic library?",
    "created_at": "2017-12-10T10:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359637",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Problems:
- I have no idea what needs to be changed in MeatAxe's Makefile to build a dynamic library.
- I have no idea what needs to be changed in MeatAxe's Makefile to link against the newly created dynamic library. Is there a syntactical difference for linking against static resp. dynamic libraries? Or is it just `-lmtx` in both cases?
- Is it a problem when the static `libmtx.a` is still around from a previous installation of meataxe? I.e., is it needed that `spkg-install` removes `libmtx.a` before creation of the dynamic library?



---

archive/issue_comments_359638.json:
```json
{
    "body": "<a id='comment:3'></a>For the record: This is the upstream Makefile\n\n```\ninclude Makefile.conf\n\nCFLAGS=$(CFLAGS1) -Itmp\nLFLAGS=$(LFLAGS1)\n\nPROGRAMS = \\\n  cfcomp checksum chop decomp genmod mkcycl mkdotl mkgraph mkhom mkhom_old\\\n  mkinc mksub mktree orbrep precond pseudochop pwkond rad soc symnew tcond tuc \\\n  zad zbl zcf zcl zcp zct zcv zef zev zfr ziv zkd zmo zmu zmw znu zor zpo zpr \\\n  zpt zqt zro zsc zsi zsp zsy ztc zte ztr zts zuk zvp\n\nall build: $(PROGRAMS:%=bin/%)\n\nclean:\n\trm -rf doc bin tmp\n\tcd test; make clean\n\n\n# ------------------------------------------------------------------------------\n# Compile C sources\n# ------------------------------------------------------------------------------\n\ntmp/%.o: tmp/mk.dir src/%.c src/meataxe.h tmp/config.h\n\t@echo \"Compiling $*.c\"\n\t@$(CC) $(CFLAGS) -c src/$*.c -o $@\n\ntmp/mk.dir:\n\tmkdir -p tmp\n\ttouch $@\n\nbin/mk.dir:\n\tmkdir -p bin\n\ttouch $@\n\n# ------------------------------------------------------------------------------\n# Link programs\n# ------------------------------------------------------------------------------\n\nbin/%: bin/mk.dir tmp/%.o tmp/libmtx.a\n\t@echo \"Linking $@\"\n\t@$(CC) $(LFLAGS) -o $@ tmp/$*.o tmp/libmtx.a\n\n\n# ------------------------------------------------------------------------------\n# Library\n# ------------------------------------------------------------------------------\n\nLIB_OBJS=\\\n\targs berlekmp \\\n\tbsand bscore bsdup bsissub bsmatch bsminus \\\n\tbsop bsor bsprint bsread bswrite \\\n\tcfinfo \\\n\tcharpol chbasis \\\n\terror \\\n\tffio \\\n\tfpcore fpdup fpmul fpmul2 fpprint \\\n\tgcd genseed\\\n\tgrmaprow grmatcore grtable \\\n\thomcomp \\\n\timatcore imatread imatwrite\\\n\tinit intio issub \\\n\tisisom kernel-$(ZZZ) \\\n\tldiag \\\n\tmaddmul mat2vec matadd matclean matcmp \\\n\tmaketabF \\\n\tmatcopy matcore matcut \\\n\tmatdup matech matid matins matinv matmul \\\n\tmatnull matorder \\\n\tmatpivot\\\n\tmatprint matpwr matread mattr mattrace matwrite \\\n\tmessage \\\n\tmfcore mfread mfreadlong mfwrite mfwritelong \\\n\tminpol mkendo\\\n\tmmulscal mraddgen mrcore mrread mrtranspose mrwrite \\\n\tmsclean mscore \\\n\tmtensor mtxobj os \\\n\tpermcmp permcore permdup perminv permmul permorder\\\n\tpermprint permpwr permread permwrite poladd\\\n\tpolcmp polcore polderive poldiv poldup\\\n\tpolgcd polmul polprint polread polwrite \\\n\tquotient random rdcfgen \\\n\tsaction setcore setinsert settest \\\n\tspinup spinup2 \\\n\tsplit stabpwr stfcore \\\n\tstfread stfwrite \\\n\tstring \\\n\tsumint \\\n\ttemap \\\n\ttkinfo vec2mat \\\n\twgen \\\n\tzcleanrow zcmprow zgap zpermrow \\\n\tzzz2 \\\n\tversion\n\ntmp/libmtx.a: $(LIB_OBJS:%=tmp/%.o)\n\t@echo \"Creating $@\"\n\t@rm -f $@\n\t@ar r $@ $(LIB_OBJS:%=tmp/%.o)\n\n\n# ------------------------------------------------------------------------------\n# Test suite\n# ------------------------------------------------------------------------------\n\nTS_OBJS1=c-args c-bitstring c-charpol\\\n\tc-ffio c-fileio c-ffmat c-ffrow c-fpoly \\\n\tc-grease c-kernel c-matins c-matrix c-matset\\\n\tc-os c-perm c-poly c-pseed c-quot c-random \\\n\tc-sets c-stf c-tensor\n\nTS_OBJS=tmp/zzztest.o $(TS_OBJS1:%=tmp/%.o) tmp/libmtx.a\n\nbin/zzztest: bin/mk.dir $(TS_OBJS)\n\t@echo \"Linking $@\"\n\t@$(CC) $(CFLAGS) -o $@ $(TS_OBJS)\n\nbin/checksum: bin/mk.dir tmp/checksum.o\n\t@echo \"Linking $@\"\n\t@$(CC) $(CFLAGS) -o $@ tmp/checksum.o\n\nTESTS=0000\\\n  0100 0100 0105 0106 0107 0108 0109 0110 0111 0112\\\n  0113 0114 0115 0116 0117 0118 0200 0201 0210 0211\\\n  0212 0213 0214 0215\n\ncheck: tmp/zzztest.done $(TESTS:%=tmp/t-%.done)\n\ntmp/zzztest.done: tmp/mk.dir bin/zzztest\n\tcd tmp && ../bin/zzztest\n\ttouch $@\n\ntmp/t-%.done: tmp/mk.dir test/t-% tmp/t.config bin/checksum build\n\t@echo \"t-$* `grep '^#:' test/t-$* | cut -c 3-100`\"\n\t@cd tmp && ../test/t-$*\n\t@touch $@\n\ntmp/t.config: tmp/mk.dir test/config\n\tcp test/config $@\n\n# ------------------------------------------------------------------------------\n# config.h\n# ------------------------------------------------------------------------------\n\ntmp/config.h: tmp/mk.dir Makefile Makefile.conf src/genconfig.c svnversion\n\t@echo \"Generating config.h\"\n\t@$(CC) $(CFLAGS) $(LFLAGS) -o tmp/genconfig src/genconfig.c\n\t@tmp/genconfig >$@\n\n\n\t\n\t\n.PHONY: doc tar clean install check\n.PRECIOUS: tmp/%.o\n\nsvnversion: $(EXPORTED_FILES)\n\tsvnversion >$@ || echo \"UNKNOWN\" >$@\n\n.PHONY: force-svnversion\nforce-svnversion:\n\tsvnversion >svnversion\n\n# ------------------------------------------------------------------------------\n# Documentation\n# ------------------------------------------------------------------------------\n\n.PHONY: doc\n\nrebuild-doc:\n\trm -rf doc\n\tmkdir -p doc\n\tdoxygen etc/Doxyfile >/dev/null\n\ndoc: doc/index.html\n\ndoc/index.html: etc/Doxyfile $(PROGRAMS:%=src/%.c) $(LIB_OBJS:%=src/%.c) src/meataxe.h src/meataxe.doc src/changelog.doc\n\tmkdir -p doc\n\tdoxygen etc/Doxyfile >/dev/null\n\n\n# ------------------------------------------------------------------------------\n# Releasing\n# ------------------------------------------------------------------------------\n\nEXPORTED_FILES =\\\n  $(PROGRAMS:%=src/%.c)\\\n  $(LIB_OBJS:%=src/%.c)\\\n  src/meataxe.h src/genconfig.c\\\n  src/check.h $(TS_OBJS1:%=src/%.c) $(TS_OBJS1:%=src/%.h) src/zzztest.c\\\n  $(TESTS:%=test/t-%) test/config test/data\\\n  Makefile Makefile.conf.dist README COPYING\\\n  src/meataxe.doc src/changelog.doc\\\n  svnversion etc doc\n\ntar: svnversion all rebuild-doc\n\tV=2.4.`cat svnversion` \\\n\t&& rm -f meataxe-$$V meataxe-$$V.tar meataxe-$$V.tar.gz \\\n\t&& ln -s . meataxe-$$V \\\n\t&& tar cf meataxe-$$V.tar $(EXPORTED_FILES) \\\n\t&& rm meataxe-$$V \\\n\t&& gzip meataxe-$$V.tar \\\n\t&& echo \"Created meataxe-$$V.tar.gz\"\n\n\n\n```\n\n---\n\nPS: Makefile.conf is empty.",
    "created_at": "2017-12-10T10:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359638",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>For the record: This is the upstream Makefile

```
include Makefile.conf

CFLAGS=$(CFLAGS1) -Itmp
LFLAGS=$(LFLAGS1)

PROGRAMS = \
  cfcomp checksum chop decomp genmod mkcycl mkdotl mkgraph mkhom mkhom_old\
  mkinc mksub mktree orbrep precond pseudochop pwkond rad soc symnew tcond tuc \
  zad zbl zcf zcl zcp zct zcv zef zev zfr ziv zkd zmo zmu zmw znu zor zpo zpr \
  zpt zqt zro zsc zsi zsp zsy ztc zte ztr zts zuk zvp

all build: $(PROGRAMS:%=bin/%)

clean:
	rm -rf doc bin tmp
	cd test; make clean


# ------------------------------------------------------------------------------
# Compile C sources
# ------------------------------------------------------------------------------

tmp/%.o: tmp/mk.dir src/%.c src/meataxe.h tmp/config.h
	@echo "Compiling $*.c"
	@$(CC) $(CFLAGS) -c src/$*.c -o $@

tmp/mk.dir:
	mkdir -p tmp
	touch $@

bin/mk.dir:
	mkdir -p bin
	touch $@

# ------------------------------------------------------------------------------
# Link programs
# ------------------------------------------------------------------------------

bin/%: bin/mk.dir tmp/%.o tmp/libmtx.a
	@echo "Linking $@"
	@$(CC) $(LFLAGS) -o $@ tmp/$*.o tmp/libmtx.a


# ------------------------------------------------------------------------------
# Library
# ------------------------------------------------------------------------------

LIB_OBJS=\
	args berlekmp \
	bsand bscore bsdup bsissub bsmatch bsminus \
	bsop bsor bsprint bsread bswrite \
	cfinfo \
	charpol chbasis \
	error \
	ffio \
	fpcore fpdup fpmul fpmul2 fpprint \
	gcd genseed\
	grmaprow grmatcore grtable \
	homcomp \
	imatcore imatread imatwrite\
	init intio issub \
	isisom kernel-$(ZZZ) \
	ldiag \
	maddmul mat2vec matadd matclean matcmp \
	maketabF \
	matcopy matcore matcut \
	matdup matech matid matins matinv matmul \
	matnull matorder \
	matpivot\
	matprint matpwr matread mattr mattrace matwrite \
	message \
	mfcore mfread mfreadlong mfwrite mfwritelong \
	minpol mkendo\
	mmulscal mraddgen mrcore mrread mrtranspose mrwrite \
	msclean mscore \
	mtensor mtxobj os \
	permcmp permcore permdup perminv permmul permorder\
	permprint permpwr permread permwrite poladd\
	polcmp polcore polderive poldiv poldup\
	polgcd polmul polprint polread polwrite \
	quotient random rdcfgen \
	saction setcore setinsert settest \
	spinup spinup2 \
	split stabpwr stfcore \
	stfread stfwrite \
	string \
	sumint \
	temap \
	tkinfo vec2mat \
	wgen \
	zcleanrow zcmprow zgap zpermrow \
	zzz2 \
	version

tmp/libmtx.a: $(LIB_OBJS:%=tmp/%.o)
	@echo "Creating $@"
	@rm -f $@
	@ar r $@ $(LIB_OBJS:%=tmp/%.o)


# ------------------------------------------------------------------------------
# Test suite
# ------------------------------------------------------------------------------

TS_OBJS1=c-args c-bitstring c-charpol\
	c-ffio c-fileio c-ffmat c-ffrow c-fpoly \
	c-grease c-kernel c-matins c-matrix c-matset\
	c-os c-perm c-poly c-pseed c-quot c-random \
	c-sets c-stf c-tensor

TS_OBJS=tmp/zzztest.o $(TS_OBJS1:%=tmp/%.o) tmp/libmtx.a

bin/zzztest: bin/mk.dir $(TS_OBJS)
	@echo "Linking $@"
	@$(CC) $(CFLAGS) -o $@ $(TS_OBJS)

bin/checksum: bin/mk.dir tmp/checksum.o
	@echo "Linking $@"
	@$(CC) $(CFLAGS) -o $@ tmp/checksum.o

TESTS=0000\
  0100 0100 0105 0106 0107 0108 0109 0110 0111 0112\
  0113 0114 0115 0116 0117 0118 0200 0201 0210 0211\
  0212 0213 0214 0215

check: tmp/zzztest.done $(TESTS:%=tmp/t-%.done)

tmp/zzztest.done: tmp/mk.dir bin/zzztest
	cd tmp && ../bin/zzztest
	touch $@

tmp/t-%.done: tmp/mk.dir test/t-% tmp/t.config bin/checksum build
	@echo "t-$* `grep '^#:' test/t-$* | cut -c 3-100`"
	@cd tmp && ../test/t-$*
	@touch $@

tmp/t.config: tmp/mk.dir test/config
	cp test/config $@

# ------------------------------------------------------------------------------
# config.h
# ------------------------------------------------------------------------------

tmp/config.h: tmp/mk.dir Makefile Makefile.conf src/genconfig.c svnversion
	@echo "Generating config.h"
	@$(CC) $(CFLAGS) $(LFLAGS) -o tmp/genconfig src/genconfig.c
	@tmp/genconfig >$@


	
	
.PHONY: doc tar clean install check
.PRECIOUS: tmp/%.o

svnversion: $(EXPORTED_FILES)
	svnversion >$@ || echo "UNKNOWN" >$@

.PHONY: force-svnversion
force-svnversion:
	svnversion >svnversion

# ------------------------------------------------------------------------------
# Documentation
# ------------------------------------------------------------------------------

.PHONY: doc

rebuild-doc:
	rm -rf doc
	mkdir -p doc
	doxygen etc/Doxyfile >/dev/null

doc: doc/index.html

doc/index.html: etc/Doxyfile $(PROGRAMS:%=src/%.c) $(LIB_OBJS:%=src/%.c) src/meataxe.h src/meataxe.doc src/changelog.doc
	mkdir -p doc
	doxygen etc/Doxyfile >/dev/null


# ------------------------------------------------------------------------------
# Releasing
# ------------------------------------------------------------------------------

EXPORTED_FILES =\
  $(PROGRAMS:%=src/%.c)\
  $(LIB_OBJS:%=src/%.c)\
  src/meataxe.h src/genconfig.c\
  src/check.h $(TS_OBJS1:%=src/%.c) $(TS_OBJS1:%=src/%.h) src/zzztest.c\
  $(TESTS:%=test/t-%) test/config test/data\
  Makefile Makefile.conf.dist README COPYING\
  src/meataxe.doc src/changelog.doc\
  svnversion etc doc

tar: svnversion all rebuild-doc
	V=2.4.`cat svnversion` \
	&& rm -f meataxe-$$V meataxe-$$V.tar meataxe-$$V.tar.gz \
	&& ln -s . meataxe-$$V \
	&& tar cf meataxe-$$V.tar $(EXPORTED_FILES) \
	&& rm meataxe-$$V \
	&& gzip meataxe-$$V.tar \
	&& echo "Created meataxe-$$V.tar.gz"



```

---

PS: Makefile.conf is empty.



---

archive/issue_comments_359639.json:
```json
{
    "body": "<a id='comment:4'></a>I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.",
    "created_at": "2017-12-10T10:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359639",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.



---

archive/issue_comments_359640.json:
```json
{
    "body": "<a id='comment:5'></a>Remark: Probably it makes no sense to contact upstream about this.\n\nFor the current meataxe spkg, we have 7 patches. Some of them fix clear bugs, some of them add a considerable speed-up in echelon computation and matrix multiplication. However, none of it was taken into account by upstream, stating that they are currently preparing another version anyway (no idea how long this will take and how many backward incompatible changes are made in the new version).",
    "created_at": "2017-12-10T10:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359640",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>Remark: Probably it makes no sense to contact upstream about this.

For the current meataxe spkg, we have 7 patches. Some of them fix clear bugs, some of them add a considerable speed-up in echelon computation and matrix multiplication. However, none of it was taken into account by upstream, stating that they are currently preparing another version anyway (no idea how long this will take and how many backward incompatible changes are made in the new version).



---

archive/issue_comments_359641.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 dimpase]:\n> I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.\n\n\nActually I already successfully autoconfiscated a package: David Green did not use autotools for his projective resolution programs, but when I became upstream, I made it use autotools.\n\nHowever, I consider it as a crucial difference that I am not upstream for MeatAxe. So, I am somehow reluctant to completely change the build system.\n\nOTOH, I did provide rather invasive patches for MeatAxe (e.g., one adding asymptotically fast matrix multiplication). So, I am not categorically against a patch that commits autoconfiscation...",
    "created_at": "2017-12-10T10:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359641",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>Replying to [comment:4 dimpase]:
> I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.


Actually I already successfully autoconfiscated a package: David Green did not use autotools for his projective resolution programs, but when I became upstream, I made it use autotools.

However, I consider it as a crucial difference that I am not upstream for MeatAxe. So, I am somehow reluctant to completely change the build system.

OTOH, I did provide rather invasive patches for MeatAxe (e.g., one adding asymptotically fast matrix multiplication). So, I am not categorically against a patch that commits autoconfiscation...



---

archive/issue_comments_359642.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 SimonKing]:\n> Replying to [comment:4 dimpase]:\n> > I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.\n\n> \n> Actually I already successfully autoconfiscated a package: David Green did not use autotools for his projective resolution programs, but when I became upstream, I made it use autotools.\n> \n> However, I consider it as a crucial difference that I am not upstream for MeatAxe. So, I am somehow reluctant to completely change the build system.\n> \n> OTOH, I did provide rather invasive patches for MeatAxe (e.g., one adding asymptotically fast matrix multiplication). So, I am not categorically against a patch that commits autoconfiscation...\n\n\nAnother build system is less invasive than functionality changes, I think.\nAnyhow, if I were you I would have just forked MeatAxe and forgot about non-cooperating upstream.\n\nPS. A threat of a fork is sometimes making upstream cooperating, all of a sudden :-)",
    "created_at": "2017-12-10T10:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359642",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>Replying to [comment:6 SimonKing]:
> Replying to [comment:4 dimpase]:
> > I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.

> 
> Actually I already successfully autoconfiscated a package: David Green did not use autotools for his projective resolution programs, but when I became upstream, I made it use autotools.
> 
> However, I consider it as a crucial difference that I am not upstream for MeatAxe. So, I am somehow reluctant to completely change the build system.
> 
> OTOH, I did provide rather invasive patches for MeatAxe (e.g., one adding asymptotically fast matrix multiplication). So, I am not categorically against a patch that commits autoconfiscation...


Another build system is less invasive than functionality changes, I think.
Anyhow, if I were you I would have just forked MeatAxe and forgot about non-cooperating upstream.

PS. A threat of a fork is sometimes making upstream cooperating, all of a sudden :-)



---

archive/issue_comments_359643.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:4 dimpase]:\n> I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.\n\n\nWhen I autotoolized David Green's modular resolution code, I used \"Autotools - A Practitioner's guide to GNU autoconf, automake, and libtool\" by John Calcote. Nonetheless, since I am still quite a newbie, I'd appreciate if you could summarise for me what steps I need to take. I guess I would be able to look up myself the details on top the summary.",
    "created_at": "2017-12-10T15:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359643",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>Replying to [comment:4 dimpase]:
> I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.


When I autotoolized David Green's modular resolution code, I used "Autotools - A Practitioner's guide to GNU autoconf, automake, and libtool" by John Calcote. Nonetheless, since I am still quite a newbie, I'd appreciate if you could summarise for me what steps I need to take. I guess I would be able to look up myself the details on top the summary.



---

archive/issue_comments_359644.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 SimonKing]:\n> Replying to [comment:4 dimpase]:\n> > I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.\n\n> \n> When I autotoolized David Green's modular resolution code, I used \"Autotools - A Practitioner's guide to GNU autoconf, automake, and libtool\" by John Calcote. Nonetheless, since I am still quite a newbie, I'd appreciate if you could summarise for me what steps I need to take. I guess I would be able to look up myself the details on top the summary.\n\n\nNot that I have much more experience with this, but yes, this book is probably the best source.\n\nAs this code does not have any nontrivial dependencies (according to a quick look at the makefile), I guess it's about \n\n* figuring out what sources (*.c and *.h) are, probably \n  putting all *.h into a separate include/ directory, \n  I would keep the library sources in src/ but create another directory, say progs/, \n  for sources of the executables.\n* figuring out what to install: headers, library, executables\n* figuring out what to test.\n\nThen, putting Makefile.am in the appropriate directories;\nfor include/ you'd want an 1-line Makefile.am with `nobase_include_HEADERS =`\nI'd go for include/meataxe/, then you'd need to modify sources to have meataxe/ in\n`#include <>` statements (this is for headers you need installed, I gather, but there\nis no harm in installing them all in meataxe/)\n\nThe Makefile.am in src/ will deal with building the library; the one in progs with executables, the one in test/ with testing.\n\nconfigure.ac would be very trivial...",
    "created_at": "2017-12-10T16:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359644",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:8 SimonKing]:
> Replying to [comment:4 dimpase]:
> > I propose autotoolization. It would be hell to make this work on OSX and other non-linux otherwise. Do shout if you need help with this - it's not hard, in fact.

> 
> When I autotoolized David Green's modular resolution code, I used "Autotools - A Practitioner's guide to GNU autoconf, automake, and libtool" by John Calcote. Nonetheless, since I am still quite a newbie, I'd appreciate if you could summarise for me what steps I need to take. I guess I would be able to look up myself the details on top the summary.


Not that I have much more experience with this, but yes, this book is probably the best source.

As this code does not have any nontrivial dependencies (according to a quick look at the makefile), I guess it's about 

* figuring out what sources (*.c and *.h) are, probably 
  putting all *.h into a separate include/ directory, 
  I would keep the library sources in src/ but create another directory, say progs/, 
  for sources of the executables.
* figuring out what to install: headers, library, executables
* figuring out what to test.

Then, putting Makefile.am in the appropriate directories;
for include/ you'd want an 1-line Makefile.am with `nobase_include_HEADERS =`
I'd go for include/meataxe/, then you'd need to modify sources to have meataxe/ in
`#include <>` statements (this is for headers you need installed, I gather, but there
is no harm in installing them all in meataxe/)

The Makefile.am in src/ will deal with building the library; the one in progs with executables, the one in test/ with testing.

configure.ac would be very trivial...



---

archive/issue_comments_359645.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 dimpase]:\n> Then, putting Makefile.am in the appropriate directories;\n> for include/ you'd want an 1-line Makefile.am with `nobase_include_HEADERS =`\n> I'd go for include/meataxe/,\n\n\nSure, currently the meataxe headers are there, too.\n\n> then you'd need to modify sources to have meataxe/ in\n> `#include <>` statements (this is for headers you need installed, I gather, but there\n> is no harm in installing them all in meataxe/)\n\n\nI don't understand what that means. Currently, there is `#include \"meataxe.h\"`. Are you saying that I need to change it into `#include \"meataxe/meataxe.h\"`? But why? Wouldn't \"make build\" take place in some build directory whose structure mimics the source structure, whereas the transfer of headers to `include/meataxe` would only happen during \"make install\"?\n\n> The Makefile.am in src/ will deal with building the library; the one in progs with executables, the one in test/ with testing.\n\n\nI need to figure out what to do so that Makefile.am in test/ will only be executing if someone does \"make test\".",
    "created_at": "2017-12-10T16:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359645",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>Replying to [comment:9 dimpase]:
> Then, putting Makefile.am in the appropriate directories;
> for include/ you'd want an 1-line Makefile.am with `nobase_include_HEADERS =`
> I'd go for include/meataxe/,


Sure, currently the meataxe headers are there, too.

> then you'd need to modify sources to have meataxe/ in
> `#include <>` statements (this is for headers you need installed, I gather, but there
> is no harm in installing them all in meataxe/)


I don't understand what that means. Currently, there is `#include "meataxe.h"`. Are you saying that I need to change it into `#include "meataxe/meataxe.h"`? But why? Wouldn't "make build" take place in some build directory whose structure mimics the source structure, whereas the transfer of headers to `include/meataxe` would only happen during "make install"?

> The Makefile.am in src/ will deal with building the library; the one in progs with executables, the one in test/ with testing.


I need to figure out what to do so that Makefile.am in test/ will only be executing if someone does "make test".



---

archive/issue_comments_359646.json:
```json
{
    "body": "<a id='comment:11'></a>PS: There is only one header file to be installed, namely `meataxe.h`. The other header files apparently are only used for testing. So, they should actually better be moved into the test/ folder.",
    "created_at": "2017-12-10T16:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359646",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'></a>PS: There is only one header file to be installed, namely `meataxe.h`. The other header files apparently are only used for testing. So, they should actually better be moved into the test/ folder.



---

archive/issue_comments_359647.json:
```json
{
    "body": "<a id='comment:12'></a>Currently meataxe only has a single src directory, containing all headers (the one to be included and the ones used for testing) and all code files (regardless whether for library functions, for executable or for tests). That'd really require a major overhaul.",
    "created_at": "2017-12-10T16:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359647",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'></a>Currently meataxe only has a single src directory, containing all headers (the one to be included and the ones used for testing) and all code files (regardless whether for library functions, for executable or for tests). That'd really require a major overhaul.



---

archive/issue_comments_359648.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:4 dimpase]:\n> I propose autotoolization.\n\n\nIndeed, it's the only realistic solution. Don't try to fix the upstream build system, just throw it out and start from scratch with autotools.",
    "created_at": "2017-12-10T17:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359648",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:4 dimpase]:
> I propose autotoolization.


Indeed, it's the only realistic solution. Don't try to fix the upstream build system, just throw it out and start from scratch with autotools.



---

archive/issue_comments_359649.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:10 SimonKing]:\n> Replying to [comment:9 dimpase]:\n> > Then, putting Makefile.am in the appropriate directories;\n> > for include/ you'd want an 1-line Makefile.am with `nobase_include_HEADERS =`\n> > I'd go for include/meataxe/,\n\n> \n> Sure, currently the meataxe headers are there, too.\n> \n> > then you'd need to modify sources to have meataxe/ in\n> > `#include <>` statements (this is for headers you need installed, I gather, but there\n> > is no harm in installing them all in meataxe/)\n\n> \n> I don't understand what that means. Currently, there is `#include \"meataxe.h\"`. Are you saying that I need to change it into `#include \"meataxe/meataxe.h\"`? But why? Wouldn't \"make build\" take place in some build directory whose structure mimics the source structure, whereas the transfer of headers to `include/meataxe` would only happen during \"make install\"?\n\n\nNo, that's not what I meant, but indeed if you only need to install meataxe.h, and no\nother headers, then you may leave it as it is.\nHowever, it's bad practice to mix *.c and *.h in the same dir.\nStill I'd create include/ and move all the *.h files there.\nThen if your AC_CONFIG_FILES in configure.ac mentions `include/Makefile`\nthe building setup with add the relevant `-I../include/` or something like this to\nthe compilation commands.\n\nIIRC, `nobase_include_HEADERS = meataxe.h` in include/ will then make sure that\n`make install` copies `meataxe.h` (and no other headers) to where it should go, i.e. `$SAGE_LOCAL/include`. (But I might be wrong on this one, it could be that you must list all the *.h files there, and then they would all get installed, something you rather want to avoid, I guess. Not sure.)\n\n\n\n> \n> > The Makefile.am in src/ will deal with building the library; the one in progs with executables, the one in test/ with testing.\n\n> \n> I need to figure out what to do so that Makefile.am in test/ will only be executing if someone does \"make test\".\n\n\nI think this is made sure by mentioning in test/Makefile.am the corresponding executables in \n`check_PROGRAMS =`, and not in `bin_PROGRAMS =`. The latter is for executables to be installed by `make install`.\n\nPS. I'm following my autotoolization project here: https://github.com/dimpase/csdp",
    "created_at": "2017-12-10T18:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359649",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [comment:10 SimonKing]:
> Replying to [comment:9 dimpase]:
> > Then, putting Makefile.am in the appropriate directories;
> > for include/ you'd want an 1-line Makefile.am with `nobase_include_HEADERS =`
> > I'd go for include/meataxe/,

> 
> Sure, currently the meataxe headers are there, too.
> 
> > then you'd need to modify sources to have meataxe/ in
> > `#include <>` statements (this is for headers you need installed, I gather, but there
> > is no harm in installing them all in meataxe/)

> 
> I don't understand what that means. Currently, there is `#include "meataxe.h"`. Are you saying that I need to change it into `#include "meataxe/meataxe.h"`? But why? Wouldn't "make build" take place in some build directory whose structure mimics the source structure, whereas the transfer of headers to `include/meataxe` would only happen during "make install"?


No, that's not what I meant, but indeed if you only need to install meataxe.h, and no
other headers, then you may leave it as it is.
However, it's bad practice to mix *.c and *.h in the same dir.
Still I'd create include/ and move all the *.h files there.
Then if your AC_CONFIG_FILES in configure.ac mentions `include/Makefile`
the building setup with add the relevant `-I../include/` or something like this to
the compilation commands.

IIRC, `nobase_include_HEADERS = meataxe.h` in include/ will then make sure that
`make install` copies `meataxe.h` (and no other headers) to where it should go, i.e. `$SAGE_LOCAL/include`. (But I might be wrong on this one, it could be that you must list all the *.h files there, and then they would all get installed, something you rather want to avoid, I guess. Not sure.)



> 
> > The Makefile.am in src/ will deal with building the library; the one in progs with executables, the one in test/ with testing.

> 
> I need to figure out what to do so that Makefile.am in test/ will only be executing if someone does "make test".


I think this is made sure by mentioning in test/Makefile.am the corresponding executables in 
`check_PROGRAMS =`, and not in `bin_PROGRAMS =`. The latter is for executables to be installed by `make install`.

PS. I'm following my autotoolization project here: https://github.com/dimpase/csdp



---

archive/issue_comments_359650.json:
```json
{
    "body": "<a id='comment:15'></a>So far, I thought I should keep the upstream sources and add yet another patch. The patch would define the change from the upstream build system to whatever comes out by applying autotools.\n\nHowever, autotools creates a lot of files, say, INSTALL, COPYING, makefile.in, config.h.in, etc, and if I understand correctly these are all files supposed to be part of a distribution, i.e., the patch would add all those files and would thus be HUGE.\n\nWouldn't it then be better to fork MeatAxe, after all?\n\nI.e., remove the old build system, apply autotools, create `meataxe-2.4.24.p4.tar.gz` by `make dist` (IIRC that's one of the make targets provided by automake), and post this on my web page? Then, the current patches from `SAGE_ROOT/build/pkgs/meataxe/patches` will already be part of the .tar.gz.\n\nI just checked that meataxe 2.5 is still not using autotools. But how to tell upstream about it without creating anger?",
    "created_at": "2017-12-17T09:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359650",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'></a>So far, I thought I should keep the upstream sources and add yet another patch. The patch would define the change from the upstream build system to whatever comes out by applying autotools.

However, autotools creates a lot of files, say, INSTALL, COPYING, makefile.in, config.h.in, etc, and if I understand correctly these are all files supposed to be part of a distribution, i.e., the patch would add all those files and would thus be HUGE.

Wouldn't it then be better to fork MeatAxe, after all?

I.e., remove the old build system, apply autotools, create `meataxe-2.4.24.p4.tar.gz` by `make dist` (IIRC that's one of the make targets provided by automake), and post this on my web page? Then, the current patches from `SAGE_ROOT/build/pkgs/meataxe/patches` will already be part of the .tar.gz.

I just checked that meataxe 2.5 is still not using autotools. But how to tell upstream about it without creating anger?



---

archive/issue_comments_359651.json:
```json
{
    "body": "<a id='comment:16'></a>Another question concerning the portability of the dynamic library approach. Are dynamic libraries really available on all platforms targeted by Sage?",
    "created_at": "2017-12-17T09:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359651",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:16'></a>Another question concerning the portability of the dynamic library approach. Are dynamic libraries really available on all platforms targeted by Sage?



---

archive/issue_comments_359652.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 SimonKing]:\n> Another question concerning the portability of the dynamic library approach. Are dynamic libraries really available on all platforms targeted by Sage?\n\n\nCertainly.",
    "created_at": "2017-12-17T09:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359652",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Replying to [comment:16 SimonKing]:
> Another question concerning the portability of the dynamic library approach. Are dynamic libraries really available on all platforms targeted by Sage?


Certainly.



---

archive/issue_comments_359653.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:15 SimonKing]:\n> So far, I thought I should keep the upstream sources and add yet another patch. The patch would define the change from the upstream build system to whatever comes out by applying autotools.\n> \n> However, autotools creates a lot of files, say, INSTALL, COPYING, makefile.in, config.h.in, etc, and if I understand correctly these are all files supposed to be part of a distribution, i.e., the patch would add all those files and would thus be HUGE.\n> \n> Wouldn't it then be better to fork MeatAxe, after all?\n> \n> I.e., remove the old build system, apply autotools, create `meataxe-2.4.24.p4.tar.gz` by `make dist` (IIRC that's one of the make targets provided by automake), and post this on my web page? Then, the current patches from `SAGE_ROOT/build/pkgs/meataxe/patches` will already be part of the .tar.gz.\n> \n> I just checked that meataxe 2.5 is still not using autotools. But how to tell upstream about it without creating anger?\n\n\n\nSupporting dynamic libraries on a variety of platforms basically requires using autotools or cmake, otherwise it is a nightmare.\n\nSage has quite some experience with autotoolising upstreams, usually it ends up well.\nCliquer (https://github.com/dimpase/autocliquer/) was an exception, upstream declined our patches, for reason that the software has not been touched for 6 or 7 years, and that the code never included outside contributions in the past.\n\nI think *reasonable* people would gladly accept these changes...",
    "created_at": "2017-12-17T10:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359653",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>Replying to [comment:15 SimonKing]:
> So far, I thought I should keep the upstream sources and add yet another patch. The patch would define the change from the upstream build system to whatever comes out by applying autotools.
> 
> However, autotools creates a lot of files, say, INSTALL, COPYING, makefile.in, config.h.in, etc, and if I understand correctly these are all files supposed to be part of a distribution, i.e., the patch would add all those files and would thus be HUGE.
> 
> Wouldn't it then be better to fork MeatAxe, after all?
> 
> I.e., remove the old build system, apply autotools, create `meataxe-2.4.24.p4.tar.gz` by `make dist` (IIRC that's one of the make targets provided by automake), and post this on my web page? Then, the current patches from `SAGE_ROOT/build/pkgs/meataxe/patches` will already be part of the .tar.gz.
> 
> I just checked that meataxe 2.5 is still not using autotools. But how to tell upstream about it without creating anger?



Supporting dynamic libraries on a variety of platforms basically requires using autotools or cmake, otherwise it is a nightmare.

Sage has quite some experience with autotoolising upstreams, usually it ends up well.
Cliquer (https://github.com/dimpase/autocliquer/) was an exception, upstream declined our patches, for reason that the software has not been touched for 6 or 7 years, and that the code never included outside contributions in the past.

I think *reasonable* people would gladly accept these changes...



---

archive/issue_comments_359654.json:
```json
{
    "body": "<a id='comment:19'></a>As I mentioned earlier, upstream ignores my patches to add Winograd-Strassen multiplication, although it is faster than schoolbook multiplication even for quite small matrices. But what would happen if upstream would accept autotoolization, but would keep ignoring the other patches?\n\nWouldn't the addition of another source file imply a change in `src/Makefile.am` (which would be part of the distribution)? I.e., we would have to wait for upstream to accept the autotoolization and then still need to patch Makefile.am",
    "created_at": "2017-12-17T10:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359654",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:19'></a>As I mentioned earlier, upstream ignores my patches to add Winograd-Strassen multiplication, although it is faster than schoolbook multiplication even for quite small matrices. But what would happen if upstream would accept autotoolization, but would keep ignoring the other patches?

Wouldn't the addition of another source file imply a change in `src/Makefile.am` (which would be part of the distribution)? I.e., we would have to wait for upstream to accept the autotoolization and then still need to patch Makefile.am



---

archive/issue_comments_359655.json:
```json
{
    "body": "<a id='comment:20'></a>Just create a fork. The fact that upstream ignores patches should not preclude further development, and the license perfectly allows this. \n\nCall it AutoMeatAxe, say...",
    "created_at": "2017-12-17T10:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359655",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>Just create a fork. The fact that upstream ignores patches should not preclude further development, and the license perfectly allows this. 

Call it AutoMeatAxe, say...



---

archive/issue_comments_359656.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 dimpase]:\n> Just create a fork. The fact that upstream ignores patches should not preclude further development, and the license perfectly allows this. \n> \n> Call it AutoMeatAxe, say...\n\n\nWhat would then happen with the current optional \"meataxe\" spkg and with the OptionalExtension depending on it? Would `sage -i meataxe` henceforth install automeataxe? But how would that work, given that `sage -i bla` looks in upstream for the latest version of bla (so that `sage -i meataxe` couldn't pick up automeataxe)?\n\nA static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.",
    "created_at": "2017-12-17T12:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359656",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>Replying to [comment:20 dimpase]:
> Just create a fork. The fact that upstream ignores patches should not preclude further development, and the license perfectly allows this. 
> 
> Call it AutoMeatAxe, say...


What would then happen with the current optional "meataxe" spkg and with the OptionalExtension depending on it? Would `sage -i meataxe` henceforth install automeataxe? But how would that work, given that `sage -i bla` looks in upstream for the latest version of bla (so that `sage -i meataxe` couldn't pick up automeataxe)?

A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.



---

archive/issue_comments_359657.json:
```json
{
    "body": "<a id='comment:22'></a>I just thought: Maybe a dynamic library is not a good solution, in particular if it comes to parallel computation?\n\nlibmtx has global C variables not only for the folders holding multiplication tables, but also for the current field and the current row length. Since the library is static, any Cython module and any executable linked against libmtx has their own copy of these variables, and it means that they are all obligated to set the appropriate variables.\n\nSuppose we would use a dynamic library instead. Now imagine a computation in which functions from different Cython modules A,B,C and different executables D,E,F are supposed to deal with matrices of different dimensions. When they are all linked against the same dynamic library, chaos would result: If module A changed the row size and executable E would pick that up, it would undoubtedly crash.\n\nAm I right that this would happen?\n\nIf \"yes\", then it is a show stopper, and we can mark this ticket as invalid.",
    "created_at": "2017-12-17T12:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359657",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'></a>I just thought: Maybe a dynamic library is not a good solution, in particular if it comes to parallel computation?

libmtx has global C variables not only for the folders holding multiplication tables, but also for the current field and the current row length. Since the library is static, any Cython module and any executable linked against libmtx has their own copy of these variables, and it means that they are all obligated to set the appropriate variables.

Suppose we would use a dynamic library instead. Now imagine a computation in which functions from different Cython modules A,B,C and different executables D,E,F are supposed to deal with matrices of different dimensions. When they are all linked against the same dynamic library, chaos would result: If module A changed the row size and executable E would pick that up, it would undoubtedly crash.

Am I right that this would happen?

If "yes", then it is a show stopper, and we can mark this ticket as invalid.



---

archive/issue_comments_359658.json:
```json
{
    "body": "<a id='comment:23'></a>And what about a multiuser setting?\n\nIf user A changes a global variable in a dynamic library, would that affect user B?",
    "created_at": "2017-12-17T12:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359658",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:23'></a>And what about a multiuser setting?

If user A changes a global variable in a dynamic library, would that affect user B?



---

archive/issue_comments_359659.json:
```json
{
    "body": "<a id='comment:24'></a>Global variables in dynamic libraries are only shared on the level of programs. Two different programs (regardless of whether it's the same executable or same user) won't share anything.\n\nSo, in practice, the relevant difference between static and shared for Sage will be if *different* Cython modules use the same library.\n\nSince parallel computation will most likely involve just one Cython module, I don't see an issue there.",
    "created_at": "2017-12-17T13:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359659",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Global variables in dynamic libraries are only shared on the level of programs. Two different programs (regardless of whether it's the same executable or same user) won't share anything.

So, in practice, the relevant difference between static and shared for Sage will be if *different* Cython modules use the same library.

Since parallel computation will most likely involve just one Cython module, I don't see an issue there.



---

archive/issue_comments_359660.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 jdemeyer]:\n> Since parallel computation will most likely involve just one Cython module, I don't see an issue there.\n\n\nThe computation of the cohomology ring of a finite group G typically involves the computation of the cohomology rings of various subgroups of G. It would be natural to have these computed in parallel. It involves libmtx calls at least from sage/groups/modular_cohomology/resolution, sage/groups/modular_cohomology/cochain and sage/matrix/matrix_gfpn_dense, and these computations would likely to be operating with *different* row sizes.",
    "created_at": "2017-12-17T13:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359660",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:25'></a>Replying to [comment:24 jdemeyer]:
> Since parallel computation will most likely involve just one Cython module, I don't see an issue there.


The computation of the cohomology ring of a finite group G typically involves the computation of the cohomology rings of various subgroups of G. It would be natural to have these computed in parallel. It involves libmtx calls at least from sage/groups/modular_cohomology/resolution, sage/groups/modular_cohomology/cochain and sage/matrix/matrix_gfpn_dense, and these computations would likely to be operating with *different* row sizes.



---

archive/issue_comments_359661.json:
```json
{
    "body": "<a id='comment:26'></a>BTW, I just created a parallel computation (using the `@`parallel decorator) of matrix products of different sizes. At least with the current static library, it works fine.",
    "created_at": "2017-12-17T13:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359661",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:26'></a>BTW, I just created a parallel computation (using the `@`parallel decorator) of matrix products of different sizes. At least with the current static library, it works fine.



---

archive/issue_comments_359662.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:21 SimonKing]:\n> Replying to [comment:20 dimpase]:\n> > Just create a fork. The fact that upstream ignores patches should not preclude further development, and the license perfectly allows this. \n> > \n> > Call it AutoMeatAxe, say...\n\n> \n> What would then happen with the current optional \"meataxe\" spkg and with the OptionalExtension depending on it? Would `sage -i meataxe` henceforth install automeataxe? But how would that work, given that `sage -i bla` looks in upstream for the latest version of bla (so that `sage -i meataxe` couldn't pick up automeataxe)?\n\n\nmeataxe package would use automeataxe tarball---tarball name can be more or less arbitrary.\nThe package name won't have to change - it's just the name of the upstream project.\nSee how this is done with cliquer.\n\n> \n> A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.\n\n\nwhy would you need both?",
    "created_at": "2017-12-17T13:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359662",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>Replying to [comment:21 SimonKing]:
> Replying to [comment:20 dimpase]:
> > Just create a fork. The fact that upstream ignores patches should not preclude further development, and the license perfectly allows this. 
> > 
> > Call it AutoMeatAxe, say...

> 
> What would then happen with the current optional "meataxe" spkg and with the OptionalExtension depending on it? Would `sage -i meataxe` henceforth install automeataxe? But how would that work, given that `sage -i bla` looks in upstream for the latest version of bla (so that `sage -i meataxe` couldn't pick up automeataxe)?


meataxe package would use automeataxe tarball---tarball name can be more or less arbitrary.
The package name won't have to change - it's just the name of the upstream project.
See how this is done with cliquer.

> 
> A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.


why would you need both?



---

archive/issue_comments_359663.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:27 dimpase]:\n> > A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.\n\n> \n> why would you need both?\n\n\nI don't. But I was afraid that an automeataxe spkg couldn't be called meataxe. Also, I am slightly worried about a stale libmtx.a: How to make sure that everything is linked against a new dynamic library rather than an old static library?\n\nThat said, I still worry about potential problems with parallelism, due to shared global variables.",
    "created_at": "2017-12-17T13:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359663",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:28'></a>Replying to [comment:27 dimpase]:
> > A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.

> 
> why would you need both?


I don't. But I was afraid that an automeataxe spkg couldn't be called meataxe. Also, I am slightly worried about a stale libmtx.a: How to make sure that everything is linked against a new dynamic library rather than an old static library?

That said, I still worry about potential problems with parallelism, due to shared global variables.



---

archive/issue_comments_359664.json:
```json
{
    "body": "<a id='comment:29'></a>`@`parallel does not do any memory sharing among subprocesses---which is often a problem for computations where you really want to avoid the overhead of copying everything, but in this case it would actually make the transition to the dynamic setting seamless.\n\n(of course, in a real multithreaded application things like global variables are something that is to be avoided, but it's not the case here.)",
    "created_at": "2017-12-17T13:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359664",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>`@`parallel does not do any memory sharing among subprocesses---which is often a problem for computations where you really want to avoid the overhead of copying everything, but in this case it would actually make the transition to the dynamic setting seamless.

(of course, in a real multithreaded application things like global variables are something that is to be avoided, but it's not the case here.)



---

archive/issue_comments_359665.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 SimonKing]:\n> Replying to [comment:27 dimpase]:\n> > > A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.\n\n> > \n> > why would you need both?\n\n> \n> I don't. But I was afraid that an automeataxe spkg couldn't be called meataxe. Also, I am slightly worried about a stale libmtx.a: How to make sure that everything is linked against a new dynamic library rather than an old static library?\n\n\nRemove the stale libs and other things in spkg-install (many packages actually do this).\n> \n> That said, I still worry about potential problems with parallelism, due to shared global variables.\n\n\nAs I said in the comment I just posted, with `@`parallel you will be fine.",
    "created_at": "2017-12-17T13:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359665",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:30'></a>Replying to [comment:28 SimonKing]:
> Replying to [comment:27 dimpase]:
> > > A static library provided by meataxe and a dynamic library provided by automeataxe can't coexist, I believe.

> > 
> > why would you need both?

> 
> I don't. But I was afraid that an automeataxe spkg couldn't be called meataxe. Also, I am slightly worried about a stale libmtx.a: How to make sure that everything is linked against a new dynamic library rather than an old static library?


Remove the stale libs and other things in spkg-install (many packages actually do this).
> 
> That said, I still worry about potential problems with parallelism, due to shared global variables.


As I said in the comment I just posted, with `@`parallel you will be fine.



---

archive/issue_comments_359666.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:29 dimpase]:\n> `@`parallel does not do any memory sharing among subprocesses\n\n\nTo elaborate: ``@`parallel` uses `fork()` which creates multiple **processes** (which don't share memory), not threads.",
    "created_at": "2017-12-17T15:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359666",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>Replying to [comment:29 dimpase]:
> `@`parallel does not do any memory sharing among subprocesses


To elaborate: ``@`parallel` uses `fork()` which creates multiple **processes** (which don't share memory), not threads.



---

archive/issue_comments_359667.json:
```json
{
    "body": "<a id='comment:32'></a>MeatAxe defines various symbols during its hand-made initialisation. Among them:\n- MTX_CONFIG_BIG_ENDIAN\n- MTX_BUILD and MTX_VERSION\n- MTX_CONFIG_LONG32 and MTX_CONFIG_LONG64\n- MTX_CONFIG_STRING\n\nSome of them are only used in the docs, some are used in a file `intio.c`.\n\nQuestion: How can autoconf be used to define these symbols? I.e., how can I check during configuration whether the machine is big or little endian and whether it is 32 or 64 bit? So far, I only found runtime tests, and in fact the upstream hand-made configuration of MeatAxe first executes a little C code that at its runtime checks the machine and then defines the above symbols, so that the rest of the code knows the configuration at compile time.",
    "created_at": "2017-12-26T14:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359667",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:32'></a>MeatAxe defines various symbols during its hand-made initialisation. Among them:
- MTX_CONFIG_BIG_ENDIAN
- MTX_BUILD and MTX_VERSION
- MTX_CONFIG_LONG32 and MTX_CONFIG_LONG64
- MTX_CONFIG_STRING

Some of them are only used in the docs, some are used in a file `intio.c`.

Question: How can autoconf be used to define these symbols? I.e., how can I check during configuration whether the machine is big or little endian and whether it is 32 or 64 bit? So far, I only found runtime tests, and in fact the upstream hand-made configuration of MeatAxe first executes a little C code that at its runtime checks the machine and then defines the above symbols, so that the rest of the code knows the configuration at compile time.



---

archive/issue_comments_359668.json:
```json
{
    "body": "<a id='comment:33'></a>For the record, the current configuration works like this:\n\n```\ntmp/config.h: tmp/mk.dir Makefile Makefile.conf src/genconfig.c svnversion\n\t@echo \"Generating config.h\"\n\t@$(CC) $(CFLAGS) $(LFLAGS) -o tmp/genconfig src/genconfig.c\n\t@tmp/genconfig >$@\n```\nand the resulting header is then included in two files, `intio.c` and `version.c`. The former C file relies on endianness and 32/64bit architecture. The latter C file provides an environment variable `MtxVersion`, which is then used to print help resp. status information.\n\nAgain, the question is how that would change when using autotools?",
    "created_at": "2017-12-26T16:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359668",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:33'></a>For the record, the current configuration works like this:

```
tmp/config.h: tmp/mk.dir Makefile Makefile.conf src/genconfig.c svnversion
	@echo "Generating config.h"
	@$(CC) $(CFLAGS) $(LFLAGS) -o tmp/genconfig src/genconfig.c
	@tmp/genconfig >$@
```
and the resulting header is then included in two files, `intio.c` and `version.c`. The former C file relies on endianness and 32/64bit architecture. The latter C file provides an environment variable `MtxVersion`, which is then used to print help resp. status information.

Again, the question is how that would change when using autotools?



---

archive/issue_comments_359669.json:
```json
{
    "body": "<a id='comment:34'></a>there is Autoconf macro AC_C_BIGENDIAN\nwhich you can use for endianness detection.\nFor the version etc there is  AC_INIT, which is typically used for setting the version.\n\nFor 32 vs 64 bits, use AC_CHECK_SIZEOF",
    "created_at": "2017-12-26T17:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359669",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>there is Autoconf macro AC_C_BIGENDIAN
which you can use for endianness detection.
For the version etc there is  AC_INIT, which is typically used for setting the version.

For 32 vs 64 bits, use AC_CHECK_SIZEOF



---

archive/issue_comments_359670.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 dimpase]:\n> there is Autoconf macro AC_C_BIGENDIAN\n> which you can use for endianness detection.\n> For the version etc there is  AC_INIT, which is typically used for setting the version.\n> \n> For 32 vs 64 bits, use AC_CHECK_SIZEOF\n\n\nThank you! That information is in fact missing in the autotools tutorial I am using. But I found it documented in the autoconf manual.",
    "created_at": "2017-12-26T17:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359670",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:35'></a>Replying to [comment:34 dimpase]:
> there is Autoconf macro AC_C_BIGENDIAN
> which you can use for endianness detection.
> For the version etc there is  AC_INIT, which is typically used for setting the version.
> 
> For 32 vs 64 bits, use AC_CHECK_SIZEOF


Thank you! That information is in fact missing in the autotools tutorial I am using. But I found it documented in the autoconf manual.



---

archive/issue_comments_359671.json:
```json
{
    "body": "<a id='comment:36'></a>I made some progress: The library and the executables of SharedMeatAxe (that's the name I chose) build.\n\nI now need to see how to run MeatAxe's test suite and how to build MeatAxe's documentation (they use doxygen).\n\nWhat I don't understand: After installation, I expected to find a single shared library in lib/, but I find:\n\n```\n$ ls lib\nlibmtx.a  libmtx.la  libmtx.so\tlibmtx.so.0  libmtx.so.0.0.0\n```\nIn particular, the static library libmtx.a is there as will. Is that not a problem?\n\nAlso, would it be a problem (e.g. for the OptionalExtension sage.matrix.matrix_gfpn_dense) that meataxe.h is not installed directly in include/ but in include/shared_meataxe/?",
    "created_at": "2017-12-27T10:03:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359671",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:36'></a>I made some progress: The library and the executables of SharedMeatAxe (that's the name I chose) build.

I now need to see how to run MeatAxe's test suite and how to build MeatAxe's documentation (they use doxygen).

What I don't understand: After installation, I expected to find a single shared library in lib/, but I find:

```
$ ls lib
libmtx.a  libmtx.la  libmtx.so	libmtx.so.0  libmtx.so.0.0.0
```
In particular, the static library libmtx.a is there as will. Is that not a problem?

Also, would it be a problem (e.g. for the OptionalExtension sage.matrix.matrix_gfpn_dense) that meataxe.h is not installed directly in include/ but in include/shared_meataxe/?



---

archive/issue_comments_359672.json:
```json
{
    "body": "<a id='comment:37'></a>various versions of .so are fine, it is the usual versioning stuff. only one of them is not a link. by default both static and dynamic libs are built. you can use a parameter to configure to build only dynamic one, something like `--disable-static`\n\nheader location can be adjusted in the progs that use them.",
    "created_at": "2017-12-27T10:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359672",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:37'></a>various versions of .so are fine, it is the usual versioning stuff. only one of them is not a link. by default both static and dynamic libs are built. you can use a parameter to configure to build only dynamic one, something like `--disable-static`

header location can be adjusted in the progs that use them.



---

archive/issue_comments_359673.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 dimpase]:\n> various versions of .so are fine, it is the usual versioning stuff. only one of them is not a link. by default both static and dynamic libs are built. you can use a parameter to configure to build only dynamic one, something like `--disable-static`\n\n\nFrom my perspective, the crucial question is: What happens if one does `-lmtx`? Would that result in linking against the static or against the dynamic library, if both are present?\n\nOTOH, I was told that Sage only supports platforms which do provide shared libraries. If that's the case then `--disable-static` probably is the way to go.\n\n> header location can be adjusted in the progs that use them.\n\n\nSure. But there is only a single header to be included. Thus, it might be better to avoid the additional `shared_meataxe` folder.",
    "created_at": "2017-12-27T10:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359673",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:38'></a>Replying to [comment:37 dimpase]:
> various versions of .so are fine, it is the usual versioning stuff. only one of them is not a link. by default both static and dynamic libs are built. you can use a parameter to configure to build only dynamic one, something like `--disable-static`


From my perspective, the crucial question is: What happens if one does `-lmtx`? Would that result in linking against the static or against the dynamic library, if both are present?

OTOH, I was told that Sage only supports platforms which do provide shared libraries. If that's the case then `--disable-static` probably is the way to go.

> header location can be adjusted in the progs that use them.


Sure. But there is only a single header to be included. Thus, it might be better to avoid the additional `shared_meataxe` folder.



---

archive/issue_comments_359674.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:36 SimonKing]:\n> Also, would it be a problem (e.g. for the OptionalExtension sage.matrix.matrix_gfpn_dense) that meataxe.h is not installed directly in include/ but in include/shared_meataxe/?\n\n\n`shared_meataxe` is a bit a strange name. I think it should be either `include/meataxe.h` or `include/meataxe/meataxe.h`",
    "created_at": "2017-12-27T11:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359674",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>Replying to [comment:36 SimonKing]:
> Also, would it be a problem (e.g. for the OptionalExtension sage.matrix.matrix_gfpn_dense) that meataxe.h is not installed directly in include/ but in include/shared_meataxe/?


`shared_meataxe` is a bit a strange name. I think it should be either `include/meataxe.h` or `include/meataxe/meataxe.h`



---

archive/issue_comments_359675.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:38 SimonKing]:\n> From my perspective, the crucial question is: What happens if one does `-lmtx`?\n\n\nOn Linux at least, dynamic libraries (`.so`) take precendence. But I know that handling of libraries differs a lot between operating systems, so I cannot speak for non-Linux systems.",
    "created_at": "2017-12-27T11:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359675",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>Replying to [comment:38 SimonKing]:
> From my perspective, the crucial question is: What happens if one does `-lmtx`?


On Linux at least, dynamic libraries (`.so`) take precendence. But I know that handling of libraries differs a lot between operating systems, so I cannot speak for non-Linux systems.



---

archive/issue_comments_359676.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:39 jdemeyer]:\n> Replying to [comment:36 SimonKing]:\n> > Also, would it be a problem (e.g. for the OptionalExtension sage.matrix.matrix_gfpn_dense) that meataxe.h is not installed directly in include/ but in include/shared_meataxe/?\n\n> \n> `shared_meataxe` is a bit a strange name.\n\n\nSharedMeatAxe is the package name that I currently propose. Dima suggested AutoMeatAxe. However, I prefer a name that indicates what the package provides (namely: A shared MeatAxe library) over a name that tells how the package is built (namely: With autotools).\n\nAt the current stage, the name isn't fixed. So, if you can think of a catchy name, then please tell!\n\n> I think it should be either `include/meataxe.h` or `include/meataxe/meataxe.h`\n\n\nI guess it will be the former; that's what the old meataxe spkg did anyway.",
    "created_at": "2017-12-27T12:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359676",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:41'></a>Replying to [comment:39 jdemeyer]:
> Replying to [comment:36 SimonKing]:
> > Also, would it be a problem (e.g. for the OptionalExtension sage.matrix.matrix_gfpn_dense) that meataxe.h is not installed directly in include/ but in include/shared_meataxe/?

> 
> `shared_meataxe` is a bit a strange name.


SharedMeatAxe is the package name that I currently propose. Dima suggested AutoMeatAxe. However, I prefer a name that indicates what the package provides (namely: A shared MeatAxe library) over a name that tells how the package is built (namely: With autotools).

At the current stage, the name isn't fixed. So, if you can think of a catchy name, then please tell!

> I think it should be either `include/meataxe.h` or `include/meataxe/meataxe.h`


I guess it will be the former; that's what the old meataxe spkg did anyway.



---

archive/issue_comments_359677.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:40 jdemeyer]:\n> Replying to [comment:38 SimonKing]:\n> > From my perspective, the crucial question is: What happens if one does `-lmtx`?\n\n> \n> On Linux at least, dynamic libraries (`.so`) take precendence. But I know that handling of libraries differs a lot between operating systems, so I cannot speak for non-Linux systems.\n\n\nThat means I have to use `--disable-static`. The whole point of this ticket is to provide a shared library, so that all parts of Sage that are using meataxe (matrix_gfpn_dense and in future also the modular group cohomology code) need to define certain global parameters only once per session, rather than once in each module. So, on a machine where static libraries have precedence, the code would break.",
    "created_at": "2017-12-27T12:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359677",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:42'></a>Replying to [comment:40 jdemeyer]:
> Replying to [comment:38 SimonKing]:
> > From my perspective, the crucial question is: What happens if one does `-lmtx`?

> 
> On Linux at least, dynamic libraries (`.so`) take precendence. But I know that handling of libraries differs a lot between operating systems, so I cannot speak for non-Linux systems.


That means I have to use `--disable-static`. The whole point of this ticket is to provide a shared library, so that all parts of Sage that are using meataxe (matrix_gfpn_dense and in future also the modular group cohomology code) need to define certain global parameters only once per session, rather than once in each module. So, on a machine where static libraries have precedence, the code would break.



---

archive/issue_comments_359678.json:
```json
{
    "body": "<a id='comment:43'></a>I am stuck with the question: How to build the documentation using autotools?\n\nIn \"Autotools - A practitioner's guide...\", the description on doxygen was obscure to me, and web search also didn't help me to understand what needs to be done.\n\nFor reference, here is the doc related part of the original Makefile:\n\n```Makefile\n# ------------------------------------------------------------------------------\n# Documentation\n# ------------------------------------------------------------------------------\n\n.PHONY: doc\n\nrebuild-doc:\n\trm -rf doc\n\tmkdir -p doc\n\tdoxygen etc/Doxyfile >/dev/null\n\ndoc: doc/index.html\n\ndoc/index.html: etc/Doxyfile $(PROGRAMS:%=src/%.c) $(LIB_OBJS:%=src/%.c) src/meataxe.h src/meataxe.doc src/changelog.doc\n\tmkdir -p doc\n\tdoxygen etc/Doxyfile >/dev/null\n```\n\nHow can one check for the presence of doxygen? How can one translate the above into an appropriate Makefile.am that should probably reside in doc/?",
    "created_at": "2017-12-27T13:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359678",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:43'></a>I am stuck with the question: How to build the documentation using autotools?

In "Autotools - A practitioner's guide...", the description on doxygen was obscure to me, and web search also didn't help me to understand what needs to be done.

For reference, here is the doc related part of the original Makefile:

```Makefile
# ------------------------------------------------------------------------------
# Documentation
# ------------------------------------------------------------------------------

.PHONY: doc

rebuild-doc:
	rm -rf doc
	mkdir -p doc
	doxygen etc/Doxyfile >/dev/null

doc: doc/index.html

doc/index.html: etc/Doxyfile $(PROGRAMS:%=src/%.c) $(LIB_OBJS:%=src/%.c) src/meataxe.h src/meataxe.doc src/changelog.doc
	mkdir -p doc
	doxygen etc/Doxyfile >/dev/null
```

How can one check for the presence of doxygen? How can one translate the above into an appropriate Makefile.am that should probably reside in doc/?



---

archive/issue_comments_359679.json:
```json
{
    "body": "<a id='comment:44'></a>If found [a macro to check for doxygen](http://www.gnu.org/software/autoconf-archive/ax_prog_doxygen.html#ax_prog_doxygen) at the Autoconf archive. Do I understand correctly that I am supposed to copy that macro into the m4/ directory of my package in order to use it?",
    "created_at": "2017-12-27T13:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359679",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:44'></a>If found [a macro to check for doxygen](http://www.gnu.org/software/autoconf-archive/ax_prog_doxygen.html#ax_prog_doxygen) at the Autoconf archive. Do I understand correctly that I am supposed to copy that macro into the m4/ directory of my package in order to use it?



---

archive/issue_comments_359680.json:
```json
{
    "body": "<a id='comment:45'></a>I don't know if this is an autotools question or a doxygen question.\n\nI am now able to get a make target \"doxygen-doc\". It somehow creates a documentation, but unfortunately I meet three problems:\n- The html pages created by doxygen are not as thorough as with the original MeatAxe. Namely, the data structures are documented, but the modules are not, and also the main page is basically empty.\n- When trying to build the pdf documentation, latex complains about a missing file `refman.tex`. Am I supposed to create that file? Is it supposed to be autogenerated? Why is it not autogenerated? I am a bit stuck.\n- `make uninstall` does not remove the created documentation.\n\nIn relation with doxygen, this is what I did:\n- In configure.ac:\n  {{{\nDX_INIT_DOXYGEN([shared_meataxe], [$(top_srcdir)/etc/Doxyfile], [doc])\nDX_DOXYGEN_FEATURE(ON)\n  }}}\n- In Makefile.am:\n  {{{\n`@`DX_RULES`@`\n\nMOSTLYCLEANFILES = DX_CLEANFILES\n  }}}\n\nThe Makefile generated by autotools/configure is then calling doxygen with these environment variables:\n\n```\nSRCDIR='../autoconfiscate' PROJECT='shared_meataxe' VERSION='1.0' PERL_PATH='/usr/bin/perl' HAVE_DOT='NO' GENERATE_MAN='NO' GENERATE_RTF='NO' GENERATE_XML='NO' GENERATE_HTMLHELP='NO' GENERATE_CHI='NO' GENERATE_HTML='YES' GENERATE_LATEX='YES'\n```\n\nDo you have an idea what is the point about the obscure `refman.tex`, why some stuff's documentation is created but other stuff's isn't, why the main doc page is empty and why the doc files aren't uninstalled?",
    "created_at": "2017-12-27T17:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359680",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:45'></a>I don't know if this is an autotools question or a doxygen question.

I am now able to get a make target "doxygen-doc". It somehow creates a documentation, but unfortunately I meet three problems:
- The html pages created by doxygen are not as thorough as with the original MeatAxe. Namely, the data structures are documented, but the modules are not, and also the main page is basically empty.
- When trying to build the pdf documentation, latex complains about a missing file `refman.tex`. Am I supposed to create that file? Is it supposed to be autogenerated? Why is it not autogenerated? I am a bit stuck.
- `make uninstall` does not remove the created documentation.

In relation with doxygen, this is what I did:
- In configure.ac:
  {{{
DX_INIT_DOXYGEN([shared_meataxe], [$(top_srcdir)/etc/Doxyfile], [doc])
DX_DOXYGEN_FEATURE(ON)
  }}}
- In Makefile.am:
  {{{
`@`DX_RULES`@`

MOSTLYCLEANFILES = DX_CLEANFILES
  }}}

The Makefile generated by autotools/configure is then calling doxygen with these environment variables:

```
SRCDIR='../autoconfiscate' PROJECT='shared_meataxe' VERSION='1.0' PERL_PATH='/usr/bin/perl' HAVE_DOT='NO' GENERATE_MAN='NO' GENERATE_RTF='NO' GENERATE_XML='NO' GENERATE_HTMLHELP='NO' GENERATE_CHI='NO' GENERATE_HTML='YES' GENERATE_LATEX='YES'
```

Do you have an idea what is the point about the obscure `refman.tex`, why some stuff's documentation is created but other stuff's isn't, why the main doc page is empty and why the doc files aren't uninstalled?



---

archive/issue_comments_359681.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 SimonKing]:\n> {{{\n> SRCDIR='../autoconfiscate' PROJECT='shared_meataxe' VERSION='1.0' PERL_PATH='/usr/bin/perl' HAVE_DOT='NO' GENERATE_MAN='NO' GENERATE_RTF='NO' GENERATE_XML='NO' GENERATE_HTMLHELP='NO' GENERATE_CHI='NO' GENERATE_HTML='YES' GENERATE_LATEX='YES'\n> }}}\n\n\nNote that `SRCDIR='../autoconfiscate'` sounds odd to me. The C sources are in fact in `../autoconfiscate/src`. However, when I manually edited the Makefile so that SRCDIR got a seemingly better definition, the modules have still not been documented.\n\nSo, where is one supposed to state (1) what .c and .h files are to be considered by doxygen, and (2) what file is the main doc page to be taken from?",
    "created_at": "2017-12-27T17:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359681",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:46'></a>Replying to [comment:45 SimonKing]:
> {{{
> SRCDIR='../autoconfiscate' PROJECT='shared_meataxe' VERSION='1.0' PERL_PATH='/usr/bin/perl' HAVE_DOT='NO' GENERATE_MAN='NO' GENERATE_RTF='NO' GENERATE_XML='NO' GENERATE_HTMLHELP='NO' GENERATE_CHI='NO' GENERATE_HTML='YES' GENERATE_LATEX='YES'
> }}}


Note that `SRCDIR='../autoconfiscate'` sounds odd to me. The C sources are in fact in `../autoconfiscate/src`. However, when I manually edited the Makefile so that SRCDIR got a seemingly better definition, the modules have still not been documented.

So, where is one supposed to state (1) what .c and .h files are to be considered by doxygen, and (2) what file is the main doc page to be taken from?



---

archive/issue_comments_359682.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:41 SimonKing]:\n> SharedMeatAxe is the package name that I currently propose. Dima suggested AutoMeatAxe. However, I prefer a name that indicates what the package provides (namely: A shared MeatAxe library) over a name that tells how the package is built (namely: With autotools).\n\n\nIt doesn't matter how you call your package. The header file doesn't depend on whether it's plain old MeatAxe or SharedMeatAxe or AutoMeatAxe. So I simply wouldn't change the header file name or location.",
    "created_at": "2017-12-27T18:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359682",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>Replying to [comment:41 SimonKing]:
> SharedMeatAxe is the package name that I currently propose. Dima suggested AutoMeatAxe. However, I prefer a name that indicates what the package provides (namely: A shared MeatAxe library) over a name that tells how the package is built (namely: With autotools).


It doesn't matter how you call your package. The header file doesn't depend on whether it's plain old MeatAxe or SharedMeatAxe or AutoMeatAxe. So I simply wouldn't change the header file name or location.



---

archive/issue_comments_359683.json:
```json
{
    "body": "<a id='comment:48'></a>The setting is:\n- I have a directory in which I build the package: `~/Projekte/Meataxe/build`.\n- The configure script resides in `~/Projekte/Meataxe/autoconfiscate`\n- The C sources are in `~/Projekte/Meataxe/autoconfiscate/src`\n- The Doxygen file is in `~/Projekte/Meataxe/autoconfiscate/etc`\n\nWhen doing `make doxygen-doc`, I see\n\n```\nerror: the type 'dirs' is not supported for the entry tag within a navindex! Check your layout file!\n```\nLater, it says\n\n```\nPreprocessing /home/king/Projekte/MeatAxe/build/config.h...\nParsing file /home/king/Projekte/MeatAxe/build/config.h...\nPreprocessing /home/king/Projekte/MeatAxe/build/include/meataxe.h...\nParsing file /home/king/Projekte/MeatAxe/build/include/meataxe.h...\n```\nwhich probably explains why some documentation is in fact created.\n\nAnd then, latex starts:\n\n```\nwriting tag file...\nlookup cache used 523/65536 hits=1630 misses=530\nfinished...\necho Timestamp >doc/shared_meataxe.tag\ncd doc/latex; \\\nrm -f *.aux *.toc *.idx *.ind *.ilg *.log *.out; \\\n/usr/bin/latex refman.tex; \\\n/usr/bin/makeindex refman.idx; \\\n/usr/bin/latex refman.tex; \\\ncountdown=5; \\\n```\n\nIf refman.tex is expected, but not provided, I suppose that upstream didn't want pdf documentation to be created. The documentation that is shipped with the upstream meataxe package is html only.\n\nHowever, I don't understand how to make doxygen consider the whole src directory, rather than only config.h and meataxe.h",
    "created_at": "2017-12-27T18:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359683",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:48'></a>The setting is:
- I have a directory in which I build the package: `~/Projekte/Meataxe/build`.
- The configure script resides in `~/Projekte/Meataxe/autoconfiscate`
- The C sources are in `~/Projekte/Meataxe/autoconfiscate/src`
- The Doxygen file is in `~/Projekte/Meataxe/autoconfiscate/etc`

When doing `make doxygen-doc`, I see

```
error: the type 'dirs' is not supported for the entry tag within a navindex! Check your layout file!
```
Later, it says

```
Preprocessing /home/king/Projekte/MeatAxe/build/config.h...
Parsing file /home/king/Projekte/MeatAxe/build/config.h...
Preprocessing /home/king/Projekte/MeatAxe/build/include/meataxe.h...
Parsing file /home/king/Projekte/MeatAxe/build/include/meataxe.h...
```
which probably explains why some documentation is in fact created.

And then, latex starts:

```
writing tag file...
lookup cache used 523/65536 hits=1630 misses=530
finished...
echo Timestamp >doc/shared_meataxe.tag
cd doc/latex; \
rm -f *.aux *.toc *.idx *.ind *.ilg *.log *.out; \
/usr/bin/latex refman.tex; \
/usr/bin/makeindex refman.idx; \
/usr/bin/latex refman.tex; \
countdown=5; \
```

If refman.tex is expected, but not provided, I suppose that upstream didn't want pdf documentation to be created. The documentation that is shipped with the upstream meataxe package is html only.

However, I don't understand how to make doxygen consider the whole src directory, rather than only config.h and meataxe.h



---

archive/issue_comments_359684.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:47 jdemeyer]:\n> It doesn't matter how you call your package. The header file doesn't depend on whether it's plain old MeatAxe or SharedMeatAxe or AutoMeatAxe. So I simply wouldn't change the header file name or location.\n\n\n1. I didn't intend to change the name of the header file.\n2. At some stage, my Makefile.am used `pkginclude_HEADERS`, and thus autotools has put meataxe.h into `local/include/$PACKAGE_NAME/`. However, I changed it to `include_HEADERS`, so that the header now goes directly into `local/include`. So, problem vanished.\n3. The package needs to have *some* name. I prefer SharedMeatAxe over AutoMeatAxe, but I'm open for better suggestions.",
    "created_at": "2017-12-27T18:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359684",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:49'></a>Replying to [comment:47 jdemeyer]:
> It doesn't matter how you call your package. The header file doesn't depend on whether it's plain old MeatAxe or SharedMeatAxe or AutoMeatAxe. So I simply wouldn't change the header file name or location.


1. I didn't intend to change the name of the header file.
2. At some stage, my Makefile.am used `pkginclude_HEADERS`, and thus autotools has put meataxe.h into `local/include/$PACKAGE_NAME/`. However, I changed it to `include_HEADERS`, so that the header now goes directly into `local/include`. So, problem vanished.
3. The package needs to have *some* name. I prefer SharedMeatAxe over AutoMeatAxe, but I'm open for better suggestions.



---

archive/issue_comments_359685.json:
```json
{
    "body": "<a id='comment:50'></a>Concerning \"type 'dirs' is not supported\", I find the following matches for \"dirs\" in etc/ (where the doxygen layout file resides):\n\n```\netc/layout.xml:    <tab type=\"dirs\" visible=\"yes\" title=\"\"/>\netc/layout.xml:      <dirs visible=\"yes\" title=\"\"/>\netc/layout.xml:      <dirs visible=\"yes\"/>\n```",
    "created_at": "2017-12-27T18:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359685",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:50'></a>Concerning "type 'dirs' is not supported", I find the following matches for "dirs" in etc/ (where the doxygen layout file resides):

```
etc/layout.xml:    <tab type="dirs" visible="yes" title=""/>
etc/layout.xml:      <dirs visible="yes" title=""/>
etc/layout.xml:      <dirs visible="yes"/>
```



---

archive/issue_comments_359686.json:
```json
{
    "body": "<a id='comment:51'></a>Are you able to build the docs in the original package?\nIt could be that the original package does not work with the up-to-date doxygen;\nif you google for the error message `the type 'dirs' is not supported for the entry tag within a navindex!` you will see that it might be due to a (relatively) recent doxygen update. \n\nPerhaps simply removing these `dirs` directives in `etc/layout.xml` will do the trick.",
    "created_at": "2017-12-27T19:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359686",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>Are you able to build the docs in the original package?
It could be that the original package does not work with the up-to-date doxygen;
if you google for the error message `the type 'dirs' is not supported for the entry tag within a navindex!` you will see that it might be due to a (relatively) recent doxygen update. 

Perhaps simply removing these `dirs` directives in `etc/layout.xml` will do the trick.



---

archive/issue_comments_359687.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:51 dimpase]:\n> Are you able to build the docs in the original package?\n\n\nYes, I just tested it. I need to be in the top-level directory. I simply did\n\n```\n$ doxygen etc/Doxyfile\n```\nThen, html documentation was created in the ./doc/ folder, using all the files from the ./src/ folder. \n\nSo, I guess the question is how to achieve that automake is issuing the doxygen command in the top-level directory of the source tree (NOT in src/, but one level above src/, and also not in the build/ directory).\n\n> It could be that the original package does not work with the up-to-date doxygen;\n> if you google for the error message `the type 'dirs' is not supported for the entry tag within a navindex!` you will see that it might be due to a (relatively) recent doxygen update. \n\n\nYes, the error occurs with the upstream package as well. However, the \"error\" is more a warning, as the documentation still builds in a useful way.\n\nBy the way, did you understand how the layout file is supposed to change? Because I didn't.",
    "created_at": "2017-12-27T19:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359687",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:52'></a>Replying to [comment:51 dimpase]:
> Are you able to build the docs in the original package?


Yes, I just tested it. I need to be in the top-level directory. I simply did

```
$ doxygen etc/Doxyfile
```
Then, html documentation was created in the ./doc/ folder, using all the files from the ./src/ folder. 

So, I guess the question is how to achieve that automake is issuing the doxygen command in the top-level directory of the source tree (NOT in src/, but one level above src/, and also not in the build/ directory).

> It could be that the original package does not work with the up-to-date doxygen;
> if you google for the error message `the type 'dirs' is not supported for the entry tag within a navindex!` you will see that it might be due to a (relatively) recent doxygen update. 


Yes, the error occurs with the upstream package as well. However, the "error" is more a warning, as the documentation still builds in a useful way.

By the way, did you understand how the layout file is supposed to change? Because I didn't.



---

archive/issue_comments_359688.json:
```json
{
    "body": "<a id='comment:53'></a>Replying to [comment:52 SimonKing]:\n> Replying to [comment:51 dimpase]:\n> > Are you able to build the docs in the original package?\n\n> \n> Yes, I just tested it. I need to be in the top-level directory. I simply did\n> \n> ```\n> $ doxygen etc/Doxyfile\n> ```\n> Then, html documentation was created in the ./doc/ folder, using all the files from the ./src/ folder. \n> \n> So, I guess the question is how to achieve that automake is issuing the doxygen command in the top-level directory of the source tree (NOT in src/, but one level above src/, and also not in the build/ directory).\n\n\nIMHO, you don't need to tweak autoconf stuff for this, you need to tweak Doxyfile\nto have `INPUT = ` specifying directories you need to process.\n\n\n> By the way, did you understand how the layout file is supposed to change? Because I didn't.\n\n\nI've never used Doxygen...",
    "created_at": "2017-12-27T20:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359688",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:53'></a>Replying to [comment:52 SimonKing]:
> Replying to [comment:51 dimpase]:
> > Are you able to build the docs in the original package?

> 
> Yes, I just tested it. I need to be in the top-level directory. I simply did
> 
> ```
> $ doxygen etc/Doxyfile
> ```
> Then, html documentation was created in the ./doc/ folder, using all the files from the ./src/ folder. 
> 
> So, I guess the question is how to achieve that automake is issuing the doxygen command in the top-level directory of the source tree (NOT in src/, but one level above src/, and also not in the build/ directory).


IMHO, you don't need to tweak autoconf stuff for this, you need to tweak Doxyfile
to have `INPUT = ` specifying directories you need to process.


> By the way, did you understand how the layout file is supposed to change? Because I didn't.


I've never used Doxygen...



---

archive/issue_comments_359689.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [comment:53 dimpase]:\n> IMHO, you don't need to tweak autoconf stuff for this, you need to tweak Doxyfile\n> to have `INPUT = ` specifying directories you need to process.\n\n\nYou are right! Upstream says `INPUT = .`. But when I change it to\n\n```\nINPUT                  = $(SRCDIR)\n```\nthen the html doc build fine.\n\nHowever, the pdf documentation is not available. I guess that's because refman.tex is not automatically generated by doxygen (which I find strange).\n\nCan you tell me how I can achieve that `make uninstall` removes the documentation?\n\nAnyway: Next problem is solved! Now I can turn towards the test suite.",
    "created_at": "2017-12-27T21:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359689",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:54'></a>Replying to [comment:53 dimpase]:
> IMHO, you don't need to tweak autoconf stuff for this, you need to tweak Doxyfile
> to have `INPUT = ` specifying directories you need to process.


You are right! Upstream says `INPUT = .`. But when I change it to

```
INPUT                  = $(SRCDIR)
```
then the html doc build fine.

However, the pdf documentation is not available. I guess that's because refman.tex is not automatically generated by doxygen (which I find strange).

Can you tell me how I can achieve that `make uninstall` removes the documentation?

Anyway: Next problem is solved! Now I can turn towards the test suite.



---

archive/issue_comments_359690.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:54 SimonKing]:\n> Can you tell me how I can achieve that `make uninstall` removes the documentation?\n\n\nAnother problem:\nSo far I am unable to convince doxygen that it is NOT supposed to try and apply LaTeX on the documentation. Also, I am unable to convince doxygen to create the documentation in a directory different from `$(prefix)/doc`.\n\nI tried to put\n\n```\nDX_INIT_DOXYGEN([shared_meataxe], [$(top_srcdir)/etc/Doxyfile], [$(docdir)])\n```\nand was configuring with `--docdir=...`, but the html documentation was still built in doc/, not in the folder that I indicated by `--docdir` --- however, a certain tag was attempted to create in `$(docdir)`, which failed!\n\nAny idea?",
    "created_at": "2017-12-27T21:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359690",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:55'></a>Replying to [comment:54 SimonKing]:
> Can you tell me how I can achieve that `make uninstall` removes the documentation?


Another problem:
So far I am unable to convince doxygen that it is NOT supposed to try and apply LaTeX on the documentation. Also, I am unable to convince doxygen to create the documentation in a directory different from `$(prefix)/doc`.

I tried to put

```
DX_INIT_DOXYGEN([shared_meataxe], [$(top_srcdir)/etc/Doxyfile], [$(docdir)])
```
and was configuring with `--docdir=...`, but the html documentation was still built in doc/, not in the folder that I indicated by `--docdir` --- however, a certain tag was attempted to create in `$(docdir)`, which failed!

Any idea?



---

archive/issue_comments_359691.json:
```json
{
    "body": "<a id='comment:56'></a>Very very odd: Although Doxyfile says `GENERATE_LATEX='NO'`, autotools is still calling doxygen with `GENERATE_LATEX='YES'`.",
    "created_at": "2017-12-27T21:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359691",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:56'></a>Very very odd: Although Doxyfile says `GENERATE_LATEX='NO'`, autotools is still calling doxygen with `GENERATE_LATEX='YES'`.



---

archive/issue_comments_359692.json:
```json
{
    "body": "<a id='comment:57'></a>Solved it! Apparently `DX_INIT` needs to be called *after* `DX_..._FEATURE`.",
    "created_at": "2017-12-27T21:26:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359692",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:57'></a>Solved it! Apparently `DX_INIT` needs to be called *after* `DX_..._FEATURE`.



---

archive/issue_comments_359693.json:
```json
{
    "body": "<a id='comment:58'></a>There remain these problems: Documentation is not uninstalled and I cannot prescribe a directory name different from doc/.",
    "created_at": "2017-12-27T21:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359693",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:58'></a>There remain these problems: Documentation is not uninstalled and I cannot prescribe a directory name different from doc/.



---

archive/issue_comments_359694.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [comment:58 SimonKing]:\n> There remain these problems: Documentation is not uninstalled\n\n\nStill unsolved\n\n> and I cannot prescribe a directory name different from doc/.\n\n\nDone: Define `OUTPUT_DIRECTORY       = $(DOCDIR)` in Doxyfile, and then `configure --docdir=...` works.",
    "created_at": "2017-12-27T22:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359694",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:59'></a>Replying to [comment:58 SimonKing]:
> There remain these problems: Documentation is not uninstalled


Still unsolved

> and I cannot prescribe a directory name different from doc/.


Done: Define `OUTPUT_DIRECTORY       = $(DOCDIR)` in Doxyfile, and then `configure --docdir=...` works.



---

archive/issue_comments_359695.json:
```json
{
    "body": "<a id='comment:60'></a>Replying to [comment:59 SimonKing]:\n> Replying to [comment:58 SimonKing]:\n> > There remain these problems: Documentation is not uninstalled\n\n> \n> Still unsolved\n> \n> > and I cannot prescribe a directory name different from doc/.\n\n> \n> Done: Define `OUTPUT_DIRECTORY       = $(DOCDIR)` in Doxyfile, and then `configure --docdir=...` works.\n\n\nAs far as I can see, the 3rd parameter of DX_INIT_DOXYGEN controls the output directory.",
    "created_at": "2017-12-27T22:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359695",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:60'></a>Replying to [comment:59 SimonKing]:
> Replying to [comment:58 SimonKing]:
> > There remain these problems: Documentation is not uninstalled

> 
> Still unsolved
> 
> > and I cannot prescribe a directory name different from doc/.

> 
> Done: Define `OUTPUT_DIRECTORY       = $(DOCDIR)` in Doxyfile, and then `configure --docdir=...` works.


As far as I can see, the 3rd parameter of DX_INIT_DOXYGEN controls the output directory.



---

archive/issue_comments_359696.json:
```json
{
    "body": "<a id='comment:61'></a>Replying to [comment:60 dimpase]:\n> As far as I can see, the 3rd parameter of DX_INIT_DOXYGEN controls the output directory.\n\n\nI thought so. But in fact, it seems that it only controls where to put certain \"tags\". But the actual location of the documentation is determined by the OUTPUT_DIRECTORY variable defined in Doxyfile.",
    "created_at": "2017-12-27T22:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359696",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:61'></a>Replying to [comment:60 dimpase]:
> As far as I can see, the 3rd parameter of DX_INIT_DOXYGEN controls the output directory.


I thought so. But in fact, it seems that it only controls where to put certain "tags". But the actual location of the documentation is determined by the OUTPUT_DIRECTORY variable defined in Doxyfile.



---

archive/issue_comments_359697.json:
```json
{
    "body": "<a id='comment:62'></a>For the record: I am now also fixing MeatAxe's documentation: Most doxygen sections are incorrectly created: The first word after `@`section is supposed to be a globally unique section label, if I understand correctly, but upstream just start with what is supposed to be the section title, or starts with a non-unique label.\n\nAlso, they are still documenting a stand-alone program for the creation of multiplication tables, that was removed.\n\nThe more upstream bugs I am fixing, the more I think it is justified to say that I am forking MeatAxe.",
    "created_at": "2017-12-28T09:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359697",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:62'></a>For the record: I am now also fixing MeatAxe's documentation: Most doxygen sections are incorrectly created: The first word after `@`section is supposed to be a globally unique section label, if I understand correctly, but upstream just start with what is supposed to be the section title, or starts with a non-unique label.

Also, they are still documenting a stand-alone program for the creation of multiplication tables, that was removed.

The more upstream bugs I am fixing, the more I think it is justified to say that I am forking MeatAxe.



---

archive/issue_comments_359698.json:
```json
{
    "body": "<a id='comment:63'></a>I am now done with the docs and making some progress with getting the test suite to run.\n\nAutomake would run several test scripts in parallel, which I'm OK with. However, upstream doesn't seem to think of parallel tests: Several test scripts write test data into local files WITH THE SAME NAME.\n\nSolution: I want to create a sub-directory for each individual test. That sub-directory should be created with `mkdir -p`. However, `mkdir -p` is (if I understand correctly) not available on all supported platforms.\n\nWhen I put `AC_PROG_MKDIR_P` into configure.ac, then the variable `MKDIR_P` gets defined into the resulting Makefile. However, `MKDIR_P` is not visible for the test scripts.\n\nSo, what shall I do?\n- Use `mkdir -p` in my test scripts, although it may not be fully portable?\n- How can I obtain an environment variable for `MKDIR_P` that the test scripts can use?",
    "created_at": "2017-12-29T11:17:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359698",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:63'></a>I am now done with the docs and making some progress with getting the test suite to run.

Automake would run several test scripts in parallel, which I'm OK with. However, upstream doesn't seem to think of parallel tests: Several test scripts write test data into local files WITH THE SAME NAME.

Solution: I want to create a sub-directory for each individual test. That sub-directory should be created with `mkdir -p`. However, `mkdir -p` is (if I understand correctly) not available on all supported platforms.

When I put `AC_PROG_MKDIR_P` into configure.ac, then the variable `MKDIR_P` gets defined into the resulting Makefile. However, `MKDIR_P` is not visible for the test scripts.

So, what shall I do?
- Use `mkdir -p` in my test scripts, although it may not be fully portable?
- How can I obtain an environment variable for `MKDIR_P` that the test scripts can use?



---

archive/issue_comments_359699.json:
```json
{
    "body": "<a id='comment:64'></a>Replying to [comment:63 SimonKing]:\n> When I put `AC_PROG_MKDIR_P` into configure.ac, then the variable `MKDIR_P` gets defined into the resulting Makefile. However, `MKDIR_P` is not visible for the test scripts.\n\n\nI found something that works:\n- In my Makefile.am, I define check-local and let it create a little script that exports MKDIR_P\n- In the tests, I first let that script be executed, and by consequence the variable is then available.\n\nIs there a more elegant solution, or is creating a custom temporary script fine?",
    "created_at": "2017-12-29T11:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359699",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:64'></a>Replying to [comment:63 SimonKing]:
> When I put `AC_PROG_MKDIR_P` into configure.ac, then the variable `MKDIR_P` gets defined into the resulting Makefile. However, `MKDIR_P` is not visible for the test scripts.


I found something that works:
- In my Makefile.am, I define check-local and let it create a little script that exports MKDIR_P
- In the tests, I first let that script be executed, and by consequence the variable is then available.

Is there a more elegant solution, or is creating a custom temporary script fine?



---

archive/issue_comments_359700.json:
```json
{
    "body": "<a id='comment:65'></a>You can call `$(MKDIR_P)$ in the makefile, why would you need to call it from your scripts? You can also export it in the makefile, why would you need a script for it? \n\nHowever, it seems that you rather want to create temporary directories/files directly, make tests output to stdout, and redirect it to temporary files.",
    "created_at": "2017-12-29T14:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359700",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:65'></a>You can call `$(MKDIR_P)$ in the makefile, why would you need to call it from your scripts? You can also export it in the makefile, why would you need a script for it? 

However, it seems that you rather want to create temporary directories/files directly, make tests output to stdout, and redirect it to temporary files.



---

archive/issue_comments_359701.json:
```json
{
    "body": "<a id='comment:66'></a>Replying to [comment:65 dimpase]:\n> You can call `$(MKDIR_P)$ in the makefile, why would you need to call it from your scripts? You can also export it in the makefile, why would you need a script for it?\n\n\nLet's define what we mean by \"scripts\". In the first place, I am talking about \"test scripts\". They are essential for the test suite.\n\nIn order to be able to run tests in parallel, it is essential that each test script has its own directory in which it stores its results. Hence, my aim was that each test script creates such a directory, named `test_$$`, where as usual `$$` provides the PID of a script.\n\nOf course, the Makefile is unaware of the PIDs of the test scripts. Therefore, Makefile can not be made responsible for creation of the directories. By consequence, I need that `mkdir -p` works IN THE TEST SCRIPTS.\n\nExporting MKDIR_P in the Makefile simply doesn't work. That was the first thing I tried, but the corresponding environment variable isn't visible for the test scripts.\n\nHence, my solution: Makefile creates a helper script that exports MKDIR_P (of course, Makefile is able to dump the value of that variable into the script!), and each test script sources the helper script. Problem solved.\n\nActually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.\n\nSo, it basically is ready for publication.\n\n> However, it seems that you rather want to create temporary directories/files directly, make tests output to stdout, and redirect it to temporary files.\n\n\nNo. It is not about text written to stdout. The MeatAxe test suite is testing executables, that read input from data files, and write output into data files. So, during parallel tests, it must not happen that several tests have output data files of the same name. Hence, the need to use a temporary directory.",
    "created_at": "2017-12-29T14:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359701",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:66'></a>Replying to [comment:65 dimpase]:
> You can call `$(MKDIR_P)$ in the makefile, why would you need to call it from your scripts? You can also export it in the makefile, why would you need a script for it?


Let's define what we mean by "scripts". In the first place, I am talking about "test scripts". They are essential for the test suite.

In order to be able to run tests in parallel, it is essential that each test script has its own directory in which it stores its results. Hence, my aim was that each test script creates such a directory, named `test_$$`, where as usual `$$` provides the PID of a script.

Of course, the Makefile is unaware of the PIDs of the test scripts. Therefore, Makefile can not be made responsible for creation of the directories. By consequence, I need that `mkdir -p` works IN THE TEST SCRIPTS.

Exporting MKDIR_P in the Makefile simply doesn't work. That was the first thing I tried, but the corresponding environment variable isn't visible for the test scripts.

Hence, my solution: Makefile creates a helper script that exports MKDIR_P (of course, Makefile is able to dump the value of that variable into the script!), and each test script sources the helper script. Problem solved.

Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.

So, it basically is ready for publication.

> However, it seems that you rather want to create temporary directories/files directly, make tests output to stdout, and redirect it to temporary files.


No. It is not about text written to stdout. The MeatAxe test suite is testing executables, that read input from data files, and write output into data files. So, during parallel tests, it must not happen that several tests have output data files of the same name. Hence, the need to use a temporary directory.



---

archive/issue_comments_359702.json:
```json
{
    "body": "<a id='comment:67'></a>Replying to [comment:66 SimonKing]:\n> In order to be able to run tests in parallel, it is essential that each test script has its own directory in which it stores its results. Hence, my aim was that each test script creates such a directory, named `test_$$`, where as usual `$$` provides the PID of a script.\n> \n> Of course, the Makefile is unaware of the PIDs of the test scripts. Therefore, Makefile can not be made responsible for creation of the directories. By consequence, I need that `mkdir -p` works IN THE TEST SCRIPTS.\n> \n> Exporting MKDIR_P in the Makefile simply doesn't work. That was the first thing I tried, but the corresponding environment variable isn't visible for the test scripts.\n> \n> Hence, my solution: Makefile creates a helper script that exports MKDIR_P (of course, Makefile is able to dump the value of that variable into the script!), and each test script sources the helper script. Problem solved.\n> \n> Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.\n> \n> So, it basically is ready for publication.\n> \n> > However, it seems that you rather want to create temporary directories/files directly, make tests output to stdout, and redirect it to temporary files.\n\n> \n> No. It is not about text written to stdout. The MeatAxe test suite is testing executables, that read input from data files, and write output into data files. So, during parallel tests, it must not happen that several tests have output data files of the same name. Hence, the need to use a temporary directory.\n\n\nOr perhaps I can really proceed differently. The name scheme for the test scripts is `t-0000`, `t-0001`, etc. So, the Makefile could create unique directories `test_0000`, `test_0001` etc, and then each script can cd into its designated directory and do its job.\n\nHowever, how to do this most easily using autotools?\n\nCurrently, the test suite is implemented like this in Makefile.am:\n\n```\nTESTS                 = zzztest t-0100 t-0000 \\\n\tt-0100 t-0100 t-0105 t-0106 t-0107 t-0108 t-0109 t-0110 t-0111 t-0112 \\\n\tt-0113 t-0114 t-0115 t-0116 t-0117 t-0118 t-0200 t-0201 t-0210 t-0211 \\\n\tt-0212 t-0213 t-0214 t-0215\n\ncheck-local:\n\t@echo \"CREATING ENV\"\n\t@echo 'export MKDIR_P=\"@MKDIR_P@\"' > MKDIR_P_ENV\n\t@chmod +x MKDIR_P_ENV\n```\nAs you can see, `make check` first creates the `MKDIR_P_ENV` helper script, and then calls all the test scripts `t-0100` etc., which in turn source the `MKDIR_P_ENV` helper script.\n\nI will now try to work with a list of numbers that are both used to generate the list of TESTS and a list of test directories.",
    "created_at": "2017-12-29T14:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359702",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:67'></a>Replying to [comment:66 SimonKing]:
> In order to be able to run tests in parallel, it is essential that each test script has its own directory in which it stores its results. Hence, my aim was that each test script creates such a directory, named `test_$$`, where as usual `$$` provides the PID of a script.
> 
> Of course, the Makefile is unaware of the PIDs of the test scripts. Therefore, Makefile can not be made responsible for creation of the directories. By consequence, I need that `mkdir -p` works IN THE TEST SCRIPTS.
> 
> Exporting MKDIR_P in the Makefile simply doesn't work. That was the first thing I tried, but the corresponding environment variable isn't visible for the test scripts.
> 
> Hence, my solution: Makefile creates a helper script that exports MKDIR_P (of course, Makefile is able to dump the value of that variable into the script!), and each test script sources the helper script. Problem solved.
> 
> Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.
> 
> So, it basically is ready for publication.
> 
> > However, it seems that you rather want to create temporary directories/files directly, make tests output to stdout, and redirect it to temporary files.

> 
> No. It is not about text written to stdout. The MeatAxe test suite is testing executables, that read input from data files, and write output into data files. So, during parallel tests, it must not happen that several tests have output data files of the same name. Hence, the need to use a temporary directory.


Or perhaps I can really proceed differently. The name scheme for the test scripts is `t-0000`, `t-0001`, etc. So, the Makefile could create unique directories `test_0000`, `test_0001` etc, and then each script can cd into its designated directory and do its job.

However, how to do this most easily using autotools?

Currently, the test suite is implemented like this in Makefile.am:

```
TESTS                 = zzztest t-0100 t-0000 \
	t-0100 t-0100 t-0105 t-0106 t-0107 t-0108 t-0109 t-0110 t-0111 t-0112 \
	t-0113 t-0114 t-0115 t-0116 t-0117 t-0118 t-0200 t-0201 t-0210 t-0211 \
	t-0212 t-0213 t-0214 t-0215

check-local:
	@echo "CREATING ENV"
	@echo 'export MKDIR_P="@MKDIR_P@"' > MKDIR_P_ENV
	@chmod +x MKDIR_P_ENV
```
As you can see, `make check` first creates the `MKDIR_P_ENV` helper script, and then calls all the test scripts `t-0100` etc., which in turn source the `MKDIR_P_ENV` helper script.

I will now try to work with a list of numbers that are both used to generate the list of TESTS and a list of test directories.



---

archive/issue_comments_359703.json:
```json
{
    "body": "<a id='comment:68'></a>Shouldn't the following work?\n\n```\nTestNumbers = 0100 0000 0100 0100 0105 0106 0107 0108 0109 0110 0111 0112 \\\n\t0113 0114 0115 0116 0117 0118 0200 0201 0210 0211 0212 0213 0214 0215\n\nTESTS                 = $(TestNumbers:%=t-%)\n```\n\nWell, it doesn't. Eventually, TESTS is the same as TestNumbers. Why?\n\nIn other words, given a list of strings separated by blanks, how can I prepend \"t-\" to each individual element of the list, in a Makefile?",
    "created_at": "2017-12-29T15:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359703",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:68'></a>Shouldn't the following work?

```
TestNumbers = 0100 0000 0100 0100 0105 0106 0107 0108 0109 0110 0111 0112 \
	0113 0114 0115 0116 0117 0118 0200 0201 0210 0211 0212 0213 0214 0215

TESTS                 = $(TestNumbers:%=t-%)
```

Well, it doesn't. Eventually, TESTS is the same as TestNumbers. Why?

In other words, given a list of strings separated by blanks, how can I prepend "t-" to each individual element of the list, in a Makefile?



---

archive/issue_comments_359704.json:
```json
{
    "body": "<a id='comment:69'></a>I could work around: I still don't know how to prepend something to the elements of a variable list - the above syntax that works fine in a Makefile doesn't work when used in Makefile.am.\n\nHowever, it seems to be possible to APPEND something to the elements of a variable list. Hence, for test script t-xxxx I am now using the folder t-xxxx_out, with the following syntax in Makefile.am:\n\n```\n@$(MKDIR_P) $(TESTNUMBERS:=_out)\n```\n\nAgain, the MeatAxe test suite passes, make clean works as it should, and I avoid the ugly hack of exporting MKDIR_P.\n\nNow, I should finally address Sage: How do I tell Sage that `./sage -i meataxe` is supposed to install `shared_meataxe-1.0`? Do I provide that information in checksum.ini?",
    "created_at": "2017-12-29T15:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359704",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:69'></a>I could work around: I still don't know how to prepend something to the elements of a variable list - the above syntax that works fine in a Makefile doesn't work when used in Makefile.am.

However, it seems to be possible to APPEND something to the elements of a variable list. Hence, for test script t-xxxx I am now using the folder t-xxxx_out, with the following syntax in Makefile.am:

```
@$(MKDIR_P) $(TESTNUMBERS:=_out)
```

Again, the MeatAxe test suite passes, make clean works as it should, and I avoid the ugly hack of exporting MKDIR_P.

Now, I should finally address Sage: How do I tell Sage that `./sage -i meataxe` is supposed to install `shared_meataxe-1.0`? Do I provide that information in checksum.ini?



---

archive/issue_comments_359705.json:
```json
{
    "body": "<a id='comment:70'></a>Is it ok to build the always install the documentation if the package gets installed? Could be a problem if doxygen is missing.\nOr should it only be installed, if `SAGE_SPKG_INSTALL=yes`?",
    "created_at": "2017-12-29T16:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359705",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:70'></a>Is it ok to build the always install the documentation if the package gets installed? Could be a problem if doxygen is missing.
Or should it only be installed, if `SAGE_SPKG_INSTALL=yes`?



---

archive/issue_comments_359706.json:
```json
{
    "body": "<a id='comment:71'></a>Is it fine to use `rm -f` in an install script, or is there some variable for it, such as `$(RM) -f`?",
    "created_at": "2017-12-29T16:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359706",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:71'></a>Is it fine to use `rm -f` in an install script, or is there some variable for it, such as `$(RM) -f`?



---

archive/issue_comments_359707.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:69 SimonKing]:\n> Now, I should finally address Sage: How do I tell Sage that `./sage -i meataxe` is supposed to install `shared_meataxe-1.0`? Do I provide that information in checksum.ini?\n\n\nYes.\n\nReplying to [comment:70 SimonKing]:\n> Is it ok to build the always install the documentation if the package gets installed?\n\n\nFine for me.\n\n> Could be a problem if doxygen is missing.\n\n\nThen don't build the documentation.\n\nReplying to [comment:71 SimonKing]:\n> Is it fine to use `rm -f` in an install script\n\n\nYes.",
    "created_at": "2017-12-29T20:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359707",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'></a>Replying to [comment:69 SimonKing]:
> Now, I should finally address Sage: How do I tell Sage that `./sage -i meataxe` is supposed to install `shared_meataxe-1.0`? Do I provide that information in checksum.ini?


Yes.

Replying to [comment:70 SimonKing]:
> Is it ok to build the always install the documentation if the package gets installed?


Fine for me.

> Could be a problem if doxygen is missing.


Then don't build the documentation.

Replying to [comment:71 SimonKing]:
> Is it fine to use `rm -f` in an install script


Yes.



---

archive/issue_comments_359708.json:
```json
{
    "body": "<a id='comment:73'></a>There is one test in sage.matrix.special that fails, but that's because of #23706. I opened #24445, but I think this shouldn't be a dependency: The failing test can be fixed without #24445.",
    "created_at": "2017-12-29T20:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359708",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:73'></a>There is one test in sage.matrix.special that fails, but that's because of #23706. I opened #24445, but I think this shouldn't be a dependency: The failing test can be fixed without #24445.



---

archive/issue_comments_359709.json:
```json
{
    "body": "<a id='comment:74'></a>Replying to [comment:66 SimonKing]:\n> Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.\n\n\nDon't forget `make distcheck`. That's the all-in-one autotools testsuite. If it passes that, you should be good to go.",
    "created_at": "2017-12-29T20:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359709",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:74'></a>Replying to [comment:66 SimonKing]:
> Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.


Don't forget `make distcheck`. That's the all-in-one autotools testsuite. If it passes that, you should be good to go.



---

archive/issue_comments_359710.json:
```json
{
    "body": "<a id='comment:76'></a>New commits:",
    "created_at": "2017-12-29T20:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359710",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:76'></a>New commits:



---

archive/issue_comments_359711.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -2,7 +2,18 @@\n \n So, purpose of this ticket: Change MeatAxe from static to dynamic.\n \n-Unfortunately, we aren't upstream for MeatAxe, but it should still be possible to add yet another patch (we already have 7) to `SAGE_ROOT/build/pkgs/meataxe/patches` that modifies MeatAxe's Makefile so that a dynamic library is built.\n+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.\n+\n+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)\n+- an autotools build system\n+- a shared library\n+- a test suite that can be run in parallel\n+- some bug fixes\n+- a speedup in echelon computation\n+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.\n+Also it fixes some errors in the documentation.\n+\n+The tarball of the fork is available at users.minet.uni-jena.de/cohomology/shared_meataxe-1.0.tar.gz\n \n Comment: 1\n \n```\n",
    "created_at": "2017-12-29T20:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359711",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
```diff
--- 
+++ 
@@ -2,7 +2,18 @@
 
 So, purpose of this ticket: Change MeatAxe from static to dynamic.
 
-Unfortunately, we aren't upstream for MeatAxe, but it should still be possible to add yet another patch (we already have 7) to `SAGE_ROOT/build/pkgs/meataxe/patches` that modifies MeatAxe's Makefile so that a dynamic library is built.
+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.
+
+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)
+- an autotools build system
+- a shared library
+- a test suite that can be run in parallel
+- some bug fixes
+- a speedup in echelon computation
+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.
+Also it fixes some errors in the documentation.
+
+The tarball of the fork is available at users.minet.uni-jena.de/cohomology/shared_meataxe-1.0.tar.gz
 
 Comment: 1
 
```




---

archive/issue_comments_359712.json:
```json
{
    "body": "<a id='comment:77'></a>Replying to [comment:74 jdemeyer]:\n> Replying to [comment:66 SimonKing]:\n> > Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.\n\n> \n> Don't forget `make distcheck`. That's the all-in-one autotools testsuite. If it passes that, you should be good to go.\n\n\nIt fails, but perhaps for an interesting reason: The test suite uses certain binaries. When the test suite is run during `make distcheck`, these binaries can't be found.\n\nWhy is that? Doesn't `make distcheck` do `make install`? Or do I need to append to PATH when running tests?",
    "created_at": "2017-12-29T20:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359712",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:77'></a>Replying to [comment:74 jdemeyer]:
> Replying to [comment:66 SimonKing]:
> > Actually, I now have a SharedMeatAxe 1.0 creating a dynamic library and executables; it passes the full MeatAxe test suite, can create docs, `make clean` works fine, and `make uninstall` removes both the binaries, the library and the docs.

> 
> Don't forget `make distcheck`. That's the all-in-one autotools testsuite. If it passes that, you should be good to go.


It fails, but perhaps for an interesting reason: The test suite uses certain binaries. When the test suite is run during `make distcheck`, these binaries can't be found.

Why is that? Doesn't `make distcheck` do `make install`? Or do I need to append to PATH when running tests?



---

archive/issue_comments_359713.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.\n \n+So, purpose of this ticket: Change MeatAxe from static to dynamic.\n+\n+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.\n+\n+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)\n+- an autotools build system\n+- a shared library\n+- a test suite that can be run in parallel\n+- some bug fixes\n+- a speedup in echelon computation\n+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.\n+Also it fixes some errors in the documentation.\n+\n+The tarball of the fork is available at http://users.minet.uni-jena.de/cohomology/shared_meataxe-1.0.tar.gz\n \n Comment: 1\n \n```\n",
    "created_at": "2017-12-29T20:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359713",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.
 
+So, purpose of this ticket: Change MeatAxe from static to dynamic.
+
+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.
+
+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)
+- an autotools build system
+- a shared library
+- a test suite that can be run in parallel
+- some bug fixes
+- a speedup in echelon computation
+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.
+Also it fixes some errors in the documentation.
+
+The tarball of the fork is available at http://users.minet.uni-jena.de/cohomology/shared_meataxe-1.0.tar.gz
 
 Comment: 1
 
```




---

archive/issue_comments_359714.json:
```json
{
    "body": "<a id='comment:79'></a>I can reproduce the problem with `make distcheck` as follows:\n- configure\n- make all\n- make check\n\nWhen I instead do\n- configure\n- make install\n- make check\n\nthen things work.\n\nI see that the missing binaries are built in src/ before being installed. So, is it a correct solution to add src/ to the PATH during the tests?",
    "created_at": "2017-12-29T20:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359714",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:79'></a>I can reproduce the problem with `make distcheck` as follows:
- configure
- make all
- make check

When I instead do
- configure
- make install
- make check

then things work.

I see that the missing binaries are built in src/ before being installed. So, is it a correct solution to add src/ to the PATH during the tests?



---

archive/issue_comments_359715.json:
```json
{
    "body": "<a id='comment:80'></a>Replying to [comment:79 SimonKing]:\n> So, is it a correct solution to add src/ to the PATH during the tests?\n\n\nIn any case, when I do so then `make distcheck` passes. So, I change the tarball accordingly.",
    "created_at": "2017-12-29T20:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359715",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:80'></a>Replying to [comment:79 SimonKing]:
> So, is it a correct solution to add src/ to the PATH during the tests?


In any case, when I do so then `make distcheck` passes. So, I change the tarball accordingly.



---

archive/issue_comments_359716.json:
```json
{
    "body": "<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-29T21:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359717.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,19 @@\n+Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.\n \n+So, purpose of this ticket: Change MeatAxe from static to dynamic.\n+\n+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.\n+\n+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)\n+- an autotools build system\n+- a shared library\n+- a test suite that can be run in parallel and passes `make distcheck`\n+- some bug fixes\n+- a speedup in echelon computation\n+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.\n+Also it fixes some errors in the documentation.\n+\n+The tarball of the fork is available at http://users.minet.uni-jena.de/cohomology/shared_meataxe-1.0.tar.gz\n \n Comment: 1\n \n```\n",
    "created_at": "2017-12-29T21:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359717",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,19 @@
+Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.
 
+So, purpose of this ticket: Change MeatAxe from static to dynamic.
+
+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.
+
+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)
+- an autotools build system
+- a shared library
+- a test suite that can be run in parallel and passes `make distcheck`
+- some bug fixes
+- a speedup in echelon computation
+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.
+Also it fixes some errors in the documentation.
+
+The tarball of the fork is available at http://users.minet.uni-jena.de/cohomology/shared_meataxe-1.0.tar.gz
 
 Comment: 1
 
```




---

archive/issue_comments_359718.json:
```json
{
    "body": "<a id='comment:82'></a>For now, I have fixed make distcheck by appending to the path. It works...\n\nNext, I will be running `make test` for Sage.",
    "created_at": "2017-12-29T21:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359718",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:82'></a>For now, I have fixed make distcheck by appending to the path. It works...

Next, I will be running `make test` for Sage.



---

archive/issue_comments_359719.json:
```json
{
    "body": "<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-29T21:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:83'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359720.json:
```json
{
    "body": "<a id='comment:84'></a>Sorry, I made a mistake and had to force-push. Now it should be fine.\n\n---\nNew commits:",
    "created_at": "2017-12-29T21:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359720",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:84'></a>Sorry, I made a mistake and had to force-push. Now it should be fine.

---
New commits:



---

archive/issue_comments_359721.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-30T00:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359721",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_359722.json:
```json
{
    "body": "<a id='comment:85'></a>Replying to [comment:84 SimonKing]:\n> Sorry, I made a mistake and had to force-push. Now it should be fine.\n\n\nIt is!\n\n```\n$ make test\n...\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 8579.6 seconds\n    cpu time: 6776.2 seconds\n    cumulative wall time: 8075.9 seconds\n```",
    "created_at": "2017-12-30T00:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359722",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:85'></a>Replying to [comment:84 SimonKing]:
> Sorry, I made a mistake and had to force-push. Now it should be fine.


It is!

```
$ make test
...
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 8579.6 seconds
    cpu time: 6776.2 seconds
    cumulative wall time: 8075.9 seconds
```



---

archive/issue_comments_359723.json:
```json
{
    "body": "<a id='comment:86'></a>You should use the standard template for `build/pkgs/meataxe/SPKG.txt`",
    "created_at": "2017-12-30T09:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359723",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:86'></a>You should use the standard template for `build/pkgs/meataxe/SPKG.txt`



---

archive/issue_comments_359724.json:
```json
{
    "body": "<a id='comment:87'></a>And `$SAGE_LOCAL` should be quoted in `spkg-install`.",
    "created_at": "2017-12-30T09:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359724",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:87'></a>And `$SAGE_LOCAL` should be quoted in `spkg-install`.



---

archive/issue_comments_359725.json:
```json
{
    "body": "<a id='comment:88'></a>This comment obviously needs to be changed:\n\n```\n###############################################################\n## It is needed to do some initialisation. Since meataxe is\n## a static library, it is needed to do this initialisation\n## by calling meataxe_init() in all modules calling MeatAxe\n## library functions\n```",
    "created_at": "2017-12-30T09:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359725",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:88'></a>This comment obviously needs to be changed:

```
###############################################################
## It is needed to do some initialisation. Since meataxe is
## a static library, it is needed to do this initialisation
## by calling meataxe_init() in all modules calling MeatAxe
## library functions
```



---

archive/issue_comments_359726.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T09:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359726",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359727.json:
```json
{
    "body": "<a id='comment:89'></a>In `spkg-install` files, you should use the new utility functions like `sdh_configure`. See `build/pkgs/ccache/spkg-install` for an example.",
    "created_at": "2017-12-30T09:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359727",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:89'></a>In `spkg-install` files, you should use the new utility functions like `sdh_configure`. See `build/pkgs/ccache/spkg-install` for an example.



---

archive/issue_comments_359728.json:
```json
{
    "body": "<a id='comment:90'></a>Replying to [comment:86 jdemeyer]:\n> You should use the standard template for `build/pkgs/meataxe/SPKG.txt`\n\n\nWhere do I find the standard template? I thought the information supposed to be provided by SPKG.txt is more or less what is written in the upstream README?",
    "created_at": "2017-12-30T09:26:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359728",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:90'></a>Replying to [comment:86 jdemeyer]:
> You should use the standard template for `build/pkgs/meataxe/SPKG.txt`


Where do I find the standard template? I thought the information supposed to be provided by SPKG.txt is more or less what is written in the upstream README?



---

archive/issue_comments_359729.json:
```json
{
    "body": "<a id='comment:91'></a>Replying to [comment:89 jdemeyer]:\n> In `spkg-install` files, you should use the new utility functions like `sdh_configure`. See `build/pkgs/ccache/spkg-install` for an example.\n\n\nWhy are these things always changing? I.e., why is one supposed to use an obscure function instead of using the easy-to-understand installation steps that a user would do? Also my past impression was that such utility functions tend to disappear in future Sage versions. Still remember the dev scripts?",
    "created_at": "2017-12-30T09:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359729",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:91'></a>Replying to [comment:89 jdemeyer]:
> In `spkg-install` files, you should use the new utility functions like `sdh_configure`. See `build/pkgs/ccache/spkg-install` for an example.


Why are these things always changing? I.e., why is one supposed to use an obscure function instead of using the easy-to-understand installation steps that a user would do? Also my past impression was that such utility functions tend to disappear in future Sage versions. Still remember the dev scripts?



---

archive/issue_comments_359730.json:
```json
{
    "body": "<a id='comment:92'></a>Replying to [comment:91 SimonKing]:\n> Replying to [comment:89 jdemeyer]:\n> > In `spkg-install` files, you should use the new utility functions like `sdh_configure`. See `build/pkgs/ccache/spkg-install` for an example.\n\n> \n> Why are these things always changing? I.e., why is one supposed to use an obscure function...\n\n\nREALLY obscure.\n\n- Why should I do `export CPPFLAGS=\"-I$SAGE_LOCAL/include $CPPFLAGS\"` if the **standard way to proceed** is to `configure --prefix=\"$SAGE_LOCAL\"`?\n- Where do sdh_* functions come from? Where are they documented?\n- What would possibly be the benefit of `sdh_make_install` over the standard `$MAKE install`? The latter is even shorter!\n\nSorry, I am escalating myself into a rant. So far, I don't see even a weak reason to use sdh_*.",
    "created_at": "2017-12-30T09:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359730",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:92'></a>Replying to [comment:91 SimonKing]:
> Replying to [comment:89 jdemeyer]:
> > In `spkg-install` files, you should use the new utility functions like `sdh_configure`. See `build/pkgs/ccache/spkg-install` for an example.

> 
> Why are these things always changing? I.e., why is one supposed to use an obscure function...


REALLY obscure.

- Why should I do `export CPPFLAGS="-I$SAGE_LOCAL/include $CPPFLAGS"` if the **standard way to proceed** is to `configure --prefix="$SAGE_LOCAL"`?
- Where do sdh_* functions come from? Where are they documented?
- What would possibly be the benefit of `sdh_make_install` over the standard `$MAKE install`? The latter is even shorter!

Sorry, I am escalating myself into a rant. So far, I don't see even a weak reason to use sdh_*.



---

archive/issue_comments_359731.json:
```json
{
    "body": "<a id='comment:93'></a>Replying to [comment:92 SimonKing]:\n> REALLY obscure.\n> \n> - Where do sdh_* functions come from? Where are they documented?\n\n\nIn a Sage shell:\n\n```\n(sage-sh) king@king-C70-B:sage$ which sdh_make_install\n(sage-sh) king@king-C70-B:sage$ find . -name sdh_make_install\n```\nSo, I'd say sdh_make_install does not even exist.",
    "created_at": "2017-12-30T09:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359731",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:93'></a>Replying to [comment:92 SimonKing]:
> REALLY obscure.
> 
> - Where do sdh_* functions come from? Where are they documented?


In a Sage shell:

```
(sage-sh) king@king-C70-B:sage$ which sdh_make_install
(sage-sh) king@king-C70-B:sage$ find . -name sdh_make_install
```
So, I'd say sdh_make_install does not even exist.



---

archive/issue_comments_359732.json:
```json
{
    "body": "<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T10:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359732",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:94'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359733.json:
```json
{
    "body": "<a id='comment:95'></a>The new commits address\n- comment:88 (Initialisation is now done by importing sage.libs.meataxe)\n- comment:86 (I followed the syntax from a different package's SPKG.txt)\n- comment:87 (Hopefully the quoting is fine in that way)\n- comment:89\n\nThe package still builds fine. I have now posted the package documentation and moved the tarball to a different location (ticket description is updated accordingly).",
    "created_at": "2017-12-30T10:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359733",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:95'></a>The new commits address
- comment:88 (Initialisation is now done by importing sage.libs.meataxe)
- comment:86 (I followed the syntax from a different package's SPKG.txt)
- comment:87 (Hopefully the quoting is fine in that way)
- comment:89

The package still builds fine. I have now posted the package documentation and moved the tarball to a different location (ticket description is updated accordingly).



---

archive/issue_comments_359734.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-30T10:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359734",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359735.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n+Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.\n \n+So, purpose of this ticket: Change MeatAxe from static to dynamic.\n+\n+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.\n+\n+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)\n+- an autotools build system\n+- a shared library\n+- a test suite that can be run in parallel and passes `make distcheck`\n+- some bug fixes\n+- a speedup in echelon computation\n+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.\n+Also it fixes some errors in the documentation.\n+\n+The tarball of the fork is available at http://users.minet.uni-jena.de/~king/SharedMeatAxe/shared_meataxe-1.0.tar.gz\n+\n+The package documentation is at http://users.minet.uni-jena.de/~king/SharedMeatAxe/\n \n Comment: 1\n \n```\n",
    "created_at": "2017-12-30T10:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359735",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,21 @@
+Working on #18514, it turns out that it is quite awkward that MeatAxe is a static library: MeatAxe uses some global variables, and *each* cython module using MeatAxe library functions needs to set these global variables.
 
+So, purpose of this ticket: Change MeatAxe from static to dynamic.
+
+Unfortunately, we aren't upstream for MeatAxe. We are already extensively patching the upstream sources, both adding features and fixing bugs. But upstream isn't really active, the last release is several years old, and they seemed reluctant to consider our patches.
+
+Therefore I created a fork, that I call SharedMeatAxe, as it provides a shared library. It provides (in contrast to upstream MeatAxe)
+- an autotools build system
+- a shared library
+- a test suite that can be run in parallel and passes `make distcheck`
+- some bug fixes
+- a speedup in echelon computation
+- asymptotically fast matrix multiplication, that is faster than schoolbook multiplication even for rather small matrices.
+Also it fixes some errors in the documentation.
+
+The tarball of the fork is available at http://users.minet.uni-jena.de/~king/SharedMeatAxe/shared_meataxe-1.0.tar.gz
+
+The package documentation is at http://users.minet.uni-jena.de/~king/SharedMeatAxe/
 
 Comment: 1
 
```




---

archive/issue_comments_359736.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T10:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359736",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359737.json:
```json
{
    "body": "<a id='comment:96'></a>PS: I think I should update the tarball, as I have slightly modified the documentation, by giving more proper reference to the \"unshared\" MeatAxe.",
    "created_at": "2017-12-30T10:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359737",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:96'></a>PS: I think I should update the tarball, as I have slightly modified the documentation, by giving more proper reference to the "unshared" MeatAxe.



---

archive/issue_comments_359738.json:
```json
{
    "body": "<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T11:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:97'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359739.json:
```json
{
    "body": "<a id='comment:98'></a>Done!\n\n---\nNew commits:",
    "created_at": "2017-12-30T11:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359739",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:98'></a>Done!

---
New commits:



---

archive/issue_comments_359740.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-30T11:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359740",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359741.json:
```json
{
    "body": "<a id='comment:99'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-30T11:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:99'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359742.json:
```json
{
    "body": "<a id='comment:100'></a>Replying to [comment:93 SimonKing]:\n> Replying to [comment:92 SimonKing]:\n> > REALLY obscure.\n> > \n> > - Where do sdh_* functions come from? Where are they documented?\n \n> \n> In a Sage shell:\n> \n> ```\n> (sage-sh) king@king-C70-B:sage$ which sdh_make_install\n> (sage-sh) king@king-C70-B:sage$ find . -name sdh_make_install\n> ```\n> So, I'd say sdh_make_install does not even exist.\n\n\nYes, it doesn't exist:\n\n```\nsage: search_doc(\"sdh_make_install\")\n\nsage: search_src(\"sdh_make_install\")\n\n```",
    "created_at": "2017-12-30T11:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359742",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:100'></a>Replying to [comment:93 SimonKing]:
> Replying to [comment:92 SimonKing]:
> > REALLY obscure.
> > 
> > - Where do sdh_* functions come from? Where are they documented?
 
> 
> In a Sage shell:
> 
> ```
> (sage-sh) king@king-C70-B:sage$ which sdh_make_install
> (sage-sh) king@king-C70-B:sage$ find . -name sdh_make_install
> ```
> So, I'd say sdh_make_install does not even exist.


Yes, it doesn't exist:

```
sage: search_doc("sdh_make_install")

sage: search_src("sdh_make_install")

```



---

archive/issue_comments_359743.json:
```json
{
    "body": "<a id='comment:1'></a>Found'em in SAGE_ROOT/src/bin...",
    "created_at": "2017-12-30T11:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359743",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>Found'em in SAGE_ROOT/src/bin...



---

archive/issue_comments_359744.json:
```json
{
    "body": "<a id='comment:2'></a>I can only say that the introduction of sdh_ things serves the purpose of a saner package management. E.g. I am told it would allow automatic reuse of system library in place of one supplied by Sage, and removal.",
    "created_at": "2017-12-30T11:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359744",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>I can only say that the introduction of sdh_ things serves the purpose of a saner package management. E.g. I am told it would allow automatic reuse of system library in place of one supplied by Sage, and removal.



---

archive/issue_comments_359745.json:
```json
{
    "body": "<a id='comment:103'></a>Replying to [comment:102 dimpase]:\n> I can only say that the introduction of sdh_ things serves the purpose of a saner package management. E.g. I am told it would allow automatic reuse of system library in place of one supplied by Sage, and removal.\n\n\nI admit that these functions save some lines that otherwise would repeat themselves over and over again. But they aren't exactly visible in the Sage documentation...",
    "created_at": "2017-12-30T12:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359745",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:103'></a>Replying to [comment:102 dimpase]:
> I can only say that the introduction of sdh_ things serves the purpose of a saner package management. E.g. I am told it would allow automatic reuse of system library in place of one supplied by Sage, and removal.


I admit that these functions save some lines that otherwise would repeat themselves over and over again. But they aren't exactly visible in the Sage documentation...



---

archive/issue_comments_359746.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T12:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359746",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359747.json:
```json
{
    "body": "<a id='comment:104'></a>Replying to [comment:73 SimonKing]:\n> There is one test in sage.matrix.special that fails, but that's because of #23706. I opened #24445, but I think this shouldn't be a dependency: The failing test can be fixed without #24445.\n\n\nAfter rethinking: It should.",
    "created_at": "2017-12-30T12:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359747",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:104'></a>Replying to [comment:73 SimonKing]:
> There is one test in sage.matrix.special that fails, but that's because of #23706. I opened #24445, but I think this shouldn't be a dependency: The failing test can be fixed without #24445.


After rethinking: It should.



---

archive/issue_comments_359748.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-12-30T12:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_359749.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-30T12:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359749",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359750.json:
```json
{
    "body": "<a id='comment:6'></a>Rebasing done...",
    "created_at": "2017-12-30T12:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359750",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>Rebasing done...



---

archive/issue_comments_359751.json:
```json
{
    "body": "<a id='comment:7'></a>Did you intentionally copy these commands from `ccache`? If MeatAxe doesn't need them, you shouldn't copy them.\n\n```\n# Use newer version of config.guess and config.sub (see Trac #23710)\ncp \"$SAGE_ROOT\"/config/config.* .\n \nexport CPPFLAGS=\"-I$SAGE_LOCAL/include $CPPFLAGS\"\n```\n\n(in the unlikely case that the copying of `config.guess` and `config.sub` is needed: change the ticket number in the comment to #24359)",
    "created_at": "2017-12-30T16:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359751",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Did you intentionally copy these commands from `ccache`? If MeatAxe doesn't need them, you shouldn't copy them.

```
# Use newer version of config.guess and config.sub (see Trac #23710)
cp "$SAGE_ROOT"/config/config.* .
 
export CPPFLAGS="-I$SAGE_LOCAL/include $CPPFLAGS"
```

(in the unlikely case that the copying of `config.guess` and `config.sub` is needed: change the ticket number in the comment to #24359)



---

archive/issue_comments_359752.json:
```json
{
    "body": "<a id='comment:108'></a>Replying to [comment:107 jdemeyer]:\n> Did you intentionally copy these commands from `ccache`? If MeatAxe doesn't need them, you shouldn't copy them.\n\n\nWell, you told me to have a look at `ccache`'s spkg-install. And when I saw the statement about config.*, I did a grep and found that *many* other spkg-install scripts have that line as well. So, I thought that this is one of the things one needs to do.\n\nFor me, the package builds fine with or without these lines. Is there a disadvantage of having them?\n\nConcerning CPPFLAGS, I wondered why `ccache`'s spkg-install has it. After all, `sdh_configure` is supposed to use `--prefix=$SAGE_LOCAL`, thus the include path should be `$SAGE_LOCAL/include` anyway.\n\n> (in the unlikely case that the copying of `config.guess` and `config.sub` is needed: change the ticket number in the comment to #24359)\n\n\nMy only reason for that line would be the fact that many other packages have them. So, I can remove it, if you like.",
    "created_at": "2017-12-30T16:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359752",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:108'></a>Replying to [comment:107 jdemeyer]:
> Did you intentionally copy these commands from `ccache`? If MeatAxe doesn't need them, you shouldn't copy them.


Well, you told me to have a look at `ccache`'s spkg-install. And when I saw the statement about config.*, I did a grep and found that *many* other spkg-install scripts have that line as well. So, I thought that this is one of the things one needs to do.

For me, the package builds fine with or without these lines. Is there a disadvantage of having them?

Concerning CPPFLAGS, I wondered why `ccache`'s spkg-install has it. After all, `sdh_configure` is supposed to use `--prefix=$SAGE_LOCAL`, thus the include path should be `$SAGE_LOCAL/include` anyway.

> (in the unlikely case that the copying of `config.guess` and `config.sub` is needed: change the ticket number in the comment to #24359)


My only reason for that line would be the fact that many other packages have them. So, I can remove it, if you like.



---

archive/issue_comments_359753.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T16:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359754.json:
```json
{
    "body": "<a id='comment:110'></a>Replying to [comment:108 SimonKing]:\n> Replying to [comment:107 jdemeyer]:\n> > Did you intentionally copy these commands from `ccache`? If MeatAxe doesn't need them, you shouldn't copy them.\n\n> \n> Well, you told me to have a look at `ccache`'s spkg-install.\n\n\nRight, but I was just referring to the `sdh_` commands. I didn't mean to copy the `spkg-install` file verbatim.\n\n> I did a grep and found that *many* other spkg-install scripts have that line as well.\n\n\nIn all those cases, they are there for a reason: the reason is that those packages were created on a system with outdated autotools(*). Those `config.guess` and `config.sub` files detect the system type and won't recognize certain newer systems if they are too old. For you shared_meataxe package, the timestamp of those files (i.e. the timestamp of autotools(*) on *your system*) is `2015-08-20` which should be sufficiently recent.\n\n(*) Don't ask me which particular component of autotools. That may even depend on how a distro packages autotools.\n\n> Is there a disadvantage of having them?\n\n\nI guess not, except that it is clutter in the `spkg-install` file.",
    "created_at": "2017-12-30T17:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359754",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:110'></a>Replying to [comment:108 SimonKing]:
> Replying to [comment:107 jdemeyer]:
> > Did you intentionally copy these commands from `ccache`? If MeatAxe doesn't need them, you shouldn't copy them.

> 
> Well, you told me to have a look at `ccache`'s spkg-install.


Right, but I was just referring to the `sdh_` commands. I didn't mean to copy the `spkg-install` file verbatim.

> I did a grep and found that *many* other spkg-install scripts have that line as well.


In all those cases, they are there for a reason: the reason is that those packages were created on a system with outdated autotools(*). Those `config.guess` and `config.sub` files detect the system type and won't recognize certain newer systems if they are too old. For you shared_meataxe package, the timestamp of those files (i.e. the timestamp of autotools(*) on *your system*) is `2015-08-20` which should be sufficiently recent.

(*) Don't ask me which particular component of autotools. That may even depend on how a distro packages autotools.

> Is there a disadvantage of having them?


I guess not, except that it is clutter in the `spkg-install` file.



---

archive/issue_comments_359755.json:
```json
{
    "body": "<a id='comment:111'></a>Thanks for the explanation!\n\nReplying to [comment:110 jdemeyer]:\n> Replying to [comment:108 SimonKing]:\n> > Is there a disadvantage of having them?\n\n> \n> I guess not, except that it is clutter in the `spkg-install` file.\n\n\nIn any case, the clutter has gone with the latest commit.",
    "created_at": "2017-12-30T17:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359755",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:111'></a>Thanks for the explanation!

Replying to [comment:110 jdemeyer]:
> Replying to [comment:108 SimonKing]:
> > Is there a disadvantage of having them?

> 
> I guess not, except that it is clutter in the `spkg-install` file.


In any case, the clutter has gone with the latest commit.



---

archive/issue_comments_359756.json:
```json
{
    "body": "<a id='comment:112'></a>Replying to [comment:93 SimonKing]:\n> In a Sage shell:\n> \n> ```\n> (sage-sh) king@king-C70-B:sage$ which sdh_make_install\n> (sage-sh) king@king-C70-B:sage$ find . -name sdh_make_install\n> ```\n\n\nFor future reference, I often use `git grep` (grep all files tracked by git) to search for something.",
    "created_at": "2017-12-30T17:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359756",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:112'></a>Replying to [comment:93 SimonKing]:
> In a Sage shell:
> 
> ```
> (sage-sh) king@king-C70-B:sage$ which sdh_make_install
> (sage-sh) king@king-C70-B:sage$ find . -name sdh_make_install
> ```


For future reference, I often use `git grep` (grep all files tracked by git) to search for something.



---

archive/issue_comments_359757.json:
```json
{
    "body": "<a id='comment:3'></a>On a `ppc64le` system, the testsuite fails badly (report attached). To be fair, the testsuite for the old meataxe also failed on that system, so I'm not blaming this ticket.",
    "created_at": "2017-12-30T17:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359757",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>On a `ppc64le` system, the testsuite fails badly (report attached). To be fair, the testsuite for the old meataxe also failed on that system, so I'm not blaming this ticket.



---

archive/issue_comments_359758.json:
```json
{
    "body": "Attachment [ppc64le-test-suite.log](tarball://root/attachments/some-uuid/ticket24359/ppc64le-test-suite.log) by @jdemeyer created at 2017-12-30 17:23:10\n\nFailing test suite on ppc64le",
    "created_at": "2017-12-30T17:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359758",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [ppc64le-test-suite.log](tarball://root/attachments/some-uuid/ticket24359/ppc64le-test-suite.log) by @jdemeyer created at 2017-12-30 17:23:10

Failing test suite on ppc64le



---

archive/issue_comments_359759.json:
```json
{
    "body": "<a id='comment:114'></a>Replying to [comment:113 jdemeyer]:\n> On a `ppc64le` system, the testsuite fails badly (report attached). To be fair, the testsuite for the old meataxe also failed on that system, so I'm not blaming this ticket.\n\n\nThanks (also for not blaming...)! Can you tell me more on that system's architecture? Anything unusual concerning endianness etc?\n\nIs it only the package test suite that fails, or also the Sage doctests (in sage.matrix.matrix_gfpn_dense)?",
    "created_at": "2017-12-30T17:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359759",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:114'></a>Replying to [comment:113 jdemeyer]:
> On a `ppc64le` system, the testsuite fails badly (report attached). To be fair, the testsuite for the old meataxe also failed on that system, so I'm not blaming this ticket.


Thanks (also for not blaming...)! Can you tell me more on that system's architecture? Anything unusual concerning endianness etc?

Is it only the package test suite that fails, or also the Sage doctests (in sage.matrix.matrix_gfpn_dense)?



---

archive/issue_comments_359760.json:
```json
{
    "body": "<a id='comment:5'></a>WTF?\n\n```\ncd: can't cd to t-0105_out\n```\nWhy can it not? Can you investigate whether the `t-xxx_out` subfolders have been created?\n\n```\n../checksum: not found\n```\nNo surprise, because at that point the script is supposed to work in the above-mentioned subfolder.\n\nBut the following errors are REALLY strange:\n- `/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test/data/Perm1: Bad file format (-1 20 1)`\n- `bsread.c(45):Invalid bit string header (-3,51,0)`\n- `permread.c(72):Not a permutation`\n- `ffio.c(193):/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test/data/Perm1: Invalid header, possibly non-MeatAxe file`\n\nThese errors indicate that there is some bug in I/O on exotic architectures, as the data files are all provided by upstream and are supposed to be readable.",
    "created_at": "2017-12-30T17:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359760",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>WTF?

```
cd: can't cd to t-0105_out
```
Why can it not? Can you investigate whether the `t-xxx_out` subfolders have been created?

```
../checksum: not found
```
No surprise, because at that point the script is supposed to work in the above-mentioned subfolder.

But the following errors are REALLY strange:
- `/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test/data/Perm1: Bad file format (-1 20 1)`
- `bsread.c(45):Invalid bit string header (-3,51,0)`
- `permread.c(72):Not a permutation`
- `ffio.c(193):/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test/data/Perm1: Invalid header, possibly non-MeatAxe file`

These errors indicate that there is some bug in I/O on exotic architectures, as the data files are all provided by upstream and are supposed to be readable.



---

archive/issue_comments_359761.json:
```json
{
    "body": "<a id='comment:6'></a>I see: \"ppc64le is a pure little-endian mode that has been introduced with the POWER8 as the prime target\", according to Wikipedia.\n\nWhat does \"little-endian mode\" mean? Is it perhaps the case that the configuration script mistakenly believes that the machine is big-endian? My group cohomology spkg, which uses meataxe, used to work both on big- and little-endian machines, but if there is an error in the configuration, then of course errors in I/O can't be avoided.",
    "created_at": "2017-12-30T17:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359761",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>I see: "ppc64le is a pure little-endian mode that has been introduced with the POWER8 as the prime target", according to Wikipedia.

What does "little-endian mode" mean? Is it perhaps the case that the configuration script mistakenly believes that the machine is big-endian? My group cohomology spkg, which uses meataxe, used to work both on big- and little-endian machines, but if there is an error in the configuration, then of course errors in I/O can't be avoided.



---

archive/issue_comments_359762.json:
```json
{
    "body": "<a id='comment:7'></a>In the summary at the very end of the configure script, I should probably also include what endianness has been found.",
    "created_at": "2017-12-30T17:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359762",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>In the summary at the very end of the configure script, I should probably also include what endianness has been found.



---

archive/issue_comments_359763.json:
```json
{
    "body": "<a id='comment:8'></a>I would like that the Summary prints\n\n```\nEndianness.....: big endian\n```\nresp.\n\n```\nEndianness.....: little endian\n```\nbut I don't know how to achieve that. Do you know? Otherwise, I'd suggest I put the following line into the summary:\n\n```\nIs big endian..: $WORDS_BIGENDIAN\n```",
    "created_at": "2017-12-30T18:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359763",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>I would like that the Summary prints

```
Endianness.....: big endian
```
resp.

```
Endianness.....: little endian
```
but I don't know how to achieve that. Do you know? Otherwise, I'd suggest I put the following line into the summary:

```
Is big endian..: $WORDS_BIGENDIAN
```



---

archive/issue_comments_359764.json:
```json
{
    "body": "<a id='comment:119'></a>Replying to [comment:116 SimonKing]:\n> What does \"little-endian mode\" mean?\n\n\nIt means little-endian.\n\nThe whole story is that this is a CPU which supports both little-endian and big-endian. I believe that the mode is chosen when booting the system. In any case, on that system everything (from kernel to user executables) is little endian.",
    "created_at": "2017-12-30T18:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359764",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:119'></a>Replying to [comment:116 SimonKing]:
> What does "little-endian mode" mean?


It means little-endian.

The whole story is that this is a CPU which supports both little-endian and big-endian. I believe that the mode is chosen when booting the system. In any case, on that system everything (from kernel to user executables) is little endian.



---

archive/issue_comments_359765.json:
```json
{
    "body": "<a id='comment:120'></a>Replying to [comment:114 SimonKing]:\n> Is it only the package test suite that fails, or also the Sage doctests (in sage.matrix.matrix_gfpn_dense)?\n\n\nPerhaps surprisingly, the Sage doctests all pass.",
    "created_at": "2017-12-30T18:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359765",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:120'></a>Replying to [comment:114 SimonKing]:
> Is it only the package test suite that fails, or also the Sage doctests (in sage.matrix.matrix_gfpn_dense)?


Perhaps surprisingly, the Sage doctests all pass.



---

archive/issue_comments_359766.json:
```json
{
    "body": "<a id='comment:1'></a>`./configure` correctly detects\n\n```\n[meataxe-1.0] checking whether byte ordering is bigendian... no\n```",
    "created_at": "2017-12-30T18:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359766",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>`./configure` correctly detects

```
[meataxe-1.0] checking whether byte ordering is bigendian... no
```



---

archive/issue_comments_359767.json:
```json
{
    "body": "<a id='comment:122'></a>Replying to [comment:115 SimonKing]:\n> {{{\n> cd: can't cd to t-0105_out\n> }}}\n> Why can it not? Can you investigate whether the `t-xxx_out` subfolders have been created?\n\n\nNo, they have not been created. I do see a `t-0100` directory, but not a `t-0100_out` directory.",
    "created_at": "2017-12-30T18:31:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359767",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:122'></a>Replying to [comment:115 SimonKing]:
> {{{
> cd: can't cd to t-0105_out
> }}}
> Why can it not? Can you investigate whether the `t-xxx_out` subfolders have been created?


No, they have not been created. I do see a `t-0100` directory, but not a `t-0100_out` directory.



---

archive/issue_comments_359768.json:
```json
{
    "body": "<a id='comment:123'></a>On a less exotic system\n\n```\nLinux tamiyo 3.17.7-gentoo #2 SMP PREEMPT Fri Dec 23 18:13:49 CET 2016 x86_64 Intel(R) Core(TM) i7-2640M CPU @ 2.80GHz GenuineIntel GNU/Linux\n```\nI have the same problem that the `_out` directories are not created.",
    "created_at": "2017-12-30T18:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359768",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:123'></a>On a less exotic system

```
Linux tamiyo 3.17.7-gentoo #2 SMP PREEMPT Fri Dec 23 18:13:49 CET 2016 x86_64 Intel(R) Core(TM) i7-2640M CPU @ 2.80GHz GenuineIntel GNU/Linux
```
I have the same problem that the `_out` directories are not created.



---

archive/issue_comments_359769.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-30T18:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359769",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359770.json:
```json
{
    "body": "<a id='comment:124'></a>Replying to [comment:69 SimonKing]:\n> However, it seems to be possible to APPEND something to the elements of a variable list. Hence, for test script t-xxxx I am now using the folder t-xxxx_out, with the following syntax in Makefile.am:\n> \n> ```\n> @$(MKDIR_P) $(TESTNUMBERS:=_out)\n> ```\n\n\nIt seems that this doesn't work. Why don't you use a shell `for` loop like\n\n```\n# The quoting might be wrong, I haven't edited Makefiles in a while\nfor dir in $(TESTNUMBERS); do \\\n    $(MKDIR_P) $${dir}_out; \\\ndone\n```",
    "created_at": "2017-12-30T18:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359770",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:124'></a>Replying to [comment:69 SimonKing]:
> However, it seems to be possible to APPEND something to the elements of a variable list. Hence, for test script t-xxxx I am now using the folder t-xxxx_out, with the following syntax in Makefile.am:
> 
> ```
> @$(MKDIR_P) $(TESTNUMBERS:=_out)
> ```


It seems that this doesn't work. Why don't you use a shell `for` loop like

```
# The quoting might be wrong, I haven't edited Makefiles in a while
for dir in $(TESTNUMBERS); do \
    $(MKDIR_P) $${dir}_out; \
done
```



---

archive/issue_comments_359771.json:
```json
{
    "body": "<a id='comment:125'></a>Replying to [comment:122 jdemeyer]:\n> Replying to [comment:115 SimonKing]:\n> > {{{\n> > cd: can't cd to t-0105_out\n> > }}}\n> > Why can it not? Can you investigate whether the `t-xxx_out` subfolders have been created?\n\n> \n> No, they have not been created. I do see a `t-0100` directory, but not a `t-0100_out` directory.\n\n\nReally a directory? 'cause `t-0100` is supposed to be the name of a test script.",
    "created_at": "2017-12-30T19:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359771",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:125'></a>Replying to [comment:122 jdemeyer]:
> Replying to [comment:115 SimonKing]:
> > {{{
> > cd: can't cd to t-0105_out
> > }}}
> > Why can it not? Can you investigate whether the `t-xxx_out` subfolders have been created?

> 
> No, they have not been created. I do see a `t-0100` directory, but not a `t-0100_out` directory.


Really a directory? 'cause `t-0100` is supposed to be the name of a test script.



---

archive/issue_comments_359772.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T19:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359773.json:
```json
{
    "body": "<a id='comment:127'></a>Replying to [comment:114 SimonKing]:\n> Can you tell me more on that system's architecture?\n\n\nOne thing which is different from other architectures is that the `char` type is unsigned. On most common systems, the range of a `char` is -128 to 127. On ppc64le, the range is 0 to 255.\n\nI found at least one instance where this is causing a bug: in `src/intio.c`, in the function `SysReadLong32`:\n\n```\n((long)(char)a[3] << 24)\n```\nshould be replaced by\n\n```\n((long)(signed char)a[3] << 24)\n```",
    "created_at": "2017-12-30T19:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359773",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:127'></a>Replying to [comment:114 SimonKing]:
> Can you tell me more on that system's architecture?


One thing which is different from other architectures is that the `char` type is unsigned. On most common systems, the range of a `char` is -128 to 127. On ppc64le, the range is 0 to 255.

I found at least one instance where this is causing a bug: in `src/intio.c`, in the function `SysReadLong32`:

```
((long)(char)a[3] << 24)
```
should be replaced by

```
((long)(signed char)a[3] << 24)
```



---

archive/issue_comments_359774.json:
```json
{
    "body": "<a id='comment:8'></a>I have updated the tarball and the checksum. The tests pass for me (i.e., creation of the test directories seems to work). Can you test if it works for you?\n\nAlso, in the configuration summary, I added a line about endianness.\n\n---\nNew commits:",
    "created_at": "2017-12-30T19:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359774",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>I have updated the tarball and the checksum. The tests pass for me (i.e., creation of the test directories seems to work). Can you test if it works for you?

Also, in the configuration summary, I added a line about endianness.

---
New commits:



---

archive/issue_comments_359775.json:
```json
{
    "body": "<a id='comment:129'></a>Replying to [comment:125 SimonKing]:\n> Really a directory? 'cause `t-0100` is supposed to be the name of a test script.\n\n\nSorry, you are right: it is an executable.",
    "created_at": "2017-12-30T19:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359775",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:129'></a>Replying to [comment:125 SimonKing]:
> Really a directory? 'cause `t-0100` is supposed to be the name of a test script.


Sorry, you are right: it is an executable.



---

archive/issue_comments_359776.json:
```json
{
    "body": "<a id='comment:130'></a>Replying to [comment:127 jdemeyer]:\n> Replying to [comment:114 SimonKing]:\n> > Can you tell me more on that system's architecture?\n\n> \n> One thing which is different from other architectures is that the `char` type is unsigned. On most common systems, the range of a `char` is -128 to 127. On ppc64le, the range is 0 to 255.\n\n\nOK, that's weird.\n \n> I found at least one instance where this is causing a bug: in `src/intio.c`, in the function `SysReadLong32`:\n> \n> ```\n> ((long)(char)a[3] << 24)\n> ```\n> should be replaced by\n> \n> ```\n> ((long)(signed char)a[3] << 24)\n> ```\n\n\nWould that be OK with all non-exotic and exotic architectures?",
    "created_at": "2017-12-30T19:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359776",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:130'></a>Replying to [comment:127 jdemeyer]:
> Replying to [comment:114 SimonKing]:
> > Can you tell me more on that system's architecture?

> 
> One thing which is different from other architectures is that the `char` type is unsigned. On most common systems, the range of a `char` is -128 to 127. On ppc64le, the range is 0 to 255.


OK, that's weird.
 
> I found at least one instance where this is causing a bug: in `src/intio.c`, in the function `SysReadLong32`:
> 
> ```
> ((long)(char)a[3] << 24)
> ```
> should be replaced by
> 
> ```
> ((long)(signed char)a[3] << 24)
> ```


Would that be OK with all non-exotic and exotic architectures?



---

archive/issue_comments_359777.json:
```json
{
    "body": "<a id='comment:131'></a>Replying to [comment:130 SimonKing]:\n> Replying to [comment:127 jdemeyer]:\n> > Replying to [comment:114 SimonKing]:\n> > > Can you tell me more on that system's architecture?\n\n> > \n> > One thing which is different from other architectures is that the `char` type is unsigned. On most common systems, the range of a `char` is -128 to 127. On ppc64le, the range is 0 to 255.\n\n> \n> OK, that's weird.\n\n\nI believe it's the same on ARM, but I'm not sure...\n\n> Would that be OK with all non-exotic and exotic architectures?\n\n\nI don't see why not. `signed char` is explicitly a signed number.\n\n> Then I should probably grep all the sources for \"char\", and replace everything by \"signed char\".\n\n\nExcept when `char` really means a character of a string. But given that the Sage testsuite passes on this `ppc64le` system, the problem of `char` probably doesn't occur in too many places.",
    "created_at": "2017-12-30T19:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359777",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:131'></a>Replying to [comment:130 SimonKing]:
> Replying to [comment:127 jdemeyer]:
> > Replying to [comment:114 SimonKing]:
> > > Can you tell me more on that system's architecture?

> > 
> > One thing which is different from other architectures is that the `char` type is unsigned. On most common systems, the range of a `char` is -128 to 127. On ppc64le, the range is 0 to 255.

> 
> OK, that's weird.


I believe it's the same on ARM, but I'm not sure...

> Would that be OK with all non-exotic and exotic architectures?


I don't see why not. `signed char` is explicitly a signed number.

> Then I should probably grep all the sources for "char", and replace everything by "signed char".


Except when `char` really means a character of a string. But given that the Sage testsuite passes on this `ppc64le` system, the problem of `char` probably doesn't occur in too many places.



---

archive/issue_comments_359778.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T19:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359779.json:
```json
{
    "body": "<a id='comment:3'></a>Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.\n\nBut why don't you simply create the directory in the test script? That would be the easiest solution.",
    "created_at": "2017-12-30T19:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359779",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.

But why don't you simply create the directory in the test script? That would be the easiest solution.



---

archive/issue_comments_359780.json:
```json
{
    "body": "<a id='comment:4'></a>Testing with `make -j1 -k`:\n\n```\n...\n[meataxe-1.0] FAIL: t-0212\n[meataxe-1.0] FAIL: t-0213\n[meataxe-1.0] FAIL: t-0214\n[meataxe-1.0] PASS: t-0215\n[meataxe-1.0] ============================================================================\n[meataxe-1.0] Testsuite summary for shared_meataxe 1.0\n[meataxe-1.0] ============================================================================\n[meataxe-1.0] # TOTAL: 27\n[meataxe-1.0] # PASS:  7\n[meataxe-1.0] # SKIP:  0\n[meataxe-1.0] # XFAIL: 0\n[meataxe-1.0] # FAIL:  20\n[meataxe-1.0] # XPASS: 0\n[meataxe-1.0] # ERROR: 0\n[meataxe-1.0] ============================================================================\n[meataxe-1.0] See test/test-suite.log\n[meataxe-1.0] Please report to simon.king@uni-jena.de\n[meataxe-1.0] ============================================================================\n[meataxe-1.0] Makefile:728: recipe for target 'test-suite.log' failed\n[meataxe-1.0] make[5]: *** [test-suite.log] Error 1\n[meataxe-1.0] make[5]: Leaving directory '/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test'\n[meataxe-1.0] Makefile:834: recipe for target 'check-TESTS' failed\n[meataxe-1.0] make[4]: *** [check-TESTS] Error 2\n[meataxe-1.0] for dir in t-0100 t-0000 t-0100 t-0100 t-0105 t-0106 t-0107 t-0108 t-0109 t-0110 t-0111 t-0112 t-0113 t-0114 t-0115 t-0116 t-0117 t-0118 t-0200 t-0201 t-0210 t-0211 t-0212 t-0213 t-0214 t-0215; do \\\n[meataxe-1.0]   /bin/mkdir -p ${dir}_out; \\\n[meataxe-1.0] done\n[meataxe-1.0] make[4]: Leaving directory '/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test'\n[meataxe-1.0] Makefile:1075: recipe for target 'check-am' failed\n```\nThe directories are created but much too late...",
    "created_at": "2017-12-30T19:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359780",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Testing with `make -j1 -k`:

```
...
[meataxe-1.0] FAIL: t-0212
[meataxe-1.0] FAIL: t-0213
[meataxe-1.0] FAIL: t-0214
[meataxe-1.0] PASS: t-0215
[meataxe-1.0] ============================================================================
[meataxe-1.0] Testsuite summary for shared_meataxe 1.0
[meataxe-1.0] ============================================================================
[meataxe-1.0] # TOTAL: 27
[meataxe-1.0] # PASS:  7
[meataxe-1.0] # SKIP:  0
[meataxe-1.0] # XFAIL: 0
[meataxe-1.0] # FAIL:  20
[meataxe-1.0] # XPASS: 0
[meataxe-1.0] # ERROR: 0
[meataxe-1.0] ============================================================================
[meataxe-1.0] See test/test-suite.log
[meataxe-1.0] Please report to simon.king@uni-jena.de
[meataxe-1.0] ============================================================================
[meataxe-1.0] Makefile:728: recipe for target 'test-suite.log' failed
[meataxe-1.0] make[5]: *** [test-suite.log] Error 1
[meataxe-1.0] make[5]: Leaving directory '/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test'
[meataxe-1.0] Makefile:834: recipe for target 'check-TESTS' failed
[meataxe-1.0] make[4]: *** [check-TESTS] Error 2
[meataxe-1.0] for dir in t-0100 t-0000 t-0100 t-0100 t-0105 t-0106 t-0107 t-0108 t-0109 t-0110 t-0111 t-0112 t-0113 t-0114 t-0115 t-0116 t-0117 t-0118 t-0200 t-0201 t-0210 t-0211 t-0212 t-0213 t-0214 t-0215; do \
[meataxe-1.0]   /bin/mkdir -p ${dir}_out; \
[meataxe-1.0] done
[meataxe-1.0] make[4]: Leaving directory '/home/jdemeyer/sage-test/local/var/tmp/sage/build/meataxe-1.0/src/test'
[meataxe-1.0] Makefile:1075: recipe for target 'check-am' failed
```
The directories are created but much too late...



---

archive/issue_comments_359781.json:
```json
{
    "body": "<a id='comment:135'></a>Replying to [comment:133 jdemeyer]:\n> Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.\n\n\nAccording to the Autotools documentation I'm using:\n\n```\nAutomake recognizes and honors -local extensions for the following standard targets:\n  all info dvi\n  ps pdf html\n  check install-data install-dvi\n  install-exec install-html install-info\n  install-pdf install-ps uninstall\n  installdirs installcheck clean distclean mostlyclean\n  maintainer-clean\nAdding a -local to any of these in your Makefile.am files will cause the\nassociated commands to be executed before the standard target.\n```\n\nSo, it is weird that you find a race condition. Is that a bug in automake?",
    "created_at": "2017-12-30T19:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359781",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:135'></a>Replying to [comment:133 jdemeyer]:
> Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.


According to the Autotools documentation I'm using:

```
Automake recognizes and honors -local extensions for the following standard targets:
  all info dvi
  ps pdf html
  check install-data install-dvi
  install-exec install-html install-info
  install-pdf install-ps uninstall
  installdirs installcheck clean distclean mostlyclean
  maintainer-clean
Adding a -local to any of these in your Makefile.am files will cause the
associated commands to be executed before the standard target.
```

So, it is weird that you find a race condition. Is that a bug in automake?



---

archive/issue_comments_359782.json:
```json
{
    "body": "<a id='comment:136'></a>Replying to [comment:133 jdemeyer]:\n> Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.\n> \n> But why don't you simply create the directory in the test script? That would be the easiest solution.\n\n\nYes, I think so.",
    "created_at": "2017-12-30T19:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359782",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:136'></a>Replying to [comment:133 jdemeyer]:
> Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.
> 
> But why don't you simply create the directory in the test script? That would be the easiest solution.


Yes, I think so.



---

archive/issue_comments_359783.json:
```json
{
    "body": "<a id='comment:137'></a>Replying to [comment:136 SimonKing]:\n> Replying to [comment:133 jdemeyer]:\n> > Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.\n> > \n> > But why don't you simply create the directory in the test script? That would be the easiest solution.\n\n> \n> Yes, I think so.\n\n\nNo, I don't think so. `MKDIR_P` is there for a reason, but (as was discussed in some comments above), `MKDIR_P` is not available for the test scripts.",
    "created_at": "2017-12-30T19:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359783",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:137'></a>Replying to [comment:136 SimonKing]:
> Replying to [comment:133 jdemeyer]:
> > Some more testing revealed that the problem with the `_out` directories is not fixed. But the issue is a race condition: I believe that `check-local` is simply an additional test target. It is unspecified whether this is run before/during/after the other tests.
> > 
> > But why don't you simply create the directory in the test script? That would be the easiest solution.

> 
> Yes, I think so.


No, I don't think so. `MKDIR_P` is there for a reason, but (as was discussed in some comments above), `MKDIR_P` is not available for the test scripts.



---

archive/issue_comments_359784.json:
```json
{
    "body": "<a id='comment:8'></a>Do you see any other way but to use `mkdir -p t-xxxx_out` in the test script `t-xxxx`? Is `mkdir -p` available on all platforms supported by Sage? Or are there systems for which `$MKDIR_P` is different from `mkdir -p`?",
    "created_at": "2017-12-30T19:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359784",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>Do you see any other way but to use `mkdir -p t-xxxx_out` in the test script `t-xxxx`? Is `mkdir -p` available on all platforms supported by Sage? Or are there systems for which `$MKDIR_P` is different from `mkdir -p`?



---

archive/issue_comments_359785.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-30T20:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359786.json:
```json
{
    "body": "<a id='comment:140'></a>Replying to [comment:137 SimonKing]:\n> No, I don't think so. `MKDIR_P` is there for a reason\n\n\nWhat is wrong with a plain `mkdir`?",
    "created_at": "2017-12-30T20:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359786",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:140'></a>Replying to [comment:137 SimonKing]:
> No, I don't think so. `MKDIR_P` is there for a reason


What is wrong with a plain `mkdir`?



---

archive/issue_comments_359787.json:
```json
{
    "body": "<a id='comment:1'></a>I am now trying to remove the race condition as follows:\n\n```\ncheck-local: mk.dir\n\trm -f mk.dir\n\nmk.dir:\n\tfor dir in $(TESTNUMBERS); do \\\n\t\t$(MKDIR_P) $${dir}_out; \\\n\tdone\n\ttouch mk.dir\n```\nIt works for me. Does it work, for you?\n\n---\nNew commits:",
    "created_at": "2017-12-30T20:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359787",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>I am now trying to remove the race condition as follows:

```
check-local: mk.dir
	rm -f mk.dir

mk.dir:
	for dir in $(TESTNUMBERS); do \
		$(MKDIR_P) $${dir}_out; \
	done
	touch mk.dir
```
It works for me. Does it work, for you?

---
New commits:



---

archive/issue_comments_359788.json:
```json
{
    "body": "<a id='comment:142'></a>Replying to [comment:140 jdemeyer]:\n> Replying to [comment:137 SimonKing]:\n> > No, I don't think so. `MKDIR_P` is there for a reason\n\n> \n> What is wrong with a plain `mkdir`?\n\n\nApparently, `MKDIR_P` is one of `mkdir -p`, `install-sh -d`, or `mkinstalldirs`. So, it makes sense to not hard-code `mkdir -p`.",
    "created_at": "2017-12-30T20:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359788",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:142'></a>Replying to [comment:140 jdemeyer]:
> Replying to [comment:137 SimonKing]:
> > No, I don't think so. `MKDIR_P` is there for a reason

> 
> What is wrong with a plain `mkdir`?


Apparently, `MKDIR_P` is one of `mkdir -p`, `install-sh -d`, or `mkinstalldirs`. So, it makes sense to not hard-code `mkdir -p`.



---

archive/issue_comments_359789.json:
```json
{
    "body": "<a id='comment:143'></a>Replying to [comment:140 jdemeyer]:\n> Replying to [comment:137 SimonKing]:\n> > No, I don't think so. `MKDIR_P` is there for a reason\n\n> \n> What is wrong with a plain `mkdir`?\n\n\nDo you mean why `-p` seems necessary? If the user forgets `make clean` before another `make check`, there would be errors because `mkdir` complains if the directory already exists. But if we let each test script remove its output directory? That might work (although the user couldn't look at the output after running the tests).",
    "created_at": "2017-12-30T20:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359789",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:143'></a>Replying to [comment:140 jdemeyer]:
> Replying to [comment:137 SimonKing]:
> > No, I don't think so. `MKDIR_P` is there for a reason

> 
> What is wrong with a plain `mkdir`?


Do you mean why `-p` seems necessary? If the user forgets `make clean` before another `make check`, there would be errors because `mkdir` complains if the directory already exists. But if we let each test script remove its output directory? That might work (although the user couldn't look at the output after running the tests).



---

archive/issue_comments_359790.json:
```json
{
    "body": "<a id='comment:4'></a>Concerning mkdir -p, see also https://unix.stackexchange.com/questions/49263/recursive-mkdir/49264 or https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Limitations-of-Usual-Tools.html#Limitations-of-Usual-Tools",
    "created_at": "2017-12-30T20:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359790",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>Concerning mkdir -p, see also https://unix.stackexchange.com/questions/49263/recursive-mkdir/49264 or https://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.69/html_node/Limitations-of-Usual-Tools.html#Limitations-of-Usual-Tools



---

archive/issue_comments_359791.json:
```json
{
    "body": "<a id='comment:5'></a>Concerning the race condition, I could imagine that `check` starts after the actions in `check-local` are all *initiated*, but it isn't waited till they *terminated*. So, I think the fix pointed out in comment:141 (that already is in the current tarball) makes sense.",
    "created_at": "2017-12-30T21:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359791",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>Concerning the race condition, I could imagine that `check` starts after the actions in `check-local` are all *initiated*, but it isn't waited till they *terminated*. So, I think the fix pointed out in comment:141 (that already is in the current tarball) makes sense.



---

archive/issue_comments_359792.json:
```json
{
    "body": "<a id='comment:146'></a>Replying to [comment:143 SimonKing]:\n> Replying to [comment:140 jdemeyer]:\n> > Replying to [comment:137 SimonKing]:\n> > > No, I don't think so. `MKDIR_P` is there for a reason\n\n> > \n> > What is wrong with a plain `mkdir`?\n\n> \n> Do you mean why `-p` seems necessary? If the user forgets `make clean` before another `make check`, there would be errors because `mkdir` complains if the directory already exists.\n\n\nThere are two other solutions to that:\n\n1. `mkdir DIR 2>/dev/null` (just let `mkdir` fail but hide the error)\n\n2. `rm -rf DIR; mkdir DIR` (remove the directory before creating it)",
    "created_at": "2017-12-31T10:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359792",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:146'></a>Replying to [comment:143 SimonKing]:
> Replying to [comment:140 jdemeyer]:
> > Replying to [comment:137 SimonKing]:
> > > No, I don't think so. `MKDIR_P` is there for a reason

> > 
> > What is wrong with a plain `mkdir`?

> 
> Do you mean why `-p` seems necessary? If the user forgets `make clean` before another `make check`, there would be errors because `mkdir` complains if the directory already exists.


There are two other solutions to that:

1. `mkdir DIR 2>/dev/null` (just let `mkdir` fail but hide the error)

2. `rm -rf DIR; mkdir DIR` (remove the directory before creating it)



---

archive/issue_comments_359793.json:
```json
{
    "body": "<a id='comment:147'></a>Replying to [comment:135 SimonKing]:\n> According to the Autotools documentation I'm using:\n> \n> ```\n> Automake recognizes and honors -local extensions for the following standard targets:\n>   all info dvi\n>   ps pdf html\n>   check install-data install-dvi\n>   install-exec install-html install-info\n>   install-pdf install-ps uninstall\n>   installdirs installcheck clean distclean mostlyclean\n>   maintainer-clean\n> Adding a -local to any of these in your Makefile.am files will cause the\n> associated commands to be executed before the standard target.\n> ```\n> \n> So, it is weird that you find a race condition. Is that a bug in automake?\n\n\nIt's either a bug in automake or its documentation.",
    "created_at": "2017-12-31T10:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359793",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:147'></a>Replying to [comment:135 SimonKing]:
> According to the Autotools documentation I'm using:
> 
> ```
> Automake recognizes and honors -local extensions for the following standard targets:
>   all info dvi
>   ps pdf html
>   check install-data install-dvi
>   install-exec install-html install-info
>   install-pdf install-ps uninstall
>   installdirs installcheck clean distclean mostlyclean
>   maintainer-clean
> Adding a -local to any of these in your Makefile.am files will cause the
> associated commands to be executed before the standard target.
> ```
> 
> So, it is weird that you find a race condition. Is that a bug in automake?


It's either a bug in automake or its documentation.



---

archive/issue_comments_359794.json:
```json
{
    "body": "<a id='comment:148'></a>Replying to [comment:141 SimonKing]:\n> I am now trying to remove the race condition as follows:\n> \n> ```\n> check-local: mk.dir\n> \trm -f mk.dir\n> \n> mk.dir:\n> \tfor dir in $(TESTNUMBERS); do \\\n> \t\t$(MKDIR_P) $${dir}_out; \\\n> \tdone\n> \ttouch mk.dir\n> ```\n\n\nI don't see why that would make a difference. It wouldn't solve the problem that `check-local` is not a dependency of `check-TESTS`.\n\n> It works for me.\n\n\nProbably you are using parallel `make`. Try a serial make (`make -j1`) instead.",
    "created_at": "2017-12-31T10:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359794",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:148'></a>Replying to [comment:141 SimonKing]:
> I am now trying to remove the race condition as follows:
> 
> ```
> check-local: mk.dir
> 	rm -f mk.dir
> 
> mk.dir:
> 	for dir in $(TESTNUMBERS); do \
> 		$(MKDIR_P) $${dir}_out; \
> 	done
> 	touch mk.dir
> ```


I don't see why that would make a difference. It wouldn't solve the problem that `check-local` is not a dependency of `check-TESTS`.

> It works for me.


Probably you are using parallel `make`. Try a serial make (`make -j1`) instead.



---

archive/issue_comments_359795.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-31T11:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359796.json:
```json
{
    "body": "<a id='comment:150'></a>Replying to [comment:146 jdemeyer]:\n> There are two other solutions to that:\n> \n> 1. `mkdir DIR 2>/dev/null` (just let `mkdir` fail but hide the error)\n> \n> 2. `rm -rf DIR; mkdir DIR` (remove the directory before creating it)\n\n\nIn the now-posted package version, I take the latter approach.\n\nHopefully it works now, including big-endian and \"char = unsigned char\" architectures, both 32- and 64-bit, both parallel and serial build...",
    "created_at": "2017-12-31T11:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359796",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:150'></a>Replying to [comment:146 jdemeyer]:
> There are two other solutions to that:
> 
> 1. `mkdir DIR 2>/dev/null` (just let `mkdir` fail but hide the error)
> 
> 2. `rm -rf DIR; mkdir DIR` (remove the directory before creating it)


In the now-posted package version, I take the latter approach.

Hopefully it works now, including big-endian and "char = unsigned char" architectures, both 32- and 64-bit, both parallel and serial build...



---

archive/issue_comments_359797.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-01-01T09:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359797",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_359798.json:
```json
{
    "body": "<a id='comment:2'></a>appears to work on OSX with clang, too.",
    "created_at": "2018-01-01T11:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359798",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>appears to work on OSX with clang, too.



---

archive/issue_comments_359799.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-01-04T11:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359799",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_359800.json:
```json
{
    "body": "<a id='comment:4'></a>There is a build issue involving the Cython module `matrix_gfpn_dense`, I'll elaborate when I figured out what it is. While testing ~~#24445~~ some unrelated ticket, I got this:\n\n```\n**********************************************************************\nFile \"src/sage/matrix/matrix_gfpn_dense.pyx\", line 1630, in sage.matrix.matrix_gfpn_dense.mtx_unpickle\nFailed example:\n    M = MatrixSpace(K,10,10).random_element()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.matrix.matrix_gfpn_dense.mtx_unpickle[1]>\", line 1, in <module>\n        M = MatrixSpace(K,Integer(10),Integer(10)).random_element()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 1981, in random_element\n        *args, **kwds)\n      File \"sage/matrix/matrix_gfpn_dense.pyx\", line 663, in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.randomize (build/cythonized/sage/matrix/matrix_gfpn_dense.c:6970)\n        INPUT:\n      File \"sage/matrix/matrix0.pyx\", line 524, in sage.matrix.matrix0.Matrix.get_unsafe (build/cythonized/sage/matrix/matrix0.c:5730)\n        raise NotImplementedError(\"this must be defined in the derived type.\")\n    NotImplementedError: this must be defined in the derived type.\n**********************************************************************\n```",
    "created_at": "2018-01-04T11:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359800",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>There is a build issue involving the Cython module `matrix_gfpn_dense`, I'll elaborate when I figured out what it is. While testing ~~#24445~~ some unrelated ticket, I got this:

```
**********************************************************************
File "src/sage/matrix/matrix_gfpn_dense.pyx", line 1630, in sage.matrix.matrix_gfpn_dense.mtx_unpickle
Failed example:
    M = MatrixSpace(K,10,10).random_element()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.matrix.matrix_gfpn_dense.mtx_unpickle[1]>", line 1, in <module>
        M = MatrixSpace(K,Integer(10),Integer(10)).random_element()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 1981, in random_element
        *args, **kwds)
      File "sage/matrix/matrix_gfpn_dense.pyx", line 663, in sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense.randomize (build/cythonized/sage/matrix/matrix_gfpn_dense.c:6970)
        INPUT:
      File "sage/matrix/matrix0.pyx", line 524, in sage.matrix.matrix0.Matrix.get_unsafe (build/cythonized/sage/matrix/matrix0.c:5730)
        raise NotImplementedError("this must be defined in the derived type.")
    NotImplementedError: this must be defined in the derived type.
**********************************************************************
```



---

archive/issue_comments_359801.json:
```json
{
    "body": "<a id='comment:6'></a>Rebased to 8.2.beta2, removed commits belonging to #24445, squashed to one commit. All to allow for easier testing.\n\n---\nNew commits:",
    "created_at": "2018-01-04T11:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359801",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Rebased to 8.2.beta2, removed commits belonging to #24445, squashed to one commit. All to allow for easier testing.

---
New commits:



---

archive/issue_comments_359802.json:
```json
{
    "body": "<a id='comment:157'></a>Replying to [comment:154 jdemeyer]:\n> There is a build issue involving the Cython module `matrix_gfpn_dense`, I'll elaborate when I figured out what it is. While testing #24445,\n\n\n#24445 is (from my point of view) a dependency for this ticket. So, why are you blaming this ticket for a failure in #24445?\n\nI could imagine, though, that it leads to problems to first test stuff here (with SharedMeatAxe), then go back and test #24445 (with unshared MeatAxe). Could you check if while testing #24445 you still have libmtx.so (which belongs to this ticket) around, or only have libmtx.a (which belongs to #24445)?",
    "created_at": "2018-01-04T11:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359802",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:157'></a>Replying to [comment:154 jdemeyer]:
> There is a build issue involving the Cython module `matrix_gfpn_dense`, I'll elaborate when I figured out what it is. While testing #24445,


#24445 is (from my point of view) a dependency for this ticket. So, why are you blaming this ticket for a failure in #24445?

I could imagine, though, that it leads to problems to first test stuff here (with SharedMeatAxe), then go back and test #24445 (with unshared MeatAxe). Could you check if while testing #24445 you still have libmtx.so (which belongs to this ticket) around, or only have libmtx.a (which belongs to #24445)?



---

archive/issue_comments_359803.json:
```json
{
    "body": "<a id='comment:158'></a>Replying to [comment:156 jdemeyer]:\n> Rebased to 8.2.beta2, removed commits belonging to #24445, squashed to one commit. All to allow for easier testing.\n\n\nCould you elaborate what you mean by \"belonging to #24445\"? If I recall correctly, the \"modern\" way of thinking is that a git commit does not \"belong\" to a ticket (in contrast to a patch).\n\nAlso note that there is one commit that changes an error message for a test that was introduced at #24445. The old and new meataxe versions are off by one line. So, please be careful that you don't think this commit belongs to #24445.",
    "created_at": "2018-01-04T11:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359803",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:158'></a>Replying to [comment:156 jdemeyer]:
> Rebased to 8.2.beta2, removed commits belonging to #24445, squashed to one commit. All to allow for easier testing.


Could you elaborate what you mean by "belonging to #24445"? If I recall correctly, the "modern" way of thinking is that a git commit does not "belong" to a ticket (in contrast to a patch).

Also note that there is one commit that changes an error message for a test that was introduced at #24445. The old and new meataxe versions are off by one line. So, please be careful that you don't think this commit belongs to #24445.



---

archive/issue_comments_359804.json:
```json
{
    "body": "<a id='comment:159'></a>Replying to [comment:158 SimonKing]:\n> Also note that there is one commit that changes an error message for a test that was introduced at #24445.\n\n\nAre you sure? If what you say is correct, there should have been a merge conflict for that line and I didn't see that.",
    "created_at": "2018-01-04T12:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359804",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:159'></a>Replying to [comment:158 SimonKing]:
> Also note that there is one commit that changes an error message for a test that was introduced at #24445.


Are you sure? If what you say is correct, there should have been a merge conflict for that line and I didn't see that.



---

archive/issue_comments_359805.json:
```json
{
    "body": "<a id='comment:160'></a>Replying to [comment:158 SimonKing]:\n> Could you elaborate what you mean by \"belonging to #24445\"? If I recall correctly, the \"modern\" way of thinking is that a git commit does not \"belong\" to a ticket (in contrast to a patch).\n\n\nFixed :-)",
    "created_at": "2018-01-04T12:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359805",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:160'></a>Replying to [comment:158 SimonKing]:
> Could you elaborate what you mean by "belonging to #24445"? If I recall correctly, the "modern" way of thinking is that a git commit does not "belong" to a ticket (in contrast to a patch).


Fixed :-)



---

archive/issue_comments_359806.json:
```json
{
    "body": "<a id='comment:161'></a>Replying to [comment:159 jdemeyer]:\n> Replying to [comment:158 SimonKing]:\n> > Also note that there is one commit that changes an error message for a test that was introduced at #24445.\n\n> \n> Are you sure? If what you say is correct, there should have been a merge conflict for that line and I didn't see that.\n\n\nNow I'm confused. I was sure that I merged the two, and there was indeed one error message where a line number in os.c (from meataxe) changes between meataxe versions. But when I now look at the commits from my original branch, I cannot see that #24445 is included.",
    "created_at": "2018-01-04T12:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359806",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:161'></a>Replying to [comment:159 jdemeyer]:
> Replying to [comment:158 SimonKing]:
> > Also note that there is one commit that changes an error message for a test that was introduced at #24445.

> 
> Are you sure? If what you say is correct, there should have been a merge conflict for that line and I didn't see that.


Now I'm confused. I was sure that I merged the two, and there was indeed one error message where a line number in os.c (from meataxe) changes between meataxe versions. But when I now look at the commits from my original branch, I cannot see that #24445 is included.



---

archive/issue_comments_359807.json:
```json
{
    "body": "<a id='comment:162'></a>Replying to [comment:159 jdemeyer]:\n> Replying to [comment:158 SimonKing]:\n> > Also note that there is one commit that changes an error message for a test that was introduced at #24445.\n\n> \n> Are you sure? If what you say is correct, there should have been a merge conflict for that line and I didn't see that.\n\n\nAnyway, git blame shows me that error message that is to be expected with SharedMeatAxe was introduced in commit 8a42fe1c, and then I get\n\n```\n$ git branch --contains 8a42fe1c\n  t/24359/turn_meataxe_into_a_dynamic_library\n  t/24468/fix_comparison_of_matrices_that_live_in_equivalent_matrix_spaces\n```\nThe changeset is\n\n```diff\ndiff --git a/src/sage/matrix/matrix_gfpn_dense.pyx b/src/sage/matrix/matrix_gfpn_dense.pyx\nindex 22af9fc..f8b53da 100644\n--- a/src/sage/matrix/matrix_gfpn_dense.pyx\n+++ b/src/sage/matrix/matrix_gfpn_dense.pyx\n@@ -365,7 +365,7 @@ cdef class Matrix_gfpn_dense(Matrix_dense):\n                 sage: Matrix_gfpn_dense('foobarNONEXISTING_FILE')       # optional: meataxe\n                 Traceback (most recent call last):\n                 ...\n-                OSError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 254)\n+                OSError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 255)\n                 sage: Matrix_gfpn_dense('')                             # optional: meataxe\n                 Traceback (most recent call last):\n                 ...\n```\n\nAnd you are right in the sense that that test does not belong to #24445.\n\nAnyway, the build error you are reporting seems very strange.",
    "created_at": "2018-01-04T12:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359807",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:162'></a>Replying to [comment:159 jdemeyer]:
> Replying to [comment:158 SimonKing]:
> > Also note that there is one commit that changes an error message for a test that was introduced at #24445.

> 
> Are you sure? If what you say is correct, there should have been a merge conflict for that line and I didn't see that.


Anyway, git blame shows me that error message that is to be expected with SharedMeatAxe was introduced in commit 8a42fe1c, and then I get

```
$ git branch --contains 8a42fe1c
  t/24359/turn_meataxe_into_a_dynamic_library
  t/24468/fix_comparison_of_matrices_that_live_in_equivalent_matrix_spaces
```
The changeset is

```diff
diff --git a/src/sage/matrix/matrix_gfpn_dense.pyx b/src/sage/matrix/matrix_gfpn_dense.pyx
index 22af9fc..f8b53da 100644
--- a/src/sage/matrix/matrix_gfpn_dense.pyx
+++ b/src/sage/matrix/matrix_gfpn_dense.pyx
@@ -365,7 +365,7 @@ cdef class Matrix_gfpn_dense(Matrix_dense):
                 sage: Matrix_gfpn_dense('foobarNONEXISTING_FILE')       # optional: meataxe
                 Traceback (most recent call last):
                 ...
-                OSError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 254)
+                OSError: .../foobarNONEXISTING_FILE: No such file or directory in file os.c (line 255)
                 sage: Matrix_gfpn_dense('')                             # optional: meataxe
                 Traceback (most recent call last):
                 ...
```

And you are right in the sense that that test does not belong to #24445.

Anyway, the build error you are reporting seems very strange.



---

archive/issue_comments_359808.json:
```json
{
    "body": "<a id='comment:3'></a>The build issue is not *caused* by this ticket (the old meataxe also had it and other optional Cython modules might also have it) but given that it's easy to fix, let's do that. Details coming soon...",
    "created_at": "2018-01-04T12:43:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359808",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>The build issue is not *caused* by this ticket (the old meataxe also had it and other optional Cython modules might also have it) but given that it's easy to fix, let's do that. Details coming soon...



---

archive/issue_comments_359809.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-04T12:46:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359809",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359810.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-04T12:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359810",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359811.json:
```json
{
    "body": "<a id='comment:5'></a>The build issue is that the `mtx` library should exist **if and only if** meataxe is installed. This can be ensured by deleting all `mtx` libraries before installing meataxe.\n\nIn detail: the build-time check in `src/module_list.py` checks whether or not the \"meataxe\" package is marked as installed but the run-time check for the `matrix_gfpn_dense` module checks whether it can be imported. We need to ensure that these two conditions are equivalent, otherwise strange things can happen.\n\nThe problem in [comment:154] happened after a *failed* build of meataxe. Now the Sage build system considers meataxe as *not installed*, so it doesn't rebuild the Cython module `matrix_gfpn_dense`. But the Cython module (actually, an outdated version of it) still exists in the install tree. And because `libmtx.so` still exists, it can still be imported.",
    "created_at": "2018-01-04T12:53:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359811",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>The build issue is that the `mtx` library should exist **if and only if** meataxe is installed. This can be ensured by deleting all `mtx` libraries before installing meataxe.

In detail: the build-time check in `src/module_list.py` checks whether or not the "meataxe" package is marked as installed but the run-time check for the `matrix_gfpn_dense` module checks whether it can be imported. We need to ensure that these two conditions are equivalent, otherwise strange things can happen.

The problem in [comment:154] happened after a *failed* build of meataxe. Now the Sage build system considers meataxe as *not installed*, so it doesn't rebuild the Cython module `matrix_gfpn_dense`. But the Cython module (actually, an outdated version of it) still exists in the install tree. And because `libmtx.so` still exists, it can still be imported.



---

archive/issue_comments_359812.json:
```json
{
    "body": "<a id='comment:166'></a>Replying to [comment:157 SimonKing]:\n> #24445 is (from my point of view) a dependency for this ticket. So, why are you blaming this ticket for a failure in #24445?\n\n\nThe ticket is irrelevant. So it really has nothing to do with #24445.",
    "created_at": "2018-01-04T12:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359812",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:166'></a>Replying to [comment:157 SimonKing]:
> #24445 is (from my point of view) a dependency for this ticket. So, why are you blaming this ticket for a failure in #24445?


The ticket is irrelevant. So it really has nothing to do with #24445.



---

archive/issue_comments_359813.json:
```json
{
    "body": "<a id='comment:7'></a>The underlying build issue is also fixed on the Cython level at #24471. Still, I think it's safer to delete all old meataxe libraries anyway. That is not a strong opinion though: I will change my mind if you think that I should.",
    "created_at": "2018-01-04T13:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359813",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>The underlying build issue is also fixed on the Cython level at #24471. Still, I think it's safer to delete all old meataxe libraries anyway. That is not a strong opinion though: I will change my mind if you think that I should.



---

archive/issue_comments_359814.json:
```json
{
    "body": "<a id='comment:168'></a>Replying to [comment:167 jdemeyer]:\n> The underlying build issue is also fixed on the Cython level at #24471. Still, I think it's safer to delete all old meataxe libraries anyway. That is not a strong opinion though: I will change my mind if you think that I should.\n\n\nIf I understand correctly, some optional packages start the installation with `make uninstall`, to make sure that no old stuff is breaking the new stuff. I think the new meataxe spkg should do the same. After all, the autotoolized Makefile also has an `uninstall` target.",
    "created_at": "2018-01-04T13:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359814",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:168'></a>Replying to [comment:167 jdemeyer]:
> The underlying build issue is also fixed on the Cython level at #24471. Still, I think it's safer to delete all old meataxe libraries anyway. That is not a strong opinion though: I will change my mind if you think that I should.


If I understand correctly, some optional packages start the installation with `make uninstall`, to make sure that no old stuff is breaking the new stuff. I think the new meataxe spkg should do the same. After all, the autotoolized Makefile also has an `uninstall` target.



---

archive/issue_comments_359815.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-04T13:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359815",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359816.json:
```json
{
    "body": "<a id='comment:9'></a>Since the install location is the same in the old and in the new version, `make install` of the new version should successfully remove the old version.",
    "created_at": "2018-01-04T13:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359816",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>Since the install location is the same in the old and in the new version, `make install` of the new version should successfully remove the old version.



---

archive/issue_comments_359817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-04T13:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359817",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359818.json:
```json
{
    "body": "<a id='comment:2'></a>Oops, my mistake.\n\nI forgot to pull from your smashed branch.",
    "created_at": "2018-01-04T13:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359818",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Oops, my mistake.

I forgot to pull from your smashed branch.



---

archive/issue_comments_359819.json:
```json
{
    "body": "<a id='comment:5'></a>Now it should be right.\n\n---\nNew commits:",
    "created_at": "2018-01-04T13:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359819",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>Now it should be right.

---
New commits:



---

archive/issue_comments_359820.json:
```json
{
    "body": "<a id='comment:6'></a>I don't think that there is much point in running `make uninstall` before `make install`. It doesn't uninstall the old package: in general, it only uninstalls the files which are installed by `make install`. For example, if your package doesn't install `libmtx.a`, then `make uninstall` would not remove `libmtx.a`.",
    "created_at": "2018-01-04T14:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359820",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>I don't think that there is much point in running `make uninstall` before `make install`. It doesn't uninstall the old package: in general, it only uninstalls the files which are installed by `make install`. For example, if your package doesn't install `libmtx.a`, then `make uninstall` would not remove `libmtx.a`.



---

archive/issue_comments_359821.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-04T14:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359821",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359822.json:
```json
{
    "body": "<a id='comment:177'></a>Replying to [comment:176 jdemeyer]:\n> I don't think that there is much point in running `make uninstall` before `make install`. It doesn't uninstall the old package: in general, it only uninstalls the files which are installed by `make install`. For example, if your package doesn't install `libmtx.a`, then `make uninstall` would not remove `libmtx.a`.\n\n\nThat's why there also is the line\n\n```\nrm -f \"$SAGE_LOCAL\"/lib/libmtx.*\n```\nin spkg-install.",
    "created_at": "2018-01-04T14:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359822",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:177'></a>Replying to [comment:176 jdemeyer]:
> I don't think that there is much point in running `make uninstall` before `make install`. It doesn't uninstall the old package: in general, it only uninstalls the files which are installed by `make install`. For example, if your package doesn't install `libmtx.a`, then `make uninstall` would not remove `libmtx.a`.


That's why there also is the line

```
rm -f "$SAGE_LOCAL"/lib/libmtx.*
```
in spkg-install.



---

archive/issue_comments_359823.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-04T14:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359823",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359824.json:
```json
{
    "body": "<a id='comment:8'></a>PS: I suppose there only is a problem when moving back from the new meataxe version (which is 1.0, as it refers to SharedMeatAxe 1.0) back to the old version (which is 2.4.24, as it refers to MeatAxe 2.4.24). The old spkg-install did (if I recall correctly) not remove `libmtx.*`, and thus there may be a conflict with the leftover `libmtx.so` after downgrading.",
    "created_at": "2018-01-04T15:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359824",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>PS: I suppose there only is a problem when moving back from the new meataxe version (which is 1.0, as it refers to SharedMeatAxe 1.0) back to the old version (which is 2.4.24, as it refers to MeatAxe 2.4.24). The old spkg-install did (if I recall correctly) not remove `libmtx.*`, and thus there may be a conflict with the leftover `libmtx.so` after downgrading.



---

archive/issue_comments_359825.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-01-04T15:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359825",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_359826.json:
```json
{
    "body": "<a id='comment:179'></a>Replying to [comment:177 SimonKing]:\n> That's why there also is the line\n> \n> ```\n> rm -f \"$SAGE_LOCAL\"/lib/libmtx.*\n> ```\n> in spkg-install.\n\n\nExactly. But then what is the point of the `$MAKE uninstall` that you added? It's not technically *wrong* but as far as I can tell, it doesn't serve any purpose.",
    "created_at": "2018-01-04T15:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359826",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:179'></a>Replying to [comment:177 SimonKing]:
> That's why there also is the line
> 
> ```
> rm -f "$SAGE_LOCAL"/lib/libmtx.*
> ```
> in spkg-install.


Exactly. But then what is the point of the `$MAKE uninstall` that you added? It's not technically *wrong* but as far as I can tell, it doesn't serve any purpose.



---

archive/issue_comments_359827.json:
```json
{
    "body": "<a id='comment:180'></a>Replying to [comment:179 jdemeyer]:\n> Exactly. But then what is the point of the `$MAKE uninstall` that you added? It's not technically *wrong* but as far as I can tell, it doesn't serve any purpose.\n\n\nIf you prefer, we can remove the previous commit.",
    "created_at": "2018-01-04T15:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359827",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:180'></a>Replying to [comment:179 jdemeyer]:
> Exactly. But then what is the point of the `$MAKE uninstall` that you added? It's not technically *wrong* but as far as I can tell, it doesn't serve any purpose.


If you prefer, we can remove the previous commit.



---

archive/issue_comments_359828.json:
```json
{
    "body": "<a id='comment:181'></a>Replying to [comment:178 SimonKing]:\n> PS: I suppose there only is a problem when moving back from the new meataxe version (which is 1.0, as it refers to SharedMeatAxe 1.0) back to the old version (which is 2.4.24, as it refers to MeatAxe 2.4.24). The old spkg-install did (if I recall correctly) not remove `libmtx.*`, and thus there may be a conflict with the leftover `libmtx.so` after downgrading.\n\n\nThat is indeed also an issue, but unrelated to the Cython issue from [comment:154] that [13828d1](https://git.sagemath.org/sage.git/commit/?id=13828d1cb042ce03148d3319bdfecee1ec54862f) is meant to fix.\n\nThis issue with downgrading cannot easily be fixed since we cannot retro-actively patch the current meataxe in 8.2.beta2. Luckily, the consequences are not severe: in the worst case, your new SharedMeatAxe from this ticket will be used on downgraded installations of Sage.",
    "created_at": "2018-01-04T15:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359828",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:181'></a>Replying to [comment:178 SimonKing]:
> PS: I suppose there only is a problem when moving back from the new meataxe version (which is 1.0, as it refers to SharedMeatAxe 1.0) back to the old version (which is 2.4.24, as it refers to MeatAxe 2.4.24). The old spkg-install did (if I recall correctly) not remove `libmtx.*`, and thus there may be a conflict with the leftover `libmtx.so` after downgrading.


That is indeed also an issue, but unrelated to the Cython issue from [comment:154] that [13828d1](https://git.sagemath.org/sage.git/commit/?id=13828d1cb042ce03148d3319bdfecee1ec54862f) is meant to fix.

This issue with downgrading cannot easily be fixed since we cannot retro-actively patch the current meataxe in 8.2.beta2. Luckily, the consequences are not severe: in the worst case, your new SharedMeatAxe from this ticket will be used on downgraded installations of Sage.



---

archive/issue_comments_359829.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-01-04T15:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359829",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_359830.json:
```json
{
    "body": "<a id='comment:3'></a>My last commit still needs review...",
    "created_at": "2018-01-05T09:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359830",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>My last commit still needs review...



---

archive/issue_comments_359831.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-05T12:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359831",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_359832.json:
```json
{
    "body": "<a id='comment:184'></a>Replying to [comment:183 jdemeyer]:\n> My last commit still needs review...\n\n\nIs 13828d1cb042ce03148d3319bdfecee1ec54862f the only one? I thought this was a referee patch...\n\nLooks good to me. So, I hope that's being a positive review, then.",
    "created_at": "2018-01-05T12:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359832",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:184'></a>Replying to [comment:183 jdemeyer]:
> My last commit still needs review...


Is 13828d1cb042ce03148d3319bdfecee1ec54862f the only one? I thought this was a referee patch...

Looks good to me. So, I hope that's being a positive review, then.



---

archive/issue_comments_359833.json:
```json
{
    "body": "<a id='comment:185'></a>Replying to [comment:184 SimonKing]:\n> Replying to [comment:183 jdemeyer]:\n> > My last commit still needs review...\n\n> \n> Is 13828d1cb042ce03148d3319bdfecee1ec54862f the only one? I thought this was a referee patch...\n\n\nIt is a referee patch. But given that it's non-trivial, it should be reviewed I think.",
    "created_at": "2018-01-05T12:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359833",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:185'></a>Replying to [comment:184 SimonKing]:
> Replying to [comment:183 jdemeyer]:
> > My last commit still needs review...

> 
> Is 13828d1cb042ce03148d3319bdfecee1ec54862f the only one? I thought this was a referee patch...


It is a referee patch. But given that it's non-trivial, it should be reviewed I think.



---

archive/issue_comments_359834.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-06T11:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24359#issuecomment-359834",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061595.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-06T11:30:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24359",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24359#event-61595"
}
```
