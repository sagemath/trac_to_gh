# Issue 24343: py3: miscellaneous fixes to sage.doctest

archive/issues_024106.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThese are most of the fixes I've made so far to the `sage.doctest` package.  It's probably not exhaustive, but these are at least the main bug fixes that were needed to get it working (and for its own self-tests to pass, though that also requires fixes in other modules).\n\nCC:  @fchapoton\n\nComponent: **python3**\n\nAuthor: **Erik Bray**\n\nBranch: **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)**\n\nReviewer: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24343_\n\n",
    "closed_at": "2018-03-21T06:19:01Z",
    "created_at": "2017-12-08T11:41:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: miscellaneous fixes to sage.doctest",
    "type": "issue",
    "updated_at": "2018-04-06T14:39:03Z",
    "url": "https://github.com/sagemath/sage/issues/24343",
    "user": "https://github.com/embray"
}
```
<div id="comment:0"></div>

These are most of the fixes I've made so far to the `sage.doctest` package.  It's probably not exhaustive, but these are at least the main bug fixes that were needed to get it working (and for its own self-tests to pass, though that also requires fixes in other modules).

CC:  @fchapoton

Component: **python3**

Author: **Erik Bray**

Branch: **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)**

Reviewer: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/24343_





---

archive/issue_events_334591.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T11:41:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334591"
}
```



---

archive/issue_events_334592.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T11:41:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334592"
}
```



---

archive/issue_events_334593.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T11:41:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334593"
}
```



---

archive/issue_events_334594.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T11:41:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334594"
}
```



---

archive/issue_comments_368283.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis won't be \"ready for review\" I think until some of its dependencies are dealt with first, but in the meantime if you want to try using these fixes it should prove helpful.",
    "created_at": "2017-12-08T11:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368283",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

This won't be "ready for review" I think until some of its dependencies are dealt with first, but in the meantime if you want to try using these fixes it should prove helpful.



---

archive/issue_comments_368284.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13\"><code>589e7a2</code></a></td><td><code>Slight reworking of the arguments to atomic_write:</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad\"><code>9a4d548</code></a></td><td><code>Slight correction to this docstring.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9398b577e70b8809fdc4680d6c5ea5c6f962d8be\"><code>9398b57</code></a></td><td><code>Miscellaneous fixes to tests in the doctest module.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5426bdbf0f753573cf94c4bb189d5ce44be3735d\"><code>5426bdb</code></a></td><td><code>Fix various minor encoding issues, and specify an encoding to use for writing the stats file.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5663cc053c97c83d67981be67862439d85e5807\"><code>a5663cc</code></a></td><td><code>Convert these classes to 'new-style' classes for consistency with Python 3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18cdffcfb580383779f28ff088e5752d34c1faf5\"><code>18cdffc</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670\"><code>2203ca2</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ccd5e960503c867170f9bffd31364da35e962aca\"><code>ccd5e96</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>\n",
    "created_at": "2018-01-17T09:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368284",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/589e7a2b6012f99542760fac2ddedb034cfbbd13"><code>589e7a2</code></a></td><td><code>Slight reworking of the arguments to atomic_write:</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a4d5481aa418e4c8d273c4f919b64491ac892ad"><code>9a4d548</code></a></td><td><code>Slight correction to this docstring.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9398b577e70b8809fdc4680d6c5ea5c6f962d8be"><code>9398b57</code></a></td><td><code>Miscellaneous fixes to tests in the doctest module.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5426bdbf0f753573cf94c4bb189d5ce44be3735d"><code>5426bdb</code></a></td><td><code>Fix various minor encoding issues, and specify an encoding to use for writing the stats file.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5663cc053c97c83d67981be67862439d85e5807"><code>a5663cc</code></a></td><td><code>Convert these classes to 'new-style' classes for consistency with Python 3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18cdffcfb580383779f28ff088e5752d34c1faf5"><code>18cdffc</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670"><code>2203ca2</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ccd5e960503c867170f9bffd31364da35e962aca"><code>ccd5e96</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>




---

archive/issue_comments_368285.json:
```json
{
    "body": "Changed commit from **[`fd139c9`](https://github.com/sagemath/sagetrac-mirror/commit/fd139c9bca7cde3189262290cb6f904baaf02892)** to **[`ccd5e96`](https://github.com/sagemath/sagetrac-mirror/commit/ccd5e960503c867170f9bffd31364da35e962aca)**",
    "created_at": "2018-01-17T09:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368285",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fd139c9`](https://github.com/sagemath/sagetrac-mirror/commit/fd139c9bca7cde3189262290cb6f904baaf02892)** to **[`ccd5e96`](https://github.com/sagemath/sagetrac-mirror/commit/ccd5e960503c867170f9bffd31364da35e962aca)**



---

archive/issue_comments_368286.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\ndoes not apply",
    "created_at": "2018-01-23T15:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368286",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

does not apply



---

archive/issue_events_334595.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-12T14:13:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334595"
}
```



---

archive/issue_comments_368287.json:
```json
{
    "body": "Changed dependencies from **#24313, #24234** to none",
    "created_at": "2018-02-12T14:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368287",
    "user": "https://github.com/fchapoton"
}
```

Changed dependencies from **#24313, #24234** to none



---

archive/issue_events_334596.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-12T14:13:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334596"
}
```



---

archive/issue_events_334597.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-12T14:13:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334597"
}
```



---

archive/issue_comments_368288.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWorking on rebasing this.  This used to have all tests passing on Python 3, and still appears to there, but breaks some things on Python 2 now (I think it used to work there but now I'm not sure, it's been too long).",
    "created_at": "2018-02-12T16:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368288",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Working on rebasing this.  This used to have all tests passing on Python 3, and still appears to there, but breaks some things on Python 2 now (I think it used to work there but now I'm not sure, it's been too long).



---

archive/issue_comments_368289.json:
```json
{
    "body": "Changed commit from **[`ccd5e96`](https://github.com/sagemath/sagetrac-mirror/commit/ccd5e960503c867170f9bffd31364da35e962aca)** to **[`7dd7f9a`](https://github.com/sagemath/sagetrac-mirror/commit/7dd7f9af21846d5d4d98815eff3cc409327dc793)**",
    "created_at": "2018-02-12T17:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368289",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ccd5e96`](https://github.com/sagemath/sagetrac-mirror/commit/ccd5e960503c867170f9bffd31364da35e962aca)** to **[`7dd7f9a`](https://github.com/sagemath/sagetrac-mirror/commit/7dd7f9af21846d5d4d98815eff3cc409327dc793)**



---

archive/issue_comments_368290.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aedc61a7037a5164d046b42845aaa571ceab3f5d\"><code>aedc61a</code></a></td><td><code>Miscellaneous fixes to tests in the doctest module.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ee3e9b6a9545585e2e02999b6f846df00c2ee23\"><code>1ee3e9b</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96ae33273894fbd3a69036f2c4c518bf75310267\"><code>96ae332</code></a></td><td><code>Convert these classes to 'new-style' classes for consistency with Python 3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c040c679afacd1fcccffd16a167650dfe5b3ea3a\"><code>c040c67</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/380a902c3c3b5ea18363fa3390c9158215b9282c\"><code>380a902</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92117e5362eb91e09e3c776a6566a26302cd5073\"><code>92117e5</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72fdf00823672ebf7b82d5be6d554a714bf02bb3\"><code>72fdf00</code></a></td><td><code>Python 2 will accept br as a string prefix but not rb</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db544c737f4eb448252bf880dd3074c083cabd41\"><code>db544c7</code></a></td><td><code>This exception reads 'utf-8' on Python 3 and 'utf8' on Python 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7dd7f9af21846d5d4d98815eff3cc409327dc793\"><code>7dd7f9a</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr></table>\n",
    "created_at": "2018-02-12T17:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368290",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aedc61a7037a5164d046b42845aaa571ceab3f5d"><code>aedc61a</code></a></td><td><code>Miscellaneous fixes to tests in the doctest module.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ee3e9b6a9545585e2e02999b6f846df00c2ee23"><code>1ee3e9b</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96ae33273894fbd3a69036f2c4c518bf75310267"><code>96ae332</code></a></td><td><code>Convert these classes to 'new-style' classes for consistency with Python 3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c040c679afacd1fcccffd16a167650dfe5b3ea3a"><code>c040c67</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/380a902c3c3b5ea18363fa3390c9158215b9282c"><code>380a902</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92117e5362eb91e09e3c776a6566a26302cd5073"><code>92117e5</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72fdf00823672ebf7b82d5be6d554a714bf02bb3"><code>72fdf00</code></a></td><td><code>Python 2 will accept br as a string prefix but not rb</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db544c737f4eb448252bf880dd3074c083cabd41"><code>db544c7</code></a></td><td><code>This exception reads 'utf-8' on Python 3 and 'utf8' on Python 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7dd7f9af21846d5d4d98815eff3cc409327dc793"><code>7dd7f9a</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr></table>




---

archive/issue_events_334598.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-12T17:10:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334598"
}
```



---

archive/issue_events_334599.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-12T17:10:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334599"
}
```



---

archive/issue_comments_368291.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis has all the tests passing on Python 2, as well as on Python 3 *except* for a test that was added recently to `FileDocTestSource.create_doctests` (the \"bitness\" test).  I'll worry about that later; it's not really a substantive failure.",
    "created_at": "2018-02-12T17:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368291",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

This has all the tests passing on Python 2, as well as on Python 3 *except* for a test that was added recently to `FileDocTestSource.create_doctests` (the "bitness" test).  I'll worry about that later; it's not really a substantive failure.



---

archive/issue_comments_368292.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThere is a lot of stuff happening in this branch. I would appreciate if this could be split up in smaller independent pieces, especially where you are making structural changes.",
    "created_at": "2018-02-13T08:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368292",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

There is a lot of stuff happening in this branch. I would appreciate if this could be split up in smaller independent pieces, especially where you are making structural changes.



---

archive/issue_comments_368293.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhen trying to use this branch in python3 to doctest a file, I get lots and lots of trivial doctests failures, typically like this one:\n\n```\nFile \"src/sage/combinat/yang_baxter_graph.py\", line 576, in sage.combinat.yang_baxter_graph.YangBaxterGraph_partition.__init__\nFailed example:\n    Y = YangBaxterGraph(partition=[3,2,1]); Y\nExpected:\n    Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)\nGot:\n    b'Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)'\n```",
    "created_at": "2018-02-15T13:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368293",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

When trying to use this branch in python3 to doctest a file, I get lots and lots of trivial doctests failures, typically like this one:

```
File "src/sage/combinat/yang_baxter_graph.py", line 576, in sage.combinat.yang_baxter_graph.YangBaxterGraph_partition.__init__
Failed example:
    Y = YangBaxterGraph(partition=[3,2,1]); Y
Expected:
    Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)
Got:
    b'Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)'
```



---

archive/issue_comments_368294.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@fchapoton](#comment%3A10):\n> When trying to use this branch in python3 to doctest a file, I get lots and lots of trivial doctests failures, typically like this one:\n> \n> ```\n> File \"src/sage/combinat/yang_baxter_graph.py\", line 576, in sage.combinat.yang_baxter_graph.YangBaxterGraph_partition.__init__\n> Failed example:\n>     Y = YangBaxterGraph(partition=[3,2,1]); Y\n> Expected:\n>     Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)\n> Got:\n>     b'Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)'\n> ```\n\nThat's likely. This is related to `sage.repl.rich_ouput.backend_test`.  I have fixes to that coming in a separate ticket.",
    "created_at": "2018-02-15T15:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368294",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@fchapoton](#comment%3A10):
> When trying to use this branch in python3 to doctest a file, I get lots and lots of trivial doctests failures, typically like this one:
> 
> ```
> File "src/sage/combinat/yang_baxter_graph.py", line 576, in sage.combinat.yang_baxter_graph.YangBaxterGraph_partition.__init__
> Failed example:
>     Y = YangBaxterGraph(partition=[3,2,1]); Y
> Expected:
>     Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)
> Got:
>     b'Yang-Baxter graph of [3, 2, 1], with top vertex (0, 1, 0, 2, 1, 0)'
> ```

That's likely. This is related to `sage.repl.rich_ouput.backend_test`.  I have fixes to that coming in a separate ticket.



---

archive/issue_comments_368295.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment%3A9):\n> There is a lot of stuff happening in this branch. I would appreciate if this could be split up in smaller independent pieces, especially where you are making structural changes.\n\nYou are welcome to look at the [individual commits](https://github.com/sagemath/sagetrac-mirror/compare/e6cae6d88dc018f6421a91fc4d9e073ab138644e...7dd7f9af21846d5d4d98815eff3cc409327dc793) if that would be easier.",
    "created_at": "2018-02-15T15:59:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368295",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment%3A9):
> There is a lot of stuff happening in this branch. I would appreciate if this could be split up in smaller independent pieces, especially where you are making structural changes.

You are welcome to look at the [individual commits](https://github.com/sagemath/sagetrac-mirror/compare/e6cae6d88dc018f6421a91fc4d9e073ab138644e...7dd7f9af21846d5d4d98815eff3cc409327dc793) if that would be easier.



---

archive/issue_comments_368296.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nFWIW I opened this ticket *two months ago* and actually was using these fixes well before I opened the ticket to run the tests on Python 3, with consistent success (in that the test framework completes test runs and correctly reports passes and failures).",
    "created_at": "2018-02-15T16:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368296",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

FWIW I opened this ticket *two months ago* and actually was using these fixes well before I opened the ticket to run the tests on Python 3, with consistent success (in that the test framework completes test runs and correctly reports passes and failures).



---

archive/issue_comments_368297.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment%3A12):\n> You are welcome to look at the individual commits if that would be easier.\n\nThe question is: am I supposed to review individual commits or the branch as a whole? I'm fine with doing either of those two extremes but rather not a mixture (I don't want to *look* at individual commits when you want me to *review* the branch as a whole).",
    "created_at": "2018-02-15T16:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368297",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment%3A12):
> You are welcome to look at the individual commits if that would be easier.

The question is: am I supposed to review individual commits or the branch as a whole? I'm fine with doing either of those two extremes but rather not a mixture (I don't want to *look* at individual commits when you want me to *review* the branch as a whole).



---

archive/issue_comments_368298.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n...and if you really want me to review individual commits, I would prefer to split this over multiple tickets.",
    "created_at": "2018-02-15T16:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368298",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

...and if you really want me to review individual commits, I would prefer to split this over multiple tickets.



---

archive/issue_comments_368299.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI'm not sure what the distinction is.  There are literally thousands of things that need to be fixed for Python 3. Grouping up large sets of fixes on a per-module or per-package basis should get things done more quickly and with fewer merge problems, than if they were spread across multiple tickets of \"miscellaneous fixes 1\", \"miscellaneous fixes 2\", etc.\n\nI'm pretty frustrated (and I believe Fr\u00e9d\u00e9ric is too) that I've actually already fixed like 50% of the tests on Python 3 but have all the work squirreled away in my private branch, often resulting in duplicate effort (e.g. #24739).  And the biggest bottleneck now is just the rate at which I can open logical tickets.\n\nIf you want to review some set of changes I don't see what difference it makes for you.",
    "created_at": "2018-02-15T16:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368299",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

I'm not sure what the distinction is.  There are literally thousands of things that need to be fixed for Python 3. Grouping up large sets of fixes on a per-module or per-package basis should get things done more quickly and with fewer merge problems, than if they were spread across multiple tickets of "miscellaneous fixes 1", "miscellaneous fixes 2", etc.

I'm pretty frustrated (and I believe Frédéric is too) that I've actually already fixed like 50% of the tests on Python 3 but have all the work squirreled away in my private branch, often resulting in duplicate effort (e.g. #24739).  And the biggest bottleneck now is just the rate at which I can open logical tickets.

If you want to review some set of changes I don't see what difference it makes for you.



---

archive/issue_comments_368300.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@embray](#comment%3A16):\n> Grouping up large sets of fixes on a per-module or per-package basis should get things done more quickly and with fewer merge problems, than if they were spread across multiple tickets of \"miscellaneous fixes 1\", \"miscellaneous fixes 2\", etc.\n\nMy opinion is the opposite. I find it easier to deal with many small isolated tickets instead of single large tickets. Mainly because it will allow easy things to pass immediately.\n\nSpeaking of frustration... I find your refusal to split up tickets frustrating. I'm not even asking you to split up the tickets. I'm asking for permission to split up your tickets.",
    "created_at": "2018-02-15T16:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368300",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@embray](#comment%3A16):
> Grouping up large sets of fixes on a per-module or per-package basis should get things done more quickly and with fewer merge problems, than if they were spread across multiple tickets of "miscellaneous fixes 1", "miscellaneous fixes 2", etc.

My opinion is the opposite. I find it easier to deal with many small isolated tickets instead of single large tickets. Mainly because it will allow easy things to pass immediately.

Speaking of frustration... I find your refusal to split up tickets frustrating. I'm not even asking you to split up the tickets. I'm asking for permission to split up your tickets.



---

archive/issue_comments_368301.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@embray](#comment%3A16):\n> I'm not sure what the distinction is.\n\nThe distinction is mainly whether the commits are logically/functionally independent or not. If you have a first commit which is broken and then commit 2 and commit 3 to fix issues with the first commit, it makes no sense to review by commit. If on the other hand, every commit fixes a single issue, it does make sense to review by commit.",
    "created_at": "2018-02-15T16:21:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368301",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@embray](#comment%3A16):
> I'm not sure what the distinction is.

The distinction is mainly whether the commits are logically/functionally independent or not. If you have a first commit which is broken and then commit 2 and commit 3 to fix issues with the first commit, it makes no sense to review by commit. If on the other hand, every commit fixes a single issue, it does make sense to review by commit.



---

archive/issue_comments_368302.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment%3A17):\n> Replying to [@embray](#comment%3A16):\n> > Grouping up large sets of fixes on a per-module or per-package basis should get things done more quickly and with fewer merge problems, than if they were spread across multiple tickets of \"miscellaneous fixes 1\", \"miscellaneous fixes 2\", etc.\n> \n> \n> My opinion is the opposite. I find it easier to deal with many small isolated tickets instead of single large tickets. Mainly because it will allow easy things to pass immediately.\n> \n> Speaking of frustration... I find your refusal to split up tickets frustrating. I'm not even asking you to split up the tickets. I'm asking for permission to split up your tickets.\n\nHey, if *you're* willing to do it be my guest.  I don't see what you'd want to spend the time.",
    "created_at": "2018-02-15T16:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368302",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment%3A17):
> Replying to [@embray](#comment%3A16):
> > Grouping up large sets of fixes on a per-module or per-package basis should get things done more quickly and with fewer merge problems, than if they were spread across multiple tickets of "miscellaneous fixes 1", "miscellaneous fixes 2", etc.
> 
> 
> My opinion is the opposite. I find it easier to deal with many small isolated tickets instead of single large tickets. Mainly because it will allow easy things to pass immediately.
> 
> Speaking of frustration... I find your refusal to split up tickets frustrating. I'm not even asking you to split up the tickets. I'm asking for permission to split up your tickets.

Hey, if *you're* willing to do it be my guest.  I don't see what you'd want to spend the time.



---

archive/issue_comments_368303.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment%3A18):\n> Replying to [@embray](#comment%3A16):\n> > I'm not sure what the distinction is.\n> \n> \n> The distinction is mainly whether the commits are logically/functionally independent or not. If you have a first commit which is broken and then commit 2 and commit 3 to fix issues with the first commit, it makes no sense to review by commit. If on the other hand, every commit fixes a single issue, it does make sense to review by commit.\n\nThat isn't really the case here.  I believe there might be 1 or 2 fixup commits added late to this branch because it wasn't passing on Python 2, but those are actually worth keeping as separate commits since I felt they called out specific Python 2/3 differences that were worth making note of.\n\nYou should know by now that I know how to use rebase effectively and usually try to organize my commits in a logical fashion, and also that I frequently write detailed commit messages about what is being changed and why.  I really don't understand why you care.  If it were me I would just look at the changes--make note of any specific ones I want to comment on, and that's that.\n\nOr just even glance over briefly to make sure nothing stands out, and then give you the benefit of the doubt.  You don't have to scrutinize every single change everyone makes.  Nobody has time for that.",
    "created_at": "2018-02-15T16:26:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368303",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment%3A18):
> Replying to [@embray](#comment%3A16):
> > I'm not sure what the distinction is.
> 
> 
> The distinction is mainly whether the commits are logically/functionally independent or not. If you have a first commit which is broken and then commit 2 and commit 3 to fix issues with the first commit, it makes no sense to review by commit. If on the other hand, every commit fixes a single issue, it does make sense to review by commit.

That isn't really the case here.  I believe there might be 1 or 2 fixup commits added late to this branch because it wasn't passing on Python 2, but those are actually worth keeping as separate commits since I felt they called out specific Python 2/3 differences that were worth making note of.

You should know by now that I know how to use rebase effectively and usually try to organize my commits in a logical fashion, and also that I frequently write detailed commit messages about what is being changed and why.  I really don't understand why you care.  If it were me I would just look at the changes--make note of any specific ones I want to comment on, and that's that.

Or just even glance over briefly to make sure nothing stands out, and then give you the benefit of the doubt.  You don't have to scrutinize every single change everyone makes.  Nobody has time for that.



---

archive/issue_comments_368304.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@embray](#comment%3A20):\n> You don't have to scrutinize every single change everyone makes.\n\nI almost feel bad to say that I am trying to do exactly that.",
    "created_at": "2018-02-15T16:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368304",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@embray](#comment%3A20):
> You don't have to scrutinize every single change everyone makes.

I almost feel bad to say that I am trying to do exactly that.



---

archive/issue_comments_368305.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment%3A21):\n> Replying to [@embray](#comment%3A20):\n> > You don't have to scrutinize every single change everyone makes.\n> \n> \n> I almost feel bad to say that I am trying to do exactly that. \n\nAnd I appreciate that, because your scrutiny promotes a high level of quality.  But I don't know how you then find time for much else.  I'm a strong proponent of careful code review, but sometimes you also have to pick your battles, or trust other people to review things.  I used to review every single line change to Astropy when we started the project, but as it grew there was no way I could keep up, especially as large modules grew in which different people had more expertise, and I learned to trust them to do their best in terms of quality assurance.  I still give most changes a glance over in case there are *specific* issues I'm concerned about.\n\nAnyways, you do what you want, and believe it or not I try my best to keep my changes reasonably atomic and logical (though this becomes difficult when making mass sets of minor fixes).  And I'll do what I can to make things easier.  I just wish I understood your process better and why you find it helpful to review a whole branch versus individual commits.\n\nTo me, looking over the full merge commit is obviously the first pass, and if there are individual changes I have more questions about I'll often drill more into the history of that file to find the individual commit where that change was made.\n\nI agree this becomes more difficult if there are lots of commits combined that affect multiple files simultaneously.  I wouldn't often combine changes like that into a single ticket (hence why I broke up #24740 and #24741, and considered actually breaking the latter into two more tickets).  In this case, however, all the changes are fairly small an localized.",
    "created_at": "2018-02-15T16:51:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368305",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment%3A21):
> Replying to [@embray](#comment%3A20):
> > You don't have to scrutinize every single change everyone makes.
> 
> 
> I almost feel bad to say that I am trying to do exactly that. 

And I appreciate that, because your scrutiny promotes a high level of quality.  But I don't know how you then find time for much else.  I'm a strong proponent of careful code review, but sometimes you also have to pick your battles, or trust other people to review things.  I used to review every single line change to Astropy when we started the project, but as it grew there was no way I could keep up, especially as large modules grew in which different people had more expertise, and I learned to trust them to do their best in terms of quality assurance.  I still give most changes a glance over in case there are *specific* issues I'm concerned about.

Anyways, you do what you want, and believe it or not I try my best to keep my changes reasonably atomic and logical (though this becomes difficult when making mass sets of minor fixes).  And I'll do what I can to make things easier.  I just wish I understood your process better and why you find it helpful to review a whole branch versus individual commits.

To me, looking over the full merge commit is obviously the first pass, and if there are individual changes I have more questions about I'll often drill more into the history of that file to find the individual commit where that change was made.

I agree this becomes more difficult if there are lots of commits combined that affect multiple files simultaneously.  I wouldn't often combine changes like that into a single ticket (hence why I broke up #24740 and #24741, and considered actually breaking the latter into two more tickets).  In this case, however, all the changes are fairly small an localized.



---

archive/issue_comments_368306.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nTo put things more constructively, if you can give me some idea how you prefer to see changes logically split into individual tickets, I can certainly keep that in mind in the future.\n\nIt's just that for the Python 3 fixes there are so many thousands of little changes, I thought it would be simplest (and least likely to produce conflicts) to group together large sets of small fixes by package, or in some cases by individual module.\n\nObviously if I require some more substantive change (such as new features) I can, and have, made separate tickets for that.  Beyond that I'm not really sure.",
    "created_at": "2018-02-15T17:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368306",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

To put things more constructively, if you can give me some idea how you prefer to see changes logically split into individual tickets, I can certainly keep that in mind in the future.

It's just that for the Python 3 fixes there are so many thousands of little changes, I thought it would be simplest (and least likely to produce conflicts) to group together large sets of small fixes by package, or in some cases by individual module.

Obviously if I require some more substantive change (such as new features) I can, and have, made separate tickets for that.  Beyond that I'm not really sure.



---

archive/issue_comments_368307.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@embray](#comment%3A23):\n> To put things more constructively, if you can give me some idea how you prefer to see changes logically split into individual tickets, I can certainly keep that in mind in the future.\n\nBroadly speaking, there are 3 level of changes:\n\n1. Small isolated changes and basic clean-up, e.g. adding `str/bytes` conversion, using `with(open())`, fixing imports, style changes.\n\n2. Non-trivial changes which do not change user-visible functionality, i.e. refactoring.\n\n3. Changes to user-visible functionality.\n\nFor me, a ticket should ideally work on precisely one of these levels. Level 1 changes can be mostly approved on sight. If a ticket consists of 80% level 1 changes and 20% level 2 changes, then it can be hard to understand the level 2 changes because the many level 1 changes are just distracting the diff.\n\n> large sets of small fixes\n\nIMHO, this ticket contains several non-small (level 2 in my above classification) changes.",
    "created_at": "2018-02-16T14:17:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368307",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@embray](#comment%3A23):
> To put things more constructively, if you can give me some idea how you prefer to see changes logically split into individual tickets, I can certainly keep that in mind in the future.

Broadly speaking, there are 3 level of changes:

1. Small isolated changes and basic clean-up, e.g. adding `str/bytes` conversion, using `with(open())`, fixing imports, style changes.

2. Non-trivial changes which do not change user-visible functionality, i.e. refactoring.

3. Changes to user-visible functionality.

For me, a ticket should ideally work on precisely one of these levels. Level 1 changes can be mostly approved on sight. If a ticket consists of 80% level 1 changes and 20% level 2 changes, then it can be hard to understand the level 2 changes because the many level 1 changes are just distracting the diff.

> large sets of small fixes

IMHO, this ticket contains several non-small (level 2 in my above classification) changes.



---

archive/issue_comments_368308.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\ndoes not apply",
    "created_at": "2018-02-19T07:10:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368308",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

does not apply



---

archive/issue_events_334600.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-19T07:10:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334600"
}
```



---

archive/issue_events_334601.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-19T07:10:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334601"
}
```



---

archive/issue_comments_368309.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)** to **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)**",
    "created_at": "2018-02-19T10:00:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368309",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)** to **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)**



---

archive/issue_events_334602.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-19T10:00:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334602"
}
```



---

archive/issue_events_334603.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-19T10:00:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334603"
}
```



---

archive/issue_comments_368310.json:
```json
{
    "body": "Dependencies: **#24772**",
    "created_at": "2018-02-19T10:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368310",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#24772**



---

archive/issue_comments_368311.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3eb2db6efc3409265b2b887fe3befb5fa2cc1b29\"><code>3eb2db6</code></a></td><td><code>Miscellaneous fixes to tests in the doctest module.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51e20d952d2f294662f47f1a6e52c62ea8617d6b\"><code>51e20d9</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/878a62b4a9d266ecccab6e6b0cdd1c6044e2ef1d\"><code>878a62b</code></a></td><td><code>This exception reads 'utf-8' on Python 3 and 'utf8' on Python 2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ba0e67b8d92a19607541cf6dfee887980f3a145\"><code>1ba0e67</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dcff893007aff8e5bde44025801eb358acdefdad\"><code>dcff893</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f513d1d4e08cb3185a36f68cd4e28120f9797705\"><code>f513d1d</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd5ddad3e17ab9519b3eb48f4ebe8fa71ca7e0b7\"><code>bd5ddad</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b16db63197e19e399656926a28ee58221d617020\"><code>b16db63</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr></table>\n",
    "created_at": "2018-02-19T10:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368311",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3eb2db6efc3409265b2b887fe3befb5fa2cc1b29"><code>3eb2db6</code></a></td><td><code>Miscellaneous fixes to tests in the doctest module.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51e20d952d2f294662f47f1a6e52c62ea8617d6b"><code>51e20d9</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/878a62b4a9d266ecccab6e6b0cdd1c6044e2ef1d"><code>878a62b</code></a></td><td><code>This exception reads 'utf-8' on Python 3 and 'utf8' on Python 2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ba0e67b8d92a19607541cf6dfee887980f3a145"><code>1ba0e67</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dcff893007aff8e5bde44025801eb358acdefdad"><code>dcff893</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f513d1d4e08cb3185a36f68cd4e28120f9797705"><code>f513d1d</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd5ddad3e17ab9519b3eb48f4ebe8fa71ca7e0b7"><code>bd5ddad</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b16db63197e19e399656926a28ee58221d617020"><code>b16db63</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr></table>




---

archive/issue_comments_368312.json:
```json
{
    "body": "Changed commit from **[`7dd7f9a`](https://github.com/sagemath/sagetrac-mirror/commit/7dd7f9af21846d5d4d98815eff3cc409327dc793)** to **[`b16db63`](https://github.com/sagemath/sagetrac-mirror/commit/b16db63197e19e399656926a28ee58221d617020)**",
    "created_at": "2018-02-19T10:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368312",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[`7dd7f9a`](https://github.com/sagemath/sagetrac-mirror/commit/7dd7f9af21846d5d4d98815eff3cc409327dc793)** to **[`b16db63`](https://github.com/sagemath/sagetrac-mirror/commit/b16db63197e19e399656926a28ee58221d617020)**



---

archive/issue_comments_368313.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12ff3be331475a61fa4925b5e89898409c7f732d\"><code>12ff3be</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34876abb4119f6b5382797d065be23b830fd7762\"><code>34876ab</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6110bc43536d159e8ebd4057e556717c8189f99f\"><code>6110bc4</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c30c078f1cab98c9b8ce3420c1137c81249e2e3b\"><code>c30c078</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f5f429a455a614d6f4296c880af34ffa7dc42a9\"><code>9f5f429</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad6d069a1aed291531d75be70c980f3ccfa5e041\"><code>ad6d069</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr></table>\n",
    "created_at": "2018-02-19T13:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368313",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12ff3be331475a61fa4925b5e89898409c7f732d"><code>12ff3be</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34876abb4119f6b5382797d065be23b830fd7762"><code>34876ab</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6110bc43536d159e8ebd4057e556717c8189f99f"><code>6110bc4</code></a></td><td><code>Fix various minor encoding issues</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c30c078f1cab98c9b8ce3420c1137c81249e2e3b"><code>c30c078</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f5f429a455a614d6f4296c880af34ffa7dc42a9"><code>9f5f429</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad6d069a1aed291531d75be70c980f3ccfa5e041"><code>ad6d069</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr></table>




---

archive/issue_comments_368314.json:
```json
{
    "body": "Changed commit from **[`b16db63`](https://github.com/sagemath/sagetrac-mirror/commit/b16db63197e19e399656926a28ee58221d617020)** to **[`ad6d069`](https://github.com/sagemath/sagetrac-mirror/commit/ad6d069a1aed291531d75be70c980f3ccfa5e041)**",
    "created_at": "2018-02-19T13:02:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368314",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b16db63`](https://github.com/sagemath/sagetrac-mirror/commit/b16db63197e19e399656926a28ee58221d617020)** to **[`ad6d069`](https://github.com/sagemath/sagetrac-mirror/commit/ad6d069a1aed291531d75be70c980f3ccfa5e041)**



---

archive/issue_comments_368315.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nCan you justify this change:\n\n```diff\n-        from six.moves.queue import Empty\n-        try:\n-            self.result = self.result_queue.get(block=False)\n-        except Empty:\n-            self.result = (0, DictAsObject(dict(err='noresult')))\n-        del self.result_queue\n-\n-        self.outtmpfile.seek(0)\n-        self.output = self.outtmpfile.read()\n-        del self.outtmpfile\n+        if self.result_queue is not None:\n+            from six.moves.queue import Empty\n+            try:\n+                self.result = self.result_queue.get(block=False)\n+            except Empty:\n+                self.result = (0, DictAsObject(dict(err='noresult')))\n+\n+            self.result_queue = None\n+\n+        if self.outtmpfile is not None:\n+            self.outtmpfile.seek(0)\n+            self.output = bytes_to_str(self.outtmpfile.read())\n+            self.outtmpfile.close()\n+            self.outtmpfile = None\n```\nWhat was wrong with the old code?",
    "created_at": "2018-02-19T13:13:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368315",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Can you justify this change:

```diff
-        from six.moves.queue import Empty
-        try:
-            self.result = self.result_queue.get(block=False)
-        except Empty:
-            self.result = (0, DictAsObject(dict(err='noresult')))
-        del self.result_queue
-
-        self.outtmpfile.seek(0)
-        self.output = self.outtmpfile.read()
-        del self.outtmpfile
+        if self.result_queue is not None:
+            from six.moves.queue import Empty
+            try:
+                self.result = self.result_queue.get(block=False)
+            except Empty:
+                self.result = (0, DictAsObject(dict(err='noresult')))
+
+            self.result_queue = None
+
+        if self.outtmpfile is not None:
+            self.outtmpfile.seek(0)
+            self.output = bytes_to_str(self.outtmpfile.read())
+            self.outtmpfile.close()
+            self.outtmpfile = None
```
What was wrong with the old code?



---

archive/issue_comments_368316.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI don't remember exactly, but I'm sure there was a good reason.  Certainly I know that I didn't like that the old code was *deleting* attributes rather than setting them to `None`.  I believe there were reasons (e.g. related to repeated calls of the same method) that it was saner to set these attributes to `None` when they were finished being used rather than deleting them.",
    "created_at": "2018-02-19T13:19:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368316",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

I don't remember exactly, but I'm sure there was a good reason.  Certainly I know that I didn't like that the old code was *deleting* attributes rather than setting them to `None`.  I believe there were reasons (e.g. related to repeated calls of the same method) that it was saner to set these attributes to `None` when they were finished being used rather than deleting them.



---

archive/issue_comments_368317.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\ngit history was rewritten in #24772, so this should be rebased.",
    "created_at": "2018-02-23T15:13:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368317",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

git history was rewritten in #24772, so this should be rebased.



---

archive/issue_events_334604.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-23T15:13:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334604"
}
```



---

archive/issue_events_334605.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-23T15:13:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334605"
}
```



---

archive/issue_comments_368318.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nYeah, I was about to take care of that.",
    "created_at": "2018-02-23T15:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368318",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

Yeah, I was about to take care of that.



---

archive/issue_events_334606.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-23T15:33:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334606"
}
```



---

archive/issue_events_334607.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-02-23T15:33:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334607"
}
```



---

archive/issue_comments_368319.json:
```json
{
    "body": "Changed commit from **[`ad6d069`](https://github.com/sagemath/sagetrac-mirror/commit/ad6d069a1aed291531d75be70c980f3ccfa5e041)** to **[`47e464d`](https://github.com/sagemath/sagetrac-mirror/commit/47e464dda9aee8cb43651568ef721ee054cbab04)**",
    "created_at": "2018-02-23T15:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368319",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`ad6d069`](https://github.com/sagemath/sagetrac-mirror/commit/ad6d069a1aed291531d75be70c980f3ccfa5e041)** to **[`47e464d`](https://github.com/sagemath/sagetrac-mirror/commit/47e464dda9aee8cb43651568ef721ee054cbab04)**



---

archive/issue_comments_368320.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)** to **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)**",
    "created_at": "2018-02-23T15:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368320",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)** to **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)**



---

archive/issue_comments_368321.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nJust took Jeroen's branch and rebased on top of #24772.\n\nIs there anything more that still needs to be discussed on this?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf6cf97ada80f3d70a07cd416a53acd2453b6d88\"><code>bf6cf97</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b92b47403df0b0ae371d846dcba13b88a368d98\"><code>4b92b47</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ed249101a327c4deb035f50385874cf5b902a050\"><code>ed24910</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47e464dda9aee8cb43651568ef721ee054cbab04\"><code>47e464d</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr></table>\n",
    "created_at": "2018-02-23T15:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368321",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

Just took Jeroen's branch and rebased on top of #24772.

Is there anything more that still needs to be discussed on this?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf6cf97ada80f3d70a07cd416a53acd2453b6d88"><code>bf6cf97</code></a></td><td><code>Correct some encoding issues on Python 2.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b92b47403df0b0ae371d846dcba13b88a368d98"><code>4b92b47</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ed249101a327c4deb035f50385874cf5b902a050"><code>ed24910</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47e464dda9aee8cb43651568ef721ee054cbab04"><code>47e464d</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr></table>




---

archive/issue_comments_368322.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@embray](#comment%3A33):\n> Is there anything more that still needs to be discussed on this?\n\nProbably yes. I haven't really looked in detail.",
    "created_at": "2018-02-23T16:21:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368322",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@embray](#comment%3A33):
> Is there anything more that still needs to be discussed on this?

Probably yes. I haven't really looked in detail.



---

archive/issue_comments_368323.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nProbably?  I'll note again that this has been working for me for months now. Maybe take a leap of faith so that we can get this in and others can finally start testing against Python 3.",
    "created_at": "2018-02-27T16:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368323",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Probably?  I'll note again that this has been working for me for months now. Maybe take a leap of faith so that we can get this in and others can finally start testing against Python 3.



---

archive/issue_comments_368324.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAs I said, I barely looked at this. And I prefer to do that after the dependencies have been merged.",
    "created_at": "2018-02-27T16:35:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368324",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

As I said, I barely looked at this. And I prefer to do that after the dependencies have been merged.



---

archive/issue_comments_368325.json:
```json
{
    "body": "Changed dependencies from **#24772** to none",
    "created_at": "2018-03-05T10:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368325",
    "user": "https://github.com/fchapoton"
}
```

Changed dependencies from **#24772** to none



---

archive/issue_comments_368326.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@embray](#comment%3A33):\n> Just took Jeroen's branch and rebased on top of #24772.\n\nThe change that I mentioned in [comment:29] is gone. Was that intentional? In any case, I would prefer *not* to add it back if there is no reason.\n\nFor ease of reviewing, I'm rebasing your branch on 8.2.beta7 (there are no conflicts, it's a trivial rebase). The 3 commits are independent and I did reorder them.",
    "created_at": "2018-03-07T09:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368326",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@embray](#comment%3A33):
> Just took Jeroen's branch and rebased on top of #24772.

The change that I mentioned in [comment:29] is gone. Was that intentional? In any case, I would prefer *not* to add it back if there is no reason.

For ease of reviewing, I'm rebasing your branch on 8.2.beta7 (there are no conflicts, it's a trivial rebase). The 3 commits are independent and I did reorder them.



---

archive/issue_comments_368327.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)** to **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)**",
    "created_at": "2018-03-07T09:32:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368327",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)** to **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)**



---

archive/issue_comments_368328.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bec13115e5aac85803353544bec7a4043fbf57d7\"><code>bec1311</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e479f262ad6ca0d3c603ec03051e9732fd1708fb\"><code>e479f26</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4ca9e2144939f844d3a35788629b159278a8487\"><code>b4ca9e2</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>\n",
    "created_at": "2018-03-07T09:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368328",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bec13115e5aac85803353544bec7a4043fbf57d7"><code>bec1311</code></a></td><td><code>Use the restore_atexit context manager for this code to work on Python 3,</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e479f262ad6ca0d3c603ec03051e9732fd1708fb"><code>e479f26</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4ca9e2144939f844d3a35788629b159278a8487"><code>b4ca9e2</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>




---

archive/issue_comments_368329.json:
```json
{
    "body": "Changed commit from **[`47e464d`](https://github.com/sagemath/sagetrac-mirror/commit/47e464dda9aee8cb43651568ef721ee054cbab04)** to **[`b4ca9e2`](https://github.com/sagemath/sagetrac-mirror/commit/b4ca9e2144939f844d3a35788629b159278a8487)**",
    "created_at": "2018-03-07T09:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368329",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`47e464d`](https://github.com/sagemath/sagetrac-mirror/commit/47e464dda9aee8cb43651568ef721ee054cbab04)** to **[`b4ca9e2`](https://github.com/sagemath/sagetrac-mirror/commit/b4ca9e2144939f844d3a35788629b159278a8487)**



---

archive/issue_comments_368330.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI'm moving the commit about `atexit` to #24922 because I want to add something.",
    "created_at": "2018-03-07T09:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368330",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:41" align="right">comment:41</div>

I'm moving the commit about `atexit` to #24922 because I want to add something.



---

archive/issue_comments_368331.json:
```json
{
    "body": "Changed commit from **[`b4ca9e2`](https://github.com/sagemath/sagetrac-mirror/commit/b4ca9e2144939f844d3a35788629b159278a8487)** to **[`500a8a6`](https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb)**",
    "created_at": "2018-03-07T09:52:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368331",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b4ca9e2`](https://github.com/sagemath/sagetrac-mirror/commit/b4ca9e2144939f844d3a35788629b159278a8487)** to **[`500a8a6`](https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb)**



---

archive/issue_comments_368332.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9c93a7f8ce56096b0e021a8555107eb9f700b29\"><code>d9c93a7</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb\"><code>500a8a6</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>\n",
    "created_at": "2018-03-07T09:52:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368332",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9c93a7f8ce56096b0e021a8555107eb9f700b29"><code>d9c93a7</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb"><code>500a8a6</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>




---

archive/issue_comments_368333.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI didn't mean to delete it, and there was at least one good reason for it which is that deleting attributes off objects is just ugly when you can set them to None instead.\n\nI'm reworking some of this code elsewhere so I'm not going to worry about it though.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9c93a7f8ce56096b0e021a8555107eb9f700b29\"><code>d9c93a7</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb\"><code>500a8a6</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>\n",
    "created_at": "2018-03-07T09:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368333",
    "user": "https://github.com/embray"
}
```

<div id="comment:43" align="right">comment:43</div>

I didn't mean to delete it, and there was at least one good reason for it which is that deleting attributes off objects is just ugly when you can set them to None instead.

I'm reworking some of this code elsewhere so I'm not going to worry about it though.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9c93a7f8ce56096b0e021a8555107eb9f700b29"><code>d9c93a7</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb"><code>500a8a6</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>




---

archive/issue_comments_368334.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThis added call to `save_result_output` is causing breakage:\n\n```diff\n+        # Save any result output so far before we kill the process off\n+        self.save_result_output()\n```\n\n```\nsage -t --long src/sage/doctest/forker.py\n**********************************************************************\nFile \"src/sage/doctest/forker.py\", line 2104, in sage.doctest.forker.DocTestWorker.save_result_output\nFailed example:\n    W.kill()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 556, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 966, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.doctest.forker.DocTestWorker.save_result_output[14]>\", line 1, in <module>\n        W.kill()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2176, in kill\n        self.save_result_output()\n      File \"/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2114, in save_result_output\n        self.result = self.result_queue.get(block=False)\n    AttributeError: 'DocTestWorker' object has no attribute 'result_queue'\n**********************************************************************\n```\nNow I see that you needed [comment:29] to fix that breakage but why did you need to add a call to `save_result_output` in `kill()`? All doctests pass when I remove that.",
    "created_at": "2018-03-07T10:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368334",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

This added call to `save_result_output` is causing breakage:

```diff
+        # Save any result output so far before we kill the process off
+        self.save_result_output()
```

```
sage -t --long src/sage/doctest/forker.py
**********************************************************************
File "src/sage/doctest/forker.py", line 2104, in sage.doctest.forker.DocTestWorker.save_result_output
Failed example:
    W.kill()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 556, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 966, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.doctest.forker.DocTestWorker.save_result_output[14]>", line 1, in <module>
        W.kill()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2176, in kill
        self.save_result_output()
      File "/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2114, in save_result_output
        self.result = self.result_queue.get(block=False)
    AttributeError: 'DocTestWorker' object has no attribute 'result_queue'
**********************************************************************
```
Now I see that you needed [comment:29] to fix that breakage but why did you need to add a call to `save_result_output` in `kill()`? All doctests pass when I remove that.



---

archive/issue_events_334608.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-07T10:36:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334608"
}
```



---

archive/issue_events_334609.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-07T10:36:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334609"
}
```



---

archive/issue_comments_368335.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nhttps://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670",
    "created_at": "2018-03-07T10:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368335",
    "user": "https://github.com/embray"
}
```

<div id="comment:45" align="right">comment:45</div>

https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670



---

archive/issue_comments_368336.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nDoes Python 3 no longer support the `\"a\"` mode in `fdopen()`? I consider that a bug. It might not matter for the doctesting framework, but the `\"w\"` and `\"a\"` options are not equivalent, especially when multiple processes write to the same file.",
    "created_at": "2018-03-07T10:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368336",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Does Python 3 no longer support the `"a"` mode in `fdopen()`? I consider that a bug. It might not matter for the doctesting framework, but the `"w"` and `"a"` options are not equivalent, especially when multiple processes write to the same file.



---

archive/issue_comments_368337.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nWhy are you wrapping all `close()` calls in a `try`/`except` block? If a file fails to close for some reason, that's a genuine error.",
    "created_at": "2018-03-07T10:59:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368337",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

Why are you wrapping all `close()` calls in a `try`/`except` block? If a file fails to close for some reason, that's a genuine error.



---

archive/issue_comments_368338.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI don't recall why the change from \"w\" to \"a\" mode.  Maybe there was a reason, but in this case it seems I didn't document it. You you can try removing it and see.  Maybe I was thinking about https://bugs.python.org/issue20082",
    "created_at": "2018-03-07T11:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368338",
    "user": "https://github.com/embray"
}
```

<div id="comment:48" align="right">comment:48</div>

I don't recall why the change from "w" to "a" mode.  Maybe there was a reason, but in this case it seems I didn't document it. You you can try removing it and see.  Maybe I was thinking about https://bugs.python.org/issue20082



---

archive/issue_comments_368339.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@jdemeyer](#comment%3A47):\n> Why are you wrapping all `close()` calls in a `try`/`except` block? If a file fails to close for some reason, that's a genuine error.\n\nNot \"all\".  Those are in `__del__` methods, where you can't assume the files are still even open.",
    "created_at": "2018-03-07T11:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368339",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@jdemeyer](#comment%3A47):
> Why are you wrapping all `close()` calls in a `try`/`except` block? If a file fails to close for some reason, that's a genuine error.

Not "all".  Those are in `__del__` methods, where you can't assume the files are still even open.



---

archive/issue_comments_368340.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@embray](#comment%3A45):\n> https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670\n\nI guess you mean this sentence from the commit message:\n> Note that `DocTestWorker.kill()` now calls `sage_results_output` [sic], which ensures that the `DocTestWorker.outtmpfile` is closed.\n\nWhy not simply call `self.outtmpfile.close()` in `kill`?",
    "created_at": "2018-03-07T11:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368340",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@embray](#comment%3A45):
> https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670

I guess you mean this sentence from the commit message:
> Note that `DocTestWorker.kill()` now calls `sage_results_output` [sic], which ensures that the `DocTestWorker.outtmpfile` is closed.

Why not simply call `self.outtmpfile.close()` in `kill`?



---

archive/issue_comments_368341.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@embray](#comment%3A49):\n> Not \"all\".  Those are in `__del__` methods, where you can't assume the files are still even open.\n\nEven if the file is already closed, Python allows closing an already-closed file:\n\n```\n>>> f = open(\"/dev/null\")\n>>> f.close()\n>>> f.close()\n```",
    "created_at": "2018-03-07T11:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368341",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@embray](#comment%3A49):
> Not "all".  Those are in `__del__` methods, where you can't assume the files are still even open.

Even if the file is already closed, Python allows closing an already-closed file:

```
>>> f = open("/dev/null")
>>> f.close()
>>> f.close()
```



---

archive/issue_comments_368342.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@embray](#comment%3A48):\n> I don't recall why the change from \"w\" to \"a\" mode.  Maybe there was a reason, but in this case it seems I didn't document it. You you can try removing it and see.  Maybe I was thinking about https://bugs.python.org/issue20082\n\nNo, it's worse than that:\n\n```\nPython 3.6.1 (default, Feb 19 2018, 09:57:52) \n[GCC 4.9.4] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> import os\n>>> os.fdopen(2, \"a\")\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/usr/local/src/sage-config/local/lib/python3.6/os.py\", line 1015, in fdopen\n    return io.open(fd, *args, **kwargs)\nOSError: [Errno 29] Illegal seek\n```",
    "created_at": "2018-03-07T11:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368342",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@embray](#comment%3A48):
> I don't recall why the change from "w" to "a" mode.  Maybe there was a reason, but in this case it seems I didn't document it. You you can try removing it and see.  Maybe I was thinking about https://bugs.python.org/issue20082

No, it's worse than that:

```
Python 3.6.1 (default, Feb 19 2018, 09:57:52) 
[GCC 4.9.4] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> os.fdopen(2, "a")
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/usr/local/src/sage-config/local/lib/python3.6/os.py", line 1015, in fdopen
    return io.open(fd, *args, **kwargs)
OSError: [Errno 29] Illegal seek
```



---

archive/issue_comments_368343.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\n(end of review for now)",
    "created_at": "2018-03-07T11:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368343",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

(end of review for now)



---

archive/issue_comments_368344.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nWell, you could try removing it and see. I probably had a reason.",
    "created_at": "2018-03-07T11:12:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368344",
    "user": "https://github.com/embray"
}
```

<div id="comment:54" align="right">comment:54</div>

Well, you could try removing it and see. I probably had a reason.



---

archive/issue_comments_368345.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@jdemeyer](#comment%3A52):\n> Replying to [@embray](#comment%3A48):\n> > I don't recall why the change from \"w\" to \"a\" mode.  Maybe there was a reason, but in this case it seems I didn't document it. You you can try removing it and see.  Maybe I was thinking about https://bugs.python.org/issue20082\n> \n> \n> No, it's worse than that:\n> \n> ```\n> Python 3.6.1 (default, Feb 19 2018, 09:57:52) \n> [GCC 4.9.4] on linux\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> import os\n> >>> os.fdopen(2, \"a\")\n> Traceback (most recent call last):\n>   File \"<stdin>\", line 1, in <module>\n>   File \"/usr/local/src/sage-config/local/lib/python3.6/os.py\", line 1015, in fdopen\n>     return io.open(fd, *args, **kwargs)\n> OSError: [Errno 29] Illegal seek\n> ```\n\nAh, right, this is https://bugs.python.org/issue27805",
    "created_at": "2018-03-07T11:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368345",
    "user": "https://github.com/embray"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@jdemeyer](#comment%3A52):
> Replying to [@embray](#comment%3A48):
> > I don't recall why the change from "w" to "a" mode.  Maybe there was a reason, but in this case it seems I didn't document it. You you can try removing it and see.  Maybe I was thinking about https://bugs.python.org/issue20082
> 
> 
> No, it's worse than that:
> 
> ```
> Python 3.6.1 (default, Feb 19 2018, 09:57:52) 
> [GCC 4.9.4] on linux
> Type "help", "copyright", "credits" or "license" for more information.
> >>> import os
> >>> os.fdopen(2, "a")
> Traceback (most recent call last):
>   File "<stdin>", line 1, in <module>
>   File "/usr/local/src/sage-config/local/lib/python3.6/os.py", line 1015, in fdopen
>     return io.open(fd, *args, **kwargs)
> OSError: [Errno 29] Illegal seek
> ```

Ah, right, this is https://bugs.python.org/issue27805



---

archive/issue_comments_368346.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nI still think whether it's needed or not, it's really ugly to just assign attributes to objects, and then delete them later, and have to do `hasattr(obj, attr)` on it when you could just set those attributes to `None` when they're not needed anymore.  Maybe this is some deeply-ingrained Java-ism, but I think deleting attributes is in most cases an anti-pattern.",
    "created_at": "2018-03-07T11:21:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368346",
    "user": "https://github.com/embray"
}
```

<div id="comment:56" align="right">comment:56</div>

I still think whether it's needed or not, it's really ugly to just assign attributes to objects, and then delete them later, and have to do `hasattr(obj, attr)` on it when you could just set those attributes to `None` when they're not needed anymore.  Maybe this is some deeply-ingrained Java-ism, but I think deleting attributes is in most cases an anti-pattern.



---

archive/issue_comments_368347.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nThat said, I think maybe the `kill()` calls from [2203ca27](https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670) can be removed.  I tried taking all that stuff and out I don't get any ResourceWarnings.  So it's possible that while they did something at one time, additional fixes elsewhere rendered it unnecessary.",
    "created_at": "2018-03-07T11:28:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368347",
    "user": "https://github.com/embray"
}
```

<div id="comment:57" align="right">comment:57</div>

That said, I think maybe the `kill()` calls from [2203ca27](https://github.com/sagemath/sagetrac-mirror/commit/2203ca27445e7db09cdf97b34896b6d8ea6eb670) can be removed.  I tried taking all that stuff and out I don't get any ResourceWarnings.  So it's possible that while they did something at one time, additional fixes elsewhere rendered it unnecessary.



---

archive/issue_comments_368348.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nSame with the try/except around the close calls.  I don't seem to have made note of a specific reason for them.",
    "created_at": "2018-03-07T11:28:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368348",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

Same with the try/except around the close calls.  I don't seem to have made note of a specific reason for them.



---

archive/issue_comments_368349.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)** to **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)**",
    "created_at": "2018-03-07T11:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368349",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/jdemeyer/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/sage-doctest)** to **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)**



---

archive/issue_comments_368350.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nOkay, I removed a few of the changes you pointed out that don't appear to be necessary.  Other than that I wouldn't mess with anything else.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87a56de604f0f7a54542c8068c1333ae67ccbc47\"><code>87a56de</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly where</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba9f9e771b56e7a2b19ef24ee481b8413d3843fc\"><code>ba9f9e7</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>\n",
    "created_at": "2018-03-07T11:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368350",
    "user": "https://github.com/embray"
}
```

<div id="comment:59" align="right">comment:59</div>

Okay, I removed a few of the changes you pointed out that don't appear to be necessary.  Other than that I wouldn't mess with anything else.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87a56de604f0f7a54542c8068c1333ae67ccbc47"><code>87a56de</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly where</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba9f9e771b56e7a2b19ef24ee481b8413d3843fc"><code>ba9f9e7</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>




---

archive/issue_events_334610.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-07T11:37:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334610"
}
```



---

archive/issue_events_334611.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-07T11:37:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334611"
}
```



---

archive/issue_comments_368351.json:
```json
{
    "body": "Changed commit from **[`500a8a6`](https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb)** to **[`ba9f9e7`](https://github.com/sagemath/sagetrac-mirror/commit/ba9f9e771b56e7a2b19ef24ee481b8413d3843fc)**",
    "created_at": "2018-03-07T11:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368351",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`500a8a6`](https://github.com/sagemath/sagetrac-mirror/commit/500a8a63da95d9709d30b83120f70ddc797c3ceb)** to **[`ba9f9e7`](https://github.com/sagemath/sagetrac-mirror/commit/ba9f9e771b56e7a2b19ef24ee481b8413d3843fc)**



---

archive/issue_events_334612.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-07T11:38:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334612"
}
```



---

archive/issue_events_334613.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-07T11:38:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334613"
}
```



---

archive/issue_comments_368352.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nHold on, I thought I removed all those try/excepts...",
    "created_at": "2018-03-07T11:38:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368352",
    "user": "https://github.com/embray"
}
```

<div id="comment:60" align="right">comment:60</div>

Hold on, I thought I removed all those try/excepts...



---

archive/issue_comments_368353.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af86e5c72b3157112648d878a03a5fde2f508319\"><code>af86e5c</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly where</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/436ed266f954ecf03f894b9c6539cca353a68ad6\"><code>436ed26</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>\n",
    "created_at": "2018-03-07T11:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368353",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af86e5c72b3157112648d878a03a5fde2f508319"><code>af86e5c</code></a></td><td><code>Various fixes intended to ensure that opened files are closed explictly where</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/436ed266f954ecf03f894b9c6539cca353a68ad6"><code>436ed26</code></a></td><td><code>A few other miscellaneous fixes to the doctests tests</code></td></tr></table>




---

archive/issue_comments_368354.json:
```json
{
    "body": "Changed commit from **[`ba9f9e7`](https://github.com/sagemath/sagetrac-mirror/commit/ba9f9e771b56e7a2b19ef24ee481b8413d3843fc)** to **[`436ed26`](https://github.com/sagemath/sagetrac-mirror/commit/436ed266f954ecf03f894b9c6539cca353a68ad6)**",
    "created_at": "2018-03-07T11:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368354",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ba9f9e7`](https://github.com/sagemath/sagetrac-mirror/commit/ba9f9e771b56e7a2b19ef24ee481b8413d3843fc)** to **[`436ed26`](https://github.com/sagemath/sagetrac-mirror/commit/436ed266f954ecf03f894b9c6539cca353a68ad6)**



---

archive/issue_events_334614.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-07T11:42:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334614"
}
```



---

archive/issue_events_334615.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-07T11:42:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334615"
}
```



---

archive/issue_comments_368355.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nOkay.",
    "created_at": "2018-03-07T11:42:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368355",
    "user": "https://github.com/embray"
}
```

<div id="comment:62" align="right">comment:62</div>

Okay.



---

archive/issue_comments_368356.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nOK, that seems good on first sight. The last commit (changing the `sleep()` time) is probably no longer needed. I guess you added it because `kill()` did more stuff and needed more time.\n\nAnd let me just think whether the change of `open()` mode from `\"a\"` to `\"w\"` could cause trouble...",
    "created_at": "2018-03-07T14:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368356",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

OK, that seems good on first sight. The last commit (changing the `sleep()` time) is probably no longer needed. I guess you added it because `kill()` did more stuff and needed more time.

And let me just think whether the change of `open()` mode from `"a"` to `"w"` could cause trouble...



---

archive/issue_comments_368357.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2018-03-08T08:25:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368357",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_334616.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-08T08:25:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334616"
}
```



---

archive/issue_events_334617.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-03-08T08:25:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334617"
}
```



---

archive/issue_events_334618.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2018-03-13T20:41:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334618"
}
```



---

archive/issue_events_334619.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2018-03-13T20:41:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334619"
}
```



---

archive/issue_comments_368358.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f\"><code>2155133</code></a></td><td><code>missing string encoding fix</code></td></tr></table>\n",
    "created_at": "2018-03-13T20:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368358",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f"><code>2155133</code></a></td><td><code>missing string encoding fix</code></td></tr></table>




---

archive/issue_comments_368359.json:
```json
{
    "body": "Changed commit from **[`436ed26`](https://github.com/sagemath/sagetrac-mirror/commit/436ed266f954ecf03f894b9c6539cca353a68ad6)** to **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)**",
    "created_at": "2018-03-13T20:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368359",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`436ed26`](https://github.com/sagemath/sagetrac-mirror/commit/436ed266f954ecf03f894b9c6539cca353a68ad6)** to **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)**



---

archive/issue_comments_368360.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nSorry, hopefully not too late to append to this ticket.  This little fix should have been here, and I think got lost somewhere along the way.",
    "created_at": "2018-03-13T20:43:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368360",
    "user": "https://github.com/embray"
}
```

<div id="comment:66" align="right">comment:66</div>

Sorry, hopefully not too late to append to this ticket.  This little fix should have been here, and I think got lost somewhere along the way.



---

archive/issue_events_334620.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-13T20:43:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334620"
}
```



---

archive/issue_events_334621.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-13T20:43:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334621"
}
```



---

archive/issue_events_334622.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-21T06:19:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334622"
}
```



---

archive/issue_events_334623.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fe173f2d9b26a95cade4f3a48b634c9624939f6d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-03-21T06:19:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24343#event-334623"
}
```



---

archive/issue_comments_368361.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)** to **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)**",
    "created_at": "2018-03-21T06:19:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368361",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/python3/sage-doctest](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-doctest)** to **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)**



---

archive/issue_comments_368362.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nI think some of the stuff I ended up removing from this was needed after all.  It might not have shown up either because:\n\na) I was originally testing with a debug build of Python which always displays `ResourceWarning`s by default (a non-debug build does not)\n\nb) Some of it might have been particular to Cygwin, but I switched mostly to testing on Linux later on.",
    "created_at": "2018-04-06T14:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368362",
    "user": "https://github.com/embray"
}
```

<div id="comment:69" align="right">comment:69</div>

I think some of the stuff I ended up removing from this was needed after all.  It might not have shown up either because:

a) I was originally testing with a debug build of Python which always displays `ResourceWarning`s by default (a non-debug build does not)

b) Some of it might have been particular to Cygwin, but I switched mostly to testing on Linux later on.



---

archive/issue_comments_368363.json:
```json
{
    "body": "Changed commit from **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)** to none",
    "created_at": "2018-04-06T14:39:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24343",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24343#issuecomment-368363",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`2155133`](https://github.com/sagemath/sagetrac-mirror/commit/2155133fa6f901ac92ea0ba46ee5ea403ee4f18f)** to none
