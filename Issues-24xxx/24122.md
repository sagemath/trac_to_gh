# Issue 24122: Use echelonize instead of echelon_form in a few places

archive/issues_023885.json:
```json
{
    "body": "We do not need to create another copy of the augmented matrix to keep memory usage down (including putting it in a cache) and because it is faster.\n\nWe do this change in `__invert__`, `right_kernel_matrix`, and `_solve_right_nonsingular_square`.\n\nWe also can take advantage of the sparse structure and our knowledge of the augmented matrix [I|A<sup>-1</sup>] when reconstructing the matrix.\n\n\n**Branch/Commit:** [cfbb77680533b3b2badc5177e3a00cea74c7ffa5](https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5)\n\n**Reviewer:** Vincent Delecroix\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/24122\n\n",
    "closed_at": "2017-12-11T01:03:22Z",
    "created_at": "2017-10-30T00:12:49Z",
    "labels": [
        "component: performance",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Use echelonize instead of echelon_form in a few places",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24122",
    "user": "https://github.com/tscrim"
}
```
We do not need to create another copy of the augmented matrix to keep memory usage down (including putting it in a cache) and because it is faster.

We do this change in `__invert__`, `right_kernel_matrix`, and `_solve_right_nonsingular_square`.

We also can take advantage of the sparse structure and our knowledge of the augmented matrix [I|A<sup>-1</sup>] when reconstructing the matrix.


**Branch/Commit:** [cfbb77680533b3b2badc5177e3a00cea74c7ffa5](https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5)

**Reviewer:** Vincent Delecroix

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/24122





---

archive/issue_comments_369000.json:
```json
{
    "body": "**Branch:** [public/linear_algebra/echelonize_in_invert-24122](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/echelonize_in_invert-24122)",
    "created_at": "2017-10-30T00:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369000",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/linear_algebra/echelonize_in_invert-24122](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/echelonize_in_invert-24122)



---

archive/issue_events_218272.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-30T00:25:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218272"
}
```



---

archive/issue_comments_369001.json:
```json
{
    "body": "**Author:** Travis Scrimshaw",
    "created_at": "2017-10-30T00:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369001",
    "user": "https://github.com/tscrim"
}
```

**Author:** Travis Scrimshaw



---

archive/issue_comments_369002.json:
```json
{
    "body": "<a id='comment:1'></a>\nBad branch not based off `develop`. Fixed.",
    "created_at": "2017-10-30T00:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369002",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:1'></a>
Bad branch not based off `develop`. Fixed.



---

archive/issue_comments_369003.json:
```json
{
    "body": "**Commit:** [d37d983d761414451b5d21ff12b732c5285d159c](https://github.com/sagemath/sagetrac-mirror/commit/d37d983d761414451b5d21ff12b732c5285d159c)",
    "created_at": "2017-10-30T00:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369003",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [d37d983d761414451b5d21ff12b732c5285d159c](https://github.com/sagemath/sagetrac-mirror/commit/d37d983d761414451b5d21ff12b732c5285d159c)



---

archive/issue_comments_369004.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3990da44ec263e5b6be38529ba56d92f0b761aa2\">3990da4</a></td><td><code>Do not create another matrix in __invert__.</code></td></tr></table>\n",
    "created_at": "2017-10-30T00:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369004",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3990da44ec263e5b6be38529ba56d92f0b761aa2">3990da4</a></td><td><code>Do not create another matrix in __invert__.</code></td></tr></table>




---

archive/issue_comments_369005.json:
```json
{
    "body": "**Changing commit** from \"[d37d983d761414451b5d21ff12b732c5285d159c](https://github.com/sagemath/sagetrac-mirror/commit/d37d983d761414451b5d21ff12b732c5285d159c)\" to \"[3990da44ec263e5b6be38529ba56d92f0b761aa2](https://github.com/sagemath/sagetrac-mirror/commit/3990da44ec263e5b6be38529ba56d92f0b761aa2)\".",
    "created_at": "2017-10-30T00:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d37d983d761414451b5d21ff12b732c5285d159c](https://github.com/sagemath/sagetrac-mirror/commit/d37d983d761414451b5d21ff12b732c5285d159c)" to "[3990da44ec263e5b6be38529ba56d92f0b761aa2](https://github.com/sagemath/sagetrac-mirror/commit/3990da44ec263e5b6be38529ba56d92f0b761aa2)".



---

archive/issue_comments_369006.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/294150fc0e058372cc83be396b188c961536e7a5\">294150f</a></td><td><code>Do different things for sparse and dense matrices from the augmented matrix.</code></td></tr></table>\n",
    "created_at": "2017-10-31T02:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/294150fc0e058372cc83be396b188c961536e7a5">294150f</a></td><td><code>Do different things for sparse and dense matrices from the augmented matrix.</code></td></tr></table>




---

archive/issue_comments_369007.json:
```json
{
    "body": "**Changing commit** from \"[3990da44ec263e5b6be38529ba56d92f0b761aa2](https://github.com/sagemath/sagetrac-mirror/commit/3990da44ec263e5b6be38529ba56d92f0b761aa2)\" to \"[294150fc0e058372cc83be396b188c961536e7a5](https://github.com/sagemath/sagetrac-mirror/commit/294150fc0e058372cc83be396b188c961536e7a5)\".",
    "created_at": "2017-10-31T02:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3990da44ec263e5b6be38529ba56d92f0b761aa2](https://github.com/sagemath/sagetrac-mirror/commit/3990da44ec263e5b6be38529ba56d92f0b761aa2)" to "[294150fc0e058372cc83be396b188c961536e7a5](https://github.com/sagemath/sagetrac-mirror/commit/294150fc0e058372cc83be396b188c961536e7a5)".



---

archive/issue_events_218273.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-31T02:22:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "label": "component: linear algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218273"
}
```



---

archive/issue_events_218274.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-10-31T02:22:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "label": "component: performance",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218274"
}
```



---

archive/issue_comments_369008.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis last change nets me ~8% speedup:\n\n```\nsage: %timeit ~(matrix({(200-i,i): 1/i for i in range(1,200,1)}, sparse=True) + 1)\n10 loops, best of 3: 159 ms per loop\nsage: %timeit ~(matrix({(100-i,i): 1/i for i in range(1,100,1)}, sparse=True) + 1)\n10 loops, best of 3: 28.6 ms per loop\nsage: %timeit ~(matrix({(20-i,i): 1/i for i in range(1,20,1)}, sparse=True) + 1)\nThe slowest run took 24.10 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000 loops, best of 3: 1.27 ms per loop\n```\nversus\n\n```\nsage: %timeit ~(matrix({(200-i,i): 1/i for i in range(1,200,1)}, sparse=True) + 1)\n10 loops, best of 3: 167 ms per loop\nsage: %timeit ~(matrix({(100-i,i): 1/i for i in range(1,100,1)}, sparse=True) + 1)\n10 loops, best of 3: 30.7 ms per loop\nsage: %timeit ~(matrix({(20-i,i): 1/i for i in range(1,20,1)}, sparse=True) + 1)\n1000 loops, best of 3: 1.36 ms per loop\n```",
    "created_at": "2017-10-31T02:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369008",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
This last change nets me ~8% speedup:

```
sage: %timeit ~(matrix({(200-i,i): 1/i for i in range(1,200,1)}, sparse=True) + 1)
10 loops, best of 3: 159 ms per loop
sage: %timeit ~(matrix({(100-i,i): 1/i for i in range(1,100,1)}, sparse=True) + 1)
10 loops, best of 3: 28.6 ms per loop
sage: %timeit ~(matrix({(20-i,i): 1/i for i in range(1,20,1)}, sparse=True) + 1)
The slowest run took 24.10 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 3: 1.27 ms per loop
```
versus

```
sage: %timeit ~(matrix({(200-i,i): 1/i for i in range(1,200,1)}, sparse=True) + 1)
10 loops, best of 3: 167 ms per loop
sage: %timeit ~(matrix({(100-i,i): 1/i for i in range(1,100,1)}, sparse=True) + 1)
10 loops, best of 3: 30.7 ms per loop
sage: %timeit ~(matrix({(20-i,i): 1/i for i in range(1,20,1)}, sparse=True) + 1)
1000 loops, best of 3: 1.36 ms per loop
```



---

archive/issue_comments_369009.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n We do not need to create another copy of the augmented matrix to keep memory usage down (including putting it in a cache) and because it is faster.\n+\n+We also can take advantage of the sparse structure and our knowledge of the augmented matrix [I|A<sup>-1</sup>] when reconstructing the matrix.\n``````\n",
    "created_at": "2017-10-31T02:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369009",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 We do not need to create another copy of the augmented matrix to keep memory usage down (including putting it in a cache) and because it is faster.
+
+We also can take advantage of the sparse structure and our knowledge of the augmented matrix [I|A<sup>-1</sup>] when reconstructing the matrix.
``````




---

archive/issue_comments_369010.json:
```json
{
    "body": "<a id='comment:5'></a>\nAlso versus `develop`, which this test is not so good for showing how the first change would improve things as the matrices are relatively tiny:\n\n```\nsage: %timeit ~(matrix({(200-i,i): 1/i for i in range(1,200,1)}, sparse=True) + 1)\n10 loops, best of 3: 171 ms per loop\nsage: %timeit ~(matrix({(100-i,i): 1/i for i in range(1,100,1)}, sparse=True) + 1)\n10 loops, best of 3: 30.2 ms per loop\nsage: %timeit ~(matrix({(20-i,i): 1/i for i in range(1,20,1)}, sparse=True) + 1)\nThe slowest run took 11.65 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000 loops, best of 3: 1.3 ms per loop\n```",
    "created_at": "2017-10-31T02:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369010",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Also versus `develop`, which this test is not so good for showing how the first change would improve things as the matrices are relatively tiny:

```
sage: %timeit ~(matrix({(200-i,i): 1/i for i in range(1,200,1)}, sparse=True) + 1)
10 loops, best of 3: 171 ms per loop
sage: %timeit ~(matrix({(100-i,i): 1/i for i in range(1,100,1)}, sparse=True) + 1)
10 loops, best of 3: 30.2 ms per loop
sage: %timeit ~(matrix({(20-i,i): 1/i for i in range(1,20,1)}, sparse=True) + 1)
The slowest run took 11.65 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 3: 1.3 ms per loop
```



---

archive/issue_events_218275.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-01T06:30:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "rename": {
        "from": "Use echelonize instead of echelon_form in __invert__",
        "to": "Use echelonize instead of echelon_form in a few places"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218275"
}
```



---

archive/issue_comments_369011.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,6 @@\n We do not need to create another copy of the augmented matrix to keep memory usage down (including putting it in a cache) and because it is faster.\n \n+We do this change in `__invert__`, `right_kernel_matrix`, and `_solve_right_nonsingular_square`.\n+\n We also can take advantage of the sparse structure and our knowledge of the augmented matrix [I|A<sup>-1</sup>] when reconstructing the matrix.\n+\n``````\n",
    "created_at": "2017-11-01T06:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369011",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,6 @@
 We do not need to create another copy of the augmented matrix to keep memory usage down (including putting it in a cache) and because it is faster.
 
+We do this change in `__invert__`, `right_kernel_matrix`, and `_solve_right_nonsingular_square`.
+
 We also can take advantage of the sparse structure and our knowledge of the augmented matrix [I|A<sup>-1</sup>] when reconstructing the matrix.
+
``````




---

archive/issue_comments_369012.json:
```json
{
    "body": "**Changing commit** from \"[294150fc0e058372cc83be396b188c961536e7a5](https://github.com/sagemath/sagetrac-mirror/commit/294150fc0e058372cc83be396b188c961536e7a5)\" to \"[d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f](https://github.com/sagemath/sagetrac-mirror/commit/d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f)\".",
    "created_at": "2017-11-01T06:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[294150fc0e058372cc83be396b188c961536e7a5](https://github.com/sagemath/sagetrac-mirror/commit/294150fc0e058372cc83be396b188c961536e7a5)" to "[d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f](https://github.com/sagemath/sagetrac-mirror/commit/d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f)".



---

archive/issue_comments_369013.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f\">d6e5a09</a></td><td><code>Use echelonize in two other places.</code></td></tr></table>\n",
    "created_at": "2017-11-01T06:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f">d6e5a09</a></td><td><code>Use echelonize in two other places.</code></td></tr></table>




---

archive/issue_comments_369014.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5\">cfbb776</a></td><td><code>Merge branch 'develop' into public/linear_algebra/echelonize_in_invert-24122</code></td></tr></table>\n",
    "created_at": "2017-11-09T00:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5">cfbb776</a></td><td><code>Merge branch 'develop' into public/linear_algebra/echelonize_in_invert-24122</code></td></tr></table>




---

archive/issue_comments_369015.json:
```json
{
    "body": "**Changing commit** from \"[d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f](https://github.com/sagemath/sagetrac-mirror/commit/d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f)\" to \"[cfbb77680533b3b2badc5177e3a00cea74c7ffa5](https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5)\".",
    "created_at": "2017-11-09T00:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f](https://github.com/sagemath/sagetrac-mirror/commit/d6e5a091afd875c1e0c1df0919f1e5b6d3bc553f)" to "[cfbb77680533b3b2badc5177e3a00cea74c7ffa5](https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5)".



---

archive/issue_comments_369016.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis is a bit weird\n\n```\n+        for i in range(nrows):\n+            del data[i,i]\n+        data = {(r,c-nrows): data[r,c] for (r,c) in data}\n```\nYou are modifying `data` and then override it. If you can not do the modification inplace, the following looks simpler\n\n```\ndata = {(r,c-nrows): data[r,c] for (r,c) in data if c >= nrows}\n```",
    "created_at": "2017-11-10T19:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369016",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
This is a bit weird

```
+        for i in range(nrows):
+            del data[i,i]
+        data = {(r,c-nrows): data[r,c] for (r,c) in data}
```
You are modifying `data` and then override it. If you can not do the modification inplace, the following looks simpler

```
data = {(r,c-nrows): data[r,c] for (r,c) in data if c >= nrows}
```



---

archive/issue_comments_369017.json:
```json
{
    "body": "<a id='comment:10'></a>\nYes, it looks more simple, but it actually takes longer because it has to do the `if` check on every nonzero object. Whereas the version I have just removes objects from the `dict`. I suspect this is more of a micro improvement, but that could be a lot of extra checks for a really big sparse matrix (at least, I have a 62001 x 62001 sparse matrix with 1756951 non-zero entries).\n\nIdeally I would like to modify the data in place and just update the indices, but hash tables are not good for doing that. One of these days, someone (me) should implement another data structure for sparse matrices...",
    "created_at": "2017-11-10T23:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369017",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
Yes, it looks more simple, but it actually takes longer because it has to do the `if` check on every nonzero object. Whereas the version I have just removes objects from the `dict`. I suspect this is more of a micro improvement, but that could be a lot of extra checks for a really big sparse matrix (at least, I have a 62001 x 62001 sparse matrix with 1756951 non-zero entries).

Ideally I would like to modify the data in place and just update the indices, but hash tables are not good for doing that. One of these days, someone (me) should implement another data structure for sparse matrices...



---

archive/issue_comments_369018.json:
```json
{
    "body": "**Reviewer:** Vincent Delecroix",
    "created_at": "2017-11-11T10:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369018",
    "user": "https://github.com/videlec"
}
```

**Reviewer:** Vincent Delecroix



---

archive/issue_comments_369019.json:
```json
{
    "body": "<a id='comment:11'></a>\nOh, I see.\n\nNote that for matrices over ZZ or QQ, there is a custom C datatype which is an array of sparse vectors. This is not ideal but already faster than dictionaries in most contexts.",
    "created_at": "2017-11-11T10:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369019",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Oh, I see.

Note that for matrices over ZZ or QQ, there is a custom C datatype which is an array of sparse vectors. This is not ideal but already faster than dictionaries in most contexts.



---

archive/issue_events_218276.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-12T20:21:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218276"
}
```



---

archive/issue_events_218277.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2017-11-12T20:21:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218277"
}
```



---

archive/issue_comments_369020.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks for the review.",
    "created_at": "2017-11-12T22:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369020",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Thanks for the review.



---

archive/issue_events_218278.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:03:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218278"
}
```



---

archive/issue_events_218279.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:03:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24122#event-218279"
}
```



---

archive/issue_comments_369021.json:
```json
{
    "body": "**Changing branch** from \"[public/linear_algebra/echelonize_in_invert-24122](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/echelonize_in_invert-24122)\" to \"[cfbb77680533b3b2badc5177e3a00cea74c7ffa5](https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5)\".",
    "created_at": "2017-12-11T01:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24122",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24122#issuecomment-369021",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/linear_algebra/echelonize_in_invert-24122](https://github.com/sagemath/sagetrac-mirror/tree/public/linear_algebra/echelonize_in_invert-24122)" to "[cfbb77680533b3b2badc5177e3a00cea74c7ffa5](https://github.com/sagemath/sagetrac-mirror/commit/cfbb77680533b3b2badc5177e3a00cea74c7ffa5)".
