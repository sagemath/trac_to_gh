# Issue 24192: -std=c99 causes numerous problems on Cygwin

archive/issues_023955.json:
```json
{
    "body": "#23919 introduced numerous regressions in the Cygwin build.  Unfortunately this ticket was not tested by the Cygwin patchbot because it just didn't get to it (it is rather slow, and has been crashing lately for some reason).  I was also not made aware of this ticket.\n\nMany headers included in newlib (Cygwin's libc) have some compatibility problems with `-std=c99`.  `-std=gnu99` tends to fare better.\n\nIn the short term I might just set that universally for Cygwin, rather than try to deal with each individual issue that comes up.\n\nKeywords: windows cygwin\n\nBranch/Commit: 520fdab4f6ead0a88edd8fd6def6017c567dd606\n\nReviewer: Emmanuel Charpentier\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24192\n\n",
    "closed_at": "2017-11-17T13:28:06Z",
    "created_at": "2017-11-10T16:49:53Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "-std=c99 causes numerous problems on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24192",
    "user": "https://github.com/embray"
}
```
#23919 introduced numerous regressions in the Cygwin build.  Unfortunately this ticket was not tested by the Cygwin patchbot because it just didn't get to it (it is rather slow, and has been crashing lately for some reason).  I was also not made aware of this ticket.

Many headers included in newlib (Cygwin's libc) have some compatibility problems with `-std=c99`.  `-std=gnu99` tends to fare better.

In the short term I might just set that universally for Cygwin, rather than try to deal with each individual issue that comes up.

Keywords: windows cygwin

Branch/Commit: 520fdab4f6ead0a88edd8fd6def6017c567dd606

Reviewer: Emmanuel Charpentier

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24192





---

archive/issue_comments_357204.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n #23919 introduced numerous regressions in the Cygwin build.  Unfortunately this ticket was not tested by the Cygwin patchbot because it just didn't get to it (it is rather slow, and has been crashing lately for some reason).  I was also not made aware of this ticket.\n \n-Many headers included in newlib (Cygwin's libc) have some compatibility problems with \\`-std=c99\\`.  \\`-std=gnu++98\\` tends to fare better.\n+Many headers included in newlib (Cygwin's libc) have some compatibility problems with \\`-std=c99\\`.  \\`-std=gnu99\\` tends to fare better.\n \n In the short term I might just set that universally for Cygwin, rather than try to deal with each individual issue that comes up.\n \n```\n",
    "created_at": "2017-11-10T16:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357204",
    "user": "https://github.com/embray"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,6 @@
 #23919 introduced numerous regressions in the Cygwin build.  Unfortunately this ticket was not tested by the Cygwin patchbot because it just didn't get to it (it is rather slow, and has been crashing lately for some reason).  I was also not made aware of this ticket.
 
-Many headers included in newlib (Cygwin's libc) have some compatibility problems with \`-std=c99\`.  \`-std=gnu++98\` tends to fare better.
+Many headers included in newlib (Cygwin's libc) have some compatibility problems with \`-std=c99\`.  \`-std=gnu99\` tends to fare better.
 
 In the short term I might just set that universally for Cygwin, rather than try to deal with each individual issue that comes up.
 
```




---

archive/issue_comments_357205.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2017-11-10T17:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357205",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_357206.json:
```json
{
    "body": "Changing keywords from \"\" to \"windows cygwin\".",
    "created_at": "2017-11-10T17:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357206",
    "user": "https://github.com/embray"
}
```

Changing keywords from "" to "windows cygwin".



---

archive/issue_comments_357207.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-10T17:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357207",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_357208.json:
```json
{
    "body": "<a id='comment:3'></a>Do you mean `sys.platform != 'cygwin'`?",
    "created_at": "2017-11-11T04:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357208",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Do you mean `sys.platform != 'cygwin'`?



---

archive/issue_comments_357209.json:
```json
{
    "body": "<a id='comment:4'></a>Oops that's weird. I just did a test build of this before posting and it worked, but looking at the logs I definitely had this the right way around before. I don't know how it got switched just before I committed. Been doing a lot of that lately. I was tired and rushed.",
    "created_at": "2017-11-11T13:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357209",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>Oops that's weird. I just did a test build of this before posting and it worked, but looking at the logs I definitely had this the right way around before. I don't know how it got switched just before I committed. Been doing a lot of that lately. I was tired and rushed.



---

archive/issue_comments_357210.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-11T13:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357210",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_357211.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 embray]:\n> Oops that's weird. I just did a test build of this before posting and it worked, but looking at the logs I definitely had this the right way around before. I don't know how it got switched just before I committed. Been doing a lot of that lately. I was tired and rushed. \n\n\nDefinitely `needs_work` : Python3 now fails to build (I'll upload the (compressed) log momentarily...",
    "created_at": "2017-11-11T14:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357211",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:5'></a>Replying to [comment:4 embray]:
> Oops that's weird. I just did a test build of this before posting and it worked, but looking at the logs I definitely had this the right way around before. I don't know how it got switched just before I committed. Been doing a lot of that lately. I was tired and rushed. 


Definitely `needs_work` : Python3 now fails to build (I'll upload the (compressed) log momentarily...



---

archive/issue_comments_357212.json:
```json
{
    "body": "Failure to build python3 with #24192.",
    "created_at": "2017-11-11T14:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357212",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Failure to build python3 with #24192.



---

archive/issue_comments_357213.json:
```json
{
    "body": "<a id='comment:6'></a>Attachment [python3-3.6.1.p1.log.gz](tarball://root/attachments/some-uuid/ticket24192/python3-3.6.1.p1.log.gz) by @tscrim created at 2017-11-11 15:38:26\n\n`@`charpent, did you try it with `!=`? `@`embray, can you push the correction?",
    "created_at": "2017-11-11T15:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357213",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Attachment [python3-3.6.1.p1.log.gz](tarball://root/attachments/some-uuid/ticket24192/python3-3.6.1.p1.log.gz) by @tscrim created at 2017-11-11 15:38:26

`@`charpent, did you try it with `!=`? `@`embray, can you push the correction?



---

archive/issue_comments_357214.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 tscrim]:\n> `@`charpent, did you try it with `!=`?\n\n\nNope. I'm a bit out of my (excessively shallow) depth, here. I prefer to wait for embray to push it itself : he knows what he's doing ; not me...\n\n> `@`embray, can you push the correction?\n\n\nSeconded.",
    "created_at": "2017-11-11T15:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357214",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:7'></a>Replying to [comment:6 tscrim]:
> `@`charpent, did you try it with `!=`?


Nope. I'm a bit out of my (excessively shallow) depth, here. I prefer to wait for embray to push it itself : he knows what he's doing ; not me...

> `@`embray, can you push the correction?


Seconded.



---

archive/issue_comments_357215.json:
```json
{
    "body": "<a id='comment:8'></a>I bit the bullet, `git checkout`ed #24192, `git pull`ed #24121, #24189, #24191 and inverted the test line 435 of `src/setup.py`.\n\nTo no avail : fails to build the library... I throw the towel for now...\n\n==> still `needs_work`",
    "created_at": "2017-11-12T00:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357215",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:8'></a>I bit the bullet, `git checkout`ed #24192, `git pull`ed #24121, #24189, #24191 and inverted the test line 435 of `src/setup.py`.

To no avail : fails to build the library... I throw the towel for now...

==> still `needs_work`



---

archive/issue_comments_357216.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-13T08:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357217.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-13T08:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357217",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357218.json:
```json
{
    "body": "<a id='comment:11'></a>1. Why `gnu++98` and not `gnu++11`? Sooner or later, we will require C++11 and then this will break on Cygwin. In fact, I thought that we already required C++11 so I'm slightly surprised that `gnu++98` even works.\n\n2. I think it is more readable to reverse the `if` condition and write\n\n```\nif sys.platform == \"cygwin\":\n    # Cygwin stuff\nelse:\n    # Generic stuff\n```",
    "created_at": "2017-11-13T09:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357218",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>1. Why `gnu++98` and not `gnu++11`? Sooner or later, we will require C++11 and then this will break on Cygwin. In fact, I thought that we already required C++11 so I'm slightly surprised that `gnu++98` even works.

2. I think it is more readable to reverse the `if` condition and write

```
if sys.platform == "cygwin":
    # Cygwin stuff
else:
    # Generic stuff
```



---

archive/issue_comments_357219.json:
```json
{
    "body": "<a id='comment:12'></a>3. This only deals with the *default* flags in case no other `-std` flags were given (coming from pkgconfig, from `module_list.py`, from `# distutils` declarations...). If Cygwin truly has problems with `-std=c...`, then it should probably replace all such flags.",
    "created_at": "2017-11-13T09:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357219",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>3. This only deals with the *default* flags in case no other `-std` flags were given (coming from pkgconfig, from `module_list.py`, from `# distutils` declarations...). If Cygwin truly has problems with `-std=c...`, then it should probably replace all such flags.



---

archive/issue_comments_357220.json:
```json
{
    "body": "<a id='comment:13'></a>It doesn't have a problem in all cases, just some.  But you raise a good point, maybe for Cygwin it just force the safest flags.  I'll try `gnu++11`--you're right, that *should* work.  I think at one point I had a problem with some module compiling with C++11 but I might have misremembered.\n\nIn general most of the problems here has to do with bugs/oddities in how newlib handles flags like `_POSIX_SOURCE` depending on the order in which some headers are included.",
    "created_at": "2017-11-13T12:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357220",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>It doesn't have a problem in all cases, just some.  But you raise a good point, maybe for Cygwin it just force the safest flags.  I'll try `gnu++11`--you're right, that *should* work.  I think at one point I had a problem with some module compiling with C++11 but I might have misremembered.

In general most of the problems here has to do with bugs/oddities in how newlib handles flags like `_POSIX_SOURCE` depending on the order in which some headers are included.



---

archive/issue_comments_357221.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-14T08:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357221",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_357222.json:
```json
{
    "body": "<a id='comment:14'></a>8.1rc0 + #24121 + #24189 + #24191 + #24192 sill doesn't build on Windows+Cygwin. The problem happens at the (final) Sage library building, where some files fail to build, the error message pointing to the need of C++11 support.\n\nI'll try to  upload the (compressed) log.\n\n==>`needs_work`",
    "created_at": "2017-11-14T08:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357222",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:14'></a>8.1rc0 + #24121 + #24189 + #24191 + #24192 sill doesn't build on Windows+Cygwin. The problem happens at the (final) Sage library building, where some files fail to build, the error message pointing to the need of C++11 support.

I'll try to  upload the (compressed) log.

==>`needs_work`



---

archive/issue_comments_357223.json:
```json
{
    "body": "Failed attempt to build with #24121+#24189+#24191+#24192",
    "created_at": "2017-11-14T08:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357223",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Failed attempt to build with #24121+#24189+#24191+#24192



---

archive/issue_comments_357224.json:
```json
{
    "body": "<a id='comment:15'></a>Attachment [install.log.gz](tarball://root/attachments/some-uuid/ticket24192/install.log.gz) by @jdemeyer created at 2017-11-14 09:16:31\n\nSo it seems that I was correct that Sage *requires* C++11.",
    "created_at": "2017-11-14T09:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357224",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Attachment [install.log.gz](tarball://root/attachments/some-uuid/ticket24192/install.log.gz) by @jdemeyer created at 2017-11-14 09:16:31

So it seems that I was correct that Sage *requires* C++11.



---

archive/issue_comments_357225.json:
```json
{
    "body": "<a id='comment:16'></a>I'm still going to try it out, but that's not true.  With the current version of this ticket everything built correctly and the test suite passed so I'm not sure what problem Emmanuel is having.",
    "created_at": "2017-11-14T11:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357225",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>I'm still going to try it out, but that's not true.  With the current version of this ticket everything built correctly and the test suite passed so I'm not sure what problem Emmanuel is having.



---

archive/issue_comments_357226.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-14T12:25:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357227.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-11-14T12:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357227",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357228.json:
```json
{
    "body": "<a id='comment:18'></a>Reworked slightly, using `-std=gnu++11` for Cygwin.  I'm still keeping the defaults for modules that already have a `-std=` flag.  In principle I should probably add these flags by force on Cygwin but it so happens that for now it works okay.  So I'd rather leave it as is for now as a short-term workaround, and then see about addressing individual problems with certain modules individually.",
    "created_at": "2017-11-14T12:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357228",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>Reworked slightly, using `-std=gnu++11` for Cygwin.  I'm still keeping the defaults for modules that already have a `-std=` flag.  In principle I should probably add these flags by force on Cygwin but it so happens that for now it works okay.  So I'd rather leave it as is for now as a short-term workaround, and then see about addressing individual problems with certain modules individually.



---

archive/issue_comments_357229.json:
```json
{
    "body": "<a id='comment:19'></a>Just one detail: could you add a reference to this ticket in a comment, so we know why Cygwin needs to be special?",
    "created_at": "2017-11-14T12:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357229",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>Just one detail: could you add a reference to this ticket in a comment, so we know why Cygwin needs to be special?



---

archive/issue_comments_357230.json:
```json
{
    "body": "<a id='comment:20'></a>Smells good : after resetting --hard and pulling that branch again :\n* `sage -b` finished without errors (at last !)\n* `make` built the doc without problems.\n\nSince this build is a bit of a chimera (different parts built with dufferent versions of `setup.py`), I'll give it a rebuild (`make distclean && make ptestlong`) before giving it positive review. This will take a while (especially if it gets interrupted by those pesky \"Resource temporarily unavailable\"...).\n\nThank you for your patience !",
    "created_at": "2017-11-14T22:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357230",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:20'></a>Smells good : after resetting --hard and pulling that branch again :
* `sage -b` finished without errors (at last !)
* `make` built the doc without problems.

Since this build is a bit of a chimera (different parts built with dufferent versions of `setup.py`), I'll give it a rebuild (`make distclean && make ptestlong`) before giving it positive review. This will take a while (especially if it gets interrupted by those pesky "Resource temporarily unavailable"...).

Thank you for your patience !



---

archive/issue_comments_357231.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-15T07:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357231",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357232.json:
```json
{
    "body": "<a id='comment:21'></a>Sage 8.1rc0 + #24121 + #24189 + #24191 + #24192 builds and passes ptestlong with two transient failures :\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 114.5 src/sage/parallel/map_reduce.py  # 2 doctests failed\nsage -t --long --warn-long 114.5 src/sage/misc/temporary_file.py  # 5 doctests failed\n----------------------------------------------------------------------\n```\n\nBoth doctests pass without error when ran standalone.\n\n==>`positive_review`\n\nNote : this is long (about 8 hours for full rebuild and tests, including about 1/4h lost due to a \"Resource temporarily unavailable\"...), on a virtual machine allocated 4 CPUs and 8 GB RAM.\n\nThis is mainly due to a long build : from install.log :\n\n```\nreal\t129m17,235s\nuser\t179m33,147s\nsys\t102m1,896s\n```\nthen\n\n```\nreal\t151m57,343s\nuser\t242m18,472s\nsys\t54m40,605s\n```\n\n\nOn the same bare metal, running Debian testing (8 CPUs, 16 GB RAM) :\n\n```\nreal\t54m55,725s\nuser\t257m40,535s\nsys\t6m44,282s\n```\n\nAbout 281 minutes of real time vs 54 minutes. One notes\n* 156 minutes of \"sys\" CPU time, vs about 7 minutes on \"bare\" Debian.\n* 420 minutes of \"user\" CPU time, vs 257 minutes on \"bare\" Debian\n\nAccounting for the avilability of about twice the resources on \"\"bare\" Debian, that means that the large \"Cygwin overhead\" may be attributed at least in part to inefficiencies in system calls.\n\nThings are different for Sage use, as exemplified by the doctests. On Cygwin :\n\n```\nTotal time for all tests: 7468.6 seconds\n    cpu time: 18746.4 seconds\n    cumulative wall time: 26871.3 seconds\n```\n\nOn the same bare metal :\n\n```\nTotal time for all tests: 3397.3 seconds\n    cpu time: 20643.2 seconds\n    cumulative wall time: 26481.0 seconds\n```\n\nBoth wall time and CPU times are roughly proportional to the available resources.\n\nOne is tempted to conclude that Cygwin is piss-poor at Sage development but results in an usable Sage. But of course, this is way too rough to be credible...\n\nOne also notes discrepancies between sum of \"user\" and \"sys\" times and total elapsed time. This may be due to more \"system\" activity on Windows. And the fact that Windows runs on a VM, which needs some CPU time for itself.\n\nHTH,",
    "created_at": "2017-11-15T07:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357232",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:21'></a>Sage 8.1rc0 + #24121 + #24189 + #24191 + #24192 builds and passes ptestlong with two transient failures :

```
----------------------------------------------------------------------
sage -t --long --warn-long 114.5 src/sage/parallel/map_reduce.py  # 2 doctests failed
sage -t --long --warn-long 114.5 src/sage/misc/temporary_file.py  # 5 doctests failed
----------------------------------------------------------------------
```

Both doctests pass without error when ran standalone.

==>`positive_review`

Note : this is long (about 8 hours for full rebuild and tests, including about 1/4h lost due to a "Resource temporarily unavailable"...), on a virtual machine allocated 4 CPUs and 8 GB RAM.

This is mainly due to a long build : from install.log :

```
real	129m17,235s
user	179m33,147s
sys	102m1,896s
```
then

```
real	151m57,343s
user	242m18,472s
sys	54m40,605s
```


On the same bare metal, running Debian testing (8 CPUs, 16 GB RAM) :

```
real	54m55,725s
user	257m40,535s
sys	6m44,282s
```

About 281 minutes of real time vs 54 minutes. One notes
* 156 minutes of "sys" CPU time, vs about 7 minutes on "bare" Debian.
* 420 minutes of "user" CPU time, vs 257 minutes on "bare" Debian

Accounting for the avilability of about twice the resources on ""bare" Debian, that means that the large "Cygwin overhead" may be attributed at least in part to inefficiencies in system calls.

Things are different for Sage use, as exemplified by the doctests. On Cygwin :

```
Total time for all tests: 7468.6 seconds
    cpu time: 18746.4 seconds
    cumulative wall time: 26871.3 seconds
```

On the same bare metal :

```
Total time for all tests: 3397.3 seconds
    cpu time: 20643.2 seconds
    cumulative wall time: 26481.0 seconds
```

Both wall time and CPU times are roughly proportional to the available resources.

One is tempted to conclude that Cygwin is piss-poor at Sage development but results in an usable Sage. But of course, this is way too rough to be credible...

One also notes discrepancies between sum of "user" and "sys" times and total elapsed time. This may be due to more "system" activity on Windows. And the fact that Windows runs on a VM, which needs some CPU time for itself.

HTH,



---

archive/issue_comments_357233.json:
```json
{
    "body": "<a id='comment:22'></a>Still need to add a comment per #24192#comment:19 (agreed)",
    "created_at": "2017-11-15T13:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357233",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>Still need to add a comment per #24192#comment:19 (agreed)



---

archive/issue_comments_357234.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-11-15T13:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357234",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_357235.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-15T13:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357236.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-11-15T13:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357236",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_357237.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:21 charpent]:\n> Note : this is long (about 8 hours for full rebuild and tests, including about 1/4h lost due to a \"Resource temporarily unavailable\"...), on a virtual machine allocated 4 CPUs and 8 GB RAM.\n\n\nIt shouldn't take that long.  Also, are using the openblas or \"atlas\".  Selecting \"atlas\" and supplying `SAGE_ATLAS_LIB=/usr/lib` will allow it to use the BLAS from Cygwin's lapack package which is going to be slower, but not typically *that* slow.\n\nI need to rework BLAS installation so it can use the version from the system more easily and more explicitly.  While that does fall under my general work of making Sage use more system packages, this is a special enough case that it might be worth the effort for me to address it specifically now.  That way it would also be easier to use Cygwin's native openblas package.",
    "created_at": "2017-11-15T13:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357237",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>Replying to [comment:21 charpent]:
> Note : this is long (about 8 hours for full rebuild and tests, including about 1/4h lost due to a "Resource temporarily unavailable"...), on a virtual machine allocated 4 CPUs and 8 GB RAM.


It shouldn't take that long.  Also, are using the openblas or "atlas".  Selecting "atlas" and supplying `SAGE_ATLAS_LIB=/usr/lib` will allow it to use the BLAS from Cygwin's lapack package which is going to be slower, but not typically *that* slow.

I need to rework BLAS installation so it can use the version from the system more easily and more explicitly.  While that does fall under my general work of making Sage use more system packages, this is a special enough case that it might be worth the effort for me to address it specifically now.  That way it would also be easier to use Cygwin's native openblas package.



---

archive/issue_comments_357238.json:
```json
{
    "body": "<a id='comment:26'></a>Also as far as installation time goes, it is slower to do a full build on Cygwin.  This mostly has to do with the significantly greater overhead involved in each process that is run.  You'll probably notice that every package's `./configure` is *slowwwwww* for this reason.  I have an experimental branch that makes it easier to cache configure results for each package, but this seems to shave off at best 5 minutes (which is still not nothing).  ccache goes a long way too...",
    "created_at": "2017-11-15T14:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357238",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>Also as far as installation time goes, it is slower to do a full build on Cygwin.  This mostly has to do with the significantly greater overhead involved in each process that is run.  You'll probably notice that every package's `./configure` is *slowwwwww* for this reason.  I have an experimental branch that makes it easier to cache configure results for each package, but this seems to shave off at best 5 minutes (which is still not nothing).  ccache goes a long way too...



---

archive/issue_comments_357239.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-11-17T13:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24192#issuecomment-357239",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061322.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-17T13:28:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24192",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24192#event-61322"
}
```
