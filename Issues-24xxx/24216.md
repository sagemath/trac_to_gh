# Issue 24216: Add crossing number of a graph

archive/issues_023979.json:
```json
{
    "body": "This patch adds a function to compute the crossing number of a graph.\n\nImplementation is slow and unusable for most graphs, but then, so is `genus()` already. And it is easier to make better code when we have any reference code to compare results.\n\n**CC:**  @dcoudert\n\n**Branch/Commit:** [6736953723bcfbf724f64bfe6c2e7f5573d0dade](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)\n\n**Reviewer:** Martin Rubey\n\n**Author:** Jori M\u00e4ntysalo\n\nIssue created by migration from https://trac.sagemath.org/ticket/24216\n\n",
    "closed_at": "2018-01-05T23:56:21Z",
    "created_at": "2017-11-14T13:16:54Z",
    "labels": [
        "component: graph theory",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Add crossing number of a graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24216",
    "user": "https://github.com/jm58660"
}
```
This patch adds a function to compute the crossing number of a graph.

Implementation is slow and unusable for most graphs, but then, so is `genus()` already. And it is easier to make better code when we have any reference code to compare results.

**CC:**  @dcoudert

**Branch/Commit:** [6736953723bcfbf724f64bfe6c2e7f5573d0dade](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)

**Reviewer:** Martin Rubey

**Author:** Jori MÃ¤ntysalo

Issue created by migration from https://trac.sagemath.org/ticket/24216





---

archive/issue_comments_368855.json:
```json
{
    "body": "**Branch:** [u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)",
    "created_at": "2017-11-14T13:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368855",
    "user": "https://github.com/jm58660"
}
```

**Branch:** [u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)



---

archive/issue_comments_368856.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc\">c2773a6</a></td><td><code>Add crossing number.</code></td></tr></table>\n",
    "created_at": "2017-11-14T13:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368856",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc">c2773a6</a></td><td><code>Add crossing number.</code></td></tr></table>




---

archive/issue_events_215014.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-14T13:17:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215014"
}
```



---

archive/issue_comments_368857.json:
```json
{
    "body": "**Commit:** [c2773a69229f4f658abccf697caf313aef0c84bc](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)",
    "created_at": "2017-11-14T13:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368857",
    "user": "https://github.com/jm58660"
}
```

**Commit:** [c2773a69229f4f658abccf697caf313aef0c84bc](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)



---

archive/issue_comments_368858.json:
```json
{
    "body": "<a id='comment:3'></a>\nHi Joris!\n\nI suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.",
    "created_at": "2017-11-14T13:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368858",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:3'></a>
Hi Joris!

I suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.



---

archive/issue_comments_368859.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [mantepse](#comment%3A3):\n\n> I suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.\n\n\nSo we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.",
    "created_at": "2017-11-14T13:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368859",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:4'></a>
Replying to [mantepse](#comment%3A3):

> I suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.


So we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.



---

archive/issue_comments_368860.json:
```json
{
    "body": "<a id='comment:5'></a>\nHello,\n\nI agree that your code do the job and is not optimized. \n\n- This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.\n\n- You could add a test for trivial graphs and planar graphs\n\n- You can do better for degree 1 vertices since you want to keep the 1-core\n\n```\none = self.cores(k=1)[0]\nif one:\n    G = Graph(self.edges())\n    G.delete_vertices(one)\nelse:\n    G = self\n```\n- For degree 2, it's easier\n\n```\ntwo = [u for u in G if G.degree(u) == 2]\nif two:\n    if G is self:\n        G = self.copy()\n    for u in two:\n        v,w = G.neighbors(u)\n        G.add_edge(v, w)\n    G.delete_vertex(u)\n```\n\n- I realize that your `edgepairs` are in fact (but this might be slower to produce. Don't know): \n\n```\nedgepairs = [Set(e) for e in G.line_graph(labels=0).complement().edge_iterator(labels=0)]\n```\n\n- for the while loop, I don't see how to make it faster.",
    "created_at": "2017-11-14T19:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368860",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>
Hello,

I agree that your code do the job and is not optimized. 

- This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.

- You could add a test for trivial graphs and planar graphs

- You can do better for degree 1 vertices since you want to keep the 1-core

```
one = self.cores(k=1)[0]
if one:
    G = Graph(self.edges())
    G.delete_vertices(one)
else:
    G = self
```
- For degree 2, it's easier

```
two = [u for u in G if G.degree(u) == 2]
if two:
    if G is self:
        G = self.copy()
    for u in two:
        v,w = G.neighbors(u)
        G.add_edge(v, w)
    G.delete_vertex(u)
```

- I realize that your `edgepairs` are in fact (but this might be slower to produce. Don't know): 

```
edgepairs = [Set(e) for e in G.line_graph(labels=0).complement().edge_iterator(labels=0)]
```

- for the while loop, I don't see how to make it faster.



---

archive/issue_comments_368861.json:
```json
{
    "body": "<a id='comment:6'></a>\n> So we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.\n\nIt's for graphs with pathwidth 3. Not sure it's easy to implement or fast...\n\nThis paper [Computing crossing number in linear time](https://dl.acm.org/citation.cfm?id=1250848) is promising. I don't know if it has already been implemented .\n\nAn ILP formulation could also be a good addition (for another ticket).",
    "created_at": "2017-11-14T19:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368861",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
> So we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.

It's for graphs with pathwidth 3. Not sure it's easy to implement or fast...

This paper [Computing crossing number in linear time](https://dl.acm.org/citation.cfm?id=1250848) is promising. I don't know if it has already been implemented .

An ILP formulation could also be a good addition (for another ticket).



---

archive/issue_comments_368862.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [dcoudert](#comment%3A5):\n> Hello,\n> \n> I agree that your code do the job and is not optimized. \n> \n> - This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.\n\n\nThere can be good reason to add a comment to a single line like that in a doctest where a full description is not ideal. So I would not say it is not a good idea (in general), although the latter is more common. However, in this case, I do think it better to have\n\n```\nCheck for a planar graph::\n\n    sage: C4 = graphs.CompleteGraph(4)\n    sage: C4.crossing_number()\n    0\n```",
    "created_at": "2017-11-15T02:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368862",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Replying to [dcoudert](#comment%3A5):
> Hello,
> 
> I agree that your code do the job and is not optimized. 
> 
> - This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.


There can be good reason to add a comment to a single line like that in a doctest where a full description is not ideal. So I would not say it is not a good idea (in general), although the latter is more common. However, in this case, I do think it better to have

```
Check for a planar graph::

    sage: C4 = graphs.CompleteGraph(4)
    sage: C4.crossing_number()
    0
```



---

archive/issue_comments_368863.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83\">669bb34</a></td><td><code>Reformat tests-block.</code></td></tr></table>\n",
    "created_at": "2017-11-15T05:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83">669bb34</a></td><td><code>Reformat tests-block.</code></td></tr></table>




---

archive/issue_comments_368864.json:
```json
{
    "body": "**Changing commit** from \"[c2773a69229f4f658abccf697caf313aef0c84bc](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)\" to \"[669bb34dff3f87b76dfb42bd2c1032a450f1ff83](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)\".",
    "created_at": "2017-11-15T05:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c2773a69229f4f658abccf697caf313aef0c84bc](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)" to "[669bb34dff3f87b76dfb42bd2c1032a450f1ff83](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)".



---

archive/issue_comments_368865.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [dcoudert](#comment%3A5):\n\nI modified `TESTS` and will do more changes. Two questions:\n\n> - You could add a test for trivial graphs and planar graphs\n\n\nIn the code or as a test?\n\n> - For degree 2, it's easier\n\n\nBut for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.\n\n(What we could do is to use automorphisms, but maybe it's not worth doing now.)",
    "created_at": "2017-11-15T05:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368865",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:9'></a>
Replying to [dcoudert](#comment%3A5):

I modified `TESTS` and will do more changes. Two questions:

> - You could add a test for trivial graphs and planar graphs


In the code or as a test?

> - For degree 2, it's easier


But for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.

(What we could do is to use automorphisms, but maybe it's not worth doing now.)



---

archive/issue_comments_368866.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jmantysalo](#comment%3A9):\n> Replying to [dcoudert](#comment%3A5):\n> \n> I modified `TESTS` and will do more changes. Two questions:\n> \n> > - You could add a test for trivial graphs and planar graphs\n \n> \n> In the code or as a test?\n\n\nIn the code. When it's trivial or low cost to answer, we should do it.\n\n> > - For degree 2, it's easier\n \n> \n> But for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.\n\n\nAre you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.\n\nYou raise an interesting point: if you forbid multiedges, then you can reduce further.\n\nThe preprocessing could be\n\n```\ntwo = {u for u in G if G.degree(u) == 2}\nwhile two:\nif two and G is self:\n    G = self.copy()\nwhile two:\n    u = two.pop()\n    if G.degree(u) < 2:\n        if G.degree(u) == 1:\n            two.add(next(G.neighbor_iterator(u)))\n        G.delete_vertex(u)\n        continue\n    v,w = G.neighbors(u)\n    G.add_edge(v, w)\n    G.delete_vertex(u)\n    if G.degree(v) <= 2:\n        two.add(v)\n    if G.degree(w) <= 2:\n        two.add(w)\n```",
    "created_at": "2017-11-15T08:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368866",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
Replying to [jmantysalo](#comment%3A9):
> Replying to [dcoudert](#comment%3A5):
> 
> I modified `TESTS` and will do more changes. Two questions:
> 
> > - You could add a test for trivial graphs and planar graphs
 
> 
> In the code or as a test?


In the code. When it's trivial or low cost to answer, we should do it.

> > - For degree 2, it's easier
 
> 
> But for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.


Are you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.

You raise an interesting point: if you forbid multiedges, then you can reduce further.

The preprocessing could be

```
two = {u for u in G if G.degree(u) == 2}
while two:
if two and G is self:
    G = self.copy()
while two:
    u = two.pop()
    if G.degree(u) < 2:
        if G.degree(u) == 1:
            two.add(next(G.neighbor_iterator(u)))
        G.delete_vertex(u)
        continue
    v,w = G.neighbors(u)
    G.add_edge(v, w)
    G.delete_vertex(u)
    if G.degree(v) <= 2:
        two.add(v)
    if G.degree(w) <= 2:
        two.add(w)
```



---

archive/issue_comments_368867.json:
```json
{
    "body": "**Changing commit** from \"[669bb34dff3f87b76dfb42bd2c1032a450f1ff83](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)\" to \"[8de878c35236cdc359e163f7e9e4838a74b192ad](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)\".",
    "created_at": "2017-11-15T10:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[669bb34dff3f87b76dfb42bd2c1032a450f1ff83](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)" to "[8de878c35236cdc359e163f7e9e4838a74b192ad](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)".



---

archive/issue_comments_368868.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad\">8de878c</a></td><td><code>Shortcut for planar graphs.</code></td></tr></table>\n",
    "created_at": "2017-11-15T10:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad">8de878c</a></td><td><code>Shortcut for planar graphs.</code></td></tr></table>




---

archive/issue_comments_368869.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [dcoudert](#comment%3A10):\n\n> > > - You could add a test for trivial graphs and planar graphs\n\n\n> > In the code or as a test?\n\n\n> In the code. When it's trivial or low cost to answer, we should do it.\n\n\nI added a test for planar graph.\n\n> Are you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.\n\n\n?? There is `_scream_if_not_simple()` in the code.\n\n> You raise an interesting point: if you forbid multiedges, then you can reduce further.\n\n\nI will do some timings with reduction. In any case it won't help much, as most of the time is used to check planarity. Doing this closely tied with `planarity.pyx` could do more, maybe.",
    "created_at": "2017-11-15T10:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368869",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:12'></a>
Replying to [dcoudert](#comment%3A10):

> > > - You could add a test for trivial graphs and planar graphs


> > In the code or as a test?


> In the code. When it's trivial or low cost to answer, we should do it.


I added a test for planar graph.

> Are you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.


?? There is `_scream_if_not_simple()` in the code.

> You raise an interesting point: if you forbid multiedges, then you can reduce further.


I will do some timings with reduction. In any case it won't help much, as most of the time is used to check planarity. Doing this closely tied with `planarity.pyx` could do more, maybe.



---

archive/issue_comments_368870.json:
```json
{
    "body": "<a id='comment:13'></a>\nConcerning the reduction steps for vertices of degree 2. Take a K5, double the edges and subdivide them. What's the crossing number ?\nI suspect that reduction steps should be done more carefully...\n\nThis is not correct, right ?\n\n```\nsage: G = graphs.CompleteGraph(5)\nsage: G.allow_multiple_edges(True)\nsage: G.add_edges(G.edges())\nsage: G.subdivide_edges(G.edges(),1)\nsage: G.allow_multiple_edges(False)\nsage: G.crossing_number()\n1\n```",
    "created_at": "2017-11-15T10:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368870",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:13'></a>
Concerning the reduction steps for vertices of degree 2. Take a K5, double the edges and subdivide them. What's the crossing number ?
I suspect that reduction steps should be done more carefully...

This is not correct, right ?

```
sage: G = graphs.CompleteGraph(5)
sage: G.allow_multiple_edges(True)
sage: G.add_edges(G.edges())
sage: G.subdivide_edges(G.edges(),1)
sage: G.allow_multiple_edges(False)
sage: G.crossing_number()
1
```



---

archive/issue_comments_368871.json:
```json
{
    "body": "<a id='comment:14'></a>\nIt the last example you intentionally break things. Same happens with other functons, like\n\n```\nsage: g = Graph({0: [1]})\nsage: g.allow_multiple_edges(True)\nsage: g.subdivide_edges(g.edges(), 1)\nsage: g.allow_multiple_edges(False)\nsage: g.graph6_string()\n'BW'\nsage: g.allow_multiple_edges(True)\nsage: g.graph6_string()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n```",
    "created_at": "2017-11-15T10:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368871",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:14'></a>
It the last example you intentionally break things. Same happens with other functons, like

```
sage: g = Graph({0: [1]})
sage: g.allow_multiple_edges(True)
sage: g.subdivide_edges(g.edges(), 1)
sage: g.allow_multiple_edges(False)
sage: g.graph6_string()
'BW'
sage: g.allow_multiple_edges(True)
sage: g.graph6_string()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
```



---

archive/issue_comments_368872.json:
```json
{
    "body": "<a id='comment:15'></a>\nI'm not breaking things at all. What I wrote is equivalent to:\n\n```\nsage: K5 = graphs.CompleteGraph(5)\nsage: H = Graph()\nsage: H.add_vertices(K5.vertices())\nsage: for u,v in K5.edges(labels=0):\n....:     H.add_path([u,H.add_vertex(),v])\n....:     H.add_path([u,H.add_vertex(),v])\n....:     \nsage: H.is_isomorphic(G)\nTrue\n```",
    "created_at": "2017-11-15T10:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368872",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>
I'm not breaking things at all. What I wrote is equivalent to:

```
sage: K5 = graphs.CompleteGraph(5)
sage: H = Graph()
sage: H.add_vertices(K5.vertices())
sage: for u,v in K5.edges(labels=0):
....:     H.add_path([u,H.add_vertex(),v])
....:     H.add_path([u,H.add_vertex(),v])
....:     
sage: H.is_isomorphic(G)
True
```



---

archive/issue_comments_368873.json:
```json
{
    "body": "<a id='comment:16'></a>\nSorry, my bad. I'll check this.",
    "created_at": "2017-11-15T11:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368873",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:16'></a>
Sorry, my bad. I'll check this.



---

archive/issue_comments_368874.json:
```json
{
    "body": "<a id='comment:17'></a>\nRandom thought: we can allow loops, as they do nothing to the crossing number. We can allow multiedges, as the definition can be applied to those too.\n\nWhat about weighted graphs? We could even support those, but there are at least three definitions: for every crossing we can take smaller weight, bigger weight or sum of both edges, and try to minimize the sum of those.\n\n(A natural use would be a part-relation -diagram where most important relations would be seen as edges with more weight.)",
    "created_at": "2017-11-16T07:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368874",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:17'></a>
Random thought: we can allow loops, as they do nothing to the crossing number. We can allow multiedges, as the definition can be applied to those too.

What about weighted graphs? We could even support those, but there are at least three definitions: for every crossing we can take smaller weight, bigger weight or sum of both edges, and try to minimize the sum of those.

(A natural use would be a part-relation -diagram where most important relations would be seen as edges with more weight.)



---

archive/issue_comments_368875.json:
```json
{
    "body": "<a id='comment:18'></a>\nRight, we can accept loops. For multiple edges, we have to find a way to handle them without excessively increasing the number of subsets to test. For weighted graph, it seems much more complicated, so we could let them for another ticket. Let's first try to have a method working for unweighted graphs.",
    "created_at": "2017-11-16T08:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368875",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'></a>
Right, we can accept loops. For multiple edges, we have to find a way to handle them without excessively increasing the number of subsets to test. For weighted graph, it seems much more complicated, so we could let them for another ticket. Let's first try to have a method working for unweighted graphs.



---

archive/issue_comments_368876.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4\">51fbdba</a></td><td><code>Another optimization, bug correction etc.</code></td></tr></table>\n",
    "created_at": "2017-11-16T09:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4">51fbdba</a></td><td><code>Another optimization, bug correction etc.</code></td></tr></table>




---

archive/issue_comments_368877.json:
```json
{
    "body": "**Changing commit** from \"[8de878c35236cdc359e163f7e9e4838a74b192ad](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)\" to \"[51fbdbaf3f31bde8c25a993928bbe5bed78870c4](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)\".",
    "created_at": "2017-11-16T09:02:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8de878c35236cdc359e163f7e9e4838a74b192ad](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)" to "[51fbdbaf3f31bde8c25a993928bbe5bed78870c4](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)".



---

archive/issue_events_215015.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-16T09:04:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215015"
}
```



---

archive/issue_events_215016.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-16T09:04:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215016"
}
```



---

archive/issue_comments_368878.json:
```json
{
    "body": "<a id='comment:20'></a>\nHere is a code that should work, and has yet another optimization: remove uninteresting cycles, i.e. blocks where only one vertex has degree greater than two.\n\nTimings for some minor optimizations are still to do.",
    "created_at": "2017-11-16T09:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368878",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:20'></a>
Here is a code that should work, and has yet another optimization: remove uninteresting cycles, i.e. blocks where only one vertex has degree greater than two.

Timings for some minor optimizations are still to do.



---

archive/issue_comments_368879.json:
```json
{
    "body": "<a id='comment:21'></a>\nAnd still more thinking: Isn't the crossing number just the sum of crossing numbers of blocks, that we can compute with `blocks_and_cut_vertices()`? And after #24163 there is no need to check non-connected graphs separately.\n\nAfter separating blocks we must only do the optimization of shrinking some edges.",
    "created_at": "2017-11-16T10:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368879",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:21'></a>
And still more thinking: Isn't the crossing number just the sum of crossing numbers of blocks, that we can compute with `blocks_and_cut_vertices()`? And after #24163 there is no need to check non-connected graphs separately.

After separating blocks we must only do the optimization of shrinking some edges.



---

archive/issue_comments_368880.json:
```json
{
    "body": "<a id='comment:22'></a>\nRight, you can consider blocks of size > 4 only.",
    "created_at": "2017-11-16T11:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368880",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'></a>
Right, you can consider blocks of size > 4 only.



---

archive/issue_comments_368881.json:
```json
{
    "body": "**Changing commit** from \"[51fbdbaf3f31bde8c25a993928bbe5bed78870c4](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)\" to \"[7ed0501e8e0a8192f7687300fc732bca7ed1ce26](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)\".",
    "created_at": "2017-11-17T07:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368881",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[51fbdbaf3f31bde8c25a993928bbe5bed78870c4](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)" to "[7ed0501e8e0a8192f7687300fc732bca7ed1ce26](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)".



---

archive/issue_comments_368882.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26\">7ed0501</a></td><td><code>Merge branch 'develop' into crossing_number</code></td></tr></table>\n",
    "created_at": "2017-11-17T07:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368882",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26">7ed0501</a></td><td><code>Merge branch 'develop' into crossing_number</code></td></tr></table>




---

archive/issue_comments_368883.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52\">af2da9e</a></td><td><code>Use blocks_and_cut_vertices().</code></td></tr></table>\n",
    "created_at": "2017-11-17T09:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52">af2da9e</a></td><td><code>Use blocks_and_cut_vertices().</code></td></tr></table>




---

archive/issue_comments_368884.json:
```json
{
    "body": "**Changing commit** from \"[7ed0501e8e0a8192f7687300fc732bca7ed1ce26](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)\" to \"[af2da9ecae0e0bc856ee7e740986d17b7a9a4b52](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)\".",
    "created_at": "2017-11-17T09:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7ed0501e8e0a8192f7687300fc732bca7ed1ce26](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)" to "[af2da9ecae0e0bc856ee7e740986d17b7a9a4b52](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)".



---

archive/issue_comments_368885.json:
```json
{
    "body": "<a id='comment:25'></a>\nI did some timing tests, but did not get noticeable speedup from using `line_graph()` etc. Hence I think this is reade when `blocks_and_cut_vertices` will handle non-connected graphs.\n\nWhen doing this I also broke #24163, got to see how to undo changes... arghs.",
    "created_at": "2017-11-17T09:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368885",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:25'></a>
I did some timing tests, but did not get noticeable speedup from using `line_graph()` etc. Hence I think this is reade when `blocks_and_cut_vertices` will handle non-connected graphs.

When doing this I also broke #24163, got to see how to undo changes... arghs.



---

archive/issue_comments_368886.json:
```json
{
    "body": "<a id='comment:26'></a>\nAs I already said, I would do the following. Indeed, when add an edge between the neighbors of v and then remove v from the graph, you don't change the degree of u and w. So you don't create new vertex of degree 2.\n\n```\n-            while True:\n-                for v in G:\n-                    if G.degree(v) == 2:\n-                        if not G.has_edge(G.neighbors(v)):\n-                            G.add_edge(G.neighbors(v))\n-                            G.delete_vertex(v)\n-                            break\n-                else:\n-                    break\n+            two = [v for v in G if G.degree(v) == 2]\n+            for v in two:\n+                u,w = G.neighbors(v)\n+                if not G.has_edge(u, w):\n+                    G.add_edge(u, w)\n+                    G.delete_vertex(v)\n```\n\nOther modifications are very good and the code is simpler and certainly more efficient now.",
    "created_at": "2017-11-17T13:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368886",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:26'></a>
As I already said, I would do the following. Indeed, when add an edge between the neighbors of v and then remove v from the graph, you don't change the degree of u and w. So you don't create new vertex of degree 2.

```
-            while True:
-                for v in G:
-                    if G.degree(v) == 2:
-                        if not G.has_edge(G.neighbors(v)):
-                            G.add_edge(G.neighbors(v))
-                            G.delete_vertex(v)
-                            break
-                else:
-                    break
+            two = [v for v in G if G.degree(v) == 2]
+            for v in two:
+                u,w = G.neighbors(v)
+                if not G.has_edge(u, w):
+                    G.add_edge(u, w)
+                    G.delete_vertex(v)
```

Other modifications are very good and the code is simpler and certainly more efficient now.



---

archive/issue_comments_368887.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb\">ddf5d27</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2017-11-18T19:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb">ddf5d27</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_comments_368888.json:
```json
{
    "body": "**Changing commit** from \"[af2da9ecae0e0bc856ee7e740986d17b7a9a4b52](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)\" to \"[ddf5d2764a3eae9714160a66716baad611e551cb](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)\".",
    "created_at": "2017-11-18T19:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368888",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[af2da9ecae0e0bc856ee7e740986d17b7a9a4b52](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)" to "[ddf5d2764a3eae9714160a66716baad611e551cb](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)".



---

archive/issue_comments_368889.json:
```json
{
    "body": "**Changing commit** from \"[ddf5d2764a3eae9714160a66716baad611e551cb](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)\" to \"[344798051ecbd2179d472956b844a9679e66e4e1](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)\".",
    "created_at": "2017-11-18T19:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ddf5d2764a3eae9714160a66716baad611e551cb](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)" to "[344798051ecbd2179d472956b844a9679e66e4e1](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)".



---

archive/issue_comments_368890.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1\">3447980</a></td><td><code>Better \"un-edgesplitting\" code.</code></td></tr></table>\n",
    "created_at": "2017-11-18T19:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1">3447980</a></td><td><code>Better "un-edgesplitting" code.</code></td></tr></table>




---

archive/issue_comments_368891.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [dcoudert](#comment%3A26):\n> As I already said, I would do the following. - -\n\n\nI think I tried that and got errors. But now it works and I see no error in the code, so I must have made some trivial copypaste error.\n\nSo, now I just wait until 8.2 or 8.3beta1 to get out, and then put this to need_review-phase.\n\n...Graph thickness would be logical next step.",
    "created_at": "2017-11-19T05:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368891",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:29'></a>
Replying to [dcoudert](#comment%3A26):
> As I already said, I would do the following. - -


I think I tried that and got errors. But now it works and I see no error in the code, so I must have made some trivial copypaste error.

So, now I just wait until 8.2 or 8.3beta1 to get out, and then put this to need_review-phase.

...Graph thickness would be logical next step.



---

archive/issue_comments_368892.json:
```json
{
    "body": "**Changing commit** from \"[344798051ecbd2179d472956b844a9679e66e4e1](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)\" to \"[8b87b5971279186a510ca35342bdb5c4ab7b0367](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)\".",
    "created_at": "2017-12-23T08:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368892",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[344798051ecbd2179d472956b844a9679e66e4e1](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)" to "[8b87b5971279186a510ca35342bdb5c4ab7b0367](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)".



---

archive/issue_comments_368893.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367\">8b87b59</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2017-12-23T08:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367">8b87b59</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_events_215017.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-12-23T10:08:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215017"
}
```



---

archive/issue_events_215018.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-12-23T10:08:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215018"
}
```



---

archive/issue_comments_368894.json:
```json
{
    "body": "<a id='comment:31'></a>\nMerged, pass tests, needs review.",
    "created_at": "2017-12-23T10:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368894",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:31'></a>
Merged, pass tests, needs review.



---

archive/issue_comments_368895.json:
```json
{
    "body": "<a id='comment:32'></a>\nI checked with findstat's values for all graphs of at most 6 vertices.\n\nI am currently checking for which graphs it takes a long time to compute the crossing number.\nFor 6 vertices, only the complete graph takes (much) longer than all the others.\n\nFor 7 vertices, the graph with edges\n\n```\n[(0, 1), (0, 2), (0, 3), (0, 4), (0, 6), (1, 2), (1, 3), (1, 4), (1, 5), (1, 6), (2, 3), (2, 4), (2, 6), (3, 4), (3, 5), (3, 6), (4, 5), (4, 6), (5, 6)]\n```\nseems to be quite bad (it is still computing on this one...)",
    "created_at": "2017-12-25T09:24:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368895",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:32'></a>
I checked with findstat's values for all graphs of at most 6 vertices.

I am currently checking for which graphs it takes a long time to compute the crossing number.
For 6 vertices, only the complete graph takes (much) longer than all the others.

For 7 vertices, the graph with edges

```
[(0, 1), (0, 2), (0, 3), (0, 4), (0, 6), (1, 2), (1, 3), (1, 4), (1, 5), (1, 6), (2, 3), (2, 4), (2, 6), (3, 4), (3, 5), (3, 6), (4, 5), (4, 6), (5, 6)]
```
seems to be quite bad (it is still computing on this one...)



---

archive/issue_comments_368896.json:
```json
{
    "body": "<a id='comment:33'></a>\nFor biconnected graphs with same crossing number the speed should be exponential to the number of edges. As I wrote in the description: \"Implementation is slow and unusable for most graphs - -\".\n\nThis has been proven to be NP-complete. But if you want more speed, try to use automorphisms of the graph.",
    "created_at": "2017-12-25T10:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368896",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:33'></a>
For biconnected graphs with same crossing number the speed should be exponential to the number of edges. As I wrote in the description: "Implementation is slow and unusable for most graphs - -".

This has been proven to be NP-complete. But if you want more speed, try to use automorphisms of the graph.



---

archive/issue_comments_368897.json:
```json
{
    "body": "<a id='comment:34'></a>\nSorry, I should have said first that what I wrote is just a comment, it might or might not be helpful or interesting.  So, from my part `positive review`, but since I am neither an expert in graph theory nor very familiar with sage, I think it's better if someone else does it.\n\nWhat made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).\n\nAlso, removing the edge `(3,6)` from the graph above (still biconnected), the crossing number is computed in almost no time (1.5 seconds), whereas the crossing number of the other graph is still not determined... (according to findstat it should be 5)",
    "created_at": "2017-12-25T10:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368897",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:34'></a>
Sorry, I should have said first that what I wrote is just a comment, it might or might not be helpful or interesting.  So, from my part `positive review`, but since I am neither an expert in graph theory nor very familiar with sage, I think it's better if someone else does it.

What made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).

Also, removing the edge `(3,6)` from the graph above (still biconnected), the crossing number is computed in almost no time (1.5 seconds), whereas the crossing number of the other graph is still not determined... (according to findstat it should be 5)



---

archive/issue_comments_368898.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [mantepse](#comment%3A34):\n\n> What made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).\n\n\nThe crossing number of `K_6` is \"strictly 3\", removing any edge will make it 2. That explains what you noticed.\n\nFor a (biconnected) graph of crossing number `k` the code will check every possibility to add crossing points to have crossing number `k-1`. (And `k-2` and `k-3` etc, but they take so less time that it does not make real difference.) I do not know any other way to check the crossing number **not** being `k-1` than trying all possibilities after using automorphism.\n\nBut it may be that there is a heuristic to find faster a solution for crossing number `k`. Maybe selecting edges so that the distance between their end vertices is so big as possible, or so small as possible, or something else.\n\nSo, there are two possible optimizations to use. They are very different, and each one can be used without the other.",
    "created_at": "2017-12-25T14:22:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368898",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:35'></a>
Replying to [mantepse](#comment%3A34):

> What made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).


The crossing number of `K_6` is "strictly 3", removing any edge will make it 2. That explains what you noticed.

For a (biconnected) graph of crossing number `k` the code will check every possibility to add crossing points to have crossing number `k-1`. (And `k-2` and `k-3` etc, but they take so less time that it does not make real difference.) I do not know any other way to check the crossing number **not** being `k-1` than trying all possibilities after using automorphism.

But it may be that there is a heuristic to find faster a solution for crossing number `k`. Maybe selecting edges so that the distance between their end vertices is so big as possible, or so small as possible, or something else.

So, there are two possible optimizations to use. They are very different, and each one can be used without the other.



---

archive/issue_comments_368899.json:
```json
{
    "body": "<a id='comment:36'></a>\nBtw, here is another paper on topic: http://www.sciencedirect.com/science/article/pii/S1572528607000497",
    "created_at": "2017-12-25T17:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368899",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:36'></a>
Btw, here is another paper on topic: http://www.sciencedirect.com/science/article/pii/S1572528607000497



---

archive/issue_comments_368900.json:
```json
{
    "body": "**Changing commit** from \"[8b87b5971279186a510ca35342bdb5c4ab7b0367](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)\" to \"[6736953723bcfbf724f64bfe6c2e7f5573d0dade](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)\".",
    "created_at": "2018-01-02T06:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8b87b5971279186a510ca35342bdb5c4ab7b0367](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)" to "[6736953723bcfbf724f64bfe6c2e7f5573d0dade](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)".



---

archive/issue_comments_368901.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade\">6736953</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2018-01-02T06:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade">6736953</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_comments_368902.json:
```json
{
    "body": "<a id='comment:38'></a>\nAnyways, I think this can be reviewed now, and we can think about better algorithms later.\n\nI also merged this to the latest beta.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade\">6736953</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2018-01-02T06:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368902",
    "user": "https://github.com/jm58660"
}
```

<a id='comment:38'></a>
Anyways, I think this can be reviewed now, and we can think about better algorithms later.

I also merged this to the latest beta.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade">6736953</a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_comments_368903.json:
```json
{
    "body": "<a id='comment:39'></a>\nThose values I could compute coincide with the ones from findstat, so I'll set it to \"positive review\".",
    "created_at": "2018-01-02T08:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368903",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:39'></a>
Those values I could compute coincide with the ones from findstat, so I'll set it to "positive review".



---

archive/issue_events_215019.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-01-02T08:19:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215019"
}
```



---

archive/issue_events_215020.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-01-02T08:19:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215020"
}
```



---

archive/issue_comments_368904.json:
```json
{
    "body": "<a id='comment:40'></a>\nreviewer's name, please",
    "created_at": "2018-01-03T12:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368904",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:40'></a>
reviewer's name, please



---

archive/issue_comments_368905.json:
```json
{
    "body": "**Reviewer:** Martin Rubey",
    "created_at": "2018-01-03T12:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368905",
    "user": "https://github.com/mantepse"
}
```

**Reviewer:** Martin Rubey



---

archive/issue_comments_368906.json:
```json
{
    "body": "<a id='comment:42'></a>\nSorry for not helping finalizing the review. I was away from email for a few days.\nI'm fine with the ticket. Thank you.",
    "created_at": "2018-01-04T12:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368906",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:42'></a>
Sorry for not helping finalizing the review. I was away from email for a few days.
I'm fine with the ticket. Thank you.



---

archive/issue_comments_368907.json:
```json
{
    "body": "**Changing branch** from \"[u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)\" to \"[6736953723bcfbf724f64bfe6c2e7f5573d0dade](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)\".",
    "created_at": "2018-01-05T23:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24216#issuecomment-368907",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)" to "[6736953723bcfbf724f64bfe6c2e7f5573d0dade](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)".



---

archive/issue_events_215021.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-05T23:56:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215021"
}
```



---

archive/issue_events_215022.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-05T23:56:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24216",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24216#event-215022"
}
```
