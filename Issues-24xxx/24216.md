# Issue 24216: Add crossing number of a graph

archive/issues_023979.json:
```json
{
    "assignees": [],
    "body": "This patch adds a function to compute the crossing number of a graph.\n\nImplementation is slow and unusable for most graphs, but then, so is `genus()` already. And it is easier to make better code when we have any reference code to compare results.\n\nCC:  @dcoudert\n\nBranch/Commit: **[`6736953`](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)**\n\nReviewer: **Martin Rubey**\n\nAuthor: **Jori M\u00e4ntysalo**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24216_\n\n",
    "closed_at": "2018-01-05T23:56:21Z",
    "created_at": "2017-11-14T13:16:54Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add crossing number of a graph",
    "type": "issue",
    "updated_at": "2018-01-05T23:56:21Z",
    "url": "https://github.com/sagemath/sage/issues/24216",
    "user": "https://github.com/jm58660"
}
```
This patch adds a function to compute the crossing number of a graph.

Implementation is slow and unusable for most graphs, but then, so is `genus()` already. And it is easier to make better code when we have any reference code to compare results.

CC:  @dcoudert

Branch/Commit: **[`6736953`](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)**

Reviewer: **Martin Rubey**

Author: **Jori MÃ¤ntysalo**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/24216_





---

archive/issue_events_335942.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-14T13:16:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335942"
}
```



---

archive/issue_events_335943.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-14T13:16:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335943"
}
```



---

archive/issue_events_335944.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-14T13:16:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335944"
}
```



---

archive/issue_events_335945.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-14T13:16:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335945"
}
```



---

archive/issue_comments_366354.json:
```json
{
    "body": "Branch: **[u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)**",
    "created_at": "2017-11-14T13:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366354",
    "user": "https://github.com/jm58660"
}
```

Branch: **[u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)**



---

archive/issue_comments_366355.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc\"><code>c2773a6</code></a></td><td><code>Add crossing number.</code></td></tr></table>\n",
    "created_at": "2017-11-14T13:17:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366355",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc"><code>c2773a6</code></a></td><td><code>Add crossing number.</code></td></tr></table>




---

archive/issue_events_335946.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-14T13:17:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335946"
}
```



---

archive/issue_comments_366356.json:
```json
{
    "body": "Commit: **[`c2773a6`](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)**",
    "created_at": "2017-11-14T13:17:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366356",
    "user": "https://github.com/jm58660"
}
```

Commit: **[`c2773a6`](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)**



---

archive/issue_comments_366357.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nHi Joris!\n\nI suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.",
    "created_at": "2017-11-14T13:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366357",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:3" align="right">comment:3</div>

Hi Joris!

I suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.



---

archive/issue_comments_366358.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@mantepse](#comment:3):\n\n> I suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.\n\nSo we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.",
    "created_at": "2017-11-14T13:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366358",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@mantepse](#comment:3):

> I suspect that this is http://www.findstat.org/StatisticsDatabase/St000323, right?  If so, you might want to contact Markus Chimani.

So we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.



---

archive/issue_comments_366359.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nHello,\n\nI agree that your code do the job and is not optimized. \n\n- This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.\n\n- You could add a test for trivial graphs and planar graphs\n\n- You can do better for degree 1 vertices since you want to keep the 1-core\n\n```\none = self.cores(k=1)[0]\nif one:\n    G = Graph(self.edges())\n    G.delete_vertices(one)\nelse:\n    G = self\n```\n- For degree 2, it's easier\n\n```\ntwo = [u for u in G if G.degree(u) == 2]\nif two:\n    if G is self:\n        G = self.copy()\n    for u in two:\n        v,w = G.neighbors(u)\n        G.add_edge(v, w)\n    G.delete_vertex(u)\n```\n\n- I realize that your `edgepairs` are in fact (but this might be slower to produce. Don't know): \n\n```\nedgepairs = [Set(e) for e in G.line_graph(labels=0).complement().edge_iterator(labels=0)]\n```\n\n- for the while loop, I don't see how to make it faster.",
    "created_at": "2017-11-14T19:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366359",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:5" align="right">comment:5</div>

Hello,

I agree that your code do the job and is not optimized. 

- This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.

- You could add a test for trivial graphs and planar graphs

- You can do better for degree 1 vertices since you want to keep the 1-core

```
one = self.cores(k=1)[0]
if one:
    G = Graph(self.edges())
    G.delete_vertices(one)
else:
    G = self
```
- For degree 2, it's easier

```
two = [u for u in G if G.degree(u) == 2]
if two:
    if G is self:
        G = self.copy()
    for u in two:
        v,w = G.neighbors(u)
        G.add_edge(v, w)
    G.delete_vertex(u)
```

- I realize that your `edgepairs` are in fact (but this might be slower to produce. Don't know): 

```
edgepairs = [Set(e) for e in G.line_graph(labels=0).complement().edge_iterator(labels=0)]
```

- for the while loop, I don't see how to make it faster.



---

archive/issue_comments_366360.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> So we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.\n\nIt's for graphs with pathwidth 3. Not sure it's easy to implement or fast...\n\nThis paper [Computing crossing number in linear time](https://dl.acm.org/citation.cfm?id=1250848) is promising. I don't know if it has already been implemented .\n\nAn ILP formulation could also be a good addition (for another ticket).",
    "created_at": "2017-11-14T19:52:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366360",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

> So we could implement https://arxiv.org/pdf/1612.03854.pdf, maybe. Maybe I take a look of those later, but for now I think that this code could be a little useful addition.

It's for graphs with pathwidth 3. Not sure it's easy to implement or fast...

This paper [Computing crossing number in linear time](https://dl.acm.org/citation.cfm?id=1250848) is promising. I don't know if it has already been implemented .

An ILP formulation could also be a good addition (for another ticket).



---

archive/issue_comments_366361.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@dcoudert](#comment:5):\n> Hello,\n> \n> I agree that your code do the job and is not optimized. \n> \n> - This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.\n\nThere can be good reason to add a comment to a single line like that in a doctest where a full description is not ideal. So I would not say it is not a good idea (in general), although the latter is more common. However, in this case, I do think it better to have\n\n```\nCheck for a planar graph::\n\n    sage: C4 = graphs.CompleteGraph(4)\n    sage: C4.crossing_number()\n    0\n```",
    "created_at": "2017-11-15T02:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366361",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@dcoudert](#comment:5):
> Hello,
> 
> I agree that your code do the job and is not optimized. 
> 
> - This is not a good idea to use `sage: C4 = graphs.CompleteGraph(4) # Planar` as the `# blah` are often used for special treatments, e.g., `# long time` or `# optional - bliss`. It's more usual to have a full sentence before the test.

There can be good reason to add a comment to a single line like that in a doctest where a full description is not ideal. So I would not say it is not a good idea (in general), although the latter is more common. However, in this case, I do think it better to have

```
Check for a planar graph::

    sage: C4 = graphs.CompleteGraph(4)
    sage: C4.crossing_number()
    0
```



---

archive/issue_comments_366362.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83\"><code>669bb34</code></a></td><td><code>Reformat tests-block.</code></td></tr></table>\n",
    "created_at": "2017-11-15T05:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366362",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83"><code>669bb34</code></a></td><td><code>Reformat tests-block.</code></td></tr></table>




---

archive/issue_comments_366363.json:
```json
{
    "body": "Changed commit from **[`c2773a6`](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)** to **[`669bb34`](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)**",
    "created_at": "2017-11-15T05:26:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366363",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c2773a6`](https://github.com/sagemath/sagetrac-mirror/commit/c2773a69229f4f658abccf697caf313aef0c84bc)** to **[`669bb34`](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)**



---

archive/issue_comments_366364.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@dcoudert](#comment:5):\n\nI modified `TESTS` and will do more changes. Two questions:\n\n> - You could add a test for trivial graphs and planar graphs\n\nIn the code or as a test?\n\n> - For degree 2, it's easier\n\nBut for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.\n\n(What we could do is to use automorphisms, but maybe it's not worth doing now.)",
    "created_at": "2017-11-15T05:50:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366364",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@dcoudert](#comment:5):

I modified `TESTS` and will do more changes. Two questions:

> - You could add a test for trivial graphs and planar graphs

In the code or as a test?

> - For degree 2, it's easier

But for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.

(What we could do is to use automorphisms, but maybe it's not worth doing now.)



---

archive/issue_comments_366365.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jm58660](#comment:9):\n> Replying to [@dcoudert](#comment:5):\n> \n> I modified `TESTS` and will do more changes. Two questions:\n> \n> > - You could add a test for trivial graphs and planar graphs\n\n> \n> In the code or as a test?\n\nIn the code. When it's trivial or low cost to answer, we should do it.\n\n> > - For degree 2, it's easier\n\n> \n> But for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.\n\nAre you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.\n\nYou raise an interesting point: if you forbid multiedges, then you can reduce further.\n\nThe preprocessing could be\n\n```\ntwo = {u for u in G if G.degree(u) == 2}\nwhile two:\nif two and G is self:\n    G = self.copy()\nwhile two:\n    u = two.pop()\n    if G.degree(u) < 2:\n        if G.degree(u) == 1:\n            two.add(next(G.neighbor_iterator(u)))\n        G.delete_vertex(u)\n        continue\n    v,w = G.neighbors(u)\n    G.add_edge(v, w)\n    G.delete_vertex(u)\n    if G.degree(v) <= 2:\n        two.add(v)\n    if G.degree(w) <= 2:\n        two.add(w)\n```",
    "created_at": "2017-11-15T08:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366365",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jm58660](#comment:9):
> Replying to [@dcoudert](#comment:5):
> 
> I modified `TESTS` and will do more changes. Two questions:
> 
> > - You could add a test for trivial graphs and planar graphs

> 
> In the code or as a test?

In the code. When it's trivial or low cost to answer, we should do it.

> > - For degree 2, it's easier

> 
> But for example `Graph('FhEK_')` will be reduced to the empty graph with iterative process.

Are you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.

You raise an interesting point: if you forbid multiedges, then you can reduce further.

The preprocessing could be

```
two = {u for u in G if G.degree(u) == 2}
while two:
if two and G is self:
    G = self.copy()
while two:
    u = two.pop()
    if G.degree(u) < 2:
        if G.degree(u) == 1:
            two.add(next(G.neighbor_iterator(u)))
        G.delete_vertex(u)
        continue
    v,w = G.neighbors(u)
    G.add_edge(v, w)
    G.delete_vertex(u)
    if G.degree(v) <= 2:
        two.add(v)
    if G.degree(w) <= 2:
        two.add(w)
```



---

archive/issue_comments_366366.json:
```json
{
    "body": "Changed commit from **[`669bb34`](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)** to **[`8de878c`](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)**",
    "created_at": "2017-11-15T10:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`669bb34`](https://github.com/sagemath/sagetrac-mirror/commit/669bb34dff3f87b76dfb42bd2c1032a450f1ff83)** to **[`8de878c`](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)**



---

archive/issue_comments_366367.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad\"><code>8de878c</code></a></td><td><code>Shortcut for planar graphs.</code></td></tr></table>\n",
    "created_at": "2017-11-15T10:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366367",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad"><code>8de878c</code></a></td><td><code>Shortcut for planar graphs.</code></td></tr></table>




---

archive/issue_comments_366368.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@dcoudert](#comment:10):\n\n> > > - You could add a test for trivial graphs and planar graphs\n\n> > In the code or as a test?\n\n> In the code. When it's trivial or low cost to answer, we should do it.\n\nI added a test for planar graph.\n\n> Are you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.\n\n?? There is `_scream_if_not_simple()` in the code.\n\n> You raise an interesting point: if you forbid multiedges, then you can reduce further.\n\nI will do some timings with reduction. In any case it won't help much, as most of the time is used to check planarity. Doing this closely tied with `planarity.pyx` could do more, maybe.",
    "created_at": "2017-11-15T10:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366368",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@dcoudert](#comment:10):

> > > - You could add a test for trivial graphs and planar graphs

> > In the code or as a test?

> In the code. When it's trivial or low cost to answer, we should do it.

I added a test for planar graph.

> Are you sure of that ? since you allow multiple edges, you will get a triple edge and no further reduction.

?? There is `_scream_if_not_simple()` in the code.

> You raise an interesting point: if you forbid multiedges, then you can reduce further.

I will do some timings with reduction. In any case it won't help much, as most of the time is used to check planarity. Doing this closely tied with `planarity.pyx` could do more, maybe.



---

archive/issue_comments_366369.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nConcerning the reduction steps for vertices of degree 2. Take a K5, double the edges and subdivide them. What's the crossing number ?\nI suspect that reduction steps should be done more carefully...\n\nThis is not correct, right ?\n\n```\nsage: G = graphs.CompleteGraph(5)\nsage: G.allow_multiple_edges(True)\nsage: G.add_edges(G.edges())\nsage: G.subdivide_edges(G.edges(),1)\nsage: G.allow_multiple_edges(False)\nsage: G.crossing_number()\n1\n```",
    "created_at": "2017-11-15T10:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366369",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:13" align="right">comment:13</div>

Concerning the reduction steps for vertices of degree 2. Take a K5, double the edges and subdivide them. What's the crossing number ?
I suspect that reduction steps should be done more carefully...

This is not correct, right ?

```
sage: G = graphs.CompleteGraph(5)
sage: G.allow_multiple_edges(True)
sage: G.add_edges(G.edges())
sage: G.subdivide_edges(G.edges(),1)
sage: G.allow_multiple_edges(False)
sage: G.crossing_number()
1
```



---

archive/issue_comments_366370.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIt the last example you intentionally break things. Same happens with other functons, like\n\n```\nsage: g = Graph({0: [1]})\nsage: g.allow_multiple_edges(True)\nsage: g.subdivide_edges(g.edges(), 1)\nsage: g.allow_multiple_edges(False)\nsage: g.graph6_string()\n'BW'\nsage: g.allow_multiple_edges(True)\nsage: g.graph6_string()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n```",
    "created_at": "2017-11-15T10:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366370",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:14" align="right">comment:14</div>

It the last example you intentionally break things. Same happens with other functons, like

```
sage: g = Graph({0: [1]})
sage: g.allow_multiple_edges(True)
sage: g.subdivide_edges(g.edges(), 1)
sage: g.allow_multiple_edges(False)
sage: g.graph6_string()
'BW'
sage: g.allow_multiple_edges(True)
sage: g.graph6_string()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
```



---

archive/issue_comments_366371.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI'm not breaking things at all. What I wrote is equivalent to:\n\n```\nsage: K5 = graphs.CompleteGraph(5)\nsage: H = Graph()\nsage: H.add_vertices(K5.vertices())\nsage: for u,v in K5.edges(labels=0):\n....:     H.add_path([u,H.add_vertex(),v])\n....:     H.add_path([u,H.add_vertex(),v])\n....:     \nsage: H.is_isomorphic(G)\nTrue\n```",
    "created_at": "2017-11-15T10:42:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366371",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">comment:15</div>

I'm not breaking things at all. What I wrote is equivalent to:

```
sage: K5 = graphs.CompleteGraph(5)
sage: H = Graph()
sage: H.add_vertices(K5.vertices())
sage: for u,v in K5.edges(labels=0):
....:     H.add_path([u,H.add_vertex(),v])
....:     H.add_path([u,H.add_vertex(),v])
....:     
sage: H.is_isomorphic(G)
True
```



---

archive/issue_comments_366372.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSorry, my bad. I'll check this.",
    "created_at": "2017-11-15T11:27:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366372",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:16" align="right">comment:16</div>

Sorry, my bad. I'll check this.



---

archive/issue_comments_366373.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRandom thought: we can allow loops, as they do nothing to the crossing number. We can allow multiedges, as the definition can be applied to those too.\n\nWhat about weighted graphs? We could even support those, but there are at least three definitions: for every crossing we can take smaller weight, bigger weight or sum of both edges, and try to minimize the sum of those.\n\n(A natural use would be a part-relation -diagram where most important relations would be seen as edges with more weight.)",
    "created_at": "2017-11-16T07:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366373",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:17" align="right">comment:17</div>

Random thought: we can allow loops, as they do nothing to the crossing number. We can allow multiedges, as the definition can be applied to those too.

What about weighted graphs? We could even support those, but there are at least three definitions: for every crossing we can take smaller weight, bigger weight or sum of both edges, and try to minimize the sum of those.

(A natural use would be a part-relation -diagram where most important relations would be seen as edges with more weight.)



---

archive/issue_comments_366374.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nRight, we can accept loops. For multiple edges, we have to find a way to handle them without excessively increasing the number of subsets to test. For weighted graph, it seems much more complicated, so we could let them for another ticket. Let's first try to have a method working for unweighted graphs.",
    "created_at": "2017-11-16T08:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366374",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:18" align="right">comment:18</div>

Right, we can accept loops. For multiple edges, we have to find a way to handle them without excessively increasing the number of subsets to test. For weighted graph, it seems much more complicated, so we could let them for another ticket. Let's first try to have a method working for unweighted graphs.



---

archive/issue_comments_366375.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4\"><code>51fbdba</code></a></td><td><code>Another optimization, bug correction etc.</code></td></tr></table>\n",
    "created_at": "2017-11-16T09:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366375",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4"><code>51fbdba</code></a></td><td><code>Another optimization, bug correction etc.</code></td></tr></table>




---

archive/issue_comments_366376.json:
```json
{
    "body": "Changed commit from **[`8de878c`](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)** to **[`51fbdba`](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)**",
    "created_at": "2017-11-16T09:02:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366376",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8de878c`](https://github.com/sagemath/sagetrac-mirror/commit/8de878c35236cdc359e163f7e9e4838a74b192ad)** to **[`51fbdba`](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)**



---

archive/issue_events_335947.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-16T09:04:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335947"
}
```



---

archive/issue_events_335948.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-11-16T09:04:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335948"
}
```



---

archive/issue_comments_366377.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHere is a code that should work, and has yet another optimization: remove uninteresting cycles, i.e. blocks where only one vertex has degree greater than two.\n\nTimings for some minor optimizations are still to do.",
    "created_at": "2017-11-16T09:04:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366377",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:20" align="right">comment:20</div>

Here is a code that should work, and has yet another optimization: remove uninteresting cycles, i.e. blocks where only one vertex has degree greater than two.

Timings for some minor optimizations are still to do.



---

archive/issue_comments_366378.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAnd still more thinking: Isn't the crossing number just the sum of crossing numbers of blocks, that we can compute with `blocks_and_cut_vertices()`? And after #24163 there is no need to check non-connected graphs separately.\n\nAfter separating blocks we must only do the optimization of shrinking some edges.",
    "created_at": "2017-11-16T10:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366378",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:21" align="right">comment:21</div>

And still more thinking: Isn't the crossing number just the sum of crossing numbers of blocks, that we can compute with `blocks_and_cut_vertices()`? And after #24163 there is no need to check non-connected graphs separately.

After separating blocks we must only do the optimization of shrinking some edges.



---

archive/issue_comments_366379.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nRight, you can consider blocks of size > 4 only.",
    "created_at": "2017-11-16T11:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366379",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:22" align="right">comment:22</div>

Right, you can consider blocks of size > 4 only.



---

archive/issue_comments_366380.json:
```json
{
    "body": "Changed commit from **[`51fbdba`](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)** to **[`7ed0501`](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)**",
    "created_at": "2017-11-17T07:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366380",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`51fbdba`](https://github.com/sagemath/sagetrac-mirror/commit/51fbdbaf3f31bde8c25a993928bbe5bed78870c4)** to **[`7ed0501`](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)**



---

archive/issue_comments_366381.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26\"><code>7ed0501</code></a></td><td><code>Merge branch 'develop' into crossing_number</code></td></tr></table>\n",
    "created_at": "2017-11-17T07:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366381",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26"><code>7ed0501</code></a></td><td><code>Merge branch 'develop' into crossing_number</code></td></tr></table>




---

archive/issue_comments_366382.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52\"><code>af2da9e</code></a></td><td><code>Use blocks_and_cut_vertices().</code></td></tr></table>\n",
    "created_at": "2017-11-17T09:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366382",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52"><code>af2da9e</code></a></td><td><code>Use blocks_and_cut_vertices().</code></td></tr></table>




---

archive/issue_comments_366383.json:
```json
{
    "body": "Changed commit from **[`7ed0501`](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)** to **[`af2da9e`](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)**",
    "created_at": "2017-11-17T09:13:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366383",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7ed0501`](https://github.com/sagemath/sagetrac-mirror/commit/7ed0501e8e0a8192f7687300fc732bca7ed1ce26)** to **[`af2da9e`](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)**



---

archive/issue_comments_366384.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI did some timing tests, but did not get noticeable speedup from using `line_graph()` etc. Hence I think this is reade when `blocks_and_cut_vertices` will handle non-connected graphs.\n\nWhen doing this I also broke #24163, got to see how to undo changes... arghs.",
    "created_at": "2017-11-17T09:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366384",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:25" align="right">comment:25</div>

I did some timing tests, but did not get noticeable speedup from using `line_graph()` etc. Hence I think this is reade when `blocks_and_cut_vertices` will handle non-connected graphs.

When doing this I also broke #24163, got to see how to undo changes... arghs.



---

archive/issue_comments_366385.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAs I already said, I would do the following. Indeed, when add an edge between the neighbors of v and then remove v from the graph, you don't change the degree of u and w. So you don't create new vertex of degree 2.\n\n```\n-            while True:\n-                for v in G:\n-                    if G.degree(v) == 2:\n-                        if not G.has_edge(G.neighbors(v)):\n-                            G.add_edge(G.neighbors(v))\n-                            G.delete_vertex(v)\n-                            break\n-                else:\n-                    break\n+            two = [v for v in G if G.degree(v) == 2]\n+            for v in two:\n+                u,w = G.neighbors(v)\n+                if not G.has_edge(u, w):\n+                    G.add_edge(u, w)\n+                    G.delete_vertex(v)\n```\n\nOther modifications are very good and the code is simpler and certainly more efficient now.",
    "created_at": "2017-11-17T13:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366385",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:26" align="right">comment:26</div>

As I already said, I would do the following. Indeed, when add an edge between the neighbors of v and then remove v from the graph, you don't change the degree of u and w. So you don't create new vertex of degree 2.

```
-            while True:
-                for v in G:
-                    if G.degree(v) == 2:
-                        if not G.has_edge(G.neighbors(v)):
-                            G.add_edge(G.neighbors(v))
-                            G.delete_vertex(v)
-                            break
-                else:
-                    break
+            two = [v for v in G if G.degree(v) == 2]
+            for v in two:
+                u,w = G.neighbors(v)
+                if not G.has_edge(u, w):
+                    G.add_edge(u, w)
+                    G.delete_vertex(v)
```

Other modifications are very good and the code is simpler and certainly more efficient now.



---

archive/issue_comments_366386.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb\"><code>ddf5d27</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2017-11-18T19:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366386",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb"><code>ddf5d27</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_comments_366387.json:
```json
{
    "body": "Changed commit from **[`af2da9e`](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)** to **[`ddf5d27`](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)**",
    "created_at": "2017-11-18T19:54:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366387",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`af2da9e`](https://github.com/sagemath/sagetrac-mirror/commit/af2da9ecae0e0bc856ee7e740986d17b7a9a4b52)** to **[`ddf5d27`](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)**



---

archive/issue_comments_366388.json:
```json
{
    "body": "Changed commit from **[`ddf5d27`](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)** to **[`3447980`](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)**",
    "created_at": "2017-11-18T19:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366388",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ddf5d27`](https://github.com/sagemath/sagetrac-mirror/commit/ddf5d2764a3eae9714160a66716baad611e551cb)** to **[`3447980`](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)**



---

archive/issue_comments_366389.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1\"><code>3447980</code></a></td><td><code>Better \"un-edgesplitting\" code.</code></td></tr></table>\n",
    "created_at": "2017-11-18T19:58:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366389",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1"><code>3447980</code></a></td><td><code>Better "un-edgesplitting" code.</code></td></tr></table>




---

archive/issue_comments_366390.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@dcoudert](#comment:26):\n> As I already said, I would do the following. - -\n\nI think I tried that and got errors. But now it works and I see no error in the code, so I must have made some trivial copypaste error.\n\nSo, now I just wait until 8.2 or 8.3beta1 to get out, and then put this to need_review-phase.\n\n...Graph thickness would be logical next step.",
    "created_at": "2017-11-19T05:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366390",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@dcoudert](#comment:26):
> As I already said, I would do the following. - -

I think I tried that and got errors. But now it works and I see no error in the code, so I must have made some trivial copypaste error.

So, now I just wait until 8.2 or 8.3beta1 to get out, and then put this to need_review-phase.

...Graph thickness would be logical next step.



---

archive/issue_comments_366391.json:
```json
{
    "body": "Changed commit from **[`3447980`](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)** to **[`8b87b59`](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)**",
    "created_at": "2017-12-23T08:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366391",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3447980`](https://github.com/sagemath/sagetrac-mirror/commit/344798051ecbd2179d472956b844a9679e66e4e1)** to **[`8b87b59`](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)**



---

archive/issue_comments_366392.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367\"><code>8b87b59</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2017-12-23T08:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366392",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367"><code>8b87b59</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_events_335949.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-12-23T10:08:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335949"
}
```



---

archive/issue_events_335950.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2017-12-23T10:08:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335950"
}
```



---

archive/issue_comments_366393.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nMerged, pass tests, needs review.",
    "created_at": "2017-12-23T10:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366393",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:31" align="right">comment:31</div>

Merged, pass tests, needs review.



---

archive/issue_comments_366394.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI checked with findstat's values for all graphs of at most 6 vertices.\n\nI am currently checking for which graphs it takes a long time to compute the crossing number.\nFor 6 vertices, only the complete graph takes (much) longer than all the others.\n\nFor 7 vertices, the graph with edges\n\n```\n[(0, 1), (0, 2), (0, 3), (0, 4), (0, 6), (1, 2), (1, 3), (1, 4), (1, 5), (1, 6), (2, 3), (2, 4), (2, 6), (3, 4), (3, 5), (3, 6), (4, 5), (4, 6), (5, 6)]\n```\nseems to be quite bad (it is still computing on this one...)",
    "created_at": "2017-12-25T09:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366394",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:32" align="right">comment:32</div>

I checked with findstat's values for all graphs of at most 6 vertices.

I am currently checking for which graphs it takes a long time to compute the crossing number.
For 6 vertices, only the complete graph takes (much) longer than all the others.

For 7 vertices, the graph with edges

```
[(0, 1), (0, 2), (0, 3), (0, 4), (0, 6), (1, 2), (1, 3), (1, 4), (1, 5), (1, 6), (2, 3), (2, 4), (2, 6), (3, 4), (3, 5), (3, 6), (4, 5), (4, 6), (5, 6)]
```
seems to be quite bad (it is still computing on this one...)



---

archive/issue_comments_366395.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nFor biconnected graphs with same crossing number the speed should be exponential to the number of edges. As I wrote in the description: \"Implementation is slow and unusable for most graphs - -\".\n\nThis has been proven to be NP-complete. But if you want more speed, try to use automorphisms of the graph.",
    "created_at": "2017-12-25T10:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366395",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:33" align="right">comment:33</div>

For biconnected graphs with same crossing number the speed should be exponential to the number of edges. As I wrote in the description: "Implementation is slow and unusable for most graphs - -".

This has been proven to be NP-complete. But if you want more speed, try to use automorphisms of the graph.



---

archive/issue_comments_366396.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nSorry, I should have said first that what I wrote is just a comment, it might or might not be helpful or interesting.  So, from my part `positive review`, but since I am neither an expert in graph theory nor very familiar with sage, I think it's better if someone else does it.\n\nWhat made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).\n\nAlso, removing the edge `(3,6)` from the graph above (still biconnected), the crossing number is computed in almost no time (1.5 seconds), whereas the crossing number of the other graph is still not determined... (according to findstat it should be 5)",
    "created_at": "2017-12-25T10:49:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366396",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:34" align="right">comment:34</div>

Sorry, I should have said first that what I wrote is just a comment, it might or might not be helpful or interesting.  So, from my part `positive review`, but since I am neither an expert in graph theory nor very familiar with sage, I think it's better if someone else does it.

What made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).

Also, removing the edge `(3,6)` from the graph above (still biconnected), the crossing number is computed in almost no time (1.5 seconds), whereas the crossing number of the other graph is still not determined... (according to findstat it should be 5)



---

archive/issue_comments_366397.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mantepse](#comment:34):\n\n> What made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).\n\nThe crossing number of `K_6` is \"strictly 3\", removing any edge will make it 2. That explains what you noticed.\n\nFor a (biconnected) graph of crossing number `k` the code will check every possibility to add crossing points to have crossing number `k-1`. (And `k-2` and `k-3` etc, but they take so less time that it does not make real difference.) I do not know any other way to check the crossing number **not** being `k-1` than trying all possibilities after using automorphism.\n\nBut it may be that there is a heuristic to find faster a solution for crossing number `k`. Maybe selecting edges so that the distance between their end vertices is so big as possible, or so small as possible, or something else.\n\nSo, there are two possible optimizations to use. They are very different, and each one can be used without the other.",
    "created_at": "2017-12-25T14:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366397",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mantepse](#comment:34):

> What made me curious is that for 6 vertices, there are 112 connected graphs, and only the complete graph needs more time (25 times longer than the second worst).

The crossing number of `K_6` is "strictly 3", removing any edge will make it 2. That explains what you noticed.

For a (biconnected) graph of crossing number `k` the code will check every possibility to add crossing points to have crossing number `k-1`. (And `k-2` and `k-3` etc, but they take so less time that it does not make real difference.) I do not know any other way to check the crossing number **not** being `k-1` than trying all possibilities after using automorphism.

But it may be that there is a heuristic to find faster a solution for crossing number `k`. Maybe selecting edges so that the distance between their end vertices is so big as possible, or so small as possible, or something else.

So, there are two possible optimizations to use. They are very different, and each one can be used without the other.



---

archive/issue_comments_366398.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nBtw, here is another paper on topic: http://www.sciencedirect.com/science/article/pii/S1572528607000497",
    "created_at": "2017-12-25T17:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366398",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:36" align="right">comment:36</div>

Btw, here is another paper on topic: http://www.sciencedirect.com/science/article/pii/S1572528607000497



---

archive/issue_comments_366399.json:
```json
{
    "body": "Changed commit from **[`8b87b59`](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)** to **[`6736953`](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)**",
    "created_at": "2018-01-02T06:40:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366399",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8b87b59`](https://github.com/sagemath/sagetrac-mirror/commit/8b87b5971279186a510ca35342bdb5c4ab7b0367)** to **[`6736953`](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)**



---

archive/issue_comments_366400.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade\"><code>6736953</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2018-01-02T06:40:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366400",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade"><code>6736953</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_comments_366401.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nAnyways, I think this can be reviewed now, and we can think about better algorithms later.\n\nI also merged this to the latest beta.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade\"><code>6736953</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>\n",
    "created_at": "2018-01-02T06:45:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366401",
    "user": "https://github.com/jm58660"
}
```

<div id="comment:38" align="right">comment:38</div>

Anyways, I think this can be reviewed now, and we can think about better algorithms later.

I also merged this to the latest beta.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade"><code>6736953</code></a></td><td><code>Merge branch 'develop' into t/24216/crossing_number</code></td></tr></table>




---

archive/issue_comments_366402.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThose values I could compute coincide with the ones from findstat, so I'll set it to \"positive review\".",
    "created_at": "2018-01-02T08:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366402",
    "user": "https://github.com/mantepse"
}
```

<div id="comment:39" align="right">comment:39</div>

Those values I could compute coincide with the ones from findstat, so I'll set it to "positive review".



---

archive/issue_events_335951.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-01-02T08:19:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335951"
}
```



---

archive/issue_events_335952.json:
```json
{
    "actor": "https://github.com/mantepse",
    "created_at": "2018-01-02T08:19:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335952"
}
```



---

archive/issue_comments_366403.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nreviewer's name, please",
    "created_at": "2018-01-03T12:36:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366403",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:40" align="right">comment:40</div>

reviewer's name, please



---

archive/issue_comments_366404.json:
```json
{
    "body": "Reviewer: **Martin Rubey**",
    "created_at": "2018-01-03T12:54:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366404",
    "user": "https://github.com/mantepse"
}
```

Reviewer: **Martin Rubey**



---

archive/issue_comments_366405.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nSorry for not helping finalizing the review. I was away from email for a few days.\nI'm fine with the ticket. Thank you.",
    "created_at": "2018-01-04T12:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366405",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:42" align="right">comment:42</div>

Sorry for not helping finalizing the review. I was away from email for a few days.
I'm fine with the ticket. Thank you.



---

archive/issue_comments_366406.json:
```json
{
    "body": "Changed branch from **[u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)** to **[`6736953`](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)**",
    "created_at": "2018-01-05T23:56:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24216#issuecomment-366406",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jmantysalo/crossing_number](https://github.com/sagemath/sagetrac-mirror/tree/u/jmantysalo/crossing_number)** to **[`6736953`](https://github.com/sagemath/sagetrac-mirror/commit/6736953723bcfbf724f64bfe6c2e7f5573d0dade)**



---

archive/issue_events_335953.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-05T23:56:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335953"
}
```



---

archive/issue_events_335954.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e2b50f15d274446852d852e02984409520b9eece",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-05T23:56:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24216",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24216#event-335954"
}
```
