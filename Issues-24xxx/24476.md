# Issue 24476: Support downloading of symlinked tarballs

archive/issues_024239.json:
```json
{
    "body": "#12426 introduces a new package \"gfortran\" which reuses the gcc tarball. This is done by symlinking various files in `build/pkgs/gfortran` to `build/pkgs/gcc`. This confuses the tarball downloader, so we add support for such symlinks in `sage_bootstrap`.\n\nCC:  @embray @vbraun @kiwifb\n\nBranch/Commit: 5b8e8ddf7a67bd062fa67c89d2b140b4846549d4\n\nReviewer: Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24476\n\n",
    "closed_at": "2018-01-14T10:14:17Z",
    "created_at": "2018-01-05T13:55:12Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Support downloading of symlinked tarballs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24476",
    "user": "https://github.com/jdemeyer"
}
```
#12426 introduces a new package "gfortran" which reuses the gcc tarball. This is done by symlinking various files in `build/pkgs/gfortran` to `build/pkgs/gcc`. This confuses the tarball downloader, so we add support for such symlinks in `sage_bootstrap`.

CC:  @embray @vbraun @kiwifb

Branch/Commit: 5b8e8ddf7a67bd062fa67c89d2b140b4846549d4

Reviewer: Dima Pasechnik

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24476





---

archive/issue_events_078084.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "rename": {
        "from": "Properly download symlinked tarballs",
        "to": "Support downloading of symlinked tarballs"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24476#event-78084"
}
```



---

archive/issue_comments_457355.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/support_downloading_of_symlinked_tarballs\"",
    "created_at": "2018-01-05T14:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457355",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/support_downloading_of_symlinked_tarballs"



---

archive/issue_comments_457356.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[5b8e8dd](https://github.com/sagemath/sagetrac-mirror/commit/5b8e8ddf7a67bd062fa67c89d2b140b4846549d4)|`Support downloading of symlinked tarballs`|",
    "created_at": "2018-01-05T14:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457356",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[5b8e8dd](https://github.com/sagemath/sagetrac-mirror/commit/5b8e8ddf7a67bd062fa67c89d2b140b4846549d4)|`Support downloading of symlinked tarballs`|



---

archive/issue_comments_457357.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-05T14:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457357",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_457358.json:
```json
{
    "body": "Changing commit from \"\" to \"5b8e8ddf7a67bd062fa67c89d2b140b4846549d4\"",
    "created_at": "2018-01-05T14:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457358",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "5b8e8ddf7a67bd062fa67c89d2b140b4846549d4"



---

archive/issue_comments_457359.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+#12426 introduces a new package \"gfortran\" which reuses the gcc tarball. This is done by symlinking various files in `build/pkgs/gfortran` to `build/pkgs/gcc`. This confuses the tarball downloader, so we add support for such symlinks in `sage_bootstrap`.\n``````\n",
    "created_at": "2018-01-05T14:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457359",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+#12426 introduces a new package "gfortran" which reuses the gcc tarball. This is done by symlinking various files in `build/pkgs/gfortran` to `build/pkgs/gcc`. This confuses the tarball downloader, so we add support for such symlinks in `sage_bootstrap`.
``````




---

archive/issue_comments_457360.json:
```json
{
    "body": "<a id='comment:7'></a>\nSo whats the plan, have a symlinked tarball or two packages refer to the same tarball? The latter seems more sane to me. Whereas the former raises some questions, e.g. what to upload to mirrors. \n\nLooking up tarball name -> package name isn't really important I think. Could just return a set of matching packages.",
    "created_at": "2018-01-05T23:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457360",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
So whats the plan, have a symlinked tarball or two packages refer to the same tarball? The latter seems more sane to me. Whereas the former raises some questions, e.g. what to upload to mirrors. 

Looking up tarball name -> package name isn't really important I think. Could just return a set of matching packages.



---

archive/issue_comments_457361.json:
```json
{
    "body": "<a id='comment:8'></a>\nTwo packages referring to the same tarball. In #12426 I ended up creating a spkg for gfortran which of course uses gcc's tarball.",
    "created_at": "2018-01-05T23:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457361",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>
Two packages referring to the same tarball. In #12426 I ended up creating a spkg for gfortran which of course uses gcc's tarball.



---

archive/issue_comments_457362.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [vbraun](#comment%3A7):\n> Looking up tarball name -> package name isn't really important I think.\n\n\nIt is needed because the tarballs on the server are stored per package. The URL is something like `.../spkg/upstream/gcc/gcc-7.2.0.xz`, where `gcc` is the package name.",
    "created_at": "2018-01-06T07:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457362",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [vbraun](#comment%3A7):
> Looking up tarball name -> package name isn't really important I think.


It is needed because the tarballs on the server are stored per package. The URL is something like `.../spkg/upstream/gcc/gcc-7.2.0.xz`, where `gcc` is the package name.



---

archive/issue_comments_457363.json:
```json
{
    "body": "<a id='comment:10'></a>\nI am testing this together with #12426. If this is the only scenario to consider, this looks good. Should then #12426 become a dependence here?",
    "created_at": "2018-01-08T12:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457363",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
I am testing this together with #12426. If this is the only scenario to consider, this looks good. Should then #12426 become a dependence here?



---

archive/issue_comments_457364.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [dimpase](#comment%3A10):\n> Should then #12426 become a dependence here?\n\n\nNo. Why should it be?",
    "created_at": "2018-01-08T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457364",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [dimpase](#comment%3A10):
> Should then #12426 become a dependence here?


No. Why should it be?



---

archive/issue_comments_457365.json:
```json
{
    "body": "<a id='comment:12'></a>\nlooks good to me.",
    "created_at": "2018-01-12T13:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457365",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>
looks good to me.



---

archive/issue_comments_457366.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2018-01-12T13:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457366",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_457367.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-12T13:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457367",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457368.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-14T10:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457368",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_078085.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T10:14:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24476#event-78085"
}
```



---

archive/issue_comments_457369.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/support_downloading_of_symlinked_tarballs\" to \"5b8e8ddf7a67bd062fa67c89d2b140b4846549d4\"",
    "created_at": "2018-01-14T10:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24476#issuecomment-457369",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/support_downloading_of_symlinked_tarballs" to "5b8e8ddf7a67bd062fa67c89d2b140b4846549d4"
