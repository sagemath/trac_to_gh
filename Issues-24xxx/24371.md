# Issue 24371: Move real/complex interval fields to new coercion model

archive/issues_024134.json:
```json
{
    "body": "Also fix the following:\n\n```\nsage: NF.<a> = QuadraticField(-2)\nsage: CIF(a)\n...\nValueError: can not convert complex algebraic number to real interval\n```\n\nWe also deal with Python 3 compatibility regarding `int`/`long` and `bytes`/`unicode`.\n\nCC:  @tscrim\n\nBranch/Commit: 9ac1612c342c66a5d574a6c824b064e2a2ec076c\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nDependencies: #24423\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24371\n\n",
    "closed_at": "2018-02-15T23:13:40Z",
    "created_at": "2017-12-12T17:07:42Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Move real/complex interval fields to new coercion model",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24371",
    "user": "https://github.com/jdemeyer"
}
```
Also fix the following:

```
sage: NF.<a> = QuadraticField(-2)
sage: CIF(a)
...
ValueError: can not convert complex algebraic number to real interval
```

We also deal with Python 3 compatibility regarding `int`/`long` and `bytes`/`unicode`.

CC:  @tscrim

Branch/Commit: 9ac1612c342c66a5d574a6c824b064e2a2ec076c

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Dependencies: #24423

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24371





---

archive/issue_comments_461431.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/move_real_complex_interval_fields_to_new_coercion_model\"",
    "created_at": "2017-12-13T14:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461431",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/move_real_complex_interval_fields_to_new_coercion_model"



---

archive/issue_comments_461432.json:
```json
{
    "body": "Changing commit from \"\" to \"db4611a6e8f58ea317498a3d7907e4ba529add6c\"",
    "created_at": "2017-12-14T12:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "db4611a6e8f58ea317498a3d7907e4ba529add6c"



---

archive/issue_comments_461433.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[375e40f](https://git.sagemath.org/sage.git/commit/?id=375e40f6f46fd2db9d231dedf53cc59dc5279147)|`Map._extra_slots(): do not pass dict`|\n|[db4611a](https://git.sagemath.org/sage.git/commit/?id=db4611a6e8f58ea317498a3d7907e4ba529add6c)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-14T12:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[375e40f](https://git.sagemath.org/sage.git/commit/?id=375e40f6f46fd2db9d231dedf53cc59dc5279147)|`Map._extra_slots(): do not pass dict`|
|[db4611a](https://git.sagemath.org/sage.git/commit/?id=db4611a6e8f58ea317498a3d7907e4ba529add6c)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461434.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2017-12-14T12:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461434",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_461435.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#24372\"",
    "created_at": "2017-12-14T12:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461435",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#24372"



---

archive/issue_comments_461436.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[549bd7d](https://git.sagemath.org/sage.git/commit/?id=549bd7d76dc6ec8afe5b1066ca1354e6f67cfc5a)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-14T17:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[549bd7d](https://git.sagemath.org/sage.git/commit/?id=549bd7d76dc6ec8afe5b1066ca1354e6f67cfc5a)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461437.json:
```json
{
    "body": "Changing commit from \"db4611a6e8f58ea317498a3d7907e4ba529add6c\" to \"549bd7d76dc6ec8afe5b1066ca1354e6f67cfc5a\"",
    "created_at": "2017-12-14T17:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "db4611a6e8f58ea317498a3d7907e4ba529add6c" to "549bd7d76dc6ec8afe5b1066ca1354e6f67cfc5a"



---

archive/issue_comments_461438.json:
```json
{
    "body": "Changing commit from \"549bd7d76dc6ec8afe5b1066ca1354e6f67cfc5a\" to \"fe4c8238db49ab1c5bf0f33e837ad65ff81686d0\"",
    "created_at": "2017-12-15T12:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461438",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "549bd7d76dc6ec8afe5b1066ca1354e6f67cfc5a" to "fe4c8238db49ab1c5bf0f33e837ad65ff81686d0"



---

archive/issue_comments_461439.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[fe4c823](https://git.sagemath.org/sage.git/commit/?id=fe4c8238db49ab1c5bf0f33e837ad65ff81686d0)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-15T12:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[fe4c823](https://git.sagemath.org/sage.git/commit/?id=fe4c8238db49ab1c5bf0f33e837ad65ff81686d0)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461440.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,25 @@\n+Also fix this:\n \n+```\n+sage: CC.one() + CIF.one()\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-20-661099892a1e> in <module>()\n+----> 1 CC.one() + CIF.one()\n+\n+/usr/local/src/sage-git/src/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10884)()\n+   1240         # Left and right are Sage elements => use coercion model\n+   1241         if BOTH_ARE_ELEMENT(cl):\n+-> 1242             return coercion_model.bin_op(left, right, add)\n+   1243 \n+   1244         try:\n+\n+/usr/local/src/sage-git/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:10736)()\n+   1137         # We should really include the underlying error.\n+   1138         # This causes so much headache.\n+-> 1139         raise bin_op_exception(op, x, y)\n+   1140 \n+   1141     cpdef canonical_coercion(self, x, y):\n+\n+TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'\n+```\n``````\n",
    "created_at": "2017-12-15T14:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461440",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,25 @@
+Also fix this:
 
+```
+sage: CC.one() + CIF.one()
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-20-661099892a1e> in <module>()
+----> 1 CC.one() + CIF.one()
+
+/usr/local/src/sage-git/src/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10884)()
+   1240         # Left and right are Sage elements => use coercion model
+   1241         if BOTH_ARE_ELEMENT(cl):
+-> 1242             return coercion_model.bin_op(left, right, add)
+   1243 
+   1244         try:
+
+/usr/local/src/sage-git/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:10736)()
+   1137         # We should really include the underlying error.
+   1138         # This causes so much headache.
+-> 1139         raise bin_op_exception(op, x, y)
+   1140 
+   1141     cpdef canonical_coercion(self, x, y):
+
+TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'
+```
``````




---

archive/issue_comments_461441.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[2cee3a4](https://git.sagemath.org/sage.git/commit/?id=2cee3a4fe110061fa7987250a1930e6ad1ab3b9b)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-15T16:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[2cee3a4](https://git.sagemath.org/sage.git/commit/?id=2cee3a4fe110061fa7987250a1930e6ad1ab3b9b)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461442.json:
```json
{
    "body": "Changing commit from \"fe4c8238db49ab1c5bf0f33e837ad65ff81686d0\" to \"2cee3a4fe110061fa7987250a1930e6ad1ab3b9b\"",
    "created_at": "2017-12-15T16:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fe4c8238db49ab1c5bf0f33e837ad65ff81686d0" to "2cee3a4fe110061fa7987250a1930e6ad1ab3b9b"



---

archive/issue_comments_461443.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis will conflict with #23739, but note that #23739 is currently stalled.",
    "created_at": "2017-12-15T21:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461443",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
This will conflict with #23739, but note that #23739 is currently stalled.



---

archive/issue_comments_461444.json:
```json
{
    "body": "<a id='comment:10'></a>\nAlso, I imagine #24363 is a dependency from looking at the code.",
    "created_at": "2017-12-15T21:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461444",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
Also, I imagine #24363 is a dependency from looking at the code.



---

archive/issue_comments_461445.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [tscrim](#comment%3A10):\n> Also, I imagine #24363 is a dependency from looking at the code.\n\n\nI don't see why.",
    "created_at": "2017-12-16T08:43:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461445",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [tscrim](#comment%3A10):
> Also, I imagine #24363 is a dependency from looking at the code.


I don't see why.



---

archive/issue_comments_461446.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Also fix this:\n+Also fix the following:\n \n ```\n sage: CC.one() + CIF.one()\n@@ -23,3 +23,10 @@\n \n TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'\n ```\n+\n+```\n+sage: NF.<a> = QuadraticField(-2)\n+sage: CIF(a)\n+...\n+ValueError: can not convert complex algebraic number to real interval\n+```\n``````\n",
    "created_at": "2017-12-16T08:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461446",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Also fix this:
+Also fix the following:
 
 ```
 sage: CC.one() + CIF.one()
@@ -23,3 +23,10 @@
 
 TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'
 ```
+
+```
+sage: NF.<a> = QuadraticField(-2)
+sage: CIF(a)
+...
+ValueError: can not convert complex algebraic number to real interval
+```
``````




---

archive/issue_comments_461447.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [tscrim](#comment%3A9):\n> This will conflict with #23739, but note that #23739 is currently stalled.\n\n\nI shouldn't be hard to fix #23739 in this ticket.",
    "created_at": "2017-12-16T09:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461447",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [tscrim](#comment%3A9):
> This will conflict with #23739, but note that #23739 is currently stalled.


I shouldn't be hard to fix #23739 in this ticket.



---

archive/issue_comments_461448.json:
```json
{
    "body": "<a id='comment:14'></a>\nI also shortly want to note #15114 here and the discussion from which that ticket spawned at [sage-devel](https://groups.google.com/forum/#!searchin/sage-devel/coercion$20interval$20field%7Csort:date/sage-devel/zfg0PhFR_qA/t2SY2cbOCAAJ). I am not saying it needs to get fixed here, but it is a good thing to have in the back of your mind while working on this ticket so that at least things do not get worse in that respect.",
    "created_at": "2017-12-16T10:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461448",
    "user": "https://github.com/koffie"
}
```

<a id='comment:14'></a>
I also shortly want to note #15114 here and the discussion from which that ticket spawned at [sage-devel](https://groups.google.com/forum/#!searchin/sage-devel/coercion$20interval$20field%7Csort:date/sage-devel/zfg0PhFR_qA/t2SY2cbOCAAJ). I am not saying it needs to get fixed here, but it is a good thing to have in the back of your mind while working on this ticket so that at least things do not get worse in that respect.



---

archive/issue_comments_461449.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A11):\n> Replying to [tscrim](#comment%3A10):\n> > Also, I imagine #24363 is a dependency from looking at the code.\n\n> \n> I don't see why.\n\n\nI thought I saw a conflict, but that turns out to not be the case.",
    "created_at": "2017-12-16T12:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461449",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A11):
> Replying to [tscrim](#comment%3A10):
> > Also, I imagine #24363 is a dependency from looking at the code.

> 
> I don't see why.


I thought I saw a conflict, but that turns out to not be the case.



---

archive/issue_comments_461450.json:
```json
{
    "body": "Changing commit from \"2cee3a4fe110061fa7987250a1930e6ad1ab3b9b\" to \"d66b54fb413a45950a8c6dd4bb385a43c2254883\"",
    "created_at": "2017-12-17T20:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2cee3a4fe110061fa7987250a1930e6ad1ab3b9b" to "d66b54fb413a45950a8c6dd4bb385a43c2254883"



---

archive/issue_comments_461451.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[d66b54f](https://git.sagemath.org/sage.git/commit/?id=d66b54fb413a45950a8c6dd4bb385a43c2254883)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-17T20:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461451",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[d66b54f](https://git.sagemath.org/sage.git/commit/?id=d66b54fb413a45950a8c6dd4bb385a43c2254883)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461452.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mderickx](#comment%3A14):\n> I also shortly want to note #15114 here and the discussion from which that ticket spawned at [sage-devel](https://groups.google.com/forum/#!searchin/sage-devel/coercion$20interval$20field%7Csort:date/sage-devel/zfg0PhFR_qA/t2SY2cbOCAAJ). I am not saying it needs to get fixed here, but it is a good thing to have in the back of your mind while working on this ticket so that at least things do not get worse in that respect.\n\n\nOK. So with #15114 in mind, this should be a feature and not a bug:\n\n```\nsage: CC.one() + CIF.one()\n...\nTypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'\n```",
    "created_at": "2017-12-18T08:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461452",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [mderickx](#comment%3A14):
> I also shortly want to note #15114 here and the discussion from which that ticket spawned at [sage-devel](https://groups.google.com/forum/#!searchin/sage-devel/coercion$20interval$20field%7Csort:date/sage-devel/zfg0PhFR_qA/t2SY2cbOCAAJ). I am not saying it needs to get fixed here, but it is a good thing to have in the back of your mind while working on this ticket so that at least things do not get worse in that respect.


OK. So with #15114 in mind, this should be a feature and not a bug:

```
sage: CC.one() + CIF.one()
...
TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'
```



---

archive/issue_comments_461453.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,28 +1,4 @@\n Also fix the following:\n-\n-```\n-sage: CC.one() + CIF.one()\n----------------------------------------------------------------------------\n-TypeError                                 Traceback (most recent call last)\n-<ipython-input-20-661099892a1e> in <module>()\n-----> 1 CC.one() + CIF.one()\n-\n-/usr/local/src/sage-git/src/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10884)()\n-   1240         # Left and right are Sage elements => use coercion model\n-   1241         if BOTH_ARE_ELEMENT(cl):\n--> 1242             return coercion_model.bin_op(left, right, add)\n-   1243 \n-   1244         try:\n-\n-/usr/local/src/sage-git/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:10736)()\n-   1137         # We should really include the underlying error.\n-   1138         # This causes so much headache.\n--> 1139         raise bin_op_exception(op, x, y)\n-   1140 \n-   1141     cpdef canonical_coercion(self, x, y):\n-\n-TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'\n-```\n \n ```\n sage: NF.<a> = QuadraticField(-2)\n@@ -30,3 +6,5 @@\n ...\n ValueError: can not convert complex algebraic number to real interval\n ```\n+\n+Using #24244, we also deal with Python 3 compatibility regarding `int`/`long`.\n``````\n",
    "created_at": "2017-12-18T13:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461453",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,28 +1,4 @@
 Also fix the following:
-
-```
-sage: CC.one() + CIF.one()
----------------------------------------------------------------------------
-TypeError                                 Traceback (most recent call last)
-<ipython-input-20-661099892a1e> in <module>()
-----> 1 CC.one() + CIF.one()
-
-/usr/local/src/sage-git/src/sage/structure/element.pyx in sage.structure.element.Element.__add__ (build/cythonized/sage/structure/element.c:10884)()
-   1240         # Left and right are Sage elements => use coercion model
-   1241         if BOTH_ARE_ELEMENT(cl):
--> 1242             return coercion_model.bin_op(left, right, add)
-   1243 
-   1244         try:
-
-/usr/local/src/sage-git/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:10736)()
-   1137         # We should really include the underlying error.
-   1138         # This causes so much headache.
--> 1139         raise bin_op_exception(op, x, y)
-   1140 
-   1141     cpdef canonical_coercion(self, x, y):
-
-TypeError: unsupported operand parent(s) for +: 'Complex Field with 53 bits of precision' and 'Complex Interval Field with 53 bits of precision'
-```
 
 ```
 sage: NF.<a> = QuadraticField(-2)
@@ -30,3 +6,5 @@
 ...
 ValueError: can not convert complex algebraic number to real interval
 ```
+
+Using #24244, we also deal with Python 3 compatibility regarding `int`/`long`.
``````




---

archive/issue_comments_461454.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[3eaf54f](https://git.sagemath.org/sage.git/commit/?id=3eaf54f855f3fa8da1700c3e2f99aeb85d007937)|`Clean up MPFI declarations`|\n|[4984485](https://git.sagemath.org/sage.git/commit/?id=4984485b63c1ad76382944ba6568da3d504cbee1)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-18T14:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461454",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[3eaf54f](https://git.sagemath.org/sage.git/commit/?id=3eaf54f855f3fa8da1700c3e2f99aeb85d007937)|`Clean up MPFI declarations`|
|[4984485](https://git.sagemath.org/sage.git/commit/?id=4984485b63c1ad76382944ba6568da3d504cbee1)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461455.json:
```json
{
    "body": "Changing commit from \"d66b54fb413a45950a8c6dd4bb385a43c2254883\" to \"4984485b63c1ad76382944ba6568da3d504cbee1\"",
    "created_at": "2017-12-18T14:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461455",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d66b54fb413a45950a8c6dd4bb385a43c2254883" to "4984485b63c1ad76382944ba6568da3d504cbee1"



---

archive/issue_comments_461456.json:
```json
{
    "body": "Changing commit from \"4984485b63c1ad76382944ba6568da3d504cbee1\" to \"244856318a3d783da4ce0c3e5ef23d512f4e6a34\"",
    "created_at": "2017-12-19T08:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461456",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4984485b63c1ad76382944ba6568da3d504cbee1" to "244856318a3d783da4ce0c3e5ef23d512f4e6a34"



---

archive/issue_comments_461457.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[2448563](https://git.sagemath.org/sage.git/commit/?id=244856318a3d783da4ce0c3e5ef23d512f4e6a34)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-19T08:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461457",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[2448563](https://git.sagemath.org/sage.git/commit/?id=244856318a3d783da4ce0c3e5ef23d512f4e6a34)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461458.json:
```json
{
    "body": "Changing dependencies from \"#24372\" to \"#24372, #24402, #24381\"",
    "created_at": "2017-12-19T08:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461458",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#24372" to "#24372, #24402, #24381"



---

archive/issue_comments_461459.json:
```json
{
    "body": "Changing commit from \"244856318a3d783da4ce0c3e5ef23d512f4e6a34\" to \"34bbe053aec67081ce0af19f27f02b26e442a294\"",
    "created_at": "2017-12-19T09:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461459",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "244856318a3d783da4ce0c3e5ef23d512f4e6a34" to "34bbe053aec67081ce0af19f27f02b26e442a294"



---

archive/issue_comments_461460.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[6067d8c](https://git.sagemath.org/sage.git/commit/?id=6067d8c514557400f451621dca0b94fc1189df9a)|`Clean up MPFR and MPFI declarations`|\n|[34bbe05](https://git.sagemath.org/sage.git/commit/?id=34bbe053aec67081ce0af19f27f02b26e442a294)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-19T09:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461460",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[6067d8c](https://git.sagemath.org/sage.git/commit/?id=6067d8c514557400f451621dca0b94fc1189df9a)|`Clean up MPFR and MPFI declarations`|
|[34bbe05](https://git.sagemath.org/sage.git/commit/?id=34bbe053aec67081ce0af19f27f02b26e442a294)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461461.json:
```json
{
    "body": "Changing commit from \"34bbe053aec67081ce0af19f27f02b26e442a294\" to \"c149d9100bf62ca8b60652b201b17016212b72ec\"",
    "created_at": "2017-12-19T14:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "34bbe053aec67081ce0af19f27f02b26e442a294" to "c149d9100bf62ca8b60652b201b17016212b72ec"



---

archive/issue_comments_461462.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[6f46f29](https://git.sagemath.org/sage.git/commit/?id=6f46f29822ef0cb9b8f81404a8162c925dbad0a7)|`New Parent method _convert_method_map`|\n|[28d5a57](https://git.sagemath.org/sage.git/commit/?id=28d5a576694d279dd6b6d96c40e88e8777f1a661)|`Clean up MPFR and MPFI declarations`|\n|[c149d91](https://git.sagemath.org/sage.git/commit/?id=c149d9100bf62ca8b60652b201b17016212b72ec)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-19T14:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[6f46f29](https://git.sagemath.org/sage.git/commit/?id=6f46f29822ef0cb9b8f81404a8162c925dbad0a7)|`New Parent method _convert_method_map`|
|[28d5a57](https://git.sagemath.org/sage.git/commit/?id=28d5a576694d279dd6b6d96c40e88e8777f1a661)|`Clean up MPFR and MPFI declarations`|
|[c149d91](https://git.sagemath.org/sage.git/commit/?id=c149d9100bf62ca8b60652b201b17016212b72ec)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461463.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[5c2f4f5](https://git.sagemath.org/sage.git/commit/?id=5c2f4f5c78c3b3a09451c601b64f4c536191b25b)|`New Parent method _convert_method_map`|\n|[db863cd](https://git.sagemath.org/sage.git/commit/?id=db863cd30f21140ebdbe2e51b6eaf472e304bef4)|`Clean up MPFR and MPFI declarations`|\n|[5416458](https://git.sagemath.org/sage.git/commit/?id=5416458afe34ea680c2921930378aed28c475b0c)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-22T12:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[5c2f4f5](https://git.sagemath.org/sage.git/commit/?id=5c2f4f5c78c3b3a09451c601b64f4c536191b25b)|`New Parent method _convert_method_map`|
|[db863cd](https://git.sagemath.org/sage.git/commit/?id=db863cd30f21140ebdbe2e51b6eaf472e304bef4)|`Clean up MPFR and MPFI declarations`|
|[5416458](https://git.sagemath.org/sage.git/commit/?id=5416458afe34ea680c2921930378aed28c475b0c)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461464.json:
```json
{
    "body": "Changing commit from \"c149d9100bf62ca8b60652b201b17016212b72ec\" to \"5416458afe34ea680c2921930378aed28c475b0c\"",
    "created_at": "2017-12-22T12:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461464",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c149d9100bf62ca8b60652b201b17016212b72ec" to "5416458afe34ea680c2921930378aed28c475b0c"



---

archive/issue_comments_461465.json:
```json
{
    "body": "Changing dependencies from \"#24372, #24402, #24381\" to \"#24402, #24381\"",
    "created_at": "2017-12-22T12:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461465",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#24372, #24402, #24381" to "#24402, #24381"



---

archive/issue_comments_461466.json:
```json
{
    "body": "Changing commit from \"5416458afe34ea680c2921930378aed28c475b0c\" to \"ed5dc4a146ef3cbc2b6ac17c5bb2ab5653c8787a\"",
    "created_at": "2017-12-22T16:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5416458afe34ea680c2921930378aed28c475b0c" to "ed5dc4a146ef3cbc2b6ac17c5bb2ab5653c8787a"



---

archive/issue_comments_461467.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[ed5dc4a](https://git.sagemath.org/sage.git/commit/?id=ed5dc4a146ef3cbc2b6ac17c5bb2ab5653c8787a)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-22T16:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461467",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[ed5dc4a](https://git.sagemath.org/sage.git/commit/?id=ed5dc4a146ef3cbc2b6ac17c5bb2ab5653c8787a)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461468.json:
```json
{
    "body": "<a id='comment:27'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[d81fa72](https://git.sagemath.org/sage.git/commit/?id=d81fa7243a95e0ac4aa618610eae9c0e497c126a)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2017-12-22T16:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[d81fa72](https://git.sagemath.org/sage.git/commit/?id=d81fa7243a95e0ac4aa618610eae9c0e497c126a)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461469.json:
```json
{
    "body": "Changing commit from \"ed5dc4a146ef3cbc2b6ac17c5bb2ab5653c8787a\" to \"d81fa7243a95e0ac4aa618610eae9c0e497c126a\"",
    "created_at": "2017-12-22T16:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461469",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ed5dc4a146ef3cbc2b6ac17c5bb2ab5653c8787a" to "d81fa7243a95e0ac4aa618610eae9c0e497c126a"



---

archive/issue_comments_461470.json:
```json
{
    "body": "Changing dependencies from \"#24402, #24381\" to \"#24402, #24381, #24423\"",
    "created_at": "2017-12-22T21:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461470",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#24402, #24381" to "#24402, #24381, #24423"



---

archive/issue_comments_461471.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/move_real_complex_interval_fields_to_new_coercion_model\" to \"public/24371-move_real_complex_interval_fields_to_new_coercion_model\"",
    "created_at": "2018-02-07T14:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461471",
    "user": "https://github.com/mezzarobba"
}
```

Changing branch from "u/jdemeyer/move_real_complex_interval_fields_to_new_coercion_model" to "public/24371-move_real_complex_interval_fields_to_new_coercion_model"



---

archive/issue_comments_461472.json:
```json
{
    "body": "<a id='comment:29'></a>\nRebased (trivial conflits only)... Is this ready for review?",
    "created_at": "2018-02-07T14:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461472",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:29'></a>
Rebased (trivial conflits only)... Is this ready for review?



---

archive/issue_comments_461473.json:
```json
{
    "body": "Changing commit from \"d81fa7243a95e0ac4aa618610eae9c0e497c126a\" to \"7b3c2e7e8d4ceae4cd050ed652b46d4f748b9445\"",
    "created_at": "2018-02-07T14:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461473",
    "user": "https://github.com/mezzarobba"
}
```

Changing commit from "d81fa7243a95e0ac4aa618610eae9c0e497c126a" to "7b3c2e7e8d4ceae4cd050ed652b46d4f748b9445"



---

archive/issue_comments_461474.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[5c2f4f5](https://git.sagemath.org/sage.git/commit/?id=5c2f4f5c78c3b3a09451c601b64f4c536191b25b)|`New Parent method _convert_method_map`|\n|[18d9877](https://git.sagemath.org/sage.git/commit/?id=18d98778238982fd01f7cc9a1f027aff51460305)|`Fix cimport`|\n|[4606309](https://git.sagemath.org/sage.git/commit/?id=4606309005099356eda39142a9abc425d341337e)|`LinearFunctionOrConstraint.__richcmp__ should replace before converting`|\n|[15cd15e](https://git.sagemath.org/sage.git/commit/?id=15cd15ead8594a9553d74ae46bac2ecaf6fa67c3)|`Merge remote-tracking branches 'trac/u/jdemeyer/new_parent_method__convert_method_map' and 'trac/u/jdemeyer/linearfunctionorconstraint___richcmp___should_replace_before_converting' into tmp`|\n|[2b36f39](https://git.sagemath.org/sage.git/commit/?id=2b36f395a8fdc2a68532c856dbcfcad458f962a6)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2018-02-07T14:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[5c2f4f5](https://git.sagemath.org/sage.git/commit/?id=5c2f4f5c78c3b3a09451c601b64f4c536191b25b)|`New Parent method _convert_method_map`|
|[18d9877](https://git.sagemath.org/sage.git/commit/?id=18d98778238982fd01f7cc9a1f027aff51460305)|`Fix cimport`|
|[4606309](https://git.sagemath.org/sage.git/commit/?id=4606309005099356eda39142a9abc425d341337e)|`LinearFunctionOrConstraint.__richcmp__ should replace before converting`|
|[15cd15e](https://git.sagemath.org/sage.git/commit/?id=15cd15ead8594a9553d74ae46bac2ecaf6fa67c3)|`Merge remote-tracking branches 'trac/u/jdemeyer/new_parent_method__convert_method_map' and 'trac/u/jdemeyer/linearfunctionorconstraint___richcmp___should_replace_before_converting' into tmp`|
|[2b36f39](https://git.sagemath.org/sage.git/commit/?id=2b36f395a8fdc2a68532c856dbcfcad458f962a6)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461475.json:
```json
{
    "body": "Changing commit from \"7b3c2e7e8d4ceae4cd050ed652b46d4f748b9445\" to \"2b36f395a8fdc2a68532c856dbcfcad458f962a6\"",
    "created_at": "2018-02-07T14:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461475",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7b3c2e7e8d4ceae4cd050ed652b46d4f748b9445" to "2b36f395a8fdc2a68532c856dbcfcad458f962a6"



---

archive/issue_comments_461476.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [mmezzarobba](#comment%3A29):\n> Is this ready for review?\n\n\nNot sure... I wanted to wait until the dependencies are merged before continuing with this.\n\nIt should be *mostly* done though. If it passes doctests, it might as well be \"needs review\".",
    "created_at": "2018-02-07T19:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461476",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replying to [mmezzarobba](#comment%3A29):
> Is this ready for review?


Not sure... I wanted to wait until the dependencies are merged before continuing with this.

It should be *mostly* done though. If it passes doctests, it might as well be "needs review".



---

archive/issue_comments_461477.json:
```json
{
    "body": "<a id='comment:32'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[d9141eb](https://git.sagemath.org/sage.git/commit/?id=d9141eb474d3ce140580349c8b7d4c30ea5d7a1a)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2018-02-09T14:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[d9141eb](https://git.sagemath.org/sage.git/commit/?id=d9141eb474d3ce140580349c8b7d4c30ea5d7a1a)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461478.json:
```json
{
    "body": "Changing commit from \"2b36f395a8fdc2a68532c856dbcfcad458f962a6\" to \"d9141eb474d3ce140580349c8b7d4c30ea5d7a1a\"",
    "created_at": "2018-02-09T14:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2b36f395a8fdc2a68532c856dbcfcad458f962a6" to "d9141eb474d3ce140580349c8b7d4c30ea5d7a1a"



---

archive/issue_comments_461479.json:
```json
{
    "body": "<a id='comment:33'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[4606309](https://git.sagemath.org/sage.git/commit/?id=4606309005099356eda39142a9abc425d341337e)|`LinearFunctionOrConstraint.__richcmp__ should replace before converting`|\n|[72ac35f](https://git.sagemath.org/sage.git/commit/?id=72ac35fbcfcbb442966f4e12313b30483f807364)|`Merge commit '4606309005099356eda39142a9abc425d341337e' into t/24371/public/24371-move_real_complex_interval_fields_to_new_coercion_model`|\n|[c74d8e7](https://git.sagemath.org/sage.git/commit/?id=c74d8e71c695d2d9f8af9ef9074a90a48e2b4753)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2018-02-09T14:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461479",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[4606309](https://git.sagemath.org/sage.git/commit/?id=4606309005099356eda39142a9abc425d341337e)|`LinearFunctionOrConstraint.__richcmp__ should replace before converting`|
|[72ac35f](https://git.sagemath.org/sage.git/commit/?id=72ac35fbcfcbb442966f4e12313b30483f807364)|`Merge commit '4606309005099356eda39142a9abc425d341337e' into t/24371/public/24371-move_real_complex_interval_fields_to_new_coercion_model`|
|[c74d8e7](https://git.sagemath.org/sage.git/commit/?id=c74d8e71c695d2d9f8af9ef9074a90a48e2b4753)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461480.json:
```json
{
    "body": "Changing commit from \"d9141eb474d3ce140580349c8b7d4c30ea5d7a1a\" to \"c74d8e71c695d2d9f8af9ef9074a90a48e2b4753\"",
    "created_at": "2018-02-09T14:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d9141eb474d3ce140580349c8b7d4c30ea5d7a1a" to "c74d8e71c695d2d9f8af9ef9074a90a48e2b4753"



---

archive/issue_comments_461481.json:
```json
{
    "body": "Changing dependencies from \"#24402, #24381, #24423\" to \"#24423\"",
    "created_at": "2018-02-09T14:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461481",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#24402, #24381, #24423" to "#24423"



---

archive/issue_comments_461482.json:
```json
{
    "body": "Changing commit from \"c74d8e71c695d2d9f8af9ef9074a90a48e2b4753\" to \"ee2d01c8fa1ec0c0c060047705f4c9d7a62ca216\"",
    "created_at": "2018-02-09T14:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c74d8e71c695d2d9f8af9ef9074a90a48e2b4753" to "ee2d01c8fa1ec0c0c060047705f4c9d7a62ca216"



---

archive/issue_comments_461483.json:
```json
{
    "body": "<a id='comment:35'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[ee2d01c](https://git.sagemath.org/sage.git/commit/?id=ee2d01c8fa1ec0c0c060047705f4c9d7a62ca216)|`Fix ComplexIntervalFieldElement.log()`|",
    "created_at": "2018-02-09T14:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[ee2d01c](https://git.sagemath.org/sage.git/commit/?id=ee2d01c8fa1ec0c0c060047705f4c9d7a62ca216)|`Fix ComplexIntervalFieldElement.log()`|



---

archive/issue_comments_461484.json:
```json
{
    "body": "Changing commit from \"ee2d01c8fa1ec0c0c060047705f4c9d7a62ca216\" to \"c74d8e71c695d2d9f8af9ef9074a90a48e2b4753\"",
    "created_at": "2018-02-09T14:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ee2d01c8fa1ec0c0c060047705f4c9d7a62ca216" to "c74d8e71c695d2d9f8af9ef9074a90a48e2b4753"



---

archive/issue_comments_461485.json:
```json
{
    "body": "<a id='comment:36'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T14:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_461486.json:
```json
{
    "body": "<a id='comment:37'></a>\nI still need to implement the Python 3 compatibility that I promised.",
    "created_at": "2018-02-09T14:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461486",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
I still need to implement the Python 3 compatibility that I promised.



---

archive/issue_comments_461487.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n ValueError: can not convert complex algebraic number to real interval\n ```\n \n-Using #24244, we also deal with Python 3 compatibility regarding `int`/`long`.\n+We also deal with Python 3 compatibility regarding `int`/`long` and `bytes`/`unicode`.\n``````\n",
    "created_at": "2018-02-09T14:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461487",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 ValueError: can not convert complex algebraic number to real interval
 ```
 
-Using #24244, we also deal with Python 3 compatibility regarding `int`/`long`.
+We also deal with Python 3 compatibility regarding `int`/`long` and `bytes`/`unicode`.
``````




---

archive/issue_comments_461488.json:
```json
{
    "body": "Changing commit from \"c74d8e71c695d2d9f8af9ef9074a90a48e2b4753\" to \"1195b3a4b098a4e5d32e482603ff9d0c3e86e9c8\"",
    "created_at": "2018-02-09T16:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461488",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c74d8e71c695d2d9f8af9ef9074a90a48e2b4753" to "1195b3a4b098a4e5d32e482603ff9d0c3e86e9c8"



---

archive/issue_comments_461489.json:
```json
{
    "body": "<a id='comment:38'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[1195b3a](https://git.sagemath.org/sage.git/commit/?id=1195b3a4b098a4e5d32e482603ff9d0c3e86e9c8)|`Move real/complex interval fields to new coercion model`|",
    "created_at": "2018-02-09T16:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[1195b3a](https://git.sagemath.org/sage.git/commit/?id=1195b3a4b098a4e5d32e482603ff9d0c3e86e9c8)|`Move real/complex interval fields to new coercion model`|



---

archive/issue_comments_461490.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-09T16:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461490",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_461491.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-02-09T21:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461491",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_461492.json:
```json
{
    "body": "<a id='comment:40'></a>\nSome comments:\n\n- I know this is slightly outside the purview of this ticket, but perhaps we can rename `ComplexIntervalField_class` to `ComplexIntervalField` and have it inherit from `UniqueRepresentation` in order to get rid of the custom caching. I can also do this if you want.\n- I would do the same for `RealIntervalField_class` except it is an extension class. Do you think there is a benefit for that? We don't even do that for `Rationals`.\n- Why not use ``@`cached_method` for `real_field`, `middle_field`, etc.? They to have `UniqueRepresentation`-like behavior, so do not strictly need to be cached. However, I am assuming they are cached for speed reasons, so doing ``@`cached_method` is the best for repeated use:\n  {{{#!sage\nsage: class Foo(object):\n....:     def __init__(self):\n....:         self._cache2 = None\n....:     `@`cached_method\n....:     def cm(self):\n....:         return 5\n....:     def c1(self):\n....:         try:\n....:             return self._cache1\n....:         except AttributeError:\n....:             self._cache1 = 5\n....:             return self._cache1\n....:     def c2(self):\n....:         if self._cache2 is None:\n....:             self._cache2 = 5\n....:         return self._cache2\nsage: timeit('F = Foo(); F.cm()', number=10000, repeat=20)\n10000 loops, best of 20: 1.53 \u00b5s per loop\nsage: timeit('F = Foo(); F.c1()', number=10000, repeat=20)\n10000 loops, best of 20: 1.39 \u00b5s per loop\nsage: timeit('F = Foo(); F.c2()', number=10000, repeat=20)\n10000 loops, best of 20: 635 ns per loop\nsage: F = Foo()\nsage: timeit('F.cm()', number=10000, repeat=20)\n10000 loops, best of 20: 68.7 ns per loop\nsage: timeit('F.c1()', number=10000, repeat=20)\n10000 loops, best of 20: 121 ns per loop\nsage: timeit('F.c2()', number=10000, repeat=20)\n10000 loops, best of 20: 1.49 \u00b5s per loop\n  }}}\n- Is the `_real_field = real_field` leftover from testing? I think it should be removed altogether.\n- You should replace\n  {{{#!diff\n        return complex_interval.ComplexIntervalFieldElement(self, x, im, **kwds)\n        return self.element_class(self, x, im, **kwds)\n  }}}\n  (in fact, if that is used elsewhere in the file, it should be replaced as well) to pick up the category contributions.\n- Same comment for returning `RealIntervalFieldElement`.\n- Similarly, I would also make this change:\n  {{{#!diff\n     R = RealIntervalField(prec=max(bits+pad, min_prec))\n     if upper is not None:\n         s = (s, upper)\n-    return RealIntervalFieldElement(R, s, base)\n+    return R.element_class(R, s, base)\n }}}\n\nI think it looks good otherwise.",
    "created_at": "2018-02-09T21:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461492",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>
Some comments:

- I know this is slightly outside the purview of this ticket, but perhaps we can rename `ComplexIntervalField_class` to `ComplexIntervalField` and have it inherit from `UniqueRepresentation` in order to get rid of the custom caching. I can also do this if you want.
- I would do the same for `RealIntervalField_class` except it is an extension class. Do you think there is a benefit for that? We don't even do that for `Rationals`.
- Why not use ``@`cached_method` for `real_field`, `middle_field`, etc.? They to have `UniqueRepresentation`-like behavior, so do not strictly need to be cached. However, I am assuming they are cached for speed reasons, so doing ``@`cached_method` is the best for repeated use:
  {{{#!sage
sage: class Foo(object):
....:     def __init__(self):
....:         self._cache2 = None
....:     `@`cached_method
....:     def cm(self):
....:         return 5
....:     def c1(self):
....:         try:
....:             return self._cache1
....:         except AttributeError:
....:             self._cache1 = 5
....:             return self._cache1
....:     def c2(self):
....:         if self._cache2 is None:
....:             self._cache2 = 5
....:         return self._cache2
sage: timeit('F = Foo(); F.cm()', number=10000, repeat=20)
10000 loops, best of 20: 1.53 s per loop
sage: timeit('F = Foo(); F.c1()', number=10000, repeat=20)
10000 loops, best of 20: 1.39 s per loop
sage: timeit('F = Foo(); F.c2()', number=10000, repeat=20)
10000 loops, best of 20: 635 ns per loop
sage: F = Foo()
sage: timeit('F.cm()', number=10000, repeat=20)
10000 loops, best of 20: 68.7 ns per loop
sage: timeit('F.c1()', number=10000, repeat=20)
10000 loops, best of 20: 121 ns per loop
sage: timeit('F.c2()', number=10000, repeat=20)
10000 loops, best of 20: 1.49 s per loop
  }}}
- Is the `_real_field = real_field` leftover from testing? I think it should be removed altogether.
- You should replace
  {{{#!diff
        return complex_interval.ComplexIntervalFieldElement(self, x, im, **kwds)
        return self.element_class(self, x, im, **kwds)
  }}}
  (in fact, if that is used elsewhere in the file, it should be replaced as well) to pick up the category contributions.
- Same comment for returning `RealIntervalFieldElement`.
- Similarly, I would also make this change:
  {{{#!diff
     R = RealIntervalField(prec=max(bits+pad, min_prec))
     if upper is not None:
         s = (s, upper)
-    return RealIntervalFieldElement(R, s, base)
+    return R.element_class(R, s, base)
 }}}

I think it looks good otherwise.



---

archive/issue_comments_461493.json:
```json
{
    "body": "<a id='comment:41'></a>\nI consider the proposed changes to unique representation outside the scope of this ticket. This ticket is already reasonably large, let's not add more things. I'll have a look at your other comments.",
    "created_at": "2018-02-09T21:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461493",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
I consider the proposed changes to unique representation outside the scope of this ticket. This ticket is already reasonably large, let's not add more things. I'll have a look at your other comments.



---

archive/issue_comments_461494.json:
```json
{
    "body": "<a id='comment:42'></a>\nI guess the `_real_field = real_field` is to avoid #24695 as a dependency?",
    "created_at": "2018-02-09T21:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461494",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>
I guess the `_real_field = real_field` is to avoid #24695 as a dependency?



---

archive/issue_comments_461495.json:
```json
{
    "body": "<a id='comment:43'></a>\nWe should also do changes of the form in `ComplexIntervalFieldElement`:\n\n```diff\n-return ComplexIntervalFieldElement(self._parent, re, im)\n+return type(self)(self._parent, re, im)\n```\nand similarly for `RealIntervalFieldElement`.",
    "created_at": "2018-02-09T21:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461495",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>
We should also do changes of the form in `ComplexIntervalFieldElement`:

```diff
-return ComplexIntervalFieldElement(self._parent, re, im)
+return type(self)(self._parent, re, im)
```
and similarly for `RealIntervalFieldElement`.



---

archive/issue_comments_461496.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [tscrim](#comment%3A42):\n> I guess the `_real_field = real_field` is to avoid #24695 as a dependency?\n\n\nI wasn't actually aware of that, thanks for the pointer :-)",
    "created_at": "2018-02-09T21:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461496",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:44'></a>
Replying to [tscrim](#comment%3A42):
> I guess the `_real_field = real_field` is to avoid #24695 as a dependency?


I wasn't actually aware of that, thanks for the pointer :-)



---

archive/issue_comments_461497.json:
```json
{
    "body": "<a id='comment:45'></a>\nI guess I kept `_real_field` for compatibility with other \"complex number\" implementations such as\n\n```\nsage: CC._real_field()\nReal Field with 53 bits of precision\n```\n\nWe should probably have a separate ticket to replace `_real_field` by `real_field`: this looks like a useful method, it should not be private.",
    "created_at": "2018-02-12T12:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461497",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:45'></a>
I guess I kept `_real_field` for compatibility with other "complex number" implementations such as

```
sage: CC._real_field()
Real Field with 53 bits of precision
```

We should probably have a separate ticket to replace `_real_field` by `real_field`: this looks like a useful method, it should not be private.



---

archive/issue_comments_461498.json:
```json
{
    "body": "Changing commit from \"1195b3a4b098a4e5d32e482603ff9d0c3e86e9c8\" to \"22d309c01fcb79c5d8858f4eb5b140e4c51d2780\"",
    "created_at": "2018-02-12T13:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461498",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1195b3a4b098a4e5d32e482603ff9d0c3e86e9c8" to "22d309c01fcb79c5d8858f4eb5b140e4c51d2780"



---

archive/issue_comments_461499.json:
```json
{
    "body": "<a id='comment:46'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[22d309c](https://git.sagemath.org/sage.git/commit/?id=22d309c01fcb79c5d8858f4eb5b140e4c51d2780)|`Cleanup for real/complex interval fields`|",
    "created_at": "2018-02-12T13:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[22d309c](https://git.sagemath.org/sage.git/commit/?id=22d309c01fcb79c5d8858f4eb5b140e4c51d2780)|`Cleanup for real/complex interval fields`|



---

archive/issue_comments_461500.json:
```json
{
    "body": "<a id='comment:47'></a>\nI ended up doing a lot of cleanup. I think I'm using `element_class` everywhere, but don't shoot me if I'm wrong.\n\nNote that currently the category stuff won't be used anyway because the elements are extension types.",
    "created_at": "2018-02-12T13:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461500",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:47'></a>
I ended up doing a lot of cleanup. I think I'm using `element_class` everywhere, but don't shoot me if I'm wrong.

Note that currently the category stuff won't be used anyway because the elements are extension types.



---

archive/issue_comments_461501.json:
```json
{
    "body": "<a id='comment:48'></a>\nThank you for doing the cleanup.\n\nFor changes such as\n\n```diff\n-        cdef ComplexIntervalFieldElement res = self._new()\n+        res = self._new()\n```\naren't we loosing some efficiency? I would think because they are still subclasses of `ComplexIntervalFieldElement`, that Cython would be able to optimize their attribute lookups by not treating them as Python objects? (Of course, we would have to explicitly cast `<ComplexIntervalFieldElement>` to avoid the type-checking-safety-penalty.)\n\nThis goes through the `__call__` (which in this case, bypasses the coercion framework, but normally it wouldn't):\n\n```diff\n-        return complex_interval.ComplexIntervalFieldElement(self, 0, 1)\n+        return self(0, 1)\n```\nI think we are better making a direct call to `self.element_class(self, 0, 1)` since this is not user input.",
    "created_at": "2018-02-13T01:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461501",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:48'></a>
Thank you for doing the cleanup.

For changes such as

```diff
-        cdef ComplexIntervalFieldElement res = self._new()
+        res = self._new()
```
aren't we loosing some efficiency? I would think because they are still subclasses of `ComplexIntervalFieldElement`, that Cython would be able to optimize their attribute lookups by not treating them as Python objects? (Of course, we would have to explicitly cast `<ComplexIntervalFieldElement>` to avoid the type-checking-safety-penalty.)

This goes through the `__call__` (which in this case, bypasses the coercion framework, but normally it wouldn't):

```diff
-        return complex_interval.ComplexIntervalFieldElement(self, 0, 1)
+        return self(0, 1)
```
I think we are better making a direct call to `self.element_class(self, 0, 1)` since this is not user input.



---

archive/issue_comments_461502.json:
```json
{
    "body": "<a id='comment:49'></a>\nReplying to [tscrim](#comment%3A48):\n> Thank you for doing the cleanup.\n> \n> For changes such as\n> \n> ```diff\n> -        cdef ComplexIntervalFieldElement res = self._new()\n> +        res = self._new()\n> ```\n> aren't we loosing some efficiency?\n\n\nNo, Cython has type inference. Since `_new` is declared as returning a `ComplexIntervalFieldElement`, the declaration `cdef ComplexIntervalFieldElement res` is just redundant.\n\n> This goes through the `__call__` (which in this case, bypasses the coercion framework, but normally it wouldn't):\n> \n> ```diff\n> -        return complex_interval.ComplexIntervalFieldElement(self, 0, 1)\n> +        return self(0, 1)\n> ```\n> I think we are better making a direct call to `self.element_class(self, 0, 1)` since this is not user input.\n\n\nI don't see the problem with using `__call__` here but I can make that change.",
    "created_at": "2018-02-13T06:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461502",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:49'></a>
Replying to [tscrim](#comment%3A48):
> Thank you for doing the cleanup.
> 
> For changes such as
> 
> ```diff
> -        cdef ComplexIntervalFieldElement res = self._new()
> +        res = self._new()
> ```
> aren't we loosing some efficiency?


No, Cython has type inference. Since `_new` is declared as returning a `ComplexIntervalFieldElement`, the declaration `cdef ComplexIntervalFieldElement res` is just redundant.

> This goes through the `__call__` (which in this case, bypasses the coercion framework, but normally it wouldn't):
> 
> ```diff
> -        return complex_interval.ComplexIntervalFieldElement(self, 0, 1)
> +        return self(0, 1)
> ```
> I think we are better making a direct call to `self.element_class(self, 0, 1)` since this is not user input.


I don't see the problem with using `__call__` here but I can make that change.



---

archive/issue_comments_461503.json:
```json
{
    "body": "Changing commit from \"22d309c01fcb79c5d8858f4eb5b140e4c51d2780\" to \"9ac1612c342c66a5d574a6c824b064e2a2ec076c\"",
    "created_at": "2018-02-13T08:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "22d309c01fcb79c5d8858f4eb5b140e4c51d2780" to "9ac1612c342c66a5d574a6c824b064e2a2ec076c"



---

archive/issue_comments_461504.json:
```json
{
    "body": "<a id='comment:50'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[9ac1612](https://git.sagemath.org/sage.git/commit/?id=9ac1612c342c66a5d574a6c824b064e2a2ec076c)|`Cleanup for real/complex interval fields`|",
    "created_at": "2018-02-13T08:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[9ac1612](https://git.sagemath.org/sage.git/commit/?id=9ac1612c342c66a5d574a6c824b064e2a2ec076c)|`Cleanup for real/complex interval fields`|



---

archive/issue_comments_461505.json:
```json
{
    "body": "<a id='comment:51'></a>\nReplying to [tscrim](#comment%3A48):\n> Cython would be able to optimize their attribute lookups by not treating them as Python objects?\n\n\nActually, the relevant attributes are `cdef` attributes, so they cannot even be accessed from Python! So the fact that the code works proves that Cython must be doing type inference.\n\nI changed some `self(...)` calls to `self.element_class(self, ...)`",
    "created_at": "2018-02-13T09:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461505",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:51'></a>
Replying to [tscrim](#comment%3A48):
> Cython would be able to optimize their attribute lookups by not treating them as Python objects?


Actually, the relevant attributes are `cdef` attributes, so they cannot even be accessed from Python! So the fact that the code works proves that Cython must be doing type inference.

I changed some `self(...)` calls to `self.element_class(self, ...)`



---

archive/issue_comments_461506.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-13T12:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461506",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_461507.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [jdemeyer](#comment%3A51):\n> Replying to [tscrim](#comment%3A48):\n> > Cython would be able to optimize their attribute lookups by not treating them as Python objects?\n\n> \n> Actually, the relevant attributes are `cdef` attributes, so they cannot even be accessed from Python! So the fact that the code works proves that Cython must be doing type inference.\n\n\nThat is what is happening, e.g.:\n\n```C\n  __pyx_t_1 = ((PyObject *)__pyx_f_4sage_5rings_16complex_interval_27ComplexIntervalFieldE\nlement__new(__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 325, __pyx_L1_error)\n  __Pyx_GOTREF(__pyx_t_1);\n  __pyx_v_a00 = ((struct __pyx_obj_4sage_5rings_16complex_interval_ComplexIntervalFieldEle\nment *)__pyx_t_1);\n  __pyx_t_1 = 0;\n```\nI didn't realize that Cython was that smart. :)\n\n> I changed some `self(...)` calls to `self.element_class(self, ...)`\n\n\nThank you. LGTM. (If I wanted to be **really** picky, I would say `self.element_class(self, 1)` should instead use the cached `self.one()`, but `zeta(1)` is almost certainly never called.)",
    "created_at": "2018-02-13T12:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461507",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:52'></a>
Replying to [jdemeyer](#comment%3A51):
> Replying to [tscrim](#comment%3A48):
> > Cython would be able to optimize their attribute lookups by not treating them as Python objects?

> 
> Actually, the relevant attributes are `cdef` attributes, so they cannot even be accessed from Python! So the fact that the code works proves that Cython must be doing type inference.


That is what is happening, e.g.:

```C
  __pyx_t_1 = ((PyObject *)__pyx_f_4sage_5rings_16complex_interval_27ComplexIntervalFieldE
lement__new(__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_a00 = ((struct __pyx_obj_4sage_5rings_16complex_interval_ComplexIntervalFieldEle
ment *)__pyx_t_1);
  __pyx_t_1 = 0;
```
I didn't realize that Cython was that smart. :)

> I changed some `self(...)` calls to `self.element_class(self, ...)`


Thank you. LGTM. (If I wanted to be **really** picky, I would say `self.element_class(self, 1)` should instead use the cached `self.one()`, but `zeta(1)` is almost certainly never called.)



---

archive/issue_comments_461508.json:
```json
{
    "body": "<a id='comment:53'></a>\nThanks!",
    "created_at": "2018-02-13T15:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461508",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:53'></a>
Thanks!



---

archive/issue_comments_461509.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-15T23:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461509",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_461510.json:
```json
{
    "body": "Changing branch from \"public/24371-move_real_complex_interval_fields_to_new_coercion_model\" to \"9ac1612c342c66a5d574a6c824b064e2a2ec076c\"",
    "created_at": "2018-02-15T23:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24371#issuecomment-461510",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/24371-move_real_complex_interval_fields_to_new_coercion_model" to "9ac1612c342c66a5d574a6c824b064e2a2ec076c"



---

archive/issue_events_061626.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-15T23:13:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24371#event-61626"
}
```
