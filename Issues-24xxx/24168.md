# Issue 24168: Upgrade Jupyter notebook

archive/issues_023931.json:
```json
{
    "body": "**Upstream tarballs**:\n\n1. https://pypi.python.org/packages/78/2f/3d1383505943268f1f6f9e4fbf226bd36ba05bc6b1f6b748294d456d2b0c/notebook-5.2.1.tar.gz#md5=ceb292c03c172947395d93b73a03e90e\n2. https://pypi.python.org/packages/b6/2d/2804f4de3a95583f65e5dcb4d7c8c7183124882323758996e867f47e72af/jupyter_core-4.4.0.tar.gz#md5=7829fc07884ed98459e170f217e2a5ba\n\nCC:  @jdemeyer @saraedum\n\nReviewer: Jeroen Demeyer\n\nAuthor: Nicolas M. Thi\u00e9ry\n\nBranch: 3f49dbc544b4796e39a7ac55ce943886d7962a4c\n\nDependencies: #24198\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24168\n\n",
    "closed_at": "2017-12-11T01:02:57Z",
    "created_at": "2017-11-06T21:04:54Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Upgrade Jupyter notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24168",
    "user": "https://github.com/nthiery"
}
```
**Upstream tarballs**:

1. https://pypi.python.org/packages/78/2f/3d1383505943268f1f6f9e4fbf226bd36ba05bc6b1f6b748294d456d2b0c/notebook-5.2.1.tar.gz#md5=ceb292c03c172947395d93b73a03e90e
2. https://pypi.python.org/packages/b6/2d/2804f4de3a95583f65e5dcb4d7c8c7183124882323758996e867f47e72af/jupyter_core-4.4.0.tar.gz#md5=7829fc07884ed98459e170f217e2a5ba

CC:  @jdemeyer @saraedum

Reviewer: Jeroen Demeyer

Author: Nicolas M. Thiéry

Branch: 3f49dbc544b4796e39a7ac55ce943886d7962a4c

Dependencies: #24198

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24168





---

archive/issue_comments_356907.json:
```json
{
    "body": "<a id='comment:1'></a>Beside manpower, is there any technical issue holding us from upgrading our package?\n\nA small piece of motivation: binder (http://mybinder.org) requires jupyter 5.*; so if we upgrade, our docker image will be directly binder ready; currently in https://github.com/sagemath/sage-binder-env/blob/master/Dockerfile, I force a Jupyter upgrade.",
    "created_at": "2017-11-06T21:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356907",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:1'></a>Beside manpower, is there any technical issue holding us from upgrading our package?

A small piece of motivation: binder (http://mybinder.org) requires jupyter 5.*; so if we upgrade, our docker image will be directly binder ready; currently in https://github.com/sagemath/sage-binder-env/blob/master/Dockerfile, I force a Jupyter upgrade.



---

archive/issue_comments_356908.json:
```json
{
    "body": "<a id='comment:2'></a>Reference: #22432",
    "created_at": "2017-11-06T21:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356908",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:2'></a>Reference: #22432



---

archive/issue_comments_356909.json:
```json
{
    "body": "<a id='comment:3'></a>Go for it..",
    "created_at": "2017-11-06T21:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356909",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:3'></a>Go for it..



---

archive/issue_comments_356910.json:
```json
{
    "body": "<a id='comment:4'></a>I think there is some confusion here. `jupyter --version` returns the version of `jupyter_core` which has a 4.4.0 release in the last 6 days.[https://github.com/jupyter/jupyter_core/releases](https://github.com/jupyter/jupyter_core/releases)\n\nThen there is the notebook, which is what you looked at with the pip command, the last release of that is indeed 5.2.1 [https://github.com/jupyter/notebook/releases](https://github.com/jupyter/notebook/releases) from 3 days ago. sage is at 4.4.1 (sage-on-gentoo is at 5.0.0) so yes we could upgrade that.\n\nOf course jupyter doesn't make it easy for you to figure the version of it components and what goes with what.",
    "created_at": "2017-11-06T21:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356910",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>I think there is some confusion here. `jupyter --version` returns the version of `jupyter_core` which has a 4.4.0 release in the last 6 days.[https://github.com/jupyter/jupyter_core/releases](https://github.com/jupyter/jupyter_core/releases)

Then there is the notebook, which is what you looked at with the pip command, the last release of that is indeed 5.2.1 [https://github.com/jupyter/notebook/releases](https://github.com/jupyter/notebook/releases) from 3 days ago. sage is at 4.4.1 (sage-on-gentoo is at 5.0.0) so yes we could upgrade that.

Of course jupyter doesn't make it easy for you to figure the version of it components and what goes with what.



---

archive/issue_comments_356911.json:
```json
{
    "body": "<a id='comment:5'></a>Also keep in mind that some pieces of Jupyter (I don't recall exactly which) are Python 3 only in their latest releases.",
    "created_at": "2017-11-07T08:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356911",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Also keep in mind that some pieces of Jupyter (I don't recall exactly which) are Python 3 only in their latest releases.



---

archive/issue_comments_356912.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 jdemeyer]:\n> Also keep in mind that some pieces of Jupyter (I don't recall exactly which) are Python 3 only in their latest releases.\n\n\nipython-6 is python3 only. However it looks like looks ipython-5 still gets regular releases for python 2.7.",
    "created_at": "2017-11-07T09:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356912",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>Replying to [comment:5 jdemeyer]:
> Also keep in mind that some pieces of Jupyter (I don't recall exactly which) are Python 3 only in their latest releases.


ipython-6 is python3 only. However it looks like looks ipython-5 still gets regular releases for python 2.7.



---

archive/issue_comments_356913.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks Fran\u00e7ois for the clarification.\n\nI am on it. I'll use the latest version suggested by pip; pip now knows not to suggest versions that are not compatible with Python's version.\n\nHopefuly no other dependency than jupyter_core needs to be updated!",
    "created_at": "2017-11-07T10:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356913",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:7'></a>Thanks François for the clarification.

I am on it. I'll use the latest version suggested by pip; pip now knows not to suggest versions that are not compatible with Python's version.

Hopefuly no other dependency than jupyter_core needs to be updated!



---

archive/issue_comments_356914.json:
```json
{
    "body": "<a id='comment:8'></a>Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...\n\n```\n[I 11:31:18.215 NotebookApp] Creating new notebook in \n[E 11:31:19.356 NotebookApp] Failed to run command:\n    [u'/usr/bin/sage', u'--python', u'-m', u'sage.repl.ipython_kernel', u'-f', u'/run/user/1000/jupyter/kernel-bf16b426-18eb-4f1b-80ff-4579ddecf42d.json']\n        PATH='/opt/sage-git/build/bin:/opt/sage-git/src/bin:/opt/sage-git/local/bin:/opt/miniconda3/bin:.:/home/nthiery/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/bin/X11:/usr/etc'\n        with kwargs:\n    {'cwd': u'/home/nthiery/tmp', 'stdin': -1, 'preexec_fn': <function <lambda> at 0x7f9eef435c80>, 'stderr': None, 'stdout': None}\n }}}",
    "created_at": "2017-11-07T10:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356914",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...

```
[I 11:31:18.215 NotebookApp] Creating new notebook in 
[E 11:31:19.356 NotebookApp] Failed to run command:
    [u'/usr/bin/sage', u'--python', u'-m', u'sage.repl.ipython_kernel', u'-f', u'/run/user/1000/jupyter/kernel-bf16b426-18eb-4f1b-80ff-4579ddecf42d.json']
        PATH='/opt/sage-git/build/bin:/opt/sage-git/src/bin:/opt/sage-git/local/bin:/opt/miniconda3/bin:.:/home/nthiery/bin:/usr/games:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/bin/X11:/usr/etc'
        with kwargs:
    {'cwd': u'/home/nthiery/tmp', 'stdin': -1, 'preexec_fn': <function <lambda> at 0x7f9eef435c80>, 'stderr': None, 'stdout': None}
 }}}



---

archive/issue_comments_356915.json:
```json
{
    "body": "<a id='comment:10'></a>New commits:",
    "created_at": "2017-11-07T10:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356915",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:10'></a>New commits:



---

archive/issue_comments_356916.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -12,6 +12,12 @@\n 4.3.0\n ```\n \n+Upstream tarballs:\n+\n+https://pypi.python.org/packages/78/2f/3d1383505943268f1f6f9e4fbf226bd36ba05bc6b1f6b748294d456d2b0c/notebook-5.2.1.tar.gz#md5=ceb292c03c172947395d93b73a03e90e\n+https://pypi.python.org/packages/b6/2d/2804f4de3a95583f65e5dcb4d7c8c7183124882323758996e867f47e72af/jupyter_core-4.4.0.tar.gz#md5=7829fc07884ed98459e170f217e2a5ba\n+\n+\n Comment: 1\n \n Summary: Upgrade to Jupyter 5.*\n```\n",
    "created_at": "2017-11-07T10:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356916",
    "user": "https://github.com/nthiery"
}
```

Description changed:
```diff
--- 
+++ 
@@ -12,6 +12,12 @@
 4.3.0
 ```
 
+Upstream tarballs:
+
+https://pypi.python.org/packages/78/2f/3d1383505943268f1f6f9e4fbf226bd36ba05bc6b1f6b748294d456d2b0c/notebook-5.2.1.tar.gz#md5=ceb292c03c172947395d93b73a03e90e
+https://pypi.python.org/packages/b6/2d/2804f4de3a95583f65e5dcb4d7c8c7183124882323758996e867f47e72af/jupyter_core-4.4.0.tar.gz#md5=7829fc07884ed98459e170f217e2a5ba
+
+
 Comment: 1
 
 Summary: Upgrade to Jupyter 5.*
```




---

archive/issue_comments_356917.json:
```json
{
    "body": "<a id='comment:11'></a>****Replying to [comment:8 nthiery]:\n> Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...\n\n\nThat was unrelated: I had an old kernelspec from Sage's debian package\nwhich was taking precedence and getting confused because in the mean\ntime I had uninstalled this package.\n\nThus I guess it's a needs review.\n\nI am not sure though what's the right way to test this?",
    "created_at": "2017-11-07T10:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356917",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:11'></a>****Replying to [comment:8 nthiery]:
> Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...


That was unrelated: I had an old kernelspec from Sage's debian package
which was taking precedence and getting confused because in the mean
time I had uninstalled this package.

Thus I guess it's a needs review.

I am not sure though what's the right way to test this?



---

archive/issue_comments_356918.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-07T10:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356918",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_356919.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n+**Upstream tarballs**:\n \n+1. https://pypi.python.org/packages/78/2f/3d1383505943268f1f6f9e4fbf226bd36ba05bc6b1f6b748294d456d2b0c/notebook-5.2.1.tar.gz#md5=ceb292c03c172947395d93b73a03e90e\n+2. https://pypi.python.org/packages/b6/2d/2804f4de3a95583f65e5dcb4d7c8c7183124882323758996e867f47e72af/jupyter_core-4.4.0.tar.gz#md5=7829fc07884ed98459e170f217e2a5ba\n \n Comment: 1\n \n```\n",
    "created_at": "2017-11-07T16:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356919",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,7 @@
+**Upstream tarballs**:
 
+1. https://pypi.python.org/packages/78/2f/3d1383505943268f1f6f9e4fbf226bd36ba05bc6b1f6b748294d456d2b0c/notebook-5.2.1.tar.gz#md5=ceb292c03c172947395d93b73a03e90e
+2. https://pypi.python.org/packages/b6/2d/2804f4de3a95583f65e5dcb4d7c8c7183124882323758996e867f47e72af/jupyter_core-4.4.0.tar.gz#md5=7829fc07884ed98459e170f217e2a5ba
 
 Comment: 1
 
```




---

archive/issue_comments_356920.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 nthiery]:\n> I am not sure though what's the right way to test this?\n\n\nPretty much the only thing to do at this stage is to run ptestlong and then if that pass, wait for people complaining about change of behavior <sup>_</sup>",
    "created_at": "2017-11-07T22:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356920",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:14'></a>Replying to [comment:11 nthiery]:
> I am not sure though what's the right way to test this?


Pretty much the only thing to do at this stage is to run ptestlong and then if that pass, wait for people complaining about change of behavior <sup>_</sup>



---

archive/issue_comments_356921.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:11 nthiery]:\n> ****Replying to [comment:8 nthiery]:\n> > Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...\n\n> \n> That was unrelated: I had an old kernelspec from Sage's debian package\n> which was taking precedence and getting confused because in the mean\n> time I had uninstalled this package.\n> \n> Thus I guess it's a needs review.\n> \n> I am not sure though what's the right way to test this?\n\n\nI'll test that it builds properly (I screwed up no less than 2 tickets this way in the latest beta). For that, I'm rebasing on #24088.\n\n---\nNew commits:",
    "created_at": "2017-11-08T12:59:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356921",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:11 nthiery]:
> ****Replying to [comment:8 nthiery]:
> > Hmm, with the branch I am about to push, I get the following error upon creating a Sage notebook. Will investigate later ...

> 
> That was unrelated: I had an old kernelspec from Sage's debian package
> which was taking precedence and getting confused because in the mean
> time I had uninstalled this package.
> 
> Thus I guess it's a needs review.
> 
> I am not sure though what's the right way to test this?


I'll test that it builds properly (I screwed up no less than 2 tickets this way in the latest beta). For that, I'm rebasing on #24088.

---
New commits:



---

archive/issue_comments_356922.json:
```json
{
    "body": "<a id='comment:17'></a>Builds fine and passes `make ptestlong`. So all that remains is to check that it actually works interactively.",
    "created_at": "2017-11-10T15:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356922",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Builds fine and passes `make ptestlong`. So all that remains is to check that it actually works interactively.



---

archive/issue_comments_356923.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-13T13:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356923",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_356924.json:
```json
{
    "body": "<a id='comment:19'></a>New commits:",
    "created_at": "2017-11-13T13:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356924",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>New commits:



---

archive/issue_comments_356925.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-11-13T14:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356925",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_356926.json:
```json
{
    "body": "<a id='comment:21'></a>Any chance to get this into 8.1 or is it too late?\nThat would ease deployment of mybinder thingies.",
    "created_at": "2017-11-16T10:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356926",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:21'></a>Any chance to get this into 8.1 or is it too late?
That would ease deployment of mybinder thingies.



---

archive/issue_comments_356927.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 jpflori]:\n> Any chance to get this into 8.1\n\n\n-1\n\nHaving a working Jupyter is too important to push this now.",
    "created_at": "2017-11-16T10:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356927",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Replying to [comment:21 jpflori]:
> Any chance to get this into 8.1


-1

Having a working Jupyter is too important to push this now.



---

archive/issue_comments_356928.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-11T01:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356928",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061284.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:02:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24168#event-61284"
}
```



---

archive/issue_comments_356929.json:
```json
{
    "body": "<a id='comment:24'></a>See #24484 for a follow-up (nbconvert broken).",
    "created_at": "2018-01-07T16:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24168",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24168#issuecomment-356929",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:24'></a>See #24484 for a follow-up (nbconvert broken).
