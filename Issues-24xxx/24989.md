# Issue 24989: G.edges_incident returns edges with vertices swapped

archive/issues_024752.json:
```json
{
    "body": "\n```\nsage: G = (graphs.PathGraph(4)).relabel(immutable=True, inplace=False)\nsage: G.edges(labels=False)\n[(0, 1), (1, 2), (2, 3)]\nsage: G.edges_incident([1,2], labels=False)\n[(1, 0), (1, 2), (2, 3)]\n```\n\nI would expect that `G.edges_incident` returns a subset of `G.edges`\n\n**Branch:** [u/gh-peelin/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-peelin/ticket24989)\n\n**Commit:** [9bfc1992cb8981f7be6a67a598cbbccf1bcc3442](https://github.com/sagemath/sagetrac-mirror/commit/9bfc1992cb8981f7be6a67a598cbbccf1bcc3442)\n\n**Status:** needs_review\n\nIssue created by migration from https://trac.sagemath.org/ticket/24989\n\n",
    "created_at": "2018-03-15T20:17:47Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "G.edges_incident returns edges with vertices swapped",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24989",
    "user": "https://github.com/mantepse"
}
```

```
sage: G = (graphs.PathGraph(4)).relabel(immutable=True, inplace=False)
sage: G.edges(labels=False)
[(0, 1), (1, 2), (2, 3)]
sage: G.edges_incident([1,2], labels=False)
[(1, 0), (1, 2), (2, 3)]
```

I would expect that `G.edges_incident` returns a subset of `G.edges`

**Branch:** [u/gh-peelin/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-peelin/ticket24989)

**Commit:** [9bfc1992cb8981f7be6a67a598cbbccf1bcc3442](https://github.com/sagemath/sagetrac-mirror/commit/9bfc1992cb8981f7be6a67a598cbbccf1bcc3442)

**Status:** needs_review

Issue created by migration from https://trac.sagemath.org/ticket/24989





---

archive/issue_comments_477483.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is due to method `iterator_edges` of the `static_sparse_graph` backend.\n\n```\nsage: G = (graphs.PathGraph(4)).relabel(immutable=True, inplace=False)\nsage: G._backend\n<sage.graphs.base.static_sparse_backend.StaticSparseBackend object at 0x2198ceea8>\nsage: G.edges_incident([1,2], labels=False)\n[(1, 0), (1, 2), (2, 3)]\nsage: list(G.edge_iterator([1,2], labels=False))\n[(1, 0), (1, 2), (2, 3)]\nsage:\nsage: G = (graphs.PathGraph(4)).relabel(immutable=False, inplace=False)\nsage: G._backend\n<sage.graphs.base.sparse_graph.SparseGraphBackend object at 0x218d369d0>\nsage: G.edges_incident([1,2], labels=False)\n[(0, 1), (1, 2), (2, 3)]\nsage: list(G.edge_iterator([1,2], labels=False))\n[(0, 1), (1, 2), (2, 3)]\n```",
    "created_at": "2018-03-16T08:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477483",
    "user": "https://github.com/dcoudert"
}
```


<a id='comment:1'></a>
This is due to method `iterator_edges` of the `static_sparse_graph` backend.

```
sage: G = (graphs.PathGraph(4)).relabel(immutable=True, inplace=False)
sage: G._backend
<sage.graphs.base.static_sparse_backend.StaticSparseBackend object at 0x2198ceea8>
sage: G.edges_incident([1,2], labels=False)
[(1, 0), (1, 2), (2, 3)]
sage: list(G.edge_iterator([1,2], labels=False))
[(1, 0), (1, 2), (2, 3)]
sage:
sage: G = (graphs.PathGraph(4)).relabel(immutable=False, inplace=False)
sage: G._backend
<sage.graphs.base.sparse_graph.SparseGraphBackend object at 0x218d369d0>
sage: G.edges_incident([1,2], labels=False)
[(0, 1), (1, 2), (2, 3)]
sage: list(G.edge_iterator([1,2], labels=False))
[(0, 1), (1, 2), (2, 3)]
```



---

archive/issue_comments_477484.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-02-08T19:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477484",
    "user": "https://github.com/vipul79321"
}
```


**Changing status** from new to needs_review.



---

archive/issue_comments_477485.json:
```json
{
    "body": "**Branch:** [u/vipul_gupta/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/vipul_gupta/ticket24989)",
    "created_at": "2020-02-08T19:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477485",
    "user": "https://github.com/vipul79321"
}
```


**Branch:** [u/vipul_gupta/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/vipul_gupta/ticket24989)



---

archive/issue_comments_477486.json:
```json
{
    "body": "**Changing branch** from \"[u/vipul_gupta/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/vipul_gupta/ticket24989)\" to \"\".",
    "created_at": "2020-02-08T19:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477486",
    "user": "https://github.com/vipul79321"
}
```


**Changing branch** from "[u/vipul_gupta/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/vipul_gupta/ticket24989)" to "".



---

archive/issue_comments_477487.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-02-08T19:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477487",
    "user": "https://github.com/vipul79321"
}
```


**Changing status** from needs_review to needs_work.



---

archive/issue_comments_477488.json:
```json
{
    "body": "**Branch:** [u/gh-vipul79321/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-vipul79321/ticket24989)",
    "created_at": "2020-02-08T19:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477488",
    "user": "https://github.com/vipul79321"
}
```


**Branch:** [u/gh-vipul79321/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-vipul79321/ticket24989)



---

archive/issue_comments_477489.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cef6f9ed666d6aeb588567a80df19153a4390e86\">cef6f9e</a></td><td><code>Edges_incident modified</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b9695c2238950cedeb01ed034a3002f8fab970\">89b9695</a></td><td><code>Edges_incident modified</code></td></tr></table>\n",
    "created_at": "2020-02-08T19:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477489",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cef6f9ed666d6aeb588567a80df19153a4390e86">cef6f9e</a></td><td><code>Edges_incident modified</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b9695c2238950cedeb01ed034a3002f8fab970">89b9695</a></td><td><code>Edges_incident modified</code></td></tr></table>




---

archive/issue_comments_477490.json:
```json
{
    "body": "**Commit:** [89b9695c2238950cedeb01ed034a3002f8fab970](https://github.com/sagemath/sagetrac-mirror/commit/89b9695c2238950cedeb01ed034a3002f8fab970)",
    "created_at": "2020-02-08T19:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477490",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Commit:** [89b9695c2238950cedeb01ed034a3002f8fab970](https://github.com/sagemath/sagetrac-mirror/commit/89b9695c2238950cedeb01ed034a3002f8fab970)



---

archive/issue_comments_477491.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-02-08T19:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477491",
    "user": "https://github.com/vipul79321"
}
```


**Changing status** from needs_work to needs_review.



---

archive/issue_comments_477492.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-02-09T10:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477492",
    "user": "https://github.com/dcoudert"
}
```


**Changing status** from needs_review to needs_work.



---

archive/issue_events_071298.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-02-09T10:44:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71298"
}
```




---

archive/issue_comments_477493.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, this is not an acceptable solution. We do our best to provide as fast as possible solutions and making a copy of the graph is a too expensive operation for this purpose. Furthermore, it is not algorithmically sounded as it relies only on the way the copy is done. \n\nThe problem must be fixed in the backend.",
    "created_at": "2020-02-09T10:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477493",
    "user": "https://github.com/dcoudert"
}
```


<a id='comment:8'></a>
No, this is not an acceptable solution. We do our best to provide as fast as possible solutions and making a copy of the graph is a too expensive operation for this purpose. Furthermore, it is not algorithmically sounded as it relies only on the way the copy is done. 

The problem must be fixed in the backend.



---

archive/issue_comments_477494.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [dcoudert](#comment%3A8):\n> No, this is not an acceptable solution. We do our best to provide as fast as possible solutions and making a copy of the graph is a too expensive operation for this purpose. Furthermore, it is not algorithmically sounded as it relies only on the way the copy is done.\n\nYeah, I agree that it is not fast. We can also try to pass another argument 'bool is_immutable'. So that our function will make copy of the graph only when it is immutable. \n> \n> The problem must be fixed in the backend.\n\nI dont think it is worth it to make changes in backend for this purpose.",
    "created_at": "2020-02-09T10:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477494",
    "user": "https://github.com/vipul79321"
}
```


<a id='comment:9'></a>
Replying to [dcoudert](#comment%3A8):
> No, this is not an acceptable solution. We do our best to provide as fast as possible solutions and making a copy of the graph is a too expensive operation for this purpose. Furthermore, it is not algorithmically sounded as it relies only on the way the copy is done.

Yeah, I agree that it is not fast. We can also try to pass another argument 'bool is_immutable'. So that our function will make copy of the graph only when it is immutable. 
> 
> The problem must be fixed in the backend.

I dont think it is worth it to make changes in backend for this purpose.



---

archive/issue_comments_477495.json:
```json
{
    "body": "<a id='comment:10'></a>\nThis problem must be fixed without copy of the graph, and FYI, we can check if a graph is immutable or not using `G.is_immutable()`.",
    "created_at": "2020-02-09T11:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477495",
    "user": "https://github.com/dcoudert"
}
```


<a id='comment:10'></a>
This problem must be fixed without copy of the graph, and FYI, we can check if a graph is immutable or not using `G.is_immutable()`.



---

archive/issue_events_071299.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71299"
}
```




---

archive/issue_events_071300.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71300"
}
```




---

archive/issue_comments_477496.json:
```json
{
    "body": "<a id='comment:11'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477496",
    "user": "https://github.com/mkoeppe"
}
```


<a id='comment:11'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_071301.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71301"
}
```




---

archive/issue_events_071302.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71302"
}
```




---

archive/issue_events_071303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71303"
}
```




---

archive/issue_events_071304.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71304"
}
```




---

archive/issue_comments_477497.json:
```json
{
    "body": "<a id='comment:13'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477497",
    "user": "https://github.com/mkoeppe"
}
```


<a id='comment:13'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_071305.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71305"
}
```




---

archive/issue_events_071306.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71306"
}
```




---

archive/issue_events_071307.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71307"
}
```




---

archive/issue_events_071308.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71308"
}
```




---

archive/issue_events_071309.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71309"
}
```




---

archive/issue_events_071310.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:19:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71310"
}
```




---

archive/issue_events_071311.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71311"
}
```




---

archive/issue_events_071312.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24989#event-71312"
}
```




---

archive/issue_comments_477498.json:
```json
{
    "body": "**Changing commit** from \"[89b9695c2238950cedeb01ed034a3002f8fab970](https://github.com/sagemath/sagetrac-mirror/commit/89b9695c2238950cedeb01ed034a3002f8fab970)\" to \"[9bfc1992cb8981f7be6a67a598cbbccf1bcc3442](https://github.com/sagemath/sagetrac-mirror/commit/9bfc1992cb8981f7be6a67a598cbbccf1bcc3442)\".",
    "created_at": "2022-12-15T23:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477498",
    "user": "https://github.com/peelin"
}
```


**Changing commit** from "[89b9695c2238950cedeb01ed034a3002f8fab970](https://github.com/sagemath/sagetrac-mirror/commit/89b9695c2238950cedeb01ed034a3002f8fab970)" to "[9bfc1992cb8981f7be6a67a598cbbccf1bcc3442](https://github.com/sagemath/sagetrac-mirror/commit/9bfc1992cb8981f7be6a67a598cbbccf1bcc3442)".



---

archive/issue_comments_477499.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2022-12-15T23:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477499",
    "user": "https://github.com/peelin"
}
```


**Changing status** from needs_work to needs_review.



---

archive/issue_comments_477500.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-vipul79321/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-vipul79321/ticket24989)\" to \"[u/gh-peelin/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-peelin/ticket24989)\".",
    "created_at": "2022-12-15T23:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477500",
    "user": "https://github.com/peelin"
}
```


**Changing branch** from "[u/gh-vipul79321/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-vipul79321/ticket24989)" to "[u/gh-peelin/ticket24989](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-peelin/ticket24989)".



---

archive/issue_comments_477501.json:
```json
{
    "body": "<a id='comment:18'></a>\nNew commit:\n\nhttps://git.sagemath.org/sage.git/commit/?h=u/gh-peelin/ticket24989",
    "created_at": "2022-12-15T23:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477501",
    "user": "https://github.com/peelin"
}
```


<a id='comment:18'></a>
New commit:

https://git.sagemath.org/sage.git/commit/?h=u/gh-peelin/ticket24989



---

archive/issue_comments_477502.json:
```json
{
    "body": "<a id='comment:19'></a>\nI  see 2 issues in your code\n\n```diff\n-                if j < i and j in b_vertices:\n-                    continue\n+\n+                # Guarantees that vertex ordering is consistent\n+                if j < i:\n+                    if j in b_vertices:\n+                        continue\n+                    else:\n+                        v1, v2 = self._vertex_to_labels[j], vi\n+                else:\n+                    v1, v2 = vi, self._vertex_to_labels[j]\n```\n\n- an an edge can now be returned twice. Before an edge was returned only when `j >= i`\n- you assume that if `i < j` then the label of `i` is smaller than the label of `j`, but there is no reason for that.",
    "created_at": "2022-12-17T08:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477502",
    "user": "https://github.com/dcoudert"
}
```


<a id='comment:19'></a>
I  see 2 issues in your code

```diff
-                if j < i and j in b_vertices:
-                    continue
+
+                # Guarantees that vertex ordering is consistent
+                if j < i:
+                    if j in b_vertices:
+                        continue
+                    else:
+                        v1, v2 = self._vertex_to_labels[j], vi
+                else:
+                    v1, v2 = vi, self._vertex_to_labels[j]
```

- an an edge can now be returned twice. Before an edge was returned only when `j >= i`
- you assume that if `i < j` then the label of `i` is smaller than the label of `j`, but there is no reason for that.



---

archive/issue_comments_477503.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2022-12-17T08:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477503",
    "user": "https://github.com/dcoudert"
}
```


**Changing status** from needs_review to needs_work.



---

archive/issue_comments_477504.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [David Coudert](#comment%3A19):\n> I  see 2 issues in your code\n> \n> ```diff\n> -                if j < i and j in b_vertices:\n> -                    continue\n> +\n> +                # Guarantees that vertex ordering is consistent\n> +                if j < i:\n> +                    if j in b_vertices:\n> +                        continue\n> +                    else:\n> +                        v1, v2 = self._vertex_to_labels[j], vi\n> +                else:\n> +                    v1, v2 = vi, self._vertex_to_labels[j]\n> ```\n> \n> - an an edge can now be returned twice. Before an edge was returned only when `j >= i`\n> - you assume that if `i < j` then the label of `i` is smaller than the label of `j`, but there is no reason for that.\n\n\n- The edges returned are the same edges as the ones returned before: which was when `j>=i or  j not in b_vertices`. I used a nested if statement to minimize the performance penalty from this change.\n\n- I am not claiming that the output edge (v1, v2) will satisfy v1 < v2, in fact the vertex labels might not even be comparable. I am only guaranteeing that if the edge is output as (v1, v2), then any other time this edge appears (in a different call), only (v1, v2) will be seen and not (v2, v1). I believe this fixes the issue because `G.edges` also internally calls `iterator_edges`.",
    "created_at": "2022-12-17T16:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477504",
    "user": "https://github.com/peelin"
}
```


<a id='comment:20'></a>
Replying to [David Coudert](#comment%3A19):
> I  see 2 issues in your code
> 
> ```diff
> -                if j < i and j in b_vertices:
> -                    continue
> +
> +                # Guarantees that vertex ordering is consistent
> +                if j < i:
> +                    if j in b_vertices:
> +                        continue
> +                    else:
> +                        v1, v2 = self._vertex_to_labels[j], vi
> +                else:
> +                    v1, v2 = vi, self._vertex_to_labels[j]
> ```
> 
> - an an edge can now be returned twice. Before an edge was returned only when `j >= i`
> - you assume that if `i < j` then the label of `i` is smaller than the label of `j`, but there is no reason for that.


- The edges returned are the same edges as the ones returned before: which was when `j>=i or  j not in b_vertices`. I used a nested if statement to minimize the performance penalty from this change.

- I am not claiming that the output edge (v1, v2) will satisfy v1 < v2, in fact the vertex labels might not even be comparable. I am only guaranteeing that if the edge is output as (v1, v2), then any other time this edge appears (in a different call), only (v1, v2) will be seen and not (v2, v1). I believe this fixes the issue because `G.edges` also internally calls `iterator_edges`.



---

archive/issue_comments_477505.json:
```json
{
    "body": "<a id='comment:21'></a>\nRight, I was too fast in real the code.\n\nI did some tests and it seems ok, but let's wait for the patchbot.",
    "created_at": "2022-12-17T16:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477505",
    "user": "https://github.com/dcoudert"
}
```


<a id='comment:21'></a>
Right, I was too fast in real the code.

I did some tests and it seems ok, but let's wait for the patchbot.



---

archive/issue_comments_477506.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2022-12-17T16:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24989",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24989#issuecomment-477506",
    "user": "https://github.com/dcoudert"
}
```


**Changing status** from needs_work to needs_review.
