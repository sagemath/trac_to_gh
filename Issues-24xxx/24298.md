# Issue 24298: Improve Morphism.is_identity()

archive/issues_024061.json:
```json
{
    "assignees": [],
    "body": "Just make `phi.is_identity()` an alias of `phi == phi.parent().identity()`\n\nDepends on #24281\n\nCC:  @tscrim\n\nBranch/Commit: **[3479550](https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24298_\n\n",
    "closed_at": "2017-12-13T17:37:42Z",
    "created_at": "2017-11-29T14:15:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20categories",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Improve Morphism.is_identity()",
    "type": "issue",
    "updated_at": "2017-12-13T17:37:42Z",
    "url": "https://github.com/sagemath/sage/issues/24298",
    "user": "https://github.com/jdemeyer"
}
```
Just make `phi.is_identity()` an alias of `phi == phi.parent().identity()`

Depends on #24281

CC:  @tscrim

Branch/Commit: **[3479550](https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220)**

Reviewer: **Travis Scrimshaw**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/24298_





---

archive/issue_events_307527.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T14:15:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307527"
}
```



---

archive/issue_events_307528.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T14:15:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20categories",
    "label_color": "0000ff",
    "label_name": "component: categories",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307528"
}
```



---

archive/issue_events_307529.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T14:15:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307529"
}
```



---

archive/issue_events_307530.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T14:15:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307530"
}
```



---

archive/issue_comments_370486.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Just make `phi.is_identity()` an alias of `phi == phi.parent().identity()`\n``````\n",
    "created_at": "2017-11-29T14:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370486",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Just make `phi.is_identity()` an alias of `phi == phi.parent().identity()`
``````




---

archive/issue_comments_370487.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/24298](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24298)**",
    "created_at": "2017-11-29T14:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370487",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/24298](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24298)**



---

archive/issue_comments_370488.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1\">25dc2fd</a></td><td><code>Fix comparison of morphisms</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29ad327949cf4067c46f120a33e49e17968f3cd9\">29ad327</a></td><td><code>Improve Morphism.is_identity()</code></td></tr></table>\n",
    "created_at": "2017-11-29T14:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370488",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'>Comment 3:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/25dc2fd6ccedf57b5ae30caa9e452b5c90ed51b1">25dc2fd</a></td><td><code>Fix comparison of morphisms</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29ad327949cf4067c46f120a33e49e17968f3cd9">29ad327</a></td><td><code>Improve Morphism.is_identity()</code></td></tr></table>




---

archive/issue_events_307531.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-29T14:35:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307531"
}
```



---

archive/issue_comments_370489.json:
```json
{
    "body": "Commit: **[29ad327](https://github.com/sagemath/sagetrac-mirror/commit/29ad327949cf4067c46f120a33e49e17968f3cd9)**",
    "created_at": "2017-11-29T14:35:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370489",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[29ad327](https://github.com/sagemath/sagetrac-mirror/commit/29ad327949cf4067c46f120a33e49e17968f3cd9)**



---

archive/issue_comments_370490.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nWhat do you think about just having:\n\n```python\ndef is_identity(self):\n   return self._richcmp_(self._parent.identity(), Py_EQ)\n```\nand letting the parent handle the verification of being an endomorphism ring? IMO, this is more future-proof if we end up having a subclass `Endset` of `Homset`, where we could avoid the check. We might also want to cache the result of `identity` so we don't have to recreate a (simple) identity map on every call.\n\nOtherwise LGTM.",
    "created_at": "2017-11-30T01:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370490",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'>Comment 4:</a>
What do you think about just having:

```python
def is_identity(self):
   return self._richcmp_(self._parent.identity(), Py_EQ)
```
and letting the parent handle the verification of being an endomorphism ring? IMO, this is more future-proof if we end up having a subclass `Endset` of `Homset`, where we could avoid the check. We might also want to cache the result of `identity` so we don't have to recreate a (simple) identity map on every call.

Otherwise LGTM.



---

archive/issue_comments_370491.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2017-11-30T01:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370491",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_370492.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@tscrim](#comment%3A4):\n> What do you think about just having:\n> \n> ```python\n> def is_identity(self):\n>    return self._richcmp_(self._parent.identity(), Py_EQ)\n> ```\n\nThat would be slightly less efficient because of the extra level of indirection. But you are right in principle.",
    "created_at": "2017-11-30T09:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370492",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@tscrim](#comment%3A4):
> What do you think about just having:
> 
> ```python
> def is_identity(self):
>    return self._richcmp_(self._parent.identity(), Py_EQ)
> ```

That would be slightly less efficient because of the extra level of indirection. But you are right in principle.



---

archive/issue_comments_370493.json:
```json
{
    "body": "Changed commit from **[29ad327](https://github.com/sagemath/sagetrac-mirror/commit/29ad327949cf4067c46f120a33e49e17968f3cd9)** to **[3479550](https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220)**",
    "created_at": "2017-11-30T10:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370493",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[29ad327](https://github.com/sagemath/sagetrac-mirror/commit/29ad327949cf4067c46f120a33e49e17968f3cd9)** to **[3479550](https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220)**



---

archive/issue_comments_370494.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220\">3479550</a></td><td><code>Improve Morphism.is_identity()</code></td></tr></table>\n",
    "created_at": "2017-11-30T10:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370494",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220">3479550</a></td><td><code>Improve Morphism.is_identity()</code></td></tr></table>




---

archive/issue_comments_370495.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nLike this?",
    "created_at": "2017-11-30T10:43:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370495",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'>Comment 7:</a>
Like this?



---

archive/issue_comments_370496.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThere would be indirection until we have `identity` being a `@cached_method` (except for the first call of course). Yes, I do like that better (I forgot we do not want to propagate the error). Although it will always be slower in returning false because it needs to throw and catch the error. I guess there is a question of how much do we expect that users call this on non-endomorphism homsets? We should just override `is_endomorphism_set` to return `True` for the endset category, which is now #24304.",
    "created_at": "2017-11-30T11:44:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370496",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'>Comment 8:</a>
There would be indirection until we have `identity` being a `@cached_method` (except for the first call of course). Yes, I do like that better (I forgot we do not want to propagate the error). Although it will always be slower in returning false because it needs to throw and catch the error. I guess there is a question of how much do we expect that users call this on non-endomorphism homsets? We should just override `is_endomorphism_set` to return `True` for the endset category, which is now #24304.



---

archive/issue_comments_370497.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nWhat I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.\n\nI do plan on going further with #24304 and moving stuff from #24277 up to the category level (but at least for tonight I do not want to watch `morphism.pyx` and all the things that depend on it recompile `^^;;` ).",
    "created_at": "2017-11-30T11:49:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370497",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'>Comment 9:</a>
What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.

I do plan on going further with #24304 and moving stuff from #24277 up to the category level (but at least for tonight I do not want to watch `morphism.pyx` and all the things that depend on it recompile `^^;;` ).



---

archive/issue_comments_370498.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@tscrim](#comment%3A9):\n> What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.\n\nI think so. Calling `is_identity()` is pretty meaningless on a non-Endset so I hope that it doesn't happen often in serious code.",
    "created_at": "2017-11-30T12:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370498",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@tscrim](#comment%3A9):
> What I am asking if you are okay with a speed penalty here for when a user doesn't realize that they are trying to check if it is the identity morphism over something that is not an endomorphism ring.

I think so. Calling `is_identity()` is pretty meaningless on a non-Endset so I hope that it doesn't happen often in serious code.



---

archive/issue_events_307532.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-30T12:46:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307532"
}
```



---

archive/issue_events_307533.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-11-30T12:46:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307533"
}
```



---

archive/issue_comments_370499.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThen positive review. Thank you.",
    "created_at": "2017-11-30T12:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370499",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'>Comment 11:</a>
Then positive review. Thank you.



---

archive/issue_comments_370500.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/24298](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24298)** to **[3479550](https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220)**",
    "created_at": "2017-12-13T17:37:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24298#issuecomment-370500",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/24298](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24298)** to **[3479550](https://github.com/sagemath/sagetrac-mirror/commit/3479550c0e9d32362144072855fd116f41dc4220)**



---

archive/issue_events_307534.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-13T17:37:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307534"
}
```



---

archive/issue_events_307535.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "48095031fe5bdc3c3e6f6cff24a05414fe8dee7d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-13T17:37:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24298",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24298#event-307535"
}
```
