# Issue 24651: Disable pexpect echo when starting the interface

archive/issues_024414.json:
```json
{
    "body": "On Solaris, the Singular pexpect interface is broken:\n\n```\nsage: t=singular(0)\n---------------------------------------------------------------------------\nIOError                                   Traceback (most recent call last)\n<ipython-input-1-43d8f01f1d2c> in <module>()\n----> 1 t=singular(Integer(0))\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)\n    787             return self(x.sage())\n    788         elif not isinstance(x, ExpectElement) and hasattr(x, '_singular_'):\n--> 789             return x._singular_(self)\n    790 \n    791         # some convenient conversions\n\n/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._singular_ (build/cythonized/sage/structure/sage_object.c:11739)()\n    954             import sage.interfaces.singular\n    955             G = sage.interfaces.singular.singular\n--> 956         return self._interface_(G)\n    957 \n    958     def _singular_init_(self, have_ring=False):\n\n/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6603)()\n    728             except Exception:\n    729                 raise NotImplementedError(\"coercion of object %s to %s not implemented:\\n%s\\n%s\" % (repr(self), I))\n--> 730         X = I(s)\n    731         if c:\n    732             try:\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)\n    793             x = str(x)[1:-1]\n    794 \n--> 795         return SingularElement(self, type, x, False)\n    796 \n    797     def _coerce_map_from_(self, S):\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __init__(self, parent, type, value, is_name)\n   1279         if not is_name:\n   1280             try:\n-> 1281                 self._name = parent._create( value, type)\n   1282             # Convert SingularError to TypeError for\n   1283             # coercion to work properly.\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _create(self, value, type)\n    754         \"\"\"\n    755         name = self._next_var_name()\n--> 756         self.set(type, name, value)\n    757         return name\n    758 \n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in set(self, type, name, value)\n    697         cmd += '%s %s=%s;'%(type, name, value)\n    698         self.__to_clear = []\n--> 699         self.eval(cmd)\n    700 \n    701     def get(self, var):\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)\n    652             x += ';'\n    653 \n--> 654         s = Expect.eval(self, x, **kwds)\n    655 \n    656         if s.find(\"error\") != -1 or s.find(\"Segment fault\") != -1:\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1295                 elif split_lines:\n   1296                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n-> 1297                                         for L in code.split('\\n') if L != ''])\n   1298                 else:\n   1299                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)\n    905         try:\n    906             if self._expect is None:\n--> 907                 self._start()\n    908             E = self._expect\n    909             try:\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)\n    437         \"\"\"\n    438         self.__libs = []\n--> 439         Expect._start(self, alt_message)\n    440         # Load some standard libraries.\n    441         self.lib('general')   # assumed loaded by misc/constants.py\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)\n    513         # switching echo off until now.\n    514         if not self._terminal_echo:\n--> 515             self._expect.setecho(0)\n    516 \n    517         with gc_disabled():\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/pexpect/pty_spawn.pyc in setecho(self, state)\n    402         Not supported on platforms where ``isatty()`` returns False.\n    403         '''\n--> 404         return self.ptyproc.setecho(state)\n    405 \n    406         self.echo = state\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in setecho(self, state)\n    488         Not supported on platforms where ``isatty()`` returns False.\n    489         '''\n--> 490         _setecho(self.fd, state)\n    491 \n    492         self.echo = state\n\n/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in _setecho(fd, state)\n     95     except termios.error as err:\n     96         if err.args[0] == errno.EINVAL:\n---> 97             raise IOError(err.args[0], '%s: %s.' % (err.args[1], errmsg))\n     98         raise\n     99 \n\nIOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.\nsage:  \n```\n\nOn Solaris, the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.\n\nCC:  @jdemeyer\n\nReviewer: Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nBranch: 350fdd62150ec152a413b09514f1f2fe52b60e58\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24651\n\n",
    "closed_at": "2018-02-09T23:47:21Z",
    "created_at": "2018-02-03T20:09:20Z",
    "labels": [
        "component: porting: solaris",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Disable pexpect echo when starting the interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24651",
    "user": "https://github.com/dimpase"
}
```
On Solaris, the Singular pexpect interface is broken:

```
sage: t=singular(0)
---------------------------------------------------------------------------
IOError                                   Traceback (most recent call last)
<ipython-input-1-43d8f01f1d2c> in <module>()
----> 1 t=singular(Integer(0))

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)
    787             return self(x.sage())
    788         elif not isinstance(x, ExpectElement) and hasattr(x, '_singular_'):
--> 789             return x._singular_(self)
    790 
    791         # some convenient conversions

/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._singular_ (build/cythonized/sage/structure/sage_object.c:11739)()
    954             import sage.interfaces.singular
    955             G = sage.interfaces.singular.singular
--> 956         return self._interface_(G)
    957 
    958     def _singular_init_(self, have_ring=False):

/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6603)()
    728             except Exception:
    729                 raise NotImplementedError("coercion of object %s to %s not implemented:\n%s\n%s" % (repr(self), I))
--> 730         X = I(s)
    731         if c:
    732             try:

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)
    793             x = str(x)[1:-1]
    794 
--> 795         return SingularElement(self, type, x, False)
    796 
    797     def _coerce_map_from_(self, S):

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __init__(self, parent, type, value, is_name)
   1279         if not is_name:
   1280             try:
-> 1281                 self._name = parent._create( value, type)
   1282             # Convert SingularError to TypeError for
   1283             # coercion to work properly.

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _create(self, value, type)
    754         """
    755         name = self._next_var_name()
--> 756         self.set(type, name, value)
    757         return name
    758 

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in set(self, type, name, value)
    697         cmd += '%s %s=%s;'%(type, name, value)
    698         self.__to_clear = []
--> 699         self.eval(cmd)
    700 
    701     def get(self, var):

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)
    652             x += ';'
    653 
--> 654         s = Expect.eval(self, x, **kwds)
    655 
    656         if s.find("error") != -1 or s.find("Segment fault") != -1:

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1295                 elif split_lines:
   1296                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
-> 1297                                         for L in code.split('\n') if L != ''])
   1298                 else:
   1299                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)
    905         try:
    906             if self._expect is None:
--> 907                 self._start()
    908             E = self._expect
    909             try:

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)
    437         """
    438         self.__libs = []
--> 439         Expect._start(self, alt_message)
    440         # Load some standard libraries.
    441         self.lib('general')   # assumed loaded by misc/constants.py

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)
    513         # switching echo off until now.
    514         if not self._terminal_echo:
--> 515             self._expect.setecho(0)
    516 
    517         with gc_disabled():

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/pexpect/pty_spawn.pyc in setecho(self, state)
    402         Not supported on platforms where ``isatty()`` returns False.
    403         '''
--> 404         return self.ptyproc.setecho(state)
    405 
    406         self.echo = state

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in setecho(self, state)
    488         Not supported on platforms where ``isatty()`` returns False.
    489         '''
--> 490         _setecho(self.fd, state)
    491 
    492         self.echo = state

/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in _setecho(fd, state)
     95     except termios.error as err:
     96         if err.args[0] == errno.EINVAL:
---> 97             raise IOError(err.args[0], '%s: %s.' % (err.args[1], errmsg))
     98         raise
     99 

IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.
sage:  
```

On Solaris, the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.

CC:  @jdemeyer

Reviewer: Dima Pasechnik

Author: Jeroen Demeyer

Branch: 350fdd62150ec152a413b09514f1f2fe52b60e58

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24651





---

archive/issue_comments_364199.json:
```json
{
    "body": "<a id='comment:1'></a>this appears to be relevant: https://github.com/pexpect/ptyprocess/issues/34",
    "created_at": "2018-02-03T22:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364199",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>this appears to be relevant: https://github.com/pexpect/ptyprocess/issues/34



---

archive/issue_comments_364200.json:
```json
{
    "body": "<a id='comment:2'></a>People who worked on #14371 certainly know much more than me about this issue.",
    "created_at": "2018-02-03T22:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364200",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>People who worked on #14371 certainly know much more than me about this issue.



---

archive/issue_comments_364201.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,4 @@\n-pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used), e.g.\n-\n-```\n-sage -t src/sage/interfaces/singular.py  # 172 doctests failed\n-```\n-here is a typical error:\n+pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used). Here is a typical error:\n \n ```\n sage: t=singular(0)\n@@ -121,6 +116,8 @@\n sage:  \n ```\n \n+The reason is that the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.\n+\n Comment: 1\n \n Summary: Fix pexpect on Solaris 11\n``````\n",
    "created_at": "2018-02-07T09:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364201",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,4 @@
-pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used), e.g.
-
-```
-sage -t src/sage/interfaces/singular.py  # 172 doctests failed
-```
-here is a typical error:
+pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used). Here is a typical error:
 
 ```
 sage: t=singular(0)
@@ -121,6 +116,8 @@
 sage:  
 ```
 
+The reason is that the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.
+
 Comment: 1
 
 Summary: Fix pexpect on Solaris 11
``````




---

archive/issue_comments_364202.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,122 @@\n+pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used). Here is a typical error:\n \n+```\n+sage: t=singular(0)\n+---------------------------------------------------------------------------\n+IOError                                   Traceback (most recent call last)\n+<ipython-input-1-43d8f01f1d2c> in <module>()\n+----> 1 t=singular(Integer(0))\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)\n+    787             return self(x.sage())\n+    788         elif not isinstance(x, ExpectElement) and hasattr(x, '_singular_'):\n+--> 789             return x._singular_(self)\n+    790 \n+    791         # some convenient conversions\n+\n+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._singular_ (build/cythonized/sage/structure/sage_object.c:11739)()\n+    954             import sage.interfaces.singular\n+    955             G = sage.interfaces.singular.singular\n+--> 956         return self._interface_(G)\n+    957 \n+    958     def _singular_init_(self, have_ring=False):\n+\n+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6603)()\n+    728             except Exception:\n+    729                 raise NotImplementedError(\"coercion of object %s to %s not implemented:\\n%s\\n%s\" % (repr(self), I))\n+--> 730         X = I(s)\n+    731         if c:\n+    732             try:\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)\n+    793             x = str(x)[1:-1]\n+    794 \n+--> 795         return SingularElement(self, type, x, False)\n+    796 \n+    797     def _coerce_map_from_(self, S):\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __init__(self, parent, type, value, is_name)\n+   1279         if not is_name:\n+   1280             try:\n+-> 1281                 self._name = parent._create( value, type)\n+   1282             # Convert SingularError to TypeError for\n+   1283             # coercion to work properly.\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _create(self, value, type)\n+    754         \"\"\"\n+    755         name = self._next_var_name()\n+--> 756         self.set(type, name, value)\n+    757         return name\n+    758 \n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in set(self, type, name, value)\n+    697         cmd += '%s %s=%s;'%(type, name, value)\n+    698         self.__to_clear = []\n+--> 699         self.eval(cmd)\n+    700 \n+    701     def get(self, var):\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)\n+    652             x += ';'\n+    653 \n+--> 654         s = Expect.eval(self, x, **kwds)\n+    655 \n+    656         if s.find(\"error\") != -1 or s.find(\"Segment fault\") != -1:\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n+   1295                 elif split_lines:\n+   1296                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n+-> 1297                                         for L in code.split('\\n') if L != ''])\n+   1298                 else:\n+   1299                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)\n+    905         try:\n+    906             if self._expect is None:\n+--> 907                 self._start()\n+    908             E = self._expect\n+    909             try:\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)\n+    437         \"\"\"\n+    438         self.__libs = []\n+--> 439         Expect._start(self, alt_message)\n+    440         # Load some standard libraries.\n+    441         self.lib('general')   # assumed loaded by misc/constants.py\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)\n+    513         # switching echo off until now.\n+    514         if not self._terminal_echo:\n+--> 515             self._expect.setecho(0)\n+    516 \n+    517         with gc_disabled():\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/pexpect/pty_spawn.pyc in setecho(self, state)\n+    402         Not supported on platforms where ``isatty()`` returns False.\n+    403         '''\n+--> 404         return self.ptyproc.setecho(state)\n+    405 \n+    406         self.echo = state\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in setecho(self, state)\n+    488         Not supported on platforms where ``isatty()`` returns False.\n+    489         '''\n+--> 490         _setecho(self.fd, state)\n+    491 \n+    492         self.echo = state\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in _setecho(fd, state)\n+     95     except termios.error as err:\n+     96         if err.args[0] == errno.EINVAL:\n+---> 97             raise IOError(err.args[0], '%s: %s.' % (err.args[1], errmsg))\n+     98         raise\n+     99 \n+\n+IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.\n+sage:  \n+```\n+\n+On Solaris, the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.\n \n Comment: 1\n \n``````\n",
    "created_at": "2018-02-07T09:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364202",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,122 @@
+pexpect interface is apparently broken (and this causes a lot of breakage everywhere pexpect is used). Here is a typical error:
 
+```
+sage: t=singular(0)
+---------------------------------------------------------------------------
+IOError                                   Traceback (most recent call last)
+<ipython-input-1-43d8f01f1d2c> in <module>()
+----> 1 t=singular(Integer(0))
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)
+    787             return self(x.sage())
+    788         elif not isinstance(x, ExpectElement) and hasattr(x, '_singular_'):
+--> 789             return x._singular_(self)
+    790 
+    791         # some convenient conversions
+
+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._singular_ (build/cythonized/sage/structure/sage_object.c:11739)()
+    954             import sage.interfaces.singular
+    955             G = sage.interfaces.singular.singular
+--> 956         return self._interface_(G)
+    957 
+    958     def _singular_init_(self, have_ring=False):
+
+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6603)()
+    728             except Exception:
+    729                 raise NotImplementedError("coercion of object %s to %s not implemented:\n%s\n%s" % (repr(self), I))
+--> 730         X = I(s)
+    731         if c:
+    732             try:
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)
+    793             x = str(x)[1:-1]
+    794 
+--> 795         return SingularElement(self, type, x, False)
+    796 
+    797     def _coerce_map_from_(self, S):
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __init__(self, parent, type, value, is_name)
+   1279         if not is_name:
+   1280             try:
+-> 1281                 self._name = parent._create( value, type)
+   1282             # Convert SingularError to TypeError for
+   1283             # coercion to work properly.
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _create(self, value, type)
+    754         """
+    755         name = self._next_var_name()
+--> 756         self.set(type, name, value)
+    757         return name
+    758 
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in set(self, type, name, value)
+    697         cmd += '%s %s=%s;'%(type, name, value)
+    698         self.__to_clear = []
+--> 699         self.eval(cmd)
+    700 
+    701     def get(self, var):
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)
+    652             x += ';'
+    653 
+--> 654         s = Expect.eval(self, x, **kwds)
+    655 
+    656         if s.find("error") != -1 or s.find("Segment fault") != -1:
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
+   1295                 elif split_lines:
+   1296                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
+-> 1297                                         for L in code.split('\n') if L != ''])
+   1298                 else:
+   1299                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)
+    905         try:
+    906             if self._expect is None:
+--> 907                 self._start()
+    908             E = self._expect
+    909             try:
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)
+    437         """
+    438         self.__libs = []
+--> 439         Expect._start(self, alt_message)
+    440         # Load some standard libraries.
+    441         self.lib('general')   # assumed loaded by misc/constants.py
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)
+    513         # switching echo off until now.
+    514         if not self._terminal_echo:
+--> 515             self._expect.setecho(0)
+    516 
+    517         with gc_disabled():
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/pexpect/pty_spawn.pyc in setecho(self, state)
+    402         Not supported on platforms where ``isatty()`` returns False.
+    403         '''
+--> 404         return self.ptyproc.setecho(state)
+    405 
+    406         self.echo = state
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in setecho(self, state)
+    488         Not supported on platforms where ``isatty()`` returns False.
+    489         '''
+--> 490         _setecho(self.fd, state)
+    491 
+    492         self.echo = state
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in _setecho(fd, state)
+     95     except termios.error as err:
+     96         if err.args[0] == errno.EINVAL:
+---> 97             raise IOError(err.args[0], '%s: %s.' % (err.args[1], errmsg))
+     98         raise
+     99 
+
+IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.
+sage:  
+```
+
+On Solaris, the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.
 
 Comment: 1
 
``````




---

archive/issue_comments_364203.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-07T09:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364203",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_364204.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2018-02-07T09:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364204",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_364205.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:1 dimpase]:\n> this appears to be relevant: https://github.com/pexpect/ptyprocess/issues/34\n\n\nI don't think so. The Sage issue is specifically about setting terminal echo.",
    "created_at": "2018-02-07T09:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364205",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:1 dimpase]:
> this appears to be relevant: https://github.com/pexpect/ptyprocess/issues/34


I don't think so. The Sage issue is specifically about setting terminal echo.



---

archive/issue_comments_364206.json:
```json
{
    "body": "<a id='comment:8'></a>Wow, brilliant catch! Appears to work, trying to build docs now.",
    "created_at": "2018-02-07T10:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364206",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>Wow, brilliant catch! Appears to work, trying to build docs now.



---

archive/issue_comments_364207.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,122 @@\n+On Solaris, the Singular pexpect interface is broken:\n \n+```\n+sage: t=singular(0)\n+---------------------------------------------------------------------------\n+IOError                                   Traceback (most recent call last)\n+<ipython-input-1-43d8f01f1d2c> in <module>()\n+----> 1 t=singular(Integer(0))\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)\n+    787             return self(x.sage())\n+    788         elif not isinstance(x, ExpectElement) and hasattr(x, '_singular_'):\n+--> 789             return x._singular_(self)\n+    790 \n+    791         # some convenient conversions\n+\n+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._singular_ (build/cythonized/sage/structure/sage_object.c:11739)()\n+    954             import sage.interfaces.singular\n+    955             G = sage.interfaces.singular.singular\n+--> 956         return self._interface_(G)\n+    957 \n+    958     def _singular_init_(self, have_ring=False):\n+\n+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6603)()\n+    728             except Exception:\n+    729                 raise NotImplementedError(\"coercion of object %s to %s not implemented:\\n%s\\n%s\" % (repr(self), I))\n+--> 730         X = I(s)\n+    731         if c:\n+    732             try:\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)\n+    793             x = str(x)[1:-1]\n+    794 \n+--> 795         return SingularElement(self, type, x, False)\n+    796 \n+    797     def _coerce_map_from_(self, S):\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __init__(self, parent, type, value, is_name)\n+   1279         if not is_name:\n+   1280             try:\n+-> 1281                 self._name = parent._create( value, type)\n+   1282             # Convert SingularError to TypeError for\n+   1283             # coercion to work properly.\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _create(self, value, type)\n+    754         \"\"\"\n+    755         name = self._next_var_name()\n+--> 756         self.set(type, name, value)\n+    757         return name\n+    758 \n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in set(self, type, name, value)\n+    697         cmd += '%s %s=%s;'%(type, name, value)\n+    698         self.__to_clear = []\n+--> 699         self.eval(cmd)\n+    700 \n+    701     def get(self, var):\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)\n+    652             x += ';'\n+    653 \n+--> 654         s = Expect.eval(self, x, **kwds)\n+    655 \n+    656         if s.find(\"error\") != -1 or s.find(\"Segment fault\") != -1:\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n+   1295                 elif split_lines:\n+   1296                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n+-> 1297                                         for L in code.split('\\n') if L != ''])\n+   1298                 else:\n+   1299                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)\n+    905         try:\n+    906             if self._expect is None:\n+--> 907                 self._start()\n+    908             E = self._expect\n+    909             try:\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)\n+    437         \"\"\"\n+    438         self.__libs = []\n+--> 439         Expect._start(self, alt_message)\n+    440         # Load some standard libraries.\n+    441         self.lib('general')   # assumed loaded by misc/constants.py\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)\n+    513         # switching echo off until now.\n+    514         if not self._terminal_echo:\n+--> 515             self._expect.setecho(0)\n+    516 \n+    517         with gc_disabled():\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/pexpect/pty_spawn.pyc in setecho(self, state)\n+    402         Not supported on platforms where ``isatty()`` returns False.\n+    403         '''\n+--> 404         return self.ptyproc.setecho(state)\n+    405 \n+    406         self.echo = state\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in setecho(self, state)\n+    488         Not supported on platforms where ``isatty()`` returns False.\n+    489         '''\n+--> 490         _setecho(self.fd, state)\n+    491 \n+    492         self.echo = state\n+\n+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in _setecho(fd, state)\n+     95     except termios.error as err:\n+     96         if err.args[0] == errno.EINVAL:\n+---> 97             raise IOError(err.args[0], '%s: %s.' % (err.args[1], errmsg))\n+     98         raise\n+     99 \n+\n+IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.\n+sage:  \n+```\n+\n+On Solaris, the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.\n \n Comment: 1\n \n``````\n",
    "created_at": "2018-02-07T10:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364207",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,122 @@
+On Solaris, the Singular pexpect interface is broken:
 
+```
+sage: t=singular(0)
+---------------------------------------------------------------------------
+IOError                                   Traceback (most recent call last)
+<ipython-input-1-43d8f01f1d2c> in <module>()
+----> 1 t=singular(Integer(0))
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)
+    787             return self(x.sage())
+    788         elif not isinstance(x, ExpectElement) and hasattr(x, '_singular_'):
+--> 789             return x._singular_(self)
+    790 
+    791         # some convenient conversions
+
+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._singular_ (build/cythonized/sage/structure/sage_object.c:11739)()
+    954             import sage.interfaces.singular
+    955             G = sage.interfaces.singular.singular
+--> 956         return self._interface_(G)
+    957 
+    958     def _singular_init_(self, have_ring=False):
+
+/datapool/dima/Sage/sagetrac-mirror/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6603)()
+    728             except Exception:
+    729                 raise NotImplementedError("coercion of object %s to %s not implemented:\n%s\n%s" % (repr(self), I))
+--> 730         X = I(s)
+    731         if c:
+    732             try:
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __call__(self, x, type)
+    793             x = str(x)[1:-1]
+    794 
+--> 795         return SingularElement(self, type, x, False)
+    796 
+    797     def _coerce_map_from_(self, S):
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in __init__(self, parent, type, value, is_name)
+   1279         if not is_name:
+   1280             try:
+-> 1281                 self._name = parent._create( value, type)
+   1282             # Convert SingularError to TypeError for
+   1283             # coercion to work properly.
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _create(self, value, type)
+    754         """
+    755         name = self._next_var_name()
+--> 756         self.set(type, name, value)
+    757         return name
+    758 
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in set(self, type, name, value)
+    697         cmd += '%s %s=%s;'%(type, name, value)
+    698         self.__to_clear = []
+--> 699         self.eval(cmd)
+    700 
+    701     def get(self, var):
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in eval(self, x, allow_semicolon, strip, **kwds)
+    652             x += ';'
+    653 
+--> 654         s = Expect.eval(self, x, **kwds)
+    655 
+    656         if s.find("error") != -1 or s.find("Segment fault") != -1:
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
+   1295                 elif split_lines:
+   1296                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
+-> 1297                                         for L in code.split('\n') if L != ''])
+   1298                 else:
+   1299                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed)
+    905         try:
+    906             if self._expect is None:
+--> 907                 self._start()
+    908             E = self._expect
+    909             try:
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/singular.pyc in _start(self, alt_message)
+    437         """
+    438         self.__libs = []
+--> 439         Expect._start(self, alt_message)
+    440         # Load some standard libraries.
+    441         self.lib('general')   # assumed loaded by misc/constants.py
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in _start(self, alt_message, block_during_init)
+    513         # switching echo off until now.
+    514         if not self._terminal_echo:
+--> 515             self._expect.setecho(0)
+    516 
+    517         with gc_disabled():
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/pexpect/pty_spawn.pyc in setecho(self, state)
+    402         Not supported on platforms where ``isatty()`` returns False.
+    403         '''
+--> 404         return self.ptyproc.setecho(state)
+    405 
+    406         self.echo = state
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in setecho(self, state)
+    488         Not supported on platforms where ``isatty()`` returns False.
+    489         '''
+--> 490         _setecho(self.fd, state)
+    491 
+    492         self.echo = state
+
+/datapool/dima/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.pyc in _setecho(fd, state)
+     95     except termios.error as err:
+     96         if err.args[0] == errno.EINVAL:
+---> 97             raise IOError(err.args[0], '%s: %s.' % (err.args[1], errmsg))
+     98         raise
+     99 
+
+IOError: [Errno 22] Invalid argument: setecho() may not be called on this platform.
+sage:  
+```
+
+On Solaris, the master process cannot set/unset terminal echo after the child is started. Terminal echo can only be set/unset once initially. `pexpect` supports that, we just need to pass the right option.
 
 Comment: 1
 
``````




---

archive/issue_comments_364208.json:
```json
{
    "body": "<a id='comment:10'></a>I find it particularly convenient that the option in `pexpect` already existed. We don't even need an upstream patch!",
    "created_at": "2018-02-07T10:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364208",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>I find it particularly convenient that the option in `pexpect` already existed. We don't even need an upstream patch!



---

archive/issue_comments_364209.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-07T10:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364209",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_364210.json:
```json
{
    "body": "<a id='comment:11'></a>Good. I can build docs now.",
    "created_at": "2018-02-07T10:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364210",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Good. I can build docs now.



---

archive/issue_events_062072.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-09T23:47:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24651#event-62072"
}
```



---

archive/issue_comments_364211.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-09T23:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364211",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_364212.json:
```json
{
    "body": "<a id='comment:14'></a>Sorry, mistyped ticket number.\n\n---\nNew commits:",
    "created_at": "2018-10-10T07:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24651#issuecomment-364212",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:14'></a>Sorry, mistyped ticket number.

---
New commits:
