# Issue 24861: Option to hold for derivative

archive/issues_024624.json:
```json
{
    "assignees": [],
    "body": "It would be nice to have the output of\n\n```\n(x^3).diff(x, hold=True)\n```\nlook like\n\n```\n$$ \\frac{\\partial}{\\partial x}x^3 $$\n```\n\n\nKeywords: **hold**\n\nBranch/Commit: **[u/rws/option_to_hold_for_derivative](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/option_to_hold_for_derivative) @ [`453cf14`](https://github.com/sagemath/sagetrac-mirror/commit/453cf14cdc3615d781d0dcd57daa95b9e45d5b5a)**\n\nAuthor: **Ralf Stephan**\n\nComponent: **calculus**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24861_\n\n",
    "created_at": "2018-02-27T21:13:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p%3A%205%20%E2%80%93%20trivial",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Option to hold for derivative",
    "type": "issue",
    "updated_at": "2022-12-29T01:42:26Z",
    "url": "https://github.com/sagemath/sage/issues/24861",
    "user": "https://github.com/vaibhavkarve"
}
```
It would be nice to have the output of

```
(x^3).diff(x, hold=True)
```
look like

```
$$ \frac{\partial}{\partial x}x^3 $$
```


Keywords: **hold**

Branch/Commit: **[u/rws/option_to_hold_for_derivative](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/option_to_hold_for_derivative) @ [`453cf14`](https://github.com/sagemath/sagetrac-mirror/commit/453cf14cdc3615d781d0dcd57daa95b9e45d5b5a)**

Author: **Ralf Stephan**

Component: **calculus**

_Issue created by migration from https://trac.sagemath.org/ticket/24861_





---

archive/issue_events_344045.json:
```json
{
    "actor": "https://github.com/vaibhavkarve",
    "created_at": "2018-02-27T21:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344045"
}
```



---

archive/issue_events_344046.json:
```json
{
    "actor": "https://github.com/vaibhavkarve",
    "created_at": "2018-02-27T21:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/p%3A%205%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p: 5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344046"
}
```



---

archive/issue_events_344047.json:
```json
{
    "actor": "https://github.com/vaibhavkarve",
    "created_at": "2018-02-27T21:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344047"
}
```



---

archive/issue_events_344048.json:
```json
{
    "actor": "https://github.com/vaibhavkarve",
    "created_at": "2018-02-27T21:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344048"
}
```



---

archive/issue_comments_378155.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAlthough we don't exactly have already a ticket for this, see the related #17445 and #15021.",
    "created_at": "2018-03-25T07:57:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378155",
    "user": "https://github.com/rwst"
}
```

<div id="comment:1" align="right">comment:1</div>

Although we don't exactly have already a ticket for this, see the related #17445 and #15021.



---

archive/issue_comments_378156.json:
```json
{
    "body": "Branch: **[u/rws/option_to_hold_for_derivative](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/option_to_hold_for_derivative)**",
    "created_at": "2018-03-25T14:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378156",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/option_to_hold_for_derivative](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/option_to_hold_for_derivative)**



---

archive/issue_comments_378157.json:
```json
{
    "body": "Commit: **[`453cf14`](https://github.com/sagemath/sagetrac-mirror/commit/453cf14cdc3615d781d0dcd57daa95b9e45d5b5a)**",
    "created_at": "2018-03-25T15:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378157",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`453cf14`](https://github.com/sagemath/sagetrac-mirror/commit/453cf14cdc3615d781d0dcd57daa95b9e45d5b5a)**



---

archive/issue_comments_378158.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/453cf14cdc3615d781d0dcd57daa95b9e45d5b5a\">453cf14</a></td><td><code>24861: handle multi diffs</code></td></tr></table>\n",
    "created_at": "2018-03-25T15:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378158",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/453cf14cdc3615d781d0dcd57daa95b9e45d5b5a">453cf14</a></td><td><code>24861: handle multi diffs</code></td></tr></table>




---

archive/issue_events_344049.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-25T15:56:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344049"
}
```



---

archive/issue_comments_378159.json:
```json
{
    "body": "Author: **Ralf Stephan**",
    "created_at": "2018-03-25T15:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378159",
    "user": "https://github.com/rwst"
}
```

Author: **Ralf Stephan**



---

archive/issue_events_344050.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-25T15:56:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344050"
}
```



---

archive/issue_events_344051.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-25T15:56:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344051"
}
```



---

archive/issue_comments_378160.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThanks for the report. This will be a useful addition to Sage.",
    "created_at": "2018-03-25T15:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378160",
    "user": "https://github.com/rwst"
}
```

<div id="comment:4" align="right">comment:4</div>

Thanks for the report. This will be a useful addition to Sage.



---

archive/issue_events_344052.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-08-01T02:04:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344052"
}
```



---

archive/issue_events_344053.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-08-01T02:04:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344053"
}
```



---

archive/issue_events_344054.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-08-01T02:04:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344054"
}
```



---

archive/issue_events_344055.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-08-01T02:04:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344055"
}
```



---

archive/issue_comments_378161.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI agree this would be a nice addition; thanks for addressing this. Here are some comments.\n\nIn `src/sage/functions/other.py`:\n- Something like `(x).diff(x*x, hold=True)` returns `diff(x, x^2)` instead of an error. Note also that `latex((x).diff(x*x, hold=True))` causes a segfault.\n- The error message `wrong argument in diff` could be made more helpful; perhaps something like `all arguments to diff must be symbols or numerical values`. This should be tested as well.\n- The LaTeX output should include parentheses around the expression (probably with `\\left` and `\\right`), otherwise something like `latex((x^3+y).diff(x,2,y,2, hold=True))` returns `{\\frac{\\partial^{4}}{{\\partial x^2}{\\partial y^2}} x^{3} + y}` which is incorrect.\n\nIn `src/sage/symbolic/expression.pyx`:\n- the `hold` parameter should be added to the docstring of `derivative`. I also noticed a typo in the first line of the docstring as well: `this expressions` -> `this expression`.",
    "created_at": "2018-08-01T02:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24861#issuecomment-378161",
    "user": "https://github.com/bryangingechen"
}
```

<div id="comment:5" align="right">comment:5</div>

I agree this would be a nice addition; thanks for addressing this. Here are some comments.

In `src/sage/functions/other.py`:
- Something like `(x).diff(x*x, hold=True)` returns `diff(x, x^2)` instead of an error. Note also that `latex((x).diff(x*x, hold=True))` causes a segfault.
- The error message `wrong argument in diff` could be made more helpful; perhaps something like `all arguments to diff must be symbols or numerical values`. This should be tested as well.
- The LaTeX output should include parentheses around the expression (probably with `\left` and `\right`), otherwise something like `latex((x^3+y).diff(x,2,y,2, hold=True))` returns `{\frac{\partial^{4}}{{\partial x^2}{\partial y^2}} x^{3} + y}` which is incorrect.

In `src/sage/symbolic/expression.pyx`:
- the `hold` parameter should be added to the docstring of `derivative`. I also noticed a typo in the first line of the docstring as well: `this expressions` -> `this expression`.



---

archive/issue_events_344056.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:42:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24861",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24861#event-344056"
}
```
