# Issue 24215: Add HAVE_GMPY2 compile-time constant

archive/issues_023978.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nIn order to optionally include code depending on gmpy2, we introduce a compile-time Cython constant `HAVE_GMPY2`.\n\nCC:  @vinklein\n\nComponent: **cython**\n\nAuthor: **Jeroen Demeyer**\n\nBranch/Commit: **[`7f06e71`](https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)**\n\nReviewer: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24215_\n\n",
    "closed_at": "2017-12-11T01:02:26Z",
    "created_at": "2017-11-14T13:08:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20cython",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add HAVE_GMPY2 compile-time constant",
    "type": "issue",
    "updated_at": "2017-12-11T01:02:26Z",
    "url": "https://github.com/sagemath/sage/issues/24215",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

In order to optionally include code depending on gmpy2, we introduce a compile-time Cython constant `HAVE_GMPY2`.

CC:  @vinklein

Component: **cython**

Author: **Jeroen Demeyer**

Branch/Commit: **[`7f06e71`](https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)**

Reviewer: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/24215_





---

archive/issue_events_333021.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-14T13:08:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333021"
}
```



---

archive/issue_events_333022.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-14T13:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20cython",
    "label_color": "0000b0",
    "label_name": "c: cython",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333022"
}
```



---

archive/issue_events_333023.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-14T13:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333023"
}
```



---

archive/issue_events_333024.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-14T13:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333024"
}
```



---

archive/issue_comments_366221.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI find this too complicated. Having Sage compilation depending on optional packages is awful.\n\nFor example, if I want to compile Sage with gmpy2 support I would have to do:\n1. compile Sage\n2. install gmpy2\n3. recompile Sage\n\nNot mentioning how impredictable this could be in doctesting.",
    "created_at": "2017-11-14T14:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366221",
    "user": "https://github.com/videlec"
}
```

<div id="comment:1" align="right">comment:1</div>

I find this too complicated. Having Sage compilation depending on optional packages is awful.

For example, if I want to compile Sage with gmpy2 support I would have to do:
1. compile Sage
2. install gmpy2
3. recompile Sage

Not mentioning how impredictable this could be in doctesting.



---

archive/issue_comments_366222.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nReplying to [@videlec](#comment%3A1):\n> I find this too complicated. Having Sage compilation depending on optional packages is awful.\n\nWe already do that for several packages (e.g. `bliss`, `coxeter3`) and it works fine. What is the problem really?",
    "created_at": "2017-11-14T15:02:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366222",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Replying to [@videlec](#comment%3A1):
> I find this too complicated. Having Sage compilation depending on optional packages is awful.

We already do that for several packages (e.g. `bliss`, `coxeter3`) and it works fine. What is the problem really?



---

archive/issue_comments_366223.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@videlec](#comment%3A1):\n> For example, if I want to compile Sage with gmpy2 support I would have to do:\n> 1. compile Sage\n> 2. install gmpy2\n> 3. recompile Sage\n\nTwo steps are sufficient:\n\n1. Install gmpy2\n2. Compile Sage\n\nAgain, this is not different from existing optional packages.",
    "created_at": "2017-11-14T15:02:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366223",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@videlec](#comment%3A1):
> For example, if I want to compile Sage with gmpy2 support I would have to do:
> 1. compile Sage
> 2. install gmpy2
> 3. recompile Sage

Two steps are sufficient:

1. Install gmpy2
2. Compile Sage

Again, this is not different from existing optional packages.



---

archive/issue_comments_366224.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@videlec](#comment%3A1):\n> Not mentioning how impredictable this could be in doctesting.\n\nUse `# optional - gmpy2`. Again, this is not different from existing optional packages.",
    "created_at": "2017-11-14T15:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366224",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@videlec](#comment%3A1):
> Not mentioning how impredictable this could be in doctesting.

Use `# optional - gmpy2`. Again, this is not different from existing optional packages.



---

archive/issue_comments_366225.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@jdemeyer](#comment%3A3):\n> Replying to [@videlec](#comment%3A1):\n> > For example, if I want to compile Sage with gmpy2 support I would have to do:\n> > 1. compile Sage\n> > 2. install gmpy2\n> > 3. recompile Sage\n> \n> \n> Two steps are sufficient:\n> \n> 1. Install gmpy2\n> 2. Compile Sage\n> \n> Again, this is not different from existing optional packages.\n\n`sage -i gmpy2` before `make`?",
    "created_at": "2017-11-14T15:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366225",
    "user": "https://github.com/videlec"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@jdemeyer](#comment%3A3):
> Replying to [@videlec](#comment%3A1):
> > For example, if I want to compile Sage with gmpy2 support I would have to do:
> > 1. compile Sage
> > 2. install gmpy2
> > 3. recompile Sage
> 
> 
> Two steps are sufficient:
> 
> 1. Install gmpy2
> 2. Compile Sage
> 
> Again, this is not different from existing optional packages.

`sage -i gmpy2` before `make`?



---

archive/issue_comments_366226.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> Replying to [@videlec](#comment%3A1):\n> > I find this too complicated. Having Sage compilation depending on optional packages is awful.\n> \n> \n> We already do that for several packages (e.g. `bliss`, `coxeter3`) and it works fine. What is the problem really?\n\nNot exactly. These two examples are handled as optional extensions. It is easy to figure out what is actually changed by their installation. With compilation constant, the distinction is less clear.",
    "created_at": "2017-11-14T15:09:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366226",
    "user": "https://github.com/videlec"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jdemeyer](#comment%3A2):
> Replying to [@videlec](#comment%3A1):
> > I find this too complicated. Having Sage compilation depending on optional packages is awful.
> 
> 
> We already do that for several packages (e.g. `bliss`, `coxeter3`) and it works fine. What is the problem really?

Not exactly. These two examples are handled as optional extensions. It is easy to figure out what is actually changed by their installation. With compilation constant, the distinction is less clear.



---

archive/issue_comments_366227.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nJust as a reminder trac #23024 require pplpy and therefore gmpy2 to be standard package. I am aware that it's not directly linked to the subject but that means we are probably going to make gmpy2 optional then standard again.",
    "created_at": "2017-11-14T15:21:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366227",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:7" align="right">comment:7</div>

Just as a reminder trac #23024 require pplpy and therefore gmpy2 to be standard package. I am aware that it's not directly linked to the subject but that means we are probably going to make gmpy2 optional then standard again.



---

archive/issue_comments_366228.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIndeed!",
    "created_at": "2017-11-14T15:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366228",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

Indeed!



---

archive/issue_comments_366229.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/24215](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24215)**",
    "created_at": "2017-11-14T15:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366229",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/24215](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24215)**



---

archive/issue_comments_366230.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment%3A5):\n> `sage -i gmpy2` before `make`?\n\nYes, that is what I meant. Although in practice most people will install Sage first and then optional packages.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be\"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr></table>\n",
    "created_at": "2017-11-14T15:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366230",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment%3A5):
> `sage -i gmpy2` before `make`?

Yes, that is what I meant. Although in practice most people will install Sage first and then optional packages.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be"><code>34ef6dc</code></a></td><td><code>Add HAVE_GMPY2 compile-time constant</code></td></tr></table>




---

archive/issue_comments_366231.json:
```json
{
    "body": "Commit: **[`34ef6dc`](https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be)**",
    "created_at": "2017-11-14T15:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366231",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`34ef6dc`](https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be)**



---

archive/issue_events_333025.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-14T15:36:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333025"
}
```



---

archive/issue_comments_366232.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@vinklein](#comment%3A7):\n> that means we are probably going to make gmpy2 optional then standard again. \n\nFine for me. To be clear: I'm not opposing to make `gmpy2` a standard package. But I am opposed to make it standard *now* just because it will needed by some hypothetical feature in the future.",
    "created_at": "2017-11-14T15:39:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366232",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@vinklein](#comment%3A7):
> that means we are probably going to make gmpy2 optional then standard again. 

Fine for me. To be clear: I'm not opposing to make `gmpy2` a standard package. But I am opposed to make it standard *now* just because it will needed by some hypothetical feature in the future.



---

archive/issue_comments_366233.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@videlec](#comment%3A6):\n> With compilation constant, the distinction is less clear.\n\nIf you look at the code on #22928, it's really not so bad. Additionally, the `HAVE_GMPY2` constant is something that you can easily grep for to find out what depends on `gmpy2`.",
    "created_at": "2017-11-14T15:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366233",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@videlec](#comment%3A6):
> With compilation constant, the distinction is less clear.

If you look at the code on #22928, it's really not so bad. Additionally, the `HAVE_GMPY2` constant is something that you can easily grep for to find out what depends on `gmpy2`.



---

archive/issue_comments_366234.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nYour `have_module` function modifies the environment\n\n```\nsage: import sys\nsage: 'scipy' in sys.modules\nFalse\nsage: have_module('scipy')\nTrue\nsage: 'scipy' in sys.modules\nTrue\n```\n(see also [#20382 comment 40](https://github.com/sagemath/sage/issues/20382#comment:40)). It would better be specified in the doc. Moreover, the function is not testing that a module is *installed* but testing whether you can *load* a given module (that might well correspond to a file in the current directory). According to the specification, this is one false positive (a module not installed) and a wrong negative (a module installed but that can not be loaded).",
    "created_at": "2017-11-15T20:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366234",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

Your `have_module` function modifies the environment

```
sage: import sys
sage: 'scipy' in sys.modules
False
sage: have_module('scipy')
True
sage: 'scipy' in sys.modules
True
```
(see also [#20382 comment 40](https://github.com/sagemath/sage/issues/20382#comment:40)). It would better be specified in the doc. Moreover, the function is not testing that a module is *installed* but testing whether you can *load* a given module (that might well correspond to a file in the current directory). According to the specification, this is one false positive (a module not installed) and a wrong negative (a module installed but that can not be loaded).



---

archive/issue_comments_366235.json:
```json
{
    "body": "Changed commit from **[`34ef6dc`](https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be)** to **[`7f06e71`](https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)**",
    "created_at": "2017-11-16T09:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366235",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`34ef6dc`](https://github.com/sagemath/sagetrac-mirror/commit/34ef6dc08de5f11a74e83c6707d6dd4f5e2563be)** to **[`7f06e71`](https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)**



---

archive/issue_comments_366236.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65\"><code>158d984</code></a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2\"><code>7f06e71</code></a></td><td><code>Fix documentation</code></td></tr></table>\n",
    "created_at": "2017-11-16T09:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366236",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/158d984a1263978ce941172c775238afbc32ad65"><code>158d984</code></a></td><td><code>Force absolute import in have_module()</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2"><code>7f06e71</code></a></td><td><code>Fix documentation</code></td></tr></table>




---

archive/issue_comments_366237.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> Replying to [@videlec](#comment%3A1):\n> > I find this too complicated. Having Sage compilation depending on optional packages is awful.\n> \n> \n> We already do that for several packages (e.g. `bliss`, `coxeter3`) and it works fine. What is the problem really?\n\nIf anything Sage needs *more* of this sort of thing, with more packages made \"optional\" IMO :)",
    "created_at": "2017-11-20T08:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366237",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment%3A2):
> Replying to [@videlec](#comment%3A1):
> > I find this too complicated. Having Sage compilation depending on optional packages is awful.
> 
> 
> We already do that for several packages (e.g. `bliss`, `coxeter3`) and it works fine. What is the problem really?

If anything Sage needs *more* of this sort of thing, with more packages made "optional" IMO :)



---

archive/issue_comments_366238.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.",
    "created_at": "2017-11-20T09:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366238",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.



---

archive/issue_comments_366239.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@embray](#comment%3A17):\n> I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.\n\nTo avoid local imports. See [comment:14](#comment%3A14).",
    "created_at": "2017-11-20T10:04:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366239",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@embray](#comment%3A17):
> I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.

To avoid local imports. See [comment:14](#comment%3A14).



---

archive/issue_comments_366240.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@embray](#comment%3A17):\n> I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.\n\n`importlib.import_module` is [almost undocumented](https://docs.python.org/2.7/library/importlib.html), so I'm not convinced that it does the right thing.\n\nOn the other hand, `__import__` has [ample documentation](https://docs.python.org/2.7/library/functions.html#__import__) so I know that it does what I want it to do.",
    "created_at": "2017-11-20T10:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366240",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@embray](#comment%3A17):
> I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.

`importlib.import_module` is [almost undocumented](https://docs.python.org/2.7/library/importlib.html), so I'm not convinced that it does the right thing.

On the other hand, `__import__` has [ample documentation](https://docs.python.org/2.7/library/functions.html#__import__) so I know that it does what I want it to do.



---

archive/issue_comments_366241.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jdemeyer](#comment%3A19):\n> Replying to [@embray](#comment%3A17):\n> > I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.\n> \n> \n> `importlib.import_module` is [almost undocumented](https://docs.python.org/2.7/library/importlib.html), so I'm not convinced that it does the right thing.\n> \n> On the other hand, `__import__` has [ample documentation](https://docs.python.org/2.7/library/functions.html#__import__) so I know that it does what I want it to do.\n\nSee https://docs.python.org/3.6/library/importlib.html#importlib.import_module",
    "created_at": "2017-11-20T10:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366241",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jdemeyer](#comment%3A19):
> Replying to [@embray](#comment%3A17):
> > I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.
> 
> 
> `importlib.import_module` is [almost undocumented](https://docs.python.org/2.7/library/importlib.html), so I'm not convinced that it does the right thing.
> 
> On the other hand, `__import__` has [ample documentation](https://docs.python.org/2.7/library/functions.html#__import__) so I know that it does what I want it to do.

See https://docs.python.org/3.6/library/importlib.html#importlib.import_module



---

archive/issue_comments_366242.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@embray](#comment%3A20):\n> See https://docs.python.org/3.6/library/importlib.html#importlib.import_module\n\nAnd how does it handle relative imports in Python 2? That's not documented, but it is documented for `__import__`.",
    "created_at": "2017-11-20T10:49:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366242",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@embray](#comment%3A20):
> See https://docs.python.org/3.6/library/importlib.html#importlib.import_module

And how does it handle relative imports in Python 2? That's not documented, but it is documented for `__import__`.



---

archive/issue_comments_366243.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@videlec](#comment%3A18):\n> Replying to [@embray](#comment%3A17):\n> > I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.\n> \n> \n> To avoid local imports. See [comment:14](#comment%3A14).\n\nIf I understand your point correctly, using `__import__` does not address the problem you're referring to in that comment.  E.g.\n\n```\n>>> import importlib, sys\n>>> 'numpy' in sys.modules\nFalse\n>>> mod = __import__('numpy', {}, {}, [], 0)\n>>> mod\n<module 'numpy' from '/usr/lib/python2.7/site-packages/numpy/__init__.pyc'>\n>>> 'numpy' in sys.modules\nTrue\n```\n\nThis is because (traditionally) inserting the module into `sys.modules` is a job performed by the relevant module `Loader`.  The fact that that happens at all is in a lower level of abstraction than the `import` statement (which calls `__import__`).\n\n`importlib.import_module` is a wrapper around `__import__` that just has more obvious semantics in terms of how dotted module names are handled, and is all around simpler.  The Python 3 docs recommend using it for this kind of purpose over `__import__`.",
    "created_at": "2017-11-20T11:10:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366243",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@videlec](#comment%3A18):
> Replying to [@embray](#comment%3A17):
> > I don't understand why this calls `__import__` with a bunch of a default arguments instead of just using `importlib.import_module`.
> 
> 
> To avoid local imports. See [comment:14](#comment%3A14).

If I understand your point correctly, using `__import__` does not address the problem you're referring to in that comment.  E.g.

```
>>> import importlib, sys
>>> 'numpy' in sys.modules
False
>>> mod = __import__('numpy', {}, {}, [], 0)
>>> mod
<module 'numpy' from '/usr/lib/python2.7/site-packages/numpy/__init__.pyc'>
>>> 'numpy' in sys.modules
True
```

This is because (traditionally) inserting the module into `sys.modules` is a job performed by the relevant module `Loader`.  The fact that that happens at all is in a lower level of abstraction than the `import` statement (which calls `__import__`).

`importlib.import_module` is a wrapper around `__import__` that just has more obvious semantics in terms of how dotted module names are handled, and is all around simpler.  The Python 3 docs recommend using it for this kind of purpose over `__import__`.



---

archive/issue_comments_366244.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@embray](#comment%3A22):\n> The Python 3 docs\n\n...are not relevant since Sage still uses Python 2.\n\nWhat are you pushing so much for `importlib.import_module`? If `__import__` works, why shouldn't we use it?",
    "created_at": "2017-11-20T11:13:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366244",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@embray](#comment%3A22):
> The Python 3 docs

...are not relevant since Sage still uses Python 2.

What are you pushing so much for `importlib.import_module`? If `__import__` works, why shouldn't we use it?



---

archive/issue_comments_366245.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jdemeyer](#comment%3A23):\n> Replying to [@embray](#comment%3A22):\n> > The Python 3 docs\n> \n> \n> ...are not relevant since Sage still uses Python 2.\n\nFor now...\n \n> What are you pushing so much for `importlib.import_module`? If `__import__` works, why shouldn't we use it?\n\nI'm so sorry that the documentation in Python 2 surrounding this is not to your liking.  A lot of the import-related modules that wasn't previously well documented is better documented now in the Python 3 docs simply because that's where the documentation improvements were made, and many of them were not backported I guess (maybe in part because there were so many other changes to the import system).\n\nThe whole point of `import_module` is that it's just simpler and implements to \"obvious\" semantics of import-by-name.  With `__import__` you pass in a mysterious `{}` basically to to force absolute imports, where as with `import_module` it's plain: `import_module('numpy')`.\n\nIn other words, its purpose is to do exactly what you want to do without dealing with the more complicated (and sometimes shifting) sematics of `__import__`.",
    "created_at": "2017-11-20T11:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366245",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jdemeyer](#comment%3A23):
> Replying to [@embray](#comment%3A22):
> > The Python 3 docs
> 
> 
> ...are not relevant since Sage still uses Python 2.

For now...
 
> What are you pushing so much for `importlib.import_module`? If `__import__` works, why shouldn't we use it?

I'm so sorry that the documentation in Python 2 surrounding this is not to your liking.  A lot of the import-related modules that wasn't previously well documented is better documented now in the Python 3 docs simply because that's where the documentation improvements were made, and many of them were not backported I guess (maybe in part because there were so many other changes to the import system).

The whole point of `import_module` is that it's just simpler and implements to "obvious" semantics of import-by-name.  With `__import__` you pass in a mysterious `{}` basically to to force absolute imports, where as with `import_module` it's plain: `import_module('numpy')`.

In other words, its purpose is to do exactly what you want to do without dealing with the more complicated (and sometimes shifting) sematics of `__import__`.



---

archive/issue_comments_366246.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThis is kind of like asking \"why are you using `MyClass()` instead of `inst = MyClass.__new__(); if isinstance(inst, MyClass): inst.__init__()`?\"",
    "created_at": "2017-11-20T11:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366246",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

This is kind of like asking "why are you using `MyClass()` instead of `inst = MyClass.__new__(); if isinstance(inst, MyClass): inst.__init__()`?"



---

archive/issue_comments_366247.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@embray](#comment%3A24):\n> I'm so sorry that the documentation in Python 2 surrounding this is not to your liking.\n\nYou're sounding sarcastic (intentional or not, I have no idea).\n\nBut the point is that documentation is important. The `import` statement maps directly to `__import__` and `__import__` is well documented. So I can be confident with using `__import__` here.\n\nIf you want to use `importlib` and want me to review that, then I will need to read the source code of `importlib`. That is not a disaster, but why should I be forced to do that?",
    "created_at": "2017-11-20T11:51:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366247",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@embray](#comment%3A24):
> I'm so sorry that the documentation in Python 2 surrounding this is not to your liking.

You're sounding sarcastic (intentional or not, I have no idea).

But the point is that documentation is important. The `import` statement maps directly to `__import__` and `__import__` is well documented. So I can be confident with using `__import__` here.

If you want to use `importlib` and want me to review that, then I will need to read the source code of `importlib`. That is not a disaster, but why should I be forced to do that?



---

archive/issue_comments_366248.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jdemeyer](#comment%3A26):\n> Replying to [@embray](#comment%3A24):\n> > I'm so sorry that the documentation in Python 2 surrounding this is not to your liking.\n> \n> \n> You're sounding sarcastic (intentional or not, I have no idea).\n\nYes and no.  I sincerely am sorry, because I understand where you're coming from and I don't think this actually matters much, but I also feel like you're stubbornly sticking to a more complicated way to do a thing because the version of the documentation you looked at wasn't as current-as if documentation is always perfect.  In this case your choice isn't *wrong*--it's just needlessly using a lower-level interface for something that can be doing with a simpler higher level interface.  `importlib.import_module` was explicitly backported to Python 2.7 to help write more forward-compatible code.\n\n> But the point is that documentation is important. The `import` statement maps directly to `__import__` and `__import__` is well documented. So I can be confident with using `__import__` here.\n> \n> If you want to use `importlib` and want me to review that, then I will need to read the source code of `importlib`. That is not a disaster, but why should I be forced to do that?\n\nNo, actually, you don't; not any more than you need to read the source code of `__import__` itself.\n\nI'll explain--I think the misunderstanding here is that `importlib` was originally added in Python 3, and small parts of it backported to Python 2.7 to aid with forward compatibility.  So in fact this function does work the same as documented in the current Python 3 docs (though it's implemented slightly differently).  The admonition in the more current docs still applies:  \"**Note:** [`__import__`] is an advanced function that is not needed in everyday Python programming, unlike `importlib.import_module()`.\"\n\nBy all means, leave it as is--as you said it works.  I was just trying to help by pointing out a simpler way...",
    "created_at": "2017-11-20T13:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366248",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jdemeyer](#comment%3A26):
> Replying to [@embray](#comment%3A24):
> > I'm so sorry that the documentation in Python 2 surrounding this is not to your liking.
> 
> 
> You're sounding sarcastic (intentional or not, I have no idea).

Yes and no.  I sincerely am sorry, because I understand where you're coming from and I don't think this actually matters much, but I also feel like you're stubbornly sticking to a more complicated way to do a thing because the version of the documentation you looked at wasn't as current-as if documentation is always perfect.  In this case your choice isn't *wrong*--it's just needlessly using a lower-level interface for something that can be doing with a simpler higher level interface.  `importlib.import_module` was explicitly backported to Python 2.7 to help write more forward-compatible code.

> But the point is that documentation is important. The `import` statement maps directly to `__import__` and `__import__` is well documented. So I can be confident with using `__import__` here.
> 
> If you want to use `importlib` and want me to review that, then I will need to read the source code of `importlib`. That is not a disaster, but why should I be forced to do that?

No, actually, you don't; not any more than you need to read the source code of `__import__` itself.

I'll explain--I think the misunderstanding here is that `importlib` was originally added in Python 3, and small parts of it backported to Python 2.7 to aid with forward compatibility.  So in fact this function does work the same as documented in the current Python 3 docs (though it's implemented slightly differently).  The admonition in the more current docs still applies:  "**Note:** [`__import__`] is an advanced function that is not needed in everyday Python programming, unlike `importlib.import_module()`."

By all means, leave it as is--as you said it works.  I was just trying to help by pointing out a simpler way...



---

archive/issue_comments_366249.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2017-11-20T13:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366249",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_events_333026.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-20T13:10:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333026"
}
```



---

archive/issue_events_333027.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-20T13:10:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333027"
}
```



---

archive/issue_comments_366250.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/24215](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24215)** to **[`7f06e71`](https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)**",
    "created_at": "2017-12-11T01:02:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24215#issuecomment-366250",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/24215](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24215)** to **[`7f06e71`](https://github.com/sagemath/sagetrac-mirror/commit/7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)**



---

archive/issue_events_333028.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-11T01:02:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333028"
}
```



---

archive/issue_events_333029.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "307076b609dbb24a137783c31ff478d159f26507",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-12-11T01:02:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24215",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24215#event-333029"
}
```
