# Issue 24814: Don't abuse prepare_dict() in ChainComplex

archive/issues_024577.json:
```json
{
    "assignees": [],
    "body": "The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n\nThis should be fixed because #24742 plans to remove the `prepare_dict` function.\n\nBranch/Commit: **[f3497c3](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24814_\n\n",
    "closed_at": "2018-02-25T19:59:00Z",
    "created_at": "2018-02-22T11:25:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Don't abuse prepare_dict() in ChainComplex",
    "type": "issue",
    "updated_at": "2018-02-25T19:59:00Z",
    "url": "https://github.com/sagemath/sage/issues/24814",
    "user": "https://github.com/jdemeyer"
}
```
The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.

This should be fixed because #24742 plans to remove the `prepare_dict` function.

Branch/Commit: **[f3497c3](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)**

Reviewer: **Frédéric Chapoton**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/24814_





---

archive/issue_events_325417.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-22T11:25:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325417"
}
```



---

archive/issue_events_325418.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-22T11:25:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325418"
}
```



---

archive/issue_events_325419.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-22T11:25:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325419"
}
```



---

archive/issue_comments_379914.json:
```json
{
    "body": "Branch: **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)**",
    "created_at": "2018-02-22T11:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379914",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)**



---

archive/issue_comments_379915.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9\">36b2456</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>\n",
    "created_at": "2018-02-22T11:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379915",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9">36b2456</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>




---

archive/issue_comments_379916.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n \n This should be fixed because #24742 plans to remove the `prepare_dict` function.\n+\n+`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):\n+\n+```python\n+            guess = next(iter(dict.keys()))\n+            if guess - deg in dict:\n+                string += \"\\\\dots \\\\xrightarrow{d_{%s}} \" % latex(guess-deg)\n+            string += _latex_module(ring, mat.ncols())\n+            string += \" \\\\xrightarrow{d_{%s}} \\\\dots\" % latex(guess)\n+```\n+I replaced this block with a `raise NotImplementedError`.\n``````\n",
    "created_at": "2018-02-22T11:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379916",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
 The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.
 
 This should be fixed because #24742 plans to remove the `prepare_dict` function.
+
+`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):
+
+```python
+            guess = next(iter(dict.keys()))
+            if guess - deg in dict:
+                string += "\\dots \\xrightarrow{d_{%s}} " % latex(guess-deg)
+            string += _latex_module(ring, mat.ncols())
+            string += " \\xrightarrow{d_{%s}} \\dots" % latex(guess)
+```
+I replaced this block with a `raise NotImplementedError`.
``````




---

archive/issue_events_325420.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-22T11:48:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325420"
}
```



---

archive/issue_comments_379917.json:
```json
{
    "body": "Commit: **[36b2456](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)**",
    "created_at": "2018-02-22T11:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379917",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[36b2456](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)**



---

archive/issue_comments_379918.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nI think `mat` should be `dict[guess]`.",
    "created_at": "2018-02-22T16:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379918",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'>Comment 3:</a>
I think `mat` should be `dict[guess]`.



---

archive/issue_comments_379919.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBut chain complexes with `grading_group` not equal to `ZZ` are not well tested in general...",
    "created_at": "2018-02-22T16:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379919",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'>Comment 4:</a>
But chain complexes with `grading_group` not equal to `ZZ` are not well tested in general...



---

archive/issue_comments_379920.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@jhpalmieri](#comment%3A3):\n> I think `mat` should be `dict[guess]`.\n\nI put your suggestion on #24826",
    "created_at": "2018-02-23T14:39:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379920",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@jhpalmieri](#comment%3A3):
> I think `mat` should be `dict[guess]`.

I put your suggestion on #24826



---

archive/issue_comments_379921.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f\">f3497c3</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>\n",
    "created_at": "2018-02-23T14:55:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379921",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'>Comment 6:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f">f3497c3</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>




---

archive/issue_comments_379922.json:
```json
{
    "body": "Changed commit from **[36b2456](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)** to **[f3497c3](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)**",
    "created_at": "2018-02-23T14:55:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379922",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[36b2456](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)** to **[f3497c3](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)**



---

archive/issue_comments_379923.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,3 @@\n The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n \n This should be fixed because #24742 plans to remove the `prepare_dict` function.\n-\n-`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):\n-\n-```python\n-            guess = next(iter(dict.keys()))\n-            if guess - deg in dict:\n-                string += \"\\\\dots \\\\xrightarrow{d_{%s}} \" % latex(guess-deg)\n-            string += _latex_module(ring, mat.ncols())\n-            string += \" \\\\xrightarrow{d_{%s}} \\\\dots\" % latex(guess)\n-```\n-I replaced this block with a `raise NotImplementedError`.\n``````\n",
    "created_at": "2018-02-23T14:55:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379923",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,3 @@
 The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.
 
 This should be fixed because #24742 plans to remove the `prepare_dict` function.
-
-`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):
-
-```python
-            guess = next(iter(dict.keys()))
-            if guess - deg in dict:
-                string += "\\dots \\xrightarrow{d_{%s}} " % latex(guess-deg)
-            string += _latex_module(ring, mat.ncols())
-            string += " \\xrightarrow{d_{%s}} \\dots" % latex(guess)
-```
-I replaced this block with a `raise NotImplementedError`.
``````




---

archive/issue_comments_379924.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)** to **[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)**",
    "created_at": "2018-02-24T18:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379924",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)** to **[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)**



---

archive/issue_comments_379925.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nSorry, changed the branch for the wrong ticket. Fixed now.",
    "created_at": "2018-02-24T18:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379925",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'>Comment 9:</a>
Sorry, changed the branch for the wrong ticket. Fixed now.



---

archive/issue_comments_379926.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)** to **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)**",
    "created_at": "2018-02-24T18:37:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379926",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)** to **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)**



---

archive/issue_events_325421.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-24T19:29:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325421"
}
```



---

archive/issue_events_325422.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-24T19:29:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325422"
}
```



---

archive/issue_comments_379927.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nok",
    "created_at": "2018-02-24T19:29:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379927",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'>Comment 10:</a>
ok



---

archive/issue_comments_379928.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2018-02-24T19:29:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379928",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_events_325423.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-25T19:59:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325423"
}
```



---

archive/issue_events_325424.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7c12eda717efe6a9ec92872bc8cc7e43b2b1a4a0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-02-25T19:59:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24814#event-325424"
}
```



---

archive/issue_comments_379929.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)** to **[f3497c3](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)**",
    "created_at": "2018-02-25T19:59:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24814#issuecomment-379929",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)** to **[f3497c3](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)**
