# Issue 24814: Don't abuse prepare_dict() in ChainComplex

archive/issues_024577.json:
```json
{
    "body": "The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n\nThis should be fixed because #24742 plans to remove the `prepare_dict` function.\n\n**Branch/Commit:** [f3497c345e518b10165654df9b619b82247d1c0f](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/24814\n\n",
    "closed_at": "2018-02-25T19:59:00Z",
    "created_at": "2018-02-22T11:25:40Z",
    "labels": [
        "component: misc",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Don't abuse prepare_dict() in ChainComplex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24814",
    "user": "https://github.com/jdemeyer"
}
```
The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.

This should be fixed because #24742 plans to remove the `prepare_dict` function.

**Branch/Commit:** [f3497c345e518b10165654df9b619b82247d1c0f](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)

**Reviewer:** Frédéric Chapoton

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/24814





---

archive/issue_comments_381352.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)",
    "created_at": "2018-02-22T11:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381352",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)



---

archive/issue_comments_381353.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9\">36b2456</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>\n",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381353",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9">36b2456</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>




---

archive/issue_comments_381354.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n \n This should be fixed because #24742 plans to remove the `prepare_dict` function.\n+\n+`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):\n+\n+```python\n+            guess = next(iter(dict.keys()))\n+            if guess - deg in dict:\n+                string += \"\\\\dots \\\\xrightarrow{d_{%s}} \" % latex(guess-deg)\n+            string += _latex_module(ring, mat.ncols())\n+            string += \" \\\\xrightarrow{d_{%s}} \\\\dots\" % latex(guess)\n+```\n+I replaced this block with a `raise NotImplementedError`.\n``````\n",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381354",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
 The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.
 
 This should be fixed because #24742 plans to remove the `prepare_dict` function.
+
+`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):
+
+```python
+            guess = next(iter(dict.keys()))
+            if guess - deg in dict:
+                string += "\\dots \\xrightarrow{d_{%s}} " % latex(guess-deg)
+            string += _latex_module(ring, mat.ncols())
+            string += " \\xrightarrow{d_{%s}} \\dots" % latex(guess)
+```
+I replaced this block with a `raise NotImplementedError`.
``````




---

archive/issue_events_224003.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-02-22T11:48:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24814#event-224003"
}
```



---

archive/issue_comments_381355.json:
```json
{
    "body": "**Commit:** [36b2456f953b237dfab86ab64d8f3da122d665f9](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381355",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [36b2456f953b237dfab86ab64d8f3da122d665f9](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)



---

archive/issue_comments_381356.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think `mat` should be `dict[guess]`.",
    "created_at": "2018-02-22T16:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381356",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
I think `mat` should be `dict[guess]`.



---

archive/issue_comments_381357.json:
```json
{
    "body": "<a id='comment:4'></a>\nBut chain complexes with `grading_group` not equal to `ZZ` are not well tested in general...",
    "created_at": "2018-02-22T16:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381357",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
But chain complexes with `grading_group` not equal to `ZZ` are not well tested in general...



---

archive/issue_comments_381358.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jhpalmieri](#comment%3A3):\n> I think `mat` should be `dict[guess]`.\n\n\nI put your suggestion on #24826",
    "created_at": "2018-02-23T14:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381358",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [jhpalmieri](#comment%3A3):
> I think `mat` should be `dict[guess]`.


I put your suggestion on #24826



---

archive/issue_comments_381359.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f\">f3497c3</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>\n",
    "created_at": "2018-02-23T14:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381359",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f">f3497c3</a></td><td><code>Stop using prepare_dict()</code></td></tr></table>




---

archive/issue_comments_381360.json:
```json
{
    "body": "**Changing commit** from \"[36b2456f953b237dfab86ab64d8f3da122d665f9](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)\" to \"[f3497c345e518b10165654df9b619b82247d1c0f](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)\".",
    "created_at": "2018-02-23T14:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[36b2456f953b237dfab86ab64d8f3da122d665f9](https://github.com/sagemath/sagetrac-mirror/commit/36b2456f953b237dfab86ab64d8f3da122d665f9)" to "[f3497c345e518b10165654df9b619b82247d1c0f](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)".



---

archive/issue_comments_381361.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,14 +1,3 @@\n The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n \n This should be fixed because #24742 plans to remove the `prepare_dict` function.\n-\n-`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):\n-\n-```python\n-            guess = next(iter(dict.keys()))\n-            if guess - deg in dict:\n-                string += \"\\\\dots \\\\xrightarrow{d_{%s}} \" % latex(guess-deg)\n-            string += _latex_module(ring, mat.ncols())\n-            string += \" \\\\xrightarrow{d_{%s}} \\\\dots\" % latex(guess)\n-```\n-I replaced this block with a `raise NotImplementedError`.\n``````\n",
    "created_at": "2018-02-23T14:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381361",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,14 +1,3 @@
 The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.
 
 This should be fixed because #24742 plans to remove the `prepare_dict` function.
-
-`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):
-
-```python
-            guess = next(iter(dict.keys()))
-            if guess - deg in dict:
-                string += "\\dots \\xrightarrow{d_{%s}} " % latex(guess-deg)
-            string += _latex_module(ring, mat.ncols())
-            string += " \\xrightarrow{d_{%s}} \\dots" % latex(guess)
-```
-I replaced this block with a `raise NotImplementedError`.
``````




---

archive/issue_comments_381362.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)\" to \"[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)\".",
    "created_at": "2018-02-24T18:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381362",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)" to "[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)".



---

archive/issue_comments_381363.json:
```json
{
    "body": "<a id='comment:9'></a>\nSorry, changed the branch for the wrong ticket. Fixed now.",
    "created_at": "2018-02-24T18:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381363",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Sorry, changed the branch for the wrong ticket. Fixed now.



---

archive/issue_comments_381364.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)\" to \"[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)\".",
    "created_at": "2018-02-24T18:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381364",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/jhpalmieri/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/ticket/24814)" to "[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)".



---

archive/issue_events_224004.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-24T19:29:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24814#event-224004"
}
```



---

archive/issue_events_224005.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-02-24T19:29:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24814#event-224005"
}
```



---

archive/issue_comments_381365.json:
```json
{
    "body": "<a id='comment:10'></a>\nok",
    "created_at": "2018-02-24T19:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381365",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
ok



---

archive/issue_comments_381366.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2018-02-24T19:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381366",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_events_224006.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-25T19:59:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24814#event-224006"
}
```



---

archive/issue_events_224007.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-25T19:59:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24814#event-224007"
}
```



---

archive/issue_comments_381367.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)\" to \"[f3497c345e518b10165654df9b619b82247d1c0f](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)\".",
    "created_at": "2018-02-25T19:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-381367",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/24814](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24814)" to "[f3497c345e518b10165654df9b619b82247d1c0f](https://github.com/sagemath/sagetrac-mirror/commit/f3497c345e518b10165654df9b619b82247d1c0f)".
