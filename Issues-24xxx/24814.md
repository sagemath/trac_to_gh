# Issue 24814: Don't abuse prepare_dict() in ChainComplex

archive/issues_024577.json:
```json
{
    "body": "The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n\nThis should be fixed because #24742 plans to remove the `prepare_dict` function.\n\nBranch/Commit: f3497c345e518b10165654df9b619b82247d1c0f\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24814\n\n",
    "closed_at": "2018-02-25T19:59:00Z",
    "created_at": "2018-02-22T11:25:40Z",
    "labels": [
        "component: misc"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Don't abuse prepare_dict() in ChainComplex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24814",
    "user": "https://github.com/jdemeyer"
}
```
The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.

This should be fixed because #24742 plans to remove the `prepare_dict` function.

Branch/Commit: f3497c345e518b10165654df9b619b82247d1c0f

Reviewer: Frédéric Chapoton

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24814





---

archive/issue_comments_471379.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/ticket/24814\"",
    "created_at": "2018-02-22T11:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471379",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/ticket/24814"



---

archive/issue_comments_471380.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[36b2456](https://git.sagemath.org/sage.git/commit?id=36b2456f953b237dfab86ab64d8f3da122d665f9)|`Stop using prepare_dict()`|",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471380",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[36b2456](https://git.sagemath.org/sage.git/commit?id=36b2456f953b237dfab86ab64d8f3da122d665f9)|`Stop using prepare_dict()`|



---

archive/issue_comments_471381.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,14 @@\n The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n \n This should be fixed because #24742 plans to remove the `prepare_dict` function.\n+\n+`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):\n+\n+```python\n+            guess = next(iter(dict.keys()))\n+            if guess - deg in dict:\n+                string += \"\\\\dots \\\\xrightarrow{d_{%s}} \" % latex(guess-deg)\n+            string += _latex_module(ring, mat.ncols())\n+            string += \" \\\\xrightarrow{d_{%s}} \\\\dots\" % latex(guess)\n+```\n+I replaced this block with a `raise NotImplementedError`.\n``````\n",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471381",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,14 @@
 The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.
 
 This should be fixed because #24742 plans to remove the `prepare_dict` function.
+
+`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):
+
+```python
+            guess = next(iter(dict.keys()))
+            if guess - deg in dict:
+                string += "\\dots \\xrightarrow{d_{%s}} " % latex(guess-deg)
+            string += _latex_module(ring, mat.ncols())
+            string += " \\xrightarrow{d_{%s}} \\dots" % latex(guess)
+```
+I replaced this block with a `raise NotImplementedError`.
``````




---

archive/issue_comments_471382.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471382",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_471383.json:
```json
{
    "body": "Changing commit from \"\" to \"36b2456f953b237dfab86ab64d8f3da122d665f9\"",
    "created_at": "2018-02-22T11:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471383",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "36b2456f953b237dfab86ab64d8f3da122d665f9"



---

archive/issue_comments_471384.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think `mat` should be `dict[guess]`.",
    "created_at": "2018-02-22T16:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471384",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
I think `mat` should be `dict[guess]`.



---

archive/issue_comments_471385.json:
```json
{
    "body": "<a id='comment:4'></a>\nBut chain complexes with `grading_group` not equal to `ZZ` are not well tested in general...",
    "created_at": "2018-02-22T16:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471385",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
But chain complexes with `grading_group` not equal to `ZZ` are not well tested in general...



---

archive/issue_comments_471386.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [jhpalmieri](#comment%3A3):\n> I think `mat` should be `dict[guess]`.\n\n\nI put your suggestion on #24826",
    "created_at": "2018-02-23T14:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471386",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [jhpalmieri](#comment%3A3):
> I think `mat` should be `dict[guess]`.


I put your suggestion on #24826



---

archive/issue_comments_471387.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[f3497c3](https://git.sagemath.org/sage.git/commit/?id=f3497c345e518b10165654df9b619b82247d1c0f)|`Stop using prepare_dict()`|",
    "created_at": "2018-02-23T14:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[f3497c3](https://git.sagemath.org/sage.git/commit/?id=f3497c345e518b10165654df9b619b82247d1c0f)|`Stop using prepare_dict()`|



---

archive/issue_comments_471388.json:
```json
{
    "body": "Changing commit from \"36b2456f953b237dfab86ab64d8f3da122d665f9\" to \"f3497c345e518b10165654df9b619b82247d1c0f\"",
    "created_at": "2018-02-23T14:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "36b2456f953b237dfab86ab64d8f3da122d665f9" to "f3497c345e518b10165654df9b619b82247d1c0f"



---

archive/issue_comments_471389.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,3 @@\n The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.\n \n This should be fixed because #24742 plans to remove the `prepare_dict` function.\n-\n-`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):\n-\n-```python\n-            guess = next(iter(dict.keys()))\n-            if guess - deg in dict:\n-                string += \"\\\\dots \\\\xrightarrow{d_{%s}} \" % latex(guess-deg)\n-            string += _latex_module(ring, mat.ncols())\n-            string += \" \\\\xrightarrow{d_{%s}} \\\\dots\" % latex(guess)\n-```\n-I replaced this block with a `raise NotImplementedError`.\n``````\n",
    "created_at": "2018-02-23T14:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471389",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,3 @@
 The function `prepare_dict` is meant to be used by the matrix constructor. However, it is also used in a convoluted and inefficient way in `ChainComplex`.
 
 This should be fixed because #24742 plans to remove the `prepare_dict` function.
-
-`pyflakes` also noticed that this code from `_latex_` is broken (`mat` is undefined):
-
-```python
-            guess = next(iter(dict.keys()))
-            if guess - deg in dict:
-                string += "\\dots \\xrightarrow{d_{%s}} " % latex(guess-deg)
-            string += _latex_module(ring, mat.ncols())
-            string += " \\xrightarrow{d_{%s}} \\dots" % latex(guess)
-```
-I replaced this block with a `raise NotImplementedError`.
``````




---

archive/issue_comments_471390.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/24814\" to \"u/jhpalmieri/ticket/24814\"",
    "created_at": "2018-02-24T18:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471390",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "u/jdemeyer/ticket/24814" to "u/jhpalmieri/ticket/24814"



---

archive/issue_comments_471391.json:
```json
{
    "body": "<a id='comment:9'></a>\nSorry, changed the branch for the wrong ticket. Fixed now.",
    "created_at": "2018-02-24T18:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471391",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Sorry, changed the branch for the wrong ticket. Fixed now.



---

archive/issue_comments_471392.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/ticket/24814\" to \"u/jdemeyer/ticket/24814\"",
    "created_at": "2018-02-24T18:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471392",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "u/jhpalmieri/ticket/24814" to "u/jdemeyer/ticket/24814"



---

archive/issue_comments_471393.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-24T19:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471393",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471394.json:
```json
{
    "body": "<a id='comment:10'></a>\nok",
    "created_at": "2018-02-24T19:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471394",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
ok



---

archive/issue_comments_471395.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2018-02-24T19:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471395",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_events_062370.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-25T19:59:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24814#event-62370"
}
```



---

archive/issue_comments_471396.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-25T19:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471396",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_471397.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/ticket/24814\" to \"f3497c345e518b10165654df9b619b82247d1c0f\"",
    "created_at": "2018-02-25T19:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24814#issuecomment-471397",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/ticket/24814" to "f3497c345e518b10165654df9b619b82247d1c0f"
