# Issue 24929: Fix q_binomial

archive/issues_024692.json:
```json
{
    "body": "We fix three bugs with `q_binomial`:\n\n1.\n\n```\nsage: R.<q> = QQ[]\nsage: q_binomial(2, 1 ,q-1, algorithm=\"naive\")\nq\nsage: q_binomial(2, 1 ,q-1, algorithm=\"cyclotomic\")\nq + 1\n```\n\n2.\n\n```\nsage: q_binomial(4, 3, 1, algorithm=\"naive\")\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-0d4b1b1e4d70> in <module>()\n----> 1 q_binomial(Integer(4), Integer(3), Integer(1), algorithm=\"naive\")\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.pyc in q_binomial(n, k, q, algorithm)\n    327         if not denom:  # q is a root of unity, use the cyclotomic algorithm\n    328             from sage.rings.polynomial.cyclotomic import cyclotomic_value\n--> 329             return cyclotomic_value(n, k, q, algorithm='cyclotomic')\n    330         else:\n    331             num = prod(one - q**i for i in range(n-k+1, n+1))\n\n/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/polynomial/cyclotomic.pyx in sage.rings.polynomial.cyclotomic.cyclotomic_value (build/cythonized/sage/rings/polynomial/cyclotomic.c:5668)()\n    194     return L\n    195 \n--> 196 def cyclotomic_value(n, x):\n    197     \"\"\"\n    198     Return the value of the `n`-th cyclotomic polynomial evaluated at `x`.\n\nTypeError: cyclotomic_value() takes exactly 2 positional arguments (3 given)\n```\n\n3.\n\n```\nsage: parent(q_binomial(3,2))\nUnivariate Polynomial Ring in q over Integer Ring\nsage: parent(q_binomial(3,3))\nInteger Ring\n```\n\nCC:  @videlec @tscrim\n\nBranch/Commit: ab4e1423785274f66801a44745047e823d0d7fe2\n\nReviewer: Vincent Delecroix, Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24929\n\n",
    "closed_at": "2018-03-19T21:59:29Z",
    "created_at": "2018-03-08T12:39:47Z",
    "labels": [
        "component: combinatorics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Fix q_binomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24929",
    "user": "https://github.com/jdemeyer"
}
```
We fix three bugs with `q_binomial`:

1.

```
sage: R.<q> = QQ[]
sage: q_binomial(2, 1 ,q-1, algorithm="naive")
q
sage: q_binomial(2, 1 ,q-1, algorithm="cyclotomic")
q + 1
```

2.

```
sage: q_binomial(4, 3, 1, algorithm="naive")
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-0d4b1b1e4d70> in <module>()
----> 1 q_binomial(Integer(4), Integer(3), Integer(1), algorithm="naive")

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.pyc in q_binomial(n, k, q, algorithm)
    327         if not denom:  # q is a root of unity, use the cyclotomic algorithm
    328             from sage.rings.polynomial.cyclotomic import cyclotomic_value
--> 329             return cyclotomic_value(n, k, q, algorithm='cyclotomic')
    330         else:
    331             num = prod(one - q**i for i in range(n-k+1, n+1))

/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/polynomial/cyclotomic.pyx in sage.rings.polynomial.cyclotomic.cyclotomic_value (build/cythonized/sage/rings/polynomial/cyclotomic.c:5668)()
    194     return L
    195 
--> 196 def cyclotomic_value(n, x):
    197     """
    198     Return the value of the `n`-th cyclotomic polynomial evaluated at `x`.

TypeError: cyclotomic_value() takes exactly 2 positional arguments (3 given)
```

3.

```
sage: parent(q_binomial(3,2))
Univariate Polynomial Ring in q over Integer Ring
sage: parent(q_binomial(3,3))
Integer Ring
```

CC:  @videlec @tscrim

Branch/Commit: ab4e1423785274f66801a44745047e823d0d7fe2

Reviewer: Vincent Delecroix, Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24929





---

archive/issue_comments_368998.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,17 @@\n+We fix two bugs with `q_binomial`:\n+\n+1.\n+\n+```\n+sage: R.<q> = QQ[]\n+sage: q_binomial(2, 1 ,q-1, algorithm=\"naive\")\n+q\n+sage: q_binomial(2, 1 ,q-1, algorithm=\"cyclotomic\")\n+q + 1\n+```\n+\n+2.\n+\n ```\n sage: parent(q_binomial(3,2))\n Univariate Polynomial Ring in q over Integer Ring\n```\n",
    "created_at": "2018-03-08T12:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-368998",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,17 @@
+We fix two bugs with `q_binomial`:
+
+1.
+
+```
+sage: R.<q> = QQ[]
+sage: q_binomial(2, 1 ,q-1, algorithm="naive")
+q
+sage: q_binomial(2, 1 ,q-1, algorithm="cyclotomic")
+q + 1
+```
+
+2.
+
 ```
 sage: parent(q_binomial(3,2))
 Univariate Polynomial Ring in q over Integer Ring
```




---

archive/issue_comments_368999.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2018-03-08T12:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-368999",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to critical.



---

archive/issue_comments_369000.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,49 @@\n+We fix three bugs with `q_binomial`:\n \n+1.\n+\n+```\n+sage: R.<q> = QQ[]\n+sage: q_binomial(2, 1 ,q-1, algorithm=\"naive\")\n+q\n+sage: q_binomial(2, 1 ,q-1, algorithm=\"cyclotomic\")\n+q + 1\n+```\n+\n+2.\n+\n+```\n+sage: q_binomial(4, 3, 1, algorithm=\"naive\")\n+---------------------------------------------------------------------------\n+TypeError                                 Traceback (most recent call last)\n+<ipython-input-2-0d4b1b1e4d70> in <module>()\n+----> 1 q_binomial(Integer(4), Integer(3), Integer(1), algorithm=\"naive\")\n+\n+/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.pyc in q_binomial(n, k, q, algorithm)\n+    327         if not denom:  # q is a root of unity, use the cyclotomic algorithm\n+    328             from sage.rings.polynomial.cyclotomic import cyclotomic_value\n+--> 329             return cyclotomic_value(n, k, q, algorithm='cyclotomic')\n+    330         else:\n+    331             num = prod(one - q**i for i in range(n-k+1, n+1))\n+\n+/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/polynomial/cyclotomic.pyx in sage.rings.polynomial.cyclotomic.cyclotomic_value (build/cythonized/sage/rings/polynomial/cyclotomic.c:5668)()\n+    194     return L\n+    195 \n+--> 196 def cyclotomic_value(n, x):\n+    197     \"\"\"\n+    198     Return the value of the `n`-th cyclotomic polynomial evaluated at `x`.\n+\n+TypeError: cyclotomic_value() takes exactly 2 positional arguments (3 given)\n+```\n+\n+3.\n+\n+```\n+sage: parent(q_binomial(3,2))\n+Univariate Polynomial Ring in q over Integer Ring\n+sage: parent(q_binomial(3,3))\n+Integer Ring\n+```\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-03-08T12:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369000",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,49 @@
+We fix three bugs with `q_binomial`:
 
+1.
+
+```
+sage: R.<q> = QQ[]
+sage: q_binomial(2, 1 ,q-1, algorithm="naive")
+q
+sage: q_binomial(2, 1 ,q-1, algorithm="cyclotomic")
+q + 1
+```
+
+2.
+
+```
+sage: q_binomial(4, 3, 1, algorithm="naive")
+---------------------------------------------------------------------------
+TypeError                                 Traceback (most recent call last)
+<ipython-input-2-0d4b1b1e4d70> in <module>()
+----> 1 q_binomial(Integer(4), Integer(3), Integer(1), algorithm="naive")
+
+/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/combinat/q_analogues.pyc in q_binomial(n, k, q, algorithm)
+    327         if not denom:  # q is a root of unity, use the cyclotomic algorithm
+    328             from sage.rings.polynomial.cyclotomic import cyclotomic_value
+--> 329             return cyclotomic_value(n, k, q, algorithm='cyclotomic')
+    330         else:
+    331             num = prod(one - q**i for i in range(n-k+1, n+1))
+
+/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/rings/polynomial/cyclotomic.pyx in sage.rings.polynomial.cyclotomic.cyclotomic_value (build/cythonized/sage/rings/polynomial/cyclotomic.c:5668)()
+    194     return L
+    195 
+--> 196 def cyclotomic_value(n, x):
+    197     """
+    198     Return the value of the `n`-th cyclotomic polynomial evaluated at `x`.
+
+TypeError: cyclotomic_value() takes exactly 2 positional arguments (3 given)
+```
+
+3.
+
+```
+sage: parent(q_binomial(3,2))
+Univariate Polynomial Ring in q over Integer Ring
+sage: parent(q_binomial(3,3))
+Integer Ring
+```
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_369001.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2018-03-08T13:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369001",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_369002.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-08T13:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369002",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369003.json:
```json
{
    "body": "<a id='comment:5'></a>`R.zero()` and `R.one()` should always work for rings.",
    "created_at": "2018-03-08T13:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369003",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>`R.zero()` and `R.one()` should always work for rings.



---

archive/issue_comments_369004.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 vdelecroix]:\n> `R.zero()` and `R.one()` should always work for rings.\n\n\nAnd `R(0)` and `R(1)` should always work without conditions.",
    "created_at": "2018-03-08T13:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369004",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:5 vdelecroix]:
> `R.zero()` and `R.one()` should always work for rings.


And `R(0)` and `R(1)` should always work without conditions.



---

archive/issue_comments_369005.json:
```json
{
    "body": "<a id='comment:7'></a>You are breaking the pep8 formatting of the header. Please do not do that.",
    "created_at": "2018-03-08T16:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369005",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>You are breaking the pep8 formatting of the header. Please do not do that.



---

archive/issue_comments_369006.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-08T16:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369007.json:
```json
{
    "body": "<a id='comment:9'></a>I am guessing you want `R(0)` and `R(1)` in case `R` is something like `int` so we don't have to special case it. Could you add a comment saying this as otherwise someone (who could very well be me) might go to `R.zero()`/`R.one()` as it is faster (avoids going through the coercion framework) and cached.",
    "created_at": "2018-03-08T23:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369007",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>I am guessing you want `R(0)` and `R(1)` in case `R` is something like `int` so we don't have to special case it. Could you add a comment saying this as otherwise someone (who could very well be me) might go to `R.zero()`/`R.one()` as it is faster (avoids going through the coercion framework) and cached.



---

archive/issue_comments_369008.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-09T09:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369009.json:
```json
{
    "body": "<a id='comment:11'></a>LGTM. Any other comments or objections to setting a positive review?",
    "created_at": "2018-03-09T14:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369009",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>LGTM. Any other comments or objections to setting a positive review?



---

archive/issue_comments_369010.json:
```json
{
    "body": "<a id='comment:12'></a>Would be good to check more output types. For example in\n\n```\nsage: q_binomial(3r, 2r, 1r)\n3\n```",
    "created_at": "2018-03-09T20:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369010",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>Would be good to check more output types. For example in

```
sage: q_binomial(3r, 2r, 1r)
3
```



---

archive/issue_comments_369011.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-09T20:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_369012.json:
```json
{
    "body": "<a id='comment:14'></a>LGTM as well.",
    "created_at": "2018-03-09T21:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369012",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>LGTM as well.



---

archive/issue_comments_369013.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-09T21:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369013",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_062572.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-19T21:59:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24929#event-62572"
}
```



---

archive/issue_comments_369014.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-19T21:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24929#issuecomment-369014",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
