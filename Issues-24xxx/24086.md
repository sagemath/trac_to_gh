# Issue 24086: Atkin-Lehner normalisation issue

archive/issues_023849.json:
```json
{
    "body": "This ticket is a follow-up to #18061, concerning Atkin--Lehner actions.\n\nFirstly, with that ticket the Atkin--Lehner action is only implemented in a certain subset of cases. It would be nice if we could compute the pseudo-eigenvalues for any newform.\n\nSecondly, there is a normalisation discrepancy: according to the docstring of `sage.modular.modform.element.ModularForm_abstract.atkin_lehner_action`, our conventions are supposed to be that the pseudo-eigenvalues of the Atkin--Lehner operator W_d should have absolute value d<sup>k/2</sup> - 1. However, it doesn't seem that this convention is being enforced very consistently:\n\n```\nsage: f = Newforms(24, 4)[0]\nsage: f\nq + 3*q^3 + 14*q^5 + O(q^6)\nsage: f.atkin_lehner_eigenvalue(8)\n-1\nsage: f.atkin_lehner_eigenvalue(3)\n-3\n```\n\nKeywords: atkin-lehner\n\nBranch/Commit: 51266f9edad6cb7979cfe4023f1e86f012aa7fbe\n\nReviewer: Aly Deines, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: David Loeffler\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24086\n\n",
    "closed_at": "2018-05-20T22:55:28Z",
    "created_at": "2017-10-22T12:17:59Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Atkin-Lehner normalisation issue",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24086",
    "user": "https://github.com/loefflerd"
}
```
This ticket is a follow-up to #18061, concerning Atkin--Lehner actions.

Firstly, with that ticket the Atkin--Lehner action is only implemented in a certain subset of cases. It would be nice if we could compute the pseudo-eigenvalues for any newform.

Secondly, there is a normalisation discrepancy: according to the docstring of `sage.modular.modform.element.ModularForm_abstract.atkin_lehner_action`, our conventions are supposed to be that the pseudo-eigenvalues of the Atkin--Lehner operator W_d should have absolute value d<sup>k/2</sup> - 1. However, it doesn't seem that this convention is being enforced very consistently:

```
sage: f = Newforms(24, 4)[0]
sage: f
q + 3*q^3 + 14*q^5 + O(q^6)
sage: f.atkin_lehner_eigenvalue(8)
-1
sage: f.atkin_lehner_eigenvalue(3)
-3
```

Keywords: atkin-lehner

Branch/Commit: 51266f9edad6cb7979cfe4023f1e86f012aa7fbe

Reviewer: Aly Deines, Frédéric Chapoton

Author: David Loeffler

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24086





---

archive/issue_comments_457665.json:
```json
{
    "body": "Changing branch from \"\" to \"u/davidloeffler/atkin_lehner_normalisation_issue\"",
    "created_at": "2017-10-23T14:27:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457665",
    "user": "https://github.com/loefflerd"
}
```

Changing branch from "" to "u/davidloeffler/atkin_lehner_normalisation_issue"



---

archive/issue_comments_457666.json:
```json
{
    "body": "Changing commit from \"\" to \"955cb0651e9c0dfa9d9af60445fdb513aacf3ec8\"",
    "created_at": "2017-10-23T14:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457666",
    "user": "https://github.com/loefflerd"
}
```

Changing commit from "" to "955cb0651e9c0dfa9d9af60445fdb513aacf3ec8"



---

archive/issue_comments_457667.json:
```json
{
    "body": "Changing author from \"\" to \"David Loeffler\"",
    "created_at": "2017-10-23T14:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457667",
    "user": "https://github.com/loefflerd"
}
```

Changing author from "" to "David Loeffler"



---

archive/issue_comments_457668.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-23T14:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457668",
    "user": "https://github.com/loefflerd"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_457669.json:
```json
{
    "body": "<a id='comment:2'></a>\nHere's a patch. As well as fixing the normalisation issue, I've readjusted our conventions to be more consistent with the standard reference (Atkin--Li 1978) -- the previous version was out by a root of unity in some cases -- and added some more examples and doctests.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|\n|[955cb06](https://github.com/sagemath/sagetrac-mirror/commit/955cb0651e9c0dfa9d9af60445fdb513aacf3ec8)|`Trac 24086: fixed normalisations for Atkin-Lehner on modular symbols and added doctests`|",
    "created_at": "2017-10-23T14:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457669",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:2'></a>
Here's a patch. As well as fixing the normalisation issue, I've readjusted our conventions to be more consistent with the standard reference (Atkin--Li 1978) -- the previous version was out by a root of unity in some cases -- and added some more examples and doctests.

---
New commits:
|                                                                                                                                          |                                                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
|[955cb06](https://github.com/sagemath/sagetrac-mirror/commit/955cb0651e9c0dfa9d9af60445fdb513aacf3ec8)|`Trac 24086: fixed normalisations for Atkin-Lehner on modular symbols and added doctests`|



---

archive/issue_comments_457670.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Aly Deines\"",
    "created_at": "2017-10-23T20:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457670",
    "user": "https://github.com/adeines"
}
```

Changing reviewer from "" to "Aly Deines"



---

archive/issue_comments_457671.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-23T20:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457671",
    "user": "https://github.com/adeines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_457672.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is a small thing, in src/sage/modular/modsym/ambient.py in documentation for the method _compute_atkin_lehner_matrix, there should be an example where the sign isn't 0 so that it hits the ValueError.\n\nThe rest looks good so far.",
    "created_at": "2017-10-23T20:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457672",
    "user": "https://github.com/adeines"
}
```

<a id='comment:3'></a>
This is a small thing, in src/sage/modular/modsym/ambient.py in documentation for the method _compute_atkin_lehner_matrix, there should be an example where the sign isn't 0 so that it hits the ValueError.

The rest looks good so far.



---

archive/issue_comments_457673.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[e43ef83](https://github.com/sagemath/sagetrac-mirror/commit/e43ef83783690d17036de36e5fee4a350743e97e)|`Trac 24086: added doctests`|",
    "created_at": "2017-10-24T08:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457673",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[e43ef83](https://github.com/sagemath/sagetrac-mirror/commit/e43ef83783690d17036de36e5fee4a350743e97e)|`Trac 24086: added doctests`|



---

archive/issue_comments_457674.json:
```json
{
    "body": "Changing commit from \"955cb0651e9c0dfa9d9af60445fdb513aacf3ec8\" to \"e43ef83783690d17036de36e5fee4a350743e97e\"",
    "created_at": "2017-10-24T08:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457674",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "955cb0651e9c0dfa9d9af60445fdb513aacf3ec8" to "e43ef83783690d17036de36e5fee4a350743e97e"



---

archive/issue_comments_457675.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-24T08:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457675",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_457676.json:
```json
{
    "body": "<a id='comment:5'></a>\nGood point. I've added a doctest for this case (and another one for a GammaH level, since there weren't any of these before).",
    "created_at": "2017-10-24T08:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457676",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:5'></a>
Good point. I've added a doctest for this case (and another one for a GammaH level, since there weren't any of these before).



---

archive/issue_comments_457677.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[8ce990c](https://github.com/sagemath/sagetrac-mirror/commit/8ce990cb3c536cb6990ea8c025ab53602867c101)|`Fixed ReST formatting`|",
    "created_at": "2017-10-24T09:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[8ce990c](https://github.com/sagemath/sagetrac-mirror/commit/8ce990cb3c536cb6990ea8c025ab53602867c101)|`Fixed ReST formatting`|



---

archive/issue_comments_457678.json:
```json
{
    "body": "Changing commit from \"e43ef83783690d17036de36e5fee4a350743e97e\" to \"8ce990cb3c536cb6990ea8c025ab53602867c101\"",
    "created_at": "2017-10-24T09:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e43ef83783690d17036de36e5fee4a350743e97e" to "8ce990cb3c536cb6990ea8c025ab53602867c101"



---

archive/issue_comments_457679.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe last commit is just a tiny ReST formatting fix (to correct an error picked up by the patchbot)",
    "created_at": "2017-10-24T09:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457679",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:7'></a>
The last commit is just a tiny ReST formatting fix (to correct an error picked up by the patchbot)



---

archive/issue_comments_457680.json:
```json
{
    "body": "<a id='comment:8'></a>\nHold it, there's a doctest failing.",
    "created_at": "2017-10-24T09:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457680",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:8'></a>
Hold it, there's a doctest failing.



---

archive/issue_comments_457681.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-24T09:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457681",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_457682.json:
```json
{
    "body": "Changing commit from \"8ce990cb3c536cb6990ea8c025ab53602867c101\" to \"ea1b4e6d1b367ebb5831d1f9cdd217cc7f65ab20\"",
    "created_at": "2017-10-24T15:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8ce990cb3c536cb6990ea8c025ab53602867c101" to "ea1b4e6d1b367ebb5831d1f9cdd217cc7f65ab20"



---

archive/issue_comments_457683.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[ea1b4e6](https://github.com/sagemath/sagetrac-mirror/commit/ea1b4e6d1b367ebb5831d1f9cdd217cc7f65ab20)|`Fixed a broken doctest from trac 18061.`|",
    "created_at": "2017-10-24T15:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[ea1b4e6](https://github.com/sagemath/sagetrac-mirror/commit/ea1b4e6d1b367ebb5831d1f9cdd217cc7f65ab20)|`Fixed a broken doctest from trac 18061.`|



---

archive/issue_comments_457684.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-24T15:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457684",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_457685.json:
```json
{
    "body": "<a id='comment:10'></a>\nThat was embarrassing: I broke the test case from #18061 (which I reported initially -- oops!). This was an issue with determining when the AL eigenvalue exists in `atkin_lehner_eigenvalue` -- we need to determine when it doesn't exist, and raise an error in that case, without needing to fix the choices of embedding needed for more general pseudo-eigenvalues. (I also adjusted the test case to make it run quicker, and removed the ` #\u00a0long time` flag.)\n\nI've also moved `atkin_lehner_action` out of the abstract modular form element class into the Newform class; eigenvalues make sense for any form, but pseudo-eigenvalues only for newforms.",
    "created_at": "2017-10-24T15:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457685",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:10'></a>
That was embarrassing: I broke the test case from #18061 (which I reported initially -- oops!). This was an issue with determining when the AL eigenvalue exists in `atkin_lehner_eigenvalue` -- we need to determine when it doesn't exist, and raise an error in that case, without needing to fix the choices of embedding needed for more general pseudo-eigenvalues. (I also adjusted the test case to make it run quicker, and removed the ` # long time` flag.)

I've also moved `atkin_lehner_action` out of the abstract modular form element class into the Newform class; eigenvalues make sense for any form, but pseudo-eigenvalues only for newforms.



---

archive/issue_comments_457686.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[d8ef6a3](https://github.com/sagemath/sagetrac-mirror/commit/d8ef6a387af622ec5e9f028aaa5c9318690f5ae8)|`Keep patchbot blocks check happy!`|",
    "created_at": "2017-10-24T20:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457686",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[d8ef6a3](https://github.com/sagemath/sagetrac-mirror/commit/d8ef6a387af622ec5e9f028aaa5c9318690f5ae8)|`Keep patchbot blocks check happy!`|



---

archive/issue_comments_457687.json:
```json
{
    "body": "Changing commit from \"ea1b4e6d1b367ebb5831d1f9cdd217cc7f65ab20\" to \"d8ef6a387af622ec5e9f028aaa5c9318690f5ae8\"",
    "created_at": "2017-10-24T20:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457687",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ea1b4e6d1b367ebb5831d1f9cdd217cc7f65ab20" to "d8ef6a387af622ec5e9f028aaa5c9318690f5ae8"



---

archive/issue_comments_457688.json:
```json
{
    "body": "Changing branch from \"u/davidloeffler/atkin_lehner_normalisation_issue\" to \"public/24086_better\"",
    "created_at": "2018-05-01T11:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457688",
    "user": "https://github.com/loefflerd"
}
```

Changing branch from "u/davidloeffler/atkin_lehner_normalisation_issue" to "public/24086_better"



---

archive/issue_comments_457689.json:
```json
{
    "body": "Changing commit from \"d8ef6a387af622ec5e9f028aaa5c9318690f5ae8\" to \"2a58074c34bec782925f46c2e0d476e017fcf535\"",
    "created_at": "2018-05-01T11:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457689",
    "user": "https://github.com/loefflerd"
}
```

Changing commit from "d8ef6a387af622ec5e9f028aaa5c9318690f5ae8" to "2a58074c34bec782925f46c2e0d476e017fcf535"



---

archive/issue_comments_457690.json:
```json
{
    "body": "<a id='comment:13'></a>\nI'm uploading a new, completely rewritten branch, which sorts out the normalisations so they're consistent with Atkin-Li, and also covers all the previously non-implemented cases using a trick based on twisting maps for modular symbols.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|\n|[2a58074](https://github.com/sagemath/sagetrac-mirror/commit/2a58074c34bec782925f46c2e0d476e017fcf535)|`Trac 24086: Atkin--Lehner operators - now works for any character, + normalisations fixed`|",
    "created_at": "2018-05-01T11:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457690",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:13'></a>
I'm uploading a new, completely rewritten branch, which sorts out the normalisations so they're consistent with Atkin-Li, and also covers all the previously non-implemented cases using a trick based on twisting maps for modular symbols.

---
New commits:
|                                                                                                                                          |                                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
|[2a58074](https://github.com/sagemath/sagetrac-mirror/commit/2a58074c34bec782925f46c2e0d476e017fcf535)|`Trac 24086: Atkin--Lehner operators - now works for any character, + normalisations fixed`|



---

archive/issue_comments_457691.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n This ticket is a follow-up to #18061, concerning Atkin--Lehner actions.\n \n-According to the docstring of `sage.modular.modform.element.ModularForm_abstract.atkin_lehner_action`, our conventions are supposed to be that the pseudo-eigenvalues of the Atkin--Lehner operator W_d should have absolute value d<sup>k/2</sup> - 1. However, it doesn't seem that this convention is being enforced very consistently:\n+Firstly, with that ticket the Atkin--Lehner action is only implemented in a certain subset of cases. It would be nice if we could compute the pseudo-eigenvalues for any newform.\n+\n+Secondly, there is a normalisation discrepancy: according to the docstring of `sage.modular.modform.element.ModularForm_abstract.atkin_lehner_action`, our conventions are supposed to be that the pseudo-eigenvalues of the Atkin--Lehner operator W_d should have absolute value d<sup>k/2</sup> - 1. However, it doesn't seem that this convention is being enforced very consistently:\n \n ```\n sage: f = Newforms(24, 4)[0]\n@@ -11,12 +13,3 @@\n sage: f.atkin_lehner_eigenvalue(3)\n -3\n ```\n-\n-The problem seems to be this:\n-\n-```\n-sage: f._atkin_lehner_action_from_qexp(3)\n-(-3, q + 3*q^3 + 14*q^5 + O(q^6))\n-sage: f._atkin_lehner_action_from_modsym(3)\n-(-1, q + 3*q^3 + 14*q^5 + O(q^6))\n-```\n``````\n",
    "created_at": "2018-05-01T11:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457691",
    "user": "https://github.com/loefflerd"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 This ticket is a follow-up to #18061, concerning Atkin--Lehner actions.
 
-According to the docstring of `sage.modular.modform.element.ModularForm_abstract.atkin_lehner_action`, our conventions are supposed to be that the pseudo-eigenvalues of the Atkin--Lehner operator W_d should have absolute value d<sup>k/2</sup> - 1. However, it doesn't seem that this convention is being enforced very consistently:
+Firstly, with that ticket the Atkin--Lehner action is only implemented in a certain subset of cases. It would be nice if we could compute the pseudo-eigenvalues for any newform.
+
+Secondly, there is a normalisation discrepancy: according to the docstring of `sage.modular.modform.element.ModularForm_abstract.atkin_lehner_action`, our conventions are supposed to be that the pseudo-eigenvalues of the Atkin--Lehner operator W_d should have absolute value d<sup>k/2</sup> - 1. However, it doesn't seem that this convention is being enforced very consistently:
 
 ```
 sage: f = Newforms(24, 4)[0]
@@ -11,12 +13,3 @@
 sage: f.atkin_lehner_eigenvalue(3)
 -3
 ```
-
-The problem seems to be this:
-
-```
-sage: f._atkin_lehner_action_from_qexp(3)
-(-3, q + 3*q^3 + 14*q^5 + O(q^6))
-sage: f._atkin_lehner_action_from_modsym(3)
-(-1, q + 3*q^3 + 14*q^5 + O(q^6))
-```
``````




---

archive/issue_comments_457692.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-05T07:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457692",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_069562.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-05-05T07:20:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24086#event-69562"
}
```



---

archive/issue_comments_457693.json:
```json
{
    "body": "<a id='comment:14'></a>\n2 failing doctests in \n\n```\nsage -t --long src/sage/modular/abvar/lseries.py \n```\nbecause of precision issues in L functions",
    "created_at": "2018-05-05T07:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457693",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
2 failing doctests in 

```
sage -t --long src/sage/modular/abvar/lseries.py 
```
because of precision issues in L functions



---

archive/issue_comments_457694.json:
```json
{
    "body": "Changing commit from \"2a58074c34bec782925f46c2e0d476e017fcf535\" to \"76e72625179f18e9d0f95a8c05b37c84cc8b5118\"",
    "created_at": "2018-05-07T17:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457694",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2a58074c34bec782925f46c2e0d476e017fcf535" to "76e72625179f18e9d0f95a8c05b37c84cc8b5118"



---

archive/issue_comments_457695.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[76e7262](https://github.com/sagemath/sagetrac-mirror/commit/76e72625179f18e9d0f95a8c05b37c84cc8b5118)|`Fix failing doctest in abvar/lseries.py`|",
    "created_at": "2018-05-07T17:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[76e7262](https://github.com/sagemath/sagetrac-mirror/commit/76e72625179f18e9d0f95a8c05b37c84cc8b5118)|`Fix failing doctest in abvar/lseries.py`|



---

archive/issue_comments_457696.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis is just harmless fuzz. The discrepancies are all in the last one or two decimal digits, and in the first example, the output from the new code was actually closer to the correct answer than the old one was. I've changed the doctest to be more noise-tolerant.",
    "created_at": "2018-05-07T17:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457696",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:16'></a>
This is just harmless fuzz. The discrepancies are all in the last one or two decimal digits, and in the first example, the output from the new code was actually closer to the correct answer than the old one was. I've changed the doctest to be more noise-tolerant.



---

archive/issue_comments_457697.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-07T17:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457697",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_457698.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-17T06:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457698",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457699.json:
```json
{
    "body": "<a id='comment:18'></a>\nok, let it be. I cannot vouch for the math, but I will take your word for it.",
    "created_at": "2018-05-17T06:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457699",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
ok, let it be. I cannot vouch for the math, but I will take your word for it.



---

archive/issue_comments_457700.json:
```json
{
    "body": "Changing reviewer from \"Aly Deines\" to \"Aly Deines, Fr\u00e9d\u00e9ric chapoton\"",
    "created_at": "2018-05-17T06:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457700",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "Aly Deines" to "Aly Deines, Frédéric chapoton"



---

archive/issue_comments_457701.json:
```json
{
    "body": "<a id='comment:19'></a>\nMerge conflict\n\nAlso, Frederic's last name shoud probably be capitalized...",
    "created_at": "2018-05-17T18:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457701",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
Merge conflict

Also, Frederic's last name shoud probably be capitalized...



---

archive/issue_comments_457702.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-17T18:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457702",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_457703.json:
```json
{
    "body": "Changing reviewer from \"Aly Deines, Fr\u00e9d\u00e9ric chapoton\" to \"Aly Deines, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2018-05-17T18:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457703",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "Aly Deines, Frédéric chapoton" to "Aly Deines, Frédéric Chapoton"



---

archive/issue_comments_457704.json:
```json
{
    "body": "<a id='comment:20'></a>\nok, will wait for the next beta.",
    "created_at": "2018-05-17T18:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457704",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
ok, will wait for the next beta.



---

archive/issue_comments_457705.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe conflict is from #23510 apparently.",
    "created_at": "2018-05-17T20:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457705",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:21'></a>
The conflict is from #23510 apparently.



---

archive/issue_comments_457706.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[6756c1e](https://github.com/sagemath/sagetrac-mirror/commit/6756c1e25146d9c0791b63d0140cd12d7ada3e19)|`Merge branch 'public/24086_better' in 8.3.b2`|",
    "created_at": "2018-05-19T06:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[6756c1e](https://github.com/sagemath/sagetrac-mirror/commit/6756c1e25146d9c0791b63d0140cd12d7ada3e19)|`Merge branch 'public/24086_better' in 8.3.b2`|



---

archive/issue_comments_457707.json:
```json
{
    "body": "Changing commit from \"76e72625179f18e9d0f95a8c05b37c84cc8b5118\" to \"6756c1e25146d9c0791b63d0140cd12d7ada3e19\"",
    "created_at": "2018-05-19T06:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "76e72625179f18e9d0f95a8c05b37c84cc8b5118" to "6756c1e25146d9c0791b63d0140cd12d7ada3e19"



---

archive/issue_comments_457708.json:
```json
{
    "body": "<a id='comment:23'></a>\nmerged, and set back to positive",
    "created_at": "2018-05-19T06:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457708",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>
merged, and set back to positive



---

archive/issue_comments_457709.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-19T06:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457709",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_457710.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-05-19T09:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_457711.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[51266f9](https://github.com/sagemath/sagetrac-mirror/commit/51266f9edad6cb7979cfe4023f1e86f012aa7fbe)|`Trac 24086: stamp out some fuzz accidentally re-introduced by auto-merge`|",
    "created_at": "2018-05-19T09:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[51266f9](https://github.com/sagemath/sagetrac-mirror/commit/51266f9edad6cb7979cfe4023f1e86f012aa7fbe)|`Trac 24086: stamp out some fuzz accidentally re-introduced by auto-merge`|



---

archive/issue_comments_457712.json:
```json
{
    "body": "Changing commit from \"6756c1e25146d9c0791b63d0140cd12d7ada3e19\" to \"51266f9edad6cb7979cfe4023f1e86f012aa7fbe\"",
    "created_at": "2018-05-19T09:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6756c1e25146d9c0791b63d0140cd12d7ada3e19" to "51266f9edad6cb7979cfe4023f1e86f012aa7fbe"



---

archive/issue_comments_457713.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-19T09:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457713",
    "user": "https://github.com/loefflerd"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457714.json:
```json
{
    "body": "<a id='comment:25'></a>\nThe auto-merge algorithm isn't quite clever enough to avoid re-introducing some of the unneeded imports which were removed by #23510. I've pushed a tiny patch to get rid of them again. These changes were already reviewed as part of #23510 so I am setting this back to positive review.",
    "created_at": "2018-05-19T09:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457714",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:25'></a>
The auto-merge algorithm isn't quite clever enough to avoid re-introducing some of the unneeded imports which were removed by #23510. I've pushed a tiny patch to get rid of them again. These changes were already reviewed as part of #23510 so I am setting this back to positive review.



---

archive/issue_comments_457715.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-20T22:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457715",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_457716.json:
```json
{
    "body": "Changing branch from \"public/24086_better\" to \"51266f9edad6cb7979cfe4023f1e86f012aa7fbe\"",
    "created_at": "2018-05-20T22:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24086#issuecomment-457716",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/24086_better" to "51266f9edad6cb7979cfe4023f1e86f012aa7fbe"



---

archive/issue_events_069563.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-20T22:55:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24086",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24086#event-69563"
}
```
