# Issue 24206: py3: change in CoercionException

archive/issues_023969.json:
```json
{
    "assignees": [],
    "body": "make it inherit from BaseException\n\nCC:  @tscrim @jdemeyer\n\nBranch/Commit: **[u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206) @ [`cefa814`](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24206_\n\n",
    "closed_at": "2017-11-13T11:14:28Z",
    "created_at": "2017-11-12T15:13:17Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: change in CoercionException",
    "type": "issue",
    "updated_at": "2017-11-20T09:57:23Z",
    "url": "https://github.com/sagemath/sage/issues/24206",
    "user": "https://github.com/fchapoton"
}
```
make it inherit from BaseException

CC:  @tscrim @jdemeyer

Branch/Commit: **[u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206) @ [`cefa814`](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)**

Reviewer: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/24206_





---

archive/issue_events_335786.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-12T15:13:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335786"
}
```



---

archive/issue_events_335787.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-12T15:13:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335787"
}
```



---

archive/issue_events_335788.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-12T15:13:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335788"
}
```



---

archive/issue_events_335789.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-12T15:13:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335789"
}
```



---

archive/issue_comments_366114.json:
```json
{
    "body": "Branch: **[u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206)**",
    "created_at": "2017-11-12T15:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366114",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206)**



---

archive/issue_comments_366115.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82\">cefa814</a></td><td><code>changing CoercionException</code></td></tr></table>\n",
    "created_at": "2017-11-12T15:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366115",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82">cefa814</a></td><td><code>changing CoercionException</code></td></tr></table>




---

archive/issue_events_335790.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-12T15:13:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335790"
}
```



---

archive/issue_comments_366116.json:
```json
{
    "body": "Commit: **[`cefa814`](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)**",
    "created_at": "2017-11-12T15:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366116",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`cefa814`](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)**



---

archive/issue_comments_366117.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nIt already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.",
    "created_at": "2017-11-12T22:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366117",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

It already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.



---

archive/issue_events_335791.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335791"
}
```



---

archive/issue_events_335792.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335792"
}
```



---

archive/issue_events_335793.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335793"
}
```



---

archive/issue_events_335794.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335794"
}
```



---

archive/issue_events_335795.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335795"
}
```



---

archive/issue_comments_366118.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nok, then ket us forget about that.",
    "created_at": "2017-11-13T07:00:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366118",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

ok, then ket us forget about that.



---

archive/issue_comments_366119.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2017-11-13T11:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366119",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_366120.json:
```json
{
    "body": "Changed author from **Fr\u00e9d\u00e9ric Chapoton** to none",
    "created_at": "2017-11-13T11:14:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366120",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Frédéric Chapoton** to none



---

archive/issue_events_335796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-13T11:14:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335796"
}
```



---

archive/issue_events_335797.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-13T11:14:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-335797"
}
```



---

archive/issue_comments_366121.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI can now confirm that this hurts, because of lazy import.\n\nIn a python3 build sage, when\n\n```\nsage: C=Cone([[1,2],[33,-1]])\nsage: C.face_lattice()\n```\nfirst call gives\n\n```\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)\n   3987 \n-> 3988         return all(Z)\n   3989 \n\n/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()\n\n/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()\n\nTypeError: x (=None) is not in Category of sets\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-37-92b0fcd27f13> in <module>()\n----> 1 C.face_lattice()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)\n   2354                 atom_to_ray = []\n   2355                 atom_to_facets = []\n-> 2356                 normals = self.facet_normals()\n   2357                 facet_to_atoms = [[] for normal in normals]\n   2358                 for i, ray in enumerate(self):\n\n/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)\n   2659         if len(normals) > 1:\n   2660             # Sort normals if they are rays\n-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:\n   2662                 normals = (normals[1], normals[0])\n   2663             else:\n\n/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)\n   3988         return all(Z)\n   3989 \n-> 3990     except CoercionException:\n   3991         raise\n   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:\n\nTypeError: catching classes that do not inherit from BaseException is not allowed\n\n```",
    "created_at": "2017-11-20T09:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-366121",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

I can now confirm that this hurts, because of lazy import.

In a python3 build sage, when

```
sage: C=Cone([[1,2],[33,-1]])
sage: C.face_lattice()
```
first call gives

```
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3987 
-> 3988         return all(Z)
   3989 

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()

TypeError: x (=None) is not in Category of sets

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-37-92b0fcd27f13> in <module>()
----> 1 C.face_lattice()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)
   2354                 atom_to_ray = []
   2355                 atom_to_facets = []
-> 2356                 normals = self.facet_normals()
   2357                 facet_to_atoms = [[] for normal in normals]
   2358                 for i, ray in enumerate(self):

/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)
   2659         if len(normals) > 1:
   2660             # Sort normals if they are rays
-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:
   2662                 normals = (normals[1], normals[0])
   2663             else:

/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3988         return all(Z)
   3989 
-> 3990     except CoercionException:
   3991         raise
   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:

TypeError: catching classes that do not inherit from BaseException is not allowed

```
