# Issue 24206: py3: change in CoercionException

archive/issues_023969.json:
```json
{
    "body": "make it inherit from BaseException\n\n**CC:**  @tscrim @jdemeyer\n\n**Branch:** [u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206)\n\n**Commit:** [cefa814dcb081ed0c197800bb190c5ec5981cc82](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton\n\nIssue created by migration from https://trac.sagemath.org/ticket/24206\n\n",
    "closed_at": "2017-11-13T11:14:28Z",
    "created_at": "2017-11-12T15:13:17Z",
    "labels": [
        "component: python3",
        "enhancement",
        "invalid"
    ],
    "title": "py3: change in CoercionException",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/24206",
    "user": "https://github.com/fchapoton"
}
```
make it inherit from BaseException

**CC:**  @tscrim @jdemeyer

**Branch:** [u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206)

**Commit:** [cefa814dcb081ed0c197800bb190c5ec5981cc82](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)

**Reviewer:** Frédéric Chapoton

Issue created by migration from https://trac.sagemath.org/ticket/24206





---

archive/issue_comments_368644.json:
```json
{
    "body": "**Branch:** [u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206)",
    "created_at": "2017-11-12T15:13:47Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368644",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/24206](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/24206)



---

archive/issue_comments_368645.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82\">cefa814</a></td><td><code>changing CoercionException</code></td></tr></table>\n",
    "created_at": "2017-11-12T15:13:47Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368645",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82">cefa814</a></td><td><code>changing CoercionException</code></td></tr></table>




---

archive/issue_events_214905.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-12T15:13:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-214905"
}
```



---

archive/issue_comments_368646.json:
```json
{
    "body": "**Commit:** [cefa814dcb081ed0c197800bb190c5ec5981cc82](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)",
    "created_at": "2017-11-12T15:13:47Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368646",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [cefa814dcb081ed0c197800bb190c5ec5981cc82](https://github.com/sagemath/sagetrac-mirror/commit/cefa814dcb081ed0c197800bb190c5ec5981cc82)



---

archive/issue_comments_368647.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.",
    "created_at": "2017-11-12T22:38:50Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368647",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
It already does that by inheriting from `TypeError` in both [Python2](https://docs.python.org/2/library/exceptions.html#exception-hierarchy) and [Python3](https://docs.python.org/3/library/exceptions.html#exception-hierarchy). So I don't understand what this ticket would change other than putting `BaseException` higher in the MRO.



---

archive/issue_events_214906.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-214906"
}
```



---

archive/issue_events_214907.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-214907"
}
```



---

archive/issue_events_214908.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-11-13T07:00:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-214908"
}
```



---

archive/issue_comments_368648.json:
```json
{
    "body": "<a id='comment:3'></a>\nok, then ket us forget about that.",
    "created_at": "2017-11-13T07:00:06Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368648",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
ok, then ket us forget about that.



---

archive/issue_comments_368649.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2017-11-13T11:14:28Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368649",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_comments_368650.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"\".",
    "created_at": "2017-11-13T11:14:28Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368650",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Frédéric Chapoton" to "".



---

archive/issue_events_214909.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-13T11:14:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-214909"
}
```



---

archive/issue_events_214910.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-11-13T11:14:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24206#event-214910"
}
```



---

archive/issue_comments_368651.json:
```json
{
    "body": "<a id='comment:5'></a>\nI can now confirm that this hurts, because of lazy import.\n\nIn a python3 build sage, when\n\n```\nsage: C=Cone([[1,2],[33,-1]])\nsage: C.face_lattice()\n```\nfirst call gives\n\n```\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)\n   3987 \n-> 3988         return all(Z)\n   3989 \n\n/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()\n\n/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()\n\nTypeError: x (=None) is not in Category of sets\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-37-92b0fcd27f13> in <module>()\n----> 1 C.face_lattice()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)\n   2354                 atom_to_ray = []\n   2355                 atom_to_facets = []\n-> 2356                 normals = self.facet_normals()\n   2357                 facet_to_atoms = [[] for normal in normals]\n   2358                 for i, ray in enumerate(self):\n\n/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)\n   2659         if len(normals) > 1:\n   2660             # Sort normals if they are rays\n-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:\n   2662                 normals = (normals[1], normals[0])\n   2663             else:\n\n/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)\n   3988         return all(Z)\n   3989 \n-> 3990     except CoercionException:\n   3991         raise\n   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:\n\nTypeError: catching classes that do not inherit from BaseException is not allowed\n\n```",
    "created_at": "2017-11-20T09:57:23Z",
    "issue": "https://github.com/sagemath/sage/issues/24206",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24206#issuecomment-368651",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
I can now confirm that this hurts, because of lazy import.

In a python3 build sage, when

```
sage: C=Cone([[1,2],[33,-1]])
sage: C.face_lattice()
```
first call gives

```
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3987 
-> 3988         return all(Z)
   3989 

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor.__call__ (build/cythonized/sage/categories/functor.c:3156)()

/home/chapoton/sage3/src/sage/categories/functor.pyx in sage.categories.functor.Functor._coerce_into_domain (build/cythonized/sage/categories/functor.c:2798)()

TypeError: x (=None) is not in Category of sets

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-37-92b0fcd27f13> in <module>()
----> 1 C.face_lattice()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in face_lattice(self)
   2354                 atom_to_ray = []
   2355                 atom_to_facets = []
-> 2356                 normals = self.facet_normals()
   2357                 facet_to_atoms = [[] for normal in normals]
   2358                 for i, ray in enumerate(self):

/home/chapoton/sage3/src/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:13511)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/geometry/cone.py in facet_normals(self)
   2659         if len(normals) > 1:
   2660             # Sort normals if they are rays
-> 2661             if self.dim() == 2 and normals[0]*self.ray(0) != 0:
   2662                 normals = (normals[1], normals[0])
   2663             else:

/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Vector.__mul__ (build/cythonized/sage/structure/element.c:20532)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:9502)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.get_action (build/cythonized/sage/structure/coerce.c:16769)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.discover_action (build/cythonized/sage/structure/coerce.c:18328)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:21462)()

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:22761)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5640)()

/home/chapoton/sage3/src/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.ModuleAction.__init__ (build/cythonized/sage/structure/coerce_actions.c:6527)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/categories/pushout.py in pushout(R, S)
   3988         return all(Z)
   3989 
-> 3990     except CoercionException:
   3991         raise
   3992     except (TypeError, ValueError, AttributeError, NotImplementedError) as ex:

TypeError: catching classes that do not inherit from BaseException is not allowed

```
