# Issue 24372: Map._extra_slots(): do not pass dict

archive/issues_024135.json:
```json
{
    "body": "In the `Map` method `_extra_slots`, a dict is passed as input. That dict is then modified in-place and also returned as output.\n\nThis awkward logic is not needed for anything. We simplify this by not passing a dict as input and creating a new dict from scratch if needed.\n\n**Branch/Commit:** [375e40f6f46fd2db9d231dedf53cc59dc5279147](https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Jeroen Demeyer\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24372\n\n",
    "closed_at": "2017-12-22T23:29:23Z",
    "created_at": "2017-12-13T14:42:24Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Map._extra_slots(): do not pass dict",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24372",
    "user": "https://github.com/jdemeyer"
}
```
In the `Map` method `_extra_slots`, a dict is passed as input. That dict is then modified in-place and also returned as output.

This awkward logic is not needed for anything. We simplify this by not passing a dict as input and creating a new dict from scratch if needed.

**Branch/Commit:** [375e40f6f46fd2db9d231dedf53cc59dc5279147](https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147)

**Reviewer:** Travis Scrimshaw

**Author:** Jeroen Demeyer

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/24372





---

archive/issue_comments_463713.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/ticket/24372](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24372)",
    "created_at": "2017-12-14T12:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463713",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/ticket/24372](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24372)



---

archive/issue_comments_463714.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147\">375e40f</a></td><td><code>Map._extra_slots(): do not pass dict</code></td></tr></table>\n",
    "created_at": "2017-12-14T12:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463714",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147">375e40f</a></td><td><code>Map._extra_slots(): do not pass dict</code></td></tr></table>




---

archive/issue_comments_463715.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-12-14T12:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463715",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_463716.json:
```json
{
    "body": "**Commit:** [375e40f6f46fd2db9d231dedf53cc59dc5279147](https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147)",
    "created_at": "2017-12-14T12:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463716",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [375e40f6f46fd2db9d231dedf53cc59dc5279147](https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147)



---

archive/issue_comments_463717.json:
```json
{
    "body": "<a id='comment:3'></a>\nLGTM overall, but I do not feel 100% comfortable relying on an uninitialized `zero_element` being `None` by default:\n\n```\n        if self.zero_element is None:\n            self.zero_element = self._codomain.zero()\n```\nSo I would add `self.zero_element = None` in the `__init__`.\n\nProbably we should also add the other cdef classes (such as `Z_to_quadratic_field_element`) to the `.pxd` file, but that can be done on a followup.",
    "created_at": "2017-12-15T22:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463717",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
LGTM overall, but I do not feel 100% comfortable relying on an uninitialized `zero_element` being `None` by default:

```
        if self.zero_element is None:
            self.zero_element = self._codomain.zero()
```
So I would add `self.zero_element = None` in the `__init__`.

Probably we should also add the other cdef classes (such as `Z_to_quadratic_field_element`) to the `.pxd` file, but that can be done on a followup.



---

archive/issue_comments_463718.json:
```json
{
    "body": "<a id='comment:4'></a>\nInterestingly, http://cython.readthedocs.io/en/latest/src/userguide/special_methods.html#initialisation-methods-cinit-and-init says\n\n\"Any Python attributes have also been initialised to `None`, but you probably shouldn\u2019t rely on that.\"",
    "created_at": "2017-12-16T08:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463718",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Interestingly, http://cython.readthedocs.io/en/latest/src/userguide/special_methods.html#initialisation-methods-cinit-and-init says

"Any Python attributes have also been initialised to `None`, but you probably shouldnâ€™t rely on that."



---

archive/issue_comments_463719.json:
```json
{
    "body": "<a id='comment:5'></a>\nSo are you saying we should just leave it be?",
    "created_at": "2017-12-16T12:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463719",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
So are you saying we should just leave it be?



---

archive/issue_comments_463720.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [tscrim](#comment%3A5):\n> So are you saying we should just leave it be?\n\n\nI just sent an email to the Cython mailing list to ask for clarification.",
    "created_at": "2017-12-17T18:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463720",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [tscrim](#comment%3A5):
> So are you saying we should just leave it be?


I just sent an email to the Cython mailing list to ask for clarification.



---

archive/issue_comments_463721.json:
```json
{
    "body": "<a id='comment:7'></a>\nReply from a Cython developer:\n> As long as Cython controls the type hierarchy, you can rely on it. Exposing\n> `NULL` values for Python attributes to !Python/Cython code would be unhelpful.\n\n>\n> There is one exception: when `__cinit__()` is called, attributes that are\n> defined by *subtypes* have not been initialised yet and thus are still `NULL`\n> instead of `None`.\n\n\nIn short: what I did is correct.",
    "created_at": "2017-12-18T09:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463721",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Reply from a Cython developer:
> As long as Cython controls the type hierarchy, you can rely on it. Exposing
> `NULL` values for Python attributes to !Python/Cython code would be unhelpful.

>
> There is one exception: when `__cinit__()` is called, attributes that are
> defined by *subtypes* have not been initialised yet and thus are still `NULL`
> instead of `None`.


In short: what I did is correct.



---

archive/issue_comments_463722.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2017-12-18T10:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463722",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_463723.json:
```json
{
    "body": "<a id='comment:8'></a>\nAlright, then positive review.",
    "created_at": "2017-12-18T10:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463723",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Alright, then positive review.



---

archive/issue_comments_463724.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-12-18T10:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463724",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_463725.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/ticket/24372](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24372)\" to \"[375e40f6f46fd2db9d231dedf53cc59dc5279147](https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147)\".",
    "created_at": "2017-12-22T23:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463725",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/ticket/24372](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/ticket/24372)" to "[375e40f6f46fd2db9d231dedf53cc59dc5279147](https://github.com/sagemath/sagetrac-mirror/commit/375e40f6f46fd2db9d231dedf53cc59dc5279147)".



---

archive/issue_comments_463726.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2017-12-22T23:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24372#issuecomment-463726",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_070087.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-22T23:29:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24372",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24372#event-70087"
}
```
