# Issue 24949: Bug in p-adic expansion over ramified extensions

archive/issues_024712.json:
```json
{
    "body": "\n```\nsage: R.<a> = Zp(2).extension(x^10 + 2)\nsage: x = R(a^4 + a^5)\nsage: y = R(a^2 + a^3)\nsage: z = x - y^2\nsage: z.expansion(4)\nTraceback (most recent call last):\n...\nPrecisionError:\n\nsage: z\na^5 + a^6 + a^15 + a^16 + O(a^204)\nsage: z.expansion(4)\n0\n```\n\nCC:  @roed314 @saraedum\n\nKeywords: expansion normalize, padicIMA\n\nBranch/Commit: [c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)\n\nReviewer: David Roe\n\nAuthor: Xavier Caruso\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24949\n\n",
    "closed_at": "2022-06-12T12:17:19Z",
    "created_at": "2018-03-11T17:12:40Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Bug in p-adic expansion over ramified extensions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24949",
    "user": "https://github.com/xcaruso"
}
```

```
sage: R.<a> = Zp(2).extension(x^10 + 2)
sage: x = R(a^4 + a^5)
sage: y = R(a^2 + a^3)
sage: z = x - y^2
sage: z.expansion(4)
Traceback (most recent call last):
...
PrecisionError:

sage: z
a^5 + a^6 + a^15 + a^16 + O(a^204)
sage: z.expansion(4)
0
```

CC:  @roed314 @saraedum

Keywords: expansion normalize, padicIMA

Branch/Commit: [c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)

Reviewer: David Roe

Author: Xavier Caruso

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24949





---

archive/issue_comments_476686.json:
```json
{
    "body": "Changing keywords from \"expansion normalize\" to \"expansion normalize, padicIMA\".",
    "created_at": "2018-07-22T20:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476686",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "expansion normalize" to "expansion normalize, padicIMA".



---

archive/issue_comments_476687.json:
```json
{
    "body": "Changing branch from \"\" to \"u/caruso/expansion_bug\"",
    "created_at": "2022-06-02T20:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476687",
    "user": "https://github.com/xcaruso"
}
```

Changing branch from "" to "u/caruso/expansion_bug"



---

archive/issue_comments_476688.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476688",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_476689.json:
```json
{
    "body": "Changing commit from \"\" to \"8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c\"",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476689",
    "user": "https://github.com/xcaruso"
}
```

Changing commit from "" to "8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c"



---

archive/issue_comments_476690.json:
```json
{
    "body": "<a id='comment:3'></a>\nAdding a call to `_normalize()' seems to fix the bug.\n\n---\nNew commits:\n|                                                                                                                                          |               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[8238b49](https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c)|`add normalize`|",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476690",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:3'></a>
Adding a call to `_normalize()' seems to fix the bug.

---
New commits:
|                                                                                                                                          |               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[8238b49](https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c)|`add normalize`|



---

archive/issue_comments_476691.json:
```json
{
    "body": "Changing commit from \"8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c\" to \"daf528e683fa739c38abc64d8d5b3af1b4d2dbb7\"",
    "created_at": "2022-06-02T20:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476691",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c" to "daf528e683fa739c38abc64d8d5b3af1b4d2dbb7"



---

archive/issue_comments_476692.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|\n|[daf528e](https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7)|`add doctest`|",
    "created_at": "2022-06-02T20:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476692",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------|
|[daf528e](https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7)|`add doctest`|



---

archive/issue_comments_476693.json:
```json
{
    "body": "Changing author from \"\" to \"Xavier Caruso\"",
    "created_at": "2022-06-02T20:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476693",
    "user": "https://github.com/xcaruso"
}
```

Changing author from "" to "Xavier Caruso"



---

archive/issue_comments_476694.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Roe\"",
    "created_at": "2022-06-02T21:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476694",
    "user": "https://github.com/roed314"
}
```

Changing reviewer from "" to "David Roe"



---

archive/issue_comments_476695.json:
```json
{
    "body": "<a id='comment:6'></a>\nPositive review once tests pass.",
    "created_at": "2022-06-02T21:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476695",
    "user": "https://github.com/roed314"
}
```

<a id='comment:6'></a>
Positive review once tests pass.



---

archive/issue_comments_476696.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt looks like there's an infinite recursion test failure....",
    "created_at": "2022-06-03T00:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476696",
    "user": "https://github.com/roed314"
}
```

<a id='comment:7'></a>
It looks like there's an infinite recursion test failure....



---

archive/issue_comments_476697.json:
```json
{
    "body": "Changing commit from \"daf528e683fa739c38abc64d8d5b3af1b4d2dbb7\" to \"c5088e601fbb9b9f995ad713979e3ce4066c23cd\"",
    "created_at": "2022-06-03T14:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476697",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "daf528e683fa739c38abc64d8d5b3af1b4d2dbb7" to "c5088e601fbb9b9f995ad713979e3ce4066c23cd"



---

archive/issue_comments_476698.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[c5088e6](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)|`be more strict with conversion between padics`|",
    "created_at": "2022-06-03T14:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[c5088e6](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)|`be more strict with conversion between padics`|



---

archive/issue_comments_476699.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe problem comes from conversion between padic when p changes:\n\n```\nsage: Zp(2)(Zp(5)(1))\nTraceback (most recent call last):\n...\nRecursionError\n```\n\nIt is fixed by the latest commit.\n\n---\nNew commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[c5088e6](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)|`be more strict with conversion between padics`|",
    "created_at": "2022-06-03T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476699",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:9'></a>
The problem comes from conversion between padic when p changes:

```
sage: Zp(2)(Zp(5)(1))
Traceback (most recent call last):
...
RecursionError
```

It is fixed by the latest commit.

---
New commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[c5088e6](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)|`be more strict with conversion between padics`|



---

archive/issue_comments_476700.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-03T18:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476700",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_476701.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe docbuild error is `/home/sagemath/sage/src/doc/en/reference/spkg/libspatialindex.rst: WARNING: document isn't included in any toctree`, which has nothing to do with this ticket.",
    "created_at": "2022-06-03T18:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476701",
    "user": "https://github.com/roed314"
}
```

<a id='comment:10'></a>
The docbuild error is `/home/sagemath/sage/src/doc/en/reference/spkg/libspatialindex.rst: WARNING: document isn't included in any toctree`, which has nothing to do with this ticket.



---

archive/issue_events_071217.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-06-03T18:50:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24949#event-71217"
}
```



---

archive/issue_comments_476702.json:
```json
{
    "body": "Changing branch from \"u/caruso/expansion_bug\" to \"c5088e601fbb9b9f995ad713979e3ce4066c23cd\"",
    "created_at": "2022-06-12T12:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476702",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/caruso/expansion_bug" to "c5088e601fbb9b9f995ad713979e3ce4066c23cd"



---

archive/issue_events_071218.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-12T12:17:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24949#event-71218"
}
```



---

archive/issue_comments_476703.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T12:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476703",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
