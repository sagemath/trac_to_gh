# Issue 24949: Bug in p-adic expansion over ramified extensions

archive/issues_024712.json:
```json
{
    "body": "\n```\nsage: R.<a> = Zp(2).extension(x^10 + 2)\nsage: x = R(a^4 + a^5)\nsage: y = R(a^2 + a^3)\nsage: z = x - y^2\nsage: z.expansion(4)\nTraceback (most recent call last):\n...\nPrecisionError:\n\nsage: z\na^5 + a^6 + a^15 + a^16 + O(a^204)\nsage: z.expansion(4)\n0\n```\n\n**CC:**  @roed314 @saraedum\n\n**Keywords:** expansion normalize, padicIMA\n\n**Branch/Commit:** [c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)\n\n**Reviewer:** David Roe\n\n**Author:** Xavier Caruso\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24949\n\n",
    "closed_at": "2022-06-12T12:17:19Z",
    "created_at": "2018-03-11T17:12:40Z",
    "labels": [
        "component: padics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Bug in p-adic expansion over ramified extensions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24949",
    "user": "https://github.com/xcaruso"
}
```

```
sage: R.<a> = Zp(2).extension(x^10 + 2)
sage: x = R(a^4 + a^5)
sage: y = R(a^2 + a^3)
sage: z = x - y^2
sage: z.expansion(4)
Traceback (most recent call last):
...
PrecisionError:

sage: z
a^5 + a^6 + a^15 + a^16 + O(a^204)
sage: z.expansion(4)
0
```

**CC:**  @roed314 @saraedum

**Keywords:** expansion normalize, padicIMA

**Branch/Commit:** [c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)

**Reviewer:** David Roe

**Author:** Xavier Caruso

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/24949





---

archive/issue_comments_476660.json:
```json
{
    "body": "**Changing keywords** from \"expansion normalize\" to \"expansion normalize, padicIMA\".",
    "created_at": "2018-07-22T20:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476660",
    "user": "https://github.com/roed314"
}
```


**Changing keywords** from "expansion normalize" to "expansion normalize, padicIMA".



---

archive/issue_comments_476661.json:
```json
{
    "body": "**Branch:** [u/caruso/expansion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/expansion_bug)",
    "created_at": "2022-06-02T20:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476661",
    "user": "https://github.com/xcaruso"
}
```


**Branch:** [u/caruso/expansion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/expansion_bug)



---

archive/issue_comments_476662.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476662",
    "user": "https://github.com/xcaruso"
}
```


**Changing status** from new to needs_review.



---

archive/issue_comments_476663.json:
```json
{
    "body": "**Commit:** [8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c](https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c)",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476663",
    "user": "https://github.com/xcaruso"
}
```


**Commit:** [8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c](https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c)



---

archive/issue_comments_476664.json:
```json
{
    "body": "<a id='comment:3'></a>\nAdding a call to `_normalize()' seems to fix the bug.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c\">8238b49</a></td><td><code>add normalize</code></td></tr></table>\n",
    "created_at": "2022-06-02T20:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476664",
    "user": "https://github.com/xcaruso"
}
```


<a id='comment:3'></a>
Adding a call to `_normalize()' seems to fix the bug.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c">8238b49</a></td><td><code>add normalize</code></td></tr></table>




---

archive/issue_comments_476665.json:
```json
{
    "body": "**Changing commit** from \"[8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c](https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c)\" to \"[daf528e683fa739c38abc64d8d5b3af1b4d2dbb7](https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7)\".",
    "created_at": "2022-06-02T20:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Changing commit** from "[8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c](https://github.com/sagemath/sagetrac-mirror/commit/8238b49ecd1afd79a63ee8f5adf80ab6d9f16e9c)" to "[daf528e683fa739c38abc64d8d5b3af1b4d2dbb7](https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7)".



---

archive/issue_comments_476666.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7\">daf528e</a></td><td><code>add doctest</code></td></tr></table>\n",
    "created_at": "2022-06-02T20:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476666",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7">daf528e</a></td><td><code>add doctest</code></td></tr></table>




---

archive/issue_comments_476667.json:
```json
{
    "body": "**Author:** Xavier Caruso",
    "created_at": "2022-06-02T20:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476667",
    "user": "https://github.com/xcaruso"
}
```


**Author:** Xavier Caruso



---

archive/issue_comments_476668.json:
```json
{
    "body": "**Reviewer:** David Roe",
    "created_at": "2022-06-02T21:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476668",
    "user": "https://github.com/roed314"
}
```


**Reviewer:** David Roe



---

archive/issue_comments_476669.json:
```json
{
    "body": "<a id='comment:6'></a>\nPositive review once tests pass.",
    "created_at": "2022-06-02T21:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476669",
    "user": "https://github.com/roed314"
}
```


<a id='comment:6'></a>
Positive review once tests pass.



---

archive/issue_comments_476670.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt looks like there's an infinite recursion test failure....",
    "created_at": "2022-06-03T00:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476670",
    "user": "https://github.com/roed314"
}
```


<a id='comment:7'></a>
It looks like there's an infinite recursion test failure....



---

archive/issue_comments_476671.json:
```json
{
    "body": "**Changing commit** from \"[daf528e683fa739c38abc64d8d5b3af1b4d2dbb7](https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7)\" to \"[c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)\".",
    "created_at": "2022-06-03T14:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Changing commit** from "[daf528e683fa739c38abc64d8d5b3af1b4d2dbb7](https://github.com/sagemath/sagetrac-mirror/commit/daf528e683fa739c38abc64d8d5b3af1b4d2dbb7)" to "[c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)".



---

archive/issue_comments_476672.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd\">c5088e6</a></td><td><code>be more strict with conversion between padics</code></td></tr></table>\n",
    "created_at": "2022-06-03T14:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd">c5088e6</a></td><td><code>be more strict with conversion between padics</code></td></tr></table>




---

archive/issue_comments_476673.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe problem comes from conversion between padic when p changes:\n\n```\nsage: Zp(2)(Zp(5)(1))\nTraceback (most recent call last):\n...\nRecursionError\n```\n\nIt is fixed by the latest commit.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd\">c5088e6</a></td><td><code>be more strict with conversion between padics</code></td></tr></table>\n",
    "created_at": "2022-06-03T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476673",
    "user": "https://github.com/xcaruso"
}
```


<a id='comment:9'></a>
The problem comes from conversion between padic when p changes:

```
sage: Zp(2)(Zp(5)(1))
Traceback (most recent call last):
...
RecursionError
```

It is fixed by the latest commit.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd">c5088e6</a></td><td><code>be more strict with conversion between padics</code></td></tr></table>




---

archive/issue_comments_476674.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2022-06-03T18:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476674",
    "user": "https://github.com/roed314"
}
```


**Changing status** from needs_review to positive_review.



---

archive/issue_comments_476675.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe docbuild error is `/home/sagemath/sage/src/doc/en/reference/spkg/libspatialindex.rst: WARNING: document isn't included in any toctree`, which has nothing to do with this ticket.",
    "created_at": "2022-06-03T18:18:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476675",
    "user": "https://github.com/roed314"
}
```


<a id='comment:10'></a>
The docbuild error is `/home/sagemath/sage/src/doc/en/reference/spkg/libspatialindex.rst: WARNING: document isn't included in any toctree`, which has nothing to do with this ticket.



---

archive/issue_events_071217.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-06-03T18:50:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24949#event-71217"
}
```




---

archive/issue_comments_476676.json:
```json
{
    "body": "**Changing branch** from \"[u/caruso/expansion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/expansion_bug)\" to \"[c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)\".",
    "created_at": "2022-06-12T12:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476676",
    "user": "https://github.com/vbraun"
}
```


**Changing branch** from "[u/caruso/expansion_bug](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/expansion_bug)" to "[c5088e601fbb9b9f995ad713979e3ce4066c23cd](https://github.com/sagemath/sagetrac-mirror/commit/c5088e601fbb9b9f995ad713979e3ce4066c23cd)".



---

archive/issue_events_071218.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-06-12T12:17:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24949#event-71218"
}
```




---

archive/issue_comments_476677.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2022-06-12T12:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24949",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24949#issuecomment-476677",
    "user": "https://github.com/vbraun"
}
```


**Resolution:** fixed
