# Issue 24628: Build PCRE without JIT if needed

archive/issues_024391.json:
```json
{
    "body": "The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a \"bus error\" on Solaris.\n\nTo work around this, I propose to *always* run the PCRE testsuite. This takes only a few seconds anyway. If the testsuite fails, recompile PCRE without `--enable-jit`.\n\n(Skip this, at the very least, on Cygwin since the testsuite fails there anyways, albeit for unrelated reasons; see #24756).\n\nCC:  @mkoeppe @dimpase @EmmanuelCharpentier\n\nReviewer: Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nBranch: db16bc954c742ea82878da606e8737e57230865b\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24628\n\n",
    "closed_at": "2018-02-09T08:03:48Z",
    "created_at": "2018-02-01T01:41:56Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Build PCRE without JIT if needed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24628",
    "user": "https://github.com/dimpase"
}
```
The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a "bus error" on Solaris.

To work around this, I propose to *always* run the PCRE testsuite. This takes only a few seconds anyway. If the testsuite fails, recompile PCRE without `--enable-jit`.

(Skip this, at the very least, on Cygwin since the testsuite fails there anyways, albeit for unrelated reasons; see #24756).

CC:  @mkoeppe @dimpase @EmmanuelCharpentier

Reviewer: Dima Pasechnik

Author: Jeroen Demeyer

Branch: db16bc954c742ea82878da606e8737e57230865b

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24628





---

archive/issue_comments_363792.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-it fails its self-tests, segfaulting (see #24596)\n+The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a \"bus error\" on Solaris.\n+\n+To work around this, I propose to *always* run the PCRE testsuite and recompile it without `--enable-jit` if it fails.\n \n Comment: 1\n \n```\n",
    "created_at": "2018-02-05T09:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363792",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
-it fails its self-tests, segfaulting (see #24596)
+The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a "bus error" on Solaris.
+
+To work around this, I propose to *always* run the PCRE testsuite and recompile it without `--enable-jit` if it fails.
 
 Comment: 1
 
```




---

archive/issue_comments_363793.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a \"bus error\" on Solaris.\n \n+To work around this, I propose to *always* run the PCRE testsuite. This takes only a few seconds anyway. If the testsuite fails, recompile PCRE without `--enable-jit`.\n \n Comment: 1\n \n```\n",
    "created_at": "2018-02-05T09:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363793",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
+The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a "bus error" on Solaris.
 
+To work around this, I propose to *always* run the PCRE testsuite. This takes only a few seconds anyway. If the testsuite fails, recompile PCRE without `--enable-jit`.
 
 Comment: 1
 
```




---

archive/issue_comments_363794.json:
```json
{
    "body": "<a id='comment:3'></a>I believe PCRE is used in Polymake, and in Sage's polymake interface. I guess without JIT they (as well as R, as R is using it too) might get slower...",
    "created_at": "2018-02-05T10:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363794",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>I believe PCRE is used in Polymake, and in Sage's polymake interface. I guess without JIT they (as well as R, as R is using it too) might get slower...



---

archive/issue_comments_363795.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 dimpase]:\n> I believe PCRE is used in Polymake, and in Sage's polymake interface. I guess without JIT they (as well as R, as R is using it too) might get slower...\n\n\nSlower but functional should be acceptable. Note that my patch still uses JIT on systems where it is supported.\n\n---\nNew commits:",
    "created_at": "2018-02-05T10:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363795",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:3 dimpase]:
> I believe PCRE is used in Polymake, and in Sage's polymake interface. I guess without JIT they (as well as R, as R is using it too) might get slower...


Slower but functional should be acceptable. Note that my patch still uses JIT on systems where it is supported.

---
New commits:



---

archive/issue_comments_363796.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-05T11:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363796",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_363797.json:
```json
{
    "body": "<a id='comment:7'></a>\n```\nreal    9m46.453s\nuser    7m32.365s\nsys     2m2.237s\nCopying package files from temporary location /datapool/jeroen/sage/local/var/tmp/sage/build/pcre-8.40.p1/inst to /datapool/jeroen/sage/local\nSuccessfully installed pcre-8.40.p1\nDeleting temporary build directory\n/datapool/jeroen/sage/local/var/tmp/sage/build/pcre-8.40.p1\nFinished installing pcre-8.40.p1.spkg\n```",
    "created_at": "2018-02-05T11:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363797",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
```
real    9m46.453s
user    7m32.365s
sys     2m2.237s
Copying package files from temporary location /datapool/jeroen/sage/local/var/tmp/sage/build/pcre-8.40.p1/inst to /datapool/jeroen/sage/local
Successfully installed pcre-8.40.p1
Deleting temporary build directory
/datapool/jeroen/sage/local/var/tmp/sage/build/pcre-8.40.p1
Finished installing pcre-8.40.p1.spkg
```



---

archive/issue_comments_363798.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-05T12:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363798",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_363799.json:
```json
{
    "body": "<a id='comment:8'></a>looks good to me",
    "created_at": "2018-02-05T12:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363799",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>looks good to me



---

archive/issue_events_062035.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-09T08:03:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24628#event-62035"
}
```



---

archive/issue_comments_363800.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-09T08:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363800",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_363801.json:
```json
{
    "body": "<a id='comment:10'></a>Wish someone had CC'd me on this (I don't read every ticket that gets opened).  The test suite for PCRE has always failed on Cygwin (with or without JIT) so this broke the build on Cygwin.",
    "created_at": "2018-02-16T15:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363801",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>Wish someone had CC'd me on this (I don't read every ticket that gets opened).  The test suite for PCRE has always failed on Cygwin (with or without JIT) so this broke the build on Cygwin.



---

archive/issue_comments_363802.json:
```json
{
    "body": "<a id='comment:11'></a>IMHO on Cygwin, and, in fact on any system that provides PCRE,\nwe should just use the system's one.",
    "created_at": "2018-02-16T15:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363802",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>IMHO on Cygwin, and, in fact on any system that provides PCRE,
we should just use the system's one.



---

archive/issue_comments_363803.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 dimpase]:\n> IMHO on Cygwin, and, in fact on any system that provides PCRE,\n> we should just use the system's one.\n\n\nAgreed. Working on that :)",
    "created_at": "2018-02-16T15:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363803",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Replying to [comment:11 dimpase]:
> IMHO on Cygwin, and, in fact on any system that provides PCRE,
> we should just use the system's one.


Agreed. Working on that :)



---

archive/issue_comments_363804.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 embray]:\n> Replying to [comment:11 dimpase]:\n> > IMHO on Cygwin, and, in fact on any system that provides PCRE,\n> > we should just use the system's one.\n\n> \n> Agreed. Working on that :)\n\n\nThis is a **general** need : unless we have specific needs not solvable in an interface, we should use whatever is installed systemwide.\n\nA mechanism to do that in the toplevel configuration file would be useful. IIRC, Erik has undertaken to refactor parts of this cofiguraion system (that's why I haven't yet progresed much on OpenSSL, BTW : I'm waiting for the dust to settle a bit...), this might be one of his objectives.\n\nHowever, I can think of difficulties to extende such a mechanism to //library// interfaces...",
    "created_at": "2018-02-16T15:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363804",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:13'></a>Replying to [comment:12 embray]:
> Replying to [comment:11 dimpase]:
> > IMHO on Cygwin, and, in fact on any system that provides PCRE,
> > we should just use the system's one.

> 
> Agreed. Working on that :)


This is a **general** need : unless we have specific needs not solvable in an interface, we should use whatever is installed systemwide.

A mechanism to do that in the toplevel configuration file would be useful. IIRC, Erik has undertaken to refactor parts of this cofiguraion system (that's why I haven't yet progresed much on OpenSSL, BTW : I'm waiting for the dust to settle a bit...), this might be one of his objectives.

However, I can think of difficulties to extende such a mechanism to //library// interfaces...



---

archive/issue_comments_363805.json:
```json
{
    "body": "<a id='comment:14'></a>I already have a prototype for this that I'm pretty happy with, but I've been waiting, as you say, for the dust to settle on #21524 before moving forward on it.  That ticket is ready for review BTW.",
    "created_at": "2018-02-16T16:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363805",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>I already have a prototype for this that I'm pretty happy with, but I've been waiting, as you say, for the dust to settle on #21524 before moving forward on it.  That ticket is ready for review BTW.



---

archive/issue_comments_363806.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a \"bus error\" on Solaris.\n \n+To work around this, I propose to *always* run the PCRE testsuite. This takes only a few seconds anyway. If the testsuite fails, recompile PCRE without `--enable-jit`.\n+\n+(Skip this, at the very least, on Cygwin since the testsuite fails there anyways, albeit for unrelated reasons; see #24756).\n \n Comment: 1\n \n```\n",
    "created_at": "2018-02-27T12:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24628#issuecomment-363806",
    "user": "https://github.com/embray"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+The JIT feature of PCRE is buggy on some systems: it already required a fix for Cygwin and it gives a "bus error" on Solaris.
 
+To work around this, I propose to *always* run the PCRE testsuite. This takes only a few seconds anyway. If the testsuite fails, recompile PCRE without `--enable-jit`.
+
+(Skip this, at the very least, on Cygwin since the testsuite fails there anyways, albeit for unrelated reasons; see #24756).
 
 Comment: 1
 
```

