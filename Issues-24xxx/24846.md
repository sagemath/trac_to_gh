# Issue 24846: Make the face lattice of a polyhedron a lattice

archive/issues_024609.json:
```json
{
    "body": "CC:  @videlec @mo271 @mkoeppe @fchapoton @jm58660\n\nKeywords: days93, poset, polytope\n\nCurrently, the output object of the method `face_lattice` is not a lattice but a finite poset. This is also a good opportunity to revamp the method `Hasse_diagram_from_incidences` which is ill-named.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24846\n\n",
    "closed_at": "2018-06-30T15:21:20Z",
    "created_at": "2018-02-26T21:53:14Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Make the face lattice of a polyhedron a lattice",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24846",
    "user": "https://github.com/jplab"
}
```
CC:  @videlec @mo271 @mkoeppe @fchapoton @jm58660

Keywords: days93, poset, polytope

Currently, the output object of the method `face_lattice` is not a lattice but a finite poset. This is also a good opportunity to revamp the method `Hasse_diagram_from_incidences` which is ill-named.



Issue created by migration from https://trac.sagemath.org/ticket/24846





---

archive/issue_comments_344836.json:
```json
{
    "body": "Is it ill-named or ill-implemented, if it is in need of a revamp?-)",
    "created_at": "2018-02-26T23:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344836",
    "user": "https://github.com/novoselt"
}
```

Is it ill-named or ill-implemented, if it is in need of a revamp?-)



---

archive/issue_comments_344837.json:
```json
{
    "body": "I'd say it is not an exclusive \"or\" in this case...!\n\nThe Hasse diagram is an oriented acyclic graph, whereas what is returned is a poset, not the Hasse diagram of that poset... So this is misleading. And I do not see why we could not readily return a LatticePoset object if it is already. (Maybe there are some reasons not to do this?)\n\nThis function is very handy sometimes and could be used for (abstract) combinatorial polytopes.",
    "created_at": "2018-02-27T08:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344837",
    "user": "https://github.com/jplab"
}
```

I'd say it is not an exclusive "or" in this case...!

The Hasse diagram is an oriented acyclic graph, whereas what is returned is a poset, not the Hasse diagram of that poset... So this is misleading. And I do not see why we could not readily return a LatticePoset object if it is already. (Maybe there are some reasons not to do this?)

This function is very handy sometimes and could be used for (abstract) combinatorial polytopes.



---

archive/issue_comments_344838.json:
```json
{
    "body": "I'm not aware of any reasons to avoid `LatticePoset`. The current output is either inherited from the old implementation or it was the best I found when rewriting it. One thing I do remember however - some tricks were necessary to construct the poset object fast, naive call to the constructor was taking several times more time than computing that acyclic graph itself.",
    "created_at": "2018-02-28T04:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344838",
    "user": "https://github.com/novoselt"
}
```

I'm not aware of any reasons to avoid `LatticePoset`. The current output is either inherited from the old implementation or it was the best I found when rewriting it. One thing I do remember however - some tricks were necessary to construct the poset object fast, naive call to the constructor was taking several times more time than computing that acyclic graph itself.



---

archive/issue_comments_344839.json:
```json
{
    "body": "Replying to [comment:3 novoselt]:\n> I'm not aware of any reasons to avoid `LatticePoset`. The current output is either inherited from the old implementation or it was the best I found when rewriting it. One thing I do remember however - some tricks were necessary to construct the poset object fast, naive call to the constructor was taking several times more time than computing that acyclic graph itself.\n\n\nAh! Ok, good to know! It will be worth benchmarking the difference.",
    "created_at": "2018-02-28T08:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344839",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:3 novoselt]:
> I'm not aware of any reasons to avoid `LatticePoset`. The current output is either inherited from the old implementation or it was the best I found when rewriting it. One thing I do remember however - some tricks were necessary to construct the poset object fast, naive call to the constructor was taking several times more time than computing that acyclic graph itself.


Ah! Ok, good to know! It will be worth benchmarking the difference.



---

archive/issue_events_062439.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-06-25T20:05:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24846#event-62439"
}
```



---

archive/issue_comments_344840.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-25T20:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344840",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_344841.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-25T20:05:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344841",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_344842.json:
```json
{
    "body": "So since I mentioned it before - was there any benchmarking/profiling looking into the speed of creating this lattice? It used to matter a lot to me when I was working with thousands of (quite small) polytopes.",
    "created_at": "2018-06-25T20:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344842",
    "user": "https://github.com/novoselt"
}
```

So since I mentioned it before - was there any benchmarking/profiling looking into the speed of creating this lattice? It used to matter a lot to me when I was working with thousands of (quite small) polytopes.



---

archive/issue_comments_344843.json:
```json
{
    "body": "The comment\n\n```\n# In principle, it is recommended to use Poset or in this case perhaps\n# even LatticePoset, but it seems to take several times more time\n# than the above computation, makes unnecessary copies, and crashes.\n```\n\ncan now be removed.\n\nI suppose this is not going to change the speed (meets and joins will be lazy evaluated), but haven't tested that.",
    "created_at": "2018-06-26T04:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344843",
    "user": "https://github.com/jm58660"
}
```

The comment

```
# In principle, it is recommended to use Poset or in this case perhaps
# even LatticePoset, but it seems to take several times more time
# than the above computation, makes unnecessary copies, and crashes.
```

can now be removed.

I suppose this is not going to change the speed (meets and joins will be lazy evaluated), but haven't tested that.



---

archive/issue_comments_344844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-26T05:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344845.json:
```json
{
    "body": "Please, could someone who is interested do the benchmarking ?",
    "created_at": "2018-06-26T07:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344845",
    "user": "https://github.com/fchapoton"
}
```

Please, could someone who is interested do the benchmarking ?



---

archive/issue_comments_344846.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-26T08:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344847.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-27T08:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_344848.json:
```json
{
    "body": "timings, before:\n\n```\nsage: P = polytopes.hypercube(4)\nsage: %time P.face_lattice()\nCPU times: user 44.7 ms, sys: 4.22 ms, total: 48.9 ms\nWall time: 40.8 ms\nFinite poset containing 82 elements with distinguished linear extension\nsage: P = polytopes.associahedron(['A',4])\nsage: %time P.face_lattice()\nCPU times: user 95.7 ms, sys: 8.17 ms, total: 104 ms\nWall time: 98.6 ms\nFinite poset containing 198 elements with distinguished linear extension\n```\nand after\n\n```\nsage: P = polytopes.hypercube(4)\nsage: %time P.face_lattice()\nCPU times: user 33.4 ms, sys: 8.65 ms, total: 42.1 ms\nWall time: 37.9 ms\nFinite lattice containing 82 elements with distinguished linear extension\nsage: P = polytopes.associahedron(['A',4])\nsage: %time P.face_lattice()\nCPU times: user 96.1 ms, sys: 3.9 ms, total: 100 ms\nWall time: 95.6 ms\nFinite lattice containing 198 elements with distinguished linear extension\n```",
    "created_at": "2018-06-27T08:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344848",
    "user": "https://github.com/fchapoton"
}
```

timings, before:

```
sage: P = polytopes.hypercube(4)
sage: %time P.face_lattice()
CPU times: user 44.7 ms, sys: 4.22 ms, total: 48.9 ms
Wall time: 40.8 ms
Finite poset containing 82 elements with distinguished linear extension
sage: P = polytopes.associahedron(['A',4])
sage: %time P.face_lattice()
CPU times: user 95.7 ms, sys: 8.17 ms, total: 104 ms
Wall time: 98.6 ms
Finite poset containing 198 elements with distinguished linear extension
```
and after

```
sage: P = polytopes.hypercube(4)
sage: %time P.face_lattice()
CPU times: user 33.4 ms, sys: 8.65 ms, total: 42.1 ms
Wall time: 37.9 ms
Finite lattice containing 82 elements with distinguished linear extension
sage: P = polytopes.associahedron(['A',4])
sage: %time P.face_lattice()
CPU times: user 96.1 ms, sys: 3.9 ms, total: 100 ms
Wall time: 95.6 ms
Finite lattice containing 198 elements with distinguished linear extension
```



---

archive/issue_comments_344849.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-28T09:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344849",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_344850.json:
```json
{
    "body": "All seems to be OK.",
    "created_at": "2018-06-28T09:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344850",
    "user": "https://github.com/jm58660"
}
```

All seems to be OK.



---

archive/issue_comments_344851.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-30T15:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24846#issuecomment-344851",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062440.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-30T15:21:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24846",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24846#event-62440"
}
```
