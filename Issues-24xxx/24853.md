# Issue 24853: substitution into polynomials over SR broken

archive/issues_024616.json:
```json
{
    "body": "\n```\nsage: R.<r>=SR[]\nsage: R\nUnivariate Polynomial Ring in r over Symbolic Ring\nsage: p=r^2-1\nsage: p(1)\nException RuntimeError: 'maximum recursion depth exceeded while calling a Python object' in <type 'exceptions.RuntimeError'> ignored\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-44-4c09f14dea4d> in <module>()\n----> 1 p(Integer(1))\n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.__call__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:9535)()\n    787         elif hasattr(a, \"_evaluate_polynomial\"):\n    788             try:\n--> 789                 return a._evaluate_polynomial(pol)\n    790             except NotImplementedError:\n    791                 pass\n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._evaluate_polynomial (build/cythonized/sage/symbolic/expression.cpp:45786)()\n   7458         cdef Expression zero\n   7459         try:\n-> 7460             return new_Expression_from_pyobject(self._parent, pol(self.pyobject()))\n   7461         except TypeError:\n   7462             zero = self._parent.zero()\n\n... last 2 frames repeated, from the frame below ...\n\n/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.__call__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:9535)()\n    787         elif hasattr(a, \"_evaluate_polynomial\"):\n    788             try:\n--> 789                 return a._evaluate_polynomial(pol)\n    790             except NotImplementedError:\n    791                 pass\n\nRuntimeError: maximum recursion depth exceeded while calling a Python object\n```\n\nsee also sage-support [here](https://groups.google.com/d/msg/sage-support/pcp_Mh65Fvk/U6Qhy_dpAgAJ)\n\n**CC:**  @rwst @mezzarobba\n\n**Branch/Commit:** [dbe38b1b2a303cac558907269d995c80c8be1088](https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088)\n\n**Reviewer:** Ralf Stephan\n\n**Author:** Marc Mezzarobba\n\nIssue created by migration from https://trac.sagemath.org/ticket/24853\n\n",
    "closed_at": "2018-03-21T06:18:42Z",
    "created_at": "2018-02-27T09:58:07Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "title": "substitution into polynomials over SR broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/24853",
    "user": "https://github.com/dimpase"
}
```

```
sage: R.<r>=SR[]
sage: R
Univariate Polynomial Ring in r over Symbolic Ring
sage: p=r^2-1
sage: p(1)
Exception RuntimeError: 'maximum recursion depth exceeded while calling a Python object' in <type 'exceptions.RuntimeError'> ignored
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-44-4c09f14dea4d> in <module>()
----> 1 p(Integer(1))

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.__call__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:9535)()
    787         elif hasattr(a, "_evaluate_polynomial"):
    788             try:
--> 789                 return a._evaluate_polynomial(pol)
    790             except NotImplementedError:
    791                 pass

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._evaluate_polynomial (build/cythonized/sage/symbolic/expression.cpp:45786)()
   7458         cdef Expression zero
   7459         try:
-> 7460             return new_Expression_from_pyobject(self._parent, pol(self.pyobject()))
   7461         except TypeError:
   7462             zero = self._parent.zero()

... last 2 frames repeated, from the frame below ...

/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.__call__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:9535)()
    787         elif hasattr(a, "_evaluate_polynomial"):
    788             try:
--> 789                 return a._evaluate_polynomial(pol)
    790             except NotImplementedError:
    791                 pass

RuntimeError: maximum recursion depth exceeded while calling a Python object
```

see also sage-support [here](https://groups.google.com/d/msg/sage-support/pcp_Mh65Fvk/U6Qhy_dpAgAJ)

**CC:**  @rwst @mezzarobba

**Branch/Commit:** [dbe38b1b2a303cac558907269d995c80c8be1088](https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088)

**Reviewer:** Ralf Stephan

**Author:** Marc Mezzarobba

Issue created by migration from https://trac.sagemath.org/ticket/24853





---

archive/issue_comments_380445.json:
```json
{
    "body": "<a id='comment:1'></a>\n`p.__call__` calls `SR(1)._evaluate_polynomial`:\n\n```\n        /* \"sage/rings/polynomial/polynomial_element.pyx\":790\n *         elif hasattr(a, \"_evaluate_polynomial\"):\n *             try:\n *                 return a._evaluate_polynomial(pol)             # <<<<<<<<<<<<<<\n *             except NotImplementedError:\n *                 pass\n */\n```\nand `SR(1)._evaluate_polynomial` calls `p(SR(1))`:\n\n```\n  /* \"sage/symbolic/expression.pyx\":7459\n *         \"\"\"\n *         cdef Expression zero\n *         try:             # <<<<<<<<<<<<<<\n *             return new_Expression_from_pyobject(self._parent, pol(self.pyobject()))\n *         except TypeError:\n */\n```",
    "created_at": "2018-02-27T15:14:12Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380445",
    "user": "https://github.com/rwst"
}
```

<a id='comment:1'></a>
`p.__call__` calls `SR(1)._evaluate_polynomial`:

```
        /* "sage/rings/polynomial/polynomial_element.pyx":790
 *         elif hasattr(a, "_evaluate_polynomial"):
 *             try:
 *                 return a._evaluate_polynomial(pol)             # <<<<<<<<<<<<<<
 *             except NotImplementedError:
 *                 pass
 */
```
and `SR(1)._evaluate_polynomial` calls `p(SR(1))`:

```
  /* "sage/symbolic/expression.pyx":7459
 *         """
 *         cdef Expression zero
 *         try:             # <<<<<<<<<<<<<<
 *             return new_Expression_from_pyobject(self._parent, pol(self.pyobject()))
 *         except TypeError:
 */
```



---

archive/issue_comments_380446.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe changes came here:\n\n```\ncommit 03e86910b66e18bc652b918a1ad8e2892ac04004\nAuthor: Marc Mezzarobba <marc@mezzarobba.net>\nDate:   Wed Jan 11 12:18:50 2017 +0100\n\n    speed up generic Polynomial.__call__()\n```",
    "created_at": "2018-02-27T15:17:50Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380446",
    "user": "https://github.com/rwst"
}
```

<a id='comment:2'></a>
The changes came here:

```
commit 03e86910b66e18bc652b918a1ad8e2892ac04004
Author: Marc Mezzarobba <marc@mezzarobba.net>
Date:   Wed Jan 11 12:18:50 2017 +0100

    speed up generic Polynomial.__call__()
```



---

archive/issue_events_220283.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-27T15:19:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "component: symbolics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220283"
}
```



---

archive/issue_events_220284.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-27T15:19:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "component: commutative algebra",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220284"
}
```



---

archive/issue_comments_380447.json:
```json
{
    "body": "<a id='comment:4'></a>\nMaybe instead of `pol(self.pyobject())` `parent(pol)(self.pyobject())` was meant?",
    "created_at": "2018-02-27T15:50:23Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380447",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>
Maybe instead of `pol(self.pyobject())` `parent(pol)(self.pyobject())` was meant?



---

archive/issue_comments_380448.json:
```json
{
    "body": "**Branch:** [u/rws/substitution_into_polynomials_over_sr_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/substitution_into_polynomials_over_sr_broken)",
    "created_at": "2018-02-27T16:14:39Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380448",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/substitution_into_polynomials_over_sr_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/substitution_into_polynomials_over_sr_broken)



---

archive/issue_comments_380449.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6e298a11d546988258d1842860d2ef577a3b7baa\">6e298a1</a></td><td><code>24853: fix doctests</code></td></tr></table>\n",
    "created_at": "2018-02-27T16:17:09Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6e298a11d546988258d1842860d2ef577a3b7baa">6e298a1</a></td><td><code>24853: fix doctests</code></td></tr></table>




---

archive/issue_comments_380450.json:
```json
{
    "body": "**Commit:** [6e298a11d546988258d1842860d2ef577a3b7baa](https://github.com/sagemath/sagetrac-mirror/commit/6e298a11d546988258d1842860d2ef577a3b7baa)",
    "created_at": "2018-02-27T16:17:09Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [6e298a11d546988258d1842860d2ef577a3b7baa](https://github.com/sagemath/sagetrac-mirror/commit/6e298a11d546988258d1842860d2ef577a3b7baa)



---

archive/issue_events_220285.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-02-27T16:19:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220285"
}
```



---

archive/issue_comments_380451.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis also fixes doctests that were wrong IMHO.\n\nFinally, I still see a half-second delay when doing the first `R.<r>=SR[]; (r^2-1)(1)`.",
    "created_at": "2018-02-27T16:19:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380451",
    "user": "https://github.com/rwst"
}
```

<a id='comment:7'></a>
This also fixes doctests that were wrong IMHO.

Finally, I still see a half-second delay when doing the first `R.<r>=SR[]; (r^2-1)(1)`.



---

archive/issue_comments_380452.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2018-02-27T16:19:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380452",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_380453.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [rws](#comment%3A7):\n\n> Finally, I still see a half-second delay when doing the first `R.<r>=SR[]; (r^2-1)(1)`.\n\nSomething big is getting loaded, perhaps Maxima?",
    "created_at": "2018-02-27T18:04:50Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380453",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
Replying to [rws](#comment%3A7):

> Finally, I still see a half-second delay when doing the first `R.<r>=SR[]; (r^2-1)(1)`.

Something big is getting loaded, perhaps Maxima?



---

archive/issue_comments_380454.json:
```json
{
    "body": "<a id='comment:9'></a>\nPolynomials over `SR` really make no sense in the first place.",
    "created_at": "2018-02-27T19:36:22Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380454",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Polynomials over `SR` really make no sense in the first place.



---

archive/issue_comments_380455.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jdemeyer](#comment%3A9):\n> Polynomials over `SR` really make no sense in the first place.\n\n\n`charpoly` of a symbolic matrix should return a symbolic polynomial?",
    "created_at": "2018-02-28T07:01:12Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380455",
    "user": "https://github.com/rwst"
}
```

<a id='comment:10'></a>
Replying to [jdemeyer](#comment%3A9):
> Polynomials over `SR` really make no sense in the first place.


`charpoly` of a symbolic matrix should return a symbolic polynomial?



---

archive/issue_comments_380456.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [rws](#comment%3A2):\n> The changes came here:\n> \n> ```\n> commit 03e86910b66e18bc652b918a1ad8e2892ac04004\n> Author: Marc Mezzarobba <marc@mezzarobba.net>\n> Date:   Wed Jan 11 12:18:50 2017 +0100\n> \n>     speed up generic Polynomial.__call__()\n> ```\n\n\nYes and no: this commit (and, perhaps more importantly, 84d6a1b874c) mainly reorganize the code, without changing its semantics much...\n\nReplying to [rws](#comment%3A4):\n> Maybe instead of `pol(self.pyobject())` `parent(pol)(self.pyobject())` was meant?\n\n\n...But I doubt that. Wouldn't something like (not tested)\n\n```\nif pol.parent() is not SR:\n    try:\n        return new_Expression_from_pyobject(self._parent, pol(self.pyobject()))\n    except TypeError:\n        pass\nzero = self._parent.zero()\nreturn zero.add(*(pol[i]*self**i for i in xrange(pol.degree() + 1)))\n```\n\nmake more sense?\n\nReplying to [rws](#comment%3A7):\n> This also fixes doctests that were wrong IMHO.\n\n\nWhile I have no strong opinion about\n\n```\n             sage: f(pi)\n-            1.00000000000000*pi^2 - 2.00000000000000\n-\n+            7.86960440108936\n```\nI really don't see why you would want this:\n\n```\n             sage: SR(0.1)._evaluate_polynomial(pol)\n-            0.123400000000000\n+            617/5000\n```",
    "created_at": "2018-02-28T09:46:40Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380456",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:11'></a>
Replying to [rws](#comment%3A2):
> The changes came here:
> 
> ```
> commit 03e86910b66e18bc652b918a1ad8e2892ac04004
> Author: Marc Mezzarobba <marc@mezzarobba.net>
> Date:   Wed Jan 11 12:18:50 2017 +0100
> 
>     speed up generic Polynomial.__call__()
> ```


Yes and no: this commit (and, perhaps more importantly, 84d6a1b874c) mainly reorganize the code, without changing its semantics much...

Replying to [rws](#comment%3A4):
> Maybe instead of `pol(self.pyobject())` `parent(pol)(self.pyobject())` was meant?


...But I doubt that. Wouldn't something like (not tested)

```
if pol.parent() is not SR:
    try:
        return new_Expression_from_pyobject(self._parent, pol(self.pyobject()))
    except TypeError:
        pass
zero = self._parent.zero()
return zero.add(*(pol[i]*self**i for i in xrange(pol.degree() + 1)))
```

make more sense?

Replying to [rws](#comment%3A7):
> This also fixes doctests that were wrong IMHO.


While I have no strong opinion about

```
             sage: f(pi)
-            1.00000000000000*pi^2 - 2.00000000000000
-
+            7.86960440108936
```
I really don't see why you would want this:

```
             sage: SR(0.1)._evaluate_polynomial(pol)
-            0.123400000000000
+            617/5000
```



---

archive/issue_comments_380457.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jdemeyer](#comment%3A9):\n> Polynomials over `SR` really make no sense in the first place.\n\n\nWhy? I agree with Ralf here, characteristic polynomials of symbolic matrices are a good example.",
    "created_at": "2018-02-28T09:48:16Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380457",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:12'></a>
Replying to [jdemeyer](#comment%3A9):
> Polynomials over `SR` really make no sense in the first place.


Why? I agree with Ralf here, characteristic polynomials of symbolic matrices are a good example.



---

archive/issue_comments_380458.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [mmezzarobba](#comment%3A11):\n> I really don't see why you would want this:\n> \n> ```\n>              sage: SR(0.1)._evaluate_polynomial(pol)\n> -            0.123400000000000\n> +            617/5000\n> ```\n\n\nBecause `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.\n\nReplying to [mmezzarobba](#comment%3A12):\n> Replying to [jdemeyer](#comment%3A9):\n> > Polynomials over `SR` really make no sense in the first place.\n\n> \n> Why? I agree with Ralf here, characteristic polynomials of symbolic matrices are a good example.\n\n\nDon't misunderstand me, my comment was not a rethorical question. I'm ready to change what's returned from charpoly() to an expression.",
    "created_at": "2018-02-28T09:53:23Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380458",
    "user": "https://github.com/rwst"
}
```

<a id='comment:13'></a>
Replying to [mmezzarobba](#comment%3A11):
> I really don't see why you would want this:
> 
> ```
>              sage: SR(0.1)._evaluate_polynomial(pol)
> -            0.123400000000000
> +            617/5000
> ```


Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.

Replying to [mmezzarobba](#comment%3A12):
> Replying to [jdemeyer](#comment%3A9):
> > Polynomials over `SR` really make no sense in the first place.

> 
> Why? I agree with Ralf here, characteristic polynomials of symbolic matrices are a good example.


Don't misunderstand me, my comment was not a rethorical question. I'm ready to change what's returned from charpoly() to an expression.



---

archive/issue_comments_380459.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mmezzarobba](#comment%3A11):\n> make more sense?\n\n\nPlease go ahead.",
    "created_at": "2018-02-28T09:54:58Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380459",
    "user": "https://github.com/rwst"
}
```

<a id='comment:14'></a>
Replying to [mmezzarobba](#comment%3A11):
> make more sense?


Please go ahead.



---

archive/issue_comments_380460.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [rws](#comment%3A13):\n> Replying to [mmezzarobba](#comment%3A11):\n> > I really don't see why you would want this:\n> > \n> > ```\n> >              sage: SR(0.1)._evaluate_polynomial(pol)\n> > -            0.123400000000000\n> > +            617/5000\n> > ```\n\n> \n> Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.\n> \n> Replying to [mmezzarobba](#comment%3A12):\n> > Replying to [jdemeyer](#comment%3A9):\n> > > Polynomials over `SR` really make no sense in the first place.\n\n> > \n> > Why? I agree with Ralf here, characteristic polynomials of symbolic matrices are a good example.\n\n> \n> Don't misunderstand me, my comment was not a rethorical question. I'm ready to change what's returned from charpoly() to an expression.\n\n\nI would not try to force this onto the user - this conversion is easy.\n\nI also do not understand why having polynomials over `SR` makes no sense; well, it might be so in an ideal world where `SR` can seamlessly discover polynomial structures in expressions and operate accordingly, but this is not the case I think.",
    "created_at": "2018-02-28T10:41:56Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380460",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [rws](#comment%3A13):
> Replying to [mmezzarobba](#comment%3A11):
> > I really don't see why you would want this:
> > 
> > ```
> >              sage: SR(0.1)._evaluate_polynomial(pol)
> > -            0.123400000000000
> > +            617/5000
> > ```

> 
> Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.
> 
> Replying to [mmezzarobba](#comment%3A12):
> > Replying to [jdemeyer](#comment%3A9):
> > > Polynomials over `SR` really make no sense in the first place.

> > 
> > Why? I agree with Ralf here, characteristic polynomials of symbolic matrices are a good example.

> 
> Don't misunderstand me, my comment was not a rethorical question. I'm ready to change what's returned from charpoly() to an expression.


I would not try to force this onto the user - this conversion is easy.

I also do not understand why having polynomials over `SR` makes no sense; well, it might be so in an ideal world where `SR` can seamlessly discover polynomial structures in expressions and operate accordingly, but this is not the case I think.



---

archive/issue_comments_380461.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [rws](#comment%3A13):\n> Replying to [mmezzarobba](#comment%3A11):\n> > I really don't see why you would want this:\n> > \n> > ```\n> >              sage: SR(0.1)._evaluate_polynomial(pol)\n> > -            0.123400000000000\n> > +            617/5000\n> > ```\n\n> \n> Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.\n\n\nI think I don't understand what you mean, sorry. First, `QQ(0.1)` is 1/10, but there is no coercion from `RR` to `QQ` so this doesn't mean anything, and `(0.1).exact_rational()` is `3602879701896397/36028797018963968`. Second, even 0.1 \u201cwas\u201d 1/10 in some stronger sense, I don't see why polynomial evaluation would want to convert the argument to the polynomial's base ring (outside symbolics, `Polynomial.__call__()` returns an element of the pushout of the base ring and the evaluation point, which does the right thing in every(?) case).",
    "created_at": "2018-03-06T16:29:11Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380461",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:16'></a>
Replying to [rws](#comment%3A13):
> Replying to [mmezzarobba](#comment%3A11):
> > I really don't see why you would want this:
> > 
> > ```
> >              sage: SR(0.1)._evaluate_polynomial(pol)
> > -            0.123400000000000
> > +            617/5000
> > ```

> 
> Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.


I think I don't understand what you mean, sorry. First, `QQ(0.1)` is 1/10, but there is no coercion from `RR` to `QQ` so this doesn't mean anything, and `(0.1).exact_rational()` is `3602879701896397/36028797018963968`. Second, even 0.1 “was” 1/10 in some stronger sense, I don't see why polynomial evaluation would want to convert the argument to the polynomial's base ring (outside symbolics, `Polynomial.__call__()` returns an element of the pushout of the base ring and the evaluation point, which does the right thing in every(?) case).



---

archive/issue_comments_380462.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mmezzarobba](#comment%3A16):\n> Replying to [rws](#comment%3A13):\n> > Replying to [mmezzarobba](#comment%3A11):\n> > > I really don't see why you would want this:\n> > > \n> > > ```\n> > >              sage: SR(0.1)._evaluate_polynomial(pol)\n> > > -            0.123400000000000\n> > > +            617/5000\n> > > ```\n\n> > \n> > Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.\n\n> \n> I think I don't understand what you mean, sorry. First, `QQ(0.1)` is 1/10, but there is no coercion from `RR` to `QQ` so this doesn't mean anything, and `(0.1).exact_rational()` is `3602879701896397/36028797018963968`. Second, even 0.1 \u201cwas\u201d 1/10 in some stronger sense, I don't see why polynomial evaluation would want to convert the argument to the polynomial's base ring (outside symbolics, `Polynomial.__call__()` returns an element of the pushout of the base ring and the evaluation point, which does the right thing in every(?) case).\n\n\nI fully agree with Marc here (see laso the related discussion at #24939). If there is **any** floating point number in the polynomial, then the output can never be an exact number (including elements of QQ, AA, QQbar as well as exact constants such as pi, e, etc, arctan(2)).",
    "created_at": "2018-03-10T15:45:16Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380462",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
Replying to [mmezzarobba](#comment%3A16):
> Replying to [rws](#comment%3A13):
> > Replying to [mmezzarobba](#comment%3A11):
> > > I really don't see why you would want this:
> > > 
> > > ```
> > >              sage: SR(0.1)._evaluate_polynomial(pol)
> > > -            0.123400000000000
> > > +            617/5000
> > > ```

> > 
> > Because `pol` is a `QQ[]` and `QQ(0.1)` is `1/10` of course.

> 
> I think I don't understand what you mean, sorry. First, `QQ(0.1)` is 1/10, but there is no coercion from `RR` to `QQ` so this doesn't mean anything, and `(0.1).exact_rational()` is `3602879701896397/36028797018963968`. Second, even 0.1 “was” 1/10 in some stronger sense, I don't see why polynomial evaluation would want to convert the argument to the polynomial's base ring (outside symbolics, `Polynomial.__call__()` returns an element of the pushout of the base ring and the evaluation point, which does the right thing in every(?) case).


I fully agree with Marc here (see laso the related discussion at #24939). If there is **any** floating point number in the polynomial, then the output can never be an exact number (including elements of QQ, AA, QQbar as well as exact constants such as pi, e, etc, arctan(2)).



---

archive/issue_comments_380463.json:
```json
{
    "body": "**Changing author** from \"Ralf Stephan\" to \"\".",
    "created_at": "2018-03-10T15:51:24Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380463",
    "user": "https://github.com/rwst"
}
```

**Changing author** from "Ralf Stephan" to "".



---

archive/issue_events_220286.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-10T15:51:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220286"
}
```



---

archive/issue_events_220287.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-10T15:51:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220287"
}
```



---

archive/issue_comments_380464.json:
```json
{
    "body": "**Changing commit** from \"[6e298a11d546988258d1842860d2ef577a3b7baa](https://github.com/sagemath/sagetrac-mirror/commit/6e298a11d546988258d1842860d2ef577a3b7baa)\" to \"\".",
    "created_at": "2018-03-10T15:51:24Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380464",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[6e298a11d546988258d1842860d2ef577a3b7baa](https://github.com/sagemath/sagetrac-mirror/commit/6e298a11d546988258d1842860d2ef577a3b7baa)" to "".



---

archive/issue_comments_380465.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/substitution_into_polynomials_over_sr_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/substitution_into_polynomials_over_sr_broken)\" to \"\".",
    "created_at": "2018-03-10T15:51:24Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380465",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/substitution_into_polynomials_over_sr_broken](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/substitution_into_polynomials_over_sr_broken)" to "".



---

archive/issue_comments_380466.json:
```json
{
    "body": "<a id='comment:18'></a>\nI think who introduced the bug should also fix it.",
    "created_at": "2018-03-10T15:51:24Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380466",
    "user": "https://github.com/rwst"
}
```

<a id='comment:18'></a>
I think who introduced the bug should also fix it.



---

archive/issue_comments_380467.json:
```json
{
    "body": "**Author:** Marc Mezzarobba",
    "created_at": "2018-03-10T16:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380467",
    "user": "https://github.com/mezzarobba"
}
```

**Author:** Marc Mezzarobba



---

archive/issue_comments_380468.json:
```json
{
    "body": "**Branch:** [u/mmezzarobba/ticket/24853-pol-SR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/24853-pol-SR)",
    "created_at": "2018-03-10T16:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380468",
    "user": "https://github.com/mezzarobba"
}
```

**Branch:** [u/mmezzarobba/ticket/24853-pol-SR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/24853-pol-SR)



---

archive/issue_comments_380469.json:
```json
{
    "body": "<a id='comment:19'></a>\nI have no idea who introduced the bug, but here is a possible fix that makes sense to me.",
    "created_at": "2018-03-10T16:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380469",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:19'></a>
I have no idea who introduced the bug, but here is a possible fix that makes sense to me.



---

archive/issue_events_220288.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-03-10T16:38:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220288"
}
```



---

archive/issue_events_220289.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-03-10T16:38:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220289"
}
```



---

archive/issue_comments_380470.json:
```json
{
    "body": "**Commit:** [598e9bc83f8e2869c9af1fefbdef9b41a8254f12](https://github.com/sagemath/sagetrac-mirror/commit/598e9bc83f8e2869c9af1fefbdef9b41a8254f12)",
    "created_at": "2018-03-10T16:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380470",
    "user": "https://github.com/mezzarobba"
}
```

**Commit:** [598e9bc83f8e2869c9af1fefbdef9b41a8254f12](https://github.com/sagemath/sagetrac-mirror/commit/598e9bc83f8e2869c9af1fefbdef9b41a8254f12)



---

archive/issue_comments_380471.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8301d6b7fddc49b190363a42c4828ae8dccc4b7c\">8301d6b</a></td><td><code>#24853 fix infinite recursion in polynomial evaluation</code></td></tr></table>\n",
    "created_at": "2018-03-10T16:43:04Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8301d6b7fddc49b190363a42c4828ae8dccc4b7c">8301d6b</a></td><td><code>#24853 fix infinite recursion in polynomial evaluation</code></td></tr></table>




---

archive/issue_comments_380472.json:
```json
{
    "body": "**Changing commit** from \"[598e9bc83f8e2869c9af1fefbdef9b41a8254f12](https://github.com/sagemath/sagetrac-mirror/commit/598e9bc83f8e2869c9af1fefbdef9b41a8254f12)\" to \"[8301d6b7fddc49b190363a42c4828ae8dccc4b7c](https://github.com/sagemath/sagetrac-mirror/commit/8301d6b7fddc49b190363a42c4828ae8dccc4b7c)\".",
    "created_at": "2018-03-10T16:43:04Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[598e9bc83f8e2869c9af1fefbdef9b41a8254f12](https://github.com/sagemath/sagetrac-mirror/commit/598e9bc83f8e2869c9af1fefbdef9b41a8254f12)" to "[8301d6b7fddc49b190363a42c4828ae8dccc4b7c](https://github.com/sagemath/sagetrac-mirror/commit/8301d6b7fddc49b190363a42c4828ae8dccc4b7c)".



---

archive/issue_comments_380473.json:
```json
{
    "body": "**Changing commit** from \"[8301d6b7fddc49b190363a42c4828ae8dccc4b7c](https://github.com/sagemath/sagetrac-mirror/commit/8301d6b7fddc49b190363a42c4828ae8dccc4b7c)\" to \"[dbe38b1b2a303cac558907269d995c80c8be1088](https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088)\".",
    "created_at": "2018-03-10T17:04:59Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8301d6b7fddc49b190363a42c4828ae8dccc4b7c](https://github.com/sagemath/sagetrac-mirror/commit/8301d6b7fddc49b190363a42c4828ae8dccc4b7c)" to "[dbe38b1b2a303cac558907269d995c80c8be1088](https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088)".



---

archive/issue_comments_380474.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088\">dbe38b1</a></td><td><code>#24853 fix infinite recursion in polynomial evaluation</code></td></tr></table>\n",
    "created_at": "2018-03-10T17:04:59Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088">dbe38b1</a></td><td><code>#24853 fix infinite recursion in polynomial evaluation</code></td></tr></table>




---

archive/issue_comments_380475.json:
```json
{
    "body": "**Reviewer:** Ralf Stephan",
    "created_at": "2018-03-19T14:59:25Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380475",
    "user": "https://github.com/rwst"
}
```

**Reviewer:** Ralf Stephan



---

archive/issue_events_220290.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-19T14:59:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220290"
}
```



---

archive/issue_events_220291.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-19T14:59:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220291"
}
```



---

archive/issue_comments_380476.json:
```json
{
    "body": "<a id='comment:22'></a>\nThanks. It's looking fine and patchbot has only the test_jupyter fail.",
    "created_at": "2018-03-19T14:59:25Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380476",
    "user": "https://github.com/rwst"
}
```

<a id='comment:22'></a>
Thanks. It's looking fine and patchbot has only the test_jupyter fail.



---

archive/issue_comments_380477.json:
```json
{
    "body": "**Changing branch** from \"[u/mmezzarobba/ticket/24853-pol-SR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/24853-pol-SR)\" to \"[dbe38b1b2a303cac558907269d995c80c8be1088](https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088)\".",
    "created_at": "2018-03-21T06:18:42Z",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24853#issuecomment-380477",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mmezzarobba/ticket/24853-pol-SR](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/24853-pol-SR)" to "[dbe38b1b2a303cac558907269d995c80c8be1088](https://github.com/sagemath/sagetrac-mirror/commit/dbe38b1b2a303cac558907269d995c80c8be1088)".



---

archive/issue_events_220292.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-21T06:18:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220292"
}
```



---

archive/issue_events_220293.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "236cd50488d9b1e7663f47990aded2b36f09a345",
    "created_at": "2018-03-21T06:18:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24853",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24853#event-220293"
}
```
