# Issue 24484: nbconvert broken after the upgrade to Jupyter 5.2.1

archive/issues_024247.json:
```json
{
    "body": "After the upgrade to Jupyter 5.2.1 implemented in #24168 (merged in Sage 8.2.beta0), the export of a notebook to another format fails, whatever the format. For instance, clicking on `File` -> `Download as` -> `PDF via LaTeX` leads to\n\n```\n500 : Internal Server Error\n\nThe error was:\n\nCould not import nbconvert: No module named base\n```\nThis was reported in https://groups.google.com/d/msg/sage-devel/Qsf9Gb4pDt4/vIORrWIABwAJ\n\nThis ticket fixes this as follows:\n- upgrade to [nbconvert](https://pypi.python.org/pypi/nbconvert) 5.3.1 (from 4.2.0)\n- add [testpath](https://pypi.python.org/pypi/testpath) 0.3.1 and make it standard\n- upgrade to [pandocfilters](https://pypi.python.org/pypi/pandocfilters) 1.4.2 (from 1.3.0)\n  and make it standard (from optional)\n- add nbconvert dependencies: pandocfilters, testpath, bleach=>html5lib=>webencodings\n\n**Upstream tarballs:**\nhttps://pypi.python.org/packages/eb/ea/58428609442130dc31d3a59010bf6cbd263a16c589d01d23b7c1e6997e3b/bleach-2.1.3.tar.gz\nhttps://pypi.python.org/packages/85/3e/cf449cf1b5004e87510b9368e7a5f1acd8831c2d6691edd3c62a0823f98f/html5lib-1.0.1.tar.gz\nhttps://pypi.python.org/packages/b9/a4/d0a0938ad6f5eeb4dea4e73d255c617ef94b0b2849d51194c9bbdb838412/nbconvert-5.3.1.tar.gz\nhttps://pypi.python.org/packages/f4/8b/b71e9ee10e5f751e9d959bc750ab122ba04187f5aa52aabdc4e63b0e31a7/testpath-0.3.1.tar.gz\nhttps://pypi.python.org/packages/0b/02/ae6ceac1baeda530866a85075641cec12989bd8d31af6d5ab4a3e8c92f47/webencodings-0.5.1.tar.gz\n\n\nAssignee: @embray\n\nCC:  @nthiery @slel @embray\n\nKeywords: jupyter, nbconvert\n\nBranch/Commit: 31e3cdf0e86f9d757142b55158851ab22550cbeb\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Erik Bray, Volker Braun\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24484\n\n",
    "closed_at": "2018-04-07T18:03:21Z",
    "created_at": "2018-01-07T16:03:49Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "nbconvert broken after the upgrade to Jupyter 5.2.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24484",
    "user": "https://github.com/egourgoulhon"
}
```
After the upgrade to Jupyter 5.2.1 implemented in #24168 (merged in Sage 8.2.beta0), the export of a notebook to another format fails, whatever the format. For instance, clicking on `File` -> `Download as` -> `PDF via LaTeX` leads to

```
500 : Internal Server Error

The error was:

Could not import nbconvert: No module named base
```
This was reported in https://groups.google.com/d/msg/sage-devel/Qsf9Gb4pDt4/vIORrWIABwAJ

This ticket fixes this as follows:
- upgrade to [nbconvert](https://pypi.python.org/pypi/nbconvert) 5.3.1 (from 4.2.0)
- add [testpath](https://pypi.python.org/pypi/testpath) 0.3.1 and make it standard
- upgrade to [pandocfilters](https://pypi.python.org/pypi/pandocfilters) 1.4.2 (from 1.3.0)
  and make it standard (from optional)
- add nbconvert dependencies: pandocfilters, testpath, bleach=>html5lib=>webencodings

**Upstream tarballs:**
https://pypi.python.org/packages/eb/ea/58428609442130dc31d3a59010bf6cbd263a16c589d01d23b7c1e6997e3b/bleach-2.1.3.tar.gz
https://pypi.python.org/packages/85/3e/cf449cf1b5004e87510b9368e7a5f1acd8831c2d6691edd3c62a0823f98f/html5lib-1.0.1.tar.gz
https://pypi.python.org/packages/b9/a4/d0a0938ad6f5eeb4dea4e73d255c617ef94b0b2849d51194c9bbdb838412/nbconvert-5.3.1.tar.gz
https://pypi.python.org/packages/f4/8b/b71e9ee10e5f751e9d959bc750ab122ba04187f5aa52aabdc4e63b0e31a7/testpath-0.3.1.tar.gz
https://pypi.python.org/packages/0b/02/ae6ceac1baeda530866a85075641cec12989bd8d31af6d5ab4a3e8c92f47/webencodings-0.5.1.tar.gz


Assignee: @embray

CC:  @nthiery @slel @embray

Keywords: jupyter, nbconvert

Branch/Commit: 31e3cdf0e86f9d757142b55158851ab22550cbeb

Reviewer: Eric Gourgoulhon

Author: Erik Bray, Volker Braun

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24484





---

archive/issue_comments_339169.json:
```json
{
    "body": "<a id='comment:3'></a>Adding outline of the fix to ticket description.\n\n---\nNew commits:",
    "created_at": "2018-01-07T22:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339169",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>Adding outline of the fix to ticket description.

---
New commits:



---

archive/issue_comments_339170.json:
```json
{
    "body": "<a id='comment:4'></a>Is this ready for review?",
    "created_at": "2018-01-09T15:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339170",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>Is this ready for review?



---

archive/issue_comments_339171.json:
```json
{
    "body": "<a id='comment:5'></a>no there is still a trail of dependencies... i stopped at html5lib for now.",
    "created_at": "2018-01-09T21:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339171",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>no there is still a trail of dependencies... i stopped at html5lib for now.



---

archive/issue_comments_339172.json:
```json
{
    "body": "<a id='comment:6'></a>Hi Volker,\n\nFor #23362, we need to upgrade pandocfilters too (and nothing else). Do you mind if we take over the two related diffs there?",
    "created_at": "2018-02-08T16:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339172",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:6'></a>Hi Volker,

For #23362, we need to upgrade pandocfilters too (and nothing else). Do you mind if we take over the two related diffs there?



---

archive/issue_comments_339173.json:
```json
{
    "body": "<a id='comment:7'></a>Hi again:\n\nTo get things moving and for testing, I have pushed a branch with those diffs to #23362; waiting for your confirmation.\n\nStrangely enough, I did not get the same checksums. You downloaded the tarbal from\nhttps://github.com/jgm/pandocfilters/releases, right?\n\nCheers,\n                   Nicolas",
    "created_at": "2018-02-08T16:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339173",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:7'></a>Hi again:

To get things moving and for testing, I have pushed a branch with those diffs to #23362; waiting for your confirmation.

Strangely enough, I did not get the same checksums. You downloaded the tarbal from
https://github.com/jgm/pandocfilters/releases, right?

Cheers,
                   Nicolas



---

archive/issue_comments_339174.json:
```json
{
    "body": "<a id='comment:8'></a>Feel free to move stuff to separate ticket. I got pandocfilters from https://pypi.python.org/pypi/pandocfilters which does list the same md5....",
    "created_at": "2018-02-08T19:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339174",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>Feel free to move stuff to separate ticket. I got pandocfilters from https://pypi.python.org/pypi/pandocfilters which does list the same md5....



---

archive/issue_comments_339175.json:
```json
{
    "body": "<a id='comment:9'></a>I see. Thanks for the feedback!\n\nI had downloaded the tarball from github, according to the instructions in the SPKG.txt, and indeed the two tarballs differ slightly:\n\n```\nSeulement dans pandocfilters-1.4.2-github/examples: gabc-score.gabc\nSeulement dans pandocfilters-1.4.2-github/examples: lilypond-score.ly\nSeulement dans pandocfilters-1.4.2-github: .gitignore\nSeulement dans pandocfilters-1.4.2-github: MANIFEST.in\nSeulement dans pandocfilters-1.4.2-github: PACKAGING\nSeulement dans pandocfilters-1.4.2: PKG-INFO\n```\n\nIt's reasonable to use pypi as authoritative source since we want to stay close to a usual pip install. So I updated the instructions in SPKG.txt and reverted to your checksums in #23362.",
    "created_at": "2018-02-09T14:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339175",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:9'></a>I see. Thanks for the feedback!

I had downloaded the tarball from github, according to the instructions in the SPKG.txt, and indeed the two tarballs differ slightly:

```
Seulement dans pandocfilters-1.4.2-github/examples: gabc-score.gabc
Seulement dans pandocfilters-1.4.2-github/examples: lilypond-score.ly
Seulement dans pandocfilters-1.4.2-github: .gitignore
Seulement dans pandocfilters-1.4.2-github: MANIFEST.in
Seulement dans pandocfilters-1.4.2-github: PACKAGING
Seulement dans pandocfilters-1.4.2: PKG-INFO
```

It's reasonable to use pypi as authoritative source since we want to stay close to a usual pip install. So I updated the instructions in SPKG.txt and reverted to your checksums in #23362.



---

archive/issue_comments_339176.json:
```json
{
    "body": "<a id='comment:10'></a>Most likely, the github tarball is just the git repo whereas the file on pypi is the output of `setup.py sdist`.",
    "created_at": "2018-02-09T14:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339176",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>Most likely, the github tarball is just the git repo whereas the file on pypi is the output of `setup.py sdist`.



---

archive/issue_comments_339177.json:
```json
{
    "body": "<a id='comment:12'></a>I'll take care of finishing this up.",
    "created_at": "2018-04-03T12:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339177",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>I'll take care of finishing this up.



---

archive/issue_comments_339178.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-04-03T12:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339178",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_339179.json:
```json
{
    "body": "<a id='comment:13'></a>New commits:",
    "created_at": "2018-04-03T13:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339179",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>New commits:



---

archive/issue_comments_339180.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-03T13:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339180",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_339181.json:
```json
{
    "body": "<a id='comment:14'></a>Rebased to incorporate #23362; added additional missing dependencies bleach, html5lib, and webencodings.\n\nConfirmed that this fixed the issue for me.  I can now export notebooks in various formats.",
    "created_at": "2018-04-03T13:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339181",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Rebased to incorporate #23362; added additional missing dependencies bleach, html5lib, and webencodings.

Confirmed that this fixed the issue for me.  I can now export notebooks in various formats.



---

archive/issue_comments_339182.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-03T14:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339182",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_339183.json:
```json
{
    "body": "<a id='comment:15'></a>Many thanks for the fix!\nI confirmed it works (Ubuntu 16.04); I simply had to install the Ubuntu package `textlive-xetex` to enable the PDF export. \nThere remains the bug reported in #23330, but this is a separate issue (and definitively not a blocker).",
    "created_at": "2018-04-03T14:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339183",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>Many thanks for the fix!
I confirmed it works (Ubuntu 16.04); I simply had to install the Ubuntu package `textlive-xetex` to enable the PDF export. 
There remains the bug reported in #23330, but this is a separate issue (and definitively not a blocker).



---

archive/issue_comments_339184.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-04-07T18:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24484#issuecomment-339184",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061789.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-04-07T18:03:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24484",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24484#event-61789"
}
```
