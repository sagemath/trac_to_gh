# Issue 24152: Bug when converting a Sage polyhedron into Polymake pexpect

archive/issues_023915.json:
```json
{
    "body": "Conversion of a Sage polyhedron into Polymake fails in the first attempt, but succeeds in the second attempt. I've put the example into the first comment rather than in the ticket description.\n\nThe fix is to install the `File::Slurp module` into perl5. This ticket updates the information about prerequisites (and how to install them) in `build/pkg/polymake/SPKG.txt`.\n\n**CC:**  @videlec @mkoeppe @jplab\n\n**Keywords:** polymake, IMA-PolyGeom\n\n**Branch/Commit:** [a9246328ef3f80bca645020f871cfc0835fb605c](https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c)\n\n**Reviewer:** Jean-Philippe Labb\u00e9\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/24152\n\n",
    "closed_at": "2018-05-08T17:27:05Z",
    "created_at": "2017-11-03T14:40:39Z",
    "labels": [
        "component: interfaces: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "title": "Bug when converting a Sage polyhedron into Polymake pexpect",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/24152",
    "user": "https://github.com/simon-king-jena"
}
```
Conversion of a Sage polyhedron into Polymake fails in the first attempt, but succeeds in the second attempt. I've put the example into the first comment rather than in the ticket description.

The fix is to install the `File::Slurp module` into perl5. This ticket updates the information about prerequisites (and how to install them) in `build/pkg/polymake/SPKG.txt`.

**CC:**  @videlec @mkoeppe @jplab

**Keywords:** polymake, IMA-PolyGeom

**Branch/Commit:** [a9246328ef3f80bca645020f871cfc0835fb605c](https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c)

**Reviewer:** Jean-Philippe Labb√©

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/24152





---

archive/issue_comments_367946.json:
```json
{
    "body": "<a id='comment:1'></a>\n\n```\nsage: eqns = [\n....: [-100, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],\n....: [0, -1, 0, 0, 0, 0, -1, 1, 1, 0, 0, 0, 0],\n....: [0, 0, 0, 0, 0, -1, 0, 0, 1, 1, -1, 0, 0],\n....: [0, 0, 0, 0, -1, 0, -1, 1, 0, 1, 0, 0, 0],\n....: [0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 1, 1, -1],\n....: [0, 0, -1, -1, 0, 1, 0, 0, 0, 0, 0, 1, 0],\n....: [0, -1, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 1],\n....: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],\n....: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]\n....: ]\nsage: ieqs = [\n....: [-1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n....: [-1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n....: [-1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n....: [-1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],\n....: [-1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],\n....: [-1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],\n....: [-1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],\n....: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],\n....: [-1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],\n....: [-1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],\n....: [-1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],\n....: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],\n....: [-1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n....: ]\nsage: P = Polyhedron(eqns = eqns, ieqs=ieqs)\nsage: PP = polymake(P)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-a1de8e99de0e> in <module>()\n----> 1 PP = polymake(P)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, x, name)\n    282             return cls(self, x, name=name)\n    283         try:\n--> 284             return self._coerce_from_special_method(x)\n    285         except TypeError:\n    286             raise\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in _coerce_from_special_method(self, x)\n    308             s = '_gp_'\n    309         try:\n--> 310             return (x.__getattribute__(s))(self)\n    311         except AttributeError:\n    312             return self(x._interface_init_())\n\n/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._polymake_ (build/cythonized/sage/structure/sage_object.c:11355)()\n    937             import sage.interfaces.polymake\n    938             G = sage.interfaces.polymake.polymake\n--> 939         return self._interface_(G)\n    940 \n    941     def _polymake_init_(self):\n\n/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6528)()\n    735         init_func = getattr(self, '_%s_init_' % nm, None)\n    736         if init_func is not None:\n--> 737             s = init_func()\n    738         else:\n    739             try:\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in _polymake_init_(self)\n   6204         \"\"\"\n   6205         from sage.interfaces.polymake import polymake\n-> 6206         polymake_field = polymake(self.base_ring().fraction_field())\n   6207         polymake_class = \"Polytope<{}>\".format(polymake_field)\n   6208         if self.is_empty():\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, x, name)\n    282             return cls(self, x, name=name)\n    283         try:\n--> 284             return self._coerce_from_special_method(x)\n    285         except TypeError:\n    286             raise\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in _coerce_from_special_method(self, x)\n    308             s = '_gp_'\n    309         try:\n--> 310             return (x.__getattribute__(s))(self)\n    311         except AttributeError:\n    312             return self(x._interface_init_())\n\n/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._polymake_ (build/cythonized/sage/structure/sage_object.c:11355)()\n    937             import sage.interfaces.polymake\n    938             G = sage.interfaces.polymake.polymake\n--> 939         return self._interface_(G)\n    940 \n    941     def _polymake_init_(self):\n\n/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6726)()\n    741             except Exception:\n    742                 raise NotImplementedError(\"coercion of object %s to %s not implemented:\\n%s\\n%s\" % (repr(self), I))\n--> 743         X = I(s)\n    744         if c:\n    745             try:\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, x, name)\n    280 \n    281         if isinstance(x, string_types):\n--> 282             return cls(self, x, name=name)\n    283         try:\n    284             return self._coerce_from_special_method(x)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)\n   1389             except (RuntimeError, ValueError) as x:\n   1390                 self._session_number = -1\n-> 1391                 raise_(TypeError, x, sys.exc_info()[2])\n   1392             except BaseException:\n   1393                 self._session_number = -1\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)\n   1384         else:\n   1385             try:\n-> 1386                 self._name = parent._create(value, name=name)\n   1387             # Convert ValueError and RuntimeError to TypeError for\n   1388             # coercion to work properly.\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _create(self, value, name)\n    617         \"\"\"\n    618         name = self._next_var_name() if name is None else name\n--> 619         self.set(name, value)\n    620         # If value is a list, then @name is now equal to that list.\n    621         # Otherwise, value is obtained by $name[0]. So, we modify\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in set(self, var, value)\n    706             value = value.strip().rstrip(';').strip()\n    707         cmd = '@%s%s(%s);'%(var,self._assign_symbol(), value)\n--> 708         self.eval(cmd)\n    709 \n    710     def get(self, cmd):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1298                 elif split_lines:\n   1299                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n-> 1300                                         for L in code.split('\\n') if L != ''])\n   1301                 else:\n   1302                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed, **kwds)\n    891         try:\n    892             if not self.is_running():\n--> 893                 self._start()\n    894             E = self._expect\n    895             try:\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _start(self, alt_message)\n    357         self.eval('use Scalar::Util qw(reftype);')\n    358         self.eval('use Scalar::Util qw(blessed);')\n--> 359         self.eval('use File::Slurp;')\n    360 \n    361     def _quit_string(self):\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1298                 elif split_lines:\n   1299                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n-> 1300                                         for L in code.split('\\n') if L != ''])\n   1301                 else:\n   1302                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)\n\n/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed, **kwds)\n   1057             warnings.warn(w, RuntimeWarning)\n   1058         for e in p_errors:\n-> 1059             raise PolymakeError(e)\n   1060         return out\n   1061 \n\nTypeError: Can't locate File/Slurp.pm in @INC (you may need to install the File::Slurp module) (@INC contains: CODE(0x316ca38) /home/king/Sage/git/sage/local/share/polymake/perllib /home/king/Sage/git/sage/local/lib/polymake/perlx/5.22.1/x86_64-linux-gnu-thread-multi /home/king/Sage/git/sage/local/lib/polymake/perlx/5.22.1 /home/king/Sage/git/sage/local/lib/polymake/perlx /home/king/Sage/git/sage/local/lib/perl5/x86_64-linux-gnu-thread-multi /home/king/Sage/git/sage/local/lib/perl5 /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.22.1 /usr/local/share/perl/5.22.1 /usr/lib/x86_64-linux-gnu/perl5/5.22 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.22 /usr/share/perl/5.22 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base .) at input line 1.\nBEGIN failed--compilation aborted at input line 1.\nsage: PP = polymake(P)\nsage: PP.VERTICES\n1 1 1 46/3 1 49/3 46/3 0 49/3 49/3 49/3 0 1\n1 45/2 45/2 1 1 47/2 1 0 47/2 2 2 0 1\n1 45/2 1 1 1 2 1 0 47/2 2 47/2 0 45/2\n1 1 1 1 45/2 2 1 0 2 47/2 47/2 0 45/2\n1 1 45/2 1 45/2 47/2 1 0 2 47/2 2 0 1\nsage: P.vertices_list()\n[[1, 1, 46/3, 1, 49/3, 46/3, 0, 49/3, 49/3, 49/3, 0, 1],\n [45/2, 45/2, 1, 1, 47/2, 1, 0, 47/2, 2, 2, 0, 1],\n [45/2, 1, 1, 1, 2, 1, 0, 47/2, 2, 47/2, 0, 45/2],\n [1, 1, 1, 45/2, 2, 1, 0, 2, 47/2, 47/2, 0, 45/2],\n [1, 45/2, 1, 45/2, 47/2, 1, 0, 2, 47/2, 2, 0, 1]]\nsage: PP.N_LATTICE_POINTS\n1260\nsage: P.integral_points_count()\n1260\n```\nNote that a user reported that the above point count is incorrect in Sage, that's why I tested what polymake has to say (and find that it agrees with Sage).\n\nSo, the bug is that the first attempt of converting P fails, while the second attempt succeeds.",
    "created_at": "2017-11-03T14:42:50Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367946",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>

```
sage: eqns = [
....: [-100, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
....: [0, -1, 0, 0, 0, 0, -1, 1, 1, 0, 0, 0, 0],
....: [0, 0, 0, 0, 0, -1, 0, 0, 1, 1, -1, 0, 0],
....: [0, 0, 0, 0, -1, 0, -1, 1, 0, 1, 0, 0, 0],
....: [0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 1, 1, -1],
....: [0, 0, -1, -1, 0, 1, 0, 0, 0, 0, 0, 1, 0],
....: [0, -1, 1, 0, -1, 0, 0, 0, 0, 0, 0, 0, 1],
....: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
....: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0]
....: ]
sage: ieqs = [
....: [-1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
....: [-1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
....: [-1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
....: [-1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0],
....: [-1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
....: [-1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
....: [-1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],
....: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],
....: [-1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
....: [-1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],
....: [-1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],
....: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0],
....: [-1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
....: ]
sage: P = Polyhedron(eqns = eqns, ieqs=ieqs)
sage: PP = polymake(P)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-a1de8e99de0e> in <module>()
----> 1 PP = polymake(P)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, x, name)
    282             return cls(self, x, name=name)
    283         try:
--> 284             return self._coerce_from_special_method(x)
    285         except TypeError:
    286             raise

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in _coerce_from_special_method(self, x)
    308             s = '_gp_'
    309         try:
--> 310             return (x.__getattribute__(s))(self)
    311         except AttributeError:
    312             return self(x._interface_init_())

/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._polymake_ (build/cythonized/sage/structure/sage_object.c:11355)()
    937             import sage.interfaces.polymake
    938             G = sage.interfaces.polymake.polymake
--> 939         return self._interface_(G)
    940 
    941     def _polymake_init_(self):

/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6528)()
    735         init_func = getattr(self, '_%s_init_' % nm, None)
    736         if init_func is not None:
--> 737             s = init_func()
    738         else:
    739             try:

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/geometry/polyhedron/base.pyc in _polymake_init_(self)
   6204         """
   6205         from sage.interfaces.polymake import polymake
-> 6206         polymake_field = polymake(self.base_ring().fraction_field())
   6207         polymake_class = "Polytope<{}>".format(polymake_field)
   6208         if self.is_empty():

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, x, name)
    282             return cls(self, x, name=name)
    283         try:
--> 284             return self._coerce_from_special_method(x)
    285         except TypeError:
    286             raise

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in _coerce_from_special_method(self, x)
    308             s = '_gp_'
    309         try:
--> 310             return (x.__getattribute__(s))(self)
    311         except AttributeError:
    312             return self(x._interface_init_())

/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._polymake_ (build/cythonized/sage/structure/sage_object.c:11355)()
    937             import sage.interfaces.polymake
    938             G = sage.interfaces.polymake.polymake
--> 939         return self._interface_(G)
    940 
    941     def _polymake_init_(self):

/home/king/Sage/git/sage/src/sage/structure/sage_object.pyx in sage.structure.sage_object.SageObject._interface_ (build/cythonized/sage/structure/sage_object.c:6726)()
    741             except Exception:
    742                 raise NotImplementedError("coercion of object %s to %s not implemented:\n%s\n%s" % (repr(self), I))
--> 743         X = I(s)
    744         if c:
    745             try:

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/interface.pyc in __call__(self, x, name)
    280 
    281         if isinstance(x, string_types):
--> 282             return cls(self, x, name=name)
    283         try:
    284             return self._coerce_from_special_method(x)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)
   1389             except (RuntimeError, ValueError) as x:
   1390                 self._session_number = -1
-> 1391                 raise_(TypeError, x, sys.exc_info()[2])
   1392             except BaseException:
   1393                 self._session_number = -1

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in __init__(self, parent, value, is_name, name)
   1384         else:
   1385             try:
-> 1386                 self._name = parent._create(value, name=name)
   1387             # Convert ValueError and RuntimeError to TypeError for
   1388             # coercion to work properly.

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _create(self, value, name)
    617         """
    618         name = self._next_var_name() if name is None else name
--> 619         self.set(name, value)
    620         # If value is a list, then @name is now equal to that list.
    621         # Otherwise, value is obtained by $name[0]. So, we modify

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in set(self, var, value)
    706             value = value.strip().rstrip(';').strip()
    707         cmd = '@%s%s(%s);'%(var,self._assign_symbol(), value)
--> 708         self.eval(cmd)
    709 
    710     def get(self, cmd):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1298                 elif split_lines:
   1299                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
-> 1300                                         for L in code.split('\n') if L != ''])
   1301                 else:
   1302                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed, **kwds)
    891         try:
    892             if not self.is_running():
--> 893                 self._start()
    894             E = self._expect
    895             try:

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _start(self, alt_message)
    357         self.eval('use Scalar::Util qw(reftype);')
    358         self.eval('use Scalar::Util qw(blessed);')
--> 359         self.eval('use File::Slurp;')
    360 
    361     def _quit_string(self):

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1298                 elif split_lines:
   1299                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)
-> 1300                                         for L in code.split('\n') if L != ''])
   1301                 else:
   1302                     return self._eval_line(code, allow_use_file=allow_use_file, **kwds)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/interfaces/polymake.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt, restart_if_needed, **kwds)
   1057             warnings.warn(w, RuntimeWarning)
   1058         for e in p_errors:
-> 1059             raise PolymakeError(e)
   1060         return out
   1061 

TypeError: Can't locate File/Slurp.pm in @INC (you may need to install the File::Slurp module) (@INC contains: CODE(0x316ca38) /home/king/Sage/git/sage/local/share/polymake/perllib /home/king/Sage/git/sage/local/lib/polymake/perlx/5.22.1/x86_64-linux-gnu-thread-multi /home/king/Sage/git/sage/local/lib/polymake/perlx/5.22.1 /home/king/Sage/git/sage/local/lib/polymake/perlx /home/king/Sage/git/sage/local/lib/perl5/x86_64-linux-gnu-thread-multi /home/king/Sage/git/sage/local/lib/perl5 /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.22.1 /usr/local/share/perl/5.22.1 /usr/lib/x86_64-linux-gnu/perl5/5.22 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.22 /usr/share/perl/5.22 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base .) at input line 1.
BEGIN failed--compilation aborted at input line 1.
sage: PP = polymake(P)
sage: PP.VERTICES
1 1 1 46/3 1 49/3 46/3 0 49/3 49/3 49/3 0 1
1 45/2 45/2 1 1 47/2 1 0 47/2 2 2 0 1
1 45/2 1 1 1 2 1 0 47/2 2 47/2 0 45/2
1 1 1 1 45/2 2 1 0 2 47/2 47/2 0 45/2
1 1 45/2 1 45/2 47/2 1 0 2 47/2 2 0 1
sage: P.vertices_list()
[[1, 1, 46/3, 1, 49/3, 46/3, 0, 49/3, 49/3, 49/3, 0, 1],
 [45/2, 45/2, 1, 1, 47/2, 1, 0, 47/2, 2, 2, 0, 1],
 [45/2, 1, 1, 1, 2, 1, 0, 47/2, 2, 47/2, 0, 45/2],
 [1, 1, 1, 45/2, 2, 1, 0, 2, 47/2, 47/2, 0, 45/2],
 [1, 45/2, 1, 45/2, 47/2, 1, 0, 2, 47/2, 2, 0, 1]]
sage: PP.N_LATTICE_POINTS
1260
sage: P.integral_points_count()
1260
```
Note that a user reported that the above point count is incorrect in Sage, that's why I tested what polymake has to say (and find that it agrees with Sage).

So, the bug is that the first attempt of converting P fails, while the second attempt succeeds.



---

archive/issue_comments_367947.json:
```json
{
    "body": "<a id='comment:2'></a>\nWhat does `self.eval('use File::Slurp;')` mean?\n\n`git blame` tells me that the line was introduced by Matthias, so CCing him.",
    "created_at": "2017-11-03T14:49:47Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367947",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
What does `self.eval('use File::Slurp;')` mean?

`git blame` tells me that the line was introduced by Matthias, so CCing him.



---

archive/issue_comments_367948.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt's loading a Perl package. http://search.cpan.org/~uri/File-Slurp-9999.19/lib/File/Slurp.pm\n\nWe need it for stuff passed by file.\n\nSage does not control the Perl installation. \nShould perhaps add a line to the polymake SPKG.txt to alert the user that this package needs to be installed (in addition to a few others that are already listed).",
    "created_at": "2017-11-04T00:42:48Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367948",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
It's loading a Perl package. http://search.cpan.org/~uri/File-Slurp-9999.19/lib/File/Slurp.pm

We need it for stuff passed by file.

Sage does not control the Perl installation. 
Should perhaps add a line to the polymake SPKG.txt to alert the user that this package needs to be installed (in addition to a few others that are already listed).



---

archive/issue_comments_367949.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [mkoeppe](#comment%3A3):\n> Sage does not control the Perl installation. \n> Should perhaps add a line to the polymake SPKG.txt to alert the user that this package needs to be installed (in addition to a few others that are already listed).\n\n... and HOW it can be installed. The search \"perl install slurp\" doesn't give me immediate answer.",
    "created_at": "2017-11-04T07:52:38Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367949",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>
Replying to [mkoeppe](#comment%3A3):
> Sage does not control the Perl installation. 
> Should perhaps add a line to the polymake SPKG.txt to alert the user that this package needs to be installed (in addition to a few others that are already listed).

... and HOW it can be installed. The search "perl install slurp" doesn't give me immediate answer.



---

archive/issue_comments_367950.json:
```json
{
    "body": "<a id='comment:5'></a>\n1. I did `sudo apt-get install libperl6-slurp-perl` which I think is supposed to install the slurp module on ubuntu.\n2. The example from [comment:1](#comment%3A1) doesn't work after installing slurp: Polymake still cannot find slurp.\n3. So, we should tell the user how to install slurp AND how to make polymake aware of it.\n4. All that still doesn't explain why the example fails once and then just works. Apparently the interface can do without slurp, but doesn't.",
    "created_at": "2017-11-04T08:00:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367950",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
1. I did `sudo apt-get install libperl6-slurp-perl` which I think is supposed to install the slurp module on ubuntu.
2. The example from [comment:1](#comment%3A1) doesn't work after installing slurp: Polymake still cannot find slurp.
3. So, we should tell the user how to install slurp AND how to make polymake aware of it.
4. All that still doesn't explain why the example fails once and then just works. Apparently the interface can do without slurp, but doesn't.



---

archive/issue_comments_367951.json:
```json
{
    "body": "<a id='comment:6'></a>\nPolymake uses Perl5, not 6.",
    "created_at": "2017-11-04T11:47:12Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367951",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Polymake uses Perl5, not 6.



---

archive/issue_comments_367952.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A6):\n> Polymake uses Perl5, not 6.\n\nWhich makes me repeat the question: How to install the slurp module?\n\n```\n$ apt-cache search perl slurp\nhobbit-plugins - plugins for the Xymon network monitor\nlibdbix-simple-perl - Perl module implementing an simpler interface to DBI\nlibfile-policy-perl - Simple policy for file I/O functions\nlibfile-read-perl - interface for reading one or more files\nlibfile-slurp-perl - single call read & write file routines\nlibfile-slurp-tiny-perl - simple, sane and efficient file slurper\nlibfile-slurp-unicode-perl - Perl module to add Unicode support for the File::Slurp package\nlibfile-slurper-perl - simple, sane and efficient module to slurp a file\nlibperl6-slurp-perl - module implementing the Perl 6 'slurp' built-in\nlibtext-clip-perl - module to clip and extract text in clipboard-like way\n```\nWhich of the above do I need to install? Hint: It isn't libfile-slurper-perl either.",
    "created_at": "2017-11-04T18:27:23Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367952",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A6):
> Polymake uses Perl5, not 6.

Which makes me repeat the question: How to install the slurp module?

```
$ apt-cache search perl slurp
hobbit-plugins - plugins for the Xymon network monitor
libdbix-simple-perl - Perl module implementing an simpler interface to DBI
libfile-policy-perl - Simple policy for file I/O functions
libfile-read-perl - interface for reading one or more files
libfile-slurp-perl - single call read & write file routines
libfile-slurp-tiny-perl - simple, sane and efficient file slurper
libfile-slurp-unicode-perl - Perl module to add Unicode support for the File::Slurp package
libfile-slurper-perl - simple, sane and efficient module to slurp a file
libperl6-slurp-perl - module implementing the Perl 6 'slurp' built-in
libtext-clip-perl - module to clip and extract text in clipboard-like way
```
Which of the above do I need to install? Hint: It isn't libfile-slurper-perl either.



---

archive/issue_comments_367953.json:
```json
{
    "body": "<a id='comment:8'></a>\n`sudo apt-get install libfile-read-perl` seems to do the trick. Afterwards, I get\n\n```\nsage: polymake(Polyhedron(eqns = eqns, ieqs=ieqs))\nPolytope<Rational>[SAGE271]\nsage: _.N_INTERIOR_LATTICE_POINTS\n952\nsage: __.N_LATTICE_POINTS\n1260\n```\n\nAnyway.\n\nI find it not good that the polymake interface depends on a specific perl module upon which polymake itself does not depend.\n\nIs it really not possible to provide the same functionality (perhaps slower) if slurp is not installed? If there is a way around slurp then that should be used as a fallback.\n\nAnd if there is no way around slurp, then the polymake interface should complain about it right in the beginning, giving specific advice on how to install slurp, alerting the user that (s)he has to take care about perl5, not perl6, and so on.",
    "created_at": "2017-11-04T18:37:53Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367953",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
`sudo apt-get install libfile-read-perl` seems to do the trick. Afterwards, I get

```
sage: polymake(Polyhedron(eqns = eqns, ieqs=ieqs))
Polytope<Rational>[SAGE271]
sage: _.N_INTERIOR_LATTICE_POINTS
952
sage: __.N_LATTICE_POINTS
1260
```

Anyway.

I find it not good that the polymake interface depends on a specific perl module upon which polymake itself does not depend.

Is it really not possible to provide the same functionality (perhaps slower) if slurp is not installed? If there is a way around slurp then that should be used as a fallback.

And if there is no way around slurp, then the polymake interface should complain about it right in the beginning, giving specific advice on how to install slurp, alerting the user that (s)he has to take care about perl5, not perl6, and so on.



---

archive/issue_comments_367954.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n Conversion of a Sage polyhedron into Polymake fails in the first attempt, but succeeds in the second attempt. I've put the example into the first comment rather than in the ticket description.\n \n+As it turns out (see comments), the problem can be prevented by installing the slurp module into perl5. However, I think an interface to polymake shouldn't have more perl dependencies than polymake itself. Moreover, it may not be immediately clear to all users (e.g, to me) how to install slurp, and why slurp-for-perl6 won't be good enough.\n``````\n",
    "created_at": "2017-11-04T18:46:54Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367954",
    "user": "https://github.com/simon-king-jena"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 Conversion of a Sage polyhedron into Polymake fails in the first attempt, but succeeds in the second attempt. I've put the example into the first comment rather than in the ticket description.
 
+As it turns out (see comments), the problem can be prevented by installing the slurp module into perl5. However, I think an interface to polymake shouldn't have more perl dependencies than polymake itself. Moreover, it may not be immediately clear to all users (e.g, to me) how to install slurp, and why slurp-for-perl6 won't be good enough.
``````




---

archive/issue_comments_367955.json:
```json
{
    "body": "<a id='comment:10'></a>\nI'd guess (but haven't tested because I am not on Ubuntu) that it would simply be `libfile-slurp-perl`. The one that you picked probably installs it as a dependency.\n\nThe distribution-independent way of installing Perl packages, of course, is using CPAN. \n\nSpecific error handling for failure to load `File::Slurp` is a good idea.\n\nOne could, of course, provide a simplified version of `read_file` directly, instead of requiring `File::Slurp`. But I don't think it's worth it.",
    "created_at": "2017-11-05T01:57:15Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367955",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
I'd guess (but haven't tested because I am not on Ubuntu) that it would simply be `libfile-slurp-perl`. The one that you picked probably installs it as a dependency.

The distribution-independent way of installing Perl packages, of course, is using CPAN. 

Specific error handling for failure to load `File::Slurp` is a good idea.

One could, of course, provide a simplified version of `read_file` directly, instead of requiring `File::Slurp`. But I don't think it's worth it.



---

archive/issue_comments_367956.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect)",
    "created_at": "2018-03-24T23:17:29Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367956",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect)



---

archive/issue_events_214532.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-03-24T23:21:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214532"
}
```



---

archive/issue_comments_367957.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n Conversion of a Sage polyhedron into Polymake fails in the first attempt, but succeeds in the second attempt. I've put the example into the first comment rather than in the ticket description.\n \n-As it turns out (see comments), the problem can be prevented by installing the slurp module into perl5. However, I think an interface to polymake shouldn't have more perl dependencies than polymake itself. Moreover, it may not be immediately clear to all users (e.g, to me) how to install slurp, and why slurp-for-perl6 won't be good enough.\n+The fix is to install the `File::Slurp module` into perl5. This ticket updates the information about prerequisites (and how to install them) in `build/pkg/polymake/SPKG.txt`.\n``````\n",
    "created_at": "2018-03-24T23:21:36Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367957",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 Conversion of a Sage polyhedron into Polymake fails in the first attempt, but succeeds in the second attempt. I've put the example into the first comment rather than in the ticket description.
 
-As it turns out (see comments), the problem can be prevented by installing the slurp module into perl5. However, I think an interface to polymake shouldn't have more perl dependencies than polymake itself. Moreover, it may not be immediately clear to all users (e.g, to me) how to install slurp, and why slurp-for-perl6 won't be good enough.
+The fix is to install the `File::Slurp module` into perl5. This ticket updates the information about prerequisites (and how to install them) in `build/pkg/polymake/SPKG.txt`.
``````




---

archive/issue_comments_367958.json:
```json
{
    "body": "**Commit:** [a9246328ef3f80bca645020f871cfc0835fb605c](https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c)",
    "created_at": "2018-03-24T23:21:36Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367958",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [a9246328ef3f80bca645020f871cfc0835fb605c](https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c)



---

archive/issue_comments_367959.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2018-03-24T23:21:36Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367959",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_367960.json:
```json
{
    "body": "<a id='comment:12'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c\">a924632</a></td><td><code>polymake SPKG.txt: Mention File::Slurp and CPAN</code></td></tr></table>\n",
    "created_at": "2018-03-24T23:21:36Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367960",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c">a924632</a></td><td><code>polymake SPKG.txt: Mention File::Slurp and CPAN</code></td></tr></table>




---

archive/issue_events_214533.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-03-24T23:21:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214533"
}
```



---

archive/issue_events_214534.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-03-24T23:21:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214534"
}
```



---

archive/issue_comments_367961.json:
```json
{
    "body": "<a id='comment:13'></a>\nNeeds review and fixes the problem reported by jipilab on #24905.",
    "created_at": "2018-04-08T16:11:45Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367961",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Needs review and fixes the problem reported by jipilab on #24905.



---

archive/issue_events_214535.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-08T18:17:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214535"
}
```



---

archive/issue_events_214536.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2018-04-08T18:17:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214536"
}
```



---

archive/issue_comments_367962.json:
```json
{
    "body": "**Reviewer:** Jean-Philippe Labb\u00e9",
    "created_at": "2018-04-08T18:17:18Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367962",
    "user": "https://github.com/jplab"
}
```

**Reviewer:** Jean-Philippe Labb√©



---

archive/issue_comments_367963.json:
```json
{
    "body": "<a id='comment:14'></a>\nThis solved the problem raised in #24905 and the above failing example works as well on my computer. This looks good to go.",
    "created_at": "2018-04-08T18:17:18Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367963",
    "user": "https://github.com/jplab"
}
```

<a id='comment:14'></a>
This solved the problem raised in #24905 and the above failing example works as well on my computer. This looks good to go.



---

archive/issue_comments_367964.json:
```json
{
    "body": "**Changing keywords** from \"polymake\" to \"polymake, IMA-PolyGeom\".",
    "created_at": "2018-04-08T21:24:32Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367964",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "polymake" to "polymake, IMA-PolyGeom".



---

archive/issue_events_214537.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214537"
}
```



---

archive/issue_events_214538.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "14669b2e4286c191896fd59c7f2d2e71c4bf5b92",
    "created_at": "2018-05-08T17:27:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24152#event-214538"
}
```



---

archive/issue_comments_367965.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect)\" to \"[a9246328ef3f80bca645020f871cfc0835fb605c](https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c)\".",
    "created_at": "2018-05-08T17:27:05Z",
    "issue": "https://github.com/sagemath/sage/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24152#issuecomment-367965",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/bug_when_converting_a_sage_polyhedron_into_polymake_pexpect)" to "[a9246328ef3f80bca645020f871cfc0835fb605c](https://github.com/sagemath/sagetrac-mirror/commit/a9246328ef3f80bca645020f871cfc0835fb605c)".
