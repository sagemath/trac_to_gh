# Issue 24752: py3: unhandled exception in pynac

archive/issues_024515.json:
```json
{
    "body": "There are several bugs like:\n\n```\nsage: arccoth(float(1.1))\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\nAttributeError: type object 'float' has no attribute 'precision'\n\nThe above exception was the direct cause of the following exception:\n\nSystemError                               Traceback (most recent call last)\n<ipython-input-1-96f50dbce315> in <module>()\n----> 1 arccoth(float(RealNumber('1.1')))\n\n/home/embray/src/sagemath/sage-python3/local/lib/python3.6/site-packages/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11828)()\n    993             res = self._evalf_try_(*args)\n    994             if res is None:\n--> 995                 res = super(BuiltinFunction, self).__call__(\n    996                         *args, coerce=coerce, hold=hold)\n    997\n\n/home/embray/src/sagemath/sage-python3/local/lib/python3.6/site-packages/sage/symbolic/function.pyx in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6847)()\n    487             res = g_function_evalv(self._serial, vec, hold)\n    488         elif self._nargs == 1:\n--> 489             res = g_function_eval1(self._serial,\n    490                     (<Expression>args[0])._gobj, hold)\n    491         elif self._nargs == 2:\n\nSystemError: <built-in function __import__> returned a result with an error set\n```\n\nThis is due to an unhandled exception elsewhere in `numeric.cpp`.  This is a problem on Python 2 as well, but by luck the exception is cleared later before it becomes a problem (whereas Python 3 is more aggressive in checking for unhandled exceptions when going into a function call).\n\nUpstream PR: https://github.com/pynac/pynac/pull/307\n\n**CC:**  @rwst\n\n**Keywords:** pynac\n\n**Upstream:** Fixed upstream, in a later stable release.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24752\n\n",
    "closed_at": "2018-07-10T11:41:40Z",
    "created_at": "2018-02-16T13:47:54Z",
    "labels": [
        "component: python3",
        "bug",
        "worksforme",
        "invalid"
    ],
    "title": "py3: unhandled exception in pynac",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24752",
    "user": "https://github.com/embray"
}
```
There are several bugs like:

```
sage: arccoth(float(1.1))
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
AttributeError: type object 'float' has no attribute 'precision'

The above exception was the direct cause of the following exception:

SystemError                               Traceback (most recent call last)
<ipython-input-1-96f50dbce315> in <module>()
----> 1 arccoth(float(RealNumber('1.1')))

/home/embray/src/sagemath/sage-python3/local/lib/python3.6/site-packages/sage/symbolic/function.pyx in sage.symbolic.function.BuiltinFunction.__call__ (build/cythonized/sage/symbolic/function.cpp:11828)()
    993             res = self._evalf_try_(*args)
    994             if res is None:
--> 995                 res = super(BuiltinFunction, self).__call__(
    996                         *args, coerce=coerce, hold=hold)
    997

/home/embray/src/sagemath/sage-python3/local/lib/python3.6/site-packages/sage/symbolic/function.pyx in sage.symbolic.function.Function.__call__ (build/cythonized/sage/symbolic/function.cpp:6847)()
    487             res = g_function_evalv(self._serial, vec, hold)
    488         elif self._nargs == 1:
--> 489             res = g_function_eval1(self._serial,
    490                     (<Expression>args[0])._gobj, hold)
    491         elif self._nargs == 2:

SystemError: <built-in function __import__> returned a result with an error set
```

This is due to an unhandled exception elsewhere in `numeric.cpp`.  This is a problem on Python 2 as well, but by luck the exception is cleared later before it becomes a problem (whereas Python 3 is more aggressive in checking for unhandled exceptions when going into a function call).

Upstream PR: https://github.com/pynac/pynac/pull/307

**CC:**  @rwst

**Keywords:** pynac

**Upstream:** Fixed upstream, in a later stable release.

Issue created by migration from https://trac.sagemath.org/ticket/24752





---

archive/issue_comments_380476.json:
```json
{
    "body": "<a id='comment:1'></a>\nTypically, pynac releases quickly after a bug-fix so we should wait for that.",
    "created_at": "2018-02-16T14:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380476",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Typically, pynac releases quickly after a bug-fix so we should wait for that.



---

archive/issue_comments_380477.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2018-02-16T14:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380477",
    "user": "https://github.com/jdemeyer"
}
```

**Changing upstream** from "N/A" to "Reported upstream. No feedback yet.".



---

archive/issue_comments_380478.json:
```json
{
    "body": "<a id='comment:2'></a>\nI know, but it's still worth noting that this issue can be changed after the next pynac upgrade.",
    "created_at": "2018-02-16T14:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380478",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
I know, but it's still worth noting that this issue can be changed after the next pynac upgrade.



---

archive/issue_comments_380479.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\".",
    "created_at": "2018-02-16T14:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380479",
    "user": "https://github.com/embray"
}
```

**Changing upstream** from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release.".



---

archive/issue_comments_380480.json:
```json
{
    "body": "**Dependencies:** #24745",
    "created_at": "2018-02-16T14:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380480",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #24745



---

archive/issue_comments_380481.json:
```json
{
    "body": "<a id='comment:4'></a>\nI believe the pynac update in #24745 will resolve several other Python 3 issues I've already fixed, but I guess not this one?",
    "created_at": "2018-02-16T16:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380481",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
I believe the pynac update in #24745 will resolve several other Python 3 issues I've already fixed, but I guess not this one?



---

archive/issue_comments_380482.json:
```json
{
    "body": "<a id='comment:5'></a>\nYes, that one is completely different.\n\nUsually we use bug report tickets that are fixed in Pynac for adding doctests but, since it came from a doctest, it's practically a duplicate of a yet-to-be-opened Pynac upgrade ticket. Alternatively, you could add your PR as patch here. The Pynac upgrade will then just remove it.",
    "created_at": "2018-02-17T06:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380482",
    "user": "https://github.com/rwst"
}
```

<a id='comment:5'></a>
Yes, that one is completely different.

Usually we use bug report tickets that are fixed in Pynac for adding doctests but, since it came from a doctest, it's practically a duplicate of a yet-to-be-opened Pynac upgrade ticket. Alternatively, you could add your PR as patch here. The Pynac upgrade will then just remove it.



---

archive/issue_events_223449.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223449"
}
```



---

archive/issue_events_223450.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223450"
}
```



---

archive/issue_comments_380483.json:
```json
{
    "body": "**Changing upstream** from \"Fixed upstream, but not in a stable release.\" to \"Fixed upstream, in a later stable release.\".",
    "created_at": "2018-05-18T19:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380483",
    "user": "https://github.com/fchapoton"
}
```

**Changing upstream** from "Fixed upstream, but not in a stable release." to "Fixed upstream, in a later stable release.".



---

archive/issue_comments_380484.json:
```json
{
    "body": "**Changing dependencies** from \"#24745\" to \"\".",
    "created_at": "2018-05-18T19:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380484",
    "user": "https://github.com/fchapoton"
}
```

**Changing dependencies** from "#24745" to "".



---

archive/issue_events_223451.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-04T07:39:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223451"
}
```



---

archive/issue_events_223452.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-04T07:39:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223452"
}
```



---

archive/issue_events_223453.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-04T07:39:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223453"
}
```



---

archive/issue_comments_380485.json:
```json
{
    "body": "<a id='comment:8'></a>\nthis should be closed now, please",
    "created_at": "2018-07-04T07:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380485",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
this should be closed now, please



---

archive/issue_events_223454.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-04T08:02:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223454"
}
```



---

archive/issue_events_223455.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-04T08:02:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223455"
}
```



---

archive/issue_events_223456.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-04T16:38:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "worksforme",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223456"
}
```



---

archive/issue_events_223457.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-04T16:38:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223457"
}
```



---

archive/issue_events_223458.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-04T16:38:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223458"
}
```



---

archive/issue_events_223459.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-04T16:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "worksforme",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223459"
}
```



---

archive/issue_events_223460.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-04T16:40:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223460"
}
```



---

archive/issue_comments_380486.json:
```json
{
    "body": "<a id='comment:12'></a>\nHas there been another update to the minimal pynac version in Sage?  Because if not then I'm not sure we can call this fixed (and if so please note the relevant ticket).",
    "created_at": "2018-07-04T16:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380486",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
Has there been another update to the minimal pynac version in Sage?  Because if not then I'm not sure we can call this fixed (and if so please note the relevant ticket).



---

archive/issue_comments_380487.json:
```json
{
    "body": "<a id='comment:13'></a>\nTrac #24838 ?",
    "created_at": "2018-07-04T17:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380487",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
Trac #24838 ?



---

archive/issue_comments_380488.json:
```json
{
    "body": "<a id='comment:14'></a>\nping ?",
    "created_at": "2018-07-09T09:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380488",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
ping ?



---

archive/issue_comments_380489.json:
```json
{
    "body": "<a id='comment:15'></a>\nYes, the PR listed in the description was merged with #24838.",
    "created_at": "2018-07-09T12:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380489",
    "user": "https://github.com/rwst"
}
```

<a id='comment:15'></a>
Yes, the PR listed in the description was merged with #24838.



---

archive/issue_events_223461.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-07-09T12:40:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223461"
}
```



---

archive/issue_events_223462.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-07-09T12:40:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223462"
}
```



---

archive/issue_events_223463.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-10T11:41:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "worksforme",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223463"
}
```



---

archive/issue_comments_380490.json:
```json
{
    "body": "<a id='comment:16'></a>\nGreat, thanks.",
    "created_at": "2018-07-10T11:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24752#issuecomment-380490",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Great, thanks.



---

archive/issue_events_223464.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-10T11:41:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223464"
}
```



---

archive/issue_events_223465.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-10T11:41:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24752",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24752#event-223465"
}
```
