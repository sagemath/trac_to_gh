# Issue 24491: sdh_configure should use bash

archive/issues_024254.json:
```json
{
    "body": "Some `configure` scripts are buggy when they are run with shells other than `bash`. See #23451 for example. Since Sage requires `bash` anyway, we can easily work around this by forcing `bash` to run `configure`.\n\nCC:  @embray @dimpase\n\nReviewer: Dima Pasechnik\n\nAuthor: Jeroen Demeyer\n\nBranch: f0e2bd8e9eb4712490d355e56ae57af3947ff661\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24491\n\n",
    "closed_at": "2018-01-14T10:14:05Z",
    "created_at": "2018-01-08T14:28:01Z",
    "labels": [
        "component: porting"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "sdh_configure should use bash",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24491",
    "user": "https://github.com/jdemeyer"
}
```
Some `configure` scripts are buggy when they are run with shells other than `bash`. See #23451 for example. Since Sage requires `bash` anyway, we can easily work around this by forcing `bash` to run `configure`.

CC:  @embray @dimpase

Reviewer: Dima Pasechnik

Author: Jeroen Demeyer

Branch: f0e2bd8e9eb4712490d355e56ae57af3947ff661

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24491





---

archive/issue_comments_339245.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-08T14:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339245",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_339246.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-01-08T14:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339246",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_339247.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-08T15:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339247",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339248.json:
```json
{
    "body": "<a id='comment:3'></a>This doesn't actually work due to way how `configure` works.",
    "created_at": "2018-01-08T15:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339248",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>This doesn't actually work due to way how `configure` works.



---

archive/issue_comments_339249.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-08T15:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339249",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339250.json:
```json
{
    "body": "<a id='comment:5'></a>Shouldn't\n\n```\nexport CONFIG_SHELL=\"$SHELL\"\n```\nrather be\n\n```\nexport CONFIG_SHELL=`command -v bash`\n```",
    "created_at": "2018-01-08T15:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339250",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>Shouldn't

```
export CONFIG_SHELL="$SHELL"
```
rather be

```
export CONFIG_SHELL=`command -v bash`
```



---

archive/issue_comments_339251.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-08T15:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339251",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339252.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 dimpase]:\n> Shouldn't\n> \n> ```\n> export CONFIG_SHELL=\"$SHELL\"\n> ```\n> rather be\n> \n> ```\n> export CONFIG_SHELL=`command -v bash`\n> ```\n\n\nGiven that `$SHELL` is `bash`, no it should not.",
    "created_at": "2018-01-08T15:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339252",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:5 dimpase]:
> Shouldn't
> 
> ```
> export CONFIG_SHELL="$SHELL"
> ```
> rather be
> 
> ```
> export CONFIG_SHELL=`command -v bash`
> ```


Given that `$SHELL` is `bash`, no it should not.



---

archive/issue_comments_339253.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 jdemeyer]:\n> Replying to [comment:5 dimpase]:\n> > Shouldn't\n> > \n> > ```\n> > export CONFIG_SHELL=\"$SHELL\"\n> > ```\n> > rather be\n> > \n> > ```\n> > export CONFIG_SHELL=`command -v bash`\n> > ```\n\n> \n> Given that `$SHELL` is `bash`, no it should not.\n\n\nWhy would $SHELL always be bash? E.g. in the context of #23451 it can be dash, no?",
    "created_at": "2018-01-08T16:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339253",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>Replying to [comment:7 jdemeyer]:
> Replying to [comment:5 dimpase]:
> > Shouldn't
> > 
> > ```
> > export CONFIG_SHELL="$SHELL"
> > ```
> > rather be
> > 
> > ```
> > export CONFIG_SHELL=`command -v bash`
> > ```

> 
> Given that `$SHELL` is `bash`, no it should not.


Why would $SHELL always be bash? E.g. in the context of #23451 it can be dash, no?



---

archive/issue_comments_339254.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 dimpase]:\n> Why would $SHELL always be bash?\n\n\nBecause the Sage build scripts are always run with `bash`.",
    "created_at": "2018-01-08T16:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339254",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:8 dimpase]:
> Why would $SHELL always be bash?


Because the Sage build scripts are always run with `bash`.



---

archive/issue_comments_339255.json:
```json
{
    "body": "<a id='comment:10'></a>Are there any other packages with non-portable configure scripts, other than the two mentioned in #23451? I think I was able to build all of sage using dash 0.5.9 with only those two \"fixed\".\n\nUsing `/bin/sh` when possible is a way to give extra testing to configure scripts, which are meant to ensure portability of software. Sage packages some mathematical software that is not included in distros, so they won't get exposure to diverse environments otherwise.\n\nAlso, a script that works with several different shells is a script that is less likely to break when bash changes, or with older versions of bash, etc.\n\n---\n\nAnyway, maybe it is a good idea to do\n\n```\nif [ -z \"$CONFIG_SHELL\" ]; then\n    export CONFIG_SHELL=\"$SHELL\"\nfi\n```\nto allow overriding of `$CONFIG_SHELL` ?",
    "created_at": "2018-01-08T16:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339255",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:10'></a>Are there any other packages with non-portable configure scripts, other than the two mentioned in #23451? I think I was able to build all of sage using dash 0.5.9 with only those two "fixed".

Using `/bin/sh` when possible is a way to give extra testing to configure scripts, which are meant to ensure portability of software. Sage packages some mathematical software that is not included in distros, so they won't get exposure to diverse environments otherwise.

Also, a script that works with several different shells is a script that is less likely to break when bash changes, or with older versions of bash, etc.

---

Anyway, maybe it is a good idea to do

```
if [ -z "$CONFIG_SHELL" ]; then
    export CONFIG_SHELL="$SHELL"
fi
```
to allow overriding of `$CONFIG_SHELL` ?



---

archive/issue_comments_339256.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:\n> Replying to [comment:8 dimpase]:\n> > Why would $SHELL always be bash?\n\n> \n> Because the Sage build scripts are always run with `bash`.\n\nI don't know what you exactly mean.\nJust check the 1st line of the top `./configure`. There is no `bash` there.",
    "created_at": "2018-01-08T16:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339256",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:
> Replying to [comment:8 dimpase]:
> > Why would $SHELL always be bash?

> 
> Because the Sage build scripts are always run with `bash`.

I don't know what you exactly mean.
Just check the 1st line of the top `./configure`. There is no `bash` there.



---

archive/issue_comments_339257.json:
```json
{
    "body": "<a id='comment:12'></a>Some autotool scripts will also break if you use `CONFIG_SHELL=bash` I don't know if there are any in sage but I have experienced it. Real autotool script usually expect `sh` but a lot of the time you are lucky and can use bash (gcc is a case in point). \n\nMy experience comes from AIX where `sh` is a real separate program rather than bash or dash called with a special profile. AIX's sh is so slow that it will take several days to compile gcc if you don't use `CONFIG_SHELL=bash`. In that light it is tempting to use bash all the time, until things starts to fail left and right in some libtool scripts later on.",
    "created_at": "2018-01-08T18:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339257",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>Some autotool scripts will also break if you use `CONFIG_SHELL=bash` I don't know if there are any in sage but I have experienced it. Real autotool script usually expect `sh` but a lot of the time you are lucky and can use bash (gcc is a case in point). 

My experience comes from AIX where `sh` is a real separate program rather than bash or dash called with a special profile. AIX's sh is so slow that it will take several days to compile gcc if you don't use `CONFIG_SHELL=bash`. In that light it is tempting to use bash all the time, until things starts to fail left and right in some libtool scripts later on.



---

archive/issue_comments_339258.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:11 dimpase]:\n> Just check the 1st line of the top `./configure`.\n\n\nI don't mean `configure`. I mean the scripts in `build/bin`.",
    "created_at": "2018-01-08T18:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339258",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Replying to [comment:11 dimpase]:
> Just check the 1st line of the top `./configure`.


I don't mean `configure`. I mean the scripts in `build/bin`.



---

archive/issue_comments_339259.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 jdemeyer]:\n> Replying to [comment:11 dimpase]:\n> > Just check the 1st line of the top `./configure`.\n\n> \n> I don't mean `configure`. I mean the scripts in `build/bin`.\n\n\nBut this does not guarantee that `sdh_configure` is only launched from there.\nSomeone could source the `sdh_configure` in a non-bash session and shoot themselves in the foot...",
    "created_at": "2018-01-08T19:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339259",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [comment:13 jdemeyer]:
> Replying to [comment:11 dimpase]:
> > Just check the 1st line of the top `./configure`.

> 
> I don't mean `configure`. I mean the scripts in `build/bin`.


But this does not guarantee that `sdh_configure` is only launched from there.
Someone could source the `sdh_configure` in a non-bash session and shoot themselves in the foot...



---

archive/issue_comments_339260.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:12 fbissey]:\n> Some autotool scripts will also break if you use `CONFIG_SHELL=bash` I don't know if there are any in sage but I have experienced it. Real autotool script usually expect `sh` but a lot of the time you are lucky and can use bash (gcc is a case in point).\n\n\nOn some systems, `/bin/sh` is `bash`:\n\n```\njdemeyer@sage4:~$ /bin/sh --version\nGNU bash, version 4.3.48(1)-release (x86_64-pc-linux-gnu)\nCopyright (C) 2013 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\n\nThis is free software; you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n```\n\nGiven that `bash` is meant to be POSIX-compliant, it should not be a problem to force the use of `bash`.",
    "created_at": "2018-01-09T11:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339260",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Replying to [comment:12 fbissey]:
> Some autotool scripts will also break if you use `CONFIG_SHELL=bash` I don't know if there are any in sage but I have experienced it. Real autotool script usually expect `sh` but a lot of the time you are lucky and can use bash (gcc is a case in point).


On some systems, `/bin/sh` is `bash`:

```
jdemeyer@sage4:~$ /bin/sh --version
GNU bash, version 4.3.48(1)-release (x86_64-pc-linux-gnu)
Copyright (C) 2013 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>

This is free software; you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.
```

Given that `bash` is meant to be POSIX-compliant, it should not be a problem to force the use of `bash`.



---

archive/issue_comments_339261.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:10 tornaria]:\n> Using `/bin/sh` when possible is a way to give extra testing to configure scripts, which are meant to ensure portability of software.\n\n\nI disagree completely with this point. It's not the goal of Sage to use our users for testing the portability of configure scripts.\n\nWe should ensure that Sage can be installed on as many systems as possible. I claim that using `bash` for configure scripts is more portable than using `/bin/sh`. So that is what we should do.",
    "created_at": "2018-01-09T11:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339261",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>Replying to [comment:10 tornaria]:
> Using `/bin/sh` when possible is a way to give extra testing to configure scripts, which are meant to ensure portability of software.


I disagree completely with this point. It's not the goal of Sage to use our users for testing the portability of configure scripts.

We should ensure that Sage can be installed on as many systems as possible. I claim that using `bash` for configure scripts is more portable than using `/bin/sh`. So that is what we should do.



---

archive/issue_comments_339262.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-09T11:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339262",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339263.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-09T11:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339263",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339264.json:
```json
{
    "body": "<a id='comment:19'></a>And on some system `sh` is actually `dash`. There are differences between `bash`, `dash` and `sh` (as one would expect). When `sh` is actually `bash` for example it is not just a link. When `bash` is invoked as `sh` a special profile is loaded, some bash functions are defined to match `sh` requirements and so on. Probably similarly for `dash`. If you just `CONFIG_SHELL=bash` everywhere you will get a surprise sooner rather than later because those functions won't be there.",
    "created_at": "2018-01-09T11:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339264",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>And on some system `sh` is actually `dash`. There are differences between `bash`, `dash` and `sh` (as one would expect). When `sh` is actually `bash` for example it is not just a link. When `bash` is invoked as `sh` a special profile is loaded, some bash functions are defined to match `sh` requirements and so on. Probably similarly for `dash`. If you just `CONFIG_SHELL=bash` everywhere you will get a surprise sooner rather than later because those functions won't be there.



---

archive/issue_comments_339265.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 fbissey]:\n> And on some system `sh` is actually `dash`. There are differences between `bash`, `dash` and `sh` (as one would expect). When `sh` is actually `bash` for example it is not just a link. When `bash` is invoked as `sh` a special profile is loaded, some bash functions are defined to match `sh` requirements and so on. Probably similarly for `dash`. If you just `CONFIG_SHELL=bash` everywhere you will get a surprise sooner rather than later because those functions won't be there.\n\n\nI always assumed that `bash` is essentially `sh` with extra features (a bit like C++ is C with extra features). Meaning that if something works with `sh`, it almost certainly works with `bash`. Of course there are edge cases where it might not work, but I doubt that it is as much a problem as you think.",
    "created_at": "2018-01-09T11:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339265",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 fbissey]:
> And on some system `sh` is actually `dash`. There are differences between `bash`, `dash` and `sh` (as one would expect). When `sh` is actually `bash` for example it is not just a link. When `bash` is invoked as `sh` a special profile is loaded, some bash functions are defined to match `sh` requirements and so on. Probably similarly for `dash`. If you just `CONFIG_SHELL=bash` everywhere you will get a surprise sooner rather than later because those functions won't be there.


I always assumed that `bash` is essentially `sh` with extra features (a bit like C++ is C with extra features). Meaning that if something works with `sh`, it almost certainly works with `bash`. Of course there are edge cases where it might not work, but I doubt that it is as much a problem as you think.



---

archive/issue_comments_339266.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-09T12:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339266",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_339267.json:
```json
{
    "body": "<a id='comment:21'></a>My experience with FreeBSD (with /bin/sh not being bash at all) tells me that making /bin/sh a link to bash allows Sage to build just fine. It breaks other components of the OS, naturally, but it's beside the point, which is that it's actually safe to use bash everywhere where there is /bin/sh (at least the one on FreeBSD) invocation in Sage.",
    "created_at": "2018-01-09T12:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339267",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>My experience with FreeBSD (with /bin/sh not being bash at all) tells me that making /bin/sh a link to bash allows Sage to build just fine. It breaks other components of the OS, naturally, but it's beside the point, which is that it's actually safe to use bash everywhere where there is /bin/sh (at least the one on FreeBSD) invocation in Sage.



---

archive/issue_comments_339268.json:
```json
{
    "body": "<a id='comment:22'></a>+1\n\nRelated question I've been wondering about for a while (while we're discussing it here): Do we require GNU make for Sage, or should any POSIX-compatible make work?  I would very much like to make use of GNU-specific features (e.g. #21524) and I'm not 100% sure if all of Sage's packages will work with a generic make but it's never been clear to me if that's a requirement or not.",
    "created_at": "2018-01-09T13:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339268",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>+1

Related question I've been wondering about for a while (while we're discussing it here): Do we require GNU make for Sage, or should any POSIX-compatible make work?  I would very much like to make use of GNU-specific features (e.g. #21524) and I'm not 100% sure if all of Sage's packages will work with a generic make but it's never been clear to me if that's a requirement or not.



---

archive/issue_comments_339269.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:20 jdemeyer]:\n> Replying to [comment:19 fbissey]:\n> > And on some system `sh` is actually `dash`. There are differences between `bash`, `dash` and `sh` (as one would expect). When `sh` is actually `bash` for example it is not just a link. When `bash` is invoked as `sh` a special profile is loaded, some bash functions are defined to match `sh` requirements and so on. Probably similarly for `dash`. If you just `CONFIG_SHELL=bash` everywhere you will get a surprise sooner rather than later because those functions won't be there.\n\n> \n> I always assumed that `bash` is essentially `sh` with extra features (a bit like C++ is C with extra features). Meaning that if something works with `sh`, it almost certainly works with `bash`. Of course there are edge cases where it might not work, but I doubt that it is as much a problem as you think.\n\n\n\nBeen there, done that, got the T-shirt. Proof is in the pudding, someone should do a complete build. My experience is that a libtool component will break sooner rather than later.",
    "created_at": "2018-01-09T18:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339269",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:23'></a>Replying to [comment:20 jdemeyer]:
> Replying to [comment:19 fbissey]:
> > And on some system `sh` is actually `dash`. There are differences between `bash`, `dash` and `sh` (as one would expect). When `sh` is actually `bash` for example it is not just a link. When `bash` is invoked as `sh` a special profile is loaded, some bash functions are defined to match `sh` requirements and so on. Probably similarly for `dash`. If you just `CONFIG_SHELL=bash` everywhere you will get a surprise sooner rather than later because those functions won't be there.

> 
> I always assumed that `bash` is essentially `sh` with extra features (a bit like C++ is C with extra features). Meaning that if something works with `sh`, it almost certainly works with `bash`. Of course there are edge cases where it might not work, but I doubt that it is as much a problem as you think.



Been there, done that, got the T-shirt. Proof is in the pudding, someone should do a complete build. My experience is that a libtool component will break sooner rather than later.



---

archive/issue_comments_339270.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 embray]:\n> +1\n> \n> Related question I've been wondering about for a while (while we're discussing it here): Do we require GNU make for Sage, or should any POSIX-compatible make work?  I would very much like to make use of GNU-specific features (e.g. #21524) and I'm not 100% sure if all of Sage's packages will work with a generic make but it's never been clear to me if that's a requirement or not.\n\n\nGNU make is needed. Once upon a time (in 2008) me and a debian developper at the time tried to patch packages to be able to use other `make`. We did go exactly nowhere. Fully autotooled packages are probably OK, it is all the custom ones that are troublesome - and it is so easy to use GNUism in make because they are so useful...",
    "created_at": "2018-01-09T18:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339270",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>Replying to [comment:22 embray]:
> +1
> 
> Related question I've been wondering about for a while (while we're discussing it here): Do we require GNU make for Sage, or should any POSIX-compatible make work?  I would very much like to make use of GNU-specific features (e.g. #21524) and I'm not 100% sure if all of Sage's packages will work with a generic make but it's never been clear to me if that's a requirement or not.


GNU make is needed. Once upon a time (in 2008) me and a debian developper at the time tried to patch packages to be able to use other `make`. We did go exactly nowhere. Fully autotooled packages are probably OK, it is all the custom ones that are troublesome - and it is so easy to use GNUism in make because they are so useful...



---

archive/issue_comments_339271.json:
```json
{
    "body": "<a id='comment:25'></a>Not much documentation on what bash does when it is invoked as sh. According to the doc it change mainly two things: the files it reads at start up and it is basically run with the `--posix` option. So adding `--posix` as an option may be enough to get out of all the potential problems. I wish I had an opportunity to test that when I found the various problems I mentioned earlier.",
    "created_at": "2018-01-09T20:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339271",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>Not much documentation on what bash does when it is invoked as sh. According to the doc it change mainly two things: the files it reads at start up and it is basically run with the `--posix` option. So adding `--posix` as an option may be enough to get out of all the potential problems. I wish I had an opportunity to test that when I found the various problems I mentioned earlier.



---

archive/issue_events_061799.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T10:14:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24491#event-61799"
}
```



---

archive/issue_comments_339272.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-14T10:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339272",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_339273.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:24 fbissey]:\n> Replying to [comment:22 embray]:\n> > +1\n> > \n> > Related question I've been wondering about for a while (while we're discussing it here): Do we require GNU make for Sage, or should any POSIX-compatible make work?  I would very much like to make use of GNU-specific features (e.g. #21524) and I'm not 100% sure if all of Sage's packages will work with a generic make but it's never been clear to me if that's a requirement or not.\n\n> \n> GNU make is needed. Once upon a time (in 2008) me and a debian developper at the time tried to patch packages to be able to use other `make`. We did go exactly nowhere. Fully autotooled packages are probably OK, it is all the custom ones that are troublesome - and it is so easy to use GNUism in make because they are so useful...\n\n\nGood, I'm glad.  While this is a problem autotools is supposed to solve that's not a universal solution anyways.",
    "created_at": "2018-01-16T17:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24491",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24491#issuecomment-339273",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>Replying to [comment:24 fbissey]:
> Replying to [comment:22 embray]:
> > +1
> > 
> > Related question I've been wondering about for a while (while we're discussing it here): Do we require GNU make for Sage, or should any POSIX-compatible make work?  I would very much like to make use of GNU-specific features (e.g. #21524) and I'm not 100% sure if all of Sage's packages will work with a generic make but it's never been clear to me if that's a requirement or not.

> 
> GNU make is needed. Once upon a time (in 2008) me and a debian developper at the time tried to patch packages to be able to use other `make`. We did go exactly nowhere. Fully autotooled packages are probably OK, it is all the custom ones that are troublesome - and it is so easy to use GNUism in make because they are so useful...


Good, I'm glad.  While this is a problem autotools is supposed to solve that's not a universal solution anyways.
