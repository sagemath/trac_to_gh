# Issue 24143: sympy misbehavoir

archive/issues_024143.json:
```json
{
    "body": "CC:  @jdemeyer @kiwifb\n\nSympy polyomials with Sage real number coefficients look very broken\n\n```\nsage: import sympy, sympy.polys\nsage: x = sympy.Symbol('x')\nsage: p = sympy.polys.Poly(x**2 - 2.0)\nsage: p\n<repr(<sympy.polys.polytools.Poly at 0x7f92ca50ef18>) failed: TypeError: int() argument must be a string or a number, not 'NoneType'>\nsage: p.coeffs()\nTypeError                                 Traceback (most recent call last)\n<ipython-input-24-7e7e3b79f346> in <module>()\n----> 1 p.coeffs()\n\n/opt/sage/local/lib/python2.7/site-packages/sympy/polys/polytools.pyc in coeffs(f, order)\n    795 \n    796         \"\"\"\n--> 797         return [f.rep.dom.to_sympy(c) for c in f.rep.coeffs(order=order)]\n    798 \n    799     def monoms(f, order=None):\n\n/opt/sage/local/lib/python2.7/site-packages/sympy/polys/domains/realfield.pyc in to_sympy(self, element)\n     64     def to_sympy(self, element):\n     65         \"\"\"Convert ``element`` to SymPy number. \"\"\"\n---> 66         return Float(element, self.dps)\n     67 \n     68     def from_sympy(self, expr):\n\n/opt/sage/local/lib/python2.7/site-packages/sympy/core/numbers.pyc in __new__(cls, num, dps, prec, precision)\n   1053                 _mpf_ = mpf_norm(_mpf_, precision)\n   1054         else:\n-> 1055             _mpf_ = mpmath.mpf(num, prec=prec)._mpf_\n   1056 \n   1057         # special cases\n\n/opt/sage/src/sage/libs/mpmath/ext_main.pyx in sage.libs.mpmath.ext_main.mpf.__init__ (build/cythonized/sage/libs/mpmath/ext_main.c:23448)()\n   1886         opts = global_opts\n   1887         if kwargs:\n-> 1888             if 'prec' in kwargs: opts.prec = int(kwargs['prec'])\n   1889             if 'dps'  in kwargs: opts.prec = libmp.dps_to_prec(int(kwargs['dps']))\n   1890             if 'rounding' in kwargs: opts.rounding = rndmode_from_python(kwargs['rounding'])\n\nTypeError: int() argument must be a string or a number, not 'NoneType'\n```\n\nWe backport a patch in sympy development branch. This problem was originally found from digging around #24378.\nUpstream fix is at https://github.com/sympy/sympy/pull/13276\n\nIssue created by migration from https://trac.sagemath.org/ticket/24380\n\n",
    "closed_at": "2017-12-18T19:39:09Z",
    "created_at": "2017-12-15T11:37:49Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "sympy misbehavoir",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24143",
    "user": "https://github.com/videlec"
}
```
CC:  @jdemeyer @kiwifb

Sympy polyomials with Sage real number coefficients look very broken

```
sage: import sympy, sympy.polys
sage: x = sympy.Symbol('x')
sage: p = sympy.polys.Poly(x**2 - 2.0)
sage: p
<repr(<sympy.polys.polytools.Poly at 0x7f92ca50ef18>) failed: TypeError: int() argument must be a string or a number, not 'NoneType'>
sage: p.coeffs()
TypeError                                 Traceback (most recent call last)
<ipython-input-24-7e7e3b79f346> in <module>()
----> 1 p.coeffs()

/opt/sage/local/lib/python2.7/site-packages/sympy/polys/polytools.pyc in coeffs(f, order)
    795 
    796         """
--> 797         return [f.rep.dom.to_sympy(c) for c in f.rep.coeffs(order=order)]
    798 
    799     def monoms(f, order=None):

/opt/sage/local/lib/python2.7/site-packages/sympy/polys/domains/realfield.pyc in to_sympy(self, element)
     64     def to_sympy(self, element):
     65         """Convert ``element`` to SymPy number. """
---> 66         return Float(element, self.dps)
     67 
     68     def from_sympy(self, expr):

/opt/sage/local/lib/python2.7/site-packages/sympy/core/numbers.pyc in __new__(cls, num, dps, prec, precision)
   1053                 _mpf_ = mpf_norm(_mpf_, precision)
   1054         else:
-> 1055             _mpf_ = mpmath.mpf(num, prec=prec)._mpf_
   1056 
   1057         # special cases

/opt/sage/src/sage/libs/mpmath/ext_main.pyx in sage.libs.mpmath.ext_main.mpf.__init__ (build/cythonized/sage/libs/mpmath/ext_main.c:23448)()
   1886         opts = global_opts
   1887         if kwargs:
-> 1888             if 'prec' in kwargs: opts.prec = int(kwargs['prec'])
   1889             if 'dps'  in kwargs: opts.prec = libmp.dps_to_prec(int(kwargs['dps']))
   1890             if 'rounding' in kwargs: opts.rounding = rndmode_from_python(kwargs['rounding'])

TypeError: int() argument must be a string or a number, not 'NoneType'
```

We backport a patch in sympy development branch. This problem was originally found from digging around #24378.
Upstream fix is at https://github.com/sympy/sympy/pull/13276

Issue created by migration from https://trac.sagemath.org/ticket/24380





---

archive/issue_comments_338049.json:
```json
{
    "body": "Updating sympy to the development version makes it working\n\n```\nsage: import sympy, sympy.polys\nsage: sympy.__version__\n'1.1.2.dev'\nsage: x = sympy.Symbol('x')\nsage: p = sympy.polys.Poly(x**2 - 2.0)\nsage: p\nPoly(1.0*x**2 - 2.0, x, domain='RR')\nsage: p.coeffs()\n[1.00000000000000, -2.00000000000000]\nsage: map(type,p.coeffs())\n[<class 'sympy.core.numbers.Float'>, <class 'sympy.core.numbers.Float'>]\n```",
    "created_at": "2017-12-15T13:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338049",
    "user": "https://github.com/videlec"
}
```

Updating sympy to the development version makes it working

```
sage: import sympy, sympy.polys
sage: sympy.__version__
'1.1.2.dev'
sage: x = sympy.Symbol('x')
sage: p = sympy.polys.Poly(x**2 - 2.0)
sage: p
Poly(1.0*x**2 - 2.0, x, domain='RR')
sage: p.coeffs()
[1.00000000000000, -2.00000000000000]
sage: map(type,p.coeffs())
[<class 'sympy.core.numbers.Float'>, <class 'sympy.core.numbers.Float'>]
```



---

archive/issue_comments_338050.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-15T14:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338050",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_338051.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-15T14:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338051",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338052.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-15T14:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_338053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-15T14:11:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_338054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-16T08:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_338055.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-12-17T07:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338055",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_338056.json:
```json
{
    "body": "LGTM.",
    "created_at": "2017-12-17T07:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338056",
    "user": "https://github.com/rwst"
}
```

LGTM.



---

archive/issue_comments_338057.json:
```json
{
    "body": "Not changing the status, but would you mind adding upstream info about this? Issues number and/or PR number.",
    "created_at": "2017-12-17T20:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338057",
    "user": "https://github.com/kiwifb"
}
```

Not changing the status, but would you mind adding upstream info about this? Issues number and/or PR number.



---

archive/issue_comments_338058.json:
```json
{
    "body": "OK, found it myself and added to description for future reference.",
    "created_at": "2017-12-17T20:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338058",
    "user": "https://github.com/kiwifb"
}
```

OK, found it myself and added to description for future reference.



---

archive/issue_comments_338059.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-18T19:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24143#issuecomment-338059",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061643.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-18T19:39:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24143",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24143#event-61643"
}
```
