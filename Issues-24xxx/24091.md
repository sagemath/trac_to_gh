# Issue 24091: Bug in order of points on elliptic curves

archive/issues_023854.json:
```json
{
    "assignees": [],
    "body": "In this example we construct a point of order 2 which thinks its order is infinity:\n\n```\nsage: E = EllipticCurve([0,0,0,0,-2])\nsage: E.torsion_order()\n1\nsage: K.<a> = NumberField(x^3-2)\nsage: P = E.lift_x(a)\nsage: P.order()\n+Infinity\nsage: 2*P\n(0 : 1 : 0)\n```\nIt's fine if we construct the point differently:\n\n```\nsage: EK = E.change_ring(K)\nsage: P = EK([a,0])\nsage: P.order()\n2\n```\nand arises since in the first construction P.curve() is the curve over QQ, not the extension.  Hence the error is in the lift_x() function.  Which means that it is probably my fault since I think I wrote that.\n\nBranch/Commit: **[d273702](https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc)**\n\nReviewer: **David Roe**\n\nAuthor: **John Cremona**\n\nComponent: **elliptic curves**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24091_\n\n",
    "closed_at": "2018-01-14T10:14:41Z",
    "created_at": "2017-10-23T16:11:11Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Bug in order of points on elliptic curves",
    "type": "issue",
    "updated_at": "2018-01-14T10:14:41Z",
    "url": "https://github.com/sagemath/sage/issues/24091",
    "user": "https://github.com/JohnCremona"
}
```
In this example we construct a point of order 2 which thinks its order is infinity:

```
sage: E = EllipticCurve([0,0,0,0,-2])
sage: E.torsion_order()
1
sage: K.<a> = NumberField(x^3-2)
sage: P = E.lift_x(a)
sage: P.order()
+Infinity
sage: 2*P
(0 : 1 : 0)
```
It's fine if we construct the point differently:

```
sage: EK = E.change_ring(K)
sage: P = EK([a,0])
sage: P.order()
2
```
and arises since in the first construction P.curve() is the curve over QQ, not the extension.  Hence the error is in the lift_x() function.  Which means that it is probably my fault since I think I wrote that.

Branch/Commit: **[d273702](https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc)**

Reviewer: **David Roe**

Author: **John Cremona**

Component: **elliptic curves**

_Issue created by migration from https://trac.sagemath.org/ticket/24091_





---

archive/issue_events_334462.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-10-23T16:11:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334462"
}
```



---

archive/issue_events_334463.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-10-23T16:11:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334463"
}
```



---

archive/issue_events_334464.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-10-23T16:11:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334464"
}
```



---

archive/issue_comments_364283.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhat happens is that the code correctly computes the y-coordinate (in the example it is 0 ) and then constructs the points using self.point(coords, check=False).  Switching off the check is to save time testing that the corordinates satisfy the equation of the curve.  But we should check that the x-coordinate given lies in the base field of the curve.\n\nIn the example it would be better if an error was raised; to construct this point the user should first construct the base-change of E from QQ to K and then construct the point on that.",
    "created_at": "2017-10-24T12:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364283",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:1" align="right">comment:1</div>

What happens is that the code correctly computes the y-coordinate (in the example it is 0 ) and then constructs the points using self.point(coords, check=False).  Switching off the check is to save time testing that the corordinates satisfy the equation of the curve.  But we should check that the x-coordinate given lies in the base field of the curve.

In the example it would be better if an error was raised; to construct this point the user should first construct the base-change of E from QQ to K and then construct the point on that.



---

archive/issue_events_334465.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2017-10-25T17:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334465"
}
```



---

archive/issue_comments_364284.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI can easily fix this by adding lines of the form\n\n```\n       K = self.base_ring()\n        try:\n            x = K(x)\n        except TypeError:\n            raise TypeError('x must be coercible into the base ring of the curve')\n```\nbut then 2 tests fail since the tests include a couple where the x supplied is in an extension of the base field.  However these examples, such as \n\n```\nsage: E = EllipticCurve('37a');\nsage: P = E.lift_x(pAdicField(17, 5)(6))\n```\nare bad since the resulting point has the wrong parent:\n\n```\nsage: P.parent()\nAbelian group of points on Elliptic Curve defined by y^2 + y = x^3 - x over Rational Field\n```\n\nA good way to fix this would be to allow the user to give an x which lies in some extension, tested by checking (if the x=K(x) fails) that E1 = E.change_ring(x.parent()) works and if so running lift_x() there, giving the same point as before but with the correct parent.  Note that the problem arises in the first place since the point returned is constructed with check=False.\n\nIf this is deemed to be useful (as I think it is), should we make it automatic, or require an additional parameter extend=False and only do the base-change when it is set to True?  This could be misleading since we must distinguish between cases where a base-change is needed to include x, and one where the y-coordinate is in a further extension.  So it's really a 3-way division: extend=False could result in failure unless both the given x and the computed y are in the original base_ring K;  extend='x' allows any x with parent L such that self.change_ring(L) is possible and returns a point over L provided that the y coordinate is also in L; and extend='xy' would be like extend='x' except that a further base-change would be made to include the y-coordinates.  Actually there's a 4th case extend='y' where we require x in the base ring but will make a quadratic extension if necessary to include the y-coordinates.\n\nI am beginning to think that we should leave the lift_x() as it is (with the stricter test that x=K(x) works, and removing the two subsequently failing tests) and add a new method with these 4 options.\n\nComments?",
    "created_at": "2017-11-10T15:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364284",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:3" align="right">comment:3</div>

I can easily fix this by adding lines of the form

```
       K = self.base_ring()
        try:
            x = K(x)
        except TypeError:
            raise TypeError('x must be coercible into the base ring of the curve')
```
but then 2 tests fail since the tests include a couple where the x supplied is in an extension of the base field.  However these examples, such as 

```
sage: E = EllipticCurve('37a');
sage: P = E.lift_x(pAdicField(17, 5)(6))
```
are bad since the resulting point has the wrong parent:

```
sage: P.parent()
Abelian group of points on Elliptic Curve defined by y^2 + y = x^3 - x over Rational Field
```

A good way to fix this would be to allow the user to give an x which lies in some extension, tested by checking (if the x=K(x) fails) that E1 = E.change_ring(x.parent()) works and if so running lift_x() there, giving the same point as before but with the correct parent.  Note that the problem arises in the first place since the point returned is constructed with check=False.

If this is deemed to be useful (as I think it is), should we make it automatic, or require an additional parameter extend=False and only do the base-change when it is set to True?  This could be misleading since we must distinguish between cases where a base-change is needed to include x, and one where the y-coordinate is in a further extension.  So it's really a 3-way division: extend=False could result in failure unless both the given x and the computed y are in the original base_ring K;  extend='x' allows any x with parent L such that self.change_ring(L) is possible and returns a point over L provided that the y coordinate is also in L; and extend='xy' would be like extend='x' except that a further base-change would be made to include the y-coordinates.  Actually there's a 4th case extend='y' where we require x in the base ring but will make a quadratic extension if necessary to include the y-coordinates.

I am beginning to think that we should leave the lift_x() as it is (with the stricter test that x=K(x) works, and removing the two subsequently failing tests) and add a new method with these 4 options.

Comments?



---

archive/issue_events_334466.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-11-11T18:54:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334466"
}
```



---

archive/issue_comments_364285.json:
```json
{
    "body": "Branch: **[u/cremona/24091](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24091)**",
    "created_at": "2017-11-11T18:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364285",
    "user": "https://github.com/JohnCremona"
}
```

Branch: **[u/cremona/24091](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24091)**



---

archive/issue_comments_364286.json:
```json
{
    "body": "Commit: **[a0cd192](https://github.com/sagemath/sagetrac-mirror/commit/a0cd1923164b95e52fa898c52d520b7ad8c9091e)**",
    "created_at": "2017-11-11T18:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364286",
    "user": "https://github.com/JohnCremona"
}
```

Commit: **[a0cd192](https://github.com/sagemath/sagetrac-mirror/commit/a0cd1923164b95e52fa898c52d520b7ad8c9091e)**



---

archive/issue_comments_364287.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nFixed the bug and added all the optional extension possibilities described above, with more examples.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0cd1923164b95e52fa898c52d520b7ad8c9091e\">a0cd192</a></td><td><code>#24091 fix the bug and add several base-extension options to the elliptic curve lift_x() method</code></td></tr></table>\n",
    "created_at": "2017-11-11T18:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364287",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">comment:4</div>

Fixed the bug and added all the optional extension possibilities described above, with more examples.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0cd1923164b95e52fa898c52d520b7ad8c9091e">a0cd192</a></td><td><code>#24091 fix the bug and add several base-extension options to the elliptic curve lift_x() method</code></td></tr></table>




---

archive/issue_comments_364288.json:
```json
{
    "body": "Author: **John Cremona**",
    "created_at": "2017-11-11T18:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364288",
    "user": "https://github.com/JohnCremona"
}
```

Author: **John Cremona**



---

archive/issue_comments_364289.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nA couple comments:\n\n* I think the right condition to check is what you have in the code: that there is a coercion from `K` to `L`.  But it's not what you describe in the documentation: that `x` is converted into the base ring.  The difference occurs for p-adics for example:\n\n```\nsage: a = Qp(5)(82748127); a\n2 + 2*5^4 + 4*5^5 + 4*5^7 + 5^8 + 2*5^9 + 3*5^10 + 5^11 + O(5^20)\nsage: QQ(a)\n-639974/5762513\n```\n\n* When there is an extension, the right ring should probably be the pushout of the parent of `x` and the base ring of the curve.\n\nOtherwise, I'm pretty happy with these changes.",
    "created_at": "2017-11-11T20:42:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364289",
    "user": "https://github.com/roed314"
}
```

<div id="comment:5" align="right">comment:5</div>

A couple comments:

* I think the right condition to check is what you have in the code: that there is a coercion from `K` to `L`.  But it's not what you describe in the documentation: that `x` is converted into the base ring.  The difference occurs for p-adics for example:

```
sage: a = Qp(5)(82748127); a
2 + 2*5^4 + 4*5^5 + 4*5^7 + 5^8 + 2*5^9 + 3*5^10 + 5^11 + O(5^20)
sage: QQ(a)
-639974/5762513
```

* When there is an extension, the right ring should probably be the pushout of the parent of `x` and the base ring of the curve.

Otherwise, I'm pretty happy with these changes.



---

archive/issue_comments_364290.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThanks for looking at this.  I can correct the docstring.\n\nI did think of pushouts but decided that was overkill, though at present this fails:\n\n```\nsage: E = EllipticCurve([0,0,0,0,2])\nsage: x = polygen(ZZ)\nsage: E.lift_x(x, extend='xy')\n...\nTypeError: Unable to base-change from Rational Field to Univariate Polynomial Ring in x over Integer Ring\n```\n\nAfter more thought I was also wondering whether it would not be simpler to to the x-extension always and let the extend parameter just be True or False and control whether or not to make the quadratic extension to include the y-coordinate where necessary.  That way you could give any reasonable x with no additional stuff and get a point defined over an extension (assuming that the y-coordinate exists in the pushout of the base ring and x's parent).\n\nI'll try out the pushout idea anyway, making sure that everything still works, only using the pushout construction when sef.base_ring() and x.parent() are different.",
    "created_at": "2017-11-12T12:19:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364290",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:6" align="right">comment:6</div>

Thanks for looking at this.  I can correct the docstring.

I did think of pushouts but decided that was overkill, though at present this fails:

```
sage: E = EllipticCurve([0,0,0,0,2])
sage: x = polygen(ZZ)
sage: E.lift_x(x, extend='xy')
...
TypeError: Unable to base-change from Rational Field to Univariate Polynomial Ring in x over Integer Ring
```

After more thought I was also wondering whether it would not be simpler to to the x-extension always and let the extend parameter just be True or False and control whether or not to make the quadratic extension to include the y-coordinate where necessary.  That way you could give any reasonable x with no additional stuff and get a point defined over an extension (assuming that the y-coordinate exists in the pushout of the base ring and x's parent).

I'll try out the pushout idea anyway, making sure that everything still works, only using the pushout construction when sef.base_ring() and x.parent() are different.



---

archive/issue_comments_364291.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nUsing pushout is not so great.  If you take the pushout of two real quadratic number fields it returns Algebraic Real Field but with no coercion from the two fields into it.  Firstly I was expecting the pushout to be another number field, and secondly I thought th whole point of pushouts was that there would be maps from the constituents into it?",
    "created_at": "2017-11-12T12:36:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364291",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:7" align="right">comment:7</div>

Using pushout is not so great.  If you take the pushout of two real quadratic number fields it returns Algebraic Real Field but with no coercion from the two fields into it.  Firstly I was expecting the pushout to be another number field, and secondly I thought th whole point of pushouts was that there would be maps from the constituents into it?



---

archive/issue_events_334467.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-11-12T15:55:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334467"
}
```



---

archive/issue_events_334468.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-11-12T15:55:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334468"
}
```



---

archive/issue_comments_364292.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI had only tested the one file but clearly need to do more.",
    "created_at": "2017-11-12T15:55:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364292",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:8" align="right">comment:8</div>

I had only tested the one file but clearly need to do more.



---

archive/issue_comments_364293.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@JohnCremona](#comment:7):\n> Using pushout is not so great.  If you take the pushout of two real quadratic number fields it returns Algebraic Real Field but with no coercion from the two fields into it.  Firstly I was expecting the pushout to be another number field, and secondly I thought th whole point of pushouts was that there would be maps from the constituents into it?\n\nYeah, that sounds like a problem with pushout.  I don't think it's unreasonable for the pushout to be Algebraic Real Field, since in general there's not a canonical choice for the number field and we don't have general tensor products of number fields.  There should be coercions, but I can also see why it would be hard in this case.  Each number field can only have one embedding, and adding coercion maps to Algebraic Real Field will be tricky.  Maybe real quadratic fields could be special cased, since there's not really a problem choosing a number field as a pushout....\n\nAnyway, feel free to drop the pushout idea if you like.",
    "created_at": "2017-11-12T17:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364293",
    "user": "https://github.com/roed314"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@JohnCremona](#comment:7):
> Using pushout is not so great.  If you take the pushout of two real quadratic number fields it returns Algebraic Real Field but with no coercion from the two fields into it.  Firstly I was expecting the pushout to be another number field, and secondly I thought th whole point of pushouts was that there would be maps from the constituents into it?

Yeah, that sounds like a problem with pushout.  I don't think it's unreasonable for the pushout to be Algebraic Real Field, since in general there's not a canonical choice for the number field and we don't have general tensor products of number fields.  There should be coercions, but I can also see why it would be hard in this case.  Each number field can only have one embedding, and adding coercion maps to Algebraic Real Field will be tricky.  Maybe real quadratic fields could be special cased, since there's not really a problem choosing a number field as a pushout....

Anyway, feel free to drop the pushout idea if you like.



---

archive/issue_comments_364294.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@JohnCremona](#comment:6):\n> After more thought I was also wondering whether it would not be simpler to to the x-extension always and let the extend parameter just be True or False and control whether or not to make the quadratic extension to include the y-coordinate where necessary.  That way you could give any reasonable x with no additional stuff and get a point defined over an extension (assuming that the y-coordinate exists in the pushout of the base ring and x's parent).\n\nYeah, I think this would be reasonable.  If someone provides an x-coordinate that's not in the field, there's some chance that they'll have an error somewhere else and will be glad to learn about it.  But I think it's more likely that they'd rather have it just work.",
    "created_at": "2017-11-12T17:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364294",
    "user": "https://github.com/roed314"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@JohnCremona](#comment:6):
> After more thought I was also wondering whether it would not be simpler to to the x-extension always and let the extend parameter just be True or False and control whether or not to make the quadratic extension to include the y-coordinate where necessary.  That way you could give any reasonable x with no additional stuff and get a point defined over an extension (assuming that the y-coordinate exists in the pushout of the base ring and x's parent).

Yeah, I think this would be reasonable.  If someone provides an x-coordinate that's not in the field, there's some chance that they'll have an error somewhere else and will be glad to learn about it.  But I think it's more likely that they'd rather have it just work.



---

archive/issue_comments_364295.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@roed314](#comment:10):\n> Replying to [@JohnCremona](#comment:6):\n> > After more thought I was also wondering whether it would not be simpler to to the x-extension always and let the extend parameter just be True or False and control whether or not to make the quadratic extension to include the y-coordinate where necessary.  That way you could give any reasonable x with no additional stuff and get a point defined over an extension (assuming that the y-coordinate exists in the pushout of the base ring and x's parent).\n\n> \n> Yeah, I think this would be reasonable.  If someone provides an x-coordinate that's not in the field, there's some chance that they'll have an error somewhere else and will be glad to learn about it.  But I think it's more likely that they'd rather have it just work.\n\nThere are two different use cases really.   Interactively we would like things to be simple with helpful defaults, but this method is used in several places in the library where silently changing the point's parent from the original curve is possibly dangerous.\n\nWhat Magma does is to make the point's parent something like E(L) where L is an extension of the base rather than E itself.  For Sage to switch to that philosophy would be a lot of work.",
    "created_at": "2017-11-12T17:39:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364295",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@roed314](#comment:10):
> Replying to [@JohnCremona](#comment:6):
> > After more thought I was also wondering whether it would not be simpler to to the x-extension always and let the extend parameter just be True or False and control whether or not to make the quadratic extension to include the y-coordinate where necessary.  That way you could give any reasonable x with no additional stuff and get a point defined over an extension (assuming that the y-coordinate exists in the pushout of the base ring and x's parent).

> 
> Yeah, I think this would be reasonable.  If someone provides an x-coordinate that's not in the field, there's some chance that they'll have an error somewhere else and will be glad to learn about it.  But I think it's more likely that they'd rather have it just work.

There are two different use cases really.   Interactively we would like things to be simple with helpful defaults, but this method is used in several places in the library where silently changing the point's parent from the original curve is possibly dangerous.

What Magma does is to make the point's parent something like E(L) where L is an extension of the base rather than E itself.  For Sage to switch to that philosophy would be a lot of work.



---

archive/issue_comments_364296.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/119f3c13fd70425411a490c3e3151a6552708302\">119f3c1</a></td><td><code>#24091: add pushout to methods attempted when extending x</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bcd750e3b3aaaabe3b0a9a9dfd7c242ff42fa74e\">bcd750e</a></td><td><code>#24091: simplify extend options to True/False for y (always extend to include x), remove pushout code</code></td></tr></table>\n",
    "created_at": "2017-11-13T10:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364296",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/119f3c13fd70425411a490c3e3151a6552708302">119f3c1</a></td><td><code>#24091: add pushout to methods attempted when extending x</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bcd750e3b3aaaabe3b0a9a9dfd7c242ff42fa74e">bcd750e</a></td><td><code>#24091: simplify extend options to True/False for y (always extend to include x), remove pushout code</code></td></tr></table>




---

archive/issue_comments_364297.json:
```json
{
    "body": "Changed commit from **[a0cd192](https://github.com/sagemath/sagetrac-mirror/commit/a0cd1923164b95e52fa898c52d520b7ad8c9091e)** to **[bcd750e](https://github.com/sagemath/sagetrac-mirror/commit/bcd750e3b3aaaabe3b0a9a9dfd7c242ff42fa74e)**",
    "created_at": "2017-11-13T10:13:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364297",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a0cd192](https://github.com/sagemath/sagetrac-mirror/commit/a0cd1923164b95e52fa898c52d520b7ad8c9091e)** to **[bcd750e](https://github.com/sagemath/sagetrac-mirror/commit/bcd750e3b3aaaabe3b0a9a9dfd7c242ff42fa74e)**



---

archive/issue_comments_364298.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThe latest version removes pushout stuff (in the previous commit) and simplifies the extend parameter to True/False, indicating whether or not to make a quadratic extension to include the y-coordinates.  Unlike the first commit here, the base will always be extended to include x if there is a coercion from x.parent() into self.base_ring() (unless there is a coercion from x.parent()  into the original base ring), with no option needing to be set.  This is closer to the old behaviour, but certainly better since the returned point will always be a curve over a base containing the point's coordinates, which was not true before (and was the cause of the bug).\n\nBefore setting this to needs review again I'll do more testing since there are minor issues in other places, hopefully noting worse than points being listed in a different order compared with the old code.",
    "created_at": "2017-11-13T10:18:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364298",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:13" align="right">comment:13</div>

The latest version removes pushout stuff (in the previous commit) and simplifies the extend parameter to True/False, indicating whether or not to make a quadratic extension to include the y-coordinates.  Unlike the first commit here, the base will always be extended to include x if there is a coercion from x.parent() into self.base_ring() (unless there is a coercion from x.parent()  into the original base ring), with no option needing to be set.  This is closer to the old behaviour, but certainly better since the returned point will always be a curve over a base containing the point's coordinates, which was not true before (and was the cause of the bug).

Before setting this to needs review again I'll do more testing since there are minor issues in other places, hopefully noting worse than points being listed in a different order compared with the old code.



---

archive/issue_comments_364299.json:
```json
{
    "body": "Changed commit from **[bcd750e](https://github.com/sagemath/sagetrac-mirror/commit/bcd750e3b3aaaabe3b0a9a9dfd7c242ff42fa74e)** to **[cb34112](https://github.com/sagemath/sagetrac-mirror/commit/cb34112e61f481a7e3bc4dc0a8204113524a5250)**",
    "created_at": "2017-11-13T11:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364299",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bcd750e](https://github.com/sagemath/sagetrac-mirror/commit/bcd750e3b3aaaabe3b0a9a9dfd7c242ff42fa74e)** to **[cb34112](https://github.com/sagemath/sagetrac-mirror/commit/cb34112e61f481a7e3bc4dc0a8204113524a5250)**



---

archive/issue_comments_364300.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb34112e61f481a7e3bc4dc0a8204113524a5250\">cb34112</a></td><td><code>#24091 fix formatting bug and a couple of tests where output now trivially different</code></td></tr></table>\n",
    "created_at": "2017-11-13T11:45:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364300",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb34112e61f481a7e3bc4dc0a8204113524a5250">cb34112</a></td><td><code>#24091 fix formatting bug and a couple of tests where output now trivially different</code></td></tr></table>




---

archive/issue_events_334469.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-11-13T11:45:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334469"
}
```



---

archive/issue_events_334470.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2017-11-13T11:45:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334470"
}
```



---

archive/issue_comments_364301.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI am working on the 3 broken doctests.",
    "created_at": "2018-01-10T11:31:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364301",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:16" align="right">comment:16</div>

I am working on the 3 broken doctests.



---

archive/issue_events_334471.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-10T11:31:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334471"
}
```



---

archive/issue_events_334472.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-10T11:31:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334472"
}
```



---

archive/issue_comments_364302.json:
```json
{
    "body": "Changed commit from **[cb34112](https://github.com/sagemath/sagetrac-mirror/commit/cb34112e61f481a7e3bc4dc0a8204113524a5250)** to **[d273702](https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc)**",
    "created_at": "2018-01-10T13:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364302",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cb34112](https://github.com/sagemath/sagetrac-mirror/commit/cb34112e61f481a7e3bc4dc0a8204113524a5250)** to **[d273702](https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc)**



---

archive/issue_comments_364303.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9542496187d7d8687311c2f9be1475e4ca2d369b\">9542496</a></td><td><code>Merge branch 'develop' into 24091</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc\">d273702</a></td><td><code>#24091: fixed two doctests</code></td></tr></table>\n",
    "created_at": "2018-01-10T13:30:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364303",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9542496187d7d8687311c2f9be1475e4ca2d369b">9542496</a></td><td><code>Merge branch 'develop' into 24091</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc">d273702</a></td><td><code>#24091: fixed two doctests</code></td></tr></table>




---

archive/issue_comments_364304.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n2 of the broken doctests were due to E.lift_x(x0) returning the other point with the same x-coordinate, which have been fixed.\nThe 3rd failure reported by a patchbot were timeouts on lines 277 and 279 of src/sage/doctest/external.py which is a patchbot issue nothing to do with this ticket, so I'll put it back to \"needs review\".",
    "created_at": "2018-01-10T13:33:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364304",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:18" align="right">comment:18</div>

2 of the broken doctests were due to E.lift_x(x0) returning the other point with the same x-coordinate, which have been fixed.
The 3rd failure reported by a patchbot were timeouts on lines 277 and 279 of src/sage/doctest/external.py which is a patchbot issue nothing to do with this ticket, so I'll put it back to "needs review".



---

archive/issue_events_334473.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-10T13:33:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334473"
}
```



---

archive/issue_events_334474.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2018-01-10T13:33:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334474"
}
```



---

archive/issue_comments_364305.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOK, patchbot is happy so all I need is a positive review!",
    "created_at": "2018-01-10T15:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364305",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:19" align="right">comment:19</div>

OK, patchbot is happy so all I need is a positive review!



---

archive/issue_comments_364306.json:
```json
{
    "body": "Reviewer: **David Roe**",
    "created_at": "2018-01-10T18:48:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364306",
    "user": "https://github.com/roed314"
}
```

Reviewer: **David Roe**



---

archive/issue_events_334475.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2018-01-10T18:48:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334475"
}
```



---

archive/issue_events_334476.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2018-01-10T18:48:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334476"
}
```



---

archive/issue_comments_364307.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nLooks good to me!",
    "created_at": "2018-01-10T18:48:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364307",
    "user": "https://github.com/roed314"
}
```

<div id="comment:20" align="right">comment:20</div>

Looks good to me!



---

archive/issue_comments_364308.json:
```json
{
    "body": "Changed branch from **[u/cremona/24091](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24091)** to **[d273702](https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc)**",
    "created_at": "2018-01-14T10:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24091#issuecomment-364308",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/cremona/24091](https://github.com/sagemath/sagetrac-mirror/tree/u/cremona/24091)** to **[d273702](https://github.com/sagemath/sagetrac-mirror/commit/d27370265f82a525966ef95b0d71d696b7eb88dc)**



---

archive/issue_events_334477.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T10:14:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334477"
}
```



---

archive/issue_events_334478.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "e29baa4e7079ae9113daa543961ec8c7c695bdd7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-14T10:14:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24091",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24091#event-334478"
}
```
