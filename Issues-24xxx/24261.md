# Issue 24261: py3: add py2 and py3 doctest flags

archive/issues_024024.json:
```json
{
    "assignees": [],
    "body": "This adds two new flags that can be placed next to doctests: `# py2` and `# py3`.  If marked `py2` a test will *only* be run on Python 2 and so on.\n\nGenerally this should be avoided in favor of making a test work on both in some way or another, but there are some cases where it simply doesn't make sense.  For example this test in `sage.doctest.control`\n\n```\n 640             sage: DD = DocTestDefaults(sagenb = True)\n 641             sage: DC = DocTestController(DD, [])\n 642             sage: DC.add_files()  # py2\n 643             Doctesting the Sage notebook.\n 644             sage: DC.files[0][-6:]  # py2\n 645             'sagenb'\n```\n\nThis doesn't work on Python 3 since we don't even install the Sage notebook on Python 3 (at least not currently).\n\nThe relevant code being tested there should also be updated to handle Python 3 better, but even so there's no practical way to make the test make sense on Python 3 until/unless sagenb is supported on Python 3.  I suspect other cases like this may come up on occasion so it's useful to have.\n\nCC:  @fchapoton\n\nBranch: **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, Erik Bray, Jeroen Demeyer**\n\nAuthor: **Erik Bray, Jeroen Demeyer**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24261_\n\n",
    "closed_at": "2018-01-14T10:14:36Z",
    "created_at": "2017-11-21T14:09:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: add py2 and py3 doctest flags",
    "type": "issue",
    "updated_at": "2018-01-19T15:16:25Z",
    "url": "https://github.com/sagemath/sage/issues/24261",
    "user": "https://github.com/embray"
}
```
This adds two new flags that can be placed next to doctests: `# py2` and `# py3`.  If marked `py2` a test will *only* be run on Python 2 and so on.

Generally this should be avoided in favor of making a test work on both in some way or another, but there are some cases where it simply doesn't make sense.  For example this test in `sage.doctest.control`

```
 640             sage: DD = DocTestDefaults(sagenb = True)
 641             sage: DC = DocTestController(DD, [])
 642             sage: DC.add_files()  # py2
 643             Doctesting the Sage notebook.
 644             sage: DC.files[0][-6:]  # py2
 645             'sagenb'
```

This doesn't work on Python 3 since we don't even install the Sage notebook on Python 3 (at least not currently).

The relevant code being tested there should also be updated to handle Python 3 better, but even so there's no practical way to make the test make sense on Python 3 until/unless sagenb is supported on Python 3.  I suspect other cases like this may come up on occasion so it's useful to have.

CC:  @fchapoton

Branch: **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)**

Reviewer: **Frédéric Chapoton, Erik Bray, Jeroen Demeyer**

Author: **Erik Bray, Jeroen Demeyer**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/24261_





---

archive/issue_events_336539.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-21T14:09:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336539"
}
```



---

archive/issue_events_336540.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-21T14:09:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "000080",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336540"
}
```



---

archive/issue_events_336541.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-21T14:09:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336541"
}
```



---

archive/issue_events_336542.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-21T14:09:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336542"
}
```



---

archive/issue_events_336543.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-11-21T14:09:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336543"
}
```



---

archive/issue_comments_367224.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nWhy not `# optional - python2` or `# optional - python3`? That's reusing an existing system for optional tests.",
    "created_at": "2017-11-21T15:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367224",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Why not `# optional - python2` or `# optional - python3`? That's reusing an existing system for optional tests.



---

archive/issue_comments_367225.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@jdemeyer](#comment:2):\n> Why not `# optional - python2` or `# optional - python3`? That's reusing an existing system for optional tests.\n\nand there are already existing instances waiting for that",
    "created_at": "2017-11-21T16:02:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367225",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@jdemeyer](#comment:2):
> Why not `# optional - python2` or `# optional - python3`? That's reusing an existing system for optional tests.

and there are already existing instances waiting for that



---

archive/issue_comments_367226.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@jdemeyer](#comment:2):\n> Why not `# optional - python2` or `# optional - python3`? That's reusing an existing system for optional tests.\n\nI considered something like that but it seems to have different semantics.  Currently \"optional - pkgname\" implies that a package is installed/available.  Here we don't care if python2/3 is available.  We care about what Python version is currently running the tests.\n\nRather than making a special case it's simpler and clearer I think to just have specific tags for this (there's also prior precedence such as using `# py3` in coverage to mark lines that should be ignored in the coverage analysis).",
    "created_at": "2017-11-21T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367226",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@jdemeyer](#comment:2):
> Why not `# optional - python2` or `# optional - python3`? That's reusing an existing system for optional tests.

I considered something like that but it seems to have different semantics.  Currently "optional - pkgname" implies that a package is installed/available.  Here we don't care if python2/3 is available.  We care about what Python version is currently running the tests.

Rather than making a special case it's simpler and clearer I think to just have specific tags for this (there's also prior precedence such as using `# py3` in coverage to mark lines that should be ignored in the coverage analysis).



---

archive/issue_comments_367227.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI think it would be better to have `# py2` and `# py3` behave like the `# 32-bit` and `# 64-bit` and be specific for the output. I guess there is also the question of how many of our doctest inputs are going to be specific for Python2. Do any of you have an impression? I think it might be marginal at worst, in which case, we can just build into the doctests an explicit check of Python2 vs 3 as part of the doctest itself.",
    "created_at": "2017-11-22T04:44:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367227",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

I think it would be better to have `# py2` and `# py3` behave like the `# 32-bit` and `# 64-bit` and be specific for the output. I guess there is also the question of how many of our doctest inputs are going to be specific for Python2. Do any of you have an impression? I think it might be marginal at worst, in which case, we can just build into the doctests an explicit check of Python2 vs 3 as part of the doctest itself.



---

archive/issue_comments_367228.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI wouldn't mind changing it to apply to the output but not skip the test.  That would actually be better since if the behavior on Python 3 changes in these cases (e.g. `sagenb` works, to use my previous example) then we'd want to see that reflected in the test results.\n\nI think a stronger possibility is *Python 3* only inputs, such as doing things with annotations and other Python 3 only syntax.  So maybe having these tags work on both output and input would be good?",
    "created_at": "2017-11-22T13:11:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367228",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

I wouldn't mind changing it to apply to the output but not skip the test.  That would actually be better since if the behavior on Python 3 changes in these cases (e.g. `sagenb` works, to use my previous example) then we'd want to see that reflected in the test results.

I think a stronger possibility is *Python 3* only inputs, such as doing things with annotations and other Python 3 only syntax.  So maybe having these tags work on both output and input would be good?



---

archive/issue_comments_367229.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI would not oppose that, but I don't think we do anything like that elsewhere. So it might require some invasive changes and might cause some slight confusion (but that is debatable). I think we would be better off having a separate marker for Python3 input.",
    "created_at": "2017-11-22T22:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367229",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

I would not oppose that, but I don't think we do anything like that elsewhere. So it might require some invasive changes and might cause some slight confusion (but that is debatable). I think we would be better off having a separate marker for Python3 input.



---

archive/issue_comments_367230.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAdding tags on output lines would not require invasive changes, but I do think it's slightly more confusing.  Whereas the use of comments on input lines is consistent with Python syntax, sticking comments in output lines is a bit ad-hoc and confusing.  But we also already have precedence for that in the \"32-bit/64-bit\" case as you pointed out.",
    "created_at": "2017-11-23T09:53:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367230",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Adding tags on output lines would not require invasive changes, but I do think it's slightly more confusing.  Whereas the use of comments on input lines is consistent with Python syntax, sticking comments in output lines is a bit ad-hoc and confusing.  But we also already have precedence for that in the "32-bit/64-bit" case as you pointed out.



---

archive/issue_events_336544.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T11:12:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336544"
}
```



---

archive/issue_events_336545.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T11:12:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336545"
}
```



---

archive/issue_comments_367231.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI just realized there's a bug in how this is implemented, where tests containing these tags are skipped regardless.",
    "created_at": "2017-12-01T11:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367231",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I just realized there's a bug in how this is implemented, where tests containing these tags are skipped regardless.



---

archive/issue_comments_367232.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nImplementation bug aside, I've been working on fixing the sageinspect module, and that's increasingly convinced me that having a concise way to run specific test cases on either Python 2 or Python 3 only is useful, especially in that module.",
    "created_at": "2017-12-01T11:16:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367232",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

Implementation bug aside, I've been working on fixing the sageinspect module, and that's increasingly convinced me that having a concise way to run specific test cases on either Python 2 or Python 3 only is useful, especially in that module.



---

archive/issue_comments_367233.json:
```json
{
    "body": "Changed commit from **[6f5fd8c](https://github.com/sagemath/sagetrac-mirror/commit/6f5fd8cfb06c4b7c7f9743e2559eca00c06f3a0f)** to **[e01e553](https://github.com/sagemath/sagetrac-mirror/commit/e01e5531b69e5a65642651efab85cf5bb496c8ee)**",
    "created_at": "2017-12-01T13:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367233",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6f5fd8c](https://github.com/sagemath/sagetrac-mirror/commit/6f5fd8cfb06c4b7c7f9743e2559eca00c06f3a0f)** to **[e01e553](https://github.com/sagemath/sagetrac-mirror/commit/e01e5531b69e5a65642651efab85cf5bb496c8ee)**



---

archive/issue_comments_367234.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e01e5531b69e5a65642651efab85cf5bb496c8ee\">e01e553</a></td><td><code>Add doctest flags for running tests on Python 2 only or Python 3 only.</code></td></tr></table>\n",
    "created_at": "2017-12-01T13:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367234",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e01e5531b69e5a65642651efab85cf5bb496c8ee">e01e553</a></td><td><code>Add doctest flags for running tests on Python 2 only or Python 3 only.</code></td></tr></table>




---

archive/issue_comments_367235.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOkay, this definitely works now.  My fixes to the sageinspect module (and in particular its tests) rely on this pretty heavily.",
    "created_at": "2017-12-01T13:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367235",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Okay, this definitely works now.  My fixes to the sageinspect module (and in particular its tests) rely on this pretty heavily.



---

archive/issue_events_336546.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T13:58:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336546"
}
```



---

archive/issue_events_336547.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-01T13:58:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336547"
}
```



---

archive/issue_comments_367236.json:
```json
{
    "body": "Changed commit from **[e01e553](https://github.com/sagemath/sagetrac-mirror/commit/e01e5531b69e5a65642651efab85cf5bb496c8ee)** to **[31f2008](https://github.com/sagemath/sagetrac-mirror/commit/31f2008835ab51a4a1fdbe8b14b7ef175494be01)**",
    "created_at": "2017-12-01T14:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367236",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e01e553](https://github.com/sagemath/sagetrac-mirror/commit/e01e5531b69e5a65642651efab85cf5bb496c8ee)** to **[31f2008](https://github.com/sagemath/sagetrac-mirror/commit/31f2008835ab51a4a1fdbe8b14b7ef175494be01)**



---

archive/issue_comments_367237.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31f2008835ab51a4a1fdbe8b14b7ef175494be01\">31f2008</a></td><td><code>Add doctest flags for running tests on Python 2 only or Python 3 only.</code></td></tr></table>\n",
    "created_at": "2017-12-01T14:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367237",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31f2008835ab51a4a1fdbe8b14b7ef175494be01">31f2008</a></td><td><code>Add doctest flags for running tests on Python 2 only or Python 3 only.</code></td></tr></table>




---

archive/issue_comments_367238.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment:4):\n> I considered something like that but it seems to have different semantics.  Currently \"optional - pkgname\" implies that a package is installed/available.  Here we don't care if python2/3 is available.  We care about what Python version is currently running the tests.\n\nRight, I get that. Still, I think that we already have enough (if not too many) special doctest markers. And even if `# optional` is typically used to check whether a package is installed, I think that the meaning of `# optional - python2` is clear enough.\n\nMoreover, there are already doctests using `# optional - python2` and `# optional - python3` referring to the current running version of Python.",
    "created_at": "2017-12-04T13:20:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367238",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment:4):
> I considered something like that but it seems to have different semantics.  Currently "optional - pkgname" implies that a package is installed/available.  Here we don't care if python2/3 is available.  We care about what Python version is currently running the tests.

Right, I get that. Still, I think that we already have enough (if not too many) special doctest markers. And even if `# optional` is typically used to check whether a package is installed, I think that the meaning of `# optional - python2` is clear enough.

Moreover, there are already doctests using `# optional - python2` and `# optional - python3` referring to the current running version of Python.



---

archive/issue_comments_367239.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment:14):\n> Replying to [@embray](#comment:4):\n> > I considered something like that but it seems to have different semantics.  Currently \"optional - pkgname\" implies that a package is installed/available.  Here we don't care if python2/3 is available.  We care about what Python version is currently running the tests.\n\n> \n> Right, I get that. Still, I think that we already have enough (if not too many) special \n\nThat's pretty subjective--I think \"enough\" is however many you need to write reasonable tests.\n\n> doctest markers. And even if `# optional` is typically used to check whether a package is installed, I think that the meaning of `# optional - python2` is clear enough.\n\nI don't.  It's overly wordy and not quite clear at all given the double meaning.\n\n> Moreover, there are already doctests using `# optional - python2` and `# optional - python3` referring to the current running version of Python.\n\nExcept those explicitly don't work right now.  I've already replaced a few examples using these markers.  Here's a concrete example that might help motivate:\n\n```\n                sage: import ast, sage.misc.sageinspect as sms  # py3\n                sage: visitor = sms.SageArgSpecVisitor()  # py3\n                sage: vis = lambda x: visitor.visit_NameConstant(ast.parse(x).body[0].value)  # py3\n                sage: [vis(n) for n in ['True', 'False', 'None']]  # py3\n                [True, False, None]\n                sage: [type(vis(n)) for n in ['True', 'False', 'None']]  # py3\n                [<type 'bool'>, <type 'bool'>, <type 'NoneType'>]\n```\n\nThis entire sequence of test commands is Python 3 only and does not even make sense on Python 2 (it might be nice to tag a whole range at once actually rather than every single line but that's a separate issue).  Putting \"# optional - python3\" on every one of those lines is just that much more line noise.",
    "created_at": "2017-12-04T13:27:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367239",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment:14):
> Replying to [@embray](#comment:4):
> > I considered something like that but it seems to have different semantics.  Currently "optional - pkgname" implies that a package is installed/available.  Here we don't care if python2/3 is available.  We care about what Python version is currently running the tests.

> 
> Right, I get that. Still, I think that we already have enough (if not too many) special 

That's pretty subjective--I think "enough" is however many you need to write reasonable tests.

> doctest markers. And even if `# optional` is typically used to check whether a package is installed, I think that the meaning of `# optional - python2` is clear enough.

I don't.  It's overly wordy and not quite clear at all given the double meaning.

> Moreover, there are already doctests using `# optional - python2` and `# optional - python3` referring to the current running version of Python.

Except those explicitly don't work right now.  I've already replaced a few examples using these markers.  Here's a concrete example that might help motivate:

```
                sage: import ast, sage.misc.sageinspect as sms  # py3
                sage: visitor = sms.SageArgSpecVisitor()  # py3
                sage: vis = lambda x: visitor.visit_NameConstant(ast.parse(x).body[0].value)  # py3
                sage: [vis(n) for n in ['True', 'False', 'None']]  # py3
                [True, False, None]
                sage: [type(vis(n)) for n in ['True', 'False', 'None']]  # py3
                [<type 'bool'>, <type 'bool'>, <type 'NoneType'>]
```

This entire sequence of test commands is Python 3 only and does not even make sense on Python 2 (it might be nice to tag a whole range at once actually rather than every single line but that's a separate issue).  Putting "# optional - python3" on every one of those lines is just that much more line noise.



---

archive/issue_events_336548.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-07T17:29:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336548"
}
```



---

archive/issue_events_336549.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-12-07T17:29:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336549"
}
```



---

archive/issue_comments_367240.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOK, fine. I don't really agree, but we have to move on. If you want to go forward with `# py2` and `# py3`, you should at least fix the existing uses of `# optional - python2` and `# optional - python3`. If you do that, I'm willing to set this ticket to positive review.",
    "created_at": "2017-12-07T17:29:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367240",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

OK, fine. I don't really agree, but we have to move on. If you want to go forward with `# py2` and `# py3`, you should at least fix the existing uses of `# optional - python2` and `# optional - python3`. If you do that, I'm willing to set this ticket to positive review.



---

archive/issue_comments_367241.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jdemeyer](#comment:16):\n> OK, fine. I don't really agree, but we have to move on. If you want to go forward with `# py2` and `# py3`, you should at least fix the existing uses of `# optional - python2` and `# optional - python3`. If you do that, I'm willing to set this ticket to positive review.\n\nI'm fixing those as I come to them, but fixing all of them at once would probably only hang this up longer.  Better to add the feature first and then switch to using it where it makes sense to on a case by case basis.",
    "created_at": "2017-12-08T09:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367241",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jdemeyer](#comment:16):
> OK, fine. I don't really agree, but we have to move on. If you want to go forward with `# py2` and `# py3`, you should at least fix the existing uses of `# optional - python2` and `# optional - python3`. If you do that, I'm willing to set this ticket to positive review.

I'm fixing those as I come to them, but fixing all of them at once would probably only hang this up longer.  Better to add the feature first and then switch to using it where it makes sense to on a case by case basis.



---

archive/issue_comments_367242.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nCome on, there are really few instances of `# optional - python[23]` currently in Sage. It doesn't take much effort to fix those. And those can also double as testcase that the `# py2` and `# py3` markers actually work.",
    "created_at": "2017-12-08T09:39:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367242",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Come on, there are really few instances of `# optional - python[23]` currently in Sage. It doesn't take much effort to fix those. And those can also double as testcase that the `# py2` and `# py3` markers actually work.



---

archive/issue_comments_367243.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAlright, I have no problem doing it (I'll have to double-check but I think I've already fixed most of those cases). It just seemed antithetical to your normal philosophy (which I generally agree with...)",
    "created_at": "2017-12-08T10:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367243",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Alright, I have no problem doing it (I'll have to double-check but I think I've already fixed most of those cases). It just seemed antithetical to your normal philosophy (which I generally agree with...)



---

archive/issue_comments_367244.json:
```json
{
    "body": "Changed commit from **[31f2008](https://github.com/sagemath/sagetrac-mirror/commit/31f2008835ab51a4a1fdbe8b14b7ef175494be01)** to **[c090076](https://github.com/sagemath/sagetrac-mirror/commit/c09007614f985868bd2a43c0f8e282aeb8de17b7)**",
    "created_at": "2017-12-08T11:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367244",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[31f2008](https://github.com/sagemath/sagetrac-mirror/commit/31f2008835ab51a4a1fdbe8b14b7ef175494be01)** to **[c090076](https://github.com/sagemath/sagetrac-mirror/commit/c09007614f985868bd2a43c0f8e282aeb8de17b7)**



---

archive/issue_comments_367245.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c09007614f985868bd2a43c0f8e282aeb8de17b7\">c090076</a></td><td><code>Fix a few more cases where '# optional - python2' wasn't really doing what was intended.</code></td></tr></table>\n",
    "created_at": "2017-12-08T11:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367245",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c09007614f985868bd2a43c0f8e282aeb8de17b7">c090076</a></td><td><code>Fix a few more cases where '# optional - python2' wasn't really doing what was intended.</code></td></tr></table>




---

archive/issue_events_336550.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T11:04:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336550"
}
```



---

archive/issue_events_336551.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-08T11:04:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336551"
}
```



---

archive/issue_comments_367246.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nNote: I also fixed one case of `# optional - python2` in #24286.",
    "created_at": "2017-12-08T11:04:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367246",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Note: I also fixed one case of `# optional - python2` in #24286.



---

archive/issue_comments_367247.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\ntypo : \"on optionl features\" in src/doc/en/developer/coding_basics.rst\n\none failing doctest in src/sage/doctest/sources.py",
    "created_at": "2017-12-14T15:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367247",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:22" align="right">comment:22</div>

typo : "on optionl features" in src/doc/en/developer/coding_basics.rst

one failing doctest in src/sage/doctest/sources.py



---

archive/issue_events_336552.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-14T15:45:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336552"
}
```



---

archive/issue_events_336553.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2017-12-14T15:45:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336553"
}
```



---

archive/issue_comments_367248.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nCan somebody explain the origin of this test?\n\n```\nsage -t --long src/sage/doctest/sources.py\n**********************************************************************\nFile \"src/sage/doctest/sources.py\", line 759, in sage.doctest.sources.FileDocTestSource._test_enough_doctests\nFailed example:\n    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time\n        path = os.path.relpath(path)\n        dirs.sort(); files.sort()\n        for F in files:\n            _, ext = os.path.splitext(F)\n            if ext in ('.py', '.pyx', '.pxd', '.pxi', '.sage', '.spyx', '.rst'):\n                filename = os.path.join(path, F)\n                FDS = FileDocTestSource(filename, DocTestDefaults(long=True,optional=True))\n                FDS._test_enough_doctests(verbose=False)\nExpected:\n    There are 7 tests in sage/combinat/diagram_algebras.py that are not being run\n    There are 7 tests in sage/combinat/dyck_word.py that are not being run\n    There are 7 tests in sage/combinat/finite_state_machine.py that are not being run\n    There are 6 tests in sage/combinat/interval_posets.py that are not being run\n    There are 18 tests in sage/combinat/partition.py that are not being run\n    There are 15 tests in sage/combinat/permutation.py that are not being run\n    There are 14 tests in sage/combinat/skew_partition.py that are not being run\n    There are 18 tests in sage/combinat/tableau.py that are not being run\n    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run\n    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run\n    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run\n    There are 3 unexpected tests being run in sage/doctest/parsing.py\n    There are 1 unexpected tests being run in sage/doctest/reporting.py\n    There are 15 tests in sage/manifolds/manifold.py that are not being run\n    There are 3 tests in sage/rings/invariant_theory.py that are not being run\nGot:\n    There are 7 tests in sage/combinat/diagram_algebras.py that are not being run\n    There are 7 tests in sage/combinat/dyck_word.py that are not being run\n    There are 7 tests in sage/combinat/finite_state_machine.py that are not being run\n    There are 6 tests in sage/combinat/interval_posets.py that are not being run\n    There are 18 tests in sage/combinat/partition.py that are not being run\n    There are 15 tests in sage/combinat/permutation.py that are not being run\n    There are 14 tests in sage/combinat/skew_partition.py that are not being run\n    There are 18 tests in sage/combinat/tableau.py that are not being run\n    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run\n    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run\n    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run\n    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run\n    There are 3 unexpected tests being run in sage/doctest/parsing.py\n    There are 1 unexpected tests being run in sage/doctest/reporting.py\n    There are 15 tests in sage/manifolds/manifold.py that are not being run\n    There are 1 tests in sage/misc/sage_eval.py that are not being run\n    There are 3 tests in sage/rings/invariant_theory.py that are not being run\n    There are 1 tests in sage/rings/finite_rings/integer_mod.pyx that are not being run\n**********************************************************************\n1 item had failures:\n   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests\n    [367 tests, 1 failure, 244.00 s]\n```\n\nIt's pretty awfully annoying to have a test whose output depends on the contents of a variety of specific modules.  If this is meant to be some kind of regression test (?) it's not clear, but surely it could be run without such a strong dependency on external data.",
    "created_at": "2017-12-15T11:23:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367248",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Can somebody explain the origin of this test?

```
sage -t --long src/sage/doctest/sources.py
**********************************************************************
File "src/sage/doctest/sources.py", line 759, in sage.doctest.sources.FileDocTestSource._test_enough_doctests
Failed example:
    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time
        path = os.path.relpath(path)
        dirs.sort(); files.sort()
        for F in files:
            _, ext = os.path.splitext(F)
            if ext in ('.py', '.pyx', '.pxd', '.pxi', '.sage', '.spyx', '.rst'):
                filename = os.path.join(path, F)
                FDS = FileDocTestSource(filename, DocTestDefaults(long=True,optional=True))
                FDS._test_enough_doctests(verbose=False)
Expected:
    There are 7 tests in sage/combinat/diagram_algebras.py that are not being run
    There are 7 tests in sage/combinat/dyck_word.py that are not being run
    There are 7 tests in sage/combinat/finite_state_machine.py that are not being run
    There are 6 tests in sage/combinat/interval_posets.py that are not being run
    There are 18 tests in sage/combinat/partition.py that are not being run
    There are 15 tests in sage/combinat/permutation.py that are not being run
    There are 14 tests in sage/combinat/skew_partition.py that are not being run
    There are 18 tests in sage/combinat/tableau.py that are not being run
    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run
    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run
    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 15 tests in sage/manifolds/manifold.py that are not being run
    There are 3 tests in sage/rings/invariant_theory.py that are not being run
Got:
    There are 7 tests in sage/combinat/diagram_algebras.py that are not being run
    There are 7 tests in sage/combinat/dyck_word.py that are not being run
    There are 7 tests in sage/combinat/finite_state_machine.py that are not being run
    There are 6 tests in sage/combinat/interval_posets.py that are not being run
    There are 18 tests in sage/combinat/partition.py that are not being run
    There are 15 tests in sage/combinat/permutation.py that are not being run
    There are 14 tests in sage/combinat/skew_partition.py that are not being run
    There are 18 tests in sage/combinat/tableau.py that are not being run
    There are 8 tests in sage/combinat/crystals/tensor_product.py that are not being run
    There are 11 tests in sage/combinat/rigged_configurations/rigged_configurations.py that are not being run
    There are 15 tests in sage/combinat/root_system/cartan_type.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_A.py that are not being run
    There are 8 tests in sage/combinat/root_system/type_G.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 15 tests in sage/manifolds/manifold.py that are not being run
    There are 1 tests in sage/misc/sage_eval.py that are not being run
    There are 3 tests in sage/rings/invariant_theory.py that are not being run
    There are 1 tests in sage/rings/finite_rings/integer_mod.pyx that are not being run
**********************************************************************
1 item had failures:
   1 of   9 in sage.doctest.sources.FileDocTestSource._test_enough_doctests
    [367 tests, 1 failure, 244.00 s]
```

It's pretty awfully annoying to have a test whose output depends on the contents of a variety of specific modules.  If this is meant to be some kind of regression test (?) it's not clear, but surely it could be run without such a strong dependency on external data.



---

archive/issue_comments_367249.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI really don't understand what to do with this test.  It's like it's testing the doctest parser by using a different, simpler doctest parser that doesn't fully work, and comparing the results from that parser to the results from the actual doctest parser.  If we want to check that the actual doctest parser works then there should be (and are) unit tests for the code of the actual doctest parser.  As it is this test is just testing the secondary, flakier doctest parser implemented in the test...",
    "created_at": "2017-12-15T11:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367249",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

I really don't understand what to do with this test.  It's like it's testing the doctest parser by using a different, simpler doctest parser that doesn't fully work, and comparing the results from that parser to the results from the actual doctest parser.  If we want to check that the actual doctest parser works then there should be (and are) unit tests for the code of the actual doctest parser.  As it is this test is just testing the secondary, flakier doctest parser implemented in the test...



---

archive/issue_comments_367250.json:
```json
{
    "body": "Changed commit from **[c090076](https://github.com/sagemath/sagetrac-mirror/commit/c09007614f985868bd2a43c0f8e282aeb8de17b7)** to **[96127eb](https://github.com/sagemath/sagetrac-mirror/commit/96127ebd7f23c774b4c5c6619962f8dcb8bc2ae5)**",
    "created_at": "2017-12-15T11:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367250",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c090076](https://github.com/sagemath/sagetrac-mirror/commit/c09007614f985868bd2a43c0f8e282aeb8de17b7)** to **[96127eb](https://github.com/sagemath/sagetrac-mirror/commit/96127ebd7f23c774b4c5c6619962f8dcb8bc2ae5)**



---

archive/issue_comments_367251.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/96127ebd7f23c774b4c5c6619962f8dcb8bc2ae5\">96127eb</a></td><td><code>Fix typo</code></td></tr></table>\n",
    "created_at": "2017-12-15T11:48:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367251",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/96127ebd7f23c774b4c5c6619962f8dcb8bc2ae5">96127eb</a></td><td><code>Fix typo</code></td></tr></table>




---

archive/issue_events_336554.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-18T16:36:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336554"
}
```



---

archive/issue_events_336555.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-18T16:36:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336555"
}
```



---

archive/issue_comments_367252.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nTo solve your problem with `_test_enough_doctests`, you could add some extra attribute to `SageDocTestParser` to never skip any test (not even the `# py2` and `# py3` tests). Then you set that attribute when running `_test_enough_doctests`.",
    "created_at": "2017-12-19T12:27:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367252",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

To solve your problem with `_test_enough_doctests`, you could add some extra attribute to `SageDocTestParser` to never skip any test (not even the `# py2` and `# py3` tests). Then you set that attribute when running `_test_enough_doctests`.



---

archive/issue_comments_367253.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI'd still just as soon remove that test...",
    "created_at": "2018-01-02T15:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367253",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

I'd still just as soon remove that test...



---

archive/issue_comments_367254.json:
```json
{
    "body": "Changed branch from **[u/embray/python3/doctest-py2-only](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/doctest-py2-only)** to **[u/jdemeyer/python3/doctest-py2-only](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/doctest-py2-only)**",
    "created_at": "2018-01-05T10:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367254",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/python3/doctest-py2-only](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/doctest-py2-only)** to **[u/jdemeyer/python3/doctest-py2-only](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/doctest-py2-only)**



---

archive/issue_events_336556.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-05T10:19:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336556"
}
```



---

archive/issue_events_336557.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-01-05T10:19:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336557"
}
```



---

archive/issue_comments_367255.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nThis variant re-uses the existing optional tags implementation. It passes all tests in `sage/doctest`.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/39c71a222dddc426e23ac733c96c0bdb90a8d18b\">39c71a2</a></td><td><code>Add doctest flags for running tests on Python 2 only or Python 3 only.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fcea7e739d5be87349d1fb11581cdfecf980af3\">1fcea7e</a></td><td><code>Better fix for this doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470\">12c300a</a></td><td><code>Automatically add py2/py3 optional tag</code></td></tr></table>\n",
    "created_at": "2018-01-05T10:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367255",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

This variant re-uses the existing optional tags implementation. It passes all tests in `sage/doctest`.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/39c71a222dddc426e23ac733c96c0bdb90a8d18b">39c71a2</a></td><td><code>Add doctest flags for running tests on Python 2 only or Python 3 only.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fcea7e739d5be87349d1fb11581cdfecf980af3">1fcea7e</a></td><td><code>Better fix for this doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470">12c300a</a></td><td><code>Automatically add py2/py3 optional tag</code></td></tr></table>




---

archive/issue_comments_367256.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, Jeroen Demeyer**",
    "created_at": "2018-01-05T10:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367256",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **Erik Bray** to **Erik Bray, Jeroen Demeyer**



---

archive/issue_comments_367257.json:
```json
{
    "body": "Changed commit from **[96127eb](https://github.com/sagemath/sagetrac-mirror/commit/96127ebd7f23c774b4c5c6619962f8dcb8bc2ae5)** to **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)**",
    "created_at": "2018-01-05T10:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367257",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[96127eb](https://github.com/sagemath/sagetrac-mirror/commit/96127ebd7f23c774b4c5c6619962f8dcb8bc2ae5)** to **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)**



---

archive/issue_comments_367258.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI don't fully understand what this is doing differently, but I'm not opposed as long as it works.",
    "created_at": "2018-01-05T12:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367258",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

I don't fully understand what this is doing differently, but I'm not opposed as long as it works.



---

archive/issue_comments_367259.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@embray](#comment:32):\n> I'm not opposed\n\nIs that a subtle way to say \"positive review\"?",
    "created_at": "2018-01-05T12:47:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367259",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@embray](#comment:32):
> I'm not opposed

Is that a subtle way to say "positive review"?



---

archive/issue_comments_367260.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThis seems to be ready to go, no ?",
    "created_at": "2018-01-06T19:21:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367260",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:34" align="right">comment:34</div>

This seems to be ready to go, no ?



---

archive/issue_events_336558.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-08T16:42:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336558"
}
```



---

archive/issue_events_336559.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-01-08T16:42:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336559"
}
```



---

archive/issue_comments_367261.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nok, let it be. Erik and Jeroen, I added your names as reviewers. Feel free to undo that.",
    "created_at": "2018-01-08T16:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367261",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:35" align="right">comment:35</div>

ok, let it be. Erik and Jeroen, I added your names as reviewers. Feel free to undo that.



---

archive/issue_comments_367262.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, Erik Bray, Jeroen Demeyer**",
    "created_at": "2018-01-08T16:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367262",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton, Erik Bray, Jeroen Demeyer**



---

archive/issue_comments_367263.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nYes, I understand how this is working now. +1",
    "created_at": "2018-01-09T13:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367263",
    "user": "https://github.com/embray"
}
```

<div id="comment:36" align="right">comment:36</div>

Yes, I understand how this is working now. +1



---

archive/issue_comments_367264.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/python3/doctest-py2-only](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/doctest-py2-only)** to **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)**",
    "created_at": "2018-01-14T10:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367264",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/python3/doctest-py2-only](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/python3/doctest-py2-only)** to **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)**



---

archive/issue_events_336560.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-14T10:14:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336560"
}
```



---

archive/issue_events_336561.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0d1bcf2ab572c863ae32d3ffdeb0d4539f9f0e36",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-01-14T10:14:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24261#event-336561"
}
```



---

archive/issue_comments_367265.json:
```json
{
    "body": "Changed commit from **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)** to none",
    "created_at": "2018-01-19T15:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367265",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[12c300a](https://github.com/sagemath/sagetrac-mirror/commit/12c300aad31ee72ea569134b35a94baed7efa470)** to none



---

archive/issue_comments_367266.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nfollow-up in #24570",
    "created_at": "2018-01-19T15:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24261",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24261#issuecomment-367266",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:38" align="right">comment:38</div>

follow-up in #24570
