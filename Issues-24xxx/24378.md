# Issue 24378: complex_root_of uses inexact index

archive/issues_024141.json:
```json
{
    "body": "When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-point number:\n\n```\nsage: complex_root_of(x^8-1, 7).n(2)\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-1-4eba84b7c14c> in <module>()\n----> 1 complex_root_of(x**Integer(8)-Integer(1), Integer(7)).n(Integer(2))\n\n/home/patchbot/sage-patchbot/src/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)()\n    863             0.666666666666667\n    864         \"\"\"\n--> 865         return self.numerical_approx(prec, digits, algorithm)\n    866 \n    867     N = deprecated_function_alias(13055, n)\n\n/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36209)()\n   5818         kwds = {'parent': R, 'algorithm': algorithm}\n   5819         try:\n-> 5820             x = x._convert(kwds)\n   5821         except TypeError: # numerical approximation for real number failed\n   5822             pass          # try again with complex\n\n/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)()\n   1257         sig_on()\n   1258         try:\n-> 1259             res = self._gobj.evalf(0, kwds)\n   1260         finally:\n   1261             sig_off()\n\n/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.pyc in _evalf_(self, poly, index, parent, algorithm)\n   2918         except AttributeError:\n   2919             prec = 53\n-> 2920         sobj = CRootOf(Poly(poly._sympy_()), int(index))\n   2921         return sobj.n(ceil(prec*3/10))._sage_()\n   2922 \n\n/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sympy/polys/rootoftools.pyc in __new__(cls, f, x, index, radicals, expand)\n    130         if index < -degree or index >= degree:\n    131             raise IndexError(\"root index out of [%d, %d] range, got %d\" %\n--> 132                              (-degree, degree - 1, index))\n    133         elif index < 0:\n    134             index += degree\n\nIndexError: root index out of [-8, 7] range, got 8\n```\n\nWhen `gmpy2` is installed, the index is even passed as complex number:\n\n```\nsage -t --long src/sage/functions/other.py\n**********************************************************************\nFile \"src/sage/functions/other.py\", line 2862, in sage.functions.other.Function_crootof\nFailed example:\n    c.n()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.functions.other.Function_crootof[1]>\", line 1, in <module>\n        c.n()\n      File \"sage/structure/element.pyx\", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)\n        return self.numerical_approx(prec, digits, algorithm)\n      File \"sage/symbolic/expression.pyx\", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)\n        x = x._convert(kwds)\n      File \"sage/symbolic/expression.pyx\", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)\n        res = self._gobj.evalf(0, kwds)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py\", line 2920, in _evalf_\n        sobj = CRootOf(Poly(poly._sympy_()), int(index))\n      File \"sage/rings/complex_number.pyx\", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)\n        raise TypeError(\"can't convert complex to int; use int(abs(z))\")\n    TypeError: can't convert complex to int; use int(abs(z))\n**********************************************************************\nFile \"src/sage/functions/other.py\", line 2864, in sage.functions.other.Function_crootof\nFailed example:\n    c.n(100)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.functions.other.Function_crootof[2]>\", line 1, in <module>\n        c.n(Integer(100))\n      File \"sage/structure/element.pyx\", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)\n        return self.numerical_approx(prec, digits, algorithm)\n      File \"sage/symbolic/expression.pyx\", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)\n        x = x._convert(kwds)\n      File \"sage/symbolic/expression.pyx\", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)\n        res = self._gobj.evalf(0, kwds)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py\", line 2920, in _evalf_\n        sobj = CRootOf(Poly(poly._sympy_()), int(index))\n      File \"sage/rings/complex_number.pyx\", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)\n        raise TypeError(\"can't convert complex to int; use int(abs(z))\")\n    TypeError: can't convert complex to int; use int(abs(z))\n**********************************************************************\nFile \"src/sage/functions/other.py\", line 2866, in sage.functions.other.Function_crootof\nFailed example:\n    (c^6 + c + 1).n(100) < 1e-25\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.functions.other.Function_crootof[3]>\", line 1, in <module>\n        (c**Integer(6) + c + Integer(1)).n(Integer(100)) < RealNumber('1e-25')\n      File \"sage/structure/element.pyx\", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)\n        return self.numerical_approx(prec, digits, algorithm)\n      File \"sage/symbolic/expression.pyx\", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)\n        x = x._convert(kwds)\n      File \"sage/symbolic/expression.pyx\", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)\n        res = self._gobj.evalf(0, kwds)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py\", line 2920, in _evalf_\n        sobj = CRootOf(Poly(poly._sympy_()), int(index))\n      File \"sage/rings/complex_number.pyx\", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)\n        raise TypeError(\"can't convert complex to int; use int(abs(z))\")\n    TypeError: can't convert complex to int; use int(abs(z))\n**********************************************************************\nFile \"src/sage/functions/other.py\", line 2908, in sage.functions.other.Function_crootof._evalf_\nFailed example:\n    complex_root_of(x^2-2, 1).n()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.functions.other.Function_crootof._evalf_[0]>\", line 1, in <module>\n        complex_root_of(x**Integer(2)-Integer(2), Integer(1)).n()\n      File \"sage/structure/element.pyx\", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)\n        return self.numerical_approx(prec, digits, algorithm)\n      File \"sage/symbolic/expression.pyx\", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)\n        x = x._convert(kwds)\n      File \"sage/symbolic/expression.pyx\", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)\n        res = self._gobj.evalf(0, kwds)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py\", line 2920, in _evalf_\n        sobj = CRootOf(Poly(poly._sympy_()), int(index))\n      File \"sage/rings/complex_number.pyx\", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)\n        raise TypeError(\"can't convert complex to int; use int(abs(z))\")\n    TypeError: can't convert complex to int; use int(abs(z))\n**********************************************************************\n2 items had failures:\n   3 of   5 in sage.functions.other.Function_crootof\n   1 of   3 in sage.functions.other.Function_crootof._evalf_\n    [622 tests, 4 failures, 17.27 s]  \nsage -t --long src/sage/interfaces/sympy.py\n**********************************************************************\nFile \"src/sage/interfaces/sympy.py\", line 617, in sage.interfaces.sympy._sympysage_crootof\nFailed example:\n    (sols[0]+1)._sage_().n()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 517, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 920, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.sympy._sympysage_crootof[6]>\", line 1, in <module>\n        (sols[Integer(0)]+Integer(1))._sage_().n()\n      File \"sage/structure/element.pyx\", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)\n        return self.numerical_approx(prec, digits, algorithm)\n      File \"sage/symbolic/expression.pyx\", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)\n        x = x._convert(kwds)\n      File \"sage/symbolic/expression.pyx\", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)\n        res = self._gobj.evalf(0, kwds)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py\", line 2920, in _evalf_\n        sobj = CRootOf(Poly(poly._sympy_()), int(index))\n      File \"sage/rings/complex_number.pyx\", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)\n        raise TypeError(\"can't convert complex to int; use int(abs(z))\")\n    TypeError: can't convert complex to int; use int(abs(z))\n**********************************************************************\n1 item had failures:\n   1 of   8 in sage.interfaces.sympy._sympysage_crootof\n    [218 tests, 1 failure, 3.27 s]\n```\n\n**CC:**  @rwst @EmmanuelCharpentier\n\n**Branch/Commit:** [277a403ef00692247f9853d89322f9a464abd471](https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Ralf Stephan\n\nIssue created by migration from https://trac.sagemath.org/ticket/24378\n\n",
    "closed_at": "2017-12-26T09:25:47Z",
    "created_at": "2017-12-15T09:38:20Z",
    "labels": [
        "component: symbolics",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "complex_root_of uses inexact index",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24378",
    "user": "https://github.com/jdemeyer"
}
```
When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-point number:

```
sage: complex_root_of(x^8-1, 7).n(2)
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-1-4eba84b7c14c> in <module>()
----> 1 complex_root_of(x**Integer(8)-Integer(1), Integer(7)).n(Integer(2))

/home/patchbot/sage-patchbot/src/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)()
    863             0.666666666666667
    864         """
--> 865         return self.numerical_approx(prec, digits, algorithm)
    866 
    867     N = deprecated_function_alias(13055, n)

/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36209)()
   5818         kwds = {'parent': R, 'algorithm': algorithm}
   5819         try:
-> 5820             x = x._convert(kwds)
   5821         except TypeError: # numerical approximation for real number failed
   5822             pass          # try again with complex

/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)()
   1257         sig_on()
   1258         try:
-> 1259             res = self._gobj.evalf(0, kwds)
   1260         finally:
   1261             sig_off()

/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.pyc in _evalf_(self, poly, index, parent, algorithm)
   2918         except AttributeError:
   2919             prec = 53
-> 2920         sobj = CRootOf(Poly(poly._sympy_()), int(index))
   2921         return sobj.n(ceil(prec*3/10))._sage_()
   2922 

/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sympy/polys/rootoftools.pyc in __new__(cls, f, x, index, radicals, expand)
    130         if index < -degree or index >= degree:
    131             raise IndexError("root index out of [%d, %d] range, got %d" %
--> 132                              (-degree, degree - 1, index))
    133         elif index < 0:
    134             index += degree

IndexError: root index out of [-8, 7] range, got 8
```

When `gmpy2` is installed, the index is even passed as complex number:

```
sage -t --long src/sage/functions/other.py
**********************************************************************
File "src/sage/functions/other.py", line 2862, in sage.functions.other.Function_crootof
Failed example:
    c.n()
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.functions.other.Function_crootof[1]>", line 1, in <module>
        c.n()
      File "sage/structure/element.pyx", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)
        return self.numerical_approx(prec, digits, algorithm)
      File "sage/symbolic/expression.pyx", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)
        x = x._convert(kwds)
      File "sage/symbolic/expression.pyx", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)
        res = self._gobj.evalf(0, kwds)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py", line 2920, in _evalf_
        sobj = CRootOf(Poly(poly._sympy_()), int(index))
      File "sage/rings/complex_number.pyx", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)
        raise TypeError("can't convert complex to int; use int(abs(z))")
    TypeError: can't convert complex to int; use int(abs(z))
**********************************************************************
File "src/sage/functions/other.py", line 2864, in sage.functions.other.Function_crootof
Failed example:
    c.n(100)
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.functions.other.Function_crootof[2]>", line 1, in <module>
        c.n(Integer(100))
      File "sage/structure/element.pyx", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)
        return self.numerical_approx(prec, digits, algorithm)
      File "sage/symbolic/expression.pyx", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)
        x = x._convert(kwds)
      File "sage/symbolic/expression.pyx", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)
        res = self._gobj.evalf(0, kwds)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py", line 2920, in _evalf_
        sobj = CRootOf(Poly(poly._sympy_()), int(index))
      File "sage/rings/complex_number.pyx", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)
        raise TypeError("can't convert complex to int; use int(abs(z))")
    TypeError: can't convert complex to int; use int(abs(z))
**********************************************************************
File "src/sage/functions/other.py", line 2866, in sage.functions.other.Function_crootof
Failed example:
    (c^6 + c + 1).n(100) < 1e-25
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.functions.other.Function_crootof[3]>", line 1, in <module>
        (c**Integer(6) + c + Integer(1)).n(Integer(100)) < RealNumber('1e-25')
      File "sage/structure/element.pyx", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)
        return self.numerical_approx(prec, digits, algorithm)
      File "sage/symbolic/expression.pyx", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)
        x = x._convert(kwds)
      File "sage/symbolic/expression.pyx", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)
        res = self._gobj.evalf(0, kwds)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py", line 2920, in _evalf_
        sobj = CRootOf(Poly(poly._sympy_()), int(index))
      File "sage/rings/complex_number.pyx", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)
        raise TypeError("can't convert complex to int; use int(abs(z))")
    TypeError: can't convert complex to int; use int(abs(z))
**********************************************************************
File "src/sage/functions/other.py", line 2908, in sage.functions.other.Function_crootof._evalf_
Failed example:
    complex_root_of(x^2-2, 1).n()
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.functions.other.Function_crootof._evalf_[0]>", line 1, in <module>
        complex_root_of(x**Integer(2)-Integer(2), Integer(1)).n()
      File "sage/structure/element.pyx", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)
        return self.numerical_approx(prec, digits, algorithm)
      File "sage/symbolic/expression.pyx", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)
        x = x._convert(kwds)
      File "sage/symbolic/expression.pyx", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)
        res = self._gobj.evalf(0, kwds)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py", line 2920, in _evalf_
        sobj = CRootOf(Poly(poly._sympy_()), int(index))
      File "sage/rings/complex_number.pyx", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)
        raise TypeError("can't convert complex to int; use int(abs(z))")
    TypeError: can't convert complex to int; use int(abs(z))
**********************************************************************
2 items had failures:
   3 of   5 in sage.functions.other.Function_crootof
   1 of   3 in sage.functions.other.Function_crootof._evalf_
    [622 tests, 4 failures, 17.27 s]  
sage -t --long src/sage/interfaces/sympy.py
**********************************************************************
File "src/sage/interfaces/sympy.py", line 617, in sage.interfaces.sympy._sympysage_crootof
Failed example:
    (sols[0]+1)._sage_().n()
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 517, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 920, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.sympy._sympysage_crootof[6]>", line 1, in <module>
        (sols[Integer(0)]+Integer(1))._sage_().n()
      File "sage/structure/element.pyx", line 865, in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)
        return self.numerical_approx(prec, digits, algorithm)
      File "sage/symbolic/expression.pyx", line 5824, in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36286)
        x = x._convert(kwds)
      File "sage/symbolic/expression.pyx", line 1259, in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)
        res = self._gobj.evalf(0, kwds)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.py", line 2920, in _evalf_
        sobj = CRootOf(Poly(poly._sympy_()), int(index))
      File "sage/rings/complex_number.pyx", line 1058, in sage.rings.complex_number.ComplexNumber.__int__ (build/cythonized/sage/rings/complex_number.c:10918)
        raise TypeError("can't convert complex to int; use int(abs(z))")
    TypeError: can't convert complex to int; use int(abs(z))
**********************************************************************
1 item had failures:
   1 of   8 in sage.interfaces.sympy._sympysage_crootof
    [218 tests, 1 failure, 3.27 s]
```

**CC:**  @rwst @EmmanuelCharpentier

**Branch/Commit:** [277a403ef00692247f9853d89322f9a464abd471](https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471)

**Reviewer:** Jeroen Demeyer

**Author:** Ralf Stephan

Issue created by migration from https://trac.sagemath.org/ticket/24378





---

archive/issue_events_070391.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "rename": {
        "from": "Doctest failures related to sympy",
        "to": "Doctest failures related to sympy CRootOf"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24378#event-70391"
}
```



---

archive/issue_comments_441162.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On two patchbots which have many optional packages installed:\n+On several machines (all of which have various optional packages installed), I get this:\n \n ```\n sage -t --long src/sage/functions/other.py\n``````\n",
    "created_at": "2017-12-15T09:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441162",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On two patchbots which have many optional packages installed:
+On several machines (all of which have various optional packages installed), I get this:
 
 ```
 sage -t --long src/sage/functions/other.py
``````




---

archive/issue_comments_441163.json:
```json
{
    "body": "**Branch:** [u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)",
    "created_at": "2017-12-15T10:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441163",
    "user": "https://github.com/rwst"
}
```

**Branch:** [u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)



---

archive/issue_comments_441164.json:
```json
{
    "body": "<a id='comment:4'></a>\nThat exact arguments are made inexact is a bug in itself. But that they are made complex (EDIT: in some machines) is beyond me.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a93662faed523eb117f4ce0197b3178855849fd2\">a93662f</a></td><td><code>24378: Doctest failures related to sympy</code></td></tr></table>\n",
    "created_at": "2017-12-15T10:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441164",
    "user": "https://github.com/rwst"
}
```

<a id='comment:4'></a>
That exact arguments are made inexact is a bug in itself. But that they are made complex (EDIT: in some machines) is beyond me.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a93662faed523eb117f4ce0197b3178855849fd2">a93662f</a></td><td><code>24378: Doctest failures related to sympy</code></td></tr></table>




---

archive/issue_comments_441165.json:
```json
{
    "body": "**Commit:** [a93662faed523eb117f4ce0197b3178855849fd2](https://github.com/sagemath/sagetrac-mirror/commit/a93662faed523eb117f4ce0197b3178855849fd2)",
    "created_at": "2017-12-15T10:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441165",
    "user": "https://github.com/rwst"
}
```

**Commit:** [a93662faed523eb117f4ce0197b3178855849fd2](https://github.com/sagemath/sagetrac-mirror/commit/a93662faed523eb117f4ce0197b3178855849fd2)



---

archive/issue_comments_441166.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2017-12-15T10:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441166",
    "user": "https://github.com/rwst"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_441167.json:
```json
{
    "body": "**Author:** Ralf Stephan",
    "created_at": "2017-12-15T10:05:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441167",
    "user": "https://github.com/rwst"
}
```

**Author:** Ralf Stephan



---

archive/issue_comments_441168.json:
```json
{
    "body": "<a id='comment:5'></a>\nDo you have an idea why this depends on the system?",
    "created_at": "2017-12-15T10:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441168",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Do you have an idea why this depends on the system?



---

archive/issue_comments_441169.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [rws](#comment%3A4):\n> That exact arguments are made inexact is a bug in itself. But that they are made complex (EDIT: in some machines) is beyond me.\n\n\nDo you know where this happens? It seems to me that it is Pynac doing this.",
    "created_at": "2017-12-15T10:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441169",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [rws](#comment%3A4):
> That exact arguments are made inexact is a bug in itself. But that they are made complex (EDIT: in some machines) is beyond me.


Do you know where this happens? It seems to me that it is Pynac doing this.



---

archive/issue_comments_441170.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On several machines (all of which have various optional packages installed), I get this:\n+When `gmpy2` is installed:\n \n ```\n sage -t --long src/sage/functions/other.py\n``````\n",
    "created_at": "2017-12-15T11:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441170",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On several machines (all of which have various optional packages installed), I get this:
+When `gmpy2` is installed:
 
 ```
 sage -t --long src/sage/functions/other.py
``````




---

archive/issue_comments_441171.json:
```json
{
    "body": "<a id='comment:8'></a>\nSome sympy behavior depends on the presence/absence of gmpy2. We had this trouble before the upgrade.",
    "created_at": "2017-12-15T11:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441171",
    "user": "https://github.com/videlec"
}
```

<a id='comment:8'></a>
Some sympy behavior depends on the presence/absence of gmpy2. We had this trouble before the upgrade.



---

archive/issue_events_070392.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "rename": {
        "from": "Doctest failures related to sympy CRootOf",
        "to": "complex_root_of uses inexact index"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24378#event-70392"
}
```



---

archive/issue_comments_441172.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,51 @@\n-When `gmpy2` is installed:\n+When numerically evaluating `complex_root_of(a, k)`, the index `k` is passes as real number:\n+\n+```\n+sage: complex_root_of(x^8-1, 7).n(2)\n+---------------------------------------------------------------------------\n+IndexError                                Traceback (most recent call last)\n+<ipython-input-4-4eba84b7c14c> in <module>()\n+----> 1 complex_root_of(x**Integer(8)-Integer(1), Integer(7)).n(Integer(2))\n+\n+/home/patchbot/sage-patchbot/src/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)()\n+    863             0.666666666666667\n+    864         \"\"\"\n+--> 865         return self.numerical_approx(prec, digits, algorithm)\n+    866 \n+    867     N = deprecated_function_alias(13055, n)\n+\n+/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36209)()\n+   5818         kwds = {'parent': R, 'algorithm': algorithm}\n+   5819         try:\n+-> 5820             x = x._convert(kwds)\n+   5821         except TypeError: # numerical approximation for real number failed\n+   5822             pass          # try again with complex\n+\n+/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)()\n+   1257         sig_on()\n+   1258         try:\n+-> 1259             res = self._gobj.evalf(0, kwds)\n+   1260         finally:\n+   1261             sig_off()\n+\n+/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.pyc in _evalf_(self, poly, index, parent, algorithm)\n+   2920         print(\"index: {}\".format(index))\n+   2921         print(\"type(index): {}\".format(type(index)))\n+-> 2922         sobj = CRootOf(Poly(poly._sympy_()), int(index))\n+   2923         return sobj.n(ceil(prec*3/10))._sage_()\n+   2924 \n+\n+/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sympy/polys/rootoftools.pyc in __new__(cls, f, x, index, radicals, expand)\n+    130         if index < -degree or index >= degree:\n+    131             raise IndexError(\"root index out of [%d, %d] range, got %d\" %\n+--> 132                              (-degree, degree - 1, index))\n+    133         elif index < 0:\n+    134             index += degree\n+\n+IndexError: root index out of [-8, 7] range, got 8\n+```\n+\n+When `gmpy2` is installed, the index is even passed as complex number:\n \n ```\n sage -t --long src/sage/functions/other.py\n``````\n",
    "created_at": "2017-12-15T11:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441172",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,51 @@
-When `gmpy2` is installed:
+When numerically evaluating `complex_root_of(a, k)`, the index `k` is passes as real number:
+
+```
+sage: complex_root_of(x^8-1, 7).n(2)
+---------------------------------------------------------------------------
+IndexError                                Traceback (most recent call last)
+<ipython-input-4-4eba84b7c14c> in <module>()
+----> 1 complex_root_of(x**Integer(8)-Integer(1), Integer(7)).n(Integer(2))
+
+/home/patchbot/sage-patchbot/src/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)()
+    863             0.666666666666667
+    864         """
+--> 865         return self.numerical_approx(prec, digits, algorithm)
+    866 
+    867     N = deprecated_function_alias(13055, n)
+
+/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.numerical_approx (build/cythonized/sage/symbolic/expression.cpp:36209)()
+   5818         kwds = {'parent': R, 'algorithm': algorithm}
+   5819         try:
+-> 5820             x = x._convert(kwds)
+   5821         except TypeError: # numerical approximation for real number failed
+   5822             pass          # try again with complex
+
+/home/patchbot/sage-patchbot/src/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._convert (build/cythonized/sage/symbolic/expression.cpp:10663)()
+   1257         sig_on()
+   1258         try:
+-> 1259             res = self._gobj.evalf(0, kwds)
+   1260         finally:
+   1261             sig_off()
+
+/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.pyc in _evalf_(self, poly, index, parent, algorithm)
+   2920         print("index: {}".format(index))
+   2921         print("type(index): {}".format(type(index)))
+-> 2922         sobj = CRootOf(Poly(poly._sympy_()), int(index))
+   2923         return sobj.n(ceil(prec*3/10))._sage_()
+   2924 
+
+/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sympy/polys/rootoftools.pyc in __new__(cls, f, x, index, radicals, expand)
+    130         if index < -degree or index >= degree:
+    131             raise IndexError("root index out of [%d, %d] range, got %d" %
+--> 132                              (-degree, degree - 1, index))
+    133         elif index < 0:
+    134             index += degree
+
+IndexError: root index out of [-8, 7] range, got 8
+```
+
+When `gmpy2` is installed, the index is even passed as complex number:
 
 ```
 sage -t --long src/sage/functions/other.py
``````




---

archive/issue_comments_441173.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [rws](#comment%3A4):\n> That exact arguments are made inexact is a bug in itself.\n\n\nRight, this ticket should just fix that.",
    "created_at": "2017-12-15T11:14:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441173",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [rws](#comment%3A4):
> That exact arguments are made inexact is a bug in itself.


Right, this ticket should just fix that.



---

archive/issue_comments_441174.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-12-15T11:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441174",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_441175.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-When numerically evaluating `complex_root_of(a, k)`, the index `k` is passes as real number:\n+When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-poing number:\n \n ```\n sage: complex_root_of(x^8-1, 7).n(2)\n``````\n",
    "created_at": "2017-12-15T11:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441175",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-When numerically evaluating `complex_root_of(a, k)`, the index `k` is passes as real number:
+When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-poing number:
 
 ```
 sage: complex_root_of(x^8-1, 7).n(2)
``````




---

archive/issue_comments_441176.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-poing number:\n+When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-point number:\n \n ```\n sage: complex_root_of(x^8-1, 7).n(2)\n``````\n",
    "created_at": "2017-12-15T11:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441176",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-poing number:
+When numerically evaluating `complex_root_of(a, k)`, the index `k` is passed as floating-point number:
 
 ```
 sage: complex_root_of(x^8-1, 7).n(2)
``````




---

archive/issue_comments_441177.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n sage: complex_root_of(x^8-1, 7).n(2)\n ---------------------------------------------------------------------------\n IndexError                                Traceback (most recent call last)\n-<ipython-input-4-4eba84b7c14c> in <module>()\n+<ipython-input-1-4eba84b7c14c> in <module>()\n ----> 1 complex_root_of(x**Integer(8)-Integer(1), Integer(7)).n(Integer(2))\n \n /home/patchbot/sage-patchbot/src/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)()\n@@ -29,11 +29,11 @@\n    1261             sig_off()\n \n /home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.pyc in _evalf_(self, poly, index, parent, algorithm)\n-   2920         print(\"index: {}\".format(index))\n-   2921         print(\"type(index): {}\".format(type(index)))\n--> 2922         sobj = CRootOf(Poly(poly._sympy_()), int(index))\n-   2923         return sobj.n(ceil(prec*3/10))._sage_()\n-   2924 \n+   2918         except AttributeError:\n+   2919             prec = 53\n+-> 2920         sobj = CRootOf(Poly(poly._sympy_()), int(index))\n+   2921         return sobj.n(ceil(prec*3/10))._sage_()\n+   2922 \n \n /home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sympy/polys/rootoftools.pyc in __new__(cls, f, x, index, radicals, expand)\n     130         if index < -degree or index >= degree:\n``````\n",
    "created_at": "2017-12-15T11:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441177",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 sage: complex_root_of(x^8-1, 7).n(2)
 ---------------------------------------------------------------------------
 IndexError                                Traceback (most recent call last)
-<ipython-input-4-4eba84b7c14c> in <module>()
+<ipython-input-1-4eba84b7c14c> in <module>()
 ----> 1 complex_root_of(x**Integer(8)-Integer(1), Integer(7)).n(Integer(2))
 
 /home/patchbot/sage-patchbot/src/sage/structure/element.pyx in sage.structure.element.Element.n (build/cythonized/sage/structure/element.c:8131)()
@@ -29,11 +29,11 @@
    1261             sig_off()
 
 /home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/functions/other.pyc in _evalf_(self, poly, index, parent, algorithm)
-   2920         print("index: {}".format(index))
-   2921         print("type(index): {}".format(type(index)))
--> 2922         sobj = CRootOf(Poly(poly._sympy_()), int(index))
-   2923         return sobj.n(ceil(prec*3/10))._sage_()
-   2924 
+   2918         except AttributeError:
+   2919             prec = 53
+-> 2920         sobj = CRootOf(Poly(poly._sympy_()), int(index))
+   2921         return sobj.n(ceil(prec*3/10))._sage_()
+   2922 
 
 /home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sympy/polys/rootoftools.pyc in __new__(cls, f, x, index, radicals, expand)
     130         if index < -degree or index >= degree:
``````




---

archive/issue_comments_441178.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jdemeyer](#comment%3A10):\n> Replying to [rws](#comment%3A4):\n> > That exact arguments are made inexact is a bug in itself.\n\n> \n> Right, this ticket should just fix that.\n\n\nIndeed `numerical_approximation` of symbolic expression is lazily converting all arguments to the same parent. Which is very wrong when a function is defined on `R x N`.\n\nPerhaps it would be good to add in `_evalf_` the check\n\n```\nif not isinstance(index, numbers.Integral):\n    raise ValueError\n```\n\nThough I am curious about this sympy misbehavior.",
    "created_at": "2017-12-15T11:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441178",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
Replying to [jdemeyer](#comment%3A10):
> Replying to [rws](#comment%3A4):
> > That exact arguments are made inexact is a bug in itself.

> 
> Right, this ticket should just fix that.


Indeed `numerical_approximation` of symbolic expression is lazily converting all arguments to the same parent. Which is very wrong when a function is defined on `R x N`.

Perhaps it would be good to add in `_evalf_` the check

```
if not isinstance(index, numbers.Integral):
    raise ValueError
```

Though I am curious about this sympy misbehavior.



---

archive/issue_comments_441179.json:
```json
{
    "body": "<a id='comment:16'></a>\nIndeed there is a sympy bug that is now tracked at #24380.",
    "created_at": "2017-12-15T11:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441179",
    "user": "https://github.com/videlec"
}
```

<a id='comment:16'></a>
Indeed there is a sympy bug that is now tracked at #24380.



---

archive/issue_comments_441180.json:
```json
{
    "body": "<a id='comment:17'></a>\n`numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.",
    "created_at": "2017-12-15T11:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441180",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
`numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.



---

archive/issue_comments_441181.json:
```json
{
    "body": "<a id='comment:18'></a>\nThere was indeed a bug in sympy: #24380 needs review!",
    "created_at": "2017-12-15T14:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441181",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>
There was indeed a bug in sympy: #24380 needs review!



---

archive/issue_comments_441182.json:
```json
{
    "body": "<a id='comment:19'></a>\nI suggest accepting my quick fix to resolve the blocker. Meanwhile I'm looking into Pynac.",
    "created_at": "2017-12-16T08:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441182",
    "user": "https://github.com/rwst"
}
```

<a id='comment:19'></a>
I suggest accepting my quick fix to resolve the blocker. Meanwhile I'm looking into Pynac.



---

archive/issue_comments_441183.json:
```json
{
    "body": "<a id='comment:20'></a>\nIf your only goal is to resolve the blocker doctest failures, then I think it is better to use `# known bug`. The fact that the index is made floating-point is the real bug, whether it is real or complex is just a small variation.",
    "created_at": "2017-12-16T08:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441183",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
If your only goal is to resolve the blocker doctest failures, then I think it is better to use `# known bug`. The fact that the index is made floating-point is the real bug, whether it is real or complex is just a small variation.



---

archive/issue_comments_441184.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [vdelecroix](#comment%3A17):\n> `numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.\n\n\nI disagree in this case. The result is exactly what was asked for.",
    "created_at": "2017-12-16T09:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441184",
    "user": "https://github.com/rwst"
}
```

<a id='comment:21'></a>
Replying to [vdelecroix](#comment%3A17):
> `numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.


I disagree in this case. The result is exactly what was asked for.



---

archive/issue_comments_441185.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [rws](#comment%3A21):\n> Replying to [vdelecroix](#comment%3A17):\n> > `numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.\n\n> \n> I disagree in this case. The result is exactly what was asked for.\n\n\nThe problem under discussion is that you have a number specified by an equation like `x^2 - 2 = 0`. Now, you want an numerical approximation of it. I claim that there is not much reason to transform the equation into `1.0 * x^2 - 2.0` for doing that. In particular, this is **not** what the user wants. This kind of conversion is a can of worms. If you want 100 bits of your number, and start by converting the coefficients to floating points with 100 bits of precision you might loose your roots.\n\nNote that in sympy they solve the original equation with appropriate root finding algorithms on rational numbers.",
    "created_at": "2017-12-16T09:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441185",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>
Replying to [rws](#comment%3A21):
> Replying to [vdelecroix](#comment%3A17):
> > `numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.

> 
> I disagree in this case. The result is exactly what was asked for.


The problem under discussion is that you have a number specified by an equation like `x^2 - 2 = 0`. Now, you want an numerical approximation of it. I claim that there is not much reason to transform the equation into `1.0 * x^2 - 2.0` for doing that. In particular, this is **not** what the user wants. This kind of conversion is a can of worms. If you want 100 bits of your number, and start by converting the coefficients to floating points with 100 bits of precision you might loose your roots.

Note that in sympy they solve the original equation with appropriate root finding algorithms on rational numbers.



---

archive/issue_comments_441186.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [vdelecroix](#comment%3A22):\n> Replying to [rws](#comment%3A21):\n> > Replying to [vdelecroix](#comment%3A17):\n> > > `numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.\n\n> > \n> > I disagree in this case. The result is exactly what was asked for.\n\n> \n> The problem under discussion is that you have a number specified by an equation like `x^2 - 2 = 0`. Now, you want an numerical approximation of it.\n\n\nNo, that is solving. `N()` just converts symbolic expressions---if they happen to contain symbols you won't get a number, you get an error. `_convert()` helps with that.\n\n> Note that in sympy they solve the original equation with appropriate root finding algorithms on rational numbers.\n\n\nThis has nothing to do with this ticket. This ticket is about losing precision in expressions that can be FP evaluated because they contain no symbols but may contain functions. While the result precision from the function at hand `complex_root_of` is in principle not affected by the exactness of the index there may be existing/future functions where it is. This can be fixed by not FP converting exact function arguments and letting the function itself (i.e. its `evalf` member) decide what to do with exact arguments. I may well be wrong, and the best solution instead is a type database for function arguments...",
    "created_at": "2017-12-16T09:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441186",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'></a>
Replying to [vdelecroix](#comment%3A22):
> Replying to [rws](#comment%3A21):
> > Replying to [vdelecroix](#comment%3A17):
> > > `numerical_approx` is very wrong when evaluating. It converts `x^2 - 2` to `x^2 - 2.0` and hence loosing precision for no good reason.

> > 
> > I disagree in this case. The result is exactly what was asked for.

> 
> The problem under discussion is that you have a number specified by an equation like `x^2 - 2 = 0`. Now, you want an numerical approximation of it.


No, that is solving. `N()` just converts symbolic expressions---if they happen to contain symbols you won't get a number, you get an error. `_convert()` helps with that.

> Note that in sympy they solve the original equation with appropriate root finding algorithms on rational numbers.


This has nothing to do with this ticket. This ticket is about losing precision in expressions that can be FP evaluated because they contain no symbols but may contain functions. While the result precision from the function at hand `complex_root_of` is in principle not affected by the exactness of the index there may be existing/future functions where it is. This can be fixed by not FP converting exact function arguments and letting the function itself (i.e. its `evalf` member) decide what to do with exact arguments. I may well be wrong, and the best solution instead is a type database for function arguments...



---

archive/issue_comments_441187.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [vdelecroix](#comment%3A22):\n> Note that in sympy they solve the original equation with appropriate root finding algorithms on rational numbers.\n\n\nYes but we don't do the solving. We let SymPy do it.",
    "created_at": "2017-12-16T09:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441187",
    "user": "https://github.com/rwst"
}
```

<a id='comment:24'></a>
Replying to [vdelecroix](#comment%3A22):
> Note that in sympy they solve the original equation with appropriate root finding algorithms on rational numbers.


Yes but we don't do the solving. We let SymPy do it.



---

archive/issue_comments_441188.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)\" to \"[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)\".",
    "created_at": "2017-12-17T06:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441188",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)" to "[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)".



---

archive/issue_comments_441189.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)\" to \"[u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)\".",
    "created_at": "2017-12-17T06:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441189",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)" to "[u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)".



---

archive/issue_comments_441190.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-12-17T06:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441190",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_441191.json:
```json
{
    "body": "<a id='comment:27'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac7681458cdeb8b6118080f81f3d9601db485021\">ac76814</a></td><td><code>24378: avoid doctest fails</code></td></tr></table>\n",
    "created_at": "2017-12-17T06:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441191",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac7681458cdeb8b6118080f81f3d9601db485021">ac76814</a></td><td><code>24378: avoid doctest fails</code></td></tr></table>




---

archive/issue_comments_441192.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)\" to \"[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)\".",
    "created_at": "2017-12-17T06:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441192",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/doctest_failures_related_to_sympy_crootof](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/doctest_failures_related_to_sympy_crootof)" to "[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)".



---

archive/issue_comments_441193.json:
```json
{
    "body": "**Changing commit** from \"[a93662faed523eb117f4ce0197b3178855849fd2](https://github.com/sagemath/sagetrac-mirror/commit/a93662faed523eb117f4ce0197b3178855849fd2)\" to \"[ac7681458cdeb8b6118080f81f3d9601db485021](https://github.com/sagemath/sagetrac-mirror/commit/ac7681458cdeb8b6118080f81f3d9601db485021)\".",
    "created_at": "2017-12-17T06:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441193",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[a93662faed523eb117f4ce0197b3178855849fd2](https://github.com/sagemath/sagetrac-mirror/commit/a93662faed523eb117f4ce0197b3178855849fd2)" to "[ac7681458cdeb8b6118080f81f3d9601db485021](https://github.com/sagemath/sagetrac-mirror/commit/ac7681458cdeb8b6118080f81f3d9601db485021)".



---

archive/issue_comments_441194.json:
```json
{
    "body": "<a id='comment:28'></a>\nSee #24397 for the fix.",
    "created_at": "2017-12-17T07:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441194",
    "user": "https://github.com/rwst"
}
```

<a id='comment:28'></a>
See #24397 for the fix.



---

archive/issue_comments_441195.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-12-17T08:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441195",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_441196.json:
```json
{
    "body": "<a id='comment:29'></a>\nYou should add the ticket number: `# known bug (Trac #24397)`.",
    "created_at": "2017-12-17T08:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441196",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
You should add the ticket number: `# known bug (Trac #24397)`.



---

archive/issue_comments_441197.json:
```json
{
    "body": "**Changing commit** from \"[ac7681458cdeb8b6118080f81f3d9601db485021](https://github.com/sagemath/sagetrac-mirror/commit/ac7681458cdeb8b6118080f81f3d9601db485021)\" to \"[49c6d614b4293059911f19ccedb87a3c5e96df35](https://github.com/sagemath/sagetrac-mirror/commit/49c6d614b4293059911f19ccedb87a3c5e96df35)\".",
    "created_at": "2017-12-17T14:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ac7681458cdeb8b6118080f81f3d9601db485021](https://github.com/sagemath/sagetrac-mirror/commit/ac7681458cdeb8b6118080f81f3d9601db485021)" to "[49c6d614b4293059911f19ccedb87a3c5e96df35](https://github.com/sagemath/sagetrac-mirror/commit/49c6d614b4293059911f19ccedb87a3c5e96df35)".



---

archive/issue_comments_441198.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49c6d614b4293059911f19ccedb87a3c5e96df35\">49c6d61</a></td><td><code>24378: cosmetics</code></td></tr></table>\n",
    "created_at": "2017-12-17T14:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49c6d614b4293059911f19ccedb87a3c5e96df35">49c6d61</a></td><td><code>24378: cosmetics</code></td></tr></table>




---

archive/issue_comments_441199.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-12-17T14:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441199",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_441200.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)\" to \"[u/rws/24378-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-1)\".",
    "created_at": "2017-12-17T15:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441200",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/24378](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378)" to "[u/rws/24378-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-1)".



---

archive/issue_comments_441201.json:
```json
{
    "body": "<a id='comment:33'></a>\nFortunately this can be resolved easily.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae3a1e0be21a0aecbb46791fc2cacf84495eee5c\">ae3a1e0</a></td><td><code>24387: complex_root_of uses inexact index</code></td></tr></table>\n",
    "created_at": "2017-12-17T15:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441201",
    "user": "https://github.com/rwst"
}
```

<a id='comment:33'></a>
Fortunately this can be resolved easily.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae3a1e0be21a0aecbb46791fc2cacf84495eee5c">ae3a1e0</a></td><td><code>24387: complex_root_of uses inexact index</code></td></tr></table>




---

archive/issue_comments_441202.json:
```json
{
    "body": "**Changing commit** from \"[49c6d614b4293059911f19ccedb87a3c5e96df35](https://github.com/sagemath/sagetrac-mirror/commit/49c6d614b4293059911f19ccedb87a3c5e96df35)\" to \"[ae3a1e0be21a0aecbb46791fc2cacf84495eee5c](https://github.com/sagemath/sagetrac-mirror/commit/ae3a1e0be21a0aecbb46791fc2cacf84495eee5c)\".",
    "created_at": "2017-12-17T15:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441202",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[49c6d614b4293059911f19ccedb87a3c5e96df35](https://github.com/sagemath/sagetrac-mirror/commit/49c6d614b4293059911f19ccedb87a3c5e96df35)" to "[ae3a1e0be21a0aecbb46791fc2cacf84495eee5c](https://github.com/sagemath/sagetrac-mirror/commit/ae3a1e0be21a0aecbb46791fc2cacf84495eee5c)".



---

archive/issue_comments_441203.json:
```json
{
    "body": "<a id='comment:34'></a>\nI have added the information to https://github.com/pynac/pynac/wiki/%7C-floating-point-evaluation, but Sage `Function` initialization options need better docs too.",
    "created_at": "2017-12-17T15:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441203",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
I have added the information to https://github.com/pynac/pynac/wiki/%7C-floating-point-evaluation, but Sage `Function` initialization options need better docs too.



---

archive/issue_comments_441204.json:
```json
{
    "body": "<a id='comment:35'></a>\nIf this fixes the actual underlying issue, could you add\n\n```\nsage: complex_root_of(x^8-1, 7).n(2)\n```\nas a doctest?",
    "created_at": "2017-12-17T20:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441204",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'></a>
If this fixes the actual underlying issue, could you add

```
sage: complex_root_of(x^8-1, 7).n(2)
```
as a doctest?



---

archive/issue_comments_441205.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-12-17T20:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441205",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_441206.json:
```json
{
    "body": "<a id='comment:36'></a>\nIt fixes the issue but there are other problems at super-low precision.",
    "created_at": "2017-12-18T07:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441206",
    "user": "https://github.com/rwst"
}
```

<a id='comment:36'></a>
It fixes the issue but there are other problems at super-low precision.



---

archive/issue_comments_441207.json:
```json
{
    "body": "**Changing commit** from \"[ae3a1e0be21a0aecbb46791fc2cacf84495eee5c](https://github.com/sagemath/sagetrac-mirror/commit/ae3a1e0be21a0aecbb46791fc2cacf84495eee5c)\" to \"[8c3f951c7b5f726260ccadb74368713d90740d93](https://github.com/sagemath/sagetrac-mirror/commit/8c3f951c7b5f726260ccadb74368713d90740d93)\".",
    "created_at": "2017-12-18T07:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ae3a1e0be21a0aecbb46791fc2cacf84495eee5c](https://github.com/sagemath/sagetrac-mirror/commit/ae3a1e0be21a0aecbb46791fc2cacf84495eee5c)" to "[8c3f951c7b5f726260ccadb74368713d90740d93](https://github.com/sagemath/sagetrac-mirror/commit/8c3f951c7b5f726260ccadb74368713d90740d93)".



---

archive/issue_comments_441208.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c3f951c7b5f726260ccadb74368713d90740d93\">8c3f951</a></td><td><code>24378: set minimum digits; convert to given prec</code></td></tr></table>\n",
    "created_at": "2017-12-18T07:48:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441208",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c3f951c7b5f726260ccadb74368713d90740d93">8c3f951</a></td><td><code>24378: set minimum digits; convert to given prec</code></td></tr></table>




---

archive/issue_comments_441209.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-12-18T07:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441209",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_441210.json:
```json
{
    "body": "<a id='comment:39'></a>\nThe expression `prec*3/10` will behave differently on Python 2 and Python 3. You should either use `//` or `from __future__ import division` such that it works the same on Python 2 and Python 3.",
    "created_at": "2017-12-18T08:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441210",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
The expression `prec*3/10` will behave differently on Python 2 and Python 3. You should either use `//` or `from __future__ import division` such that it works the same on Python 2 and Python 3.



---

archive/issue_comments_441211.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2017-12-18T08:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441211",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_441212.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2017-12-18T08:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441212",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_441213.json:
```json
{
    "body": "<a id='comment:40'></a>\nWhat is the meaning of the factor `3/10` anyway?",
    "created_at": "2017-12-18T08:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441213",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
What is the meaning of the factor `3/10` anyway?



---

archive/issue_comments_441214.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [jdemeyer](#comment%3A40):\n> What is the meaning of the factor `3/10` anyway?\n\n\nAn approximation to `log(2,10)` (EDITED) which is good enough until about 1000 bits precision.",
    "created_at": "2017-12-18T08:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441214",
    "user": "https://github.com/rwst"
}
```

<a id='comment:41'></a>
Replying to [jdemeyer](#comment%3A40):
> What is the meaning of the factor `3/10` anyway?


An approximation to `log(2,10)` (EDITED) which is good enough until about 1000 bits precision.



---

archive/issue_comments_441215.json:
```json
{
    "body": "<a id='comment:42'></a>\nReplying to [rws](#comment%3A41):\n> Replying to [jdemeyer](#comment%3A40):\n> > What is the meaning of the factor `3/10` anyway?\n\n> \n> An approximation to `log(2,10)` (EDITED) which is good enough until about 1000 bits precision.\n\n\nThen why don't use the actual value `0.3010299956639812`? That avoids the problem with division also.",
    "created_at": "2017-12-18T08:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441215",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'></a>
Replying to [rws](#comment%3A41):
> Replying to [jdemeyer](#comment%3A40):
> > What is the meaning of the factor `3/10` anyway?

> 
> An approximation to `log(2,10)` (EDITED) which is good enough until about 1000 bits precision.


Then why don't use the actual value `0.3010299956639812`? That avoids the problem with division also.



---

archive/issue_comments_441216.json:
```json
{
    "body": "**Changing commit** from \"[8c3f951c7b5f726260ccadb74368713d90740d93](https://github.com/sagemath/sagetrac-mirror/commit/8c3f951c7b5f726260ccadb74368713d90740d93)\" to \"[8e65608d35c2527bcf6a7ebba8eadc7eb0377c38](https://github.com/sagemath/sagetrac-mirror/commit/8e65608d35c2527bcf6a7ebba8eadc7eb0377c38)\".",
    "created_at": "2017-12-18T09:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8c3f951c7b5f726260ccadb74368713d90740d93](https://github.com/sagemath/sagetrac-mirror/commit/8c3f951c7b5f726260ccadb74368713d90740d93)" to "[8e65608d35c2527bcf6a7ebba8eadc7eb0377c38](https://github.com/sagemath/sagetrac-mirror/commit/8e65608d35c2527bcf6a7ebba8eadc7eb0377c38)".



---

archive/issue_comments_441217.json:
```json
{
    "body": "<a id='comment:43'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8e65608d35c2527bcf6a7ebba8eadc7eb0377c38\">8e65608</a></td><td><code>24378: don't prematurely optimize</code></td></tr></table>\n",
    "created_at": "2017-12-18T09:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8e65608d35c2527bcf6a7ebba8eadc7eb0377c38">8e65608</a></td><td><code>24378: don't prematurely optimize</code></td></tr></table>




---

archive/issue_comments_441218.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2017-12-18T09:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441218",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_441219.json:
```json
{
    "body": "<a id='comment:45'></a>\nPing?",
    "created_at": "2017-12-20T14:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441219",
    "user": "https://github.com/rwst"
}
```

<a id='comment:45'></a>
Ping?



---

archive/issue_comments_441220.json:
```json
{
    "body": "<a id='comment:46'></a>\n`ceil(prec*log(2,10)))` is terrible. Why not using `0.3010299956639812` as suggested in [This is the Trac macro *comment:42* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:42-macro)? A possible alternative would be\n\n```\nfrom math import log10\nint(prec * log10(2))\n```\nYou definitely do not want to use two symbolic functions here.",
    "created_at": "2017-12-21T16:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441220",
    "user": "https://github.com/videlec"
}
```

<a id='comment:46'></a>
`ceil(prec*log(2,10)))` is terrible. Why not using `0.3010299956639812` as suggested in [This is the Trac macro *comment:42* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:42-macro)? A possible alternative would be

```
from math import log10
int(prec * log10(2))
```
You definitely do not want to use two symbolic functions here.



---

archive/issue_comments_441221.json:
```json
{
    "body": "**Changing commit** from \"[8e65608d35c2527bcf6a7ebba8eadc7eb0377c38](https://github.com/sagemath/sagetrac-mirror/commit/8e65608d35c2527bcf6a7ebba8eadc7eb0377c38)\" to \"[14ed7c6f210f4e809c3458dc54315542bbf3547b](https://github.com/sagemath/sagetrac-mirror/commit/14ed7c6f210f4e809c3458dc54315542bbf3547b)\".",
    "created_at": "2017-12-22T06:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8e65608d35c2527bcf6a7ebba8eadc7eb0377c38](https://github.com/sagemath/sagetrac-mirror/commit/8e65608d35c2527bcf6a7ebba8eadc7eb0377c38)" to "[14ed7c6f210f4e809c3458dc54315542bbf3547b](https://github.com/sagemath/sagetrac-mirror/commit/14ed7c6f210f4e809c3458dc54315542bbf3547b)".



---

archive/issue_comments_441222.json:
```json
{
    "body": "<a id='comment:47'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14ed7c6f210f4e809c3458dc54315542bbf3547b\">14ed7c6</a></td><td><code>24378: fix previous commit</code></td></tr></table>\n",
    "created_at": "2017-12-22T06:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:47'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14ed7c6f210f4e809c3458dc54315542bbf3547b">14ed7c6</a></td><td><code>24378: fix previous commit</code></td></tr></table>




---

archive/issue_comments_441223.json:
```json
{
    "body": "<a id='comment:48'></a>\nOr better yet, use the sympy function `prec_to_dps` which is meant to convert bits to digits:\n\n```\nfrom sympy.core.evalf import prec_to_dps\n```",
    "created_at": "2017-12-22T22:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441223",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>
Or better yet, use the sympy function `prec_to_dps` which is meant to convert bits to digits:

```
from sympy.core.evalf import prec_to_dps
```



---

archive/issue_comments_441224.json:
```json
{
    "body": "<a id='comment:49'></a>\nThanks both. I'll make a fresh branch.",
    "created_at": "2017-12-23T06:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441224",
    "user": "https://github.com/rwst"
}
```

<a id='comment:49'></a>
Thanks both. I'll make a fresh branch.



---

archive/issue_comments_441225.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/24378-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-1)\" to \"[u/rws/24378-2](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-2)\".",
    "created_at": "2017-12-23T07:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441225",
    "user": "https://github.com/rwst"
}
```

**Changing branch** from "[u/rws/24378-1](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-1)" to "[u/rws/24378-2](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-2)".



---

archive/issue_comments_441226.json:
```json
{
    "body": "**Changing commit** from \"[14ed7c6f210f4e809c3458dc54315542bbf3547b](https://github.com/sagemath/sagetrac-mirror/commit/14ed7c6f210f4e809c3458dc54315542bbf3547b)\" to \"[277a403ef00692247f9853d89322f9a464abd471](https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471)\".",
    "created_at": "2017-12-23T07:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441226",
    "user": "https://github.com/rwst"
}
```

**Changing commit** from "[14ed7c6f210f4e809c3458dc54315542bbf3547b](https://github.com/sagemath/sagetrac-mirror/commit/14ed7c6f210f4e809c3458dc54315542bbf3547b)" to "[277a403ef00692247f9853d89322f9a464abd471](https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471)".



---

archive/issue_comments_441227.json:
```json
{
    "body": "<a id='comment:51'></a>\nA minor note is that the results from `prec_dps(n)` are not identical to the previously proposed formulae at small values, even with a suitable shift.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471\">277a403</a></td><td><code>24378: complex_root_of uses inexact index</code></td></tr></table>\n",
    "created_at": "2017-12-23T07:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441227",
    "user": "https://github.com/rwst"
}
```

<a id='comment:51'></a>
A minor note is that the results from `prec_dps(n)` are not identical to the previously proposed formulae at small values, even with a suitable shift.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471">277a403</a></td><td><code>24378: complex_root_of uses inexact index</code></td></tr></table>




---

archive/issue_comments_441228.json:
```json
{
    "body": "<a id='comment:52'></a>\nGood for me if this passes patchbot testing.",
    "created_at": "2017-12-23T09:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441228",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'></a>
Good for me if this passes patchbot testing.



---

archive/issue_comments_441229.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2017-12-24T06:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441229",
    "user": "https://github.com/rwst"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_070393.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-26T09:25:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24378#event-70393"
}
```



---

archive/issue_comments_441230.json:
```json
{
    "body": "**Changing branch** from \"[u/rws/24378-2](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-2)\" to \"[277a403ef00692247f9853d89322f9a464abd471](https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471)\".",
    "created_at": "2017-12-26T09:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24378#issuecomment-441230",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/rws/24378-2](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/24378-2)" to "[277a403ef00692247f9853d89322f9a464abd471](https://github.com/sagemath/sagetrac-mirror/commit/277a403ef00692247f9853d89322f9a464abd471)".
