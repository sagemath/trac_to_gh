# Issue 24097: Broken paths in cython()'d modules

archive/issues_023860.json:
```json
{
    "assignees": [],
    "body": "As discussed [on the mailing list](https://groups.google.com/d/msg/sage-release/r920G2EVTBU/1-Xk7ZIEAgAJ), when cythonizing a module, the hard-coded path to that file saved in the module is written as a relative path if the current working directory is somewhere along the path that the module file resides.\n\nThat is, if the cython module is at\n\n```\n/home/sage/.sage/temp/cython/mymodule.pyx\n```\n\nand the current working directory is `/home/sage`, then the module's path is written as\n\n```\n.sage/temp/cython/mymodule.pyx\n```\n.\n\nThis breaks `sage.misc.sageinspect._extract_embedded_position` which assumes that files generated with `cython()` are relative to the `SPYX_TMP` variable.\n\nThis could be considered a defect in Cython, but it's also easy to work around for now by chdir()-ing into the `SPYX_TMP` directory before running `cythonize()`.\n\nDepends on #24088\n\nCC:  @jdemeyer @kiwifb\n\nKeywords: **sageinspect cython cythonize**\n\nBranch/Commit: **[1cf56a5](https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **Erik Bray**\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/24097_\n\n",
    "closed_at": "2017-10-30T07:41:34Z",
    "created_at": "2017-10-24T14:25:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Broken paths in cython()'d modules",
    "type": "issue",
    "updated_at": "2017-10-30T07:41:34Z",
    "url": "https://github.com/sagemath/sage/issues/24097",
    "user": "https://github.com/embray"
}
```
As discussed [on the mailing list](https://groups.google.com/d/msg/sage-release/r920G2EVTBU/1-Xk7ZIEAgAJ), when cythonizing a module, the hard-coded path to that file saved in the module is written as a relative path if the current working directory is somewhere along the path that the module file resides.

That is, if the cython module is at

```
/home/sage/.sage/temp/cython/mymodule.pyx
```

and the current working directory is `/home/sage`, then the module's path is written as

```
.sage/temp/cython/mymodule.pyx
```
.

This breaks `sage.misc.sageinspect._extract_embedded_position` which assumes that files generated with `cython()` are relative to the `SPYX_TMP` variable.

This could be considered a defect in Cython, but it's also easy to work around for now by chdir()-ing into the `SPYX_TMP` directory before running `cythonize()`.

Depends on #24088

CC:  @jdemeyer @kiwifb

Keywords: **sageinspect cython cythonize**

Branch/Commit: **[1cf56a5](https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c)**

Reviewer: **Jeroen Demeyer**

Author: **Erik Bray**

Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/24097_





---

archive/issue_events_334537.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-24T14:25:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334537"
}
```



---

archive/issue_events_334538.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-24T14:25:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334538"
}
```



---

archive/issue_events_334539.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-24T14:25:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334539"
}
```



---

archive/issue_comments_364405.json:
```json
{
    "body": "Branch: **[u/embray/misc/cython-path-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug)**",
    "created_at": "2017-10-24T15:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364405",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/misc/cython-path-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug)**



---

archive/issue_events_334540.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-24T15:28:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334540"
}
```



---

archive/issue_events_334541.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-24T15:28:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334541"
}
```



---

archive/issue_events_334542.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-10-24T15:28:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334542"
}
```



---

archive/issue_comments_364406.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2017-10-24T15:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364406",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_364407.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nMarked as critical just because this regression prevents new builds of the docker container from being pushed, since the script that does so requires all tests to pass (though perhaps this requirement could be relaxed somewhat for pre-releases...)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c90fe7f984dc08111fd02f9b1a6f620e98920c9b\">c90fe7f</a></td><td><code>Add some dependencies for ipykernel</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65fa4c005fb3e31b0fb8cb8a6298543c3f2c7fdb\">65fa4c0</a></td><td><code>Add a restore_cwd context manager</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6dd73f77a132d790f7a0092b25403eb69f50805\">f6dd73f</a></td><td><code>Fixes #24097 and includes a regression test</code></td></tr></table>\n",
    "created_at": "2017-10-24T15:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364407",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

Marked as critical just because this regression prevents new builds of the docker container from being pushed, since the script that does so requires all tests to pass (though perhaps this requirement could be relaxed somewhat for pre-releases...)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c90fe7f984dc08111fd02f9b1a6f620e98920c9b">c90fe7f</a></td><td><code>Add some dependencies for ipykernel</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65fa4c005fb3e31b0fb8cb8a6298543c3f2c7fdb">65fa4c0</a></td><td><code>Add a restore_cwd context manager</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6dd73f77a132d790f7a0092b25403eb69f50805">f6dd73f</a></td><td><code>Fixes #24097 and includes a regression test</code></td></tr></table>




---

archive/issue_comments_364408.json:
```json
{
    "body": "Commit: **[f6dd73f](https://github.com/sagemath/sagetrac-mirror/commit/f6dd73f77a132d790f7a0092b25403eb69f50805)**",
    "created_at": "2017-10-24T15:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364408",
    "user": "https://github.com/embray"
}
```

Commit: **[f6dd73f](https://github.com/sagemath/sagetrac-mirror/commit/f6dd73f77a132d790f7a0092b25403eb69f50805)**



---

archive/issue_comments_364409.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nDepends on #24088 only because I can't build without it.",
    "created_at": "2017-10-24T15:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364409",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

Depends on #24088 only because I can't build without it.



---

archive/issue_comments_364410.json:
```json
{
    "body": "Dependencies: **#24088**",
    "created_at": "2017-10-24T15:29:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364410",
    "user": "https://github.com/embray"
}
```

Dependencies: **#24088**



---

archive/issue_comments_364411.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nmissing `::` in the doc in sage inspect",
    "created_at": "2017-10-24T17:52:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364411",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

missing `::` in the doc in sage inspect



---

archive/issue_comments_364412.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nWhat does the docker container do differently that causes this bug to only appear there? Or in other words, how could I reproduce this bug?",
    "created_at": "2017-10-24T19:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364412",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

What does the docker container do differently that causes this bug to only appear there? Or in other words, how could I reproduce this bug?



---

archive/issue_comments_364413.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nOK, after reading your mailing list post again, I understand the problem. It happens when you rundoctest from `$HOME`.\n\nBut I think the bug is really in `_extract_embedded_position`: it shouldn't assume that the path is relative to `SPYX_TMP`. In other words, the following patch also fixes the problem for me and I think it is a better solution:\n\n```diff\ndiff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\nindex c8e79e0..2628e07 100644\n--- a/src/sage/misc/sageinspect.py\n+++ b/src/sage/misc/sageinspect.py\n@@ -222,10 +222,16 @@ def _extract_embedded_position(docstring):\n         return None\n \n     raw_filename = res.group('FILENAME')\n-    filename = os.path.join(SAGE_SRC, raw_filename)\n-    if not os.path.isfile(filename):\n-        from sage.misc.misc import SPYX_TMP\n-        filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)\n+    if os.path.isfile(raw_filename):\n+        filename = os.path.abspath(raw_filename)\n+    else:\n+        # Maybe the path is relative to SAGE_SRC\n+        sagesrcfile = os.path.join(SAGE_SRC, raw_filename)\n+        if os.path.isfile(sagesrcfile):\n+            filename = sagesrcfile\n+        else:\n+            # No idea, keep raw path\n+            filename = raw_filename\n     lineno = int(res.group('LINENO'))\n     original = res.group('ORIGINAL')\n     return (original, filename, lineno)\n```",
    "created_at": "2017-10-24T20:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364413",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

OK, after reading your mailing list post again, I understand the problem. It happens when you rundoctest from `$HOME`.

But I think the bug is really in `_extract_embedded_position`: it shouldn't assume that the path is relative to `SPYX_TMP`. In other words, the following patch also fixes the problem for me and I think it is a better solution:

```diff
diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
index c8e79e0..2628e07 100644
--- a/src/sage/misc/sageinspect.py
+++ b/src/sage/misc/sageinspect.py
@@ -222,10 +222,16 @@ def _extract_embedded_position(docstring):
         return None
 
     raw_filename = res.group('FILENAME')
-    filename = os.path.join(SAGE_SRC, raw_filename)
-    if not os.path.isfile(filename):
-        from sage.misc.misc import SPYX_TMP
-        filename = os.path.join(SPYX_TMP, '_'.join(raw_filename.split('_')[:-1]), raw_filename)
+    if os.path.isfile(raw_filename):
+        filename = os.path.abspath(raw_filename)
+    else:
+        # Maybe the path is relative to SAGE_SRC
+        sagesrcfile = os.path.join(SAGE_SRC, raw_filename)
+        if os.path.isfile(sagesrcfile):
+            filename = sagesrcfile
+        else:
+            # No idea, keep raw path
+            filename = raw_filename
     lineno = int(res.group('LINENO'))
     original = res.group('ORIGINAL')
     return (original, filename, lineno)
```



---

archive/issue_comments_364414.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHmm--I don't particularly like this either.  If I understand your point, it's that this code in `_extract_embedded_position` should be able to work on arbitrary modules.  But then, if it's a relative path, there's really know way of knowing where it's relative to.  In fact it's making a wild guess when it checks if it's relative to `SAGE_SRC`.  How would this handle the case where it's relative to `SPYX_TMP`?\n\nThis `if os.path.isfile(raw_filename): filename = os.path.abspath(raw_filename)` works if the filename is already an absolute path *or* if the file is a relative path and we just happen to be in the directory it's relative to.  For example, you could `cython()` a function, then change directories, then try to inspect the function and this would fail.\n\nI think for now my solution is better because it explicitly addresses correct handling of modules that were compiled by Sage's `cython()` function.",
    "created_at": "2017-10-25T08:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364414",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Hmm--I don't particularly like this either.  If I understand your point, it's that this code in `_extract_embedded_position` should be able to work on arbitrary modules.  But then, if it's a relative path, there's really know way of knowing where it's relative to.  In fact it's making a wild guess when it checks if it's relative to `SAGE_SRC`.  How would this handle the case where it's relative to `SPYX_TMP`?

This `if os.path.isfile(raw_filename): filename = os.path.abspath(raw_filename)` works if the filename is already an absolute path *or* if the file is a relative path and we just happen to be in the directory it's relative to.  For example, you could `cython()` a function, then change directories, then try to inspect the function and this would fail.

I think for now my solution is better because it explicitly addresses correct handling of modules that were compiled by Sage's `cython()` function.



---

archive/issue_comments_364415.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@fchapoton](#comment:3):\n> missing `::` in the doc in sage inspect\n\nOh I see what you're saying. I'll fix that.",
    "created_at": "2017-10-25T08:43:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364415",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@fchapoton](#comment:3):
> missing `::` in the doc in sage inspect

Oh I see what you're saying. I'll fix that.



---

archive/issue_comments_364416.json:
```json
{
    "body": "Changed commit from **[f6dd73f](https://github.com/sagemath/sagetrac-mirror/commit/f6dd73f77a132d790f7a0092b25403eb69f50805)** to **[a43134c](https://github.com/sagemath/sagetrac-mirror/commit/a43134ce20db0ba1463efdd3ff539a7dddcca5af)**",
    "created_at": "2017-10-25T08:44:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364416",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f6dd73f](https://github.com/sagemath/sagetrac-mirror/commit/f6dd73f77a132d790f7a0092b25403eb69f50805)** to **[a43134c](https://github.com/sagemath/sagetrac-mirror/commit/a43134ce20db0ba1463efdd3ff539a7dddcca5af)**



---

archive/issue_comments_364417.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a43134ce20db0ba1463efdd3ff539a7dddcca5af\">a43134c</a></td><td><code>Fix docstring</code></td></tr></table>\n",
    "created_at": "2017-10-25T08:44:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364417",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a43134ce20db0ba1463efdd3ff539a7dddcca5af">a43134c</a></td><td><code>Fix docstring</code></td></tr></table>




---

archive/issue_comments_364418.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@embray](#comment:6):\n> In fact it's making a wild guess when it checks if it's relative to `SAGE_SRC`.\n\nThat is not a wild guess. This is correct for functions in the Sage library, which is the most important use case.",
    "created_at": "2017-10-25T08:45:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364418",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@embray](#comment:6):
> In fact it's making a wild guess when it checks if it's relative to `SAGE_SRC`.

That is not a wild guess. This is correct for functions in the Sage library, which is the most important use case.



---

archive/issue_comments_364419.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@embray](#comment:6):\n> For example, you could `cython()` a function, then change directories, then try to inspect the function and this would fail.\n\nOK, I see your point and I agree.\n\nBut then I have some further comments:\n\n1. Instead of changing the directory to `target_dir` and then using some dubious code in `_extract_embedded_position` to reconstruct the path, why not change directory to some other directory (say `SAGE_LOCAL`) to force Cython to write an absolute path in the first place?\n\n2. Only the `cythonize()` call should be inside the `restore_cwd()` context, not the whole `try/except` block.",
    "created_at": "2017-10-25T09:10:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364419",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@embray](#comment:6):
> For example, you could `cython()` a function, then change directories, then try to inspect the function and this would fail.

OK, I see your point and I agree.

But then I have some further comments:

1. Instead of changing the directory to `target_dir` and then using some dubious code in `_extract_embedded_position` to reconstruct the path, why not change directory to some other directory (say `SAGE_LOCAL`) to force Cython to write an absolute path in the first place?

2. Only the `cythonize()` call should be inside the `restore_cwd()` context, not the whole `try/except` block.



---

archive/issue_comments_364420.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jdemeyer](#comment:9):\n> Replying to [@embray](#comment:6):\n> > In fact it's making a wild guess when it checks if it's relative to `SAGE_SRC`.\n\n> \n> That is not a wild guess. This is correct for functions in the Sage library, which is the most important use case.\n\nSorry, I was unclear. It's not a \"wild guess\" and I agree that part of the code is actually fine.  All I meant was that it's still a *heuristic* approach that can in theory be wrong (but probably isn't).",
    "created_at": "2017-10-25T09:33:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364420",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jdemeyer](#comment:9):
> Replying to [@embray](#comment:6):
> > In fact it's making a wild guess when it checks if it's relative to `SAGE_SRC`.

> 
> That is not a wild guess. This is correct for functions in the Sage library, which is the most important use case.

Sorry, I was unclear. It's not a "wild guess" and I agree that part of the code is actually fine.  All I meant was that it's still a *heuristic* approach that can in theory be wrong (but probably isn't).



---

archive/issue_comments_364421.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment:10):\n> Replying to [@embray](#comment:6):\n> > For example, you could `cython()` a function, then change directories, then try to inspect the function and this would fail.\n\n> \n> OK, I see your point and I agree.\n> \n> But then I have some further comments:\n> \n> 1. Instead of changing the directory to `target_dir` and then using some dubious code in `_extract_embedded_position` to reconstruct the path, why not change directory to some other directory (say `SAGE_LOCAL`) to force Cython to write an absolute path in the first place?\n\nI considered that, but it seemed like *more* of a hack around Cython.  The current approach feels more explicit, along the lines of how we guess a path might be relative to `SAGE_SRC`.  I'd be fine with either approach if you have strong feelings about it but I like this better and I don't think it's all that dubious.\n\n> 2. Only the `cythonize()` call should be inside the `restore_cwd()` context, not the whole `try/except` block.\n\nHeh, I actually had a small debate with myself about this.  I'm not saying I disagree but why do you think it should be inverted?",
    "created_at": "2017-10-25T09:36:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364421",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment:10):
> Replying to [@embray](#comment:6):
> > For example, you could `cython()` a function, then change directories, then try to inspect the function and this would fail.

> 
> OK, I see your point and I agree.
> 
> But then I have some further comments:
> 
> 1. Instead of changing the directory to `target_dir` and then using some dubious code in `_extract_embedded_position` to reconstruct the path, why not change directory to some other directory (say `SAGE_LOCAL`) to force Cython to write an absolute path in the first place?

I considered that, but it seemed like *more* of a hack around Cython.  The current approach feels more explicit, along the lines of how we guess a path might be relative to `SAGE_SRC`.  I'd be fine with either approach if you have strong feelings about it but I like this better and I don't think it's all that dubious.

> 2. Only the `cythonize()` call should be inside the `restore_cwd()` context, not the whole `try/except` block.

Heh, I actually had a small debate with myself about this.  I'm not saying I disagree but why do you think it should be inverted?



---

archive/issue_comments_364422.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@embray](#comment:12):\n> I'm not saying I disagree but why do you think it should be inverted?\n\nBecause it is easier to understand if the minimal amount of code is inside the context. Otherwise, you give the impression that the `except:` block should be executed also in a specific directory.",
    "created_at": "2017-10-25T09:40:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364422",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@embray](#comment:12):
> I'm not saying I disagree but why do you think it should be inverted?

Because it is easier to understand if the minimal amount of code is inside the context. Otherwise, you give the impression that the `except:` block should be executed also in a specific directory.



---

archive/issue_comments_364423.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@embray](#comment:12):\n> I considered that, but it seemed like *more* of a hack around Cython.  The current approach feels more explicit, along the lines of how we guess a path might be relative to `SAGE_SRC`.  I'd be fine with either approach if you have strong feelings about it but I like this better and I don't think it's all that dubious.\n\nIdeally, Cython should just use absolute paths. That was, no hacks in `_extract_embedded_position` are needed.",
    "created_at": "2017-10-25T09:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364423",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@embray](#comment:12):
> I considered that, but it seemed like *more* of a hack around Cython.  The current approach feels more explicit, along the lines of how we guess a path might be relative to `SAGE_SRC`.  I'd be fine with either approach if you have strong feelings about it but I like this better and I don't think it's all that dubious.

Ideally, Cython should just use absolute paths. That was, no hacks in `_extract_embedded_position` are needed.



---

archive/issue_comments_364424.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jdemeyer](#comment:14):\n> Replying to [@embray](#comment:12):\n> > I considered that, but it seemed like *more* of a hack around Cython.  The current approach feels more explicit, along the lines of how we guess a path might be relative to `SAGE_SRC`.  I'd be fine with either approach if you have strong feelings about it but I like this better and I don't think it's all that dubious.\n\n> \n> Ideally, Cython should just use absolute paths. That was, no hacks in `_extract_embedded_position` are needed.\n\nWell, yes, but we need this worked around now and I don't want to wait for/depend on a fix to Cython.",
    "created_at": "2017-10-25T10:26:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364424",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jdemeyer](#comment:14):
> Replying to [@embray](#comment:12):
> > I considered that, but it seemed like *more* of a hack around Cython.  The current approach feels more explicit, along the lines of how we guess a path might be relative to `SAGE_SRC`.  I'd be fine with either approach if you have strong feelings about it but I like this better and I don't think it's all that dubious.

> 
> Ideally, Cython should just use absolute paths. That was, no hacks in `_extract_embedded_position` are needed.

Well, yes, but we need this worked around now and I don't want to wait for/depend on a fix to Cython.



---

archive/issue_comments_364425.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment:13):\n> Replying to [@embray](#comment:12):\n> > I'm not saying I disagree but why do you think it should be inverted?\n\n> \n> Because it is easier to understand if the minimal amount of code is inside the context. Otherwise, you give the impression that the `except:` block should be executed also in a specific directory.\n\nTrue, but you could also argue the other way around it makes less clear exactly what the exception handling pertains to.  In this case it's clear enough, but it's also just as clear that there's nothing in the exception handling that's dependent on the current directory.  \n\nPerhaps in a case like this the context manager is almost more of a distraction and deserves to be simply a `finally:` statement.  I just added it because I've written the same context manager almost every time I've wanted some code that temporarily changes directories.",
    "created_at": "2017-10-25T10:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364425",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment:13):
> Replying to [@embray](#comment:12):
> > I'm not saying I disagree but why do you think it should be inverted?

> 
> Because it is easier to understand if the minimal amount of code is inside the context. Otherwise, you give the impression that the `except:` block should be executed also in a specific directory.

True, but you could also argue the other way around it makes less clear exactly what the exception handling pertains to.  In this case it's clear enough, but it's also just as clear that there's nothing in the exception handling that's dependent on the current directory.  

Perhaps in a case like this the context manager is almost more of a distraction and deserves to be simply a `finally:` statement.  I just added it because I've written the same context manager almost every time I've wanted some code that temporarily changes directories.



---

archive/issue_comments_364426.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@embray](#comment:16):\n> Perhaps in a case like this the context manager is almost more of a distraction and deserves to be simply a `finally:` statement.\n\nActually, that makes a lot of sense here, especially because we already have a `try` block.",
    "created_at": "2017-10-25T10:31:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364426",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@embray](#comment:16):
> Perhaps in a case like this the context manager is almost more of a distraction and deserves to be simply a `finally:` statement.

Actually, that makes a lot of sense here, especially because we already have a `try` block.



---

archive/issue_comments_364427.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:17):\n> Replying to [@embray](#comment:16):\n> > Perhaps in a case like this the context manager is almost more of a distraction and deserves to be simply a `finally:` statement.\n\n> \n> Actually, that makes a lot of sense here, especially because we already have a `try` block.\n\nIndeed; I'll just drop the context manager for now and maybe it add it back in later.",
    "created_at": "2017-10-25T10:47:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364427",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:17):
> Replying to [@embray](#comment:16):
> > Perhaps in a case like this the context manager is almost more of a distraction and deserves to be simply a `finally:` statement.

> 
> Actually, that makes a lot of sense here, especially because we already have a `try` block.

Indeed; I'll just drop the context manager for now and maybe it add it back in later.



---

archive/issue_comments_364428.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOn second thought, I ended up keeping the context manager as a utility, as it's useful for implementing the regression test (indeed most of the times I find myself in need of such a utility it's for testing).  So I only used it in the doctest for now.",
    "created_at": "2017-10-25T11:01:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364428",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

On second thought, I ended up keeping the context manager as a utility, as it's useful for implementing the regression test (indeed most of the times I find myself in need of such a utility it's for testing).  So I only used it in the doctest for now.



---

archive/issue_comments_364429.json:
```json
{
    "body": "Changed commit from **[a43134c](https://github.com/sagemath/sagetrac-mirror/commit/a43134ce20db0ba1463efdd3ff539a7dddcca5af)** to **[e03cf20](https://github.com/sagemath/sagetrac-mirror/commit/e03cf202160df6a8d619363ad7405e9dd443eb1c)**",
    "created_at": "2017-10-25T11:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364429",
    "user": "https://github.com/embray"
}
```

Changed commit from **[a43134c](https://github.com/sagemath/sagetrac-mirror/commit/a43134ce20db0ba1463efdd3ff539a7dddcca5af)** to **[e03cf20](https://github.com/sagemath/sagetrac-mirror/commit/e03cf202160df6a8d619363ad7405e9dd443eb1c)**



---

archive/issue_comments_364430.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nKept basically the same logic in sageinspect for now, but I think clarified the approach somewhat.  Still open to other ideas, including just forcing Cython to write an absolute path. \n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3662dbd488a814c8977e2b51e1679a8b0c6f618b\">3662dbd</a></td><td><code>Fixes #24097 and includes a regression test</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e03cf202160df6a8d619363ad7405e9dd443eb1c\">e03cf20</a></td><td><code>Make the logic for how this funcion handles relative paths a bit clearer</code></td></tr></table>\n",
    "created_at": "2017-10-25T11:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364430",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Kept basically the same logic in sageinspect for now, but I think clarified the approach somewhat.  Still open to other ideas, including just forcing Cython to write an absolute path. 

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3662dbd488a814c8977e2b51e1679a8b0c6f618b">3662dbd</a></td><td><code>Fixes #24097 and includes a regression test</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e03cf202160df6a8d619363ad7405e9dd443eb1c">e03cf20</a></td><td><code>Make the logic for how this funcion handles relative paths a bit clearer</code></td></tr></table>




---

archive/issue_comments_364431.json:
```json
{
    "body": "Changed branch from **[u/embray/misc/cython-path-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug)** to **[u/embray/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug-2)**",
    "created_at": "2017-10-25T11:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364431",
    "user": "https://github.com/embray"
}
```

Changed branch from **[u/embray/misc/cython-path-bug](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug)** to **[u/embray/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug-2)**



---

archive/issue_comments_364432.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a1259e4237f72feae65b6118116f3defa0b5052\">0a1259e</a></td><td><code>This didn't work as advertised if the filename relative to SPYX_TMP was not</code></td></tr></table>\n",
    "created_at": "2017-10-25T11:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364432",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a1259e4237f72feae65b6118116f3defa0b5052">0a1259e</a></td><td><code>This didn't work as advertised if the filename relative to SPYX_TMP was not</code></td></tr></table>




---

archive/issue_comments_364433.json:
```json
{
    "body": "Changed commit from **[e03cf20](https://github.com/sagemath/sagetrac-mirror/commit/e03cf202160df6a8d619363ad7405e9dd443eb1c)** to **[0a1259e](https://github.com/sagemath/sagetrac-mirror/commit/0a1259e4237f72feae65b6118116f3defa0b5052)**",
    "created_at": "2017-10-25T11:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364433",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e03cf20](https://github.com/sagemath/sagetrac-mirror/commit/e03cf202160df6a8d619363ad7405e9dd443eb1c)** to **[0a1259e](https://github.com/sagemath/sagetrac-mirror/commit/0a1259e4237f72feae65b6118116f3defa0b5052)**



---

archive/issue_comments_364434.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nFunny that you put `os.chdir(target_dir)` inside the `try`. I remember a long discussion about that :-)",
    "created_at": "2017-10-25T11:56:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364434",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Funny that you put `os.chdir(target_dir)` inside the `try`. I remember a long discussion about that :-)



---

archive/issue_comments_364435.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@jdemeyer](#comment:23):\n> Funny that you put `os.chdir(target_dir)` inside the `try`. I remember a long discussion about that :-)\n\nI thought about that....  I did it because I didn't want to have the discussion again.",
    "created_at": "2017-10-25T12:26:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364435",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@jdemeyer](#comment:23):
> Funny that you put `os.chdir(target_dir)` inside the `try`. I remember a long discussion about that :-)

I thought about that....  I did it because I didn't want to have the discussion again.



---

archive/issue_comments_364436.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nSo is this fine for now?",
    "created_at": "2017-10-25T12:27:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364436",
    "user": "https://github.com/embray"
}
```

<div id="comment:25" align="right">comment:25</div>

So is this fine for now?



---

archive/issue_comments_364437.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@embray](#comment:25):\n> So is this fine for now?  \n\nI still think that this would be better fixed upstream in Cython (I just wrote to cython-devel about it). How important/urgent is this ticket?",
    "created_at": "2017-10-25T12:31:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364437",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@embray](#comment:25):
> So is this fine for now?  

I still think that this would be better fixed upstream in Cython (I just wrote to cython-devel about it). How important/urgent is this ticket?



---

archive/issue_comments_364438.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nIt is urgent because it's a regression in the tests.  With the fix the overall approach is no better/worse than it was before except that it doesn't break due to the user's current directory so it's an obvious improvement.",
    "created_at": "2017-10-25T12:36:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364438",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

It is urgent because it's a regression in the tests.  With the fix the overall approach is no better/worse than it was before except that it doesn't break due to the user's current directory so it's an obvious improvement.



---

archive/issue_comments_364439.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIn other words, I'm going to change the default behavior of the docker images just to work around a minor regression in the test suite that is demonstrably fixed.",
    "created_at": "2017-10-25T12:38:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364439",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

In other words, I'm going to change the default behavior of the docker images just to work around a minor regression in the test suite that is demonstrably fixed.



---

archive/issue_comments_364440.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI can live with this as work-around. I still think that it should be fixed in a better way in the future.\n\nDid you verify that your docker image works with the latest version of this ticket?",
    "created_at": "2017-10-25T12:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364440",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

I can live with this as work-around. I still think that it should be fixed in a better way in the future.

Did you verify that your docker image works with the latest version of this ticket?



---

archive/issue_comments_364441.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2017-10-25T12:39:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364441",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_364442.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nYes, in fact that was the first place I tested it.  Feel free to open a follow-up ticket if you think it should be updated later.",
    "created_at": "2017-10-25T12:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364442",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Yes, in fact that was the first place I tested it.  Feel free to open a follow-up ticket if you think it should be updated later.



---

archive/issue_events_334543.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T12:51:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334543"
}
```



---

archive/issue_events_334544.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-25T12:51:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334544"
}
```



---

archive/issue_comments_364443.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nSorry, one final detail: I don't like to add more stuff to `sage.misc.misc`. Would you agree to add `restore_cwd` to `sage.misc.sage_ostools` (or some other more specific module)?",
    "created_at": "2017-10-26T08:05:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364443",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">comment:32</div>

Sorry, one final detail: I don't like to add more stuff to `sage.misc.misc`. Would you agree to add `restore_cwd` to `sage.misc.sage_ostools` (or some other more specific module)?



---

archive/issue_events_334545.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-26T08:05:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334545"
}
```



---

archive/issue_events_334546.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-26T08:05:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334546"
}
```



---

archive/issue_comments_364444.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI certainly don't mind moving it (I would suggest breaking up `sage.misc.misc` even further eventually).  I just wasn't sure where would be better.  I don't know about `sage_ostools` (do we really need \"sage\" in the name of that module? It seems superfluous...)\n\nInstead ISTM there's a case for some kind of `pathutils` module for filename/path-related utilities.",
    "created_at": "2017-10-26T10:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364444",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

I certainly don't mind moving it (I would suggest breaking up `sage.misc.misc` even further eventually).  I just wasn't sure where would be better.  I don't know about `sage_ostools` (do we really need "sage" in the name of that module? It seems superfluous...)

Instead ISTM there's a case for some kind of `pathutils` module for filename/path-related utilities.



---

archive/issue_comments_364445.json:
```json
{
    "body": "Changed branch from **[u/embray/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug-2)** to **[u/jdemeyer/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/misc/cython-path-bug-2)**",
    "created_at": "2017-10-27T10:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364445",
    "user": "https://github.com/jdemeyer"
}
```

Changed branch from **[u/embray/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/cython-path-bug-2)** to **[u/jdemeyer/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/misc/cython-path-bug-2)**



---

archive/issue_events_334547.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-27T10:05:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334547"
}
```



---

archive/issue_events_334548.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2017-10-27T10:05:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334548"
}
```



---

archive/issue_comments_364446.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa989e3aecfd485f2051b4a5029ab1231b23284c\">fa989e3</a></td><td><code>Add a restore_cwd context manager</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c\">1cf56a5</a></td><td><code>Fixes #24097 and includes a regression test</code></td></tr></table>\n",
    "created_at": "2017-10-27T10:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364446",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa989e3aecfd485f2051b4a5029ab1231b23284c">fa989e3</a></td><td><code>Add a restore_cwd context manager</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c">1cf56a5</a></td><td><code>Fixes #24097 and includes a regression test</code></td></tr></table>




---

archive/issue_comments_364447.json:
```json
{
    "body": "Changed commit from **[0a1259e](https://github.com/sagemath/sagetrac-mirror/commit/0a1259e4237f72feae65b6118116f3defa0b5052)** to **[1cf56a5](https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c)**",
    "created_at": "2017-10-27T10:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364447",
    "user": "https://github.com/jdemeyer"
}
```

Changed commit from **[0a1259e](https://github.com/sagemath/sagetrac-mirror/commit/0a1259e4237f72feae65b6118116f3defa0b5052)** to **[1cf56a5](https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c)**



---

archive/issue_comments_364448.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nMoved to `sage_ostools`.",
    "created_at": "2017-10-27T10:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364448",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Moved to `sage_ostools`.



---

archive/issue_comments_364449.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI'm not crazy about \"sage_ostools\", but whatever works.",
    "created_at": "2017-10-27T12:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364449",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

I'm not crazy about "sage_ostools", but whatever works.



---

archive/issue_comments_364450.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/misc/cython-path-bug-2)** to **[1cf56a5](https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c)**",
    "created_at": "2017-10-30T07:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/24097#issuecomment-364450",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/misc/cython-path-bug-2](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/misc/cython-path-bug-2)** to **[1cf56a5](https://github.com/sagemath/sagetrac-mirror/commit/1cf56a587a15c89b9b759fa327fc255e7779eb6c)**



---

archive/issue_events_334549.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-30T07:41:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334549"
}
```



---

archive/issue_events_334550.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "10d243487869c394443876a7402a50173c83904e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-10-30T07:41:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/24097",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/24097#event-334550"
}
```
