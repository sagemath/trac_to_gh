# Issue 24223: py3: several string conversion fixes

archive/issues_023986.json:
```json
{
    "body": "This fixes several (hardly exhaustive) string conversions around Sage such that functions and methods that returned `str` on Python 2 also return `str` on Python 3 (and the same for functions and methods that take `str` as arguments) using the new string utilities from #24222.\n\nThis also incorporates/replaces the fixes from #23812.\n\nCC:  @fchapoton @jdemeyer\n\nBranch/Commit: e9a582e0a3a5fe777ea34475200f18288fc3db2c\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24223\n\n",
    "closed_at": "2018-02-02T12:06:05Z",
    "created_at": "2017-11-16T11:44:24Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "py3: several string conversion fixes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24223",
    "user": "https://github.com/embray"
}
```
This fixes several (hardly exhaustive) string conversions around Sage such that functions and methods that returned `str` on Python 2 also return `str` on Python 3 (and the same for functions and methods that take `str` as arguments) using the new string utilities from #24222.

This also incorporates/replaces the fixes from #23812.

CC:  @fchapoton @jdemeyer

Branch/Commit: e9a582e0a3a5fe777ea34475200f18288fc3db2c

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24223





---

archive/issue_comments_458367.json:
```json
{
    "body": "<a id='comment:1'></a>\nWith this, plus a few other small fixes (including fixes from other existing tickets merged in) I was able to get the Sage REPL up and `1 + 1` working.",
    "created_at": "2017-11-16T11:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458367",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
With this, plus a few other small fixes (including fixes from other existing tickets merged in) I was able to get the Sage REPL up and `1 + 1` working.



---

archive/issue_comments_458368.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[34ef6dc](https://git.sagemath.org/sage.git/commit/?id=34ef6dc08de5f11a74e83c6707d6dd4f5e2563be)|`Add HAVE_GMPY2 compile-time constant`|\n|[158d984](https://git.sagemath.org/sage.git/commit/?id=158d984a1263978ce941172c775238afbc32ad65)|`Force absolute import in have_module()`|\n|[7f06e71](https://git.sagemath.org/sage.git/commit/?id=7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)|`Fix documentation`|\n|[3ac146c](https://git.sagemath.org/sage.git/commit/?id=3ac146c17ccabbaf53918f874f516909041e82c5)|`Add a Cython compile-time constant for Python major version.`|\n|[f71fd41](https://git.sagemath.org/sage.git/commit/?id=f71fd41b659ea250ec96c0df343c4fe6b2be9289)|`Add new string conversion utilities.`|\n|[a5d5219](https://git.sagemath.org/sage.git/commit/?id=a5d521980e6ce42afc2b127e8f7d892f32488ee4)|`Add support for optional error handling.`|\n|[627d4c7](https://git.sagemath.org/sage.git/commit/?id=627d4c7536b8a219b59177a07b93a67569fddfc4)|`Add new string conversion utilities.`|\n|[25d6c32](https://git.sagemath.org/sage.git/commit/?id=25d6c32154c88dc4e9f1520d105b586b61c43cdc)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|",
    "created_at": "2017-11-20T09:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458368",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[34ef6dc](https://git.sagemath.org/sage.git/commit/?id=34ef6dc08de5f11a74e83c6707d6dd4f5e2563be)|`Add HAVE_GMPY2 compile-time constant`|
|[158d984](https://git.sagemath.org/sage.git/commit/?id=158d984a1263978ce941172c775238afbc32ad65)|`Force absolute import in have_module()`|
|[7f06e71](https://git.sagemath.org/sage.git/commit/?id=7f06e71efb3fdc5f91fcf4b0b3ef761c72d9a8c2)|`Fix documentation`|
|[3ac146c](https://git.sagemath.org/sage.git/commit/?id=3ac146c17ccabbaf53918f874f516909041e82c5)|`Add a Cython compile-time constant for Python major version.`|
|[f71fd41](https://git.sagemath.org/sage.git/commit/?id=f71fd41b659ea250ec96c0df343c4fe6b2be9289)|`Add new string conversion utilities.`|
|[a5d5219](https://git.sagemath.org/sage.git/commit/?id=a5d521980e6ce42afc2b127e8f7d892f32488ee4)|`Add support for optional error handling.`|
|[627d4c7](https://git.sagemath.org/sage.git/commit/?id=627d4c7536b8a219b59177a07b93a67569fddfc4)|`Add new string conversion utilities.`|
|[25d6c32](https://git.sagemath.org/sage.git/commit/?id=25d6c32154c88dc4e9f1520d105b586b61c43cdc)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|



---

archive/issue_comments_458369.json:
```json
{
    "body": "Changing commit from \"44a55407569e8919b7598ca367a05469732e78bf\" to \"25d6c32154c88dc4e9f1520d105b586b61c43cdc\"",
    "created_at": "2017-11-20T09:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "44a55407569e8919b7598ca367a05469732e78bf" to "25d6c32154c88dc4e9f1520d105b586b61c43cdc"



---

archive/issue_comments_458370.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-20T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458370",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458371.json:
```json
{
    "body": "<a id='comment:3'></a>\nRebased on current version of #24222.",
    "created_at": "2017-11-20T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458371",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
Rebased on current version of #24222.



---

archive/issue_comments_458372.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-20T19:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458372",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_458373.json:
```json
{
    "body": "<a id='comment:4'></a>\nSomething is wrong: there are still the files `src/sage/misc/string.*`",
    "created_at": "2017-11-20T19:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458373",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Something is wrong: there are still the files `src/sage/misc/string.*`



---

archive/issue_comments_458374.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis is again a ticket with many small independent changes where a \"partial positive review\" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?",
    "created_at": "2017-11-20T19:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458374",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
This is again a ticket with many small independent changes where a "partial positive review" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?



---

archive/issue_comments_458375.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Something is wrong: there are still the files `src/sage/misc/string.*`\n\n\nOops--part of the problem here is I'm moving between two different working trees, one for Python 2 and one for Python 3, so it can get confusing.  I'll clean this up.",
    "created_at": "2017-11-21T16:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458375",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Replying to [jdemeyer](#comment%3A4):
> Something is wrong: there are still the files `src/sage/misc/string.*`


Oops--part of the problem here is I'm moving between two different working trees, one for Python 2 and one for Python 3, so it can get confusing.  I'll clean this up.



---

archive/issue_comments_458376.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [jdemeyer](#comment%3A5):\n> This is again a ticket with many small independent changes where a \"partial positive review\" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?\n\n\nI'd be fine if you proposed your changes and tossed it back to me as \"needs review\", rather than going immediately to \"positive review\".",
    "created_at": "2017-11-21T16:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458376",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Replying to [jdemeyer](#comment%3A5):
> This is again a ticket with many small independent changes where a "partial positive review" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?


I'd be fine if you proposed your changes and tossed it back to me as "needs review", rather than going immediately to "positive review".



---

archive/issue_comments_458377.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt seems strange to me to use `locale.getpreferredencoding()` for strings which do not depend on the locale. I would propose:\n\n1. Use `locale.getpreferredencoding()` for strings which actually depend on the locale.\n\n2. Use `sys.getfilesystemencoding()` for strings which actually depend on the file system encoding.\n\n3. Use UTF-8 otherwise.",
    "created_at": "2017-11-22T14:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458377",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
It seems strange to me to use `locale.getpreferredencoding()` for strings which do not depend on the locale. I would propose:

1. Use `locale.getpreferredencoding()` for strings which actually depend on the locale.

2. Use `sys.getfilesystemencoding()` for strings which actually depend on the file system encoding.

3. Use UTF-8 otherwise.



---

archive/issue_events_061362.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24223#event-61362"
}
```



---

archive/issue_comments_458378.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[64567aa](https://git.sagemath.org/sage.git/commit/?id=64567aa772d737b6ff052f99a67cc6e8ad72c21c)|`Make type checks explicit`|\n|[a358aea](https://git.sagemath.org/sage.git/commit/?id=a358aeaec8612efe19678482fb510751a1b7b33a)|`Require a const char*--this is more consistent for use in cases where`|\n|[64a1c2d](https://git.sagemath.org/sage.git/commit/?id=64a1c2d58713636a51c60e3be508204c88513658)|`Use a less unusual character in the tests`|\n|[1bf6709](https://git.sagemath.org/sage.git/commit/?id=1bf6709cb5b256537bab4058ba3fa578996f521b)|`Use r-strings for the docstrings since they contain slashes`|\n|[2bb8396](https://git.sagemath.org/sage.git/commit/?id=2bb839655c50259c8beec273cab5773eb5158265)|`Clean up these declarations:`|\n|[6d73a41](https://git.sagemath.org/sage.git/commit/?id=6d73a416b18f9d0edec280009495ae77f7b0a49a)|`Use more specific type declarations here.`|\n|[56f1c02](https://git.sagemath.org/sage.git/commit/?id=56f1c02add22c05178f43c2d14ea4bfa1aae0db9)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|",
    "created_at": "2017-12-21T11:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458378",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[64567aa](https://git.sagemath.org/sage.git/commit/?id=64567aa772d737b6ff052f99a67cc6e8ad72c21c)|`Make type checks explicit`|
|[a358aea](https://git.sagemath.org/sage.git/commit/?id=a358aeaec8612efe19678482fb510751a1b7b33a)|`Require a const char*--this is more consistent for use in cases where`|
|[64a1c2d](https://git.sagemath.org/sage.git/commit/?id=64a1c2d58713636a51c60e3be508204c88513658)|`Use a less unusual character in the tests`|
|[1bf6709](https://git.sagemath.org/sage.git/commit/?id=1bf6709cb5b256537bab4058ba3fa578996f521b)|`Use r-strings for the docstrings since they contain slashes`|
|[2bb8396](https://git.sagemath.org/sage.git/commit/?id=2bb839655c50259c8beec273cab5773eb5158265)|`Clean up these declarations:`|
|[6d73a41](https://git.sagemath.org/sage.git/commit/?id=6d73a416b18f9d0edec280009495ae77f7b0a49a)|`Use more specific type declarations here.`|
|[56f1c02](https://git.sagemath.org/sage.git/commit/?id=56f1c02add22c05178f43c2d14ea4bfa1aae0db9)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|



---

archive/issue_comments_458379.json:
```json
{
    "body": "Changing commit from \"25d6c32154c88dc4e9f1520d105b586b61c43cdc\" to \"56f1c02add22c05178f43c2d14ea4bfa1aae0db9\"",
    "created_at": "2017-12-21T11:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458379",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "25d6c32154c88dc4e9f1520d105b586b61c43cdc" to "56f1c02add22c05178f43c2d14ea4bfa1aae0db9"



---

archive/issue_comments_458380.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[a285af4](https://git.sagemath.org/sage.git/commit/?id=a285af48a5bf05ea9db98d268ff8822d93a85559)|`Add new string conversion utilities.`|\n|[5b3719a](https://git.sagemath.org/sage.git/commit/?id=5b3719a36342fc8a7245e72cc25f993d6e407e90)|`Add support for optional error handling.`|\n|[bf5f893](https://git.sagemath.org/sage.git/commit/?id=bf5f893c73c224849233e1a400a3e97299615089)|`Make type checks explicit`|\n|[1bd27fc](https://git.sagemath.org/sage.git/commit/?id=1bd27fc5a7d14fce1b5d27df3be980f745913646)|`Require a const char*--this is more consistent for use in cases where`|\n|[bd2d931](https://git.sagemath.org/sage.git/commit/?id=bd2d93183aa4ecc8f541b9407be4829130449547)|`Use a less unusual character in the tests`|\n|[b32f000](https://git.sagemath.org/sage.git/commit/?id=b32f000b55e932039e6284e466888d6e3bfaad6f)|`Use r-strings for the docstrings since they contain slashes`|\n|[ccf7bcd](https://git.sagemath.org/sage.git/commit/?id=ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b)|`Clean up these declarations:`|\n|[dec9f3a](https://git.sagemath.org/sage.git/commit/?id=dec9f3ac79a992d3152366ae266f1065c70c7867)|`Use more specific type declarations here.`|\n|[a9ebae6](https://git.sagemath.org/sage.git/commit/?id=a9ebae6bfffc84a549af6e8da8abc52840b2b74c)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|",
    "created_at": "2017-12-21T11:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458380",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[a285af4](https://git.sagemath.org/sage.git/commit/?id=a285af48a5bf05ea9db98d268ff8822d93a85559)|`Add new string conversion utilities.`|
|[5b3719a](https://git.sagemath.org/sage.git/commit/?id=5b3719a36342fc8a7245e72cc25f993d6e407e90)|`Add support for optional error handling.`|
|[bf5f893](https://git.sagemath.org/sage.git/commit/?id=bf5f893c73c224849233e1a400a3e97299615089)|`Make type checks explicit`|
|[1bd27fc](https://git.sagemath.org/sage.git/commit/?id=1bd27fc5a7d14fce1b5d27df3be980f745913646)|`Require a const char*--this is more consistent for use in cases where`|
|[bd2d931](https://git.sagemath.org/sage.git/commit/?id=bd2d93183aa4ecc8f541b9407be4829130449547)|`Use a less unusual character in the tests`|
|[b32f000](https://git.sagemath.org/sage.git/commit/?id=b32f000b55e932039e6284e466888d6e3bfaad6f)|`Use r-strings for the docstrings since they contain slashes`|
|[ccf7bcd](https://git.sagemath.org/sage.git/commit/?id=ccf7bcd46559fd7b96984f35e1b7999aecb2cc2b)|`Clean up these declarations:`|
|[dec9f3a](https://git.sagemath.org/sage.git/commit/?id=dec9f3ac79a992d3152366ae266f1065c70c7867)|`Use more specific type declarations here.`|
|[a9ebae6](https://git.sagemath.org/sage.git/commit/?id=a9ebae6bfffc84a549af6e8da8abc52840b2b74c)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|



---

archive/issue_comments_458381.json:
```json
{
    "body": "Changing commit from \"56f1c02add22c05178f43c2d14ea4bfa1aae0db9\" to \"a9ebae6bfffc84a549af6e8da8abc52840b2b74c\"",
    "created_at": "2017-12-21T11:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458381",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "56f1c02add22c05178f43c2d14ea4bfa1aae0db9" to "a9ebae6bfffc84a549af6e8da8abc52840b2b74c"



---

archive/issue_comments_458382.json:
```json
{
    "body": "<a id='comment:12'></a>\nIs this needs_review again?",
    "created_at": "2017-12-27T19:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458382",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
Is this needs_review again?



---

archive/issue_comments_458383.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-02T14:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458383",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_458384.json:
```json
{
    "body": "<a id='comment:13'></a>\nYeah, IIRC this was just a bunch of miscellaneous string conversions from some other tickets, but redone using the `sage.cpython.string` utilities.",
    "created_at": "2018-01-02T14:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458384",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>
Yeah, IIRC this was just a bunch of miscellaneous string conversions from some other tickets, but redone using the `sage.cpython.string` utilities.



---

archive/issue_comments_458385.json:
```json
{
    "body": "<a id='comment:14'></a>\n3 failing doctests in integer.pyx",
    "created_at": "2018-01-03T12:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458385",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
3 failing doctests in integer.pyx



---

archive/issue_comments_458386.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-05T08:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458386",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_458387.json:
```json
{
    "body": "<a id='comment:16'></a>\nInteresting--when I added `str_to_bytes` I predicted we might later want to allow Python 2 `unicode` objects to be supported somehow, but put it off because I didn't think there was much code in Sage that already was expected to handle `unicode` (except in a few places like unicode art, etc.).  But the tests that are failing here clearly show that there are some places it's expected to work.\n\nSo I see at least three options:\n\n1. Modify `str_to_bytes` to treat `unicode` appropriate on Python 2\n2. Add some new function like `unicode_to_str` that's analogous to `str_to_bytes` (I'm not crazy about this)\n3. Just special case `unicode` on Python 2 where we do want to support it.\n\nI lean towards 1. but I'm open to ideas.",
    "created_at": "2018-01-05T12:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458387",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>
Interesting--when I added `str_to_bytes` I predicted we might later want to allow Python 2 `unicode` objects to be supported somehow, but put it off because I didn't think there was much code in Sage that already was expected to handle `unicode` (except in a few places like unicode art, etc.).  But the tests that are failing here clearly show that there are some places it's expected to work.

So I see at least three options:

1. Modify `str_to_bytes` to treat `unicode` appropriate on Python 2
2. Add some new function like `unicode_to_str` that's analogous to `str_to_bytes` (I'm not crazy about this)
3. Just special case `unicode` on Python 2 where we do want to support it.

I lean towards 1. but I'm open to ideas.



---

archive/issue_comments_458388.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [embray](#comment%3A16):\n> I lean towards 1.\n\n\nI agree. We should just support `bytes` and `unicode` (in the Cython sense!) as input to `str_to_bytes` regardless of Python version. One complication is that the Python 3 code path of `str_to_bytes` uses some functions specific to Python 3, so we cannot just run that code on Python 2.",
    "created_at": "2018-01-05T12:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458388",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [embray](#comment%3A16):
> I lean towards 1.


I agree. We should just support `bytes` and `unicode` (in the Cython sense!) as input to `str_to_bytes` regardless of Python version. One complication is that the Python 3 code path of `str_to_bytes` uses some functions specific to Python 3, so we cannot just run that code on Python 2.



---

archive/issue_comments_458389.json:
```json
{
    "body": "<a id='comment:18'></a>\nRight, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.  Welcome back btw!",
    "created_at": "2018-01-05T12:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458389",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.  Welcome back btw!



---

archive/issue_comments_458390.json:
```json
{
    "body": "<a id='comment:19'></a>\nI created a new ticket for this: #24475",
    "created_at": "2018-01-05T12:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458390",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
I created a new ticket for this: #24475



---

archive/issue_comments_458391.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [embray](#comment%3A18):\n> Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.\n\n\nI would rather avoid that. Instead of `PyUnicode_EncodeLocale`, you can just pass `NULL` as `encoding` to `PyUnicode_AsEncodedString`. That leaves `PyUnicode_AsUTF8` which is really only used to translate the `encoding` and `errors` arguments. We could require that this is always of type `str` (so, not `unicode` on Python 2).",
    "created_at": "2018-01-05T12:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458391",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [embray](#comment%3A18):
> Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.


I would rather avoid that. Instead of `PyUnicode_EncodeLocale`, you can just pass `NULL` as `encoding` to `PyUnicode_AsEncodedString`. That leaves `PyUnicode_AsUTF8` which is really only used to translate the `encoding` and `errors` arguments. We could require that this is always of type `str` (so, not `unicode` on Python 2).



---

archive/issue_comments_458392.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [embray](#comment%3A18):\n> I'll give it a look though.\n\n\nI can also do that. Just let me know, to avoid double work.",
    "created_at": "2018-01-05T12:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458392",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Replying to [embray](#comment%3A18):
> I'll give it a look though.


I can also do that. Just let me know, to avoid double work.



---

archive/issue_comments_458393.json:
```json
{
    "body": "Changing commit from \"a9ebae6bfffc84a549af6e8da8abc52840b2b74c\" to \"c393e41ee8f627ca5b76149100039c5664208235\"",
    "created_at": "2018-01-10T14:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458393",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a9ebae6bfffc84a549af6e8da8abc52840b2b74c" to "c393e41ee8f627ca5b76149100039c5664208235"



---

archive/issue_comments_458394.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[9cf556b](https://git.sagemath.org/sage.git/commit/?id=9cf556b0a9ad8bdf708ab083f160e0fe674c4569)|`Rework str_to_bytes so that it accepts unicode on Python 2 and treats it same as str on Python 3.`|\n|[086e523](https://git.sagemath.org/sage.git/commit/?id=086e523ddcb32b2750f6ca6a0b23e0c5416ccb37)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|\n|[728a0bc](https://git.sagemath.org/sage.git/commit/?id=728a0bc71a8e284d1f5c25563ae408c6de3d12d5)|`Use str_to_bytes for 'unicode' (which will be str on Python 3 and unicode on Python 2)`|\n|[c393e41](https://git.sagemath.org/sage.git/commit/?id=c393e41ee8f627ca5b76149100039c5664208235)|`Minor Python 3 fix for sage.libs.flint.fmpz_poly`|",
    "created_at": "2018-01-10T14:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[9cf556b](https://git.sagemath.org/sage.git/commit/?id=9cf556b0a9ad8bdf708ab083f160e0fe674c4569)|`Rework str_to_bytes so that it accepts unicode on Python 2 and treats it same as str on Python 3.`|
|[086e523](https://git.sagemath.org/sage.git/commit/?id=086e523ddcb32b2750f6ca6a0b23e0c5416ccb37)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|
|[728a0bc](https://git.sagemath.org/sage.git/commit/?id=728a0bc71a8e284d1f5c25563ae408c6de3d12d5)|`Use str_to_bytes for 'unicode' (which will be str on Python 3 and unicode on Python 2)`|
|[c393e41](https://git.sagemath.org/sage.git/commit/?id=c393e41ee8f627ca5b76149100039c5664208235)|`Minor Python 3 fix for sage.libs.flint.fmpz_poly`|



---

archive/issue_comments_458395.json:
```json
{
    "body": "<a id='comment:23'></a>\nis this in \"needs_review\" state ?",
    "created_at": "2018-01-15T19:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458395",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>
is this in "needs_review" state ?



---

archive/issue_comments_458396.json:
```json
{
    "body": "Changing dependencies from \"#24222\" to \"#24222, #24475\"",
    "created_at": "2018-01-16T16:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458396",
    "user": "https://github.com/embray"
}
```

Changing dependencies from "#24222" to "#24222, #24475"



---

archive/issue_comments_458397.json:
```json
{
    "body": "Changing commit from \"c393e41ee8f627ca5b76149100039c5664208235\" to \"0925f3b3d747e2f935006576a929c317eda7f1f3\"",
    "created_at": "2018-01-17T15:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c393e41ee8f627ca5b76149100039c5664208235" to "0925f3b3d747e2f935006576a929c317eda7f1f3"



---

archive/issue_comments_458398.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[0925f3b](https://git.sagemath.org/sage.git/commit/?id=0925f3b3d747e2f935006576a929c317eda7f1f3)|`A few additional string conversion fixes for sage.libs.ecl`|",
    "created_at": "2018-01-17T15:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458398",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[0925f3b](https://git.sagemath.org/sage.git/commit/?id=0925f3b3d747e2f935006576a929c317eda7f1f3)|`A few additional string conversion fixes for sage.libs.ecl`|



---

archive/issue_comments_458399.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-17T15:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458399",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_458400.json:
```json
{
    "body": "Changing commit from \"0925f3b3d747e2f935006576a929c317eda7f1f3\" to \"7e4d3ccff889e902f6e93c42533b68e9991c83b4\"",
    "created_at": "2018-01-19T15:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0925f3b3d747e2f935006576a929c317eda7f1f3" to "7e4d3ccff889e902f6e93c42533b68e9991c83b4"



---

archive/issue_comments_458401.json:
```json
{
    "body": "<a id='comment:27'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[7e4d3cc](https://git.sagemath.org/sage.git/commit/?id=7e4d3ccff889e902f6e93c42533b68e9991c83b4)|`py3: fix pickling of integers and other minor bytes/str fixes`|",
    "created_at": "2018-01-19T15:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458401",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[7e4d3cc](https://git.sagemath.org/sage.git/commit/?id=7e4d3ccff889e902f6e93c42533b68e9991c83b4)|`py3: fix pickling of integers and other minor bytes/str fixes`|



---

archive/issue_comments_458402.json:
```json
{
    "body": "Changing commit from \"7e4d3ccff889e902f6e93c42533b68e9991c83b4\" to \"1338ba4db9db82a4e96191fa5b8ecb3f51cf5805\"",
    "created_at": "2018-01-22T13:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458402",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7e4d3ccff889e902f6e93c42533b68e9991c83b4" to "1338ba4db9db82a4e96191fa5b8ecb3f51cf5805"



---

archive/issue_comments_458403.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[998911f](https://git.sagemath.org/sage.git/commit/?id=998911f90dbab7e3f2af8e5cd8862b78377d9147)|`Rework str_to_bytes so that it accepts unicode on Python 2 and treats it same as str on Python 3.`|\n|[c2c898e](https://git.sagemath.org/sage.git/commit/?id=c2c898ee7bf0c45c8013cb5e7ec7c469991fa7c2)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|\n|[0637cde](https://git.sagemath.org/sage.git/commit/?id=0637cde3efca7a81042c464bae788eb7eef8ea36)|`Use str_to_bytes for 'unicode' (which will be str on Python 3 and unicode on Python 2)`|\n|[c0158a9](https://git.sagemath.org/sage.git/commit/?id=c0158a97d4cdb0ca05b0301026b4d200a0cb86b7)|`Minor Python 3 fix for sage.libs.flint.fmpz_poly`|\n|[f415e2f](https://git.sagemath.org/sage.git/commit/?id=f415e2fff05fb2dd79ecc79b1bb676e7b245b2c3)|`A few additional string conversion fixes for sage.libs.ecl`|\n|[1338ba4](https://git.sagemath.org/sage.git/commit/?id=1338ba4db9db82a4e96191fa5b8ecb3f51cf5805)|`py3: fix pickling of integers and other minor bytes/str fixes`|",
    "created_at": "2018-01-22T13:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458403",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[998911f](https://git.sagemath.org/sage.git/commit/?id=998911f90dbab7e3f2af8e5cd8862b78377d9147)|`Rework str_to_bytes so that it accepts unicode on Python 2 and treats it same as str on Python 3.`|
|[c2c898e](https://git.sagemath.org/sage.git/commit/?id=c2c898ee7bf0c45c8013cb5e7ec7c469991fa7c2)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|
|[0637cde](https://git.sagemath.org/sage.git/commit/?id=0637cde3efca7a81042c464bae788eb7eef8ea36)|`Use str_to_bytes for 'unicode' (which will be str on Python 3 and unicode on Python 2)`|
|[c0158a9](https://git.sagemath.org/sage.git/commit/?id=c0158a97d4cdb0ca05b0301026b4d200a0cb86b7)|`Minor Python 3 fix for sage.libs.flint.fmpz_poly`|
|[f415e2f](https://git.sagemath.org/sage.git/commit/?id=f415e2fff05fb2dd79ecc79b1bb676e7b245b2c3)|`A few additional string conversion fixes for sage.libs.ecl`|
|[1338ba4](https://git.sagemath.org/sage.git/commit/?id=1338ba4db9db82a4e96191fa5b8ecb3f51cf5805)|`py3: fix pickling of integers and other minor bytes/str fixes`|



---

archive/issue_comments_458404.json:
```json
{
    "body": "<a id='comment:29'></a>\nLooks good to me, globally, even if do not feel I understand everything in detail.\n\nJeroen, do you think we can move forward with this important ticket ?",
    "created_at": "2018-01-23T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458404",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>
Looks good to me, globally, even if do not feel I understand everything in detail.

Jeroen, do you think we can move forward with this important ticket ?



---

archive/issue_comments_458405.json:
```json
{
    "body": "<a id='comment:30'></a>\nI always find it a bit unpleasant to review tickets with non-merged dependencies. So I would rather wait until the next beta.\n\nTwo immediate issues that I see:\n\n1. In `src/sage/libs/mpmath/utils.pyx` you add an import that you don't use.\n\n2. In several files, you `import` stuff from `sage.cpython.string` where you could use `cimport`.",
    "created_at": "2018-01-23T19:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458405",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
I always find it a bit unpleasant to review tickets with non-merged dependencies. So I would rather wait until the next beta.

Two immediate issues that I see:

1. In `src/sage/libs/mpmath/utils.pyx` you add an import that you don't use.

2. In several files, you `import` stuff from `sage.cpython.string` where you could use `cimport`.



---

archive/issue_comments_458406.json:
```json
{
    "body": "Changing branch from \"u/embray/python3/string-fixes\" to \"public/python3-trac24223\"",
    "created_at": "2018-01-28T07:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458406",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/embray/python3/string-fixes" to "public/python3-trac24223"



---

archive/issue_comments_458407.json:
```json
{
    "body": "<a id='comment:31'></a>\nNew commits:\n|                                                                                                                                          |                                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|\n|[00f2776](https://git.sagemath.org/sage.git/commit?id=00f2776101f58a9c232fc06a3ee3eb2d87fc4d62)|`Merge branch 'u/embray/python3/string-fixes' in 8.2.b4`|",
    "created_at": "2018-01-28T07:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458407",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>
New commits:
|                                                                                                                                          |                                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------|
|[00f2776](https://git.sagemath.org/sage.git/commit?id=00f2776101f58a9c232fc06a3ee3eb2d87fc4d62)|`Merge branch 'u/embray/python3/string-fixes' in 8.2.b4`|



---

archive/issue_comments_458408.json:
```json
{
    "body": "Changing dependencies from \"#24222, #24475\" to \"\"",
    "created_at": "2018-01-28T07:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458408",
    "user": "https://github.com/fchapoton"
}
```

Changing dependencies from "#24222, #24475" to ""



---

archive/issue_comments_458409.json:
```json
{
    "body": "Changing commit from \"1338ba4db9db82a4e96191fa5b8ecb3f51cf5805\" to \"00f2776101f58a9c232fc06a3ee3eb2d87fc4d62\"",
    "created_at": "2018-01-28T07:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458409",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "1338ba4db9db82a4e96191fa5b8ecb3f51cf5805" to "00f2776101f58a9c232fc06a3ee3eb2d87fc4d62"



---

archive/issue_comments_458410.json:
```json
{
    "body": "Changing commit from \"00f2776101f58a9c232fc06a3ee3eb2d87fc4d62\" to \"7d68d8c73f2524d8ceb7af3d74bba57f31a4cbe7\"",
    "created_at": "2018-01-28T08:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "00f2776101f58a9c232fc06a3ee3eb2d87fc4d62" to "7d68d8c73f2524d8ceb7af3d74bba57f31a4cbe7"



---

archive/issue_comments_458411.json:
```json
{
    "body": "<a id='comment:32'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[7d68d8c](https://git.sagemath.org/sage.git/commit/?id=7d68d8c73f2524d8ceb7af3d74bba57f31a4cbe7)|`some details of imports`|",
    "created_at": "2018-01-28T08:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[7d68d8c](https://git.sagemath.org/sage.git/commit/?id=7d68d8c73f2524d8ceb7af3d74bba57f31a4cbe7)|`some details of imports`|



---

archive/issue_comments_458412.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-29T13:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458412",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458413.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-01-29T13:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458413",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_458414.json:
```json
{
    "body": "<a id='comment:34'></a>\nThis does not work:\n\n```\n-from sage.cpython.string import FS_ENCODING, str_to_bytes\n+from sage.cpython.string cimport FS_ENCODING, str_to_bytes\n```\n\n`FS_ENCODING` is can't be cimported.",
    "created_at": "2018-01-30T12:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458414",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>
This does not work:

```
-from sage.cpython.string import FS_ENCODING, str_to_bytes
+from sage.cpython.string cimport FS_ENCODING, str_to_bytes
```

`FS_ENCODING` is can't be cimported.



---

archive/issue_comments_458415.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-01-30T12:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458415",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_458416.json:
```json
{
    "body": "<a id='comment:35'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------|\n|[80b0d1f](https://git.sagemath.org/sage.git/commit/?id=80b0d1f0c5d761c6804abff6bfbf94a1645105c8)|`fix import`|",
    "created_at": "2018-01-30T14:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------|
|[80b0d1f](https://git.sagemath.org/sage.git/commit/?id=80b0d1f0c5d761c6804abff6bfbf94a1645105c8)|`fix import`|



---

archive/issue_comments_458417.json:
```json
{
    "body": "Changing commit from \"7d68d8c73f2524d8ceb7af3d74bba57f31a4cbe7\" to \"80b0d1f0c5d761c6804abff6bfbf94a1645105c8\"",
    "created_at": "2018-01-30T14:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7d68d8c73f2524d8ceb7af3d74bba57f31a4cbe7" to "80b0d1f0c5d761c6804abff6bfbf94a1645105c8"



---

archive/issue_comments_458418.json:
```json
{
    "body": "<a id='comment:36'></a>\nimport corrected",
    "created_at": "2018-01-30T14:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458418",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'></a>
import corrected



---

archive/issue_comments_458419.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-30T14:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458419",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_458420.json:
```json
{
    "body": "Changing branch from \"public/python3-trac24223\" to \"u/embray/python3/string-fixes\"",
    "created_at": "2018-01-30T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458420",
    "user": "https://github.com/embray"
}
```

Changing branch from "public/python3-trac24223" to "u/embray/python3/string-fixes"



---

archive/issue_comments_458421.json:
```json
{
    "body": "<a id='comment:37'></a>\nI rebased and squashed some of these changes.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                  |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|\n|[cc214fd](https://git.sagemath.org/sage.git/commit?id=cc214fdcf00443531ade6e2fa650426de7debefb)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|\n|[f7e1153](https://git.sagemath.org/sage.git/commit?id=f7e1153918d1da2c451e95fbb9d4f00a393d1752)|`Use str_to_bytes for 'unicode' (which will be str on Python 3 and unicode on Python 2)`|\n|[a4d6fe3](https://git.sagemath.org/sage.git/commit?id=a4d6fe3074a6df02eb2fda49fe47767727479294)|`A few additional string conversion fixes for sage.libs.ecl`|\n|[d03a8d4](https://git.sagemath.org/sage.git/commit?id=d03a8d450e577e5c1cad95ef825409e6141367c4)|`py3: fix pickling of integers and other minor bytes/str fixes`|\n|[e9a582e](https://git.sagemath.org/sage.git/commit?id=e9a582e0a3a5fe777ea34475200f18288fc3db2c)|`import -> cimport where appropriate`|",
    "created_at": "2018-01-30T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458421",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>
I rebased and squashed some of these changes.

---
New commits:
|                                                                                                                                          |                                                                                  |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------|
|[cc214fd](https://git.sagemath.org/sage.git/commit?id=cc214fdcf00443531ade6e2fa650426de7debefb)|`Numerous string conversions from bytes to str and from str to bytes for Python 3`|
|[f7e1153](https://git.sagemath.org/sage.git/commit?id=f7e1153918d1da2c451e95fbb9d4f00a393d1752)|`Use str_to_bytes for 'unicode' (which will be str on Python 3 and unicode on Python 2)`|
|[a4d6fe3](https://git.sagemath.org/sage.git/commit?id=a4d6fe3074a6df02eb2fda49fe47767727479294)|`A few additional string conversion fixes for sage.libs.ecl`|
|[d03a8d4](https://git.sagemath.org/sage.git/commit?id=d03a8d450e577e5c1cad95ef825409e6141367c4)|`py3: fix pickling of integers and other minor bytes/str fixes`|
|[e9a582e](https://git.sagemath.org/sage.git/commit?id=e9a582e0a3a5fe777ea34475200f18288fc3db2c)|`import -> cimport where appropriate`|



---

archive/issue_comments_458422.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-30T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458422",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458423.json:
```json
{
    "body": "Changing commit from \"80b0d1f0c5d761c6804abff6bfbf94a1645105c8\" to \"e9a582e0a3a5fe777ea34475200f18288fc3db2c\"",
    "created_at": "2018-01-30T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458423",
    "user": "https://github.com/embray"
}
```

Changing commit from "80b0d1f0c5d761c6804abff6bfbf94a1645105c8" to "e9a582e0a3a5fe777ea34475200f18288fc3db2c"



---

archive/issue_comments_458424.json:
```json
{
    "body": "<a id='comment:38'></a>\n\n```\n[sagelib-8.2.beta4] Error compiling Cython file:\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] ...\n[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_prime_modn import FiniteField_prime_modn\n[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_givaro import FiniteField_givaro\n[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_ntl_gf2e import FiniteField_ntl_gf2e\n[sagelib-8.2.beta4] from sage.libs.pari.all import pari\n[sagelib-8.2.beta4] from sage.libs.gmp.all cimport *\n[sagelib-8.2.beta4] from sage.cpython.string cimport FS_ENCODING, str_to_bytes\n[sagelib-8.2.beta4] ^\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:40:0: 'sage/cpython/string/FS_ENCODING.pxd' not found\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4] Error compiling Cython file:\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] ...\n[sagelib-8.2.beta4]     lib = SINGULAR_SO\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4]     if not os.path.exists(lib):\n[sagelib-8.2.beta4]         raise ImportError(\"cannot locate Singular library ({})\".format(lib))\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4]     lib = str_to_bytes(lib, FS_ENCODING, \"surrogateescape\")\n[sagelib-8.2.beta4]                            ^\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:778:28: 'FS_ENCODING' is not a constant, variable or function identifier\n[sagelib-8.2.beta4] Traceback (most recent call last):\n[sagelib-8.2.beta4]   File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1179, in cythonize_one_helper\n[sagelib-8.2.beta4]     return cythonize_one(*m)\n[sagelib-8.2.beta4]   File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1161, in cythonize_one\n[sagelib-8.2.beta4]     raise CompileError(None, pyx_file)\n[sagelib-8.2.beta4] CompileError: sage/libs/singular/singular.pyx\n```",
    "created_at": "2018-01-31T21:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458424",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>

```
[sagelib-8.2.beta4] Error compiling Cython file:
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] ...
[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_prime_modn import FiniteField_prime_modn
[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_givaro import FiniteField_givaro
[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_ntl_gf2e import FiniteField_ntl_gf2e
[sagelib-8.2.beta4] from sage.libs.pari.all import pari
[sagelib-8.2.beta4] from sage.libs.gmp.all cimport *
[sagelib-8.2.beta4] from sage.cpython.string cimport FS_ENCODING, str_to_bytes
[sagelib-8.2.beta4] ^
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:40:0: 'sage/cpython/string/FS_ENCODING.pxd' not found
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4] Error compiling Cython file:
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] ...
[sagelib-8.2.beta4]     lib = SINGULAR_SO
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4]     if not os.path.exists(lib):
[sagelib-8.2.beta4]         raise ImportError("cannot locate Singular library ({})".format(lib))
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4]     lib = str_to_bytes(lib, FS_ENCODING, "surrogateescape")
[sagelib-8.2.beta4]                            ^
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:778:28: 'FS_ENCODING' is not a constant, variable or function identifier
[sagelib-8.2.beta4] Traceback (most recent call last):
[sagelib-8.2.beta4]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 1179, in cythonize_one_helper
[sagelib-8.2.beta4]     return cythonize_one(*m)
[sagelib-8.2.beta4]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 1161, in cythonize_one
[sagelib-8.2.beta4]     raise CompileError(None, pyx_file)
[sagelib-8.2.beta4] CompileError: sage/libs/singular/singular.pyx
```



---

archive/issue_comments_458425.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-01-31T21:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458425",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_458426.json:
```json
{
    "body": "<a id='comment:39'></a>\nVolker, did you use the latest branch ?",
    "created_at": "2018-02-01T07:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458426",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>
Volker, did you use the latest branch ?



---

archive/issue_comments_458427.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-02-01T12:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458427",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_458428.json:
```json
{
    "body": "<a id='comment:40'></a>\nHe didn't.  Setting this back to positive review since this otherwise fixes Jeroen's issue.",
    "created_at": "2018-02-01T12:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458428",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>
He didn't.  Setting this back to positive review since this otherwise fixes Jeroen's issue.



---

archive/issue_events_061363.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-02T12:06:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24223#event-61363"
}
```



---

archive/issue_comments_458429.json:
```json
{
    "body": "Changing branch from \"u/embray/python3/string-fixes\" to \"e9a582e0a3a5fe777ea34475200f18288fc3db2c\"",
    "created_at": "2018-02-02T12:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458429",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/python3/string-fixes" to "e9a582e0a3a5fe777ea34475200f18288fc3db2c"



---

archive/issue_comments_458430.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-02T12:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-458430",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
