# Issue 24223: py3: several string conversion fixes

archive/issues_023986.json:
```json
{
    "body": "This fixes several (hardly exhaustive) string conversions around Sage such that functions and methods that returned `str` on Python 2 also return `str` on Python 3 (and the same for functions and methods that take `str` as arguments) using the new string utilities from #24222.\n\nThis also incorporates/replaces the fixes from #23812.\n\nCC:  @fchapoton @jdemeyer\n\nBranch/Commit: e9a582e0a3a5fe777ea34475200f18288fc3db2c\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24223\n\n",
    "closed_at": "2018-02-02T12:06:05Z",
    "created_at": "2017-11-16T11:44:24Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "py3: several string conversion fixes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24223",
    "user": "https://github.com/embray"
}
```
This fixes several (hardly exhaustive) string conversions around Sage such that functions and methods that returned `str` on Python 2 also return `str` on Python 3 (and the same for functions and methods that take `str` as arguments) using the new string utilities from #24222.

This also incorporates/replaces the fixes from #23812.

CC:  @fchapoton @jdemeyer

Branch/Commit: e9a582e0a3a5fe777ea34475200f18288fc3db2c

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24223





---

archive/issue_comments_357793.json:
```json
{
    "body": "<a id='comment:1'></a>With this, plus a few other small fixes (including fixes from other existing tickets merged in) I was able to get the Sage REPL up and `1 + 1` working.",
    "created_at": "2017-11-16T11:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357793",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>With this, plus a few other small fixes (including fixes from other existing tickets merged in) I was able to get the Sage REPL up and `1 + 1` working.



---

archive/issue_comments_357794.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-11-20T09:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357795.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-11-20T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357795",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_357796.json:
```json
{
    "body": "<a id='comment:3'></a>Rebased on current version of #24222.",
    "created_at": "2017-11-20T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357796",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>Rebased on current version of #24222.



---

archive/issue_comments_357797.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-11-20T19:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357797",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_357798.json:
```json
{
    "body": "<a id='comment:4'></a>Something is wrong: there are still the files `src/sage/misc/string.*`",
    "created_at": "2017-11-20T19:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357798",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Something is wrong: there are still the files `src/sage/misc/string.*`



---

archive/issue_comments_357799.json:
```json
{
    "body": "<a id='comment:5'></a>This is again a ticket with many small independent changes where a \"partial positive review\" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?",
    "created_at": "2017-11-20T19:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357799",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>This is again a ticket with many small independent changes where a "partial positive review" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?



---

archive/issue_comments_357800.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 jdemeyer]:\n> Something is wrong: there are still the files `src/sage/misc/string.*`\n\n\nOops--part of the problem here is I'm moving between two different working trees, one for Python 2 and one for Python 3, so it can get confusing.  I'll clean this up.",
    "created_at": "2017-11-21T16:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357800",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>Replying to [comment:4 jdemeyer]:
> Something is wrong: there are still the files `src/sage/misc/string.*`


Oops--part of the problem here is I'm moving between two different working trees, one for Python 2 and one for Python 3, so it can get confusing.  I'll clean this up.



---

archive/issue_comments_357801.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 jdemeyer]:\n> This is again a ticket with many small independent changes where a \"partial positive review\" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?\n\n\nI'd be fine if you proposed your changes and tossed it back to me as \"needs review\", rather than going immediately to \"positive review\".",
    "created_at": "2017-11-21T16:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357801",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>Replying to [comment:5 jdemeyer]:
> This is again a ticket with many small independent changes where a "partial positive review" like what I proposed on #24025 would make sense. I didn't like how we handled that, so how should we proceed here?


I'd be fine if you proposed your changes and tossed it back to me as "needs review", rather than going immediately to "positive review".



---

archive/issue_comments_357802.json:
```json
{
    "body": "<a id='comment:8'></a>It seems strange to me to use `locale.getpreferredencoding()` for strings which do not depend on the locale. I would propose:\n\n1. Use `locale.getpreferredencoding()` for strings which actually depend on the locale.\n\n2. Use `sys.getfilesystemencoding()` for strings which actually depend on the file system encoding.\n\n3. Use UTF-8 otherwise.",
    "created_at": "2017-11-22T14:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357802",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>It seems strange to me to use `locale.getpreferredencoding()` for strings which do not depend on the locale. I would propose:

1. Use `locale.getpreferredencoding()` for strings which actually depend on the locale.

2. Use `sys.getfilesystemencoding()` for strings which actually depend on the file system encoding.

3. Use UTF-8 otherwise.



---

archive/issue_events_061362.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-12-12T08:27:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24223#event-61362"
}
```



---

archive/issue_comments_357803.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-21T11:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357804.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-21T11:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357805.json:
```json
{
    "body": "<a id='comment:12'></a>Is this needs_review again?",
    "created_at": "2017-12-27T19:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357805",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Is this needs_review again?



---

archive/issue_comments_357806.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-02T14:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357806",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357807.json:
```json
{
    "body": "<a id='comment:13'></a>Yeah, IIRC this was just a bunch of miscellaneous string conversions from some other tickets, but redone using the `sage.cpython.string` utilities.",
    "created_at": "2018-01-02T14:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357807",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>Yeah, IIRC this was just a bunch of miscellaneous string conversions from some other tickets, but redone using the `sage.cpython.string` utilities.



---

archive/issue_comments_357808.json:
```json
{
    "body": "<a id='comment:14'></a>3 failing doctests in integer.pyx",
    "created_at": "2018-01-03T12:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357808",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>3 failing doctests in integer.pyx



---

archive/issue_comments_357809.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-05T08:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357809",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_357810.json:
```json
{
    "body": "<a id='comment:16'></a>Interesting--when I added `str_to_bytes` I predicted we might later want to allow Python 2 `unicode` objects to be supported somehow, but put it off because I didn't think there was much code in Sage that already was expected to handle `unicode` (except in a few places like unicode art, etc.).  But the tests that are failing here clearly show that there are some places it's expected to work.\n\nSo I see at least three options:\n\n1. Modify `str_to_bytes` to treat `unicode` appropriate on Python 2\n2. Add some new function like `unicode_to_str` that's analogous to `str_to_bytes` (I'm not crazy about this)\n3. Just special case `unicode` on Python 2 where we do want to support it.\n\nI lean towards 1. but I'm open to ideas.",
    "created_at": "2018-01-05T12:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357810",
    "user": "https://github.com/embray"
}
```

<a id='comment:16'></a>Interesting--when I added `str_to_bytes` I predicted we might later want to allow Python 2 `unicode` objects to be supported somehow, but put it off because I didn't think there was much code in Sage that already was expected to handle `unicode` (except in a few places like unicode art, etc.).  But the tests that are failing here clearly show that there are some places it's expected to work.

So I see at least three options:

1. Modify `str_to_bytes` to treat `unicode` appropriate on Python 2
2. Add some new function like `unicode_to_str` that's analogous to `str_to_bytes` (I'm not crazy about this)
3. Just special case `unicode` on Python 2 where we do want to support it.

I lean towards 1. but I'm open to ideas.



---

archive/issue_comments_357811.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 embray]:\n> I lean towards 1.\n\n\nI agree. We should just support `bytes` and `unicode` (in the Cython sense!) as input to `str_to_bytes` regardless of Python version. One complication is that the Python 3 code path of `str_to_bytes` uses some functions specific to Python 3, so we cannot just run that code on Python 2.",
    "created_at": "2018-01-05T12:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357811",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>Replying to [comment:16 embray]:
> I lean towards 1.


I agree. We should just support `bytes` and `unicode` (in the Cython sense!) as input to `str_to_bytes` regardless of Python version. One complication is that the Python 3 code path of `str_to_bytes` uses some functions specific to Python 3, so we cannot just run that code on Python 2.



---

archive/issue_comments_357812.json:
```json
{
    "body": "<a id='comment:18'></a>Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.  Welcome back btw!",
    "created_at": "2018-01-05T12:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357812",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.  Welcome back btw!



---

archive/issue_comments_357813.json:
```json
{
    "body": "<a id='comment:19'></a>I created a new ticket for this: #24475",
    "created_at": "2018-01-05T12:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357813",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>I created a new ticket for this: #24475



---

archive/issue_comments_357814.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:18 embray]:\n> Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.\n\n\nI would rather avoid that. Instead of `PyUnicode_EncodeLocale`, you can just pass `NULL` as `encoding` to `PyUnicode_AsEncodedString`. That leaves `PyUnicode_AsUTF8` which is really only used to translate the `encoding` and `errors` arguments. We could require that this is always of type `str` (so, not `unicode` on Python 2).",
    "created_at": "2018-01-05T12:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357814",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:18 embray]:
> Right, I'll give it a look though.  It will just have to have a slightly different implementation for Python 2.


I would rather avoid that. Instead of `PyUnicode_EncodeLocale`, you can just pass `NULL` as `encoding` to `PyUnicode_AsEncodedString`. That leaves `PyUnicode_AsUTF8` which is really only used to translate the `encoding` and `errors` arguments. We could require that this is always of type `str` (so, not `unicode` on Python 2).



---

archive/issue_comments_357815.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:18 embray]:\n> I'll give it a look though.\n\n\nI can also do that. Just let me know, to avoid double work.",
    "created_at": "2018-01-05T12:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357815",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Replying to [comment:18 embray]:
> I'll give it a look though.


I can also do that. Just let me know, to avoid double work.



---

archive/issue_comments_357816.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-10T14:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357817.json:
```json
{
    "body": "<a id='comment:23'></a>is this in \"needs_review\" state ?",
    "created_at": "2018-01-15T19:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357817",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>is this in "needs_review" state ?



---

archive/issue_comments_357818.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-17T15:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357819.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-17T15:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357819",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357820.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-19T15:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357821.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-22T13:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_357822.json:
```json
{
    "body": "<a id='comment:29'></a>Looks good to me, globally, even if do not feel I understand everything in detail.\n\nJeroen, do you think we can move forward with this important ticket ?",
    "created_at": "2018-01-23T17:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357822",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>Looks good to me, globally, even if do not feel I understand everything in detail.

Jeroen, do you think we can move forward with this important ticket ?



---

archive/issue_comments_357823.json:
```json
{
    "body": "<a id='comment:30'></a>I always find it a bit unpleasant to review tickets with non-merged dependencies. So I would rather wait until the next beta.\n\nTwo immediate issues that I see:\n\n1. In `src/sage/libs/mpmath/utils.pyx` you add an import that you don't use.\n\n2. In several files, you `import` stuff from `sage.cpython.string` where you could use `cimport`.",
    "created_at": "2018-01-23T19:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357823",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>I always find it a bit unpleasant to review tickets with non-merged dependencies. So I would rather wait until the next beta.

Two immediate issues that I see:

1. In `src/sage/libs/mpmath/utils.pyx` you add an import that you don't use.

2. In several files, you `import` stuff from `sage.cpython.string` where you could use `cimport`.



---

archive/issue_comments_357824.json:
```json
{
    "body": "<a id='comment:31'></a>New commits:",
    "created_at": "2018-01-28T07:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357824",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:31'></a>New commits:



---

archive/issue_comments_357825.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-28T08:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357826.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-29T13:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357826",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357827.json:
```json
{
    "body": "<a id='comment:34'></a>This does not work:\n\n```\n-from sage.cpython.string import FS_ENCODING, str_to_bytes\n+from sage.cpython.string cimport FS_ENCODING, str_to_bytes\n```\n\n`FS_ENCODING` is can't be cimported.",
    "created_at": "2018-01-30T12:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357827",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>This does not work:

```
-from sage.cpython.string import FS_ENCODING, str_to_bytes
+from sage.cpython.string cimport FS_ENCODING, str_to_bytes
```

`FS_ENCODING` is can't be cimported.



---

archive/issue_comments_357828.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-01-30T12:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357828",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_357829.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-30T14:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_357830.json:
```json
{
    "body": "<a id='comment:36'></a>import corrected",
    "created_at": "2018-01-30T14:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357830",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'></a>import corrected



---

archive/issue_comments_357831.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-30T14:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357831",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_357832.json:
```json
{
    "body": "<a id='comment:37'></a>I rebased and squashed some of these changes.\n\n---\nNew commits:",
    "created_at": "2018-01-30T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357832",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>I rebased and squashed some of these changes.

---
New commits:



---

archive/issue_comments_357833.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-30T14:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357833",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357834.json:
```json
{
    "body": "<a id='comment:38'></a>\n```\n[sagelib-8.2.beta4] Error compiling Cython file:\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] ...\n[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_prime_modn import FiniteField_prime_modn\n[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_givaro import FiniteField_givaro\n[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_ntl_gf2e import FiniteField_ntl_gf2e\n[sagelib-8.2.beta4] from sage.libs.pari.all import pari\n[sagelib-8.2.beta4] from sage.libs.gmp.all cimport *\n[sagelib-8.2.beta4] from sage.cpython.string cimport FS_ENCODING, str_to_bytes\n[sagelib-8.2.beta4] ^\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:40:0: 'sage/cpython/string/FS_ENCODING.pxd' not found\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4] Error compiling Cython file:\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] ...\n[sagelib-8.2.beta4]     lib = SINGULAR_SO\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4]     if not os.path.exists(lib):\n[sagelib-8.2.beta4]         raise ImportError(\"cannot locate Singular library ({})\".format(lib))\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4]     lib = str_to_bytes(lib, FS_ENCODING, \"surrogateescape\")\n[sagelib-8.2.beta4]                            ^\n[sagelib-8.2.beta4] ------------------------------------------------------------\n[sagelib-8.2.beta4] \n[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:778:28: 'FS_ENCODING' is not a constant, variable or function identifier\n[sagelib-8.2.beta4] Traceback (most recent call last):\n[sagelib-8.2.beta4]   File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1179, in cythonize_one_helper\n[sagelib-8.2.beta4]     return cythonize_one(*m)\n[sagelib-8.2.beta4]   File \"/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py\", line 1161, in cythonize_one\n[sagelib-8.2.beta4]     raise CompileError(None, pyx_file)\n[sagelib-8.2.beta4] CompileError: sage/libs/singular/singular.pyx\n```",
    "created_at": "2018-01-31T21:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357834",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>
```
[sagelib-8.2.beta4] Error compiling Cython file:
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] ...
[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_prime_modn import FiniteField_prime_modn
[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_givaro import FiniteField_givaro
[sagelib-8.2.beta4] from sage.rings.finite_rings.finite_field_ntl_gf2e import FiniteField_ntl_gf2e
[sagelib-8.2.beta4] from sage.libs.pari.all import pari
[sagelib-8.2.beta4] from sage.libs.gmp.all cimport *
[sagelib-8.2.beta4] from sage.cpython.string cimport FS_ENCODING, str_to_bytes
[sagelib-8.2.beta4] ^
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:40:0: 'sage/cpython/string/FS_ENCODING.pxd' not found
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4] Error compiling Cython file:
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] ...
[sagelib-8.2.beta4]     lib = SINGULAR_SO
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4]     if not os.path.exists(lib):
[sagelib-8.2.beta4]         raise ImportError("cannot locate Singular library ({})".format(lib))
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4]     lib = str_to_bytes(lib, FS_ENCODING, "surrogateescape")
[sagelib-8.2.beta4]                            ^
[sagelib-8.2.beta4] ------------------------------------------------------------
[sagelib-8.2.beta4] 
[sagelib-8.2.beta4] sage/libs/singular/singular.pyx:778:28: 'FS_ENCODING' is not a constant, variable or function identifier
[sagelib-8.2.beta4] Traceback (most recent call last):
[sagelib-8.2.beta4]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 1179, in cythonize_one_helper
[sagelib-8.2.beta4]     return cythonize_one(*m)
[sagelib-8.2.beta4]   File "/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py", line 1161, in cythonize_one
[sagelib-8.2.beta4]     raise CompileError(None, pyx_file)
[sagelib-8.2.beta4] CompileError: sage/libs/singular/singular.pyx
```



---

archive/issue_comments_357835.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-01-31T21:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357835",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_357836.json:
```json
{
    "body": "<a id='comment:39'></a>Volker, did you use the latest branch ?",
    "created_at": "2018-02-01T07:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357836",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>Volker, did you use the latest branch ?



---

archive/issue_comments_357837.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-02-01T12:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357837",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_357838.json:
```json
{
    "body": "<a id='comment:40'></a>He didn't.  Setting this back to positive review since this otherwise fixes Jeroen's issue.",
    "created_at": "2018-02-01T12:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357838",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>He didn't.  Setting this back to positive review since this otherwise fixes Jeroen's issue.



---

archive/issue_events_061363.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-02T12:06:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24223#event-61363"
}
```



---

archive/issue_comments_357839.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-02T12:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24223",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24223#issuecomment-357839",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
