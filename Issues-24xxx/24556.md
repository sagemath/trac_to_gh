# Issue 24556: py3: fix raise StopIteration in generator statements

archive/issues_024319.json:
```json
{
    "body": "Since [PEP-479](https://www.python.org/dev/peps/pep-0479/) it's deprecated to call `raise StopIteration` from within a generator (eventually this will cause a `RuntimeError` to be raised).\n\nPer the PEP:\n\n> Finally, the proposal also clears up the confusion about how to terminate a generator: the proper way is `return`, not `raise StopIteration`.\n\n\nThis fixes several generators in Sage (I think all) that used `raise StopIteration` inappropriately according to the PEP.\n\n**Branch/Commit:** [06155e22e66116bba13c398c1f816b9669cdcb97](https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Erik Bray\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24556\n\n",
    "closed_at": "2018-01-20T20:20:14Z",
    "created_at": "2018-01-17T10:11:10Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "py3: fix raise StopIteration in generator statements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24556",
    "user": "https://github.com/embray"
}
```
Since [PEP-479](https://www.python.org/dev/peps/pep-0479/) it's deprecated to call `raise StopIteration` from within a generator (eventually this will cause a `RuntimeError` to be raised).

Per the PEP:

> Finally, the proposal also clears up the confusion about how to terminate a generator: the proper way is `return`, not `raise StopIteration`.


This fixes several generators in Sage (I think all) that used `raise StopIteration` inappropriately according to the PEP.

**Branch/Commit:** [06155e22e66116bba13c398c1f816b9669cdcb97](https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97)

**Reviewer:** Travis Scrimshaw

**Author:** Erik Bray

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/24556





---

archive/issue_comments_467111.json:
```json
{
    "body": "**Commit:** [53386ed9aa2f86cb1d957a46a41ee6ac6eda614f](https://github.com/sagemath/sagetrac-mirror/commit/53386ed9aa2f86cb1d957a46a41ee6ac6eda614f)",
    "created_at": "2018-01-17T10:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [53386ed9aa2f86cb1d957a46a41ee6ac6eda614f](https://github.com/sagemath/sagetrac-mirror/commit/53386ed9aa2f86cb1d957a46a41ee6ac6eda614f)



---

archive/issue_comments_467112.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/53386ed9aa2f86cb1d957a46a41ee6ac6eda614f\">53386ed</a></td><td><code>Fix several 'raise StopIteration' statements in generator functions.</code></td></tr></table>\n",
    "created_at": "2018-01-17T10:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/53386ed9aa2f86cb1d957a46a41ee6ac6eda614f">53386ed</a></td><td><code>Fix several 'raise StopIteration' statements in generator functions.</code></td></tr></table>




---

archive/issue_comments_467113.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-01-17T14:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467113",
    "user": "https://github.com/embray"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_467114.json:
```json
{
    "body": "**Author:** Erik Bray",
    "created_at": "2018-01-17T14:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467114",
    "user": "https://github.com/embray"
}
```

**Author:** Erik Bray



---

archive/issue_comments_467115.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-01-17T15:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467115",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_467116.json:
```json
{
    "body": "<a id='comment:4'></a>\nTrivial failure in `src/sage/graphs/graph_generators.py` due to change in error message. Once fixed, you can set a positive review on my behalf.",
    "created_at": "2018-01-17T15:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467116",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
Trivial failure in `src/sage/graphs/graph_generators.py` due to change in error message. Once fixed, you can set a positive review on my behalf.



---

archive/issue_comments_467117.json:
```json
{
    "body": "<a id='comment:5'></a>\nTurns out if you return a value from a generator with the `return` statement it will be passed as the first argument to the implicitly raised `StopIteration` so I should just do that.",
    "created_at": "2018-01-18T16:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467117",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Turns out if you return a value from a generator with the `return` statement it will be passed as the first argument to the implicitly raised `StopIteration` so I should just do that.



---

archive/issue_comments_467118.json:
```json
{
    "body": "<a id='comment:6'></a>\nOh, but that only works on Python 3.  In that case I'll special case this one.  The message isn't really important but I'd still rather keep the existing behavior.",
    "created_at": "2018-01-18T16:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467118",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Oh, but that only works on Python 3.  In that case I'll special case this one.  The message isn't really important but I'd still rather keep the existing behavior.



---

archive/issue_comments_467119.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f73be162052e682b5d3d761f5953ad6df82d1b0f\">f73be16</a></td><td><code>Slight special case:</code></td></tr></table>\n",
    "created_at": "2018-01-18T16:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f73be162052e682b5d3d761f5953ad6df82d1b0f">f73be16</a></td><td><code>Slight special case:</code></td></tr></table>




---

archive/issue_comments_467120.json:
```json
{
    "body": "**Changing commit** from \"[53386ed9aa2f86cb1d957a46a41ee6ac6eda614f](https://github.com/sagemath/sagetrac-mirror/commit/53386ed9aa2f86cb1d957a46a41ee6ac6eda614f)\" to \"[f73be162052e682b5d3d761f5953ad6df82d1b0f](https://github.com/sagemath/sagetrac-mirror/commit/f73be162052e682b5d3d761f5953ad6df82d1b0f)\".",
    "created_at": "2018-01-18T16:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[53386ed9aa2f86cb1d957a46a41ee6ac6eda614f](https://github.com/sagemath/sagetrac-mirror/commit/53386ed9aa2f86cb1d957a46a41ee6ac6eda614f)" to "[f73be162052e682b5d3d761f5953ad6df82d1b0f](https://github.com/sagemath/sagetrac-mirror/commit/f73be162052e682b5d3d761f5953ad6df82d1b0f)".



---

archive/issue_comments_467121.json:
```json
{
    "body": "<a id='comment:8'></a>\nNo, that still doesn't work.  Having the return statement with a return value inside a generator is a syntax error at compilation time on Python 2.  Strangely my build didn't fail because of that...",
    "created_at": "2018-01-19T08:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467121",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
No, that still doesn't work.  Having the return statement with a return value inside a generator is a syntax error at compilation time on Python 2.  Strangely my build didn't fail because of that...



---

archive/issue_comments_467122.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97\">06155e2</a></td><td><code>Update this test, since a value is no longer returned in the StopIteration exception</code></td></tr></table>\n",
    "created_at": "2018-01-19T09:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97">06155e2</a></td><td><code>Update this test, since a value is no longer returned in the StopIteration exception</code></td></tr></table>




---

archive/issue_comments_467123.json:
```json
{
    "body": "**Changing commit** from \"[f73be162052e682b5d3d761f5953ad6df82d1b0f](https://github.com/sagemath/sagetrac-mirror/commit/f73be162052e682b5d3d761f5953ad6df82d1b0f)\" to \"[06155e22e66116bba13c398c1f816b9669cdcb97](https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97)\".",
    "created_at": "2018-01-19T09:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f73be162052e682b5d3d761f5953ad6df82d1b0f](https://github.com/sagemath/sagetrac-mirror/commit/f73be162052e682b5d3d761f5953ad6df82d1b0f)" to "[06155e22e66116bba13c398c1f816b9669cdcb97](https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97)".



---

archive/issue_comments_467124.json:
```json
{
    "body": "<a id='comment:10'></a>\nEnded up just changing the test.  Not thrilled about that, but I can't think of a good way to support this use case in cross-compatible manner (it's actually technically Python 3.3 where return value from a generator became allowed).  The only way I can think of is a decorator along with a special exception class for returning a value out of the generator, and then re-raising it as a `StopIteration`.  But that's a lot of cognitive overhead for a use case that, in this case anyway, is not very important.  The message is helpful, but not critical.",
    "created_at": "2018-01-19T09:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467124",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Ended up just changing the test.  Not thrilled about that, but I can't think of a good way to support this use case in cross-compatible manner (it's actually technically Python 3.3 where return value from a generator became allowed).  The only way I can think of is a decorator along with a special exception class for returning a value out of the generator, and then re-raising it as a `StopIteration`.  But that's a lot of cognitive overhead for a use case that, in this case anyway, is not very important.  The message is helpful, but not critical.



---

archive/issue_comments_467125.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-01-19T14:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467125",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_467126.json:
```json
{
    "body": "<a id='comment:11'></a>\nAgreed.",
    "created_at": "2018-01-19T14:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467126",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Agreed.



---

archive/issue_events_070428.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-01-20T20:20:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24556#event-70428"
}
```



---

archive/issue_comments_467127.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/python3/stopiteration](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/stopiteration)\" to \"[06155e22e66116bba13c398c1f816b9669cdcb97](https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97)\".",
    "created_at": "2018-01-20T20:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467127",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/embray/python3/stopiteration](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/stopiteration)" to "[06155e22e66116bba13c398c1f816b9669cdcb97](https://github.com/sagemath/sagetrac-mirror/commit/06155e22e66116bba13c398c1f816b9669cdcb97)".



---

archive/issue_comments_467128.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-01-20T20:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24556#issuecomment-467128",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
