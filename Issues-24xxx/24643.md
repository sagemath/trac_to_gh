# Issue 24643: Fix linking of Flint on FreeBSD and other platforms

archive/issues_024406.json:
```json
{
    "body": "On #24596, we see (on SPARC Solaris 11)\n\n```\nImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory\n```\n\nIndeed, Flint fails to create `libflint.so.13`, it only creates\n`libflint.so` (a link) and `libflint.so.13.*` (the real library).\n\n**Upstream**: https://github.com/wbhart/flint2/pull/347\n\nThis fixes FLINT at least on FreeBSD and Solaris.\n\nBranch/Commit: 3df9f9ffabb2b7ec588646160c337521089c30bd\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Jeroen Demeyer\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24643\n\n",
    "closed_at": "2018-02-09T23:47:23Z",
    "created_at": "2018-02-02T11:38:35Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Fix linking of Flint on FreeBSD and other platforms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24643",
    "user": "https://github.com/dimpase"
}
```
On #24596, we see (on SPARC Solaris 11)

```
ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory
```

Indeed, Flint fails to create `libflint.so.13`, it only creates
`libflint.so` (a link) and `libflint.so.13.*` (the real library).

**Upstream**: https://github.com/wbhart/flint2/pull/347

This fixes FLINT at least on FreeBSD and Solaris.

Branch/Commit: 3df9f9ffabb2b7ec588646160c337521089c30bd

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Jeroen Demeyer

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24643





---

archive/issue_comments_364038.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,13 @@\n ```\n ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory\n ```\n+\n+Indeed, Flint fails to create `libflint.so.13`, it only creates\n+`libflint.so` (a link) and `libflint.so.13.*` (the real library).\n+I have fixed this kind of error in Flint on FreeBSD, see\n+https://github.com/wbhart/flint2/pull/347\n+\n+Thus updating the corresponding `case` in `configure` to include `SunOS` might be enough.\n \n Upstream: Not yet reported upstream; Will do shortly.\n \n``````\n",
    "created_at": "2018-02-02T13:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364038",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,13 @@
 ```
 ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory
 ```
+
+Indeed, Flint fails to create `libflint.so.13`, it only creates
+`libflint.so` (a link) and `libflint.so.13.*` (the real library).
+I have fixed this kind of error in Flint on FreeBSD, see
+https://github.com/wbhart/flint2/pull/347
+
+Thus updating the corresponding `case` in `configure` to include `SunOS` might be enough.
 
 Upstream: Not yet reported upstream; Will do shortly.
 
``````




---

archive/issue_comments_364039.json:
```json
{
    "body": "<a id='comment:2'></a>So FLINT doesn't use libtool? This is yet another good example of why writing your own build system is doomed to fail.",
    "created_at": "2018-02-02T15:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364039",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>So FLINT doesn't use libtool? This is yet another good example of why writing your own build system is doomed to fail.



---

archive/issue_comments_364040.json:
```json
{
    "body": "<a id='comment:3'></a>indeed.",
    "created_at": "2018-02-02T16:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364040",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>indeed.



---

archive/issue_comments_364041.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2018-02-05T12:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364041",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_364042.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-05T12:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364042",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_364043.json:
```json
{
    "body": "<a id='comment:5'></a>Has this been reported upstream? The upstream bug report is not the same as the patch that you are adding here. By the way, why special case `FreeBSD` and `SunOS`? The patch seems written under the assumption that `ldconfig` will never on those systems. I think it's better to check anyway. So in other words, I have some doubts about this change:\n\n```diff\n+diff --git a/configure b/configure\n+index 424ab0a..959a650 100755\n+--- a/configure\n++++ b/configure\n+@@ -450,7 +450,7 @@ fi\n+ \n+ # sometimes LDCONFIG is not to be found in the path. Look at some common places.\n+ case \"$OS\" in\n+-   MINGW*|CYGWIN*|Darwin)\n++   MINGW*|CYGWIN*|Darwin|FreeBSD|SunOS)\n+       LDCONFIG=\"true\";;\n+    *)\n+       if [ -z \"$LDCONFIG\" ]; then\n```\nThe rest of the patch looks reasonable.",
    "created_at": "2018-02-05T19:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364043",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Has this been reported upstream? The upstream bug report is not the same as the patch that you are adding here. By the way, why special case `FreeBSD` and `SunOS`? The patch seems written under the assumption that `ldconfig` will never on those systems. I think it's better to check anyway. So in other words, I have some doubts about this change:

```diff
+diff --git a/configure b/configure
+index 424ab0a..959a650 100755
+--- a/configure
++++ b/configure
+@@ -450,7 +450,7 @@ fi
+ 
+ # sometimes LDCONFIG is not to be found in the path. Look at some common places.
+ case "$OS" in
+-   MINGW*|CYGWIN*|Darwin)
++   MINGW*|CYGWIN*|Darwin|FreeBSD|SunOS)
+       LDCONFIG="true";;
+    *)
+       if [ -z "$LDCONFIG" ]; then
```
The rest of the patch looks reasonable.



---

archive/issue_comments_364044.json:
```json
{
    "body": "<a id='comment:6'></a>The extended commit message explains:\n\n```\nbackported from https://github.com/wbhart/flint2/commit/6a9fb5340828918707ab9aadb5f842fb1a1e5952\nwith adding SunOS to the list of OSes needing special treatment in\nline 506 (on upstream branch) of configure.\n```\n\nI have not yet proposed to upstream adding SunOS",
    "created_at": "2018-02-05T19:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364044",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>The extended commit message explains:

```
backported from https://github.com/wbhart/flint2/commit/6a9fb5340828918707ab9aadb5f842fb1a1e5952
with adding SunOS to the list of OSes needing special treatment in
line 506 (on upstream branch) of configure.
```

I have not yet proposed to upstream adding SunOS



---

archive/issue_comments_364045.json:
```json
{
    "body": "<a id='comment:7'></a>I would like to try the exact upstream commit without special-casing for SunOS.",
    "created_at": "2018-02-05T21:02:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364045",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I would like to try the exact upstream commit without special-casing for SunOS.



---

archive/issue_comments_364046.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 dimpase]:\n> The extended commit message\n\n\nThat information belongs in the patch, not the commit message.",
    "created_at": "2018-02-05T21:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364046",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:6 dimpase]:
> The extended commit message


That information belongs in the patch, not the commit message.



---

archive/issue_comments_364047.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 jdemeyer]:\n> I would like to try the exact upstream commit without special-casing for SunOS.\n\n\nThe exact upstream commit does not apply, as it is few dozens commits later than our MPIR. So it needs rebasing. \nThe difference between the rebased upstream commit and this patch is as follows:\n\n```\n+-   MINGW*|CYGWIN*|Darwin|FreeBSD)\n++   MINGW*|CYGWIN*|Darwin|FreeBSD|SunOS)\n```\n\nSo you may try removing this chunk, if you must...\n\nIn turn, the upstream commit is merging my pull request:\nhttps://github.com/wbhart/flint2/pull/347\nwhich was addressing the same sort of issue on FreeBSD.\nAnd indeed it was needed to go from `MINGW*|CYGWIN*|Darwin)` to\n`MINGW*|CYGWIN*|Darwin|FreeBSD)` in the very same place.",
    "created_at": "2018-02-05T21:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364047",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:7 jdemeyer]:
> I would like to try the exact upstream commit without special-casing for SunOS.


The exact upstream commit does not apply, as it is few dozens commits later than our MPIR. So it needs rebasing. 
The difference between the rebased upstream commit and this patch is as follows:

```
+-   MINGW*|CYGWIN*|Darwin|FreeBSD)
++   MINGW*|CYGWIN*|Darwin|FreeBSD|SunOS)
```

So you may try removing this chunk, if you must...

In turn, the upstream commit is merging my pull request:
https://github.com/wbhart/flint2/pull/347
which was addressing the same sort of issue on FreeBSD.
And indeed it was needed to go from `MINGW*|CYGWIN*|Darwin)` to
`MINGW*|CYGWIN*|Darwin|FreeBSD)` in the very same place.



---

archive/issue_comments_364048.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 jdemeyer]:\n> Replying to [comment:6 dimpase]:\n> > The extended commit message\n\n> \n> That information belongs in the patch, not the commit message.\n\nthe commit message is a part of the patch/branch, isn't it?\n(just click on the commit hyperlink in comment 4, and you see it here)",
    "created_at": "2018-02-05T21:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364048",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Replying to [comment:8 jdemeyer]:
> Replying to [comment:6 dimpase]:
> > The extended commit message

> 
> That information belongs in the patch, not the commit message.

the commit message is a part of the patch/branch, isn't it?
(just click on the commit hyperlink in comment 4, and you see it here)



---

archive/issue_comments_364049.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 dimpase]:\n> the commit message is a part of the patch/branch, isn't it?\n\n\nYes but it serves a different purpose. The commit message is only relevant at the time of merging the commit for example. It doesn't reflect possible future insights.",
    "created_at": "2018-02-05T22:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364049",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 dimpase]:
> the commit message is a part of the patch/branch, isn't it?


Yes but it serves a different purpose. The commit message is only relevant at the time of merging the commit for example. It doesn't reflect possible future insights.



---

archive/issue_comments_364050.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-05T22:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364050",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_364051.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:9 dimpase]:\n> So you may try removing this chunk, if you must...\n\nI will (to be precise: not without that complete hunk, just adding only `FreeBSD` like the upstream patch)",
    "created_at": "2018-02-05T22:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364051",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:9 dimpase]:
> So you may try removing this chunk, if you must...

I will (to be precise: not without that complete hunk, just adding only `FreeBSD` like the upstream patch)



---

archive/issue_comments_364052.json:
```json
{
    "body": "<a id='comment:14'></a>Also, the version of FLINT should be increased.",
    "created_at": "2018-02-05T22:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364052",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Also, the version of FLINT should be increased.



---

archive/issue_comments_364053.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:5 jdemeyer]:\n> Has this been reported upstream? The upstream bug report is not the same as the patch that you are adding here. By the way, why special case `FreeBSD` and `SunOS`?\n\n\nOn FreeBSD ldconfig does not accept the option `-n`, it needs `-m` or something like this. \nThat's why it's necessary to special-case FreeBSD.",
    "created_at": "2018-02-05T23:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364053",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>Replying to [comment:5 jdemeyer]:
> Has this been reported upstream? The upstream bug report is not the same as the patch that you are adding here. By the way, why special case `FreeBSD` and `SunOS`?


On FreeBSD ldconfig does not accept the option `-n`, it needs `-m` or something like this. 
That's why it's necessary to special-case FreeBSD.



---

archive/issue_comments_364054.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-06T00:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_364055.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-06T00:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364055",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_364056.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,15 @@\n+On #24596, we see (on SPARC Solaris 11)\n \n+```\n+ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory\n+```\n+\n+Indeed, Flint fails to create `libflint.so.13`, it only creates\n+`libflint.so` (a link) and `libflint.so.13.*` (the real library).\n+\n+**Upstream**: https://github.com/wbhart/flint2/pull/347\n+\n+This fixes FLINT at least on FreeBSD and Solaris.\n \n Upstream: Not yet reported upstream; Will do shortly.\n \n``````\n",
    "created_at": "2018-02-06T06:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364056",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,15 @@
+On #24596, we see (on SPARC Solaris 11)
 
+```
+ImportError: ld.so.1: python2.7: fatal: libflint.so.13: open failed: No such file or directory
+```
+
+Indeed, Flint fails to create `libflint.so.13`, it only creates
+`libflint.so` (a link) and `libflint.so.13.*` (the real library).
+
+**Upstream**: https://github.com/wbhart/flint2/pull/347
+
+This fixes FLINT at least on FreeBSD and Solaris.
 
 Upstream: Not yet reported upstream; Will do shortly.
 
``````




---

archive/issue_comments_364057.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-07T10:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364057",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_364058.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-09T23:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24643#issuecomment-364058",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062057.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-02-09T23:47:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24643",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24643#event-62057"
}
```
