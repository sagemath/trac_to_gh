# Issue 24907: GCC is installed multiple times

archive/issues_024670.json:
```json
{
    "body": "#24599 introduced an import regression: GCC is installed multiple times:\n\n```\njdemeyer@sardonis:~/sage-gcc$ grep 'Setting up build directory for gcc' logs/install.log \n[gcc-7.2.0] Setting up build directory for gcc-7.2.0\n[gcc-7.2.0] Setting up build directory for gcc-7.2.0\n[gcc-7.2.0] Setting up build directory for gcc-7.2.0\n```\n\nCC:  @embray\n\nReviewer: Volker Braun\n\nAuthor: Jeroen Demeyer\n\nBranch: a682787fb43197162f4f562bec4f311431994561\n\nDependencies: #24867\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/24907\n\n",
    "closed_at": "2018-03-19T07:57:37Z",
    "created_at": "2018-03-06T10:17:16Z",
    "labels": [
        "component: build: configure",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "GCC is installed multiple times",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24907",
    "user": "https://github.com/jdemeyer"
}
```
#24599 introduced an import regression: GCC is installed multiple times:

```
jdemeyer@sardonis:~/sage-gcc$ grep 'Setting up build directory for gcc' logs/install.log 
[gcc-7.2.0] Setting up build directory for gcc-7.2.0
[gcc-7.2.0] Setting up build directory for gcc-7.2.0
[gcc-7.2.0] Setting up build directory for gcc-7.2.0
```

CC:  @embray

Reviewer: Volker Braun

Author: Jeroen Demeyer

Branch: a682787fb43197162f4f562bec4f311431994561

Dependencies: #24867

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/24907





---

archive/issue_comments_345755.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-03-08T09:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345755",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_345756.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-08T09:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345756",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_345757.json:
```json
{
    "body": "<a id='comment:3'></a>\n```\n+            rm -f \"$SAGE_LOCAL\"/gcc\n+            rm -f \"$SAGE_LOCAL\"/g++\n```\nDo you mean `\"$SAGE_LOCAL\"/bin/gcc` etc. here? And what does it mean to \"pretend\" that it is not installed?",
    "created_at": "2018-03-09T04:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345757",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
```
+            rm -f "$SAGE_LOCAL"/gcc
+            rm -f "$SAGE_LOCAL"/g++
```
Do you mean `"$SAGE_LOCAL"/bin/gcc` etc. here? And what does it mean to "pretend" that it is not installed?



---

archive/issue_comments_345758.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-09T06:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345758",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_345759.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-09T09:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345759",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_345760.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-09T09:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345760",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_345761.json:
```json
{
    "body": "<a id='comment:7'></a>This looks fine to me but I don't fully understand the details of how gcc and its dependencies are installed in sage, so someone else should finish the review of this ticket.",
    "created_at": "2018-03-10T00:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345761",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>This looks fine to me but I don't fully understand the details of how gcc and its dependencies are installed in sage, so someone else should finish the review of this ticket.



---

archive/issue_comments_345762.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-13T23:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345762",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_345763.json:
```json
{
    "body": "<a id='comment:9'></a>This wasn't the cause for the breakage in ppl/givaro noted at #24703#comment:17, various 32-bit buildbots are still borked",
    "created_at": "2018-03-16T22:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345763",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>This wasn't the cause for the breakage in ppl/givaro noted at #24703#comment:17, various 32-bit buildbots are still borked



---

archive/issue_comments_345764.json:
```json
{
    "body": "<a id='comment:10'></a>In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:\n\n```\nbuildbot@sagebd07_32s02:~/slave/sage_git/build$ grep -B 1 able-cxx logs/pkgs/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.log \nConfiguring MPIR with the following options:\n    --prefix=\"/home/buildbot/slave/sage_git/build/local\" --libdir=\"/home/buildbot/slave/sage_git/build/local/lib\" --enable-gmpcompat --enable-shared  --disable-cxx --disable-static\n```",
    "created_at": "2018-03-16T22:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345764",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:

```
buildbot@sagebd07_32s02:~/slave/sage_git/build$ grep -B 1 able-cxx logs/pkgs/mpir-3.0.0-644faf502c56f97d9accd301965fc57d6ec70868.log 
Configuring MPIR with the following options:
    --prefix="/home/buildbot/slave/sage_git/build/local" --libdir="/home/buildbot/slave/sage_git/build/local/lib" --enable-gmpcompat --enable-shared  --disable-cxx --disable-static
```



---

archive/issue_comments_345765.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-03-16T22:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345765",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_345766.json:
```json
{
    "body": "<a id='comment:12'></a>It does fix the building-gcc-twice bug tho; but maybe the remaining toolchain dependencies coud be fixed here as well?",
    "created_at": "2018-03-16T22:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345766",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>It does fix the building-gcc-twice bug tho; but maybe the remaining toolchain dependencies coud be fixed here as well?



---

archive/issue_comments_345767.json:
```json
{
    "body": "<a id='comment:13'></a>If you insist... but one could also consider that an independent bug.",
    "created_at": "2018-03-17T07:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345767",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>If you insist... but one could also consider that an independent bug.



---

archive/issue_comments_345768.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:10 vbraun]:\n> In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:\n\n\nI think that might have been broken in #21524.",
    "created_at": "2018-03-17T07:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345768",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Replying to [comment:10 vbraun]:
> In fact mpir isn't built a second time, there is only the first build which does disable the c++ interface:


I think that might have been broken in #21524.



---

archive/issue_comments_345769.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-17T08:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345769",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_345770.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-17T08:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345770",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_345771.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-19T07:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345771",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062550.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-19T07:57:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24907#event-62550"
}
```



---

archive/issue_comments_345772.json:
```json
{
    "body": "<a id='comment:18'></a>I didn't even get to see this before it was closed as \"fixed\", but I must insist that in the future `./configure` should not be doing weird things that modify `$SAGE_LOCAL`.\n\nInstead this should change something about how the makefile works...",
    "created_at": "2018-03-19T11:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345772",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>I didn't even get to see this before it was closed as "fixed", but I must insist that in the future `./configure` should not be doing weird things that modify `$SAGE_LOCAL`.

Instead this should change something about how the makefile works...



---

archive/issue_comments_345773.json:
```json
{
    "body": "<a id='comment:19'></a>What's a reliable way to reproduce this, so that I can try out a different fix?  Is it just to install Sage's gcc package, and then what?  Why would the gcc in Sage be broken?",
    "created_at": "2018-03-19T11:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345773",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>What's a reliable way to reproduce this, so that I can try out a different fix?  Is it just to install Sage's gcc package, and then what?  Why would the gcc in Sage be broken?



---

archive/issue_comments_345774.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 embray]:\n> What's a reliable way to reproduce this\n\n\nRevert this commit and build Sage with `SAGE_INSTALL_GCC=yes`. It should only build GCC once.\n\n> Why would the gcc in Sage be broken?\n\n\nBecause the libraries it depends on are upgraded, see #24599.",
    "created_at": "2018-03-19T12:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345774",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 embray]:
> What's a reliable way to reproduce this


Revert this commit and build Sage with `SAGE_INSTALL_GCC=yes`. It should only build GCC once.

> Why would the gcc in Sage be broken?


Because the libraries it depends on are upgraded, see #24599.



---

archive/issue_comments_345775.json:
```json
{
    "body": "<a id='comment:21'></a>I still cannot figure out an exact sequence of steps to reproduce this on 8.2.beta8.  I install GCC, then I install giac, then I `./sage -f gcc`?  Seems to work...  Should I go back to an older version?",
    "created_at": "2018-03-20T15:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345775",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>I still cannot figure out an exact sequence of steps to reproduce this on 8.2.beta8.  I install GCC, then I install giac, then I `./sage -f gcc`?  Seems to work...  Should I go back to an older version?



---

archive/issue_comments_345776.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 embray]:\n> I still cannot figure out an exact sequence of steps to reproduce this\n\n\nWhat is \"this\"? #24907 or #24599?",
    "created_at": "2018-03-20T20:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345776",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>Replying to [comment:21 embray]:
> I still cannot figure out an exact sequence of steps to reproduce this


What is "this"? #24907 or #24599?



---

archive/issue_comments_345777.json:
```json
{
    "body": "<a id='comment:23'></a>Both, really.  I can't reproduce #24907 (this ticket, hence \"this\").  But I don't know how to reproduce it without reproducing #24599 which I also can't do (but maybe I have to go back to an older version to do that).",
    "created_at": "2018-03-21T09:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24907#issuecomment-345777",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>Both, really.  I can't reproduce #24907 (this ticket, hence "this").  But I don't know how to reproduce it without reproducing #24599 which I also can't do (but maybe I have to go back to an older version to do that).
