# Issue 33569: symbolic/random_tests.py test failure

Issue created by migration from https://trac.sagemath.org/ticket/33806

Original creator: @collares

Original creation time: 2022-05-05 12:11:10

Happened on Sage 9.6rc3 on x86_64 when doctesting with `--long --all` and 48 threads. See also #33794 for a similarly mysterious AttributeError; #33794#comment:5 hypothesized a caching bug as a possible cause.


```
**********************************************************************
File "/nix/store/nkqf50khp5687qv1am8wp1r28z928jcq-sage-src-9.6.rc3/src/sage/symbolic/random_tests.py", line 429, in sage.symbolic.random_tests.test_symbolic_expression_order
Failed example:
    test_symbolic_expression_order(10000)  # long time
Exception raised:
    Traceback (most recent call last):
      File "/nix/store/a9csyhp9lkqhm3in804mca3a3k2vyblh-python3-3.9.12-env/lib/python3.9/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/nix/store/a9csyhp9lkqhm3in804mca3a3k2vyblh-python3-3.9.12-env/lib/python3.9/site-packages/sage/doctest/forker.py", line 1101, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.random_tests.test_symbolic_expression_order[2]>", line 1, in <module>
        test_symbolic_expression_order(Integer(10000))  # long time
      File "/nix/store/a9csyhp9lkqhm3in804mca3a3k2vyblh-python3-3.9.12-env/lib/python3.9/site-packages/sage/symbolic/random_tests.py", line 455, in test_symbolic_expression_order
        assert_strict_weak_order(a, b, c, lambda x,y: x._cmp_add(y))
      File "/nix/store/a9csyhp9lkqhm3in804mca3a3k2vyblh-python3-3.9.12-env/lib/python3.9/site-packages/sage/symbolic/random_tests.py", line 386, in assert_strict_weak_order
        cmp_M[i, j] = (cmp_func(x[i], x[j]) == 1)   # or -1, doesn't matter
      File "/nix/store/a9csyhp9lkqhm3in804mca3a3k2vyblh-python3-3.9.12-env/lib/python3.9/site-packages/sage/symbolic/random_tests.py", line 455, in <lambda>
        assert_strict_weak_order(a, b, c, lambda x,y: x._cmp_add(y))
    AttributeError: 'float' object has no attribute '_cmp_add'
```



---

Comment by @collares created at 2022-05-07 20:57:52

Changing priority from major to minor.


---

Comment by @DaveWitteMorris created at 2022-05-14 02:20:19

Related ticket: #29961 (random symbolic expression is completely unstable)
