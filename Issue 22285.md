# Issue 22285: generic latte_int interface to integrate

Issue created by migration from https://trac.sagemath.org/ticket/22522

Original creator: mforets

Original creation time: 2017-03-05 22:42:01

CC:  vdelecroix mkoeppe jipilab

Provide a generic interface to integrate a polynomial over a polytope.


---

Comment by vdelecroix created at 2017-03-06 00:45:33

Changing keywords from "" to "days84".


---

Comment by mforets created at 2017-03-06 15:42:47

New commits:


---

Comment by mforets created at 2017-03-06 15:42:47

Changing status from new to needs_review.


---

Comment by git created at 2017-03-06 16:04:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2017-03-06 16:10:35

Why your commit `d3c9589` is here!? Shouldn't it belong to another ticket?


---

Comment by git created at 2017-03-06 18:05:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-03-07 00:25:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-03-07 01:43:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2017-03-07 15:48:37

Replying to [comment:6 vdelecroix]:
> Why your commit `d3c9589` is here!? Shouldn't it belong to another ticket?
The branch is on top of the branch of #22497.


---

Comment by mkoeppe created at 2017-03-07 15:49:18

Looks good to me.

Now follow-up tickets with corresponding methods of `Polyhedron` would be good.


---

Comment by mkoeppe created at 2017-03-07 15:49:18

Changing status from needs_review to positive_review.


---

Comment by git created at 2017-03-07 19:14:58

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2017-03-07 19:14:58

Changing status from positive_review to needs_review.


---

Comment by mkoeppe created at 2017-03-07 21:35:25

What does 

```
``[1,[2,2,2]]``
```

do in the doctest?


---

Comment by git created at 2017-03-08 06:44:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-03-08 07:12:56

Replying to [comment:13 mkoeppe]:
> What does 
> {{{
> ``[1,[2,2,2]]``
> }}}
> do in the doctest?

It's me struggling to get tests work in the particular case where a string is passed as argument  :( 

Probably some issue with string conversion. See this:

In the Sage REPL, the usual single quotes work, as in:


```
sage: P = polytopes.cuboctahedron()
sage: P.integrate('[[3,[2,4,6]],[7,[0, 3, 5]]]')   
629/47775
```


(ok I'm already using #20887 for P.integrate(..) but you get the point).

However the doctests didn't pass if I used that, but they pass with the double quote in one test. In Python it seems to have a meaning:


```
sage: type(``x``)
<type 'str'>
```


But I'd like to understand what went wrong with just single quotes, of course.


---

Comment by mkoeppe created at 2017-03-08 07:43:19

Learn about :: in the doc formatting. This will solve your problem.
Also build and verify the html doc.


---

Comment by tscrim created at 2017-03-08 17:17:28

There are also a number of doc issues with `integrate` in `base.py`. The doc should start with

```
    def integrate(self, polynomial, **kwds):
        r"""
        Return the integral of a polynomial over a polytope.

        INPUT:

        - ``polynomial`` -- a multivariate polynomial or a valid LattE description string
          for a polynomial

        - ``**kwds`` -- additional keyword arguments that are passed to the engine

        OUTPUT:

        The integral of the polynomial over the polytope.

        .. NOTE::

            The polytope triangulation algorithm is used. This function depends on
            LattE (i.e., the ``latte_int`` optional package).
```

The code in the `EXAMPLES::` block also needs to be indented (as per comment:16).


---

Comment by git created at 2017-03-09 17:30:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-03-09 17:46:49

done! and thanks both for the help. from my side this ticket and #20887 are ok.

in the proposed solution, the new volume and integrate methods can also receive polyhedra in RDF, and each vertex is cast to QQ with an iterator over the vertices.


---

Comment by vdelecroix created at 2017-03-09 17:52:38

Replying to [comment:19 mforets]:
> done! and thanks both for the help. from my side this ticket and #20887 are ok.

Nice work!

> in the proposed solution, the new volume and integrate methods can also receive polyhedra in RDF, and each vertex is cast to QQ with an iterator over the vertices.

Is the answer of `.integrate()` will be a RDF? Otherwise I think it is a bad idea.


---

Comment by vdelecroix created at 2017-03-09 17:58:36

Replying to [comment:18 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[91d885e](https://git.sagemath.org/sage.git/commit/?id=91d885edbccb92d581781c72f3c5eeb94417d0b8)||`Fix the docstrings, and enhance integrate method.`||
> ||[507aea5](https://git.sagemath.org/sage.git/commit/?id=507aea5adb6f05ddc95cfef7cd79d24d3041de10)||`Add the new volume engine Polyhedron.`||

I don't understand why these commits are here... this ticket is about `generic latte_int interface to integrate`. If you change the purpose of the ticket you need to update the description.


---

Comment by vdelecroix created at 2017-03-09 17:58:46

Changing status from needs_review to needs_work.


---

Comment by mforets created at 2017-03-09 23:06:05

Replying to [comment:20 vdelecroix]:
> Replying to [comment:19 mforets]:
> > done! and thanks both for the help. from my side this ticket and #20887 are ok.
> 
> Nice work!
> 
> > in the proposed solution, the new volume and integrate methods can also receive polyhedra in RDF, and each vertex is cast to QQ with an iterator over the vertices.
> 
> Is the answer of `.integrate()` will be a RDF? Otherwise I think it is a bad idea.

But why? It will be a QQ.


---

Comment by vdelecroix created at 2017-03-09 23:17:43

Replying to [comment:23 mforets]:
> Replying to [comment:20 vdelecroix]:
> > Replying to [comment:19 mforets]:
> > > done! and thanks both for the help. from my side this ticket and #20887 are ok.
> > 
> > Nice work!
> > 
> > > in the proposed solution, the new volume and integrate methods can also receive polyhedra in RDF, and each vertex is cast to QQ with an iterator over the vertices.
> > 
> > Is the answer of `.integrate()` will be a RDF? Otherwise I think it is a bad idea.
> 
> But why? It will be a QQ.

It does not make any sense. If I have a Polyhedron defined over RDF (= non exact field) its volume can not defined as an element of QQ (= exact field).


---

Comment by mforets created at 2017-03-10 07:41:12

Hmm.. Matrices have a change_ring feature that comes very handy for conversion. Shall we add a similar one for Polyhedron? 

And following your recommendation, make integrate and volume via `latte` raise a value error when instantiated with, say, `P = 1.4142*polytopes.cube()`. 

With the change ring, we could still integrate integrate a polynomial over P with the slightly more complicated `P.change_ring().integrate(x<sup>2*y</sup>2*z^2)`, instead of the ugly


```
sage: P_QQ = Polyhedron(vertices = [[QQ(vi) for vi in v] for v in P.vertices_generator()])
sage: P_QQ.integrate(x^2*y^2*z^2)
```


If there are alternative recommended options, I'd really like to learn; but I can post it as a ask.sagemath one if i'm off-topic :)


---

Comment by mkoeppe created at 2017-03-10 07:55:01

Integration over an RDF polyhedron via QQ polyhedron (latte) could make sense _as long as the method converts the answer back to RDF_ to indicate that the answer is inexact.

As to `change_ring`, this could be useful. I had related discussions with JP.


---

Comment by mkoeppe created at 2017-03-10 07:59:14

(In addition to `change_ring`, there could also be `change_backend`.)


---

Comment by git created at 2017-03-10 08:52:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mforets created at 2017-03-10 09:04:08

Changing status from needs_work to needs_review.


---

Comment by mforets created at 2017-03-10 09:14:24

Changing status from needs_review to needs_work.


---

Comment by mforets created at 2017-03-10 14:43:57

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2017-03-14 19:06:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-03-27 20:42:02

Resolution: fixed
