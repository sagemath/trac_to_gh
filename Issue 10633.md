# Issue 10633: speed up computation of T_p in characteristic p

Issue created by migration from Trac.

Original creator: AlexGhitza

Original creation time: 2011-01-25 04:33:15

Assignee: craigcitro

CC:  davidloeffler mraum cremona

Keywords: hecke operator q-expansion

In characteristic p, the formula for the Hecke operator Tp is much simpler (and faster to work through) than in the general case.  It's worth having this as a special case in the code.  

The attached simple patch does this.  Here are some timings on sage-4.6.1, with a speedup factor of 9:

BEFORE:


```
sage: p = 199
sage: fp = delta_qexp(prec=p^2+1, K=GF(p))
sage: timeit("tfp = hecke_operator_on_qexp(fp, p, 12)")
25 loops, best of 3: 22.7 ms per loop
```


AFTER:


```
sage: p = 199
sage: fp = delta_qexp(prec=p^2+1, K=GF(p))
sage: timeit("tfp = hecke_operator_on_qexp(fp, p, 12)")
125 loops, best of 3: 2.51 ms per loop
```




---

Comment by AlexGhitza created at 2011-01-25 04:38:40

Changing status from new to needs_review.


---

Comment by AlexGhitza created at 2011-01-25 04:38:40

Cc-ing some of the usual suspects in case they are looking for something quick to review :)


---

Comment by davidloeffler created at 2011-01-25 08:19:28

Is this formula valid for weight 1 forms? The fact that you're assuming that ` p**(k-1) == 0 ` worries me if `k==1`. I know we haven't implemented weight 1 cusp forms yet, but we do have weight 1 Eis series, and weight 1 cusp forms have been on the to-do list since forever.

As for a review, I'll swap you for any of #5048/#10450/#10451/#10452/#10453/#10658 :-)

David


---

Comment by davidloeffler created at 2011-01-25 08:19:28

Changing status from needs_review to needs_info.


---

Comment by AlexGhitza created at 2011-01-25 10:08:41

Changing status from needs_info to needs_review.


---

Comment by AlexGhitza created at 2011-01-25 10:08:41

Thanks David!  You are completely right, the action on weight 1 forms is not given by the same formula.  I have modified the patch accordingly.

The already existing code should give the right result in weight 1.


---

Comment by AlexGhitza created at 2011-01-25 10:10:48

Replying to [comment:2 davidloeffler]:
> As for a review, I'll swap you for any of #5048/#10450/#10451/#10452/#10453/#10658 :-)

I had a shot at #10450, I hope to have some more time to look at some of the others.


---

Comment by davidloeffler created at 2011-01-25 11:54:08

Changing status from needs_review to needs_work.


---

Comment by davidloeffler created at 2011-01-25 11:54:08

I think there's still an error for the case of non-field base rings. Sage defines the "characteristic" of `Zmod(N)` to be N, which leads to problems modulo prime powers:

```python
sage: E = 240*eisenstein_series_qexp(2, 1000)
sage: hecke_operator_on_qexp(E.change_ring(Zmod(49)), 49, 2) - hecke_operator_on_qexp(E, 49, 2).change_ring(Zmod(49))
21 + 35*q^7 + 7*q^14 + O(q^21)
```



---

Comment by cremona created at 2011-01-25 12:00:58

Well, Z/49 does really have characteristic 49!

Perhaps the simplest thing to do is just detect prime characteristic and use the special code for powers of that, only.  Surely non-prime (positive) characteristic is not used a lot, so efficiency in that case is not crucial?


---

Comment by davidloeffler created at 2011-01-25 12:12:01

Replying to [comment:6 cremona]:
> Well, Z/49 does really have characteristic 49!
> 
> Perhaps the simplest thing to do is just detect prime characteristic and use the special code for powers of that, only.  Surely non-prime (positive) characteristic is not used a lot, so efficiency in that case is not crucial?

Agreed. Alex, can you do a new patch?


---

Attachment


---

Comment by AlexGhitza created at 2011-01-25 12:20:34

Done.  Thanks for catching this.


---

Comment by AlexGhitza created at 2011-01-25 12:20:34

Changing status from needs_work to needs_review.


---

Comment by davidloeffler created at 2011-01-25 13:05:52

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-01-27 13:15:19

Resolution: fixed
