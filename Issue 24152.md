# Issue 24152: Upgrade IPython to 5.5.0

archive/issues_024152.json:
```json
{
    "body": "CC:  @slel @kiwifb\n\nThis ticket upgrades to IPython 5.5.0.\n\nIt also updates some related packages and adds the new dependency \"scandir\".\n\nList of updates:\n- [certifi](https://pypi.python.org/pypi/certifi) 2017.11.5 (from 2016.2.28)\n- [entrypoints](https://pypi.python.org/pypi/entrypoints) 0.2.3 (from 0.2.2)\n- [ipykernel](https://pypi.python.org/pypi/ipykernel) now depends on\n  [scandir](https://pypi.python.org/pypi/scandir)\n- [ipython](https://pypi.python.org/pypi/ipython) 5.5.0 (from 5.1.0)\n  (fixes \"extra blank line in multi-line output\" issue)\n- [pathlib2](https://pypi.python.org/pypi/pathlib2) 2.3.0 (from 2.1.0)\n- [prompt_toolkit](https://pypi.python.org/pypi/prompt_toolkit) 1.0.15 (from 1.0.9)\n- [scandir](https://pypi.python.org/pypi/scandir) 1.6 (new standard package)\n  -- \"a better directory iterator and faster os.walk()\"\n- [terminado](https://pypi.python.org/pypi/terminado) 0.8.1 (from 0.6)\n- [traitlets](https://pypi.python.org/pypi/traitlets) 4.3.2 (from 4.3.1)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24389\n\n",
    "closed_at": "2017-12-25T18:21:32Z",
    "created_at": "2017-12-16T13:43:34Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Upgrade IPython to 5.5.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24152",
    "user": "https://github.com/vbraun"
}
```
CC:  @slel @kiwifb

This ticket upgrades to IPython 5.5.0.

It also updates some related packages and adds the new dependency "scandir".

List of updates:
- [certifi](https://pypi.python.org/pypi/certifi) 2017.11.5 (from 2016.2.28)
- [entrypoints](https://pypi.python.org/pypi/entrypoints) 0.2.3 (from 0.2.2)
- [ipykernel](https://pypi.python.org/pypi/ipykernel) now depends on
  [scandir](https://pypi.python.org/pypi/scandir)
- [ipython](https://pypi.python.org/pypi/ipython) 5.5.0 (from 5.1.0)
  (fixes "extra blank line in multi-line output" issue)
- [pathlib2](https://pypi.python.org/pypi/pathlib2) 2.3.0 (from 2.1.0)
- [prompt_toolkit](https://pypi.python.org/pypi/prompt_toolkit) 1.0.15 (from 1.0.9)
- [scandir](https://pypi.python.org/pypi/scandir) 1.6 (new standard package)
  -- "a better directory iterator and faster os.walk()"
- [terminado](https://pypi.python.org/pypi/terminado) 0.8.1 (from 0.6)
- [traitlets](https://pypi.python.org/pypi/traitlets) 4.3.2 (from 4.3.1)


Issue created by migration from https://trac.sagemath.org/ticket/24389





---

archive/issue_comments_338123.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to notebook.",
    "created_at": "2017-12-16T15:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338123",
    "user": "https://github.com/vbraun"
}
```

Changing component from PLEASE CHANGE to notebook.



---

archive/issue_comments_338124.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2017-12-16T15:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338124",
    "user": "https://github.com/vbraun"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_338125.json:
```json
{
    "body": "Related because it will supercede it: #23125. There are things that will probably still be relevant in that issue.",
    "created_at": "2017-12-16T19:21:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338125",
    "user": "https://github.com/kiwifb"
}
```

Related because it will supercede it: #23125. There are things that will probably still be relevant in that issue.



---

archive/issue_comments_338126.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-17T14:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338126",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_338127.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-17T14:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338127",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_338128.json:
```json
{
    "body": "Attached branch fixes the issue from #24389",
    "created_at": "2017-12-17T14:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338128",
    "user": "https://github.com/vbraun"
}
```

Attached branch fixes the issue from #24389



---

archive/issue_comments_338129.json:
```json
{
    "body": "Does this *require* an upgrade of widgetsnbextension or did you just upgrade for the sake of upgrading? I'm asking because widgetsnbextension might need to be synchronized with ipywidgets.",
    "created_at": "2017-12-17T18:01:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338129",
    "user": "https://github.com/jdemeyer"
}
```

Does this *require* an upgrade of widgetsnbextension or did you just upgrade for the sake of upgrading? I'm asking because widgetsnbextension might need to be synchronized with ipywidgets.



---

archive/issue_comments_338130.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-17T19:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_338131.json:
```json
{
    "body": "I guess we should also update ipywidgets to the latests release. I was trying to update all ipy/jupyter stuff, I haven't really tried to figure out whether anything breaks if we don't update it together. At least the widgets that I tried did still work...",
    "created_at": "2017-12-17T19:44:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338131",
    "user": "https://github.com/vbraun"
}
```

I guess we should also update ipywidgets to the latests release. I was trying to update all ipy/jupyter stuff, I haven't really tried to figure out whether anything breaks if we don't update it together. At least the widgets that I tried did still work...



---

archive/issue_comments_338132.json:
```json
{
    "body": "Replying to [comment:8 vbraun]:\n> I guess we should also update ipywidgets to the latests release. I was trying to update all ipy/jupyter stuff, I haven't really tried to figure out whether anything breaks if we don't update it together. At least the widgets that I tried did still work...\n\n\nWell there is #23177 about `ipywidgets` and Jeroen and I haven't done anything about the problems it triggers so far.",
    "created_at": "2017-12-17T20:05:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338132",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:8 vbraun]:
> I guess we should also update ipywidgets to the latests release. I was trying to update all ipy/jupyter stuff, I haven't really tried to figure out whether anything breaks if we don't update it together. At least the widgets that I tried did still work...


Well there is #23177 about `ipywidgets` and Jeroen and I haven't done anything about the problems it triggers so far.



---

archive/issue_comments_338133.json:
```json
{
    "body": "Other than that, I am happy with the fix to `forker.py`, it fixes my doctest.",
    "created_at": "2017-12-17T20:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338133",
    "user": "https://github.com/kiwifb"
}
```

Other than that, I am happy with the fix to `forker.py`, it fixes my doctest.



---

archive/issue_comments_338134.json:
```json
{
    "body": "You could have told me about #23177 straight away... I'll try to leave widgetsnbextension/ipywidgets at the old version, then.",
    "created_at": "2017-12-17T21:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338134",
    "user": "https://github.com/vbraun"
}
```

You could have told me about #23177 straight away... I'll try to leave widgetsnbextension/ipywidgets at the old version, then.



---

archive/issue_comments_338135.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-12-17T22:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338135",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_338136.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-17T23:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338136",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_338137.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-21T00:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338137",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_338138.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-12-21T01:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338138",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_338139.json:
```json
{
    "body": "I was not sure why it did go back to \"needs work\". Looks good to me.",
    "created_at": "2017-12-21T01:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338139",
    "user": "https://github.com/kiwifb"
}
```

I was not sure why it did go back to "needs work". Looks good to me.



---

archive/issue_comments_338140.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-25T18:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338140",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061649.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-12-25T18:21:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24152#event-61649"
}
```



---

archive/issue_comments_338141.json:
```json
{
    "body": "This caused build failures on Cygwin, but was merged anyways: https://patchbot.sagemath.org/log/24389/CYGWIN_NT-10.0/2017-04-01%2020:47/x86_64/2.8.0(0.309/5/3)/windows-10-prof/2017-12-17%2022:15:15",
    "created_at": "2018-01-02T14:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338141",
    "user": "https://github.com/embray"
}
```

This caused build failures on Cygwin, but was merged anyways: https://patchbot.sagemath.org/log/24389/CYGWIN_NT-10.0/2017-04-01%2020:47/x86_64/2.8.0(0.309/5/3)/windows-10-prof/2017-12-17%2022:15:15



---

archive/issue_comments_338142.json:
```json
{
    "body": "Replying to [comment:17 embray]:\n> This caused build failures on Cygwin, but was merged anyways: https://patchbot.sagemath.org/log/24389/CYGWIN_NT-10.0/2017-04-01%2020:47/x86_64/2.8.0(0.309/5/3)/windows-10-prof/2017-12-17%2022:15:15\n\n\nThat said, I can't seem to reproduce this problem locally.  It's *only* happening on the patchbot, which is very strange.  Though it's definitely this ticket where it started breaking.  I'm not sure what's different between the Sage checkout on the patchbot versus the one I have locally.",
    "created_at": "2018-01-04T16:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338142",
    "user": "https://github.com/embray"
}
```

Replying to [comment:17 embray]:
> This caused build failures on Cygwin, but was merged anyways: https://patchbot.sagemath.org/log/24389/CYGWIN_NT-10.0/2017-04-01%2020:47/x86_64/2.8.0(0.309/5/3)/windows-10-prof/2017-12-17%2022:15:15


That said, I can't seem to reproduce this problem locally.  It's *only* happening on the patchbot, which is very strange.  Though it's definitely this ticket where it started breaking.  I'm not sure what's different between the Sage checkout on the patchbot versus the one I have locally.



---

archive/issue_comments_338143.json:
```json
{
    "body": "I see now; it was an issue with permissions.",
    "created_at": "2018-01-04T16:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338143",
    "user": "https://github.com/embray"
}
```

I see now; it was an issue with permissions.



---

archive/issue_comments_338144.json:
```json
{
    "body": "There's still kind of a bug here, though not really originating from this ticket (it only started here because the `entrypoints` package was upgraded).\n\nThe problem is that our entrypoints package has a custom `setup.py` that imports from the package itself at build/install time.  This fails if the build directory's permissions are not proper due to Jeroen's patch to Python that disallows `''` to be in `sys.path`.  Since not having correct permissions effectively kills the Sage build I'd suggest that's a bug, even if the solution is still some kind of permissions enforcement, but earlier in the build process.  I'll open a new ticket.",
    "created_at": "2018-01-04T16:46:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338144",
    "user": "https://github.com/embray"
}
```

There's still kind of a bug here, though not really originating from this ticket (it only started here because the `entrypoints` package was upgraded).

The problem is that our entrypoints package has a custom `setup.py` that imports from the package itself at build/install time.  This fails if the build directory's permissions are not proper due to Jeroen's patch to Python that disallows `''` to be in `sys.path`.  Since not having correct permissions effectively kills the Sage build I'd suggest that's a bug, even if the solution is still some kind of permissions enforcement, but earlier in the build process.  I'll open a new ticket.



---

archive/issue_comments_338145.json:
```json
{
    "body": "(Adding list of updates to ticket description.)",
    "created_at": "2018-01-05T18:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24152#issuecomment-338145",
    "user": "https://github.com/slel"
}
```

(Adding list of updates to ticket description.)
