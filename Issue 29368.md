# Issue 29368: plotting function for forests

Issue created by migration from https://trac.sagemath.org/ticket/29605

Original creator: @jfraymond

Original creation time: 2020-04-27 18:42:59

Keywords: graph plotting forest

Currently, it is not possible to plot forests using the `layout_tree` algorithm. : `layout_tree` raises an exception when the input graph is not a tree.

This ticket introduces the `layout_forest` function, which plots forests using `layout_tree` on each connected component, via the `layout_split` function introduced in ticket #29522 to deal with disconnected graphs. The function is very simple, it is basically a wrapper for `layout_split`.

Other things changed in this ticket:
- Minor changes in `layout_split` to deal with the layout options.
- Returning a dict of lists of size 2 (positions of the vertices) in `layout_tree` instead of a dict of pairs. This is to match the behavior of the other graph layout functions (useful here as `layout_split` should work with all layout functions).
- Checking whether the input graph is empty and if so returning the appropriate result in `layout_tree` (otherwise, the result is an exception saying that the graph is not a tree).


---

Comment by @jfraymond created at 2020-04-27 19:09:56

When I was looking for places where `layout_tree` (from `GenericGraph`) is used I found an other `layout_tree` function in `graph_plot.py`. It seems to be the same function (some parts of the code are identical) with less options.
Also it is unclear from the [documentation](https://doc.sagemath.org/html/en/reference/graphs/sage/graphs/graph_plot.html#sage.graphs.graph_plot.GraphPlot.layout_tree) what is the purpose of having this function here while the same result can be achieved with `layout_tree` from `GenericGraph`).
Is it something that somebody planned to remove but forgot?

Second question:
the only failing doctest I got is the following:

```python
sage: g = graphs.LadderGraph(3) #TODO!!!!
sage: g.layout_spring()
{0: [0.73..., -0.29...],
1: [1.37..., 0.30...],
2: [2.08..., 0.89...],
3: [1.23..., -0.83...],
4: [1.88..., -0.30...],
5: [2.53..., 0.22...]}
```

("TODO!!!!" is not mine)

It is quite surprising as I did not touch this function and tests passed on the branch on which this one is based (that of #29522).
Also, I always get different results when I run the following

```python
sage: g = graphs.LadderGraph(3)
sage: g.layout_spring()
```

even on the `develop` branch. (So I do not even see how the tests can pass on this branch.) Any idea?


---

Comment by git created at 2020-04-28 08:49:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jfraymond created at 2020-04-28 08:55:20

Problem 2 solved: The result of `layout_spring` was different because I changed the definition of the variable `buffer` in `layout_split`, which is used by `layout_spring` (even when the graph is connected).
So I fixed the failing doctest by changing the expected layout in the docstring for what sage got when running the tests, even though it is still a mystery for me why the test pass now for such a function that return different results every time I run it.


---

Comment by @jfraymond created at 2020-04-28 09:44:14

Changing status from new to needs_review.


---

Comment by git created at 2020-05-01 08:31:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-02 06:21:24

Please fix the patchbot warning

```
+src/sage/graphs/graph_plot.py:596:41: E701 multiple statements on one line (colon)
```

even if it's not your fault.


---

Comment by git created at 2020-05-02 09:29:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-06-03 16:45:36

red branch


---

Comment by chapoton created at 2020-06-03 16:45:36

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2020-06-20 07:45:40

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2020-06-20 07:45:40

I rebased the ticket on 9.2.beta1, fixed merge conflicts and added a missing doctest.
----
New commits:


---

Comment by git created at 2020-06-20 08:02:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jfraymond created at 2020-06-23 14:48:18

Thanks!


---

Comment by dcoudert created at 2020-06-23 15:18:59

If you are OK, you can set this ticket to positive review on my behalf.


---

Comment by @jfraymond created at 2020-06-23 16:11:26

Changing status from needs_review to positive_review.


---

Comment by @jfraymond created at 2020-06-23 16:11:26

Done. Thanks!


---

Comment by vbraun created at 2020-07-08 19:32:38

Resolution: fixed
