# Issue 32069: int overflow in multiplicities computations in strongly_regular_graph

Issue created by migration from https://trac.sagemath.org/ticket/32306

Original creator: dimpase

Original creation time: 2021-07-29 17:55:11

in `seems_feasible` in `graphs/strongly_regular_db.pyx` there are computations of multiplicities (f,g) of eigenvalues which silently overflow `int` for relatively modest values of parameters, e.g. for
a feasible tuple `(16384, 8256, 4160, 4160)`.

```
    f = -k*(s+1)*(k-s)//(mu*(r-s))
    g =  k*(r+1)*(k-r)//(mu*(r-s))
```

this should not be done with `int`.

As well, these computations should be done before `"Integrality condition"` check.



---

Comment by dimpase created at 2021-07-30 09:06:26

here is a test that should pass

```
sage: from sage.graphs.strongly_regular_db import strongly_regular_graph                     
sage: strongly_regular_graph(16384, 8256, 4160, 4160, existence=True)                        
True
```

- but currently is does not


---

Comment by dimpase created at 2021-07-30 11:00:10

this was picked up while working with a construction from Designs, Codes and Cryptography (2021) 89:1993â€“2007 https://doi.org/10.1007/s10623-021-00896-2, namely, the 1st one on p 2005:

```
sage: def para2(q,s): 
....:     return (q^(2*s),(q^(s-1))*(q^s+1)*(q-1), 
....:      q^(s-1)*(2*q-3+q^(s-1)*(q-1)^2), 
....:      (q-1)*q^(s-1)*(q^s-q^(s-1)+1)) 
```

where `q` must be a power of 2.


---

Comment by dcoudert created at 2021-10-27 10:04:27

A naive fix. May be not the good solution.
----
New commits:


---

Comment by dcoudert created at 2021-10-27 10:04:27

Changing status from new to needs_review.


---

Comment by dcoudert created at 2021-10-28 16:46:15

I don't understand the reported error on blocks. We have similar syntax elsewhere without error.


---

Comment by chapoton created at 2021-10-28 18:32:05

Replying to [comment:4 dcoudert]:
> I don't understand the reported error on blocks. We have similar syntax elsewhere without error.

It could be a bug in the patchbot plugin. Probably never looked at by anybody else than me.


---

Comment by chapoton created at 2021-10-28 18:34:08

Here is the regexp used:

```
    regexps = [r'\.\.SEE|SEE ALSO|SEEALSO:($|[^:])',
               r'^\s*TEST:', r'^\s*EXAMPLE:', r'^\s*NOTES:',
               r'^\s*[A-Z]*PUT::', r'^\s*[A-Z]*PUT$',
               r'^\s*[A-Z]*\s:$',
               r'^\s*REFERENCES?::', r'\s:$', r'^\s*Returns']
```

Do you see why `:trac:`32306` is fixed::` matches ?


---

Comment by dcoudert created at 2021-10-28 18:57:36

No, I don't see why it matches. We have similar block in `graph.py` line 1525:

```
        TESTS:

        :trac:`14434` is fixed::

            sage: g = Graph({0:[1,4,5],3:[4,8,9],4:[9],5:[7,8],7:[9]})
```



---

Comment by dimpase created at 2021-10-30 21:42:04

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-10-30 21:42:18

OK, this works, thanks.


---

Comment by vbraun created at 2021-11-02 22:36:35

Resolution: fixed
