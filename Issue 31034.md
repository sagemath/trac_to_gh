# Issue 31034: MR52: upgrade ubuntu system in docker image

archive/issues_031034.json:
```json
{
    "body": "Julian R\u00fcth ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/52:\n----\n\n```markdown\nthis fixes an issue with line endings in CI. The old version of\ngit on ubuntu xenial does not understand our .gitattributes or it does\nnot understand the .git directory that we copy into the docker build\ncontext from a much newer version of git. Anyway, the broken line\nendings are gone now.\n```\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/31271\n\n",
    "created_at": "2021-01-21T02:51:24Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "MR52: upgrade ubuntu system in docker image",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31034",
    "user": "galois"
}
```
Julian RÃ¼th ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/52:
----

```markdown
this fixes an issue with line endings in CI. The old version of
git on ubuntu xenial does not understand our .gitattributes or it does
not understand the .git directory that we copy into the docker build
context from a much newer version of git. Anyway, the broken line
endings are gone now.
```




Issue created by migration from https://trac.sagemath.org/ticket/31271





---

archive/issue_comments_443267.json:
```json
{
    "body": "still fails on gitlab\n\nhere: https://gitlab.com/sagemath/dev/trac/-/pipelines/244687774",
    "created_at": "2021-01-21T08:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443267",
    "user": "@fchapoton"
}
```

still fails on gitlab

here: https://gitlab.com/sagemath/dev/trac/-/pipelines/244687774



---

archive/issue_comments_443268.json:
```json
{
    "body": "maybe because latest is stuck at 9.0, though",
    "created_at": "2021-01-21T08:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443268",
    "user": "@fchapoton"
}
```

maybe because latest is stuck at 9.0, though



---

archive/issue_comments_443269.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-01-21T11:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443269",
    "user": "@saraedum"
}
```

Changing priority from major to critical.



---

archive/issue_comments_443270.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2021-01-21T11:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443270",
    "user": "@saraedum"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_443271.json:
```json
{
    "body": "The CI run for this branch is here: https://gitlab.com/sagemath/dev/sage/-/jobs/976444339\n\nIt seems to work since `git status --porcelain` does not report any pending changes anymore.",
    "created_at": "2021-01-21T11:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443271",
    "user": "@saraedum"
}
```

The CI run for this branch is here: https://gitlab.com/sagemath/dev/sage/-/jobs/976444339

It seems to work since `git status --porcelain` does not report any pending changes anymore.



---

archive/issue_comments_443272.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to docker.",
    "created_at": "2021-01-21T11:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443272",
    "user": "@saraedum"
}
```

Changing component from PLEASE CHANGE to docker.



---

archive/issue_comments_443273.json:
```json
{
    "body": "While this fixes one problem, we now have a `[dochtml] Illegal instruction (core dumped)` in another CI step.",
    "created_at": "2021-01-21T12:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443273",
    "user": "@saraedum"
}
```

While this fixes one problem, we now have a `[dochtml] Illegal instruction (core dumped)` in another CI step.



---

archive/issue_comments_443274.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-21T12:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443274",
    "user": "@saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_443275.json:
```json
{
    "body": "Probably happens because the image was built on Skylake and the tests ran on Sandy Bridge.",
    "created_at": "2021-01-21T12:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443275",
    "user": "@saraedum"
}
```

Probably happens because the image was built on Skylake and the tests ran on Sandy Bridge.



---

archive/issue_comments_443276.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2021-01-21T12:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443276",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_443277.json:
```json
{
    "body": "so needs review ?",
    "created_at": "2021-01-21T17:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443277",
    "user": "@fchapoton"
}
```

so needs review ?



---

archive/issue_comments_443278.json:
```json
{
    "body": "You already had `ENV SAGE_FAT_BINARY yes`, but you might be running into #29537 here",
    "created_at": "2021-01-21T17:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443278",
    "user": "@mkoeppe"
}
```

You already had `ENV SAGE_FAT_BINARY yes`, but you might be running into #29537 here



---

archive/issue_comments_443279.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2021-01-21T20:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443279",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_443280.json:
```json
{
    "body": "Replying to [comment:2 chapoton]:\n> maybe because latest is stuck at 9.0, though\n\nIt fails on gitlab because the sagemath-dev:develop image is broken. (due to this very issue.)\n\nI ran it in a separate pipeline and it seemed to work.",
    "created_at": "2021-01-21T20:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443280",
    "user": "@saraedum"
}
```

Replying to [comment:2 chapoton]:
> maybe because latest is stuck at 9.0, though

It fails on gitlab because the sagemath-dev:develop image is broken. (due to this very issue.)

I ran it in a separate pipeline and it seemed to work.



---

archive/issue_comments_443281.json:
```json
{
    "body": "Let's not worry about the SAGE_FAT_BINARY issue here. That's a different problem.",
    "created_at": "2021-01-21T20:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443281",
    "user": "@saraedum"
}
```

Let's not worry about the SAGE_FAT_BINARY issue here. That's a different problem.



---

archive/issue_comments_443282.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-21T20:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443282",
    "user": "@saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_443283.json:
```json
{
    "body": "ok, let's move on",
    "created_at": "2021-01-21T20:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443283",
    "user": "@fchapoton"
}
```

ok, let's move on



---

archive/issue_comments_443284.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-21T20:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443284",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_443285.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-31T20:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31034",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31034#issuecomment-443285",
    "user": "@vbraun"
}
```

Resolution: fixed
