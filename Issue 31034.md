# Issue 31034: MR52: upgrade ubuntu system in docker image

Issue created by migration from https://trac.sagemath.org/ticket/31271

Original creator: galois

Original creation time: 2021-01-21 02:51:24

Julian RÃ¼th ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/-/merge_requests/52:
----

```markdown
this fixes an issue with line endings in CI. The old version of
git on ubuntu xenial does not understand our .gitattributes or it does
not understand the .git directory that we copy into the docker build
context from a much newer version of git. Anyway, the broken line
endings are gone now.
```





---

Comment by chapoton created at 2021-01-21 08:25:53

still fails on gitlab

here: https://gitlab.com/sagemath/dev/trac/-/pipelines/244687774


---

Comment by chapoton created at 2021-01-21 08:27:31

maybe because latest is stuck at 9.0, though


---

Comment by saraedum created at 2021-01-21 11:27:13

Changing priority from major to critical.


---

Comment by saraedum created at 2021-01-21 11:27:13

Changing type from PLEASE CHANGE to defect.


---

Comment by saraedum created at 2021-01-21 11:27:13

The CI run for this branch is here: https://gitlab.com/sagemath/dev/sage/-/jobs/976444339

It seems to work since `git status --porcelain` does not report any pending changes anymore.


---

Comment by saraedum created at 2021-01-21 11:27:13

Changing component from PLEASE CHANGE to docker.


---

Comment by saraedum created at 2021-01-21 12:02:40

While this fixes one problem, we now have a `[dochtml] Illegal instruction (core dumped)` in another CI step.


---

Comment by saraedum created at 2021-01-21 12:02:40

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2021-01-21 12:07:59

Probably happens because the image was built on Skylake and the tests ran on Sandy Bridge.


---

Comment by galois created at 2021-01-21 12:28:46

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by chapoton created at 2021-01-21 17:25:33

so needs review ?


---

Comment by mkoeppe created at 2021-01-21 17:37:59

You already had `ENV SAGE_FAT_BINARY yes`, but you might be running into #29537 here


---

Comment by galois created at 2021-01-21 20:04:16

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by saraedum created at 2021-01-21 20:05:19

Replying to [comment:2 chapoton]:
> maybe because latest is stuck at 9.0, though

It fails on gitlab because the sagemath-dev:develop image is broken. (due to this very issue.)

I ran it in a separate pipeline and it seemed to work.


---

Comment by saraedum created at 2021-01-21 20:05:58

Let's not worry about the SAGE_FAT_BINARY issue here. That's a different problem.


---

Comment by saraedum created at 2021-01-21 20:05:58

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2021-01-21 20:32:39

ok, let's move on


---

Comment by chapoton created at 2021-01-21 20:32:39

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-01-31 20:53:52

Resolution: fixed
