# Issue 17811: Bug in GAP conversion of finite field elements

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2015-03-24 20:35:34

As reported in [this question on ask](http://ask.sagemath.org/question/26283/computing-minimum_distance-of-a-code-on-non-prime-fields-fails-sometimes) we have a problem with our finite fields and GAP

```
sage: K = GF(16,'a')
sage: a = K.gen()
sage: b = a**2 + a
sage: K(b._gap_())
Traceback (most recent call last):
...
TypeError: unable to coerce from a finite field other than the prime subfield
```


Strangely, it works with `GF(8)`.


---

Comment by pbruin created at 2015-03-25 18:36:49

This is because the function `sage.interfaces.gap.gfq_gap_to_sage`, which converts a GAP element into an element of a Sage finite field `F`, constructs an intermediate field which does not necessarily have a canonical embedding into `F`.  I am now testing a patch which avoids the intermediate field.


---

Comment by pbruin created at 2015-03-25 19:29:35

Changing status from new to needs_review.


---

Comment by pbruin created at 2015-03-25 19:29:35

Notes:
- Before this patch, it was implicitly assumed that non-prime finite fields are defined by Conway polynomials, because this is how GAP represents finite fields.  This is now an explicit requirement.
- Elements of a GAP prime field `Z(p)` are now converted into a Sage `FiniteField(p)`, as opposed to `IntegerModRing(p)`.


---

Comment by pbruin created at 2015-03-25 19:30:34

In addition to the doctest, I tested the example given in the link in the ticket description 200 times and did not get any errors.


---

Comment by vdelecroix created at 2015-03-25 22:16:34

Changing priority from major to critical.


---

Comment by vdelecroix created at 2015-03-25 22:16:34

Hello,

That's wonderful that you did have a look! I put this to positive review as it fixes an important bug (and might hopefully be in sage-6.6).

On a related note, the code uses a lot of string parsing. This is ugly and not very safe. I think that we can get rid of most of it with
- `Characteristic(z)`: the characteristic of the field
- `DegreeFFE(z)`: degree of the smallest base field containing the element `z`
- `LogFFE(z,base)`: logarithm in finite field
I do not like the fact that we need to call `LogFFE` to have access to the good power of the generator. If you think about a good solution for that I will open an other ticket.

Vincent


---

Comment by vdelecroix created at 2015-03-25 22:16:34

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-03-27 00:39:56

Resolution: fixed
