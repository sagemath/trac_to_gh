# Issue 23101: Clean up polynomial constructor

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-06-29 12:25:53

CC:  tscrim




---

Comment by tscrim created at 2017-06-29 12:44:16

+1


---

Comment by jdemeyer created at 2017-06-29 15:23:43

First version, not finished or tested yet. But feel free to comment...
----
New commits:


---

Comment by git created at 2017-06-29 21:58:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-06-29 22:02:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-06-29 22:11:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2017-06-30 00:11:43

My quick comments are:

- The indentation of the doc looks off for the numbered points. The subsequent lines of text should start at the same place the first line did (unless you want it to be further indented).
- In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).
- You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.
- We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no `var_array` block.
- Should I interpret the `[m, ...]` as extra input here?
  {{{
4. ``PolynomialRing(base_ring, n, [m, ...,] var_array=var_array, ...)``
  }}}
  It is confusing with what might be a list. It might be better to do:
  {{{
4. ``PolynomialRing(base_ring, n0, ..., nm, var_array=var_array, ...)``
  }}}
- Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.


---

Comment by git created at 2017-06-30 08:59:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-06-30 09:13:47

Replying to [comment:14 tscrim]:
> - In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).

No, the current code is intentional. I only want to support

```
R.<x,y> = PolynomialRing(QQ, "x,y")
```

and not

```
R = PolynomialRing(QQ, "x,y", names="x,y")
```

The preparser passes `names` already normalized, so there is no reason to call `normalize_names()` on `kwnames`.

> - You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.
What do you mean with this?

> - We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no var_array block.

Well, that would make the code slightly more complicated since that check needs to be done _after_ `normalize_names()`. Also, I see no reason to a priori disallow something like

```
R.<x0,x1> = PolynomialRing(QQ, 2, var_array=["x"])
```

Yes, it's stupid to write that but we do allow the analogous thing without `var_array`.

> - Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.

Right. I didn't care much about `var_array` since it's not widely used (there isn't a single place in the Sage library or documentation where it is used, except for the `PolynomialRing` constructor itself). Still, you are right that additional doctests would be good.


---

Comment by git created at 2017-06-30 12:23:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-06-30 12:40:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-06-30 12:42:00

I think this addresses your comments, except for the ones regarding the redundant `R.<x> = Polynomial(QQ, "x")` syntax.


---

Comment by jdemeyer created at 2017-06-30 12:42:00

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-06-30 12:44:18

Replying to [comment:16 jdemeyer]:
> Replying to [comment:14 tscrim]:
> > - In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).
> 
> No, the current code is intentional. I only want to support
> {{{
> R.<x,y> = PolynomialRing(QQ, "x,y")
> }}}
> and not
> {{{
> R = PolynomialRing(QQ, "x,y", names="x,y")
> }}}
> The preparser passes `names` already normalized, so there is no reason to call `normalize_names()` on `kwnames`.

Ah, I see. Okay.

> > - You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.
> What do you mean with this?

Most of the code that checks for input of this form is already in the code path when `var_array` is not being used. I feel like it should go there. However, this is moot because...

> > - We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no var_array block.
> 
> Well, that would make the code slightly more complicated since that check needs to be done _after_ `normalize_names()`. Also, I see no reason to a priori disallow something like
> {{{
> R.<x0,x1> = PolynomialRing(QQ, 2, var_array=["x"])
> }}}
> Yes, it's stupid to write that but we do allow the analogous thing without `var_array`.

I agree with this. I missed the `normalize_names` call on my quick look through.

> > - Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.
> 
> Right. I didn't care much about `var_array` since it's not widely used (there isn't a single place in the Sage library or documentation where it is used, except for the `PolynomialRing` constructor itself). Still, you are right that additional doctests would be good.

I did the initial implementation because I got a few requests to have such a feature (which is useful for doing matrices with generic parameters). So I care a little bit. :)

I'm wondering if we should always have a one variable implementation always be a univariate polynomial ring, of course with `implementation='singular'` being an exception to construct the multivariate polynomial ring? This should be uncontroversial as it only expands functionality.


---

Comment by jdemeyer created at 2017-06-30 12:56:53

Replying to [comment:20 tscrim]:
> I'm wondering if we should always have a one variable implementation always be a univariate polynomial ring, of course with `implementation='singular'` being an exception to construct the multivariate polynomial ring? This should be uncontroversial as it only expands functionality.

I don't agree that it only expands functionality. In at least 2 places, the Sage library has been using `PolynomialRing(R, 1, "x")` as a contrived way to get a multivariate polynomial ring implemented in Singular. Of course, this can now be done using `PolynomialRing(R, "x", implementation="singular")`. For this reason, I would maybe give a deprecation warning for `PolynomialRing(R, 1, "x")` but _not_ change functionality yet.


---

Comment by jdemeyer created at 2017-06-30 13:23:10

It seems that there are quite a bit of places in Sage which rely on the behaviour that specifying 1 variable gives a multivariate polynomial ring. For example, doctests checking whether some algorithm for multivariate rings also deals with the 1-variable case properly. So I feel inclined to keep the current behaviour.


---

Comment by tscrim created at 2017-06-30 13:32:33

Fair enough. Although in some ways changing the behavior makes the doctests a little moot...but one could directly call the constructor class (or pass `implementation="singular"`). However, it is beyond the scope of the ticket in a way, so I'm fine doing this on another ticket.


---

Comment by tscrim created at 2017-06-30 14:01:37

So it looks like we took care of all places that are using `PolynomialRing(F, 1, 'x')` to get a Singular object other than some doctests in `polynomial_singular_interface.py` and `interfaces/singular.py`. Once those are changed, then you can set this to a positive review.


---

Comment by jdemeyer created at 2017-06-30 16:24:38

Replying to [comment:24 tscrim]:
> So it looks like we took care of all places that are using `PolynomialRing(F, 1, 'x')` to get a Singular object other than some doctests in `polynomial_singular_interface.py` and `interfaces/singular.py`.

I actually think that there are more places like that. I'll try to fix them all.


---

Comment by git created at 2017-07-04 13:35:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-07-05 12:49:02

Thanks. LGTM.


---

Comment by tscrim created at 2017-07-05 12:49:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-07-26 22:13:00

Resolution: fixed
