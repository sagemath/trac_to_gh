# Issue 23101: Clean up polynomial constructor

archive/issues_023101.json:
```json
{
    "body": "CC:  tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23338\n\n",
    "created_at": "2017-06-29T12:25:53Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Clean up polynomial constructor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23101",
    "user": "jdemeyer"
}
```
CC:  tscrim



Issue created by migration from https://trac.sagemath.org/ticket/23338





---

archive/issue_comments_323028.json:
```json
{
    "body": "+1",
    "created_at": "2017-06-29T12:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323028",
    "user": "tscrim"
}
```

+1



---

archive/issue_comments_323029.json:
```json
{
    "body": "First version, not finished or tested yet. But feel free to comment...\n----\nNew commits:",
    "created_at": "2017-06-29T15:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323029",
    "user": "jdemeyer"
}
```

First version, not finished or tested yet. But feel free to comment...
----
New commits:



---

archive/issue_comments_323030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-29T21:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323030",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-29T22:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323031",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-29T22:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323032",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323033.json:
```json
{
    "body": "My quick comments are:\n\n- The indentation of the doc looks off for the numbered points. The subsequent lines of text should start at the same place the first line did (unless you want it to be further indented).\n- In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).\n- You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.\n- We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no `var_array` block.\n- Should I interpret the `[m, ...]` as extra input here?\n  {{{\n4. ``PolynomialRing(base_ring, n, [m, ...,] var_array=var_array, ...)``\n   }}}\n   It is confusing with what might be a list. It might be better to do:\n   {{{\n4. ``PolynomialRing(base_ring, n0, ..., nm, var_array=var_array, ...)``\n   }}}\n- Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.",
    "created_at": "2017-06-30T00:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323033",
    "user": "tscrim"
}
```

My quick comments are:

- The indentation of the doc looks off for the numbered points. The subsequent lines of text should start at the same place the first line did (unless you want it to be further indented).
- In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).
- You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.
- We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no `var_array` block.
- Should I interpret the `[m, ...]` as extra input here?
  {{{
4. ``PolynomialRing(base_ring, n, [m, ...,] var_array=var_array, ...)``
   }}}
   It is confusing with what might be a list. It might be better to do:
   {{{
4. ``PolynomialRing(base_ring, n0, ..., nm, var_array=var_array, ...)``
   }}}
- Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.



---

archive/issue_comments_323034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-30T08:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323034",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323035.json:
```json
{
    "body": "Replying to [comment:14 tscrim]:\n> - In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).\n\nNo, the current code is intentional. I only want to support\n\n```\nR.<x,y> = PolynomialRing(QQ, \"x,y\")\n```\n\nand not\n\n```\nR = PolynomialRing(QQ, \"x,y\", names=\"x,y\")\n```\n\nThe preparser passes `names` already normalized, so there is no reason to call `normalize_names()` on `kwnames`.\n\n> - You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.\nWhat do you mean with this?\n\n> - We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no var_array block.\n\nWell, that would make the code slightly more complicated since that check needs to be done *after* `normalize_names()`. Also, I see no reason to a priori disallow something like\n\n```\nR.<x0,x1> = PolynomialRing(QQ, 2, var_array=[\"x\"])\n```\n\nYes, it's stupid to write that but we do allow the analogous thing without `var_array`.\n\n> - Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.\n\nRight. I didn't care much about `var_array` since it's not widely used (there isn't a single place in the Sage library or documentation where it is used, except for the `PolynomialRing` constructor itself). Still, you are right that additional doctests would be good.",
    "created_at": "2017-06-30T09:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323035",
    "user": "jdemeyer"
}
```

Replying to [comment:14 tscrim]:
> - In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).

No, the current code is intentional. I only want to support

```
R.<x,y> = PolynomialRing(QQ, "x,y")
```

and not

```
R = PolynomialRing(QQ, "x,y", names="x,y")
```

The preparser passes `names` already normalized, so there is no reason to call `normalize_names()` on `kwnames`.

> - You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.
What do you mean with this?

> - We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no var_array block.

Well, that would make the code slightly more complicated since that check needs to be done *after* `normalize_names()`. Also, I see no reason to a priori disallow something like

```
R.<x0,x1> = PolynomialRing(QQ, 2, var_array=["x"])
```

Yes, it's stupid to write that but we do allow the analogous thing without `var_array`.

> - Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.

Right. I didn't care much about `var_array` since it's not widely used (there isn't a single place in the Sage library or documentation where it is used, except for the `PolynomialRing` constructor itself). Still, you are right that additional doctests would be good.



---

archive/issue_comments_323036.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-30T12:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323036",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323037.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-06-30T12:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323037",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323038.json:
```json
{
    "body": "I think this addresses your comments, except for the ones regarding the redundant `R.<x> = Polynomial(QQ, \"x\")` syntax.",
    "created_at": "2017-06-30T12:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323038",
    "user": "jdemeyer"
}
```

I think this addresses your comments, except for the ones regarding the redundant `R.<x> = Polynomial(QQ, "x")` syntax.



---

archive/issue_comments_323039.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-30T12:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323039",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_323040.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Replying to [comment:14 tscrim]:\n> > - In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).\n> \n> No, the current code is intentional. I only want to support\n> {{{\n> R.<x,y> = PolynomialRing(QQ, \"x,y\")\n> }}}\n> and not\n> {{{\n> R = PolynomialRing(QQ, \"x,y\", names=\"x,y\")\n> }}}\n> The preparser passes `names` already normalized, so there is no reason to call `normalize_names()` on `kwnames`.\n\nAh, I see. Okay.\n\n> > - You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.\n> What do you mean with this?\n\nMost of the code that checks for input of this form is already in the code path when `var_array` is not being used. I feel like it should go there. However, this is moot because...\n\n> > - We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no var_array block.\n> \n> Well, that would make the code slightly more complicated since that check needs to be done *after* `normalize_names()`. Also, I see no reason to a priori disallow something like\n> {{{\n> R.<x0,x1> = PolynomialRing(QQ, 2, var_array=[\"x\"])\n> }}}\n> Yes, it's stupid to write that but we do allow the analogous thing without `var_array`.\n\nI agree with this. I missed the `normalize_names` call on my quick look through.\n\n> > - Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.\n> \n> Right. I didn't care much about `var_array` since it's not widely used (there isn't a single place in the Sage library or documentation where it is used, except for the `PolynomialRing` constructor itself). Still, you are right that additional doctests would be good.\n\nI did the initial implementation because I got a few requests to have such a feature (which is useful for doing matrices with generic parameters). So I care a little bit. :)\n\nI'm wondering if we should always have a one variable implementation always be a univariate polynomial ring, of course with `implementation='singular'` being an exception to construct the multivariate polynomial ring? This should be uncontroversial as it only expands functionality.",
    "created_at": "2017-06-30T12:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323040",
    "user": "tscrim"
}
```

Replying to [comment:16 jdemeyer]:
> Replying to [comment:14 tscrim]:
> > - In handling the case `R.<x> = PolynomialRing(QQ, 'x')`, you should normalize the names there so that `kwnames != names` is a valid comparison (e.g., `names='x,y'` should be valid input).
> 
> No, the current code is intentional. I only want to support
> {{{
> R.<x,y> = PolynomialRing(QQ, "x,y")
> }}}
> and not
> {{{
> R = PolynomialRing(QQ, "x,y", names="x,y")
> }}}
> The preparser passes `names` already normalized, so there is no reason to call `normalize_names()` on `kwnames`.

Ah, I see. Okay.

> > - You also almost already check for `R.<x> = PolynomialRing(QQ, 'x')` in the no `var_array` block.
> What do you mean with this?

Most of the code that checks for input of this form is already in the code path when `var_array` is not being used. I feel like it should go there. However, this is moot because...

> > - We probably can/should handle the `R.<x> = PolynomialRing(QQ, 'x')` input entirely in the no var_array block.
> 
> Well, that would make the code slightly more complicated since that check needs to be done *after* `normalize_names()`. Also, I see no reason to a priori disallow something like
> {{{
> R.<x0,x1> = PolynomialRing(QQ, 2, var_array=["x"])
> }}}
> Yes, it's stupid to write that but we do allow the analogous thing without `var_array`.

I agree with this. I missed the `normalize_names` call on my quick look through.

> > - Your code has some slightly sneaky logic for some corner cases like `PolynomialRing(QQ, 'x', 1, var_array='x')` not being valid input. It would be good to have some tests for `var_array` input.
> 
> Right. I didn't care much about `var_array` since it's not widely used (there isn't a single place in the Sage library or documentation where it is used, except for the `PolynomialRing` constructor itself). Still, you are right that additional doctests would be good.

I did the initial implementation because I got a few requests to have such a feature (which is useful for doing matrices with generic parameters). So I care a little bit. :)

I'm wondering if we should always have a one variable implementation always be a univariate polynomial ring, of course with `implementation='singular'` being an exception to construct the multivariate polynomial ring? This should be uncontroversial as it only expands functionality.



---

archive/issue_comments_323041.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> I'm wondering if we should always have a one variable implementation always be a univariate polynomial ring, of course with `implementation='singular'` being an exception to construct the multivariate polynomial ring? This should be uncontroversial as it only expands functionality.\n\nI don't agree that it only expands functionality. In at least 2 places, the Sage library has been using `PolynomialRing(R, 1, \"x\")` as a contrived way to get a multivariate polynomial ring implemented in Singular. Of course, this can now be done using `PolynomialRing(R, \"x\", implementation=\"singular\")`. For this reason, I would maybe give a deprecation warning for `PolynomialRing(R, 1, \"x\")` but *not* change functionality yet.",
    "created_at": "2017-06-30T12:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323041",
    "user": "jdemeyer"
}
```

Replying to [comment:20 tscrim]:
> I'm wondering if we should always have a one variable implementation always be a univariate polynomial ring, of course with `implementation='singular'` being an exception to construct the multivariate polynomial ring? This should be uncontroversial as it only expands functionality.

I don't agree that it only expands functionality. In at least 2 places, the Sage library has been using `PolynomialRing(R, 1, "x")` as a contrived way to get a multivariate polynomial ring implemented in Singular. Of course, this can now be done using `PolynomialRing(R, "x", implementation="singular")`. For this reason, I would maybe give a deprecation warning for `PolynomialRing(R, 1, "x")` but *not* change functionality yet.



---

archive/issue_comments_323042.json:
```json
{
    "body": "It seems that there are quite a bit of places in Sage which rely on the behaviour that specifying 1 variable gives a multivariate polynomial ring. For example, doctests checking whether some algorithm for multivariate rings also deals with the 1-variable case properly. So I feel inclined to keep the current behaviour.",
    "created_at": "2017-06-30T13:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323042",
    "user": "jdemeyer"
}
```

It seems that there are quite a bit of places in Sage which rely on the behaviour that specifying 1 variable gives a multivariate polynomial ring. For example, doctests checking whether some algorithm for multivariate rings also deals with the 1-variable case properly. So I feel inclined to keep the current behaviour.



---

archive/issue_comments_323043.json:
```json
{
    "body": "Fair enough. Although in some ways changing the behavior makes the doctests a little moot...but one could directly call the constructor class (or pass `implementation=\"singular\"`). However, it is beyond the scope of the ticket in a way, so I'm fine doing this on another ticket.",
    "created_at": "2017-06-30T13:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323043",
    "user": "tscrim"
}
```

Fair enough. Although in some ways changing the behavior makes the doctests a little moot...but one could directly call the constructor class (or pass `implementation="singular"`). However, it is beyond the scope of the ticket in a way, so I'm fine doing this on another ticket.



---

archive/issue_comments_323044.json:
```json
{
    "body": "So it looks like we took care of all places that are using `PolynomialRing(F, 1, 'x')` to get a Singular object other than some doctests in `polynomial_singular_interface.py` and `interfaces/singular.py`. Once those are changed, then you can set this to a positive review.",
    "created_at": "2017-06-30T14:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323044",
    "user": "tscrim"
}
```

So it looks like we took care of all places that are using `PolynomialRing(F, 1, 'x')` to get a Singular object other than some doctests in `polynomial_singular_interface.py` and `interfaces/singular.py`. Once those are changed, then you can set this to a positive review.



---

archive/issue_comments_323045.json:
```json
{
    "body": "Replying to [comment:24 tscrim]:\n> So it looks like we took care of all places that are using `PolynomialRing(F, 1, 'x')` to get a Singular object other than some doctests in `polynomial_singular_interface.py` and `interfaces/singular.py`.\n\nI actually think that there are more places like that. I'll try to fix them all.",
    "created_at": "2017-06-30T16:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323045",
    "user": "jdemeyer"
}
```

Replying to [comment:24 tscrim]:
> So it looks like we took care of all places that are using `PolynomialRing(F, 1, 'x')` to get a Singular object other than some doctests in `polynomial_singular_interface.py` and `interfaces/singular.py`.

I actually think that there are more places like that. I'll try to fix them all.



---

archive/issue_comments_323046.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-04T13:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323046",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323047.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2017-07-05T12:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323047",
    "user": "tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_323048.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-05T12:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323048",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_323049.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-26T22:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23101#issuecomment-323049",
    "user": "vbraun"
}
```

Resolution: fixed
