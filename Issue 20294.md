# Issue 20294: Don't use "long double" functions for Pynac

Issue created by migration from https://trac.sagemath.org/ticket/20531

Original creator: jdemeyer

Original creation time: 2016-05-02 12:03:12

CC:  rws embray

There seems to be no reason to use the `long double` functions like `sage_logl` for Pynac. It interacts only with Python objects and Python's `float` corresponds to `double` in C.


---

Comment by jdemeyer created at 2016-05-02 12:28:35

New commits:


---

Comment by jdemeyer created at 2016-05-02 12:28:35

Changing status from new to needs_review.


---

Comment by embray created at 2016-05-02 12:42:43

I don't know anything about Pynac but LGTM otherwise.


---

Comment by rws created at 2016-05-03 07:48:13

LGTM too. I have put your real name in the Reviewer: field and set positive for you.


---

Comment by rws created at 2016-05-03 07:48:13

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-05-03 08:10:17

Actually one the commit will fix a QA problem reported by portage in sage-on-gentoo. Quite happy about that.


---

Comment by vbraun created at 2016-05-04 17:10:34

Resolution: fixed


---

Comment by vbraun created at 2016-05-05 09:26:16

Changing status from closed to new.


---

Comment by vbraun created at 2016-05-05 09:26:16

Resolution changed from fixed to 


---

Comment by vbraun created at 2016-05-05 09:26:16

On OSX:

```
sage -t --long src/sage/symbolic/pynac.pyx
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 1795, in sage.symbolic.pynac.py_lgamma
Failed example:
    py_lgamma(4.r)
Expected:
    1.791759469228055
Got:
    1.7917594692280552
**********************************************************************
File "src/sage/symbolic/pynac.pyx", line 1797, in sage.symbolic.pynac.py_lgamma
Failed example:
    py_lgamma(4r)
Expected:
    1.791759469228055
Got:
    1.7917594692280552
**********************************************************************
1 item had failures:
   2 of   7 in sage.symbolic.pynac.py_lgamma
```



---

Comment by jdemeyer created at 2016-05-05 09:44:02

Interesting. So on OS X, `(double)lgammal(4.0)` is not the same as `lgamma(4.0)`


---

Comment by jdemeyer created at 2016-05-05 09:50:03

...which isn't that surprising perhaps, since `lgamma()` probably uses a less precise algorithm than `lgammal()`. Anyway, the error is still less than 1 ulp, so I will just add some `# abs tol`.


---

Comment by jdemeyer created at 2016-05-05 09:55:22

New commits:


---

Comment by jdemeyer created at 2016-05-05 09:55:22

Changing status from new to needs_review.


---

Comment by fbissey created at 2016-05-05 10:05:05

Trivially putting it back to positive review.


---

Comment by fbissey created at 2016-05-05 10:05:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-05-18 18:21:00

Resolution: fixed
