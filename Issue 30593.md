# Issue 30593: Subintervals of OpenInterval and UniqueRepresentation

archive/issues_030593.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim @tobiasdiez\n\nAt the moment, we have the following behavior:\n\n```\nsage: I = OpenInterval(0,2)\nsage: J = OpenInterval(0,1, ambient_interval=I, coordinate='t')\nsage: I.open_interval(0,1)\nTraceback (most recent call last)\n...\nValueError: the name '(0, 1)' is already used for another subset of the Real interval (0, 2)\n```\n\nEven though the use of `OpenInterval(0,1, ambient_interval=I)` is not intended, this is still a blind spot.\n\nThe reason for this behavior comes from the `UniqueRepresentation` and how the subintervals are constructed.\n\nI propose a fix using `__classcall_private__`.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30830\n\n",
    "closed_at": "2020-11-22T15:06:30Z",
    "created_at": "2020-10-25T20:09:12Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Subintervals of OpenInterval and UniqueRepresentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30593",
    "user": "https://github.com/mjungmath"
}
```
CC:  @egourgoulhon @tscrim @tobiasdiez

At the moment, we have the following behavior:

```
sage: I = OpenInterval(0,2)
sage: J = OpenInterval(0,1, ambient_interval=I, coordinate='t')
sage: I.open_interval(0,1)
Traceback (most recent call last)
...
ValueError: the name '(0, 1)' is already used for another subset of the Real interval (0, 2)
```

Even though the use of `OpenInterval(0,1, ambient_interval=I)` is not intended, this is still a blind spot.

The reason for this behavior comes from the `UniqueRepresentation` and how the subintervals are constructed.

I propose a fix using `__classcall_private__`.


Issue created by migration from https://trac.sagemath.org/ticket/30830





---

archive/issue_comments_436528.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-25T20:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436528",
    "user": "https://github.com/mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_436529.json:
```json
{
    "body": "Ready for review.\n\n---\nNew commits:",
    "created_at": "2020-10-25T20:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436529",
    "user": "https://github.com/mjungmath"
}
```

Ready for review.

---
New commits:



---

archive/issue_comments_436530.json:
```json
{
    "body": "You have a doctest failure in `continuous_map` (see the patchbot). Otherwise LGTM.",
    "created_at": "2020-10-26T00:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436530",
    "user": "https://github.com/tscrim"
}
```

You have a doctest failure in `continuous_map` (see the patchbot). Otherwise LGTM.



---

archive/issue_comments_436531.json:
```json
{
    "body": "Also `TEST:` -> `TESTS::`.",
    "created_at": "2020-10-26T00:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436531",
    "user": "https://github.com/tscrim"
}
```

Also `TEST:` -> `TESTS::`.



---

archive/issue_comments_436532.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-26T10:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436532",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436533.json:
```json
{
    "body": "I think, this approach is slighly better because it is closer to the original behavior. Now, the test in `continuous_map.py` should pass.",
    "created_at": "2020-10-26T10:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436533",
    "user": "https://github.com/mjungmath"
}
```

I think, this approach is slighly better because it is closer to the original behavior. Now, the test in `continuous_map.py` should pass.



---

archive/issue_comments_436534.json:
```json
{
    "body": "Side remark: It would be nice to connect `OpenInterval` also to `RealSet` (not on this ticket)...",
    "created_at": "2020-10-26T17:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436534",
    "user": "https://github.com/mkoeppe"
}
```

Side remark: It would be nice to connect `OpenInterval` also to `RealSet` (not on this ticket)...



---

archive/issue_comments_436535.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> Side remark: It would be nice to connect `OpenInterval` also to `RealSet` (not on this ticket)...\n\n\nNice! Would you take the honor to open the corresponding ticket?",
    "created_at": "2020-10-26T17:17:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436535",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:8 mkoeppe]:
> Side remark: It would be nice to connect `OpenInterval` also to `RealSet` (not on this ticket)...


Nice! Would you take the honor to open the corresponding ticket?



---

archive/issue_comments_436536.json:
```json
{
    "body": "That's now #30832",
    "created_at": "2020-10-26T20:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436536",
    "user": "https://github.com/mkoeppe"
}
```

That's now #30832



---

archive/issue_comments_436537.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> That's now #30832\n\n+1",
    "created_at": "2020-10-26T20:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436537",
    "user": "https://github.com/mjungmath"
}
```

Replying to [comment:10 mkoeppe]:
> That's now #30832

+1



---

archive/issue_comments_436538.json:
```json
{
    "body": "With this change, you can create two distinct intervals with the same (latex) name by passing the resulting values if `None` is given (e.g., `name='R'`). While this is me being deliberately evil, it is something I want you to consider and if you are okay with this possible situation happening.",
    "created_at": "2020-10-31T07:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436538",
    "user": "https://github.com/tscrim"
}
```

With this change, you can create two distinct intervals with the same (latex) name by passing the resulting values if `None` is given (e.g., `name='R'`). While this is me being deliberately evil, it is something I want you to consider and if you are okay with this possible situation happening.



---

archive/issue_comments_436539.json:
```json
{
    "body": "You mean\n\n```\nsage: R = RealLine(); R                                                         \nReal number line R\nsage: R1 = RealLine(name='R'); R1                                               \nReal number line R\nsage: R is R1                                                                   \nFalse\n```\n\nRight?",
    "created_at": "2020-10-31T10:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436539",
    "user": "https://github.com/mjungmath"
}
```

You mean

```
sage: R = RealLine(); R                                                         
Real number line R
sage: R1 = RealLine(name='R'); R1                                               
Real number line R
sage: R is R1                                                                   
False
```

Right?



---

archive/issue_comments_436540.json:
```json
{
    "body": "Replying to [comment:13 gh-mjungmath]:\n> You mean\n> \n> \n> ```\n> sage: R = RealLine(); R                                                         \n> Real number line R\n> sage: R1 = RealLine(name='R'); R1                                               \n> Real number line R\n> sage: R is R1                                                                   \n> False\n> ```\n> \n> Right?\n\n\nYes, exactly.",
    "created_at": "2020-10-31T10:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436540",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:13 gh-mjungmath]:
> You mean
> 
> 
> ```
> sage: R = RealLine(); R                                                         
> Real number line R
> sage: R1 = RealLine(name='R'); R1                                               
> Real number line R
> sage: R is R1                                                                   
> False
> ```
> 
> Right?


Yes, exactly.



---

archive/issue_comments_436541.json:
```json
{
    "body": "This should do, but it doesn't. Adding `__classcall__` to `RealLine` doesn't help either.",
    "created_at": "2020-10-31T11:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436541",
    "user": "https://github.com/mjungmath"
}
```

This should do, but it doesn't. Adding `__classcall__` to `RealLine` doesn't help either.



---

archive/issue_comments_436542.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-31T11:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436542",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_436543.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-31T11:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_436544.json:
```json
{
    "body": "This works now.\n\nI think that `OpenInterval` should silently return a `RealLine` instance if `lower == minus_infinity` and `upper == infinity`. As [Eric pointed out](https://trac.sagemath.org/ticket/30799#comment:50), the  Real line is a fully determined mathematical object, and the behaviour here should reflect that.\n\nBut this should be part of another ticket.",
    "created_at": "2020-10-31T11:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436544",
    "user": "https://github.com/mjungmath"
}
```

This works now.

I think that `OpenInterval` should silently return a `RealLine` instance if `lower == minus_infinity` and `upper == infinity`. As [Eric pointed out](https://trac.sagemath.org/ticket/30799#comment:50), the  Real line is a fully determined mathematical object, and the behaviour here should reflect that.

But this should be part of another ticket.



---

archive/issue_comments_436545.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-02T22:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436545",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_436546.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2020-11-02T22:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436546",
    "user": "https://github.com/tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_436547.json:
```json
{
    "body": "Thanks for the review.",
    "created_at": "2020-11-02T22:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436547",
    "user": "https://github.com/mjungmath"
}
```

Thanks for the review.



---

archive/issue_comments_436548.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-22T15:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30593#issuecomment-436548",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080451.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-22T15:06:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30593",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30593#event-80451"
}
```
