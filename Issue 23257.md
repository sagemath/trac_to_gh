# Issue 23257: Monkey-patch inspect.isfunction() to support Cython functions

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-07-20 12:23:29

See http://opendreamkit.org/2017/06/09/CythonSphinx/


---

Comment by jdemeyer created at 2017-07-20 12:31:13

New commits:


---

Comment by jdemeyer created at 2017-07-20 12:31:13

Changing status from new to needs_review.


---

Comment by embray created at 2017-07-21 11:26:58

I'm not really sure how I feel about

```
hasattr(type(obj), "__code__")
```

but I'm not completely opposed to it.  I just don't know why we can't be more specific.


---

Comment by embray created at 2017-07-21 11:26:58

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-07-21 12:19:09

Replying to [comment:3 embray]:
> I'm not really sure how I feel about
> {{{
> hasattr(type(obj), "__code__")
> }}}
> but I'm not completely opposed to it.  I just don't know why we can't be more specific.

My code uses the "duck typing" philosophy. But I'm open for suggestions...


---

Comment by embray created at 2017-07-21 16:10:12

I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).

Maybe it would be good, as part of any proposal to overhaul Python's function types, if there were an ABC for functions in the sense of https://docs.python.org/3/library/collections.abc.html#collections-abstract-base-classes


---

Comment by jdemeyer created at 2017-07-25 10:08:47

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2017-07-25 10:08:47

Doctest failure (see patchbot)


---

Comment by jdemeyer created at 2017-07-25 10:09:50

Replying to [comment:5 embray]:
> I don't think there's actually a formal interface that defines `__code__` as implying a function-like type, as in the sense that the presence of `__iter__` implies an iterable.  Of course, practically speaking it works fine for that purpose so I'm fine with it; I just mean I don't think there's a specification or anything beyond the fact that the `function` type itself happens to have a `__code__` attribute (I could be wrong, but I haven't seen anything of the sort).

I think you are right. However, the `__code__` attribute seems to work in practice for my purpose, even if it's not formally documented.


---

Comment by jdemeyer created at 2017-07-25 10:10:23

And in any case, such duck-typing is better than the `isinstance()` check that the official `inspect` module does.


---

Comment by git created at 2017-07-25 11:17:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-07-25 11:24:19

Trivial fix.


---

Comment by jdemeyer created at 2017-07-25 11:24:19

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-07-31 20:19:18

Resolution: fixed
