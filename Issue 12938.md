# Issue 12938: ComplexNumber should be able to accept the Python complex type

archive/issues_012938.json:
```json
{
    "body": "Assignee: jason, jkantor\n\n`ComplexNumber` does not know how to convert from the Python `complex` type:\n\n\n```\nsage: ComplexNumber(complex('13.8+6.2j'))\nTypeError: unable to coerce to a ComplexNumber: <type 'str'>\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13110\n\n",
    "created_at": "2012-06-13T00:43:14Z",
    "labels": [
        "numerical",
        "major",
        "bug"
    ],
    "title": "ComplexNumber should be able to accept the Python complex type",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12938",
    "user": "eviatarbach"
}
```
Assignee: jason, jkantor

`ComplexNumber` does not know how to convert from the Python `complex` type:


```
sage: ComplexNumber(complex('13.8+6.2j'))
TypeError: unable to coerce to a ComplexNumber: <type 'str'>
```


Issue created by migration from https://trac.sagemath.org/ticket/13110





---

archive/issue_comments_155827.json:
```json
{
    "body": "Changing keywords from \"\" to \"complex, beginner\".",
    "created_at": "2013-02-09T20:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155827",
    "user": "tscrim"
}
```

Changing keywords from "" to "complex, beginner".



---

archive/issue_comments_155828.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-02-09T20:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155828",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_155829.json:
```json
{
    "body": "Simple fix and easy to review.",
    "created_at": "2013-02-09T20:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155829",
    "user": "tscrim"
}
```

Simple fix and easy to review.



---

archive/issue_comments_155830.json:
```json
{
    "body": "Don't you want it more along the lines of\n\n```\n    if s_imag is None: \n        if isinstance(s_real, complex): \n            s_imag = s_real.imag \n            s_real = s_real.real \n        else:\n            s_imag = 0 \n```\n\nto avoid accepting malformed input such as\n\n```\nComplexNumber(complex(1,1),1)\n```\n\nperhaps?",
    "created_at": "2013-02-09T21:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155830",
    "user": "nbruin"
}
```

Don't you want it more along the lines of

```
    if s_imag is None: 
        if isinstance(s_real, complex): 
            s_imag = s_real.imag 
            s_real = s_real.real 
        else:
            s_imag = 0 
```

to avoid accepting malformed input such as

```
ComplexNumber(complex(1,1),1)
```

perhaps?



---

archive/issue_comments_155831.json:
```json
{
    "body": "Also, a typo; 'fixzed'>'fixed'",
    "created_at": "2013-02-09T21:11:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155831",
    "user": "eviatarbach"
}
```

Also, a typo; 'fixzed'>'fixed'



---

archive/issue_comments_155832.json:
```json
{
    "body": "That is a good idea. Updated (and typo fixzed :P) and now it will also work for `CDF` and `ComplexField` elements as well.",
    "created_at": "2013-02-09T21:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155832",
    "user": "tscrim"
}
```

That is a good idea. Updated (and typo fixzed :P) and now it will also work for `CDF` and `ComplexField` elements as well.



---

archive/issue_comments_155833.json:
```json
{
    "body": "It seems to me that you should explain in the doc that a new kind of input is now allowed. So far, the doc says that the only possible input is a pair of numbers.",
    "created_at": "2013-04-03T20:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155833",
    "user": "chapoton"
}
```

It seems to me that you should explain in the doc that a new kind of input is now allowed. So far, the doc says that the only possible input is a pair of numbers.



---

archive/issue_comments_155834.json:
```json
{
    "body": "Attachment [trac_13110-python_complex_input-ts.patch](tarball://root/attachments/some-uuid/ticket13110/trac_13110-python_complex_input-ts.patch) by tscrim created at 2013-04-03 22:14:49\n\nI've updated the documentation and added a (quick 'n' dirty) parser for string inputs as well.",
    "created_at": "2013-04-03T22:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155834",
    "user": "tscrim"
}
```

Attachment [trac_13110-python_complex_input-ts.patch](tarball://root/attachments/some-uuid/ticket13110/trac_13110-python_complex_input-ts.patch) by tscrim created at 2013-04-03 22:14:49

I've updated the documentation and added a (quick 'n' dirty) parser for string inputs as well.



---

archive/issue_comments_155835.json:
```json
{
    "body": "This is really nice, but I think the string parser should be more strict in order to enforce a more consistent syntax. How about just accepting the Python `complex` syntax?",
    "created_at": "2013-04-04T04:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155835",
    "user": "eviatarbach"
}
```

This is really nice, but I think the string parser should be more strict in order to enforce a more consistent syntax. How about just accepting the Python `complex` syntax?



---

archive/issue_comments_155836.json:
```json
{
    "body": "Replying to [comment:7 eviatarbach]:\n> This is really nice, but I think the string parser should be more strict in order to enforce a more consistent syntax. How about just accepting the Python `complex` syntax?\n\nI disagree since the output from `ComplexNumber(1, 1)` is `1.0... + 1.0...*I`, so we should allow this as valid input to be consistent with python's `complex` function and because we do accept python `complex` strings.",
    "created_at": "2013-04-08T13:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155836",
    "user": "tscrim"
}
```

Replying to [comment:7 eviatarbach]:
> This is really nice, but I think the string parser should be more strict in order to enforce a more consistent syntax. How about just accepting the Python `complex` syntax?

I disagree since the output from `ComplexNumber(1, 1)` is `1.0... + 1.0...*I`, so we should allow this as valid input to be consistent with python's `complex` function and because we do accept python `complex` strings.



---

archive/issue_comments_155837.json:
```json
{
    "body": "This makes sense, but `2.0+5.0I` isn't valid syntax in either Python or Sage.",
    "created_at": "2013-04-08T17:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155837",
    "user": "eviatarbach"
}
```

This makes sense, but `2.0+5.0I` isn't valid syntax in either Python or Sage.



---

archive/issue_comments_155838.json:
```json
{
    "body": "True, but it's the \"natural\" in between since python complex strings are `2 + 2j` and I think a typical user is likely to try `2 + 2i` first. However, if you feel strongly about it, I'll remove it since it is easier to add functionality into sage than to remove it; and I'm 95% certain there's a bug in my current implementation that I have to fix (it should fail on `2 + -2*I`).",
    "created_at": "2013-04-08T17:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155838",
    "user": "tscrim"
}
```

True, but it's the "natural" in between since python complex strings are `2 + 2j` and I think a typical user is likely to try `2 + 2i` first. However, if you feel strongly about it, I'll remove it since it is easier to add functionality into sage than to remove it; and I'm 95% certain there's a bug in my current implementation that I have to fix (it should fail on `2 + -2*I`).



---

archive/issue_comments_155839.json:
```json
{
    "body": "We already have a clash\n\n```\nsage: 2.0j\n2.00000000000000*I\nsage: implicit_multiplication(True)\nsage: 2.0j\nNameError: name 'j' is not defined\n```\n\nand I'm pretty sure you won't get to predefine `i` and `j`.",
    "created_at": "2013-04-08T18:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155839",
    "user": "nbruin"
}
```

We already have a clash

```
sage: 2.0j
2.00000000000000*I
sage: implicit_multiplication(True)
sage: 2.0j
NameError: name 'j' is not defined
```

and I'm pretty sure you won't get to predefine `i` and `j`.



---

archive/issue_comments_155840.json:
```json
{
    "body": "I'm a bit scared by the included number parser ;-) Can we use a regex? This would also be better at validating input.",
    "created_at": "2013-05-11T19:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155840",
    "user": "vbraun"
}
```

I'm a bit scared by the included number parser ;-) Can we use a regex? This would also be better at validating input.



---

archive/issue_comments_155841.json:
```json
{
    "body": "The ticket states that `ComplexNumber(complex(...))` doesn't work and proceeds by implementing a more elaborate string parser. That's not the most obvious way of soving the ticket:\n- a python `complex` already has a nice `.real()` and `.imag()`, so stuffing them together in a string to just pry them apart is not a smart move. Doing\n\n```\n    if isinstance(s_real, complex):\n        s_real, s_imag = s_real.real(), s_real.imag()\n```\n\nmakes much more sense to solve the problem at hand.\n- The fact that `ComplexNumber` would assemble a complex number from numerical input by converting to a string is ludicrous in its own right: If you're handed real and imaginary parts in numerical form, you should NOT be converting to strings as an intermediate. That's just asking for precision loss (and horrible performance).\n\nI realize that we have the documentation:\n\n```\ndef create_ComplexNumber(s_real, s_imag=None, int pad=0, min_prec=53):\n    Return the complex number defined by the strings s_real and\n    s_imag as an element of ``ComplexField(prec=n)``,\n    where n potentially has slightly more (controlled by pad) bits than\n    given by s.\n```\n\nAccording to that documentation, the proposed input is not valid anyway. By changing that you're changing the interface the routine offers. That's fine, but once you start changing it, you should *improve* it.\n\nNote that `CC(complex(\"1+2j\"))` already works. By the looks of it, `CC.__call__` is already taking a much saner approach. Perhaps `ComplexNumber` should share more with that routine? Or be documented that people should really use `CC(...)`? or perhaps `ComplexNumber` can be deprecated altogether?",
    "created_at": "2013-05-11T20:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155841",
    "user": "nbruin"
}
```

The ticket states that `ComplexNumber(complex(...))` doesn't work and proceeds by implementing a more elaborate string parser. That's not the most obvious way of soving the ticket:
- a python `complex` already has a nice `.real()` and `.imag()`, so stuffing them together in a string to just pry them apart is not a smart move. Doing

```
    if isinstance(s_real, complex):
        s_real, s_imag = s_real.real(), s_real.imag()
```

makes much more sense to solve the problem at hand.
- The fact that `ComplexNumber` would assemble a complex number from numerical input by converting to a string is ludicrous in its own right: If you're handed real and imaginary parts in numerical form, you should NOT be converting to strings as an intermediate. That's just asking for precision loss (and horrible performance).

I realize that we have the documentation:

```
def create_ComplexNumber(s_real, s_imag=None, int pad=0, min_prec=53):
    Return the complex number defined by the strings s_real and
    s_imag as an element of ``ComplexField(prec=n)``,
    where n potentially has slightly more (controlled by pad) bits than
    given by s.
```

According to that documentation, the proposed input is not valid anyway. By changing that you're changing the interface the routine offers. That's fine, but once you start changing it, you should *improve* it.

Note that `CC(complex("1+2j"))` already works. By the looks of it, `CC.__call__` is already taking a much saner approach. Perhaps `ComplexNumber` should share more with that routine? Or be documented that people should really use `CC(...)`? or perhaps `ComplexNumber` can be deprecated altogether?



---

archive/issue_comments_155842.json:
```json
{
    "body": "Replying to [comment:13 nbruin]:\n> The ticket states that `ComplexNumber(complex(...))` doesn't work and proceeds by implementing a more elaborate string parser. That's not the most obvious way of soving the ticket:\n>  - a python `complex` already has a nice `.real()` and `.imag()`, so stuffing them together in a string to just pry them apart is not a smart move. Doing\n> {{{\n>     if isinstance(s_real, complex):\n>         s_real, s_imag = s_real.real(), s_real.imag()\n> }}}\n>    makes much more sense to solve the problem at hand.\n\nThis is already how I've done it done in the current patch.\n\n>  - The fact that `ComplexNumber` would assemble a complex number from numerical input by converting to a string is ludicrous in its own right: If you're handed real and imaginary parts in numerical form, you should NOT be converting to strings as an intermediate. That's just asking for precision loss (and horrible performance).\n\nThat was the original implementation with two reals as input, and I haven't changed that. Nevertheless, I agree that it should be changed (see below).\n\n> \n> I realize that we have the documentation:\n> {{{\n> def create_ComplexNumber(s_real, s_imag=None, int pad=0, min_prec=53):\n>     Return the complex number defined by the strings s_real and\n>     s_imag as an element of ``ComplexField(prec=n)``,\n>     where n potentially has slightly more (controlled by pad) bits than\n>     given by s.\n> }}}\n>    According to that documentation, the proposed input is not valid anyway. By changing that you're changing the interface the routine offers. That's fine, but once you start changing it, you should *improve* it.\n> \n> Note that `CC(complex(\"1+2j\"))` already works. By the looks of it, `CC.__call__` is already taking a much saner approach. Perhaps `ComplexNumber` should share more with that routine? Or be documented that people should really use `CC(...)`? or perhaps `ComplexNumber` can be deprecated altogether?\n\nHow about we check if the input is a (pair of) `str`, and if not, then it just feeds it to `CC` in an appropriate fashion? I don't think we should deprecate it because the naive person IMO would likely look for `ComplexNumber` before `CC`.\n\n\nVolker, good point. I don't use regex too often so it's never really something I think of. I'll do that on the next patch.",
    "created_at": "2013-05-11T21:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155842",
    "user": "tscrim"
}
```

Replying to [comment:13 nbruin]:
> The ticket states that `ComplexNumber(complex(...))` doesn't work and proceeds by implementing a more elaborate string parser. That's not the most obvious way of soving the ticket:
>  - a python `complex` already has a nice `.real()` and `.imag()`, so stuffing them together in a string to just pry them apart is not a smart move. Doing
> {{{
>     if isinstance(s_real, complex):
>         s_real, s_imag = s_real.real(), s_real.imag()
> }}}
>    makes much more sense to solve the problem at hand.

This is already how I've done it done in the current patch.

>  - The fact that `ComplexNumber` would assemble a complex number from numerical input by converting to a string is ludicrous in its own right: If you're handed real and imaginary parts in numerical form, you should NOT be converting to strings as an intermediate. That's just asking for precision loss (and horrible performance).

That was the original implementation with two reals as input, and I haven't changed that. Nevertheless, I agree that it should be changed (see below).

> 
> I realize that we have the documentation:
> {{{
> def create_ComplexNumber(s_real, s_imag=None, int pad=0, min_prec=53):
>     Return the complex number defined by the strings s_real and
>     s_imag as an element of ``ComplexField(prec=n)``,
>     where n potentially has slightly more (controlled by pad) bits than
>     given by s.
> }}}
>    According to that documentation, the proposed input is not valid anyway. By changing that you're changing the interface the routine offers. That's fine, but once you start changing it, you should *improve* it.
> 
> Note that `CC(complex("1+2j"))` already works. By the looks of it, `CC.__call__` is already taking a much saner approach. Perhaps `ComplexNumber` should share more with that routine? Or be documented that people should really use `CC(...)`? or perhaps `ComplexNumber` can be deprecated altogether?

How about we check if the input is a (pair of) `str`, and if not, then it just feeds it to `CC` in an appropriate fashion? I don't think we should deprecate it because the naive person IMO would likely look for `ComplexNumber` before `CC`.


Volker, good point. I don't use regex too often so it's never really something I think of. I'll do that on the next patch.



---

archive/issue_comments_155843.json:
```json
{
    "body": "`CC._element_constructor_` is probably slow for string input since it evaluates the input. I'm a bit uncomfortable with that security-wise, though there are certainly bigger fish to fry.\n\nI agree that it would be best if `ComplexNumber` would just delegate everything to `CC`. The latter even handles two strings as input. The docstring should reflect that and say that it is preferred to use `CC` / `CDF` directly.",
    "created_at": "2013-05-11T21:45:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155843",
    "user": "vbraun"
}
```

`CC._element_constructor_` is probably slow for string input since it evaluates the input. I'm a bit uncomfortable with that security-wise, though there are certainly bigger fish to fry.

I agree that it would be best if `ComplexNumber` would just delegate everything to `CC`. The latter even handles two strings as input. The docstring should reflect that and say that it is preferred to use `CC` / `CDF` directly.



---

archive/issue_comments_155844.json:
```json
{
    "body": "Hmm. What do you all think of just making `ComplexNumber` an alias for `CC`? In fact, I think this could also be done to `RealNumber` with `RR`.",
    "created_at": "2013-05-11T23:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155844",
    "user": "eviatarbach"
}
```

Hmm. What do you all think of just making `ComplexNumber` an alias for `CC`? In fact, I think this could also be done to `RealNumber` with `RR`.



---

archive/issue_comments_155845.json:
```json
{
    "body": "Replying to [comment:15 vbraun]:\n> `CC._element_constructor_` is probably slow for string input since it evaluates the input. I'm a bit uncomfortable with that security-wise, though there are certainly bigger fish to fry.\n\nYes, indeed. That very \"eval\" instruction is marked with a \"TODO\", indicating that it could use improvements. I'd say that's the place to a string interpretation routine, rather than in `create_ComplexNumber`. Note, by the way, that most machinery for making complex numbers sits in `sage.rings.complex_number.ComplexNumber.__init__`. It can deal with various inputs, including strings for real and imag, by virtue of just calling `RR(real)` and `RR(imag)` (where `RR` is the underlying real field). Thus, the only thing a \"complex number\" parser would have to do is locate the likely real and imaginary part in the string and pass them on. This could even be put in this routine itself.\n\nThere is one thing that `create_ComplexNumber` does that other routines don't: It takes the string lengths as an indication of the number of bits required in the representation. None of the other routines do that. It also indicates that `create_ComplexNumber` perhaps shouldn't be used for anything more general, or in its other roles, take a hint from its input to choose what precision to use.\n\nI think in general, guessing precision from number of digits written down is rarely going to produce desirable results, so I'd be for providing the user interface with a default precision (complex) field.",
    "created_at": "2013-05-12T01:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155845",
    "user": "nbruin"
}
```

Replying to [comment:15 vbraun]:
> `CC._element_constructor_` is probably slow for string input since it evaluates the input. I'm a bit uncomfortable with that security-wise, though there are certainly bigger fish to fry.

Yes, indeed. That very "eval" instruction is marked with a "TODO", indicating that it could use improvements. I'd say that's the place to a string interpretation routine, rather than in `create_ComplexNumber`. Note, by the way, that most machinery for making complex numbers sits in `sage.rings.complex_number.ComplexNumber.__init__`. It can deal with various inputs, including strings for real and imag, by virtue of just calling `RR(real)` and `RR(imag)` (where `RR` is the underlying real field). Thus, the only thing a "complex number" parser would have to do is locate the likely real and imaginary part in the string and pass them on. This could even be put in this routine itself.

There is one thing that `create_ComplexNumber` does that other routines don't: It takes the string lengths as an indication of the number of bits required in the representation. None of the other routines do that. It also indicates that `create_ComplexNumber` perhaps shouldn't be used for anything more general, or in its other roles, take a hint from its input to choose what precision to use.

I think in general, guessing precision from number of digits written down is rarely going to produce desirable results, so I'd be for providing the user interface with a default precision (complex) field.



---

archive/issue_comments_155846.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-06-12T19:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155846",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155847.json:
```json
{
    "body": "For reference, Python's built-in function for generating a `complex` from a string is defined at http://hg.python.org/cpython/file/c6880edaf6f3/Objects/complexobject.c as `complex_subtype_from_string`. We should probably try to emulate that for our parser.",
    "created_at": "2013-08-19T23:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155847",
    "user": "eviatarbach"
}
```

For reference, Python's built-in function for generating a `complex` from a string is defined at http://hg.python.org/cpython/file/c6880edaf6f3/Objects/complexobject.c as `complex_subtype_from_string`. We should probably try to emulate that for our parser.



---

archive/issue_comments_155848.json:
```json
{
    "body": "Changing component from numerical to coercion.",
    "created_at": "2014-10-16T17:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155848",
    "user": "jdemeyer"
}
```

Changing component from numerical to coercion.



---

archive/issue_comments_155849.json:
```json
{
    "body": "Changing component from coercion to numerical.",
    "created_at": "2014-10-16T17:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155849",
    "user": "jdemeyer"
}
```

Changing component from coercion to numerical.



---

archive/issue_comments_155850.json:
```json
{
    "body": "Sorry, I shouldn't have taken over this ticket, it's about something else.",
    "created_at": "2014-10-16T17:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155850",
    "user": "jdemeyer"
}
```

Sorry, I shouldn't have taken over this ticket, it's about something else.



---

archive/issue_comments_155851.json:
```json
{
    "body": "I am interested on working on the issue. How do I start?",
    "created_at": "2016-11-24T14:45:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155851",
    "user": "souravsingh"
}
```

I am interested on working on the issue. How do I start?



---

archive/issue_comments_155852.json:
```json
{
    "body": "I believe all that is needed is changing the [ComplexNumber](ComplexNumber) function and the RealNumber function to point to CC and RR instead.",
    "created_at": "2016-11-27T00:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155852",
    "user": "zonova"
}
```

I believe all that is needed is changing the [ComplexNumber](ComplexNumber) function and the RealNumber function to point to CC and RR instead.



---

archive/issue_comments_155853.json:
```json
{
    "body": "I modified `create_ComplexNumber` to allow the input as stated in the ticket description as a temporary fix. How should [ComplexNumber](ComplexNumber) and RealNumber point to CC and RR? Just make them aliases or eg call CC with the same input inside `create_ComplexNumber`?  \n----\nNew commits:",
    "created_at": "2017-03-15T18:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155853",
    "user": "epilys"
}
```

I modified `create_ComplexNumber` to allow the input as stated in the ticket description as a temporary fix. How should [ComplexNumber](ComplexNumber) and RealNumber point to CC and RR? Just make them aliases or eg call CC with the same input inside `create_ComplexNumber`?  
----
New commits:



---

archive/issue_comments_155854.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-15T18:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155854",
    "user": "epilys"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155855.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-03-21T09:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155855",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_155856.json:
```json
{
    "body": "Replying to [comment:30 epilys]:\n> I modified `create_ComplexNumber` to allow the input as stated in the ticket description as a temporary fix.\n\nBut why? I don't think there is much reason to allow `RealNumber()` and `ComplexNumber`, that's why I think they should be deprecated instead.",
    "created_at": "2017-03-21T09:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155856",
    "user": "jdemeyer"
}
```

Replying to [comment:30 epilys]:
> I modified `create_ComplexNumber` to allow the input as stated in the ticket description as a temporary fix.

But why? I don't think there is much reason to allow `RealNumber()` and `ComplexNumber`, that's why I think they should be deprecated instead.



---

archive/issue_comments_155857.json:
```json
{
    "body": "Replying to [comment:30 epilys]:\n> I modified `create_ComplexNumber` to allow the input as stated in the ticket description as a temporary fix. How should [ComplexNumber](ComplexNumber) and RealNumber point to CC and RR? Just make them aliases or eg call CC with the same input inside `create_ComplexNumber`?  \n> ----\n> New commits:\n> ||[c1995f1](https://git.sagemath.org/sage.git/commit?id=c1995f12a8529bdb5c5ff25288b481caf01a40c9)||`Allow type complex input in ComplexNumber()`||\n\n\nYes, I was suggesting that [ComplexNumber](ComplexNumber) and RealNumber be aliases for CC and RR. Unless I am missing some functionality that these are supposed to provide that CC and RR don't. I think that, for a lot of students, they would easily recognize the command [ComplexNumber](ComplexNumber), but might not recognize the command CC, so I think it is useful as an alias.",
    "created_at": "2017-03-21T14:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155857",
    "user": "zonova"
}
```

Replying to [comment:30 epilys]:
> I modified `create_ComplexNumber` to allow the input as stated in the ticket description as a temporary fix. How should [ComplexNumber](ComplexNumber) and RealNumber point to CC and RR? Just make them aliases or eg call CC with the same input inside `create_ComplexNumber`?  
> ----
> New commits:
> ||[c1995f1](https://git.sagemath.org/sage.git/commit?id=c1995f12a8529bdb5c5ff25288b481caf01a40c9)||`Allow type complex input in ComplexNumber()`||


Yes, I was suggesting that [ComplexNumber](ComplexNumber) and RealNumber be aliases for CC and RR. Unless I am missing some functionality that these are supposed to provide that CC and RR don't. I think that, for a lot of students, they would easily recognize the command [ComplexNumber](ComplexNumber), but might not recognize the command CC, so I think it is useful as an alias.



---

archive/issue_comments_155858.json:
```json
{
    "body": "Replying to [comment:33 zonova]:\n> I think that, for a lot of students, they would easily recognize the command [ComplexNumber](ComplexNumber)\n\nWhy *should* they recognize the command `ComplexNumber`? Most likely they will type something like `1.2 + 3.4 * I` and that works fine.",
    "created_at": "2017-03-21T15:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155858",
    "user": "jdemeyer"
}
```

Replying to [comment:33 zonova]:
> I think that, for a lot of students, they would easily recognize the command [ComplexNumber](ComplexNumber)

Why *should* they recognize the command `ComplexNumber`? Most likely they will type something like `1.2 + 3.4 * I` and that works fine.



---

archive/issue_comments_155859.json:
```json
{
    "body": "Replying to [comment:34 jdemeyer]:\n> Replying to [comment:33 zonova]:\n> > I think that, for a lot of students, they would easily recognize the command [ComplexNumber](ComplexNumber)\n> \n> Why *should* they recognize the command `ComplexNumber`? Most likely they will type something like `1.2 + 3.4 * I` and that works fine.\n\nThat does not\n\n```\nsage: parent(1.2 + 3.4 * I)\nSymbolic Ring\n```\n",
    "created_at": "2018-01-17T17:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155859",
    "user": "vdelecroix"
}
```

Replying to [comment:34 jdemeyer]:
> Replying to [comment:33 zonova]:
> > I think that, for a lot of students, they would easily recognize the command [ComplexNumber](ComplexNumber)
> 
> Why *should* they recognize the command `ComplexNumber`? Most likely they will type something like `1.2 + 3.4 * I` and that works fine.

That does not

```
sage: parent(1.2 + 3.4 * I)
Symbolic Ring
```




---

archive/issue_comments_155860.json:
```json
{
    "body": "I think that the simplest would just be to remove `RealNumber` and `ComplexNumber` from the global namespace (ie deprecate them). These functions are intended to parse a very special kind of strings in a very particular way. This can be achieved by other means in the console like `RR(my_string)`/`CC(my_string)` as was suggested.",
    "created_at": "2018-01-17T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155860",
    "user": "vdelecroix"
}
```

I think that the simplest would just be to remove `RealNumber` and `ComplexNumber` from the global namespace (ie deprecate them). These functions are intended to parse a very special kind of strings in a very particular way. This can be achieved by other means in the console like `RR(my_string)`/`CC(my_string)` as was suggested.



---

archive/issue_comments_155861.json:
```json
{
    "body": "Changing keywords from \"complex, beginner\" to \"\".",
    "created_at": "2018-01-17T17:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155861",
    "user": "vdelecroix"
}
```

Changing keywords from "complex, beginner" to "".



---

archive/issue_comments_155862.json:
```json
{
    "body": "If we decide to keep `RealNumber`/`ComplexNumber` in the global namespace, I think that what they should be would better be left to #24456 and #24457. This is one more reason to make this ticket used only for deprecation.",
    "created_at": "2018-01-17T17:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155862",
    "user": "vdelecroix"
}
```

If we decide to keep `RealNumber`/`ComplexNumber` in the global namespace, I think that what they should be would better be left to #24456 and #24457. This is one more reason to make this ticket used only for deprecation.



---

archive/issue_comments_155863.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-01-25T15:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155863",
    "user": "vdelecroix"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_155864.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-01-25T15:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155864",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_155865.json:
```json
{
    "body": "Mostly setting to needs review in order to let patchbots test it!",
    "created_at": "2018-01-25T15:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155865",
    "user": "vdelecroix"
}
```

Mostly setting to needs review in order to let patchbots test it!



---

archive/issue_comments_155866.json:
```json
{
    "body": "I don't like the verbosity of `sage.rings.real_mpfr.create_RealNumber`. I would suggest still keeping it in the global namespace but under a (short) private name like `_Real`.",
    "created_at": "2018-01-25T16:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155866",
    "user": "jdemeyer"
}
```

I don't like the verbosity of `sage.rings.real_mpfr.create_RealNumber`. I would suggest still keeping it in the global namespace but under a (short) private name like `_Real`.



---

archive/issue_comments_155867.json:
```json
{
    "body": "Replying to [comment:41 jdemeyer]:\n> I don't like the verbosity of `sage.rings.real_mpfr.create_RealNumber`. I would suggest still keeping it in the global namespace but under a (short) private name like `_Real`.\n\nFine for me.",
    "created_at": "2018-01-25T16:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155867",
    "user": "vdelecroix"
}
```

Replying to [comment:41 jdemeyer]:
> I don't like the verbosity of `sage.rings.real_mpfr.create_RealNumber`. I would suggest still keeping it in the global namespace but under a (short) private name like `_Real`.

Fine for me.



---

archive/issue_comments_155868.json:
```json
{
    "body": "Replying to [comment:42 vdelecroix]:\n> Replying to [comment:41 jdemeyer]:\n> > I don't like the verbosity of `sage.rings.real_mpfr.create_RealNumber`. I would suggest still keeping it in the global namespace but under a (short) private name like `_Real`.\n> \n> Fine for me.\n\nThough a problem is that names starting with underscore in `all.py` files are not imported.",
    "created_at": "2018-01-25T16:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155868",
    "user": "vdelecroix"
}
```

Replying to [comment:42 vdelecroix]:
> Replying to [comment:41 jdemeyer]:
> > I don't like the verbosity of `sage.rings.real_mpfr.create_RealNumber`. I would suggest still keeping it in the global namespace but under a (short) private name like `_Real`.
> 
> Fine for me.

Though a problem is that names starting with underscore in `all.py` files are not imported.



---

archive/issue_comments_155869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-25T18:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155869",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_155870.json:
```json
{
    "body": "Replying to [comment:43 vdelecroix]:\n> Though a problem is that names starting with underscore in `all.py` files are not imported.\n\nNot a big problem, just import `_Real` and `_Complex` explicitly.",
    "created_at": "2018-01-25T21:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155870",
    "user": "jdemeyer"
}
```

Replying to [comment:43 vdelecroix]:
> Though a problem is that names starting with underscore in `all.py` files are not imported.

Not a big problem, just import `_Real` and `_Complex` explicitly.



---

archive/issue_comments_155871.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Replying to [comment:43 vdelecroix]:\n> > Though a problem is that names starting with underscore in `all.py` files are not imported.\n> \n> Not a big problem, just import `_Real` and `_Complex` explicitly.\n\nFrom where? This is about the preparser...",
    "created_at": "2018-01-25T21:15:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155871",
    "user": "vdelecroix"
}
```

Replying to [comment:45 jdemeyer]:
> Replying to [comment:43 vdelecroix]:
> > Though a problem is that names starting with underscore in `all.py` files are not imported.
> 
> Not a big problem, just import `_Real` and `_Complex` explicitly.

From where? This is about the preparser...



---

archive/issue_comments_155872.json:
```json
{
    "body": "Replying to [comment:46 vdelecroix]:\n> From where?\n\nPut this in `sage.all`:\n\n```\nfrom sage.rings.real_mpfr import create_RealNumber as _Real\n```\n",
    "created_at": "2018-01-25T21:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155872",
    "user": "jdemeyer"
}
```

Replying to [comment:46 vdelecroix]:
> From where?

Put this in `sage.all`:

```
from sage.rings.real_mpfr import create_RealNumber as _Real
```




---

archive/issue_comments_155873.json:
```json
{
    "body": "Replying to [comment:47 jdemeyer]:\n> Replying to [comment:46 vdelecroix]:\n> > From where?\n> \n> Put this in `sage.all`:\n> {{{\n> from sage.rings.real_mpfr import create_RealNumber as _Real\n> }}}\n\nDoes not work. Names starting with an underscore are ignored by the `import *` syntax.",
    "created_at": "2018-01-25T21:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155873",
    "user": "vdelecroix"
}
```

Replying to [comment:47 jdemeyer]:
> Replying to [comment:46 vdelecroix]:
> > From where?
> 
> Put this in `sage.all`:
> {{{
> from sage.rings.real_mpfr import create_RealNumber as _Real
> }}}

Does not work. Names starting with an underscore are ignored by the `import *` syntax.



---

archive/issue_comments_155874.json:
```json
{
    "body": "Replying to [comment:48 vdelecroix]:\n> Replying to [comment:47 jdemeyer]:\n> > Replying to [comment:46 vdelecroix]:\n> > > From where?\n> > \n> > Put this in `sage.all`:\n> > {{{\n> > from sage.rings.real_mpfr import create_RealNumber as _Real\n> > }}}\n> \n> Does not work. Names starting with an underscore are ignored by the `import *` syntax.\n\nThis would be a (not very elegant) solution\n\n```diff\ndiff --git a/src/sage/repl/ipython_extension.py b/src/sage/repl/ipython_extension.py\nindex 90a8049d72..22110fe5ac 100644\n--- a/src/sage/repl/ipython_extension.py\n+++ b/src/sage/repl/ipython_extension.py\n@@ -476,8 +476,12 @@ class SageCustomizations(object):\n         Set up Sage command-line environment\n         \"\"\"\n         # import outside of cell so we don't get a traceback\n-        from sage.repl.user_globals import initialize_globals\n+        from sage.repl.user_globals import initialize_globals, set_global\n+        from sage.rings.real_mpfr import create_RealNumber\n+        from sage.rings.complex_number import create_ComplexNumber\n         initialize_globals(self.all_globals(), self.shell.user_ns)\n+        set_global('_Real', create_RealNumber)\n+        set_global('_Complex', create_ComplexNumber)\n         self.run_init()\n```\n",
    "created_at": "2018-01-25T23:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155874",
    "user": "vdelecroix"
}
```

Replying to [comment:48 vdelecroix]:
> Replying to [comment:47 jdemeyer]:
> > Replying to [comment:46 vdelecroix]:
> > > From where?
> > 
> > Put this in `sage.all`:
> > {{{
> > from sage.rings.real_mpfr import create_RealNumber as _Real
> > }}}
> 
> Does not work. Names starting with an underscore are ignored by the `import *` syntax.

This would be a (not very elegant) solution

```diff
diff --git a/src/sage/repl/ipython_extension.py b/src/sage/repl/ipython_extension.py
index 90a8049d72..22110fe5ac 100644
--- a/src/sage/repl/ipython_extension.py
+++ b/src/sage/repl/ipython_extension.py
@@ -476,8 +476,12 @@ class SageCustomizations(object):
         Set up Sage command-line environment
         """
         # import outside of cell so we don't get a traceback
-        from sage.repl.user_globals import initialize_globals
+        from sage.repl.user_globals import initialize_globals, set_global
+        from sage.rings.real_mpfr import create_RealNumber
+        from sage.rings.complex_number import create_ComplexNumber
         initialize_globals(self.all_globals(), self.shell.user_ns)
+        set_global('_Real', create_RealNumber)
+        set_global('_Complex', create_ComplexNumber)
         self.run_init()
```




---

archive/issue_comments_155875.json:
```json
{
    "body": "does not apply",
    "created_at": "2018-02-09T15:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155875",
    "user": "chapoton"
}
```

does not apply



---

archive/issue_comments_155876.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-09T15:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12938",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12938#issuecomment-155876",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.
