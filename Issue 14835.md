# Issue 14835: sage --version hangs on MacOS

Issue created by migration from Trac.

Original creator: aschilling

Original creation time: 2013-08-21 09:59:07

sage --version hangs in sage-5.12.beta1 on MacOS. It still works with sage-5.11.


---

Comment by vbraun created at 2013-08-21 10:13:45

See also https://groups.google.com/d/msg/sage-release/TbSd9Lm5EHE/YjcphaIJ_nwJ

Though it did work on the buildbot, so there must be something specific to the OSX machines where it fails.


---

Comment by vbraun created at 2013-08-21 10:17:27

On bsd.math:

```
cloud:~ vbraun$ cat sage-banner 
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 5.12.beta2, Release Date: 2013-08-20                  │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
cloud:~ vbraun$ sed -n -e 's/.*\(Sage Version.*Date: [0-9-]*\).*/\1/p' ./sage-banner
Sage Version 5.12.beta2, Release Date: 2013-08-20
cloud:~ vbraun$ echo $LANG

cloud:~ vbraun$ LANG=C sed -n -e 's/.*\(Sage Version.*Date: [0-9-]*\).*/\1/p' ./sage-banner
Sage Version 5.12.beta2, Release Date: 2013-08-20
cloud:~ vbraun$ LANG=fr sed -n -e 's/.*\(Sage Version.*Date: [0-9-]*\).*/\1/p' ./sage-banner
Sage Version 5.12.beta2, Release Date: 2013-08-20
cloud:~ vbraun$ LANG=en_US sed -n -e 's/.*\(Sage Version.*Date: [0-9-]*\).*/\1/p' ./sage-banner
^C
```

The last one hangs, sed on OSX has apparently some serious braindamage.


---

Comment by jdemeyer created at 2013-08-21 10:34:10

Changing component from PLEASE CHANGE to porting.


---

Comment by jdemeyer created at 2013-08-21 10:37:05

Proposal: run

```
export LC_ALL=C
```

before running that `sed` command.


---

Comment by vbraun created at 2013-08-21 10:38:54

More discussion here, apparently there are a number of issues with sed on OSX 10.8: https://github.com/mxcl/homebrew/pull/13787

Just `LC_CTYPE=C` is enough, so I'll patch it with that.


---

Comment by vbraun created at 2013-08-21 10:38:54

Changing component from porting to PLEASE CHANGE.


---

Comment by vbraun created at 2013-08-21 10:47:33

Changing component from PLEASE CHANGE to scripts.


---

Comment by vbraun created at 2013-08-21 10:47:33

Changing status from new to needs_review.


---

Comment by aschilling created at 2013-08-21 10:48:46

Replying to [comment:6 jdemeyer]:
> Proposal: run
> {{{
> export LC_ALL=C
> }}}
> before running that `sed` command.

That seems to work!


---

Comment by jdemeyer created at 2013-08-21 12:23:50

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2013-08-21 12:23:50

Replying to [comment:7 vbraun]:
> Just `LC_CTYPE=C` is enough, so I'll patch it with that.
I would use `LC_ALL` since that overrides `LC_CTYPE` (in case both are set). The following still hangs:

```
LC_CTYPE=C LC_ALL=en_US sed -n -e 's/.*\(Sage Version.*Date: [0-9-]*\).*/\1/p' ./sage-banner
```



---

Comment by jdemeyer created at 2013-08-21 12:26:43

Also, in the comment `OSX 10.8` is inaccurate, as it occurs also with `OSX 10.6`


---

Comment by vbraun created at 2013-08-21 12:42:12

Updated patch


---

Comment by vbraun created at 2013-08-21 12:42:52

Changing status from needs_work to needs_review.


---

Attachment

I hope OSX doesn't set `LC_ALL` by default, that would be even more WTF. I would put it into the category of settings that ought to break things since you explicitly asked for it to be broken. 

In any case, I switched to overriding `LC_ALL` and don't refer to 10.8 any more.


---

Comment by jdemeyer created at 2013-08-21 13:58:18

Replying to [comment:12 vbraun]:
> I hope OSX doesn't set `LC_ALL` by default
I was thinking that a user might have set it.


---

Comment by jdemeyer created at 2013-08-21 13:58:18

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-08-28 06:55:13

Resolution: fixed
