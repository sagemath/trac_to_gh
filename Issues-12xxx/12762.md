# Issue 12762: LinBox (1.1.6) fails to build with GCC 4.7.0, and lacks an `spkg-check`

archive/issues_012590.json:
```json
{
    "body": "Assignee: @nexttime\n\nCC:  @ClementPernet @williamstein mariah\n\nKeywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5\n\nThis is due to stricter (C++11) name look-up rules in GCC 4.7.x.\n\nI've created an spkg with a trivial fix, just adding `-fpermissive` to `CXXFLAGS` if we're using `g++` 4.7.x:\n\n```patch\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -20,6 +20,13 @@\n export CFLAGS=\"$CFLAGS -g -fPIC\"\n export CXXFLAGS=\"$CXXFLAGS -g -fPIC\"\n \n+case \"`$CXX -dumpversion 2>/dev/null`\" in\n+    4.7.*)\n+        echo \"Adding '-fpermissive' to CXXFLAGS to make LinBox build with GCC 4.7.x.\"\n+        echo \"This is a temporary fix; LinBox currently doesn't conform to the C++11 standard.\"\n+        CXXFLAGS=\"-fpermissive $CXXFLAGS\" # The user might still override that.\n+esac\n+\n # Some systems have problems when parts of Linbox are compiled with\n # the commentator enabled and other parts with the commentator\n # disabled.  Therefore, disable it always.\n```\n\n---\n\n**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/linbox-1.1.6.p10.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/linbox-1.1.6.p10.spkg)\n\n### linbox-1.1.6.p10 (Jeroen Demeyer, 25 May 2012)\n* #12762 review: Remove the touching of linbox.pyx, since\n  Cython knows the dependency of linbox.pyx on linbox-sage.h\n* Only add the -fpermissive workaround on GCC-4.7.x, not other\n  compilers.\n\n### linbox-1.1.6.p9 (Leif Leonhardy, April 7th 2012)\n* #12762: Temporarily add `-fpermissive` to `CXXFLAGS` if we're compiling\n  with `g++` 4.7.x, since the LinBox sources currently don't conform to\n  C++11, so GCC 4.7.x would otherwise reject them.\n* Exit if the build failed.\n* Use `CFLAG64` if it is set (and `SAGE64=yes`).\n* Clean up `spkg-install`, add some messages.\n* Add an `spkg-check` file, which currently runs `make check`. (There's also\n  a `fullcheck` target.)\n* Change patch to disable the commentator, as default parameters were missing\n  with `-DDISABLE_COMMENTATOR`, such that the test suite wouldn't build.\n  Also, one must not unconditionally use `extern` for the global (dummy)\n  commentator since this is C++, and doing so also breaks the test suite.\n* Fix (i.e. patch) the sources such that the test suite (`make check`) builds,\n  also with GCC 4.7.0.\n* Add the \"Special Update/Build Instructions\" section.\n\n\n---\n\nSee #12751 for the GCC-4.7.0 metaticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12762\n\n",
    "closed_at": "2012-06-02T13:42:25Z",
    "created_at": "2012-03-27T18:23:13Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0.1",
    "title": "LinBox (1.1.6) fails to build with GCC 4.7.0, and lacks an `spkg-check`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12762",
    "user": "https://github.com/nexttime"
}
```
Assignee: @nexttime

CC:  @ClementPernet @williamstein mariah

Keywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5

This is due to stricter (C++11) name look-up rules in GCC 4.7.x.

I've created an spkg with a trivial fix, just adding `-fpermissive` to `CXXFLAGS` if we're using `g++` 4.7.x:

```patch
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -20,6 +20,13 @@
 export CFLAGS="$CFLAGS -g -fPIC"
 export CXXFLAGS="$CXXFLAGS -g -fPIC"
 
+case "`$CXX -dumpversion 2>/dev/null`" in
+    4.7.*)
+        echo "Adding '-fpermissive' to CXXFLAGS to make LinBox build with GCC 4.7.x."
+        echo "This is a temporary fix; LinBox currently doesn't conform to the C++11 standard."
+        CXXFLAGS="-fpermissive $CXXFLAGS" # The user might still override that.
+esac
+
 # Some systems have problems when parts of Linbox are compiled with
 # the commentator enabled and other parts with the commentator
 # disabled.  Therefore, disable it always.
```

---

**New spkg:** [http://boxen.math.washington.edu/home/jdemeyer/spkg/linbox-1.1.6.p10.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/linbox-1.1.6.p10.spkg)

### linbox-1.1.6.p10 (Jeroen Demeyer, 25 May 2012)
* #12762 review: Remove the touching of linbox.pyx, since
  Cython knows the dependency of linbox.pyx on linbox-sage.h
* Only add the -fpermissive workaround on GCC-4.7.x, not other
  compilers.

### linbox-1.1.6.p9 (Leif Leonhardy, April 7th 2012)
* #12762: Temporarily add `-fpermissive` to `CXXFLAGS` if we're compiling
  with `g++` 4.7.x, since the LinBox sources currently don't conform to
  C++11, so GCC 4.7.x would otherwise reject them.
* Exit if the build failed.
* Use `CFLAG64` if it is set (and `SAGE64=yes`).
* Clean up `spkg-install`, add some messages.
* Add an `spkg-check` file, which currently runs `make check`. (There's also
  a `fullcheck` target.)
* Change patch to disable the commentator, as default parameters were missing
  with `-DDISABLE_COMMENTATOR`, such that the test suite wouldn't build.
  Also, one must not unconditionally use `extern` for the global (dummy)
  commentator since this is C++, and doing so also breaks the test suite.
* Fix (i.e. patch) the sources such that the test suite (`make check`) builds,
  also with GCC 4.7.0.
* Add the "Special Update/Build Instructions" section.


---

See #12751 for the GCC-4.7.0 metaticket.

Issue created by migration from https://trac.sagemath.org/ticket/12762





---

archive/issue_comments_149492.json:
```json
{
    "body": "P.S.: Probably upstream has already fixed this; haven't checked.\n\nAlso *this* package has last been upgraded in June 2008; Cl\u00e9ment Pernet is listed as an spkg maintainer as well as the upstream contact.",
    "created_at": "2012-03-28T16:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149492",
    "user": "https://github.com/nexttime"
}
```

P.S.: Probably upstream has already fixed this; haven't checked.

Also *this* package has last been upgraded in June 2008; Cl√©ment Pernet is listed as an spkg maintainer as well as the upstream contact.



---

archive/issue_comments_149493.json:
```json
{
    "body": "Diff between the previous spkg in Sage and my new p8 spkg.  For reference / review only.",
    "created_at": "2012-04-07T20:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149493",
    "user": "https://github.com/nexttime"
}
```

Diff between the previous spkg in Sage and my new p8 spkg.  For reference / review only.



---

archive/issue_comments_149494.json:
```json
{
    "body": "Changing keywords from \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg\" to \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check\".",
    "created_at": "2012-04-07T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149494",
    "user": "https://github.com/nexttime"
}
```

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check".



---

archive/issue_comments_149495.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-07T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149495",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149496.json:
```json
{
    "body": "Attachment [linbox-1.1.6.p7-p8.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p7-p8.diff) by @nexttime created at 2012-04-07 20:25:52\n\nOk, changed and added a couple of things in addition, among these an `spkg-check` file, and changes to upstream code and the \"disable commentator\" patch to make the test suite build (see changelog entry in the ticket's description and the attached diff for details).\n\nNew spkg, same place, changes now committed, ready to test & review... :P",
    "created_at": "2012-04-07T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149496",
    "user": "https://github.com/nexttime"
}
```

Attachment [linbox-1.1.6.p7-p8.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p7-p8.diff) by @nexttime created at 2012-04-07 20:25:52

Ok, changed and added a couple of things in addition, among these an `spkg-check` file, and changes to upstream code and the "disable commentator" patch to make the test suite build (see changelog entry in the ticket's description and the attached diff for details).

New spkg, same place, changes now committed, ready to test & review... :P



---

archive/issue_comments_149497.json:
```json
{
    "body": "P.S.:\n\nThere's a not that recent \"stable\" LinBox version 1.1.7, as well as IIRC more recent \"instable\" 1.2.x development versions.  (Unfortunately there's [no changelog entry for the 1.1.7 version](http://linalg.org/NEWS-1.1.html), at least not online.)\n\nHaven't yet tried any of these, but upgrading -- if worthwhile -- should IMHO be done on another ticket; making the spkg build with GCC 4.7.x, adding an `spkg-check` file and making the test suite build seems more important (or urgent) to me.",
    "created_at": "2012-04-07T20:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149497",
    "user": "https://github.com/nexttime"
}
```

P.S.:

There's a not that recent "stable" LinBox version 1.1.7, as well as IIRC more recent "instable" 1.2.x development versions.  (Unfortunately there's [no changelog entry for the 1.1.7 version](http://linalg.org/NEWS-1.1.html), at least not online.)

Haven't yet tried any of these, but upgrading -- if worthwhile -- should IMHO be done on another ticket; making the spkg build with GCC 4.7.x, adding an `spkg-check` file and making the test suite build seems more important (or urgent) to me.



---

archive/issue_comments_149498.json:
```json
{
    "body": "Fedora has this patch for linbox 1.2.2 http://pkgs.fedoraproject.org/gitweb/?p=linbox.git;a=blob;f=linbox-gcc47.patch",
    "created_at": "2012-04-26T18:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149498",
    "user": "https://trac.sagemath.org/admin/accounts/users/pcpa"
}
```

Fedora has this patch for linbox 1.2.2 http://pkgs.fedoraproject.org/gitweb/?p=linbox.git;a=blob;f=linbox-gcc47.patch



---

archive/issue_comments_149499.json:
```json
{
    "body": "I tried this spkg this morning and it failed ; the compile lines lack the -fpermissive, even though I see the code in spkg-install which is supposed to add it...\n\nNotice that it was with a fairly extensively modified sage-5.0.rc1, so maybe the failure isn't that conclusive, but I still thought it was worth reporting.",
    "created_at": "2012-05-13T09:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149499",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

I tried this spkg this morning and it failed ; the compile lines lack the -fpermissive, even though I see the code in spkg-install which is supposed to add it...

Notice that it was with a fairly extensively modified sage-5.0.rc1, so maybe the failure isn't that conclusive, but I still thought it was worth reporting.



---

archive/issue_comments_149500.json:
```json
{
    "body": "I retried with a bare sage-5.0.rc1, and linbox failed.\n\nI retried with the spkg with md5sum b7a35a9927d5fc5c51f88ad3ada3df6c, and it failed.",
    "created_at": "2012-05-13T20:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149500",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

I retried with a bare sage-5.0.rc1, and linbox failed.

I retried with the spkg with md5sum b7a35a9927d5fc5c51f88ad3ada3df6c, and it failed.



---

archive/issue_comments_149501.json:
```json
{
    "body": "I noticed two things :\n1. the only directory where the current patch doesn't work is interfaces/sage/ : the rest builds ok!\n2. if there is nothing in patches/, then spkg-install errors out.\n\nI settled to fix the matter, but must admit my failure : even if I manage to get the -fpermissive through (adding directly to interfaces/sage/Makefile.am... not clean at all), the build still fails with this error :\nlinbox-sage.C:463:13: error: \u2018NTL_ZZ\u2019 was not declared in this scope",
    "created_at": "2012-05-14T13:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149501",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

I noticed two things :
1. the only directory where the current patch doesn't work is interfaces/sage/ : the rest builds ok!
2. if there is nothing in patches/, then spkg-install errors out.

I settled to fix the matter, but must admit my failure : even if I manage to get the -fpermissive through (adding directly to interfaces/sage/Makefile.am... not clean at all), the build still fails with this error :
linbox-sage.C:463:13: error: ‚ÄòNTL_ZZ‚Äô was not declared in this scope



---

archive/issue_events_034696.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-16T20:02:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12762#event-34696"
}
```



---

archive/issue_comments_149502.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T18:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149502",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149503.json:
```json
{
    "body": "In\n\n```\ncase \"`$CXX -dumpversion 2>/dev/null`\" in\n    4.7.*)\n```\nYou should check for GCC first.",
    "created_at": "2012-05-25T18:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149503",
    "user": "https://github.com/jdemeyer"
}
```

In

```
case "`$CXX -dumpversion 2>/dev/null`" in
    4.7.*)
```
You should check for GCC first.



---

archive/issue_comments_149504.json:
```json
{
    "body": "I have another idea : get in touch with upstream so the code is fixed, and update the version in sage... no more ugly workaround!",
    "created_at": "2012-05-25T18:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149504",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

I have another idea : get in touch with upstream so the code is fixed, and update the version in sage... no more ugly workaround!



---

archive/issue_comments_149505.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-26T00:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149505",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149506.json:
```json
{
    "body": "Diff between leif's p9 (a rebased p8) and my p10 spkgs. For reference / review only.",
    "created_at": "2012-05-26T00:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149506",
    "user": "https://github.com/jdemeyer"
}
```

Diff between leif's p9 (a rebased p8) and my p10 spkgs. For reference / review only.



---

archive/issue_comments_149507.json:
```json
{
    "body": "Attachment [linbox-1.1.6.p10.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p10.diff) by @jdemeyer created at 2012-05-26 00:28:54\n\nRebased leif's patch to #10281, then made some further changes.\n\nNew spkg needs review.",
    "created_at": "2012-05-26T00:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149507",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [linbox-1.1.6.p10.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p10.diff) by @jdemeyer created at 2012-05-26 00:28:54

Rebased leif's patch to #10281, then made some further changes.

New spkg needs review.



---

archive/issue_comments_149508.json:
```json
{
    "body": "Changing keywords from \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check\" to \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5\".",
    "created_at": "2012-05-26T01:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149508",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5".



---

archive/issue_comments_149509.json:
```json
{
    "body": "This installs correctly with 4.7.0 on sage.math, and then *after* using `SAGE_UPGRADING` and everything building, then *again* force installing this package and doing `sage -b` does build the correct extension modules.  Spkg is properly constructed etc., patches are applying without exiting with non-zero, etc.  Running long doctests, but I don't expect anything unusual.",
    "created_at": "2012-05-26T03:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149509",
    "user": "https://github.com/kcrisman"
}
```

This installs correctly with 4.7.0 on sage.math, and then *after* using `SAGE_UPGRADING` and everything building, then *again* force installing this package and doing `sage -b` does build the correct extension modules.  Spkg is properly constructed etc., patches are applying without exiting with non-zero, etc.  Running long doctests, but I don't expect anything unusual.



---

archive/issue_comments_149510.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-26T03:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149510",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149511.json:
```json
{
    "body": "Good to go.  Also passes tests on Mac OS X built with GCC 4.6.3, so should be ok.",
    "created_at": "2012-05-26T03:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149511",
    "user": "https://github.com/kcrisman"
}
```

Good to go.  Also passes tests on Mac OS X built with GCC 4.6.3, so should be ok.



---

archive/issue_events_034697.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-28T23:06:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12762#event-34697"
}
```



---

archive/issue_events_034698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-28T23:06:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "milestone": "sage-5.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12762#event-34698"
}
```



---

archive/issue_comments_149512.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-02T13:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12762#issuecomment-149512",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_034699.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T13:42:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12762",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12762#event-34699"
}
```
