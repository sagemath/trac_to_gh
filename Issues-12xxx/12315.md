# Issue 12315: OS X Lion: pari fails self tests

archive/issues_012143.json:
```json
{
    "assignees": [],
    "body": "On OS X Lion, if you set SAGE_CHECK=yes and build pari, some tests fail. See\n\n  [http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log](http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log)\n\nfor a log file.\n\n---\n\nNew spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg)\n\n\nCC:  @williamstein @jdemeyer @sagetrac-GeorgSWeber\n\nKeywords: **pari darwin lion osx**\n\nReviewer: **John Palmieri**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12315_\n\n",
    "closed_at": "2012-04-26T20:13:13Z",
    "created_at": "2012-01-16T17:39:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "OS X Lion: pari fails self tests",
    "type": "issue",
    "updated_at": "2012-04-26T20:13:13Z",
    "url": "https://github.com/sagemath/sage/issues/12315",
    "user": "https://github.com/jhpalmieri"
}
```
On OS X Lion, if you set SAGE_CHECK=yes and build pari, some tests fail. See

  [http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log](http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log)

for a log file.

---

New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg)


CC:  @williamstein @jdemeyer @sagetrac-GeorgSWeber

Keywords: **pari darwin lion osx**

Reviewer: **John Palmieri**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/12315_





---

archive/issue_events_168522.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-16T17:39:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168522"
}
```



---

archive/issue_events_168523.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-16T17:39:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168523"
}
```



---

archive/issue_events_168524.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-16T17:39:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168524"
}
```



---

archive/issue_events_168525.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-16T17:39:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168525"
}
```



---

archive/issue_comments_133892.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nwas pointed out [on sage-devel](https://groups.google.com/d/topic/sage-devel/j5lsn50_tN8/discussion) that with `SAGE_DEBUG=True`, self-tests pass.  So it may be a compiler error; compiling with `-O0` seems to work.  It may be just a single file (the one containing the bezout function) causing the problems.",
    "created_at": "2012-01-18T02:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133892",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

was pointed out [on sage-devel](https://groups.google.com/d/topic/sage-devel/j5lsn50_tN8/discussion) that with `SAGE_DEBUG=True`, self-tests pass.  So it may be a compiler error; compiling with `-O0` seems to work.  It may be just a single file (the one containing the bezout function) causing the problems.



---

archive/issue_comments_133893.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAn exchange on #11881 about this.\n> > I am currently at the PARI atelier and we're discussing OS X Lion. Essentially the PARI developers are saying that Apple's compiler is completely broken and that the Only Right Solution is to install a real compiler, i.e. gcc.\n> > So maybe the best solution in practice for Sage is to add a check in prereq that users aren't using Apple's broken compiler.  \n\n> ?  So that no one using \"just Xcode\" can build Sage?  I'm a little unclear on what would have to change for ordinary users.\n> > Also we should have one server machine running Lion with a good compiler to build binaries.\n\n> Certainly.\n> jhpalmieri points out on #12315 (where these comments should probably live anyway)\n> > was pointed out  on sage-devel that with SAGE_DEBUG=True, self-tests pass. So it may be a compiler error; compiling with -O0 seems to work. It may be just a single file (the one containing the bezout function) causing the problems.\n\n> So perhaps a workaround would be to check for the \"bad\" compiler in the spkg-install somehow and then do no optimization if that's the case.  Power users who need Pari optimized would be expected to have the technical know-how to use the right one, and as you say the binary builder could have this as well.",
    "created_at": "2012-01-26T13:19:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133893",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

An exchange on #11881 about this.
> > I am currently at the PARI atelier and we're discussing OS X Lion. Essentially the PARI developers are saying that Apple's compiler is completely broken and that the Only Right Solution is to install a real compiler, i.e. gcc.
> > So maybe the best solution in practice for Sage is to add a check in prereq that users aren't using Apple's broken compiler.  

> ?  So that no one using "just Xcode" can build Sage?  I'm a little unclear on what would have to change for ordinary users.
> > Also we should have one server machine running Lion with a good compiler to build binaries.

> Certainly.
> jhpalmieri points out on #12315 (where these comments should probably live anyway)
> > was pointed out  on sage-devel that with SAGE_DEBUG=True, self-tests pass. So it may be a compiler error; compiling with -O0 seems to work. It may be just a single file (the one containing the bezout function) causing the problems.

> So perhaps a workaround would be to check for the "bad" compiler in the spkg-install somehow and then do no optimization if that's the case.  Power users who need Pari optimized would be expected to have the technical know-how to use the right one, and as you say the binary builder could have this as well.



---

archive/issue_comments_133894.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAnother datapoint, from [here](https://github.com/sagemath/sage/issues/11881#comment:23):\n> I took sage-4.8.alpha0, added in the spkg's from the various tickets here, including the Python spkg from #11967, and built Sage with SAGE_CHECK=yes. Tests failed for the Python spkg, as usual, but they passed for PARI.\n\nWas Pari upgraded in the meantime? I assume so.",
    "created_at": "2012-01-26T14:20:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133894",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Another datapoint, from [here](https://github.com/sagemath/sage/issues/11881#comment:23):
> I took sage-4.8.alpha0, added in the spkg's from the various tickets here, including the Python spkg from #11967, and built Sage with SAGE_CHECK=yes. Tests failed for the Python spkg, as usual, but they passed for PARI.

Was Pari upgraded in the meantime? I assume so.



---

archive/issue_comments_133895.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@kcrisman](#comment:3):\n> Another datapoint, from [here](https://github.com/sagemath/sage/issues/11881#comment:23):\n> > I took sage-4.8.alpha0, added in the spkg's from the various tickets here, including the Python spkg from #11967, and built Sage with SAGE_CHECK=yes. Tests failed for the Python spkg, as usual, but they passed for PARI.\n\nI've been unable to reproduce that, so I don't know how I got Pari's self-tests to pass that one time.\n\nIt seems to me that our current viable choices are\n\n1. Test whether the platform is Lion, and if so, turn off optimization.  (Using `-O0` should work; I don't know about `-O1`, but I'm testing that now.)\n\n2. Test whether the platform is Lion, and if so, turn off optimization for the single file causing problems.\n\n3. Test whether the platform is Lion and the compiler is a bad one (I'm not sure what qualifies beyond the current GCC/LLVM thing in !XCode), and if so, turn off optimization.\n\nI can prepare an spkg doing the first of these, but I'm not sure about how to do #2 the right way, and I don't know enough about which compiler(s) are bad and which are good to do #3.",
    "created_at": "2012-01-26T17:08:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133895",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@kcrisman](#comment:3):
> Another datapoint, from [here](https://github.com/sagemath/sage/issues/11881#comment:23):
> > I took sage-4.8.alpha0, added in the spkg's from the various tickets here, including the Python spkg from #11967, and built Sage with SAGE_CHECK=yes. Tests failed for the Python spkg, as usual, but they passed for PARI.

I've been unable to reproduce that, so I don't know how I got Pari's self-tests to pass that one time.

It seems to me that our current viable choices are

1. Test whether the platform is Lion, and if so, turn off optimization.  (Using `-O0` should work; I don't know about `-O1`, but I'm testing that now.)

2. Test whether the platform is Lion, and if so, turn off optimization for the single file causing problems.

3. Test whether the platform is Lion and the compiler is a bad one (I'm not sure what qualifies beyond the current GCC/LLVM thing in !XCode), and if so, turn off optimization.

I can prepare an spkg doing the first of these, but I'm not sure about how to do #2 the right way, and I don't know enough about which compiler(s) are bad and which are good to do #3.



---

archive/issue_comments_133896.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis should be coordinated with #12363, but go ahead.  I would prefer option 3. to option 1.  Could you not simply blacklist the default compiler on OS X 10.7?",
    "created_at": "2012-01-26T17:18:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133896",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

This should be coordinated with #12363, but go ahead.  I would prefer option 3. to option 1.  Could you not simply blacklist the default compiler on OS X 10.7?



---

archive/issue_comments_133897.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n> Could you not simply blacklist the default compiler on OS X 10.7?\n\nCf: William's recent comment on #11881 about whether he wants to do so on Lion:\n> > Power users who need Pari optimized would be expected to have the technical know-how to use the right one,\n\n> I'm such a user and I don't want to have to build GCC from source.\n\nIt's pretty painful to deal with anything else on OS X.  We couldn't even really use the fink or macports gcc, because we currently require people to rename or remove from their path anything in /sw.",
    "created_at": "2012-01-26T17:32:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133897",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">comment:6</div>

> Could you not simply blacklist the default compiler on OS X 10.7?

Cf: William's recent comment on #11881 about whether he wants to do so on Lion:
> > Power users who need Pari optimized would be expected to have the technical know-how to use the right one,

> I'm such a user and I don't want to have to build GCC from source.

It's pretty painful to deal with anything else on OS X.  We couldn't even really use the fink or macports gcc, because we currently require people to rename or remove from their path anything in /sw.



---

archive/issue_comments_133898.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@kcrisman](#comment:6):\n> > Could you not simply blacklist the default compiler on OS X 10.7?\n\n> Cf: William's recent comment on #11881 about whether he wants to do so on Lion:\n> > > Power users who need Pari optimized would be expected to have the technical know-how to use the right one,\n\n> > I'm such a user and I don't want to have to build GCC from source.\n\n> It's pretty painful to deal with anything else on OS X.  We couldn't even really use the fink or macports gcc, because we currently require people to rename or remove from their path anything in /sw.\n\nUnless we create an spkg \"gcc\" which works properly with Sage.  I noticed somebody made an experimental package \"gcc\" but I haven't tried it.",
    "created_at": "2012-01-26T17:48:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133898",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@kcrisman](#comment:6):
> > Could you not simply blacklist the default compiler on OS X 10.7?

> Cf: William's recent comment on #11881 about whether he wants to do so on Lion:
> > > Power users who need Pari optimized would be expected to have the technical know-how to use the right one,

> > I'm such a user and I don't want to have to build GCC from source.

> It's pretty painful to deal with anything else on OS X.  We couldn't even really use the fink or macports gcc, because we currently require people to rename or remove from their path anything in /sw.

Unless we create an spkg "gcc" which works properly with Sage.  I noticed somebody made an experimental package "gcc" but I haven't tried it.



---

archive/issue_comments_133899.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nIf the problem is a single file, the file [should be](http://pari.math.u-bordeaux.fr/archives/pari-dev-1108/msg00007.html) `src/src/kernel/none/gcdll.c`.  I tried compiling just that file with `-O0`, but I still got self test failures -- not as many, but a few:\n\n```\nell-sta.dif\nell.dyn.dif\n```\nTo build this way, I patched the file `src/src/kernel/gmp/MakeLVL1.SH`, adding in the `-O0` flag.\n\nFor what it's worth, on this particular machine, it took about 19 minutes to run self tests after compiling all of Pari with `-O0`, and it took about 15 minutes compiling most with `-O3` and just the one file with `-O0`.",
    "created_at": "2012-01-26T19:49:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133899",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

If the problem is a single file, the file [should be](http://pari.math.u-bordeaux.fr/archives/pari-dev-1108/msg00007.html) `src/src/kernel/none/gcdll.c`.  I tried compiling just that file with `-O0`, but I still got self test failures -- not as many, but a few:

```
ell-sta.dif
ell.dyn.dif
```
To build this way, I patched the file `src/src/kernel/gmp/MakeLVL1.SH`, adding in the `-O0` flag.

For what it's worth, on this particular machine, it took about 19 minutes to run self tests after compiling all of Pari with `-O0`, and it took about 15 minutes compiling most with `-O3` and just the one file with `-O0`.



---

archive/issue_comments_133900.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nPlease post the file `ell-sta.dif` (it should be inside `Odarwin-*` in the pari build directory).",
    "created_at": "2012-01-26T19:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133900",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Please post the file `ell-sta.dif` (it should be inside `Odarwin-*` in the pari build directory).



---

archive/issue_comments_133901.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jdemeyer](#comment:5):\n> This should be coordinated with #12363, but go ahead.  I would prefer option 3.\n>  to option 1.  Could you not simply blacklist the default compiler on OS X 10.7?\n\nI consider option 3 a total non-option unless there is a fully working alternative GCC spkg available.   If there were, that would be the way to go.  I posted to sage-devel to see if anybody has something like this.\n\nI prefer option 2 by far, along with reporting the bugs to APPLE.  Then just turn off 2 once the bug is fixed (but of course don't just build broken sage's by people who haven't upgraded yet).",
    "created_at": "2012-01-26T20:45:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133901",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jdemeyer](#comment:5):
> This should be coordinated with #12363, but go ahead.  I would prefer option 3.
>  to option 1.  Could you not simply blacklist the default compiler on OS X 10.7?

I consider option 3 a total non-option unless there is a fully working alternative GCC spkg available.   If there were, that would be the way to go.  I posted to sage-devel to see if anybody has something like this.

I prefer option 2 by far, along with reporting the bugs to APPLE.  Then just turn off 2 once the bug is fixed (but of course don't just build broken sage's by people who haven't upgraded yet).



---

archive/issue_comments_133902.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSince the file is small, I'm attaching `ell-sta.dif`.",
    "created_at": "2012-01-26T20:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133902",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

Since the file is small, I'm attaching `ell-sta.dif`.



---

archive/issue_comments_133903.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,8 @@\n   [http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log](http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log)\n \n for a log file.\n+\n+---\n+\n+New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg)\n+\n``````\n",
    "created_at": "2012-01-26T22:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133903",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,8 @@
   [http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log](http://sage.math.washington.edu/home/palmieri/misc/pari-2.5.0.p3.log)
 
 for a log file.
+
+---
+
+New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg)
+
``````




---

archive/issue_events_168526.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-26T22:44:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168526"
}
```



---

archive/issue_comments_133904.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAttachment: **[ell-sta.dif.gz](https://github.com/sagemath/sage/files/ticket12315/ell-sta.dif.gz)**\n\nOkay, nailed it.  On OS X Lion, 'gcc' is a symbolic link to '/usr/bin/llvm-gcc-4.2', but '/usr/bin/gcc-4.2' is a plain version of gcc.  So if, when building Pari, we do `export CC=gcc-4.2`, then self-tests pass when building with standard (`-O3`) optimization.  So we have an easy solution, but it leads to several questions:\n\n- Is the version of OS X (Lion vs. Snow Leopard) important, or is it only the version of XCode?  That is, should we just test whether 'LLVM' is in the output from `gcc --version` (or perhaps something more refined, like 'LLVM' is in the output from `gcc --version` and gcc is version 4.2.1, or `gcc --version` contains the string \"LLVM build 2.335.15.00\")?\n\n- Should we make this change only for Pari, or should we do this when building all of Sage?  I have a feeling we do it on a case-by-case basis, since I think that not all spkgs respect the CC variable.  I tried it with cvxopt (see #12011), and it didn't seem to help, but it's worth exploring more...\n\nI've posted an spkg which tests whether we're using an 'LLVM' version of gcc 4.2.1.",
    "created_at": "2012-01-26T22:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133904",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Attachment: **[ell-sta.dif.gz](https://github.com/sagemath/sage/files/ticket12315/ell-sta.dif.gz)**

Okay, nailed it.  On OS X Lion, 'gcc' is a symbolic link to '/usr/bin/llvm-gcc-4.2', but '/usr/bin/gcc-4.2' is a plain version of gcc.  So if, when building Pari, we do `export CC=gcc-4.2`, then self-tests pass when building with standard (`-O3`) optimization.  So we have an easy solution, but it leads to several questions:

- Is the version of OS X (Lion vs. Snow Leopard) important, or is it only the version of XCode?  That is, should we just test whether 'LLVM' is in the output from `gcc --version` (or perhaps something more refined, like 'LLVM' is in the output from `gcc --version` and gcc is version 4.2.1, or `gcc --version` contains the string "LLVM build 2.335.15.00")?

- Should we make this change only for Pari, or should we do this when building all of Sage?  I have a feeling we do it on a case-by-case basis, since I think that not all spkgs respect the CC variable.  I tried it with cvxopt (see #12011), and it didn't seem to help, but it's worth exploring more...

I've posted an spkg which tests whether we're using an 'LLVM' version of gcc 4.2.1.



---

archive/issue_comments_133905.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nNICE!!!\n\nCould you look into symmetrica too?   \n\nNICE!!!",
    "created_at": "2012-01-26T22:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133905",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:13" align="right">comment:13</div>

NICE!!!

Could you look into symmetrica too?   

NICE!!!



---

archive/issue_comments_133906.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nSure, I'll try.  Is the problem with symmetrica only revealed by failed Sage doctests?  (I don't see a ticket for symmetrica on Lion at #11881).",
    "created_at": "2012-01-26T23:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133906",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:14" align="right">comment:14</div>

Sure, I'll try.  Is the problem with symmetrica only revealed by failed Sage doctests?  (I don't see a ticket for symmetrica on Lion at #11881).



---

archive/issue_comments_133907.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jhpalmieri](#comment:14):\n> Sure, I'll try.  Is the problem with symmetrica only revealed by failed Sage doctests?\n\nYes.",
    "created_at": "2012-01-26T23:11:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133907",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jhpalmieri](#comment:14):
> Sure, I'll try.  Is the problem with symmetrica only revealed by failed Sage doctests?

Yes.



---

archive/issue_comments_133908.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nGreat work, jhpalmieri.  Question: is there any (tiny) chance that the '/usr/bin/gcc-4.2' is a leftover from a previous Xcode you had on this machine?  It would be good to test this on a machine that has only had Xcode 4 and Lion on it.",
    "created_at": "2012-01-27T01:51:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133908",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:16" align="right">comment:16</div>

Great work, jhpalmieri.  Question: is there any (tiny) chance that the '/usr/bin/gcc-4.2' is a leftover from a previous Xcode you had on this machine?  It would be good to test this on a machine that has only had Xcode 4 and Lion on it.



---

archive/issue_comments_133909.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@kcrisman](#comment:16):\n> Great work, jhpalmieri.  Question: is there any (tiny) chance that the '/usr/bin/gcc-4.2' is a leftover from a previous Xcode you had on this machine?  It would be good to test this on a machine that has only had Xcode 4 and Lion on it.\n\nI think there is a tiny chance, but all of these different versions of gcc (gcc-4.2, llvm-gcc-4.2, etc) have the same modification date, so I think they all came from XCode 4.\n\nMeanwhile, I'm having problems which I'm trying to track down: with sage-5.0.prealpha1, I get no test failures with this Pari spkg.  With sage-5.0.beta1, I get a few test failures.  I'm not sure what the difference is, though.  Maybe the termcap spkg?",
    "created_at": "2012-01-27T05:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133909",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@kcrisman](#comment:16):
> Great work, jhpalmieri.  Question: is there any (tiny) chance that the '/usr/bin/gcc-4.2' is a leftover from a previous Xcode you had on this machine?  It would be good to test this on a machine that has only had Xcode 4 and Lion on it.

I think there is a tiny chance, but all of these different versions of gcc (gcc-4.2, llvm-gcc-4.2, etc) have the same modification date, so I think they all came from XCode 4.

Meanwhile, I'm having problems which I'm trying to track down: with sage-5.0.prealpha1, I get no test failures with this Pari spkg.  With sage-5.0.beta1, I get a few test failures.  I'm not sure what the difference is, though.  Maybe the termcap spkg?



---

archive/issue_comments_133910.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n> > Great work, jhpalmieri.  Question: is there any (tiny) chance that the '/usr/bin/gcc-4.2' is a leftover from a previous Xcode you had on this machine?  It would be good to test this on a machine that has only had Xcode 4 and Lion on it.\n\n> \n> I think there is a tiny chance, but all of these different versions of gcc (gcc-4.2, llvm-gcc-4.2, etc) have the same modification date, so I think they all came from XCode 4.\n\nHmm, but see [Georg's post](http://groups.google.com/group/sage-devel/browse_thread/thread/d9a00d4bb84474c4/f88220b8e72e5b12?show_docid=f88220b8e72e5b12) about this on sage-devel:\n\n```\nStay with the old \"FSF-flavor\" Apple version of gcc v4.2.1 \"build \n5666.3\", as has been included in XCode 3.2.6, 4.0. and 4.1 (but no \nlonger from 4.2 onwards), and that gcc42 package. \n```\nSo maybe this will go away, and we might not want to rely on it.",
    "created_at": "2012-01-27T15:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133910",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">comment:18</div>

> > Great work, jhpalmieri.  Question: is there any (tiny) chance that the '/usr/bin/gcc-4.2' is a leftover from a previous Xcode you had on this machine?  It would be good to test this on a machine that has only had Xcode 4 and Lion on it.

> 
> I think there is a tiny chance, but all of these different versions of gcc (gcc-4.2, llvm-gcc-4.2, etc) have the same modification date, so I think they all came from XCode 4.

Hmm, but see [Georg's post](http://groups.google.com/group/sage-devel/browse_thread/thread/d9a00d4bb84474c4/f88220b8e72e5b12?show_docid=f88220b8e72e5b12) about this on sage-devel:

```
Stay with the old "FSF-flavor" Apple version of gcc v4.2.1 "build 
5666.3", as has been included in XCode 3.2.6, 4.0. and 4.1 (but no 
longer from 4.2 onwards), and that gcc42 package. 
```
So maybe this will go away, and we might not want to rely on it.



---

archive/issue_comments_133911.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOkay, at least I've figured out the problem with test failures: I based my spkg on a prerelease version of 2.5.1 (from #12363), and the installation process wasn't installing all of the required data files.  This was making tests fail.  In the prealpha1 installation, I must have installed an earlier version of Pari (without SAGE_CHECK set), so it had installed the data earlier.\n\nNow I'm working on a different spkg based on the old version of Pari, and things are looking good.",
    "created_at": "2012-01-28T03:38:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133911",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Okay, at least I've figured out the problem with test failures: I based my spkg on a prerelease version of 2.5.1 (from #12363), and the installation process wasn't installing all of the required data files.  This was making tests fail.  In the prealpha1 installation, I must have installed an earlier version of Pari (without SAGE_CHECK set), so it had installed the data earlier.

Now I'm working on a different spkg based on the old version of Pari, and things are looking good.



---

archive/issue_comments_133912.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\n(The posted spkg is broken because I used an incomplete tar ball.  Once the spkg at #12363 is in good shape -- it's too big right now -- I'll post a new one based on that.)",
    "created_at": "2012-01-28T03:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133912",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:20" align="right">comment:20</div>

(The posted spkg is broken because I used an incomplete tar ball.  Once the spkg at #12363 is in good shape -- it's too big right now -- I'll post a new one based on that.)



---

archive/issue_events_168527.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T03:53:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168527"
}
```



---

archive/issue_events_168528.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T03:53:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168528"
}
```



---

archive/issue_comments_133913.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nHere's a new spkg, based on the old version of Pari.  This gives us something to test with on Lion.  If it works and if we're happy with the solution, the patch here should be easy to merge with the spkg at #12363.\n\nI'm not what to do about the possible lack of gcc-4.2 in newer versions of XCode.  I can't find any verification of Georg's statement about this.",
    "created_at": "2012-01-28T04:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133913",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:21" align="right">comment:21</div>

Here's a new spkg, based on the old version of Pari.  This gives us something to test with on Lion.  If it works and if we're happy with the solution, the patch here should be easy to merge with the spkg at #12363.

I'm not what to do about the possible lack of gcc-4.2 in newer versions of XCode.  I can't find any verification of Georg's statement about this.



---

archive/issue_events_168529.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T04:39:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168529"
}
```



---

archive/issue_events_168530.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T04:39:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168530"
}
```



---

archive/issue_comments_133914.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,5 +6,5 @@\n \n ---\n \n-New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg)\n+New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg)\n \n``````\n",
    "created_at": "2012-01-28T04:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133914",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,5 +6,5 @@
 
 ---
 
-New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.1.p0.spkg)
+New spkg: [http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg](http://sage.math.washington.edu/home/palmieri/SPKG/pari-2.5.0.p4.spkg)
 
``````




---

archive/issue_comments_133915.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nBy the way, I tried\n\n```\nCC=clang  # instead of gcc-4.2\nexport CC\n```\nbut spkg-check had lots of failures.",
    "created_at": "2012-01-28T17:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133915",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

By the way, I tried

```
CC=clang  # instead of gcc-4.2
export CC
```
but spkg-check had lots of failures.



---

archive/issue_comments_133916.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nMaybe I messed up last time, but using clang is working for me now.  Since clang is part of XCode 4, it is guaranteed to be there (as opposed to gcc-4.2).  Using clang with the standard CFLAGS is presumably faster than using the default compiler with optimization turned off.\n\nSo I've updated the spkg to use clang.",
    "created_at": "2012-02-04T06:19:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133916",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

Maybe I messed up last time, but using clang is working for me now.  Since clang is part of XCode 4, it is guaranteed to be there (as opposed to gcc-4.2).  Using clang with the standard CFLAGS is presumably faster than using the default compiler with optimization turned off.

So I've updated the spkg to use clang.



---

archive/issue_comments_133917.json:
```json
{
    "body": "patch for pari spkg; for reference only",
    "created_at": "2012-02-05T16:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133917",
    "user": "https://github.com/jhpalmieri"
}
```

patch for pari spkg; for reference only



---

archive/issue_comments_133918.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nAttachment: **[trac_12315-pari.patch.gz](https://github.com/sagemath/sage/files/ticket12315/trac_12315-pari.patch.gz)**\n\nSince PARI-2.5.0 doesn't work with gcc-4.6.2 on OS X, but PARI-2.5.1 (#12363) does work, you might want to work with the new PARI.",
    "created_at": "2012-02-08T07:51:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133918",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Attachment: **[trac_12315-pari.patch.gz](https://github.com/sagemath/sage/files/ticket12315/trac_12315-pari.patch.gz)**

Since PARI-2.5.0 doesn't work with gcc-4.6.2 on OS X, but PARI-2.5.1 (#12363) does work, you might want to work with the new PARI.



---

archive/issue_comments_133919.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI think this ticket should be closed, since the Pari issues are taken care of via #12369.",
    "created_at": "2012-04-21T17:21:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133919",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

I think this ticket should be closed, since the Pari issues are taken care of via #12369.



---

archive/issue_events_168531.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-21T17:21:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168531"
}
```



---

archive/issue_events_168532.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-21T17:21:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168532"
}
```



---

archive/issue_events_168533.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-21T17:21:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168533"
}
```



---

archive/issue_events_168534.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-21T17:21:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168534"
}
```



---

archive/issue_events_168535.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-04-21T17:21:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168535"
}
```



---

archive/issue_events_168536.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-26T20:13:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168536"
}
```



---

archive/issue_events_168537.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-26T20:13:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168537"
}
```



---

archive/issue_comments_133920.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2012-04-26T20:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12315#issuecomment-133920",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_168538.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-26T20:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12315",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12315#event-168538"
}
```
