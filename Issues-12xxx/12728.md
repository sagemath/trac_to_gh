# Issue 12728: sage's spkg sources should use correct include paths instead of having ../../../../whatever everywhere

archive/issues_012556.json:
```json
{
    "body": "**Problem**\n\nThere are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n\n**Solution**\nThose should be removed, and the right path added to the include line.\n\n\nThe first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.\n\nApply \n* [attachment:trac_12728_5.10.beta4_auto.patch]\n* [attachment:trac_12728_5.10.beta4_hand.patch]\n* [attachment:trac_12728_docbuild_workaround.patch]\n\nAssignee: Snark\n\nReviewer: Volker Braun, Jeroen Demeyer, Julien Puydt\n\nAuthor: Julien Puydt\n\nMerged: sage-5.10.beta5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12728\n\n",
    "closed_at": "2013-05-24T09:39:55Z",
    "created_at": "2012-03-22T13:46:46Z",
    "labels": [
        "component: build",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "sage's spkg sources should use correct include paths instead of having ../../../../whatever everywhere",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12728",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
**Problem**

There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).

**Solution**
Those should be removed, and the right path added to the include line.


The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.

Apply 
* [attachment:trac_12728_5.10.beta4_auto.patch]
* [attachment:trac_12728_5.10.beta4_hand.patch]
* [attachment:trac_12728_docbuild_workaround.patch]

Assignee: Snark

Reviewer: Volker Braun, Jeroen Demeyer, Julien Puydt

Author: Julien Puydt

Merged: sage-5.10.beta5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12728





---

archive/issue_comments_184454.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-24T08:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184454",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_184455.json:
```json
{
    "body": "<a id='comment:2'></a>I don't like [attachment:compile_with_no_up_in_includes.patch].  I would prefer the patch to add only `SAGE_ROOT/devel/sage` and not all those other directories.",
    "created_at": "2012-04-02T09:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184455",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>I don't like [attachment:compile_with_no_up_in_includes.patch].  I would prefer the patch to add only `SAGE_ROOT/devel/sage` and not all those other directories.



---

archive/issue_comments_184456.json:
```json
{
    "body": "<a id='comment:3'></a>There are two problems with \"../../../../..\" :\n1. it doesn't give any serious information, so why is it here?\n2. the code is supposed to provide features ; it shouldn't worry about building.\n\nIt's better to have the build system provide ten \"-I\" flags than having a thousand places in the code where those ten paths are engraved, for maintainability reasons.",
    "created_at": "2012-04-02T10:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184456",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:3'></a>There are two problems with "../../../../.." :
1. it doesn't give any serious information, so why is it here?
2. the code is supposed to provide features ; it shouldn't worry about building.

It's better to have the build system provide ten "-I" flags than having a thousand places in the code where those ten paths are engraved, for maintainability reasons.



---

archive/issue_comments_184457.json:
```json
{
    "body": "<a id='comment:4'></a>Please fill in your real name as Author.",
    "created_at": "2012-07-27T20:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184457",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Please fill in your real name as Author.



---

archive/issue_comments_184458.json:
```json
{
    "body": "Changing author from \"\" to \"Julien Puydt\"",
    "created_at": "2012-08-06T13:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184458",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing author from "" to "Julien Puydt"



---

archive/issue_comments_184459.json:
```json
{
    "body": "<a id='comment:6'></a>Some dedication here. The second patch at least will need rebasing against at least 5.2. I am not sure you should add all these paths to CYTHON_INCLUDE_DIRS. Is there a reason why they are not in their own variable. Do you need all these and not just SAGE_ROOT + '/devel/sage/sage/'?",
    "created_at": "2012-08-08T11:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184459",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>Some dedication here. The second patch at least will need rebasing against at least 5.2. I am not sure you should add all these paths to CYTHON_INCLUDE_DIRS. Is there a reason why they are not in their own variable. Do you need all these and not just SAGE_ROOT + '/devel/sage/sage/'?



---

archive/issue_comments_184460.json:
```json
{
    "body": "<a id='comment:7'></a>Yes, it's now old and deprecated. And yes, I think it was needed to add all those paths.\n\nI plan to rework on the matter differently -- the question is when. The plan would be to have some script with a list of the included headers with their full paths and their wanted path, which would normalize the paths in includes. That might still require changing CYTHON_INCLUDE_DIRS, but hopefully adding less paths.",
    "created_at": "2012-08-08T12:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184460",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:7'></a>Yes, it's now old and deprecated. And yes, I think it was needed to add all those paths.

I plan to rework on the matter differently -- the question is when. The plan would be to have some script with a list of the included headers with their full paths and their wanted path, which would normalize the paths in includes. That might still require changing CYTHON_INCLUDE_DIRS, but hopefully adding less paths.



---

archive/issue_comments_184461.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-08T12:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184461",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_184462.json:
```json
{
    "body": "<a id='comment:9'></a>On Sage-devel, you reported that by changing the include paths the answers to some doctest in sage.misc.sageinspect changed. I'll see where that comes from, but I guess sageinspect needs a fix concerning temporary Cython code anyway.",
    "created_at": "2013-01-06T12:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184462",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>On Sage-devel, you reported that by changing the include paths the answers to some doctest in sage.misc.sageinspect changed. I'll see where that comes from, but I guess sageinspect needs a fix concerning temporary Cython code anyway.



---

archive/issue_comments_184463.json:
```json
{
    "body": "<a id='comment:10'></a>See #13916.",
    "created_at": "2013-01-06T12:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184463",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>See #13916.



---

archive/issue_comments_184464.json:
```json
{
    "body": "<a id='comment:11'></a>That shell script has a bug where everything before stdsage.pxi might get eaten -- that is the reason why there's a failing doctest. Not ready for review yet :-P",
    "created_at": "2013-01-06T15:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184464",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:11'></a>That shell script has a bug where everything before stdsage.pxi might get eaten -- that is the reason why there's a failing doctest. Not ready for review yet :-P



---

archive/issue_comments_184465.json:
```json
{
    "body": "Attachment [updirectories-sed.sh](tarball://root/attachments/some-uuid/ticket12728/updirectories-sed.sh) by Snark created at 2013-01-06 20:07:45\n\nShell script which patches 99,99% of the issues",
    "created_at": "2013-01-06T20:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184465",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Attachment [updirectories-sed.sh](tarball://root/attachments/some-uuid/ticket12728/updirectories-sed.sh) by Snark created at 2013-01-06 20:07:45

Shell script which patches 99,99% of the issues



---

archive/issue_comments_184466.json:
```json
{
    "body": "<a id='comment:12'></a>Ok, the new version of the updirectories-sed shell script passes all doctests: it needs review. It won't fix 100% of the problem, but the rest can be patched by hand, at it concerns only a handful of cases.",
    "created_at": "2013-01-07T07:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184466",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:12'></a>Ok, the new version of the updirectories-sed shell script passes all doctests: it needs review. It won't fix 100% of the problem, but the rest can be patched by hand, at it concerns only a handful of cases.



---

archive/issue_comments_184467.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-07T07:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184467",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_184468.json:
```json
{
    "body": "<a id='comment:13'></a>Please make it clear what should be applied.",
    "created_at": "2013-01-12T22:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184468",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>Please make it clear what should be applied.



---

archive/issue_comments_184469.json:
```json
{
    "body": "<a id='comment:14'></a>The updirectories-sed.sh shell script needs to be reviewed:\n1. read ;\n2. run (from the right directory) ;\n3. compile ;\n4. make ptestlong ;\n5. report success (very likely) or failure (very unlikely).",
    "created_at": "2013-01-13T10:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184469",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:14'></a>The updirectories-sed.sh shell script needs to be reviewed:
1. read ;
2. run (from the right directory) ;
3. compile ;
4. make ptestlong ;
5. report success (very likely) or failure (very unlikely).



---

archive/issue_comments_184470.json:
```json
{
    "body": "<a id='comment:15'></a>I think that's not how we want to proceed hence, Jeroen's question. Having the script is nice for testing but once you have run it you should generate a patch with mercurial and post it here for inclusion. \nThe script is nice for stuff that will be included in the future... there is a ticket somewhere where someone is making a similar mess - I didn't have the heart to shoot him early.",
    "created_at": "2013-01-13T10:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184470",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>I think that's not how we want to proceed hence, Jeroen's question. Having the script is nice for testing but once you have run it you should generate a patch with mercurial and post it here for inclusion. 
The script is nice for stuff that will be included in the future... there is a ticket somewhere where someone is making a similar mess - I didn't have the heart to shoot him early.



---

archive/issue_comments_184471.json:
```json
{
    "body": "<a id='comment:16'></a>I'll generate an mercurial patch if that is what you want. It will be thousands of lines long, but if you prefer to review that... every taste is in nature.",
    "created_at": "2013-01-13T10:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184471",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:16'></a>I'll generate an mercurial patch if that is what you want. It will be thousands of lines long, but if you prefer to review that... every taste is in nature.



---

archive/issue_comments_184472.json:
```json
{
    "body": "<a id='comment:17'></a>Size of the patch is just a technical problem. It just makes it harder to find a problem if there is any but no more so than with just applying your script.",
    "created_at": "2013-01-13T10:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184472",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>Size of the patch is just a technical problem. It just makes it harder to find a problem if there is any but no more so than with just applying your script.



---

archive/issue_comments_184473.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 Snark]:\n> I'll generate an mercurial patch if that is what you want.\n\nNo, that's not needed.  But you should really explain **in the ticket description** which patches should be applied/which scripts should be run.  From the previous ticket description, it was a absolutely totally utterly completely not clear that the script should be run instead of applying any patches.",
    "created_at": "2013-01-13T10:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184473",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>Replying to [comment:16 Snark]:
> I'll generate an mercurial patch if that is what you want.

No, that's not needed.  But you should really explain **in the ticket description** which patches should be applied/which scripts should be run.  From the previous ticket description, it was a absolutely totally utterly completely not clear that the script should be run instead of applying any patches.



---

archive/issue_comments_184474.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,9 +1,14 @@\n There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n \n-Those should be removed, and the right path added to the include\n-line.\n+Those should be removed, and the right path added to the include line.\n \n-I'll work on it in the coming days ; this ticket is so I can be pestered about it if I have no patch ready soon enough.\n+**Run**:\n+\n+```\n+cd \"$SAGE_ROOT/devel/sage/sage\"\n+source updirectories-sed.sh\n+hg commit -m \"Trac #12728: Update include directories\"\n+```\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-01-13T10:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184474",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,9 +1,14 @@
 There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
 
-Those should be removed, and the right path added to the include
-line.
+Those should be removed, and the right path added to the include line.
 
-I'll work on it in the coming days ; this ticket is so I can be pestered about it if I have no patch ready soon enough.
+**Run**:
+
+```
+cd "$SAGE_ROOT/devel/sage/sage"
+source updirectories-sed.sh
+hg commit -m "Trac #12728: Update include directories"
+```
 
 Comment: 1
 
``````




---

archive/issue_comments_184475.json:
```json
{
    "body": "<a id='comment:19'></a>I don't like editing the ticket description because that breaks the flow of comments. And notice that running the shell script fixes a huge percentage of the updirectory includes, but doesn't fix them all : I'll still need to hand-edit the remaining ones afterwards.",
    "created_at": "2013-01-13T11:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184475",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:19'></a>I don't like editing the ticket description because that breaks the flow of comments. And notice that running the shell script fixes a huge percentage of the updirectory includes, but doesn't fix them all : I'll still need to hand-edit the remaining ones afterwards.



---

archive/issue_comments_184476.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 Snark]:\n> I don't like editing the ticket description because that breaks the flow of comments.\n\nSo you expect the release manager to read **all the comments** in **every** ticket just to know which patches should be applied?  That's not going to happen.\n\nAnd even from reading the comments, it's not that clear that the shell script replaces the usual patch.",
    "created_at": "2013-01-13T11:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184476",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 Snark]:
> I don't like editing the ticket description because that breaks the flow of comments.

So you expect the release manager to read **all the comments** in **every** ticket just to know which patches should be applied?  That's not going to happen.

And even from reading the comments, it's not that clear that the shell script replaces the usual patch.



---

archive/issue_comments_184477.json:
```json
{
    "body": "<a id='comment:21'></a>You rejected the patches, but trac doesn't allow to mark them as rejected as far as I know... so they still sit there, unfortunately.",
    "created_at": "2013-01-13T12:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184477",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:21'></a>You rejected the patches, but trac doesn't allow to mark them as rejected as far as I know... so they still sit there, unfortunately.



---

archive/issue_comments_184478.json:
```json
{
    "body": "Patch created applying the script agains 5.10.beta3",
    "created_at": "2013-05-18T11:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184478",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Patch created applying the script agains 5.10.beta3



---

archive/issue_comments_184479.json:
```json
{
    "body": "<a id='comment:22'></a>Attachment [trac_12728_5.10.beta3.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta3.patch) by Snark created at 2013-05-18 11:46:25\n\nOk, I applied the script on sage 5.10.beta3 ; it doesn't make new doctests fail (the quadratic forms code doesn't work correctly on this box anyway).",
    "created_at": "2013-05-18T11:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184479",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:22'></a>Attachment [trac_12728_5.10.beta3.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta3.patch) by Snark created at 2013-05-18 11:46:25

Ok, I applied the script on sage 5.10.beta3 ; it doesn't make new doctests fail (the quadratic forms code doesn't work correctly on this box anyway).



---

archive/issue_comments_184480.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,16 @@\n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n \n+Those should be removed, and the right path added to the include line.\n+\n+**Run**:\n+\n+```\n+cd \"$SAGE_ROOT/devel/sage/sage\"\n+source updirectories-sed.sh\n+hg commit -m \"Trac #12728: Update include directories\"\n+```\n+\n+**or alternatively, for sage-5.10.beta3, apply** trac_12728_5.10.beta3.patch.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-18T11:46:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184480",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,16 @@
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
 
+Those should be removed, and the right path added to the include line.
+
+**Run**:
+
+```
+cd "$SAGE_ROOT/devel/sage/sage"
+source updirectories-sed.sh
+hg commit -m "Trac #12728: Update include directories"
+```
+
+**or alternatively, for sage-5.10.beta3, apply** trac_12728_5.10.beta3.patch.
 
 Comment: 1
 
``````




---

archive/issue_comments_184481.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n \n+Those should be removed, and the right path added to the include line.\n+\n+**Run**:\n+\n+```\n+cd \"$SAGE_ROOT/devel/sage/sage\"\n+source updirectories-sed.sh\n+hg commit -m \"Trac #12728: Update include directories\"\n+```\n+\n+\n+Jeroen: apply trac_12728_5.10.beta3.patch.\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-18T11:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184481",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
 
+Those should be removed, and the right path added to the include line.
+
+**Run**:
+
+```
+cd "$SAGE_ROOT/devel/sage/sage"
+source updirectories-sed.sh
+hg commit -m "Trac #12728: Update include directories"
+```
+
+
+Jeroen: apply trac_12728_5.10.beta3.patch.
 
 Comment: 1
 
``````




---

archive/issue_comments_184482.json:
```json
{
    "body": "<a id='comment:23'></a>Looks good to me!",
    "created_at": "2013-05-18T11:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184482",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:23'></a>Looks good to me!



---

archive/issue_comments_184483.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Volker Braun\"",
    "created_at": "2013-05-18T11:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184483",
    "user": "https://github.com/vbraun"
}
```

Changing reviewer from "" to "Volker Braun"



---

archive/issue_comments_184484.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-18T11:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184484",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_184485.json:
```json
{
    "body": "<a id='comment:25'></a>You may have made some publicity for it earlier ... ;-)",
    "created_at": "2013-05-18T13:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184485",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>You may have made some publicity for it earlier ... ;-)



---

archive/issue_comments_184486.json:
```json
{
    "body": "<a id='comment:26'></a>If the patch built by my script gets applied for 5.10.beta4, there's even a chance I'll be able to work on the remaining problems for 5.10 :-)",
    "created_at": "2013-05-20T14:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184486",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:26'></a>If the patch built by my script gets applied for 5.10.beta4, there's even a chance I'll be able to work on the remaining problems for 5.10 :-)



---

archive/issue_comments_184487.json:
```json
{
    "body": "Hand-crafted finalization of the fix",
    "created_at": "2013-05-21T06:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184487",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Hand-crafted finalization of the fix



---

archive/issue_comments_184488.json:
```json
{
    "body": "<a id='comment:27'></a>Attachment [trac_12728_5.10.beta3_hand.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta3_hand.patch) by @jdemeyer created at 2013-05-21 06:59:47",
    "created_at": "2013-05-21T06:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184488",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Attachment [trac_12728_5.10.beta3_hand.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta3_hand.patch) by @jdemeyer created at 2013-05-21 06:59:47



---

archive/issue_comments_184489.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-05-21T06:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184489",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_184490.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-21T06:59:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184490",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_184491.json:
```json
{
    "body": "<a id='comment:29'></a>If [attachment:trac_12728_5.10.beta3_hand.patch] should be applied, it should be reviewed and mentioned in the ticket description.",
    "created_at": "2013-05-21T07:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184491",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>If [attachment:trac_12728_5.10.beta3_hand.patch] should be applied, it should be reviewed and mentioned in the ticket description.



---

archive/issue_comments_184492.json:
```json
{
    "body": "<a id='comment:30'></a>I also don't like two ways of applying a patch, because which one is \"correct\"? Either only mention the script, or only the patch.",
    "created_at": "2013-05-21T07:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184492",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>I also don't like two ways of applying a patch, because which one is "correct"? Either only mention the script, or only the patch.



---

archive/issue_comments_184493.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n \n+Those should be removed, and the right path added to the include line.\n+\n+Apply trac_12728_5.10.beta3.patch and trac_12728_5.10.beta3-hand.patch.\n+\n+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-21T12:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184493",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
 
+Those should be removed, and the right path added to the include line.
+
+Apply trac_12728_5.10.beta3.patch and trac_12728_5.10.beta3-hand.patch.
+
+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)
 
 Comment: 1
 
``````




---

archive/issue_comments_184494.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n \n+Those should be removed, and the right path added to the include line.\n+\n+Apply trac_12728_5.10.beta3.patch and trac_12728_5.10.beta3-hand.patch.\n+\n+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)\n+\n+(The first patch was already reviewed by Volker, but not the second)\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-21T12:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184494",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
 
+Those should be removed, and the right path added to the include line.
+
+Apply trac_12728_5.10.beta3.patch and trac_12728_5.10.beta3-hand.patch.
+
+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)
+
+(The first patch was already reviewed by Volker, but not the second)
 
 Comment: 1
 
``````




---

archive/issue_comments_184495.json:
```json
{
    "body": "<a id='comment:33'></a>Can you rediff the first patch for sage-5.10.beta4",
    "created_at": "2013-05-21T12:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184495",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>Can you rediff the first patch for sage-5.10.beta4



---

archive/issue_comments_184496.json:
```json
{
    "body": "Changing work_issues from \"\" to \"rebase\"",
    "created_at": "2013-05-21T13:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184496",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "" to "rebase"



---

archive/issue_comments_184497.json:
```json
{
    "body": "Changing reviewer from \"Volker Braun\" to \"Volker Braun, Jeroen Demeyer\"",
    "created_at": "2013-05-21T13:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184497",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "Volker Braun" to "Volker Braun, Jeroen Demeyer"



---

archive/issue_comments_184498.json:
```json
{
    "body": "<a id='comment:34'></a>Positive review to [attachment:trac_12728_5.10.beta3_hand.patch]",
    "created_at": "2013-05-21T13:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184498",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>Positive review to [attachment:trac_12728_5.10.beta3_hand.patch]



---

archive/issue_comments_184499.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-21T13:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184499",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_184500.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n \n+Those should be removed, and the right path added to the include line.\n+\n+Apply [attachment:trac_12728_5.10.beta3.patch] and [attachment:trac_12728_5.10.beta3-hand.patch]\n+\n+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)\n+\n+(The first patch was reviewed by Volker, the second by Jeroen)\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-21T13:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184500",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
 
+Those should be removed, and the right path added to the include line.
+
+Apply [attachment:trac_12728_5.10.beta3.patch] and [attachment:trac_12728_5.10.beta3-hand.patch]
+
+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)
+
+(The first patch was reviewed by Volker, the second by Jeroen)
 
 Comment: 1
 
``````




---

archive/issue_comments_184501.json:
```json
{
    "body": "Attachment [trac_12728_5.10.beta4_auto.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta4_auto.patch) by Snark created at 2013-05-21 19:37:00\n\nPatch created applying the script agains 5.10.beta4",
    "created_at": "2013-05-21T19:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184501",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Attachment [trac_12728_5.10.beta4_auto.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta4_auto.patch) by Snark created at 2013-05-21 19:37:00

Patch created applying the script agains 5.10.beta4



---

archive/issue_comments_184502.json:
```json
{
    "body": "Attachment [trac_12728_5.10.beta4_hand.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta4_hand.patch) by Snark created at 2013-05-21 19:37:36\n\nHand-crafted finalization of the fix",
    "created_at": "2013-05-21T19:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184502",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Attachment [trac_12728_5.10.beta4_hand.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_5.10.beta4_hand.patch) by Snark created at 2013-05-21 19:37:36

Hand-crafted finalization of the fix



---

archive/issue_comments_184503.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n+\"\"Problem\"\"\n \n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n+\n+\"\"Solution\"\"\n+Those should be removed, and the right path added to the include line.\n+\n+Apply [attachment:trac_12728_5.10.beta4_auto.patch] and [attachment:trac_12728_5.10.beta4_hand.patch]\n+\n+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-21T19:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184503",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,13 @@
+""Problem""
 
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
+
+""Solution""
+Those should be removed, and the right path added to the include line.
+
+Apply [attachment:trac_12728_5.10.beta4_auto.patch] and [attachment:trac_12728_5.10.beta4_hand.patch]
+
+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)
 
 Comment: 1
 
``````




---

archive/issue_comments_184504.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-21T19:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184504",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_184505.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,13 @@\n+**Problem**\n \n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n+\n+**Solution**\n+Those should be removed, and the right path added to the include line.\n+\n+Apply [attachment:trac_12728_5.10.beta4_auto.patch] and [attachment:trac_12728_5.10.beta4_hand.patch]\n+\n+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-21T19:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184505",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,13 @@
+**Problem**
 
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
+
+**Solution**
+Those should be removed, and the right path added to the include line.
+
+Apply [attachment:trac_12728_5.10.beta4_auto.patch] and [attachment:trac_12728_5.10.beta4_hand.patch]
+
+(The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.)
 
 Comment: 1
 
``````




---

archive/issue_comments_184506.json:
```json
{
    "body": "<a id='comment:37'></a>Looks good. \n\nJeroen, can we merge this in beta5?",
    "created_at": "2013-05-22T10:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184506",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>Looks good. 

Jeroen, can we merge this in beta5?



---

archive/issue_comments_184507.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-22T10:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184507",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_184508.json:
```json
{
    "body": "Changing work_issues from \"rebase\" to \"\"",
    "created_at": "2013-05-22T13:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184508",
    "user": "https://github.com/jdemeyer"
}
```

Changing work_issues from "rebase" to ""



---

archive/issue_comments_184509.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-05-23T08:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184509",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_184510.json:
```json
{
    "body": "<a id='comment:39'></a>This causes problems with the HTML documentation:\n\n```\ndochtml.log:[rings_sta] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/rings_standard/sage/rings/integer.rst:11: WARNING: error while formatting signature for sage.rings.integer.parent: 'NoneType' object has no attribute 'find'\ndochtml.log:[structure] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/structure/sage/sets/disjoint_set.rst:11: WARNING: error while formatting signature for sage.sets.disjoint_set.OP_represent: 'NoneType' object has no attribute 'find'\ndochtml.log:[structure] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/structure/sage/sets/disjoint_set.rst:11: WARNING: error while formatting signature for sage.sets.disjoint_set.PS_represent: 'NoneType' object has no attribute 'find'\ndochtml.log:[structure] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/structure/sage/sets/disjoint_set.rst:11: WARNING: error while formatting signature for sage.sets.disjoint_set.SC_test_list_perms: 'NoneType' object has no attribute 'find'\n```",
    "created_at": "2013-05-23T08:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184510",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>This causes problems with the HTML documentation:

```
dochtml.log:[rings_sta] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/rings_standard/sage/rings/integer.rst:11: WARNING: error while formatting signature for sage.rings.integer.parent: 'NoneType' object has no attribute 'find'
dochtml.log:[structure] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/structure/sage/sets/disjoint_set.rst:11: WARNING: error while formatting signature for sage.sets.disjoint_set.OP_represent: 'NoneType' object has no attribute 'find'
dochtml.log:[structure] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/structure/sage/sets/disjoint_set.rst:11: WARNING: error while formatting signature for sage.sets.disjoint_set.PS_represent: 'NoneType' object has no attribute 'find'
dochtml.log:[structure] /mazur/release/merger/sage-5.10.beta5/devel/sage/doc/en/reference/structure/sage/sets/disjoint_set.rst:11: WARNING: error while formatting signature for sage.sets.disjoint_set.SC_test_list_perms: 'NoneType' object has no attribute 'find'
```



---

archive/issue_comments_184511.json:
```json
{
    "body": "<a id='comment:40'></a>Your error message doesn't look at all like it's related to my changes (no error looking like \"File not found\"), but I'll investigate...",
    "created_at": "2013-05-23T09:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184511",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:40'></a>Your error message doesn't look at all like it's related to my changes (no error looking like "File not found"), but I'll investigate...



---

archive/issue_comments_184512.json:
```json
{
    "body": "<a id='comment:41'></a>This is what broke:\n\n```\nsage: sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-1-b9940f7f2356> in <module>()\n----> 1 sage_getargspec(sage.sets.disjoint_set.OP_represent)\n\nNameError: name 'sage_getargspec' is not defined\nsage: sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-ee04891bf854> in <module>()\n----> 1 sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)\n\n/home/vbraun/opt/sage-5.10.beta3/local/lib/python2.7/site-packages/sage/misc/sageinspect.pyc in sage_getargspec(obj)\n   1332         except TypeError: # arg is not a code object\n   1333         # The above \"hopefully\" was wishful thinking:\n-> 1334             return inspect.ArgSpec(*_sage_getargspec_cython(sage_getsource(obj)))\n   1335             #return _sage_getargspec_from_ast(sage_getsource(obj))\n   1336     try:\n\n/home/vbraun/opt/sage-5.10.beta3/local/lib/python2.7/site-packages/sage/misc/sageinspect.pyc in _sage_getargspec_cython(source)\n    984 \n    985     \"\"\"\n--> 986     defpos = source.find('def ')\n    987     assert defpos > -1, \"The given source does not contain 'def'\"\n    988     s = source[defpos:].strip()\n\nAttributeError: 'NoneType' object has no attribute 'find'\n```\nused to be \n\n```\nsage: sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)\nArgSpec(args=['n', 'merges', 'perm'], varargs=None, keywords=None, defaults=None)\n```",
    "created_at": "2013-05-23T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184512",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:41'></a>This is what broke:

```
sage: sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-1-b9940f7f2356> in <module>()
----> 1 sage_getargspec(sage.sets.disjoint_set.OP_represent)

NameError: name 'sage_getargspec' is not defined
sage: sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-ee04891bf854> in <module>()
----> 1 sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)

/home/vbraun/opt/sage-5.10.beta3/local/lib/python2.7/site-packages/sage/misc/sageinspect.pyc in sage_getargspec(obj)
   1332         except TypeError: # arg is not a code object
   1333         # The above "hopefully" was wishful thinking:
-> 1334             return inspect.ArgSpec(*_sage_getargspec_cython(sage_getsource(obj)))
   1335             #return _sage_getargspec_from_ast(sage_getsource(obj))
   1336     try:

/home/vbraun/opt/sage-5.10.beta3/local/lib/python2.7/site-packages/sage/misc/sageinspect.pyc in _sage_getargspec_cython(source)
    984 
    985     """
--> 986     defpos = source.find('def ')
    987     assert defpos > -1, "The given source does not contain 'def'"
    988     s = source[defpos:].strip()

AttributeError: 'NoneType' object has no attribute 'find'
```
used to be 

```
sage: sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent)
ArgSpec(args=['n', 'merges', 'perm'], varargs=None, keywords=None, defaults=None)
```



---

archive/issue_comments_184513.json:
```json
{
    "body": "<a id='comment:42'></a>`@`vbraun: thanks ; it still doesn't look like a missing file, but at least it's a place I can start digging.\n\nMy plan was the following :\n1. freshly unpack a sage-5.10.beta4 tarball ;\n2. make build\n3. apply the patches\n4. ./sage -ba-force\n5. make doc-html\n\nnow step 5 is to start from this sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent).",
    "created_at": "2013-05-23T10:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184513",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:42'></a>`@`vbraun: thanks ; it still doesn't look like a missing file, but at least it's a place I can start digging.

My plan was the following :
1. freshly unpack a sage-5.10.beta4 tarball ;
2. make build
3. apply the patches
4. ./sage -ba-force
5. make doc-html

now step 5 is to start from this sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent).



---

archive/issue_comments_184514.json:
```json
{
    "body": "<a id='comment:43'></a>Ok, I determined that sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent) gets interpreted in sageinspect.py like this:\n1. is it an abstract method, line 1284? No.\n2. is it callable, line 1287? Yes.\n3. try to read the argspec, line 1290 - AttributeError line 1291, pass (line 1292)!\n4. is it a function, line 1293? No.\n5. is it a method, line 1295? No.\n6. is it a class instance, line 1297? No.\n7. is it a class, line 1311? No.\n8. does it have some attributes, line 1314? No.\n9. fallback to the 'else' of line 1318!\n10. let's call sage_getsource, line 1320, and get None.\n21. line 1321-1324: since we got None, we set func_obj=obj.\n32. try something line 1328 and fail with AttributeError\n43. catch this exception and try something else line 1331 and fail with TypeError\n54. catch this exception line 1332\n65. let's do (no try this time): \"return inspect.ArgSpec(*_sage_getargspec_cython(sage_getsource(obj)))\", because obviously, the fact that a few lines above sage_getsource got us None already won't be a problem! BOOM!\n\nI interpret those findings as meaning that something with my patches has made sage_getsource(obj) return None, and this then uncovered a nice bug in sageinspect. Does this sound sensible? Should I then file a bug against sageinspect.py? [Of course, I'll now investigate why None gets returned]",
    "created_at": "2013-05-23T12:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184514",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:43'></a>Ok, I determined that sage.misc.sageinspect.sage_getargspec(sage.sets.disjoint_set.OP_represent) gets interpreted in sageinspect.py like this:
1. is it an abstract method, line 1284? No.
2. is it callable, line 1287? Yes.
3. try to read the argspec, line 1290 - AttributeError line 1291, pass (line 1292)!
4. is it a function, line 1293? No.
5. is it a method, line 1295? No.
6. is it a class instance, line 1297? No.
7. is it a class, line 1311? No.
8. does it have some attributes, line 1314? No.
9. fallback to the 'else' of line 1318!
10. let's call sage_getsource, line 1320, and get None.
21. line 1321-1324: since we got None, we set func_obj=obj.
32. try something line 1328 and fail with AttributeError
43. catch this exception and try something else line 1331 and fail with TypeError
54. catch this exception line 1332
65. let's do (no try this time): "return inspect.ArgSpec(*_sage_getargspec_cython(sage_getsource(obj)))", because obviously, the fact that a few lines above sage_getsource got us None already won't be a problem! BOOM!

I interpret those findings as meaning that something with my patches has made sage_getsource(obj) return None, and this then uncovered a nice bug in sageinspect. Does this sound sensible? Should I then file a bug against sageinspect.py? [Of course, I'll now investigate why None gets returned]



---

archive/issue_comments_184515.json:
```json
{
    "body": "<a id='comment:44'></a>Oh, I forgot to make explicit the remark that sage_getsource returning None could be related to a \"File not found\" problem -- so now it makes sense that the problem can be related to my patches. Something which wasn't that clear. So now I'm looking for a problem, and I believe in it :-P",
    "created_at": "2013-05-23T12:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184515",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:44'></a>Oh, I forgot to make explicit the remark that sage_getsource returning None could be related to a "File not found" problem -- so now it makes sense that the problem can be related to my patches. Something which wasn't that clear. So now I'm looking for a problem, and I believe in it :-P



---

archive/issue_comments_184516.json:
```json
{
    "body": "<a id='comment:45'></a>I now determined how sage_getsource(sage.sets.disjoint_set.OP_represent) gets interpreted in sageinspect.py:\n1. try to use the _sage_src_ method and raise an AttributeError, line 1552 (gets pass-ed)\n2. try to use sage_getsourcelines, line 1556 and get None\n3. after a test of the previous value, return None, line 1558\n\nThe problems turns into: why does sage_getsourcelines(sage.sets.disjoint_set.OP_represent) return None? Let's follow the trail again:\n1. try to use the _sage_src_lines_ method and raise an AttributeError line 1783 (gets pass-ed)\n2. is it a class instance, line 1791? No.\n3. get a nice-looking doctring line 1802, except that the filename reads 'res_pyx.pxi'\n4. try to use _extract_embedded_position on it... get to line 200... where the filename gets obtained by os.path.join(SAGE_SRC, res.group('FILENAME'))\n5. from there, the rest is history: we have a wrong filename in a wrong path, so it's no surprise things get messy. \n\n\nSo now I see two problems there: first, the only file with a name looking like this is sage/groups/perm_gps/partn_ref/data_structures_pyx.pxi, and second, the way the full path is obtained from the filename looks too naive.\n\nHow can I debug the first problem?",
    "created_at": "2013-05-23T12:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184516",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:45'></a>I now determined how sage_getsource(sage.sets.disjoint_set.OP_represent) gets interpreted in sageinspect.py:
1. try to use the _sage_src_ method and raise an AttributeError, line 1552 (gets pass-ed)
2. try to use sage_getsourcelines, line 1556 and get None
3. after a test of the previous value, return None, line 1558

The problems turns into: why does sage_getsourcelines(sage.sets.disjoint_set.OP_represent) return None? Let's follow the trail again:
1. try to use the _sage_src_lines_ method and raise an AttributeError line 1783 (gets pass-ed)
2. is it a class instance, line 1791? No.
3. get a nice-looking doctring line 1802, except that the filename reads 'res_pyx.pxi'
4. try to use _extract_embedded_position on it... get to line 200... where the filename gets obtained by os.path.join(SAGE_SRC, res.group('FILENAME'))
5. from there, the rest is history: we have a wrong filename in a wrong path, so it's no surprise things get messy. 


So now I see two problems there: first, the only file with a name looking like this is sage/groups/perm_gps/partn_ref/data_structures_pyx.pxi, and second, the way the full path is obtained from the filename looks too naive.

How can I debug the first problem?



---

archive/issue_comments_184517.json:
```json
{
    "body": "<a id='comment:46'></a>\"sage.sets.disjoint_set.OP_represent\" is defined in sage/groups/perm_gps/partn_ref/data_structures_pyx.pxi, and indeed at line 125 as I see in the docstring.\nThe line number is correct ; only the filename looks like it has been eaten.",
    "created_at": "2013-05-23T13:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184517",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:46'></a>"sage.sets.disjoint_set.OP_represent" is defined in sage/groups/perm_gps/partn_ref/data_structures_pyx.pxi, and indeed at line 125 as I see in the docstring.
The line number is correct ; only the filename looks like it has been eaten.



---

archive/issue_comments_184518.json:
```json
{
    "body": "<a id='comment:47'></a>On the non-patched sage-5.10.beta5 the filename is \"sage/sets/../groups/perm_gps/partn_ref/data_structures_pyx.pxi\".",
    "created_at": "2013-05-23T13:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184518",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:47'></a>On the non-patched sage-5.10.beta5 the filename is "sage/sets/../groups/perm_gps/partn_ref/data_structures_pyx.pxi".



---

archive/issue_comments_184519.json:
```json
{
    "body": "<a id='comment:48'></a>The filename is already wrong in the Cythonized `disjoint_set.c`:\n\n```\nstatic char __pyx_doc_4sage_4sets_12disjoint_set_OP_represent[] = \"File: pyx.pxi (starting at line 125)\\n\\n    Demonstration and testing.\\n    \\n    TESTS::\\n\\n        [...]        Done.\\n\\n    \";\n```\nSo there is nothing in this ticket that is responsible for it.",
    "created_at": "2013-05-23T14:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184519",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:48'></a>The filename is already wrong in the Cythonized `disjoint_set.c`:

```
static char __pyx_doc_4sage_4sets_12disjoint_set_OP_represent[] = "File: pyx.pxi (starting at line 125)\n\n    Demonstration and testing.\n    \n    TESTS::\n\n        [...]        Done.\n\n    ";
```
So there is nothing in this ticket that is responsible for it.



---

archive/issue_comments_184520.json:
```json
{
    "body": "<a id='comment:49'></a>The bug is in Cython `Nodes.relative_position`, which assumes that you can make the path relative by stripping off `len(os.path.abspath(os.getcwd()))` characters. Thats of course totally wrong when the file was discovered through a search path.",
    "created_at": "2013-05-23T15:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184520",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:49'></a>The bug is in Cython `Nodes.relative_position`, which assumes that you can make the path relative by stripping off `len(os.path.abspath(os.getcwd()))` characters. Thats of course totally wrong when the file was discovered through a search path.



---

archive/issue_comments_184521.json:
```json
{
    "body": "<a id='comment:50'></a>See #14634 for the Cython bug",
    "created_at": "2013-05-23T15:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184521",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:50'></a>See #14634 for the Cython bug



---

archive/issue_comments_184522.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-05-23T15:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184522",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_034560.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-23T15:59:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12728#event-34560"
}
```



---

archive/issue_comments_184523.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#14634\"",
    "created_at": "2013-05-23T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184523",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#14634"



---

archive/issue_comments_184524.json:
```json
{
    "body": "Initial patch",
    "created_at": "2013-05-23T17:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184524",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_events_034561.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-23T17:50:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12728#event-34561"
}
```



---

archive/issue_events_034562.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-05-23T17:50:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "milestone": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12728#event-34562"
}
```



---

archive/issue_comments_184525.json:
```json
{
    "body": "<a id='comment:52'></a>Attachment [trac_12728_docbuild_workaround.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_docbuild_workaround.patch) by @vbraun created at 2013-05-23 17:50:18\n\nI suggest we just revert the two includes that trigger the Cython bug.",
    "created_at": "2013-05-23T17:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184525",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:52'></a>Attachment [trac_12728_docbuild_workaround.patch](tarball://root/attachments/some-uuid/ticket12728/trac_12728_docbuild_workaround.patch) by @vbraun created at 2013-05-23 17:50:18

I suggest we just revert the two includes that trigger the Cython bug.



---

archive/issue_comments_184526.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,17 @@\n+**Problem**\n \n+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).\n+\n+**Solution**\n+Those should be removed, and the right path added to the include line.\n+\n+\n+The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.\n+\n+Apply \n+* [attachment:trac_12728_5.10.beta4_auto.patch]\n+* [attachment:trac_12728_5.10.beta4_hand.patch]\n+* [attachment:trac_12728_docbuild_workaround.patch]\n \n Comment: 1\n \n``````\n",
    "created_at": "2013-05-23T17:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184526",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,17 @@
+**Problem**
 
+There are many places in sage's spkg sources where inclusions are made with a filename which looks like ../../../../../whatever (no exageration: up to *five* levels!).
+
+**Solution**
+Those should be removed, and the right path added to the include line.
+
+
+The first patch was obtained by running the attached script and the second one by hand-editing the remaining occurrences.
+
+Apply 
+* [attachment:trac_12728_5.10.beta4_auto.patch]
+* [attachment:trac_12728_5.10.beta4_hand.patch]
+* [attachment:trac_12728_docbuild_workaround.patch]
 
 Comment: 1
 
``````




---

archive/issue_comments_184527.json:
```json
{
    "body": "Changing dependencies from \"#14634\" to \"\"",
    "created_at": "2013-05-23T17:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184527",
    "user": "https://github.com/vbraun"
}
```

Changing dependencies from "#14634" to ""



---

archive/issue_comments_184528.json:
```json
{
    "body": "<a id='comment:53'></a>I'm happy with your solution. I rebuilt sagelib adding your patch to my two patches, then built the doc from there : perfect. Positive review!",
    "created_at": "2013-05-23T19:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184528",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:53'></a>I'm happy with your solution. I rebuilt sagelib adding your patch to my two patches, then built the doc from there : perfect. Positive review!



---

archive/issue_comments_184529.json:
```json
{
    "body": "Changing reviewer from \"Volker Braun, Jeroen Demeyer\" to \"Volker Braun, Jeroen Demeyer, Julien Puydt\"",
    "created_at": "2013-05-23T19:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184529",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing reviewer from "Volker Braun, Jeroen Demeyer" to "Volker Braun, Jeroen Demeyer, Julien Puydt"



---

archive/issue_comments_184530.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-24T09:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184530",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_034563.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T09:39:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12728#event-34563"
}
```



---

archive/issue_comments_184531.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.10.beta5\"",
    "created_at": "2013-05-24T09:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12728",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12728#issuecomment-184531",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.10.beta5"
