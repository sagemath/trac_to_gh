# Issue 12661: Include GMP 5.1.3 as an optional package

archive/issues_012489.json:
```json
{
    "body": "Let's package GMP 5.1.3.\n\nUpstream tarball at:\n* https://ftp.gnu.org/gnu/gmp/gmp-5.1.3.tar.bz2\n\nAssignee: tbd\n\nCC:  @nexttime @rwst\n\nKeywords: gmp\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Simon King, Jean-Pierre Flori\n\nBranch: a14aaf2fd94252c0e263c8b02003f8c640d70e0e\n\nCommit: a14aaf2fd94252c0e263c8b02003f8c640d70e0e\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12661\n\n",
    "closed_at": "2014-03-20T15:43:43Z",
    "created_at": "2012-03-13T10:00:18Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "Include GMP 5.1.3 as an optional package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12661",
    "user": "https://github.com/simon-king-jena"
}
```
Let's package GMP 5.1.3.

Upstream tarball at:
* https://ftp.gnu.org/gnu/gmp/gmp-5.1.3.tar.bz2

Assignee: tbd

CC:  @nexttime @rwst

Keywords: gmp

Reviewer: Fran√ßois Bissey

Author: Simon King, Jean-Pierre Flori

Branch: a14aaf2fd94252c0e263c8b02003f8c640d70e0e

Commit: a14aaf2fd94252c0e263c8b02003f8c640d70e0e

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12661





---

archive/issue_comments_147711.json:
```json
{
    "body": "<a id='comment:1'></a>Google told me that some people suggested to \"include cstdio to obtain std::FILE\". So, I tried to add\n\n```\n#include <cstdio.h>\n```\nto gmp.h. However, after I attempted to build it, that line was gone!!\n\nCan someone explain how I can avoid that my editing the file is reverted? Perhaps I need to do my change in the \"patches\" directory?",
    "created_at": "2012-03-13T10:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147711",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>Google told me that some people suggested to "include cstdio to obtain std::FILE". So, I tried to add

```
#include <cstdio.h>
```
to gmp.h. However, after I attempted to build it, that line was gone!!

Can someone explain how I can avoid that my editing the file is reverted? Perhaps I need to do my change in the "patches" directory?



---

archive/issue_comments_147712.json:
```json
{
    "body": "<a id='comment:2'></a>Yeah, I made some progress!!\n\nI found that I needed to edit `src/gmp-h.in`, and I needed to `#include <cstdio>`, but only `#if defined (__cplusplus)`.\n\nThen, building the package went beyond the point where it failed previously. However, it turns out that the gmp package requires yacc. I am insalling it now.\n\nTODO (for the moment):\n\n- Turn my changes to `src/gmp-h.in` into a patch, to be put into the `patches` directory.\n- spkg-install should check for the presence of yacc.",
    "created_at": "2012-03-13T10:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147712",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Yeah, I made some progress!!

I found that I needed to edit `src/gmp-h.in`, and I needed to `#include <cstdio>`, but only `#if defined (__cplusplus)`.

Then, building the package went beyond the point where it failed previously. However, it turns out that the gmp package requires yacc. I am insalling it now.

TODO (for the moment):

- Turn my changes to `src/gmp-h.in` into a patch, to be put into the `patches` directory.
- spkg-install should check for the presence of yacc.



---

archive/issue_comments_147713.json:
```json
{
    "body": "<a id='comment:3'></a>Hooray, the modified package builds on my openSuse laptop. However, spkg-check fails, ending with\n\n```\nMaking check in cxx\nmake[3]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\nmake  t-assign t-binary t-cast t-constr t-headers t-istream t-locale t-misc t-ops t-ostream t-prec t-rand t-ternary t-unary\nmake[4]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-assign.o t-assign.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-assign  t-assign.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \nmkdir .libs\ng++ -O2 -m64 -mtune=k8 -o .libs/t-assign t-assign.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-assign\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-binary.o t-binary.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-binary  t-binary.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-binary t-binary.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-binary\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-cast.o t-cast.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-cast  t-cast.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-cast t-cast.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-cast\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-constr.o t-constr.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-constr  t-constr.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-constr t-constr.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-constr\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-headers.o t-headers.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-headers  t-headers.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-headers t-headers.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-headers\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-istream.o t-istream.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-istream  t-istream.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-istream t-istream.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-istream\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-locale.o t-locale.cc\nt-locale.cc: In function \u2018void check_input()\u2019:\nt-locale.cc:108:26: error: \u2018abort\u2019 was not declared in this scope\nt-locale.cc:123:26: error: \u2018abort\u2019 was not declared in this scope\nt-locale.cc: In function \u2018void check_output()\u2019:\nt-locale.cc:158:18: error: \u2018abort\u2019 was not declared in this scope\nmake[4]: *** [t-locale.o] Fehler 1\nmake[4]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\nmake[3]: *** [check-am] Fehler 2\nmake[3]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\nmake[2]: *** [check-recursive] Fehler 1\nmake[2]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests'\nmake[1]: *** [check-recursive] Fehler 1\nmake[1]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src'\nmake: *** [check] Fehler 2\n```",
    "created_at": "2012-03-13T10:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147713",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>Hooray, the modified package builds on my openSuse laptop. However, spkg-check fails, ending with

```
Making check in cxx
make[3]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
make  t-assign t-binary t-cast t-constr t-headers t-istream t-locale t-misc t-ops t-ostream t-prec t-rand t-ternary t-unary
make[4]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-assign.o t-assign.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-assign  t-assign.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
mkdir .libs
g++ -O2 -m64 -mtune=k8 -o .libs/t-assign t-assign.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-assign
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-binary.o t-binary.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-binary  t-binary.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-binary t-binary.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-binary
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-cast.o t-cast.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-cast  t-cast.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-cast t-cast.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-cast
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-constr.o t-constr.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-constr  t-constr.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-constr t-constr.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-constr
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-headers.o t-headers.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-headers  t-headers.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-headers t-headers.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-headers
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-istream.o t-istream.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-istream  t-istream.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-istream t-istream.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-istream
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-locale.o t-locale.cc
t-locale.cc: In function ‚Äòvoid check_input()‚Äô:
t-locale.cc:108:26: error: ‚Äòabort‚Äô was not declared in this scope
t-locale.cc:123:26: error: ‚Äòabort‚Äô was not declared in this scope
t-locale.cc: In function ‚Äòvoid check_output()‚Äô:
t-locale.cc:158:18: error: ‚Äòabort‚Äô was not declared in this scope
make[4]: *** [t-locale.o] Fehler 1
make[4]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
make[3]: *** [check-am] Fehler 2
make[3]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
make[2]: *** [check-recursive] Fehler 1
make[2]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests'
make[1]: *** [check-recursive] Fehler 1
make[1]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src'
make: *** [check] Fehler 2
```



---

archive/issue_comments_147714.json:
```json
{
    "body": "<a id='comment:4'></a>While I was at it, I tried to upgrade to gmp 5.0.4. Unfortunately, it complains that it can not find bdivmod.c in the path -- the old spkg contains that file in src/mpn/generic, but the original gmp 5.0.4 sources do no contain bdivmod.c in src/mpn/generic. Too bad.",
    "created_at": "2012-03-13T11:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147714",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>While I was at it, I tried to upgrade to gmp 5.0.4. Unfortunately, it complains that it can not find bdivmod.c in the path -- the old spkg contains that file in src/mpn/generic, but the original gmp 5.0.4 sources do no contain bdivmod.c in src/mpn/generic. Too bad.



---

archive/issue_comments_147715.json:
```json
{
    "body": "<a id='comment:5'></a>The advantage of gmp 5.0.4 would be that the sources already include cstdio. So, no need for patching it. The problem is that 5.0.4 has removed and renamed a couple of things. For example, all files starting with the name `mullow_` are now starting with `mullo_`. The patches of the spkg need to be changed accordingly.\n\nThe gmp 5.0.4 package seems to build. Keeping my fingers crossed for the test...",
    "created_at": "2012-03-13T11:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147715",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>The advantage of gmp 5.0.4 would be that the sources already include cstdio. So, no need for patching it. The problem is that 5.0.4 has removed and renamed a couple of things. For example, all files starting with the name `mullow_` are now starting with `mullo_`. The patches of the spkg need to be changed accordingly.

The gmp 5.0.4 package seems to build. Keeping my fingers crossed for the test...



---

archive/issue_comments_147716.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 SimonKing]:\n> The gmp 5.0.4 package seems to build.\n\n\nNo, it doesn't. I get an infinite loop during configuration, it seems. `/bin/sh ./config.status --recheck` is repeated over and over again.",
    "created_at": "2012-03-13T12:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147716",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>Replying to [comment:5 SimonKing]:
> The gmp 5.0.4 package seems to build.


No, it doesn't. I get an infinite loop during configuration, it seems. `/bin/sh ./config.status --recheck` is repeated over and over again.



---

archive/issue_comments_147717.json:
```json
{
    "body": "Changing keywords from \"\" to \"gmp\".",
    "created_at": "2012-03-13T13:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147717",
    "user": "https://github.com/simon-king-jena"
}
```

Changing keywords from "" to "gmp".



---

archive/issue_comments_147718.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-13T13:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147718",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_147719.json:
```json
{
    "body": "<a id='comment:8'></a>See modified ticket description: It was easy to make gmp 5.0.4 build and pass all tests. Simply one has to drop all patches of the old gmp spkg.",
    "created_at": "2012-03-13T13:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147719",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>See modified ticket description: It was easy to make gmp 5.0.4 build and pass all tests. Simply one has to drop all patches of the old gmp spkg.



---

archive/issue_comments_147720.json:
```json
{
    "body": "<a id='comment:9'></a>A related ticket: #12661 (optional `CLooG` spkg).\n\n`CLooG` needs gmp to build.",
    "created_at": "2012-03-13T20:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147720",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>A related ticket: #12661 (optional `CLooG` spkg).

`CLooG` needs gmp to build.



---

archive/issue_comments_147721.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 SimonKing]:\n> `CLooG` needs gmp to build.\n\n\n[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/ee5cfaef02dc30ac) claims that `CLooG` could also be built with MPIR rather than GMP.\n\nAnyway. Since the current spkg is broken (at least on openSuse), I still think we should upgrade. But people need to test on different platforms.",
    "created_at": "2012-03-15T08:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147721",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>Replying to [comment:9 SimonKing]:
> `CLooG` needs gmp to build.


[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/ee5cfaef02dc30ac) claims that `CLooG` could also be built with MPIR rather than GMP.

Anyway. Since the current spkg is broken (at least on openSuse), I still think we should upgrade. But people need to test on different platforms.



---

archive/issue_comments_147722.json:
```json
{
    "body": "<a id='comment:13'></a>FWIW, I did build Sage against GMP (5.0.1 or 5.0.2) a couple of times in 2010 (when we made the \"first big PARI upgrade\") and never ran into any problems, except for the Lcalc spkg, which was the only one explicitly using `-lmpir` instead of `-lgmp`, an issue which AFAIK meanwhile is fixed.\n\nAlthough I looked at the (btw. completely outdated) optional GMP spkg (on other occasions as well), I didn't use any of it, in particular didn't apply any additional patches to the more recent GMP versions.\n\n---\n\nWe'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, as newer (2.x, but IIRC only the most recent) versions of FLINT use some *MPIR* internals GMP doesn't provide, or at least isn't compatible with.\n\nBut for the moment it should be ok to use GMP instead, although (for CLooG) this shouldn't be necessary.\n\n(In contrast, as Dima recently mentioned on sage-devel and mpir-devel, GAP uses some GMP internals MPIR currently doesn't provide.  The [older?] version of GAP we use apparently works with MPIR... :-) )",
    "created_at": "2012-03-15T09:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147722",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>FWIW, I did build Sage against GMP (5.0.1 or 5.0.2) a couple of times in 2010 (when we made the "first big PARI upgrade") and never ran into any problems, except for the Lcalc spkg, which was the only one explicitly using `-lmpir` instead of `-lgmp`, an issue which AFAIK meanwhile is fixed.

Although I looked at the (btw. completely outdated) optional GMP spkg (on other occasions as well), I didn't use any of it, in particular didn't apply any additional patches to the more recent GMP versions.

---

We'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, as newer (2.x, but IIRC only the most recent) versions of FLINT use some *MPIR* internals GMP doesn't provide, or at least isn't compatible with.

But for the moment it should be ok to use GMP instead, although (for CLooG) this shouldn't be necessary.

(In contrast, as Dima recently mentioned on sage-devel and mpir-devel, GAP uses some GMP internals MPIR currently doesn't provide.  The [older?] version of GAP we use apparently works with MPIR... :-) )



---

archive/issue_comments_147723.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 leif]:\n> Although I looked at the (btw. completely outdated) optional GMP spkg ...\n\n\nYes, that's what this ticket is about.\n\n> in particular didn't apply any additional patches to the more recent GMP versions.\n\n\nI'm not using any patches either. The question is whether other platforms (Solaris? OS X?) need patches.\n\n> We'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, \n\n\nWhen I first tried to build the optional gcc from #12369 with graphite (hence, together with the optional cloog-ppl package from #12666), I thought that cloog-ppl needs GMP (not MPIR). This is why I opened this ticket in the first place.\n\nI found a massive *slow-down* when I built sage with the optimizations provided by graphite. Big surprise. But some people suggested that the culprit might in fact be GMP. So, I am started over. I can not tell yet whether Sage is faster with MPIR than with GMP. However, GMP is definitely not required by cloog-ppl, which lessens the priority of this ticket considerably, from my perspective...",
    "created_at": "2012-03-15T19:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147723",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>Replying to [comment:13 leif]:
> Although I looked at the (btw. completely outdated) optional GMP spkg ...


Yes, that's what this ticket is about.

> in particular didn't apply any additional patches to the more recent GMP versions.


I'm not using any patches either. The question is whether other platforms (Solaris? OS X?) need patches.

> We'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, 


When I first tried to build the optional gcc from #12369 with graphite (hence, together with the optional cloog-ppl package from #12666), I thought that cloog-ppl needs GMP (not MPIR). This is why I opened this ticket in the first place.

I found a massive *slow-down* when I built sage with the optimizations provided by graphite. Big surprise. But some people suggested that the culprit might in fact be GMP. So, I am started over. I can not tell yet whether Sage is faster with MPIR than with GMP. However, GMP is definitely not required by cloog-ppl, which lessens the priority of this ticket considerably, from my perspective...



---

archive/issue_comments_147724.json:
```json
{
    "body": "<a id='comment:15'></a>Building the new gmp spkg here on Mac OS X (with gcc 4.6.3) with SAGE_CHECK=yes succeeds and passess all tests!",
    "created_at": "2012-05-26T04:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147724",
    "user": "https://github.com/benjaminfjones"
}
```

<a id='comment:15'></a>Building the new gmp spkg here on Mac OS X (with gcc 4.6.3) with SAGE_CHECK=yes succeeds and passess all tests!



---

archive/issue_comments_147725.json:
```json
{
    "body": "<a id='comment:16'></a>GMP 5.0.5 is out since a while...",
    "created_at": "2012-07-28T13:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147725",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>GMP 5.0.5 is out since a while...



---

archive/issue_comments_147726.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 leif]:\n> GMP 5.0.5 is out since a while...\n\n\nThis ticket is open since a while...",
    "created_at": "2012-07-28T14:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147726",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:17'></a>Replying to [comment:16 leif]:
> GMP 5.0.5 is out since a while...


This ticket is open since a while...



---

archive/issue_comments_147727.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 SimonKing]:\n> Replying to [comment:16 leif]:\n> > GMP 5.0.5 is out since a while...\n\n> \n> This ticket is open since a while...\n\n\nI was wanting to review it since a while...",
    "created_at": "2012-07-28T14:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147727",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>Replying to [comment:17 SimonKing]:
> Replying to [comment:16 leif]:
> > GMP 5.0.5 is out since a while...

> 
> This ticket is open since a while...


I was wanting to review it since a while...



---

archive/issue_events_034329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12661#event-34329"
}
```



---

archive/issue_comments_147728.json:
```json
{
    "body": "<a id='comment:20'></a>gmp 5.1.x is out and transition to git is needed if we want to keep gmp in sage.",
    "created_at": "2013-12-26T19:41:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147728",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>gmp 5.1.x is out and transition to git is needed if we want to keep gmp in sage.



---

archive/issue_comments_147729.json:
```json
{
    "body": "<a id='comment:21'></a>Yup, also note that FLINT >= 2.4 can now be built on top of GMP.\nIIRC it's the only spkg which explicitely depended on MPIR.",
    "created_at": "2014-01-03T13:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147729",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:21'></a>Yup, also note that FLINT >= 2.4 can now be built on top of GMP.
IIRC it's the only spkg which explicitely depended on MPIR.



---

archive/issue_events_034330.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12661#event-34330"
}
```



---

archive/issue_events_034331.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12661#event-34331"
}
```



---

archive/issue_comments_147730.json:
```json
{
    "body": "<a id='comment:23'></a>Also, mpir was not updated since Nov 2012. However gmp isn't even in optional now, so a new ticket would have to be opened to include it.",
    "created_at": "2014-02-15T16:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147730",
    "user": "https://github.com/rwst"
}
```

<a id='comment:23'></a>Also, mpir was not updated since Nov 2012. However gmp isn't even in optional now, so a new ticket would have to be opened to include it.



---

archive/issue_comments_147731.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-02-21T11:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147731",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_147732.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2014-02-21T11:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147732",
    "user": "https://github.com/rwst"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_147733.json:
```json
{
    "body": "Changing type from enhancement to defect.",
    "created_at": "2014-02-27T10:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147733",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing type from enhancement to defect.



---

archive/issue_comments_147734.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2014-02-27T10:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147734",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_147735.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-27T11:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_147736.json:
```json
{
    "body": "<a id='comment:28'></a>Problems with farey_symbol.pyx which uses additional c++ source files (farey.cpp and sl2z.cpp) but cython wants to compile them with CC and that fails when GMP is used underneath.\nNot sure why it succeeded on top of MPIR.",
    "created_at": "2014-02-27T11:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147736",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:28'></a>Problems with farey_symbol.pyx which uses additional c++ source files (farey.cpp and sl2z.cpp) but cython wants to compile them with CC and that fails when GMP is used underneath.
Not sure why it succeeded on top of MPIR.



---

archive/issue_comments_147737.json:
```json
{
    "body": "<a id='comment:29'></a>Anyway, it also fails with CXX:\n\n```\ng++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w\nsage/modular/arithgroup/farey.cpp: In function \u2018mpz_class floor(mpq_class)\u2019:\nsage/modular/arithgroup/farey.cpp:147:44: error: conversion from \u2018mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}\u2019 to non-scalar type \u2018mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}\u2019 requested\n```",
    "created_at": "2014-02-27T11:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147737",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:29'></a>Anyway, it also fails with CXX:

```
g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w
sage/modular/arithgroup/farey.cpp: In function ‚Äòmpz_class floor(mpq_class)‚Äô:
sage/modular/arithgroup/farey.cpp:147:44: error: conversion from ‚Äòmpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}‚Äô to non-scalar type ‚Äòmpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}‚Äô requested
```



---

archive/issue_comments_147738.json:
```json
{
    "body": "<a id='comment:30'></a>Similar probledm and solution here:\n* https://bugs.kde.org/show_bug.cgi?id=312481",
    "created_at": "2014-02-27T11:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147738",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:30'></a>Similar probledm and solution here:
* https://bugs.kde.org/show_bug.cgi?id=312481



---

archive/issue_comments_147739.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-27T13:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147739",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_147740.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:29 jpflori]:\n> Anyway, it also fails with CXX:\n> \n> ```\n> g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w\n> sage/modular/arithgroup/farey.cpp: In function \u2018mpz_class floor(mpq_class)\u2019:\n> sage/modular/arithgroup/farey.cpp:147:44: error: conversion from \u2018mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}\u2019 to non-scalar type \u2018mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}\u2019 requested\n> ```\n\nSorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.",
    "created_at": "2014-02-27T17:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147740",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>Replying to [comment:29 jpflori]:
> Anyway, it also fails with CXX:
> 
> ```
> g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w
> sage/modular/arithgroup/farey.cpp: In function ‚Äòmpz_class floor(mpq_class)‚Äô:
> sage/modular/arithgroup/farey.cpp:147:44: error: conversion from ‚Äòmpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}‚Äô to non-scalar type ‚Äòmpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}‚Äô requested
> ```

Sorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.



---

archive/issue_comments_147741.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:32 fbissey]:\n> Replying to [comment:29 jpflori]:\n> > Anyway, it also fails with CXX:\n> > \n> > ```\n> > g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w\n> > sage/modular/arithgroup/farey.cpp: In function \u2018mpz_class floor(mpq_class)\u2019:\n> > sage/modular/arithgroup/farey.cpp:147:44: error: conversion from \u2018mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}\u2019 to non-scalar type \u2018mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}\u2019 requested\n> > ```\n\n> Sorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.\nNo problem, I found the solution more than easily on the web.\n\nAny other suggestion from sage-on-gentoo?\nE.g., do you have devised any simple way to switch from gmp to mpir and back again easily?\nOr are you really stuck with gmp and cannot use mpir? (that would be strange.)",
    "created_at": "2014-02-28T09:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147741",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:33'></a>Replying to [comment:32 fbissey]:
> Replying to [comment:29 jpflori]:
> > Anyway, it also fails with CXX:
> > 
> > ```
> > g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w
> > sage/modular/arithgroup/farey.cpp: In function ‚Äòmpz_class floor(mpq_class)‚Äô:
> > sage/modular/arithgroup/farey.cpp:147:44: error: conversion from ‚Äòmpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}‚Äô to non-scalar type ‚Äòmpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}‚Äô requested
> > ```

> Sorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.
No problem, I found the solution more than easily on the web.

Any other suggestion from sage-on-gentoo?
E.g., do you have devised any simple way to switch from gmp to mpir and back again easily?
Or are you really stuck with gmp and cannot use mpir? (that would be strange.)



---

archive/issue_comments_147742.json:
```json
{
    "body": "<a id='comment:34'></a>We are really stuck with gmp unless we make great effort. It is complicated because most of the package of the tree will depend on gmp and few will use mpir directly, at some point I tried to port a lot of ebuild to mpir directly but it was a bit unsustainable. The easiest way is to use the gmp compatibility layer from mpir. Then we have to convince the toolchain people that we should have the possibility of switching between gmp and mpir to build gcc. Then we need to replace all dependencies to gmp in the tree by some virtual package which can be either gmp or mpir passing as gmp. That's a ton of work, require convincing people and so on.\n\nif all package in sage could be configured with either real gmp or real mpir out of the box we may be able to do some easy switching between the two but it is not the case.\nlmona.de could go its own way and use mpir exclusively if they wanted too (by calling it gmp mainly).",
    "created_at": "2014-02-28T10:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147742",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>We are really stuck with gmp unless we make great effort. It is complicated because most of the package of the tree will depend on gmp and few will use mpir directly, at some point I tried to port a lot of ebuild to mpir directly but it was a bit unsustainable. The easiest way is to use the gmp compatibility layer from mpir. Then we have to convince the toolchain people that we should have the possibility of switching between gmp and mpir to build gcc. Then we need to replace all dependencies to gmp in the tree by some virtual package which can be either gmp or mpir passing as gmp. That's a ton of work, require convincing people and so on.

if all package in sage could be configured with either real gmp or real mpir out of the box we may be able to do some easy switching between the two but it is not the case.
lmona.de could go its own way and use mpir exclusively if they wanted too (by calling it gmp mainly).



---

archive/issue_comments_147743.json:
```json
{
    "body": "<a id='comment:35'></a>FTR here are the only failing doctests:\n\n```\nsage -t --long src/sage/rings/integer.pyx\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 1955, in sage.rings.integer.Integer.__pow__\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes\nGot:\n    gmp: overflow in mpz type   \n    Traceback (most recent call last):\n      File \"/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo\nrker.py\", line 480, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo\nrker.py\", line 839, in execute  \n        exec compiled in globs  \n      File \"<doctest sage.rings.integer.Integer.__pow__[27]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"integer.pyx\", line 1994, in sage.rings.integer.Integer.__pow__ (sage/rin\ngs/integer.c:14075)\n      File \"c_lib.pyx\", line 85, in sage.ext.c_lib.sig_raise_exception (sage/ext/c_l\nib.c:1009)\n    RuntimeError: Aborted\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 5401, in sage.rings.integer.Integer._xgcd\nFailed example:\n    2._xgcd(-2)\nExpected:\n    (2, 1, 0)\nGot:\n    (2, 0, -1)\n**********************************************************************\n```\nand\n\n```\nsage -t --long src/sage/tests/book_stein_modform.py\n**********************************************************************\nFile \"src/sage/tests/book_stein_modform.py\", line 94, in sage.tests.book_stein_modform\nFailed example:\n    [x.lift_to_sl2z(2) for x in M.manin_generators()]\nExpected:\n    [[1, 0, 0, 1], [0, -1, 1, 0], [0, -1, 1, 1]]\nGot:\n    [[1, 0, 0, 1], [0, -1, 1, 0], [1, 0, 1, 1]]\n**********************************************************************\n```",
    "created_at": "2014-02-28T10:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147743",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:35'></a>FTR here are the only failing doctests:

```
sage -t --long src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 1955, in sage.rings.integer.Integer.__pow__
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes
Got:
    gmp: overflow in mpz type   
    Traceback (most recent call last):
      File "/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo
rker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo
rker.py", line 839, in execute  
        exec compiled in globs  
      File "<doctest sage.rings.integer.Integer.__pow__[27]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "integer.pyx", line 1994, in sage.rings.integer.Integer.__pow__ (sage/rin
gs/integer.c:14075)
      File "c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (sage/ext/c_l
ib.c:1009)
    RuntimeError: Aborted
**********************************************************************
File "src/sage/rings/integer.pyx", line 5401, in sage.rings.integer.Integer._xgcd
Failed example:
    2._xgcd(-2)
Expected:
    (2, 1, 0)
Got:
    (2, 0, -1)
**********************************************************************
```
and

```
sage -t --long src/sage/tests/book_stein_modform.py
**********************************************************************
File "src/sage/tests/book_stein_modform.py", line 94, in sage.tests.book_stein_modform
Failed example:
    [x.lift_to_sl2z(2) for x in M.manin_generators()]
Expected:
    [[1, 0, 0, 1], [0, -1, 1, 0], [0, -1, 1, 1]]
Got:
    [[1, 0, 0, 1], [0, -1, 1, 0], [1, 0, 1, 1]]
**********************************************************************
```



---

archive/issue_comments_147744.json:
```json
{
    "body": "<a id='comment:36'></a>I got the first one in sage/rings/integer.pyx and knew it was from gmp vs mpir. I also have sage/tests/book_stein_modform.py but I didn't know it was originating from gmp vs mpir. I don't have the second failure in integer.pyx it may be because I am currently only at gmp 5.1.2.",
    "created_at": "2014-02-28T11:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147744",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>I got the first one in sage/rings/integer.pyx and knew it was from gmp vs mpir. I also have sage/tests/book_stein_modform.py but I didn't know it was originating from gmp vs mpir. I don't have the second failure in integer.pyx it may be because I am currently only at gmp 5.1.2.



---

archive/issue_comments_147745.json:
```json
{
    "body": "<a id='comment:37'></a>The ones in integer.pyx are really harmless anyway.\n\nNot sure about the one in the Manin generators computation, so I could be easily convinced it is innocuous as well.",
    "created_at": "2014-02-28T11:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147745",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:37'></a>The ones in integer.pyx are really harmless anyway.

Not sure about the one in the Manin generators computation, so I could be easily convinced it is innocuous as well.



---

archive/issue_comments_147746.json:
```json
{
    "body": "<a id='comment:38'></a>Actually I got the second one in integer.pyx. It wasn't present when I last made a record of doctests failures in sage-on-gentoo for sage 6.0, but it is in 6.2.beta2.",
    "created_at": "2014-02-28T18:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147746",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:38'></a>Actually I got the second one in integer.pyx. It wasn't present when I last made a record of doctests failures in sage-on-gentoo for sage 6.0, but it is in 6.2.beta2.



---

archive/issue_comments_147747.json:
```json
{
    "body": "<a id='comment:39'></a>Any reason why this is still stuck at \"need work\"? I can give this a positive review, fixing the doctests to work with gmp is probably more work than it is worth. Especially the top one in integer.pyx.\n\nOpinions?",
    "created_at": "2014-03-15T06:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147747",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>Any reason why this is still stuck at "need work"? I can give this a positive review, fixing the doctests to work with gmp is probably more work than it is worth. Especially the top one in integer.pyx.

Opinions?



---

archive/issue_comments_147748.json:
```json
{
    "body": "<a id='comment:40'></a>I agree that I can live with the failing doctests.\n\nAs far as setting this to \"needs_review\" is concerned, I did not change the status because I wanted to include some patches to let SAge actually use GMP rather than MPIR and even potentially being able to switch from one to the other.",
    "created_at": "2014-03-17T09:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147748",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:40'></a>I agree that I can live with the failing doctests.

As far as setting this to "needs_review" is concerned, I did not change the status because I wanted to include some patches to let SAge actually use GMP rather than MPIR and even potentially being able to switch from one to the other.



---

archive/issue_comments_147749.json:
```json
{
    "body": "<a id='comment:41'></a>The only thing I can see right now that prevent sage to build with gmp out of the box is the inclusion of mpir.h instead of gmp.h in memory.c in clib.",
    "created_at": "2014-03-17T09:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147749",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>The only thing I can see right now that prevent sage to build with gmp out of the box is the inclusion of mpir.h instead of gmp.h in memory.c in clib.



---

archive/issue_comments_147750.json:
```json
{
    "body": "<a id='comment:42'></a>Flint install script should be modified as well.\nOk maybe it works without modification but passing with-gmp is better than with-mpir now that it is supported.",
    "created_at": "2014-03-17T09:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147750",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:42'></a>Flint install script should be modified as well.
Ok maybe it works without modification but passing with-gmp is better than with-mpir now that it is supported.



---

archive/issue_comments_147751.json:
```json
{
    "body": "<a id='comment:43'></a>And you should also prevent Sage from building mpir I guess.",
    "created_at": "2014-03-17T09:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147751",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:43'></a>And you should also prevent Sage from building mpir I guess.



---

archive/issue_comments_147752.json:
```json
{
    "body": "<a id='comment:44'></a>Ambitious I see. Of course I have total control in sage-on-gentoo but I would appreciate just having to switch --with-gmp or something.",
    "created_at": "2014-03-17T09:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147752",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>Ambitious I see. Of course I have total control in sage-on-gentoo but I would appreciate just having to switch --with-gmp or something.



---

archive/issue_comments_147753.json:
```json
{
    "body": "<a id='comment:45'></a>Sure.\n\nI would be ok to postpone the proper way to use gmp instead of mpir for sage the distrib in a follow up ticket.\nLet me dig up the few simple fixes needed for minimal support and push them here first.",
    "created_at": "2014-03-17T09:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147753",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:45'></a>Sure.

I would be ok to postpone the proper way to use gmp instead of mpir for sage the distrib in a follow up ticket.
Let me dig up the few simple fixes needed for minimal support and push them here first.



---

archive/issue_comments_147754.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-17T09:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147754",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_147755.json:
```json
{
    "body": "<a id='comment:46'></a>Ok so everything is in fact already here.",
    "created_at": "2014-03-17T09:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147755",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:46'></a>Ok so everything is in fact already here.



---

archive/issue_comments_147756.json:
```json
{
    "body": "<a id='comment:47'></a>Follow up at #15957.",
    "created_at": "2014-03-17T09:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147756",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:47'></a>Follow up at #15957.



---

archive/issue_comments_147757.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-03-17T10:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147757",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_147758.json:
```json
{
    "body": "<a id='comment:48'></a>I don't know that the renaming of sage_mpir_* to sage_gmp_* is necessary. In fact I am not even sure it needs to be named gmp or mpir at all. Aside from that it is all ok and conform to what we do in sage-on-gentoo. \nIt also would cross a patch and a sed from my ebuilds at least.",
    "created_at": "2014-03-17T10:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147758",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:48'></a>I don't know that the renaming of sage_mpir_* to sage_gmp_* is necessary. In fact I am not even sure it needs to be named gmp or mpir at all. Aside from that it is all ok and conform to what we do in sage-on-gentoo. 
It also would cross a patch and a sed from my ebuilds at least.



---

archive/issue_comments_147759.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-03-20T15:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12661#issuecomment-147759",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_034332.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-20T15:43:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12661",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12661#event-34332"
}
```
