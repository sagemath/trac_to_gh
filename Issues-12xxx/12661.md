# Issue 12661: Include GMP 5.1.3 as an optional package

archive/issues_012489.json:
```json
{
    "assignees": [],
    "body": "Let's package GMP 5.1.3.\n\nUpstream tarball at:\n* https://ftp.gnu.org/gnu/gmp/gmp-5.1.3.tar.bz2\n\nCC:  @nexttime @rwst\n\nKeywords: **gmp**\n\nBranch/Commit: **[a14aaf2](https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Simon King, Jean-Pierre Flori**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12661_\n\n",
    "closed_at": "2014-03-20T15:43:43Z",
    "created_at": "2012-03-13T10:00:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Include GMP 5.1.3 as an optional package",
    "type": "issue",
    "updated_at": "2014-03-20T15:43:43Z",
    "url": "https://github.com/sagemath/sage/issues/12661",
    "user": "https://github.com/simon-king-jena"
}
```
Let's package GMP 5.1.3.

Upstream tarball at:
* https://ftp.gnu.org/gnu/gmp/gmp-5.1.3.tar.bz2

CC:  @nexttime @rwst

Keywords: **gmp**

Branch/Commit: **[a14aaf2](https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e)**

Reviewer: **François Bissey**

Author: **Simon King, Jean-Pierre Flori**

_Issue created by migration from https://trac.sagemath.org/ticket/12661_





---

archive/issue_events_159251.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-03-13T10:00:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159251"
}
```



---

archive/issue_events_159252.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-03-13T10:00:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159252"
}
```



---

archive/issue_events_159253.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-03-13T10:00:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159253"
}
```



---

archive/issue_events_159254.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-03-13T10:00:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159254"
}
```



---

archive/issue_comments_143449.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nGoogle told me that some people suggested to \"include cstdio to obtain std::FILE\". So, I tried to add\n\n```\n#include <cstdio.h>\n```\nto gmp.h. However, after I attempted to build it, that line was gone!!\n\nCan someone explain how I can avoid that my editing the file is reverted? Perhaps I need to do my change in the \"patches\" directory?",
    "created_at": "2012-03-13T10:22:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143449",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">Comment 1</div>

Google told me that some people suggested to "include cstdio to obtain std::FILE". So, I tried to add

```
#include <cstdio.h>
```
to gmp.h. However, after I attempted to build it, that line was gone!!

Can someone explain how I can avoid that my editing the file is reverted? Perhaps I need to do my change in the "patches" directory?



---

archive/issue_comments_143450.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nYeah, I made some progress!!\n\nI found that I needed to edit `src/gmp-h.in`, and I needed to `#include <cstdio>`, but only `#if defined (__cplusplus)`.\n\nThen, building the package went beyond the point where it failed previously. However, it turns out that the gmp package requires yacc. I am insalling it now.\n\nTODO (for the moment):\n\n- Turn my changes to `src/gmp-h.in` into a patch, to be put into the `patches` directory.\n- spkg-install should check for the presence of yacc.",
    "created_at": "2012-03-13T10:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143450",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:2" align="right">Comment 2</div>

Yeah, I made some progress!!

I found that I needed to edit `src/gmp-h.in`, and I needed to `#include <cstdio>`, but only `#if defined (__cplusplus)`.

Then, building the package went beyond the point where it failed previously. However, it turns out that the gmp package requires yacc. I am insalling it now.

TODO (for the moment):

- Turn my changes to `src/gmp-h.in` into a patch, to be put into the `patches` directory.
- spkg-install should check for the presence of yacc.



---

archive/issue_comments_143451.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nHooray, the modified package builds on my openSuse laptop. However, spkg-check fails, ending with\n\n```\nMaking check in cxx\nmake[3]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\nmake  t-assign t-binary t-cast t-constr t-headers t-istream t-locale t-misc t-ops t-ostream t-prec t-rand t-ternary t-unary\nmake[4]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-assign.o t-assign.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-assign  t-assign.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \nmkdir .libs\ng++ -O2 -m64 -mtune=k8 -o .libs/t-assign t-assign.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-assign\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-binary.o t-binary.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-binary  t-binary.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-binary t-binary.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-binary\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-cast.o t-cast.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-cast  t-cast.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-cast t-cast.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-cast\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-constr.o t-constr.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-constr  t-constr.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-constr t-constr.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-constr\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-headers.o t-headers.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-headers  t-headers.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-headers t-headers.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-headers\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-istream.o t-istream.cc\n/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-istream  t-istream.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la \ng++ -O2 -m64 -mtune=k8 -o .libs/t-istream t-istream.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib\ncreating t-istream\ng++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-locale.o t-locale.cc\nt-locale.cc: In function \u2018void check_input()\u2019:\nt-locale.cc:108:26: error: \u2018abort\u2019 was not declared in this scope\nt-locale.cc:123:26: error: \u2018abort\u2019 was not declared in this scope\nt-locale.cc: In function \u2018void check_output()\u2019:\nt-locale.cc:158:18: error: \u2018abort\u2019 was not declared in this scope\nmake[4]: *** [t-locale.o] Fehler 1\nmake[4]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\nmake[3]: *** [check-am] Fehler 2\nmake[3]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'\nmake[2]: *** [check-recursive] Fehler 1\nmake[2]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests'\nmake[1]: *** [check-recursive] Fehler 1\nmake[1]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src'\nmake: *** [check] Fehler 2\n```",
    "created_at": "2012-03-13T10:59:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143451",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:3" align="right">Comment 3</div>

Hooray, the modified package builds on my openSuse laptop. However, spkg-check fails, ending with

```
Making check in cxx
make[3]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
make  t-assign t-binary t-cast t-constr t-headers t-istream t-locale t-misc t-ops t-ostream t-prec t-rand t-ternary t-unary
make[4]: Entering directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-assign.o t-assign.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-assign  t-assign.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
mkdir .libs
g++ -O2 -m64 -mtune=k8 -o .libs/t-assign t-assign.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-assign
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-binary.o t-binary.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-binary  t-binary.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-binary t-binary.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-binary
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-cast.o t-cast.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-cast  t-cast.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-cast t-cast.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-cast
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-constr.o t-constr.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-constr  t-constr.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-constr t-constr.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-constr
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-headers.o t-headers.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-headers  t-headers.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-headers t-headers.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-headers
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-istream.o t-istream.cc
/bin/sh ../../libtool --mode=link g++  -O2 -m64 -mtune=k8   -o t-istream  t-istream.o -L../../.libs ../../tests/libtests.la ../../libgmpxx.la ../../libgmp.la 
g++ -O2 -m64 -mtune=k8 -o .libs/t-istream t-istream.o  -L/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs ../../tests/.libs/libtests.a ../../.libs/libgmpxx.so /home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/.libs/libgmp.so ../../.libs/libgmp.so -Wl,--rpath -Wl,/home/simon/SAGE/sage-5.0.beta7/local/lib
creating t-istream
g++ -DHAVE_CONFIG_H -I. -I. -I../.. -I../.. -I../../tests    -O2 -m64 -mtune=k8 -c -o t-locale.o t-locale.cc
t-locale.cc: In function ‘void check_input()’:
t-locale.cc:108:26: error: ‘abort’ was not declared in this scope
t-locale.cc:123:26: error: ‘abort’ was not declared in this scope
t-locale.cc: In function ‘void check_output()’:
t-locale.cc:158:18: error: ‘abort’ was not declared in this scope
make[4]: *** [t-locale.o] Fehler 1
make[4]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
make[3]: *** [check-am] Fehler 2
make[3]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests/cxx'
make[2]: *** [check-recursive] Fehler 1
make[2]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src/tests'
make[1]: *** [check-recursive] Fehler 1
make[1]: Leaving directory `/home/simon/SAGE/sage-5.0.beta7/spkg/optional/gmp-4.2.1.p11.copy/src'
make: *** [check] Fehler 2
```



---

archive/issue_comments_143452.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nWhile I was at it, I tried to upgrade to gmp 5.0.4. Unfortunately, it complains that it can not find bdivmod.c in the path -- the old spkg contains that file in src/mpn/generic, but the original gmp 5.0.4 sources do no contain bdivmod.c in src/mpn/generic. Too bad.",
    "created_at": "2012-03-13T11:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143452",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">Comment 4</div>

While I was at it, I tried to upgrade to gmp 5.0.4. Unfortunately, it complains that it can not find bdivmod.c in the path -- the old spkg contains that file in src/mpn/generic, but the original gmp 5.0.4 sources do no contain bdivmod.c in src/mpn/generic. Too bad.



---

archive/issue_comments_143453.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nThe advantage of gmp 5.0.4 would be that the sources already include cstdio. So, no need for patching it. The problem is that 5.0.4 has removed and renamed a couple of things. For example, all files starting with the name `mullow_` are now starting with `mullo_`. The patches of the spkg need to be changed accordingly.\n\nThe gmp 5.0.4 package seems to build. Keeping my fingers crossed for the test...",
    "created_at": "2012-03-13T11:37:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143453",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:5" align="right">Comment 5</div>

The advantage of gmp 5.0.4 would be that the sources already include cstdio. So, no need for patching it. The problem is that 5.0.4 has removed and renamed a couple of things. For example, all files starting with the name `mullow_` are now starting with `mullo_`. The patches of the spkg need to be changed accordingly.

The gmp 5.0.4 package seems to build. Keeping my fingers crossed for the test...



---

archive/issue_comments_143454.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@simon-king-jena](#comment%3A5):\n> The gmp 5.0.4 package seems to build.\n\nNo, it doesn't. I get an infinite loop during configuration, it seems. `/bin/sh ./config.status --recheck` is repeated over and over again.",
    "created_at": "2012-03-13T12:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143454",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@simon-king-jena](#comment%3A5):
> The gmp 5.0.4 package seems to build.

No, it doesn't. I get an infinite loop during configuration, it seems. `/bin/sh ./config.status --recheck` is repeated over and over again.



---

archive/issue_comments_143455.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,13 @@\n-The optional gmp-4.2.1 package fails to build on my laptop,\n+The optional gmp-4.2.1 package fails to build on my openSuse laptop,\n \n-```\n-(sage subshell) linux-sqwp:sage-5.0.beta7 simon$ uname -a\n-Linux linux-sqwp.site 3.1.9-1.4-desktop #1 SMP PREEMPT Fri Jan 27 08:55:10 UTC 2012 (efb5ff4) x86_64 x86_64 x86_64 GNU/Linux\n-SAGE_ROOT=/home/simon/SAGE/sage-5.0.beta7\n-(sage subshell) linux-sqwp:sage-5.0.beta7 simon$ cat /etc/issue\n-Welcome to openSUSE 12.1 \"Asparagus\" - Kernel \\r (\\l).\n-```\n+I succeeded to fix it, in the sense that it did build. However, the tests did not pass.\n \n-Here is [the log](http://sage.math.washington.edu/home/SimonKing/logs/gmp.log) from installing the package.\n+Therefore I suggest to upgrade the optional gmp package to the latest upstream release.\n \n-Note that I have already added the `--libdir` option when spkg-install calls `./configure` (that was needed for many other packages on openSuse, see #12313), but it was not enough to solve the problem, and the error without my change looked the same.\n+It turns out that the *unpatched* upstream code installs and tests fine on my laptop. However, the old gmp spkg was massively patched, for various reasons. I don't know if all of the fixes from the old spkg went upstream.\n+\n+Therefore, I hope that some experts can check on various machines and in various settings, to see whether some of the old patches are still needed.\n+\n+Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.\n+\n+Install http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg\n``````\n",
    "created_at": "2012-03-13T13:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143455",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,13 @@
-The optional gmp-4.2.1 package fails to build on my laptop,
+The optional gmp-4.2.1 package fails to build on my openSuse laptop,
 
-```
-(sage subshell) linux-sqwp:sage-5.0.beta7 simon$ uname -a
-Linux linux-sqwp.site 3.1.9-1.4-desktop #1 SMP PREEMPT Fri Jan 27 08:55:10 UTC 2012 (efb5ff4) x86_64 x86_64 x86_64 GNU/Linux
-SAGE_ROOT=/home/simon/SAGE/sage-5.0.beta7
-(sage subshell) linux-sqwp:sage-5.0.beta7 simon$ cat /etc/issue
-Welcome to openSUSE 12.1 "Asparagus" - Kernel \r (\l).
-```
+I succeeded to fix it, in the sense that it did build. However, the tests did not pass.
 
-Here is [the log](http://sage.math.washington.edu/home/SimonKing/logs/gmp.log) from installing the package.
+Therefore I suggest to upgrade the optional gmp package to the latest upstream release.
 
-Note that I have already added the `--libdir` option when spkg-install calls `./configure` (that was needed for many other packages on openSuse, see #12313), but it was not enough to solve the problem, and the error without my change looked the same.
+It turns out that the *unpatched* upstream code installs and tests fine on my laptop. However, the old gmp spkg was massively patched, for various reasons. I don't know if all of the fixes from the old spkg went upstream.
+
+Therefore, I hope that some experts can check on various machines and in various settings, to see whether some of the old patches are still needed.
+
+Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.
+
+Install http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg
``````




---

archive/issue_events_159255.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-03-13T13:23:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "title_is": "Upgrade the optional GMP package",
    "title_was": "Fix optional gmp package on openSuse",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159255"
}
```



---

archive/issue_comments_143456.json:
```json
{
    "body": "Author: **Simon King**",
    "created_at": "2012-03-13T13:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143456",
    "user": "https://github.com/simon-king-jena"
}
```

Author: **Simon King**



---

archive/issue_comments_143457.json:
```json
{
    "body": "Changed keywords from **** to **gmp**",
    "created_at": "2012-03-13T13:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143457",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from **** to **gmp**



---

archive/issue_events_159256.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-03-13T13:23:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159256"
}
```



---

archive/issue_comments_143458.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nSee modified ticket description: It was easy to make gmp 5.0.4 build and pass all tests. Simply one has to drop all patches of the old gmp spkg.",
    "created_at": "2012-03-13T13:24:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143458",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">Comment 8</div>

See modified ticket description: It was easy to make gmp 5.0.4 build and pass all tests. Simply one has to drop all patches of the old gmp spkg.



---

archive/issue_comments_143459.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nA related ticket: #12661 (optional `CLooG` spkg).\n\n`CLooG` needs gmp to build.",
    "created_at": "2012-03-13T20:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143459",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">Comment 9</div>

A related ticket: #12661 (optional `CLooG` spkg).

`CLooG` needs gmp to build.



---

archive/issue_comments_143460.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@simon-king-jena](#comment%3A9):\n> `CLooG` needs gmp to build.\n\n[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/ee5cfaef02dc30ac) claims that `CLooG` could also be built with MPIR rather than GMP.\n\nAnyway. Since the current spkg is broken (at least on openSuse), I still think we should upgrade. But people need to test on different platforms.",
    "created_at": "2012-03-15T08:24:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143460",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@simon-king-jena](#comment%3A9):
> `CLooG` needs gmp to build.

[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/ee5cfaef02dc30ac) claims that `CLooG` could also be built with MPIR rather than GMP.

Anyway. Since the current spkg is broken (at least on openSuse), I still think we should upgrade. But people need to test on different platforms.



---

archive/issue_comments_143461.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n \n Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.\n \n-Install http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg\n+**spkg**: [http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)\n``````\n",
    "created_at": "2012-03-15T08:27:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143461",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 
 Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.
 
-Install http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg
+**spkg**: [http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)
``````




---

archive/issue_comments_143462.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n \n Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.\n \n-**spkg**: [http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)\n``````\n",
    "created_at": "2012-03-15T08:28:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143462",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 
 Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.
 
-**spkg**: [http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)
``````




---

archive/issue_comments_143463.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nFWIW, I did build Sage against GMP (5.0.1 or 5.0.2) a couple of times in 2010 (when we made the \"first big PARI upgrade\") and never ran into any problems, except for the Lcalc spkg, which was the only one explicitly using `-lmpir` instead of `-lgmp`, an issue which AFAIK meanwhile is fixed.\n\nAlthough I looked at the (btw. completely outdated) optional GMP spkg (on other occasions as well), I didn't use any of it, in particular didn't apply any additional patches to the more recent GMP versions.\n\n---\n\nWe'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, as newer (2.x, but IIRC only the most recent) versions of FLINT use some *MPIR* internals GMP doesn't provide, or at least isn't compatible with.\n\nBut for the moment it should be ok to use GMP instead, although (for CLooG) this shouldn't be necessary.\n\n(In contrast, as Dima recently mentioned on sage-devel and mpir-devel, GAP uses some GMP internals MPIR currently doesn't provide.  The [older?] version of GAP we use apparently works with MPIR... :-) )",
    "created_at": "2012-03-15T09:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143463",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">Comment 13</div>

FWIW, I did build Sage against GMP (5.0.1 or 5.0.2) a couple of times in 2010 (when we made the "first big PARI upgrade") and never ran into any problems, except for the Lcalc spkg, which was the only one explicitly using `-lmpir` instead of `-lgmp`, an issue which AFAIK meanwhile is fixed.

Although I looked at the (btw. completely outdated) optional GMP spkg (on other occasions as well), I didn't use any of it, in particular didn't apply any additional patches to the more recent GMP versions.

---

We'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, as newer (2.x, but IIRC only the most recent) versions of FLINT use some *MPIR* internals GMP doesn't provide, or at least isn't compatible with.

But for the moment it should be ok to use GMP instead, although (for CLooG) this shouldn't be necessary.

(In contrast, as Dima recently mentioned on sage-devel and mpir-devel, GAP uses some GMP internals MPIR currently doesn't provide.  The [older?] version of GAP we use apparently works with MPIR... :-) )



---

archive/issue_comments_143464.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nReplying to [@nexttime](#comment%3A13):\n> Although I looked at the (btw. completely outdated) optional GMP spkg ...\n\nYes, that's what this ticket is about.\n\n> in particular didn't apply any additional patches to the more recent GMP versions.\n\nI'm not using any patches either. The question is whether other platforms (Solaris? OS X?) need patches.\n\n> We'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, \n\nWhen I first tried to build the optional gcc from #12369 with graphite (hence, together with the optional cloog-ppl package from #12666), I thought that cloog-ppl needs GMP (not MPIR). This is why I opened this ticket in the first place.\n\nI found a massive *slow-down* when I built sage with the optimizations provided by graphite. Big surprise. But some people suggested that the culprit might in fact be GMP. So, I am started over. I can not tell yet whether Sage is faster with MPIR than with GMP. However, GMP is definitely not required by cloog-ppl, which lessens the priority of this ticket considerably, from my perspective...",
    "created_at": "2012-03-15T19:19:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143464",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">Comment 14</div>

Replying to [@nexttime](#comment%3A13):
> Although I looked at the (btw. completely outdated) optional GMP spkg ...

Yes, that's what this ticket is about.

> in particular didn't apply any additional patches to the more recent GMP versions.

I'm not using any patches either. The question is whether other platforms (Solaris? OS X?) need patches.

> We'll probably only run into trouble with using GMP instead of MPIR the day we upgrade FLINT, 

When I first tried to build the optional gcc from #12369 with graphite (hence, together with the optional cloog-ppl package from #12666), I thought that cloog-ppl needs GMP (not MPIR). This is why I opened this ticket in the first place.

I found a massive *slow-down* when I built sage with the optimizations provided by graphite. Big surprise. But some people suggested that the culprit might in fact be GMP. So, I am started over. I can not tell yet whether Sage is faster with MPIR than with GMP. However, GMP is definitely not required by cloog-ppl, which lessens the priority of this ticket considerably, from my perspective...



---

archive/issue_comments_143465.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nBuilding the new gmp spkg here on Mac OS X (with gcc 4.6.3) with SAGE_CHECK=yes succeeds and passess all tests!",
    "created_at": "2012-05-26T04:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143465",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:15" align="right">Comment 15</div>

Building the new gmp spkg here on Mac OS X (with gcc 4.6.3) with SAGE_CHECK=yes succeeds and passess all tests!



---

archive/issue_comments_143466.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nGMP 5.0.5 is out since a while...",
    "created_at": "2012-07-28T13:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143466",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:16" align="right">Comment 16</div>

GMP 5.0.5 is out since a while...



---

archive/issue_comments_143467.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nReplying to [@nexttime](#comment%3A16):\n> GMP 5.0.5 is out since a while...\n\nThis ticket is open since a while...",
    "created_at": "2012-07-28T14:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143467",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">Comment 17</div>

Replying to [@nexttime](#comment%3A16):
> GMP 5.0.5 is out since a while...

This ticket is open since a while...



---

archive/issue_comments_143468.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@simon-king-jena](#comment%3A17):\n> Replying to [@nexttime](#comment%3A16):\n> > GMP 5.0.5 is out since a while...\n\n> \n> This ticket is open since a while...\n\nI was wanting to review it since a while...",
    "created_at": "2012-07-28T14:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143468",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@simon-king-jena](#comment%3A17):
> Replying to [@nexttime](#comment%3A16):
> > GMP 5.0.5 is out since a while...

> 
> This ticket is open since a while...

I was wanting to review it since a while...



---

archive/issue_events_159257.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159257"
}
```



---

archive/issue_events_159258.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159258"
}
```



---

archive/issue_comments_143469.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\ngmp 5.1.x is out and transition to git is needed if we want to keep gmp in sage.",
    "created_at": "2013-12-26T19:41:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143469",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">Comment 20</div>

gmp 5.1.x is out and transition to git is needed if we want to keep gmp in sage.



---

archive/issue_comments_143470.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nYup, also note that FLINT >= 2.4 can now be built on top of GMP.\nIIRC it's the only spkg which explicitely depended on MPIR.",
    "created_at": "2014-01-03T13:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143470",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:21" align="right">Comment 21</div>

Yup, also note that FLINT >= 2.4 can now be built on top of GMP.
IIRC it's the only spkg which explicitely depended on MPIR.



---

archive/issue_events_159259.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159259"
}
```



---

archive/issue_events_159260.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159260"
}
```



---

archive/issue_comments_143471.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nAlso, mpir was not updated since Nov 2012. However gmp isn't even in optional now, so a new ticket would have to be opened to include it.",
    "created_at": "2014-02-15T16:51:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143471",
    "user": "https://github.com/rwst"
}
```

<div id="comment:23" align="right">Comment 23</div>

Also, mpir was not updated since Nov 2012. However gmp isn't even in optional now, so a new ticket would have to be opened to include it.



---

archive/issue_events_159261.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-21T11:03:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "title_is": "include GMP as optional package",
    "title_was": "Upgrade the optional GMP package",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159261"
}
```



---

archive/issue_events_159262.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-21T11:03:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159262"
}
```



---

archive/issue_events_159263.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-21T11:03:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159263"
}
```



---

archive/issue_events_159264.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-21T11:03:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159264"
}
```



---

archive/issue_events_159265.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-21T11:03:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159265"
}
```



---

archive/issue_comments_143472.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,7 @@\n+gmp is no longer in Sage!\n+\n+The ticket tried to upgrade it when it was there:\n+\n The optional gmp-4.2.1 package fails to build on my openSuse laptop,\n \n I succeeded to fix it, in the sense that it did build. However, the tests did not pass.\n``````\n",
    "created_at": "2014-02-21T11:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143472",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,7 @@
+gmp is no longer in Sage!
+
+The ticket tried to upgrade it when it was there:
+
 The optional gmp-4.2.1 package fails to build on my openSuse laptop,
 
 I succeeded to fix it, in the sense that it did build. However, the tests did not pass.
``````




---

archive/issue_comments_143473.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,4 @@\n-gmp is no longer in Sage!\n+Let's package GMP 5.1.3.\n \n-The ticket tried to upgrade it when it was there:\n-\n-The optional gmp-4.2.1 package fails to build on my openSuse laptop,\n-\n-I succeeded to fix it, in the sense that it did build. However, the tests did not pass.\n-\n-Therefore I suggest to upgrade the optional gmp package to the latest upstream release.\n-\n-It turns out that the *unpatched* upstream code installs and tests fine on my laptop. However, the old gmp spkg was massively patched, for various reasons. I don't know if all of the fixes from the old spkg went upstream.\n-\n-Therefore, I hope that some experts can check on various machines and in various settings, to see whether some of the old patches are still needed.\n-\n-Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.\n-\n-**spkg**: [http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)\n+Upstream tarball at:\n+* https://ftp.gnu.org/gnu/gmp/gmp-5.1.3.tar.bz2\n``````\n",
    "created_at": "2014-02-27T10:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143473",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,4 @@
-gmp is no longer in Sage!
+Let's package GMP 5.1.3.
 
-The ticket tried to upgrade it when it was there:
-
-The optional gmp-4.2.1 package fails to build on my openSuse laptop,
-
-I succeeded to fix it, in the sense that it did build. However, the tests did not pass.
-
-Therefore I suggest to upgrade the optional gmp package to the latest upstream release.
-
-It turns out that the *unpatched* upstream code installs and tests fine on my laptop. However, the old gmp spkg was massively patched, for various reasons. I don't know if all of the fixes from the old spkg went upstream.
-
-Therefore, I hope that some experts can check on various machines and in various settings, to see whether some of the old patches are still needed.
-
-Note that the old `SPKG.txt` remarks that the spkg-install of the optional polymake spkg needs to be updated, if gmp is upgraded. I hope that someone can do that.
-
-**spkg**: [http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/gmp-5.0.4.spkg)
+Upstream tarball at:
+* https://ftp.gnu.org/gnu/gmp/gmp-5.1.3.tar.bz2
``````




---

archive/issue_events_159266.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-02-27T10:58:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "title_is": "Include GMP 5.1.3 as an optional package",
    "title_was": "include GMP as optional package",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159266"
}
```



---

archive/issue_events_159267.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-02-27T10:58:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159267"
}
```



---

archive/issue_events_159268.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-02-27T10:58:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159268"
}
```



---

archive/issue_comments_143474.json:
```json
{
    "body": "Branch: **[u/jpflori/ticket/12661](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/12661)**",
    "created_at": "2014-02-27T10:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143474",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Branch: **[u/jpflori/ticket/12661](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/12661)**



---

archive/issue_events_159269.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-02-27T10:58:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159269"
}
```



---

archive/issue_events_159270.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-02-27T10:58:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159270"
}
```



---

archive/issue_comments_143475.json:
```json
{
    "body": "Commit: **[2c34755](https://github.com/sagemath/sagetrac-mirror/commit/2c34755c939f42814dd31047b98c5aeda84b9a29)**",
    "created_at": "2014-02-27T11:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143475",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[2c34755](https://github.com/sagemath/sagetrac-mirror/commit/2c34755c939f42814dd31047b98c5aeda84b9a29)**



---

archive/issue_comments_143476.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c34755c939f42814dd31047b98c5aeda84b9a29\">2c34755</a></td><td><code>Initial commit for GMP 5.1.3.</code></td></tr></table>\n",
    "created_at": "2014-02-27T11:19:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143476",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27" align="right">Comment 27</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c34755c939f42814dd31047b98c5aeda84b9a29">2c34755</a></td><td><code>Initial commit for GMP 5.1.3.</code></td></tr></table>




---

archive/issue_comments_143477.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nProblems with farey_symbol.pyx which uses additional c++ source files (farey.cpp and sl2z.cpp) but cython wants to compile them with CC and that fails when GMP is used underneath.\nNot sure why it succeeded on top of MPIR.",
    "created_at": "2014-02-27T11:20:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143477",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:28" align="right">Comment 28</div>

Problems with farey_symbol.pyx which uses additional c++ source files (farey.cpp and sl2z.cpp) but cython wants to compile them with CC and that fails when GMP is used underneath.
Not sure why it succeeded on top of MPIR.



---

archive/issue_comments_143478.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nAnyway, it also fails with CXX:\n\n```\ng++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w\nsage/modular/arithgroup/farey.cpp: In function \u2018mpz_class floor(mpq_class)\u2019:\nsage/modular/arithgroup/farey.cpp:147:44: error: conversion from \u2018mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}\u2019 to non-scalar type \u2018mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}\u2019 requested\n```",
    "created_at": "2014-02-27T11:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143478",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:29" align="right">Comment 29</div>

Anyway, it also fails with CXX:

```
g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w
sage/modular/arithgroup/farey.cpp: In function ‘mpz_class floor(mpq_class)’:
sage/modular/arithgroup/farey.cpp:147:44: error: conversion from ‘mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}’ to non-scalar type ‘mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}’ requested
```



---

archive/issue_comments_143479.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nSimilar probledm and solution here:\n* https://bugs.kde.org/show_bug.cgi?id=312481",
    "created_at": "2014-02-27T11:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143479",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:30" align="right">Comment 30</div>

Similar probledm and solution here:
* https://bugs.kde.org/show_bug.cgi?id=312481



---

archive/issue_comments_143480.json:
```json
{
    "body": "Changed commit from **[2c34755](https://github.com/sagemath/sagetrac-mirror/commit/2c34755c939f42814dd31047b98c5aeda84b9a29)** to **[a14aaf2](https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e)**",
    "created_at": "2014-02-27T13:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143480",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2c34755](https://github.com/sagemath/sagetrac-mirror/commit/2c34755c939f42814dd31047b98c5aeda84b9a29)** to **[a14aaf2](https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e)**



---

archive/issue_comments_143481.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e\">a14aaf2</a></td><td><code>Explicit conversion in farey.cpp as recent GMP do not do it automatically.</code></td></tr></table>\n",
    "created_at": "2014-02-27T13:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143481",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31" align="right">Comment 31</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e">a14aaf2</a></td><td><code>Explicit conversion in farey.cpp as recent GMP do not do it automatically.</code></td></tr></table>




---

archive/issue_comments_143482.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@sagetrac-jpflori](#comment%3A29):\n> Anyway, it also fails with CXX:\n> \n> ```\n> g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w\n> sage/modular/arithgroup/farey.cpp: In function \u2018mpz_class floor(mpq_class)\u2019:\n> sage/modular/arithgroup/farey.cpp:147:44: error: conversion from \u2018mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}\u2019 to non-scalar type \u2018mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}\u2019 requested\n> ```\n\nSorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.",
    "created_at": "2014-02-27T17:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143482",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@sagetrac-jpflori](#comment%3A29):
> Anyway, it also fails with CXX:
> 
> ```
> g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w
> sage/modular/arithgroup/farey.cpp: In function ‘mpz_class floor(mpq_class)’:
> sage/modular/arithgroup/farey.cpp:147:44: error: conversion from ‘mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}’ to non-scalar type ‘mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}’ requested
> ```

Sorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.



---

archive/issue_comments_143483.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nReplying to [@kiwifb](#comment%3A32):\n> Replying to [@sagetrac-jpflori](#comment%3A29):\n> > Anyway, it also fails with CXX:\n> > \n> > ```\n> > g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w\n> > sage/modular/arithgroup/farey.cpp: In function \u2018mpz_class floor(mpq_class)\u2019:\n> > sage/modular/arithgroup/farey.cpp:147:44: error: conversion from \u2018mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}\u2019 to non-scalar type \u2018mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}\u2019 requested\n> > ```\n\n> Sorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.\n\nNo problem, I found the solution more than easily on the web.\n\nAny other suggestion from sage-on-gentoo?\nE.g., do you have devised any simple way to switch from gmp to mpir and back again easily?\nOr are you really stuck with gmp and cannot use mpir? (that would be strange.)",
    "created_at": "2014-02-28T09:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143483",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:33" align="right">Comment 33</div>

Replying to [@kiwifb](#comment%3A32):
> Replying to [@sagetrac-jpflori](#comment%3A29):
> > Anyway, it also fails with CXX:
> > 
> > ```
> > g++ -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include -I/home/jpflori/sage.git/local/include/csage -I/home/jpflori/sage.git/src -I/home/jpflori/sage.git/src/sage/ext -I/home/jpflori/sage.git/local/include/python2.7 -c sage/modular/arithgroup/farey.cpp -o build/temp.linux-ppc64-2.7/sage/modular/arithgroup/farey.o -fno-strict-aliasing -w
> > sage/modular/arithgroup/farey.cpp: In function ‘mpz_class floor(mpq_class)’:
> > sage/modular/arithgroup/farey.cpp:147:44: error: conversion from ‘mpq_class {aka __gmp_expr<__mpq_struct [1], __mpq_struct [1]>}’ to non-scalar type ‘mpz_class {aka __gmp_expr<__mpz_struct [1], __mpz_struct [1]>}’ requested
> > ```

> Sorry we could have warned you about that since sage-on-gentoo is stuck on gmp we knew about this and how to fix it.

No problem, I found the solution more than easily on the web.

Any other suggestion from sage-on-gentoo?
E.g., do you have devised any simple way to switch from gmp to mpir and back again easily?
Or are you really stuck with gmp and cannot use mpir? (that would be strange.)



---

archive/issue_comments_143484.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nWe are really stuck with gmp unless we make great effort. It is complicated because most of the package of the tree will depend on gmp and few will use mpir directly, at some point I tried to port a lot of ebuild to mpir directly but it was a bit unsustainable. The easiest way is to use the gmp compatibility layer from mpir. Then we have to convince the toolchain people that we should have the possibility of switching between gmp and mpir to build gcc. Then we need to replace all dependencies to gmp in the tree by some virtual package which can be either gmp or mpir passing as gmp. That's a ton of work, require convincing people and so on.\n\nif all package in sage could be configured with either real gmp or real mpir out of the box we may be able to do some easy switching between the two but it is not the case.\nlmona.de could go its own way and use mpir exclusively if they wanted too (by calling it gmp mainly).",
    "created_at": "2014-02-28T10:09:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143484",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34" align="right">Comment 34</div>

We are really stuck with gmp unless we make great effort. It is complicated because most of the package of the tree will depend on gmp and few will use mpir directly, at some point I tried to port a lot of ebuild to mpir directly but it was a bit unsustainable. The easiest way is to use the gmp compatibility layer from mpir. Then we have to convince the toolchain people that we should have the possibility of switching between gmp and mpir to build gcc. Then we need to replace all dependencies to gmp in the tree by some virtual package which can be either gmp or mpir passing as gmp. That's a ton of work, require convincing people and so on.

if all package in sage could be configured with either real gmp or real mpir out of the box we may be able to do some easy switching between the two but it is not the case.
lmona.de could go its own way and use mpir exclusively if they wanted too (by calling it gmp mainly).



---

archive/issue_comments_143485.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nFTR here are the only failing doctests:\n\n```\nsage -t --long src/sage/rings/integer.pyx\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 1955, in sage.rings.integer.Integer.__pow__\nFailed example:\n    2^(2^63-2)\nExpected:\n    Traceback (most recent call last):\n    ...\n    MemoryError: failed to allocate 1152921504606847008 bytes\nGot:\n    gmp: overflow in mpz type   \n    Traceback (most recent call last):\n      File \"/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo\nrker.py\", line 480, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo\nrker.py\", line 839, in execute  \n        exec compiled in globs  \n      File \"<doctest sage.rings.integer.Integer.__pow__[27]>\", line 1, in <module>\n        Integer(2)**(Integer(2)**Integer(63)-Integer(2))\n      File \"integer.pyx\", line 1994, in sage.rings.integer.Integer.__pow__ (sage/rin\ngs/integer.c:14075)\n      File \"c_lib.pyx\", line 85, in sage.ext.c_lib.sig_raise_exception (sage/ext/c_l\nib.c:1009)\n    RuntimeError: Aborted\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 5401, in sage.rings.integer.Integer._xgcd\nFailed example:\n    2._xgcd(-2)\nExpected:\n    (2, 1, 0)\nGot:\n    (2, 0, -1)\n**********************************************************************\n```\nand\n\n```\nsage -t --long src/sage/tests/book_stein_modform.py\n**********************************************************************\nFile \"src/sage/tests/book_stein_modform.py\", line 94, in sage.tests.book_stein_modform\nFailed example:\n    [x.lift_to_sl2z(2) for x in M.manin_generators()]\nExpected:\n    [[1, 0, 0, 1], [0, -1, 1, 0], [0, -1, 1, 1]]\nGot:\n    [[1, 0, 0, 1], [0, -1, 1, 0], [1, 0, 1, 1]]\n**********************************************************************\n```",
    "created_at": "2014-02-28T10:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143485",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:35" align="right">Comment 35</div>

FTR here are the only failing doctests:

```
sage -t --long src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 1955, in sage.rings.integer.Integer.__pow__
Failed example:
    2^(2^63-2)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: failed to allocate 1152921504606847008 bytes
Got:
    gmp: overflow in mpz type   
    Traceback (most recent call last):
      File "/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo
rker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jpflori/sage.git/local/lib/python2.7/site-packages/sage/doctest/fo
rker.py", line 839, in execute  
        exec compiled in globs  
      File "<doctest sage.rings.integer.Integer.__pow__[27]>", line 1, in <module>
        Integer(2)**(Integer(2)**Integer(63)-Integer(2))
      File "integer.pyx", line 1994, in sage.rings.integer.Integer.__pow__ (sage/rin
gs/integer.c:14075)
      File "c_lib.pyx", line 85, in sage.ext.c_lib.sig_raise_exception (sage/ext/c_l
ib.c:1009)
    RuntimeError: Aborted
**********************************************************************
File "src/sage/rings/integer.pyx", line 5401, in sage.rings.integer.Integer._xgcd
Failed example:
    2._xgcd(-2)
Expected:
    (2, 1, 0)
Got:
    (2, 0, -1)
**********************************************************************
```
and

```
sage -t --long src/sage/tests/book_stein_modform.py
**********************************************************************
File "src/sage/tests/book_stein_modform.py", line 94, in sage.tests.book_stein_modform
Failed example:
    [x.lift_to_sl2z(2) for x in M.manin_generators()]
Expected:
    [[1, 0, 0, 1], [0, -1, 1, 0], [0, -1, 1, 1]]
Got:
    [[1, 0, 0, 1], [0, -1, 1, 0], [1, 0, 1, 1]]
**********************************************************************
```



---

archive/issue_comments_143486.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nI got the first one in sage/rings/integer.pyx and knew it was from gmp vs mpir. I also have sage/tests/book_stein_modform.py but I didn't know it was originating from gmp vs mpir. I don't have the second failure in integer.pyx it may be because I am currently only at gmp 5.1.2.",
    "created_at": "2014-02-28T11:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143486",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">Comment 36</div>

I got the first one in sage/rings/integer.pyx and knew it was from gmp vs mpir. I also have sage/tests/book_stein_modform.py but I didn't know it was originating from gmp vs mpir. I don't have the second failure in integer.pyx it may be because I am currently only at gmp 5.1.2.



---

archive/issue_comments_143487.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nThe ones in integer.pyx are really harmless anyway.\n\nNot sure about the one in the Manin generators computation, so I could be easily convinced it is innocuous as well.",
    "created_at": "2014-02-28T11:05:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143487",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:37" align="right">Comment 37</div>

The ones in integer.pyx are really harmless anyway.

Not sure about the one in the Manin generators computation, so I could be easily convinced it is innocuous as well.



---

archive/issue_comments_143488.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nActually I got the second one in integer.pyx. It wasn't present when I last made a record of doctests failures in sage-on-gentoo for sage 6.0, but it is in 6.2.beta2.",
    "created_at": "2014-02-28T18:36:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143488",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">Comment 38</div>

Actually I got the second one in integer.pyx. It wasn't present when I last made a record of doctests failures in sage-on-gentoo for sage 6.0, but it is in 6.2.beta2.



---

archive/issue_comments_143489.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nAny reason why this is still stuck at \"need work\"? I can give this a positive review, fixing the doctests to work with gmp is probably more work than it is worth. Especially the top one in integer.pyx.\n\nOpinions?",
    "created_at": "2014-03-15T06:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143489",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:39" align="right">Comment 39</div>

Any reason why this is still stuck at "need work"? I can give this a positive review, fixing the doctests to work with gmp is probably more work than it is worth. Especially the top one in integer.pyx.

Opinions?



---

archive/issue_comments_143490.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nI agree that I can live with the failing doctests.\n\nAs far as setting this to \"needs_review\" is concerned, I did not change the status because I wanted to include some patches to let SAge actually use GMP rather than MPIR and even potentially being able to switch from one to the other.",
    "created_at": "2014-03-17T09:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143490",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:40" align="right">Comment 40</div>

I agree that I can live with the failing doctests.

As far as setting this to "needs_review" is concerned, I did not change the status because I wanted to include some patches to let SAge actually use GMP rather than MPIR and even potentially being able to switch from one to the other.



---

archive/issue_comments_143491.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nThe only thing I can see right now that prevent sage to build with gmp out of the box is the inclusion of mpir.h instead of gmp.h in memory.c in clib.",
    "created_at": "2014-03-17T09:32:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143491",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">Comment 41</div>

The only thing I can see right now that prevent sage to build with gmp out of the box is the inclusion of mpir.h instead of gmp.h in memory.c in clib.



---

archive/issue_comments_143492.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nFlint install script should be modified as well.\nOk maybe it works without modification but passing with-gmp is better than with-mpir now that it is supported.",
    "created_at": "2014-03-17T09:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143492",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:42" align="right">Comment 42</div>

Flint install script should be modified as well.
Ok maybe it works without modification but passing with-gmp is better than with-mpir now that it is supported.



---

archive/issue_comments_143493.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nAnd you should also prevent Sage from building mpir I guess.",
    "created_at": "2014-03-17T09:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143493",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:43" align="right">Comment 43</div>

And you should also prevent Sage from building mpir I guess.



---

archive/issue_comments_143494.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nAmbitious I see. Of course I have total control in sage-on-gentoo but I would appreciate just having to switch --with-gmp or something.",
    "created_at": "2014-03-17T09:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143494",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:44" align="right">Comment 44</div>

Ambitious I see. Of course I have total control in sage-on-gentoo but I would appreciate just having to switch --with-gmp or something.



---

archive/issue_comments_143495.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nSure.\n\nI would be ok to postpone the proper way to use gmp instead of mpir for sage the distrib in a follow up ticket.\nLet me dig up the few simple fixes needed for minimal support and push them here first.",
    "created_at": "2014-03-17T09:41:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143495",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:45" align="right">Comment 45</div>

Sure.

I would be ok to postpone the proper way to use gmp instead of mpir for sage the distrib in a follow up ticket.
Let me dig up the few simple fixes needed for minimal support and push them here first.



---

archive/issue_events_159271.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-03-17T09:54:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159271"
}
```



---

archive/issue_events_159272.json:
```json
{
    "actor": "https://github.com/sagetrac-jpflori",
    "created_at": "2014-03-17T09:54:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159272"
}
```



---

archive/issue_comments_143496.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nOk so everything is in fact already here.",
    "created_at": "2014-03-17T09:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143496",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:46" align="right">Comment 46</div>

Ok so everything is in fact already here.



---

archive/issue_comments_143497.json:
```json
{
    "body": "Changed author from **Simon King** to **Simon King, Jean-Pierre Flori**",
    "created_at": "2014-03-17T09:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143497",
    "user": "https://github.com/sagetrac-jpflori"
}
```

Changed author from **Simon King** to **Simon King, Jean-Pierre Flori**



---

archive/issue_comments_143498.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nFollow up at #15957.",
    "created_at": "2014-03-17T09:56:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143498",
    "user": "https://github.com/sagetrac-jpflori"
}
```

<div id="comment:47" align="right">Comment 47</div>

Follow up at #15957.



---

archive/issue_comments_143499.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2014-03-17T10:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143499",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **François Bissey**



---

archive/issue_events_159273.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2014-03-17T10:04:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159273"
}
```



---

archive/issue_events_159274.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2014-03-17T10:04:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159274"
}
```



---

archive/issue_comments_143500.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nI don't know that the renaming of sage_mpir_* to sage_gmp_* is necessary. In fact I am not even sure it needs to be named gmp or mpir at all. Aside from that it is all ok and conform to what we do in sage-on-gentoo. \nIt also would cross a patch and a sed from my ebuilds at least.",
    "created_at": "2014-03-17T10:04:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143500",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:48" align="right">Comment 48</div>

I don't know that the renaming of sage_mpir_* to sage_gmp_* is necessary. In fact I am not even sure it needs to be named gmp or mpir at all. Aside from that it is all ok and conform to what we do in sage-on-gentoo. 
It also would cross a patch and a sed from my ebuilds at least.



---

archive/issue_comments_143501.json:
```json
{
    "body": "Changed branch from **[u/jpflori/ticket/12661](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/12661)** to **[a14aaf2](https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e)**",
    "created_at": "2014-03-20T15:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12661#issuecomment-143501",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jpflori/ticket/12661](https://github.com/sagemath/sagetrac-mirror/tree/u/jpflori/ticket/12661)** to **[a14aaf2](https://github.com/sagemath/sagetrac-mirror/commit/a14aaf2fd94252c0e263c8b02003f8c640d70e0e)**



---

archive/issue_events_159275.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-03-20T15:43:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159275"
}
```



---

archive/issue_events_159276.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d59db5bbfbd9d4082ac74dcb9523b13df45d5ca5",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-03-20T15:43:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12661",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12661#event-159276"
}
```
