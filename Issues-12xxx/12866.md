# Issue 12866: Bug in Sage's monodromy pairing on elements of Brandt modules

archive/issues_012694.json:
```json
{
    "body": "\nIn Magma:\n\n```\nBr:=BrandtModule(2,7);\ng:=Br.1-Br.2;\nInnerProduct(g,g);\n6\n```\nIn Sage:\n\n```\nBr = BrandtModule(2,7)\ng1,g2 = Br.basis()\ng = g1-g2\nprint g1,g2\nprint g.monodromy_pairing(g)\n(1, 0) (0, 1)\n2\n```\n\nAssignee: @craigcitro\n\nKeywords: Brandt module, monodromy pairing\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Aly Deines, Gonzalo Tornar\u00eda\n\nBranch: 448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12866\n\n",
    "closed_at": "2016-08-07T20:01:49Z",
    "created_at": "2012-04-21T21:08:48Z",
    "labels": [
        "component: modular forms",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Bug in Sage's monodromy pairing on elements of Brandt modules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12866",
    "user": "https://github.com/adeines"
}
```

In Magma:

```
Br:=BrandtModule(2,7);
g:=Br.1-Br.2;
InnerProduct(g,g);
6
```
In Sage:

```
Br = BrandtModule(2,7)
g1,g2 = Br.basis()
g = g1-g2
print g1,g2
print g.monodromy_pairing(g)
(1, 0) (0, 1)
2
```

Assignee: @craigcitro

Keywords: Brandt module, monodromy pairing

Reviewer: Frédéric Chapoton

Author: Aly Deines, Gonzalo Tornaría

Branch: 448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12866





---

archive/issue_events_035069.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35069"
}
```



---

archive/issue_comments_187783.json:
```json
{
    "body": "Changing branch from \"\" to \"u/aly.deines/ticket/12866\"",
    "created_at": "2014-01-04T18:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187783",
    "user": "https://github.com/adeines"
}
```

Changing branch from "" to "u/aly.deines/ticket/12866"



---

archive/issue_events_035070.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35070"
}
```



---

archive/issue_events_035071.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35071"
}
```



---

archive/issue_events_035072.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35072"
}
```



---

archive/issue_events_035073.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35073"
}
```



---

archive/issue_events_035074.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35074"
}
```



---

archive/issue_events_035075.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35075"
}
```



---

archive/issue_comments_187784.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-26T02:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187784",
    "user": "https://github.com/tornaria"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187785.json:
```json
{
    "body": "Changing branch from \"u/aly.deines/ticket/12866\" to \"u/tornaria/ticket/12866\"",
    "created_at": "2014-08-26T02:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187785",
    "user": "https://github.com/tornaria"
}
```

Changing branch from "u/aly.deines/ticket/12866" to "u/tornaria/ticket/12866"



---

archive/issue_comments_187786.json:
```json
{
    "body": "Changing commit from \"\" to \"cede6e19f33191c6542490a67adb729564b6c627\"",
    "created_at": "2014-08-26T02:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187786",
    "user": "https://github.com/tornaria"
}
```

Changing commit from "" to "cede6e19f33191c6542490a67adb729564b6c627"



---

archive/issue_comments_187787.json:
```json
{
    "body": "<a id='comment:6'></a>\nI rebased Aly's patch to sage-6.4.beta1. I added a series of commits to fix a typo in her patch, add some explanation of the computation that is being done, and then an asymptotic improvement so that the monodromy pairing can be computed in O(n) rather than O(n<sup>2</sup>) ideal computations.\n\n---\nNew commits:\n|                                                                                                                                          |                                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[2f56770](http://git.sagemath.org/sage.git/commit/?id=2f5677047027819cc4362c4fdde124ee6efeadfd)|`Fixed Brandt module monodromy weights.`|\n|[1891ad3](http://git.sagemath.org/sage.git/commit/?id=1891ad38cdc511a629f957a7f15cd4da380414ba)|`Fix Aly patch for Brandt module monodromy weights.`|\n|[1fead1d](http://git.sagemath.org/sage.git/commit/?id=1fead1d6bbf4cf31bdc5b22029810ace83a70427)|`Brandt modules: extend _ideal_products() method`|\n|[cede6e1](http://git.sagemath.org/sage.git/commit/?id=cede6e19f33191c6542490a67adb729564b6c627)|`Trac 12866: improve asymptotic of monodromy_weights()`|",
    "created_at": "2014-08-26T02:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187787",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:6'></a>
I rebased Aly's patch to sage-6.4.beta1. I added a series of commits to fix a typo in her patch, add some explanation of the computation that is being done, and then an asymptotic improvement so that the monodromy pairing can be computed in O(n) rather than O(n<sup>2</sup>) ideal computations.

---
New commits:
|                                                                                                                                          |                                        |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[2f56770](http://git.sagemath.org/sage.git/commit/?id=2f5677047027819cc4362c4fdde124ee6efeadfd)|`Fixed Brandt module monodromy weights.`|
|[1891ad3](http://git.sagemath.org/sage.git/commit/?id=1891ad38cdc511a629f957a7f15cd4da380414ba)|`Fix Aly patch for Brandt module monodromy weights.`|
|[1fead1d](http://git.sagemath.org/sage.git/commit/?id=1fead1d6bbf4cf31bdc5b22029810ace83a70427)|`Brandt modules: extend _ideal_products() method`|
|[cede6e1](http://git.sagemath.org/sage.git/commit/?id=cede6e19f33191c6542490a67adb729564b6c627)|`Trac 12866: improve asymptotic of monodromy_weights()`|



---

archive/issue_comments_187788.json:
```json
{
    "body": "Changing author from \"\" to \"aly.deines, tornaria\"",
    "created_at": "2014-08-26T02:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187788",
    "user": "https://github.com/tornaria"
}
```

Changing author from "" to "aly.deines, tornaria"



---

archive/issue_comments_187789.json:
```json
{
    "body": "Changing stopgaps from \"\" to \"todo\"",
    "created_at": "2015-08-25T18:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187789",
    "user": "https://trac.sagemath.org/admin/accounts/users/jakobkroeker"
}
```

Changing stopgaps from "" to "todo"



---

archive/issue_comments_187790.json:
```json
{
    "body": "Changing branch from \"u/tornaria/ticket/12866\" to \"public/12866\"",
    "created_at": "2016-03-14T16:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187790",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "u/tornaria/ticket/12866" to "public/12866"



---

archive/issue_comments_187791.json:
```json
{
    "body": "Changing commit from \"cede6e19f33191c6542490a67adb729564b6c627\" to \"8cb36d5cfd034995a08c5403b293185843641ac7\"",
    "created_at": "2016-03-14T16:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187791",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "cede6e19f33191c6542490a67adb729564b6c627" to "8cb36d5cfd034995a08c5403b293185843641ac7"



---

archive/issue_comments_187792.json:
```json
{
    "body": "<a id='comment:9'></a>\nI have made a branch with other changes to the file:\n\n- many doc enhancements, and problems corrected\n- use of cached_method instead of custom cache\n- other small code changes.\n\n---\nNew commits:\n|                                                                                                                                          |                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|\n|[fcf022a](http://git.sagemath.org/sage.git/commit/?id=fcf022a14c75e9efd1ba1fea2b5f2944301f4415)|`Merge branch 'u/tornaria/ticket/12866' into 7.1.rc0`|\n|[8cb36d5](http://git.sagemath.org/sage.git/commit/?id=8cb36d5cfd034995a08c5403b293185843641ac7)|`trac #12866 general spring cleanup of doc of Brandt modules`|",
    "created_at": "2016-03-14T16:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187792",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
I have made a branch with other changes to the file:

- many doc enhancements, and problems corrected
- use of cached_method instead of custom cache
- other small code changes.

---
New commits:
|                                                                                                                                          |                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------|
|[fcf022a](http://git.sagemath.org/sage.git/commit/?id=fcf022a14c75e9efd1ba1fea2b5f2944301f4415)|`Merge branch 'u/tornaria/ticket/12866' into 7.1.rc0`|
|[8cb36d5](http://git.sagemath.org/sage.git/commit/?id=8cb36d5cfd034995a08c5403b293185843641ac7)|`trac #12866 general spring cleanup of doc of Brandt modules`|



---

archive/issue_events_035076.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-03-14T18:16:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35076"
}
```



---

archive/issue_events_035077.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-03-14T18:16:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35077"
}
```



---

archive/issue_comments_187793.json:
```json
{
    "body": "Changing author from \"aly.deines, tornaria\" to \"Aly Deines, Gonzalo Tornaria\"",
    "created_at": "2016-03-14T18:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187793",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "aly.deines, tornaria" to "Aly Deines, Gonzalo Tornaria"



---

archive/issue_comments_187794.json:
```json
{
    "body": "Changing stopgaps from \"todo\" to \"\"",
    "created_at": "2016-03-25T16:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187794",
    "user": "https://github.com/fchapoton"
}
```

Changing stopgaps from "todo" to ""



---

archive/issue_events_035078.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-03-25T16:12:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35078"
}
```



---

archive/issue_events_035079.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-03-25T16:12:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35079"
}
```



---

archive/issue_comments_187795.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[448cd9d](https://git.sagemath.org/sage.git/commit/?id=448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa)|`Merge branch 'public/12866' into 7.3.rc0`|",
    "created_at": "2016-07-30T06:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[448cd9d](https://git.sagemath.org/sage.git/commit/?id=448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa)|`Merge branch 'public/12866' into 7.3.rc0`|



---

archive/issue_comments_187796.json:
```json
{
    "body": "Changing commit from \"8cb36d5cfd034995a08c5403b293185843641ac7\" to \"448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa\"",
    "created_at": "2016-07-30T06:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8cb36d5cfd034995a08c5403b293185843641ac7" to "448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa"



---

archive/issue_events_035080.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-30T06:27:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35080"
}
```



---

archive/issue_events_035081.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2016-07-30T06:27:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35081"
}
```



---

archive/issue_comments_187797.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2016-08-04T16:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187797",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_187798.json:
```json
{
    "body": "<a id='comment:15'></a>\nI have checked the code of the authors.\nMy own changes are purely cosmetic, and I have double-checked them.\nThe bot has given a green light.\n\nTherefore I am going to set this to positive review.",
    "created_at": "2016-08-04T16:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187798",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>
I have checked the code of the authors.
My own changes are purely cosmetic, and I have double-checked them.
The bot has given a green light.

Therefore I am going to set this to positive review.



---

archive/issue_comments_187799.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-04T16:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187799",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187800.json:
```json
{
    "body": "Changing branch from \"public/12866\" to \"448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa\"",
    "created_at": "2016-08-07T20:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187800",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/12866" to "448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa"



---

archive/issue_events_035082.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-07T20:01:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12866#event-35082"
}
```



---

archive/issue_comments_187801.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-07T20:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187801",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_187802.json:
```json
{
    "body": "Changing author from \"Aly Deines, Gonzalo Tornaria\" to \"Aly Deines, Gonzalo Tornar\u00eda\"",
    "created_at": "2016-10-31T16:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187802",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "Aly Deines, Gonzalo Tornaria" to "Aly Deines, Gonzalo Tornaría"



---

archive/issue_comments_187803.json:
```json
{
    "body": "Changing commit from \"448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa\" to \"\"",
    "created_at": "2016-10-31T16:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12866#issuecomment-187803",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "448cd9de8e322e7f00c86f0d6e51ffeefd83bdaa" to ""
