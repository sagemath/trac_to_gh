# Issue 12205: rewrite conway polynomial spkg and code in Sage library to not use ZODB

archive/issues_012033.json:
```json
{
    "body": "This is necessary so we can dump the ZODB spkg from Sage.\n\n---\n**Installation Instructions**\n* Install the [new spkg](http://wstein.org/home/ohanar/spkgs/conway_polynomials-0.4.spkg).\n* Apply [attachment:trac12205.patch trac12205.patch] to the sage library\n* Apply [attachment:12205_root.patch] to the sage root repository\n\n\nAssignee: @williamstein\n\nCC:  @kini\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: R. Andrew Ohana\n\nMerged: sage-5.7.beta0\n\nDependencies: #13896, #13963\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12205\n\n",
    "closed_at": "2013-01-21T21:12:55Z",
    "created_at": "2011-12-20T18:59:14Z",
    "labels": [
        "component: packages: huge"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "rewrite conway polynomial spkg and code in Sage library to not use ZODB",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12205",
    "user": "https://github.com/williamstein"
}
```
This is necessary so we can dump the ZODB spkg from Sage.

---
**Installation Instructions**
* Install the [new spkg](http://wstein.org/home/ohanar/spkgs/conway_polynomials-0.4.spkg).
* Apply [attachment:trac12205.patch trac12205.patch] to the sage library
* Apply [attachment:12205_root.patch] to the sage root repository


Assignee: @williamstein

CC:  @kini

Reviewer: Fran√ßois Bissey

Author: R. Andrew Ohana

Merged: sage-5.7.beta0

Dependencies: #13896, #13963

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12205





---

archive/issue_comments_138828.json:
```json
{
    "body": "<a id='comment:2'></a>I did some work on this on the airplane, and better post a link before I forget about it or loose it:  http://wstein.org/patches/conway_polynomials-0.3.spkg\n\nBasically, the database is tiny so it can easily and very efficiently just be stored as a standard sobj.   Using ZODB is silly.",
    "created_at": "2012-01-27T20:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138828",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>I did some work on this on the airplane, and better post a link before I forget about it or loose it:  http://wstein.org/patches/conway_polynomials-0.3.spkg

Basically, the database is tiny so it can easily and very efficiently just be stored as a standard sobj.   Using ZODB is silly.



---

archive/issue_comments_138829.json:
```json
{
    "body": "<a id='comment:3'></a>That's a good start. Now we need to put SPKG.txt and spkg-install in proper shape. I suppose there need to be more work sage side to use the sobj rather than zodb.",
    "created_at": "2012-01-28T00:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138829",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>That's a good start. Now we need to put SPKG.txt and spkg-install in proper shape. I suppose there need to be more work sage side to use the sobj rather than zodb.



---

archive/issue_comments_138830.json:
```json
{
    "body": "Changing type from enhancement to task.",
    "created_at": "2012-06-18T05:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138830",
    "user": "https://github.com/ohanar"
}
```

Changing type from enhancement to task.



---

archive/issue_comments_138831.json:
```json
{
    "body": "<a id='comment:4'></a>William, do you have a work-in-progress patch for the sage library? I would like to finish this task.\n\nEdit: Other than a description in the SPKG.txt, [this spkg](http://wstein.org/home/ohanar/spkgs/conway_polynomials-0.4.spkg) should final.\n\nEdit2: Ok, there is now a small description, and it is rebased off of the spkg that I made for #13123.",
    "created_at": "2012-06-18T05:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138831",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>William, do you have a work-in-progress patch for the sage library? I would like to finish this task.

Edit: Other than a description in the SPKG.txt, [this spkg](http://wstein.org/home/ohanar/spkgs/conway_polynomials-0.4.spkg) should final.

Edit2: Ok, there is now a small description, and it is rebased off of the spkg that I made for #13123.



---

archive/issue_comments_138832.json:
```json
{
    "body": "<a id='comment:5'></a>Looks like I missed your work on this ohanar getting rid of zodb would be good news all around. Do this need any rebasing?",
    "created_at": "2012-12-29T08:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138832",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Looks like I missed your work on this ohanar getting rid of zodb would be good news all around. Do this need any rebasing?



---

archive/issue_comments_138833.json:
```json
{
    "body": "<a id='comment:6'></a>What's the status? According to comment:4, [conway_polynomials-0.4.spkg](http://wstein.org/home/ohanar/spkgs/conway_polynomials-0.4.spkg) should be final. So, needs review?\n\nWhat should be done to test whether this is really enough to get rid of zodb? I mean: How can one remove zodb from an existing Sage install?",
    "created_at": "2012-12-29T10:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138833",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>What's the status? According to comment:4, [conway_polynomials-0.4.spkg](http://wstein.org/home/ohanar/spkgs/conway_polynomials-0.4.spkg) should be final. So, needs review?

What should be done to test whether this is really enough to get rid of zodb? I mean: How can one remove zodb from an existing Sage install?



---

archive/issue_comments_138834.json:
```json
{
    "body": "<a id='comment:7'></a>Well, a patch is also needed to the sage library, and unfortunately William never provided that. It probably wouldn't be that hard to reverse engineer what he was thinking from the SPKG, but I haven't really looked into it.\n\nThe only other database in sage that used zodb was the Cremona database, but I rewrote that a year and a half ago to use sqlite3, so this is the only thing that should really be using zope at all (there may be other things that stupidly depend on it, but they should be easy to fix to not use zope).",
    "created_at": "2012-12-29T11:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138834",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:7'></a>Well, a patch is also needed to the sage library, and unfortunately William never provided that. It probably wouldn't be that hard to reverse engineer what he was thinking from the SPKG, but I haven't really looked into it.

The only other database in sage that used zodb was the Cremona database, but I rewrote that a year and a half ago to use sqlite3, so this is the only thing that should really be using zope at all (there may be other things that stupidly depend on it, but they should be easy to fix to not use zope).



---

archive/issue_comments_138835.json:
```json
{
    "body": "<a id='comment:8'></a>I think all that needs to be changed are the files: databases/compressed_storage.py, databases/db.py and databases/conway.py. conway.py is where we will have to be careful to present the same interface to the rest of sage so has not to break anything.",
    "created_at": "2012-12-30T10:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138835",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>I think all that needs to be changed are the files: databases/compressed_storage.py, databases/db.py and databases/conway.py. conway.py is where we will have to be careful to present the same interface to the rest of sage so has not to break anything.



---

archive/issue_comments_138836.json:
```json
{
    "body": "<a id='comment:9'></a>OK rewrite of conway.py belongs here and the other two files belong to #10353. I am looking at conway.py and see if it is in my abilities.",
    "created_at": "2012-12-30T23:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138836",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>OK rewrite of conway.py belongs here and the other two files belong to #10353. I am looking at conway.py and see if it is in my abilities.



---

archive/issue_comments_138837.json:
```json
{
    "body": "<a id='comment:10'></a>I think it is easy but it will be question of getting the syntax right. In the mean time I found that the stein-watkins optional \"huge\" database also use zodb and will need a similar treatment.",
    "created_at": "2012-12-31T00:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138837",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>I think it is easy but it will be question of getting the syntax right. In the mean time I found that the stein-watkins optional "huge" database also use zodb and will need a similar treatment.



---

archive/issue_comments_138838.json:
```json
{
    "body": "<a id='comment:11'></a>In the end I am hitting a brick wall here. Possibly due to my lack of python skills and my will to only have minimal changes in conway.py. The issue is that the created sobj is a double dictionary and that the call to the ConwayPolynomials() class follow the same pattern as a double dictionary. You have calls of the kind:\nConwayPolynomials()[3][21]\n\nImplementing the class as a dictionary allows sage to start \n\n```\nimport os\n\nfrom sage.structure.sage_object import load\nfrom sage.misc.misc import SAGE_DATA\n\n_CONWAYDATA = os.path.join(SAGE_DATA,'conway_polynomials')\n\nclass ConwayPolynomials(dict):\n    def __init__(self,*arg,**kw):\n        \"\"\"\n        Initialize the database.\n        \"\"\"\n        super(ConwayPolynomials, self).__init__(*arg, **kw)\n\n    def _init(self):\n        if not os.path.exists(_CONWAYDATA):\n            raise RuntimeError, \"In order to initialize the database, the directory must exist.\"%_CONWAYDATA\n        os.chdir(_CONWAYDATA)\n        self = load(os.path.join(_CONWAYDATA, 'conway_polynomials'))\n```\nbut unfortunately but I get key errors:\n\n```\nsage: sage.databases.conway.ConwayPolynomials()[3][21]\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n\n/home/fbissey/Work/Overlays/BlueFern/sci-mathematics/sage/<ipython console> in <module>()\n\nKeyError: 3\nsage: sage.databases.conway.ConwayPolynomials().keys()\n[]\n```\n I was hoping that inheriting the dict class the access problem would be solved but I am obviously doing something wrong here. Loading the sobj directly from sage is totally usable, it is just when trying to put it in a class.",
    "created_at": "2013-01-02T09:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138838",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:11'></a>In the end I am hitting a brick wall here. Possibly due to my lack of python skills and my will to only have minimal changes in conway.py. The issue is that the created sobj is a double dictionary and that the call to the ConwayPolynomials() class follow the same pattern as a double dictionary. You have calls of the kind:
ConwayPolynomials()[3][21]

Implementing the class as a dictionary allows sage to start 

```
import os

from sage.structure.sage_object import load
from sage.misc.misc import SAGE_DATA

_CONWAYDATA = os.path.join(SAGE_DATA,'conway_polynomials')

class ConwayPolynomials(dict):
    def __init__(self,*arg,**kw):
        """
        Initialize the database.
        """
        super(ConwayPolynomials, self).__init__(*arg, **kw)

    def _init(self):
        if not os.path.exists(_CONWAYDATA):
            raise RuntimeError, "In order to initialize the database, the directory must exist."%_CONWAYDATA
        os.chdir(_CONWAYDATA)
        self = load(os.path.join(_CONWAYDATA, 'conway_polynomials'))
```
but unfortunately but I get key errors:

```
sage: sage.databases.conway.ConwayPolynomials()[3][21]
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)

/home/fbissey/Work/Overlays/BlueFern/sci-mathematics/sage/<ipython console> in <module>()

KeyError: 3
sage: sage.databases.conway.ConwayPolynomials().keys()
[]
```
 I was hoping that inheriting the dict class the access problem would be solved but I am obviously doing something wrong here. Loading the sobj directly from sage is totally usable, it is just when trying to put it in a class.



---

archive/issue_comments_138839.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 fbissey]:\n> `self = load(os.path.join(_CONWAYDATA, 'conway_polynomials'))`\n\n\nThis only changes the meaning of the `self` variable in the local scope. To modify the `self` object, use `self.update(load(\u2026))` instead.",
    "created_at": "2013-01-02T09:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138839",
    "user": "https://github.com/gagern"
}
```

<a id='comment:12'></a>Replying to [comment:11 fbissey]:
> `self = load(os.path.join(_CONWAYDATA, 'conway_polynomials'))`


This only changes the meaning of the `self` variable in the local scope. To modify the `self` object, use `self.update(load(‚Ä¶))` instead.



---

archive/issue_comments_138840.json:
```json
{
    "body": "<a id='comment:13'></a>Interesting point but here it will call update() from the dict class which I don't think is what you meant. I still get the same results after doing your suggested replacement.",
    "created_at": "2013-01-02T10:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138840",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>Interesting point but here it will call update() from the dict class which I don't think is what you meant. I still get the same results after doing your suggested replacement.



---

archive/issue_comments_138841.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:11 fbissey]:\n> In the end I am hitting a brick wall here. Possibly due to my lack of python skills and my will to only have minimal changes in conway.py.\n\n\nI don't think `_init` is a magic python method that automatically gets called. It may well be part of a protocol involved in sage.databases.db.Database. However, when you want to implement this as inheriting from `dict`, you'll have to call `_init` yourself in `__init__`, or better: just make `_init` part of it.\n\nTo make the dictionary read-only, you may want to override the dictionary modification methods too. Plus you probably want to amend pickling (interesting question: How should this pickle? Should it write its content to a file or should it pickle to \"initialize ConwayPolynomials() for unpickling\"?",
    "created_at": "2013-01-02T17:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138841",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:14'></a>Replying to [comment:11 fbissey]:
> In the end I am hitting a brick wall here. Possibly due to my lack of python skills and my will to only have minimal changes in conway.py.


I don't think `_init` is a magic python method that automatically gets called. It may well be part of a protocol involved in sage.databases.db.Database. However, when you want to implement this as inheriting from `dict`, you'll have to call `_init` yourself in `__init__`, or better: just make `_init` part of it.

To make the dictionary read-only, you may want to override the dictionary modification methods too. Plus you probably want to amend pickling (interesting question: How should this pickle? Should it write its content to a file or should it pickle to "initialize ConwayPolynomials() for unpickling"?



---

archive/issue_comments_138842.json:
```json
{
    "body": "<a id='comment:15'></a>Thanks Nils. I actually though about that _init method as it was strange to have two. Merging the two didn't improve my problems however. I wouldn't know about the pickling. I'd like this to give me the correct behaviour of the class first. I'll retry merging inits as there may have been caching getting in the way.",
    "created_at": "2013-01-02T18:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138842",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>Thanks Nils. I actually though about that _init method as it was strange to have two. Merging the two didn't improve my problems however. I wouldn't know about the pickling. I'd like this to give me the correct behaviour of the class first. I'll retry merging inits as there may have been caching getting in the way.



---

archive/issue_comments_138843.json:
```json
{
    "body": "<a id='comment:16'></a>I found a way to properly initialise the database. It is a bit ugly but we may be able to move to the other problems: pickling and dict method override. I'll post a patch when I am on something else than that iPad.",
    "created_at": "2013-01-03T00:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138843",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>I found a way to properly initialise the database. It is a bit ugly but we may be able to move to the other problems: pickling and dict method override. I'll post a patch when I am on something else than that iPad.



---

archive/issue_comments_138844.json:
```json
{
    "body": "<a id='comment:17'></a>Actually, what you *should* do is just write the ConwayPolynomials class without thinking about how to initialize from an sobj at all, but just as either a normal class that has an attribute storing the info or inheriting from dict and ensure that pickling works. Then you just have to make sure that the `.sobj` is a pickled version of it with the appropriate content. (and you may store in the documentation somewhere a script that can produce this pickle from a human-readable file)",
    "created_at": "2013-01-03T04:07:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138844",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:17'></a>Actually, what you *should* do is just write the ConwayPolynomials class without thinking about how to initialize from an sobj at all, but just as either a normal class that has an attribute storing the info or inheriting from dict and ensure that pickling works. Then you just have to make sure that the `.sobj` is a pickled version of it with the appropriate content. (and you may store in the documentation somewhere a script that can produce this pickle from a human-readable file)



---

archive/issue_comments_138845.json:
```json
{
    "body": "<a id='comment:18'></a>Rather than inheriting from `dict`, I think it makes more sense to inherit from `collections.Mapping` since we only want read functionality. I uploaded a patch that does this, and uses the current dictionary format in the background (I don't see a good alternative to this storage method, but I'm open to suggestions).",
    "created_at": "2013-01-03T08:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138845",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:18'></a>Rather than inheriting from `dict`, I think it makes more sense to inherit from `collections.Mapping` since we only want read functionality. I uploaded a patch that does this, and uses the current dictionary format in the background (I don't see a good alternative to this storage method, but I'm open to suggestions).



---

archive/issue_comments_138846.json:
```json
{
    "body": "<a id='comment:19'></a>I think we have to stick with the dictionary format since the code in sage is littered with calls to ConwayPolynomials()[p][n] and changing the storage would imply changing an enormous amount of code. I trust that your python foo is way ahead of mine. I would never have produced that getitem and didn't find any examples to do that with google. Your patch is longer than my current one but probably better behaved in the long run. It is very educative to me too.",
    "created_at": "2013-01-03T08:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138846",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>I think we have to stick with the dictionary format since the code in sage is littered with calls to ConwayPolynomials()[p][n] and changing the storage would imply changing an enormous amount of code. I trust that your python foo is way ahead of mine. I would never have produced that getitem and didn't find any examples to do that with google. Your patch is longer than my current one but probably better behaved in the long run. It is very educative to me too.



---

archive/issue_comments_138847.json:
```json
{
    "body": "<a id='comment:20'></a>Looks great! Two questions:\n- How do we (re)produce the *.sobj file? I think we do want to be able to bootstap sage from human-readable formats? Just documenting how to obtain the appropriate *.sobj is probably sufficient.\n- Do you have a good reason to inherit from `UniqueRepresentation`? Doing so is definitely not free. It makes instantiation a much more expensive affair and there'll be a cache floating around. You should only do so if you need it and I don't think you do here (`ConwayPolynomials` is not a parent).",
    "created_at": "2013-01-03T08:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138847",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:20'></a>Looks great! Two questions:
- How do we (re)produce the *.sobj file? I think we do want to be able to bootstap sage from human-readable formats? Just documenting how to obtain the appropriate *.sobj is probably sufficient.
- Do you have a good reason to inherit from `UniqueRepresentation`? Doing so is definitely not free. It makes instantiation a much more expensive affair and there'll be a cache floating around. You should only do so if you need it and I don't think you do here (`ConwayPolynomials` is not a parent).



---

archive/issue_comments_138848.json:
```json
{
    "body": "<a id='comment:21'></a>I can answer the first question: It is generated in the spkg attached in this ticket from a python table in text format look it up. Technically it doesn't have to be a sobj the previous spkg was installing a bzipped version of the python table and then inserting it in the database. We could do something similar, not sure about the cost.",
    "created_at": "2013-01-03T08:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138848",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>I can answer the first question: It is generated in the spkg attached in this ticket from a python table in text format look it up. Technically it doesn't have to be a sobj the previous spkg was installing a bzipped version of the python table and then inserting it in the database. We could do something similar, not sure about the cost.



---

archive/issue_comments_138849.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:19 fbissey]:\n> I think we have to stick with the dictionary format ...\n\n\nAs much as I understand, the \"format\" (in the sense of the \"interface to retrieve data\") does not change. That's exactly the point: If you wanted to inherit from dict, then you'd also have to have a `__setitem__` method - but we don't want to set data in an interactive session. All what we want is that during initialisation, data are obtained from a file, and then the user can retrieve these data (which is granted by the `__getitem__` method).\n\n> ... since the code in sage is littered with calls to ConwayPolynomials()[p][n]\n\n\nWould that be changed by the patch? Looking at the lines\n\n```\n    def __getitem__(self, key): \n        try: \n            return self._store[key] \n        except KeyError, err: \n            try: \n                if isinstance(key, (tuple, list)): \n                    if len(key) == 2: \n                        return self._store[key[0]][key[1]] \n            except KeyError: \n                pass \n            raise err \n```\nit seems to me that `ConwayPolynomials()[p][n]` is still a possible syntax (that's `return self._store[key]`), but *in addition to the old syntax* we now also allow the syntax `ConwayPolynomials()[p, n]` (that's `return self._store[key[0]][key[1]]`).\n\n> and changing the storage would imply changing an enormous amount of code.\n\n\nBy \"storage\", I understand the format of the data stored in the .sobj file containing the data base. I don't think that would be a problem, as long as there is a function that is able to read old data and transforms it into the new format.\n\n> I trust that your python foo is way ahead of mine. I would never have produced that getitem and didn't find any examples to do that with google.\n\n\nThat's in [dive into python](http://www.diveintopython.net/object_oriented_framework/special_class_methods.html) or other Python introductions, or in the [Python documentation](http://docs.python.org/2/reference/datamodel.html#special-method-names).",
    "created_at": "2013-01-03T08:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138849",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'></a>Replying to [comment:19 fbissey]:
> I think we have to stick with the dictionary format ...


As much as I understand, the "format" (in the sense of the "interface to retrieve data") does not change. That's exactly the point: If you wanted to inherit from dict, then you'd also have to have a `__setitem__` method - but we don't want to set data in an interactive session. All what we want is that during initialisation, data are obtained from a file, and then the user can retrieve these data (which is granted by the `__getitem__` method).

> ... since the code in sage is littered with calls to ConwayPolynomials()[p][n]


Would that be changed by the patch? Looking at the lines

```
    def __getitem__(self, key): 
        try: 
            return self._store[key] 
        except KeyError, err: 
            try: 
                if isinstance(key, (tuple, list)): 
                    if len(key) == 2: 
                        return self._store[key[0]][key[1]] 
            except KeyError: 
                pass 
            raise err 
```
it seems to me that `ConwayPolynomials()[p][n]` is still a possible syntax (that's `return self._store[key]`), but *in addition to the old syntax* we now also allow the syntax `ConwayPolynomials()[p, n]` (that's `return self._store[key[0]][key[1]]`).

> and changing the storage would imply changing an enormous amount of code.


By "storage", I understand the format of the data stored in the .sobj file containing the data base. I don't think that would be a problem, as long as there is a function that is able to read old data and transforms it into the new format.

> I trust that your python foo is way ahead of mine. I would never have produced that getitem and didn't find any examples to do that with google.


That's in [dive into python](http://www.diveintopython.net/object_oriented_framework/special_class_methods.html) or other Python introductions, or in the [Python documentation](http://docs.python.org/2/reference/datamodel.html#special-method-names).



---

archive/issue_comments_138850.json:
```json
{
    "body": "<a id='comment:23'></a>I noticed a a flaw with what I did -- `ConwayPolynomials()[p]` returns a mutable Python dict, so you can actually write to the database. I'll post a fix for this in a moment. \n\nThere is no good reason as far as I can tell to use anything but plain text in the SPKG considering how small the database is.\n\nAs for the second question, the only concern would be that the entire database is loaded into memory with each instance (granted this might not be a huge concern due to the small size of the database). The main reason I added the inheritance of `UniqueRepresentation` was because of a comment I seem to recall being told that Sage databases should be unique. It is simple enough to remove if we deem it not necessary.",
    "created_at": "2013-01-03T09:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138850",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:23'></a>I noticed a a flaw with what I did -- `ConwayPolynomials()[p]` returns a mutable Python dict, so you can actually write to the database. I'll post a fix for this in a moment. 

There is no good reason as far as I can tell to use anything but plain text in the SPKG considering how small the database is.

As for the second question, the only concern would be that the entire database is loaded into memory with each instance (granted this might not be a huge concern due to the small size of the database). The main reason I added the inheritance of `UniqueRepresentation` was because of a comment I seem to recall being told that Sage databases should be unique. It is simple enough to remove if we deem it not necessary.



---

archive/issue_comments_138851.json:
```json
{
    "body": "<a id='comment:24'></a>`@`SimonKing: overall you read my terrible prose correctly. I read the patch carefuly and in spite of call changes in the class I understood that the old way of accessing the class was preserved. You make a good point that it doesn't need to be preserved internally - just that we provide the right method of access.\nI used to have a copy of \"dive into python\" wonder what happened to it. Probably lost last time I moved. I would say I read the python documentation but my python skill are not advanced enough that I could have crafted a getitem accessing something like [p][n] - [p,n] is easy the former is more tricky to me.\n\n`@`ohanar: going with plain text would remove the requirement of installing sage before this spkg. As it is sage needs to be installed first to produce the sobj. The spkg could then be installed at any time.",
    "created_at": "2013-01-03T09:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138851",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>`@`SimonKing: overall you read my terrible prose correctly. I read the patch carefuly and in spite of call changes in the class I understood that the old way of accessing the class was preserved. You make a good point that it doesn't need to be preserved internally - just that we provide the right method of access.
I used to have a copy of "dive into python" wonder what happened to it. Probably lost last time I moved. I would say I read the python documentation but my python skill are not advanced enough that I could have crafted a getitem accessing something like [p][n] - [p,n] is easy the former is more tricky to me.

`@`ohanar: going with plain text would remove the requirement of installing sage before this spkg. As it is sage needs to be installed first to produce the sobj. The spkg could then be installed at any time.



---

archive/issue_comments_138852.json:
```json
{
    "body": "<a id='comment:26'></a>Any reason you changed \"[]\" to \"()\" in the polynomial method doctest? It wasn't in the previous patch and I would hope that if it is correct it doesn't lead to other breakages in the rest of sage.",
    "created_at": "2013-01-03T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138852",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>Any reason you changed "[]" to "()" in the polynomial method doctest? It wasn't in the previous patch and I would hope that if it is correct it doesn't lead to other breakages in the rest of sage.



---

archive/issue_comments_138853.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:23 ohanar]:\n> As for the second question, the only concern would be that the entire database is loaded into memory with each instance (granted this might not be a huge concern due to the small size of the database).\n\nPerhaps store the database in a module-level variable then? Modules naturally have a unique instance (or at least you have to work very hard to get multiple instances). If the nature of the instance is known at compile time (such as with a data base!) you might as well use the mechanism to your advantage.\n\n(for data bases in general: Especially for writable data bases, you wouldn't want multiple instances backed by the same file)",
    "created_at": "2013-01-03T09:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138853",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:27'></a>Replying to [comment:23 ohanar]:
> As for the second question, the only concern would be that the entire database is loaded into memory with each instance (granted this might not be a huge concern due to the small size of the database).

Perhaps store the database in a module-level variable then? Modules naturally have a unique instance (or at least you have to work very hard to get multiple instances). If the nature of the instance is known at compile time (such as with a data base!) you might as well use the mechanism to your advantage.

(for data bases in general: Especially for writable data bases, you wouldn't want multiple instances backed by the same file)



---

archive/issue_comments_138854.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 fbissey]:\n> Any reason you changed \"[]\" to \"()\" in the polynomial method doctest? It wasn't in the previous patch and I would hope that if it is correct it doesn't lead to other breakages in the rest of sage.\n\n\nI updated the database to use tuples (updated the spkg), rather than lists, as they are not mutable. I don't believe there are other breakages, but I haven't run the full doctest suit (just a few files I found through greping).\n\nReplying to [comment:27 nbruin]:\n> Perhaps store the database in a module-level variable then?\n\n\nYes, that sounds like a plan.",
    "created_at": "2013-01-03T09:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138854",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:28'></a>Replying to [comment:26 fbissey]:
> Any reason you changed "[]" to "()" in the polynomial method doctest? It wasn't in the previous patch and I would hope that if it is correct it doesn't lead to other breakages in the rest of sage.


I updated the database to use tuples (updated the spkg), rather than lists, as they are not mutable. I don't believe there are other breakages, but I haven't run the full doctest suit (just a few files I found through greping).

Replying to [comment:27 nbruin]:
> Perhaps store the database in a module-level variable then?


Yes, that sounds like a plan.



---

archive/issue_comments_138855.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 ohanar]:\n> Replying to [comment:26 fbissey]:\n> > Any reason you changed \"[]\" to \"()\" in the polynomial method doctest? It wasn't in the previous patch and I would hope that if it is correct it doesn't lead to other breakages in the rest of sage.\n\n> \n> I updated the database to use tuples (updated the spkg), rather than lists, as they are not mutable. I don't believe there are other breakages, but I haven't run the full doctest suit (just a few files I found through greping).\n> \n\nOK will run some tests as well. I didn't know you had updated the spkg.",
    "created_at": "2013-01-03T09:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138855",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:29'></a>Replying to [comment:28 ohanar]:
> Replying to [comment:26 fbissey]:
> > Any reason you changed "[]" to "()" in the polynomial method doctest? It wasn't in the previous patch and I would hope that if it is correct it doesn't lead to other breakages in the rest of sage.

> 
> I updated the database to use tuples (updated the spkg), rather than lists, as they are not mutable. I don't believe there are other breakages, but I haven't run the full doctest suit (just a few files I found through greping).
> 

OK will run some tests as well. I didn't know you had updated the spkg.



---

archive/issue_comments_138856.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:29 fbissey]:\n> OK will run some tests as well. I didn't know you had updated the spkg.\n\nSorry about that, I noticed it wouldn't install on 5.6-beta1, so I updated it (and changed to tuples at the same time).\n\nOk, added a updated the patch to add some doctests and remove `UniqueRepresentation` in favor of a module level variable.",
    "created_at": "2013-01-03T10:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138856",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:30'></a>Replying to [comment:29 fbissey]:
> OK will run some tests as well. I didn't know you had updated the spkg.

Sorry about that, I noticed it wouldn't install on 5.6-beta1, so I updated it (and changed to tuples at the same time).

Ok, added a updated the patch to add some doctests and remove `UniqueRepresentation` in favor of a module level variable.



---

archive/issue_comments_138857.json:
```json
{
    "body": "<a id='comment:31'></a>All tests past on 5.5 with the next to last patch. Since the the last changes are internal I don't think it will change the tests results. Thanks ohanar for the splendid work.",
    "created_at": "2013-01-03T10:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138857",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>All tests past on 5.5 with the next to last patch. Since the the last changes are internal I don't think it will change the tests results. Thanks ohanar for the splendid work.



---

archive/issue_comments_138858.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-03T11:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138858",
    "user": "https://github.com/ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_138859.json:
```json
{
    "body": "<a id='comment:32'></a>Ok, all doctests are now filled and all functionality should be there, so I'm marking this as needs review.",
    "created_at": "2013-01-03T11:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138859",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:32'></a>Ok, all doctests are now filled and all functionality should be there, so I'm marking this as needs review.



---

archive/issue_comments_138860.json:
```json
{
    "body": "apply to sage library",
    "created_at": "2013-01-03T11:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138860",
    "user": "https://github.com/ohanar"
}
```

apply to sage library



---

archive/issue_comments_138861.json:
```json
{
    "body": "<a id='comment:33'></a>Attachment [trac12205.patch](tarball://root/attachments/some-uuid/ticket12205/trac12205.patch) by @ohanar created at 2013-01-03 11:20:43\n\nwell, apparently sage doesn't like docstrings surrounded by `'''` instead of `\"\"\"`, so that is now fixed",
    "created_at": "2013-01-03T11:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138861",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:33'></a>Attachment [trac12205.patch](tarball://root/attachments/some-uuid/ticket12205/trac12205.patch) by @ohanar created at 2013-01-03 11:20:43

well, apparently sage doesn't like docstrings surrounded by `'''` instead of `"""`, so that is now fixed



---

archive/issue_comments_138862.json:
```json
{
    "body": "<a id='comment:34'></a>This is very bizzare I had no doctests failures with the previous version of the patch (on top of 5.5) but with this new one I get \n\n```\nsage -t -long \"devel/sage-main/sage/algebras/free_algebra.py\"\nThe doctested process was killed by signal 11\n         [1.4 s]\n```\nBut if I add \"-verbose\" the test pass. There are no obvious relation with this ticket (and #10353 on which I am working at the same time) apart from the fact that it appeared out of the blue after application.",
    "created_at": "2013-01-04T10:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138862",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>This is very bizzare I had no doctests failures with the previous version of the patch (on top of 5.5) but with this new one I get 

```
sage -t -long "devel/sage-main/sage/algebras/free_algebra.py"
The doctested process was killed by signal 11
         [1.4 s]
```
But if I add "-verbose" the test pass. There are no obvious relation with this ticket (and #10353 on which I am working at the same time) apart from the fact that it appeared out of the blue after application.



---

archive/issue_comments_138863.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:34 fbissey]:\n> This is very bizzare I had no doctests failures with the previous version of the patch (on top of 5.5) but with this new one I get \n> \n> ```\n> sage -t -long \"devel/sage-main/sage/algebras/free_algebra.py\"\n> The doctested process was killed by signal 11\n>          [1.4 s]\n> ```\n> But if I add \"-verbose\" the test pass.\n\n\nThat is very likely caused by an upstream bug in Cython that became immanent with #715.\n\nCan you try with the new Cython spkg from #13896? I.e., install that spkg and do sage -ba.",
    "created_at": "2013-01-04T10:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138863",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:35'></a>Replying to [comment:34 fbissey]:
> This is very bizzare I had no doctests failures with the previous version of the patch (on top of 5.5) but with this new one I get 
> 
> ```
> sage -t -long "devel/sage-main/sage/algebras/free_algebra.py"
> The doctested process was killed by signal 11
>          [1.4 s]
> ```
> But if I add "-verbose" the test pass.


That is very likely caused by an upstream bug in Cython that became immanent with #715.

Can you try with the new Cython spkg from #13896? I.e., install that spkg and do sage -ba.



---

archive/issue_comments_138864.json:
```json
{
    "body": "<a id='comment:36'></a>Thanks Simon. I have no time to do it tonight, I'll try tomorrow. As far as I am concerned this is the only thing that stand against a positive review. But I suspect it is as you say, and is just something bitting from another corner.",
    "created_at": "2013-01-04T10:42:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138864",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>Thanks Simon. I have no time to do it tonight, I'll try tomorrow. As far as I am concerned this is the only thing that stand against a positive review. But I suspect it is as you say, and is just something bitting from another corner.



---

archive/issue_comments_138865.json:
```json
{
    "body": "<a id='comment:37'></a>Yup. Upgrading cython fixed the problem. I also checked that the thing would build properly not just upgrade from an existing sage. I am giving this a positive review.",
    "created_at": "2013-01-05T08:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138865",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>Yup. Upgrading cython fixed the problem. I also checked that the thing would build properly not just upgrade from an existing sage. I am giving this a positive review.



---

archive/issue_comments_138866.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-05T08:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138866",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_138867.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 fbissey]:\n> Yup. Upgrading cython fixed the problem. I also checked that the thing would build properly not just upgrade from an existing sage. I am giving this a positive review.\n\n\nGreat! To be on the safe side, I add #13896 as a dependency, even though #13896 is a blocker with positive review (hence, is assumed to be in the next release).",
    "created_at": "2013-01-05T09:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138867",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:38'></a>Replying to [comment:37 fbissey]:
> Yup. Upgrading cython fixed the problem. I also checked that the thing would build properly not just upgrade from an existing sage. I am giving this a positive review.


Great! To be on the safe side, I add #13896 as a dependency, even though #13896 is a blocker with positive review (hence, is assumed to be in the next release).



---

archive/issue_events_032504.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-07T22:13:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12205#event-32504"
}
```



---

archive/issue_comments_138868.json:
```json
{
    "body": "<a id='comment:40'></a>What is preventing this from being merged in 5.6?",
    "created_at": "2013-01-07T22:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138868",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:40'></a>What is preventing this from being merged in 5.6?



---

archive/issue_comments_138869.json:
```json
{
    "body": "<a id='comment:41'></a>Nothing really, but I feel like this should be merged while removing ZODB.",
    "created_at": "2013-01-07T22:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138869",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>Nothing really, but I feel like this should be merged while removing ZODB.



---

archive/issue_comments_138870.json:
```json
{
    "body": "<a id='comment:42'></a>I am not fussy about it. I think #10353 is ready but if you want it in two stages that's fine. Zodb is now gone from sage-on-gentoo and maintenance wise we won't miss it :).",
    "created_at": "2013-01-08T03:25:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138870",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:42'></a>I am not fussy about it. I think #10353 is ready but if you want it in two stages that's fine. Zodb is now gone from sage-on-gentoo and maintenance wise we won't miss it :).



---

archive/issue_comments_138871.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-10T10:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138871",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_138872.json:
```json
{
    "body": "<a id='comment:43'></a>The sage-root patch needs to be rebased to sage-5.6.beta3.",
    "created_at": "2013-01-10T10:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138872",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'></a>The sage-root patch needs to be rebased to sage-5.6.beta3.



---

archive/issue_comments_138873.json:
```json
{
    "body": "Attachment [trac12205_root.2.patch](tarball://root/attachments/some-uuid/ticket12205/trac12205_root.2.patch) by @kiwifb created at 2013-01-14 10:26:42\n\nupdated sage_root repo patch",
    "created_at": "2013-01-14T10:26:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138873",
    "user": "https://github.com/kiwifb"
}
```

Attachment [trac12205_root.2.patch](tarball://root/attachments/some-uuid/ticket12205/trac12205_root.2.patch) by @kiwifb created at 2013-01-14 10:26:42

updated sage_root repo patch



---

archive/issue_comments_138874.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-14T10:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138874",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_138875.json:
```json
{
    "body": "<a id='comment:44'></a>I put a rebased version of the root repo patch and updated the ticket instructions accordingly. The rebasing was done against 5.6.rc0.",
    "created_at": "2013-01-14T10:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138875",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>I put a rebased version of the root repo patch and updated the ticket instructions accordingly. The rebasing was done against 5.6.rc0.



---

archive/issue_comments_138876.json:
```json
{
    "body": "<a id='comment:45'></a>Putting back to positive review.",
    "created_at": "2013-01-14T10:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138876",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>Putting back to positive review.



---

archive/issue_comments_138877.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-14T10:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138877",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_138878.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-15T10:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138878",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_138879.json:
```json
{
    "body": "<a id='comment:48'></a>Attachment [12205_root.patch](tarball://root/attachments/some-uuid/ticket12205/12205_root.patch) by @jdemeyer created at 2013-01-15 10:28:43\n\nThis needs to depend on `$(SAGERUNTIME)`, not only the Sage library because we actually run Sage code.  See new patch.\n\nMoreover, this causes build problems for `sagenb`:\n\n```\nProcessing dependencies for Twisted==12.1.0\nSearching for zope.interface\n\nLink to http://pypi.python.org/simple/zope.interface/ ***BLOCKED*** by --allow-hosts\n\nCouldn't find index page for 'zope.interface' (maybe misspelled?)\nScanning index of all packages (this may take a while)\n\nLink to http://pypi.python.org/simple/ ***BLOCKED*** by --allow-hosts\n\nNo local packages or download links found for zope.interface\nerror: Could not find suitable distribution for Requirement.parse('zope.interface')\nError installing Twisted-12.1.0.tar.bz2 !\n```",
    "created_at": "2013-01-15T10:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138879",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:48'></a>Attachment [12205_root.patch](tarball://root/attachments/some-uuid/ticket12205/12205_root.patch) by @jdemeyer created at 2013-01-15 10:28:43

This needs to depend on `$(SAGERUNTIME)`, not only the Sage library because we actually run Sage code.  See new patch.

Moreover, this causes build problems for `sagenb`:

```
Processing dependencies for Twisted==12.1.0
Searching for zope.interface

Link to http://pypi.python.org/simple/zope.interface/ ***BLOCKED*** by --allow-hosts

Couldn't find index page for 'zope.interface' (maybe misspelled?)
Scanning index of all packages (this may take a while)

Link to http://pypi.python.org/simple/ ***BLOCKED*** by --allow-hosts

No local packages or download links found for zope.interface
error: Could not find suitable distribution for Requirement.parse('zope.interface')
Error installing Twisted-12.1.0.tar.bz2 !
```



---

archive/issue_comments_138880.json:
```json
{
    "body": "<a id='comment:49'></a>SAGERUNTIME? I hadn't seen that. I should have paid more attention to the originating ticket. OK I hadn't thought of twisted but the comment really is for #10353. I shall try to update the sagenb spkg to include zope.interface sometime this week.",
    "created_at": "2013-01-15T10:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138880",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:49'></a>SAGERUNTIME? I hadn't seen that. I should have paid more attention to the originating ticket. OK I hadn't thought of twisted but the comment really is for #10353. I shall try to update the sagenb spkg to include zope.interface sometime this week.



---

archive/issue_comments_138881.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:49 fbissey]:\n> SAGERUNTIME? I hadn't seen that.\n\nBasically, `$(INST)/$(SAGE)` is purely the Sage library (i.e. the stuff in `devel/sage`).  But actually starting Sage or running Sage code requires more, because things are imported from other packages, for example the notebook.  That stuff is in `$(SAGERUNTIME)`.\n\nIt used to be the case that `$(INST)/$(SAGE)` was what is essentially `$(SAGERUNTIME)` now.  But that's silly because it adds extra unneeded build-time dependencies for `$(INST)/$(SAGE)`, which needs a long time to build.",
    "created_at": "2013-01-15T10:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138881",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:50'></a>Replying to [comment:49 fbissey]:
> SAGERUNTIME? I hadn't seen that.

Basically, `$(INST)/$(SAGE)` is purely the Sage library (i.e. the stuff in `devel/sage`).  But actually starting Sage or running Sage code requires more, because things are imported from other packages, for example the notebook.  That stuff is in `$(SAGERUNTIME)`.

It used to be the case that `$(INST)/$(SAGE)` was what is essentially `$(SAGERUNTIME)` now.  But that's silly because it adds extra unneeded build-time dependencies for `$(INST)/$(SAGE)`, which needs a long time to build.



---

archive/issue_comments_138882.json:
```json
{
    "body": "<a id='comment:51'></a>Understood. But zope.interface shouldn't be a blocker for this ticket, only for #10353.",
    "created_at": "2013-01-15T10:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138882",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:51'></a>Understood. But zope.interface shouldn't be a blocker for this ticket, only for #10353.



---

archive/issue_comments_138883.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:51 fbissey]:\n> Understood. But zope.interface shouldn't be a blocker for this ticket, only for #10353.\n  \nFair enough, I always confuse these two tickets.",
    "created_at": "2013-01-15T10:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138883",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:52'></a>Replying to [comment:51 fbissey]:
> Understood. But zope.interface shouldn't be a blocker for this ticket, only for #10353.
  
Fair enough, I always confuse these two tickets.



---

archive/issue_comments_138884.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-15T10:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138884",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_138885.json:
```json
{
    "body": "<a id='comment:54'></a>Potential build failures due to #13963.",
    "created_at": "2013-01-17T11:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138885",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:54'></a>Potential build failures due to #13963.



---

archive/issue_comments_138886.json:
```json
{
    "body": "<a id='comment:55'></a>Could this have caused (note this is over `GF(8)`):\n\n```\nsage -t  \"devel/sage-main/sage/rings/polynomial/polynomial_ring.py\"\n**********************************************************************\nFile \"/release/merger/sage-5.7.beta0/devel/sage-main/sage/rings/polynomial/polynomial_ring.py\", line 1641:\n    sage: R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)], algorithm=\"neville\", previous_row=p)[-1]\nExpected:\n    a^2*x^2 + a^2*x + a^2\nGot:\n    a^2*x^2 + a*x + a^2 + a\n**********************************************************************\n```",
    "created_at": "2013-01-18T08:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138886",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:55'></a>Could this have caused (note this is over `GF(8)`):

```
sage -t  "devel/sage-main/sage/rings/polynomial/polynomial_ring.py"
**********************************************************************
File "/release/merger/sage-5.7.beta0/devel/sage-main/sage/rings/polynomial/polynomial_ring.py", line 1641:
    sage: R.lagrange_polynomial([(a^2+a,a),(a,1),(a^2,a^2+a+1)], algorithm="neville", previous_row=p)[-1]
Expected:
    a^2*x^2 + a^2*x + a^2
Got:
    a^2*x^2 + a*x + a^2 + a
**********************************************************************
```



---

archive/issue_comments_138887.json:
```json
{
    "body": "<a id='comment:56'></a>Is it a new doctest? I see this on unreleased 5.7.beta0. I agressively patched sage-on-gentoo (5.5) to get rid of zodb and we haven't seen that anywhere. I'll admit the move to new gap is giving me trouble but it should be unrelated - or should it?",
    "created_at": "2013-01-18T08:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138887",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:56'></a>Is it a new doctest? I see this on unreleased 5.7.beta0. I agressively patched sage-on-gentoo (5.5) to get rid of zodb and we haven't seen that anywhere. I'll admit the move to new gap is giving me trouble but it should be unrelated - or should it?



---

archive/issue_comments_138888.json:
```json
{
    "body": "<a id='comment:57'></a>Replying to [comment:56 fbissey]:\n> Is it a new doctest?\n\nNo, it's not.  On first sight, it doesn't seem to use anything besides basic polynomial arithmetic.  But if basic polynomial arithmetic were broken, we would see a lot more doctests failing.\n\nI'm not at all saying that this ticket has anything to do with it, I merge a bunch of tickets and when there's a failure I have to guess which ticket caused it.",
    "created_at": "2013-01-18T08:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138888",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:57'></a>Replying to [comment:56 fbissey]:
> Is it a new doctest?

No, it's not.  On first sight, it doesn't seem to use anything besides basic polynomial arithmetic.  But if basic polynomial arithmetic were broken, we would see a lot more doctests failing.

I'm not at all saying that this ticket has anything to do with it, I merge a bunch of tickets and when there's a failure I have to guess which ticket caused it.



---

archive/issue_comments_138889.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-21T21:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138889",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_032505.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-21T21:12:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12205#event-32505"
}
```



---

archive/issue_comments_138890.json:
```json
{
    "body": "<a id='comment:59'></a>Has anybody noticed the very very long string of primes you get when installing this spkg yet?  This is with beta1 + #6495, but I assume it is part of this spkg.  See [the log](http://sage.math.washington.edu/home/kcrisman/conway_polynomials-0.4.log).",
    "created_at": "2013-01-30T03:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138890",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:59'></a>Has anybody noticed the very very long string of primes you get when installing this spkg yet?  This is with beta1 + #6495, but I assume it is part of this spkg.  See [the log](http://sage.math.washington.edu/home/kcrisman/conway_polynomials-0.4.log).



---

archive/issue_comments_138891.json:
```json
{
    "body": "<a id='comment:60'></a>It is part of the spkg. Don't ask me why ohanar put a \"print p \" in there. I don't mind the spam but I had a complaint about it in sage-on-gentoo and removed it there.",
    "created_at": "2013-01-30T03:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138891",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:60'></a>It is part of the spkg. Don't ask me why ohanar put a "print p " in there. I don't mind the spam but I had a complaint about it in sage-on-gentoo and removed it there.



---

archive/issue_comments_138892.json:
```json
{
    "body": "<a id='comment:61'></a>> It is part of the spkg. Don't ask me why ohanar put a \"print p \" in there. I don't mind the spam but I had a complaint about it in sage-on-gentoo and removed it there.\n\nDon't worry, it wasn't directed at anyone in particular!  Presumably it's something left over from debugging.  Shall I assume this is to be considered non-optimal and a ticket should be opened?",
    "created_at": "2013-01-30T03:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138892",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:61'></a>> It is part of the spkg. Don't ask me why ohanar put a "print p " in there. I don't mind the spam but I had a complaint about it in sage-on-gentoo and removed it there.

Don't worry, it wasn't directed at anyone in particular!  Presumably it's something left over from debugging.  Shall I assume this is to be considered non-optimal and a ticket should be opened?



---

archive/issue_comments_138893.json:
```json
{
    "body": "<a id='comment:62'></a>fbissey: sage-on-gentoo is like a third level of ticket review after the official reviewer and the release manager! :D",
    "created_at": "2013-01-30T17:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138893",
    "user": "https://github.com/kini"
}
```

<a id='comment:62'></a>fbissey: sage-on-gentoo is like a third level of ticket review after the official reviewer and the release manager! :D



---

archive/issue_comments_138894.json:
```json
{
    "body": "<a id='comment:63'></a>> > It is part of the spkg. Don't ask me why ohanar put a \"print p \" in there. I don't mind the spam but I had a complaint about it in sage-on-gentoo and removed it there.\n\n> Don't worry, it wasn't directed at anyone in particular!  Presumably it's something left over from debugging.  Shall I assume this is to be considered non-optimal and a ticket should be opened?\nSo... should I open a ticket?  It does seem bizarre, and apparently easily fixed?  But if it was necessary, I don't want to.",
    "created_at": "2013-02-07T02:15:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138894",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:63'></a>> > It is part of the spkg. Don't ask me why ohanar put a "print p " in there. I don't mind the spam but I had a complaint about it in sage-on-gentoo and removed it there.

> Don't worry, it wasn't directed at anyone in particular!  Presumably it's something left over from debugging.  Shall I assume this is to be considered non-optimal and a ticket should be opened?
So... should I open a ticket?  It does seem bizarre, and apparently easily fixed?  But if it was necessary, I don't want to.



---

archive/issue_comments_138895.json:
```json
{
    "body": "<a id='comment:64'></a>That's very easy to fix but opening a ticket is pretty much the only way it will ever get merged.",
    "created_at": "2013-02-07T02:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138895",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:64'></a>That's very easy to fix but opening a ticket is pretty much the only way it will ever get merged.



---

archive/issue_comments_138896.json:
```json
{
    "body": "<a id='comment:65'></a>> That's very easy to fix but opening a ticket is pretty much the only way it will ever get merged.\n\n#14075",
    "created_at": "2013-02-07T02:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12205#issuecomment-138896",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:65'></a>> That's very easy to fix but opening a ticket is pretty much the only way it will ever get merged.

#14075
