# Issue 12738: Singular fails to build with LTO

archive/issues_012566.json:
```json
{
    "body": "I took sage-5.0.beta9, replaced the ppl package by the one from #12672, added the cloog-ppl package from #12666, replaced the glpk package by the one from #12703, added a new libelf spkg, added the mpc and gcc spkgs from #12369 and modified the gcc spkg such that the gcc is built with support of loop optimization (graphite) and lto.\n\nThen, I tried to build Sage with rather high optimization:\n\n```\nking@mpc622:/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/spkg$ echo $CFLAGS\n-O3 -march=native -floop-interchange -floop-strip-mine -floop-block -fno-strict-aliasing -flto\nking@mpc622:/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/spkg$ echo $CXXFLAGS\n-O3 -march=native -floop-interchange -floop-strip-mine -floop-block -fno-strict-aliasing -flto\nking@mpc622:/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/spkg$ echo $LDFLAGS\n-flto\n```\n\nMoreover, I attempted to build parallely (four threads).\n\nHowever, Singular failed to build. Note that dropping -flto would enable to build Singular. Hence, the problem really seems to be -flto, whereas `make -j4` and `-march=native` and `-floop*` seems to be fine.\n\nIt seems to me that LDFLAGS is not correctly passed. Namely, in the [install log](http://boxen.math.washington.edu/home/SimonKing/SAGE/install_logs/singular-3-1-3-3.p6.log), I read\n\n```\ng++ -O3 -march=native -floop-interchange -floop-strip-mine -floop-block -fno-strict-aliasing -flto -O2 -g -fPIC -pipe  -fno-implicit-templates -I. -I.. -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.bet\na9/local  -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/local/include -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/local/include -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/local/include   -DNDEBUG -DOM_NDEBUG -Dx86_64_Linux -DHAVE_CONFIG_H -fpic -DPIC -Dp_Procs_FieldQ -c p_Procs_Lib.cc -o p_Procs_Lib_FieldQ.dl_o\n```\nbut\n\n```\nld -shared -o p_Procs_FieldQ.sog p_Procs_Lib_FieldQ.dl_og\n...\nld -shared -o p_Procs_FieldQ.so p_Procs_Lib_FieldQ.dl_o\n```\n\nMoreover, I see that libfac/Makefile.dist defines LDFLAGS empty\n\n```\n  LDFLAGS=\n```\nand defines\n\n```\n  LD = g++ $(ALLFLAGS)\n```\nwhere LDFLAGS does not appear in the definition of ALLFLAGS.\n\nAssignee: tbd\n\nCC:  @nexttime @nathanncohen @malb\n\nKeywords: singular lto gcc\n\nUpstream: Reported upstream. No feedback yet.\n\nReviewer: Michael Orlitzky\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/12738\n\n",
    "closed_at": "2021-09-18T17:51:47Z",
    "created_at": "2012-03-23T20:31:27Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Singular fails to build with LTO",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12738",
    "user": "https://github.com/simon-king-jena"
}
```
I took sage-5.0.beta9, replaced the ppl package by the one from #12672, added the cloog-ppl package from #12666, replaced the glpk package by the one from #12703, added a new libelf spkg, added the mpc and gcc spkgs from #12369 and modified the gcc spkg such that the gcc is built with support of loop optimization (graphite) and lto.

Then, I tried to build Sage with rather high optimization:

```
king@mpc622:/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/spkg$ echo $CFLAGS
-O3 -march=native -floop-interchange -floop-strip-mine -floop-block -fno-strict-aliasing -flto
king@mpc622:/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/spkg$ echo $CXXFLAGS
-O3 -march=native -floop-interchange -floop-strip-mine -floop-block -fno-strict-aliasing -flto
king@mpc622:/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/spkg$ echo $LDFLAGS
-flto
```

Moreover, I attempted to build parallely (four threads).

However, Singular failed to build. Note that dropping -flto would enable to build Singular. Hence, the problem really seems to be -flto, whereas `make -j4` and `-march=native` and `-floop*` seems to be fine.

It seems to me that LDFLAGS is not correctly passed. Namely, in the [install log](http://boxen.math.washington.edu/home/SimonKing/SAGE/install_logs/singular-3-1-3-3.p6.log), I read

```
g++ -O3 -march=native -floop-interchange -floop-strip-mine -floop-block -fno-strict-aliasing -flto -O2 -g -fPIC -pipe  -fno-implicit-templates -I. -I.. -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.bet
a9/local  -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/local/include -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/local/include -I/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta9/local/include   -DNDEBUG -DOM_NDEBUG -Dx86_64_Linux -DHAVE_CONFIG_H -fpic -DPIC -Dp_Procs_FieldQ -c p_Procs_Lib.cc -o p_Procs_Lib_FieldQ.dl_o
```
but

```
ld -shared -o p_Procs_FieldQ.sog p_Procs_Lib_FieldQ.dl_og
...
ld -shared -o p_Procs_FieldQ.so p_Procs_Lib_FieldQ.dl_o
```

Moreover, I see that libfac/Makefile.dist defines LDFLAGS empty

```
  LDFLAGS=
```
and defines

```
  LD = g++ $(ALLFLAGS)
```
where LDFLAGS does not appear in the definition of ALLFLAGS.

Assignee: tbd

CC:  @nexttime @nathanncohen @malb

Keywords: singular lto gcc

Upstream: Reported upstream. No feedback yet.

Reviewer: Michael Orlitzky

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/12738





---

archive/issue_comments_158563.json:
```json
{
    "body": "<a id='comment:1'></a>Cc to Martin, because I suppose he knows a lot about the Singular spkg...",
    "created_at": "2012-03-23T20:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158563",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:1'></a>Cc to Martin, because I suppose he knows a lot about the Singular spkg...



---

archive/issue_comments_158564.json:
```json
{
    "body": "<a id='comment:2'></a>Leif said at #12703: \"Btw., parts of Singular still seem to disrespect CXXFLAGS, i.e., some C++ sources are compiled only using CPPFLAGS.\" However, adding CPPFLAGS did not help.",
    "created_at": "2012-03-23T20:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158564",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Leif said at #12703: "Btw., parts of Singular still seem to disrespect CXXFLAGS, i.e., some C++ sources are compiled only using CPPFLAGS." However, adding CPPFLAGS did not help.



---

archive/issue_comments_158565.json:
```json
{
    "body": "<a id='comment:4'></a>See #12741: There is a similar problem with R.",
    "created_at": "2012-03-24T11:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158565",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>See #12741: There is a similar problem with R.



---

archive/issue_comments_158566.json:
```json
{
    "body": "<a id='comment:5'></a>To me this all smells more like a problem with the GCC setup (i.e., the Sage GCC spkg), as I don't have any problems compiling Sage 5.0beta{8,9} (with some spkgs replaced, see `sage-release`) with GCC 4.6.3 and `-flto` (as well as Graphite loop optimization) enabled.",
    "created_at": "2012-03-24T11:32:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158566",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>To me this all smells more like a problem with the GCC setup (i.e., the Sage GCC spkg), as I don't have any problems compiling Sage 5.0beta{8,9} (with some spkgs replaced, see `sage-release`) with GCC 4.6.3 and `-flto` (as well as Graphite loop optimization) enabled.



---

archive/issue_comments_158567.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 leif]:\n> To me this all smells more like a problem with the GCC setup (i.e., the Sage GCC spkg)\n\n\nThen it would probably be fair to say that it is a problem with how I modified the GCC spkg, so that it supports graphite and lto in the first place. The diff with respect to the spkg from #12369 is\n\n```diff\ndiff --git a/spkg-install b/spkg-install\n--- a/spkg-install\n+++ b/spkg-install\n@@ -82,6 +82,8 @@\n ../src/configure \\\n     --prefix=\"$SAGE_LOCAL\" \\\n     --with-local-prefix=\"$SAGE_LOCAL\" \\\n+    --with-cloog=\"$SAGE_LOCAL\" --with-ppl=\"$SAGE_LOCAL\" \\\n+    --enable-lto \\\n     --with-gmp=\"$SAGE_LOCAL\" --with-mpfr=\"$SAGE_LOCAL\" --with-mpc=\"$SAGE_LOCAL\" \\\n     --with-system-zlib \\\n     --disable-multilib \\\n```\n\nAnd of course I also added a libelf spkg (not published yet, but it is just upstream sources) and a cloog-ppl spkg (#12666).\n\nJust for the record: Singular does build with the gcc from the modified spkg, as soon as one drops -flto, while -floop* is fine.",
    "created_at": "2012-03-24T11:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158567",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>Replying to [comment:5 leif]:
> To me this all smells more like a problem with the GCC setup (i.e., the Sage GCC spkg)


Then it would probably be fair to say that it is a problem with how I modified the GCC spkg, so that it supports graphite and lto in the first place. The diff with respect to the spkg from #12369 is

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -82,6 +82,8 @@
 ../src/configure \
     --prefix="$SAGE_LOCAL" \
     --with-local-prefix="$SAGE_LOCAL" \
+    --with-cloog="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL" \
+    --enable-lto \
     --with-gmp="$SAGE_LOCAL" --with-mpfr="$SAGE_LOCAL" --with-mpc="$SAGE_LOCAL" \
     --with-system-zlib \
     --disable-multilib \
```

And of course I also added a libelf spkg (not published yet, but it is just upstream sources) and a cloog-ppl spkg (#12666).

Just for the record: Singular does build with the gcc from the modified spkg, as soon as one drops -flto, while -floop* is fine.



---

archive/issue_comments_158568.json:
```json
{
    "body": "<a id='comment:7'></a>Furthermore (this is Sage 5.0.beta10, which doesn't matter here, GCC 4.6.3, but with binutils 2.22, and `LDFLAGS=\"-flto -fuse-linker-plugin\"`):\n\n```\nlto1: internal compiler error: in lto_varpool_replace_node, at lto-symtab.c:304\nPlease submit a full bug report,\nwith preprocessed source if appropriate.\nSee <http://gcc.gnu.org/bugs.html> for instructions.\nlto-wrapper: g++-4.6.3 returned 1 exit status\n/usr/local/bin/ld: lto-wrapper failed\ncollect2: ld returned 1 exit status\nmake[4]: *** [Singular] Error 1\nmake[4]: Leaving directory `/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/spkg/build/singular-3-1-3-3.p6/src/Singular'\nmake[3]: *** [install] Error 1\nmake[3]: Leaving directory `/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/spkg/build/singular-3-1-3-3.p6/src'\nmake[2]: *** [/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/local/bin/Singular-3-1-3] Error 2\nmake[2]: Leaving directory `/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/spkg/build/singular-3-1-3-3.p6/src'\nUnable to build Singular.\n```\n\nBut this *might* simply be a hidden \"no space left on device\" error, as `/tmp` is currently on my almost full root partition -- will retry later...",
    "created_at": "2012-03-25T01:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158568",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>Furthermore (this is Sage 5.0.beta10, which doesn't matter here, GCC 4.6.3, but with binutils 2.22, and `LDFLAGS="-flto -fuse-linker-plugin"`):

```
lto1: internal compiler error: in lto_varpool_replace_node, at lto-symtab.c:304
Please submit a full bug report,
with preprocessed source if appropriate.
See <http://gcc.gnu.org/bugs.html> for instructions.
lto-wrapper: g++-4.6.3 returned 1 exit status
/usr/local/bin/ld: lto-wrapper failed
collect2: ld returned 1 exit status
make[4]: *** [Singular] Error 1
make[4]: Leaving directory `/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/spkg/build/singular-3-1-3-3.p6/src/Singular'
make[3]: *** [install] Error 1
make[3]: Leaving directory `/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/spkg/build/singular-3-1-3-3.p6/src'
make[2]: *** [/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/local/bin/Singular-3-1-3] Error 2
make[2]: Leaving directory `/data/leif/Sage/sage-5.0.beta10-gcc-4.6.3-LTO/spkg/build/singular-3-1-3-3.p6/src'
Unable to build Singular.
```

But this *might* simply be a hidden "no space left on device" error, as `/tmp` is currently on my almost full root partition -- will retry later...



---

archive/issue_comments_158569.json:
```json
{
    "body": "<a id='comment:8'></a>Ooops, somehow forgot to hit the submit button...\n\nReplying to [comment:7 leif]:\n> Furthermore (this is Sage 5.0.beta10, which doesn't matter here, GCC 4.6.3, but with binutils 2.22, and `LDFLAGS=\"-flto -fuse-linker-plugin\"`):\n> \n> \n> ```\n> lto1: internal compiler error: in lto_varpool_replace_node, at lto-symtab.c:304\n> ...\n> ```\n> \n> But this *might* simply be a hidden \"no space left on device\" error, as `/tmp` is currently on my almost full root partition -- will retry later...\n\n\nNope, it was not.  But I can currently get around that bug by omitting `-fuse-linker-plugin` from `LDFLAGS`.",
    "created_at": "2012-03-25T01:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158569",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>Ooops, somehow forgot to hit the submit button...

Replying to [comment:7 leif]:
> Furthermore (this is Sage 5.0.beta10, which doesn't matter here, GCC 4.6.3, but with binutils 2.22, and `LDFLAGS="-flto -fuse-linker-plugin"`):
> 
> 
> ```
> lto1: internal compiler error: in lto_varpool_replace_node, at lto-symtab.c:304
> ...
> ```
> 
> But this *might* simply be a hidden "no space left on device" error, as `/tmp` is currently on my almost full root partition -- will retry later...


Nope, it was not.  But I can currently get around that bug by omitting `-fuse-linker-plugin` from `LDFLAGS`.



---

archive/issue_comments_158570.json:
```json
{
    "body": "<a id='comment:9'></a>Hi! With the new setting (i.e., with a binutils-2.22.spkg), I seemingly get exactly the same problem as you:\n\n```\niplib.cc:68:14: Warnung: Typ von \u00bbyylp_errlist\u00ab passt nicht zur urspr\u00fcnglichen Deklaration [standardm\u00e4\u00dfig aktiviert]\nlibparse.l:63:13: Anmerkung: vorher hier deklariert\nlto1: interner Compiler-Fehler: in lto_varpool_replace_node, bei lto-symtab.c:304\nBitte senden Sie einen vollst\u00e4ndigen Fehlerbericht auf Englisch ein;\nbearbeiten Sie die Quellen zun\u00e4chst mit einem Pr\u00e4prozessor, wenn es\ndienlich ist.\nFehler in der deutschen \u00dcbersetzung sind an translation-team-de@lists.sourceforge.net zu melden.\n\nGehen Sie gem\u00e4\u00df den Hinweisen in <http://gcc.gnu.org/bugs.html> vor.\nlto-wrapper: g++ gab Ende-Status 1 zur\u00fcck\n/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/local/lib/gcc/x86_64-unknown-linux-gnu/4.6.3/../../../../x86_64-unknown-linux-gnu/bin/ld: lto-wrapper failed\ncollect2: ld gab 1 als Ende-Status zur\u00fcck\nmake[4]: *** [Singular] Fehler 1\nmake[4]: Leaving directory `/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/spkg/build/singular-3-1-3-3.p6/src/Singular'\nmake[3]: *** [install] Fehler 1\nmake[3]: Leaving directory `/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/spkg/build/singular-3-1-3-3.p6/src'\nmake[2]: *** [/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/local/bin/Singular-3-1-3] Fehler 2\nmake[2]: Leaving directory `/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/spkg/build/singular-3-1-3-3.p6/src'\nUnable to build Singular.\n```\n\nI am now trying to drop `-fuse-linker-plugin`",
    "created_at": "2012-03-25T07:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158570",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'></a>Hi! With the new setting (i.e., with a binutils-2.22.spkg), I seemingly get exactly the same problem as you:

```
iplib.cc:68:14: Warnung: Typ von »yylp_errlist« passt nicht zur ursprünglichen Deklaration [standardmäßig aktiviert]
libparse.l:63:13: Anmerkung: vorher hier deklariert
lto1: interner Compiler-Fehler: in lto_varpool_replace_node, bei lto-symtab.c:304
Bitte senden Sie einen vollständigen Fehlerbericht auf Englisch ein;
bearbeiten Sie die Quellen zunächst mit einem Präprozessor, wenn es
dienlich ist.
Fehler in der deutschen Übersetzung sind an translation-team-de@lists.sourceforge.net zu melden.

Gehen Sie gemäß den Hinweisen in <http://gcc.gnu.org/bugs.html> vor.
lto-wrapper: g++ gab Ende-Status 1 zurück
/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/local/lib/gcc/x86_64-unknown-linux-gnu/4.6.3/../../../../x86_64-unknown-linux-gnu/bin/ld: lto-wrapper failed
collect2: ld gab 1 als Ende-Status zurück
make[4]: *** [Singular] Fehler 1
make[4]: Leaving directory `/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/spkg/build/singular-3-1-3-3.p6/src/Singular'
make[3]: *** [install] Fehler 1
make[3]: Leaving directory `/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/spkg/build/singular-3-1-3-3.p6/src'
make[2]: *** [/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/local/bin/Singular-3-1-3] Fehler 2
make[2]: Leaving directory `/mnt/local/king/SAGE/testinggcc/lto/sage-5.0.beta10/spkg/build/singular-3-1-3-3.p6/src'
Unable to build Singular.
```

I am now trying to drop `-fuse-linker-plugin`



---

archive/issue_comments_158571.json:
```json
{
    "body": "<a id='comment:10'></a>I tried to drop -fuse-linker-plugin from LDFLAGS, but it didn't help. I tried to drop it from both LDFLAGS and C(XX)FLAGS, but it didn't help either. The [install log](http://boxen.math.washington.edu/home/SimonKing/SAGE/install_logs/singular_lto.log) should contain all three failing sessions, I don't know if there is any visible difference between the three.",
    "created_at": "2012-03-25T07:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158571",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>I tried to drop -fuse-linker-plugin from LDFLAGS, but it didn't help. I tried to drop it from both LDFLAGS and C(XX)FLAGS, but it didn't help either. The [install log](http://boxen.math.washington.edu/home/SimonKing/SAGE/install_logs/singular_lto.log) should contain all three failing sessions, I don't know if there is any visible difference between the three.



---

archive/issue_comments_158572.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 SimonKing]:\n> I tried to drop -fuse-linker-plugin from LDFLAGS, but it didn't help.\n\n\nThat only worked for me because I had built GCC 4.6.3 with older binutils, in particular GNU `ld` 2.20.*.\n\n(If a plugin-capable linker is present during the build of GCC, you later don't have to specify `-fuse-linker-plugin` at all.)",
    "created_at": "2012-03-25T09:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158572",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>Replying to [comment:10 SimonKing]:
> I tried to drop -fuse-linker-plugin from LDFLAGS, but it didn't help.


That only worked for me because I had built GCC 4.6.3 with older binutils, in particular GNU `ld` 2.20.*.

(If a plugin-capable linker is present during the build of GCC, you later don't have to specify `-fuse-linker-plugin` at all.)



---

archive/issue_comments_158573.json:
```json
{
    "body": "<a id='comment:12'></a>In the ticket description, I mentioned that the user-defined LDFLAGS is overridden in libfac/Makefile.dist. So, I commented out the line in which that happens. Keeping my fingers crossed that it solves the problem...",
    "created_at": "2012-03-25T09:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158573",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'></a>In the ticket description, I mentioned that the user-defined LDFLAGS is overridden in libfac/Makefile.dist. So, I commented out the line in which that happens. Keeping my fingers crossed that it solves the problem...



---

archive/issue_comments_158574.json:
```json
{
    "body": "<a id='comment:13'></a>Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.",
    "created_at": "2012-03-25T09:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158574",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'></a>Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.



---

archive/issue_comments_158575.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 SimonKing]:\n> Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.\n\n\nAs expected... :-(",
    "created_at": "2012-03-25T09:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158575",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:14'></a>Replying to [comment:13 SimonKing]:
> Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.


As expected... :-(



---

archive/issue_comments_158576.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 leif]:\n> Replying to [comment:13 SimonKing]:\n> > Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.\n\n> \n> As expected... :-(\n\n\nWhy expected? I thought that the problem is that Singular does not take LDFLAGS into account!",
    "created_at": "2012-03-25T09:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158576",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'></a>Replying to [comment:14 leif]:
> Replying to [comment:13 SimonKing]:
> > Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.

> 
> As expected... :-(


Why expected? I thought that the problem is that Singular does not take LDFLAGS into account!



---

archive/issue_comments_158577.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 SimonKing]:\n> Replying to [comment:14 leif]:\n> > Replying to [comment:13 SimonKing]:\n> > > Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.\n\n> > \n> > As expected... :-(\n\n> \n> Why expected? I thought that the problem is that Singular does not take LDFLAGS into account!\n\n\nBecause dropping `-flto` shouldn't have any effect except that LTO simply won't happen.\n\nOf course there are some other effects, e.g. regarding the size of the object files (and of course compile time), depending on *where* you drop it, if not everywhere.\n\n`-flto` *during compilation* just prepares the generated object files for LTO (i.e., adds the extra information needed later); `-flto` during the link phase then triggers LTO.  If some object files or libraries lack the special sections needed, they're just excluded from LTO, as there's no information available on them.  This is very similar to compiling with `-g`, and later using the debugger.",
    "created_at": "2012-03-25T09:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158577",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:16'></a>Replying to [comment:15 SimonKing]:
> Replying to [comment:14 leif]:
> > Replying to [comment:13 SimonKing]:
> > > Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.

> > 
> > As expected... :-(

> 
> Why expected? I thought that the problem is that Singular does not take LDFLAGS into account!


Because dropping `-flto` shouldn't have any effect except that LTO simply won't happen.

Of course there are some other effects, e.g. regarding the size of the object files (and of course compile time), depending on *where* you drop it, if not everywhere.

`-flto` *during compilation* just prepares the generated object files for LTO (i.e., adds the extra information needed later); `-flto` during the link phase then triggers LTO.  If some object files or libraries lack the special sections needed, they're just excluded from LTO, as there's no information available on them.  This is very similar to compiling with `-g`, and later using the debugger.



---

archive/issue_comments_158578.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 leif]:\n> Replying to [comment:15 SimonKing]:\n> > Replying to [comment:14 leif]:\n> > > Replying to [comment:13 SimonKing]:\n> > > > Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.\n\n> > > \n> > > As expected... :-(\n\n> > \n> > Why expected? I thought that the problem is that Singular does not take LDFLAGS into account!\n\n> \n> Because dropping `-flto` shouldn't have any effect except that LTO simply won't happen.\n\n\nI was not talking about \"dropping -flto\" but about modifying the Singular sources such that LDFLAGS is not overridden.",
    "created_at": "2012-03-25T10:12:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158578",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:17'></a>Replying to [comment:16 leif]:
> Replying to [comment:15 SimonKing]:
> > Replying to [comment:14 leif]:
> > > Replying to [comment:13 SimonKing]:
> > > > Just as I wrote the previous comment, building Singular failed again, with the same error `in lto_varpool_replace_node, bei lto-symtab.c:304`.

> > > 
> > > As expected... :-(

> > 
> > Why expected? I thought that the problem is that Singular does not take LDFLAGS into account!

> 
> Because dropping `-flto` shouldn't have any effect except that LTO simply won't happen.


I was not talking about "dropping -flto" but about modifying the Singular sources such that LDFLAGS is not overridden.



---

archive/issue_comments_158579.json:
```json
{
    "body": "<a id='comment:18'></a>To be more precise:\n\n* Singular dropping / ignoring `*FLAGS` (in this case, `-flto`, or `LDFLAGS` *from compiler link commands*) isn't nice, likewise ignoring `CXXFLAGS` in some compile commands, and should probably get fixed and reported upstream, but *should **not break** the build* (at least not if only `-flto` isn't passed to the compiler).\n\n* The error we get with LTO (when enabled during the link phase), which makes the build *fail*, is a **GCC bug**, and should get reported GCC upstream.",
    "created_at": "2012-03-25T10:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158579",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:18'></a>To be more precise:

* Singular dropping / ignoring `*FLAGS` (in this case, `-flto`, or `LDFLAGS` *from compiler link commands*) isn't nice, likewise ignoring `CXXFLAGS` in some compile commands, and should probably get fixed and reported upstream, but *should **not break** the build* (at least not if only `-flto` isn't passed to the compiler).

* The error we get with LTO (when enabled during the link phase), which makes the build *fail*, is a **GCC bug**, and should get reported GCC upstream.



---

archive/issue_comments_158580.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 leif]:\n>  * The error we get with LTO (when enabled during the link phase), which makes the build *fail*, is a **GCC bug**, and should get reported GCC upstream.\n\n\nOK. Can you do that? Because apparently the gcc spkg was automatically building a \"localized\" version, such that the error messages are German, but they ask for a report in English.",
    "created_at": "2012-03-25T10:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158580",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:19'></a>Replying to [comment:18 leif]:
>  * The error we get with LTO (when enabled during the link phase), which makes the build *fail*, is a **GCC bug**, and should get reported GCC upstream.


OK. Can you do that? Because apparently the gcc spkg was automatically building a "localized" version, such that the error messages are German, but they ask for a report in English.



---

archive/issue_comments_158581.json:
```json
{
    "body": "<a id='comment:20'></a>Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)",
    "created_at": "2012-03-25T19:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158581",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:20'></a>Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)



---

archive/issue_comments_158582.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 leif]:\n> Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)\n\n\nCongrats. I just failed to build Maxima with GCC 4.6.3 and LTO enabled. Interestingly, maxima has not been a problem with -flto (if I remember correctly), but now I had -flto -fuse-linker-plugin.",
    "created_at": "2012-03-25T20:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158582",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:21'></a>Replying to [comment:20 leif]:
> Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)


Congrats. I just failed to build Maxima with GCC 4.6.3 and LTO enabled. Interestingly, maxima has not been a problem with -flto (if I remember correctly), but now I had -flto -fuse-linker-plugin.



---

archive/issue_comments_158583.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 SimonKing]:\n> Replying to [comment:20 leif]:\n> > Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)\n\n> \n> Congrats. I just failed to build Maxima with GCC 4.6.3 and LTO enabled. Interestingly, maxima has not been a problem with -flto (if I remember correctly), but now I had -flto -fuse-linker-plugin.\n\n\nSee [comment:ticket:12741:10 my comment] at #12741.  I've also posted to sage-release, and do have an spkg fixing this: :-)\n\n[maxima-5.26.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/maxima-5.26.0.p1.spkg) (Changes not yet committed due to lacking ticket number, haven't yet opened one for that.)",
    "created_at": "2012-03-25T21:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158583",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>Replying to [comment:21 SimonKing]:
> Replying to [comment:20 leif]:
> > Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)

> 
> Congrats. I just failed to build Maxima with GCC 4.6.3 and LTO enabled. Interestingly, maxima has not been a problem with -flto (if I remember correctly), but now I had -flto -fuse-linker-plugin.


See [comment:ticket:12741:10 my comment] at #12741.  I've also posted to sage-release, and do have an spkg fixing this: :-)

[maxima-5.26.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/maxima-5.26.0.p1.spkg) (Changes not yet committed due to lacking ticket number, haven't yet opened one for that.)



---

archive/issue_comments_158584.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 leif]:\n> Replying to [comment:21 SimonKing]:\n> > Replying to [comment:20 leif]:\n> > > Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)\n\n> > \n> > Congrats. I just failed to build Maxima with GCC 4.6.3 and LTO enabled. Interestingly, maxima has not been a problem with -flto (if I remember correctly), but now I had -flto -fuse-linker-plugin.\n  \n> \n> See [comment:ticket:12741:10 my comment] at #12741.  I've also posted to sage-release, and do have an spkg fixing this: :-)\n> \n> [maxima-5.26.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/maxima-5.26.0.p1.spkg) (Changes not yet committed due to lacking ticket number, haven't yet opened one for that.)\n\n\nOh, forgot: This is now #12759 (changes committed, needing review :P ).",
    "created_at": "2012-04-08T00:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158584",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>Replying to [comment:22 leif]:
> Replying to [comment:21 SimonKing]:
> > Replying to [comment:20 leif]:
> > > Just successfully built Singular (3-1-3-3.p6) with GCC **4.7.0** and LTO enabled. :-)

> > 
> > Congrats. I just failed to build Maxima with GCC 4.6.3 and LTO enabled. Interestingly, maxima has not been a problem with -flto (if I remember correctly), but now I had -flto -fuse-linker-plugin.
  
> 
> See [comment:ticket:12741:10 my comment] at #12741.  I've also posted to sage-release, and do have an spkg fixing this: :-)
> 
> [maxima-5.26.0.p1.spkg](http://boxen.math.washington.edu/home/leif/Sage/spkgs/maxima-5.26.0.p1.spkg) (Changes not yet committed due to lacking ticket number, haven't yet opened one for that.)


Oh, forgot: This is now #12759 (changes committed, needing review :P ).



---

archive/issue_comments_158585.json:
```json
{
    "body": "<a id='comment:25'></a>Is this still an issue (with Singular 3-1-5, newer GCC versions...)?",
    "created_at": "2013-06-13T15:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158585",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:25'></a>Is this still an issue (with Singular 3-1-5, newer GCC versions...)?



---

archive/issue_comments_158586.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2013-06-13T15:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158586",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_info.



---

archive/issue_events_034621.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34621"
}
```



---

archive/issue_events_034622.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34622"
}
```



---

archive/issue_events_034623.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34623"
}
```



---

archive/issue_events_034624.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34624"
}
```



---

archive/issue_events_034625.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34625"
}
```



---

archive/issue_events_034626.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34626"
}
```



---

archive/issue_events_034627.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34627"
}
```



---

archive/issue_comments_158587.json:
```json
{
    "body": "<a id='comment:30'></a>outdated, should close",
    "created_at": "2021-09-10T06:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158587",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>outdated, should close



---

archive/issue_comments_158588.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-09-10T06:48:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158588",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_034628.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-10T06:48:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34628"
}
```



---

archive/issue_events_034629.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-10T06:48:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34629"
}
```



---

archive/issue_comments_158589.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-18T10:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158589",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_158590.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-09-18T17:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12738#issuecomment-158590",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_034630.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-18T17:51:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12738",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12738#event-34630"
}
```
