# Issue 12318: **kwds in the Graph constructor is confusing

archive/issues_012146.json:
```json
{
    "body": "The possibility of using any argument in the Graph constructor without an error is very confusing, see #10441 for some example. Is the universal **kwds argument necessary?\n\nApply:\n* [attachment:trac_12318_removing_kwds.3.patch]\n* [attachment:trac_12318_review.patch]\n\nAssignee: jason, ncohen, rlm\n\nCC:  brunellus\n\nResolution: fixed\n\nAuthor: Luk\u00e1\u0161 L\u00e1nsk\u00fd\n\nReviewer: Nathann Cohen\n\nMerged: sage-5.0.beta4\n\nIssue created by migration from https://trac.sagemath.org/ticket/12318\n\n",
    "closed_at": "2012-02-14T14:21:17Z",
    "created_at": "2012-01-17T23:08:55Z",
    "labels": [
        "component: graph theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "**kwds in the Graph constructor is confusing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12318",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```
The possibility of using any argument in the Graph constructor without an error is very confusing, see #10441 for some example. Is the universal **kwds argument necessary?

Apply:
* [attachment:trac_12318_removing_kwds.3.patch]
* [attachment:trac_12318_review.patch]

Assignee: jason, ncohen, rlm

CC:  brunellus

Resolution: fixed

Author: Lukáš Lánský

Reviewer: Nathann Cohen

Merged: sage-5.0.beta4

Issue created by migration from https://trac.sagemath.org/ticket/12318





---

archive/issue_comments_149653.json:
```json
{
    "body": "<a id='comment:1'></a>As you can see in this patch, there were three wrong (quietly disfunctional) calls in the sage library itself.\n\nI'll think if there is something I can do with BipartiteGraph constructor. It's quite messy.",
    "created_at": "2012-01-18T18:40:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149653",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:1'></a>As you can see in this patch, there were three wrong (quietly disfunctional) calls in the sage library itself.

I'll think if there is something I can do with BipartiteGraph constructor. It's quite messy.



---

archive/issue_comments_149654.json:
```json
{
    "body": "Attachment [trac_12318_removing_kwds.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_removing_kwds.patch) by brunellus created at 2012-01-19 01:56:57",
    "created_at": "2012-01-19T01:56:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149654",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Attachment [trac_12318_removing_kwds.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_removing_kwds.patch) by brunellus created at 2012-01-19 01:56:57



---

archive/issue_comments_149655.json:
```json
{
    "body": "Attachment [trac_12318_removing_kwds.2.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_removing_kwds.2.patch) by brunellus created at 2012-01-20 11:29:22",
    "created_at": "2012-01-20T11:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149655",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Attachment [trac_12318_removing_kwds.2.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_removing_kwds.2.patch) by brunellus created at 2012-01-20 11:29:22



---

archive/issue_comments_149656.json:
```json
{
    "body": "<a id='comment:2'></a>OK, this should be it. In the bipartite case I left *args and **kwds in the constructor, but they are only used to construct a Graph now, so this should be safe.",
    "created_at": "2012-01-20T11:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149656",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:2'></a>OK, this should be it. In the bipartite case I left *args and **kwds in the constructor, but they are only used to construct a Graph now, so this should be safe.



---

archive/issue_comments_149657.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-20T11:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149657",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149658.json:
```json
{
    "body": "<a id='comment:3'></a>Wow, veeeeeeery good idea !!!\n\nSeveral remarks :\n\n* in BipartiteGraph : could you explicit in the description of the ``check`` flag what \"changing the graph to be bipartite\" means ? The documentation later says \"However, if one specifies check=False, the offending edges are simply deleted (along with those vertices not appearing in either list)\" but it is easy to miss.\n\n* Your test \n\n```\nif len(partition[0]) > 0 or len(partition[1]) > 0: \n```\n      Can be replaced by\n\n```\nif partition[0] or partition[1]: \n```\n      Python is funny sometimes `:-p`\n* Why did you replace \n\n```\n#. An arbitrary graph (finds a bipartition). \n#. A graph and a bipartition. \n```\n      By\n\n```\n#. An arbitrary graph. \n```\n      ? `O_o`\n* The line \"- all remaining arguments are passed to the ``Graph`` constructor\" would fit well inside of a \".. NOTE::\" field.\n\n* What about making what \"``convert_empty_dict_labels_to_None``\" does more explicit ? Something saying \"you don't have to care as long as you do not deal with NetworkX\". For instance : \"This arguments sets the default edge labels used by NetworkX (empty dictionaries) to be replaced by ``None``, the default Sage edge label. It is set to ``True`` by default.\n\nNathann",
    "created_at": "2012-01-28T13:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149658",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>Wow, veeeeeeery good idea !!!

Several remarks :

* in BipartiteGraph : could you explicit in the description of the ``check`` flag what "changing the graph to be bipartite" means ? The documentation later says "However, if one specifies check=False, the offending edges are simply deleted (along with those vertices not appearing in either list)" but it is easy to miss.

* Your test 

```
if len(partition[0]) > 0 or len(partition[1]) > 0: 
```
      Can be replaced by

```
if partition[0] or partition[1]: 
```
      Python is funny sometimes `:-p`
* Why did you replace 

```
#. An arbitrary graph (finds a bipartition). 
#. A graph and a bipartition. 
```
      By

```
#. An arbitrary graph. 
```
      ? `O_o`
* The line "- all remaining arguments are passed to the ``Graph`` constructor" would fit well inside of a ".. NOTE::" field.

* What about making what "``convert_empty_dict_labels_to_None``" does more explicit ? Something saying "you don't have to care as long as you do not deal with NetworkX". For instance : "This arguments sets the default edge labels used by NetworkX (empty dictionaries) to be replaced by ``None``, the default Sage edge label. It is set to ``True`` by default.

Nathann



---

archive/issue_comments_149659.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-28T13:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149659",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149660.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks!\n\nReplying to [comment:3 ncohen]:\n>     * Why did you replace \n \n> {{{\n> #. An arbitrary graph (finds a bipartition). \n> #. A graph and a bipartition. \n> }}}\n>       By\n> \n> ```\n> #. An arbitrary graph. \n> ```\n>       ? `O_o`\n\n\nWell, the *data* argument doesn't hold any information about partition. \"A graph and a bipartion\" seems like someone could write BipartiteGraph(data=(Graph(...), [...]))\n\nLuk\u00e1\u0161.",
    "created_at": "2012-01-28T14:11:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149660",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:4'></a>Thanks!

Replying to [comment:3 ncohen]:
>     * Why did you replace 
 
> {{{
> #. An arbitrary graph (finds a bipartition). 
> #. A graph and a bipartition. 
> }}}
>       By
> 
> ```
> #. An arbitrary graph. 
> ```
>       ? `O_o`


Well, the *data* argument doesn't hold any information about partition. "A graph and a bipartion" seems like someone could write BipartiteGraph(data=(Graph(...), [...]))

Lukáš.



---

archive/issue_comments_149661.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-01-28T18:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149661",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_149662.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n The possibility of using any argument in the Graph constructor without an error is very confusing, see #10441 for some example. Is the universal **kwds argument necessary?\n+\n+Apply:\n+* [attachment:trac_12318_removing_kwds.3.patch]\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-01-28T18:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149662",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
 The possibility of using any argument in the Graph constructor without an error is very confusing, see #10441 for some example. Is the universal **kwds argument necessary?
+
+Apply:
+* [attachment:trac_12318_removing_kwds.3.patch]
 
 Comment: 1
 
``````




---

archive/issue_comments_149663.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [trac_12318_removing_kwds.3.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_removing_kwds.3.patch) by @nathanncohen created at 2012-01-28 18:06:27\n\nAfter another review and looooooong tests on Sage, this patch can go ! `:-)`\n\nNathann",
    "created_at": "2012-01-28T18:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149663",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Attachment [trac_12318_removing_kwds.3.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_removing_kwds.3.patch) by @nathanncohen created at 2012-01-28 18:06:27

After another review and looooooong tests on Sage, this patch can go ! `:-)`

Nathann



---

archive/issue_comments_149664.json:
```json
{
    "body": "<a id='comment:7'></a>I get doctest failures:\n\n```\nsage -t  -force_lib devel/sage/sage/geometry/triangulation/point_configuration.py\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py\", line 1620:\n    sage: pyramid.restricted_automorphism_group()\nExpected:\n    Permutation Group with generators [(3,5), (2,3)(4,5), (2,4)]\nGot:\n    Permutation Group with generators [(4,5), (3,4), (2,3), (1,2)]\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py\", line 1622:\n    sage: DihedralGroup(4).is_isomorphic(_)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py\", line 1630:\n    sage: square.restricted_automorphism_group()\nExpected:\n    Permutation Group with generators [(3,5)]\nGot:\n    Permutation Group with generators [(4,5), (3,4), (2,3), (1,2)]\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py\", line 1632:\n    sage: DihedralGroup(1).is_isomorphic(_)\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\nand similar errors in `devel/sage/sage/geometry/polyhedra.py`.",
    "created_at": "2012-01-30T10:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149664",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I get doctest failures:

```
sage -t  -force_lib devel/sage/sage/geometry/triangulation/point_configuration.py
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py", line 1620:
    sage: pyramid.restricted_automorphism_group()
Expected:
    Permutation Group with generators [(3,5), (2,3)(4,5), (2,4)]
Got:
    Permutation Group with generators [(4,5), (3,4), (2,3), (1,2)]
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py", line 1622:
    sage: DihedralGroup(4).is_isomorphic(_)
Expected:
    True
Got:
    False
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py", line 1630:
    sage: square.restricted_automorphism_group()
Expected:
    Permutation Group with generators [(3,5)]
Got:
    Permutation Group with generators [(4,5), (3,4), (2,3), (1,2)]
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-5.0.beta2/devel/sage-main/sage/geometry/triangulation/point_configuration.py", line 1632:
    sage: DihedralGroup(1).is_isomorphic(_)
Expected:
    True
Got:
    False
**********************************************************************
```
and similar errors in `devel/sage/sage/geometry/polyhedra.py`.



---

archive/issue_comments_149665.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-01-30T10:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149665",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_149666.json:
```json
{
    "body": "<a id='comment:8'></a>My God. It thought it was because I had intalled GAP recently on my machine... There there are exceptions which are not read correctly.. I'll take care of that `O_o`\n\nNathann",
    "created_at": "2012-01-30T10:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149666",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>My God. It thought it was because I had intalled GAP recently on my machine... There there are exceptions which are not read correctly.. I'll take care of that `O_o`

Nathann



---

archive/issue_comments_149667.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-01-30T11:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149667",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149668.json:
```json
{
    "body": "<a id='comment:9'></a>Well....\n\nSo.\n\nIn his patch Lukasz replaced the arguments to Graph that were in the files by what they *intended*. For instance, he replaced dense=True by sparse=False, which makes sense. The thing is that the \"dense\" value was not read by the Graph backend, and as a result writing Graph(dense=True) actually created a sparse Graph.\nHe replaced the values by what was meant, but what was executed was actually different.\nSo I replaced the code, in this second patch, by what was actually run.\n\nAll this tells us is that there's something very wrong with the Dense graph backends. That's urgent to fix but does not mean computations went wrong before, precisely because the dense backend is almost never used.\n\nThis patch \"solves the problem\". And I created ticket #12387 for the dense backend problem.\n\nNathann",
    "created_at": "2012-01-30T11:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149668",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>Well....

So.

In his patch Lukasz replaced the arguments to Graph that were in the files by what they *intended*. For instance, he replaced dense=True by sparse=False, which makes sense. The thing is that the "dense" value was not read by the Graph backend, and as a result writing Graph(dense=True) actually created a sparse Graph.
He replaced the values by what was meant, but what was executed was actually different.
So I replaced the code, in this second patch, by what was actually run.

All this tells us is that there's something very wrong with the Dense graph backends. That's urgent to fix but does not mean computations went wrong before, precisely because the dense backend is almost never used.

This patch "solves the problem". And I created ticket #12387 for the dense backend problem.

Nathann



---

archive/issue_comments_149669.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+The possibility of using any argument in the Graph constructor without an error is very confusing, see #10441 for some example. Is the universal **kwds argument necessary?\n \n+Apply:\n+* [attachment:trac_12318_removing_kwds.3.patch]\n+* [attachment:trac_12318_review.patch]\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-01-30T11:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149669",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,8 @@
+The possibility of using any argument in the Graph constructor without an error is very confusing, see #10441 for some example. Is the universal **kwds argument necessary?
 
+Apply:
+* [attachment:trac_12318_removing_kwds.3.patch]
+* [attachment:trac_12318_review.patch]
 
 Comment: 1
 
``````




---

archive/issue_comments_149670.json:
```json
{
    "body": "Attachment [trac_12318_review.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_review.patch) by @nathanncohen created at 2012-01-30 11:44:43",
    "created_at": "2012-01-30T11:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149670",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_12318_review.patch](tarball://root/attachments/some-uuid/ticket12318/trac_12318_review.patch) by @nathanncohen created at 2012-01-30 11:44:43



---

archive/issue_comments_149671.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks! All tests pass now.",
    "created_at": "2012-02-06T11:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149671",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:10'></a>Thanks! All tests pass now.



---

archive/issue_comments_149672.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-06T11:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149672",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149673.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-14T14:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12318#issuecomment-149673",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_032982.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:21:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12318",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12318#event-32982"
}
```
