# Issue 12924: SchubertPolynomialRing causes symmetrica and Sage to crash on bad input

archive/issues_012752.json:
```json
{
    "assignees": [
        "https://github.com/VivianePons"
    ],
    "body": "The SchubertPolynomialRing expects a permutation as an index. When a list is given which is not a permutation, the object is created anyway. The problem comes when one tries to expand the polynomial, if the index is not a valid permutation, it makes symmetrica crash which makes Sage crash !\n\n```\nsage: S = SchubertPolynomialRing(ZZ)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \nsage: pol = S([2,1,3])\nsage: pol.expand()\nx0\nsage: pol = S([2,1,1])\nsage: pol.expand()\nfunction: mult_apply_integer(2) \npython: function: mult_apply_integer(2) \n: Operation not permitted\n```\nSo the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not.\n\nNew behaviour is now :\n\n```\nsage: X = SchubertPolynomialRing(QQ)\nsage: X._element_constructor_([1,2,1])\nTraceback (most recent call last):\n...\nValueError: The input [1, 2, 1] is not a valid permutation\nsage: X._element_constructor_(Permutation([1,2,1]))\nTraceback (most recent call last):\n...\nValueError: The input [1, 2, 1] is not a valid permutation\n\n```\nTests have been added into the documentation.\n\nThe patch is attached to the ticket and also available into Sage-Combinat\n\nCC:  @sagetrac-sage-combinat @nthiery\n\nKeywords: **days38, Schubert polynomials**\n\nReviewer: **Mike Hansen**\n\nAuthor: **Viviane Pons**\n\nMerged: **sage-5.3.beta1**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12924_\n\n",
    "closed_at": "2012-08-12T18:59:38Z",
    "created_at": "2012-05-08T15:16:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "SchubertPolynomialRing causes symmetrica and Sage to crash on bad input",
    "type": "issue",
    "updated_at": "2012-08-12T18:59:38Z",
    "url": "https://github.com/sagemath/sage/issues/12924",
    "user": "https://github.com/VivianePons"
}
```
The SchubertPolynomialRing expects a permutation as an index. When a list is given which is not a permutation, the object is created anyway. The problem comes when one tries to expand the polynomial, if the index is not a valid permutation, it makes symmetrica crash which makes Sage crash !

```
sage: S = SchubertPolynomialRing(ZZ)                                  
sage: pol = S([2,1,3])
sage: pol.expand()
x0
sage: pol = S([2,1,1])
sage: pol.expand()
function: mult_apply_integer(2) 
python: function: mult_apply_integer(2) 
: Operation not permitted
```
So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not.

New behaviour is now :

```
sage: X = SchubertPolynomialRing(QQ)
sage: X._element_constructor_([1,2,1])
Traceback (most recent call last):
...
ValueError: The input [1, 2, 1] is not a valid permutation
sage: X._element_constructor_(Permutation([1,2,1]))
Traceback (most recent call last):
...
ValueError: The input [1, 2, 1] is not a valid permutation

```
Tests have been added into the documentation.

The patch is attached to the ticket and also available into Sage-Combinat

CC:  @sagetrac-sage-combinat @nthiery

Keywords: **days38, Schubert polynomials**

Reviewer: **Mike Hansen**

Author: **Viviane Pons**

Merged: **sage-5.3.beta1**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/12924_





---

archive/issue_events_178750.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2012-05-08T15:16:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178750"
}
```



---

archive/issue_events_178751.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2012-05-08T15:16:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178751"
}
```



---

archive/issue_events_178752.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2012-05-08T15:16:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178752"
}
```



---

archive/issue_events_178753.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2012-05-08T15:16:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178753"
}
```



---

archive/issue_events_178754.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2012-05-08T15:16:12Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "subject": "https://github.com/VivianePons",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178754"
}
```



---

archive/issue_events_178755.json:
```json
{
    "actor": "https://github.com/VivianePons",
    "created_at": "2012-05-08T18:44:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178755"
}
```



---

archive/issue_comments_146374.json:
```json
{
    "body": "Author: **Viviane Pons**",
    "created_at": "2012-05-08T18:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146374",
    "user": "https://github.com/VivianePons"
}
```

Author: **Viviane Pons**



---

archive/issue_comments_146375.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The SchubertPolynomialRing expects a permutation as an index. When a list is given which is not a permutation, the object is created anyway. The problem comes when one tries to expand the polynomial, if the index is not a valid permutation, it makes symmetrica crash which makes Sage crash ! \n+The SchubertPolynomialRing expects a permutation as an index. When a list is given which is not a permutation, the object is created anyway. The problem comes when one tries to expand the polynomial, if the index is not a valid permutation, it makes symmetrica crash which makes Sage crash !\n \n ```\n sage: S = SchubertPolynomialRing(ZZ)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \n@@ -11,5 +11,20 @@\n python: function: mult_apply_integer(2) \n : Operation not permitted\n ```\n-So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not. \n+So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not.\u00a0\n \n+New behaviour is now :\n+\n+```\n+sage: X = SchubertPolynomialRing(QQ)\n+sage: X._element_constructor_([1,2,1])\n+Traceback (most recent call last):\n+...\n+ValueError: The input [1, 2, 1] is not a valid permutation\n+sage: X._element_constructor_(Permutation([1,2,1]))\n+Traceback (most recent call last):\n+...\n+ValueError: The input [1, 2, 1] is not a valid permutation\n+\n+```\n+Tests have been added into the documentation.\n``````\n",
    "created_at": "2012-05-08T18:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146375",
    "user": "https://github.com/VivianePons"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The SchubertPolynomialRing expects a permutation as an index. When a list is given which is not a permutation, the object is created anyway. The problem comes when one tries to expand the polynomial, if the index is not a valid permutation, it makes symmetrica crash which makes Sage crash ! 
+The SchubertPolynomialRing expects a permutation as an index. When a list is given which is not a permutation, the object is created anyway. The problem comes when one tries to expand the polynomial, if the index is not a valid permutation, it makes symmetrica crash which makes Sage crash !
 
 ```
 sage: S = SchubertPolynomialRing(ZZ)                                  
@@ -11,5 +11,20 @@
 python: function: mult_apply_integer(2) 
 : Operation not permitted
 ```
-So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not. 
+So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not. 
 
+New behaviour is now :
+
+```
+sage: X = SchubertPolynomialRing(QQ)
+sage: X._element_constructor_([1,2,1])
+Traceback (most recent call last):
+...
+ValueError: The input [1, 2, 1] is not a valid permutation
+sage: X._element_constructor_(Permutation([1,2,1]))
+Traceback (most recent call last):
+...
+ValueError: The input [1, 2, 1] is not a valid permutation
+
+```
+Tests have been added into the documentation.
``````




---

archive/issue_comments_146376.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[trac_12924-Schubert-polynomials-input-bug-vp.patch.gz](https://github.com/sagemath/sage/files/ticket12924/trac_12924-Schubert-polynomials-input-bug-vp.patch.gz)**",
    "created_at": "2012-05-08T18:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146376",
    "user": "https://github.com/VivianePons"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[trac_12924-Schubert-polynomials-input-bug-vp.patch.gz](https://github.com/sagemath/sage/files/ticket12924/trac_12924-Schubert-polynomials-input-bug-vp.patch.gz)**



---

archive/issue_comments_146377.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n python: function: mult_apply_integer(2) \n : Operation not permitted\n ```\n-So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not.\u00a0\n+So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not.\n \n New behaviour is now :\n \n@@ -28,3 +28,5 @@\n \n ```\n Tests have been added into the documentation.\n+\n+The patch is attached to the ticket and also available into Sage-Combinat\n``````\n",
    "created_at": "2012-05-08T18:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146377",
    "user": "https://github.com/VivianePons"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 python: function: mult_apply_integer(2) 
 : Operation not permitted
 ```
-So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not. 
+So the idea would be to check when the polynomial is created that the input is correct and raise an exception at this point if it's not.
 
 New behaviour is now :
 
@@ -28,3 +28,5 @@
 
 ```
 Tests have been added into the documentation.
+
+The patch is attached to the ticket and also available into Sage-Combinat
``````




---

archive/issue_comments_146378.json:
```json
{
    "body": "Reviewer: **Mike Hansen**",
    "created_at": "2012-07-31T22:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146378",
    "user": "https://github.com/mwhansen"
}
```

Reviewer: **Mike Hansen**



---

archive/issue_comments_146379.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_12924-doc_fix.patch.gz](https://github.com/sagemath/sage/files/ticket12924/trac_12924-doc_fix.patch.gz)**\n\nI've fixed some of the formatting.  If you're fine with these changes, you can mark this ticket as positive_review.",
    "created_at": "2012-07-31T22:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146379",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_12924-doc_fix.patch.gz](https://github.com/sagemath/sage/files/ticket12924/trac_12924-doc_fix.patch.gz)**

I've fixed some of the formatting.  If you're fine with these changes, you can mark this ticket as positive_review.



---

archive/issue_comments_146380.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt's ok with me ! Thank's for the review",
    "created_at": "2012-08-02T02:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146380",
    "user": "https://github.com/VivianePons"
}
```

<div id="comment:4" align="right">comment:4</div>

It's ok with me ! Thank's for the review



---

archive/issue_events_178756.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2012-08-02T02:40:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178756"
}
```



---

archive/issue_events_178757.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2012-08-02T02:40:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178757"
}
```



---

archive/issue_events_178758.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T18:59:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178758"
}
```



---

archive/issue_events_178759.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T18:59:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12924#event-178759"
}
```



---

archive/issue_comments_146381.json:
```json
{
    "body": "Merged: **sage-5.3.beta1**",
    "created_at": "2012-08-12T18:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12924",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12924#issuecomment-146381",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.3.beta1**
