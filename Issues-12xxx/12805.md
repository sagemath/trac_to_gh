# Issue 12805: Do not create SAGE_TESTDIR/tmp

archive/issues_012633.json:
```json
{
    "body": "The script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.\n\nApply [attachment:trac_12805-no-tmp.patch] to the scripts repository.\n\n**Assignee:** mvngu\n\n**CC:**  @nexttime\n\n**Keywords:** sage-test SAGE_TESTDIR tmp\n\n**Reviewer:** Leif Leonhardy\n\n**Author:** John Palmieri\n\n**Merged:** sage-5.0.beta13\n\nIssue created by migration from https://trac.sagemath.org/ticket/12805\n\n",
    "closed_at": "2012-04-07T15:09:53Z",
    "created_at": "2012-04-03T21:03:30Z",
    "labels": [
        "component: doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Do not create SAGE_TESTDIR/tmp",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12805",
    "user": "https://github.com/jhpalmieri"
}
```
The script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.

Apply [attachment:trac_12805-no-tmp.patch] to the scripts repository.

**Assignee:** mvngu

**CC:**  @nexttime

**Keywords:** sage-test SAGE_TESTDIR tmp

**Reviewer:** Leif Leonhardy

**Author:** John Palmieri

**Merged:** sage-5.0.beta13

Issue created by migration from https://trac.sagemath.org/ticket/12805





---

archive/attachments_017244.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12805-no-tmp.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12805/trac_12805-no-tmp.patch",
    "created_at": "2012-04-03T21:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_178889.json:
```json
{
    "body": "scripts repo",
    "created_at": "2012-04-03T21:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178889",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/issue_comments_178890.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,3 @@\n The script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.\n \n+Apply [attachment:trac_12805-no-tmp.patch] to the scripts repository.\n``````\n",
    "created_at": "2012-04-03T21:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178890",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,3 @@
 The script `sage-test` creates the directory `SAGE_TESTDIR/tmp`, and then that directory is never used for anything. Its presence, combined with the doctests from #12069, results in the temporary doctesting directory (created by `sage -tp ...` or `make ptestlong`, for example) to be nonempty, and therefore not deleted after doctesting, even if all tests passed.
 
+Apply [attachment:trac_12805-no-tmp.patch] to the scripts repository.
``````




---

archive/issue_comments_178891.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-04-03T21:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178891",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_178892.json:
```json
{
    "body": "<a id='comment:2'></a>\nA few ways to test this:\n\n1. Remove the directory `DOT_SAGE/tmp`, and then doctest a single file: `./sage -t devel/sage/sage/tests/arxiv_0812_2725.py`. If you haven't applied the patch, then after testing has completed, you should see `DOT_SAGE/tmp` (which is `SAGE_TESTDIR`) but also `DOT_SAGE/tmp/tmp` (which is useless). After applying the patch, this last directory should not be present.\n2. Run `./sage -tp devel/sage/sage/tests/cmdline.py`. If you haven't applied the patch, you should see a message like\n\n```\nsage -t --long devel/sage/sage/tests/cmdline.py\n\t [24.3 s]\n \n----------------------------------------------------------------------\nThe temporary doctesting directory\n   /Users/palmieri/.sage/tmp/jpalmieri538.math.washington.edu-92341\nwas not removed: it is not empty, presumably because doctests\nfailed or doctesting was interrupted.\n\n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 24.3 seconds\n```\n If you have applied the patch, then you won't see the part about the directory not being empty.",
    "created_at": "2012-04-03T21:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178892",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
A few ways to test this:

1. Remove the directory `DOT_SAGE/tmp`, and then doctest a single file: `./sage -t devel/sage/sage/tests/arxiv_0812_2725.py`. If you haven't applied the patch, then after testing has completed, you should see `DOT_SAGE/tmp` (which is `SAGE_TESTDIR`) but also `DOT_SAGE/tmp/tmp` (which is useless). After applying the patch, this last directory should not be present.
2. Run `./sage -tp devel/sage/sage/tests/cmdline.py`. If you haven't applied the patch, you should see a message like

```
sage -t --long devel/sage/sage/tests/cmdline.py
	 [24.3 s]
 
----------------------------------------------------------------------
The temporary doctesting directory
   /Users/palmieri/.sage/tmp/jpalmieri538.math.washington.edu-92341
was not removed: it is not empty, presumably because doctests
failed or doctesting was interrupted.

----------------------------------------------------------------------
All tests passed!
Total time for all tests: 24.3 seconds
```
 If you have applied the patch, then you won't see the part about the directory not being empty.



---

archive/issue_comments_178893.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-04-03T22:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178893",
    "user": "https://github.com/nexttime"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_178894.json:
```json
{
    "body": "**Reviewer:** Leif Leonhardy",
    "created_at": "2012-04-03T22:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178894",
    "user": "https://github.com/nexttime"
}
```

**Reviewer:** Leif Leonhardy



---

archive/issue_comments_178895.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks, works as expected.",
    "created_at": "2012-04-03T22:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178895",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
Thanks, works as expected.



---

archive/issue_comments_178896.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2012-04-03T22:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178896",
    "user": "https://github.com/nexttime"
}
```

**Author:** John Palmieri



---

archive/issue_events_040962.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-07T15:09:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12805#event-40962"
}
```



---

archive/issue_comments_178897.json:
```json
{
    "body": "**Merged:** sage-5.0.beta13",
    "created_at": "2012-04-07T15:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12805",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12805#issuecomment-178897",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta13
