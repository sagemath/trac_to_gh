# Issue 12855: FLINTQS fails to build on Solaris (with GCC 4.7.x)

archive/issues_012683.json:
```json
{
    "body": "This is a rather subtle issue, related to Solaris' headers, and the fact that GCC (4.7.0) now defines `__cplusplus` to `199711L`, while previous versions defined it to just `1`.\n\nIf `__cplusplus >= 199711L`, a lot of overloaded (originally C) functions like `div()` and `log()` get defined in the `std` namespace (if one includes `math.h`), e.g.\n\n```c++\nfloat std::log(float);             // logf() in C\ndouble std::log(double);           // log() in C\nlong double std::log(long double); // logl() in C\n```\nwhich is correct in the first place, but on Solaris these also end up in the **global** namespace:\n\n```c++\n// /usr/include/math.h\n\n...\n\n#if __cplusplus >= 199711L\n...\nusing std::log;\n...\n#endif\n\n```\n\nNow FLINTQS happens to call `log()` with an `unsigned long` (without a cast) in one place, and with the overloaded functions present as well, the call gets ambiguous.  The obvious, trivial fix is to just cast the argument to a `double`, such that `double log(double)` gets called (as before).\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg)\n\n### flintqs-20070817.p7 (Jeroen Demeyer, 25 May 2012)\n* Trac #12855: Only call log() on float or double types.  This works\n  around a problem with Solaris' libc where log() in C++ is overloaded\n  for float, double and long double but not integer types.\n* Use `patch` for patching, use standard template for spkg-install.\n* Don't retry the build upon failure on x86_64, which seems pointless\n  after #11351.\n\nAssignee: tbd\n\nCC:  @ppurka\n\nKeywords: spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS sd40.5\n\nReviewer: Karl-Dieter Crisman\n\nAuthor: Jeroen Demeyer\n\nMerged: sage-5.1.rc0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12855\n\n",
    "closed_at": "2012-06-28T09:36:27Z",
    "created_at": "2012-04-18T01:33:07Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "FLINTQS fails to build on Solaris (with GCC 4.7.x)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12855",
    "user": "https://github.com/nexttime"
}
```
This is a rather subtle issue, related to Solaris' headers, and the fact that GCC (4.7.0) now defines `__cplusplus` to `199711L`, while previous versions defined it to just `1`.

If `__cplusplus >= 199711L`, a lot of overloaded (originally C) functions like `div()` and `log()` get defined in the `std` namespace (if one includes `math.h`), e.g.

```c++
float std::log(float);             // logf() in C
double std::log(double);           // log() in C
long double std::log(long double); // logl() in C
```
which is correct in the first place, but on Solaris these also end up in the **global** namespace:

```c++
// /usr/include/math.h

...

#if __cplusplus >= 199711L
...
using std::log;
...
#endif

```

Now FLINTQS happens to call `log()` with an `unsigned long` (without a cast) in one place, and with the overloaded functions present as well, the call gets ambiguous.  The obvious, trivial fix is to just cast the argument to a `double`, such that `double log(double)` gets called (as before).

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg)

### flintqs-20070817.p7 (Jeroen Demeyer, 25 May 2012)
* Trac #12855: Only call log() on float or double types.  This works
  around a problem with Solaris' libc where log() in C++ is overloaded
  for float, double and long double but not integer types.
* Use `patch` for patching, use standard template for spkg-install.
* Don't retry the build upon failure on x86_64, which seems pointless
  after #11351.

Assignee: tbd

CC:  @ppurka

Keywords: spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS sd40.5

Reviewer: Karl-Dieter Crisman

Author: Jeroen Demeyer

Merged: sage-5.1.rc0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12855





---

archive/issue_comments_160898.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2012-05-27T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160898",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_160899.json:
```json
{
    "body": "Changing keywords from \"spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS\" to \"spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS sd40.5\".",
    "created_at": "2012-05-27T16:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160899",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS" to "spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS sd40.5".



---

archive/issue_comments_160900.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-05-28T17:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160900",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_160901.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,12 +24,15 @@\n \n Now FLINTQS happens to call `log()` with an `unsigned long` (without a cast) in one place, and with the overloaded functions present as well, the call gets ambiguous.  The obvious, trivial fix is to just cast the argument to a `double`, such that `double log(double)` gets called (as before).\n \n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg)\n \n-\n-\n-There's a lot wrong with the FLINTQS spkg, as I noted a couple of times before, but I won't address other issues *here*.  [The most important fact being that *a newer version* of Bill Hart's quadratic sieve is included in FLINT since a long time, but the FLINT spkg simply doesn't install it.  So the FLINTQS spkg is obsolete in whole, but we can't remove it until *someone*<sup>TM</sup> fixes the FLINT spkg to also install the QS program included in it.]\n-\n-Keywords: spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS\n+### flintqs-20070817.p7 (Jeroen Demeyer, 25 May 2012)\n+* Trac #12855: Only call log() on float or double types.  This works\n+  around a problem with Solaris' libc where log() in C++ is overloaded\n+  for float, double and long double but not integer types.\n+* Use `patch` for patching, use standard template for spkg-install.\n+* Don't retry the build upon failure on x86_64, which seems pointless\n+  after #11351.\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-05-28T17:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160901",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,12 +24,15 @@
 
 Now FLINTQS happens to call `log()` with an `unsigned long` (without a cast) in one place, and with the overloaded functions present as well, the call gets ambiguous.  The obvious, trivial fix is to just cast the argument to a `double`, such that `double log(double)` gets called (as before).
 
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flintqs-20070817.p7.spkg)
 
-
-
-There's a lot wrong with the FLINTQS spkg, as I noted a couple of times before, but I won't address other issues *here*.  [The most important fact being that *a newer version* of Bill Hart's quadratic sieve is included in FLINT since a long time, but the FLINT spkg simply doesn't install it.  So the FLINTQS spkg is obsolete in whole, but we can't remove it until *someone*<sup>TM</sup> fixes the FLINT spkg to also install the QS program included in it.]
-
-Keywords: spkg GCC 4.7.0 C++ g++ log() math.h overloaded SunOS
+### flintqs-20070817.p7 (Jeroen Demeyer, 25 May 2012)
+* Trac #12855: Only call log() on float or double types.  This works
+  around a problem with Solaris' libc where log() in C++ is overloaded
+  for float, double and long double but not integer types.
+* Use `patch` for patching, use standard template for spkg-install.
+* Don't retry the build upon failure on x86_64, which seems pointless
+  after #11351.
 
 Comment: 1
 
``````




---

archive/issue_comments_160902.json:
```json
{
    "body": "Attachment [flintqs-20070817.p7.diff](tarball://root/attachments/some-uuid/ticket12855/flintqs-20070817.p7.diff) by @jdemeyer created at 2012-05-28 17:11:00\n\nDiff for the flintqs spkg. For reference / review only.",
    "created_at": "2012-05-28T17:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160902",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [flintqs-20070817.p7.diff](tarball://root/attachments/some-uuid/ticket12855/flintqs-20070817.p7.diff) by @jdemeyer created at 2012-05-28 17:11:00

Diff for the flintqs spkg. For reference / review only.



---

archive/issue_comments_160903.json:
```json
{
    "body": "<a id='comment:3'></a>New spkg builds fine on Skynet `mark` with gcc-4.7.0, needs review.",
    "created_at": "2012-05-28T17:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160903",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>New spkg builds fine on Skynet `mark` with gcc-4.7.0, needs review.



---

archive/issue_events_035019.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-29T00:42:14Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "milestone": "sage-5.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12855#event-35019"
}
```



---

archive/issue_comments_160904.json:
```json
{
    "body": "<a id='comment:5'></a>Just for reference, #9544 has a very small FreeBSD-only patch which perhaps could be integrated into this.  Or is this almost ready for positive review and we should base on that?\n\n```\n#ifdef __FreeBSD__ \n#include <stdint.h> \n#endif \n```",
    "created_at": "2012-06-20T19:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160904",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>Just for reference, #9544 has a very small FreeBSD-only patch which perhaps could be integrated into this.  Or is this almost ready for positive review and we should base on that?

```
#ifdef __FreeBSD__ 
#include <stdint.h> 
#endif 
```



---

archive/issue_events_035020.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-21T10:27:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "milestone": "sage-5.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12855#event-35020"
}
```



---

archive/issue_events_035021.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-21T10:27:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12855#event-35021"
}
```



---

archive/issue_comments_160905.json:
```json
{
    "body": "<a id='comment:7'></a>See also #11792?",
    "created_at": "2012-06-21T13:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160905",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>See also #11792?



---

archive/issue_comments_160906.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 kcrisman]:\n> See also #11792?\n\n\nI'm aware of that ticket, but I don't know enough about flint/flintqs to do something about that.",
    "created_at": "2012-06-21T13:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160906",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:7 kcrisman]:
> See also #11792?


I'm aware of that ticket, but I don't know enough about flint/flintqs to do something about that.



---

archive/issue_comments_160907.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-06-21T20:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160907",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_160908.json:
```json
{
    "body": "<a id='comment:9'></a>The diff looks good as far as it goes, and #9544 (based on this) installs fine and passes relevant tests on OS X 10.6.  \n\nI can't test whether this actually works on Solaris or know whether these fixes are right, have to take your word for it. The Mac fix isn't mentioned on this ticket, either, and I can't check if it's necessary or actually fixes anything.\n\nFinally, is `flintqs-gcc-4.3-fix.patch` still in use?    It apparently was *not* actually applied before?  At least that's what the diff seems to indicate.  That patch was added over 4 years ago, and I'm not even sure whether we allow people to build with gcc-4.3...  In fact, \n\n```\n$ hg log -p spkg-install | less \n```\nindicates that maybe the patch was *never* applied.  ???  Or maybe the fix was simply applied in source (against regulations)?\n\nAnyway, what do you think about that patch?  Obviously it still applies, and maybe doesn't cause any trouble.\n\n---\n\nFor positive review, should someone else try it on Solaris?  Also we would need just informational update on the Mac and extra patch as mentioned above.",
    "created_at": "2012-06-21T20:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160908",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>The diff looks good as far as it goes, and #9544 (based on this) installs fine and passes relevant tests on OS X 10.6.  

I can't test whether this actually works on Solaris or know whether these fixes are right, have to take your word for it. The Mac fix isn't mentioned on this ticket, either, and I can't check if it's necessary or actually fixes anything.

Finally, is `flintqs-gcc-4.3-fix.patch` still in use?    It apparently was *not* actually applied before?  At least that's what the diff seems to indicate.  That patch was added over 4 years ago, and I'm not even sure whether we allow people to build with gcc-4.3...  In fact, 

```
$ hg log -p spkg-install | less 
```
indicates that maybe the patch was *never* applied.  ???  Or maybe the fix was simply applied in source (against regulations)?

Anyway, what do you think about that patch?  Obviously it still applies, and maybe doesn't cause any trouble.

---

For positive review, should someone else try it on Solaris?  Also we would need just informational update on the Mac and extra patch as mentioned above.



---

archive/issue_comments_160909.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 kcrisman]:\n> The Mac fix isn't mentioned on this ticket, either, and I can't check if it's necessary or actually fixes anything.\n\nYou mean `lanczos.h.patch`?  That existed before, so it's not subject to review for this ticket.\n\n> Finally, is `flintqs-gcc-4.3-fix.patch` still in use? Or maybe the fix was simply applied in source (against regulations)?\n\nThat was indeed the case, you can compare the `src/` directories of the old and new spkg if you want.  So that patch itself isn't subject to review.",
    "created_at": "2012-06-22T09:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160909",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Replying to [comment:9 kcrisman]:
> The Mac fix isn't mentioned on this ticket, either, and I can't check if it's necessary or actually fixes anything.

You mean `lanczos.h.patch`?  That existed before, so it's not subject to review for this ticket.

> Finally, is `flintqs-gcc-4.3-fix.patch` still in use? Or maybe the fix was simply applied in source (against regulations)?

That was indeed the case, you can compare the `src/` directories of the old and new spkg if you want.  So that patch itself isn't subject to review.



---

archive/issue_comments_160910.json:
```json
{
    "body": "<a id='comment:11'></a>> > The Mac fix isn't mentioned on this ticket, either, and I can't check if it's necessary or actually fixes anything.\n\n> You mean `lanczos.h.patch`?  That existed before, so it's not subject to review for this ticket.\nOk, that makes sense, and I should have figured that out.\n\n> > Finally, is `flintqs-gcc-4.3-fix.patch` still in use? Or maybe the fix was simply applied in source (against regulations)?\n\n> That was indeed the case, you can compare the `src/` directories of the old and new spkg if you want.  So that patch itself isn't subject to review.\nOk.\n\nSo it seems fine, except for the issue that perhaps someone other than jdemeyer should test it on Solaris with gcc-4.7?  I think that's all that's needed here.",
    "created_at": "2012-06-22T13:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160910",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>> > The Mac fix isn't mentioned on this ticket, either, and I can't check if it's necessary or actually fixes anything.

> You mean `lanczos.h.patch`?  That existed before, so it's not subject to review for this ticket.
Ok, that makes sense, and I should have figured that out.

> > Finally, is `flintqs-gcc-4.3-fix.patch` still in use? Or maybe the fix was simply applied in source (against regulations)?

> That was indeed the case, you can compare the `src/` directories of the old and new spkg if you want.  So that patch itself isn't subject to review.
Ok.

So it seems fine, except for the issue that perhaps someone other than jdemeyer should test it on Solaris with gcc-4.7?  I think that's all that's needed here.



---

archive/issue_comments_160911.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-06-22T13:43:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160911",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_160912.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 kcrisman]:\n> So it seems fine, except for the issue that perhaps someone other than jdemeyer should test it on Solaris with gcc-4.7?\n\n\nI just built GCC-4.7.1 (see #13150) on `mark` (Solaris SPARC) and then built this FLINTQS spkg with GCC-4.7.1 and it worked.  This was starting from sage-5.1.beta0.",
    "created_at": "2012-06-24T22:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160912",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:11 kcrisman]:
> So it seems fine, except for the issue that perhaps someone other than jdemeyer should test it on Solaris with gcc-4.7?


I just built GCC-4.7.1 (see #13150) on `mark` (Solaris SPARC) and then built this FLINTQS spkg with GCC-4.7.1 and it worked.  This was starting from sage-5.1.beta0.



---

archive/issue_comments_160913.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-24T22:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160913",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160914.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-28T09:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12855#issuecomment-160914",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_035022.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-28T09:36:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12855",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12855#event-35022"
}
```
