# Issue 12480: NTL segfault on OS X 10.7

archive/issues_012308.json:
```json
{
    "body": "On OS X 10.7 (compiled with gcc-4.6.2, #12369):\n\n```\nThe following tests failed:\n\n        sage -t  --long -force_lib devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx # Killed/crashed\n```\n\nThis is because executing the following code (from the file `devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx`):\n\n```\nR = Zp(5,5)\nS.<x> = R[]\nf = x^5 + 75*x^3 - 15*x^2 +125*x - 5\nW.<w> = R.ext(f)\npol = ntl.ZZ_pX([5^40,5^42,3*5^41], 5^44)\nW(pol, relprec = 0)\n```\ncrashes Sage:\n\n```\nProgram received signal EXC_BAD_ACCESS, Could not access memory.\nReason: KERN_INVALID_ADDRESS at address: 0x0000000300000002\n0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157\n157           if (src->ref_count == NTL_MAX_LONG)\nCurrent language:  auto; currently c++\n(gdb) bt\n#0  0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157\n#1  0x0000000101791d46 in NTL::ZZ_pContext::restore (this=0x100191148) at ZZ_p.c:205\n#2  0x000000010164e1aa in ZZ_pX_conv_modulus ()\n#3  0x00000001063a1ff7 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_ZZ_pX_eis_shift_p (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:6173\n#4  0x0000000106392871 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_27PowComputer_ZZ_pX_small_Eis_eis_shift (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:12917\n#5  0x000000010638aced in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_17PowComputer_ZZ_pX_eis_shift_capdiv (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:9448\n#6  0x00000001064e0aba in __pyx_f_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement__internal_lshift (__pyx_v_self=0x10e057ef0, __pyx_v_shift=-200) at padic_ZZ_pX_CR_element.cpp:9197\n#7  0x00000001064dfd8b in __pyx_f_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement__set_from_ZZ_pX_part2 (__pyx_v_self=0x10e057ef0, __pyx_v_poly=0x10e075f98) at padic_ZZ_pX_CR_element.cpp:8445\n#8  0x00000001064de4c7 in __pyx_f_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement__set_from_ZZ_pX_rel (__pyx_v_self=0x10e057ef0, __pyx_v_poly=0x10e075f98, __pyx_v_ctx=0x10e078730, __pyx_v_relprec=0) at padic_ZZ_pX_CR_element.cpp:8146\n#9  0x00000001064fe4ee in __pyx_pf_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement___init__ (__pyx_v_self=0x10e057ef0, __pyx_args=0x10db23d40, __pyx_kwds=0x10da8f290) at padic_ZZ_pX_CR_element.cpp:5163\n#10 0x000000010007a1a7 in type_call ()\nPrevious frame inner to this frame (gdb could not unwind past this frame)\n```\n\nThis is a huge can of worms.  The relevant code is in `sage/rings/padics/pow_computer_ext.pyx`:\n\n```\n    cdef ntl_ZZ_pContext_class get_context(self, long n):\n        \"\"\"\n        Returns the context for p^n.\n\n        Note that this function will raise an Index error if n > self.cache_limit.\n        Also, it will return None on input 0\n        [...]\n        \"\"\"\n        if n < 0:\n            n = -n\n        try:\n            return self.c[n]\n        except IndexError:\n            return PowComputer_ZZ_pX.get_context(self, n)\n\n```\n**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`** and we pretend like that's okay.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.\n\nThe `None` in the `self.c[]` array comes from line 1671 in `pow_computer_ext.pyx`:\n\n```\n            self.c.append(None)\n            for i from 1 <= i <= cache_limit:\n                self.c.append(PowComputer_ZZ_pX.get_context(self,i))\n```\n\n**Assignee:** @williamstein\n\n**Reviewer:** William Stein, Jeroen Demeyer\n\n**Author:** David Roe\n\n**Merged:** sage-5.0.beta8\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12480\n\n",
    "closed_at": "2012-03-13T08:24:05Z",
    "created_at": "2012-02-09T10:28:49Z",
    "labels": [
        "component: interfaces",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "NTL segfault on OS X 10.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12480",
    "user": "https://github.com/jdemeyer"
}
```
On OS X 10.7 (compiled with gcc-4.6.2, #12369):

```
The following tests failed:

        sage -t  --long -force_lib devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx # Killed/crashed
```

This is because executing the following code (from the file `devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx`):

```
R = Zp(5,5)
S.<x> = R[]
f = x^5 + 75*x^3 - 15*x^2 +125*x - 5
W.<w> = R.ext(f)
pol = ntl.ZZ_pX([5^40,5^42,3*5^41], 5^44)
W(pol, relprec = 0)
```
crashes Sage:

```
Program received signal EXC_BAD_ACCESS, Could not access memory.
Reason: KERN_INVALID_ADDRESS at address: 0x0000000300000002
0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157
157           if (src->ref_count == NTL_MAX_LONG)
Current language:  auto; currently c++
(gdb) bt
#0  0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157
#1  0x0000000101791d46 in NTL::ZZ_pContext::restore (this=0x100191148) at ZZ_p.c:205
#2  0x000000010164e1aa in ZZ_pX_conv_modulus ()
#3  0x00000001063a1ff7 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_ZZ_pX_eis_shift_p (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:6173
#4  0x0000000106392871 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_27PowComputer_ZZ_pX_small_Eis_eis_shift (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:12917
#5  0x000000010638aced in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_17PowComputer_ZZ_pX_eis_shift_capdiv (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:9448
#6  0x00000001064e0aba in __pyx_f_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement__internal_lshift (__pyx_v_self=0x10e057ef0, __pyx_v_shift=-200) at padic_ZZ_pX_CR_element.cpp:9197
#7  0x00000001064dfd8b in __pyx_f_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement__set_from_ZZ_pX_part2 (__pyx_v_self=0x10e057ef0, __pyx_v_poly=0x10e075f98) at padic_ZZ_pX_CR_element.cpp:8445
#8  0x00000001064de4c7 in __pyx_f_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement__set_from_ZZ_pX_rel (__pyx_v_self=0x10e057ef0, __pyx_v_poly=0x10e075f98, __pyx_v_ctx=0x10e078730, __pyx_v_relprec=0) at padic_ZZ_pX_CR_element.cpp:8146
#9  0x00000001064fe4ee in __pyx_pf_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement___init__ (__pyx_v_self=0x10e057ef0, __pyx_args=0x10db23d40, __pyx_kwds=0x10da8f290) at padic_ZZ_pX_CR_element.cpp:5163
#10 0x000000010007a1a7 in type_call ()
Previous frame inner to this frame (gdb could not unwind past this frame)
```

This is a huge can of worms.  The relevant code is in `sage/rings/padics/pow_computer_ext.pyx`:

```
    cdef ntl_ZZ_pContext_class get_context(self, long n):
        """
        Returns the context for p^n.

        Note that this function will raise an Index error if n > self.cache_limit.
        Also, it will return None on input 0
        [...]
        """
        if n < 0:
            n = -n
        try:
            return self.c[n]
        except IndexError:
            return PowComputer_ZZ_pX.get_context(self, n)

```
**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`** and we pretend like that's okay.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.

The `None` in the `self.c[]` array comes from line 1671 in `pow_computer_ext.pyx`:

```
            self.c.append(None)
            for i from 1 <= i <= cache_limit:
                self.c.append(PowComputer_ZZ_pX.get_context(self,i))
```

**Assignee:** @williamstein

**Reviewer:** William Stein, Jeroen Demeyer

**Author:** David Roe

**Merged:** sage-5.0.beta8

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/12480





---

archive/issue_comments_184079.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,10 +13,12 @@\n ```\n Program received signal EXC_BAD_ACCESS, Could not access memory.\n Reason: KERN_INVALID_ADDRESS at address: 0x0000000300000002\n-0x0000000101791ae1 in NTL::CopyPointer ()\n+0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157\n+157           if (src->ref_count == NTL_MAX_LONG)\n+Current language:  auto; currently c++\n (gdb) bt\n-#0  0x0000000101791ae1 in NTL::CopyPointer ()\n-#1  0x0000000101791d46 in NTL::ZZ_pContext::restore ()\n+#0  0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157\n+#1  0x0000000101791d46 in NTL::ZZ_pContext::restore (this=0x100191148) at ZZ_p.c:205\n #2  0x000000010164e1aa in ZZ_pX_conv_modulus ()\n #3  0x00000001063a1ff7 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_ZZ_pX_eis_shift_p (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:6173\n #4  0x0000000106392871 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_27PowComputer_ZZ_pX_small_Eis_eis_shift (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:12917\n@@ -27,5 +29,4 @@\n #9  0x00000001064fe4ee in __pyx_pf_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement___init__ (__pyx_v_self=0x10e057ef0, __pyx_args=0x10db23d40, __pyx_kwds=0x10da8f290) at padic_ZZ_pX_CR_element.cpp:5163\n #10 0x000000010007a1a7 in type_call ()\n Previous frame inner to this frame (gdb could not unwind past this frame)\n-(gdb)\n ```\n``````\n",
    "created_at": "2012-02-09T10:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184079",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,10 +13,12 @@
 ```
 Program received signal EXC_BAD_ACCESS, Could not access memory.
 Reason: KERN_INVALID_ADDRESS at address: 0x0000000300000002
-0x0000000101791ae1 in NTL::CopyPointer ()
+0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157
+157           if (src->ref_count == NTL_MAX_LONG)
+Current language:  auto; currently c++
 (gdb) bt
-#0  0x0000000101791ae1 in NTL::CopyPointer ()
-#1  0x0000000101791d46 in NTL::ZZ_pContext::restore ()
+#0  0x0000000101791ae1 in CopyPointer (dst=@0x10190b700, src=0x300000002) at ZZ_p.c:157
+#1  0x0000000101791d46 in NTL::ZZ_pContext::restore (this=0x100191148) at ZZ_p.c:205
 #2  0x000000010164e1aa in ZZ_pX_conv_modulus ()
 #3  0x00000001063a1ff7 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_ZZ_pX_eis_shift_p (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:6173
 #4  0x0000000106392871 in __pyx_f_4sage_5rings_6padics_16pow_computer_ext_27PowComputer_ZZ_pX_small_Eis_eis_shift (__pyx_v_self=0x10db203f0, __pyx_v_x=0x10e057f18, __pyx_v_a=0x10e057f18, __pyx_v_n=200, __pyx_v_finalprec=0) at pow_computer_ext.cpp:12917
@@ -27,5 +29,4 @@
 #9  0x00000001064fe4ee in __pyx_pf_4sage_5rings_6padics_22padic_ZZ_pX_CR_element_18pAdicZZpXCRElement___init__ (__pyx_v_self=0x10e057ef0, __pyx_args=0x10db23d40, __pyx_kwds=0x10da8f290) at padic_ZZ_pX_CR_element.cpp:5163
 #10 0x000000010007a1a7 in type_call ()
 Previous frame inner to this frame (gdb could not unwind past this frame)
-(gdb)
 ```
``````




---

archive/issue_comments_184080.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -30,3 +30,15 @@\n #10 0x000000010007a1a7 in type_call ()\n Previous frame inner to this frame (gdb could not unwind past this frame)\n ```\n+\n+This is a huge can of worms. In `sage/rings/padics/pow_computer_ext.pyx`:\n+\n+```\n+    cdef ntl_ZZ_pContext_class get_context(self, long n):\n+        \"\"\"\n+        Returns the context for p^n.\n+\n+        Note that this function will raise an Index error if n > self.cache_limit.\n+        Also, it will return None on input 0\n+```\n+**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`**.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.\n``````\n",
    "created_at": "2012-02-09T15:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184080",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -30,3 +30,15 @@
 #10 0x000000010007a1a7 in type_call ()
 Previous frame inner to this frame (gdb could not unwind past this frame)
 ```
+
+This is a huge can of worms. In `sage/rings/padics/pow_computer_ext.pyx`:
+
+```
+    cdef ntl_ZZ_pContext_class get_context(self, long n):
+        """
+        Returns the context for p^n.
+
+        Note that this function will raise an Index error if n > self.cache_limit.
+        Also, it will return None on input 0
+```
+**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`**.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.
``````




---

archive/issue_comments_184081.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -40,5 +40,22 @@\n \n         Note that this function will raise an Index error if n > self.cache_limit.\n         Also, it will return None on input 0\n+        [...]\n+        \"\"\"\n+        if n < 0:\n+            n = -n\n+        try:\n+            return self.c[n]\n+        except IndexError:\n+            return PowComputer_ZZ_pX.get_context(self, n)\n+\n ```\n-**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`**.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.\n+**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`** and we pretend like that's okay.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.\n+\n+The `None` in the `self.c[]` array comes from line 1671:\n+\n+```\n+            self.c.append(None)\n+            for i from 1 <= i <= cache_limit:\n+                self.c.append(PowComputer_ZZ_pX.get_context(self,i))\n+```\n``````\n",
    "created_at": "2012-02-09T16:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184081",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -40,5 +40,22 @@
 
         Note that this function will raise an Index error if n > self.cache_limit.
         Also, it will return None on input 0
+        [...]
+        """
+        if n < 0:
+            n = -n
+        try:
+            return self.c[n]
+        except IndexError:
+            return PowComputer_ZZ_pX.get_context(self, n)
+
 ```
-**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`**.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.
+**On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`** and we pretend like that's okay.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.
+
+The `None` in the `self.c[]` array comes from line 1671:
+
+```
+            self.c.append(None)
+            for i from 1 <= i <= cache_limit:
+                self.c.append(PowComputer_ZZ_pX.get_context(self,i))
+```
``````




---

archive/issue_comments_184082.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n-On OS X 10.7 (compiled with gcc-4.6.2, #12369), executing the following code:\n+On OS X 10.7 (compiled with gcc-4.6.2, #12369):\n+\n+```\n+The following tests failed:\n+\n+        sage -t  --long -force_lib devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx # Killed/crashed\n+```\n+\n+This is because executing the following code (from the file `devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx`):\n \n ```\n R = Zp(5,5)\n@@ -31,7 +39,7 @@\n Previous frame inner to this frame (gdb could not unwind past this frame)\n ```\n \n-This is a huge can of worms. In `sage/rings/padics/pow_computer_ext.pyx`:\n+This is a huge can of worms.  The relevant code is in `sage/rings/padics/pow_computer_ext.pyx`:\n \n ```\n     cdef ntl_ZZ_pContext_class get_context(self, long n):\n@@ -52,7 +60,7 @@\n ```\n **On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`** and we pretend like that's okay.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.\n \n-The `None` in the `self.c[]` array comes from line 1671:\n+The `None` in the `self.c[]` array comes from line 1671 in `pow_computer_ext.pyx`:\n \n ```\n             self.c.append(None)\n``````\n",
    "created_at": "2012-02-09T20:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184082",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
-On OS X 10.7 (compiled with gcc-4.6.2, #12369), executing the following code:
+On OS X 10.7 (compiled with gcc-4.6.2, #12369):
+
+```
+The following tests failed:
+
+        sage -t  --long -force_lib devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx # Killed/crashed
+```
+
+This is because executing the following code (from the file `devel/sage/sage/rings/padics/padic_ZZ_pX_CR_element.pyx`):
 
 ```
 R = Zp(5,5)
@@ -31,7 +39,7 @@
 Previous frame inner to this frame (gdb could not unwind past this frame)
 ```
 
-This is a huge can of worms. In `sage/rings/padics/pow_computer_ext.pyx`:
+This is a huge can of worms.  The relevant code is in `sage/rings/padics/pow_computer_ext.pyx`:
 
 ```
     cdef ntl_ZZ_pContext_class get_context(self, long n):
@@ -52,7 +60,7 @@
 ```
 **On input 0, we have a `Py_None` typecast to a `ntl_ZZ_pContext_class`** and we pretend like that's okay.  How does this make sense?  The fact that it crashes on OS X 10.7 is expected, the surprising thing is that this doesn't crash on other systems.
 
-The `None` in the `self.c[]` array comes from line 1671:
+The `None` in the `self.c[]` array comes from line 1671 in `pow_computer_ext.pyx`:
 
 ```
             self.c.append(None)
``````




---

archive/issue_comments_184083.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [12480.patch](tarball://root/attachments/some-uuid/ticket12480/12480.patch) by @williamstein created at 2012-02-09 23:40:04\n\nPositive review to the patch posted right when I write this.",
    "created_at": "2012-02-09T23:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184083",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
Attachment [12480.patch](tarball://root/attachments/some-uuid/ticket12480/12480.patch) by @williamstein created at 2012-02-09 23:40:04

Positive review to the patch posted right when I write this.



---

archive/issue_comments_184084.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-02-09T23:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184084",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_184085.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-02-09T23:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184085",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_184086.json:
```json
{
    "body": "**Reviewer:** William Stein, Jeroen Demeyer",
    "created_at": "2012-02-10T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184086",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** William Stein, Jeroen Demeyer



---

archive/issue_comments_184087.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2012-02-10T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184087",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_184088.json:
```json
{
    "body": "**Author:** David Roe",
    "created_at": "2012-02-10T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184088",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** David Roe



---

archive/issue_comments_184089.json:
```json
{
    "body": "<a id='comment:7'></a>\nReviewer patch fixes some documentation strings and also removes exceptions which will be ignored anyway (a cdef function can only raise exceptions if it is declared with an \"except\" value or if it returns a Python object).",
    "created_at": "2012-02-10T09:30:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184089",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Reviewer patch fixes some documentation strings and also removes exceptions which will be ignored anyway (a cdef function can only raise exceptions if it is declared with an "except" value or if it returns a Python object).



---

archive/issue_comments_184090.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-02-10T09:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184090",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_184091.json:
```json
{
    "body": "<a id='comment:9'></a>\nWilliam or David, could any of you please review my reviewer patch?",
    "created_at": "2012-02-11T21:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184091",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
William or David, could any of you please review my reviewer patch?



---

archive/issue_comments_184092.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-02-11T22:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184092",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_184093.json:
```json
{
    "body": "<a id='comment:10'></a>\nDavid and I discussed ValueError versus RuntimeError when he wrote this.  I initially suggested ValueError (as you changed it to), but he argued that this error should *never* occur, ever -- there should be no way to call this code from Python to produce this error.   I'm convinced by David.",
    "created_at": "2012-02-11T22:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184093",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>
David and I discussed ValueError versus RuntimeError when he wrote this.  I initially suggested ValueError (as you changed it to), but he argued that this error should *never* occur, ever -- there should be no way to call this code from Python to produce this error.   I'm convinced by David.



---

archive/issue_comments_184094.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [was](#comment%3A10):\n> he argued that this error should *never* occur, ever\n\nI don't see why this is an argument for `RuntimeError` instead of `ValueError`.\n\nHow would you like `SystemError` instead?  Of all standard Python exceptions, it seems to be the closest equivalent to what you want: [http://docs.python.org/library/exceptions.html#exceptions.SystemError](http://docs.python.org/library/exceptions.html#exceptions.SystemError)",
    "created_at": "2012-02-11T23:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184094",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [was](#comment%3A10):
> he argued that this error should *never* occur, ever

I don't see why this is an argument for `RuntimeError` instead of `ValueError`.

How would you like `SystemError` instead?  Of all standard Python exceptions, it seems to be the closest equivalent to what you want: [http://docs.python.org/library/exceptions.html#exceptions.SystemError](http://docs.python.org/library/exceptions.html#exceptions.SystemError)



---

archive/issue_comments_184095.json:
```json
{
    "body": "<a id='comment:12'></a>\n*** ping ***",
    "created_at": "2012-02-15T16:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184095",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
*** ping ***



---

archive/issue_comments_184096.json:
```json
{
    "body": "<a id='comment:13'></a>\n*** ahem ***",
    "created_at": "2012-03-01T17:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184096",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
*** ahem ***



---

archive/issue_comments_184097.json:
```json
{
    "body": "<a id='comment:14'></a>\nSorry: I wasn't getting trac notifications on this ticket for some reason.\n\nThe changes look good, except the removal of the three checks for n < 0 in `pow_mpz_t_tmp` and `pow_ZZ_tmp` where a ValueError is raised.  While I understand that Cython will ignore those errors, I think the right option is to open another ticket and modify what is done, rather than just removing the checks.  With these changes it's easier for these functions to segfault on incorrect input.",
    "created_at": "2012-03-03T00:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184097",
    "user": "https://github.com/roed314"
}
```

<a id='comment:14'></a>
Sorry: I wasn't getting trac notifications on this ticket for some reason.

The changes look good, except the removal of the three checks for n < 0 in `pow_mpz_t_tmp` and `pow_ZZ_tmp` where a ValueError is raised.  While I understand that Cython will ignore those errors, I think the right option is to open another ticket and modify what is done, rather than just removing the checks.  With these changes it's easier for these functions to segfault on incorrect input.



---

archive/issue_comments_184098.json:
```json
{
    "body": "Reviewer patch, apply on top of previous",
    "created_at": "2012-03-05T08:41:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184098",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer patch, apply on top of previous



---

archive/issue_comments_184099.json:
```json
{
    "body": "<a id='comment:15'></a>\nAttachment [12480_review.patch](tarball://root/attachments/some-uuid/ticket12480/12480_review.patch) by @jdemeyer created at 2012-03-05 08:43:32\n\nI kept all `raise` statements but annotated them by\n\n```\n# Exception will be ignored by Cython\n```",
    "created_at": "2012-03-05T08:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184099",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Attachment [12480_review.patch](tarball://root/attachments/some-uuid/ticket12480/12480_review.patch) by @jdemeyer created at 2012-03-05 08:43:32

I kept all `raise` statements but annotated them by

```
# Exception will be ignored by Cython
```



---

archive/issue_comments_184100.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-03-05T08:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184100",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_184101.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-03-05T18:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184101",
    "user": "https://github.com/roed314"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_184102.json:
```json
{
    "body": "<a id='comment:16'></a>\nLooks good.  Have you created a ticket to fix these ignored exceptions, or shall I?",
    "created_at": "2012-03-05T18:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184102",
    "user": "https://github.com/roed314"
}
```

<a id='comment:16'></a>
Looks good.  Have you created a ticket to fix these ignored exceptions, or shall I?



---

archive/issue_comments_184103.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [roed](#comment%3A16):\n> Looks good.  Have you created a ticket to fix these ignored exceptions, or shall I?\n\nI don't plan to deal with this code, so go ahead.",
    "created_at": "2012-03-05T20:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184103",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [roed](#comment%3A16):
> Looks good.  Have you created a ticket to fix these ignored exceptions, or shall I?

I don't plan to deal with this code, so go ahead.



---

archive/issue_events_039451.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-13T08:24:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12480#event-39451"
}
```



---

archive/issue_comments_184104.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-03-13T08:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184104",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_comments_184105.json:
```json
{
    "body": "**Merged:** sage-5.0.beta8",
    "created_at": "2012-03-13T08:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184105",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta8



---

archive/issue_comments_184106.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [roed](#comment%3A14):\n> The changes look good, except the removal of the three checks for n < 0 in `pow_mpz_t_tmp` and `pow_ZZ_tmp` where a ValueError is raised.  While I understand that Cython will ignore those errors, I think the right option is to open another ticket and modify what is done, rather than just removing the checks.  With these changes it's easier for these functions to segfault on incorrect input.\n\nDoes this refer to how Cython used to work? Does it make sense to add an `except NULL` to the function definition now? I stumbled upon this while working on #13591.",
    "created_at": "2014-07-09T18:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12480",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12480#issuecomment-184106",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:19'></a>
Replying to [roed](#comment%3A14):
> The changes look good, except the removal of the three checks for n < 0 in `pow_mpz_t_tmp` and `pow_ZZ_tmp` where a ValueError is raised.  While I understand that Cython will ignore those errors, I think the right option is to open another ticket and modify what is done, rather than just removing the checks.  With these changes it's easier for these functions to segfault on incorrect input.

Does this refer to how Cython used to work? Does it make sense to add an `except NULL` to the function definition now? I stumbled upon this while working on #13591.
