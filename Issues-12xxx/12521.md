# Issue 12521: evaluate log gamma for complex input

archive/issues_012349.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "Currently, we use MPFR or Ginac to evaluate `log_gamma`, but this returns `NaN` for negative input with even ceiling.\n\n```\nsage: log_gamma(-2.1)\nNaN\nsage: log_gamma(-3.1)\n0.400311696703985\nsage: log_gamma(-4.1)\nNaN\nsage: log_gamma(-5.1)\n-2.63991581673655\nsage: log_gamma(-21/10).n()\nNaN\nsage: get_systems('log_gamma(-21/10).n()')\n['ginac']\nsage: log_gamma(CC(-2.1))\n1.53171380819509 + 3.14159265358979*I\n```\nWe can use mpmath or something other trick to get this to work, now that #10075 has a  nice symbolic function available.  See #10072 for where we originally got better numerical evaluation.\n\n```\nsage: mpmath.loggamma(-2.1)\nmpc(real='1.5317138081950856', imag='-9.4247779607693793')\n```\nPutting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n\nApply: [attachment: trac_12521_3.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)\n\nThere is now also the arb option:\n\n```\nsage: x=ComplexBallField(53)(-2.1)\nsage: %timeit _ = x.log_gamma()\nThe slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 8.15 \u00b5s per loop\nsage: x.log_gamma()\n[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I\n```\n\n\nCC:  @burcin @sagetrac-ktkohl @sagetrac-fstan @zimmermann6 @benjaminfjones @eviatarbach @paulmasson\n\nComponent: **basic arithmetic**\n\nKeywords: **lgamma log_gamma**\n\nAuthor: **Eviatar Bach, Ralf Stephan**\n\nBranch/Commit: **[`c11c3ef`](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**\n\nReviewer: **Burcin Erocal, Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12521_\n\n",
    "closed_at": "2016-06-24T07:26:13Z",
    "created_at": "2012-02-16T17:02:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "evaluate log gamma for complex input",
    "type": "issue",
    "updated_at": "2016-06-24T07:26:13Z",
    "url": "https://github.com/sagemath/sage/issues/12521",
    "user": "https://github.com/kcrisman"
}
```
Currently, we use MPFR or Ginac to evaluate `log_gamma`, but this returns `NaN` for negative input with even ceiling.

```
sage: log_gamma(-2.1)
NaN
sage: log_gamma(-3.1)
0.400311696703985
sage: log_gamma(-4.1)
NaN
sage: log_gamma(-5.1)
-2.63991581673655
sage: log_gamma(-21/10).n()
NaN
sage: get_systems('log_gamma(-21/10).n()')
['ginac']
sage: log_gamma(CC(-2.1))
1.53171380819509 + 3.14159265358979*I
```
We can use mpmath or something other trick to get this to work, now that #10075 has a  nice symbolic function available.  See #10072 for where we originally got better numerical evaluation.

```
sage: mpmath.loggamma(-2.1)
mpc(real='1.5317138081950856', imag='-9.4247779607693793')
```
Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...

Apply: [attachment: trac_12521_3.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)

There is now also the arb option:

```
sage: x=ComplexBallField(53)(-2.1)
sage: %timeit _ = x.log_gamma()
The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 8.15 µs per loop
sage: x.log_gamma()
[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I
```


CC:  @burcin @sagetrac-ktkohl @sagetrac-fstan @zimmermann6 @benjaminfjones @eviatarbach @paulmasson

Component: **basic arithmetic**

Keywords: **lgamma log_gamma**

Author: **Eviatar Bach, Ralf Stephan**

Branch/Commit: **[`c11c3ef`](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**

Reviewer: **Burcin Erocal, Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/12521_





---

archive/issue_events_169782.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169782"
}
```



---

archive/issue_events_169783.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169783"
}
```



---

archive/issue_events_169784.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169784"
}
```



---

archive/issue_events_169785.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169785"
}
```



---

archive/issue_events_169786.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "subject": "https://github.com/kcrisman",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169786"
}
```



---

archive/issue_comments_138509.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI cannot reproduce some examples from the description with Sage 4.8:\n\n```\nsage: from sage.misc.citation import get_systems\nsage: get_systems('log_gamma(-21/10).n()')      \n['MPFR']\nsage: log_gamma(CC(-2.1))\nNaN\n```\nDo you use a different version? Did you apply some patches?\n\nPaul",
    "created_at": "2012-02-17T09:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138509",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:1" align="right">comment:1</div>

I cannot reproduce some examples from the description with Sage 4.8:

```
sage: from sage.misc.citation import get_systems
sage: get_systems('log_gamma(-21/10).n()')      
['MPFR']
sage: log_gamma(CC(-2.1))
NaN
```
Do you use a different version? Did you apply some patches?

Paul



---

archive/issue_comments_138510.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n> Do you use a different version? Did you apply some patches?\n\nYes, I guess this is after #10075.  There is the same problem before that patch, but the systems and outputs will be different.   In particular, inheriting from the parent of the input (which most generic `Function` classes do) if it has a method of the same name (which `CC` does) makes this change.\n\nThere is no patch, so this doesn't depend on #10075 in that sense, but I will put it anyway so that it's clear.  Thanks!",
    "created_at": "2012-02-17T13:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138510",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

> Do you use a different version? Did you apply some patches?

Yes, I guess this is after #10075.  There is the same problem before that patch, but the systems and outputs will be different.   In particular, inheriting from the parent of the input (which most generic `Function` classes do) if it has a method of the same name (which `CC` does) makes this change.

There is no patch, so this doesn't depend on #10075 in that sense, but I will put it anyway so that it's clear.  Thanks!



---

archive/issue_comments_138511.json:
```json
{
    "body": "Dependencies: **#10075**",
    "created_at": "2012-02-17T13:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138511",
    "user": "https://github.com/kcrisman"
}
```

Dependencies: **#10075**



---

archive/issue_comments_138512.json:
```json
{
    "body": "Changed dependencies from **#10075** to none",
    "created_at": "2012-07-07T02:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138512",
    "user": "https://github.com/kcrisman"
}
```

Changed dependencies from **#10075** to none



---

archive/issue_comments_138513.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nRemoving dependency so as not to confuse anyone, now that that is in a long-since released version of Sage.",
    "created_at": "2012-07-07T02:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138513",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">comment:3</div>

Removing dependency so as not to confuse anyone, now that that is in a long-since released version of Sage.



---

archive/issue_comments_138514.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nby the way, MPFR provides two functions: `mpfr_lngamma` indeed returns `NaN` between\n`-2k-1` and `-2k` for `k` a non-negative integer.\n\nHowever there is another function `mpfr_lgamma` which returns `log(abs(gamma(x)))`,\nand separately the sign of `gamma(x)`. It suffices to add `pi*I` when the sign is\nnegative.\n\nThis would solve the problem at least for real input.\n\nPaul",
    "created_at": "2012-07-09T13:05:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138514",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:4" align="right">comment:4</div>

by the way, MPFR provides two functions: `mpfr_lngamma` indeed returns `NaN` between
`-2k-1` and `-2k` for `k` a non-negative integer.

However there is another function `mpfr_lgamma` which returns `log(abs(gamma(x)))`,
and separately the sign of `gamma(x)`. It suffices to add `pi*I` when the sign is
negative.

This would solve the problem at least for real input.

Paul



---

archive/issue_comments_138515.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThere is a related issue with the beta function:\n\n```\nsage: beta(-1.3,-0.4)\nNaN\nsage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality\n-4.92909641669610\n```\n\nThis is presumably because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `gamma(-0.4)` is negative. I'm confused as to why it works fine in the GiNaC interactive shell though.",
    "created_at": "2013-01-21T01:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138515",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:6" align="right">comment:6</div>

There is a related issue with the beta function:

```
sage: beta(-1.3,-0.4)
NaN
sage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality
-4.92909641669610
```

This is presumably because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `gamma(-0.4)` is negative. I'm confused as to why it works fine in the GiNaC interactive shell though.



---

archive/issue_events_169787.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-19T17:24:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169787"
}
```



---

archive/issue_events_169788.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-19T17:24:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169788"
}
```



---

archive/issue_comments_138516.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOur current implementation is wrong. For the principal branch, `log_gamma(z)` should not be equal to `log(gamma(z))` in general. See https://cs.uwaterloo.ca/research/tr/1994/23/CS-94-23.pdf:\n\n`ln_gamma(x) = ln(gamma(x)) + 2*pi*i*ceil(x/2 - 1)`\n\nChanging to critical because the documentation claims that it's the principal branch, which is mathematically wrong.",
    "created_at": "2013-06-19T17:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138516",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:8" align="right">comment:8</div>

Our current implementation is wrong. For the principal branch, `log_gamma(z)` should not be equal to `log(gamma(z))` in general. See https://cs.uwaterloo.ca/research/tr/1994/23/CS-94-23.pdf:

`ln_gamma(x) = ln(gamma(x)) + 2*pi*i*ceil(x/2 - 1)`

Changing to critical because the documentation claims that it's the principal branch, which is mathematically wrong.



---

archive/issue_comments_138517.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?",
    "created_at": "2013-06-19T20:06:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138517",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">comment:9</div>

I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?



---

archive/issue_comments_138518.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nPaul, could you please comment on this code for `sage/rings/real_mpfr.pyx`?\n\n\n```\n    def log_gamma(self):\n        cdef RealNumber x = self._new()\n        cdef int sign\n        parent = (<RealField_class>self._parent)\n        if parent.__prec > SIG_PREC_THRESHOLD: sig_on()\n        mpfr_lgamma(x.value, &sign, self.value, parent.rnd)\n        if parent.__prec > SIG_PREC_THRESHOLD: sig_off()\n        if not mpfr_sgn(self.value) < 0:\n            return x\n        cdef RealNumber v = self._new()\n        mpfr_div_si((<RealNumber>v).value, self.value, 2, parent.rnd)\n        return parent.complex_field()(x, parent.pi() *\n                                      (2 * (v - 1).ceil() + 1))\n```\n\nThis correctly computes the principal branch. However, I'm concerned about precision; the result of `lgamma` is presumably guaranteed to be correct up to the precision of the input, but after doing some arithmetic it might not be. Is there any way to fix this?",
    "created_at": "2013-06-19T21:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138518",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:10" align="right">comment:10</div>

Paul, could you please comment on this code for `sage/rings/real_mpfr.pyx`?


```
    def log_gamma(self):
        cdef RealNumber x = self._new()
        cdef int sign
        parent = (<RealField_class>self._parent)
        if parent.__prec > SIG_PREC_THRESHOLD: sig_on()
        mpfr_lgamma(x.value, &sign, self.value, parent.rnd)
        if parent.__prec > SIG_PREC_THRESHOLD: sig_off()
        if not mpfr_sgn(self.value) < 0:
            return x
        cdef RealNumber v = self._new()
        mpfr_div_si((<RealNumber>v).value, self.value, 2, parent.rnd)
        return parent.complex_field()(x, parent.pi() *
                                      (2 * (v - 1).ceil() + 1))
```

This correctly computes the principal branch. However, I'm concerned about precision; the result of `lgamma` is presumably guaranteed to be correct up to the precision of the input, but after doing some arithmetic it might not be. Is there any way to fix this?



---

archive/issue_comments_138519.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nDear Eviatar,\n\nI see no argument to tell the precision of the output in this function, thus I guess the result should be computed to the precision of the input.\n\nThen the real part seems fine to me.\n\nFor the imaginary part, you create the variable `v` with the same precision than the input I guess.\nIn `v-1` you might have a problem if `v` is very large, then `v-1` rounded will equal `v`,\nand `(v-1).ceil()` will equal `v` too. Thus the result will be too large by `2pi`.\n\nPaul",
    "created_at": "2013-06-20T05:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138519",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:11" align="right">comment:11</div>

Dear Eviatar,

I see no argument to tell the precision of the output in this function, thus I guess the result should be computed to the precision of the input.

Then the real part seems fine to me.

For the imaginary part, you create the variable `v` with the same precision than the input I guess.
In `v-1` you might have a problem if `v` is very large, then `v-1` rounded will equal `v`,
and `(v-1).ceil()` will equal `v` too. Thus the result will be too large by `2pi`.

Paul



---

archive/issue_comments_138520.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@kcrisman](#comment%3A9):\n> I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?\n\nthere are some references on http://mathworld.wolfram.com/LogGammaFunction.html\n\nPaul",
    "created_at": "2013-06-20T08:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138520",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@kcrisman](#comment%3A9):
> I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?

there are some references on http://mathworld.wolfram.com/LogGammaFunction.html

Paul



---

archive/issue_comments_138521.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThank you. I suspected there might be a problem like this. I think maybe using MPFR for positive reals (since it's faster) and mpmath for negative reals might be best.",
    "created_at": "2013-06-20T16:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138521",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:13" align="right">comment:13</div>

Thank you. I suspected there might be a problem like this. I think maybe using MPFR for positive reals (since it's faster) and mpmath for negative reals might be best.



---

archive/issue_comments_138522.json:
```json
{
    "body": "Attachment: **[trac_12521.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.patch.gz)**",
    "created_at": "2013-06-25T09:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138522",
    "user": "https://github.com/eviatarbach"
}
```

Attachment: **[trac_12521.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.patch.gz)**



---

archive/issue_events_169789.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-25T09:38:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169789"
}
```



---

archive/issue_comments_138523.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nPatch uploaded. It uses mpmath to evaluate `log_gamma` in certain circumstances, while the MPFR implementation is left intact for positive reals. It also removes the `lgamma` and `lngamma` functions which were deprecated four years ago with #6992.\n\nPatchbot apply trac_12521.2.patch",
    "created_at": "2013-06-25T09:38:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138523",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:14" align="right">comment:14</div>

Patch uploaded. It uses mpmath to evaluate `log_gamma` in certain circumstances, while the MPFR implementation is left intact for positive reals. It also removes the `lgamma` and `lngamma` functions which were deprecated four years ago with #6992.

Patchbot apply trac_12521.2.patch



---

archive/issue_comments_138524.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,3 +23,5 @@\n mpc(real='1.5317138081950856', imag='-9.4247779607693793')\n ```\n Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n+\n+Apply: [attachment: trac_12521.2.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)\n``````\n",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138524",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,3 +23,5 @@
 mpc(real='1.5317138081950856', imag='-9.4247779607693793')
 ```
 Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...
+
+Apply: [attachment: trac_12521.2.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)
``````




---

archive/issue_comments_138525.json:
```json
{
    "body": "Reviewer: **Burcin Erocal**",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138525",
    "user": "https://github.com/burcin"
}
```

Reviewer: **Burcin Erocal**



---

archive/issue_comments_138526.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)**\n\nThe patchbot complains about old style doctest continuation.\n\nSince you need to edit the patch anyway... In the `py_lgamma` function from `pynac.pyx`, you don't need to import `call` from `mpmath` or `parent` from `sage.structure.coerce`. These are already available as `mpmath_utils.call` and `parent_c`.\n\nThanks for the patch! Great work noticing that we don't actually compute the principal branch.",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138526",
    "user": "https://github.com/burcin"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)**

The patchbot complains about old style doctest continuation.

Since you need to edit the patch anyway... In the `py_lgamma` function from `pynac.pyx`, you don't need to import `call` from `mpmath` or `parent` from `sage.structure.coerce`. These are already available as `mpmath_utils.call` and `parent_c`.

Thanks for the patch! Great work noticing that we don't actually compute the principal branch.



---

archive/issue_events_169790.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-27T16:55:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169790"
}
```



---

archive/issue_events_169791.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-27T16:55:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169791"
}
```



---

archive/issue_comments_138527.json:
```json
{
    "body": "Author: **Eviatar Bach**",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138527",
    "user": "https://github.com/burcin"
}
```

Author: **Eviatar Bach**



---

archive/issue_events_169792.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-27T20:33:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169792"
}
```



---

archive/issue_events_169793.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-27T20:33:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169793"
}
```



---

archive/issue_comments_138528.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThanks!\n\nI had already fixed the doctest continuation and overwrote the previous patch, but the patchbot didn't test it again.\n\nI fixed the import issue. I also noticed that the results for Python `float` and `complex` were inconsistent, so I fixed that and added some tests.\n\nPatchbot apply trac_12521_3.patch",
    "created_at": "2013-06-27T20:33:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138528",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:16" align="right">comment:16</div>

Thanks!

I had already fixed the doctest continuation and overwrote the previous patch, but the patchbot didn't test it again.

I fixed the import issue. I also noticed that the results for Python `float` and `complex` were inconsistent, so I fixed that and added some tests.

Patchbot apply trac_12521_3.patch



---

archive/issue_comments_138529.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,4 +24,4 @@\n ```\n Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n \n-Apply: [attachment: trac_12521.2.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)\n+Apply: [attachment: trac_12521_3.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)\n``````\n",
    "created_at": "2013-06-28T20:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138529",
    "user": "https://github.com/eviatarbach"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,4 +24,4 @@
 ```
 Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...
 
-Apply: [attachment: trac_12521.2.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)
+Apply: [attachment: trac_12521_3.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)
``````




---

archive/issue_comments_138530.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAttachment: **[trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)**\n\nWhy is the patchbot trying to apply the last two patches instead of just trac_12521_3.patch?",
    "created_at": "2013-06-28T20:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138530",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:17" align="right">comment:17</div>

Attachment: **[trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)**

Why is the patchbot trying to apply the last two patches instead of just trac_12521_3.patch?



---

archive/issue_comments_138531.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nLet's try again:\n\nPatchbot apply trac_12521_3.patch",
    "created_at": "2013-07-16T05:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138531",
    "user": "https://github.com/eviatarbach"
}
```

<div id="comment:18" align="right">comment:18</div>

Let's try again:

Patchbot apply trac_12521_3.patch



---

archive/issue_events_169794.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169794"
}
```



---

archive/issue_events_169795.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169795"
}
```



---

archive/issue_comments_138532.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI am against removing the `lngamma()` method and against the deprecation from #6992 for PARI. Inside PARI/GP, the name is `lngamma()` and that name should be available to Sage too.",
    "created_at": "2013-10-29T08:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138532",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

I am against removing the `lngamma()` method and against the deprecation from #6992 for PARI. Inside PARI/GP, the name is `lngamma()` and that name should be available to Sage too.



---

archive/issue_events_169796.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-29T08:31:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169796"
}
```



---

archive/issue_events_169797.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-29T08:31:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169797"
}
```



---

archive/issue_comments_138533.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAlso, it seems the algorithm for complex numbers is much faster than for real numbers, so we should probably use the complex algorithm for all inputs:\n\n```\nsage: a=RealField(53)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 118 \u00b5s per loop\nsage: a=ComplexField(53)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 112 \u00b5s per loop\n```\n\n```\nsage: a=RealField(10**4)(2.5); timeit('log_gamma(a)')\n5 loops, best of 3: 506 ms per loop\nsage: a=ComplexField(10**4)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 782 \u00b5s per loop\n```",
    "created_at": "2013-10-29T08:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138533",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Also, it seems the algorithm for complex numbers is much faster than for real numbers, so we should probably use the complex algorithm for all inputs:

```
sage: a=RealField(53)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 118 µs per loop
sage: a=ComplexField(53)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 112 µs per loop
```

```
sage: a=RealField(10**4)(2.5); timeit('log_gamma(a)')
5 loops, best of 3: 506 ms per loop
sage: a=ComplexField(10**4)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 782 µs per loop
```



---

archive/issue_events_169798.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169798"
}
```



---

archive/issue_events_169799.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169799"
}
```



---

archive/issue_comments_138534.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI am reverting the deprecation of `lngamma()` for PARI in #15767 (see comment [comment:20])",
    "created_at": "2014-02-09T16:27:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138534",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

I am reverting the deprecation of `lngamma()` for PARI in #15767 (see comment [comment:20])



---

archive/issue_events_169800.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169800"
}
```



---

archive/issue_events_169801.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169801"
}
```



---

archive/issue_events_169802.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169802"
}
```



---

archive/issue_events_169803.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169803"
}
```



---

archive/issue_comments_138535.json:
```json
{
    "body": "Branch: **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)**",
    "created_at": "2014-08-11T07:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138535",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)**



---

archive/issue_comments_138536.json:
```json
{
    "body": "Work Issues: **speedup**",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138536",
    "user": "https://github.com/rwst"
}
```

Work Issues: **speedup**



---

archive/issue_comments_138537.json:
```json
{
    "body": "Changed reviewer from **Burcin Erocal** to **Burcin Erocal, Ralf Stephan**",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138537",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Burcin Erocal** to **Burcin Erocal, Ralf Stephan**



---

archive/issue_comments_138538.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nTests are good in `functions`, `rings`, `symbolic`. The speed issue in [comment:21](#comment%3A21) still remains.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4b611dedda2b87dbb690647d3de0e735fea2b3b\"><code>f4b611d</code></a></td><td><code>12521: fixing numerical evaluation of log_gamma</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b\"><code>d7731cb</code></a></td><td><code>12521: reviewer missed a part of the patch</code></td></tr></table>\n",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138538",
    "user": "https://github.com/rwst"
}
```

<div id="comment:27" align="right">comment:27</div>

Tests are good in `functions`, `rings`, `symbolic`. The speed issue in [comment:21](#comment%3A21) still remains.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4b611dedda2b87dbb690647d3de0e735fea2b3b"><code>f4b611d</code></a></td><td><code>12521: fixing numerical evaluation of log_gamma</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b"><code>d7731cb</code></a></td><td><code>12521: reviewer missed a part of the patch</code></td></tr></table>




---

archive/issue_comments_138539.json:
```json
{
    "body": "Commit: **[`d7731cb`](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)**",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138539",
    "user": "https://github.com/rwst"
}
```

Commit: **[`d7731cb`](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)**



---

archive/issue_comments_138540.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767\"><code>bacd234</code></a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr></table>\n",
    "created_at": "2014-09-03T08:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138540",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767"><code>bacd234</code></a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr></table>




---

archive/issue_comments_138541.json:
```json
{
    "body": "Changed commit from **[`d7731cb`](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)** to **[`bacd234`](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)**",
    "created_at": "2014-09-03T08:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138541",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d7731cb`](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)** to **[`bacd234`](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)**



---

archive/issue_comments_138542.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nHas anyone checked the *mathematics* of this recently?  Eviatar usually does a very good job on this stuff, but unfortunately Burcin didn't make it clear whether the rest was approved of other than the different imports.",
    "created_at": "2014-09-03T12:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138542",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:29" align="right">comment:29</div>

Has anyone checked the *mathematics* of this recently?  Eviatar usually does a very good job on this stuff, but unfortunately Burcin didn't make it clear whether the rest was approved of other than the different imports.



---

archive/issue_comments_138543.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,3 +25,15 @@\n Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n \n Apply: [attachment: trac_12521_3.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)\n+\n+There is now also the arb option:\n+\n+```\n+sage: x=ComplexBallField(53)(-2.1)\n+sage: %timeit _ = x.log_gamma()\n+The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.\n+100000 loops, best of 3: 8.15 \u00b5s per loop\n+sage: x.log_gamma()\n+[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I\n+```\n+\n``````\n",
    "created_at": "2016-06-14T12:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138543",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,3 +25,15 @@
 Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...
 
 Apply: [attachment: trac_12521_3.patch](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)
+
+There is now also the arb option:
+
+```
+sage: x=ComplexBallField(53)(-2.1)
+sage: %timeit _ = x.log_gamma()
+The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.
+100000 loops, best of 3: 8.15 µs per loop
+sage: x.log_gamma()
+[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I
+```
+
``````




---

archive/issue_comments_138544.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5021044cc10f728a1f85d615925c9ab77f42c1c\"><code>d502104</code></a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62\"><code>c11c3ef</code></a></td><td><code>12521: simplifcations, doctest fixes</code></td></tr></table>\n",
    "created_at": "2016-06-15T07:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138544",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5021044cc10f728a1f85d615925c9ab77f42c1c"><code>d502104</code></a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62"><code>c11c3ef</code></a></td><td><code>12521: simplifcations, doctest fixes</code></td></tr></table>




---

archive/issue_comments_138545.json:
```json
{
    "body": "Changed commit from **[`bacd234`](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)** to **[`c11c3ef`](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**",
    "created_at": "2016-06-15T07:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138545",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bacd234`](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)** to **[`c11c3ef`](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**



---

archive/issue_comments_138546.json:
```json
{
    "body": "Changed author from **Eviatar Bach** to **Eviatar Bach, Ralf Stephan**",
    "created_at": "2016-06-15T07:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138546",
    "user": "https://github.com/rwst"
}
```

Changed author from **Eviatar Bach** to **Eviatar Bach, Ralf Stephan**



---

archive/issue_comments_138547.json:
```json
{
    "body": "Changed work issues from **speedup** to none",
    "created_at": "2016-06-15T07:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138547",
    "user": "https://github.com/rwst"
}
```

Changed work issues from **speedup** to none



---

archive/issue_events_169804.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169804"
}
```



---

archive/issue_events_169805.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169805"
}
```



---

archive/issue_events_169806.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169806"
}
```



---

archive/issue_events_169807.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169807"
}
```



---

archive/issue_comments_138548.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nWith these changes the beta() function is still producing small imaginary parts around poles and not returning the appropriate signed Infinity at the poles. Presumably that should be on another ticket.\n\nOtherwise looks fine to me.",
    "created_at": "2016-06-22T19:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138548",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:34" align="right">comment:34</div>

With these changes the beta() function is still producing small imaginary parts around poles and not returning the appropriate signed Infinity at the poles. Presumably that should be on another ticket.

Otherwise looks fine to me.



---

archive/issue_events_169808.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-06-22T19:38:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169808"
}
```



---

archive/issue_events_169809.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-06-22T19:38:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169809"
}
```



---

archive/issue_comments_138549.json:
```json
{
    "body": "Changed branch from **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)** to **[`c11c3ef`](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**",
    "created_at": "2016-06-24T07:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-138549",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)** to **[`c11c3ef`](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**



---

archive/issue_events_169810.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-24T07:26:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169810"
}
```



---

archive/issue_events_169811.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d3522256eb24bae2d3e83f03bada46a7e4f3a15d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-06-24T07:26:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-169811"
}
```
