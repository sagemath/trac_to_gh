# Issue 12521: evaluate log gamma for complex input

archive/issues_012349.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  @burcin ktkohl fstan @zimmermann6 @benjaminfjones @eviatarbach @paulmasson\n\nKeywords: lgamma log_gamma\n\nCurrently, we use MPFR or Ginac to evaluate `log_gamma`, but this returns `NaN` for negative input with even ceiling.\n\n```\nsage: log_gamma(-2.1)\nNaN\nsage: log_gamma(-3.1)\n0.400311696703985\nsage: log_gamma(-4.1)\nNaN\nsage: log_gamma(-5.1)\n-2.63991581673655\nsage: log_gamma(-21/10).n()\nNaN\nsage: get_systems('log_gamma(-21/10).n()')\n['ginac']\nsage: log_gamma(CC(-2.1))\n1.53171380819509 + 3.14159265358979*I\n```\nWe can use mpmath or something other trick to get this to work, now that #10075 has a  nice symbolic function available.  See #10072 for where we originally got better numerical evaluation.\n\n```\nsage: mpmath.loggamma(-2.1)\nmpc(real='1.5317138081950856', imag='-9.4247779607693793')\n```\nPutting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n\nApply: [attachment:trac_12521_3.patch]\n\nThere is now also the arb option:\n\n```\nsage: x=ComplexBallField(53)(-2.1)\nsage: %timeit _ = x.log_gamma()\nThe slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 8.15 \u00b5s per loop\nsage: x.log_gamma()\n[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12521\n\n",
    "closed_at": "2016-06-24T07:26:13Z",
    "created_at": "2012-02-16T17:02:27Z",
    "labels": [
        "component: basic arithmetic",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "evaluate log gamma for complex input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12521",
    "user": "https://github.com/kcrisman"
}
```
Assignee: @aghitza

CC:  @burcin ktkohl fstan @zimmermann6 @benjaminfjones @eviatarbach @paulmasson

Keywords: lgamma log_gamma

Currently, we use MPFR or Ginac to evaluate `log_gamma`, but this returns `NaN` for negative input with even ceiling.

```
sage: log_gamma(-2.1)
NaN
sage: log_gamma(-3.1)
0.400311696703985
sage: log_gamma(-4.1)
NaN
sage: log_gamma(-5.1)
-2.63991581673655
sage: log_gamma(-21/10).n()
NaN
sage: get_systems('log_gamma(-21/10).n()')
['ginac']
sage: log_gamma(CC(-2.1))
1.53171380819509 + 3.14159265358979*I
```
We can use mpmath or something other trick to get this to work, now that #10075 has a  nice symbolic function available.  See #10072 for where we originally got better numerical evaluation.

```
sage: mpmath.loggamma(-2.1)
mpc(real='1.5317138081950856', imag='-9.4247779607693793')
```
Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...

Apply: [attachment:trac_12521_3.patch]

There is now also the arb option:

```
sage: x=ComplexBallField(53)(-2.1)
sage: %timeit _ = x.log_gamma()
The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 8.15 µs per loop
sage: x.log_gamma()
[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I
```


Issue created by migration from https://trac.sagemath.org/ticket/12521





---

archive/issue_comments_145268.json:
```json
{
    "body": "I cannot reproduce some examples from the description with Sage 4.8:\n\n```\nsage: from sage.misc.citation import get_systems\nsage: get_systems('log_gamma(-21/10).n()')      \n['MPFR']\nsage: log_gamma(CC(-2.1))\nNaN\n```\nDo you use a different version? Did you apply some patches?\n\nPaul",
    "created_at": "2012-02-17T09:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145268",
    "user": "https://github.com/zimmermann6"
}
```

I cannot reproduce some examples from the description with Sage 4.8:

```
sage: from sage.misc.citation import get_systems
sage: get_systems('log_gamma(-21/10).n()')      
['MPFR']
sage: log_gamma(CC(-2.1))
NaN
```
Do you use a different version? Did you apply some patches?

Paul



---

archive/issue_comments_145269.json:
```json
{
    "body": "> Do you use a different version? Did you apply some patches?\n\nYes, I guess this is after #10075.  There is the same problem before that patch, but the systems and outputs will be different.   In particular, inheriting from the parent of the input (which most generic `Function` classes do) if it has a method of the same name (which `CC` does) makes this change.\n\nThere is no patch, so this doesn't depend on #10075 in that sense, but I will put it anyway so that it's clear.  Thanks!",
    "created_at": "2012-02-17T13:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145269",
    "user": "https://github.com/kcrisman"
}
```

> Do you use a different version? Did you apply some patches?

Yes, I guess this is after #10075.  There is the same problem before that patch, but the systems and outputs will be different.   In particular, inheriting from the parent of the input (which most generic `Function` classes do) if it has a method of the same name (which `CC` does) makes this change.

There is no patch, so this doesn't depend on #10075 in that sense, but I will put it anyway so that it's clear.  Thanks!



---

archive/issue_comments_145270.json:
```json
{
    "body": "Removing dependency so as not to confuse anyone, now that that is in a long-since released version of Sage.",
    "created_at": "2012-07-07T02:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145270",
    "user": "https://github.com/kcrisman"
}
```

Removing dependency so as not to confuse anyone, now that that is in a long-since released version of Sage.



---

archive/issue_comments_145271.json:
```json
{
    "body": "by the way, MPFR provides two functions: `mpfr_lngamma` indeed returns `NaN` between\n`-2k-1` and `-2k` for `k` a non-negative integer.\n\nHowever there is another function `mpfr_lgamma` which returns `log(abs(gamma(x)))`,\nand separately the sign of `gamma(x)`. It suffices to add `pi*I` when the sign is\nnegative.\n\nThis would solve the problem at least for real input.\n\nPaul",
    "created_at": "2012-07-09T13:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145271",
    "user": "https://github.com/zimmermann6"
}
```

by the way, MPFR provides two functions: `mpfr_lngamma` indeed returns `NaN` between
`-2k-1` and `-2k` for `k` a non-negative integer.

However there is another function `mpfr_lgamma` which returns `log(abs(gamma(x)))`,
and separately the sign of `gamma(x)`. It suffices to add `pi*I` when the sign is
negative.

This would solve the problem at least for real input.

Paul



---

archive/issue_comments_145272.json:
```json
{
    "body": "There is a related issue with the beta function:\n\n```\nsage: beta(-1.3,-0.4)\nNaN\nsage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality\n-4.92909641669610\n```\n\nThis is presumably because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `gamma(-0.4)` is negative. I'm confused as to why it works fine in the GiNaC interactive shell though.",
    "created_at": "2013-01-21T01:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145272",
    "user": "https://github.com/eviatarbach"
}
```

There is a related issue with the beta function:

```
sage: beta(-1.3,-0.4)
NaN
sage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality
-4.92909641669610
```

This is presumably because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `gamma(-0.4)` is negative. I'm confused as to why it works fine in the GiNaC interactive shell though.



---

archive/issue_comments_145273.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2013-06-19T17:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145273",
    "user": "https://github.com/eviatarbach"
}
```

Changing priority from major to critical.



---

archive/issue_comments_145274.json:
```json
{
    "body": "Our current implementation is wrong. For the principal branch, `log_gamma(z)` should not be equal to `log(gamma(z))` in general. See https://cs.uwaterloo.ca/research/tr/1994/23/CS-94-23.pdf:\n\n`ln_gamma(x) = ln(gamma(x)) + 2*pi*i*ceil(x/2 - 1)`\n\nChanging to critical because the documentation claims that it's the principal branch, which is mathematically wrong.",
    "created_at": "2013-06-19T17:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145274",
    "user": "https://github.com/eviatarbach"
}
```

Our current implementation is wrong. For the principal branch, `log_gamma(z)` should not be equal to `log(gamma(z))` in general. See https://cs.uwaterloo.ca/research/tr/1994/23/CS-94-23.pdf:

`ln_gamma(x) = ln(gamma(x)) + 2*pi*i*ceil(x/2 - 1)`

Changing to critical because the documentation claims that it's the principal branch, which is mathematically wrong.



---

archive/issue_comments_145275.json:
```json
{
    "body": "I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?",
    "created_at": "2013-06-19T20:06:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145275",
    "user": "https://github.com/kcrisman"
}
```

I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?



---

archive/issue_comments_145276.json:
```json
{
    "body": "Paul, could you please comment on this code for `sage/rings/real_mpfr.pyx`?\n\n\n```\n    def log_gamma(self):\n        cdef RealNumber x = self._new()\n        cdef int sign\n        parent = (<RealField_class>self._parent)\n        if parent.__prec > SIG_PREC_THRESHOLD: sig_on()\n        mpfr_lgamma(x.value, &sign, self.value, parent.rnd)\n        if parent.__prec > SIG_PREC_THRESHOLD: sig_off()\n        if not mpfr_sgn(self.value) < 0:\n            return x\n        cdef RealNumber v = self._new()\n        mpfr_div_si((<RealNumber>v).value, self.value, 2, parent.rnd)\n        return parent.complex_field()(x, parent.pi() *\n                                      (2 * (v - 1).ceil() + 1))\n```\n\nThis correctly computes the principal branch. However, I'm concerned about precision; the result of `lgamma` is presumably guaranteed to be correct up to the precision of the input, but after doing some arithmetic it might not be. Is there any way to fix this?",
    "created_at": "2013-06-19T21:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145276",
    "user": "https://github.com/eviatarbach"
}
```

Paul, could you please comment on this code for `sage/rings/real_mpfr.pyx`?


```
    def log_gamma(self):
        cdef RealNumber x = self._new()
        cdef int sign
        parent = (<RealField_class>self._parent)
        if parent.__prec > SIG_PREC_THRESHOLD: sig_on()
        mpfr_lgamma(x.value, &sign, self.value, parent.rnd)
        if parent.__prec > SIG_PREC_THRESHOLD: sig_off()
        if not mpfr_sgn(self.value) < 0:
            return x
        cdef RealNumber v = self._new()
        mpfr_div_si((<RealNumber>v).value, self.value, 2, parent.rnd)
        return parent.complex_field()(x, parent.pi() *
                                      (2 * (v - 1).ceil() + 1))
```

This correctly computes the principal branch. However, I'm concerned about precision; the result of `lgamma` is presumably guaranteed to be correct up to the precision of the input, but after doing some arithmetic it might not be. Is there any way to fix this?



---

archive/issue_comments_145277.json:
```json
{
    "body": "Dear Eviatar,\n\nI see no argument to tell the precision of the output in this function, thus I guess the result should be computed to the precision of the input.\n\nThen the real part seems fine to me.\n\nFor the imaginary part, you create the variable `v` with the same precision than the input I guess.\nIn `v-1` you might have a problem if `v` is very large, then `v-1` rounded will equal `v`,\nand `(v-1).ceil()` will equal `v` too. Thus the result will be too large by `2pi`.\n\nPaul",
    "created_at": "2013-06-20T05:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145277",
    "user": "https://github.com/zimmermann6"
}
```

Dear Eviatar,

I see no argument to tell the precision of the output in this function, thus I guess the result should be computed to the precision of the input.

Then the real part seems fine to me.

For the imaginary part, you create the variable `v` with the same precision than the input I guess.
In `v-1` you might have a problem if `v` is very large, then `v-1` rounded will equal `v`,
and `(v-1).ceil()` will equal `v` too. Thus the result will be too large by `2pi`.

Paul



---

archive/issue_comments_145278.json:
```json
{
    "body": "Replying to [comment:9 kcrisman]:\n> I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?\n\n\nthere are some references on http://mathworld.wolfram.com/LogGammaFunction.html\n\nPaul",
    "created_at": "2013-06-20T08:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145278",
    "user": "https://github.com/zimmermann6"
}
```

Replying to [comment:9 kcrisman]:
> I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?


there are some references on http://mathworld.wolfram.com/LogGammaFunction.html

Paul



---

archive/issue_comments_145279.json:
```json
{
    "body": "Thank you. I suspected there might be a problem like this. I think maybe using MPFR for positive reals (since it's faster) and mpmath for negative reals might be best.",
    "created_at": "2013-06-20T16:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145279",
    "user": "https://github.com/eviatarbach"
}
```

Thank you. I suspected there might be a problem like this. I think maybe using MPFR for positive reals (since it's faster) and mpmath for negative reals might be best.



---

archive/issue_comments_145280.json:
```json
{
    "body": "Attachment [trac_12521.patch](tarball://root/attachments/some-uuid/ticket12521/trac_12521.patch) by @eviatarbach created at 2013-06-25 09:35:37",
    "created_at": "2013-06-25T09:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145280",
    "user": "https://github.com/eviatarbach"
}
```

Attachment [trac_12521.patch](tarball://root/attachments/some-uuid/ticket12521/trac_12521.patch) by @eviatarbach created at 2013-06-25 09:35:37



---

archive/issue_comments_145281.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-06-25T09:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145281",
    "user": "https://github.com/eviatarbach"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_145282.json:
```json
{
    "body": "Patch uploaded. It uses mpmath to evaluate `log_gamma` in certain circumstances, while the MPFR implementation is left intact for positive reals. It also removes the `lgamma` and `lngamma` functions which were deprecated four years ago with #6992.\n\nPatchbot apply trac_12521.2.patch",
    "created_at": "2013-06-25T09:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145282",
    "user": "https://github.com/eviatarbach"
}
```

Patch uploaded. It uses mpmath to evaluate `log_gamma` in certain circumstances, while the MPFR implementation is left intact for positive reals. It also removes the `lgamma` and `lngamma` functions which were deprecated four years ago with #6992.

Patchbot apply trac_12521.2.patch



---

archive/issue_comments_145283.json:
```json
{
    "body": "Attachment [trac_12521.2.patch](tarball://root/attachments/some-uuid/ticket12521/trac_12521.2.patch) by @burcin created at 2013-06-27 16:55:20\n\nThe patchbot complains about old style doctest continuation.\n\nSince you need to edit the patch anyway... In the `py_lgamma` function from `pynac.pyx`, you don't need to import `call` from `mpmath` or `parent` from `sage.structure.coerce`. These are already available as `mpmath_utils.call` and `parent_c`.\n\nThanks for the patch! Great work noticing that we don't actually compute the principal branch.",
    "created_at": "2013-06-27T16:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145283",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_12521.2.patch](tarball://root/attachments/some-uuid/ticket12521/trac_12521.2.patch) by @burcin created at 2013-06-27 16:55:20

The patchbot complains about old style doctest continuation.

Since you need to edit the patch anyway... In the `py_lgamma` function from `pynac.pyx`, you don't need to import `call` from `mpmath` or `parent` from `sage.structure.coerce`. These are already available as `mpmath_utils.call` and `parent_c`.

Thanks for the patch! Great work noticing that we don't actually compute the principal branch.



---

archive/issue_comments_145284.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-06-27T16:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145284",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_145285.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-06-27T20:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145285",
    "user": "https://github.com/eviatarbach"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_145286.json:
```json
{
    "body": "Thanks!\n\nI had already fixed the doctest continuation and overwrote the previous patch, but the patchbot didn't test it again.\n\nI fixed the import issue. I also noticed that the results for Python `float` and `complex` were inconsistent, so I fixed that and added some tests.\n\nPatchbot apply trac_12521_3.patch",
    "created_at": "2013-06-27T20:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145286",
    "user": "https://github.com/eviatarbach"
}
```

Thanks!

I had already fixed the doctest continuation and overwrote the previous patch, but the patchbot didn't test it again.

I fixed the import issue. I also noticed that the results for Python `float` and `complex` were inconsistent, so I fixed that and added some tests.

Patchbot apply trac_12521_3.patch



---

archive/issue_comments_145287.json:
```json
{
    "body": "Attachment [trac_12521_3.patch](tarball://root/attachments/some-uuid/ticket12521/trac_12521_3.patch) by @eviatarbach created at 2013-06-28 20:30:58\n\nWhy is the patchbot trying to apply the last two patches instead of just trac_12521_3.patch?",
    "created_at": "2013-06-28T20:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145287",
    "user": "https://github.com/eviatarbach"
}
```

Attachment [trac_12521_3.patch](tarball://root/attachments/some-uuid/ticket12521/trac_12521_3.patch) by @eviatarbach created at 2013-06-28 20:30:58

Why is the patchbot trying to apply the last two patches instead of just trac_12521_3.patch?



---

archive/issue_comments_145288.json:
```json
{
    "body": "Let's try again:\n\nPatchbot apply trac_12521_3.patch",
    "created_at": "2013-07-16T05:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145288",
    "user": "https://github.com/eviatarbach"
}
```

Let's try again:

Patchbot apply trac_12521_3.patch



---

archive/issue_events_033740.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33740"
}
```



---

archive/issue_comments_145289.json:
```json
{
    "body": "I am against removing the `lngamma()` method and against the deprecation from #6992 for PARI. Inside PARI/GP, the name is `lngamma()` and that name should be available to Sage too.",
    "created_at": "2013-10-29T08:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145289",
    "user": "https://github.com/jdemeyer"
}
```

I am against removing the `lngamma()` method and against the deprecation from #6992 for PARI. Inside PARI/GP, the name is `lngamma()` and that name should be available to Sage too.



---

archive/issue_comments_145290.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-29T08:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145290",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_145291.json:
```json
{
    "body": "Also, it seems the algorithm for complex numbers is much faster than for real numbers, so we should probably use the complex algorithm for all inputs:\n\n```\nsage: a=RealField(53)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 118 \u00b5s per loop\nsage: a=ComplexField(53)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 112 \u00b5s per loop\n```\n\n```\nsage: a=RealField(10**4)(2.5); timeit('log_gamma(a)')\n5 loops, best of 3: 506 ms per loop\nsage: a=ComplexField(10**4)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 782 \u00b5s per loop\n```",
    "created_at": "2013-10-29T08:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145291",
    "user": "https://github.com/jdemeyer"
}
```

Also, it seems the algorithm for complex numbers is much faster than for real numbers, so we should probably use the complex algorithm for all inputs:

```
sage: a=RealField(53)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 118 µs per loop
sage: a=ComplexField(53)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 112 µs per loop
```

```
sage: a=RealField(10**4)(2.5); timeit('log_gamma(a)')
5 loops, best of 3: 506 ms per loop
sage: a=ComplexField(10**4)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 782 µs per loop
```



---

archive/issue_events_033741.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33741"
}
```



---

archive/issue_events_033742.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33742"
}
```



---

archive/issue_comments_145292.json:
```json
{
    "body": "I am reverting the deprecation of `lngamma()` for PARI in #15767 (see comment [comment:20])",
    "created_at": "2014-02-09T16:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145292",
    "user": "https://github.com/jdemeyer"
}
```

I am reverting the deprecation of `lngamma()` for PARI in #15767 (see comment [comment:20])



---

archive/issue_events_033743.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33743"
}
```



---

archive/issue_events_033744.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33744"
}
```



---

archive/issue_events_033745.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33745"
}
```



---

archive/issue_events_033746.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33746"
}
```



---

archive/issue_comments_145293.json:
```json
{
    "body": "Tests are good in `functions`, `rings`, `symbolic`. The speed issue in comment:21 still remains.\n\n---\nNew commits:",
    "created_at": "2014-08-11T07:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145293",
    "user": "https://github.com/rwst"
}
```

Tests are good in `functions`, `rings`, `symbolic`. The speed issue in comment:21 still remains.

---
New commits:



---

archive/issue_comments_145294.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-03T08:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145294",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_145295.json:
```json
{
    "body": "Has anyone checked the *mathematics* of this recently?  Eviatar usually does a very good job on this stuff, but unfortunately Burcin didn't make it clear whether the rest was approved of other than the different imports.",
    "created_at": "2014-09-03T12:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145295",
    "user": "https://github.com/kcrisman"
}
```

Has anyone checked the *mathematics* of this recently?  Eviatar usually does a very good job on this stuff, but unfortunately Burcin didn't make it clear whether the rest was approved of other than the different imports.



---

archive/issue_comments_145296.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-15T07:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145296",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_145297.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-06-15T07:30:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145297",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_033747.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33747"
}
```



---

archive/issue_events_033748.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "milestone": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33748"
}
```



---

archive/issue_comments_145298.json:
```json
{
    "body": "With these changes the beta() function is still producing small imaginary parts around poles and not returning the appropriate signed Infinity at the poles. Presumably that should be on another ticket.\n\nOtherwise looks fine to me.",
    "created_at": "2016-06-22T19:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145298",
    "user": "https://github.com/paulmasson"
}
```

With these changes the beta() function is still producing small imaginary parts around poles and not returning the appropriate signed Infinity at the poles. Presumably that should be on another ticket.

Otherwise looks fine to me.



---

archive/issue_comments_145299.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-06-22T19:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145299",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145300.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-06-24T07:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12521#issuecomment-145300",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_033749.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-24T07:26:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12521",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12521#event-33749"
}
```
