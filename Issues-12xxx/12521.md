# Issue 12521: evaluate log gamma for complex input

archive/issues_012349.json:
```json
{
    "assignees": [],
    "body": "Currently, we use MPFR or Ginac to evaluate `log_gamma`, but this returns `NaN` for negative input with even ceiling.\n\n```\nsage: log_gamma(-2.1)\nNaN\nsage: log_gamma(-3.1)\n0.400311696703985\nsage: log_gamma(-4.1)\nNaN\nsage: log_gamma(-5.1)\n-2.63991581673655\nsage: log_gamma(-21/10).n()\nNaN\nsage: get_systems('log_gamma(-21/10).n()')\n['ginac']\nsage: log_gamma(CC(-2.1))\n1.53171380819509 + 3.14159265358979*I\n```\nWe can use mpmath or something other trick to get this to work, now that #10075 has a  nice symbolic function available.  See #10072 for where we originally got better numerical evaluation.\n\n```\nsage: mpmath.loggamma(-2.1)\nmpc(real='1.5317138081950856', imag='-9.4247779607693793')\n```\nPutting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n\nApply: [attachment: trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)\n\nThere is now also the arb option:\n\n```\nsage: x=ComplexBallField(53)(-2.1)\nsage: %timeit _ = x.log_gamma()\nThe slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 8.15 \u00b5s per loop\nsage: x.log_gamma()\n[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I\n```\n\n\nAssignee: **@aghitza**\n\nCC:  @burcin ktkohl fstan @zimmermann6 @benjaminfjones @eviatarbach @paulmasson\n\nKeywords: **lgamma log_gamma**\n\nBranch/Commit: **[c11c3ef](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**\n\nReviewer: **Burcin Erocal, Ralf Stephan**\n\nAuthor: **Eviatar Bach, Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12521_\n\n",
    "closed_at": "2016-06-24T07:26:13Z",
    "created_at": "2012-02-16T17:02:27Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "evaluate log gamma for complex input",
    "type": "issue",
    "updated_at": "2016-06-24T07:26:13Z",
    "url": "https://github.com/sagemath/sage/issues/12521",
    "user": "https://github.com/kcrisman"
}
```
Currently, we use MPFR or Ginac to evaluate `log_gamma`, but this returns `NaN` for negative input with even ceiling.

```
sage: log_gamma(-2.1)
NaN
sage: log_gamma(-3.1)
0.400311696703985
sage: log_gamma(-4.1)
NaN
sage: log_gamma(-5.1)
-2.63991581673655
sage: log_gamma(-21/10).n()
NaN
sage: get_systems('log_gamma(-21/10).n()')
['ginac']
sage: log_gamma(CC(-2.1))
1.53171380819509 + 3.14159265358979*I
```
We can use mpmath or something other trick to get this to work, now that #10075 has a  nice symbolic function available.  See #10072 for where we originally got better numerical evaluation.

```
sage: mpmath.loggamma(-2.1)
mpc(real='1.5317138081950856', imag='-9.4247779607693793')
```
Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...

Apply: [attachment: trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)

There is now also the arb option:

```
sage: x=ComplexBallField(53)(-2.1)
sage: %timeit _ = x.log_gamma()
The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 8.15 µs per loop
sage: x.log_gamma()
[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I
```


Assignee: **@aghitza**

CC:  @burcin ktkohl fstan @zimmermann6 @benjaminfjones @eviatarbach @paulmasson

Keywords: **lgamma log_gamma**

Branch/Commit: **[c11c3ef](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**

Reviewer: **Burcin Erocal, Ralf Stephan**

Author: **Eviatar Bach, Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/12521_





---

archive/issue_events_156860.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156860"
}
```



---

archive/issue_events_156861.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "component: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156861"
}
```



---

archive/issue_events_156862.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156862"
}
```



---

archive/issue_events_156863.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2012-02-16T17:02:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156863"
}
```



---

archive/issue_comments_140818.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nI cannot reproduce some examples from the description with Sage 4.8:\n\n```\nsage: from sage.misc.citation import get_systems\nsage: get_systems('log_gamma(-21/10).n()')      \n['MPFR']\nsage: log_gamma(CC(-2.1))\nNaN\n```\nDo you use a different version? Did you apply some patches?\n\nPaul",
    "created_at": "2012-02-17T09:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140818",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:1'>Comment 1:</a>
I cannot reproduce some examples from the description with Sage 4.8:

```
sage: from sage.misc.citation import get_systems
sage: get_systems('log_gamma(-21/10).n()')      
['MPFR']
sage: log_gamma(CC(-2.1))
NaN
```
Do you use a different version? Did you apply some patches?

Paul



---

archive/issue_comments_140819.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\n> Do you use a different version? Did you apply some patches?\n\nYes, I guess this is after #10075.  There is the same problem before that patch, but the systems and outputs will be different.   In particular, inheriting from the parent of the input (which most generic `Function` classes do) if it has a method of the same name (which `CC` does) makes this change.\n\nThere is no patch, so this doesn't depend on #10075 in that sense, but I will put it anyway so that it's clear.  Thanks!",
    "created_at": "2012-02-17T13:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140819",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'>Comment 2:</a>
> Do you use a different version? Did you apply some patches?

Yes, I guess this is after #10075.  There is the same problem before that patch, but the systems and outputs will be different.   In particular, inheriting from the parent of the input (which most generic `Function` classes do) if it has a method of the same name (which `CC` does) makes this change.

There is no patch, so this doesn't depend on #10075 in that sense, but I will put it anyway so that it's clear.  Thanks!



---

archive/issue_comments_140820.json:
```json
{
    "body": "Dependencies: **#10075**",
    "created_at": "2012-02-17T13:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140820",
    "user": "https://github.com/kcrisman"
}
```

Dependencies: **#10075**



---

archive/issue_comments_140821.json:
```json
{
    "body": "Changed dependencies from **#10075** to none",
    "created_at": "2012-07-07T02:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140821",
    "user": "https://github.com/kcrisman"
}
```

Changed dependencies from **#10075** to none



---

archive/issue_comments_140822.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nRemoving dependency so as not to confuse anyone, now that that is in a long-since released version of Sage.",
    "created_at": "2012-07-07T02:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140822",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'>Comment 3:</a>
Removing dependency so as not to confuse anyone, now that that is in a long-since released version of Sage.



---

archive/issue_comments_140823.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nby the way, MPFR provides two functions: `mpfr_lngamma` indeed returns `NaN` between\n`-2k-1` and `-2k` for `k` a non-negative integer.\n\nHowever there is another function `mpfr_lgamma` which returns `log(abs(gamma(x)))`,\nand separately the sign of `gamma(x)`. It suffices to add `pi*I` when the sign is\nnegative.\n\nThis would solve the problem at least for real input.\n\nPaul",
    "created_at": "2012-07-09T13:05:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140823",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'>Comment 4:</a>
by the way, MPFR provides two functions: `mpfr_lngamma` indeed returns `NaN` between
`-2k-1` and `-2k` for `k` a non-negative integer.

However there is another function `mpfr_lgamma` which returns `log(abs(gamma(x)))`,
and separately the sign of `gamma(x)`. It suffices to add `pi*I` when the sign is
negative.

This would solve the problem at least for real input.

Paul



---

archive/issue_comments_140824.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThere is a related issue with the beta function:\n\n```\nsage: beta(-1.3,-0.4)\nNaN\nsage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality\n-4.92909641669610\n```\n\nThis is presumably because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `gamma(-0.4)` is negative. I'm confused as to why it works fine in the GiNaC interactive shell though.",
    "created_at": "2013-01-21T01:06:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140824",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:6'>Comment 6:</a>
There is a related issue with the beta function:

```
sage: beta(-1.3,-0.4)
NaN
sage: (gamma(-1.3) * gamma(-0.4)) / gamma(-1.3 - 0.4) # expected functionality
-4.92909641669610
```

This is presumably because GiNaC uses `exp(log_gamma(-1.3)+log_gamma(-0.4)-log_gamma(-1.3-0.4))` to evaluate, and `gamma(-0.4)` is negative. I'm confused as to why it works fine in the GiNaC interactive shell though.



---

archive/issue_events_156864.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-19T17:24:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156864"
}
```



---

archive/issue_events_156865.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-19T17:24:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156865"
}
```



---

archive/issue_comments_140825.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nOur current implementation is wrong. For the principal branch, `log_gamma(z)` should not be equal to `log(gamma(z))` in general. See https://cs.uwaterloo.ca/research/tr/1994/23/CS-94-23.pdf:\n\n`ln_gamma(x) = ln(gamma(x)) + 2*pi*i*ceil(x/2 - 1)`\n\nChanging to critical because the documentation claims that it's the principal branch, which is mathematically wrong.",
    "created_at": "2013-06-19T17:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140825",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:8'>Comment 8:</a>
Our current implementation is wrong. For the principal branch, `log_gamma(z)` should not be equal to `log(gamma(z))` in general. See https://cs.uwaterloo.ca/research/tr/1994/23/CS-94-23.pdf:

`ln_gamma(x) = ln(gamma(x)) + 2*pi*i*ceil(x/2 - 1)`

Changing to critical because the documentation claims that it's the principal branch, which is mathematically wrong.



---

archive/issue_comments_140826.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?",
    "created_at": "2013-06-19T20:06:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140826",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'>Comment 9:</a>
I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?



---

archive/issue_comments_140827.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nPaul, could you please comment on this code for `sage/rings/real_mpfr.pyx`?\n\n\n```\n    def log_gamma(self):\n        cdef RealNumber x = self._new()\n        cdef int sign\n        parent = (<RealField_class>self._parent)\n        if parent.__prec > SIG_PREC_THRESHOLD: sig_on()\n        mpfr_lgamma(x.value, &sign, self.value, parent.rnd)\n        if parent.__prec > SIG_PREC_THRESHOLD: sig_off()\n        if not mpfr_sgn(self.value) < 0:\n            return x\n        cdef RealNumber v = self._new()\n        mpfr_div_si((<RealNumber>v).value, self.value, 2, parent.rnd)\n        return parent.complex_field()(x, parent.pi() *\n                                      (2 * (v - 1).ceil() + 1))\n```\n\nThis correctly computes the principal branch. However, I'm concerned about precision; the result of `lgamma` is presumably guaranteed to be correct up to the precision of the input, but after doing some arithmetic it might not be. Is there any way to fix this?",
    "created_at": "2013-06-19T21:59:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140827",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:10'>Comment 10:</a>
Paul, could you please comment on this code for `sage/rings/real_mpfr.pyx`?


```
    def log_gamma(self):
        cdef RealNumber x = self._new()
        cdef int sign
        parent = (<RealField_class>self._parent)
        if parent.__prec > SIG_PREC_THRESHOLD: sig_on()
        mpfr_lgamma(x.value, &sign, self.value, parent.rnd)
        if parent.__prec > SIG_PREC_THRESHOLD: sig_off()
        if not mpfr_sgn(self.value) < 0:
            return x
        cdef RealNumber v = self._new()
        mpfr_div_si((<RealNumber>v).value, self.value, 2, parent.rnd)
        return parent.complex_field()(x, parent.pi() *
                                      (2 * (v - 1).ceil() + 1))
```

This correctly computes the principal branch. However, I'm concerned about precision; the result of `lgamma` is presumably guaranteed to be correct up to the precision of the input, but after doing some arithmetic it might not be. Is there any way to fix this?



---

archive/issue_comments_140828.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nDear Eviatar,\n\nI see no argument to tell the precision of the output in this function, thus I guess the result should be computed to the precision of the input.\n\nThen the real part seems fine to me.\n\nFor the imaginary part, you create the variable `v` with the same precision than the input I guess.\nIn `v-1` you might have a problem if `v` is very large, then `v-1` rounded will equal `v`,\nand `(v-1).ceil()` will equal `v` too. Thus the result will be too large by `2pi`.\n\nPaul",
    "created_at": "2013-06-20T05:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140828",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:11'>Comment 11:</a>
Dear Eviatar,

I see no argument to tell the precision of the output in this function, thus I guess the result should be computed to the precision of the input.

Then the real part seems fine to me.

For the imaginary part, you create the variable `v` with the same precision than the input I guess.
In `v-1` you might have a problem if `v` is very large, then `v-1` rounded will equal `v`,
and `(v-1).ceil()` will equal `v` too. Thus the result will be too large by `2pi`.

Paul



---

archive/issue_comments_140829.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nReplying to [@kcrisman](#comment%3A9):\n> I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?\n\nthere are some references on http://mathworld.wolfram.com/LogGammaFunction.html\n\nPaul",
    "created_at": "2013-06-20T08:45:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140829",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'>Comment 12:</a>
Replying to [@kcrisman](#comment%3A9):
> I'd like to have another reference for this (perhaps NIST or A&S) but this sounds plausible.  So what is the relation between this and the mpfr versions?

there are some references on http://mathworld.wolfram.com/LogGammaFunction.html

Paul



---

archive/issue_comments_140830.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThank you. I suspected there might be a problem like this. I think maybe using MPFR for positive reals (since it's faster) and mpmath for negative reals might be best.",
    "created_at": "2013-06-20T16:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140830",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:13'>Comment 13:</a>
Thank you. I suspected there might be a problem like this. I think maybe using MPFR for positive reals (since it's faster) and mpmath for negative reals might be best.



---

archive/issue_comments_140831.json:
```json
{
    "body": "Attachment: **[trac_12521.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.patch.gz)**",
    "created_at": "2013-06-25T09:35:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140831",
    "user": "https://github.com/eviatarbach"
}
```

Attachment: **[trac_12521.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.patch.gz)**



---

archive/issue_events_156866.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-25T09:38:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156866"
}
```



---

archive/issue_comments_140832.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nPatch uploaded. It uses mpmath to evaluate `log_gamma` in certain circumstances, while the MPFR implementation is left intact for positive reals. It also removes the `lgamma` and `lngamma` functions which were deprecated four years ago with #6992.\n\nPatchbot apply trac_12521.2.patch",
    "created_at": "2013-06-25T09:38:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140832",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:14'>Comment 14:</a>
Patch uploaded. It uses mpmath to evaluate `log_gamma` in certain circumstances, while the MPFR implementation is left intact for positive reals. It also removes the `lgamma` and `lngamma` functions which were deprecated four years ago with #6992.

Patchbot apply trac_12521.2.patch



---

archive/issue_comments_140833.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,3 +23,5 @@\n mpc(real='1.5317138081950856', imag='-9.4247779607693793')\n ```\n Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n+\n+Apply: [attachment: trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)\n``````\n",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140833",
    "user": "https://github.com/burcin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,3 +23,5 @@
 mpc(real='1.5317138081950856', imag='-9.4247779607693793')
 ```
 Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...
+
+Apply: [attachment: trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)
``````




---

archive/issue_comments_140834.json:
```json
{
    "body": "Reviewer: **Burcin Erocal**",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140834",
    "user": "https://github.com/burcin"
}
```

Reviewer: **Burcin Erocal**



---

archive/issue_comments_140835.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nAttachment: **[trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)**\n\nThe patchbot complains about old style doctest continuation.\n\nSince you need to edit the patch anyway... In the `py_lgamma` function from `pynac.pyx`, you don't need to import `call` from `mpmath` or `parent` from `sage.structure.coerce`. These are already available as `mpmath_utils.call` and `parent_c`.\n\nThanks for the patch! Great work noticing that we don't actually compute the principal branch.",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140835",
    "user": "https://github.com/burcin"
}
```

<a id='comment:15'>Comment 15:</a>
Attachment: **[trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)**

The patchbot complains about old style doctest continuation.

Since you need to edit the patch anyway... In the `py_lgamma` function from `pynac.pyx`, you don't need to import `call` from `mpmath` or `parent` from `sage.structure.coerce`. These are already available as `mpmath_utils.call` and `parent_c`.

Thanks for the patch! Great work noticing that we don't actually compute the principal branch.



---

archive/issue_events_156867.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-27T16:55:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156867"
}
```



---

archive/issue_events_156868.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-06-27T16:55:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156868"
}
```



---

archive/issue_comments_140836.json:
```json
{
    "body": "Author: **Eviatar Bach**",
    "created_at": "2013-06-27T16:55:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140836",
    "user": "https://github.com/burcin"
}
```

Author: **Eviatar Bach**



---

archive/issue_events_156869.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-27T20:33:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156869"
}
```



---

archive/issue_events_156870.json:
```json
{
    "actor": "https://github.com/eviatarbach",
    "created_at": "2013-06-27T20:33:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156870"
}
```



---

archive/issue_comments_140837.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThanks!\n\nI had already fixed the doctest continuation and overwrote the previous patch, but the patchbot didn't test it again.\n\nI fixed the import issue. I also noticed that the results for Python `float` and `complex` were inconsistent, so I fixed that and added some tests.\n\nPatchbot apply trac_12521_3.patch",
    "created_at": "2013-06-27T20:33:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140837",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:16'>Comment 16:</a>
Thanks!

I had already fixed the doctest continuation and overwrote the previous patch, but the patchbot didn't test it again.

I fixed the import issue. I also noticed that the results for Python `float` and `complex` were inconsistent, so I fixed that and added some tests.

Patchbot apply trac_12521_3.patch



---

archive/issue_comments_140838.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,4 +24,4 @@\n ```\n Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n \n-Apply: [attachment: trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)\n+Apply: [attachment: trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)\n``````\n",
    "created_at": "2013-06-28T20:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140838",
    "user": "https://github.com/eviatarbach"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,4 +24,4 @@
 ```
 Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...
 
-Apply: [attachment: trac_12521.2.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521.2.patch.gz)
+Apply: [attachment: trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)
``````




---

archive/issue_comments_140839.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nAttachment: **[trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)**\n\nWhy is the patchbot trying to apply the last two patches instead of just trac_12521_3.patch?",
    "created_at": "2013-06-28T20:30:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140839",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:17'>Comment 17:</a>
Attachment: **[trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)**

Why is the patchbot trying to apply the last two patches instead of just trac_12521_3.patch?



---

archive/issue_comments_140840.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nLet's try again:\n\nPatchbot apply trac_12521_3.patch",
    "created_at": "2013-07-16T05:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140840",
    "user": "https://github.com/eviatarbach"
}
```

<a id='comment:18'>Comment 18:</a>
Let's try again:

Patchbot apply trac_12521_3.patch



---

archive/issue_events_156871.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156871"
}
```



---

archive/issue_events_156872.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156872"
}
```



---

archive/issue_comments_140841.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nI am against removing the `lngamma()` method and against the deprecation from #6992 for PARI. Inside PARI/GP, the name is `lngamma()` and that name should be available to Sage too.",
    "created_at": "2013-10-29T08:08:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140841",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'>Comment 20:</a>
I am against removing the `lngamma()` method and against the deprecation from #6992 for PARI. Inside PARI/GP, the name is `lngamma()` and that name should be available to Sage too.



---

archive/issue_events_156873.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-29T08:31:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156873"
}
```



---

archive/issue_events_156874.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-10-29T08:31:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156874"
}
```



---

archive/issue_comments_140842.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nAlso, it seems the algorithm for complex numbers is much faster than for real numbers, so we should probably use the complex algorithm for all inputs:\n\n```\nsage: a=RealField(53)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 118 \u00b5s per loop\nsage: a=ComplexField(53)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 112 \u00b5s per loop\n```\n\n```\nsage: a=RealField(10**4)(2.5); timeit('log_gamma(a)')\n5 loops, best of 3: 506 ms per loop\nsage: a=ComplexField(10**4)(2.5); timeit('log_gamma(a)')\n625 loops, best of 3: 782 \u00b5s per loop\n```",
    "created_at": "2013-10-29T08:31:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140842",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'>Comment 21:</a>
Also, it seems the algorithm for complex numbers is much faster than for real numbers, so we should probably use the complex algorithm for all inputs:

```
sage: a=RealField(53)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 118 µs per loop
sage: a=ComplexField(53)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 112 µs per loop
```

```
sage: a=RealField(10**4)(2.5); timeit('log_gamma(a)')
5 loops, best of 3: 506 ms per loop
sage: a=ComplexField(10**4)(2.5); timeit('log_gamma(a)')
625 loops, best of 3: 782 µs per loop
```



---

archive/issue_events_156875.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156875"
}
```



---

archive/issue_events_156876.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156876"
}
```



---

archive/issue_comments_140843.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI am reverting the deprecation of `lngamma()` for PARI in #15767 (see comment [comment:20])",
    "created_at": "2014-02-09T16:27:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140843",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
I am reverting the deprecation of `lngamma()` for PARI in #15767 (see comment [comment:20])



---

archive/issue_events_156877.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156877"
}
```



---

archive/issue_events_156878.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156878"
}
```



---

archive/issue_events_156879.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156879"
}
```



---

archive/issue_events_156880.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156880"
}
```



---

archive/issue_comments_140844.json:
```json
{
    "body": "Branch: **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)**",
    "created_at": "2014-08-11T07:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140844",
    "user": "https://github.com/rwst"
}
```

Branch: **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)**



---

archive/issue_comments_140845.json:
```json
{
    "body": "Work Issues: **speedup**",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140845",
    "user": "https://github.com/rwst"
}
```

Work Issues: **speedup**



---

archive/issue_comments_140846.json:
```json
{
    "body": "Changed reviewer from **Burcin Erocal** to **Burcin Erocal, Ralf Stephan**",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140846",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Burcin Erocal** to **Burcin Erocal, Ralf Stephan**



---

archive/issue_comments_140847.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nTests are good in `functions`, `rings`, `symbolic`. The speed issue in [comment:21](#comment%3A21) still remains.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4b611dedda2b87dbb690647d3de0e735fea2b3b\">f4b611d</a></td><td><code>12521: fixing numerical evaluation of log_gamma</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b\">d7731cb</a></td><td><code>12521: reviewer missed a part of the patch</code></td></tr></table>\n",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140847",
    "user": "https://github.com/rwst"
}
```

<a id='comment:27'>Comment 27:</a>
Tests are good in `functions`, `rings`, `symbolic`. The speed issue in [comment:21](#comment%3A21) still remains.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4b611dedda2b87dbb690647d3de0e735fea2b3b">f4b611d</a></td><td><code>12521: fixing numerical evaluation of log_gamma</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b">d7731cb</a></td><td><code>12521: reviewer missed a part of the patch</code></td></tr></table>




---

archive/issue_comments_140848.json:
```json
{
    "body": "Commit: **[d7731cb](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)**",
    "created_at": "2014-08-11T07:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140848",
    "user": "https://github.com/rwst"
}
```

Commit: **[d7731cb](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)**



---

archive/issue_comments_140849.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767\">bacd234</a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr></table>\n",
    "created_at": "2014-09-03T08:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140849",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>Comment 28:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767">bacd234</a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr></table>




---

archive/issue_comments_140850.json:
```json
{
    "body": "Changed commit from **[d7731cb](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)** to **[bacd234](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)**",
    "created_at": "2014-09-03T08:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140850",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d7731cb](https://github.com/sagemath/sagetrac-mirror/commit/d7731cb41c4b5c555e553996d132c725e73a3c5b)** to **[bacd234](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)**



---

archive/issue_comments_140851.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nHas anyone checked the *mathematics* of this recently?  Eviatar usually does a very good job on this stuff, but unfortunately Burcin didn't make it clear whether the rest was approved of other than the different imports.",
    "created_at": "2014-09-03T12:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140851",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:29'>Comment 29:</a>
Has anyone checked the *mathematics* of this recently?  Eviatar usually does a very good job on this stuff, but unfortunately Burcin didn't make it clear whether the rest was approved of other than the different imports.



---

archive/issue_comments_140852.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -25,3 +25,15 @@\n Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...\n \n Apply: [attachment: trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)\n+\n+There is now also the arb option:\n+\n+```\n+sage: x=ComplexBallField(53)(-2.1)\n+sage: %timeit _ = x.log_gamma()\n+The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.\n+100000 loops, best of 3: 8.15 \u00b5s per loop\n+sage: x.log_gamma()\n+[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I\n+```\n+\n``````\n",
    "created_at": "2016-06-14T12:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140852",
    "user": "https://github.com/rwst"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -25,3 +25,15 @@
 Putting as defect because there is a log gamma for negative numbers, though we should talk about branches...
 
 Apply: [attachment: trac_12521_3.patch.gz](https://github.com/sagemath/sage/files/ticket12521/trac_12521_3.patch.gz)
+
+There is now also the arb option:
+
+```
+sage: x=ComplexBallField(53)(-2.1)
+sage: %timeit _ = x.log_gamma()
+The slowest run took 8.11 times longer than the fastest. This could mean that an intermediate result is being cached.
+100000 loops, best of 3: 8.15 µs per loop
+sage: x.log_gamma()
+[1.53171380819509 +/- 5.52e-15] + [-9.42477796076938 +/- 2.48e-15]*I
+```
+
``````




---

archive/issue_comments_140853.json:
```json
{
    "body": "<a id='comment:32'>Comment 32:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5021044cc10f728a1f85d615925c9ab77f42c1c\">d502104</a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62\">c11c3ef</a></td><td><code>12521: simplifcations, doctest fixes</code></td></tr></table>\n",
    "created_at": "2016-06-15T07:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140853",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:32'>Comment 32:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5021044cc10f728a1f85d615925c9ab77f42c1c">d502104</a></td><td><code>Merge branch 'develop' into t/12521/evaluate_log_gamma_for_complex_input</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62">c11c3ef</a></td><td><code>12521: simplifcations, doctest fixes</code></td></tr></table>




---

archive/issue_comments_140854.json:
```json
{
    "body": "Changed commit from **[bacd234](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)** to **[c11c3ef](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**",
    "created_at": "2016-06-15T07:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140854",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[bacd234](https://github.com/sagemath/sagetrac-mirror/commit/bacd2349b07fd6296737d56b6f430c08fe28c767)** to **[c11c3ef](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**



---

archive/issue_comments_140855.json:
```json
{
    "body": "Changed author from **Eviatar Bach** to **Eviatar Bach, Ralf Stephan**",
    "created_at": "2016-06-15T07:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140855",
    "user": "https://github.com/rwst"
}
```

Changed author from **Eviatar Bach** to **Eviatar Bach, Ralf Stephan**



---

archive/issue_comments_140856.json:
```json
{
    "body": "Changed work issues from **speedup** to none",
    "created_at": "2016-06-15T07:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140856",
    "user": "https://github.com/rwst"
}
```

Changed work issues from **speedup** to none



---

archive/issue_events_156881.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156881"
}
```



---

archive/issue_events_156882.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156882"
}
```



---

archive/issue_events_156883.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156883"
}
```



---

archive/issue_events_156884.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-06-15T07:30:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156884"
}
```



---

archive/issue_comments_140857.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nWith these changes the beta() function is still producing small imaginary parts around poles and not returning the appropriate signed Infinity at the poles. Presumably that should be on another ticket.\n\nOtherwise looks fine to me.",
    "created_at": "2016-06-22T19:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140857",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:34'>Comment 34:</a>
With these changes the beta() function is still producing small imaginary parts around poles and not returning the appropriate signed Infinity at the poles. Presumably that should be on another ticket.

Otherwise looks fine to me.



---

archive/issue_events_156885.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-06-22T19:38:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156885"
}
```



---

archive/issue_events_156886.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2016-06-22T19:38:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156886"
}
```



---

archive/issue_comments_140858.json:
```json
{
    "body": "Changed branch from **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)** to **[c11c3ef](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**",
    "created_at": "2016-06-24T07:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12521#issuecomment-140858",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/rws/evaluate_log_gamma_for_complex_input](https://github.com/sagemath/sagetrac-mirror/tree/u/rws/evaluate_log_gamma_for_complex_input)** to **[c11c3ef](https://github.com/sagemath/sagetrac-mirror/commit/c11c3efddd8c6ae02df3fcf421616d5c665a0a62)**



---

archive/issue_events_156887.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-06-24T07:26:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156887"
}
```



---

archive/issue_events_156888.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d3522256eb24bae2d3e83f03bada46a7e4f3a15d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-06-24T07:26:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12521",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12521#event-156888"
}
```
