# Issue 12371: The graph_decompositions/ code seems to have bounds issues

archive/issues_012199.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nThat makes the code non-portable ; the patch I provide adds either signed or unsigned in each place, which makes the ARM platform pass the tests happily.\n\nNotice that it does fix the current problem but there are still two problems with the code:\n1. in vertex_separation.pyx, we still have \"minimums[i] = n\" which is an unsigned char getting an unsigned int ;\n2. in vertex_separation.pyx, we still have \"tmp_count = <unsigned char> popcount(i)\", where popcount returns an \"int\".\n\nAPPLY:\n* [attachment:trac_12371.patch]\n* [attachment:trac_popcount.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/12371\n\n",
    "closed_at": "2012-03-28T10:04:48Z",
    "created_at": "2012-01-27T17:02:44Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "The graph_decompositions/ code seems to have bounds issues",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12371",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
Assignee: jason, ncohen, rlm

That makes the code non-portable ; the patch I provide adds either signed or unsigned in each place, which makes the ARM platform pass the tests happily.

Notice that it does fix the current problem but there are still two problems with the code:
1. in vertex_separation.pyx, we still have "minimums[i] = n" which is an unsigned char getting an unsigned int ;
2. in vertex_separation.pyx, we still have "tmp_count = <unsigned char> popcount(i)", where popcount returns an "int".

APPLY:
* [attachment:trac_12371.patch]
* [attachment:trac_popcount.patch]

Issue created by migration from https://trac.sagemath.org/ticket/12371





---

archive/issue_comments_142117.json:
```json
{
    "body": "Attachment [graph_decompositions_char.patch](tarball://root/attachments/some-uuid/ticket12371/graph_decompositions_char.patch) by Snark created at 2012-01-27 17:03:11\n\nPatch to fix the unsigned/signed char issue",
    "created_at": "2012-01-27T17:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142117",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Attachment [graph_decompositions_char.patch](tarball://root/attachments/some-uuid/ticket12371/graph_decompositions_char.patch) by Snark created at 2012-01-27 17:03:11

Patch to fix the unsigned/signed char issue



---

archive/issue_comments_142118.json:
```json
{
    "body": "Now that I think of it, this \"int\" is the size of the graph, and assumed to be small, so perhaps that should be an \"unsigned char\" too?",
    "created_at": "2012-01-27T17:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142118",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Now that I think of it, this "int" is the size of the graph, and assumed to be small, so perhaps that should be an "unsigned char" too?



---

archive/issue_comments_142119.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-01-27T17:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142119",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142120.json:
```json
{
    "body": "Helloooo !!!\n\nActually, what Volker said on [1] makes sense. What about using u_int8_t and int8_t as data types ? It would also be visually shorter and make the code much more readable `O_o`\n\n[1] https://groups.google.com/d/msg/sage-devel/2HwMYI1CY98/QNWOwanWp4kJ",
    "created_at": "2012-01-28T13:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142120",
    "user": "https://github.com/nathanncohen"
}
```

Helloooo !!!

Actually, what Volker said on [1] makes sense. What about using u_int8_t and int8_t as data types ? It would also be visually shorter and make the code much more readable `O_o`

[1] https://groups.google.com/d/msg/sage-devel/2HwMYI1CY98/QNWOwanWp4kJ



---

archive/issue_comments_142121.json:
```json
{
    "body": "1. I think the standard names for the types are uint8_t and int8_t, and are found in stdint.h.\n   2. The purpose of that ticket is the char issue, so I would rather see another ticket on changing the implementation to use (u)int8_t.",
    "created_at": "2012-01-28T14:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142121",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

1. I think the standard names for the types are uint8_t and int8_t, and are found in stdint.h.
   2. The purpose of that ticket is the char issue, so I would rather see another ticket on changing the implementation to use (u)int8_t.



---

archive/issue_comments_142122.json:
```json
{
    "body": "Let's no create ten patches to address the same changes. I will write the patch in a couple hours if it is ok with you.\n\nNathann",
    "created_at": "2012-01-28T15:03:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142122",
    "user": "https://github.com/nathanncohen"
}
```

Let's no create ten patches to address the same changes. I will write the patch in a couple hours if it is ok with you.

Nathann



---

archive/issue_comments_142123.json:
```json
{
    "body": "It's ok for me ; if you have something to test, I'll give it a try on my ARM box too.",
    "created_at": "2012-01-28T15:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142123",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

It's ok for me ; if you have something to test, I'll give it a try on my ARM box too.



---

archive/issue_comments_142124.json:
```json
{
    "body": "Hellooooooo !!\n\nHere is a patch that does the same, but with the correct types `:-)`\n\nNathann",
    "created_at": "2012-01-28T21:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142124",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooo !!

Here is a patch that does the same, but with the correct types `:-)`

Nathann



---

archive/issue_comments_142125.json:
```json
{
    "body": "Attachment [trac_12371.patch](tarball://root/attachments/some-uuid/ticket12371/trac_12371.patch) by Snark created at 2012-01-29 11:39:44\n\nEh, this patch is basically mine with s/unsigned char/uint8_t/g and s/signed char/int8_t/g, so it's no surprise it passes the tests.\n\nBut it also means it has all the problems of the original code, plus the ones of my patch.\n\nWhen I read the patched code, I see the following (potential or real) problems :\n1. there are loops on \"int\" counters from 0 to a cardinal (they should be the same type as the cardinal);\n2. the implementation of pop_count uses magical values which seem to assume a definite sizeof(int);\n3. there are \"int\" which are in fact bit arrays ; it should probably be \"unsigned int\" ;\n4. there are arrays which are indexed by above, so I'm not sure there is no risk there (though there is a test to bail out in case of problems, 8*sizeof(int)).\n\nIf I remember well, the current doctests just use graphs of cardinal up to 8, so we can only detect signed/unsigned issues, but not other ones.\n\nI'll try to work on a bigger patch ; I'm updating the summary of that ticket to reflect that much more ambitious scope.",
    "created_at": "2012-01-29T11:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142125",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Attachment [trac_12371.patch](tarball://root/attachments/some-uuid/ticket12371/trac_12371.patch) by Snark created at 2012-01-29 11:39:44

Eh, this patch is basically mine with s/unsigned char/uint8_t/g and s/signed char/int8_t/g, so it's no surprise it passes the tests.

But it also means it has all the problems of the original code, plus the ones of my patch.

When I read the patched code, I see the following (potential or real) problems :
1. there are loops on "int" counters from 0 to a cardinal (they should be the same type as the cardinal);
2. the implementation of pop_count uses magical values which seem to assume a definite sizeof(int);
3. there are "int" which are in fact bit arrays ; it should probably be "unsigned int" ;
4. there are arrays which are indexed by above, so I'm not sure there is no risk there (though there is a test to bail out in case of problems, 8*sizeof(int)).

If I remember well, the current doctests just use graphs of cardinal up to 8, so we can only detect signed/unsigned issues, but not other ones.

I'll try to work on a bigger patch ; I'm updating the summary of that ticket to reflect that much more ambitious scope.



---

archive/issue_comments_142126.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-01-29T11:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142126",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_142127.json:
```json
{
    "body": "Patch to change the types in the graph_decompositions/ code",
    "created_at": "2012-01-29T11:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142127",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Patch to change the types in the graph_decompositions/ code



---

archive/issue_comments_142128.json:
```json
{
    "body": "Attachment [graph_decompositions_typings.patch](tarball://root/attachments/some-uuid/ticket12371/graph_decompositions_typings.patch) by @nathanncohen created at 2012-01-29 11:52:55\n\nDon't you think it is going a bit too far ? You are refusing to compare unsigned char with integers, for some reason bit arrays \"should be\" unsigned int and not \"int\"...\n\nAnd even if the ansers of some methods do not require more than 8 bits that is no reason why we should force the user to deal with int8_t instead of regular integers...\n\nI agree that the argument of popcount should be redefined to int32_t though.\n\nNathann",
    "created_at": "2012-01-29T11:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142128",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [graph_decompositions_typings.patch](tarball://root/attachments/some-uuid/ticket12371/graph_decompositions_typings.patch) by @nathanncohen created at 2012-01-29 11:52:55

Don't you think it is going a bit too far ? You are refusing to compare unsigned char with integers, for some reason bit arrays "should be" unsigned int and not "int"...

And even if the ansers of some methods do not require more than 8 bits that is no reason why we should force the user to deal with int8_t instead of regular integers...

I agree that the argument of popcount should be redefined to int32_t though.

Nathann



---

archive/issue_comments_142129.json:
```json
{
    "body": "Well, you seemed eager to use \"correct types\", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)\n\nAnd for bit arrays, I didn't write they \"should be\" but \"should probably be\", which is even weaker: I'm not convinced.\n\nWhatever gets applied, as long as it works, is ok for me.\n\n(PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)",
    "created_at": "2012-01-29T12:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142129",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Well, you seemed eager to use "correct types", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)

And for bit arrays, I didn't write they "should be" but "should probably be", which is even weaker: I'm not convinced.

Whatever gets applied, as long as it works, is ok for me.

(PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)



---

archive/issue_comments_142130.json:
```json
{
    "body": "> Well, you seemed eager to use \"correct types\", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)\n\n\nWell, the thing with \"char\" is that it has a \"meaning\", it represents characters, and that's why there is a difference on your architecture. What I mean by using char is actually \"a 8-bits integer\", which can be unsigned at times. But what is the point of saving 3 bytes on an integer counter ?\n\n> Whatever gets applied, as long as it works, is ok for me.\n\n+1\n\n> (PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)\n\nWell, I said it would make sense to move its argument to int32_t. Isn't that what you meant ?\n\nNathann",
    "created_at": "2012-01-29T12:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142130",
    "user": "https://github.com/nathanncohen"
}
```

> Well, you seemed eager to use "correct types", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)


Well, the thing with "char" is that it has a "meaning", it represents characters, and that's why there is a difference on your architecture. What I mean by using char is actually "a 8-bits integer", which can be unsigned at times. But what is the point of saving 3 bytes on an integer counter ?

> Whatever gets applied, as long as it works, is ok for me.

+1

> (PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)

Well, I said it would make sense to move its argument to int32_t. Isn't that what you meant ?

Nathann



---

archive/issue_comments_142131.json:
```json
{
    "body": "Well, if int32_t is used for popcount, we'd better be sure \"int\" doesn't have more bits than that, because that's what is used elsewhere, and especially the whole code is guarded against 8*sizeof(int), not againt 32.",
    "created_at": "2012-01-29T13:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142131",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Well, if int32_t is used for popcount, we'd better be sure "int" doesn't have more bits than that, because that's what is used elsewhere, and especially the whole code is guarded against 8*sizeof(int), not againt 32.



---

archive/issue_comments_142132.json:
```json
{
    "body": "Hmmmm... You are right ! But then it makes much more sense to adapt popcount than to adapt all code to popcount.\n\nI'll give this a look, it is also used in the bitset code.\n\nNathann",
    "created_at": "2012-01-29T13:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142132",
    "user": "https://github.com/nathanncohen"
}
```

Hmmmm... You are right ! But then it makes much more sense to adapt popcount than to adapt all code to popcount.

I'll give this a look, it is also used in the bitset code.

Nathann



---

archive/issue_comments_142133.json:
```json
{
    "body": "Ahahah. Turns out the stupid way is also the best. It looks like there is no preprocessor way to check the integer size, but as we compile with O3 gcc does the job anyway and removes the condition itself `:-)`\n\nAnd I finally did not touch the bitset code, as they deal with long type.\n\nNathann",
    "created_at": "2012-01-29T13:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142133",
    "user": "https://github.com/nathanncohen"
}
```

Ahahah. Turns out the stupid way is also the best. It looks like there is no preprocessor way to check the integer size, but as we compile with O3 gcc does the job anyway and removes the condition itself `:-)`

And I finally did not touch the bitset code, as they deal with long type.

Nathann



---

archive/issue_comments_142134.json:
```json
{
    "body": "Nathann, what is the status of this ticket?",
    "created_at": "2012-02-26T07:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142134",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Nathann, what is the status of this ticket?



---

archive/issue_comments_142135.json:
```json
{
    "body": "Hellooooo !!\n\n> Nathann, what is the status of this ticket?\n\n\nWell.... You sent a patch while setting the ticket to \"needs_work\", so you tell me `^^;`\n\nI tried to answer the points you made in your 4 items list. I think (a very personal advice) that points 1, 3 and 4 have more to do with theology than with programming (there is nothing that makes me worry in any of them, except that any patch fixing them would made the way harder to read) and the remark you made in 2 is right for me, and can be fixed with the trick I gave two comments above. That is : it can be fixed the stupid way with a if(sizeof(int) == 4), at no cost in efficiency as this kind of things is solver at compilation time) `:-)`\n\nNathann",
    "created_at": "2012-02-26T08:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142135",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooo !!

> Nathann, what is the status of this ticket?


Well.... You sent a patch while setting the ticket to "needs_work", so you tell me `^^;`

I tried to answer the points you made in your 4 items list. I think (a very personal advice) that points 1, 3 and 4 have more to do with theology than with programming (there is nothing that makes me worry in any of them, except that any patch fixing them would made the way harder to read) and the remark you made in 2 is right for me, and can be fixed with the trick I gave two comments above. That is : it can be fixed the stupid way with a if(sizeof(int) == 4), at no cost in efficiency as this kind of things is solver at compilation time) `:-)`

Nathann



---

archive/issue_comments_142136.json:
```json
{
    "body": "Both your patches look good, and I would gladly see them go in :-)",
    "created_at": "2012-02-26T09:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142136",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Both your patches look good, and I would gladly see them go in :-)



---

archive/issue_comments_142137.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-26T09:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142137",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_142138.json:
```json
{
    "body": "> Both your patches look good, and I would gladly see them go in :-)\n\n\nOh. Then if you think those ones should go, then all that is left to do is to review them `:-)`\n\nAnd the \"is solver\" in my previous message was a \"is solved\", naturally `:-p`\n\nNathann",
    "created_at": "2012-02-26T09:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142138",
    "user": "https://github.com/nathanncohen"
}
```

> Both your patches look good, and I would gladly see them go in :-)


Oh. Then if you think those ones should go, then all that is left to do is to review them `:-)`

And the "is solver" in my previous message was a "is solved", naturally `:-p`

Nathann



---

archive/issue_comments_142139.json:
```json
{
    "body": "Apply trac_12371.patch, trac_popcount.patch\n\n(for the patchbot, which is trying to apply all four patches at once)",
    "created_at": "2012-03-11T11:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142139",
    "user": "https://github.com/loefflerd"
}
```

Apply trac_12371.patch, trac_popcount.patch

(for the patchbot, which is trying to apply all four patches at once)



---

archive/issue_comments_142140.json:
```json
{
    "body": "Ping ? This ticket still needs a review `:-)`\n\nNathann",
    "created_at": "2012-03-25T08:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142140",
    "user": "https://github.com/nathanncohen"
}
```

Ping ? This ticket still needs a review `:-)`

Nathann



---

archive/issue_comments_142141.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-25T08:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142141",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142142.json:
```json
{
    "body": "Well, I said 'yes' four weeks ago, so I guess I should put \"positive review\".\n\nI thought telling \"ok\" to the code maintainer was good enough...",
    "created_at": "2012-03-25T08:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142142",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Well, I said 'yes' four weeks ago, so I guess I should put "positive review".

I thought telling "ok" to the code maintainer was good enough...



---

archive/issue_comments_142143.json:
```json
{
    "body": "> Well, I said 'yes' four weeks ago, so I guess I should put \"positive review\".\n> \n> I thought telling \"ok\" to the code maintainer was good enough...\n\n\noops, sorry `:-)`\n\nand thank you for the review !\n\nNathann",
    "created_at": "2012-03-25T08:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142143",
    "user": "https://github.com/nathanncohen"
}
```

> Well, I said 'yes' four weeks ago, so I guess I should put "positive review".
> 
> I thought telling "ok" to the code maintainer was good enough...


oops, sorry `:-)`

and thank you for the review !

Nathann



---

archive/issue_comments_142144.json:
```json
{
    "body": "1) This isn't a proper commit message for the reviewer patch:\n\n```\n[mq]: ffff\n```\n\n2) Could you please explain the logic behind the reviewer patch?  It seems to me like you're potentially changing the behaviour, and it's not clear to me why.  The ticket description isn't clear on this either.",
    "created_at": "2012-03-26T06:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142144",
    "user": "https://github.com/jdemeyer"
}
```

1) This isn't a proper commit message for the reviewer patch:

```
[mq]: ffff
```

2) Could you please explain the logic behind the reviewer patch?  It seems to me like you're potentially changing the behaviour, and it's not clear to me why.  The ticket description isn't clear on this either.



---

archive/issue_comments_142145.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2012-03-26T06:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142145",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_142146.json:
```json
{
    "body": "Hellooo Jeroen !!\n\nSorry about that patch, the commit message is now updated !\n\nI do not get your second question, though.... The popcount function as it is implemented is made for 32 bits integers, and I thought it was better to write a popcount function for \"int\" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result, which has 0 cost as these things are simplified by the compiler anyway. When do you think the behaviour may change ?\n\nNathann",
    "created_at": "2012-03-26T08:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142146",
    "user": "https://github.com/nathanncohen"
}
```

Hellooo Jeroen !!

Sorry about that patch, the commit message is now updated !

I do not get your second question, though.... The popcount function as it is implemented is made for 32 bits integers, and I thought it was better to write a popcount function for "int" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result, which has 0 cost as these things are simplified by the compiler anyway. When do you think the behaviour may change ?

Nathann



---

archive/issue_comments_142147.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-03-26T08:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142147",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_142148.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-26T08:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142148",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_142149.json:
```json
{
    "body": "(so that Jeroen sees it)",
    "created_at": "2012-03-26T08:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142149",
    "user": "https://github.com/nathanncohen"
}
```

(so that Jeroen sees it)



---

archive/issue_comments_142150.json:
```json
{
    "body": "Replying to [comment:23 ncohen]:\n> The popcount function as it is implemented is made for 32 bits integers\n\nThat's not clear from looking at the code.\n\n> and I thought it was better to write a popcount function for \"int\" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result.\n\nThat's my question: why do the test?  Why not just do\n\n```\ncdef inline int popcount(int i): \n    return __builtin_popcount(i) \n```\n\nAlso: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.",
    "created_at": "2012-03-26T08:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142150",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 ncohen]:
> The popcount function as it is implemented is made for 32 bits integers

That's not clear from looking at the code.

> and I thought it was better to write a popcount function for "int" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result.

That's my question: why do the test?  Why not just do

```
cdef inline int popcount(int i): 
    return __builtin_popcount(i) 
```

Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.



---

archive/issue_comments_142151.json:
```json
{
    "body": "Attachment [trac_popcount.patch](tarball://root/attachments/some-uuid/ticket12371/trac_popcount.patch) by @nathanncohen created at 2012-03-26 11:48:37",
    "created_at": "2012-03-26T11:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142151",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_popcount.patch](tarball://root/attachments/some-uuid/ticket12371/trac_popcount.patch) by @nathanncohen created at 2012-03-26 11:48:37



---

archive/issue_comments_142152.json:
```json
{
    "body": "Helloooo Jeroen !!!\n\n> That's not clear from looking at the code.\n\n\nIt is clearer now. The function is renamed to popcount32 and I added a short docstring.\n\n> That's my question: why do the test?  Why not just do\n> \n> ```\n> cdef inline int popcount(int i): \n>     return __builtin_popcount(i) \n> ```\n\n\nOh. Because this code is much faster.\n \n> Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.\n\n\nArggggg ! `O_O;;;`\n\nWell... I uploaded a new patch but I would like to have your advice on that. I added a new function whose purpose is only to test popcount32, but the test is *LONG* (around 5 minutes) so I flagged it with \"not tested\". I thought it was too long even for a \"long\" flag. It tries \"all 32bits integers\" and computes popcount in two different ways, to check for correction. Considering how this 3-lines function is written I do not expect it to cause problem on a different architecture (as long as we are dealing with >=32bits integers... There is no 16bits left, right ? `O_o;;;`).\n\nNathann",
    "created_at": "2012-03-26T11:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142152",
    "user": "https://github.com/nathanncohen"
}
```

Helloooo Jeroen !!!

> That's not clear from looking at the code.


It is clearer now. The function is renamed to popcount32 and I added a short docstring.

> That's my question: why do the test?  Why not just do
> 
> ```
> cdef inline int popcount(int i): 
>     return __builtin_popcount(i) 
> ```


Oh. Because this code is much faster.
 
> Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.


Arggggg ! `O_O;;;`

Well... I uploaded a new patch but I would like to have your advice on that. I added a new function whose purpose is only to test popcount32, but the test is *LONG* (around 5 minutes) so I flagged it with "not tested". I thought it was too long even for a "long" flag. It tries "all 32bits integers" and computes popcount in two different ways, to check for correction. Considering how this 3-lines function is written I do not expect it to cause problem on a different architecture (as long as we are dealing with >=32bits integers... There is no 16bits left, right ? `O_o;;;`).

Nathann



---

archive/issue_comments_142153.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2012-03-26T12:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142153",
    "user": "https://github.com/loefflerd"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_142154.json:
```json
{
    "body": "(the problem with needs_info is that Jeroen does not see it anymore ^^;)",
    "created_at": "2012-03-26T12:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142154",
    "user": "https://github.com/nathanncohen"
}
```

(the problem with needs_info is that Jeroen does not see it anymore ^^;)



---

archive/issue_comments_142155.json:
```json
{
    "body": "Replying to [comment:26 ncohen]:\n> Oh. Because this code is much faster.\n  \nReally?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.",
    "created_at": "2012-03-26T12:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142155",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:26 ncohen]:
> Oh. Because this code is much faster.
  
Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.



---

archive/issue_comments_142156.json:
```json
{
    "body": "> Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.\n\n\nWell, it is not like I have an explanation for that, it is too low-level for me. If I were to try to find an answer I would say that the function implemented is inline while builtin_popcount is necessarily a function to be called.\n\nOf course, nothing beats using __builtin_popcount with a popcount instruction enabled on the processor, as it is directly translated to a function call.\n\nOk, now I made these tests a long time ago and it is actually very easy to check. I will post that in a second.\n\nNathann",
    "created_at": "2012-03-26T12:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142156",
    "user": "https://github.com/nathanncohen"
}
```

> Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.


Well, it is not like I have an explanation for that, it is too low-level for me. If I were to try to find an answer I would say that the function implemented is inline while builtin_popcount is necessarily a function to be called.

Of course, nothing beats using __builtin_popcount with a popcount instruction enabled on the processor, as it is directly translated to a function call.

Ok, now I made these tests a long time ago and it is actually very easy to check. I will post that in a second.

Nathann



---

archive/issue_comments_142157.json:
```json
{
    "body": "Yooooooo !!!\n\nWell, I just did the tests, and you can find attached the patch I used to do that. I actually first did the tests by replacing \"return popcount32\" in the code by \"return \\_\\_builtin_popcount\", and there was no difference that I could see in the runtimes of path_decomposition. I was about to say \"ok you are right, there is no difference after all\", but short of my natural dislike of acknowledging my own mistakes, I was really convinced that there was a real diference between the two.\n\nAnd it turns out that if I did not see the difference anymore, it is because of some change I made late in the path_decomposition algorithm (a previous version was *MUCH* slower than the current one), and this popcount is not the critical function anymore.\nThe \"stupid test\" (try many integers, compute what's left afterwards) is clear enough though :\n\n```\nsage: from sage.graphs.graph_decompositions.vertex_separation import test_handmade, test_builtin\nsage: time test_builtin()                                                                       \n-805306368\nTime: CPU 5.94 s, Wall: 5.95 s\nsage: time test_handmade()                                                                      \n-805306368\nTime: CPU 1.85 s, Wall: 1.85 s\n```\n\nOf course, these tests are immediately destroyed if you are lucky enough to compile the code on a machine with the popcnt instruction enabled... But so far I found no way to do that in a way that would not make the code crash on a machine that does *not* have it enabled.\n\nNathann",
    "created_at": "2012-03-26T13:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142157",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooo !!!

Well, I just did the tests, and you can find attached the patch I used to do that. I actually first did the tests by replacing "return popcount32" in the code by "return \_\_builtin_popcount", and there was no difference that I could see in the runtimes of path_decomposition. I was about to say "ok you are right, there is no difference after all", but short of my natural dislike of acknowledging my own mistakes, I was really convinced that there was a real diference between the two.

And it turns out that if I did not see the difference anymore, it is because of some change I made late in the path_decomposition algorithm (a previous version was *MUCH* slower than the current one), and this popcount is not the critical function anymore.
The "stupid test" (try many integers, compute what's left afterwards) is clear enough though :

```
sage: from sage.graphs.graph_decompositions.vertex_separation import test_handmade, test_builtin
sage: time test_builtin()                                                                       
-805306368
Time: CPU 5.94 s, Wall: 5.95 s
sage: time test_handmade()                                                                      
-805306368
Time: CPU 1.85 s, Wall: 1.85 s
```

Of course, these tests are immediately destroyed if you are lucky enough to compile the code on a machine with the popcnt instruction enabled... But so far I found no way to do that in a way that would not make the code crash on a machine that does *not* have it enabled.

Nathann



---

archive/issue_comments_142158.json:
```json
{
    "body": "Attachment [test_popcount.patch](tarball://root/attachments/some-uuid/ticket12371/test_popcount.patch) by @nathanncohen created at 2012-03-26 13:03:13",
    "created_at": "2012-03-26T13:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142158",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [test_popcount.patch](tarball://root/attachments/some-uuid/ticket12371/test_popcount.patch) by @nathanncohen created at 2012-03-26 13:03:13



---

archive/issue_comments_142159.json:
```json
{
    "body": "I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of comment:32 are correct.",
    "created_at": "2012-03-26T20:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142159",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of comment:32 are correct.



---

archive/issue_comments_142160.json:
```json
{
    "body": "Replying to [comment:33 Snark]:\n> I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of comment:32 are correct.\n\nThen change it!",
    "created_at": "2012-03-26T21:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142160",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:33 Snark]:
> I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of comment:32 are correct.

Then change it!



---

archive/issue_comments_142161.json:
```json
{
    "body": "Positive review since the patch works.",
    "created_at": "2012-03-27T15:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142161",
    "user": "https://github.com/jdemeyer"
}
```

Positive review since the patch works.



---

archive/issue_comments_142162.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-03-27T15:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142162",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_142163.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-27T15:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142163",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_033153.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:04:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12371#event-33153"
}
```



---

archive/issue_comments_142164.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-28T10:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12371#issuecomment-142164",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
