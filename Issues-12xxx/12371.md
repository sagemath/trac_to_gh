# Issue 12371: The graph_decompositions/ code seems to have bounds issues

archive/issues_012199.json:
```json
{
    "assignees": [
        "https://github.com/jasongrout",
        "https://github.com/nathanncohen",
        "https://github.com/rlmill"
    ],
    "body": "That makes the code non-portable ; the patch I provide adds either signed or unsigned in each place, which makes the ARM platform pass the tests happily.\n\nNotice that it does fix the current problem but there are still two problems with the code:\n1. in vertex_separation.pyx, we still have \"minimums[i] = n\" which is an unsigned char getting an unsigned int ;\n2. in vertex_separation.pyx, we still have \"tmp_count = <unsigned char> popcount(i)\", where popcount returns an \"int\".\n\nAPPLY:\n* [attachment: trac_12371.patch](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)\n* [attachment: trac_popcount.patch](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)\n\nComponent: **graph theory**\n\nAuthor: **Julien Puydt**\n\nReviewer: **Nathann Cohen, Jeroen Demeyer**\n\nMerged: **sage-5.0.beta11**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12371_\n\n",
    "closed_at": "2012-03-28T10:04:48Z",
    "created_at": "2012-01-27T17:02:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "The graph_decompositions/ code seems to have bounds issues",
    "type": "issue",
    "updated_at": "2012-03-28T10:04:48Z",
    "url": "https://github.com/sagemath/sage/issues/12371",
    "user": "https://github.com/SnarkBoojum"
}
```
That makes the code non-portable ; the patch I provide adds either signed or unsigned in each place, which makes the ARM platform pass the tests happily.

Notice that it does fix the current problem but there are still two problems with the code:
1. in vertex_separation.pyx, we still have "minimums[i] = n" which is an unsigned char getting an unsigned int ;
2. in vertex_separation.pyx, we still have "tmp_count = <unsigned char> popcount(i)", where popcount returns an "int".

APPLY:
* [attachment: trac_12371.patch](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)
* [attachment: trac_popcount.patch](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)

Component: **graph theory**

Author: **Julien Puydt**

Reviewer: **Nathann Cohen, Jeroen Demeyer**

Merged: **sage-5.0.beta11**

_Issue created by migration from https://trac.sagemath.org/ticket/12371_





---

archive/issue_events_167121.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167121"
}
```



---

archive/issue_events_167122.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167122"
}
```



---

archive/issue_events_167123.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167123"
}
```



---

archive/issue_events_167124.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167124"
}
```



---

archive/issue_events_167125.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "subject": "https://github.com/SnarkBoojum",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167125"
}
```



---

archive/issue_events_167126.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "subject": "https://github.com/SnarkBoojum",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167126"
}
```



---

archive/issue_events_167127.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "subject": "https://github.com/SnarkBoojum",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167127"
}
```



---

archive/issue_comments_134954.json:
```json
{
    "body": "Attachment: **[graph_decompositions_char.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_char.patch.gz)**\n\nPatch to fix the unsigned/signed char issue",
    "created_at": "2012-01-27T17:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134954",
    "user": "https://github.com/SnarkBoojum"
}
```

Attachment: **[graph_decompositions_char.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_char.patch.gz)**

Patch to fix the unsigned/signed char issue



---

archive/issue_comments_134955.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNow that I think of it, this \"int\" is the size of the graph, and assumed to be small, so perhaps that should be an \"unsigned char\" too?",
    "created_at": "2012-01-27T17:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134955",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:1" align="right">comment:1</div>

Now that I think of it, this "int" is the size of the graph, and assumed to be small, so perhaps that should be an "unsigned char" too?



---

archive/issue_events_167128.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-27T17:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167128"
}
```



---

archive/issue_comments_134956.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHelloooo !!!\n\nActually, what Volker said on [1] makes sense. What about using u_int8_t and int8_t as data types ? It would also be visually shorter and make the code much more readable `O_o`\n\n[1] https://groups.google.com/d/msg/sage-devel/2HwMYI1CY98/QNWOwanWp4kJ",
    "created_at": "2012-01-28T13:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134956",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:2" align="right">comment:2</div>

Helloooo !!!

Actually, what Volker said on [1] makes sense. What about using u_int8_t and int8_t as data types ? It would also be visually shorter and make the code much more readable `O_o`

[1] https://groups.google.com/d/msg/sage-devel/2HwMYI1CY98/QNWOwanWp4kJ



---

archive/issue_comments_134957.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n1. I think the standard names for the types are uint8_t and int8_t, and are found in stdint.h.\n   2. The purpose of that ticket is the char issue, so I would rather see another ticket on changing the implementation to use (u)int8_t.",
    "created_at": "2012-01-28T14:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134957",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:3" align="right">comment:3</div>

1. I think the standard names for the types are uint8_t and int8_t, and are found in stdint.h.
   2. The purpose of that ticket is the char issue, so I would rather see another ticket on changing the implementation to use (u)int8_t.



---

archive/issue_comments_134958.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nLet's no create ten patches to address the same changes. I will write the patch in a couple hours if it is ok with you.\n\nNathann",
    "created_at": "2012-01-28T15:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134958",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:4" align="right">comment:4</div>

Let's no create ten patches to address the same changes. I will write the patch in a couple hours if it is ok with you.

Nathann



---

archive/issue_comments_134959.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nIt's ok for me ; if you have something to test, I'll give it a try on my ARM box too.",
    "created_at": "2012-01-28T15:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134959",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:5" align="right">comment:5</div>

It's ok for me ; if you have something to test, I'll give it a try on my ARM box too.



---

archive/issue_comments_134960.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHellooooooo !!\n\nHere is a patch that does the same, but with the correct types `:-)`\n\nNathann",
    "created_at": "2012-01-28T21:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134960",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:6" align="right">comment:6</div>

Hellooooooo !!

Here is a patch that does the same, but with the correct types `:-)`

Nathann



---

archive/issue_comments_134961.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAttachment: **[trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)**\n\nEh, this patch is basically mine with s/unsigned char/uint8_t/g and s/signed char/int8_t/g, so it's no surprise it passes the tests.\n\nBut it also means it has all the problems of the original code, plus the ones of my patch.\n\nWhen I read the patched code, I see the following (potential or real) problems :\n1. there are loops on \"int\" counters from 0 to a cardinal (they should be the same type as the cardinal);\n2. the implementation of pop_count uses magical values which seem to assume a definite sizeof(int);\n3. there are \"int\" which are in fact bit arrays ; it should probably be \"unsigned int\" ;\n4. there are arrays which are indexed by above, so I'm not sure there is no risk there (though there is a test to bail out in case of problems, 8*sizeof(int)).\n\nIf I remember well, the current doctests just use graphs of cardinal up to 8, so we can only detect signed/unsigned issues, but not other ones.\n\nI'll try to work on a bigger patch ; I'm updating the summary of that ticket to reflect that much more ambitious scope.",
    "created_at": "2012-01-29T11:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134961",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:7" align="right">comment:7</div>

Attachment: **[trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)**

Eh, this patch is basically mine with s/unsigned char/uint8_t/g and s/signed char/int8_t/g, so it's no surprise it passes the tests.

But it also means it has all the problems of the original code, plus the ones of my patch.

When I read the patched code, I see the following (potential or real) problems :
1. there are loops on "int" counters from 0 to a cardinal (they should be the same type as the cardinal);
2. the implementation of pop_count uses magical values which seem to assume a definite sizeof(int);
3. there are "int" which are in fact bit arrays ; it should probably be "unsigned int" ;
4. there are arrays which are indexed by above, so I'm not sure there is no risk there (though there is a test to bail out in case of problems, 8*sizeof(int)).

If I remember well, the current doctests just use graphs of cardinal up to 8, so we can only detect signed/unsigned issues, but not other ones.

I'll try to work on a bigger patch ; I'm updating the summary of that ticket to reflect that much more ambitious scope.



---

archive/issue_comments_134962.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2012-01-29T11:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134962",
    "user": "https://github.com/SnarkBoojum"
}
```

Description changed:
``````diff

``````




---

archive/issue_events_167129.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-29T11:39:44Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "title_is": "The graph_decompositions/ code seems to have bounds issues",
    "title_was": "The graph_decompositions/ code uses \"char\" without the unsigned/signed keyword",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167129"
}
```



---

archive/issue_events_167130.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-29T11:39:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167130"
}
```



---

archive/issue_events_167131.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-01-29T11:39:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167131"
}
```



---

archive/issue_comments_134963.json:
```json
{
    "body": "Patch to change the types in the graph_decompositions/ code",
    "created_at": "2012-01-29T11:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134963",
    "user": "https://github.com/SnarkBoojum"
}
```

Patch to change the types in the graph_decompositions/ code



---

archive/issue_comments_134964.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[graph_decompositions_typings.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_typings.patch.gz)**\n\nDon't you think it is going a bit too far ? You are refusing to compare unsigned char with integers, for some reason bit arrays \"should be\" unsigned int and not \"int\"...\n\nAnd even if the ansers of some methods do not require more than 8 bits that is no reason why we should force the user to deal with int8_t instead of regular integers...\n\nI agree that the argument of popcount should be redefined to int32_t though.\n\nNathann",
    "created_at": "2012-01-29T11:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134964",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[graph_decompositions_typings.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_typings.patch.gz)**

Don't you think it is going a bit too far ? You are refusing to compare unsigned char with integers, for some reason bit arrays "should be" unsigned int and not "int"...

And even if the ansers of some methods do not require more than 8 bits that is no reason why we should force the user to deal with int8_t instead of regular integers...

I agree that the argument of popcount should be redefined to int32_t though.

Nathann



---

archive/issue_comments_134965.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nWell, you seemed eager to use \"correct types\", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)\n\nAnd for bit arrays, I didn't write they \"should be\" but \"should probably be\", which is even weaker: I'm not convinced.\n\nWhatever gets applied, as long as it works, is ok for me.\n\n(PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)",
    "created_at": "2012-01-29T12:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134965",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:9" align="right">comment:9</div>

Well, you seemed eager to use "correct types", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)

And for bit arrays, I didn't write they "should be" but "should probably be", which is even weaker: I'm not convinced.

Whatever gets applied, as long as it works, is ok for me.

(PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)



---

archive/issue_comments_134966.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n> Well, you seemed eager to use \"correct types\", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)\n\nWell, the thing with \"char\" is that it has a \"meaning\", it represents characters, and that's why there is a difference on your architecture. What I mean by using char is actually \"a 8-bits integer\", which can be unsigned at times. But what is the point of saving 3 bytes on an integer counter ?\n\n> Whatever gets applied, as long as it works, is ok for me.\n\n+1\n\n> (PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)\n\nWell, I said it would make sense to move its argument to int32_t. Isn't that what you meant ?\n\nNathann",
    "created_at": "2012-01-29T12:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134966",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:10" align="right">comment:10</div>

> Well, you seemed eager to use "correct types", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)

Well, the thing with "char" is that it has a "meaning", it represents characters, and that's why there is a difference on your architecture. What I mean by using char is actually "a 8-bits integer", which can be unsigned at times. But what is the point of saving 3 bytes on an integer counter ?

> Whatever gets applied, as long as it works, is ok for me.

+1

> (PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)

Well, I said it would make sense to move its argument to int32_t. Isn't that what you meant ?

Nathann



---

archive/issue_comments_134967.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWell, if int32_t is used for popcount, we'd better be sure \"int\" doesn't have more bits than that, because that's what is used elsewhere, and especially the whole code is guarded against 8*sizeof(int), not againt 32.",
    "created_at": "2012-01-29T13:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134967",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:11" align="right">comment:11</div>

Well, if int32_t is used for popcount, we'd better be sure "int" doesn't have more bits than that, because that's what is used elsewhere, and especially the whole code is guarded against 8*sizeof(int), not againt 32.



---

archive/issue_comments_134968.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nHmmmm... You are right ! But then it makes much more sense to adapt popcount than to adapt all code to popcount.\n\nI'll give this a look, it is also used in the bitset code.\n\nNathann",
    "created_at": "2012-01-29T13:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134968",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:12" align="right">comment:12</div>

Hmmmm... You are right ! But then it makes much more sense to adapt popcount than to adapt all code to popcount.

I'll give this a look, it is also used in the bitset code.

Nathann



---

archive/issue_comments_134969.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAhahah. Turns out the stupid way is also the best. It looks like there is no preprocessor way to check the integer size, but as we compile with O3 gcc does the job anyway and removes the condition itself `:-)`\n\nAnd I finally did not touch the bitset code, as they deal with long type.\n\nNathann",
    "created_at": "2012-01-29T13:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134969",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:13" align="right">comment:13</div>

Ahahah. Turns out the stupid way is also the best. It looks like there is no preprocessor way to check the integer size, but as we compile with O3 gcc does the job anyway and removes the condition itself `:-)`

And I finally did not touch the bitset code, as they deal with long type.

Nathann



---

archive/issue_comments_134970.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNathann, what is the status of this ticket?",
    "created_at": "2012-02-26T07:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134970",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:14" align="right">comment:14</div>

Nathann, what is the status of this ticket?



---

archive/issue_comments_134971.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nHellooooo !!\n\n> Nathann, what is the status of this ticket?\n\nWell.... You sent a patch while setting the ticket to \"needs_work\", so you tell me `^^;`\n\nI tried to answer the points you made in your 4 items list. I think (a very personal advice) that points 1, 3 and 4 have more to do with theology than with programming (there is nothing that makes me worry in any of them, except that any patch fixing them would made the way harder to read) and the remark you made in 2 is right for me, and can be fixed with the trick I gave two comments above. That is : it can be fixed the stupid way with a if(sizeof(int) == 4), at no cost in efficiency as this kind of things is solver at compilation time) `:-)`\n\nNathann",
    "created_at": "2012-02-26T08:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134971",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:15" align="right">comment:15</div>

Hellooooo !!

> Nathann, what is the status of this ticket?

Well.... You sent a patch while setting the ticket to "needs_work", so you tell me `^^;`

I tried to answer the points you made in your 4 items list. I think (a very personal advice) that points 1, 3 and 4 have more to do with theology than with programming (there is nothing that makes me worry in any of them, except that any patch fixing them would made the way harder to read) and the remark you made in 2 is right for me, and can be fixed with the trick I gave two comments above. That is : it can be fixed the stupid way with a if(sizeof(int) == 4), at no cost in efficiency as this kind of things is solver at compilation time) `:-)`

Nathann



---

archive/issue_comments_134972.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nBoth your patches look good, and I would gladly see them go in :-)",
    "created_at": "2012-02-26T09:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134972",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:16" align="right">comment:16</div>

Both your patches look good, and I would gladly see them go in :-)



---

archive/issue_events_167132.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-02-26T09:46:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167132"
}
```



---

archive/issue_events_167133.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-02-26T09:46:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167133"
}
```



---

archive/issue_comments_134973.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n> Both your patches look good, and I would gladly see them go in :-)\n\nOh. Then if you think those ones should go, then all that is left to do is to review them `:-)`\n\nAnd the \"is solver\" in my previous message was a \"is solved\", naturally `:-p`\n\nNathann",
    "created_at": "2012-02-26T09:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134973",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:17" align="right">comment:17</div>

> Both your patches look good, and I would gladly see them go in :-)

Oh. Then if you think those ones should go, then all that is left to do is to review them `:-)`

And the "is solver" in my previous message was a "is solved", naturally `:-p`

Nathann



---

archive/issue_comments_134974.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,7 @@\n Notice that it does fix the current problem but there are still two problems with the code:\n 1. in vertex_separation.pyx, we still have \"minimums[i] = n\" which is an unsigned char getting an unsigned int ;\n 2. in vertex_separation.pyx, we still have \"tmp_count = <unsigned char> popcount(i)\", where popcount returns an \"int\".\n+\n+APPLY:\n+* [attachment: trac_12371.patch](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)\n+* [attachment: trac_popcount.patch](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)\n``````\n",
    "created_at": "2012-02-26T09:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134974",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,7 @@
 Notice that it does fix the current problem but there are still two problems with the code:
 1. in vertex_separation.pyx, we still have "minimums[i] = n" which is an unsigned char getting an unsigned int ;
 2. in vertex_separation.pyx, we still have "tmp_count = <unsigned char> popcount(i)", where popcount returns an "int".
+
+APPLY:
+* [attachment: trac_12371.patch](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)
+* [attachment: trac_popcount.patch](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)
``````




---

archive/issue_comments_134975.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nApply trac_12371.patch, trac_popcount.patch\n\n(for the patchbot, which is trying to apply all four patches at once)",
    "created_at": "2012-03-11T11:00:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134975",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:18" align="right">comment:18</div>

Apply trac_12371.patch, trac_popcount.patch

(for the patchbot, which is trying to apply all four patches at once)



---

archive/issue_comments_134976.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nPing ? This ticket still needs a review `:-)`\n\nNathann",
    "created_at": "2012-03-25T08:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134976",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:19" align="right">comment:19</div>

Ping ? This ticket still needs a review `:-)`

Nathann



---

archive/issue_events_167134.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-03-25T08:44:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167134"
}
```



---

archive/issue_events_167135.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-03-25T08:44:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167135"
}
```



---

archive/issue_comments_134977.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nWell, I said 'yes' four weeks ago, so I guess I should put \"positive review\".\n\nI thought telling \"ok\" to the code maintainer was good enough...",
    "created_at": "2012-03-25T08:44:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134977",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:20" align="right">comment:20</div>

Well, I said 'yes' four weeks ago, so I guess I should put "positive review".

I thought telling "ok" to the code maintainer was good enough...



---

archive/issue_comments_134978.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\n> Well, I said 'yes' four weeks ago, so I guess I should put \"positive review\".\n> \n> I thought telling \"ok\" to the code maintainer was good enough...\n\noops, sorry `:-)`\n\nand thank you for the review !\n\nNathann",
    "created_at": "2012-03-25T08:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134978",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:21" align="right">comment:21</div>

> Well, I said 'yes' four weeks ago, so I guess I should put "positive review".
> 
> I thought telling "ok" to the code maintainer was good enough...

oops, sorry `:-)`

and thank you for the review !

Nathann



---

archive/issue_comments_134979.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n1) This isn't a proper commit message for the reviewer patch:\n\n```\n[mq]: ffff\n```\n\n2) Could you please explain the logic behind the reviewer patch?  It seems to me like you're potentially changing the behaviour, and it's not clear to me why.  The ticket description isn't clear on this either.",
    "created_at": "2012-03-26T06:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134979",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">comment:22</div>

1) This isn't a proper commit message for the reviewer patch:

```
[mq]: ffff
```

2) Could you please explain the logic behind the reviewer patch?  It seems to me like you're potentially changing the behaviour, and it's not clear to me why.  The ticket description isn't clear on this either.



---

archive/issue_events_167136.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-26T06:46:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167136"
}
```



---

archive/issue_events_167137.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-26T06:46:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167137"
}
```



---

archive/issue_comments_134980.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nHellooo Jeroen !!\n\nSorry about that patch, the commit message is now updated !\n\nI do not get your second question, though.... The popcount function as it is implemented is made for 32 bits integers, and I thought it was better to write a popcount function for \"int\" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result, which has 0 cost as these things are simplified by the compiler anyway. When do you think the behaviour may change ?\n\nNathann",
    "created_at": "2012-03-26T08:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134980",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:23" align="right">comment:23</div>

Hellooo Jeroen !!

Sorry about that patch, the commit message is now updated !

I do not get your second question, though.... The popcount function as it is implemented is made for 32 bits integers, and I thought it was better to write a popcount function for "int" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result, which has 0 cost as these things are simplified by the compiler anyway. When do you think the behaviour may change ?

Nathann



---

archive/issue_events_167138.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167138"
}
```



---

archive/issue_events_167139.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167139"
}
```



---

archive/issue_events_167140.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167140"
}
```



---

archive/issue_events_167141.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167141"
}
```



---

archive/issue_comments_134981.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n(so that Jeroen sees it)",
    "created_at": "2012-03-26T08:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134981",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:24" align="right">comment:24</div>

(so that Jeroen sees it)



---

archive/issue_comments_134982.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@nathanncohen](#comment%3A23):\n> The popcount function as it is implemented is made for 32 bits integers\n\nThat's not clear from looking at the code.\n\n> and I thought it was better to write a popcount function for \"int\" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result.\n\nThat's my question: why do the test?  Why not just do\n\n```\ncdef inline int popcount(int i): \n    return __builtin_popcount(i) \n```\n\nAlso: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.",
    "created_at": "2012-03-26T08:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134982",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@nathanncohen](#comment%3A23):
> The popcount function as it is implemented is made for 32 bits integers

That's not clear from looking at the code.

> and I thought it was better to write a popcount function for "int" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result.

That's my question: why do the test?  Why not just do

```
cdef inline int popcount(int i): 
    return __builtin_popcount(i) 
```

Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.



---

archive/issue_comments_134983.json:
```json
{
    "body": "Attachment: **[trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)**",
    "created_at": "2012-03-26T11:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134983",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)**



---

archive/issue_comments_134984.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nHelloooo Jeroen !!!\n\n> That's not clear from looking at the code.\n\nIt is clearer now. The function is renamed to popcount32 and I added a short docstring.\n\n> That's my question: why do the test?  Why not just do\n> \n> ```\n> cdef inline int popcount(int i): \n>     return __builtin_popcount(i) \n> ```\n\nOh. Because this code is much faster.\n \n> Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.\n\nArggggg ! `O_O;;;`\n\nWell... I uploaded a new patch but I would like to have your advice on that. I added a new function whose purpose is only to test popcount32, but the test is *LONG* (around 5 minutes) so I flagged it with \"not tested\". I thought it was too long even for a \"long\" flag. It tries \"all 32bits integers\" and computes popcount in two different ways, to check for correction. Considering how this 3-lines function is written I do not expect it to cause problem on a different architecture (as long as we are dealing with >=32bits integers... There is no 16bits left, right ? `O_o;;;`).\n\nNathann",
    "created_at": "2012-03-26T11:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134984",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:26" align="right">comment:26</div>

Helloooo Jeroen !!!

> That's not clear from looking at the code.

It is clearer now. The function is renamed to popcount32 and I added a short docstring.

> That's my question: why do the test?  Why not just do
> 
> ```
> cdef inline int popcount(int i): 
>     return __builtin_popcount(i) 
> ```

Oh. Because this code is much faster.
 
> Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.

Arggggg ! `O_O;;;`

Well... I uploaded a new patch but I would like to have your advice on that. I added a new function whose purpose is only to test popcount32, but the test is *LONG* (around 5 minutes) so I flagged it with "not tested". I thought it was too long even for a "long" flag. It tries "all 32bits integers" and computes popcount in two different ways, to check for correction. Considering how this 3-lines function is written I do not expect it to cause problem on a different architecture (as long as we are dealing with >=32bits integers... There is no 16bits left, right ? `O_o;;;`).

Nathann



---

archive/issue_events_167142.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-26T12:24:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167142"
}
```



---

archive/issue_events_167143.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-26T12:24:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167143"
}
```



---

archive/issue_comments_134985.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n(the problem with needs_info is that Jeroen does not see it anymore ^^;)",
    "created_at": "2012-03-26T12:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134985",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:28" align="right">comment:28</div>

(the problem with needs_info is that Jeroen does not see it anymore ^^;)



---

archive/issue_comments_134986.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@nathanncohen](#comment%3A26):\n> Oh. Because this code is much faster.\n\nReally?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.",
    "created_at": "2012-03-26T12:41:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134986",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@nathanncohen](#comment%3A26):
> Oh. Because this code is much faster.

Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.



---

archive/issue_comments_134987.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n> Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.\n\nWell, it is not like I have an explanation for that, it is too low-level for me. If I were to try to find an answer I would say that the function implemented is inline while builtin_popcount is necessarily a function to be called.\n\nOf course, nothing beats using __builtin_popcount with a popcount instruction enabled on the processor, as it is directly translated to a function call.\n\nOk, now I made these tests a long time ago and it is actually very easy to check. I will post that in a second.\n\nNathann",
    "created_at": "2012-03-26T12:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134987",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:30" align="right">comment:30</div>

> Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.

Well, it is not like I have an explanation for that, it is too low-level for me. If I were to try to find an answer I would say that the function implemented is inline while builtin_popcount is necessarily a function to be called.

Of course, nothing beats using __builtin_popcount with a popcount instruction enabled on the processor, as it is directly translated to a function call.

Ok, now I made these tests a long time ago and it is actually very easy to check. I will post that in a second.

Nathann



---

archive/issue_comments_134988.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nYooooooo !!!\n\nWell, I just did the tests, and you can find attached the patch I used to do that. I actually first did the tests by replacing \"return popcount32\" in the code by \"return \\_\\_builtin_popcount\", and there was no difference that I could see in the runtimes of path_decomposition. I was about to say \"ok you are right, there is no difference after all\", but short of my natural dislike of acknowledging my own mistakes, I was really convinced that there was a real diference between the two.\n\nAnd it turns out that if I did not see the difference anymore, it is because of some change I made late in the path_decomposition algorithm (a previous version was *MUCH* slower than the current one), and this popcount is not the critical function anymore.\nThe \"stupid test\" (try many integers, compute what's left afterwards) is clear enough though :\n\n```\nsage: from sage.graphs.graph_decompositions.vertex_separation import test_handmade, test_builtin\nsage: time test_builtin()                                                                       \n-805306368\nTime: CPU 5.94 s, Wall: 5.95 s\nsage: time test_handmade()                                                                      \n-805306368\nTime: CPU 1.85 s, Wall: 1.85 s\n```\n\nOf course, these tests are immediately destroyed if you are lucky enough to compile the code on a machine with the popcnt instruction enabled... But so far I found no way to do that in a way that would not make the code crash on a machine that does *not* have it enabled.\n\nNathann",
    "created_at": "2012-03-26T13:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134988",
    "user": "https://github.com/nathanncohen"
}
```

<div id="comment:31" align="right">comment:31</div>

Yooooooo !!!

Well, I just did the tests, and you can find attached the patch I used to do that. I actually first did the tests by replacing "return popcount32" in the code by "return \_\_builtin_popcount", and there was no difference that I could see in the runtimes of path_decomposition. I was about to say "ok you are right, there is no difference after all", but short of my natural dislike of acknowledging my own mistakes, I was really convinced that there was a real diference between the two.

And it turns out that if I did not see the difference anymore, it is because of some change I made late in the path_decomposition algorithm (a previous version was *MUCH* slower than the current one), and this popcount is not the critical function anymore.
The "stupid test" (try many integers, compute what's left afterwards) is clear enough though :

```
sage: from sage.graphs.graph_decompositions.vertex_separation import test_handmade, test_builtin
sage: time test_builtin()                                                                       
-805306368
Time: CPU 5.94 s, Wall: 5.95 s
sage: time test_handmade()                                                                      
-805306368
Time: CPU 1.85 s, Wall: 1.85 s
```

Of course, these tests are immediately destroyed if you are lucky enough to compile the code on a machine with the popcnt instruction enabled... But so far I found no way to do that in a way that would not make the code crash on a machine that does *not* have it enabled.

Nathann



---

archive/issue_comments_134989.json:
```json
{
    "body": "Attachment: **[test_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/test_popcount.patch.gz)**",
    "created_at": "2012-03-26T13:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134989",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[test_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/test_popcount.patch.gz)**



---

archive/issue_comments_134990.json:
```json
{
    "body": "Author: **Julien Puydt**",
    "created_at": "2012-03-26T20:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134990",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Julien Puydt**



---

archive/issue_comments_134991.json:
```json
{
    "body": "Reviewer: **Nathann Cohen, Jeroen Demeyer**",
    "created_at": "2012-03-26T20:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134991",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Nathann Cohen, Jeroen Demeyer**



---

archive/issue_comments_134992.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.",
    "created_at": "2012-03-26T20:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134992",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:33" align="right">comment:33</div>

I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.



---

archive/issue_comments_134993.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@SnarkBoojum](#comment%3A33):\n> I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.\n\nThen change it!",
    "created_at": "2012-03-26T21:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134993",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@SnarkBoojum](#comment%3A33):
> I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.

Then change it!



---

archive/issue_comments_134994.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nPositive review since the patch works.",
    "created_at": "2012-03-27T15:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134994",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:35" align="right">comment:35</div>

Positive review since the patch works.



---

archive/issue_events_167144.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167144"
}
```



---

archive/issue_events_167145.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167145"
}
```



---

archive/issue_events_167146.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167146"
}
```



---

archive/issue_events_167147.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167147"
}
```



---

archive/issue_events_167148.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:04:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167148"
}
```



---

archive/issue_events_167149.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:04:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-167149"
}
```



---

archive/issue_comments_134995.json:
```json
{
    "body": "Merged: **sage-5.0.beta11**",
    "created_at": "2012-03-28T10:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-134995",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta11**
