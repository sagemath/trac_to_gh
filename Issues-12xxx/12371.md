# Issue 12371: The graph_decompositions/ code seems to have bounds issues

archive/issues_012199.json:
```json
{
    "assignees": [],
    "body": "That makes the code non-portable ; the patch I provide adds either signed or unsigned in each place, which makes the ARM platform pass the tests happily.\n\nNotice that it does fix the current problem but there are still two problems with the code:\n1. in vertex_separation.pyx, we still have \"minimums[i] = n\" which is an unsigned char getting an unsigned int ;\n2. in vertex_separation.pyx, we still have \"tmp_count = <unsigned char> popcount(i)\", where popcount returns an \"int\".\n\nAPPLY:\n* [attachment: trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)\n* [attachment: trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)\n\nAssignee: **@jasongrout, @nathanncohen, @rlmill**\n\nReviewer: **Nathann Cohen, Jeroen Demeyer**\n\nAuthor: **Julien Puydt**\n\nMerged: **sage-5.0.beta11**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12371_\n\n",
    "closed_at": "2012-03-28T10:04:48Z",
    "created_at": "2012-01-27T17:02:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "The graph_decompositions/ code seems to have bounds issues",
    "type": "issue",
    "updated_at": "2012-03-28T10:04:48Z",
    "url": "https://github.com/sagemath/sage/issues/12371",
    "user": "https://github.com/sagetrac-Snark"
}
```
That makes the code non-portable ; the patch I provide adds either signed or unsigned in each place, which makes the ARM platform pass the tests happily.

Notice that it does fix the current problem but there are still two problems with the code:
1. in vertex_separation.pyx, we still have "minimums[i] = n" which is an unsigned char getting an unsigned int ;
2. in vertex_separation.pyx, we still have "tmp_count = <unsigned char> popcount(i)", where popcount returns an "int".

APPLY:
* [attachment: trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)
* [attachment: trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)

Assignee: **@jasongrout, @nathanncohen, @rlmill**

Reviewer: **Nathann Cohen, Jeroen Demeyer**

Author: **Julien Puydt**

Merged: **sage-5.0.beta11**

_Issue created by migration from https://trac.sagemath.org/ticket/12371_





---

archive/issue_events_154353.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154353"
}
```



---

archive/issue_events_154354.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154354"
}
```



---

archive/issue_events_154355.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154355"
}
```



---

archive/issue_events_154356.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-27T17:02:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154356"
}
```



---

archive/issue_comments_137244.json:
```json
{
    "body": "Attachment: **[graph_decompositions_char.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_char.patch.gz)**\n\nPatch to fix the unsigned/signed char issue",
    "created_at": "2012-01-27T17:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137244",
    "user": "https://github.com/sagetrac-Snark"
}
```

Attachment: **[graph_decompositions_char.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_char.patch.gz)**

Patch to fix the unsigned/signed char issue



---

archive/issue_comments_137245.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nNow that I think of it, this \"int\" is the size of the graph, and assumed to be small, so perhaps that should be an \"unsigned char\" too?",
    "created_at": "2012-01-27T17:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137245",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:1'>Comment 1:</a>
Now that I think of it, this "int" is the size of the graph, and assumed to be small, so perhaps that should be an "unsigned char" too?



---

archive/issue_events_154357.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-27T17:08:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154357"
}
```



---

archive/issue_comments_137246.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nHelloooo !!!\n\nActually, what Volker said on [1] makes sense. What about using u_int8_t and int8_t as data types ? It would also be visually shorter and make the code much more readable `O_o`\n\n[1] https://groups.google.com/d/msg/sage-devel/2HwMYI1CY98/QNWOwanWp4kJ",
    "created_at": "2012-01-28T13:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137246",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:2'>Comment 2:</a>
Helloooo !!!

Actually, what Volker said on [1] makes sense. What about using u_int8_t and int8_t as data types ? It would also be visually shorter and make the code much more readable `O_o`

[1] https://groups.google.com/d/msg/sage-devel/2HwMYI1CY98/QNWOwanWp4kJ



---

archive/issue_comments_137247.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\n1. I think the standard names for the types are uint8_t and int8_t, and are found in stdint.h.\n   2. The purpose of that ticket is the char issue, so I would rather see another ticket on changing the implementation to use (u)int8_t.",
    "created_at": "2012-01-28T14:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137247",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:3'>Comment 3:</a>
1. I think the standard names for the types are uint8_t and int8_t, and are found in stdint.h.
   2. The purpose of that ticket is the char issue, so I would rather see another ticket on changing the implementation to use (u)int8_t.



---

archive/issue_comments_137248.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nLet's no create ten patches to address the same changes. I will write the patch in a couple hours if it is ok with you.\n\nNathann",
    "created_at": "2012-01-28T15:03:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137248",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:4'>Comment 4:</a>
Let's no create ten patches to address the same changes. I will write the patch in a couple hours if it is ok with you.

Nathann



---

archive/issue_comments_137249.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nIt's ok for me ; if you have something to test, I'll give it a try on my ARM box too.",
    "created_at": "2012-01-28T15:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137249",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:5'>Comment 5:</a>
It's ok for me ; if you have something to test, I'll give it a try on my ARM box too.



---

archive/issue_comments_137250.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nHellooooooo !!\n\nHere is a patch that does the same, but with the correct types `:-)`\n\nNathann",
    "created_at": "2012-01-28T21:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137250",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'>Comment 6:</a>
Hellooooooo !!

Here is a patch that does the same, but with the correct types `:-)`

Nathann



---

archive/issue_comments_137251.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nAttachment: **[trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)**\n\nEh, this patch is basically mine with s/unsigned char/uint8_t/g and s/signed char/int8_t/g, so it's no surprise it passes the tests.\n\nBut it also means it has all the problems of the original code, plus the ones of my patch.\n\nWhen I read the patched code, I see the following (potential or real) problems :\n1. there are loops on \"int\" counters from 0 to a cardinal (they should be the same type as the cardinal);\n2. the implementation of pop_count uses magical values which seem to assume a definite sizeof(int);\n3. there are \"int\" which are in fact bit arrays ; it should probably be \"unsigned int\" ;\n4. there are arrays which are indexed by above, so I'm not sure there is no risk there (though there is a test to bail out in case of problems, 8*sizeof(int)).\n\nIf I remember well, the current doctests just use graphs of cardinal up to 8, so we can only detect signed/unsigned issues, but not other ones.\n\nI'll try to work on a bigger patch ; I'm updating the summary of that ticket to reflect that much more ambitious scope.",
    "created_at": "2012-01-29T11:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137251",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:7'>Comment 7:</a>
Attachment: **[trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)**

Eh, this patch is basically mine with s/unsigned char/uint8_t/g and s/signed char/int8_t/g, so it's no surprise it passes the tests.

But it also means it has all the problems of the original code, plus the ones of my patch.

When I read the patched code, I see the following (potential or real) problems :
1. there are loops on "int" counters from 0 to a cardinal (they should be the same type as the cardinal);
2. the implementation of pop_count uses magical values which seem to assume a definite sizeof(int);
3. there are "int" which are in fact bit arrays ; it should probably be "unsigned int" ;
4. there are arrays which are indexed by above, so I'm not sure there is no risk there (though there is a test to bail out in case of problems, 8*sizeof(int)).

If I remember well, the current doctests just use graphs of cardinal up to 8, so we can only detect signed/unsigned issues, but not other ones.

I'll try to work on a bigger patch ; I'm updating the summary of that ticket to reflect that much more ambitious scope.



---

archive/issue_comments_137252.json:
```json
{
    "body": "Description changed:\n``````diff\n\n``````\n",
    "created_at": "2012-01-29T11:39:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137252",
    "user": "https://github.com/sagetrac-Snark"
}
```

Description changed:
``````diff

``````




---

archive/issue_events_154358.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-29T11:39:44Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "title_is": "The graph_decompositions/ code seems to have bounds issues",
    "title_was": "The graph_decompositions/ code uses \"char\" without the unsigned/signed keyword",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154358"
}
```



---

archive/issue_events_154359.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-29T11:39:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154359"
}
```



---

archive/issue_events_154360.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-01-29T11:39:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154360"
}
```



---

archive/issue_comments_137253.json:
```json
{
    "body": "Patch to change the types in the graph_decompositions/ code",
    "created_at": "2012-01-29T11:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137253",
    "user": "https://github.com/sagetrac-Snark"
}
```

Patch to change the types in the graph_decompositions/ code



---

archive/issue_comments_137254.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nAttachment: **[graph_decompositions_typings.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_typings.patch.gz)**\n\nDon't you think it is going a bit too far ? You are refusing to compare unsigned char with integers, for some reason bit arrays \"should be\" unsigned int and not \"int\"...\n\nAnd even if the ansers of some methods do not require more than 8 bits that is no reason why we should force the user to deal with int8_t instead of regular integers...\n\nI agree that the argument of popcount should be redefined to int32_t though.\n\nNathann",
    "created_at": "2012-01-29T11:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137254",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'>Comment 8:</a>
Attachment: **[graph_decompositions_typings.patch.gz](https://github.com/sagemath/sage/files/ticket12371/graph_decompositions_typings.patch.gz)**

Don't you think it is going a bit too far ? You are refusing to compare unsigned char with integers, for some reason bit arrays "should be" unsigned int and not "int"...

And even if the ansers of some methods do not require more than 8 bits that is no reason why we should force the user to deal with int8_t instead of regular integers...

I agree that the argument of popcount should be redefined to int32_t though.

Nathann



---

archive/issue_comments_137255.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nWell, you seemed eager to use \"correct types\", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)\n\nAnd for bit arrays, I didn't write they \"should be\" but \"should probably be\", which is even weaker: I'm not convinced.\n\nWhatever gets applied, as long as it works, is ok for me.\n\n(PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)",
    "created_at": "2012-01-29T12:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137255",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:9'>Comment 9:</a>
Well, you seemed eager to use "correct types", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)

And for bit arrays, I didn't write they "should be" but "should probably be", which is even weaker: I'm not convinced.

Whatever gets applied, as long as it works, is ok for me.

(PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)



---

archive/issue_comments_137256.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\n> Well, you seemed eager to use \"correct types\", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)\n\nWell, the thing with \"char\" is that it has a \"meaning\", it represents characters, and that's why there is a difference on your architecture. What I mean by using char is actually \"a 8-bits integer\", which can be unsigned at times. But what is the point of saving 3 bytes on an integer counter ?\n\n> Whatever gets applied, as long as it works, is ok for me.\n\n+1\n\n> (PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)\n\nWell, I said it would make sense to move its argument to int32_t. Isn't that what you meant ?\n\nNathann",
    "created_at": "2012-01-29T12:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137256",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:10'>Comment 10:</a>
> Well, you seemed eager to use "correct types", and signed/unsigned char didn't seem good enough, so I changed the rest of the code in that direction :-)

Well, the thing with "char" is that it has a "meaning", it represents characters, and that's why there is a difference on your architecture. What I mean by using char is actually "a 8-bits integer", which can be unsigned at times. But what is the point of saving 3 bytes on an integer counter ?

> Whatever gets applied, as long as it works, is ok for me.

+1

> (PS: you didn't comment on point 2, which might be an issue if sizeof(int) isn't what you expect)

Well, I said it would make sense to move its argument to int32_t. Isn't that what you meant ?

Nathann



---

archive/issue_comments_137257.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nWell, if int32_t is used for popcount, we'd better be sure \"int\" doesn't have more bits than that, because that's what is used elsewhere, and especially the whole code is guarded against 8*sizeof(int), not againt 32.",
    "created_at": "2012-01-29T13:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137257",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:11'>Comment 11:</a>
Well, if int32_t is used for popcount, we'd better be sure "int" doesn't have more bits than that, because that's what is used elsewhere, and especially the whole code is guarded against 8*sizeof(int), not againt 32.



---

archive/issue_comments_137258.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nHmmmm... You are right ! But then it makes much more sense to adapt popcount than to adapt all code to popcount.\n\nI'll give this a look, it is also used in the bitset code.\n\nNathann",
    "created_at": "2012-01-29T13:06:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137258",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'>Comment 12:</a>
Hmmmm... You are right ! But then it makes much more sense to adapt popcount than to adapt all code to popcount.

I'll give this a look, it is also used in the bitset code.

Nathann



---

archive/issue_comments_137259.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nAhahah. Turns out the stupid way is also the best. It looks like there is no preprocessor way to check the integer size, but as we compile with O3 gcc does the job anyway and removes the condition itself `:-)`\n\nAnd I finally did not touch the bitset code, as they deal with long type.\n\nNathann",
    "created_at": "2012-01-29T13:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137259",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:13'>Comment 13:</a>
Ahahah. Turns out the stupid way is also the best. It looks like there is no preprocessor way to check the integer size, but as we compile with O3 gcc does the job anyway and removes the condition itself `:-)`

And I finally did not touch the bitset code, as they deal with long type.

Nathann



---

archive/issue_comments_137260.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nNathann, what is the status of this ticket?",
    "created_at": "2012-02-26T07:55:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137260",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:14'>Comment 14:</a>
Nathann, what is the status of this ticket?



---

archive/issue_comments_137261.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nHellooooo !!\n\n> Nathann, what is the status of this ticket?\n\nWell.... You sent a patch while setting the ticket to \"needs_work\", so you tell me `^^;`\n\nI tried to answer the points you made in your 4 items list. I think (a very personal advice) that points 1, 3 and 4 have more to do with theology than with programming (there is nothing that makes me worry in any of them, except that any patch fixing them would made the way harder to read) and the remark you made in 2 is right for me, and can be fixed with the trick I gave two comments above. That is : it can be fixed the stupid way with a if(sizeof(int) == 4), at no cost in efficiency as this kind of things is solver at compilation time) `:-)`\n\nNathann",
    "created_at": "2012-02-26T08:46:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137261",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:15'>Comment 15:</a>
Hellooooo !!

> Nathann, what is the status of this ticket?

Well.... You sent a patch while setting the ticket to "needs_work", so you tell me `^^;`

I tried to answer the points you made in your 4 items list. I think (a very personal advice) that points 1, 3 and 4 have more to do with theology than with programming (there is nothing that makes me worry in any of them, except that any patch fixing them would made the way harder to read) and the remark you made in 2 is right for me, and can be fixed with the trick I gave two comments above. That is : it can be fixed the stupid way with a if(sizeof(int) == 4), at no cost in efficiency as this kind of things is solver at compilation time) `:-)`

Nathann



---

archive/issue_comments_137262.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nBoth your patches look good, and I would gladly see them go in :-)",
    "created_at": "2012-02-26T09:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137262",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:16'>Comment 16:</a>
Both your patches look good, and I would gladly see them go in :-)



---

archive/issue_events_154361.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-02-26T09:46:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154361"
}
```



---

archive/issue_events_154362.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-02-26T09:46:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154362"
}
```



---

archive/issue_comments_137263.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\n> Both your patches look good, and I would gladly see them go in :-)\n\nOh. Then if you think those ones should go, then all that is left to do is to review them `:-)`\n\nAnd the \"is solver\" in my previous message was a \"is solved\", naturally `:-p`\n\nNathann",
    "created_at": "2012-02-26T09:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137263",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:17'>Comment 17:</a>
> Both your patches look good, and I would gladly see them go in :-)

Oh. Then if you think those ones should go, then all that is left to do is to review them `:-)`

And the "is solver" in my previous message was a "is solved", naturally `:-p`

Nathann



---

archive/issue_comments_137264.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,7 @@\n Notice that it does fix the current problem but there are still two problems with the code:\n 1. in vertex_separation.pyx, we still have \"minimums[i] = n\" which is an unsigned char getting an unsigned int ;\n 2. in vertex_separation.pyx, we still have \"tmp_count = <unsigned char> popcount(i)\", where popcount returns an \"int\".\n+\n+APPLY:\n+* [attachment: trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)\n+* [attachment: trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)\n``````\n",
    "created_at": "2012-02-26T09:46:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137264",
    "user": "https://github.com/nathanncohen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,7 @@
 Notice that it does fix the current problem but there are still two problems with the code:
 1. in vertex_separation.pyx, we still have "minimums[i] = n" which is an unsigned char getting an unsigned int ;
 2. in vertex_separation.pyx, we still have "tmp_count = <unsigned char> popcount(i)", where popcount returns an "int".
+
+APPLY:
+* [attachment: trac_12371.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_12371.patch.gz)
+* [attachment: trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)
``````




---

archive/issue_comments_137265.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nApply trac_12371.patch, trac_popcount.patch\n\n(for the patchbot, which is trying to apply all four patches at once)",
    "created_at": "2012-03-11T11:00:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137265",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:18'>Comment 18:</a>
Apply trac_12371.patch, trac_popcount.patch

(for the patchbot, which is trying to apply all four patches at once)



---

archive/issue_comments_137266.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nPing ? This ticket still needs a review `:-)`\n\nNathann",
    "created_at": "2012-03-25T08:35:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137266",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:19'>Comment 19:</a>
Ping ? This ticket still needs a review `:-)`

Nathann



---

archive/issue_events_154363.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-03-25T08:44:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154363"
}
```



---

archive/issue_events_154364.json:
```json
{
    "actor": "https://github.com/sagetrac-Snark",
    "created_at": "2012-03-25T08:44:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154364"
}
```



---

archive/issue_comments_137267.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nWell, I said 'yes' four weeks ago, so I guess I should put \"positive review\".\n\nI thought telling \"ok\" to the code maintainer was good enough...",
    "created_at": "2012-03-25T08:44:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137267",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:20'>Comment 20:</a>
Well, I said 'yes' four weeks ago, so I guess I should put "positive review".

I thought telling "ok" to the code maintainer was good enough...



---

archive/issue_comments_137268.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\n> Well, I said 'yes' four weeks ago, so I guess I should put \"positive review\".\n> \n> I thought telling \"ok\" to the code maintainer was good enough...\n\noops, sorry `:-)`\n\nand thank you for the review !\n\nNathann",
    "created_at": "2012-03-25T08:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137268",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:21'>Comment 21:</a>
> Well, I said 'yes' four weeks ago, so I guess I should put "positive review".
> 
> I thought telling "ok" to the code maintainer was good enough...

oops, sorry `:-)`

and thank you for the review !

Nathann



---

archive/issue_comments_137269.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\n1) This isn't a proper commit message for the reviewer patch:\n\n```\n[mq]: ffff\n```\n\n2) Could you please explain the logic behind the reviewer patch?  It seems to me like you're potentially changing the behaviour, and it's not clear to me why.  The ticket description isn't clear on this either.",
    "created_at": "2012-03-26T06:46:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137269",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'>Comment 22:</a>
1) This isn't a proper commit message for the reviewer patch:

```
[mq]: ffff
```

2) Could you please explain the logic behind the reviewer patch?  It seems to me like you're potentially changing the behaviour, and it's not clear to me why.  The ticket description isn't clear on this either.



---

archive/issue_events_154365.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-26T06:46:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154365"
}
```



---

archive/issue_events_154366.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-26T06:46:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154366"
}
```



---

archive/issue_comments_137270.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nHellooo Jeroen !!\n\nSorry about that patch, the commit message is now updated !\n\nI do not get your second question, though.... The popcount function as it is implemented is made for 32 bits integers, and I thought it was better to write a popcount function for \"int\" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result, which has 0 cost as these things are simplified by the compiler anyway. When do you think the behaviour may change ?\n\nNathann",
    "created_at": "2012-03-26T08:17:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137270",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:23'>Comment 23:</a>
Hellooo Jeroen !!

Sorry about that patch, the commit message is now updated !

I do not get your second question, though.... The popcount function as it is implemented is made for 32 bits integers, and I thought it was better to write a popcount function for "int" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result, which has 0 cost as these things are simplified by the compiler anyway. When do you think the behaviour may change ?

Nathann



---

archive/issue_events_154367.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154367"
}
```



---

archive/issue_events_154368.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154368"
}
```



---

archive/issue_events_154369.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154369"
}
```



---

archive/issue_events_154370.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2012-03-26T08:17:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154370"
}
```



---

archive/issue_comments_137271.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\n(so that Jeroen sees it)",
    "created_at": "2012-03-26T08:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137271",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:24'>Comment 24:</a>
(so that Jeroen sees it)



---

archive/issue_comments_137272.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@nathanncohen](#comment%3A23):\n> The popcount function as it is implemented is made for 32 bits integers\n\nThat's not clear from looking at the code.\n\n> and I thought it was better to write a popcount function for \"int\" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result.\n\nThat's my question: why do the test?  Why not just do\n\n```\ncdef inline int popcount(int i): \n    return __builtin_popcount(i) \n```\n\nAlso: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.",
    "created_at": "2012-03-26T08:27:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137272",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@nathanncohen](#comment%3A23):
> The popcount function as it is implemented is made for 32 bits integers

That's not clear from looking at the code.

> and I thought it was better to write a popcount function for "int" than to write a popcount function for int32_fast_t, so here it is. This function just tests the size of an int before returning its result.

That's my question: why do the test?  Why not just do

```
cdef inline int popcount(int i): 
    return __builtin_popcount(i) 
```

Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.



---

archive/issue_comments_137273.json:
```json
{
    "body": "Attachment: **[trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)**",
    "created_at": "2012-03-26T11:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137273",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[trac_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/trac_popcount.patch.gz)**



---

archive/issue_comments_137274.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nHelloooo Jeroen !!!\n\n> That's not clear from looking at the code.\n\nIt is clearer now. The function is renamed to popcount32 and I added a short docstring.\n\n> That's my question: why do the test?  Why not just do\n> \n> ```\n> cdef inline int popcount(int i): \n>     return __builtin_popcount(i) \n> ```\n\nOh. Because this code is much faster.\n \n> Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.\n\nArggggg ! `O_O;;;`\n\nWell... I uploaded a new patch but I would like to have your advice on that. I added a new function whose purpose is only to test popcount32, but the test is *LONG* (around 5 minutes) so I flagged it with \"not tested\". I thought it was too long even for a \"long\" flag. It tries \"all 32bits integers\" and computes popcount in two different ways, to check for correction. Considering how this 3-lines function is written I do not expect it to cause problem on a different architecture (as long as we are dealing with >=32bits integers... There is no 16bits left, right ? `O_o;;;`).\n\nNathann",
    "created_at": "2012-03-26T11:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137274",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:26'>Comment 26:</a>
Helloooo Jeroen !!!

> That's not clear from looking at the code.

It is clearer now. The function is renamed to popcount32 and I added a short docstring.

> That's my question: why do the test?  Why not just do
> 
> ```
> cdef inline int popcount(int i): 
>     return __builtin_popcount(i) 
> ```

Oh. Because this code is much faster.
 
> Also: there are portability issues: `__builtin_popcount()` is a GCC extension, certainly not supported by all compilers.

Arggggg ! `O_O;;;`

Well... I uploaded a new patch but I would like to have your advice on that. I added a new function whose purpose is only to test popcount32, but the test is *LONG* (around 5 minutes) so I flagged it with "not tested". I thought it was too long even for a "long" flag. It tries "all 32bits integers" and computes popcount in two different ways, to check for correction. Considering how this 3-lines function is written I do not expect it to cause problem on a different architecture (as long as we are dealing with >=32bits integers... There is no 16bits left, right ? `O_o;;;`).

Nathann



---

archive/issue_events_154371.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-26T12:24:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154371"
}
```



---

archive/issue_events_154372.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2012-03-26T12:24:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154372"
}
```



---

archive/issue_comments_137275.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\n(the problem with needs_info is that Jeroen does not see it anymore ^^;)",
    "created_at": "2012-03-26T12:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137275",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:28'>Comment 28:</a>
(the problem with needs_info is that Jeroen does not see it anymore ^^;)



---

archive/issue_comments_137276.json:
```json
{
    "body": "<a id='comment:29'>Comment 29:</a>\nReplying to [@nathanncohen](#comment%3A26):\n> Oh. Because this code is much faster.\n\nReally?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.",
    "created_at": "2012-03-26T12:41:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137276",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'>Comment 29:</a>
Replying to [@nathanncohen](#comment%3A26):
> Oh. Because this code is much faster.

Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.



---

archive/issue_comments_137277.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\n> Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.\n\nWell, it is not like I have an explanation for that, it is too low-level for me. If I were to try to find an answer I would say that the function implemented is inline while builtin_popcount is necessarily a function to be called.\n\nOf course, nothing beats using __builtin_popcount with a popcount instruction enabled on the processor, as it is directly translated to a function call.\n\nOk, now I made these tests a long time ago and it is actually very easy to check. I will post that in a second.\n\nNathann",
    "created_at": "2012-03-26T12:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137277",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:30'>Comment 30:</a>
> Really?  I highly doubt that you can write something which is faster than `__builtin_popcount()`.

Well, it is not like I have an explanation for that, it is too low-level for me. If I were to try to find an answer I would say that the function implemented is inline while builtin_popcount is necessarily a function to be called.

Of course, nothing beats using __builtin_popcount with a popcount instruction enabled on the processor, as it is directly translated to a function call.

Ok, now I made these tests a long time ago and it is actually very easy to check. I will post that in a second.

Nathann



---

archive/issue_comments_137278.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nYooooooo !!!\n\nWell, I just did the tests, and you can find attached the patch I used to do that. I actually first did the tests by replacing \"return popcount32\" in the code by \"return \\_\\_builtin_popcount\", and there was no difference that I could see in the runtimes of path_decomposition. I was about to say \"ok you are right, there is no difference after all\", but short of my natural dislike of acknowledging my own mistakes, I was really convinced that there was a real diference between the two.\n\nAnd it turns out that if I did not see the difference anymore, it is because of some change I made late in the path_decomposition algorithm (a previous version was *MUCH* slower than the current one), and this popcount is not the critical function anymore.\nThe \"stupid test\" (try many integers, compute what's left afterwards) is clear enough though :\n\n```\nsage: from sage.graphs.graph_decompositions.vertex_separation import test_handmade, test_builtin\nsage: time test_builtin()                                                                       \n-805306368\nTime: CPU 5.94 s, Wall: 5.95 s\nsage: time test_handmade()                                                                      \n-805306368\nTime: CPU 1.85 s, Wall: 1.85 s\n```\n\nOf course, these tests are immediately destroyed if you are lucky enough to compile the code on a machine with the popcnt instruction enabled... But so far I found no way to do that in a way that would not make the code crash on a machine that does *not* have it enabled.\n\nNathann",
    "created_at": "2012-03-26T13:02:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137278",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:31'>Comment 31:</a>
Yooooooo !!!

Well, I just did the tests, and you can find attached the patch I used to do that. I actually first did the tests by replacing "return popcount32" in the code by "return \_\_builtin_popcount", and there was no difference that I could see in the runtimes of path_decomposition. I was about to say "ok you are right, there is no difference after all", but short of my natural dislike of acknowledging my own mistakes, I was really convinced that there was a real diference between the two.

And it turns out that if I did not see the difference anymore, it is because of some change I made late in the path_decomposition algorithm (a previous version was *MUCH* slower than the current one), and this popcount is not the critical function anymore.
The "stupid test" (try many integers, compute what's left afterwards) is clear enough though :

```
sage: from sage.graphs.graph_decompositions.vertex_separation import test_handmade, test_builtin
sage: time test_builtin()                                                                       
-805306368
Time: CPU 5.94 s, Wall: 5.95 s
sage: time test_handmade()                                                                      
-805306368
Time: CPU 1.85 s, Wall: 1.85 s
```

Of course, these tests are immediately destroyed if you are lucky enough to compile the code on a machine with the popcnt instruction enabled... But so far I found no way to do that in a way that would not make the code crash on a machine that does *not* have it enabled.

Nathann



---

archive/issue_comments_137279.json:
```json
{
    "body": "Attachment: **[test_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/test_popcount.patch.gz)**",
    "created_at": "2012-03-26T13:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137279",
    "user": "https://github.com/nathanncohen"
}
```

Attachment: **[test_popcount.patch.gz](https://github.com/sagemath/sage/files/ticket12371/test_popcount.patch.gz)**



---

archive/issue_comments_137280.json:
```json
{
    "body": "Author: **Julien Puydt**",
    "created_at": "2012-03-26T20:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137280",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Julien Puydt**



---

archive/issue_comments_137281.json:
```json
{
    "body": "Reviewer: **Nathann Cohen, Jeroen Demeyer**",
    "created_at": "2012-03-26T20:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137281",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Nathann Cohen, Jeroen Demeyer**



---

archive/issue_comments_137282.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\nI wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.",
    "created_at": "2012-03-26T20:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137282",
    "user": "https://github.com/sagetrac-Snark"
}
```

<a id='comment:33'>Comment 33:</a>
I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.



---

archive/issue_comments_137283.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nReplying to [Snark](#comment%3A33):\n> I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.\n\nThen change it!",
    "created_at": "2012-03-26T21:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137283",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>Comment 34:</a>
Replying to [Snark](#comment%3A33):
> I wrote some initial patches, but after that, Nathann is the one who did the authoring, so I'm not sure the changes of [comment:32](#comment%3A32) are correct.

Then change it!



---

archive/issue_comments_137284.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nPositive review since the patch works.",
    "created_at": "2012-03-27T15:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137284",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>Comment 35:</a>
Positive review since the patch works.



---

archive/issue_events_154373.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154373"
}
```



---

archive/issue_events_154374.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154374"
}
```



---

archive/issue_events_154375.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154375"
}
```



---

archive/issue_events_154376.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-27T15:55:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154376"
}
```



---

archive/issue_events_154377.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:04:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154377"
}
```



---

archive/issue_events_154378.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-28T10:04:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12371#event-154378"
}
```



---

archive/issue_comments_137285.json:
```json
{
    "body": "Merged: **sage-5.0.beta11**",
    "created_at": "2012-03-28T10:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12371#issuecomment-137285",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta11**
