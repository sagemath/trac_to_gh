# Issue 12221: Failures in gp pexpect interface with specific length of $DOT_SAGE using a "screen" terminal

archive/issues_012049.json:
```json
{
    "assignees": [],
    "body": "On Gentoo Linux x86_64 and on sage.math running sage-4.8.alpha6 + #11073 (but *without* #12263):\n\nUse a \"screen\" terminal.\n\nWhen $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (pty).  The pty seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm.\n\nFor example, on a 138-column terminal:\n\n```\n( export HOME=/mnt/usb1/scratch/jdemeyer/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )\n[...]\nsage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n  ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n  ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n**********************************************************************\nFile \"/usr/local/src/sage-4.8.alpha4/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\", line 526:\n    sage: E.conductor(algorithm=\"gp\")\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage-4.8.alpha4/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[5]>\", line 1, in <module>\n        E.conductor(algorithm=\"gp\")###line 526:\n    sage: E.conductor(algorithm=\"gp\")\n      File \"/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 552, in conductor\n        self.__conductor_gp = Integer(gp.eval('ellglobalred(ellinit(%s,0))[1]'%list(self.a_invariants())))\n      File \"integer.pyx\", line 681, in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:6786)\n    TypeError: unable to convert x (=read(\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/.sage/temp/arcanis/5630//interface//tmp5647\") ) to an integer\n**********************************************************************\nFile \"/usr/local/src/sage-4.8.alpha4/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1430:\n    sage: E.simon_two_descent()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/usr/local/src/sage-4.8.alpha4/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_28[4]>\", line 1, in <module>\n        E.simon_two_descent()###line 1430:\n    sage: E.simon_two_descent()\n      File \"/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1493, in simon_two_descent\n        maxprob=maxprob, limbigprime=limbigprime)\n      File \"/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/schemes/elliptic_curves/gp_simon.py\", line 117, in simon_two_descent\n        ans = sage_eval(v, {'Mod': _gp_mod, 'y': K.gen(0)})\n      File \"/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/misc/sage_eval.py\", line 199, in sage_eval\n        return eval(source, sage.all.__dict__, locals)\n      File \"<string>\", line 0\n\n        ^\n     SyntaxError: unexpected EOF while parsing\n**********************************************************************\n[...]\nThe following tests failed:\n\n        sage -t  devel/sage/sage/schemes/elliptic_curves/lseries_ell.py # 1 doctests failed\n        sage -t  devel/sage/sage/schemes/elliptic_curves/gp_simon.py # 3 doctests failed\n        sage -t  devel/sage/sage/schemes/elliptic_curves/BSD.py # 3 doctests failed\n        sage -t  devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 4 doctests failed\n        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 14 doctests failed\n        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_number_field.py # 11 doctests failed\n```\n\n---\n\n**How to reproduce this more artificially**:\napply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  The problem is the filename length of the temporary files used in the read() command.  This depends on `$DOT_SAGE`, on the hostname, on process IDs.\n\nDownload [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run (from within a \"screen\" session).  This will execute a read() command with increasing filename lengths:\n\n```\n$ ./sage test12221.sage\n```\nI see\n\n```\nTERM = screen\n18 char filename: ok\n19 char filename: ok\n20 char filename: ok\n[...]\n68 char filename: ok\n69 char filename: ok\n70 char filename: fail\n[...]\n```\n\n**apply** [attachment:12221_pexpect_unset_TERM.patch](https://github.com/sagemath/sage/files/ticket12221/12221_pexpect_unset_TERM.patch) and the **spkg** [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)\n\n**Assignee:** @williamstein\n\n**CC:**  @JohnCremona\n\n**Keywords:** gp pexpect spkg\n\n**Author:** Jeroen Demeyer\n\n**Reviewer:** Georg S. Weber\n\n**Merged:** sage-5.0.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/12221\n\n",
    "closed_at": "2012-01-20T13:43:16Z",
    "created_at": "2011-12-22T13:27:47Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Failures in gp pexpect interface with specific length of $DOT_SAGE using a \"screen\" terminal",
    "type": "issue",
    "updated_at": "2012-01-20T13:43:43Z",
    "url": "https://github.com/sagemath/sage/issues/12221",
    "user": "https://github.com/jdemeyer"
}
```
On Gentoo Linux x86_64 and on sage.math running sage-4.8.alpha6 + #11073 (but *without* #12263):

Use a "screen" terminal.

When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (pty).  The pty seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm.

For example, on a 138-column terminal:

```
( export HOME=/mnt/usb1/scratch/jdemeyer/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )
[...]
sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
  ***   Warning: new stack size = 1003360 (0.957 Mbytes).
  ***   Warning: new stack size = 1003360 (0.957 Mbytes).
**********************************************************************
File "/usr/local/src/sage-4.8.alpha4/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py", line 526:
    sage: E.conductor(algorithm="gp")
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage-4.8.alpha4/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[5]>", line 1, in <module>
        E.conductor(algorithm="gp")###line 526:
    sage: E.conductor(algorithm="gp")
      File "/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 552, in conductor
        self.__conductor_gp = Integer(gp.eval('ellglobalred(ellinit(%s,0))[1]'%list(self.a_invariants())))
      File "integer.pyx", line 681, in sage.rings.integer.Integer.__init__ (sage/rings/integer.c:6786)
    TypeError: unable to convert x (=read("/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/.sage/temp/arcanis/5630//interface//tmp5647") ) to an integer
**********************************************************************
File "/usr/local/src/sage-4.8.alpha4/devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py", line 1430:
    sage: E.simon_two_descent()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/usr/local/src/sage-4.8.alpha4/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/usr/local/src/sage-4.8.alpha4/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_28[4]>", line 1, in <module>
        E.simon_two_descent()###line 1430:
    sage: E.simon_two_descent()
      File "/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 1493, in simon_two_descent
        maxprob=maxprob, limbigprime=limbigprime)
      File "/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/schemes/elliptic_curves/gp_simon.py", line 117, in simon_two_descent
        ans = sage_eval(v, {'Mod': _gp_mod, 'y': K.gen(0)})
      File "/usr/local/src/sage-4.8.alpha4/local/lib/python/site-packages/sage/misc/sage_eval.py", line 199, in sage_eval
        return eval(source, sage.all.__dict__, locals)
      File "<string>", line 0

        ^
     SyntaxError: unexpected EOF while parsing
**********************************************************************
[...]
The following tests failed:

        sage -t  devel/sage/sage/schemes/elliptic_curves/lseries_ell.py # 1 doctests failed
        sage -t  devel/sage/sage/schemes/elliptic_curves/gp_simon.py # 3 doctests failed
        sage -t  devel/sage/sage/schemes/elliptic_curves/BSD.py # 3 doctests failed
        sage -t  devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 4 doctests failed
        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 14 doctests failed
        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_number_field.py # 11 doctests failed
```

---

**How to reproduce this more artificially**:
apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  The problem is the filename length of the temporary files used in the read() command.  This depends on `$DOT_SAGE`, on the hostname, on process IDs.

Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run (from within a "screen" session).  This will execute a read() command with increasing filename lengths:

```
$ ./sage test12221.sage
```
I see

```
TERM = screen
18 char filename: ok
19 char filename: ok
20 char filename: ok
[...]
68 char filename: ok
69 char filename: ok
70 char filename: fail
[...]
```

**apply** [attachment:12221_pexpect_unset_TERM.patch](https://github.com/sagemath/sage/files/ticket12221/12221_pexpect_unset_TERM.patch) and the **spkg** [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)

**Assignee:** @williamstein

**CC:**  @JohnCremona

**Keywords:** gp pexpect spkg

**Author:** Jeroen Demeyer

**Reviewer:** Georg S. Weber

**Merged:** sage-5.0.beta0

Issue created by migration from https://trac.sagemath.org/ticket/12221





---

archive/issue_events_140351.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-22T13:27:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140351"
}
```



---

archive/issue_events_140352.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-22T13:27:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "08517b",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140352"
}
```



---

archive/issue_events_140353.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-22T13:27:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/blocker",
    "label_color": "ff0000",
    "label_name": "blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140353"
}
```



---

archive/issue_events_140354.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-22T13:28:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140354"
}
```



---

archive/issue_comments_134393.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n When the home directory $HOME is unusually long, failures happen in the gp interface:\n \n ```\n-( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t --long devel/sage/sage/ )\n+( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )\n [...]\n sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n   ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n``````\n",
    "created_at": "2011-12-22T13:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134393",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 When the home directory $HOME is unusually long, failures happen in the gp interface:
 
 ```
-( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t --long devel/sage/sage/ )
+( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )
 [...]
 sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
   ***   Warning: new stack size = 1003360 (0.957 Mbytes).
``````




---

archive/issue_comments_134394.json:
```json
{
    "body": "<a id='comment:2'></a>\nI can't reproduce this, either on sage.math or an OS X box.  What platform were you using?",
    "created_at": "2011-12-22T16:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134394",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I can't reproduce this, either on sage.math or an OS X box.  What platform were you using?



---

archive/issue_comments_134395.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n+On Gentoo Linux, x86_64:\n+\n+```\n+Linux arcanis 2.6.34-gentoo-r12 #4 SMP Thu May 26 19:17:15 EEST 2011 x86_64 Intel(R) Core(TM)2 Duo CPU T5870 @ 2.00GHz GenuineIntel GNU/Linux\n+```\n+\n When the home directory $HOME is unusually long, failures happen in the gp interface:\n \n ```\n``````\n",
    "created_at": "2011-12-22T16:47:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134395",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,9 @@
+On Gentoo Linux, x86_64:
+
+```
+Linux arcanis 2.6.34-gentoo-r12 #4 SMP Thu May 26 19:17:15 EEST 2011 x86_64 Intel(R) Core(TM)2 Duo CPU T5870 @ 2.00GHz GenuineIntel GNU/Linux
+```
+
 When the home directory $HOME is unusually long, failures happen in the gp interface:
 
 ```
``````




---

archive/issue_comments_134396.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,10 @@\n-On Gentoo Linux, x86_64:\n+On Gentoo Linux x86_64:\n \n ```\n Linux arcanis 2.6.34-gentoo-r12 #4 SMP Thu May 26 19:17:15 EEST 2011 x86_64 Intel(R) Core(TM)2 Duo CPU T5870 @ 2.00GHz GenuineIntel GNU/Linux\n ```\n \n-When the home directory $HOME is unusually long, failures happen in the gp interface:\n+When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha4):\n \n ```\n ( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )\n``````\n",
    "created_at": "2011-12-22T16:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134396",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,10 @@
-On Gentoo Linux, x86_64:
+On Gentoo Linux x86_64:
 
 ```
 Linux arcanis 2.6.34-gentoo-r12 #4 SMP Thu May 26 19:17:15 EEST 2011 x86_64 Intel(R) Core(TM)2 Duo CPU T5870 @ 2.00GHz GenuineIntel GNU/Linux
 ```
 
-When the home directory $HOME is unusually long, failures happen in the gp interface:
+When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha4):
 
 ```
 ( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )
``````




---

archive/issue_comments_134397.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt might really be caused by #11704 then.  Need to do some more tests.",
    "created_at": "2011-12-22T16:55:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134397",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
It might really be caused by #11704 then.  Need to do some more tests.



---

archive/issue_comments_134398.json:
```json
{
    "body": "<a id='comment:6'></a>\nI should clarify: I couldn't reproduce this, either before applying the patch from #11704 or after.",
    "created_at": "2011-12-22T17:19:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134398",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
I should clarify: I couldn't reproduce this, either before applying the patch from #11704 or after.



---

archive/issue_comments_134399.json:
```json
{
    "body": "<a id='comment:7'></a>\nIt might really be caused by #11704 + #11073 then. Need to do some more tests.",
    "created_at": "2011-12-23T16:32:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134399",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
It might really be caused by #11704 + #11073 then. Need to do some more tests.



---

archive/issue_comments_134400.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [@jdemeyer](#comment%3A7):\n> It might really be caused by #11704 + #11073 then. Need to do some more tests. \n\nThat combination doesn't cause me problems on sage.math: I have a copy of sage in `/scratch/palmieri/11073/sage-4.8.a4-11073` which has the patches from #11073 and its dependencies, including #11704.  Tests pass when I use the command in the ticket description.  (I produced this version of Sage with the file [http://sage.math.washington.edu/home/palmieri/misc/11073/sage-4.8.a4-11073.tar](http://sage.math.washington.edu/home/palmieri/misc/11073/sage-4.8.a4-11073.tar).)",
    "created_at": "2011-12-23T18:07:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134400",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Replying to [@jdemeyer](#comment%3A7):
> It might really be caused by #11704 + #11073 then. Need to do some more tests. 

That combination doesn't cause me problems on sage.math: I have a copy of sage in `/scratch/palmieri/11073/sage-4.8.a4-11073` which has the patches from #11073 and its dependencies, including #11704.  Tests pass when I use the command in the ticket description.  (I produced this version of Sage with the file [http://sage.math.washington.edu/home/palmieri/misc/11073/sage-4.8.a4-11073.tar](http://sage.math.washington.edu/home/palmieri/misc/11073/sage-4.8.a4-11073.tar).)



---

archive/issue_comments_134401.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha4):\n \n ```\n-( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )\n+( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )\n [...]\n sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n   ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n``````\n",
    "created_at": "2011-12-24T01:17:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134401",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha4):
 
 ```
-( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )
+( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )
 [...]
 sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
   ***   Warning: new stack size = 1003360 (0.957 Mbytes).
``````




---

archive/issue_comments_134402.json:
```json
{
    "body": "<a id='comment:10'></a>\nNow I also have problems reproducing it.  It must be some strange interaction between several tickets.",
    "created_at": "2011-12-24T01:25:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134402",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Now I also have problems reproducing it.  It must be some strange interaction between several tickets.



---

archive/issue_comments_134403.json:
```json
{
    "body": "<a id='comment:11'></a>\nMaybe it's a race condition of some sort being triggered by #11704?",
    "created_at": "2011-12-24T01:34:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134403",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Maybe it's a race condition of some sort being triggered by #11704?



---

archive/issue_events_140355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-28T22:32:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140355"
}
```



---

archive/issue_events_140356.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-28T22:32:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "008080",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140356"
}
```



---

archive/issue_comments_134404.json:
```json
{
    "body": "<a id='comment:12'></a>\nI can't seem to reproduce this anymore...",
    "created_at": "2011-12-28T22:32:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134404",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>
I can't seem to reproduce this anymore...



---

archive/issue_comments_134405.json:
```json
{
    "body": "<a id='comment:13'></a>\nReproducing it again sometimes when merging #11073...  must be some race condition, which makes it an even more annoying bug.",
    "created_at": "2012-01-04T19:00:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134405",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Reproducing it again sometimes when merging #11073...  must be some race condition, which makes it an even more annoying bug.



---

archive/issue_events_140357.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-04T19:00:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140357"
}
```



---

archive/issue_comments_134406.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,10 +1,6 @@\n-On Gentoo Linux x86_64:\n+On Gentoo Linux x86_64 and on sage.math with #11073:\n \n-```\n-Linux arcanis 2.6.34-gentoo-r12 #4 SMP Thu May 26 19:17:15 EEST 2011 x86_64 Intel(R) Core(TM)2 Duo CPU T5870 @ 2.00GHz GenuineIntel GNU/Linux\n-```\n-\n-When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha4):\n+When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha6 + #11073):\n \n ```\n ( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )\n``````\n",
    "created_at": "2012-01-06T14:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134406",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,10 +1,6 @@
-On Gentoo Linux x86_64:
+On Gentoo Linux x86_64 and on sage.math with #11073:
 
-```
-Linux arcanis 2.6.34-gentoo-r12 #4 SMP Thu May 26 19:17:15 EEST 2011 x86_64 Intel(R) Core(TM)2 Duo CPU T5870 @ 2.00GHz GenuineIntel GNU/Linux
-```
-
-When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha4):
+When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha6 + #11073):
 
 ```
 ( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )
``````




---

archive/issue_comments_134407.json:
```json
{
    "body": "<a id='comment:15'></a>\nThese errors happen much less frequently (but they still do happen) with python-2.7.  At least that's my feeling.",
    "created_at": "2012-01-10T07:22:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134407",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
These errors happen much less frequently (but they still do happen) with python-2.7.  At least that's my feeling.



---

archive/issue_events_140358.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-10T07:22:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "rename": {
        "from": "Failures in gp interface with long $HOME",
        "to": "Failures in gp pexpect interface with #11073"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140358"
}
```



---

archive/issue_comments_134408.json:
```json
{
    "body": "<a id='comment:17'></a>\nImportant data point: the failures seem to happen only (or at least mostly) during the first test run.  Running \"make ptest\" from a fresh install causes a lot of failures.  Running \"make ptest\" a second time gives no (or much less) failures.",
    "created_at": "2012-01-10T23:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134408",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Important data point: the failures seem to happen only (or at least mostly) during the first test run.  Running "make ptest" from a fresh install causes a lot of failures.  Running "make ptest" a second time gives no (or much less) failures.



---

archive/issue_comments_134409.json:
```json
{
    "body": "<a id='comment:18'></a>\nThis observation about the \"first run\" could be because of a cold disk cache causing some race condition.",
    "created_at": "2012-01-10T23:06:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134409",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
This observation about the "first run" could be because of a cold disk cache causing some race condition.



---

archive/issue_comments_134410.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,9 @@\n On Gentoo Linux x86_64 and on sage.math with #11073:\n \n-When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha6 + #11073):\n+With certain values of $HOME (I haven't determined which), failures happen in the gp interface (with sage-4.8.alpha6 + #11073):\n \n ```\n-( export HOME=\"/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )\n+( export HOME=\"/scratch/jdemeyer/merger/sage-4.8.alpha6-remove-base/home\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )\n [...]\n sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n   ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n@@ -63,3 +63,4 @@\n         sage -t  \"devel/sage/sage/schemes/elliptic_curves/period_lattice.py\"\n         sage -t  \"devel/sage/sage/schemes/elliptic_curves/BSD.py\"\n ```\n+(the list of failed tests changes every time I try this, sometimes there are no failures).\n``````\n",
    "created_at": "2012-01-11T14:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134410",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,9 @@
 On Gentoo Linux x86_64 and on sage.math with #11073:
 
-When the home directory $HOME is unusually long, failures happen in the gp interface (with sage-4.8.alpha6 + #11073):
+With certain values of $HOME (I haven't determined which), failures happen in the gp interface (with sage-4.8.alpha6 + #11073):
 
 ```
-( export HOME="/tmp/123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789_123456789/"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes/elliptic_curves )
+( export HOME="/scratch/jdemeyer/merger/sage-4.8.alpha6-remove-base/home"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )
 [...]
 sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
   ***   Warning: new stack size = 1003360 (0.957 Mbytes).
@@ -63,3 +63,4 @@
         sage -t  "devel/sage/sage/schemes/elliptic_curves/period_lattice.py"
         sage -t  "devel/sage/sage/schemes/elliptic_curves/BSD.py"
 ```
+(the list of failed tests changes every time I try this, sometimes there are no failures).
``````




---

archive/issue_comments_134411.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,9 @@\n On Gentoo Linux x86_64 and on sage.math with #11073:\n \n-With certain values of $HOME (I haven't determined which), failures happen in the gp interface (with sage-4.8.alpha6 + #11073):\n+When $HOME is set to a directory inside the Sage install tree, failures sometimes happen in the gp interface (with sage-4.8.alpha6 + #11073):\n \n ```\n-( export HOME=\"/scratch/jdemeyer/merger/sage-4.8.alpha6-remove-base/home\"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )\n+( export HOME=`pwd`/home; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )\n [...]\n sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n   ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n``````\n",
    "created_at": "2012-01-11T14:46:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134411",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,9 @@
 On Gentoo Linux x86_64 and on sage.math with #11073:
 
-With certain values of $HOME (I haven't determined which), failures happen in the gp interface (with sage-4.8.alpha6 + #11073):
+When $HOME is set to a directory inside the Sage install tree, failures sometimes happen in the gp interface (with sage-4.8.alpha6 + #11073):
 
 ```
-( export HOME="/scratch/jdemeyer/merger/sage-4.8.alpha6-remove-base/home"; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )
+( export HOME=`pwd`/home; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )
 [...]
 sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
   ***   Warning: new stack size = 1003360 (0.957 Mbytes).
``````




---

archive/issue_comments_134412.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -54,13 +54,11 @@\n [...]\n The following tests failed:\n \n-\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/gp_simon.py\"\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/lseries_ell.py\"\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/sha_tate.py\"\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_number_field.py\"\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/period_lattice.py\"\n-        sage -t  \"devel/sage/sage/schemes/elliptic_curves/BSD.py\"\n+        sage -t  devel/sage/sage/schemes/elliptic_curves/lseries_ell.py # 1 doctests failed\n+        sage -t  devel/sage/sage/schemes/elliptic_curves/gp_simon.py # 3 doctests failed\n+        sage -t  devel/sage/sage/schemes/elliptic_curves/BSD.py # 3 doctests failed\n+        sage -t  devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 4 doctests failed\n+        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 14 doctests failed\n+        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_number_field.py # 11 doctests failed\n ```\n (the list of failed tests changes every time I try this, sometimes there are no failures).\n``````\n",
    "created_at": "2012-01-11T14:47:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134412",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -54,13 +54,11 @@
 [...]
 The following tests failed:
 
-
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/gp_simon.py"
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/lseries_ell.py"
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/sha_tate.py"
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_number_field.py"
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/period_lattice.py"
-        sage -t  "devel/sage/sage/schemes/elliptic_curves/BSD.py"
+        sage -t  devel/sage/sage/schemes/elliptic_curves/lseries_ell.py # 1 doctests failed
+        sage -t  devel/sage/sage/schemes/elliptic_curves/gp_simon.py # 3 doctests failed
+        sage -t  devel/sage/sage/schemes/elliptic_curves/BSD.py # 3 doctests failed
+        sage -t  devel/sage/sage/schemes/elliptic_curves/sha_tate.py # 4 doctests failed
+        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 14 doctests failed
+        sage -t  devel/sage/sage/schemes/elliptic_curves/ell_number_field.py # 11 doctests failed
 ```
 (the list of failed tests changes every time I try this, sometimes there are no failures).
``````




---

archive/issue_events_140359.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-12T10:41:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "rename": {
        "from": "Failures in gp pexpect interface with #11073",
        "to": "Failures in gp pexpect interface with specific length of $DOT_SAGE"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140359"
}
```



---

archive/issue_comments_134413.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,11 @@\n-On Gentoo Linux x86_64 and on sage.math with #11073:\n+On Gentoo Linux x86_64 and on sage.math:\n \n-When $HOME is set to a directory inside the Sage install tree, failures sometimes happen in the gp interface (with sage-4.8.alpha6 + #11073):\n+When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal.\n+\n+For example, on a 138-column terminal:\n \n ```\n-( export HOME=`pwd`/home; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )\n+( export HOME=/mnt/usb1/scratch/jdemeyer/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )\n [...]\n sage -t  \"devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\"\n   ***   Warning: new stack size = 1003360 (0.957 Mbytes).\n``````\n",
    "created_at": "2012-01-12T10:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134413",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,11 @@
-On Gentoo Linux x86_64 and on sage.math with #11073:
+On Gentoo Linux x86_64 and on sage.math:
 
-When $HOME is set to a directory inside the Sage install tree, failures sometimes happen in the gp interface (with sage-4.8.alpha6 + #11073):
+When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal.
+
+For example, on a 138-column terminal:
 
 ```
-( export HOME=`pwd`/home; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )
+( export HOME=/mnt/usb1/scratch/jdemeyer/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx; mkdir -p $HOME; ./sage -t devel/sage/sage/schemes )
 [...]
 sage -t  "devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py"
   ***   Warning: new stack size = 1003360 (0.957 Mbytes).
``````




---

archive/issue_events_140360.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-12T11:00:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "rename": {
        "from": "Failures in gp pexpect interface with specific length of $DOT_SAGE",
        "to": "Failures in gp pexpect interface with specific length of $DOT_SAGE using a \"screen\" terminal"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140360"
}
```



---

archive/issue_comments_134414.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n-On Gentoo Linux x86_64 and on sage.math:\n+On Gentoo Linux x86_64 and on sage.math running sage-4.8.alpha6 + #11073 (but *without* #12263):\n \n-When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal.\n+Use a \"screen\" terminal.\n+\n+When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (which seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm).\n \n For example, on a 138-column terminal:\n \n@@ -63,4 +65,27 @@\n         sage -t  devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 14 doctests failed\n         sage -t  devel/sage/sage/schemes/elliptic_curves/ell_number_field.py # 11 doctests failed\n ```\n-(the list of failed tests changes every time I try this, sometimes there are no failures).\n+\n+---\n+\n+How to reproduce this more artificially:\n+apply [download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/3edf7a283a26b61c7f329820f1ce02b3.patch](https://github.com/sagemath/sage/files/ticket12221/ab0fccf274b2d97f1a97aad05dd92b26.patch),) and run\n+\n+```\n+$ ./sage test12221.sage\n+```\n+I see\n+\n+```\n+TERM = screen\n+18 char filename: ok\n+19 char filename: ok\n+20 char filename: ok\n+[...]\n+68 char filename: ok\n+69 char filename: ok\n+70 char filename: fail\n+71 char filename: fail\n+72 char filename: fail\n+[...]\n+```\n``````\n",
    "created_at": "2012-01-12T11:00:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134414",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
-On Gentoo Linux x86_64 and on sage.math:
+On Gentoo Linux x86_64 and on sage.math running sage-4.8.alpha6 + #11073 (but *without* #12263):
 
-When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal.
+Use a "screen" terminal.
+
+When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (which seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm).
 
 For example, on a 138-column terminal:
 
@@ -63,4 +65,27 @@
         sage -t  devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # 14 doctests failed
         sage -t  devel/sage/sage/schemes/elliptic_curves/ell_number_field.py # 11 doctests failed
 ```
-(the list of failed tests changes every time I try this, sometimes there are no failures).
+
+---
+
+How to reproduce this more artificially:
+apply [download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/3edf7a283a26b61c7f329820f1ce02b3.patch](https://github.com/sagemath/sage/files/ticket12221/ab0fccf274b2d97f1a97aad05dd92b26.patch),) and run
+
+```
+$ ./sage test12221.sage
+```
+I see
+
+```
+TERM = screen
+18 char filename: ok
+19 char filename: ok
+20 char filename: ok
+[...]
+68 char filename: ok
+69 char filename: ok
+70 char filename: fail
+71 char filename: fail
+72 char filename: fail
+[...]
+```
``````




---

archive/issue_comments_134415.json:
```json
{
    "body": "**Attachment:** [12221_debug.patch.gz](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch.gz)",
    "created_at": "2012-01-12T11:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134415",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [12221_debug.patch.gz](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch.gz)



---

archive/issue_comments_134416.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -69,7 +69,9 @@\n ---\n \n How to reproduce this more artificially:\n-apply [download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/3edf7a283a26b61c7f329820f1ce02b3.patch](https://github.com/sagemath/sage/files/ticket12221/ab0fccf274b2d97f1a97aad05dd92b26.patch),) and run\n+apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  We want to directly call a read() command, controlling the filename length.\n+\n+Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run\n \n ```\n $ ./sage test12221.sage\n``````\n",
    "created_at": "2012-01-12T11:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134416",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -69,7 +69,9 @@
 ---
 
 How to reproduce this more artificially:
-apply [download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/3edf7a283a26b61c7f329820f1ce02b3.patch](https://github.com/sagemath/sage/files/ticket12221/ab0fccf274b2d97f1a97aad05dd92b26.patch),) and run
+apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  We want to directly call a read() command, controlling the filename length.
+
+Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run
 
 ```
 $ ./sage test12221.sage
``````




---

archive/issue_comments_134417.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n \n Use a \"screen\" terminal.\n \n-When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (which seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm).\n+When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (pty).  The pty seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm.\n \n For example, on a 138-column terminal:\n \n@@ -68,10 +68,10 @@\n \n ---\n \n-How to reproduce this more artificially:\n-apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  We want to directly call a read() command, controlling the filename length.\n+**How to reproduce this more artificially**:\n+apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  The problem is the filename length of the temporary files used in the read() command.  This depends on `$DOT_SAGE`, on the hostname, on process IDs.\n \n-Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run\n+Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run (from within a \"screen\" session).  This will execute a read() command with increasing filename lengths:\n \n ```\n $ ./sage test12221.sage\n``````\n",
    "created_at": "2012-01-12T11:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134417",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 
 Use a "screen" terminal.
 
-When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (which seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm).
+When $DOT_SAGE (and therefore, $HOME) contains a specific number of characters in relation to the number of columns on the pseudo-terminal ($COLUMNS), failures happen.  I believe this is due to temporary filenames word-wrapping in the pseudo-terminal (pty).  The pty seems to inherit properties of the actual terminal, that's why there are failures with screen but not with xterm.
 
 For example, on a 138-column terminal:
 
@@ -68,10 +68,10 @@
 
 ---
 
-How to reproduce this more artificially:
-apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  We want to directly call a read() command, controlling the filename length.
+**How to reproduce this more artificially**:
+apply [attachment:12221_debug.patch](https://github.com/sagemath/sage/files/ticket12221/12221_debug.patch).  This will send all gp pexpect commands less than 200 characters directly to gp, without using a temporary file.  The problem is the filename length of the temporary files used in the read() command.  This depends on `$DOT_SAGE`, on the hostname, on process IDs.
 
-Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run
+Download [attachment:test12221.sage](https://github.com/sagemath/sage/files/ticket12221/test12221.sage) and run (from within a "screen" session).  This will execute a read() command with increasing filename lengths:
 
 ```
 $ ./sage test12221.sage
``````




---

archive/issue_comments_134418.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -91,3 +91,5 @@\n 72 char filename: fail\n [...]\n ```\n+\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)\n``````\n",
    "created_at": "2012-01-12T12:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134418",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -91,3 +91,5 @@
 72 char filename: fail
 [...]
 ```
+
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)
``````




---

archive/issue_comments_134419.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -92,4 +92,4 @@\n [...]\n ```\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)\n+**apply** [attachment:12221_pexpect_unset_TERM.patch](https://github.com/sagemath/sage/files/ticket12221/12221_pexpect_unset_TERM.patch) and the **spkg** [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)\n``````\n",
    "created_at": "2012-01-12T13:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134419",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -92,4 +92,4 @@
 [...]
 ```
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)
+**apply** [attachment:12221_pexpect_unset_TERM.patch](https://github.com/sagemath/sage/files/ticket12221/12221_pexpect_unset_TERM.patch) and the **spkg** [http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/pexpect-2.0.p5.spkg)
``````




---

archive/issue_comments_134420.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2012-01-12T13:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134420",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_events_140361.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-12T13:51:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140361"
}
```



---

archive/issue_comments_134421.json:
```json
{
    "body": "<a id='comment:27'></a>\nVery experimental fix seems to work on first sight, certainly needs more testing.",
    "created_at": "2012-01-12T13:51:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134421",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
Very experimental fix seems to work on first sight, certainly needs more testing.



---

archive/issue_comments_134422.json:
```json
{
    "body": "**Changing keywords** from \"gp pexpect\" to \"gp pexpect spkg\".",
    "created_at": "2012-01-12T13:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134422",
    "user": "https://github.com/jdemeyer"
}
```

**Changing keywords** from "gp pexpect" to "gp pexpect spkg".



---

archive/issue_comments_134423.json:
```json
{
    "body": "<a id='comment:29'></a>\nFor the record, I still can't reproduce it on Fedora 16:\n\n```\n\n[vbraun@volker-laptop-two hg]$ hg qapplied\n12221_debug.patch\n[vbraun@volker-laptop-two hg]$ export TERM=screen\n[vbraun@volker-laptop-two hg]$ sage /tmp/test12221.sage \nTERM = screen\n18 char filename: ok\n19 char filename: ok\n[...\n117 char filename: ok\n```",
    "created_at": "2012-01-12T15:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134423",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>
For the record, I still can't reproduce it on Fedora 16:

```

[vbraun@volker-laptop-two hg]$ hg qapplied
12221_debug.patch
[vbraun@volker-laptop-two hg]$ export TERM=screen
[vbraun@volker-laptop-two hg]$ sage /tmp/test12221.sage 
TERM = screen
18 char filename: ok
19 char filename: ok
[...
117 char filename: ok
```



---

archive/issue_comments_134424.json:
```json
{
    "body": "<a id='comment:30'></a>\nI haven't looked at this at all, but it's probably safer to set TERM to `dumb' than unsetting it. (As also evidenced by the termcap crash in #12282)",
    "created_at": "2012-01-12T15:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134424",
    "user": "https://github.com/wjp"
}
```

<a id='comment:30'></a>
I haven't looked at this at all, but it's probably safer to set TERM to `dumb' than unsetting it. (As also evidenced by the termcap crash in #12282)



---

archive/issue_comments_134425.json:
```json
{
    "body": "<a id='comment:31'></a>\nVolker: you need to actually use \"screen\", not just set TERM=screen.\n\nAnd then the obvious: is your `sage` executable the same as `./sage` and did you run `./sage -b`?",
    "created_at": "2012-01-12T15:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134425",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Volker: you need to actually use "screen", not just set TERM=screen.

And then the obvious: is your `sage` executable the same as `./sage` and did you run `./sage -b`?



---

archive/issue_comments_134426.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [@wjp](#comment%3A30):\n> I haven't looked at this at all, but it's probably safer to set TERM to `dumb' than unsetting it. (As also evidenced by the termcap crash in #12282)\n\nI already tried this and unfortunately the error still remains with TERM=dumb.",
    "created_at": "2012-01-12T15:57:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134426",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Replying to [@wjp](#comment%3A30):
> I haven't looked at this at all, but it's probably safer to set TERM to `dumb' than unsetting it. (As also evidenced by the termcap crash in #12282)

I already tried this and unfortunately the error still remains with TERM=dumb.



---

archive/issue_comments_134427.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -87,8 +87,6 @@\n 68 char filename: ok\n 69 char filename: ok\n 70 char filename: fail\n-71 char filename: fail\n-72 char filename: fail\n [...]\n ```\n \n``````\n",
    "created_at": "2012-01-12T15:58:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134427",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -87,8 +87,6 @@
 68 char filename: ok
 69 char filename: ok
 70 char filename: fail
-71 char filename: fail
-72 char filename: fail
 [...]
 ```
 
``````




---

archive/issue_comments_134428.json:
```json
{
    "body": "**Attachment:** [test12221.sage.gz](https://github.com/sagemath/sage/files/ticket12221/test12221.sage.gz)",
    "created_at": "2012-01-12T15:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134428",
    "user": "https://github.com/jdemeyer"
}
```

**Attachment:** [test12221.sage.gz](https://github.com/sagemath/sage/files/ticket12221/test12221.sage.gz)



---

archive/issue_comments_134429.json:
```json
{
    "body": "<a id='comment:34'></a>\nI tried it under `screen` as well without problems. I also tried running the loop longer and this works until I hit the 255 byte filename limit in ext4:\n\n```\n269 char filename: ok\n270 char filename: ok\nTraceback (most recent call last):\n  File \"/tmp/test12221.py\", line 11, in <module>\n    f = open(gpfilename, \"w\")\nIOError: [Errno 36] File name too long: '/tmp/tmppzCAbE/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.gp'\n```",
    "created_at": "2012-01-12T16:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134429",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
I tried it under `screen` as well without problems. I also tried running the loop longer and this works until I hit the 255 byte filename limit in ext4:

```
269 char filename: ok
270 char filename: ok
Traceback (most recent call last):
  File "/tmp/test12221.py", line 11, in <module>
    f = open(gpfilename, "w")
IOError: [Errno 36] File name too long: '/tmp/tmppzCAbE/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx.gp'
```



---

archive/issue_comments_134430.json:
```json
{
    "body": "<a id='comment:35'></a>\nI can reproduce the failing test12221.sage at home in a screen session, but it goes away with TERM=dumb.\n\nOn sage.math the test doesn't fail for me, but I do get a lot of escape sequences (1b 4d, followed by a lot of 1b 5b 43, followed by a 1b 5b 4b) when the length hits 70.",
    "created_at": "2012-01-12T19:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134430",
    "user": "https://github.com/wjp"
}
```

<a id='comment:35'></a>
I can reproduce the failing test12221.sage at home in a screen session, but it goes away with TERM=dumb.

On sage.math the test doesn't fail for me, but I do get a lot of escape sequences (1b 4d, followed by a lot of 1b 5b 43, followed by a 1b 5b 4b) when the length hits 70.



---

archive/issue_comments_134431.json:
```json
{
    "body": "<a id='comment:36'></a>\nWith some terminal capabilities, gp is using escape sequences to \"redraw\" the current line once you send a newline after exactly the right (or wrong) input line length. This redrawing of the current line includes the prompt characters, and that triggers pexpect to output the next command prematurely, getting things out of sync.",
    "created_at": "2012-01-12T20:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134431",
    "user": "https://github.com/wjp"
}
```

<a id='comment:36'></a>
With some terminal capabilities, gp is using escape sequences to "redraw" the current line once you send a newline after exactly the right (or wrong) input line length. This redrawing of the current line includes the prompt characters, and that triggers pexpect to output the next command prematurely, getting things out of sync.



---

archive/issue_comments_134432.json:
```json
{
    "body": "Diff for the pexpect spkg, for review only",
    "created_at": "2012-01-13T10:04:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134432",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the pexpect spkg, for review only



---

archive/issue_comments_134433.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Attachment:** [pexpect-2.0.p4-p5.diff.gz](https://github.com/sagemath/sage/files/ticket12221/pexpect-2.0.p4-p5.diff.gz)",
    "created_at": "2012-01-15T21:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134433",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
**Attachment:** [pexpect-2.0.p4-p5.diff.gz](https://github.com/sagemath/sage/files/ticket12221/pexpect-2.0.p4-p5.diff.gz)



---

archive/issue_comments_134434.json:
```json
{
    "body": "**Merged:** sage-5.0.beta0",
    "created_at": "2012-01-15T21:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134434",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta0



---

archive/issue_comments_134435.json:
```json
{
    "body": "<a id='comment:38'></a>\nWell,\nI'm not too fond of mixing up the change of \"eval_using_file_cutoff\" value from 50 to 1024 (in \"12221_pexpect_unset_TERM.patch\") on the one hand, and the safer handling of the \"TERM\" envorinment variable on the other hand --- these seem orthogonal action items to me, being worth independent tickets.\n\nHowever, none of these changes makes the situation worse than before, and the cleaning up of the pexpect spkg alone is worth to have this getting in the main tree as soon as possible.\n\n\nCheers,\nGeorg",
    "created_at": "2012-01-20T13:26:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134435",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

<a id='comment:38'></a>
Well,
I'm not too fond of mixing up the change of "eval_using_file_cutoff" value from 50 to 1024 (in "12221_pexpect_unset_TERM.patch") on the one hand, and the safer handling of the "TERM" envorinment variable on the other hand --- these seem orthogonal action items to me, being worth independent tickets.

However, none of these changes makes the situation worse than before, and the cleaning up of the pexpect spkg alone is worth to have this getting in the main tree as soon as possible.


Cheers,
Georg



---

archive/issue_events_140362.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-01-20T13:26:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140362"
}
```



---

archive/issue_events_140363.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-01-20T13:26:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140363"
}
```



---

archive/issue_comments_134436.json:
```json
{
    "body": "**Reviewer:** Georg S. Weber",
    "created_at": "2012-01-20T13:26:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134436",
    "user": "https://github.com/sagetrac-GeorgSWeber"
}
```

**Reviewer:** Georg S. Weber



---

archive/issue_comments_134437.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [GeorgSWeber](#comment%3A38):\n> Well,\n> I'm not too fond of mixing up the change of \"eval_using_file_cutoff\" value from 50 to 1024 (in \"12221_pexpect_unset_TERM.patch\") on the one hand, and the safer handling of the \"TERM\" envorinment variable on the other hand --- these seem orthogonal action items to me, being worth independent tickets.\n\nFair enough, see #12330.",
    "created_at": "2012-01-20T13:40:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134437",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'></a>
Replying to [GeorgSWeber](#comment%3A38):
> Well,
> I'm not too fond of mixing up the change of "eval_using_file_cutoff" value from 50 to 1024 (in "12221_pexpect_unset_TERM.patch") on the one hand, and the safer handling of the "TERM" envorinment variable on the other hand --- these seem orthogonal action items to me, being worth independent tickets.

Fair enough, see #12330.



---

archive/issue_events_140364.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-20T13:43:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140364"
}
```



---

archive/issue_events_140365.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-20T13:43:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12221#event-140365"
}
```



---

archive/issue_comments_134438.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Attachment:** [12221_pexpect_unset_TERM.patch.gz](https://github.com/sagemath/sage/files/ticket12221/12221_pexpect_unset_TERM.patch.gz)",
    "created_at": "2012-01-20T13:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134438",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
**Attachment:** [12221_pexpect_unset_TERM.patch.gz](https://github.com/sagemath/sage/files/ticket12221/12221_pexpect_unset_TERM.patch.gz)



---

archive/issue_comments_134439.json:
```json
{
    "body": "<a id='comment:41'></a>\nGeorg, would you mind reviewing #12330 then?",
    "created_at": "2012-01-20T13:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12221",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12221#issuecomment-134439",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:41'></a>
Georg, would you mind reviewing #12330 then?
