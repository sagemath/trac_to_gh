# Issue 12876: Fix element and parent classes of Hom categories to be abstract, and simplify the Hom logic.

archive/issues_012704.json:
```json
{
    "assignees": [
        "https://github.com/nthiery"
    ],
    "body": "This patch fixes the parent and element classes for Hom categories to\nbe purely abstract, and simplifies the Hom logic:\n\n- Unified the logic for selecting the class when building a Homset\n  (e.g. Homset, RingHomset, HeckeModuleHomspace, ...). This is now\n  systematically done through the `_Hom_` hook. The logic still has a\n  fundamental flaw, but that's for the later #10668.\n- The cache for Hom is handled at a single point in Hom\n  In particular, homsets created via the `_Hom_` hook are now unique.\n- If category is None, Hom simply calls itself with the meet of the\n  categories of the parent, which removes a cache handling duplication\n  in the code\n- Parent.Hom calls  Hom directly (removes duplicate `_Hom_` logic).\n- ParentWithBase.Hom was redundant and is gone.\n- Reduce the footprint of the current trick to delegate\n  Hom(F,F)(on_basis=...) to module_morphism, allow for the diagonal\n  option too, an make sure the homset category is set properly.\n- Update a doctest in sage.modules.vector_space_homspace to take into\n  account that homsets created via `_Hom_` are now unique.\n- Scheme is (apparently) an abstract base class; so it should not be\n  instantiated. I changed some doctests in\n  sage.schemes.generic.SchemeMorphism to use instead the concrete\n  Spec(ZZ). Those doctests were breaking because Scheme does not\n  implement equality, which is required for Hom caching.\n\nAs a byproduct, the HeckeModules category does not import any more\nHeckeModulesHomspace, which was a recurrent source of import loops.\n\n#11935 depends on this ticket\n\nApply:\n\n* [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n\n\nDepends on #715\nDepends on #11521\nDepends on #12215\nDepends on #12313\nDepends on #13412\nDepends on #13145\nDepends on #14159\nDepends on #13184\nDepends on #14287\nDepends on #14217\n\nCC:  @sagetrac-sage-combinat @simon-king-jena\n\nComponent: **categories**\n\nKeywords: **Hom**\n\nAuthor: **Nicolas M. Thi\u00e9ry**\n\nReviewer: **Simon King**\n\nMerged: **sage-5.11.beta0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12876_\n\n",
    "closed_at": "2013-06-06T12:31:56Z",
    "created_at": "2012-04-24T21:55:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20categories",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20categories"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.11",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix element and parent classes of Hom categories to be abstract, and simplify the Hom logic.",
    "type": "issue",
    "updated_at": "2013-06-06T12:31:56Z",
    "url": "https://github.com/sagemath/sage/issues/12876",
    "user": "https://github.com/nthiery"
}
```
This patch fixes the parent and element classes for Hom categories to
be purely abstract, and simplifies the Hom logic:

- Unified the logic for selecting the class when building a Homset
  (e.g. Homset, RingHomset, HeckeModuleHomspace, ...). This is now
  systematically done through the `_Hom_` hook. The logic still has a
  fundamental flaw, but that's for the later #10668.
- The cache for Hom is handled at a single point in Hom
  In particular, homsets created via the `_Hom_` hook are now unique.
- If category is None, Hom simply calls itself with the meet of the
  categories of the parent, which removes a cache handling duplication
  in the code
- Parent.Hom calls  Hom directly (removes duplicate `_Hom_` logic).
- ParentWithBase.Hom was redundant and is gone.
- Reduce the footprint of the current trick to delegate
  Hom(F,F)(on_basis=...) to module_morphism, allow for the diagonal
  option too, an make sure the homset category is set properly.
- Update a doctest in sage.modules.vector_space_homspace to take into
  account that homsets created via `_Hom_` are now unique.
- Scheme is (apparently) an abstract base class; so it should not be
  instantiated. I changed some doctests in
  sage.schemes.generic.SchemeMorphism to use instead the concrete
  Spec(ZZ). Those doctests were breaking because Scheme does not
  implement equality, which is required for Hom caching.

As a byproduct, the HeckeModules category does not import any more
HeckeModulesHomspace, which was a recurrent source of import loops.

#11935 depends on this ticket

Apply:

* [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)


Depends on #715
Depends on #11521
Depends on #12215
Depends on #12313
Depends on #13412
Depends on #13145
Depends on #14159
Depends on #13184
Depends on #14287
Depends on #14217

CC:  @sagetrac-sage-combinat @simon-king-jena

Component: **categories**

Keywords: **Hom**

Author: **Nicolas M. Thi√©ry**

Reviewer: **Simon King**

Merged: **sage-5.11.beta0**

_Issue created by migration from https://trac.sagemath.org/ticket/12876_





---

archive/issue_events_176048.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:55:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176048"
}
```



---

archive/issue_events_176049.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20categories",
    "label_color": "0000ff",
    "label_name": "c: categories",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176049"
}
```



---

archive/issue_events_176050.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176050"
}
```



---

archive/issue_events_176051.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176051"
}
```



---

archive/issue_events_176052.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:55:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20categories",
    "label_color": "0000ff",
    "label_name": "c: categories",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176052"
}
```



---

archive/issue_events_176053.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:55:40Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "subject": "https://github.com/nthiery",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176053"
}
```



---

archive/issue_events_176054.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-04-24T21:57:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176054"
}
```



---

archive/issue_comments_145275.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nNote: this might depend on #12875",
    "created_at": "2012-04-24T21:57:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145275",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:1" align="right">comment:1</div>

Note: this might depend on #12875



---

archive/issue_comments_145276.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -24,3 +24,4 @@\n As a byproduct, the HeckeModules category does not import any more\n HeckeModulesHomspace, which was a recurrent source of import loops.\n \n+#11935 depends on this ticket\n``````\n",
    "created_at": "2012-04-24T21:58:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145276",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -24,3 +24,4 @@
 As a byproduct, the HeckeModules category does not import any more
 HeckeModulesHomspace, which was a recurrent source of import loops.
 
+#11935 depends on this ticket
``````




---

archive/issue_comments_145277.json:
```json
{
    "body": "Reviewer: **Simon King**",
    "created_at": "2012-04-24T22:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145277",
    "user": "https://github.com/nthiery"
}
```

Reviewer: **Simon King**



---

archive/issue_comments_145278.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNote: there are two doctests failures that I don't know how to handle, related to the refcounting of Singular rings::\n\n```\n\nsage -t  devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx\n**********************************************************************\nFile \"/opt/sage-5.0.beta11/devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 418:\n    sage: len(ring_refcount_dict) == n\nExpected:\n    True\nGot:\n    False\nsage -t  devel/sage-combinat/sage/libs/singular/ring.pyx\n**********************************************************************\nFile \"/opt/sage-5.0.beta11/devel/sage-combinat/sage/libs/singular/ring.pyx\", line 469:\n    sage: ring_ptr in ring_refcount_dict\nExpected:\n    False\nGot:\n    True\n```\n\nHelp fixing those welcome!",
    "created_at": "2012-04-24T22:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145278",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:3" align="right">comment:3</div>

Note: there are two doctests failures that I don't know how to handle, related to the refcounting of Singular rings::

```

sage -t  devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx
**********************************************************************
File "/opt/sage-5.0.beta11/devel/sage-combinat/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 418:
    sage: len(ring_refcount_dict) == n
Expected:
    True
Got:
    False
sage -t  devel/sage-combinat/sage/libs/singular/ring.pyx
**********************************************************************
File "/opt/sage-5.0.beta11/devel/sage-combinat/sage/libs/singular/ring.pyx", line 469:
    sage: ring_ptr in ring_refcount_dict
Expected:
    False
Got:
    True
```

Help fixing those welcome!



---

archive/issue_comments_145279.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThe updated patch includes two small related improvements I had in later patches. I moved them here to resolve the conflict.",
    "created_at": "2012-04-25T00:13:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145279",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:4" align="right">comment:4</div>

The updated patch includes two small related improvements I had in later patches. I moved them here to resolve the conflict.



---

archive/issue_comments_145280.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,8 @@\n - Parent.Hom calls  Hom directly (removes duplicate `_Hom_` logic).\n - ParentWithBase.Hom was redundant and is gone.\n - Reduce the footprint of the current trick to delegate\n-  Hom(F,F)(on_basis=...) to module_morphism.\n+  Hom(F,F)(on_basis=...) to module_morphism, allow for the diagonal\n+  option too, an make sure the homset category is set properly.\n - Update a doctest in sage.modules.vector_space_homspace to take into\n   account that homsets created via `_Hom_` are now unique.\n - Scheme is (apparently) an abstract base class; so it should not be\n``````\n",
    "created_at": "2012-04-25T00:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145280",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,8 @@
 - Parent.Hom calls  Hom directly (removes duplicate `_Hom_` logic).
 - ParentWithBase.Hom was redundant and is gone.
 - Reduce the footprint of the current trick to delegate
-  Hom(F,F)(on_basis=...) to module_morphism.
+  Hom(F,F)(on_basis=...) to module_morphism, allow for the diagonal
+  option too, an make sure the homset category is set properly.
 - Update a doctest in sage.modules.vector_space_homspace to take into
   account that homsets created via `_Hom_` are now unique.
 - Scheme is (apparently) an abstract base class; so it should not be
``````




---

archive/issue_comments_145281.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nOops. The updated patch includes two further hunks I had forgotten.",
    "created_at": "2012-04-25T00:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145281",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:6" align="right">comment:6</div>

Oops. The updated patch includes two further hunks I had forgotten.



---

archive/issue_comments_145282.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nArr, yet another missing hunk ... Time to go to bed!",
    "created_at": "2012-04-25T00:46:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145282",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:7" align="right">comment:7</div>

Arr, yet another missing hunk ... Time to go to bed!



---

archive/issue_comments_145283.json:
```json
{
    "body": "Dependencies: **#12877**",
    "created_at": "2012-04-25T13:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145283",
    "user": "https://github.com/nthiery"
}
```

Dependencies: **#12877**



---

archive/issue_comments_145284.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFor the record, all test passed on 5.0.beta13, with #12875 and #12877 applied (and a couple unrelated ones). I expect no dependency upon #12875, but can't swear at this point.",
    "created_at": "2012-04-25T13:53:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145284",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:8" align="right">comment:8</div>

For the record, all test passed on 5.0.beta13, with #12875 and #12877 applied (and a couple unrelated ones). I expect no dependency upon #12875, but can't swear at this point.



---

archive/issue_comments_145285.json:
```json
{
    "body": "Changed dependencies from **#12877** to **#12875, #12877**",
    "created_at": "2012-04-25T14:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145285",
    "user": "https://github.com/nthiery"
}
```

Changed dependencies from **#12877** to **#12875, #12877**



---

archive/issue_comments_145286.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nthiery](#comment%3A8):\n> I expect no dependency upon #12875, but can't swear at this point.\n\nActually it does depend on #12875.",
    "created_at": "2012-04-25T14:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145286",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nthiery](#comment%3A8):
> I expect no dependency upon #12875, but can't swear at this point.

Actually it does depend on #12875.



---

archive/issue_events_176055.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-26T16:38:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176055"
}
```



---

archive/issue_events_176056.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-26T16:38:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176056"
}
```



---

archive/issue_comments_145287.json:
```json
{
    "body": "Work Issues: **Fix ring_refcount_dict problem**",
    "created_at": "2012-04-26T16:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145287",
    "user": "https://github.com/simon-king-jena"
}
```

Work Issues: **Fix ring_refcount_dict problem**



---

archive/issue_comments_145288.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWith #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:\n\n```\n\tsage -t  -force_lib \"devel/sage/sage/libs/singular/ring.pyx\"\n\tsage -t  -force_lib \"devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx\"\n```\nNamely:\n\n```\nsage -t -force_lib \"devel/sage/sage/libs/singular/ring.pyx\" \n**********************************************************************\nFile \"/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/libs/singular/ring.pyx\", line 469:\n    sage: ring_ptr in ring_refcount_dict\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n```\nand\n\n```\nsage -t -force_lib \"devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx\", line 418:\n    sage: len(ring_refcount_dict) == n\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\nSo, apparently it is only a single problem.",
    "created_at": "2012-04-26T16:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145288",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:11" align="right">comment:11</div>

With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:

```
	sage -t  -force_lib "devel/sage/sage/libs/singular/ring.pyx"
	sage -t  -force_lib "devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx"
```
Namely:

```
sage -t -force_lib "devel/sage/sage/libs/singular/ring.pyx" 
**********************************************************************
File "/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/libs/singular/ring.pyx", line 469:
    sage: ring_ptr in ring_refcount_dict
Expected:
    False
Got:
    True
**********************************************************************
```
and

```
sage -t -force_lib "devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx"
**********************************************************************
File "/mnt/local/king/SAGE/experiment/notebook/sage-5.1.notebook/devel/sage/sage/rings/polynomial/multi_polynomial_libsingular.pyx", line 418:
    sage: len(ring_refcount_dict) == n
Expected:
    True
Got:
    False
**********************************************************************
```

So, apparently it is only a single problem.



---

archive/issue_comments_145289.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nPS: I just verified that the problem also occurs without #12808.",
    "created_at": "2012-04-26T16:40:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145289",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

PS: I just verified that the problem also occurs without #12808.



---

archive/issue_comments_145290.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@simon-king-jena](#comment%3A11):\n> With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:\n\nYeah, I know (see comment 3 above). I feel quite stuck with those\nfailures, and would really appreciate if you could investigate them\nsince you know much better than me the caching for Singular rings.\n\nThanks!\n\nCheers,\n                            Nicolas",
    "created_at": "2012-04-26T17:08:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145290",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@simon-king-jena](#comment%3A11):
> With #12808, #12875 and #12877 applied on top of sage-5.1.notebook, all doctests pass. But when adding the patch from here, there are two problems:

Yeah, I know (see comment 3 above). I feel quite stuck with those
failures, and would really appreciate if you could investigate them
since you know much better than me the caching for Singular rings.

Thanks!

Cheers,
                            Nicolas



---

archive/issue_comments_145291.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIn one of my \"weak caching\" patches (see #11521), I also had to fix a ring_refcount_dict test. Thus, I tried to see whether applying #11521 in addition to your patch helps. Unfortunately there is an incompatibility, so, it is not resolved yet.",
    "created_at": "2012-04-27T05:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145291",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

In one of my "weak caching" patches (see #11521), I also had to fix a ring_refcount_dict test. Thus, I tried to see whether applying #11521 in addition to your patch helps. Unfortunately there is an incompatibility, so, it is not resolved yet.



---

archive/issue_comments_145292.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSince there is a positive review for #11521 and #715 (which belong together and have otherwise no pending dependency), could you consider to rebase your patch relative to #11521?",
    "created_at": "2012-04-27T07:17:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145292",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

Since there is a positive review for #11521 and #715 (which belong together and have otherwise no pending dependency), could you consider to rebase your patch relative to #11521?



---

archive/issue_comments_145293.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nPS: I am just attempting a rebase, to see whether #11521 fixes the ring_refcount_dict problem.",
    "created_at": "2012-04-27T07:21:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145293",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:16" align="right">comment:16</div>

PS: I am just attempting a rebase, to see whether #11521 fixes the ring_refcount_dict problem.



---

archive/issue_comments_145294.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nHere is the rejection:\n\n```diff\n--- homset.py\n+++ homset.py\n@@ -165,43 +203,27 @@ def Hom(X, Y, category=None):\n             if H.domain() is X and H.codomain() is Y:\n                 return H\n \n-    try:\n-        return X._Hom_(Y, category)\n-    except (AttributeError, TypeError):\n-        pass\n-\n     cat_X = X.category()\n     cat_Y = Y.category()\n     if category is None:\n-        category = cat_X._meet_(cat_Y)\n-    elif isinstance(category, Category):\n-        if not cat_X.is_subcategory(category):\n-            raise TypeError, \"%s is not in %s\"%(X, category)\n-        if not cat_Y.is_subcategory(category):\n-            raise TypeError, \"%s is not in %s\"%(Y, category)\n-    else:\n+        return Hom(X,Y,category=cat_X._meet_(cat_Y))\n+    if not isinstance(category, Category):\n         raise TypeError, \"Argument category (= %s) must be a category.\"%category\n-    # Now, as the category may have changed, we try to find the hom set in the cache, again:\n-    key = (X,Y,category)\n-    if _cache.has_key(key):\n-        H = _cache[key]()\n-        if H:\n-            # Are domain or codomain breaking the unique parent condition?\n-            if H.domain() is X and H.codomain() is Y:\n-                return H\n-\n-    # coercing would be incredibly annoying, since the domain and codomain\n-    # are totally different objects\n-    #X = category(X); Y = category(Y)\n+    if not cat_X.is_subcategory(category):\n+        raise TypeError, \"%s is not in %s\"%(X, category)\n+    if not cat_Y.is_subcategory(category):\n+        raise TypeError, \"%s is not in %s\"%(Y, category)\n \n     # construct H\n     # Design question: should the Homset classes get the category or the homset category?\n     # For the moment, this is the category, for compatibility with the current implementations\n     # of Homset in rings, schemes, ...\n-    H = category.hom_category().parent_class(X, Y, category = category)\n-            \n-    ##_cache[key] = weakref.ref(H)\n-    _cache[(X, Y, category)] = weakref.ref(H)\n+    from sets_cat import Sets\n+    try:\n+        H = X._Hom_(Y, category)\n+    except (AttributeError, TypeError):\n+        H = Homset(X, Y, category = category)\n+    _cache[key] = weakref.ref(H)\n     return H\n \n def hom(X, Y, f):\n```\n\nWhy do you import Sets (new line 221)?\n\nDo I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?",
    "created_at": "2012-04-27T07:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145294",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Here is the rejection:

```diff
--- homset.py
+++ homset.py
@@ -165,43 +203,27 @@ def Hom(X, Y, category=None):
             if H.domain() is X and H.codomain() is Y:
                 return H
 
-    try:
-        return X._Hom_(Y, category)
-    except (AttributeError, TypeError):
-        pass
-
     cat_X = X.category()
     cat_Y = Y.category()
     if category is None:
-        category = cat_X._meet_(cat_Y)
-    elif isinstance(category, Category):
-        if not cat_X.is_subcategory(category):
-            raise TypeError, "%s is not in %s"%(X, category)
-        if not cat_Y.is_subcategory(category):
-            raise TypeError, "%s is not in %s"%(Y, category)
-    else:
+        return Hom(X,Y,category=cat_X._meet_(cat_Y))
+    if not isinstance(category, Category):
         raise TypeError, "Argument category (= %s) must be a category."%category
-    # Now, as the category may have changed, we try to find the hom set in the cache, again:
-    key = (X,Y,category)
-    if _cache.has_key(key):
-        H = _cache[key]()
-        if H:
-            # Are domain or codomain breaking the unique parent condition?
-            if H.domain() is X and H.codomain() is Y:
-                return H
-
-    # coercing would be incredibly annoying, since the domain and codomain
-    # are totally different objects
-    #X = category(X); Y = category(Y)
+    if not cat_X.is_subcategory(category):
+        raise TypeError, "%s is not in %s"%(X, category)
+    if not cat_Y.is_subcategory(category):
+        raise TypeError, "%s is not in %s"%(Y, category)
 
     # construct H
     # Design question: should the Homset classes get the category or the homset category?
     # For the moment, this is the category, for compatibility with the current implementations
     # of Homset in rings, schemes, ...
-    H = category.hom_category().parent_class(X, Y, category = category)
-            
-    ##_cache[key] = weakref.ref(H)
-    _cache[(X, Y, category)] = weakref.ref(H)
+    from sets_cat import Sets
+    try:
+        H = X._Hom_(Y, category)
+    except (AttributeError, TypeError):
+        H = Homset(X, Y, category = category)
+    _cache[key] = weakref.ref(H)
     return H
 
 def hom(X, Y, f):
```

Why do you import Sets (new line 221)?

Do I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?



---

archive/issue_comments_145295.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAnother point: I had inserted a comment in #11521, namely \"Apparently `_Hom_` is supposed to be cached.\" This is why I did not insert stuff in the (weak) cache.\n\nDo you lift that assumption? Then, we should see what `_Hom_` methods actually do caching. They should at most do *weak* caching.",
    "created_at": "2012-04-27T07:38:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145295",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:18" align="right">comment:18</div>

Another point: I had inserted a comment in #11521, namely "Apparently `_Hom_` is supposed to be cached." This is why I did not insert stuff in the (weak) cache.

Do you lift that assumption? Then, we should see what `_Hom_` methods actually do caching. They should at most do *weak* caching.



---

archive/issue_comments_145296.json:
```json
{
    "body": "Attachment: **[trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)**\n\nNicolas' patch rebased rel #11521",
    "created_at": "2012-04-27T07:47:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145296",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)**

Nicolas' patch rebased rel #11521



---

archive/issue_comments_145297.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI have rebased your patch relative to #11521 (as I said: This already has positive review).\n\nPlease have a look whether you are happy with my changes: I only changed sage/categories/homset.py, by using the :trac: directive in two places, fixing one hunk that has only applied with fuzz and removing the import of Sets. Apart from that, I adopted your logic of constructing the homset.\n\nSo far, I have tested sage/categories/homset.py and have verified that the previously failing tests are indeed fixed by #11521 (in fact, I also had some other pathes applied, but I am convinced that ##11521 suffices). I am now running the full tests suite, with *only* #11521 (and its dependency #715) and the new patch (and its dependencies #12875 and #12877).\n\nApply trac_12876_category-fix_abstract_class-nt-rel11521.patch",
    "created_at": "2012-04-27T08:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145297",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

I have rebased your patch relative to #11521 (as I said: This already has positive review).

Please have a look whether you are happy with my changes: I only changed sage/categories/homset.py, by using the :trac: directive in two places, fixing one hunk that has only applied with fuzz and removing the import of Sets. Apart from that, I adopted your logic of constructing the homset.

So far, I have tested sage/categories/homset.py and have verified that the previously failing tests are indeed fixed by #11521 (in fact, I also had some other pathes applied, but I am convinced that ##11521 suffices). I am now running the full tests suite, with *only* #11521 (and its dependency #715) and the new patch (and its dependencies #12875 and #12877).

Apply trac_12876_category-fix_abstract_class-nt-rel11521.patch



---

archive/issue_events_176057.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-27T08:01:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176057"
}
```



---

archive/issue_events_176058.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-27T08:01:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176058"
}
```



---

archive/issue_comments_145298.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -26,3 +26,7 @@\n HeckeModulesHomspace, which was a recurrent source of import loops.\n \n #11935 depends on this ticket\n+\n+Apply:\n+\n+ [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)\n``````\n",
    "created_at": "2012-04-27T08:01:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145298",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -26,3 +26,7 @@
 HeckeModulesHomspace, which was a recurrent source of import loops.
 
 #11935 depends on this ticket
+
+Apply:
+
+ [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)
``````




---

archive/issue_comments_145299.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nHm. With sage-5.0.beta13 plus #715, #11521, #12875, #12877 and [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz), I get one error, namely a segfault in\n\n```\nsage -t -force_lib \"devel/sage/sage/rings/number_field/number_field_rel.py\"\n```\n\nBut strange enough: When I ran it with --verbose, all tests passed, and the segfault came from leaving sage. That reminds me another problem: The deallocation of the (unique) pari instance is not done as it is supposed to be. This is fixed by the second patch of #12215. Hence, I am trying again, with #12215 added.",
    "created_at": "2012-04-27T11:40:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145299",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">comment:20</div>

Hm. With sage-5.0.beta13 plus #715, #11521, #12875, #12877 and [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz), I get one error, namely a segfault in

```
sage -t -force_lib "devel/sage/sage/rings/number_field/number_field_rel.py"
```

But strange enough: When I ran it with --verbose, all tests passed, and the segfault came from leaving sage. That reminds me another problem: The deallocation of the (unique) pari instance is not done as it is supposed to be. This is fixed by the second patch of #12215. Hence, I am trying again, with #12215 added.



---

archive/issue_comments_145300.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nYes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?",
    "created_at": "2012-04-27T11:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145300",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">comment:21</div>

Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?



---

archive/issue_comments_145301.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,4 +29,5 @@\n \n Apply:\n \n- [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)\n+* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)\n+* [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)\n``````\n",
    "created_at": "2012-04-27T13:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145301",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,4 +29,5 @@
 
 Apply:
 
- [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)
+* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)
+* [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)
``````




---

archive/issue_comments_145302.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nWith sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz), all doc tests pass.\n\nI made some additional cosmetic changes in a reviewer patch.\n\nFurther questions:\n\nIn sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.\n\nI see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?\nBut then, shouldn't `__getnewargs__` be removed as well?\n\nPlease tell whether you want to address these questions in an additional patch. And  I hope you agree with adding #715, #11521 and #12215 to the dependencies? Only #12215 needs review (hint...).\n\nIf you do agree, then put this to *positive review*, please.\n\nApply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch",
    "created_at": "2012-04-27T13:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145302",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:22" align="right">comment:22</div>

With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz), all doc tests pass.

I made some additional cosmetic changes in a reviewer patch.

Further questions:

In sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.

I see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?
But then, shouldn't `__getnewargs__` be removed as well?

Please tell whether you want to address these questions in an additional patch. And  I hope you agree with adding #715, #11521 and #12215 to the dependencies? Only #12215 needs review (hint...).

If you do agree, then put this to *positive review*, please.

Apply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch



---

archive/issue_comments_145303.json:
```json
{
    "body": "Changed dependencies from **#12875, #12877** to **#715, #11521, #12875, #12877, #12215**",
    "created_at": "2012-04-27T13:58:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145303",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#12875, #12877** to **#715, #11521, #12875, #12877, #12215**



---

archive/issue_comments_145304.json:
```json
{
    "body": "Attachment: **[trac_12876-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)**",
    "created_at": "2012-04-27T14:00:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145304",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac_12876-reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)**



---

archive/issue_comments_145305.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nSorry, I made a last-minute change in the reviewer patch (namely, by mistake, I changed \"ticket ???\" into \"ticket 12876\", but I think ??? really refers to a ticket that has not been created, yet. Anyway, feel free to change ??? into something real! And disregard trac_12876-reviewer.2.patch, which was created by mistake.\n\nApply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch",
    "created_at": "2012-04-27T14:02:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145305",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

Sorry, I made a last-minute change in the reviewer patch (namely, by mistake, I changed "ticket ???" into "ticket 12876", but I think ??? really refers to a ticket that has not been created, yet. Anyway, feel free to change ??? into something real! And disregard trac_12876-reviewer.2.patch, which was created by mistake.

Apply trac_12876_category-fix_abstract_class-nt-rel11521.patch trac_12876-reviewer.patch



---

archive/issue_comments_145306.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI tried whether one can remove the `__new__` and `__getnewargs__` methods. However, when doing so, one gets a reproducible timeout in the tests for sage/rings/polynomial/multi_polynomial_sequence.py - that's the only error.\n\nSo, better keep it as it is.\n\nRecall: I would give it a positive review, if you agree with the additional dependencies.",
    "created_at": "2012-04-27T16:20:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145306",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:24" align="right">comment:24</div>

I tried whether one can remove the `__new__` and `__getnewargs__` methods. However, when doing so, one gets a reproducible timeout in the tests for sage/rings/polynomial/multi_polynomial_sequence.py - that's the only error.

So, better keep it as it is.

Recall: I would give it a positive review, if you agree with the additional dependencies.



---

archive/issue_comments_145307.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@simon-king-jena](#comment%3A17):\n> Do I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?\n\nI did not test it. But it simplifies quite much the logic and the calling overhead occurs only for the first call, so I assumed it was negligible.",
    "created_at": "2012-04-27T17:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145307",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@simon-king-jena](#comment%3A17):
> Do I understand correctly: If Hom receives None as category, then you determine the category as the meet of the categories of domain and codomain, and call Hom again. Did you test that the calling overhead does not matter?

I did not test it. But it simplifies quite much the logic and the calling overhead occurs only for the first call, so I assumed it was negligible.



---

archive/issue_comments_145308.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@simon-king-jena](#comment%3A21):\n> Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?\n\nThat's ok for me. Thanks for tracking all of those down! I'll try to review #12215, but that probably won't be before Monday.",
    "created_at": "2012-04-27T17:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145308",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@simon-king-jena](#comment%3A21):
> Yes! Adding #12215 fixes the segfault. I am now running doctests. Do you mind adding it as another dependency, provided that the test suite passes?

That's ok for me. Thanks for tracking all of those down! I'll try to review #12215, but that probably won't be before Monday.



---

archive/issue_comments_145309.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nHi Simon!\n\nReplying to [@simon-king-jena](#comment%3A22):\n> With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz), all doc tests pass.\n\nCool!\n> In sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.\n\nOops. Those are #12879 and #12880 respectively.\n> \n> I see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?\n> But then, shouldn't `__getnewargs__` be removed as well?\n\nYes, that was my intention indeed: in principle they should not be needed, and I forgot to remove them. I'll investigate the failure you report on Monday, unless you beat me to it.\n\n\n> Please tell whether you want to address these questions in an additional patch.\n\nUnless removing `__getnewargs__` turns out to be hard, I'd rather fix all of the above right now.\nFeel free to experiment: I won't download the patches before Monday.\n\nThanks a lot for all your quick work on this :-)",
    "created_at": "2012-04-27T17:25:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145309",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:27" align="right">comment:27</div>

Hi Simon!

Replying to [@simon-king-jena](#comment%3A22):
> With sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz), all doc tests pass.

Cool!
> In sage/category/hecke_modules.py, you refer to ticket number ??? for fixing _test_zero and _test_elements. In sage/schemes/elliptic_curves/ell_curve_isogeny.py, you leave a reference to trac open as well. Have the tickets now been created? I didn't fix that yet.

Oops. Those are #12879 and #12880 respectively.
> 
> I see that you rename `Rings.HomCategory.ParentMethods.__new__` into `__new__bx`. Does that mean the ugly `__new__` method ought to be removed (finally!)?
> But then, shouldn't `__getnewargs__` be removed as well?

Yes, that was my intention indeed: in principle they should not be needed, and I forgot to remove them. I'll investigate the failure you report on Monday, unless you beat me to it.


> Please tell whether you want to address these questions in an additional patch.

Unless removing `__getnewargs__` turns out to be hard, I'd rather fix all of the above right now.
Feel free to experiment: I won't download the patches before Monday.

Thanks a lot for all your quick work on this :-)



---

archive/issue_comments_145310.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@simon-king-jena](#comment%3A18):\n> Another point: I had inserted a comment in #11521, namely \"Apparently `_Hom_` is supposed to be cached.\" This is why I did not insert stuff in the (weak) cache.\n> \n> Do you lift that assumption? Then, we should see what `_Hom_` methods actually do caching. They should at most do *weak* caching.\n\nYes: I consider that all the caching logic should be in Hom; in particular the `_Hom_` methods should not do caching (and if I recall correctly, they currently don't). We should probably add a note about this in the documentation of Hom.",
    "created_at": "2012-04-27T17:31:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145310",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@simon-king-jena](#comment%3A18):
> Another point: I had inserted a comment in #11521, namely "Apparently `_Hom_` is supposed to be cached." This is why I did not insert stuff in the (weak) cache.
> 
> Do you lift that assumption? Then, we should see what `_Hom_` methods actually do caching. They should at most do *weak* caching.

Yes: I consider that all the caching logic should be in Hom; in particular the `_Hom_` methods should not do caching (and if I recall correctly, they currently don't). We should probably add a note about this in the documentation of Hom.



---

archive/issue_comments_145311.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI have uploaded a reviewer's patch which fixes the trac ticket numbers, and removes completely Rings.HomCategory. I could not reproduce the timeout:\n\n```\nsage -t  \"devel/sage-combinat/sage/rings/polynomial/multi_polynomial_sequence.py\"\n\t [8.6 s]\n```\n\nCan you check again?\n\nIf you are happy with the change, please fold everything, and set a positive review.",
    "created_at": "2012-04-30T08:19:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145311",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:29" align="right">comment:29</div>

I have uploaded a reviewer's patch which fixes the trac ticket numbers, and removes completely Rings.HomCategory. I could not reproduce the timeout:

```
sage -t  "devel/sage-combinat/sage/rings/polynomial/multi_polynomial_sequence.py"
	 [8.6 s]
```

Can you check again?

If you are happy with the change, please fold everything, and set a positive review.



---

archive/issue_comments_145312.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI just verified: I don't see a timeout anymore. Strange.\n\nAnyway, I am now running make testlong, and if everything works, I'll give it a positive review and provide a combined patch.",
    "created_at": "2012-04-30T10:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145312",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:30" align="right">comment:30</div>

I just verified: I don't see a timeout anymore. Strange.

Anyway, I am now running make testlong, and if everything works, I'll give it a positive review and provide a combined patch.



---

archive/issue_comments_145313.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nToo bad. \"make testlong\" resulted in\n\n```\nsage -t  --long -force_lib \"devel/sage/sage/categories/map.pyx\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 382:\n    sage: phi.category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 388:\n    sage: f.category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\n```\nand\n\n```\nsage -t  --long -force_lib \"devel/sage/sage/categories/homset.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 228:\n    sage: Hom(PA,PJ).category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 339:\n    sage: End(QQ).category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n```\n\nI have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.",
    "created_at": "2012-04-30T13:04:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145313",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:31" align="right">comment:31</div>

Too bad. "make testlong" resulted in

```
sage -t  --long -force_lib "devel/sage/sage/categories/map.pyx"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 382:
    sage: phi.category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 388:
    sage: f.category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
```
and

```
sage -t  --long -force_lib "devel/sage/sage/categories/homset.py"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 228:
    sage: Hom(PA,PJ).category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 339:
    sage: End(QQ).category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
```

I have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.



---

archive/issue_events_176059.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-30T13:04:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176059"
}
```



---

archive/issue_events_176060.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-30T13:04:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176060"
}
```



---

archive/issue_comments_145314.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@simon-king-jena](#comment%3A31):\n> I have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.\n\nTo be precise (in case I forgot to apply one patch):\n\n```\n\nking@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa\ntrac_715_combined.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_12875-category-fix_abvar_homspace-nt.patch\ntrac_12877-category-for_more_rings_and_schemes-nt.patch\ntrac12215_weak_cached_function.patch\ntrac12215_segfault_fixes.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521.patch\ntrac_12876-reviewer.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n```",
    "created_at": "2012-04-30T13:06:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145314",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@simon-king-jena](#comment%3A31):
> I have sage-5.0.beta13 plus #715, #11521, #12875, #12877, #12215 and #12876.

To be precise (in case I forgot to apply one patch):

```

king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa
trac_715_combined.patch
trac_11521_homset_weakcache_combined.patch
trac_12875-category-fix_abvar_homspace-nt.patch
trac_12877-category-for_more_rings_and_schemes-nt.patch
trac12215_weak_cached_function.patch
trac12215_segfault_fixes.patch
trac_12876_category-fix_abstract_class-nt-rel11521.patch
trac_12876-reviewer.patch
trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
```



---

archive/issue_comments_145315.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nOk, this is totally benign. Now, to minimize change, the easiest is probably to keep the HomCategory even if we delete its containt. The updated reviewer's patch does just that.\n\nCheers,\n                        Nicolas",
    "created_at": "2012-04-30T13:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145315",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:33" align="right">comment:33</div>

Ok, this is totally benign. Now, to minimize change, the easiest is probably to keep the HomCategory even if we delete its containt. The updated reviewer's patch does just that.

Cheers,
                        Nicolas



---

archive/issue_comments_145316.json:
```json
{
    "body": "Changed work issues from **Fix ring_refcount_dict problem** to **Fix the review-nt patch**",
    "created_at": "2012-05-02T10:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145316",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Fix ring_refcount_dict problem** to **Fix the review-nt patch**



---

archive/issue_comments_145317.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAttachment: **[trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)**\n\n[attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) doesn't work, because you confused ` with '.\n\nPlease change the following hunk:\n\n```diff\n--- hecke_modules.py\n+++ hecke_modules.py\n@@ -116,7 +116,7 @@ class HeckeModules(Category_module):\n             Fixing :meth:`_test_zero` (``__call__`` should accept a\n             function as input) and :meth:`_test_elements` (modular\n             form morphisms elements should inherit from categories) is\n-            :trac:`???`.\n+            :trac:`12879`.\n \n             TESTS::\n```\nsince the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.",
    "created_at": "2012-05-02T10:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145317",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:34" align="right">comment:34</div>

Attachment: **[trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)**

[attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) doesn't work, because you confused ` with '.

Please change the following hunk:

```diff
--- hecke_modules.py
+++ hecke_modules.py
@@ -116,7 +116,7 @@ class HeckeModules(Category_module):
             Fixing :meth:`_test_zero` (``__call__`` should accept a
             function as input) and :meth:`_test_elements` (modular
             form morphisms elements should inherit from categories) is
-            :trac:`???`.
+            :trac:`12879`.
 
             TESTS::
```
since the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.



---

archive/issue_comments_145318.json:
```json
{
    "body": "Changed work issues from **Fix the review-nt patch** to **Fix the review-nt patch, fix doctests in map.pyx and homset.py**",
    "created_at": "2012-05-02T13:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145318",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Fix the review-nt patch** to **Fix the review-nt patch, fix doctests in map.pyx and homset.py**



---

archive/issue_comments_145319.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI get four errors with `make ptestlong`:\n\n```\n----------------------------------------------------------------------\n\nThe following tests failed:\n\n\tsage -t  --long -force_lib devel/sage/sage/categories/homset.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/categories/map.pyx # 2 doctests failed\n----------------------------------------------------------------------\n```\nnamely\n\n```\nsage -t --long -force_lib \"devel/sage/sage/categories/homset.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 228:\n    sage: Hom(PA,PJ).category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py\", line 337:\n    sage: End(QQ).category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n**********************************************************************\n```\nand\n\n```\nsage -t --long -force_lib \"devel/sage/sage/categories/map.pyx\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 382:\n    sage: phi.category()\nExpected:\n    Category of hom sets in Category of rings\nGot:\n    Category of hom sets in Category of sets\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 388:\n    sage: f.category()\nExpected:\n    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\nGot:\n    Category of hom sets in Category of modules over Rational Field\n**********************************************************************\n```\n\nFor reference, I have\n\n```\nking@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qapplied \ntrac_12808-classcall_speedup-fh.patch\ntrac_12808_nested_class_cython.patch\ntrac_12808-classcall_cdef.patch\ntrac12215_weak_cached_function.patch\ntrac12215_segfault_fixes.patch\ntrac_715_combined.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_12875-category-fix_abvar_homspace-nt.patch\ntrac_12877-category-for_more_rings_and_schemes-nt.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n```\nHow is that different from your setting?",
    "created_at": "2012-05-02T13:13:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145319",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:35" align="right">comment:35</div>

I get four errors with `make ptestlong`:

```
----------------------------------------------------------------------

The following tests failed:

	sage -t  --long -force_lib devel/sage/sage/categories/homset.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/categories/map.pyx # 2 doctests failed
----------------------------------------------------------------------
```
namely

```
sage -t --long -force_lib "devel/sage/sage/categories/homset.py"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 228:
    sage: Hom(PA,PJ).category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/homset.py", line 337:
    sage: End(QQ).category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
**********************************************************************
```
and

```
sage -t --long -force_lib "devel/sage/sage/categories/map.pyx"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 382:
    sage: phi.category()
Expected:
    Category of hom sets in Category of rings
Got:
    Category of hom sets in Category of sets
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 388:
    sage: f.category()
Expected:
    Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
Got:
    Category of hom sets in Category of modules over Rational Field
**********************************************************************
```

For reference, I have

```
king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qapplied 
trac_12808-classcall_speedup-fh.patch
trac_12808_nested_class_cython.patch
trac_12808-classcall_cdef.patch
trac12215_weak_cached_function.patch
trac12215_segfault_fixes.patch
trac_715_combined.patch
trac_11521_homset_weakcache_combined.patch
trac_12875-category-fix_abvar_homspace-nt.patch
trac_12877-category-for_more_rings_and_schemes-nt.patch
trac_12876_category-fix_abstract_class-nt-rel11521.patch
trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
```
How is that different from your setting?



---

archive/issue_comments_145320.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@simon-king-jena](#comment%3A34):\n> [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) doesn't work, because you confused ` with '.\n> \n> Please change the following hunk:\n> \n> ```diff\n> --- hecke_modules.py\n> +++ hecke_modules.py\n> @@ -116,7 +116,7 @@ class HeckeModules(Category_module):\n>              Fixing :meth:`_test_zero` (``__call__`` should accept a\n>              function as input) and :meth:`_test_elements` (modular\n>              form morphisms elements should inherit from categories) is\n> -            :trac:`???`.\n> +            :trac:`12879`.\n>  \n>              TESTS::\n> ```\n> since the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.\n\nDid you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?",
    "created_at": "2012-05-02T13:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145320",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@simon-king-jena](#comment%3A34):
> [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) doesn't work, because you confused ` with '.
> 
> Please change the following hunk:
> 
> ```diff
> --- hecke_modules.py
> +++ hecke_modules.py
> @@ -116,7 +116,7 @@ class HeckeModules(Category_module):
>              Fixing :meth:`_test_zero` (``__call__`` should accept a
>              function as input) and :meth:`_test_elements` (modular
>              form morphisms elements should inherit from categories) is
> -            :trac:`???`.
> +            :trac:`12879`.
>  
>              TESTS::
> ```
> since the to-be-changed file has `:trac:'???'`, hence, no backticks around ???.

Did you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?



---

archive/issue_comments_145321.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@simon-king-jena](#comment%3A35):\n> I get four errors with `make ptestlong`:\n> ...\n> \n> ```\n> sage -t --long -force_lib \"devel/sage/sage/categories/map.pyx\"\n> **********************************************************************\n> File \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 382:\n>     sage: phi.category()\n> Expected:\n>     Category of hom sets in Category of rings\n> Got:\n>     Category of hom sets in Category of sets\n> **********************************************************************\n> File \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx\", line 388:\n>     sage: f.category()\n> Expected:\n>     Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field\n> Got:\n>     Category of hom sets in Category of modules over Rational Field\n> **********************************************************************\n> ```\n\nThis looks like the errors I was getting when I had removed completely\nRings.HomCategory. Can you double check that you have the latest\nversion of the reviewer patch from trac and that categories/rings.py\nindeed has an (empty) class Rings.Homcategory?",
    "created_at": "2012-05-02T13:42:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145321",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@simon-king-jena](#comment%3A35):
> I get four errors with `make ptestlong`:
> ...
> 
> ```
> sage -t --long -force_lib "devel/sage/sage/categories/map.pyx"
> **********************************************************************
> File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 382:
>     sage: phi.category()
> Expected:
>     Category of hom sets in Category of rings
> Got:
>     Category of hom sets in Category of sets
> **********************************************************************
> File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/categories/map.pyx", line 388:
>     sage: f.category()
> Expected:
>     Join of Category of hom sets in Category of rings and Category of hom sets in Category of modules over Rational Field
> Got:
>     Category of hom sets in Category of modules over Rational Field
> **********************************************************************
> ```

This looks like the errors I was getting when I had removed completely
Rings.HomCategory. Can you double check that you have the latest
version of the reviewer patch from trac and that categories/rings.py
indeed has an (empty) class Rings.Homcategory?



---

archive/issue_comments_145322.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@nthiery](#comment%3A36):\n> Did you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?\n\nNope! I thought that your review patch replaces mine.",
    "created_at": "2012-05-02T14:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145322",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@nthiery](#comment%3A36):
> Did you include your trac_12876-reviewer.patch (which fixes those backticks) in between trac_12876_category-fix_abstract_class-nt-rel11521.patch and trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch?

Nope! I thought that your review patch replaces mine.



---

archive/issue_comments_145323.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@nthiery](#comment%3A37):\n> This looks like the errors I was getting when I had removed completely\n> Rings.HomCategory. Can you double check that you have the latest\n> version of the reviewer patch from trac and that categories/rings.py\n> indeed has an (empty) class Rings.Homcategory?\n\nNo, categories/rings.py has no Homcategory. So, am I using the wrong patch?",
    "created_at": "2012-05-02T14:06:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145323",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@nthiery](#comment%3A37):
> This looks like the errors I was getting when I had removed completely
> Rings.HomCategory. Can you double check that you have the latest
> version of the reviewer patch from trac and that categories/rings.py
> indeed has an (empty) class Rings.Homcategory?

No, categories/rings.py has no Homcategory. So, am I using the wrong patch?



---

archive/issue_comments_145324.json:
```json
{
    "body": "Changed work issues from **Fix the review-nt patch, fix doctests in map.pyx and homset.py** to **Fx doctests in map.pyx and homset.py**",
    "created_at": "2012-05-02T14:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145324",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Fix the review-nt patch, fix doctests in map.pyx and homset.py** to **Fx doctests in map.pyx and homset.py**



---

archive/issue_comments_145325.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nApplication works when *both* reviewer patches are applied. I am changing the ticket description accordingly.",
    "created_at": "2012-05-02T14:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145325",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:40" align="right">comment:40</div>

Application works when *both* reviewer patches are applied. I am changing the ticket description accordingly.



---

archive/issue_comments_145326.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,3 +31,5 @@\n \n * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)\n * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)\n+* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n+\n``````\n",
    "created_at": "2012-05-02T14:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145326",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,3 +31,5 @@
 
 * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)
 * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)
+* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
+
``````




---

archive/issue_comments_145327.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nPS: With \n\n```\nking@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa\ntrac_12808-classcall_speedup-fh.patch\ntrac_12808_nested_class_cython.patch\ntrac_12808-classcall_cdef.patch\ntrac12215_weak_cached_function.patch\ntrac12215_segfault_fixes.patch\ntrac_715_combined.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_12875-category-fix_abvar_homspace-nt.patch\ntrac_12877-category-for_more_rings_and_schemes-nt.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521.patch\ntrac_12876-reviewer.patch\ntrac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n```\n`sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.",
    "created_at": "2012-05-02T14:14:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145327",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:41" align="right">comment:41</div>

PS: With 

```
king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa
trac_12808-classcall_speedup-fh.patch
trac_12808_nested_class_cython.patch
trac_12808-classcall_cdef.patch
trac12215_weak_cached_function.patch
trac12215_segfault_fixes.patch
trac_715_combined.patch
trac_11521_homset_weakcache_combined.patch
trac_12875-category-fix_abvar_homspace-nt.patch
trac_12877-category-for_more_rings_and_schemes-nt.patch
trac_12876_category-fix_abstract_class-nt-rel11521.patch
trac_12876-reviewer.patch
trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
```
`sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.



---

archive/issue_comments_145328.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nPS: We really should do something about source code inspection! See what happens if you do\n\n```\nsage: sage.categories.rings.Rings.HomCategory??\n```\nor\n\n```\nsage: edit(sage.categories.rings.Rings.HomCategory,'vim')\n```\nI thought I had fixed that in some ticket!!",
    "created_at": "2012-05-02T14:18:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145328",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:42" align="right">comment:42</div>

PS: We really should do something about source code inspection! See what happens if you do

```
sage: sage.categories.rings.Rings.HomCategory??
```
or

```
sage: edit(sage.categories.rings.Rings.HomCategory,'vim')
```
I thought I had fixed that in some ticket!!



---

archive/issue_comments_145329.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@simon-king-jena](#comment%3A42):\n> I thought I had fixed that in some ticket!!\n\nI did: #11768, needing review (hint-hint).",
    "created_at": "2012-05-02T14:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145329",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@simon-king-jena](#comment%3A42):
> I thought I had fixed that in some ticket!!

I did: #11768, needing review (hint-hint).



---

archive/issue_comments_145330.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@simon-king-jena](#comment%3A41):\n> PS: With \n> \n> ```\n> king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa\n> trac_12808-classcall_speedup-fh.patch\n> trac_12808_nested_class_cython.patch\n> trac_12808-classcall_cdef.patch\n> trac12215_weak_cached_function.patch\n> trac12215_segfault_fixes.patch\n> trac_715_combined.patch\n> trac_11521_homset_weakcache_combined.patch\n> trac_12875-category-fix_abvar_homspace-nt.patch\n> trac_12877-category-for_more_rings_and_schemes-nt.patch\n> trac_12876_category-fix_abstract_class-nt-rel11521.patch\n> trac_12876-reviewer.patch\n> trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch\n> ```\n> `sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.\n\nCool. I guess you are running the tests now, right?",
    "created_at": "2012-05-02T14:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145330",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@simon-king-jena](#comment%3A41):
> PS: With 
> 
> ```
> king@mpc622:/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage$ hg qa
> trac_12808-classcall_speedup-fh.patch
> trac_12808_nested_class_cython.patch
> trac_12808-classcall_cdef.patch
> trac12215_weak_cached_function.patch
> trac12215_segfault_fixes.patch
> trac_715_combined.patch
> trac_11521_homset_weakcache_combined.patch
> trac_12875-category-fix_abvar_homspace-nt.patch
> trac_12877-category-for_more_rings_and_schemes-nt.patch
> trac_12876_category-fix_abstract_class-nt-rel11521.patch
> trac_12876-reviewer.patch
> trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch
> ```
> `sage.categories.rings.Rings.HomCategory` exists and is empty, as it is supposed to be, I guess.

Cool. I guess you are running the tests now, right?



---

archive/issue_comments_145331.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@nthiery](#comment%3A44):\n> Cool. I guess you are running the tests now, right?\n\nI have already verified that the two problematic tests pass. If it works, it will be a positive review.\n\nAdmittedly, I am running the test suite with #9107 and #11768 applied as well...",
    "created_at": "2012-05-02T17:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145331",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@nthiery](#comment%3A44):
> Cool. I guess you are running the tests now, right?

I have already verified that the two problematic tests pass. If it works, it will be a positive review.

Admittedly, I am running the test suite with #9107 and #11768 applied as well...



---

archive/issue_comments_145332.json:
```json
{
    "body": "Changed work issues from **Fx doctests in map.pyx and homset.py** to **Fx doctests in sageinspect.py**",
    "created_at": "2012-05-02T18:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145332",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Fx doctests in map.pyx and homset.py** to **Fx doctests in sageinspect.py**



---

archive/issue_comments_145333.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI'm afraid it still needs a tiny bit of work. `make ptestlong` resulted in (only) one error, namely\n\n```\nsage -t --long -force_lib \"devel/sage/sage/misc/sageinspect.py\"\n**********************************************************************\nFile \"/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/misc/sageinspect.py\", line 1495:\n    sage: sage_getsourcelines(HC)\nExpected:\n    (['    class HomCategory(HomCategory):\\n',\n     '        def extra_super_categories(self):\\n',\n     ...\n     '                return (self.domain(), self.codomain(), self.category())\\n'], ...)\nGot:\n    (['    class HomCategory(HomCategory):\\n', '        pass\\n'], 564)\n**********************************************************************\n1 items had failures:\n   1 of  24 in __main__.example_27\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /mnt/local/king/.sage/tmp/sageinspect_13253.py\n         [14.0 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t --long -force_lib \"devel/sage/sage/misc/sageinspect.py\"\nTotal time for all tests: 14.0 seconds\n```\n\nApparently this is caused by emptying the HomCategory of Rings().",
    "created_at": "2012-05-02T18:40:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145333",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:46" align="right">comment:46</div>

I'm afraid it still needs a tiny bit of work. `make ptestlong` resulted in (only) one error, namely

```
sage -t --long -force_lib "devel/sage/sage/misc/sageinspect.py"
**********************************************************************
File "/mnt/local/king/SAGE/stable/sage-5.0.beta13/devel/sage/sage/misc/sageinspect.py", line 1495:
    sage: sage_getsourcelines(HC)
Expected:
    (['    class HomCategory(HomCategory):\n',
     '        def extra_super_categories(self):\n',
     ...
     '                return (self.domain(), self.codomain(), self.category())\n'], ...)
Got:
    (['    class HomCategory(HomCategory):\n', '        pass\n'], 564)
**********************************************************************
1 items had failures:
   1 of  24 in __main__.example_27
***Test Failed*** 1 failures.
For whitespace errors, see the file /mnt/local/king/.sage/tmp/sageinspect_13253.py
         [14.0 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t --long -force_lib "devel/sage/sage/misc/sageinspect.py"
Total time for all tests: 14.0 seconds
```

Apparently this is caused by emptying the HomCategory of Rings().



---

archive/issue_comments_145334.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nPS: The obvious fix is to change the expected result in the test...",
    "created_at": "2012-05-02T18:40:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145334",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:47" align="right">comment:47</div>

PS: The obvious fix is to change the expected result in the test...



---

archive/issue_comments_145335.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nMe stupid! The failing test is only introduced in #11768. So, I had better not apply more than the necessary patches...\n\nRunning the failing tests without the additional patch works.\n\nHence, repeating the test suite now... Sorry!",
    "created_at": "2012-05-02T18:49:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145335",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:48" align="right">comment:48</div>

Me stupid! The failing test is only introduced in #11768. So, I had better not apply more than the necessary patches...

Running the failing tests without the additional patch works.

Hence, repeating the test suite now... Sorry!



---

archive/issue_comments_145336.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nNow it works. It is thus a positive review.",
    "created_at": "2012-05-02T21:21:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145336",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:49" align="right">comment:49</div>

Now it works. It is thus a positive review.



---

archive/issue_events_176061.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-05-02T21:21:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176061"
}
```



---

archive/issue_events_176062.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-05-02T21:21:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176062"
}
```



---

archive/issue_comments_145337.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@simon-king-jena](#comment%3A49):\n> Now it works. It is thus a positive review.\n\nThanks! I can't wait for 5.1 :-)",
    "created_at": "2012-05-02T21:27:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145337",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@simon-king-jena](#comment%3A49):
> Now it works. It is thus a positive review.

Thanks! I can't wait for 5.1 :-)



---

archive/issue_comments_145338.json:
```json
{
    "body": "Changed work issues from **Fx doctests in sageinspect.py** to none",
    "created_at": "2012-05-03T12:26:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145338",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Fx doctests in sageinspect.py** to none



---

archive/issue_comments_145339.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI forgot to remove the \"work issues\".",
    "created_at": "2012-05-03T12:26:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145339",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:51" align="right">comment:51</div>

I forgot to remove the "work issues".



---

archive/issue_events_176063.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-07T12:03:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176063"
}
```



---

archive/issue_events_176064.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-07T12:03:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176064"
}
```



---

archive/issue_comments_145340.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThe third patch needs a proper commit message.",
    "created_at": "2012-05-07T12:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145340",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:53" align="right">comment:53</div>

The third patch needs a proper commit message.



---

archive/issue_comments_145341.json:
```json
{
    "body": "Work Issues: **commit message**",
    "created_at": "2012-05-07T12:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145341",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **commit message**



---

archive/issue_events_176065.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-27T11:34:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176065"
}
```



---

archive/issue_events_176066.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-27T11:34:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176066"
}
```



---

archive/issue_events_176067.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-27T11:34:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176067"
}
```



---

archive/issue_events_176068.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-27T11:34:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176068"
}
```



---

archive/issue_comments_145342.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12875, #12877, #12215** to **#715, #11521, #12215**",
    "created_at": "2012-08-27T11:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145342",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#715, #11521, #12875, #12877, #12215** to **#715, #11521, #12215**



---

archive/issue_comments_145343.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThis needs to be rebased to sage-5.3.rc0 + #715 + #11521 + #12215 + #12313.",
    "created_at": "2012-08-27T11:42:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145343",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

This needs to be rebased to sage-5.3.rc0 + #715 + #11521 + #12215 + #12313.



---

archive/issue_comments_145344.json:
```json
{
    "body": "Attachment: **[trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)**\n\nReplacement of [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) wrt to the new patch versions at #715, #12313 etc.",
    "created_at": "2012-08-28T10:27:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145344",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)**

Replacement of [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) wrt to the new patch versions at #715, #12313 etc.



---

archive/issue_comments_145345.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nI have replaced Nicolas' first patch, under a new name. The changes became necessary by changes in the patches at #715 and #12313. Now I am running doctests.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch     trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch",
    "created_at": "2012-08-28T10:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145345",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:56" align="right">comment:56</div>

I have replaced Nicolas' first patch, under a new name. The changes became necessary by changes in the patches at #715 and #12313. Now I am running doctests.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch     trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch



---

archive/issue_comments_145346.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,7 +29,7 @@\n \n Apply:\n \n-* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)\n+* [attachment: trac_12876_category-fix_abstract_class-sk-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)\n * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)\n * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n \n``````\n",
    "created_at": "2012-08-28T10:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145346",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,7 +29,7 @@
 
 Apply:
 
-* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521.patch.gz)
+* [attachment: trac_12876_category-fix_abstract_class-sk-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)
 * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)
 * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
 
``````




---

archive/issue_events_176069.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-28T10:31:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176069"
}
```



---

archive/issue_events_176070.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-28T10:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176070"
}
```



---

archive/issue_comments_145347.json:
```json
{
    "body": "Changed work issues from **commit message** to **fix doctests and segfaults**",
    "created_at": "2012-08-28T11:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145347",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **commit message** to **fix doctests and segfaults**



---

archive/issue_comments_145348.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nWith sage-5.3.b2 plus #715, #11521, #12215, #12313, #13370, #13378 and the patches from here, I get\n\n```\nmake ptest\n...\nThe following tests failed:\n\n        sage -t  -force_lib devel/sage/sage/interfaces/r.py # 1 doctests failed\n        sage -t  -force_lib devel/sage/sage/rings/polynomial/infinite_polynomial_ring.py # 0 doctests failed\n        sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py # 1 doctests failed\n```\n\nThe error in hecke_modules.py is due to\n\n```\nNotImplementedError: please implement _an_element_ for Set of Morphisms from Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field to Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field in Category of Hecke modules over Rational Field\n```\n\nThe error in expect/r.py looks strange to me:\n\n```\nsage -t  -force_lib devel/sage/sage/interfaces/r.py\n**********************************************************************\nFile \"/mnt/local/king/SAGE/prereleases/sage-5.3.beta2/devel/sage-main/sage/interfaces/r.py\", line 1169:\n    sage: os.path.realpath(tmpdir) == sageobj(r.getwd())\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   1 of   7 in __main__.example_43\n```\nThe error is not reproducible, at least not if I run the test individually.\n\nIn infinite_polynomial_ring.py one gets a segfault. One does *not* get a segfault when running the tests with `--verbose`. But gdb yields the following backtrace:\n\n```\n#0  PyObject_Malloc (nbytes=123) at Objects/obmalloc.c:788\n#1  0x00007ffff7a9bd5b in string_concat (a=0x7ffff7ed6730, bb=0x54c6180) at Objects/stringobject.c:1056\n#2  0x00007ffff7a9dda5 in PyString_Concat (pv=0x7fffffffac58, w=<value optimized out>) at Objects/stringobject.c:3862\n#3  0x00007ffff7a46025 in string_concatenate (v=0x7ffff7ed6730, w=0x54c6180, f=<value optimized out>, next_instr=<value optimized out>) at Python/ceval.c:4856\n#4  0x00007ffff7af56c7 in PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:1548\n#5  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5b70, kwcount=0,\n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#6  0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#7  call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#8  PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#9  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5930, kwcount=0,\n    defs=0x7ffff7f70968, defcount=1, closure=0x0) at Python/ceval.c:3253\n#10 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#11 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#12 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#13 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x50ed188, kwcount=0,\n    defs=0x7ffff7f708e8, defcount=1, closure=0x0) at Python/ceval.c:3253\n#14 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#15 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#16 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#17 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecf90, kwcount=0,\n    defs=0x4918628, defcount=1, closure=0x0) at Python/ceval.c:3253\n#18 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#19 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#20 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#21 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecd88, kwcount=0,\n    defs=0x7ffff7f708a8, defcount=1, closure=0x0) at Python/ceval.c:3253\n#22 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#23 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#24 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#25 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ec980, kwcount=0, \n    defs=0x7ffff7f5aa40, defcount=2, closure=0x0) at Python/ceval.c:3253\n#26 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#27 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#28 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#29 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50eac40, kwcount=1, \n    defs=0x7ffff7ee9218, defcount=2, closure=0x0) at Python/ceval.c:3253\n#30 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#31 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#32 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#33 0x00007ffff7af627b in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4107\n#34 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#35 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#36 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x0, kwcount=0, \n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#37 0x00007ffff7a7a02c in function_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/funcobject.c:526\n#38 0x00007ffff7a522c3 in PyObject_Call (func=0x491cb18, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#39 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/classobject.c:2578\n#40 0x00007ffff7a522c3 in PyObject_Call (func=0x42995f0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#41 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239\n#42 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044\n#43 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#44 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x4d12cf0, kwcount=0, \n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#45 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#46 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#47 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#48 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x488e5b0, kwcount=3, \n    defs=0x491d388, defcount=3, closure=0x0) at Python/ceval.c:3253\n#49 0x00007ffff7a7a123 in function_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/funcobject.c:526\n#50 0x00007ffff7a522c3 in PyObject_Call (func=0x491cc80, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#51 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/classobject.c:2578\n#52 0x00007ffff7a522c3 in PyObject_Call (func=0x4856be0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529\n#53 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239\n#54 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044\n#55 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#56 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x4068fd0, kwcount=0, \n    defs=0x48c48d8, defcount=3, closure=0x0) at Python/ceval.c:3253\n#57 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#58 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#59 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#60 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x49af830, kwcount=10, \n    defs=0x49104a8, defcount=10, closure=0x0) at Python/ceval.c:3253\n#61 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#62 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#63 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#64 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=1, kws=0x6d8fb8, kwcount=3, \n    defs=0x4910310, defcount=10, closure=0x0) at Python/ceval.c:3253\n#65 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117\n#66 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042\n#67 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666\n#68 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x0, kwcount=0, \n    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253\n#69 0x00007ffff7af7262 in PyEval_EvalCode (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>) at Python/ceval.c:667\n#70 0x00007ffff7b19760 in run_mod (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380)\n    at Python/pythonrun.c:1353\n#71 PyRun_FileExFlags (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380) at Python/pythonrun.c:1339\n#72 0x00007ffff7b1a1ff in PyRun_SimpleFileExFlags (fp=0x6c66c0, filename=0x7fffffffd8ff \"/mnt/local/king/.sage/tmp/infinite_polynomial_ring_15153.py\", closeit=1, flags=0x7fffffffd380)\n    at Python/pythonrun.c:943\n#73 0x00007ffff7b2d4b5 in Py_Main (argc=<value optimized out>, argv=<value optimized out>) at Modules/main.c:639\n#74 0x00007ffff6e1ec8d in __libc_start_main (main=<value optimized out>, argc=<value optimized out>, ubp_av=<value optimized out>, init=<value optimized out>, fini=<value optimized out>, \n    rtld_fini=<value optimized out>, stack_end=0x7fffffffd498) at libc-start.c:228\n#75 0x0000000000400619 in _start ()\n```\n\nCould very well be that this is (once again) due to the new weak caches. But I will also rerun without #13370 and #13378.",
    "created_at": "2012-08-28T11:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145348",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:57" align="right">comment:57</div>

With sage-5.3.b2 plus #715, #11521, #12215, #12313, #13370, #13378 and the patches from here, I get

```
make ptest
...
The following tests failed:

        sage -t  -force_lib devel/sage/sage/interfaces/r.py # 1 doctests failed
        sage -t  -force_lib devel/sage/sage/rings/polynomial/infinite_polynomial_ring.py # 0 doctests failed
        sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py # 1 doctests failed
```

The error in hecke_modules.py is due to

```
NotImplementedError: please implement _an_element_ for Set of Morphisms from Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field to Modular Forms space of dimension 3 for Congruence Subgroup Gamma0(7) of weight 4 over Rational Field in Category of Hecke modules over Rational Field
```

The error in expect/r.py looks strange to me:

```
sage -t  -force_lib devel/sage/sage/interfaces/r.py
**********************************************************************
File "/mnt/local/king/SAGE/prereleases/sage-5.3.beta2/devel/sage-main/sage/interfaces/r.py", line 1169:
    sage: os.path.realpath(tmpdir) == sageobj(r.getwd())
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   1 of   7 in __main__.example_43
```
The error is not reproducible, at least not if I run the test individually.

In infinite_polynomial_ring.py one gets a segfault. One does *not* get a segfault when running the tests with `--verbose`. But gdb yields the following backtrace:

```
#0  PyObject_Malloc (nbytes=123) at Objects/obmalloc.c:788
#1  0x00007ffff7a9bd5b in string_concat (a=0x7ffff7ed6730, bb=0x54c6180) at Objects/stringobject.c:1056
#2  0x00007ffff7a9dda5 in PyString_Concat (pv=0x7fffffffac58, w=<value optimized out>) at Objects/stringobject.c:3862
#3  0x00007ffff7a46025 in string_concatenate (v=0x7ffff7ed6730, w=0x54c6180, f=<value optimized out>, next_instr=<value optimized out>) at Python/ceval.c:4856
#4  0x00007ffff7af56c7 in PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:1548
#5  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5b70, kwcount=0,
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#6  0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#7  call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#8  PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#9  0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x49a5930, kwcount=0,
    defs=0x7ffff7f70968, defcount=1, closure=0x0) at Python/ceval.c:3253
#10 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#11 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#12 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#13 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x50ed188, kwcount=0,
    defs=0x7ffff7f708e8, defcount=1, closure=0x0) at Python/ceval.c:3253
#14 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#15 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#16 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#17 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecf90, kwcount=0,
    defs=0x4918628, defcount=1, closure=0x0) at Python/ceval.c:3253
#18 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#19 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#20 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#21 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ecd88, kwcount=0,
    defs=0x7ffff7f708a8, defcount=1, closure=0x0) at Python/ceval.c:3253
#22 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#23 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#24 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#25 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50ec980, kwcount=0, 
    defs=0x7ffff7f5aa40, defcount=2, closure=0x0) at Python/ceval.c:3253
#26 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#27 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#28 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#29 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=3, kws=0x50eac40, kwcount=1, 
    defs=0x7ffff7ee9218, defcount=2, closure=0x0) at Python/ceval.c:3253
#30 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#31 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#32 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#33 0x00007ffff7af627b in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4107
#34 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#35 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#36 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x0, kwcount=0, 
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#37 0x00007ffff7a7a02c in function_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/funcobject.c:526
#38 0x00007ffff7a522c3 in PyObject_Call (func=0x491cb18, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#39 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cb18, arg=0x476c050, kw=0x0) at Objects/classobject.c:2578
#40 0x00007ffff7a522c3 in PyObject_Call (func=0x42995f0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#41 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239
#42 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044
#43 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#44 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=4, kws=0x4d12cf0, kwcount=0, 
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#45 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#46 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#47 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#48 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x488e5b0, kwcount=3, 
    defs=0x491d388, defcount=3, closure=0x0) at Python/ceval.c:3253
#49 0x00007ffff7a7a123 in function_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/funcobject.c:526
#50 0x00007ffff7a522c3 in PyObject_Call (func=0x491cc80, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#51 0x00007ffff7a5fa0f in instancemethod_call (func=0x491cc80, arg=0x4906cb0, kw=0x494f090) at Objects/classobject.c:2578
#52 0x00007ffff7a522c3 in PyObject_Call (func=0x4856be0, arg=<value optimized out>, kw=<value optimized out>) at Objects/abstract.c:2529
#53 0x00007ffff7af40fd in do_call (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4239
#54 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4044
#55 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#56 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=2, kws=0x4068fd0, kwcount=0, 
    defs=0x48c48d8, defcount=3, closure=0x0) at Python/ceval.c:3253
#57 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#58 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#59 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#60 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x49af830, kwcount=10, 
    defs=0x49104a8, defcount=10, closure=0x0) at Python/ceval.c:3253
#61 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#62 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#63 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#64 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=1, kws=0x6d8fb8, kwcount=3, 
    defs=0x4910310, defcount=10, closure=0x0) at Python/ceval.c:3253
#65 0x00007ffff7af5550 in fast_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4117
#66 call_function (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:4042
#67 PyEval_EvalFrameEx (f=<value optimized out>, throwflag=<value optimized out>) at Python/ceval.c:2666
#68 0x00007ffff7af7125 in PyEval_EvalCodeEx (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>, args=<value optimized out>, argcount=0, kws=0x0, kwcount=0, 
    defs=0x0, defcount=0, closure=0x0) at Python/ceval.c:3253
#69 0x00007ffff7af7262 in PyEval_EvalCode (co=<value optimized out>, globals=<value optimized out>, locals=<value optimized out>) at Python/ceval.c:667
#70 0x00007ffff7b19760 in run_mod (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380)
    at Python/pythonrun.c:1353
#71 PyRun_FileExFlags (fp=0x6c66c0, filename=<value optimized out>, start=<value optimized out>, globals=0x640280, locals=0x640280, closeit=1, flags=0x7fffffffd380) at Python/pythonrun.c:1339
#72 0x00007ffff7b1a1ff in PyRun_SimpleFileExFlags (fp=0x6c66c0, filename=0x7fffffffd8ff "/mnt/local/king/.sage/tmp/infinite_polynomial_ring_15153.py", closeit=1, flags=0x7fffffffd380)
    at Python/pythonrun.c:943
#73 0x00007ffff7b2d4b5 in Py_Main (argc=<value optimized out>, argv=<value optimized out>) at Modules/main.c:639
#74 0x00007ffff6e1ec8d in __libc_start_main (main=<value optimized out>, argc=<value optimized out>, ubp_av=<value optimized out>, init=<value optimized out>, fini=<value optimized out>, 
    rtld_fini=<value optimized out>, stack_end=0x7fffffffd498) at libc-start.c:228
#75 0x0000000000400619 in _start ()
```

Could very well be that this is (once again) due to the new weak caches. But I will also rerun without #13370 and #13378.



---

archive/issue_events_176071.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-28T11:15:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176071"
}
```



---

archive/issue_events_176072.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-28T11:15:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176072"
}
```



---

archive/issue_comments_145349.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12215** to **#715, #11521, #12215, #12313**",
    "created_at": "2012-08-28T11:31:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145349",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#715, #11521, #12215** to **#715, #11521, #12215, #12313**



---

archive/issue_comments_145350.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,4 +32,5 @@\n * [attachment: trac_12876_category-fix_abstract_class-sk-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)\n * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)\n * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n+* [attachment: trac_12876_fix_infinite_polynomial_ring.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)\n \n``````\n",
    "created_at": "2012-08-28T14:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145350",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,4 +32,5 @@
 * [attachment: trac_12876_category-fix_abstract_class-sk-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)
 * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)
 * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
+* [attachment: trac_12876_fix_infinite_polynomial_ring.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)
 
``````




---

archive/issue_events_176073.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-28T14:40:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176073"
}
```



---

archive/issue_events_176074.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-28T14:40:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176074"
}
```



---

archive/issue_comments_145351.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nGot it!\n\nInfinite polynomial rings were using `WeakKeyDict` in `_has_coerce_map_from_`for caching whether there is a coercion. That has probably been a bad idea, because the methods that are really used (`has_coerce_map`) have a cache anyway.\n\nRemoving the additional cache fixes the segfault.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch",
    "created_at": "2012-08-28T14:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145351",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:59" align="right">comment:59</div>

Got it!

Infinite polynomial rings were using `WeakKeyDict` in `_has_coerce_map_from_`for caching whether there is a coercion. That has probably been a bad idea, because the methods that are really used (`has_coerce_map`) have a cache anyway.

Removing the additional cache fixes the segfault.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch



---

archive/issue_comments_145352.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nOne has to remove the dependency #715, because #715 and #11521 are mutually dependent, but #715 needs to be applied first.\n\nAnyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a `_an_element_` method. The error with r seems to have been noise.",
    "created_at": "2012-08-28T15:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145352",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:60" align="right">comment:60</div>

One has to remove the dependency #715, because #715 and #11521 are mutually dependent, but #715 needs to be applied first.

Anyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a `_an_element_` method. The error with r seems to have been noise.



---

archive/issue_comments_145353.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12215, #12313** to **#11521, #12215, #12313**",
    "created_at": "2012-08-28T15:33:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145353",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#715, #11521, #12215, #12313** to **#11521, #12215, #12313**



---

archive/issue_comments_145354.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@simon-king-jena](#comment%3A60):\n> Anyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a `_an_element_` method.\n\n... or: One could replace that test - after all, the test is new (introduced in the first patch).",
    "created_at": "2012-08-28T15:56:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145354",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@simon-king-jena](#comment%3A60):
> Anyway. There just remains the error in sage -t  -force_lib devel/sage/sage/categories/hecke_modules.py, which amounts to writing a `_an_element_` method.

... or: One could replace that test - after all, the test is new (introduced in the first patch).



---

archive/issue_comments_145355.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nI think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.\n\nI am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:\n\n```\nsage: M = ModularForms(Gamma0(7), 4)\nsage: H = Hom(M,M)\nsage: H is loads(dumps(H))\nFalse\n```\nso that by consequence several tests from the test suite fail.",
    "created_at": "2012-08-28T17:08:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145355",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:62" align="right">comment:62</div>

I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.

I am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:

```
sage: M = ModularForms(Gamma0(7), 4)
sage: H = Hom(M,M)
sage: H is loads(dumps(H))
False
```
so that by consequence several tests from the test suite fail.



---

archive/issue_comments_145356.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@simon-king-jena](#comment%3A62):\n> \n> ```\n> sage: M = ModularForms(Gamma0(7), 4)\n> sage: H = Hom(M,M)\n> sage: H is loads(dumps(H))\n> False\n> ```\n\n... which has two reasons: `H` has no `__reduce__` method, and `M` has no reduce method.",
    "created_at": "2012-08-28T17:18:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145356",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@simon-king-jena](#comment%3A62):
> 
> ```
> sage: M = ModularForms(Gamma0(7), 4)
> sage: H = Hom(M,M)
> sage: H is loads(dumps(H))
> False
> ```

... which has two reasons: `H` has no `__reduce__` method, and `M` has no reduce method.



---

archive/issue_comments_145357.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nHi Simon!\n\nReplying to [@simon-king-jena](#comment%3A62):\n> I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.\n> \n> I am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:\n> \n> ```\n> sage: M = ModularForms(Gamma0(7), 4)\n> sage: H = Hom(M,M)\n> sage: H is loads(dumps(H))\n> False\n> ```\n> so that by consequence several tests from the test suite fail.\n\nFeel free to just skip the failing tests and mention them, say on #12879.\n\nAnd thanks a lot for all the work you put in rebasing/finalizing this patch! I'll try to look at it tomorrow.\n\nCheers,\n                         Nicolas",
    "created_at": "2012-08-28T20:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145357",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:64" align="right">comment:64</div>

Hi Simon!

Replying to [@simon-king-jena](#comment%3A62):
> I think implementing a `_an_element_` is easy enough that I can do it in another reviewer patch. One thing doesn't work as described in the documentation, though. It says that a homomorphism of Hecke algebras can not only be obtained from a matrix (that works) but from an element of a Hecke algebra (I suppose: An element of the codomain). However, this isn't implemented.
> 
> I am not competent to implement it. So, I suggest that I start with implementing `_an_element_`, try to use the category framework on these homsets (i.e., define the Element attribute), and very important: Make the homsets unique upon pickling. Namely:
> 
> ```
> sage: M = ModularForms(Gamma0(7), 4)
> sage: H = Hom(M,M)
> sage: H is loads(dumps(H))
> False
> ```
> so that by consequence several tests from the test suite fail.

Feel free to just skip the failing tests and mention them, say on #12879.

And thanks a lot for all the work you put in rebasing/finalizing this patch! I'll try to look at it tomorrow.

Cheers,
                         Nicolas



---

archive/issue_comments_145358.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@nthiery](#comment%3A64):\n> Feel free to just skip the failing tests and mention them, say on #12879.\n\n... and to remove the erroneous documentation (or perhaps: Marking it as \"TODO\").\n\nI was confident that I have produced a patch (not posted, though) that does the right thing with the categories of Hecke homsets. In fact, the full `TestSuite` of these homsets passes. However, a surprising amount of tests fail, all over sage. So, I guess you are right: One should work around for now, and fix it for real in #12879.\n\nCheers,\nSimon",
    "created_at": "2012-08-28T21:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145358",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@nthiery](#comment%3A64):
> Feel free to just skip the failing tests and mention them, say on #12879.

... and to remove the erroneous documentation (or perhaps: Marking it as "TODO").

I was confident that I have produced a patch (not posted, though) that does the right thing with the categories of Hecke homsets. In fact, the full `TestSuite` of these homsets passes. However, a surprising amount of tests fail, all over sage. So, I guess you are right: One should work around for now, and fix it for real in #12879.

Cheers,
Simon



---

archive/issue_comments_145359.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI have updated the last patch, so that more tests from the failing `TestSuite` are skipped. Let's see if the patchbot is happy.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch",
    "created_at": "2012-08-29T09:07:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145359",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:66" align="right">comment:66</div>

I have updated the last patch, so that more tests from the failing `TestSuite` are skipped. Let's see if the patchbot is happy.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch



---

archive/issue_comments_145360.json:
```json
{
    "body": "Attachment: **[trac_12876_fix_infinite_polynomial_ring.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)**\n\nDo not weak-cache things in infinite_polynomial_ring that are cached anyway. Skip more tests in Hecke homset's `TestSuite`",
    "created_at": "2012-08-29T13:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145360",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac_12876_fix_infinite_polynomial_ring.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)**

Do not weak-cache things in infinite_polynomial_ring that are cached anyway. Skip more tests in Hecke homset's `TestSuite`



---

archive/issue_comments_145361.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nOops, I thought that I had an outdated version of my last patch, but apparently it has been the correct one. Anyway, I'll restart the patchbot and will run the tests on my own machine as well, and will of course have a look at Nicolas' patches\n\nFrom Nicolas' comment on #12879, I understood that he accepts to make the `TestSuite` temporarily silent and leave a proper fix to the number theorists. I guess that's a healthy attitude...\n\nI hope that Nicolas also likes the fix for infinite polynomial rings.\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch",
    "created_at": "2012-08-29T13:05:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145361",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:67" align="right">comment:67</div>

Oops, I thought that I had an outdated version of my last patch, but apparently it has been the correct one. Anyway, I'll restart the patchbot and will run the tests on my own machine as well, and will of course have a look at Nicolas' patches

From Nicolas' comment on #12879, I understood that he accepts to make the `TestSuite` temporarily silent and leave a proper fix to the number theorists. I guess that's a healthy attitude...

I hope that Nicolas also likes the fix for infinite polynomial rings.

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch



---

archive/issue_comments_145362.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nSome questions, Nicolas:\n\nThe first patch contains\n\n```\nsage: category = FiniteDimensionalModulesWithBasis(QQ) \nsage: X = CombinatorialFreeModule(QQ, [1,2,3], category = category);   X.rename(\"X\") \nsage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], category = category); Y.rename(\"Y\") \nsage: H = Hom(X, Y) \nsage: H.zero().category_for() \nCategory of finite dimensional modules with basis over Rational Field\n```\nWhy are X and Y renamed? There is yet another location where things are renamed, namely\n\n```\nDiagonal functions can be constructed using the ``diagonal`` option:: \n\n    sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename(\"X\") \n    sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key=\"Y\"); Y.rename(\"Y\") \n    sage: H = Hom(X, Y)\n```\nHere, I also wonder about the \"key\" argument.\n\nIn sage.rings.ring.pyx, you state:\n\n```\n    \"\"\"\n    This temporary alias is here for those instances of :class:`Ring`\n    that are not yet properly in the :class:`Rings`() category.\n\n    TESTS::\n\n        sage: A = Ring(ZZ)\n        sage: A._Hom_.__module__\n        'sage.categories.rings'\n        sage: Hom(A,A).__class__\n        <class 'sage.rings.homset.RingHomset_generic_with_category'>\n    \"\"\"\n    _Hom_ = Rings.ParentMethods.__dict__['_Hom_']\n```\nAre there any rings that do not initialise the category, after #9138? Hence, what would happen without that alias? Perhaps I'll test it, after finishing the tests for the original patches.",
    "created_at": "2012-08-29T13:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145362",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:68" align="right">comment:68</div>

Some questions, Nicolas:

The first patch contains

```
sage: category = FiniteDimensionalModulesWithBasis(QQ) 
sage: X = CombinatorialFreeModule(QQ, [1,2,3], category = category);   X.rename("X") 
sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], category = category); Y.rename("Y") 
sage: H = Hom(X, Y) 
sage: H.zero().category_for() 
Category of finite dimensional modules with basis over Rational Field
```
Why are X and Y renamed? There is yet another location where things are renamed, namely

```
Diagonal functions can be constructed using the ``diagonal`` option:: 

    sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename("X") 
    sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key="Y"); Y.rename("Y") 
    sage: H = Hom(X, Y)
```
Here, I also wonder about the "key" argument.

In sage.rings.ring.pyx, you state:

```
    """
    This temporary alias is here for those instances of :class:`Ring`
    that are not yet properly in the :class:`Rings`() category.

    TESTS::

        sage: A = Ring(ZZ)
        sage: A._Hom_.__module__
        'sage.categories.rings'
        sage: Hom(A,A).__class__
        <class 'sage.rings.homset.RingHomset_generic_with_category'>
    """
    _Hom_ = Rings.ParentMethods.__dict__['_Hom_']
```
Are there any rings that do not initialise the category, after #9138? Hence, what would happen without that alias? Perhaps I'll test it, after finishing the tests for the original patches.



---

archive/issue_comments_145363.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nAll tests passed, and the patches look good to me, modulo the questions that I asked above. I will now rerun the tests without the alias for _Hom_.",
    "created_at": "2012-08-29T16:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145363",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:69" align="right">comment:69</div>

All tests passed, and the patches look good to me, modulo the questions that I asked above. I will now rerun the tests without the alias for _Hom_.



---

archive/issue_comments_145364.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nWhen removing the `_Hom_` alias, I get\n\n```\n        sage -t  -force_lib devel/sage/sage/rings/multi_power_series_ring_element.py # 5 doctests failed\n```\nSo, apparently it *is* needed.",
    "created_at": "2012-08-29T17:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145364",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:70" align="right">comment:70</div>

When removing the `_Hom_` alias, I get

```
        sage -t  -force_lib devel/sage/sage/rings/multi_power_series_ring_element.py # 5 doctests failed
```
So, apparently it *is* needed.



---

archive/issue_comments_145365.json:
```json
{
    "body": "Another reviewer patch",
    "created_at": "2012-08-29T21:16:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145365",
    "user": "https://github.com/simon-king-jena"
}
```

Another reviewer patch



---

archive/issue_comments_145366.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nAttachment: **[trac_12876_another_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_another_reviewer.patch.gz)**\n\nI give it a positive review, modulo commit message of [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) and modulo the small reviewer patch that I have attached. I think it should be `.. todo::` and not `..TODO::` (note the blank space).\n\nSo, when you added a commit message to your patch, then please change it into a positive review!\n\nApply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch  trac_12876_another_reviewer.patch",
    "created_at": "2012-08-29T21:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145366",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:71" align="right">comment:71</div>

Attachment: **[trac_12876_another_reviewer.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_another_reviewer.patch.gz)**

I give it a positive review, modulo commit message of [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz) and modulo the small reviewer patch that I have attached. I think it should be `.. todo::` and not `..TODO::` (note the blank space).

So, when you added a commit message to your patch, then please change it into a positive review!

Apply trac_12876_category-fix_abstract_class-sk-rel11521.patch trac_12876-reviewer.patch trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch trac_12876_fix_infinite_polynomial_ring.patch  trac_12876_another_reviewer.patch



---

archive/issue_comments_145367.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -33,4 +33,5 @@\n * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)\n * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n * [attachment: trac_12876_fix_infinite_polynomial_ring.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)\n+* [attachment: trac_12876_another_reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_another_reviewer.patch.gz)\n \n``````\n",
    "created_at": "2012-08-29T21:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145367",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -33,4 +33,5 @@
 * [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)
 * [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
 * [attachment: trac_12876_fix_infinite_polynomial_ring.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)
+* [attachment: trac_12876_another_reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_another_reviewer.patch.gz)
 
``````




---

archive/issue_comments_145368.json:
```json
{
    "body": "Changed work issues from **fix doctests and segfaults** to **add commit message to one patch**",
    "created_at": "2012-08-29T21:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145368",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **fix doctests and segfaults** to **add commit message to one patch**



---

archive/issue_comments_145369.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nHere is the problem with removing the nasty alias:\n\n```\nsage: A.<a,b> = PowerSeriesRing(QQ)\nsage: A._is_category_initialized()\nFalse\nsage: isinstance(A,Ring)\nTrue\n```\n\nHence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.",
    "created_at": "2012-08-30T08:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145369",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:72" align="right">comment:72</div>

Here is the problem with removing the nasty alias:

```
sage: A.<a,b> = PowerSeriesRing(QQ)
sage: A._is_category_initialized()
False
sage: isinstance(A,Ring)
True
```

Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.



---

archive/issue_comments_145370.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@simon-king-jena](#comment%3A72):\n> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.\n\nSee #13412",
    "created_at": "2012-08-30T08:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145370",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@simon-king-jena](#comment%3A72):
> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.

See #13412



---

archive/issue_comments_145371.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nHi Simon,\n\nSorry, I am slow answering; I was immersed all afternoon in tracking\ndown a nasty bug where UniqueRepresentation was violated. It turned\nout that the UniqueRepresentation dict had to equal entries in its\nkeys (gasp), and that was due to a tricky mro order for a non trivial\ninheritance involving Category_singleton and FastHash which got the\nhash to change over time ... Anyway ...\n\nReplying to [@simon-king-jena](#comment%3A68):\n> \n> ```\n> Diagonal functions can be constructed using the ``diagonal`` option:: \n> \n>     sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename(\"X\") \n>     sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key=\"Y\"); Y.rename(\"Y\") \n>     sage: H = Hom(X, Y)\n> ```\n> Why are X and Y renamed? There is yet another location where things are renamed, namely\n> Here, I also wonder about the \"key\" argument.\n\nI do this fairly systematically in the tests in modules_with_basis. It\nmakes it immediate to check that the domain and codomain are set\nproperly when looking at the repr of a morphism or homset. They key is\nto force the domain and codomain to be distinct (otherwise, and this\nhappened to me, if the code accidently interchanges the two it will\nget unnoticed).\n\nWell, and for good or bad, once you rename a given parent in a\ndoctest, you have to rename consistently this parent in all other\ndoctests in the same file. Or to call X.rename() at the end of the\ndoctest.",
    "created_at": "2012-08-30T08:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145371",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:74" align="right">comment:74</div>

Hi Simon,

Sorry, I am slow answering; I was immersed all afternoon in tracking
down a nasty bug where UniqueRepresentation was violated. It turned
out that the UniqueRepresentation dict had to equal entries in its
keys (gasp), and that was due to a tricky mro order for a non trivial
inheritance involving Category_singleton and FastHash which got the
hash to change over time ... Anyway ...

Replying to [@simon-king-jena](#comment%3A68):
> 
> ```
> Diagonal functions can be constructed using the ``diagonal`` option:: 
> 
>     sage: X = CombinatorialFreeModule(QQ, [1,2,3,4]); X.rename("X") 
>     sage: Y = CombinatorialFreeModule(QQ, [1,2,3,4], key="Y"); Y.rename("Y") 
>     sage: H = Hom(X, Y)
> ```
> Why are X and Y renamed? There is yet another location where things are renamed, namely
> Here, I also wonder about the "key" argument.

I do this fairly systematically in the tests in modules_with_basis. It
makes it immediate to check that the domain and codomain are set
properly when looking at the repr of a morphism or homset. They key is
to force the domain and codomain to be distinct (otherwise, and this
happened to me, if the code accidently interchanges the two it will
get unnoticed).

Well, and for good or bad, once you rename a given parent in a
doctest, you have to rename consistently this parent in all other
doctests in the same file. Or to call X.rename() at the end of the
doctest.



---

archive/issue_comments_145372.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nReplying to [@simon-king-jena](#comment%3A72):\n> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.\n\n+1\n\nCan you just add a mini comment on #13412 stating that once it's done the alias can be removed?\n\nThanks!",
    "created_at": "2012-08-30T08:49:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145372",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:75" align="right">comment:75</div>

Replying to [@simon-king-jena](#comment%3A72):
> Hence, apparently `Ring.__init__` is not called on `PowerSeriesRing`. That's nasty, but I think in order to make any progress it would be better to leave that to a different ticket.

+1

Can you just add a mini comment on #13412 stating that once it's done the alias can be removed?

Thanks!



---

archive/issue_comments_145373.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@simon-king-jena](#comment%3A71):\n> I give it a positive review, modulo commit message of\n> [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n> and modulo the small reviewer patch that I have attached. I think it\n> should be `.. todo::` and not `..TODO::` (note the blank space).\n\nThanks for fixing the space. Apparently, there is some sort of\nconsensus for using .. TODO:: rather than .. todo:: (same thing\nfor seealso, ...).\n\nI have checked the change on infinite polynomial rings, and am ok with\nit.\n\nDo you mind folding all patches together? Now that we have checked the\nlittle steps, that will leave a better overview for the future. And\nthat will take care of the commit messages :-)\n\n(or I can do it, but I need to get the latest beta version first).\n\nAnd then, it's ready for positive review! Yippee!\n\nCheers,\n                   Nicolas",
    "created_at": "2012-08-30T09:05:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145373",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@simon-king-jena](#comment%3A71):
> I give it a positive review, modulo commit message of
> [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
> and modulo the small reviewer patch that I have attached. I think it
> should be `.. todo::` and not `..TODO::` (note the blank space).

Thanks for fixing the space. Apparently, there is some sort of
consensus for using .. TODO:: rather than .. todo:: (same thing
for seealso, ...).

I have checked the change on infinite polynomial rings, and am ok with
it.

Do you mind folding all patches together? Now that we have checked the
little steps, that will leave a better overview for the future. And
that will take care of the commit messages :-)

(or I can do it, but I need to get the latest beta version first).

And then, it's ready for positive review! Yippee!

Cheers,
                   Nicolas



---

archive/issue_comments_145374.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@nthiery](#comment%3A76):\n> Replying to [@simon-king-jena](#comment%3A71):\n> > I give it a positive review, modulo commit message of\n> > [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n> > and modulo the small reviewer patch that I have attached. I think it\n> > should be `.. todo::` and not `..TODO::` (note the blank space).\n\n> \n> Thanks for fixing the space. Apparently, there is some sort of\n> consensus for using .. TODO:: rather than .. todo:: (same thing\n> for seealso, ...).\n\nI wouldn't mind to have it upper case.\n\n> (or I can do it, but I need to get the latest beta version first).\n\nI don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.",
    "created_at": "2012-08-30T10:22:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145374",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@nthiery](#comment%3A76):
> Replying to [@simon-king-jena](#comment%3A71):
> > I give it a positive review, modulo commit message of
> > [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
> > and modulo the small reviewer patch that I have attached. I think it
> > should be `.. todo::` and not `..TODO::` (note the blank space).

> 
> Thanks for fixing the space. Apparently, there is some sort of
> consensus for using .. TODO:: rather than .. todo:: (same thing
> for seealso, ...).

I wouldn't mind to have it upper case.

> (or I can do it, but I need to get the latest beta version first).

I don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.



---

archive/issue_comments_145375.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@simon-king-jena](#comment%3A77):\n> I don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.\n\nI meant for folding the patches together!",
    "created_at": "2012-08-30T10:52:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145375",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@simon-king-jena](#comment%3A77):
> I don't think you need any beta version if you want to add a commit message. I think editing the patch and replacing the line `[mq]: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch` by, say `#12876: Use generic code for sage.categories.rings.Rings.HomCategory` would be enough.

I meant for folding the patches together!



---

archive/issue_comments_145376.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nWhy folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?",
    "created_at": "2012-08-30T11:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145376",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:79" align="right">comment:79</div>

Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?



---

archive/issue_comments_145377.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [@simon-king-jena](#comment%3A79):\n> Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?\n\nIt's not so much about the release manager than for whoever will come\nback to this ticket in the future, and will want to have a synthetic\nview of what the patch(es) does.\n\nSeparate patches are temporarily good for incremental review. They can\nbe interesting too in the long run when they do independent\nchanges. But when they pile on top of each other (typically for\ntrivial typo fixes) it goes in the way of the reader. Typically (s)he\nwill read the main patch, see a typo, wonder if it has been fixed,\nwill have to dig through the followup patches, think about the order\nin which they are to be applied, etc.",
    "created_at": "2012-08-30T12:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145377",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [@simon-king-jena](#comment%3A79):
> Why folding? Perhaps that's a question to the release manager. But are four patches substantially more difficult to merge than one patch?

It's not so much about the release manager than for whoever will come
back to this ticket in the future, and will want to have a synthetic
view of what the patch(es) does.

Separate patches are temporarily good for incremental review. They can
be interesting too in the long run when they do independent
changes. But when they pile on top of each other (typically for
trivial typo fixes) it goes in the way of the reader. Typically (s)he
will read the main patch, see a typo, wonder if it has been fixed,
will have to dig through the followup patches, think about the order
in which they are to be applied, etc.



---

archive/issue_comments_145378.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nI produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it \"needs review\" for now, but will change it into positive review provided the tests pass.\n\nApply  trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2012-08-30T13:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145378",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:81" align="right">comment:81</div>

I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it "needs review" for now, but will change it into positive review provided the tests pass.

Apply  trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_145379.json:
```json
{
    "body": "Changed dependencies from **#11521, #12215, #12313** to **#11521, #12215, #12313, #13412**",
    "created_at": "2012-08-30T13:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145379",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#11521, #12215, #12313** to **#11521, #12215, #12313, #13412**



---

archive/issue_comments_145380.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,9 +29,4 @@\n \n Apply:\n \n-* [attachment: trac_12876_category-fix_abstract_class-sk-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)\n-* [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)\n-* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)\n-* [attachment: trac_12876_fix_infinite_polynomial_ring.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)\n-* [attachment: trac_12876_another_reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_another_reviewer.patch.gz)\n-\n+* [attachment: trac_12876_category_abstract_classes_for_hom.patch]\n``````\n",
    "created_at": "2012-08-30T13:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145380",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,9 +29,4 @@
 
 Apply:
 
-* [attachment: trac_12876_category-fix_abstract_class-sk-rel11521.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-sk-rel11521.patch.gz)
-* [attachment: trac_12876-reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-reviewer.patch.gz)
-* [attachment: trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category-fix_abstract_class-nt-rel11521-review-nt.patch.gz)
-* [attachment: trac_12876_fix_infinite_polynomial_ring.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_fix_infinite_polynomial_ring.patch.gz)
-* [attachment: trac_12876_another_reviewer.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_another_reviewer.patch.gz)
-
+* [attachment: trac_12876_category_abstract_classes_for_hom.patch]
``````




---

archive/issue_comments_145381.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nReplying to [@simon-king-jena](#comment%3A81):\n> I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it \"needs review\" for now, but will change it into positive review provided the tests pass.\n> \n> Apply  trac_12876_category_abstract_classes_for_hom.patch\n\nExcellent, thanks!\n\nIs there any of the old patches that you would like to keep for posterity, or should I just wipe them up?\n\nCheers,",
    "created_at": "2012-08-30T13:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145381",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:82" align="right">comment:82</div>

Replying to [@simon-king-jena](#comment%3A81):
> I produced a combined patch. I added #13412, because it allows to remove the ugly alias for `_Hom_` in sage.rings.ring. Because of that last change, I keep it "needs review" for now, but will change it into positive review provided the tests pass.
> 
> Apply  trac_12876_category_abstract_classes_for_hom.patch

Excellent, thanks!

Is there any of the old patches that you would like to keep for posterity, or should I just wipe them up?

Cheers,



---

archive/issue_comments_145382.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nI wouldn't remove the old patches from trac - and actually I wouldn't be able to remove them -, unless there are problems with disc space etc. And IF there will eventually be problems with disc space, I guess a better solution would be to start deleting the attachments of tickets that are merged since, say, at least one year.",
    "created_at": "2012-08-30T13:55:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145382",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:83" align="right">comment:83</div>

I wouldn't remove the old patches from trac - and actually I wouldn't be able to remove them -, unless there are problems with disc space etc. And IF there will eventually be problems with disc space, I guess a better solution would be to start deleting the attachments of tickets that are merged since, say, at least one year.



---

archive/issue_comments_145383.json:
```json
{
    "body": "Changed work issues from **add commit message to one patch** to **Understand why the crash in infinite_polynomial_ring is not fixed and what happens with r**",
    "created_at": "2012-08-30T14:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145383",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **add commit message to one patch** to **Understand why the crash in infinite_polynomial_ring is not fixed and what happens with r**



---

archive/issue_events_176075.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-30T14:30:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176075"
}
```



---

archive/issue_events_176076.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-30T14:30:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176076"
}
```



---

archive/issue_comments_145384.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nThat's bad. Pathbot reports\n\n```\n\tsage -t  -force_lib devel/sage-12876/sage/rings/polynomial/infinite_polynomial_ring.py # Killed/crashed\n\tsage -t  -force_lib devel/sage-12876/sage/interfaces/r.py # 1 doctests failed\n```\n\nThe crash in infinite_polynomial_ring.py was supposed to be fixed with one of the folded patches, namely removing the additional weak cache. The second one has occurred on my computer as well - but was not reproducible, so I thought it was just some noise.\n\nBad.",
    "created_at": "2012-08-30T14:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145384",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:84" align="right">comment:84</div>

That's bad. Pathbot reports

```
	sage -t  -force_lib devel/sage-12876/sage/rings/polynomial/infinite_polynomial_ring.py # Killed/crashed
	sage -t  -force_lib devel/sage-12876/sage/interfaces/r.py # 1 doctests failed
```

The crash in infinite_polynomial_ring.py was supposed to be fixed with one of the folded patches, namely removing the additional weak cache. The second one has occurred on my computer as well - but was not reproducible, so I thought it was just some noise.

Bad.



---

archive/issue_comments_145385.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nI tried to stress-test my machine, running 16 copies of the infinite_polynomial_ring tests in parallel on only 4 kernels, but I was not able to reproduce the segfault.\n\nConcerning the other error, perhaps one can add the following patch:\n\n```patch\ndiff --git a/sage/interfaces/r.py b/sage/interfaces/r.py\n--- a/sage/interfaces/r.py\n+++ b/sage/interfaces/r.py\n@@ -1166,7 +1166,7 @@\n \n         ::\n \n-            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())\n+            sage: os.path.realpath(tmpdir) == os.path.realpath(sageobj(r.getwd()))\n             True\n         \"\"\"\n         self.execute('setwd(%r)' % dir)\n```",
    "created_at": "2012-08-30T15:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145385",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:85" align="right">comment:85</div>

I tried to stress-test my machine, running 16 copies of the infinite_polynomial_ring tests in parallel on only 4 kernels, but I was not able to reproduce the segfault.

Concerning the other error, perhaps one can add the following patch:

```patch
diff --git a/sage/interfaces/r.py b/sage/interfaces/r.py
--- a/sage/interfaces/r.py
+++ b/sage/interfaces/r.py
@@ -1166,7 +1166,7 @@
 
         ::
 
-            sage: os.path.realpath(tmpdir) == sageobj(r.getwd())
+            sage: os.path.realpath(tmpdir) == os.path.realpath(sageobj(r.getwd()))
             True
         """
         self.execute('setwd(%r)' % dir)
```



---

archive/issue_events_176077.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-30T15:28:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176077"
}
```



---

archive/issue_events_176078.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-08-30T15:28:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176078"
}
```



---

archive/issue_comments_145386.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,4 +29,5 @@\n \n Apply:\n \n-* [attachment: trac_12876_category_abstract_classes_for_hom.patch]\n+* [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n+* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)\n``````\n",
    "created_at": "2012-08-30T15:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145386",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,4 +29,5 @@
 
 Apply:
 
-* [attachment: trac_12876_category_abstract_classes_for_hom.patch]
+* [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
+* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)
``````




---

archive/issue_comments_145387.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nLet's try, even though I have no idea about the segfault:\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch",
    "created_at": "2012-08-30T15:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145387",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:86" align="right">comment:86</div>

Let's try, even though I have no idea about the segfault:

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch



---

archive/issue_comments_145388.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nOK, the r-test works now. But the segfault remains. I wish I could reproduce it, preferably in verbose mode.",
    "created_at": "2012-08-30T15:56:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145388",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:87" align="right">comment:87</div>

OK, the r-test works now. But the segfault remains. I wish I could reproduce it, preferably in verbose mode.



---

archive/issue_comments_145389.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nI tried to valgrind the failing segfault (Nils Bruin recommended valgrind and posted a sage.supp at #11918), in the hope that it'll find something fishy even if it doesn't result in a segfault.\n\nWhen I run the tests of sage/rings/polynomial/infinite_polynomial_ring.py, I do not get a SIGILL. But I do get a considerable amount of lost memory:\n\n```\n==13541== 13,936 bytes in 1 blocks are definitely lost in loss record 8,673 of 8,997\n==13541==    at 0x4C244E8: malloc (vg_replace_malloc.c:236)\n==13541==    by 0x21E8984F: omAllocFromSystem (omAllocSystem.c:184)\n==13541==    by 0x21E89A21: omAllocLarge (omAllocSystem.c:39)\n==13541==    by 0x21BB3A00: iiAllStart(procinfo*, char*, feBufferTypes, int) (omalloc.h:2432)\n==13541==    by 0x21BB3B95: iiPStart(idrec*, sleftv*) (iplib.cc:360)\n==13541==    by 0x21BB4148: iiMake_proc(idrec*, sip_package*, sleftv*) (iplib.cc:482)\n==13541==    by 0x2239B64D: __pyx_f_4sage_4libs_8singular_8function_call_function(__pyx_obj_4sage_4libs_8singular_8function_SingularFunction*, _object*, _object*, __pyx_opt_args_4sage_4libs_8singular_8f\nunction_call_function*) (function.cpp:13241)\n==13541==    by 0x2239CBA8: __pyx_pw_4sage_4libs_8singular_8function_16SingularFunction_5__call__(_object*, _object*, _object*) (function.cpp:11924)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0x4F160FC: PyEval_EvalFrameEx (ceval.c:4239)\n==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)\n==13541==    by 0x4E9C122: function_call (funcobject.c:526)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)\n==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)\n==13541==    by 0x4E9C122: function_call (funcobject.c:526)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)\n==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)\n==13541==    by 0x4E9C122: function_call (funcobject.c:526)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0xB29B841: __pyx_pw_4sage_4misc_9cachefunc_12CachedMethod_3_instance_call (cachefunc.c:9733)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n==13541==    by 0xB29C7D4: __pyx_pw_4sage_4misc_9cachefunc_18CachedMethodCaller_7__call__ (cachefunc.c:7254)\n==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)\n```\nIs there a way to find out what singular_function or what cached method are involved?",
    "created_at": "2012-08-30T21:24:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145389",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:88" align="right">comment:88</div>

I tried to valgrind the failing segfault (Nils Bruin recommended valgrind and posted a sage.supp at #11918), in the hope that it'll find something fishy even if it doesn't result in a segfault.

When I run the tests of sage/rings/polynomial/infinite_polynomial_ring.py, I do not get a SIGILL. But I do get a considerable amount of lost memory:

```
==13541== 13,936 bytes in 1 blocks are definitely lost in loss record 8,673 of 8,997
==13541==    at 0x4C244E8: malloc (vg_replace_malloc.c:236)
==13541==    by 0x21E8984F: omAllocFromSystem (omAllocSystem.c:184)
==13541==    by 0x21E89A21: omAllocLarge (omAllocSystem.c:39)
==13541==    by 0x21BB3A00: iiAllStart(procinfo*, char*, feBufferTypes, int) (omalloc.h:2432)
==13541==    by 0x21BB3B95: iiPStart(idrec*, sleftv*) (iplib.cc:360)
==13541==    by 0x21BB4148: iiMake_proc(idrec*, sip_package*, sleftv*) (iplib.cc:482)
==13541==    by 0x2239B64D: __pyx_f_4sage_4libs_8singular_8function_call_function(__pyx_obj_4sage_4libs_8singular_8function_SingularFunction*, _object*, _object*, __pyx_opt_args_4sage_4libs_8singular_8f
unction_call_function*) (function.cpp:13241)
==13541==    by 0x2239CBA8: __pyx_pw_4sage_4libs_8singular_8function_16SingularFunction_5__call__(_object*, _object*, _object*) (function.cpp:11924)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0x4F160FC: PyEval_EvalFrameEx (ceval.c:4239)
==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)
==13541==    by 0x4E9C122: function_call (funcobject.c:526)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)
==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)
==13541==    by 0x4E9C122: function_call (funcobject.c:526)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0x4F14C59: PyEval_EvalFrameEx (ceval.c:4334)
==13541==    by 0x4F19124: PyEval_EvalCodeEx (ceval.c:3253)
==13541==    by 0x4E9C122: function_call (funcobject.c:526)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0xB29B841: __pyx_pw_4sage_4misc_9cachefunc_12CachedMethod_3_instance_call (cachefunc.c:9733)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
==13541==    by 0xB29C7D4: __pyx_pw_4sage_4misc_9cachefunc_18CachedMethodCaller_7__call__ (cachefunc.c:7254)
==13541==    by 0x4E742C2: PyObject_Call (abstract.c:2529)
```
Is there a way to find out what singular_function or what cached method are involved?



---

archive/issue_comments_145390.json:
```json
{
    "body": "Changed dependencies from **#11521, #12215, #12313, #13412** to **#11521, #12215, #12313, #13412. #13145**",
    "created_at": "2012-09-01T23:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145390",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#11521, #12215, #12313, #13412** to **#11521, #12215, #12313, #13412. #13145**



---

archive/issue_comments_145391.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nIt seems that #13145 fixes the segfault that was sometimes observed at #13370. Perhaps it helps here as well? Let's try!",
    "created_at": "2012-09-01T23:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145391",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:89" align="right">comment:89</div>

It seems that #13145 fixes the segfault that was sometimes observed at #13370. Perhaps it helps here as well? Let's try!



---

archive/issue_comments_145392.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nToo bad, #13145 didn't help.\n\nI'd really need some help to trace the problem down. Could someone run the test in verbose mode on one of the machines exposing the segfault, so that one can see whether the problem is during the tests or while shutting down Sage? Can someone produce (and post) a backtrace?",
    "created_at": "2012-09-02T07:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145392",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:90" align="right">comment:90</div>

Too bad, #13145 didn't help.

I'd really need some help to trace the problem down. Could someone run the test in verbose mode on one of the machines exposing the segfault, so that one can see whether the problem is during the tests or while shutting down Sage? Can someone produce (and post) a backtrace?



---

archive/issue_comments_145393.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nThere is a potential name conflict between an attribute S of Action and `RingHomomorphism`. The former has been turned into a weak reference at #715. I am now trying to rename the attribute of Action, and updated the main patch at #715 accordingly.\n\nHence, kicking the patchbot now. Hope it works!",
    "created_at": "2012-09-03T09:35:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145393",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:91" align="right">comment:91</div>

There is a potential name conflict between an attribute S of Action and `RingHomomorphism`. The former has been turned into a weak reference at #715. I am now trying to rename the attribute of Action, and updated the main patch at #715 accordingly.

Hence, kicking the patchbot now. Hope it works!



---

archive/issue_comments_145394.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nIt doesn't work. Hence, again I'd like to finally see a backtrace of the segfault. So far, I tried to reproduce the segfault on my linux laptop, but to no avail. Next, I'll try bsd.math.",
    "created_at": "2012-09-03T12:35:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145394",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:92" align="right">comment:92</div>

It doesn't work. Hence, again I'd like to finally see a backtrace of the segfault. So far, I tried to reproduce the segfault on my linux laptop, but to no avail. Next, I'll try bsd.math.



---

archive/issue_comments_145395.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nNow I am totally puzzled. On bsd.math, admittedly with the new GAP 4.5.5 spkg, I get\n\n```\nThe following tests failed:\n\n        sage -t  -force_lib devel/sage/sage/combinat/combinatorial_algebra.py # 4 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/partition.py # 3 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/classical.py # 11 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/dual.py # 89 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/elementary.py # 9 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/hall_littlewood.py # 61 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/homogeneous.py # 9 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/jack.py # 68 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/kschur.py # 15 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/llt.py # 50 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/monomial.py # 16 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/ns_macdonald.py # 2 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/macdonald.py # 106 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/orthotriang.py # 25 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/powersum.py # 17 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/schur.py # 13 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/sf/sfa.py # 291 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/composition_species.py # 4 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/functorial_composition_species.py # 3 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/generating_series.py # 38 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/library.py # 4 doctests failed\n        sage -t  -force_lib devel/sage/sage/combinat/species/species.py # 4 doctests failed\n```\nbut no segfault. Does one need #5457?",
    "created_at": "2012-09-03T14:36:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145395",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:93" align="right">comment:93</div>

Now I am totally puzzled. On bsd.math, admittedly with the new GAP 4.5.5 spkg, I get

```
The following tests failed:

        sage -t  -force_lib devel/sage/sage/combinat/combinatorial_algebra.py # 4 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/partition.py # 3 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/classical.py # 11 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/dual.py # 89 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/elementary.py # 9 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/hall_littlewood.py # 61 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/homogeneous.py # 9 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/jack.py # 68 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/kschur.py # 15 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/llt.py # 50 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/monomial.py # 16 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/ns_macdonald.py # 2 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/macdonald.py # 106 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/orthotriang.py # 25 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/powersum.py # 17 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/schur.py # 13 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/sf/sfa.py # 291 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/composition_species.py # 4 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/functorial_composition_species.py # 3 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/generating_series.py # 38 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/library.py # 4 doctests failed
        sage -t  -force_lib devel/sage/sage/combinat/species/species.py # 4 doctests failed
```
but no segfault. Does one need #5457?



---

archive/issue_comments_145396.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nDid you forget a `./sage -b` by chance?",
    "created_at": "2012-09-03T14:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145396",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:94" align="right">comment:94</div>

Did you forget a `./sage -b` by chance?



---

archive/issue_comments_145397.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nReplying to [@jdemeyer](#comment%3A94):\n> Did you forget a `./sage -b` by chance?\n\nDoesn't `make ptest` start with `./sage -b`?",
    "created_at": "2012-09-03T14:48:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145397",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:95" align="right">comment:95</div>

Replying to [@jdemeyer](#comment%3A94):
> Did you forget a `./sage -b` by chance?

Doesn't `make ptest` start with `./sage -b`?



---

archive/issue_comments_145398.json:
```json
{
    "body": "<div id=\"comment:96\" align=\"right\">comment:96</div>\n\nIt is really really REALLY frustrating. Volker's patchbot keeps reporting a segfault, but I can not reproduce it on bsd.math, With #5457 and the new GAP spkg, make ptest just reports a single error:\n\n```\nsage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"      \n**********************************************************************\nFile \"/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py\", line 809:\n    sage: gap(2)\nExpected:\n    2\nGot:\n    <BLANKLINE>\n**********************************************************************\n1 items had failures:\n   1 of   4 in __main__.example_21\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /Users/SimonKing/.sage//tmp/gap_70056.py\n         [29.6 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -force_lib \"devel/sage/sage/interfaces/gap.py\"\nTotal time for all tests: 29.7 seconds\n```\nThat's rather strange, but I guess that's the problem of the GAP spkg.\n\nIn any case, I don't see a segfault. Not on my laptop, not on the machine in my office, not on bsd.math.",
    "created_at": "2012-09-03T19:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145398",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:96" align="right">comment:96</div>

It is really really REALLY frustrating. Volker's patchbot keeps reporting a segfault, but I can not reproduce it on bsd.math, With #5457 and the new GAP spkg, make ptest just reports a single error:

```
sage -t -force_lib "devel/sage/sage/interfaces/gap.py"      
**********************************************************************
File "/scratch/sking/sage-5.3.rc1/devel/sage/sage/interfaces/gap.py", line 809:
    sage: gap(2)
Expected:
    2
Got:
    <BLANKLINE>
**********************************************************************
1 items had failures:
   1 of   4 in __main__.example_21
***Test Failed*** 1 failures.
For whitespace errors, see the file /Users/SimonKing/.sage//tmp/gap_70056.py
         [29.6 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -force_lib "devel/sage/sage/interfaces/gap.py"
Total time for all tests: 29.7 seconds
```
That's rather strange, but I guess that's the problem of the GAP spkg.

In any case, I don't see a segfault. Not on my laptop, not on the machine in my office, not on bsd.math.



---

archive/issue_comments_145399.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nMeanwhile #11521 has a new dependency, namely #13447, that is supposed to fix the segfaults (which apparently came from a wrong refcount in libsingular).\n\nI am now running `make ptest` on bsd.math.washington.edu, with\n\n```\n$ hg qa\ntrac_715_combined.patch\ntrac_715_local_refcache.patch\ntrac_715_safer.patch\ntrac_715_specification.patch\ntrac_11521_homset_weakcache_combined.patch\ntrac_11521_callback.patch\n13145.patch\ntrac_13447-sanitise_ring_refcount.patch\ntrac12215_weak_cached_function-sk.patch\ntrac12215_segfault_fixes.patch\ntrac_12313-mono_dict-combined-random-sk.patch\ntrac_12313_quit_sage.patch\ntrac13370_deprecate_is_field.patch\ntrac_13378-convert_map_shortcut.patch\ntrac_13412_category_for_power_series_rings.patch\ntrac_12876_category_abstract_classes_for_hom.patch\ntrac_12876_r_test.patch\n```\napplied on top of sage-5.4.beta0.",
    "created_at": "2012-09-18T09:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145399",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:97" align="right">comment:97</div>

Meanwhile #11521 has a new dependency, namely #13447, that is supposed to fix the segfaults (which apparently came from a wrong refcount in libsingular).

I am now running `make ptest` on bsd.math.washington.edu, with

```
$ hg qa
trac_715_combined.patch
trac_715_local_refcache.patch
trac_715_safer.patch
trac_715_specification.patch
trac_11521_homset_weakcache_combined.patch
trac_11521_callback.patch
13145.patch
trac_13447-sanitise_ring_refcount.patch
trac12215_weak_cached_function-sk.patch
trac12215_segfault_fixes.patch
trac_12313-mono_dict-combined-random-sk.patch
trac_12313_quit_sage.patch
trac13370_deprecate_is_field.patch
trac_13378-convert_map_shortcut.patch
trac_13412_category_for_power_series_rings.patch
trac_12876_category_abstract_classes_for_hom.patch
trac_12876_r_test.patch
```
applied on top of sage-5.4.beta0.



---

archive/issue_comments_145400.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nHooray, all tests pass :)",
    "created_at": "2012-09-18T10:14:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145400",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:98" align="right">comment:98</div>

Hooray, all tests pass :)



---

archive/issue_comments_145401.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nNice!\n\nAnything left to be done to complete the review?",
    "created_at": "2012-09-18T10:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145401",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:99" align="right">comment:99</div>

Nice!

Anything left to be done to complete the review?



---

archive/issue_comments_145402.json:
```json
{
    "body": "Changed work issues from **Understand why the crash in infinite_polynomial_ring is not fixed and what happens with r** to none",
    "created_at": "2012-09-18T11:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145402",
    "user": "https://github.com/simon-king-jena"
}
```

Changed work issues from **Understand why the crash in infinite_polynomial_ring is not fixed and what happens with r** to none



---

archive/issue_events_176079.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-09-18T11:46:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176079"
}
```



---

archive/issue_events_176080.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-09-18T11:46:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176080"
}
```



---

archive/issue_comments_145403.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nThe work issue was \"understand the crash of r\". I think it *is* now understood, because it could be solved by using `os.realpath` in some test, where apparently a relative path was stored.\n\nAll segfaults that I have seen are gone because of #13447. But it would be nice if Volker's patchbot could try it again, because it seems to have a tendency to break in a different way than my machines.\n\nI have read the patch carefully in the past, and all tests pass, with the patches stated in [comment:97](#comment%3A97).\n\nHence: Positive review, I'd say.",
    "created_at": "2012-09-18T11:46:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145403",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:100" align="right">comment:100</div>

The work issue was "understand the crash of r". I think it *is* now understood, because it could be solved by using `os.realpath` in some test, where apparently a relative path was stored.

All segfaults that I have seen are gone because of #13447. But it would be nice if Volker's patchbot could try it again, because it seems to have a tendency to break in a different way than my machines.

I have read the patch carefully in the past, and all tests pass, with the patches stated in [comment:97](#comment%3A97).

Hence: Positive review, I'd say.



---

archive/issue_comments_145404.json:
```json
{
    "body": "Changed dependencies from **#11521, #12215, #12313, #13412. #13145** to **#715, #11521, #12215, #12313, #13412. #13145**",
    "created_at": "2012-09-19T06:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145404",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#11521, #12215, #12313, #13412. #13145** to **#715, #11521, #12215, #12313, #13412. #13145**



---

archive/issue_events_176081.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-19T06:33:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176081"
}
```



---

archive/issue_events_176082.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-19T06:33:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176082"
}
```



---

archive/issue_comments_145405.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12215, #12313, #13412. #13145** to **#13447, #715, #11521, #12215, #12313, #13412. #13145**",
    "created_at": "2012-09-19T06:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145405",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#715, #11521, #12215, #12313, #13412. #13145** to **#13447, #715, #11521, #12215, #12313, #13412. #13145**



---

archive/issue_events_176083.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-05-11T03:30:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176083"
}
```



---

archive/issue_events_176084.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-05-11T03:30:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176084"
}
```



---

archive/issue_comments_145406.json:
```json
{
    "body": "Changed dependencies from **#13447, #715, #11521, #12215, #12313, #13412. #13145** to **#715, #11521, #12215, #12313, #13412. #13145**",
    "created_at": "2013-05-11T03:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145406",
    "user": "https://github.com/nthiery"
}
```

Changed dependencies from **#13447, #715, #11521, #12215, #12313, #13412. #13145** to **#715, #11521, #12215, #12313, #13412. #13145**



---

archive/issue_comments_145407.json:
```json
{
    "body": "Work Issues: **needs rebase**",
    "created_at": "2013-05-11T03:30:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145407",
    "user": "https://github.com/nthiery"
}
```

Work Issues: **needs rebase**



---

archive/issue_comments_145408.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nAs per the discussion on #13347, I have removed this dependency.\n\nThe patch needs to be rebased upon #14159 and #13184 that have been merged in 5.10beta0. I am working on it.",
    "created_at": "2013-05-11T03:32:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145408",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:104" align="right">comment:104</div>

As per the discussion on #13347, I have removed this dependency.

The patch needs to be rebased upon #14159 and #13184 that have been merged in 5.10beta0. I am working on it.



---

archive/issue_comments_145409.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nI just uploaded a rebased patch. This patch sounds almost good to go.\n\nStill, there are a couple failing tests which all boil to the following little design issue:\n\nTake as typical situation A to be Rings().parent_class, and B to be some NumberField parent class. Assume that P is an instance of A resp. B and that:\n\n- A implements `_Hom_` so that P._Hom_(codomain) is a RingHomset if codomain is a ring\n- B implements `_Hom_` so that P._Hom_(codomain) is a NumberFieldHomset if codomain is a NumberField\n\nLet P be an instance of B and codomain a ring. With the current logic Hom(P, codomain) will\ntry the later, which will fail, but won't proceed to try the former. So the result will be a plain Homset, and not a RingHomset as desired.\n\nFor some reasons this situation did not appear a year ago. Presumably some tests were added in the mean time. Or we did not run the tests with --long ...\n\nWhat's the best way out?\n\n- Option 1: Walk the mro of the class of P, and call cls._Hom_(P, codomain) in turn until something does not fail\n\n- Option 2: change the protocol so that the `_Hom_` method should call super instead of failing if they cannot handle the situation\n\n- Option 3: ???\n\nCheers,\n                                          Nicolas",
    "created_at": "2013-05-11T04:20:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145409",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:105" align="right">comment:105</div>

I just uploaded a rebased patch. This patch sounds almost good to go.

Still, there are a couple failing tests which all boil to the following little design issue:

Take as typical situation A to be Rings().parent_class, and B to be some NumberField parent class. Assume that P is an instance of A resp. B and that:

- A implements `_Hom_` so that P._Hom_(codomain) is a RingHomset if codomain is a ring
- B implements `_Hom_` so that P._Hom_(codomain) is a NumberFieldHomset if codomain is a NumberField

Let P be an instance of B and codomain a ring. With the current logic Hom(P, codomain) will
try the later, which will fail, but won't proceed to try the former. So the result will be a plain Homset, and not a RingHomset as desired.

For some reasons this situation did not appear a year ago. Presumably some tests were added in the mean time. Or we did not run the tests with --long ...

What's the best way out?

- Option 1: Walk the mro of the class of P, and call cls._Hom_(P, codomain) in turn until something does not fail

- Option 2: change the protocol so that the `_Hom_` method should call super instead of failing if they cannot handle the situation

- Option 3: ???

Cheers,
                                          Nicolas



---

archive/issue_comments_145410.json:
```json
{
    "body": "Changed work issues from **needs rebase** to **failing tests; design issue**",
    "created_at": "2013-05-11T04:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145410",
    "user": "https://github.com/nthiery"
}
```

Changed work issues from **needs rebase** to **failing tests; design issue**



---

archive/issue_comments_145411.json:
```json
{
    "body": "Changed work issues from **failing tests; design issue** to none",
    "created_at": "2013-05-11T14:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145411",
    "user": "https://github.com/nthiery"
}
```

Changed work issues from **failing tests; design issue** to none



---

archive/issue_comments_145412.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">comment:107</div>\n\nTwo failures were actually trivial:\n\n- A trivial doctest in\n  devel/sage/doc/en/thematic_tutorials/coercion_and_categories.rst\n- More skips were needed in the new TestSuite(H) in line 114 of sage.categories.hecke_modules\n  (some new test methods that require the currently missing an_element were added since last year)\n\nI implemented a simplistic protocol for the above issue. If P._Hom_ fails, then try category.parent_class._Hom_. This is sufficient for the other failing test in Parent.\n\nOther than this, the attached patch is a straightforward rebase of the previous one. So to finalize the review it would suffice to:\n\n- glance at the above change\n- recheck sage.categories.homset.Hom\n\nI am currently running the long tests, but I expect everything to pass.\n\nAlmost done!",
    "created_at": "2013-05-11T14:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145412",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:107" align="right">comment:107</div>

Two failures were actually trivial:

- A trivial doctest in
  devel/sage/doc/en/thematic_tutorials/coercion_and_categories.rst
- More skips were needed in the new TestSuite(H) in line 114 of sage.categories.hecke_modules
  (some new test methods that require the currently missing an_element were added since last year)

I implemented a simplistic protocol for the above issue. If P._Hom_ fails, then try category.parent_class._Hom_. This is sufficient for the other failing test in Parent.

Other than this, the attached patch is a straightforward rebase of the previous one. So to finalize the review it would suffice to:

- glance at the above change
- recheck sage.categories.homset.Hom

I am currently running the long tests, but I expect everything to pass.

Almost done!



---

archive/issue_events_176085.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-05-11T14:17:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176085"
}
```



---

archive/issue_events_176086.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-05-11T14:17:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176086"
}
```



---

archive/issue_comments_145413.json:
```json
{
    "body": "<div id=\"comment:108\" align=\"right\">comment:108</div>\n\nmake ptestlong passed smoothly on my machine!",
    "created_at": "2013-05-11T14:38:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145413",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:108" align="right">comment:108</div>

make ptestlong passed smoothly on my machine!



---

archive/issue_comments_145414.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nAre there dependencies missing? With sage-5.9.rc0, which should contain all the dependencies listed, I get\n\n```\n> hg qimport -P https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz\nF\u00fcge trac_12876_category_abstract_classes_for_hom.patch zur Seriendatei hinzu\nWende trac_12876_category_abstract_classes_for_hom.patch an\nWende Patch auf Datei doc/en/thematic_tutorials/coercion_and_categories.rst an\nFEHLSCHLAG von Teilst\u00fcck #1 in Zeile 407\n1 von 1 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei doc/en/thematic_tutorials/coercion_and_categories.rst.rej\nWende Patch auf Datei sage/categories/homset.py an\nTeilst\u00fcck #1 wurde erfolgreich in Zeile 69 mit Unsch\u00e4rfe 2 angewandt (0 Zeilen verschoben).\nFEHLSCHLAG von Teilst\u00fcck #4 in Zeile 181\nFEHLSCHLAG von Teilst\u00fcck #7 in Zeile 273\n2 von 12 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/categories/homset.py.rej\nWende Patch auf Datei sage/modules/vector_space_homspace.py an\nFEHLSCHLAG von Teilst\u00fcck #1 in Zeile 327\n1 von 1 Teilst\u00fccken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/modules/vector_space_homspace.py.rej\nPatch schlug fehl und Fortsetzung unm\u00f6glich (versuche -v)\nPatch schlug fehl, Fehlerabschnitte noch im Arbeitsverzeichnis\nFehler beim Anwenden. Bitte beheben und trac_12876_category_abstract_classes_for_hom.patch aktualisieren\n```\n\nHence, several failures in applying the first patch.\n\nIt seems that the patchbot applies the patches in the wrong order anyway (and also gets a failure).\n\nTo let the patchbot get it right:\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch",
    "created_at": "2013-05-23T17:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145414",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:109" align="right">comment:109</div>

Are there dependencies missing? With sage-5.9.rc0, which should contain all the dependencies listed, I get

```
> hg qimport -P https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz
F√ºge trac_12876_category_abstract_classes_for_hom.patch zur Seriendatei hinzu
Wende trac_12876_category_abstract_classes_for_hom.patch an
Wende Patch auf Datei doc/en/thematic_tutorials/coercion_and_categories.rst an
FEHLSCHLAG von Teilst√ºck #1 in Zeile 407
1 von 1 Teilst√ºcken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei doc/en/thematic_tutorials/coercion_and_categories.rst.rej
Wende Patch auf Datei sage/categories/homset.py an
Teilst√ºck #1 wurde erfolgreich in Zeile 69 mit Unsch√§rfe 2 angewandt (0 Zeilen verschoben).
FEHLSCHLAG von Teilst√ºck #4 in Zeile 181
FEHLSCHLAG von Teilst√ºck #7 in Zeile 273
2 von 12 Teilst√ºcken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/categories/homset.py.rej
Wende Patch auf Datei sage/modules/vector_space_homspace.py an
FEHLSCHLAG von Teilst√ºck #1 in Zeile 327
1 von 1 Teilst√ºcken sind FEHLGESCHLAGEN -- speichere Ausschuss in Datei sage/modules/vector_space_homspace.py.rej
Patch schlug fehl und Fortsetzung unm√∂glich (versuche -v)
Patch schlug fehl, Fehlerabschnitte noch im Arbeitsverzeichnis
Fehler beim Anwenden. Bitte beheben und trac_12876_category_abstract_classes_for_hom.patch aktualisieren
```

Hence, several failures in applying the first patch.

It seems that the patchbot applies the patches in the wrong order anyway (and also gets a failure).

To let the patchbot get it right:

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.patch



---

archive/issue_comments_145415.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nYes; I rebased the patch upon #14159 and #13184 which have been merged in 5.10 beta0. I just added them to the dependency list for the record.",
    "created_at": "2013-05-23T18:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145415",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:110" align="right">comment:110</div>

Yes; I rebased the patch upon #14159 and #13184 which have been merged in 5.10 beta0. I just added them to the dependency list for the record.



---

archive/issue_comments_145416.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12215, #12313, #13412. #13145** to **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184**",
    "created_at": "2013-05-23T18:28:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145416",
    "user": "https://github.com/nthiery"
}
```

Changed dependencies from **#715, #11521, #12215, #12313, #13412. #13145** to **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184**



---

archive/issue_comments_145417.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\n#14287 is also needed. With this, the patch applies.",
    "created_at": "2013-05-23T19:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145417",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:111" align="right">comment:111</div>

#14287 is also needed. With this, the patch applies.



---

archive/issue_comments_145418.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184** to **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184, #14287**",
    "created_at": "2013-05-23T19:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145418",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184** to **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184, #14287**



---

archive/issue_comments_145419.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nHowever, there seems to be yet another dependency for the second patch.",
    "created_at": "2013-05-23T19:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145419",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:112" align="right">comment:112</div>

However, there seems to be yet another dependency for the second patch.



---

archive/issue_comments_145420.json:
```json
{
    "body": "<div id=\"comment:113\" align=\"right\">comment:113</div>\n\nIt fails to apply, because in r.py it reads\n\n```\n           sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)\n```\nbut the second patch from here assumes that there is no pointer to #9970.",
    "created_at": "2013-05-23T20:02:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145420",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:113" align="right">comment:113</div>

It fails to apply, because in r.py it reads

```
           sage: os.path.realpath(tmpdir) == sageobj(r.getwd())  # known bug (:trac:`9970`)
```
but the second patch from here assumes that there is no pointer to #9970.



---

archive/issue_comments_145421.json:
```json
{
    "body": "<div id=\"comment:114\" align=\"right\">comment:114</div>\n\nThe pointer got introduced in #12415, as it seems.",
    "created_at": "2013-05-23T20:03:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145421",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:114" align="right">comment:114</div>

The pointer got introduced in #12415, as it seems.



---

archive/issue_comments_145422.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\nAfter applying the failing hunk manually, I am now running make ptestlong.",
    "created_at": "2013-05-23T20:13:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145422",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:115" align="right">comment:115</div>

After applying the failing hunk manually, I am now running make ptestlong.



---

archive/issue_comments_145423.json:
```json
{
    "body": "<div id=\"comment:116\" align=\"right\">comment:116</div>\n\nI don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](https://github.com/sagemath/sage/issues/9970#comment:20) by Simon for background.",
    "created_at": "2013-05-23T20:26:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145423",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:116" align="right">comment:116</div>

I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](https://github.com/sagemath/sage/issues/9970#comment:20) by Simon for background.



---

archive/issue_comments_145424.json:
```json
{
    "body": "<div id=\"comment:117\" align=\"right\">comment:117</div>\n\nReplying to [@kcrisman](#comment%3A116):\n> I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](https://github.com/sagemath/sage/issues/9970#comment:20) by Simon for background.\n\nIn any case, the second patch needs to be rebased against #12415, right?",
    "created_at": "2013-05-23T20:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145424",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:117" align="right">comment:117</div>

Replying to [@kcrisman](#comment%3A116):
> I don't think that the reference to #9970 should be removed.  It's okay to put in a different test for now if that helps things, but it doesn't remove the underlying problem in our parsing that wjp has a tentative patch for there, so we shouldn't just completely not mention it.  See [this comment](https://github.com/sagemath/sage/issues/9970#comment:20) by Simon for background.

In any case, the second patch needs to be rebased against #12415, right?



---

archive/issue_comments_145425.json:
```json
{
    "body": "<div id=\"comment:118\" align=\"right\">comment:118</div>\n\nSimon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!",
    "created_at": "2013-05-23T21:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145425",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:118" align="right">comment:118</div>

Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!



---

archive/issue_comments_145426.json:
```json
{
    "body": "<div id=\"comment:119\" align=\"right\">comment:119</div>\n\nReplying to [@nthiery](#comment%3A118):\n> Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!\n\nReally?\n\nOK, then let's try:\n\nApply trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2013-05-23T21:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145426",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:119" align="right">comment:119</div>

Replying to [@nthiery](#comment%3A118):
> Simon: are you sure we need trac_12876_r_test.patch? It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!

Really?

OK, then let's try:

Apply trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_145427.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,4 +30,3 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n-* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)\n``````\n",
    "created_at": "2013-05-23T21:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145427",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,4 +30,3 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
-* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)
``````




---

archive/issue_comments_145428.json:
```json
{
    "body": "<div id=\"comment:120\" align=\"right\">comment:120</div>\n\n> It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!\n\nThis is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.",
    "created_at": "2013-05-24T01:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145428",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:120" align="right">comment:120</div>

> It's a patch that you had added and actually I forgot to insert it in the sage-combinat queue; and all tests are passing smoothly for me without it!

This is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.



---

archive/issue_comments_145429.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nReplying to [@kcrisman](#comment%3A120):\n> This is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.\n\nI am fine with that. I just still need to understand at some point how this is related to this ticket :-)",
    "created_at": "2013-05-24T02:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145429",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:121" align="right">comment:121</div>

Replying to [@kcrisman](#comment%3A120):
> This is a pretty unstable situation - it doesn't appear all the time and not on all platforms.  I think that the idea of replacing this with a test that works for now is fine - see Simon's suggestion at #9970.

I am fine with that. I just still need to understand at some point how this is related to this ticket :-)



---

archive/issue_comments_145430.json:
```json
{
    "body": "<div id=\"comment:122\" align=\"right\">comment:122</div>\n\nAttachment: **[trac_12876-schemes_homcategory.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)**\n\nWith the attached extra patch, all test still pass and there is no more crappy `__new__` in Schemes.HomCategory.ParentMethods.",
    "created_at": "2013-05-24T02:26:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145430",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:122" align="right">comment:122</div>

Attachment: **[trac_12876-schemes_homcategory.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)**

With the attached extra patch, all test still pass and there is no more crappy `__new__` in Schemes.HomCategory.ParentMethods.



---

archive/issue_comments_145431.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,3 +30,5 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n+* [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)\n+\n``````\n",
    "created_at": "2013-05-24T02:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145431",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,3 +30,5 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
+* [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)
+
``````




---

archive/issue_comments_145432.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">comment:124</div>\n\nPatchbot times out at sage/interfaces/ecm.py. However, with the first two patches, make ptestlong passes.\n\nMy plan is to modify the second patch, so that reference to #9970 is preserved, and to repeat make ptestlong with the third patch.",
    "created_at": "2013-05-24T04:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145432",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:124" align="right">comment:124</div>

Patchbot times out at sage/interfaces/ecm.py. However, with the first two patches, make ptestlong passes.

My plan is to modify the second patch, so that reference to #9970 is preserved, and to repeat make ptestlong with the third patch.



---

archive/issue_comments_145433.json:
```json
{
    "body": "<div id=\"comment:125\" align=\"right\">comment:125</div>\n\nWhat other dependency is there for the third patch?",
    "created_at": "2013-05-24T05:17:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145433",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:125" align="right">comment:125</div>

What other dependency is there for the third patch?



---

archive/issue_comments_145434.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">comment:126</div>\n\nI have\n\n```\n> hg qa\ntrac_14159_weak_value_triple_dict.patch\ntrac_14159_use_cdef_get.patch\ntrac_13184_sage_5.9.beta.patch\ntrac_14287-rebased.patch\ntrac_12876_category_abstract_classes_for_hom.patch\ntrac_12876_r_test.patch\n```\non top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are\n\n```\n            \"\"\"\n            return []\n\n        class ParentMethods:\n\n            def __new__(cls, R, S, category):\n                \"\"\"\n                TESTS::\n\n                    sage: E = EllipticCurve('37a1')\n                    sage: Hom(E, E).__class__\n                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>\n\n                If both schemes R and S are actually specs, we want\n                the parent for Hom(R, S) to be in a different class::\n\n                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__\n                    <class 'sage.schemes.generic.homset.SchemeHomset_points_spec_with_category'>\n\n                Currently, and to minimize the changes, this is done\n                by delegating the job to SchemeHomset. This is not\n                very robust: for example, only one category can do\n                this hack.\n\n                FIXME: this might be better handled by an extra Spec category\n                \"\"\"\n                from sage.schemes.generic.homset import SchemeHomset\n                return SchemeHomset(R, S, category=category)\n\n\n#############################################################\n```\n\nHowever, the patch expects\n\n```\n             \"\"\"\n             return []\n \n-        class ParentMethods:\n-\n-            def __new__(cls, R, S, category):\n-                \"\"\"\n-                TESTS::\n-\n-                    sage: E = EllipticCurve('37a1')\n-                    sage: Hom(E, E).__class__\n-                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>\n-\n-                If both schemes R and S are actually specs, we want\n-                the parent for Hom(R, S) to be in a different class::\n-\n-                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__\n-                    <class 'sage.schemes.affine.affine_homset.SchemeHomset_points_spec_with_category'>\n-\n-                Currently, and to minimize the changes, this is done\n-                by delegating the job to SchemeHomset. This is not\n-                very robust: for example, only one category can do\n-                this hack.\n-\n-                FIXME: this might be better handled by an extra Spec category\n-                \"\"\"\n-                from sage.schemes.generic.homset import SchemeHomset\n-                return SchemeHomset(R, S, category=category)\n \n \n #############################################################\n```\n\nSo, what tickect changed `sage.schemes.generic.homset.SchemeHomset_points_spec` into `sage.schemes.affine.affine_homset.SchemeHomset_points_spec`?",
    "created_at": "2013-05-24T05:22:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145434",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:126" align="right">comment:126</div>

I have

```
> hg qa
trac_14159_weak_value_triple_dict.patch
trac_14159_use_cdef_get.patch
trac_13184_sage_5.9.beta.patch
trac_14287-rebased.patch
trac_12876_category_abstract_classes_for_hom.patch
trac_12876_r_test.patch
```
on top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are

```
            """
            return []

        class ParentMethods:

            def __new__(cls, R, S, category):
                """
                TESTS::

                    sage: E = EllipticCurve('37a1')
                    sage: Hom(E, E).__class__
                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>

                If both schemes R and S are actually specs, we want
                the parent for Hom(R, S) to be in a different class::

                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__
                    <class 'sage.schemes.generic.homset.SchemeHomset_points_spec_with_category'>

                Currently, and to minimize the changes, this is done
                by delegating the job to SchemeHomset. This is not
                very robust: for example, only one category can do
                this hack.

                FIXME: this might be better handled by an extra Spec category
                """
                from sage.schemes.generic.homset import SchemeHomset
                return SchemeHomset(R, S, category=category)


#############################################################
```

However, the patch expects

```
             """
             return []
 
-        class ParentMethods:
-
-            def __new__(cls, R, S, category):
-                """
-                TESTS::
-
-                    sage: E = EllipticCurve('37a1')
-                    sage: Hom(E, E).__class__
-                    <class 'sage.schemes.generic.homset.SchemeHomset_generic_with_category'>
-
-                If both schemes R and S are actually specs, we want
-                the parent for Hom(R, S) to be in a different class::
-
-                    sage: Hom(Spec(ZZ), Spec(ZZ)).__class__
-                    <class 'sage.schemes.affine.affine_homset.SchemeHomset_points_spec_with_category'>
-
-                Currently, and to minimize the changes, this is done
-                by delegating the job to SchemeHomset. This is not
-                very robust: for example, only one category can do
-                this hack.
-
-                FIXME: this might be better handled by an extra Spec category
-                """
-                from sage.schemes.generic.homset import SchemeHomset
-                return SchemeHomset(R, S, category=category)
 
 
 #############################################################
```

So, what tickect changed `sage.schemes.generic.homset.SchemeHomset_points_spec` into `sage.schemes.affine.affine_homset.SchemeHomset_points_spec`?



---

archive/issue_comments_145435.json:
```json
{
    "body": "Changed dependencies from **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184, #14287** to **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184, #14287, #14217**",
    "created_at": "2013-05-24T05:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145435",
    "user": "https://github.com/simon-king-jena"
}
```

Changed dependencies from **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184, #14287** to **#715, #11521, #12215, #12313, #13412, #13145, #14159, #13184, #14287, #14217**



---

archive/issue_comments_145436.json:
```json
{
    "body": "<div id=\"comment:127\" align=\"right\">comment:127</div>\n\nIt is #14217.",
    "created_at": "2013-05-24T05:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145436",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:127" align="right">comment:127</div>

It is #14217.



---

archive/issue_comments_145437.json:
```json
{
    "body": "Attachment: **[trac_12876_r_test.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)**\n\nTry to make one test in interfaces/r.py more stable wrt symbolic links",
    "created_at": "2013-05-24T05:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145437",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac_12876_r_test.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)**

Try to make one test in interfaces/r.py more stable wrt symbolic links



---

archive/issue_comments_145438.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,5 +30,6 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n+* [attachment: trac_12876_r_test.py](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.py.gz)\n * [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)\n \n``````\n",
    "created_at": "2013-05-24T05:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145438",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,5 +30,6 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
+* [attachment: trac_12876_r_test.py](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.py.gz)
 * [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)
 
``````




---

archive/issue_comments_145439.json:
```json
{
    "body": "<div id=\"comment:128\" align=\"right\">comment:128</div>\n\nPatchbot:\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.py trac_12876-schemes_homcategory.patch",
    "created_at": "2013-05-24T05:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145439",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:128" align="right">comment:128</div>

Patchbot:
Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876_r_test.py trac_12876-schemes_homcategory.patch



---

archive/issue_comments_145440.json:
```json
{
    "body": "<div id=\"comment:129\" align=\"right\">comment:129</div>\n\nI really don't like [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz). Are we sure the test actually works now (you removed `# known bug`)?",
    "created_at": "2013-05-24T06:34:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145440",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:129" align="right">comment:129</div>

I really don't like [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz). Are we sure the test actually works now (you removed `# known bug`)?



---

archive/issue_comments_145441.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,6 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n-* [attachment: trac_12876_r_test.py](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.py.gz)\n+* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)\n * [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)\n \n``````\n",
    "created_at": "2013-05-24T06:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145441",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,6 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
-* [attachment: trac_12876_r_test.py](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.py.gz)
+* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)
 * [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)
 
``````




---

archive/issue_comments_145442.json:
```json
{
    "body": "<div id=\"comment:131\" align=\"right\">comment:131</div>\n\nGiven that the other patches don't change **anything** in the R interface, it is almost impossible that this ticket could have any influence on the R test. Or at least, it requires a good explanation if something did change.\n\nProposal: do not apply [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)",
    "created_at": "2013-05-24T06:42:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145442",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:131" align="right">comment:131</div>

Given that the other patches don't change **anything** in the R interface, it is almost impossible that this ticket could have any influence on the R test. Or at least, it requires a good explanation if something did change.

Proposal: do not apply [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)



---

archive/issue_events_176087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T06:42:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176087"
}
```



---

archive/issue_events_176088.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T06:42:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176088"
}
```



---

archive/issue_comments_145443.json:
```json
{
    "body": "<div id=\"comment:133\" align=\"right\">comment:133</div>\n\nI'm fine with not applying the r-test patch. An info that I need: Does that tag `# known bug` mean that the patchbot will not complain about it?",
    "created_at": "2013-05-24T06:54:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145443",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:133" align="right">comment:133</div>

I'm fine with not applying the r-test patch. An info that I need: Does that tag `# known bug` mean that the patchbot will not complain about it?



---

archive/issue_comments_145444.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,6 +30,5 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n-* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)\n * [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)\n \n``````\n",
    "created_at": "2013-05-24T06:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145444",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,6 +30,5 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
-* [attachment: trac_12876_r_test.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_r_test.patch.gz)
 * [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)
 
``````




---

archive/issue_events_176089.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-24T06:56:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176089"
}
```



---

archive/issue_events_176090.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-24T06:56:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176090"
}
```



---

archive/issue_comments_145445.json:
```json
{
    "body": "<div id=\"comment:134\" align=\"right\">comment:134</div>\n\nPatchbot:\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876-schemes_homcategory.patch",
    "created_at": "2013-05-24T06:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145445",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:134" align="right">comment:134</div>

Patchbot:

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876-schemes_homcategory.patch



---

archive/issue_comments_145446.json:
```json
{
    "body": "<div id=\"comment:135\" align=\"right\">comment:135</div>\n\nReplying to [@simon-king-jena](#comment%3A133):\n> Does that tag `# known bug` mean that the patchbot will not complain about it?\n\nYes, see [http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples](http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples)",
    "created_at": "2013-05-24T06:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145446",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:135" align="right">comment:135</div>

Replying to [@simon-king-jena](#comment%3A133):
> Does that tag `# known bug` mean that the patchbot will not complain about it?

Yes, see [http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples](http://sagemath.org/doc/developer/conventions.html#further-conventions-for-automated-testing-of-examples)



---

archive/issue_events_176091.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T06:59:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176091"
}
```



---

archive/issue_events_176092.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-24T06:59:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176092"
}
```



---

archive/issue_comments_145447.json:
```json
{
    "body": "<div id=\"comment:137\" align=\"right\">comment:137</div>\n\nHi Simon!\n\n> on top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are\n\nTime for an upgrade maybe? :-)",
    "created_at": "2013-05-24T10:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145447",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:137" align="right">comment:137</div>

Hi Simon!

> on top of sage-5.9.rc0, and the relevant lines in sage/categories/schemes.py are

Time for an upgrade maybe? :-)



---

archive/issue_comments_145448.json:
```json
{
    "body": "<div id=\"comment:138\" align=\"right\">comment:138</div>\n\nPatchbot is green :-)",
    "created_at": "2013-05-24T10:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145448",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:138" align="right">comment:138</div>

Patchbot is green :-)



---

archive/issue_comments_145449.json:
```json
{
    "body": "<div id=\"comment:139\" align=\"right\">comment:139</div>\n\nReplying to [@nthiery](#comment%3A138):\n> Patchbot is green :-)\n\nYes, I know. I need some more time to finish yet another job application.",
    "created_at": "2013-05-24T10:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145449",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:139" align="right">comment:139</div>

Replying to [@nthiery](#comment%3A138):
> Patchbot is green :-)

Yes, I know. I need some more time to finish yet another job application.



---

archive/issue_comments_145450.json:
```json
{
    "body": "<div id=\"comment:140\" align=\"right\">comment:140</div>\n\nReplying to [@simon-king-jena](#comment%3A139):\n> Yes, I know. I need some more time to finish yet another job application.\n\nI did not mean to pressure; I was just happy :-)\n\nOf course job applications have priority! Good luck!",
    "created_at": "2013-05-24T11:05:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145450",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:140" align="right">comment:140</div>

Replying to [@simon-king-jena](#comment%3A139):
> Yes, I know. I need some more time to finish yet another job application.

I did not mean to pressure; I was just happy :-)

Of course job applications have priority! Good luck!



---

archive/issue_comments_145451.json:
```json
{
    "body": "<div id=\"comment:141\" align=\"right\">comment:141</div>\n\nFrom the commit message:\n- If category is None, Hom simply calls itself with the meet of the\n  categories of the parent, which removes a cache handling duplication.\n\nI don't know if that's a good idea. Duplicating the cache costs virtually nothing (because all objects, categories and homsets involved are there anyway), but it speeds up the most commonly used case, namely category=None. Computing the meet of the underlying categories is expensive, even though it is cached.",
    "created_at": "2013-05-24T11:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145451",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:141" align="right">comment:141</div>

From the commit message:
- If category is None, Hom simply calls itself with the meet of the
  categories of the parent, which removes a cache handling duplication.

I don't know if that's a good idea. Duplicating the cache costs virtually nothing (because all objects, categories and homsets involved are there anyway), but it speeds up the most commonly used case, namely category=None. Computing the meet of the underlying categories is expensive, even though it is cached.



---

archive/issue_comments_145452.json:
```json
{
    "body": "<div id=\"comment:142\" align=\"right\">comment:142</div>\n\nQuestion: Is it really needed that each category defines its own `HomCategory`, which in most cases is just\n\n```\n    class HomCategory(HomCategory):\n        pass\n```\n?\n\nSince all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?\n\nThis could be for a different ticket, though. I just wonder.",
    "created_at": "2013-05-24T12:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145452",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:142" align="right">comment:142</div>

Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just

```
    class HomCategory(HomCategory):
        pass
```
?

Since all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?

This could be for a different ticket, though. I just wonder.



---

archive/issue_comments_145453.json:
```json
{
    "body": "<div id=\"comment:143\" align=\"right\">comment:143</div>\n\nBTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.",
    "created_at": "2013-05-24T12:17:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145453",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:143" align="right">comment:143</div>

BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.



---

archive/issue_events_176093.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-24T12:22:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176093"
}
```



---

archive/issue_events_176094.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-24T12:22:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176094"
}
```



---

archive/issue_comments_145454.json:
```json
{
    "body": "<div id=\"comment:144\" align=\"right\">comment:144</div>\n\nTests passed. I went through both patches, and they look mostly good, except for the minor criticism in [comment:141](#comment%3A141) and [comment:142](#comment%3A142). It is almost a positive review, but perhaps you have a comment on these two points.",
    "created_at": "2013-05-24T12:22:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145454",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:144" align="right">comment:144</div>

Tests passed. I went through both patches, and they look mostly good, except for the minor criticism in [comment:141](#comment%3A141) and [comment:142](#comment%3A142). It is almost a positive review, but perhaps you have a comment on these two points.



---

archive/issue_comments_145455.json:
```json
{
    "body": "<div id=\"comment:145\" align=\"right\">comment:145</div>\n\nReplying to [@simon-king-jena](#comment%3A141):\n> From the commit message:\n> - If category is None, Hom simply calls itself with the meet of the\n>   categories of the parent, which removes a cache handling duplication.\n> \n> I don't know if that's a good idea. Duplicating the cache costs\n> virtually nothing (because all objects, categories and homsets\n> involved are there anyway), but it speeds up the most commonly used\n> case, namely category=None. Computing the meet of the underlying\n> categories is expensive, even though it is cached.\n\nOh you are right. I meant to avoid a duplication in the source code, not in the caching itself. I agree with you, the current code is wrong. I am going to fix this right now.\n\nThanks for catching this!",
    "created_at": "2013-05-24T13:32:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145455",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:145" align="right">comment:145</div>

Replying to [@simon-king-jena](#comment%3A141):
> From the commit message:
> - If category is None, Hom simply calls itself with the meet of the
>   categories of the parent, which removes a cache handling duplication.
> 
> I don't know if that's a good idea. Duplicating the cache costs
> virtually nothing (because all objects, categories and homsets
> involved are there anyway), but it speeds up the most commonly used
> case, namely category=None. Computing the meet of the underlying
> categories is expensive, even though it is cached.

Oh you are right. I meant to avoid a duplication in the source code, not in the caching itself. I agree with you, the current code is wrong. I am going to fix this right now.

Thanks for catching this!



---

archive/issue_comments_145456.json:
```json
{
    "body": "<div id=\"comment:146\" align=\"right\">comment:146</div>\n\nAttachment: **[trac_12876-fix-homset-cache-nt.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-fix-homset-cache-nt.patch.gz)**\n\nThe new uploaded patch is the previous one with\n\n* [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)\n* [attachment: trac_12876-fix-homset-cache-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-fix-homset-cache-nt.patch.gz)\n\nfolded in. The latter should fix the caching of Hom(X,Y).\n\nI am currently running all long tests!",
    "created_at": "2013-05-24T13:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145456",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:146" align="right">comment:146</div>

Attachment: **[trac_12876-fix-homset-cache-nt.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-fix-homset-cache-nt.patch.gz)**

The new uploaded patch is the previous one with

* [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)
* [attachment: trac_12876-fix-homset-cache-nt.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-fix-homset-cache-nt.patch.gz)

folded in. The latter should fix the caching of Hom(X,Y).

I am currently running all long tests!



---

archive/issue_events_176095.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-05-24T13:56:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176095"
}
```



---

archive/issue_events_176096.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2013-05-24T13:56:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176096"
}
```



---

archive/issue_comments_145457.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,7 +8,8 @@\n - The cache for Hom is handled at a single point in Hom\n   In particular, homsets created via the `_Hom_` hook are now unique.\n - If category is None, Hom simply calls itself with the meet of the\n-  categories of the parent, which removes a cache handling duplication.\n+  categories of the parent, which removes a cache handling duplication\n+  in the code\n - Parent.Hom calls  Hom directly (removes duplicate `_Hom_` logic).\n - ParentWithBase.Hom was redundant and is gone.\n - Reduce the footprint of the current trick to delegate\n@@ -30,5 +31,4 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n-* [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)\n \n``````\n",
    "created_at": "2013-05-24T13:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145457",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,7 +8,8 @@
 - The cache for Hom is handled at a single point in Hom
   In particular, homsets created via the `_Hom_` hook are now unique.
 - If category is None, Hom simply calls itself with the meet of the
-  categories of the parent, which removes a cache handling duplication.
+  categories of the parent, which removes a cache handling duplication
+  in the code
 - Parent.Hom calls  Hom directly (removes duplicate `_Hom_` logic).
 - ParentWithBase.Hom was redundant and is gone.
 - Reduce the footprint of the current trick to delegate
@@ -30,5 +31,4 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
-* [attachment: trac_12876-schemes_homcategory.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-schemes_homcategory.patch.gz)
 
``````




---

archive/issue_comments_145458.json:
```json
{
    "body": "<div id=\"comment:147\" align=\"right\">comment:147</div>\n\nReplying to [@simon-king-jena](#comment%3A142):\n> Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just\n> \n> ```\n>     class HomCategory(HomCategory):\n>         pass\n> ```\n> ?\n> \n> Since all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?\n\nWell, most categories actually don't define a HomCategory. I did not\nstrip the now trivial HomCategory in Schemes just as to avoid having\nto fix some trivial doctest failures elsewhere (without it, a\nHom(scheme,scheme) was downgraded to the category of homsets of sets).\n\n> This could be for a different ticket, though. I just wonder.\n\nYup. At this point we have very little use cases of HomCategories, and\nI don't have a good view on how often this gadget will be used, and\nthus what the sane default should be. So I would indeed leave things\nuntouched for now until we have more experience.",
    "created_at": "2013-05-24T14:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145458",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:147" align="right">comment:147</div>

Replying to [@simon-king-jena](#comment%3A142):
> Question: Is it really needed that each category defines its own `HomCategory`, which in most cases is just
> 
> ```
>     class HomCategory(HomCategory):
>         pass
> ```
> ?
> 
> Since all classes for categories inherit from `Category`, couldn't one just define the `HomCategory` there, and only replace it when really needed?

Well, most categories actually don't define a HomCategory. I did not
strip the now trivial HomCategory in Schemes just as to avoid having
to fix some trivial doctest failures elsewhere (without it, a
Hom(scheme,scheme) was downgraded to the category of homsets of sets).

> This could be for a different ticket, though. I just wonder.

Yup. At this point we have very little use cases of HomCategories, and
I don't have a good view on how often this gadget will be used, and
thus what the sane default should be. So I would indeed leave things
untouched for now until we have more experience.



---

archive/issue_comments_145459.json:
```json
{
    "body": "<div id=\"comment:148\" align=\"right\">comment:148</div>\n\nYou should also tell the patchbot what to do.\n\nApply trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2013-05-24T14:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145459",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:148" align="right">comment:148</div>

You should also tell the patchbot what to do.

Apply trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_145460.json:
```json
{
    "body": "<div id=\"comment:149\" align=\"right\">comment:149</div>\n\nReplying to [@simon-king-jena](#comment%3A143):\n> BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.\n\nWell, actually you wrote this piece; see [comment:59]!\n\nI am fine with this change. And since you had forgotten that you had\nwritten it in the first place, I consider your self-review of this\npiece as sufficient :-)",
    "created_at": "2013-05-24T14:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145460",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:149" align="right">comment:149</div>

Replying to [@simon-king-jena](#comment%3A143):
> BTW, thank you for fixing the coercion cache of `InfinitePolynomialRing`. Now, as the default cache is weak anyway, the custom cache can certainly be removed now.

Well, actually you wrote this piece; see [comment:59]!

I am fine with this change. And since you had forgotten that you had
written it in the first place, I consider your self-review of this
piece as sufficient :-)



---

archive/issue_comments_145461.json:
```json
{
    "body": "<div id=\"comment:150\" align=\"right\">comment:150</div>\n\nReplying to [@simon-king-jena](#comment%3A148):\n> You should also tell the patchbot what to do.\n> \n> Apply trac_12876_category_abstract_classes_for_hom.patch\n\nAh shoot; I had done this in the description but not here. Thanks. I really don't like that the patch bot is extracting this info from the comments rather than the description. Oh well.",
    "created_at": "2013-05-24T14:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145461",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:150" align="right">comment:150</div>

Replying to [@simon-king-jena](#comment%3A148):
> You should also tell the patchbot what to do.
> 
> Apply trac_12876_category_abstract_classes_for_hom.patch

Ah shoot; I had done this in the description but not here. Thanks. I really don't like that the patch bot is extracting this info from the comments rather than the description. Oh well.



---

archive/issue_comments_145462.json:
```json
{
    "body": "<div id=\"comment:151\" align=\"right\">comment:151</div>\n\nAll test passed:\n\nhttp://sage.math.washington.edu/home/nthiery/trac_12876_category_abstract_classes_for_hom.patch-testlog\n\nWell, almost. I got the following error:\n\n```\nsage -t --long devel/sage/sage/graphs/genus.pyx\n**********************************************************************\nFile \"devel/sage/sage/graphs/genus.pyx\", line 136, in sage.graphs.genus.simple_connected_genus_backtracker.__dealloc__\nFailed example:\n    get_memory_usage(t) <= 0.0\nExpected:\n    True\nGot:\n    False\n```\nbut can't reproduce it; so this sounds more like an unrelated random sporadic unfluke.\n\nLet's see what the patchbot says!",
    "created_at": "2013-05-24T14:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145462",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:151" align="right">comment:151</div>

All test passed:

http://sage.math.washington.edu/home/nthiery/trac_12876_category_abstract_classes_for_hom.patch-testlog

Well, almost. I got the following error:

```
sage -t --long devel/sage/sage/graphs/genus.pyx
**********************************************************************
File "devel/sage/sage/graphs/genus.pyx", line 136, in sage.graphs.genus.simple_connected_genus_backtracker.__dealloc__
Failed example:
    get_memory_usage(t) <= 0.0
Expected:
    True
Got:
    False
```
but can't reproduce it; so this sounds more like an unrelated random sporadic unfluke.

Let's see what the patchbot says!



---

archive/issue_comments_145463.json:
```json
{
    "body": "<div id=\"comment:152\" align=\"right\">comment:152</div>\n\nIt seems to be happy :-)",
    "created_at": "2013-05-24T14:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145463",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:152" align="right">comment:152</div>

It seems to be happy :-)



---

archive/issue_comments_145464.json:
```json
{
    "body": "<div id=\"comment:153\" align=\"right\">comment:153</div>\n\nOK, I am just waiting for my own tests to finish, and will then provide a reviewer patch, adding a test that shows that providing `Category.meet([X.category(),Y.category()])` is equivalent to providing `None`.",
    "created_at": "2013-05-24T14:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145464",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:153" align="right">comment:153</div>

OK, I am just waiting for my own tests to finish, and will then provide a reviewer patch, adding a test that shows that providing `Category.meet([X.category(),Y.category()])` is equivalent to providing `None`.



---

archive/issue_comments_145465.json:
```json
{
    "body": "Attachment: **[trac_12876-review.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-review.patch.gz)**",
    "created_at": "2013-05-24T14:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145465",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[trac_12876-review.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876-review.patch.gz)**



---

archive/issue_comments_145466.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,4 +31,5 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n+* [attachment: trac_12876-review.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-review.patch.gz)\n \n``````\n",
    "created_at": "2013-05-24T14:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145466",
    "user": "https://github.com/simon-king-jena"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,4 +31,5 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
+* [attachment: trac_12876-review.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-review.patch.gz)
 
``````




---

archive/issue_comments_145467.json:
```json
{
    "body": "<div id=\"comment:154\" align=\"right\">comment:154</div>\n\nOr better: Add the patch now and let the bot start over.\n\nApply trac_12876_category_abstract_classes_for_hom.patch trac_12876-review.patch",
    "created_at": "2013-05-24T14:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145467",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:154" align="right">comment:154</div>

Or better: Add the patch now and let the bot start over.

Apply trac_12876_category_abstract_classes_for_hom.patch trac_12876-review.patch



---

archive/issue_comments_145468.json:
```json
{
    "body": "<div id=\"comment:155\" align=\"right\">comment:155</div>\n\nfor the review patch: \"identic\" -> \"identical\"",
    "created_at": "2013-05-24T15:00:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145468",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:155" align="right">comment:155</div>

for the review patch: "identic" -> "identical"



---

archive/issue_comments_145469.json:
```json
{
    "body": "<div id=\"comment:156\" align=\"right\">comment:156</div>\n\nReplying to [@nbruin](#comment%3A155):\n> for the review patch: \"identic\" -> \"identical\"\n\nYup. I am on it.",
    "created_at": "2013-05-24T15:06:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145469",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:156" align="right">comment:156</div>

Replying to [@nbruin](#comment%3A155):
> for the review patch: "identic" -> "identical"

Yup. I am on it.



---

archive/issue_comments_145470.json:
```json
{
    "body": "Attachment: **[trac_12876_category_abstract_classes_for_hom.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)**\n\nCombined patch",
    "created_at": "2013-05-24T15:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145470",
    "user": "https://github.com/nthiery"
}
```

Attachment: **[trac_12876_category_abstract_classes_for_hom.patch.gz](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)**

Combined patch



---

archive/issue_comments_145471.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,5 +31,4 @@\n Apply:\n \n * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)\n-* [attachment: trac_12876-review.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-review.patch.gz)\n \n``````\n",
    "created_at": "2013-05-24T15:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145471",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,5 +31,4 @@
 Apply:
 
 * [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)
-* [attachment: trac_12876-review.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876-review.patch.gz)
 
``````




---

archive/issue_comments_145472.json:
```json
{
    "body": "<div id=\"comment:158\" align=\"right\">comment:158</div>\n\nI folded in you review patch, and fixed identic to identical (also in a paragraph just after).\n\nApply:\n\n* [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)",
    "created_at": "2013-05-24T15:10:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145472",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:158" align="right">comment:158</div>

I folded in you review patch, and fixed identic to identical (also in a paragraph just after).

Apply:

* [attachment: trac_12876_category_abstract_classes_for_hom.patch](https://github.com/sagemath/sage/files/ticket12876/trac_12876_category_abstract_classes_for_hom.patch.gz)



---

archive/issue_events_176097.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-24T15:12:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176097"
}
```



---

archive/issue_events_176098.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2013-05-24T15:12:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176098"
}
```



---

archive/issue_comments_145473.json:
```json
{
    "body": "<div id=\"comment:159\" align=\"right\">comment:159</div>\n\nOK, for me, the tests pass. So, I make it a positive review.",
    "created_at": "2013-05-24T15:12:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145473",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:159" align="right">comment:159</div>

OK, for me, the tests pass. So, I make it a positive review.



---

archive/issue_comments_145474.json:
```json
{
    "body": "<div id=\"comment:160\" align=\"right\">comment:160</div>\n\nPS, I did briefly check the combined patch...\n\nApply trac_12876_category_abstract_classes_for_hom.patch",
    "created_at": "2013-05-24T15:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145474",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:160" align="right">comment:160</div>

PS, I did briefly check the combined patch...

Apply trac_12876_category_abstract_classes_for_hom.patch



---

archive/issue_comments_145475.json:
```json
{
    "body": "<div id=\"comment:161\" align=\"right\">comment:161</div>\n\nYoupi!\n\nThanks Simon!",
    "created_at": "2013-05-24T15:18:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145475",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:161" align="right">comment:161</div>

Youpi!

Thanks Simon!



---

archive/issue_events_176099.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-27T06:24:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176099"
}
```



---

archive/issue_events_176100.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-27T06:24:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176100"
}
```



---

archive/issue_comments_145476.json:
```json
{
    "body": "Merged: **sage-5.11.beta0**",
    "created_at": "2013-06-06T12:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12876#issuecomment-145476",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.11.beta0**



---

archive/issue_events_176101.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-06T12:31:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176101"
}
```



---

archive/issue_events_176102.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-06T12:31:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12876",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12876#event-176102"
}
```
