# Issue 12966: Indefinite factorization for exact matrices

archive/issues_012794.json:
```json
{
    "body": "Almost any square symmetric (or Hermitian) matrix A over a field can be decomposed into a lower triangular matrix L and a diagonal matrix D such that  A = L*D*L-transpose, suitably adjusted in the Hermitian case.\n\n1) This is of interest for its own sake (eg for solving systems).\n\n2) If the field has square roots and the diagonal matrix has positive entries, then the Cholesky decomposition is easy.  This would fix #11274.\n\n3) This will give a good way to tell if a matrix is positive definite.\n\n**Apply**:\n1.  [attachment:trac_12966-indefinite-factorization-v2.patch]\n\n**Assignee:** @jasongrout, @williamstein\n\n**Keywords:** sd40.5\n\n**Reviewer:** Andrey Novoseltsev\n\n**Author:** Rob Beezer\n\n**Merged:** sage-5.1.beta2\n\nIssue created by migration from https://trac.sagemath.org/ticket/12966\n\n",
    "closed_at": "2012-06-02T12:15:53Z",
    "created_at": "2012-05-17T22:15:25Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Indefinite factorization for exact matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12966",
    "user": "https://github.com/rbeezer"
}
```
Almost any square symmetric (or Hermitian) matrix A over a field can be decomposed into a lower triangular matrix L and a diagonal matrix D such that  A = L*D*L-transpose, suitably adjusted in the Hermitian case.

1) This is of interest for its own sake (eg for solving systems).

2) If the field has square roots and the diagonal matrix has positive entries, then the Cholesky decomposition is easy.  This would fix #11274.

3) This will give a good way to tell if a matrix is positive definite.

**Apply**:
1.  [attachment:trac_12966-indefinite-factorization-v2.patch]

**Assignee:** @jasongrout, @williamstein

**Keywords:** sd40.5

**Reviewer:** Andrey Novoseltsev

**Author:** Rob Beezer

**Merged:** sage-5.1.beta2

Issue created by migration from https://trac.sagemath.org/ticket/12966





---

archive/attachments_017492.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12966-indefinite-factorization-draft-1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12966/trac_12966-indefinite-factorization-draft-1.patch",
    "created_at": "2012-05-17T22:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_150990.json:
```json
{
    "body": "<a id='comment:1'></a>\nDraft 1 patch is mostly for safe-keeping.  It \"works\" but needs an option for failure mode - zero diagonals versus negative diagonals.  Underscore method will then be used to address the three items above - (1) on this ticket, (2) on the bug ticket, and (3) somewhere.",
    "created_at": "2012-05-17T22:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150990",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:1'></a>
Draft 1 patch is mostly for safe-keeping.  It "works" but needs an option for failure mode - zero diagonals versus negative diagonals.  Underscore method will then be used to address the three items above - (1) on this ticket, (2) on the bug ticket, and (3) somewhere.



---

archive/issue_comments_150991.json:
```json
{
    "body": "**Author:** Rob Beezer",
    "created_at": "2012-05-25T02:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150991",
    "user": "https://github.com/rbeezer"
}
```

**Author:** Rob Beezer



---

archive/issue_comments_150992.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,3 +5,6 @@\n 2) If the field has square roots and the diagonal matrix has positive entries, then the Cholesky decomposition is easy.  This would fix #11274.\n \n 3) This will give a good way to tell if a matrix is positive definite.\n+\n+**Apply**:\n+1.  [attachment:trac_12966-indefinite-factorization-v1.patch]\n``````\n",
    "created_at": "2012-05-25T02:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150992",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,3 +5,6 @@
 2) If the field has square roots and the diagonal matrix has positive entries, then the Cholesky decomposition is easy.  This would fix #11274.
 
 3) This will give a good way to tell if a matrix is positive definite.
+
+**Apply**:
+1.  [attachment:trac_12966-indefinite-factorization-v1.patch]
``````




---

archive/issue_comments_150993.json:
```json
{
    "body": "<a id='comment:2'></a>\nv1 patch implements general utility function as an underscore method and then uses this for a user-level method.  The utility method will be used to provide an `is_positive_definite` method and a fixed version of Cholesky decomposition.",
    "created_at": "2012-05-25T02:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150993",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:2'></a>
v1 patch implements general utility function as an underscore method and then uses this for a user-level method.  The utility method will be used to provide an `is_positive_definite` method and a fixed version of Cholesky decomposition.



---

archive/issue_events_111093.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-05-25T02:48:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12966#event-111093"
}
```



---

archive/issue_comments_150994.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T05:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150994",
    "user": "https://github.com/rbeezer"
}
```

**Changing keywords** from "" to "sd40.5".



---

archive/issue_comments_150995.json:
```json
{
    "body": "**Reviewer:** Andrey Novoseltsev",
    "created_at": "2012-05-25T15:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150995",
    "user": "https://github.com/novoselt"
}
```

**Reviewer:** Andrey Novoseltsev



---

archive/attachments_017493.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12966-indefinite-factorization-v1.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12966/trac_12966-indefinite-factorization-v1.patch",
    "created_at": "2012-05-25T15:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/novoselt"
}
```



---

archive/issue_comments_150996.json:
```json
{
    "body": "<a id='comment:4'></a>\nLooking over.",
    "created_at": "2012-05-25T15:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150996",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
Looking over.



---

archive/issue_comments_150997.json:
```json
{
    "body": "<a id='comment:5'></a>\nFor the documentation:\n* line 10032: Why the base ring for the diagonal matrix is mentioned explicitly? I think the output for `d` must be such that the appropriate matrix is constructed from `d` directly.\n* lines 10040-10042: Probably need one more space for perfect alignment.\n* line 10292: I don't understand the reference to RDF/CDF - how can they be used if they are not exact?\n\nImplementation-wise, I don't understand why error-handling is delegated to calling functions - checking for square matrices seems natural before the actual computation, detecting absence of the fraction field seems to be repeated and I don't understand at all what is accomplished by\n\n```\nexcept ValueError as e: \n    raise ValueError(e)\n```\ncan't it just be deleted without any effect on the behaviour? It seems to me that the only real work for non-underscore method is to convert `d` to a vector (which probably addressed my first comment on the documentation). It seems to me that either this can be the only thing left in this function with error-checking going to the underscore method or even the conversion can go there and we end up with a single function.",
    "created_at": "2012-05-25T16:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150997",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
For the documentation:
* line 10032: Why the base ring for the diagonal matrix is mentioned explicitly? I think the output for `d` must be such that the appropriate matrix is constructed from `d` directly.
* lines 10040-10042: Probably need one more space for perfect alignment.
* line 10292: I don't understand the reference to RDF/CDF - how can they be used if they are not exact?

Implementation-wise, I don't understand why error-handling is delegated to calling functions - checking for square matrices seems natural before the actual computation, detecting absence of the fraction field seems to be repeated and I don't understand at all what is accomplished by

```
except ValueError as e: 
    raise ValueError(e)
```
can't it just be deleted without any effect on the behaviour? It seems to me that the only real work for non-underscore method is to convert `d` to a vector (which probably addressed my first comment on the documentation). It seems to me that either this can be the only thing left in this function with error-checking going to the underscore method or even the conversion can go there and we end up with a single function.



---

archive/issue_comments_150998.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [novoselt](#comment%3A5):\nAndrey,\n\nThanks for the comments.   The underscore method will also power an \"is_positive_definite\" method and a new (fixed) \"cholesky_decompsition\" method.  I was trying to isolate common functionality in the underscore method.  I was also trying to have errors be actually reported out of the calling functions.\n\nIn particular, indefinite factorization will fail if there is a zero computed for the diagonal.  But this is also an indicator of a non-positive-definite matrix, so I want to catch that error and convert it to a False return.  I'm still uncertain about how Cholesky will be employing this routine.\n\nRob\n\n\n\n> For the documentation:\n> * line 10032: Why the base ring for the diagonal matrix is mentioned explicitly? I think the output for `d` must be such that the appropriate matrix is constructed from `d` directly.\n> * lines 10040-10042: Probably need one more space for perfect alignment.\n> * line 10292: I don't understand the reference to RDF/CDF - how can they be used if they are not exact?\n> \n> Implementation-wise, I don't understand why error-handling is delegated to calling functions - checking for square matrices seems natural before the actual computation, detecting absence of the fraction field seems to be repeated and I don't understand at all what is accomplished by\n> \n> ```\n> except ValueError as e: \n>     raise ValueError(e)\n> ```\n> can't it just be deleted without any effect on the behaviour? It seems to me that the only real work for non-underscore method is to convert `d` to a vector (which probably addressed my first comment on the documentation). It seems to me that either this can be the only thing left in this function with error-checking going to the underscore method or even the conversion can go there and we end up with a single function.\n",
    "created_at": "2012-05-25T17:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150998",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>
Replying to [novoselt](#comment%3A5):
Andrey,

Thanks for the comments.   The underscore method will also power an "is_positive_definite" method and a new (fixed) "cholesky_decompsition" method.  I was trying to isolate common functionality in the underscore method.  I was also trying to have errors be actually reported out of the calling functions.

In particular, indefinite factorization will fail if there is a zero computed for the diagonal.  But this is also an indicator of a non-positive-definite matrix, so I want to catch that error and convert it to a False return.  I'm still uncertain about how Cholesky will be employing this routine.

Rob



> For the documentation:
> * line 10032: Why the base ring for the diagonal matrix is mentioned explicitly? I think the output for `d` must be such that the appropriate matrix is constructed from `d` directly.
> * lines 10040-10042: Probably need one more space for perfect alignment.
> * line 10292: I don't understand the reference to RDF/CDF - how can they be used if they are not exact?
> 
> Implementation-wise, I don't understand why error-handling is delegated to calling functions - checking for square matrices seems natural before the actual computation, detecting absence of the fraction field seems to be repeated and I don't understand at all what is accomplished by
> 
> ```
> except ValueError as e: 
>     raise ValueError(e)
> ```
> can't it just be deleted without any effect on the behaviour? It seems to me that the only real work for non-underscore method is to convert `d` to a vector (which probably addressed my first comment on the documentation). It seems to me that either this can be the only thing left in this function with error-checking going to the underscore method or even the conversion can go there and we end up with a single function.




---

archive/issue_comments_150999.json:
```json
{
    "body": "<a id='comment:7'></a>\nWell, as I understand `is_positive_definite` can call the decomposition and return False if either it fails of there are negative entries. For this patch it seems that the purpose of both methods is exactly the same - if the underscore cannot compute the decomposition for whatever reason, this is the same reason that should be reported by the public method.",
    "created_at": "2012-05-25T17:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-150999",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:7'></a>
Well, as I understand `is_positive_definite` can call the decomposition and return False if either it fails of there are negative entries. For this patch it seems that the purpose of both methods is exactly the same - if the underscore cannot compute the decomposition for whatever reason, this is the same reason that should be reported by the public method.



---

archive/issue_comments_151000.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,4 +7,4 @@\n 3) This will give a good way to tell if a matrix is positive definite.\n \n **Apply**:\n-1.  [attachment:trac_12966-indefinite-factorization-v1.patch]\n+1.  [attachment:trac_12966-indefinite-factorization-v2.patch]\n``````\n",
    "created_at": "2012-05-25T21:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-151000",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,4 +7,4 @@
 3) This will give a good way to tell if a matrix is positive definite.
 
 **Apply**:
-1.  [attachment:trac_12966-indefinite-factorization-v1.patch]
+1.  [attachment:trac_12966-indefinite-factorization-v2.patch]
``````




---

archive/attachments_017494.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12966-indefinite-factorization-v2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12966/trac_12966-indefinite-factorization-v2.patch",
    "created_at": "2012-05-25T21:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_151001.json:
```json
{
    "body": "<a id='comment:8'></a>\nReworked with a cleaner separation.  Error-checking and tests are in the underscore method, making the regular call much shorter an I think the two following routines will work better also.",
    "created_at": "2012-05-25T21:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-151001",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:8'></a>
Reworked with a cleaner separation.  Error-checking and tests are in the underscore method, making the regular call much shorter an I think the two following routines will work better also.



---

archive/issue_comments_151002.json:
```json
{
    "body": "<a id='comment:9'></a>\nApply only trac_12966-indefinite-factorization-v2.patch",
    "created_at": "2012-05-26T23:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-151002",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:9'></a>
Apply only trac_12966-indefinite-factorization-v2.patch



---

archive/issue_events_111094.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-27T00:16:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12966#event-111094"
}
```



---

archive/issue_events_111095.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-05-27T00:16:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12966#event-111095"
}
```



---

archive/issue_comments_151003.json:
```json
{
    "body": "<a id='comment:11'></a>\nBy the way Rob - `\"{0} and {1}\".format(a ,b)` is the same as `\"{} and {}\".format(a, b)`, so you don't have to keep track of numbers.",
    "created_at": "2012-05-27T00:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-151003",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:11'></a>
By the way Rob - `"{0} and {1}".format(a ,b)` is the same as `"{} and {}".format(a, b)`, so you don't have to keep track of numbers.



---

archive/issue_comments_151004.json:
```json
{
    "body": "**Merged:** sage-5.1.beta2",
    "created_at": "2012-06-02T12:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12966#issuecomment-151004",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta2



---

archive/issue_events_111096.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T12:15:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12966#event-111096"
}
```



---

archive/issue_events_111097.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T12:15:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12966",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12966#event-111097"
}
```
