# Issue 12437: Fix remaining C++ issues of Lcalc (also to let it build with clang)

archive/issues_012265.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "Lcalc still uses some non-standard \"features\" of `g++`.\n\nC++ compilers that are pickier than `g++` will not allow this.\n\nGCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n \n---\nCurrent branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.\n\n\nCC:  @kiwifb @SnarkBoojum @tscrim\n\nKeywords: **C++11 C++14 GCC 5 clang**\n\nBranch/Commit: **[`f498bff`](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Fran\u00e7ois Bissey**\n\nComponent: **packages: standard**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12437_\n\n",
    "closed_at": "2016-10-21T07:04:42Z",
    "created_at": "2012-02-04T18:56:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-7.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix remaining C++ issues of Lcalc (also to let it build with clang)",
    "type": "issue",
    "updated_at": "2016-10-21T07:04:42Z",
    "url": "https://github.com/sagemath/sage/issues/12437",
    "user": "https://github.com/ohanar"
}
```
Lcalc still uses some non-standard "features" of `g++`.

C++ compilers that are pickier than `g++` will not allow this.

GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
 
---
Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.


CC:  @kiwifb @SnarkBoojum @tscrim

Keywords: **C++11 C++14 GCC 5 clang**

Branch/Commit: **[`f498bff`](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)**

Reviewer: **Travis Scrimshaw**

Author: **Fran√ßois Bissey**

Component: **packages: standard**

_Issue created by migration from https://trac.sagemath.org/ticket/12437_





---

archive/issue_events_170631.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-04T18:56:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170631"
}
```



---

archive/issue_events_170632.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-04T18:56:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170632"
}
```



---

archive/issue_events_170633.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-04T18:56:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170633"
}
```



---

archive/issue_events_170634.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-04T18:56:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170634"
}
```



---

archive/issue_events_170635.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-02-04T18:56:51Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "subject": "https://github.com/ohanar",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170635"
}
```



---

archive/issue_comments_136924.json:
```json
{
    "body": "Attachment: **[lcalc-defaults.patch.gz](https://github.com/sagemath/sage/files/ticket12437/lcalc-defaults.patch.gz)**\n\nfor review purposes",
    "created_at": "2012-02-04T18:57:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136924",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[lcalc-defaults.patch.gz](https://github.com/sagemath/sage/files/ticket12437/lcalc-defaults.patch.gz)**

for review purposes



---

archive/issue_events_170636.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-04T18:57:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170636"
}
```



---

archive/issue_comments_136925.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n c++ compilers that are pickier than g++ will not allow this.\n \n-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n+I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n``````\n",
    "created_at": "2012-02-04T18:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136925",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 c++ compilers that are pickier than g++ will not allow this.
 
-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg). (This is a review spkg in case there are more issues with clang down the road.)
+I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
``````




---

archive/issue_comments_136926.json:
```json
{
    "body": "Dependencies: **#12681**",
    "created_at": "2012-03-22T12:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136926",
    "user": "https://github.com/nexttime"
}
```

Dependencies: **#12681**



---

archive/issue_events_170637.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-03-22T12:32:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170637"
}
```



---

archive/issue_events_170638.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-03-22T12:32:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170638"
}
```



---

archive/issue_comments_136927.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWe now need a new spkg (based on that of #12681) incorporating this patch.\n\nWe also should report this upstream.\n\nPatch so far looks good (not sure whether I've seen all of it -- maybe trac truncated it); seems like most functions (also) had the default values in their *declarations*.",
    "created_at": "2012-03-22T12:32:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136927",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

We now need a new spkg (based on that of #12681) incorporating this patch.

We also should report this upstream.

Patch so far looks good (not sure whether I've seen all of it -- maybe trac truncated it); seems like most functions (also) had the default values in their *declarations*.



---

archive/issue_comments_136928.json:
```json
{
    "body": "Work Issues: **Create a new spkg.**",
    "created_at": "2012-03-22T12:33:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136928",
    "user": "https://github.com/nexttime"
}
```

Work Issues: **Create a new spkg.**



---

archive/issue_events_170639.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170639"
}
```



---

archive/issue_events_170640.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170640"
}
```



---

archive/issue_events_170641.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170641"
}
```



---

archive/issue_events_170642.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170642"
}
```



---

archive/issue_events_170643.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-02-04T08:00:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170643"
}
```



---

archive/issue_events_170644.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-02-04T08:00:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170644"
}
```



---

archive/issue_comments_136929.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nGCC 4.9 now also requires `-fpermissive` to build Lcalc as well as the Cython extension modules that use Lcalc's headers, unless we fix Lcalc.",
    "created_at": "2014-04-21T10:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136929",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

GCC 4.9 now also requires `-fpermissive` to build Lcalc as well as the Cython extension modules that use Lcalc's headers, unless we fix Lcalc.



---

archive/issue_comments_136930.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI'll check [later<sup>TM</sup>] whether Andrew's patch still applies (and whether it is sufficient for GCC 4.9 at least).",
    "created_at": "2014-04-21T10:58:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136930",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:9" align="right">comment:9</div>

I'll check [later<sup>TM</sup>] whether Andrew's patch still applies (and whether it is sufficient for GCC 4.9 at least).



---

archive/issue_comments_136931.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHmmm, haven't tested Andrew's patch [yet], but tried by myself.\n\nFor GCC 4.9, apparently the following tiny patch is sufficient to build Lcalc and the Sage library extension module (which currently lacks a `depends` btw.<sup>*</sup>):\n\n```diff\ndiff -Naur lcalc-1.23-vanilla/include/Ldirichlet_series.h lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h\n--- lcalc-1.23-vanilla/include/Ldirichlet_series.h\t2012-08-08 23:21:55.000000000 +0200\n+++ lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h\t2014-04-21 14:37:59.027464849 +0200\n@@ -43,7 +43,7 @@\n  //XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n template <class ttype>\n Complex L_function <ttype>::\n-dirichlet_series(Complex s, long long N=-1)\n+dirichlet_series(Complex s, long long N)\n {\n     Complex z=0.;\n     long long m,n;\ndiff -Naur lcalc-1.23-vanilla/include/L.h lcalc-1.23-fixed-gcc.4.9/include/L.h\n--- lcalc-1.23-vanilla/include/L.h\t2012-08-08 23:21:55.000000000 +0200\n+++ lcalc-1.23-fixed-gcc.4.9/include/L.h\t2014-04-21 14:32:04.003467348 +0200\n@@ -491,7 +491,7 @@\n \n     //#include \"Ldirichlet_series.h\" //for computing Dirichlet series\n     Complex partial_dirichlet_series(Complex s, long long N1, long long N2);\n-    Complex dirichlet_series(Complex s, long long N);\n+    Complex dirichlet_series(Complex s, long long N=-1LL);\n \n     //#include \"Ltaylor_series.h\" //for computing taylor series for Dirichlet series\n     //void compute_taylor_series(int N, int K, Complex s_0, Complex *series);\n```\n(In addition to the patches to Lcalc we already have in Sage, of which only a trivial one is needed to build Lcalc outside of Sage.)\n\n\n---\n\n<sup>*</sup>\n\n```diff\ndiff --git a/src/module_list.py b/src/module_list.py\nindex fa460be..b5449be 100755\n--- a/src/module_list.py\n+++ b/src/module_list.py\n@@ -700,10 +700,12 @@ ext_modules = [\n \n     Extension('sage.libs.lcalc.lcalc_Lfunction',\n               sources = ['sage/libs/lcalc/lcalc_Lfunction.pyx'],\n-              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',\n+              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',         # XXX Are all of these really needed? (NTL??)\n                            'Lfunction'],\n               include_dirs = [SAGE_INC + \"/libLfunction\"],\n-              extra_compile_args=[\"-O3\", \"-ffast-math\"],\n+              depends = [ os.path.join(SAGE_INC, \"libLfunction\", header)\n+                          for header in [\"L.h\"] ],                     # maybe more headers from there\n+              extra_compile_args=[\"-O3\", \"-ffast-math\"],               # probably add '-Wno-deprecated', as of Lcalc 1.23\n               language = 'c++'),\n \n \n```\n\n(And, despite having `language=\"c++\"`, the extension module is *compiled* with the C compiler, not the C++ compiler, such that -- besides other effects -- `CXXFLAGS` aren't used.  It gets *linked* with `g++` though.)",
    "created_at": "2014-04-21T13:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136931",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:10" align="right">comment:10</div>

Hmmm, haven't tested Andrew's patch [yet], but tried by myself.

For GCC 4.9, apparently the following tiny patch is sufficient to build Lcalc and the Sage library extension module (which currently lacks a `depends` btw.<sup>*</sup>):

```diff
diff -Naur lcalc-1.23-vanilla/include/Ldirichlet_series.h lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h
--- lcalc-1.23-vanilla/include/Ldirichlet_series.h	2012-08-08 23:21:55.000000000 +0200
+++ lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h	2014-04-21 14:37:59.027464849 +0200
@@ -43,7 +43,7 @@
  //XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
 template <class ttype>
 Complex L_function <ttype>::
-dirichlet_series(Complex s, long long N=-1)
+dirichlet_series(Complex s, long long N)
 {
     Complex z=0.;
     long long m,n;
diff -Naur lcalc-1.23-vanilla/include/L.h lcalc-1.23-fixed-gcc.4.9/include/L.h
--- lcalc-1.23-vanilla/include/L.h	2012-08-08 23:21:55.000000000 +0200
+++ lcalc-1.23-fixed-gcc.4.9/include/L.h	2014-04-21 14:32:04.003467348 +0200
@@ -491,7 +491,7 @@
 
     //#include "Ldirichlet_series.h" //for computing Dirichlet series
     Complex partial_dirichlet_series(Complex s, long long N1, long long N2);
-    Complex dirichlet_series(Complex s, long long N);
+    Complex dirichlet_series(Complex s, long long N=-1LL);
 
     //#include "Ltaylor_series.h" //for computing taylor series for Dirichlet series
     //void compute_taylor_series(int N, int K, Complex s_0, Complex *series);
```
(In addition to the patches to Lcalc we already have in Sage, of which only a trivial one is needed to build Lcalc outside of Sage.)


---

<sup>*</sup>

```diff
diff --git a/src/module_list.py b/src/module_list.py
index fa460be..b5449be 100755
--- a/src/module_list.py
+++ b/src/module_list.py
@@ -700,10 +700,12 @@ ext_modules = [
 
     Extension('sage.libs.lcalc.lcalc_Lfunction',
               sources = ['sage/libs/lcalc/lcalc_Lfunction.pyx'],
-              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',
+              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',         # XXX Are all of these really needed? (NTL??)
                            'Lfunction'],
               include_dirs = [SAGE_INC + "/libLfunction"],
-              extra_compile_args=["-O3", "-ffast-math"],
+              depends = [ os.path.join(SAGE_INC, "libLfunction", header)
+                          for header in ["L.h"] ],                     # maybe more headers from there
+              extra_compile_args=["-O3", "-ffast-math"],               # probably add '-Wno-deprecated', as of Lcalc 1.23
               language = 'c++'),
 
 
```

(And, despite having `language="c++"`, the extension module is *compiled* with the C compiler, not the C++ compiler, such that -- besides other effects -- `CXXFLAGS` aren't used.  It gets *linked* with `g++` though.)



---

archive/issue_comments_136932.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nYour patch looks like a subset of mine. I can't remember why I did all the things that I did in my patch, but I would guess that I needed them to compile with clang. It may be that gcc 4.9 is still too permissive in this case.",
    "created_at": "2014-04-21T18:40:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136932",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:11" align="right">comment:11</div>

Your patch looks like a subset of mine. I can't remember why I did all the things that I did in my patch, but I would guess that I needed them to compile with clang. It may be that gcc 4.9 is still too permissive in this case.



---

archive/issue_comments_136933.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@ohanar](#comment:11):\n> Your patch looks like a subset of mine.\n\nYes.  My primary goal was to make Lcalc work with GCC; I'll take a closer look at other changes later.\n\nAdding `void` to the `friend` declaration of `reset()` is certainly correct (although slightly unrelated to what the *name of the patch* suggests, on the broader topic of *this* ticket, namely making Lcalc's code build with `clang`).\n\nIn the other hunks, you just removed default parameters from *definitions*, but did not move them to corresponding *declarations* (probably because there aren't any, which is something I'll have to check).  But from at least one comment, it looks like those parts were \"dead\" code anyway.",
    "created_at": "2014-04-21T23:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136933",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@ohanar](#comment:11):
> Your patch looks like a subset of mine.

Yes.  My primary goal was to make Lcalc work with GCC; I'll take a closer look at other changes later.

Adding `void` to the `friend` declaration of `reset()` is certainly correct (although slightly unrelated to what the *name of the patch* suggests, on the broader topic of *this* ticket, namely making Lcalc's code build with `clang`).

In the other hunks, you just removed default parameters from *definitions*, but did not move them to corresponding *declarations* (probably because there aren't any, which is something I'll have to check).  But from at least one comment, it looks like those parts were "dead" code anyway.



---

archive/issue_events_170645.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170645"
}
```



---

archive/issue_events_170646.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170646"
}
```



---

archive/issue_comments_136934.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOk, so I've now created 7 new patches to fix all remaining clang/non-GNU/C++11 issues with Lcalc (except for some deprecation warnings):\n\n```\nMakefile_2-dont_compile_C_with_CXXFLAGS.patch\nlcalc-1.23-fix_VLA_1.patch\nlcalc-1.23-fix_VLA_2.patch\nlcalc-1.23-fix_control_reaches_end_of_non-void_fn.patch\nlcalc-1.23-fix_typeof.patch\nlcalc-1.23-missing_return_type.patch\nlcalc-1.23_default_parameters_2.patch\n```\n\nBut I'd prefer to put them on a single ticket, i.e., to either open a new one, or repurpose one of the two existing ones.  (But before doing so, I'll anyway polish them a bit, and probably merge some of them into another or into one of the existing ones.)\n\nI did take a slightly different approach to variable-length arrays; instead of using `std::vector<>`, I'm using `foo_t *_foo = new foo_t[dim1*dim2*dim3]`, along with a macro `foo(i,j,k)` which maps the indices to a single one, and of course added `delete [] _foo` where necessary.\n\nSo far tested with GCC 4.4, 4.8 and 4.9, clang 3.4.1, and a couple of `-std=...` variations.",
    "created_at": "2014-05-19T01:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136934",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:15" align="right">comment:15</div>

Ok, so I've now created 7 new patches to fix all remaining clang/non-GNU/C++11 issues with Lcalc (except for some deprecation warnings):

```
Makefile_2-dont_compile_C_with_CXXFLAGS.patch
lcalc-1.23-fix_VLA_1.patch
lcalc-1.23-fix_VLA_2.patch
lcalc-1.23-fix_control_reaches_end_of_non-void_fn.patch
lcalc-1.23-fix_typeof.patch
lcalc-1.23-missing_return_type.patch
lcalc-1.23_default_parameters_2.patch
```

But I'd prefer to put them on a single ticket, i.e., to either open a new one, or repurpose one of the two existing ones.  (But before doing so, I'll anyway polish them a bit, and probably merge some of them into another or into one of the existing ones.)

I did take a slightly different approach to variable-length arrays; instead of using `std::vector<>`, I'm using `foo_t *_foo = new foo_t[dim1*dim2*dim3]`, along with a macro `foo(i,j,k)` which maps the indices to a single one, and of course added `delete [] _foo` where necessary.

So far tested with GCC 4.4, 4.8 and 4.9, clang 3.4.1, and a couple of `-std=...` variations.



---

archive/issue_comments_136935.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nHi leif,\n\nthese are quite some patches. Do you plan to send them upstream?",
    "created_at": "2014-05-20T22:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136935",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:16" align="right">comment:16</div>

Hi leif,

these are quite some patches. Do you plan to send them upstream?



---

archive/issue_comments_136936.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@tobihan](#comment:16):\n> Hi leif,\n> \n> these are quite some patches. Do you plan to send them upstream?\n\nWell, upstream... ;-)\n\nThe patches are pretty small, and I'll merge them into fewer I think, hopefully next weekend.\n\nPretty a while ago, *someone<sup>TM</sup>* wanted to create an autotools project for Michael, but that apparently never happened, so we keep heavily patching the existing Makefile.\n\nAFAIK, some previous patches (e.g. dealing with newer PARI versions) went upstream, i.e., Michael should at least be aware of them; I'll certainly send him the new / updated ones later.  Not sure whether he's interested in changes removing GNU extensions.  (Variable-length arrays can still be used depending on macros / the compiler though.)",
    "created_at": "2014-05-21T09:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136936",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@tobihan](#comment:16):
> Hi leif,
> 
> these are quite some patches. Do you plan to send them upstream?

Well, upstream... ;-)

The patches are pretty small, and I'll merge them into fewer I think, hopefully next weekend.

Pretty a while ago, *someone<sup>TM</sup>* wanted to create an autotools project for Michael, but that apparently never happened, so we keep heavily patching the existing Makefile.

AFAIK, some previous patches (e.g. dealing with newer PARI versions) went upstream, i.e., Michael should at least be aware of them; I'll certainly send him the new / updated ones later.  Not sure whether he's interested in changes removing GNU extensions.  (Variable-length arrays can still be used depending on macros / the compiler though.)



---

archive/issue_comments_136937.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nWell I hope upstreaming them works out. Sage is not the only downstream who needs these patches. There's at least Debian (where I'm maintaining the package) and Fedora. Having them upstream would make everyones live a lot easier.",
    "created_at": "2014-05-21T10:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136937",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:18" align="right">comment:18</div>

Well I hope upstreaming them works out. Sage is not the only downstream who needs these patches. There's at least Debian (where I'm maintaining the package) and Fedora. Having them upstream would make everyones live a lot easier.



---

archive/issue_events_170647.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170647"
}
```



---

archive/issue_events_170648.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170648"
}
```



---

archive/issue_comments_136938.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'm also interested in the issue. What is the status of the patches? Did upstream answer?",
    "created_at": "2015-02-18T19:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136938",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:20" align="right">comment:20</div>

I'm also interested in the issue. What is the status of the patches? Did upstream answer?



---

archive/issue_comments_136939.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n c++ compilers that are pickier than g++ will not allow this.\n \n+GCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n+ \n+---\n+\n+(Meanwhile historical note from Andrew:)\n+\n I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n+\n``````\n",
    "created_at": "2015-04-22T01:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136939",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
 c++ compilers that are pickier than g++ will not allow this.
 
+GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
+ 
+---
+
+(Meanwhile historical note from Andrew:)
+
 I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
+
``````




---

archive/issue_comments_136940.json:
```json
{
    "body": "Changed work issues from **Create a new spkg.** to **Locate patches and upload them... ;-)**",
    "created_at": "2015-04-22T01:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136940",
    "user": "https://github.com/nexttime"
}
```

Changed work issues from **Create a new spkg.** to **Locate patches and upload them... ;-)**



---

archive/issue_comments_136941.json:
```json
{
    "body": "Changed keywords from none to **C++11 C++14 GCC 5 clang**",
    "created_at": "2015-04-22T01:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136941",
    "user": "https://github.com/nexttime"
}
```

Changed keywords from none to **C++11 C++14 GCC 5 clang**



---

archive/issue_events_170649.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-22T01:54:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170649"
}
```



---

archive/issue_events_170650.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-22T01:54:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170650"
}
```



---

archive/issue_comments_136942.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nGCC 5.x now also needs a small subset of the fixes for clang (or `-fpermissive`; then also a couple of Sage extension modules which include Lcalc headers have to get built with `-fpermissive`, in `CFLAGS`(!)).  (cf. ticket description)\n\nI'll probably deal with that on another ticket.",
    "created_at": "2015-04-22T01:54:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136942",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:21" align="right">comment:21</div>

GCC 5.x now also needs a small subset of the fixes for clang (or `-fpermissive`; then also a couple of Sage extension modules which include Lcalc headers have to get built with `-fpermissive`, in `CFLAGS`(!)).  (cf. ticket description)

I'll probably deal with that on another ticket.



---

archive/issue_comments_136943.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?",
    "created_at": "2015-04-22T01:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136943",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:22" align="right">comment:22</div>

The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?



---

archive/issue_comments_136944.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@kiwifb](#comment:22):\n> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?\n\nSure, trivial for `g++` at least.\n\nWe of course could also add `-fpermissive` in Lcalc's `spkg-install`, but I rather meant\n\n```sh\nenv CXXFLAGS=\"-fpermissive\" ./sage -f lcalc\nenv CFLAGS=\"-fpermissive\" ./sage -b\n```\nto temporarily work around the errors when building Sage (with GCC 5.x).\n\nI had two other issues (with gf2x and ncurses) which hopefully vanish tomorrow [i.e., later today down under] when the final 5.1 (or 5.0.1?) gets released.",
    "created_at": "2015-04-22T02:11:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136944",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@kiwifb](#comment:22):
> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?

Sure, trivial for `g++` at least.

We of course could also add `-fpermissive` in Lcalc's `spkg-install`, but I rather meant

```sh
env CXXFLAGS="-fpermissive" ./sage -f lcalc
env CFLAGS="-fpermissive" ./sage -b
```
to temporarily work around the errors when building Sage (with GCC 5.x).

I had two other issues (with gf2x and ncurses) which hopefully vanish tomorrow [i.e., later today down under] when the final 5.1 (or 5.0.1?) gets released.



---

archive/issue_comments_136945.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@kiwifb](#comment:22):\n> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?\n\nI probably misunderstood you; the (GCC 5.x/default parameters) patch is the same for Lcalc and the headers the Sage library uses (i.e., Lcalc uses the same so the errors are exactly the same, one patch for both issues).",
    "created_at": "2015-04-22T02:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136945",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@kiwifb](#comment:22):
> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?

I probably misunderstood you; the (GCC 5.x/default parameters) patch is the same for Lcalc and the headers the Sage library uses (i.e., Lcalc uses the same so the errors are exactly the same, one patch for both issues).



---

archive/issue_comments_136946.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,",
    "created_at": "2015-04-22T02:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136946",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

I think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,



---

archive/issue_comments_136947.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThis looks like the second default parameters patch I mentioned:\n\n```diff\n--- lcalc-1.23/include/Lgamma.h\t2012-08-08 23:21:55.000000000 +0200\n+++ lcalc-1.23/include/Lgamma.h\t2014-05-18 21:15:27.786889718 +0200\n@@ -77,7 +77,7 @@\n //n=0 should just give log_GAMMA(z)... thus making log_GAMMA\n //code obsolete. But leave log_GAMMA intact anyways.\n template <class ttype>\n-precise(ttype) log_GAMMA (ttype z,int n=0)\n+precise(ttype) log_GAMMA (ttype z,int n)\n {\n     int M;\n     precise(ttype) log_G,r,r2,y;\n@@ -230,7 +230,7 @@\n //value exp_w which holds exp(-w)\n //computes G(z,w), so there's an extra w^(-z) factor.\n template <class ttype>\n-Complex inc_GAMMA (ttype z,ttype w, const char *method=\"temme\", ttype exp_w = 0, bool recycle=false)\n+Complex inc_GAMMA (ttype z,ttype w, const char *method, ttype exp_w, bool recycle)\n {\n \n     Complex G;\n@@ -334,7 +334,7 @@\n \n \n template <class ttype>\n-ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w=0, bool recycle=false)  //computes G(z,w) via continued fraction\n+ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via continued fraction\n {\n \n         ttype G;\n@@ -424,7 +424,7 @@\n }\n \n template <class ttype>\n-ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w = 0, bool recycle=false)  //computes G(z,w) via asymptotic series\n+ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via asymptotic series\n {\n \n         if(my_verbose>3) cout << \"called asympt_GAMMA(\"<<z<<\",\"<<w<<\")\"<< endl;\n@@ -446,7 +446,7 @@\n \n \n template <class ttype>\n-ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w = 0, bool recycle=false)  //computes g(z,w)\n+ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w, bool recycle)  //computes g(z,w)\n {\n \n     ttype g;\n@@ -604,7 +604,7 @@\n }\n \n template <class ttype>\n-Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta=1, const char *method=\"temme\")\n+Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta, const char *method)\n {\n     Complex SUM=0;\n \n```\n(Not yet checked whether it's complete/sufficient; the GCC 5.0.1 release candidate is on another machine.)",
    "created_at": "2015-04-22T02:31:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136947",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:26" align="right">comment:26</div>

This looks like the second default parameters patch I mentioned:

```diff
--- lcalc-1.23/include/Lgamma.h	2012-08-08 23:21:55.000000000 +0200
+++ lcalc-1.23/include/Lgamma.h	2014-05-18 21:15:27.786889718 +0200
@@ -77,7 +77,7 @@
 //n=0 should just give log_GAMMA(z)... thus making log_GAMMA
 //code obsolete. But leave log_GAMMA intact anyways.
 template <class ttype>
-precise(ttype) log_GAMMA (ttype z,int n=0)
+precise(ttype) log_GAMMA (ttype z,int n)
 {
     int M;
     precise(ttype) log_G,r,r2,y;
@@ -230,7 +230,7 @@
 //value exp_w which holds exp(-w)
 //computes G(z,w), so there's an extra w^(-z) factor.
 template <class ttype>
-Complex inc_GAMMA (ttype z,ttype w, const char *method="temme", ttype exp_w = 0, bool recycle=false)
+Complex inc_GAMMA (ttype z,ttype w, const char *method, ttype exp_w, bool recycle)
 {
 
     Complex G;
@@ -334,7 +334,7 @@
 
 
 template <class ttype>
-ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w=0, bool recycle=false)  //computes G(z,w) via continued fraction
+ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via continued fraction
 {
 
         ttype G;
@@ -424,7 +424,7 @@
 }
 
 template <class ttype>
-ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w = 0, bool recycle=false)  //computes G(z,w) via asymptotic series
+ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via asymptotic series
 {
 
         if(my_verbose>3) cout << "called asympt_GAMMA("<<z<<","<<w<<")"<< endl;
@@ -446,7 +446,7 @@
 
 
 template <class ttype>
-ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w = 0, bool recycle=false)  //computes g(z,w)
+ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w, bool recycle)  //computes g(z,w)
 {
 
     ttype g;
@@ -604,7 +604,7 @@
 }
 
 template <class ttype>
-Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta=1, const char *method="temme")
+Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta, const char *method)
 {
     Complex SUM=0;
 
```
(Not yet checked whether it's complete/sufficient; the GCC 5.0.1 release candidate is on another machine.)



---

archive/issue_comments_136948.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@kiwifb](#comment:25):\n> I think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,\n\nI was surprised building the first RC went smooth (on a pretty \"clean\" machine though); this time no cloog/PPL/ISL version hazards or the like... (`make clean` still bails out though IIRC.)\n\nW.r.t. the versioning:  5.1 in the subject, 5.0.1 in the message body; RC1 tarball called 5.1.0-, identifies as 5.0.1 (prerelease)...  B)",
    "created_at": "2015-04-22T02:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136948",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@kiwifb](#comment:25):
> I think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,

I was surprised building the first RC went smooth (on a pretty "clean" machine though); this time no cloog/PPL/ISL version hazards or the like... (`make clean` still bails out though IIRC.)

W.r.t. the versioning:  5.1 in the subject, 5.0.1 in the message body; RC1 tarball called 5.1.0-, identifies as 5.0.1 (prerelease)...  B)



---

archive/issue_comments_136949.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThe [lcalc-1.23_default_parameters_2.patch](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/lcalc/patches/lcalc-1.23_default_parameters_2.patch?id=e8b148686cf17804be7354723401bdd84c0a49aa) is now [there](http://trac.sagemath.org/ticket/18316), and sufficient for GCC 5.x (needs review).",
    "created_at": "2015-04-27T18:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136949",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:28" align="right">comment:28</div>

The [lcalc-1.23_default_parameters_2.patch](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/lcalc/patches/lcalc-1.23_default_parameters_2.patch?id=e8b148686cf17804be7354723401bdd84c0a49aa) is now [there](http://trac.sagemath.org/ticket/18316), and sufficient for GCC 5.x (needs review).



---

archive/issue_comments_136950.json:
```json
{
    "body": "Changed dependencies from **#12681** to **#12681, #18316**",
    "created_at": "2015-04-27T18:09:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136950",
    "user": "https://github.com/nexttime"
}
```

Changed dependencies from **#12681** to **#12681, #18316**



---

archive/issue_comments_136951.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nCan this be closed as duplicate of #18316?",
    "created_at": "2015-05-19T12:53:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136951",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Can this be closed as duplicate of #18316?



---

archive/issue_comments_136952.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@jdemeyer](#comment:29):\n> Can this be closed as duplicate of #18316?\n\nNope, we just need a good new title (as the other issues with `clang` / C++, cf. [the comment above](#comment:15)) have been discussed here as well...  (There's also #12436, but this one is probably a bit fresher.)",
    "created_at": "2015-05-19T13:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136952",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@jdemeyer](#comment:29):
> Can this be closed as duplicate of #18316?

Nope, we just need a good new title (as the other issues with `clang` / C++, cf. [the comment above](#comment:15)) have been discussed here as well...  (There's also #12436, but this one is probably a bit fresher.)



---

archive/issue_events_170651.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-19T13:51:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "title_is": "Fix remaining C++ issues of Lcalc (also to let it build with clang)",
    "title_was": "lcalc defines default values for functions outside of declarations",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170651"
}
```



---

archive/issue_comments_136953.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-c++ compilers that are pickier than g++ will not allow this.\n+Lcalc still uses some non-standard \"features\" of `g++`.\n+\n+C++ compilers that are pickier than `g++` will not allow this.\n \n GCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n  \n``````\n",
    "created_at": "2015-05-19T13:51:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136953",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-c++ compilers that are pickier than g++ will not allow this.
+Lcalc still uses some non-standard "features" of `g++`.
+
+C++ compilers that are pickier than `g++` will not allow this.
 
 GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
  
``````




---

archive/issue_comments_136954.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nP.S.:\n\nI also have to retest my patches with more recent versions of `clang` and `g++`.",
    "created_at": "2015-05-19T14:06:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136954",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:32" align="right">comment:32</div>

P.S.:

I also have to retest my patches with more recent versions of `clang` and `g++`.



---

archive/issue_comments_136955.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nLeif, can you put the remaining stuff in a branch to test? And I would say close #12436 as a duplicate.",
    "created_at": "2016-09-17T07:48:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136955",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">comment:33</div>

Leif, can you put the remaining stuff in a branch to test? And I would say close #12436 as a duplicate.



---

archive/issue_comments_136956.json:
```json
{
    "body": "Commit: **[`8a9fe64`](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)**",
    "created_at": "2016-09-18T21:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136956",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[`8a9fe64`](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)**



---

archive/issue_comments_136957.json:
```json
{
    "body": "Branch: **[u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)**",
    "created_at": "2016-09-18T21:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136957",
    "user": "https://github.com/kiwifb"
}
```

Branch: **[u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)**



---

archive/issue_comments_136958.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf\"><code>8a9fe64</code></a></td><td><code>Remove use of internal header- cmath should be sufficient. Fix declaration.</code></td></tr></table>\n",
    "created_at": "2016-09-18T21:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136958",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:34"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf"><code>8a9fe64</code></a></td><td><code>Remove use of internal header- cmath should be sufficient. Fix declaration.</code></td></tr></table>




---

archive/issue_events_170652.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-18T21:40:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170652"
}
```



---

archive/issue_events_170653.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-18T21:40:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170653"
}
```



---

archive/issue_comments_136959.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,6 @@\n \n I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n \n+---\n+Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.\n+\n``````\n",
    "created_at": "2016-09-18T21:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136959",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,6 @@
 
 I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
 
+---
+Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.
+
``````




---

archive/issue_comments_136960.json:
```json
{
    "body": "Author: **Fran\u00e7ois Bissey**",
    "created_at": "2016-09-18T21:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136960",
    "user": "https://github.com/kiwifb"
}
```

Author: **Fran√ßois Bissey**



---

archive/issue_comments_136961.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nNext issue\n\n```\n[lcalc-1.23.p14] clang++ -O3   -ffast-math -fPIC   -I../include -c Lriemannsiegel.cc\n[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:\n[lcalc-1.23.p14] In file included from ../include/L.h:539:\n[lcalc-1.23.p14] ../include/Ldokchitser.h:72:14: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]     Complex m[N+1];\n[lcalc-1.23.p14]              ^\n[lcalc-1.23.p14] ../include/Ldokchitser.h:81:23: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]         Complex sum_log_Gamma[N+1][MYDIGITS+1];\n[lcalc-1.23.p14]                              ^\n[lcalc-1.23.p14] ../include/Ldokchitser.h:106:27: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]         Complex exp_sum_log_Gamma[N+1][MYDIGITS+1][MYDIGITS+1]; // symmetric functions\n[lcalc-1.23.p14]                                  ^\n[lcalc-1.23.p14] ../include/Ldokchitser.h:107:15: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]         Complex gamma[N+1][MYDIGITS+1]; // gamma(s+m[j]) for j = 1 to N\n[lcalc-1.23.p14]                      ^\n[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:\n[lcalc-1.23.p14] In file included from ../include/L.h:542:\n[lcalc-1.23.p14] ../include/Lexplicit_formula.h:28:12: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]   Complex b[num_coeffs+1];\n[lcalc-1.23.p14]            ^\n[lcalc-1.23.p14] 5 errors generated.\n```",
    "created_at": "2016-09-18T21:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136961",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:35" align="right">comment:35</div>

Next issue

```
[lcalc-1.23.p14] clang++ -O3   -ffast-math -fPIC   -I../include -c Lriemannsiegel.cc
[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:
[lcalc-1.23.p14] In file included from ../include/L.h:539:
[lcalc-1.23.p14] ../include/Ldokchitser.h:72:14: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]     Complex m[N+1];
[lcalc-1.23.p14]              ^
[lcalc-1.23.p14] ../include/Ldokchitser.h:81:23: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]         Complex sum_log_Gamma[N+1][MYDIGITS+1];
[lcalc-1.23.p14]                              ^
[lcalc-1.23.p14] ../include/Ldokchitser.h:106:27: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]         Complex exp_sum_log_Gamma[N+1][MYDIGITS+1][MYDIGITS+1]; // symmetric functions
[lcalc-1.23.p14]                                  ^
[lcalc-1.23.p14] ../include/Ldokchitser.h:107:15: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]         Complex gamma[N+1][MYDIGITS+1]; // gamma(s+m[j]) for j = 1 to N
[lcalc-1.23.p14]                      ^
[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:
[lcalc-1.23.p14] In file included from ../include/L.h:542:
[lcalc-1.23.p14] ../include/Lexplicit_formula.h:28:12: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]   Complex b[num_coeffs+1];
[lcalc-1.23.p14]            ^
[lcalc-1.23.p14] 5 errors generated.
```



---

archive/issue_comments_136962.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,11 +5,5 @@\n GCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n  \n ---\n-\n-(Meanwhile historical note from Andrew:)\n-\n-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n-\n----\n Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.\n \n``````\n",
    "created_at": "2016-09-19T15:14:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136962",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,11 +5,5 @@
 GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
  
 ---
-
-(Meanwhile historical note from Andrew:)
-
-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
-
----
 Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.
 
``````




---

archive/issue_comments_136963.json:
```json
{
    "body": "Changed dependencies from **#12681, #18316** to none",
    "created_at": "2016-09-19T15:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136963",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#12681, #18316** to none



---

archive/issue_comments_136964.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nThe issue I hit now with this is pretty much the VLA. I am guessing I can get the first VLA patch from #12436 but not the second one. \n\n@nexttime do you still have those patches and can you share them?",
    "created_at": "2016-09-29T21:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136964",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:39" align="right">comment:39</div>

The issue I hit now with this is pretty much the VLA. I am guessing I can get the first VLA patch from #12436 but not the second one. 

@nexttime do you still have those patches and can you share them?



---

archive/issue_comments_136965.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b\"><code>f498bff</code></a></td><td><code>Adapt old patch from Andrew Ohana for VLA in C++</code></td></tr></table>\n",
    "created_at": "2016-09-30T00:36:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136965",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b"><code>f498bff</code></a></td><td><code>Adapt old patch from Andrew Ohana for VLA in C++</code></td></tr></table>




---

archive/issue_comments_136966.json:
```json
{
    "body": "Changed commit from **[`8a9fe64`](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)** to **[`f498bff`](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)**",
    "created_at": "2016-09-30T00:36:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136966",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8a9fe64`](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)** to **[`f498bff`](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)**



---

archive/issue_events_170654.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170654"
}
```



---

archive/issue_events_170655.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "milestone_number": null,
    "milestone_title": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170655"
}
```



---

archive/issue_events_170656.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170656"
}
```



---

archive/issue_events_170657.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170657"
}
```



---

archive/issue_comments_136967.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nActually doing the VLA like Andrew did initially in #12436 is good enough. And while we have warnings for all the other stuff mentioned in this tickets it all compiled successfully with clang (latest on Sierra, based on 3.8).",
    "created_at": "2016-09-30T00:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136967",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:41" align="right">comment:41</div>

Actually doing the VLA like Andrew did initially in #12436 is good enough. And while we have warnings for all the other stuff mentioned in this tickets it all compiled successfully with clang (latest on Sierra, based on 3.8).



---

archive/issue_comments_136968.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI'm hesitant about the changes of the form:\n\n```diff\n+diff --git a/include/Ldokchitser.h b/include/Ldokchitser.h\n+index c67f01a..7b3e5c9 100644\n+--- a/include/Ldokchitser.h\n++++ b/include/Ldokchitser.h\n+@@ -69,7 +69,7 @@ phi_series(int precision)\n+     \n+     // compute the values m[j] for the respective lambda_k[j]\n+     \n+-    Complex m[N+1];\n++    std::vector<Complex> m(N+1);\n+     for (j=1;j<=N;j++)\n+     \tm[j] = -2*lambda_k[j] + 2;\n+ \t\n```\nbecause my understanding is g++ to treats `Complex m[N+1]` as `Complex *m = new Complex[N+1]`, which changing to `std::vector` could have an impact on performance. I haven't looked at the code itself, but my guess is that lcalc wanted to treat these as fixed length arrays whose size is determined at runtime.",
    "created_at": "2016-10-04T19:16:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136968",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

I'm hesitant about the changes of the form:

```diff
+diff --git a/include/Ldokchitser.h b/include/Ldokchitser.h
+index c67f01a..7b3e5c9 100644
+--- a/include/Ldokchitser.h
++++ b/include/Ldokchitser.h
+@@ -69,7 +69,7 @@ phi_series(int precision)
+     
+     // compute the values m[j] for the respective lambda_k[j]
+     
+-    Complex m[N+1];
++    std::vector<Complex> m(N+1);
+     for (j=1;j<=N;j++)
+     	m[j] = -2*lambda_k[j] + 2;
+ 	
```
because my understanding is g++ to treats `Complex m[N+1]` as `Complex *m = new Complex[N+1]`, which changing to `std::vector` could have an impact on performance. I haven't looked at the code itself, but my guess is that lcalc wanted to treat these as fixed length arrays whose size is determined at runtime.



---

archive/issue_comments_136969.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nCorrect, they are VLA. The replacement with `new` works very well for one dimensional arrays. Multidimensional ones are another story, I guess it would be similar with more ugly loops. It seems to me that the accepted behavior in C++ is to use vector for these (from stack overflow examples).\nThe mystery to me is that there are many more VLA in that particular code but only a few of them raise a flag. What gives?",
    "created_at": "2016-10-04T19:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136969",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:43" align="right">comment:43</div>

Correct, they are VLA. The replacement with `new` works very well for one dimensional arrays. Multidimensional ones are another story, I guess it would be similar with more ugly loops. It seems to me that the accepted behavior in C++ is to use vector for these (from stack overflow examples).
The mystery to me is that there are many more VLA in that particular code but only a few of them raise a flag. What gives?



---

archive/issue_comments_136970.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nI can understand why `std::vector` would be a natural choice because you don't have to worry about memory management (specifically the deallocation). It just there is some slight overhead from using it rather than direct system calls with the array, but that is more likely a micro-optimization. Perhaps some of the others aren't raising warnings because their length can be determined at compile time?\n\nOne little change to a patch:\n\n```diff\n         std::vector<std::vector<std::vector<Complex> > > exp_sum_log_Gamma(N+1); // symmetric functions\n         std::vector<std::vector<Complex> > gamma(N+1); // gamma(s+m[j]) for j = 1 to N\n         for (j=1;j<=N;j++){\n             exp_sum_log_Gamma[j].resize(MYDIGITS+1);\n+            for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);\n             gamma[j].resize(MYDIGITS+1);\n         }\n-        for (j=1;j<=N;j++) for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);\n```\nas I think it is (slightly) more readable considering we are already working with the 3d array.",
    "created_at": "2016-10-04T19:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136970",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:44" align="right">comment:44</div>

I can understand why `std::vector` would be a natural choice because you don't have to worry about memory management (specifically the deallocation). It just there is some slight overhead from using it rather than direct system calls with the array, but that is more likely a micro-optimization. Perhaps some of the others aren't raising warnings because their length can be determined at compile time?

One little change to a patch:

```diff
         std::vector<std::vector<std::vector<Complex> > > exp_sum_log_Gamma(N+1); // symmetric functions
         std::vector<std::vector<Complex> > gamma(N+1); // gamma(s+m[j]) for j = 1 to N
         for (j=1;j<=N;j++){
             exp_sum_log_Gamma[j].resize(MYDIGITS+1);
+            for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);
             gamma[j].resize(MYDIGITS+1);
         }
-        for (j=1;j<=N;j++) for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);
```
as I think it is (slightly) more readable considering we are already working with the 3d array.



---

archive/issue_comments_136971.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI wouldn't worry too much about optimization at this stage. The compiler does a better job than you'll ever do on that. The only thing the compiler cannot do is find a better algorithm (although it may be able able to re-order your loops in a way you wouldn't have thought of). \nFor the little change I copied the structure of the original patch which does that in separate stages. If you feel it is clearer your way, feel free to commit your change as a part of your review (I can do it myself if you insist).",
    "created_at": "2016-10-05T21:26:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136971",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:45" align="right">comment:45</div>

I wouldn't worry too much about optimization at this stage. The compiler does a better job than you'll ever do on that. The only thing the compiler cannot do is find a better algorithm (although it may be able able to re-order your loops in a way you wouldn't have thought of). 
For the little change I copied the structure of the original patch which does that in separate stages. If you feel it is clearer your way, feel free to commit your change as a part of your review (I can do it myself if you insist).



---

archive/issue_events_170658.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-10-05T21:28:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170658"
}
```



---

archive/issue_events_170659.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-10-05T21:28:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170659"
}
```



---

archive/issue_comments_136972.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2016-10-05T21:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136972",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_136973.json:
```json
{
    "body": "Changed work issues from **Locate patches and upload them... ;-)** to none",
    "created_at": "2016-10-05T21:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136973",
    "user": "https://github.com/tscrim"
}
```

Changed work issues from **Locate patches and upload them... ;-)** to none



---

archive/issue_comments_136974.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nIt's in the realm of bikeshedding, so I'm sending this off to the buildbots.",
    "created_at": "2016-10-05T21:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136974",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:46" align="right">comment:46</div>

It's in the realm of bikeshedding, so I'm sending this off to the buildbots.



---

archive/issue_events_170660.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-21T07:04:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170660"
}
```



---

archive/issue_events_170661.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "455d8f40753d97fb0fd1d4c08fd1c8a74391d3db",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2016-10-21T07:04:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12437#event-170661"
}
```



---

archive/issue_comments_136975.json:
```json
{
    "body": "Changed branch from **[u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)** to **[`f498bff`](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)**",
    "created_at": "2016-10-21T07:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12437#issuecomment-136975",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)** to **[`f498bff`](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)**
