# Issue 12437: Fix remaining C++ issues of Lcalc (also to let it build with clang)

archive/issues_012265.json:
```json
{
    "body": "Lcalc still uses some non-standard \"features\" of `g++`.\n\nC++ compilers that are pickier than `g++` will not allow this.\n\nGCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n \n---\nCurrent branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.\n\n\n**Assignee:** GeorgSWeber\n\n**CC:**  @kiwifb Snark @tscrim\n\n**Keywords:** C++11 C++14 GCC 5 clang\n\n**Branch/Commit:** [f498bffb5d0c8cc88acc005e4af8def82c18237b](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Fran\u00e7ois Bissey\n\nIssue created by migration from https://trac.sagemath.org/ticket/12437\n\n",
    "closed_at": "2016-10-21T07:04:42Z",
    "created_at": "2012-02-04T18:56:51Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Fix remaining C++ issues of Lcalc (also to let it build with clang)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12437",
    "user": "https://github.com/ohanar"
}
```
Lcalc still uses some non-standard "features" of `g++`.

C++ compilers that are pickier than `g++` will not allow this.

GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
 
---
Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.


**Assignee:** GeorgSWeber

**CC:**  @kiwifb Snark @tscrim

**Keywords:** C++11 C++14 GCC 5 clang

**Branch/Commit:** [f498bffb5d0c8cc88acc005e4af8def82c18237b](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)

**Reviewer:** Travis Scrimshaw

**Author:** Fran√ßois Bissey

Issue created by migration from https://trac.sagemath.org/ticket/12437





---

archive/attachments_016709.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "lcalc-defaults.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12437/lcalc-defaults.patch",
    "created_at": "2012-02-04T18:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/ohanar"
}
```



---

archive/issue_comments_139168.json:
```json
{
    "body": "for review purposes",
    "created_at": "2012-02-04T18:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139168",
    "user": "https://github.com/ohanar"
}
```

for review purposes



---

archive/issue_events_102107.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-02-04T18:57:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102107"
}
```



---

archive/issue_comments_139169.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n c++ compilers that are pickier than g++ will not allow this.\n \n-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n+I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n``````\n",
    "created_at": "2012-02-04T18:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139169",
    "user": "https://github.com/ohanar"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 c++ compilers that are pickier than g++ will not allow this.
 
-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-.spkg). (This is a review spkg in case there are more issues with clang down the road.)
+I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
``````




---

archive/issue_comments_139170.json:
```json
{
    "body": "**Dependencies:** #12681",
    "created_at": "2012-03-22T12:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139170",
    "user": "https://github.com/nexttime"
}
```

**Dependencies:** #12681



---

archive/issue_events_102108.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-03-22T12:32:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102108"
}
```



---

archive/issue_events_102109.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2012-03-22T12:32:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102109"
}
```



---

archive/issue_comments_139171.json:
```json
{
    "body": "<a id='comment:3'></a>\nWe now need a new spkg (based on that of #12681) incorporating this patch.\n\nWe also should report this upstream.\n\nPatch so far looks good (not sure whether I've seen all of it -- maybe trac truncated it); seems like most functions (also) had the default values in their *declarations*.",
    "created_at": "2012-03-22T12:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139171",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>
We now need a new spkg (based on that of #12681) incorporating this patch.

We also should report this upstream.

Patch so far looks good (not sure whether I've seen all of it -- maybe trac truncated it); seems like most functions (also) had the default values in their *declarations*.



---

archive/issue_comments_139172.json:
```json
{
    "body": "**Work_Issues:** Create a new spkg.",
    "created_at": "2012-03-22T12:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139172",
    "user": "https://github.com/nexttime"
}
```

**Work_Issues:** Create a new spkg.



---

archive/issue_events_102110.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102110"
}
```



---

archive/issue_events_102111.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102111"
}
```



---

archive/issue_events_102112.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102112"
}
```



---

archive/issue_events_102113.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102113"
}
```



---

archive/issue_events_102114.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-02-04T08:00:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "component: build",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102114"
}
```



---

archive/issue_events_102115.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2014-02-04T08:00:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "component: packages: standard",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102115"
}
```



---

archive/issue_comments_139173.json:
```json
{
    "body": "<a id='comment:8'></a>\nGCC 4.9 now also requires `-fpermissive` to build Lcalc as well as the Cython extension modules that use Lcalc's headers, unless we fix Lcalc.",
    "created_at": "2014-04-21T10:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139173",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
GCC 4.9 now also requires `-fpermissive` to build Lcalc as well as the Cython extension modules that use Lcalc's headers, unless we fix Lcalc.



---

archive/issue_comments_139174.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'll check [later<sup>TM</sup>] whether Andrew's patch still applies (and whether it is sufficient for GCC 4.9 at least).",
    "created_at": "2014-04-21T10:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139174",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:9'></a>
I'll check [later<sup>TM</sup>] whether Andrew's patch still applies (and whether it is sufficient for GCC 4.9 at least).



---

archive/issue_comments_139175.json:
```json
{
    "body": "<a id='comment:10'></a>\nHmmm, haven't tested Andrew's patch [yet], but tried by myself.\n\nFor GCC 4.9, apparently the following tiny patch is sufficient to build Lcalc and the Sage library extension module (which currently lacks a `depends` btw.<sup>*</sup>):\n\n```diff\ndiff -Naur lcalc-1.23-vanilla/include/Ldirichlet_series.h lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h\n--- lcalc-1.23-vanilla/include/Ldirichlet_series.h\t2012-08-08 23:21:55.000000000 +0200\n+++ lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h\t2014-04-21 14:37:59.027464849 +0200\n@@ -43,7 +43,7 @@\n  //XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\n template <class ttype>\n Complex L_function <ttype>::\n-dirichlet_series(Complex s, long long N=-1)\n+dirichlet_series(Complex s, long long N)\n {\n     Complex z=0.;\n     long long m,n;\ndiff -Naur lcalc-1.23-vanilla/include/L.h lcalc-1.23-fixed-gcc.4.9/include/L.h\n--- lcalc-1.23-vanilla/include/L.h\t2012-08-08 23:21:55.000000000 +0200\n+++ lcalc-1.23-fixed-gcc.4.9/include/L.h\t2014-04-21 14:32:04.003467348 +0200\n@@ -491,7 +491,7 @@\n \n     //#include \"Ldirichlet_series.h\" //for computing Dirichlet series\n     Complex partial_dirichlet_series(Complex s, long long N1, long long N2);\n-    Complex dirichlet_series(Complex s, long long N);\n+    Complex dirichlet_series(Complex s, long long N=-1LL);\n \n     //#include \"Ltaylor_series.h\" //for computing taylor series for Dirichlet series\n     //void compute_taylor_series(int N, int K, Complex s_0, Complex *series);\n```\n(In addition to the patches to Lcalc we already have in Sage, of which only a trivial one is needed to build Lcalc outside of Sage.)\n\n\n---\n\n<sup>*</sup>\n\n```diff\ndiff --git a/src/module_list.py b/src/module_list.py\nindex fa460be..b5449be 100755\n--- a/src/module_list.py\n+++ b/src/module_list.py\n@@ -700,10 +700,12 @@ ext_modules = [\n \n     Extension('sage.libs.lcalc.lcalc_Lfunction',\n               sources = ['sage/libs/lcalc/lcalc_Lfunction.pyx'],\n-              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',\n+              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',         # XXX Are all of these really needed? (NTL??)\n                            'Lfunction'],\n               include_dirs = [SAGE_INC + \"/libLfunction\"],\n-              extra_compile_args=[\"-O3\", \"-ffast-math\"],\n+              depends = [ os.path.join(SAGE_INC, \"libLfunction\", header)\n+                          for header in [\"L.h\"] ],                     # maybe more headers from there\n+              extra_compile_args=[\"-O3\", \"-ffast-math\"],               # probably add '-Wno-deprecated', as of Lcalc 1.23\n               language = 'c++'),\n \n \n```\n\n(And, despite having `language=\"c++\"`, the extension module is *compiled* with the C compiler, not the C++ compiler, such that -- besides other effects -- `CXXFLAGS` aren't used.  It gets *linked* with `g++` though.)",
    "created_at": "2014-04-21T13:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139175",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:10'></a>
Hmmm, haven't tested Andrew's patch [yet], but tried by myself.

For GCC 4.9, apparently the following tiny patch is sufficient to build Lcalc and the Sage library extension module (which currently lacks a `depends` btw.<sup>*</sup>):

```diff
diff -Naur lcalc-1.23-vanilla/include/Ldirichlet_series.h lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h
--- lcalc-1.23-vanilla/include/Ldirichlet_series.h	2012-08-08 23:21:55.000000000 +0200
+++ lcalc-1.23-fixed-gcc.4.9/include/Ldirichlet_series.h	2014-04-21 14:37:59.027464849 +0200
@@ -43,7 +43,7 @@
  //XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
 template <class ttype>
 Complex L_function <ttype>::
-dirichlet_series(Complex s, long long N=-1)
+dirichlet_series(Complex s, long long N)
 {
     Complex z=0.;
     long long m,n;
diff -Naur lcalc-1.23-vanilla/include/L.h lcalc-1.23-fixed-gcc.4.9/include/L.h
--- lcalc-1.23-vanilla/include/L.h	2012-08-08 23:21:55.000000000 +0200
+++ lcalc-1.23-fixed-gcc.4.9/include/L.h	2014-04-21 14:32:04.003467348 +0200
@@ -491,7 +491,7 @@
 
     //#include "Ldirichlet_series.h" //for computing Dirichlet series
     Complex partial_dirichlet_series(Complex s, long long N1, long long N2);
-    Complex dirichlet_series(Complex s, long long N);
+    Complex dirichlet_series(Complex s, long long N=-1LL);
 
     //#include "Ltaylor_series.h" //for computing taylor series for Dirichlet series
     //void compute_taylor_series(int N, int K, Complex s_0, Complex *series);
```
(In addition to the patches to Lcalc we already have in Sage, of which only a trivial one is needed to build Lcalc outside of Sage.)


---

<sup>*</sup>

```diff
diff --git a/src/module_list.py b/src/module_list.py
index fa460be..b5449be 100755
--- a/src/module_list.py
+++ b/src/module_list.py
@@ -700,10 +700,12 @@ ext_modules = [
 
     Extension('sage.libs.lcalc.lcalc_Lfunction',
               sources = ['sage/libs/lcalc/lcalc_Lfunction.pyx'],
-              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',
+              libraries = ['m', 'ntl', 'mpfr', 'gmp', 'gmpxx',         # XXX Are all of these really needed? (NTL??)
                            'Lfunction'],
               include_dirs = [SAGE_INC + "/libLfunction"],
-              extra_compile_args=["-O3", "-ffast-math"],
+              depends = [ os.path.join(SAGE_INC, "libLfunction", header)
+                          for header in ["L.h"] ],                     # maybe more headers from there
+              extra_compile_args=["-O3", "-ffast-math"],               # probably add '-Wno-deprecated', as of Lcalc 1.23
               language = 'c++'),
 
 
```

(And, despite having `language="c++"`, the extension module is *compiled* with the C compiler, not the C++ compiler, such that -- besides other effects -- `CXXFLAGS` aren't used.  It gets *linked* with `g++` though.)



---

archive/issue_comments_139176.json:
```json
{
    "body": "<a id='comment:11'></a>\nYour patch looks like a subset of mine. I can't remember why I did all the things that I did in my patch, but I would guess that I needed them to compile with clang. It may be that gcc 4.9 is still too permissive in this case.",
    "created_at": "2014-04-21T18:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139176",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:11'></a>
Your patch looks like a subset of mine. I can't remember why I did all the things that I did in my patch, but I would guess that I needed them to compile with clang. It may be that gcc 4.9 is still too permissive in this case.



---

archive/issue_comments_139177.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [ohanar](#comment%3A11):\n> Your patch looks like a subset of mine.\n\n\nYes.  My primary goal was to make Lcalc work with GCC; I'll take a closer look at other changes later.\n\nAdding `void` to the `friend` declaration of `reset()` is certainly correct (although slightly unrelated to what the *name of the patch* suggests, on the broader topic of *this* ticket, namely making Lcalc's code build with `clang`).\n\nIn the other hunks, you just removed default parameters from *definitions*, but did not move them to corresponding *declarations* (probably because there aren't any, which is something I'll have to check).  But from at least one comment, it looks like those parts were \"dead\" code anyway.",
    "created_at": "2014-04-21T23:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139177",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>
Replying to [ohanar](#comment%3A11):
> Your patch looks like a subset of mine.


Yes.  My primary goal was to make Lcalc work with GCC; I'll take a closer look at other changes later.

Adding `void` to the `friend` declaration of `reset()` is certainly correct (although slightly unrelated to what the *name of the patch* suggests, on the broader topic of *this* ticket, namely making Lcalc's code build with `clang`).

In the other hunks, you just removed default parameters from *definitions*, but did not move them to corresponding *declarations* (probably because there aren't any, which is something I'll have to check).  But from at least one comment, it looks like those parts were "dead" code anyway.



---

archive/issue_events_102116.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102116"
}
```



---

archive/issue_events_102117.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102117"
}
```



---

archive/issue_comments_139178.json:
```json
{
    "body": "<a id='comment:15'></a>\nOk, so I've now created 7 new patches to fix all remaining clang/non-GNU/C++11 issues with Lcalc (except for some deprecation warnings):\n\n```\nMakefile_2-dont_compile_C_with_CXXFLAGS.patch\nlcalc-1.23-fix_VLA_1.patch\nlcalc-1.23-fix_VLA_2.patch\nlcalc-1.23-fix_control_reaches_end_of_non-void_fn.patch\nlcalc-1.23-fix_typeof.patch\nlcalc-1.23-missing_return_type.patch\nlcalc-1.23_default_parameters_2.patch\n```\n\nBut I'd prefer to put them on a single ticket, i.e., to either open a new one, or repurpose one of the two existing ones.  (But before doing so, I'll anyway polish them a bit, and probably merge some of them into another or into one of the existing ones.)\n\nI did take a slightly different approach to variable-length arrays; instead of using `std::vector<>`, I'm using `foo_t *_foo = new foo_t[dim1*dim2*dim3]`, along with a macro `foo(i,j,k)` which maps the indices to a single one, and of course added `delete [] _foo` where necessary.\n\nSo far tested with GCC 4.4, 4.8 and 4.9, clang 3.4.1, and a couple of `-std=...` variations.",
    "created_at": "2014-05-19T01:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139178",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Ok, so I've now created 7 new patches to fix all remaining clang/non-GNU/C++11 issues with Lcalc (except for some deprecation warnings):

```
Makefile_2-dont_compile_C_with_CXXFLAGS.patch
lcalc-1.23-fix_VLA_1.patch
lcalc-1.23-fix_VLA_2.patch
lcalc-1.23-fix_control_reaches_end_of_non-void_fn.patch
lcalc-1.23-fix_typeof.patch
lcalc-1.23-missing_return_type.patch
lcalc-1.23_default_parameters_2.patch
```

But I'd prefer to put them on a single ticket, i.e., to either open a new one, or repurpose one of the two existing ones.  (But before doing so, I'll anyway polish them a bit, and probably merge some of them into another or into one of the existing ones.)

I did take a slightly different approach to variable-length arrays; instead of using `std::vector<>`, I'm using `foo_t *_foo = new foo_t[dim1*dim2*dim3]`, along with a macro `foo(i,j,k)` which maps the indices to a single one, and of course added `delete [] _foo` where necessary.

So far tested with GCC 4.4, 4.8 and 4.9, clang 3.4.1, and a couple of `-std=...` variations.



---

archive/issue_comments_139179.json:
```json
{
    "body": "<a id='comment:16'></a>\nHi leif,\n\nthese are quite some patches. Do you plan to send them upstream?",
    "created_at": "2014-05-20T22:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139179",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:16'></a>
Hi leif,

these are quite some patches. Do you plan to send them upstream?



---

archive/issue_comments_139180.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [thansen](#comment%3A16):\n> Hi leif,\n> \n> these are quite some patches. Do you plan to send them upstream?\n\n\nWell, upstream... ;-)\n\nThe patches are pretty small, and I'll merge them into fewer I think, hopefully next weekend.\n\nPretty a while ago, *someone<sup>TM</sup>* wanted to create an autotools project for Michael, but that apparently never happened, so we keep heavily patching the existing Makefile.\n\nAFAIK, some previous patches (e.g. dealing with newer PARI versions) went upstream, i.e., Michael should at least be aware of them; I'll certainly send him the new / updated ones later.  Not sure whether he's interested in changes removing GNU extensions.  (Variable-length arrays can still be used depending on macros / the compiler though.)",
    "created_at": "2014-05-21T09:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139180",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:17'></a>
Replying to [thansen](#comment%3A16):
> Hi leif,
> 
> these are quite some patches. Do you plan to send them upstream?


Well, upstream... ;-)

The patches are pretty small, and I'll merge them into fewer I think, hopefully next weekend.

Pretty a while ago, *someone<sup>TM</sup>* wanted to create an autotools project for Michael, but that apparently never happened, so we keep heavily patching the existing Makefile.

AFAIK, some previous patches (e.g. dealing with newer PARI versions) went upstream, i.e., Michael should at least be aware of them; I'll certainly send him the new / updated ones later.  Not sure whether he's interested in changes removing GNU extensions.  (Variable-length arrays can still be used depending on macros / the compiler though.)



---

archive/issue_comments_139181.json:
```json
{
    "body": "<a id='comment:18'></a>\nWell I hope upstreaming them works out. Sage is not the only downstream who needs these patches. There's at least Debian (where I'm maintaining the package) and Fedora. Having them upstream would make everyones live a lot easier.",
    "created_at": "2014-05-21T10:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139181",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:18'></a>
Well I hope upstreaming them works out. Sage is not the only downstream who needs these patches. There's at least Debian (where I'm maintaining the package) and Fedora. Having them upstream would make everyones live a lot easier.



---

archive/issue_events_102118.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102118"
}
```



---

archive/issue_events_102119.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102119"
}
```



---

archive/issue_comments_139182.json:
```json
{
    "body": "<a id='comment:20'></a>\nI'm also interested in the issue. What is the status of the patches? Did upstream answer?",
    "created_at": "2015-02-18T19:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139182",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:20'></a>
I'm also interested in the issue. What is the status of the patches? Did upstream answer?



---

archive/issue_comments_139183.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n c++ compilers that are pickier than g++ will not allow this.\n \n+GCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n+ \n+---\n+\n+(Meanwhile historical note from Andrew:)\n+\n I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n+\n``````\n",
    "created_at": "2015-04-22T01:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139183",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
 c++ compilers that are pickier than g++ will not allow this.
 
+GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
+ 
+---
+
+(Meanwhile historical note from Andrew:)
+
 I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
+
``````




---

archive/issue_comments_139184.json:
```json
{
    "body": "**Changing work_issues** from \"Create a new spkg.\" to \"Locate patches and upload them... ;-)\".",
    "created_at": "2015-04-22T01:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139184",
    "user": "https://github.com/nexttime"
}
```

**Changing work_issues** from "Create a new spkg." to "Locate patches and upload them... ;-)".



---

archive/issue_comments_139185.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"C++11 C++14 GCC 5 clang\".",
    "created_at": "2015-04-22T01:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139185",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "" to "C++11 C++14 GCC 5 clang".



---

archive/issue_events_102120.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-22T01:54:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102120"
}
```



---

archive/issue_events_102121.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-04-22T01:54:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102121"
}
```



---

archive/issue_comments_139186.json:
```json
{
    "body": "<a id='comment:21'></a>\nGCC 5.x now also needs a small subset of the fixes for clang (or `-fpermissive`; then also a couple of Sage extension modules which include Lcalc headers have to get built with `-fpermissive`, in `CFLAGS`(!)).  (cf. ticket description)\n\nI'll probably deal with that on another ticket.",
    "created_at": "2015-04-22T01:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139186",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
GCC 5.x now also needs a small subset of the fixes for clang (or `-fpermissive`; then also a couple of Sage extension modules which include Lcalc headers have to get built with `-fpermissive`, in `CFLAGS`(!)).  (cf. ticket description)

I'll probably deal with that on another ticket.



---

archive/issue_comments_139187.json:
```json
{
    "body": "<a id='comment:22'></a>\nThe `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?",
    "created_at": "2015-04-22T01:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139187",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?



---

archive/issue_comments_139188.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [fbissey](#comment%3A22):\n> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?\n\n\nSure, trivial for `g++` at least.\n\nWe of course could also add `-fpermissive` in Lcalc's `spkg-install`, but I rather meant\n\n```sh\nenv CXXFLAGS=\"-fpermissive\" ./sage -f lcalc\nenv CFLAGS=\"-fpermissive\" ./sage -b\n```\nto temporarily work around the errors when building Sage (with GCC 5.x).\n\nI had two other issues (with gf2x and ncurses) which hopefully vanish tomorrow [i.e., later today down under] when the final 5.1 (or 5.0.1?) gets released.",
    "created_at": "2015-04-22T02:11:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139188",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:23'></a>
Replying to [fbissey](#comment%3A22):
> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?


Sure, trivial for `g++` at least.

We of course could also add `-fpermissive` in Lcalc's `spkg-install`, but I rather meant

```sh
env CXXFLAGS="-fpermissive" ./sage -f lcalc
env CFLAGS="-fpermissive" ./sage -b
```
to temporarily work around the errors when building Sage (with GCC 5.x).

I had two other issues (with gf2x and ncurses) which hopefully vanish tomorrow [i.e., later today down under] when the final 5.1 (or 5.0.1?) gets released.



---

archive/issue_comments_139189.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [fbissey](#comment%3A22):\n> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?\n\n\nI probably misunderstood you; the (GCC 5.x/default parameters) patch is the same for Lcalc and the headers the Sage library uses (i.e., Lcalc uses the same so the errors are exactly the same, one patch for both issues).",
    "created_at": "2015-04-22T02:23:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139189",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
Replying to [fbissey](#comment%3A22):
> The `-fpermissive` bit could live in `module_list.py` with the appropriate sage extensions. But can the headers be fixed?


I probably misunderstood you; the (GCC 5.x/default parameters) patch is the same for Lcalc and the headers the Sage library uses (i.e., Lcalc uses the same so the errors are exactly the same, one patch for both issues).



---

archive/issue_comments_139190.json:
```json
{
    "body": "<a id='comment:25'></a>\nI think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,",
    "created_at": "2015-04-22T02:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139190",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
I think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,



---

archive/issue_comments_139191.json:
```json
{
    "body": "<a id='comment:26'></a>\nThis looks like the second default parameters patch I mentioned:\n\n```diff\n--- lcalc-1.23/include/Lgamma.h\t2012-08-08 23:21:55.000000000 +0200\n+++ lcalc-1.23/include/Lgamma.h\t2014-05-18 21:15:27.786889718 +0200\n@@ -77,7 +77,7 @@\n //n=0 should just give log_GAMMA(z)... thus making log_GAMMA\n //code obsolete. But leave log_GAMMA intact anyways.\n template <class ttype>\n-precise(ttype) log_GAMMA (ttype z,int n=0)\n+precise(ttype) log_GAMMA (ttype z,int n)\n {\n     int M;\n     precise(ttype) log_G,r,r2,y;\n@@ -230,7 +230,7 @@\n //value exp_w which holds exp(-w)\n //computes G(z,w), so there's an extra w^(-z) factor.\n template <class ttype>\n-Complex inc_GAMMA (ttype z,ttype w, const char *method=\"temme\", ttype exp_w = 0, bool recycle=false)\n+Complex inc_GAMMA (ttype z,ttype w, const char *method, ttype exp_w, bool recycle)\n {\n \n     Complex G;\n@@ -334,7 +334,7 @@\n \n \n template <class ttype>\n-ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w=0, bool recycle=false)  //computes G(z,w) via continued fraction\n+ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via continued fraction\n {\n \n         ttype G;\n@@ -424,7 +424,7 @@\n }\n \n template <class ttype>\n-ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w = 0, bool recycle=false)  //computes G(z,w) via asymptotic series\n+ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via asymptotic series\n {\n \n         if(my_verbose>3) cout << \"called asympt_GAMMA(\"<<z<<\",\"<<w<<\")\"<< endl;\n@@ -446,7 +446,7 @@\n \n \n template <class ttype>\n-ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w = 0, bool recycle=false)  //computes g(z,w)\n+ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w, bool recycle)  //computes g(z,w)\n {\n \n     ttype g;\n@@ -604,7 +604,7 @@\n }\n \n template <class ttype>\n-Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta=1, const char *method=\"temme\")\n+Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta, const char *method)\n {\n     Complex SUM=0;\n \n```\n(Not yet checked whether it's complete/sufficient; the GCC 5.0.1 release candidate is on another machine.)",
    "created_at": "2015-04-22T02:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139191",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>
This looks like the second default parameters patch I mentioned:

```diff
--- lcalc-1.23/include/Lgamma.h	2012-08-08 23:21:55.000000000 +0200
+++ lcalc-1.23/include/Lgamma.h	2014-05-18 21:15:27.786889718 +0200
@@ -77,7 +77,7 @@
 //n=0 should just give log_GAMMA(z)... thus making log_GAMMA
 //code obsolete. But leave log_GAMMA intact anyways.
 template <class ttype>
-precise(ttype) log_GAMMA (ttype z,int n=0)
+precise(ttype) log_GAMMA (ttype z,int n)
 {
     int M;
     precise(ttype) log_G,r,r2,y;
@@ -230,7 +230,7 @@
 //value exp_w which holds exp(-w)
 //computes G(z,w), so there's an extra w^(-z) factor.
 template <class ttype>
-Complex inc_GAMMA (ttype z,ttype w, const char *method="temme", ttype exp_w = 0, bool recycle=false)
+Complex inc_GAMMA (ttype z,ttype w, const char *method, ttype exp_w, bool recycle)
 {
 
     Complex G;
@@ -334,7 +334,7 @@
 
 
 template <class ttype>
-ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w=0, bool recycle=false)  //computes G(z,w) via continued fraction
+ttype cfrac_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via continued fraction
 {
 
         ttype G;
@@ -424,7 +424,7 @@
 }
 
 template <class ttype>
-ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w = 0, bool recycle=false)  //computes G(z,w) via asymptotic series
+ttype asympt_GAMMA (ttype z,ttype w, ttype exp_w, bool recycle)  //computes G(z,w) via asymptotic series
 {
 
         if(my_verbose>3) cout << "called asympt_GAMMA("<<z<<","<<w<<")"<< endl;
@@ -446,7 +446,7 @@
 
 
 template <class ttype>
-ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w = 0, bool recycle=false)  //computes g(z,w)
+ttype comp_inc_GAMMA (ttype z,ttype w,ttype exp_w, bool recycle)  //computes g(z,w)
 {
 
     ttype g;
@@ -604,7 +604,7 @@
 }
 
 template <class ttype>
-Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta=1, const char *method="temme")
+Complex gamma_sum(Complex s, int what_type, ttype *coeff, int N, Double g, Complex l, Double Q, Long Period, Complex delta, const char *method)
 {
     Complex SUM=0;
 
```
(Not yet checked whether it's complete/sufficient; the GCC 5.0.1 release candidate is on another machine.)



---

archive/issue_comments_139192.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [fbissey](#comment%3A25):\n> I think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,\n\n\nI was surprised building the first RC went smooth (on a pretty \"clean\" machine though); this time no cloog/PPL/ISL version hazards or the like... (`make clean` still bails out though IIRC.)\n\nW.r.t. the versioning:  5.1 in the subject, 5.0.1 in the message body; RC1 tarball called 5.1.0-, identifies as 5.0.1 (prerelease)...  B)",
    "created_at": "2015-04-22T02:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139192",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:27'></a>
Replying to [fbissey](#comment%3A25):
> I think I had misunderstood your description. Final release of gcc will be `5.1`. `X.0.x` are now pre-release. In effect betas and release candidates. Was a pain in the ass to build `5.0.1_rc` on my cluster, there is regression in the build system, using `--with-gmp=` and friends can bring system headers that you don't want in phase 2 and 3. Happened in the past and been fixed and now it's back,


I was surprised building the first RC went smooth (on a pretty "clean" machine though); this time no cloog/PPL/ISL version hazards or the like... (`make clean` still bails out though IIRC.)

W.r.t. the versioning:  5.1 in the subject, 5.0.1 in the message body; RC1 tarball called 5.1.0-, identifies as 5.0.1 (prerelease)...  B)



---

archive/issue_comments_139193.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe [lcalc-1.23_default_parameters_2.patch](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/lcalc/patches/lcalc-1.23_default_parameters_2.patch?id=e8b148686cf17804be7354723401bdd84c0a49aa) is now [there](http://trac.sagemath.org/ticket/18316), and sufficient for GCC 5.x (needs review).",
    "created_at": "2015-04-27T18:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139193",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:28'></a>
The [lcalc-1.23_default_parameters_2.patch](https://github.com/sagemath/sagetrac-mirror/blob/develop/build/pkgs/lcalc/patches/lcalc-1.23_default_parameters_2.patch?id=e8b148686cf17804be7354723401bdd84c0a49aa) is now [there](http://trac.sagemath.org/ticket/18316), and sufficient for GCC 5.x (needs review).



---

archive/issue_comments_139194.json:
```json
{
    "body": "**Changing dependencies** from \"#12681\" to \"#12681, #18316\".",
    "created_at": "2015-04-27T18:09:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139194",
    "user": "https://github.com/nexttime"
}
```

**Changing dependencies** from "#12681" to "#12681, #18316".



---

archive/issue_comments_139195.json:
```json
{
    "body": "<a id='comment:29'></a>\nCan this be closed as duplicate of #18316?",
    "created_at": "2015-05-19T12:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139195",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>
Can this be closed as duplicate of #18316?



---

archive/issue_comments_139196.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [jdemeyer](#comment%3A29):\n> Can this be closed as duplicate of #18316?\n\n\nNope, we just need a good new title (as the other issues with `clang` / C++, cf. [the comment above](#comment%3A15)) have been discussed here as well...  (There's also #12436, but this one is probably a bit fresher.)",
    "created_at": "2015-05-19T13:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139196",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:30'></a>
Replying to [jdemeyer](#comment%3A29):
> Can this be closed as duplicate of #18316?


Nope, we just need a good new title (as the other issues with `clang` / C++, cf. [the comment above](#comment%3A15)) have been discussed here as well...  (There's also #12436, but this one is probably a bit fresher.)



---

archive/issue_events_102122.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2015-05-19T13:51:57Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "rename": {
        "from": "lcalc defines default values for functions outside of declarations",
        "to": "Fix remaining C++ issues of Lcalc (also to let it build with clang)"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102122"
}
```



---

archive/issue_comments_139197.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-c++ compilers that are pickier than g++ will not allow this.\n+Lcalc still uses some non-standard \"features\" of `g++`.\n+\n+C++ compilers that are pickier than `g++` will not allow this.\n \n GCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n  \n``````\n",
    "created_at": "2015-05-19T13:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139197",
    "user": "https://github.com/nexttime"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-c++ compilers that are pickier than g++ will not allow this.
+Lcalc still uses some non-standard "features" of `g++`.
+
+C++ compilers that are pickier than `g++` will not allow this.
 
 GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
  
``````




---

archive/issue_comments_139198.json:
```json
{
    "body": "<a id='comment:32'></a>\nP.S.:\n\nI also have to retest my patches with more recent versions of `clang` and `g++`.",
    "created_at": "2015-05-19T14:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139198",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:32'></a>
P.S.:

I also have to retest my patches with more recent versions of `clang` and `g++`.



---

archive/issue_comments_139199.json:
```json
{
    "body": "<a id='comment:33'></a>\nLeif, can you put the remaining stuff in a branch to test? And I would say close #12436 as a duplicate.",
    "created_at": "2016-09-17T07:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139199",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:33'></a>
Leif, can you put the remaining stuff in a branch to test? And I would say close #12436 as a duplicate.



---

archive/issue_comments_139200.json:
```json
{
    "body": "**Commit:** [8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)",
    "created_at": "2016-09-18T21:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139200",
    "user": "https://github.com/kiwifb"
}
```

**Commit:** [8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)



---

archive/issue_comments_139201.json:
```json
{
    "body": "**Branch:** [u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)",
    "created_at": "2016-09-18T21:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139201",
    "user": "https://github.com/kiwifb"
}
```

**Branch:** [u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)



---

archive/issue_comments_139202.json:
```json
{
    "body": "<a id='comment:34'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf\">8a9fe64</a></td><td><code>Remove use of internal header- cmath should be sufficient. Fix declaration.</code></td></tr></table>\n",
    "created_at": "2016-09-18T21:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139202",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf">8a9fe64</a></td><td><code>Remove use of internal header- cmath should be sufficient. Fix declaration.</code></td></tr></table>




---

archive/issue_events_102123.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-18T21:40:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-6.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102123"
}
```



---

archive/issue_events_102124.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-18T21:40:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102124"
}
```



---

archive/issue_comments_139203.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,3 +10,6 @@\n \n I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n \n+---\n+Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.\n+\n``````\n",
    "created_at": "2016-09-18T21:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139203",
    "user": "https://github.com/kiwifb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,3 +10,6 @@
 
 I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
 
+---
+Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.
+
``````




---

archive/issue_comments_139204.json:
```json
{
    "body": "**Author:** Fran\u00e7ois Bissey",
    "created_at": "2016-09-18T21:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139204",
    "user": "https://github.com/kiwifb"
}
```

**Author:** Fran√ßois Bissey



---

archive/issue_comments_139205.json:
```json
{
    "body": "<a id='comment:35'></a>\nNext issue\n\n```\n[lcalc-1.23.p14] clang++ -O3   -ffast-math -fPIC   -I../include -c Lriemannsiegel.cc\n[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:\n[lcalc-1.23.p14] In file included from ../include/L.h:539:\n[lcalc-1.23.p14] ../include/Ldokchitser.h:72:14: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]     Complex m[N+1];\n[lcalc-1.23.p14]              ^\n[lcalc-1.23.p14] ../include/Ldokchitser.h:81:23: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]         Complex sum_log_Gamma[N+1][MYDIGITS+1];\n[lcalc-1.23.p14]                              ^\n[lcalc-1.23.p14] ../include/Ldokchitser.h:106:27: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]         Complex exp_sum_log_Gamma[N+1][MYDIGITS+1][MYDIGITS+1]; // symmetric functions\n[lcalc-1.23.p14]                                  ^\n[lcalc-1.23.p14] ../include/Ldokchitser.h:107:15: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]         Complex gamma[N+1][MYDIGITS+1]; // gamma(s+m[j]) for j = 1 to N\n[lcalc-1.23.p14]                      ^\n[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:\n[lcalc-1.23.p14] In file included from ../include/L.h:542:\n[lcalc-1.23.p14] ../include/Lexplicit_formula.h:28:12: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')\n[lcalc-1.23.p14]   Complex b[num_coeffs+1];\n[lcalc-1.23.p14]            ^\n[lcalc-1.23.p14] 5 errors generated.\n```",
    "created_at": "2016-09-18T21:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139205",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:35'></a>
Next issue

```
[lcalc-1.23.p14] clang++ -O3   -ffast-math -fPIC   -I../include -c Lriemannsiegel.cc
[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:
[lcalc-1.23.p14] In file included from ../include/L.h:539:
[lcalc-1.23.p14] ../include/Ldokchitser.h:72:14: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]     Complex m[N+1];
[lcalc-1.23.p14]              ^
[lcalc-1.23.p14] ../include/Ldokchitser.h:81:23: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]         Complex sum_log_Gamma[N+1][MYDIGITS+1];
[lcalc-1.23.p14]                              ^
[lcalc-1.23.p14] ../include/Ldokchitser.h:106:27: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]         Complex exp_sum_log_Gamma[N+1][MYDIGITS+1][MYDIGITS+1]; // symmetric functions
[lcalc-1.23.p14]                                  ^
[lcalc-1.23.p14] ../include/Ldokchitser.h:107:15: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]         Complex gamma[N+1][MYDIGITS+1]; // gamma(s+m[j]) for j = 1 to N
[lcalc-1.23.p14]                      ^
[lcalc-1.23.p14] In file included from Lriemannsiegel.cc:24:
[lcalc-1.23.p14] In file included from ../include/L.h:542:
[lcalc-1.23.p14] ../include/Lexplicit_formula.h:28:12: error: variable length array of non-POD element type 'Complex' (aka 'complex<double>')
[lcalc-1.23.p14]   Complex b[num_coeffs+1];
[lcalc-1.23.p14]            ^
[lcalc-1.23.p14] 5 errors generated.
```



---

archive/issue_comments_139206.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,11 +5,5 @@\n GCC 5.x again got stricter and now also needs the second \"default parameter\" patch (or once again `-fpermissive`) mentioned below.\n  \n ---\n-\n-(Meanwhile historical note from Andrew:)\n-\n-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)\n-\n----\n Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.\n \n``````\n",
    "created_at": "2016-09-19T15:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139206",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,11 +5,5 @@
 GCC 5.x again got stricter and now also needs the second "default parameter" patch (or once again `-fpermissive`) mentioned below.
  
 ---
-
-(Meanwhile historical note from Andrew:)
-
-I've posted an spkg that fixes this (and #12435, #12436) at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/lcalc-1.23.p10.spkg). (This is a review spkg in case there are more issues with clang down the road.)
-
----
 Current branch fix usage of internal headers and some declarations. More to be done as I haven't even scratched the issues mentioned in this ticket - unless they have been fixed by another merged ticket.
 
``````




---

archive/issue_comments_139207.json:
```json
{
    "body": "**Changing dependencies** from \"#12681, #18316\" to \"\".",
    "created_at": "2016-09-19T15:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139207",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#12681, #18316" to "".



---

archive/issue_comments_139208.json:
```json
{
    "body": "<a id='comment:39'></a>\nThe issue I hit now with this is pretty much the VLA. I am guessing I can get the first VLA patch from #12436 but not the second one. \n\n@nexttime do you still have those patches and can you share them?",
    "created_at": "2016-09-29T21:50:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139208",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:39'></a>
The issue I hit now with this is pretty much the VLA. I am guessing I can get the first VLA patch from #12436 but not the second one. 

@nexttime do you still have those patches and can you share them?



---

archive/issue_comments_139209.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b\">f498bff</a></td><td><code>Adapt old patch from Andrew Ohana for VLA in C++</code></td></tr></table>\n",
    "created_at": "2016-09-30T00:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139209",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b">f498bff</a></td><td><code>Adapt old patch from Andrew Ohana for VLA in C++</code></td></tr></table>




---

archive/issue_comments_139210.json:
```json
{
    "body": "**Changing commit** from \"[8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)\" to \"[f498bffb5d0c8cc88acc005e4af8def82c18237b](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)\".",
    "created_at": "2016-09-30T00:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf](https://github.com/sagemath/sagetrac-mirror/commit/8a9fe644d0cd9b5827ddcd0acf2b01d1816b48bf)" to "[f498bffb5d0c8cc88acc005e4af8def82c18237b](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)".



---

archive/issue_events_102125.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102125"
}
```



---

archive/issue_events_102126.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102126"
}
```



---

archive/issue_events_102127.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102127"
}
```



---

archive/issue_events_102128.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2016-09-30T00:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102128"
}
```



---

archive/issue_comments_139211.json:
```json
{
    "body": "<a id='comment:41'></a>\nActually doing the VLA like Andrew did initially in #12436 is good enough. And while we have warnings for all the other stuff mentioned in this tickets it all compiled successfully with clang (latest on Sierra, based on 3.8).",
    "created_at": "2016-09-30T00:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139211",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:41'></a>
Actually doing the VLA like Andrew did initially in #12436 is good enough. And while we have warnings for all the other stuff mentioned in this tickets it all compiled successfully with clang (latest on Sierra, based on 3.8).



---

archive/issue_comments_139212.json:
```json
{
    "body": "<a id='comment:42'></a>\nI'm hesitant about the changes of the form:\n\n```diff\n+diff --git a/include/Ldokchitser.h b/include/Ldokchitser.h\n+index c67f01a..7b3e5c9 100644\n+--- a/include/Ldokchitser.h\n++++ b/include/Ldokchitser.h\n+@@ -69,7 +69,7 @@ phi_series(int precision)\n+     \n+     // compute the values m[j] for the respective lambda_k[j]\n+     \n+-    Complex m[N+1];\n++    std::vector<Complex> m(N+1);\n+     for (j=1;j<=N;j++)\n+     \tm[j] = -2*lambda_k[j] + 2;\n+ \t\n```\nbecause my understanding is g++ to treats `Complex m[N+1]` as `Complex *m = new Complex[N+1]`, which changing to `std::vector` could have an impact on performance. I haven't looked at the code itself, but my guess is that lcalc wanted to treat these as fixed length arrays whose size is determined at runtime.",
    "created_at": "2016-10-04T19:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139212",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>
I'm hesitant about the changes of the form:

```diff
+diff --git a/include/Ldokchitser.h b/include/Ldokchitser.h
+index c67f01a..7b3e5c9 100644
+--- a/include/Ldokchitser.h
++++ b/include/Ldokchitser.h
+@@ -69,7 +69,7 @@ phi_series(int precision)
+     
+     // compute the values m[j] for the respective lambda_k[j]
+     
+-    Complex m[N+1];
++    std::vector<Complex> m(N+1);
+     for (j=1;j<=N;j++)
+     	m[j] = -2*lambda_k[j] + 2;
+ 	
```
because my understanding is g++ to treats `Complex m[N+1]` as `Complex *m = new Complex[N+1]`, which changing to `std::vector` could have an impact on performance. I haven't looked at the code itself, but my guess is that lcalc wanted to treat these as fixed length arrays whose size is determined at runtime.



---

archive/issue_comments_139213.json:
```json
{
    "body": "<a id='comment:43'></a>\nCorrect, they are VLA. The replacement with `new` works very well for one dimensional arrays. Multidimensional ones are another story, I guess it would be similar with more ugly loops. It seems to me that the accepted behavior in C++ is to use vector for these (from stack overflow examples).\nThe mystery to me is that there are many more VLA in that particular code but only a few of them raise a flag. What gives?",
    "created_at": "2016-10-04T19:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139213",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:43'></a>
Correct, they are VLA. The replacement with `new` works very well for one dimensional arrays. Multidimensional ones are another story, I guess it would be similar with more ugly loops. It seems to me that the accepted behavior in C++ is to use vector for these (from stack overflow examples).
The mystery to me is that there are many more VLA in that particular code but only a few of them raise a flag. What gives?



---

archive/issue_comments_139214.json:
```json
{
    "body": "<a id='comment:44'></a>\nI can understand why `std::vector` would be a natural choice because you don't have to worry about memory management (specifically the deallocation). It just there is some slight overhead from using it rather than direct system calls with the array, but that is more likely a micro-optimization. Perhaps some of the others aren't raising warnings because their length can be determined at compile time?\n\nOne little change to a patch:\n\n```diff\n         std::vector<std::vector<std::vector<Complex> > > exp_sum_log_Gamma(N+1); // symmetric functions\n         std::vector<std::vector<Complex> > gamma(N+1); // gamma(s+m[j]) for j = 1 to N\n         for (j=1;j<=N;j++){\n             exp_sum_log_Gamma[j].resize(MYDIGITS+1);\n+            for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);\n             gamma[j].resize(MYDIGITS+1);\n         }\n-        for (j=1;j<=N;j++) for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);\n```\nas I think it is (slightly) more readable considering we are already working with the 3d array.",
    "created_at": "2016-10-04T19:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139214",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:44'></a>
I can understand why `std::vector` would be a natural choice because you don't have to worry about memory management (specifically the deallocation). It just there is some slight overhead from using it rather than direct system calls with the array, but that is more likely a micro-optimization. Perhaps some of the others aren't raising warnings because their length can be determined at compile time?

One little change to a patch:

```diff
         std::vector<std::vector<std::vector<Complex> > > exp_sum_log_Gamma(N+1); // symmetric functions
         std::vector<std::vector<Complex> > gamma(N+1); // gamma(s+m[j]) for j = 1 to N
         for (j=1;j<=N;j++){
             exp_sum_log_Gamma[j].resize(MYDIGITS+1);
+            for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);
             gamma[j].resize(MYDIGITS+1);
         }
-        for (j=1;j<=N;j++) for (n=0;n<=MYDIGITS;n++) exp_sum_log_Gamma[j][n].resize(MYDIGITS+1);
```
as I think it is (slightly) more readable considering we are already working with the 3d array.



---

archive/issue_comments_139215.json:
```json
{
    "body": "<a id='comment:45'></a>\nI wouldn't worry too much about optimization at this stage. The compiler does a better job than you'll ever do on that. The only thing the compiler cannot do is find a better algorithm (although it may be able able to re-order your loops in a way you wouldn't have thought of). \nFor the little change I copied the structure of the original patch which does that in separate stages. If you feel it is clearer your way, feel free to commit your change as a part of your review (I can do it myself if you insist).",
    "created_at": "2016-10-05T21:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139215",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:45'></a>
I wouldn't worry too much about optimization at this stage. The compiler does a better job than you'll ever do on that. The only thing the compiler cannot do is find a better algorithm (although it may be able able to re-order your loops in a way you wouldn't have thought of). 
For the little change I copied the structure of the original patch which does that in separate stages. If you feel it is clearer your way, feel free to commit your change as a part of your review (I can do it myself if you insist).



---

archive/issue_events_102129.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-10-05T21:28:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102129"
}
```



---

archive/issue_events_102130.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-10-05T21:28:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102130"
}
```



---

archive/issue_comments_139216.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2016-10-05T21:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139216",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_139217.json:
```json
{
    "body": "**Changing work_issues** from \"Locate patches and upload them... ;-)\" to \"\".",
    "created_at": "2016-10-05T21:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139217",
    "user": "https://github.com/tscrim"
}
```

**Changing work_issues** from "Locate patches and upload them... ;-)" to "".



---

archive/issue_comments_139218.json:
```json
{
    "body": "<a id='comment:46'></a>\nIt's in the realm of bikeshedding, so I'm sending this off to the buildbots.",
    "created_at": "2016-10-05T21:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139218",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>
It's in the realm of bikeshedding, so I'm sending this off to the buildbots.



---

archive/issue_events_102131.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-21T07:04:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102131"
}
```



---

archive/issue_events_102132.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-21T07:04:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12437#event-102132"
}
```



---

archive/issue_comments_139219.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)\" to \"[f498bffb5d0c8cc88acc005e4af8def82c18237b](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)\".",
    "created_at": "2016-10-21T07:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12437",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12437#issuecomment-139219",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/fbissey/lcalc_clang](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/lcalc_clang)" to "[f498bffb5d0c8cc88acc005e4af8def82c18237b](https://github.com/sagemath/sagetrac-mirror/commit/f498bffb5d0c8cc88acc005e4af8def82c18237b)".
