# Issue 12466: test whether a polynomial is cyclotomic

archive/issues_012294.json:
```json
{
    "body": "Given a polynomial with integer coefficients, test if it is cyclotomic or not:\n\n```\nsage: P.<x> = ZZ[x]\nsage: (x-1).is_cyclotomic()\nTrue\nsage: (x^2+1).is_cyclotomic()\nTrue\nsage: (x^3-x+1).is_cyclotomic()\nFalse\n```\n\nAssignee: @staroste\n\nCC:  @videlec alexghitza\n\nKeywords: Cernay2012\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\nAuthor: \u0160t\u011bp\u00e1n Starosta\n\nMerged: sage-5.9.beta4\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12466\n\n",
    "closed_at": "2013-04-06T14:50:24Z",
    "created_at": "2012-02-07T19:43:28Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "test whether a polynomial is cyclotomic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12466",
    "user": "https://github.com/staroste"
}
```
Given a polynomial with integer coefficients, test if it is cyclotomic or not:

```
sage: P.<x> = ZZ[x]
sage: (x-1).is_cyclotomic()
True
sage: (x^2+1).is_cyclotomic()
True
sage: (x^3-x+1).is_cyclotomic()
False
```

Assignee: @staroste

CC:  @videlec alexghitza

Keywords: Cernay2012

Reviewer: Frédéric Chapoton, Travis Scrimshaw

Author: Štěpán Starosta

Merged: sage-5.9.beta4

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12466





---

archive/issue_comments_153343.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-08T12:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153343",
    "user": "https://github.com/staroste"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_153344.json:
```json
{
    "body": "<a id='comment:2'></a>Hi Stepan,\n\nI had a quick look at you patch. I have two comment:\n- There is a proper syntax for reference and algorithm please see: http://www.sagemath.org/doc/developer/conventions.html#docstring-markup-with-rest-and-sphinx. I don't have the time to fix it myself.\n- More important, I think your code should go in a file which is not dependent on a particular implementation of polynomial. I think sage/rings/polynomial/polynomial_element.pyx is a good place. You'll find there methods such as (`squarefree_decomposition, is_square`). Maybe putting a function in `cyclotomic.pyx` and a frontend method in `polynomial_element`, that is having all cyclotomic algorithm in the same place, is a better solution.\n\nThanks for this nice work !\n\nFlorent",
    "created_at": "2012-02-11T11:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153344",
    "user": "https://github.com/hivert"
}
```

<a id='comment:2'></a>Hi Stepan,

I had a quick look at you patch. I have two comment:
- There is a proper syntax for reference and algorithm please see: http://www.sagemath.org/doc/developer/conventions.html#docstring-markup-with-rest-and-sphinx. I don't have the time to fix it myself.
- More important, I think your code should go in a file which is not dependent on a particular implementation of polynomial. I think sage/rings/polynomial/polynomial_element.pyx is a good place. You'll find there methods such as (`squarefree_decomposition, is_square`). Maybe putting a function in `cyclotomic.pyx` and a frontend method in `polynomial_element`, that is having all cyclotomic algorithm in the same place, is a better solution.

Thanks for this nice work !

Florent



---

archive/issue_comments_153345.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 hivert]:\n\nHi Florent,\n\nthank you for the feedback! I made some improvements.\n\n\n>  - There is a proper syntax for reference and algorithm\n\n\nI tried to make some changes according to the documentation.\n\n>  - More important, I think your code should go in a file which is not dependent on a particular implementation of polynomial.\n\n\nI moved the code to sage/rings/polynomial/polynomial_element.pyx for the moment.",
    "created_at": "2012-02-21T20:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153345",
    "user": "https://github.com/staroste"
}
```

<a id='comment:3'></a>Replying to [comment:2 hivert]:

Hi Florent,

thank you for the feedback! I made some improvements.


>  - There is a proper syntax for reference and algorithm


I tried to make some changes according to the documentation.

>  - More important, I think your code should go in a file which is not dependent on a particular implementation of polynomial.


I moved the code to sage/rings/polynomial/polynomial_element.pyx for the moment.



---

archive/issue_comments_153346.json:
```json
{
    "body": "<a id='comment:5'></a>This will do some strange things if the base ring is a finite field. For instance it will say that the mod p reduction of the nth cyclotomic polynomial is cyclotomic for some values of p, and non-cyclotomic for others (because it will depend whether the reduction mod p is irreducible or not). \n\nMoreover, if the base ring is a characteristic 0 ring bigger than ZZ, you will get some strange behaviour in case 3 because you call \"f1.factor()\" and the factorization over ` self.base_ring() ` won't generally be the same as over ZZ; indeed you might even get errors at this point if the base ring is one where Sage doesn't know how to factor polynomials.\n\nI suggest you change the type-check\n\n```python\ntry:\n    self.change_ring(ZZ)\nexcept TypeError:\n    return False\n```\nto something a bit more cautious like\n\n```python\nif self.base_ring().characteristic() != 0:\n    return False\nif self.base_ring() != ZZ:\n    try:\n        f = self.change_ring(ZZ)\n        return f.is_cyclotomic()\n    except TypeError,ValueError:\n        return False\n```\n(or raise a ValueError, if you prefer). Then you can continue with your algorithm in the confidence that the base ring is ZZ.",
    "created_at": "2012-04-05T11:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153346",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:5'></a>This will do some strange things if the base ring is a finite field. For instance it will say that the mod p reduction of the nth cyclotomic polynomial is cyclotomic for some values of p, and non-cyclotomic for others (because it will depend whether the reduction mod p is irreducible or not). 

Moreover, if the base ring is a characteristic 0 ring bigger than ZZ, you will get some strange behaviour in case 3 because you call "f1.factor()" and the factorization over ` self.base_ring() ` won't generally be the same as over ZZ; indeed you might even get errors at this point if the base ring is one where Sage doesn't know how to factor polynomials.

I suggest you change the type-check

```python
try:
    self.change_ring(ZZ)
except TypeError:
    return False
```
to something a bit more cautious like

```python
if self.base_ring().characteristic() != 0:
    return False
if self.base_ring() != ZZ:
    try:
        f = self.change_ring(ZZ)
        return f.is_cyclotomic()
    except TypeError,ValueError:
        return False
```
(or raise a ValueError, if you prefer). Then you can continue with your algorithm in the confidence that the base ring is ZZ.



---

archive/issue_comments_153347.json:
```json
{
    "body": "<a id='comment:6'></a>Please fill in your real name as Author.",
    "created_at": "2012-07-27T20:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153347",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Please fill in your real name as Author.



---

archive/issue_comments_153348.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 davidloeffler]:\n\n> I suggest you change the type-check to something a bit more cautious\n\n\nThanks a lot! I had doubts about this part. I did what you suggested.\n\n\nReplying to [comment:6 jdemeyer]:\n\n> Please fill in your real name as Author.\n\n\nDone.",
    "created_at": "2012-08-16T10:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153348",
    "user": "https://github.com/staroste"
}
```

<a id='comment:7'></a>Replying to [comment:5 davidloeffler]:

> I suggest you change the type-check to something a bit more cautious


Thanks a lot! I had doubts about this part. I did what you suggested.


Replying to [comment:6 jdemeyer]:

> Please fill in your real name as Author.


Done.



---

archive/issue_comments_153349.json:
```json
{
    "body": "Attachment [trac_12466-ss.patch](tarball://root/attachments/some-uuid/ticket12466/trac_12466-ss.patch) by @staroste created at 2012-08-18 11:13:27\n\ntested on sage 5.3.beta1",
    "created_at": "2012-08-18T11:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153349",
    "user": "https://github.com/staroste"
}
```

Attachment [trac_12466-ss.patch](tarball://root/attachments/some-uuid/ticket12466/trac_12466-ss.patch) by @staroste created at 2012-08-18 11:13:27

tested on sage 5.3.beta1



---

archive/issue_comments_153350.json:
```json
{
    "body": "<a id='comment:8'></a>A few changes made in the review patch:\n\n* the reference is no longer given by a number like [1], but by [BD89]\n\n* added a link to the cited article as follows \n`:doi:`10.1007/3-540-51084-2_22``\n\n* when the characteristic is not zero, raise an error\n\n```\nraise NotImplementedError(\"not implemented in non-zero characteristic\")\n```\n\n* the odd and even construction are now done in two lines\n\n```\npo_odd = sum(coefs[i]*(gen**((i-1)/2)) for i in xrange(1,len(coefs),2))\npo_even = sum(coefs[i]*(gen**(i/2)) for i in xrange(0,len(coefs),2))\n```",
    "created_at": "2013-03-13T13:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153350",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>A few changes made in the review patch:

* the reference is no longer given by a number like [1], but by [BD89]

* added a link to the cited article as follows 
`:doi:`10.1007/3-540-51084-2_22``

* when the characteristic is not zero, raise an error

```
raise NotImplementedError("not implemented in non-zero characteristic")
```

* the odd and even construction are now done in two lines

```
po_odd = sum(coefs[i]*(gen**((i-1)/2)) for i in xrange(1,len(coefs),2))
po_even = sum(coefs[i]*(gen**(i/2)) for i in xrange(0,len(coefs),2))
```



---

archive/issue_comments_153351.json:
```json
{
    "body": "<a id='comment:9'></a>Once the bot has given a green light, and if you are happy with the review patch, you can give a positive review",
    "created_at": "2013-03-13T13:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153351",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>Once the bot has given a green light, and if you are happy with the review patch, you can give a positive review



---

archive/issue_comments_153352.json:
```json
{
    "body": "<a id='comment:10'></a>Hey Frederic,\n\nBot has essentially given a green light and the review patch looks good to me except for one minor thing on line 5969, I would prefer it to be:\n\n```\nReturn ``True`` if ``self`` is a cyclotomic polynomial.\n```\nSorry to nitpick.\n\nThanks,\n\nTravis",
    "created_at": "2013-04-04T12:19:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153352",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Hey Frederic,

Bot has essentially given a green light and the review patch looks good to me except for one minor thing on line 5969, I would prefer it to be:

```
Return ``True`` if ``self`` is a cyclotomic polynomial.
```
Sorry to nitpick.

Thanks,

Travis



---

archive/issue_comments_153353.json:
```json
{
    "body": "<a id='comment:11'></a>Attachment [trac_12466_review-fc.patch](tarball://root/attachments/some-uuid/ticket12466/trac_12466_review-fc.patch) by @fchapoton created at 2013-04-04 14:09:15\n\nrevised patch, with line 5969 changed",
    "created_at": "2013-04-04T14:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153353",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>Attachment [trac_12466_review-fc.patch](tarball://root/attachments/some-uuid/ticket12466/trac_12466_review-fc.patch) by @fchapoton created at 2013-04-04 14:09:15

revised patch, with line 5969 changed



---

archive/issue_comments_153354.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-04T14:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153354",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153355.json:
```json
{
    "body": "<a id='comment:12'></a>Thanks Frederic.",
    "created_at": "2013-04-04T14:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153355",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Thanks Frederic.



---

archive/issue_events_033597.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-06T14:50:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12466#event-33597"
}
```



---

archive/issue_comments_153356.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-06T14:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12466",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12466#issuecomment-153356",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
