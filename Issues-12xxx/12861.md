# Issue 12861: maximal_order of quaternion algebras should be more general

archive/issues_012689.json:
```json
{
    "body": "Currently Sage can only compute maximal orders in quaternion algebras over QQ having prime discriminant.\n\nAlgorithms exist to do this for arbitrary discriminants over arbitrary number fields, and should probably be implemented at least over QQ (for general number fields we don't have the necessary basics to deal with pseudo-bases of quaternion orders implemented at the moment).\n\nThe attached patch implements the algorithm from J. Voight, \"Identifying the matrix ring: algorithms for quaternion algebras and quadratic forms\" over QQ. (Needs to be applied after the patch from #12860)\n\nDepends on #12860\n\n**Assignee:** @dansme\n\n**Reviewer:** Aly Deines\n\n**Author:** Daniel Smertnig\n\n**Merged:** sage-5.3.beta1\n\nIssue created by migration from https://trac.sagemath.org/ticket/12861\n\n",
    "closed_at": "2012-08-12T18:59:30Z",
    "created_at": "2012-04-19T21:11:59Z",
    "labels": [
        "component: algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.3",
    "title": "maximal_order of quaternion algebras should be more general",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12861",
    "user": "https://github.com/dansme"
}
```
Currently Sage can only compute maximal orders in quaternion algebras over QQ having prime discriminant.

Algorithms exist to do this for arbitrary discriminants over arbitrary number fields, and should probably be implemented at least over QQ (for general number fields we don't have the necessary basics to deal with pseudo-bases of quaternion orders implemented at the moment).

The attached patch implements the algorithm from J. Voight, "Identifying the matrix ring: algorithms for quaternion algebras and quadratic forms" over QQ. (Needs to be applied after the patch from #12860)

Depends on #12860

**Assignee:** @dansme

**Reviewer:** Aly Deines

**Author:** Daniel Smertnig

**Merged:** sage-5.3.beta1

Issue created by migration from https://trac.sagemath.org/ticket/12861





---

archive/issue_comments_147327.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n Algorithms exist to do this for arbitrary discriminants over arbitrary number fields, and should probably be implemented at least over QQ (for general number fields we don't have the necessary basics to deal with pseudo-bases of quaternion orders implemented at the moment).\n \n-Note: I'm working on this and should have code for QQ available soon.\n+The attached patch implements the algorithm from J. Voight, \"Identifying the matrix ring: algorithms for quaternion algebras and quadratic forms\" over QQ. (Needs to be applied after the patch from #12860)\n``````\n",
    "created_at": "2012-04-19T22:46:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147327",
    "user": "https://github.com/dansme"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 Algorithms exist to do this for arbitrary discriminants over arbitrary number fields, and should probably be implemented at least over QQ (for general number fields we don't have the necessary basics to deal with pseudo-bases of quaternion orders implemented at the moment).
 
-Note: I'm working on this and should have code for QQ available soon.
+The attached patch implements the algorithm from J. Voight, "Identifying the matrix ring: algorithms for quaternion algebras and quadratic forms" over QQ. (Needs to be applied after the patch from #12860)
``````




---

archive/issue_comments_147328.json:
```json
{
    "body": "<a id='comment:2'></a>\nSecond patch is the right one, and applies on sage-5.0.beta13 after #12860. Ignore the first patch (I forgot to check \"replace patch\").",
    "created_at": "2012-04-20T10:23:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147328",
    "user": "https://github.com/dansme"
}
```

<a id='comment:2'></a>
Second patch is the right one, and applies on sage-5.0.beta13 after #12860. Ignore the first patch (I forgot to check "replace patch").



---

archive/issue_events_107363.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2012-07-21T23:37:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107363"
}
```



---

archive/issue_comments_147329.json:
```json
{
    "body": "<a id='comment:4'></a>\nRunning -t using sage-5.2.rc0, the following errors came up:\n\n```\nAlys-MacBook-Air:sage-5.2.rc0 aly$ ./sage -t devel/sage/sage/algebras/quatalg/\nsage -t  \"devel/sage/sage/algebras/quatalg/__init__.py\"     \n\t [0.1 s]\nsage -t  \"devel/sage/sage/algebras/quatalg/all.py\"          \n\t [0.1 s]\nsage -t  \"devel/sage/sage/algebras/quatalg/quaternion_algebra.py\"\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 641:\n    sage: QuaternionAlgebra(-17*9,-3).maximal_order().basis()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_20[11]>\", line 1, in <module>\n        QuaternionAlgebra(-Integer(17)*Integer(9),-Integer(3)).maximal_order().basis()###line 641:\n    sage: QuaternionAlgebra(-17*9,-3).maximal_order().basis()\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 739, in maximal_order\n        f = normalize_basis_at_p(list(e), p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 650:\n    sage: QuaternionAlgebra(-3,-89).maximal_order(take_shortcuts=False)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_20[13]>\", line 1, in <module>\n        QuaternionAlgebra(-Integer(3),-Integer(89)).maximal_order(take_shortcuts=False)###line 650:\n    sage: QuaternionAlgebra(-3,-89).maximal_order(take_shortcuts=False)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 739, in maximal_order\n        f = normalize_basis_at_p(list(e), p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 652:\n    sage: QuaternionAlgebra(1,1).maximal_order(take_shortcuts=False)    # Matrix ring\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_20[14]>\", line 1, in <module>\n        QuaternionAlgebra(Integer(1),Integer(1)).maximal_order(take_shortcuts=False)    # Matrix ring###line 652:\n    sage: QuaternionAlgebra(1,1).maximal_order(take_shortcuts=False)    # Matrix ring\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 739, in maximal_order\n        f = normalize_basis_at_p(list(e), p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 654:\n    sage: QuaternionAlgebra(-22,210).maximal_order(take_shortcuts=False)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_20[15]>\", line 1, in <module>\n        QuaternionAlgebra(-Integer(22),Integer(210)).maximal_order(take_shortcuts=False)###line 654:\n    sage: QuaternionAlgebra(-22,210).maximal_order(take_shortcuts=False)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 739, in maximal_order\n        f = normalize_basis_at_p(list(e), p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 2693:\n    sage: normalize_basis_at_p(e, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_83[5]>\", line 1, in <module>\n        normalize_basis_at_p(e, Integer(2))###line 2693:\n    sage: normalize_basis_at_p(e, 2)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 2697:\n    sage: normalize_basis_at_p(e, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_83[8]>\", line 1, in <module>\n        normalize_basis_at_p(e, Integer(2))###line 2697:\n    sage: normalize_basis_at_p(e, 2)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 2701:\n    sage: normalize_basis_at_p(e, 5)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_83[11]>\", line 1, in <module>\n        normalize_basis_at_p(e, Integer(5))###line 2701:\n    sage: normalize_basis_at_p(e, 5)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\nFile \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py\", line 2705:\n    sage: normalize_basis_at_p(e, 2)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_83[14]>\", line 1, in <module>\n        normalize_basis_at_p(e, Integer(2))###line 2705:\n    sage: normalize_basis_at_p(e, 2)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2744, in normalize_basis_at_p\n        f = normalize_basis_at_p(e[1:], p)\n      File \"/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 2745, in normalize_basis_at_p\n        print 'f', f, 'dif', min_v - valuation(p,2)\n      File \"element.pyx\", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)\n      File \"coerce.pyx\", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)\n      File \"coerce.pxi\", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)\n      File \"coerce.pxi\", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)\n    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument\n**********************************************************************\n2 items had failures:\n   4 of  19 in __main__.example_20\n   4 of  16 in __main__.example_83\n***Test Failed*** 8 failures.\nFor whitespace errors, see the file /Users/aly/.sage//tmp/quaternion_algebra_66690.py\n\t [13.4 s]\nsage -t  \"devel/sage/sage/algebras/quatalg/quaternion_algebra_cython.pyx\"\n\t [2.3 s]\nsage -t  \"devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx\"\n\t [4.4 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  \"devel/sage/sage/algebras/quatalg/quaternion_algebra.py\"\nTotal time for all tests: 20.5 seconds\n\n\n```\n\nI'll try again on sage-5.1.",
    "created_at": "2012-07-23T18:33:08Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147329",
    "user": "https://github.com/adeines"
}
```

<a id='comment:4'></a>
Running -t using sage-5.2.rc0, the following errors came up:

```
Alys-MacBook-Air:sage-5.2.rc0 aly$ ./sage -t devel/sage/sage/algebras/quatalg/
sage -t  "devel/sage/sage/algebras/quatalg/__init__.py"     
	 [0.1 s]
sage -t  "devel/sage/sage/algebras/quatalg/all.py"          
	 [0.1 s]
sage -t  "devel/sage/sage/algebras/quatalg/quaternion_algebra.py"
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 641:
    sage: QuaternionAlgebra(-17*9,-3).maximal_order().basis()
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_20[11]>", line 1, in <module>
        QuaternionAlgebra(-Integer(17)*Integer(9),-Integer(3)).maximal_order().basis()###line 641:
    sage: QuaternionAlgebra(-17*9,-3).maximal_order().basis()
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 739, in maximal_order
        f = normalize_basis_at_p(list(e), p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 650:
    sage: QuaternionAlgebra(-3,-89).maximal_order(take_shortcuts=False)
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_20[13]>", line 1, in <module>
        QuaternionAlgebra(-Integer(3),-Integer(89)).maximal_order(take_shortcuts=False)###line 650:
    sage: QuaternionAlgebra(-3,-89).maximal_order(take_shortcuts=False)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 739, in maximal_order
        f = normalize_basis_at_p(list(e), p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 652:
    sage: QuaternionAlgebra(1,1).maximal_order(take_shortcuts=False)    # Matrix ring
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_20[14]>", line 1, in <module>
        QuaternionAlgebra(Integer(1),Integer(1)).maximal_order(take_shortcuts=False)    # Matrix ring###line 652:
    sage: QuaternionAlgebra(1,1).maximal_order(take_shortcuts=False)    # Matrix ring
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 739, in maximal_order
        f = normalize_basis_at_p(list(e), p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 654:
    sage: QuaternionAlgebra(-22,210).maximal_order(take_shortcuts=False)
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_20[15]>", line 1, in <module>
        QuaternionAlgebra(-Integer(22),Integer(210)).maximal_order(take_shortcuts=False)###line 654:
    sage: QuaternionAlgebra(-22,210).maximal_order(take_shortcuts=False)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 739, in maximal_order
        f = normalize_basis_at_p(list(e), p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 2693:
    sage: normalize_basis_at_p(e, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_83[5]>", line 1, in <module>
        normalize_basis_at_p(e, Integer(2))###line 2693:
    sage: normalize_basis_at_p(e, 2)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 2697:
    sage: normalize_basis_at_p(e, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_83[8]>", line 1, in <module>
        normalize_basis_at_p(e, Integer(2))###line 2697:
    sage: normalize_basis_at_p(e, 2)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 2701:
    sage: normalize_basis_at_p(e, 5)
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_83[11]>", line 1, in <module>
        normalize_basis_at_p(e, Integer(5))###line 2701:
    sage: normalize_basis_at_p(e, 5)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/devel/sage/sage/algebras/quatalg/quaternion_algebra.py", line 2705:
    sage: normalize_basis_at_p(e, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_83[14]>", line 1, in <module>
        normalize_basis_at_p(e, Integer(2))###line 2705:
    sage: normalize_basis_at_p(e, 2)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2744, in normalize_basis_at_p
        f = normalize_basis_at_p(e[1:], p)
      File "/Users/aly/Desktop/AllSage/sage-5.2.rc0/local/lib/python/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 2745, in normalize_basis_at_p
        print 'f', f, 'dif', min_v - valuation(p,2)
      File "element.pyx", line 1550, in sage.structure.element.RingElement.__sub__ (sage/structure/element.c:13697)
      File "coerce.pyx", line 797, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7668)
      File "coerce.pxi", line 71, in sage.structure.coerce.arith_error_message (sage/structure/coerce.c:3038)
      File "coerce.pxi", line 41, in sage.structure.coerce.parent_c (sage/structure/coerce.c:2710)
    TypeError: descriptor 'parent' of 'sage.structure.element.Element' object needs an argument
**********************************************************************
2 items had failures:
   4 of  19 in __main__.example_20
   4 of  16 in __main__.example_83
***Test Failed*** 8 failures.
For whitespace errors, see the file /Users/aly/.sage//tmp/quaternion_algebra_66690.py
	 [13.4 s]
sage -t  "devel/sage/sage/algebras/quatalg/quaternion_algebra_cython.pyx"
	 [2.3 s]
sage -t  "devel/sage/sage/algebras/quatalg/quaternion_algebra_element.pyx"
	 [4.4 s]
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  "devel/sage/sage/algebras/quatalg/quaternion_algebra.py"
Total time for all tests: 20.5 seconds


```

I'll try again on sage-5.1.



---

archive/issue_events_107364.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2012-07-23T18:33:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107364"
}
```



---

archive/issue_events_107365.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2012-07-23T18:33:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107365"
}
```



---

archive/issue_comments_147330.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks for testing the patch! \nI just tried applying the patch from #12860 and after that the second patch from this ticket to a fresh install of Sage 5.2rc0, and the tests passed.\n\nI also tried inserting your debug print:\n\n```\nprint 'f', f, 'dif', min_v - valuation(p,2)\n```\nafter the calls to `f = normalize_basis_at_p(e[1:], p)`, but wasn't able to reproduce this error message.\n\nI noticed that my line numbers are a bit different, i.e., a call to `f = normalize_basis_at_p(e[1:], p)` sits at line 2744 for you, while this only occurs on 2756 and 2787 for me.\n\nAre there any other patches I should apply to debug this? (I have only #12860 followed by patch.2 of this ticket).\n\nI did however notice a typo in the docstring of `normalize_basis_at_p` and have fixed thatin a new upload (``p \\eq 2`` becomes ``p = 2``).\n\nOn an unrelated note: If working with quaternion algebras you might also care about #12811 (which has a tiny patch).",
    "created_at": "2012-07-24T11:29:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147330",
    "user": "https://github.com/dansme"
}
```

<a id='comment:5'></a>
Thanks for testing the patch! 
I just tried applying the patch from #12860 and after that the second patch from this ticket to a fresh install of Sage 5.2rc0, and the tests passed.

I also tried inserting your debug print:

```
print 'f', f, 'dif', min_v - valuation(p,2)
```
after the calls to `f = normalize_basis_at_p(e[1:], p)`, but wasn't able to reproduce this error message.

I noticed that my line numbers are a bit different, i.e., a call to `f = normalize_basis_at_p(e[1:], p)` sits at line 2744 for you, while this only occurs on 2756 and 2787 for me.

Are there any other patches I should apply to debug this? (I have only #12860 followed by patch.2 of this ticket).

I did however notice a typo in the docstring of `normalize_basis_at_p` and have fixed thatin a new upload (``p \eq 2`` becomes ``p = 2``).

On an unrelated note: If working with quaternion algebras you might also care about #12811 (which has a tiny patch).



---

archive/issue_comments_147331.json:
```json
{
    "body": "<a id='comment:6'></a>\nFinally, I managed to reliably reproduce the error but only when running `make ptestlong'.\nCalling either\n\n```\nsage -t  --long -force_lib devel/sage/sage/algebras/quatalg/\n```\nor\n\n```\nsage -t  --long devel/sage/sage/algebras/quatalg/\n```\ndirectly all tests pass. I'll try to figure out what's going on here, but this seems to be quite strange.",
    "created_at": "2012-07-26T13:46:03Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147331",
    "user": "https://github.com/dansme"
}
```

<a id='comment:6'></a>
Finally, I managed to reliably reproduce the error but only when running `make ptestlong'.
Calling either

```
sage -t  --long -force_lib devel/sage/sage/algebras/quatalg/
```
or

```
sage -t  --long devel/sage/sage/algebras/quatalg/
```
directly all tests pass. I'll try to figure out what's going on here, but this seems to be quite strange.



---

archive/issue_comments_147332.json:
```json
{
    "body": "<a id='comment:7'></a>\nThat's interesting.  I applied both patches to a clean Sage-5.2.rc0 install on mod.math.washington.edu, the tests ran fine.   For me, the tests have only failed on my mac, but with both Sage-5.1 and Sage-5.2.rc0.\n\nFor the line discrepancy, I'd been debugging and had some print statements in a few places.",
    "created_at": "2012-07-26T13:57:26Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147332",
    "user": "https://github.com/adeines"
}
```

<a id='comment:7'></a>
That's interesting.  I applied both patches to a clean Sage-5.2.rc0 install on mod.math.washington.edu, the tests ran fine.   For me, the tests have only failed on my mac, but with both Sage-5.1 and Sage-5.2.rc0.

For the line discrepancy, I'd been debugging and had some print statements in a few places.



---

archive/issue_comments_147333.json:
```json
{
    "body": "<a id='comment:8'></a>\nStrange. But at least it always seems to die on the subtraction `min_v - valuation(p, 2)`, so I suppose I must in fact be doing something wrong there (but so far I don't see the problem).",
    "created_at": "2012-07-26T14:03:58Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147333",
    "user": "https://github.com/dansme"
}
```

<a id='comment:8'></a>
Strange. But at least it always seems to die on the subtraction `min_v - valuation(p, 2)`, so I suppose I must in fact be doing something wrong there (but so far I don't see the problem).



---

archive/issue_comments_147334.json:
```json
{
    "body": "<a id='comment:9'></a>\nIt seems the problem was that I used `PlusInfinity` which is the class, not an instance thereof.\nComparing the class with an integer is of course non-sense, but seems to have accidently worked most of the time (it is only used to ensure that `B(e[0],e[0])` is less than min_v in the first iteration). \nSo I need to replace it by either `PlusInfinity()` or `infinity`.\n\nI'll upload a new patch once I have verified that `make ptestlong` now works for me.",
    "created_at": "2012-07-26T14:44:08Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147334",
    "user": "https://github.com/dansme"
}
```

<a id='comment:9'></a>
It seems the problem was that I used `PlusInfinity` which is the class, not an instance thereof.
Comparing the class with an integer is of course non-sense, but seems to have accidently worked most of the time (it is only used to ensure that `B(e[0],e[0])` is less than min_v in the first iteration). 
So I need to replace it by either `PlusInfinity()` or `infinity`.

I'll upload a new patch once I have verified that `make ptestlong` now works for me.



---

archive/attachments_017946.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12861_maximal_order.2.patch",
    "asset_url": "tarball://root/attachments/ticket12861/trac_12861_maximal_order.2.patch",
    "created_at": "2012-07-27T08:46:40Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12861/trac_12861_maximal_order.2.patch",
    "user": "https://github.com/dansme"
}
```



---

archive/issue_comments_147335.json:
```json
{
    "body": "**Attachment:** [trac_12861_maximal_order.2.patch](https://github.com/sagemath/sage/files/ticket12861/trac_12861_maximal_order.2.patch)",
    "created_at": "2012-07-27T08:46:40Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147335",
    "user": "https://github.com/dansme"
}
```

**Attachment:** [trac_12861_maximal_order.2.patch](https://github.com/sagemath/sage/files/ticket12861/trac_12861_maximal_order.2.patch)



---

archive/issue_events_107366.json:
```json
{
    "actor": "https://github.com/dansme",
    "created_at": "2012-07-27T08:47:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107366"
}
```



---

archive/issue_events_107367.json:
```json
{
    "actor": "https://github.com/dansme",
    "created_at": "2012-07-27T08:47:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107367"
}
```



---

archive/issue_comments_147336.json:
```json
{
    "body": "<a id='comment:11'></a>\nGood catch!  \n\nYou aren't planning to generalize any of this to the number field case are you?  If not, I'll have some patches up in that direction soon.",
    "created_at": "2012-07-27T14:38:53Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147336",
    "user": "https://github.com/adeines"
}
```

<a id='comment:11'></a>
Good catch!  

You aren't planning to generalize any of this to the number field case are you?  If not, I'll have some patches up in that direction soon.



---

archive/issue_events_107368.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2012-07-27T14:38:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107368"
}
```



---

archive/issue_events_107369.json:
```json
{
    "actor": "https://github.com/adeines",
    "created_at": "2012-07-27T14:38:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107369"
}
```



---

archive/issue_comments_147337.json:
```json
{
    "body": "<a id='comment:12'></a>\nI would love to see quaternion algebras over number fields implemented, but don't have any concrete plans to do it anytime soon. So feel free to work on it.",
    "created_at": "2012-07-27T15:31:15Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147337",
    "user": "https://github.com/dansme"
}
```

<a id='comment:12'></a>
I would love to see quaternion algebras over number fields implemented, but don't have any concrete plans to do it anytime soon. So feel free to work on it.



---

archive/issue_comments_147338.json:
```json
{
    "body": "<a id='comment:13'></a>\nPlease fill in your real name as Author.",
    "created_at": "2012-07-27T20:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147338",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Please fill in your real name as Author.



---

archive/issue_comments_147339.json:
```json
{
    "body": "<a id='comment:14'></a>\nPlease fill in your real name as Reviewer.",
    "created_at": "2012-07-27T20:44:05Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147339",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Please fill in your real name as Reviewer.



---

archive/issue_comments_147340.json:
```json
{
    "body": "**Reviewer:** Aly Deines",
    "created_at": "2012-07-27T21:47:00Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147340",
    "user": "https://github.com/adeines"
}
```

**Reviewer:** Aly Deines



---

archive/issue_comments_147341.json:
```json
{
    "body": "**Author:** Daniel Smertnig",
    "created_at": "2012-07-27T21:50:38Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147341",
    "user": "https://github.com/dansme"
}
```

**Author:** Daniel Smertnig



---

archive/issue_events_107370.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T18:59:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107370"
}
```



---

archive/issue_events_107371.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-12T18:59:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12861#event-107371"
}
```



---

archive/issue_comments_147342.json:
```json
{
    "body": "**Merged:** sage-5.3.beta1",
    "created_at": "2012-08-12T18:59:30Z",
    "issue": "https://github.com/sagemath/sage/issues/12861",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12861#issuecomment-147342",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.3.beta1
