# Issue 12698: Add a warning not to install packages using the Sage shell

archive/issues_012526.json:
```json
{
    "body": "As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.\n\nThe problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.\n\nThis ticket is about adding a warning when running `sage --sh`.  After the patch:\n\n```\n$ ./sage --sh\n\nStarting subshell with Sage environment variables set.  Don't forget\nto exit when you are done.  Beware:\n * Do not do anything with other copies of Sage on your system.\n * Do not use this for installing Sage packages using \"sage -i\" or for\n   running \"make\" at Sage's root directory.  These should be done\n   outside the Sage shell.\n\nBypassing shell configuration files...\n\nNote: SAGE_ROOT=/usr/local/src/sage-5.0.beta8\n(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$\n```\n**Apply** [attachment:12698_sh_beware.patch\u200b] to SAGE_ROOT.\n\n**Assignee:** @nexttime\n\n**Reviewer:** John Palmieri\n\n**Author:** Jeroen Demeyer\n\n**Merged:** sage-5.0.beta10\n\n**Dependencies:** #11790\n\nIssue created by migration from https://trac.sagemath.org/ticket/12698\n\n",
    "closed_at": "2012-03-23T15:23:56Z",
    "created_at": "2012-03-19T14:50:18Z",
    "labels": [
        "component: scripts",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Add a warning not to install packages using the Sage shell",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12698",
    "user": "https://github.com/jdemeyer"
}
```
As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.

The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.

This ticket is about adding a warning when running `sage --sh`.  After the patch:

```
$ ./sage --sh

Starting subshell with Sage environment variables set.  Don't forget
to exit when you are done.  Beware:
 * Do not do anything with other copies of Sage on your system.
 * Do not use this for installing Sage packages using "sage -i" or for
   running "make" at Sage's root directory.  These should be done
   outside the Sage shell.

Bypassing shell configuration files...

Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8
(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$
```
**Apply** [attachment:12698_sh_beware.patch​] to SAGE_ROOT.

**Assignee:** @nexttime

**Reviewer:** John Palmieri

**Author:** Jeroen Demeyer

**Merged:** sage-5.0.beta10

**Dependencies:** #11790

Issue created by migration from https://trac.sagemath.org/ticket/12698





---

archive/issue_comments_145469.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2012-03-19T15:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145469",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_events_107695.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-19T15:05:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107695"
}
```



---

archive/issue_comments_145470.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,22 @@\n \n The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.\n \n-This ticket is about adding a warning when running `sage --sh`.\n+This ticket is about adding a warning when running `sage --sh`.  After the patch:\n+\n+```\n+$ ./sage --sh\n+\n+Starting subshell with Sage environment variables set.  Don't forget\n+to exit when you are done.  Beware:\n+ * Do not do anything with other copies of Sage on your system.\n+ * Do not use this for installing Sage packages using \"sage -i\" or for\n+   running \"make\".  These should be done outside the Sage shell.\n+\n+Bypassing shell configuration files...\n+\n+Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8\n+\n+(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$\n+```\n+\n+**Apply** [attachment:12698_sh_beware.patch\u200b] to SAGE_ROOT.\n``````\n",
    "created_at": "2012-03-19T15:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145470",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,22 @@
 
 The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.
 
-This ticket is about adding a warning when running `sage --sh`.
+This ticket is about adding a warning when running `sage --sh`.  After the patch:
+
+```
+$ ./sage --sh
+
+Starting subshell with Sage environment variables set.  Don't forget
+to exit when you are done.  Beware:
+ * Do not do anything with other copies of Sage on your system.
+ * Do not use this for installing Sage packages using "sage -i" or for
+   running "make".  These should be done outside the Sage shell.
+
+Bypassing shell configuration files...
+
+Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8
+
+(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$
+```
+
+**Apply** [attachment:12698_sh_beware.patch​] to SAGE_ROOT.
``````




---

archive/issue_comments_145471.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe comment about not running `make` seems to conflict with the error message in `sage-spkg`:\n\n```\nInstead, the following commands setup all environment variables\ncorrectly and load a subshell for you to debug the error:\n  (cd '`pwd`' && '$SAGE_ROOT/sage' -sh)\nWhen you are done debugging, you can type \"exit\" to leave the subshell.\n```\n(It's not clear what should be done to \"debug the error\", but running `make` seems like a natural thing to do.)  Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?",
    "created_at": "2012-03-19T18:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145471",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
The comment about not running `make` seems to conflict with the error message in `sage-spkg`:

```
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '`pwd`' && '$SAGE_ROOT/sage' -sh)
When you are done debugging, you can type "exit" to leave the subshell.
```
(It's not clear what should be done to "debug the error", but running `make` seems like a natural thing to do.)  Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?



---

archive/issue_events_107696.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-20T07:31:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107696"
}
```



---

archive/issue_events_107697.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-20T07:31:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107697"
}
```



---

archive/issue_comments_145472.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [jhpalmieri](#comment%3A2):\n> Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?\n\nI meant Sage's top-level \"make\" (or \"make\" inside `SAGE_ROOT/spkg` with #10492).  Running \"make\" inside a spkg directory is fine, and indeed one is encouraged to use the Sage shell for that.\n\nSo the wording should be improved.",
    "created_at": "2012-03-20T07:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145472",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Replying to [jhpalmieri](#comment%3A2):
> Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?

I meant Sage's top-level "make" (or "make" inside `SAGE_ROOT/spkg` with #10492).  Running "make" inside a spkg directory is fine, and indeed one is encouraged to use the Sage shell for that.

So the wording should be improved.



---

archive/issue_events_107698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-20T09:19:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107698"
}
```



---

archive/issue_events_107699.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-20T09:19:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107699"
}
```



---

archive/issue_comments_145473.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,13 +11,12 @@\n to exit when you are done.  Beware:\n  * Do not do anything with other copies of Sage on your system.\n  * Do not use this for installing Sage packages using \"sage -i\" or for\n-   running \"make\".  These should be done outside the Sage shell.\n+   running \"make\" at Sage's root directory.  These should be done\n+   outside the Sage shell.\n \n Bypassing shell configuration files...\n \n Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8\n-\n (sage-sh) jdemeyer@arcanis:sage-5.0.beta8$\n ```\n-\n **Apply** [attachment:12698_sh_beware.patch\u200b] to SAGE_ROOT.\n``````\n",
    "created_at": "2012-03-20T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145473",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,13 +11,12 @@
 to exit when you are done.  Beware:
  * Do not do anything with other copies of Sage on your system.
  * Do not use this for installing Sage packages using "sage -i" or for
-   running "make".  These should be done outside the Sage shell.
+   running "make" at Sage's root directory.  These should be done
+   outside the Sage shell.
 
 Bypassing shell configuration files...
 
 Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8
-
 (sage-sh) jdemeyer@arcanis:sage-5.0.beta8$
 ```
-
 **Apply** [attachment:12698_sh_beware.patch​] to SAGE_ROOT.
``````




---

archive/attachments_017062.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "12698_sh_beware.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12698/12698_sh_beware.patch",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jhpalmieri"
}
```



---

archive/issue_comments_145474.json:
```json
{
    "body": "<a id='comment:5'></a>\nI think this is okay now.",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145474",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
I think this is okay now.



---

archive/issue_comments_145475.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145475",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_events_107700.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-20T18:34:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107700"
}
```



---

archive/issue_events_107701.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-20T18:34:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107701"
}
```



---

archive/issue_comments_145476.json:
```json
{
    "body": "**Merged:** sage-5.0.beta10",
    "created_at": "2012-03-23T15:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-145476",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta10



---

archive/issue_events_107702.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:23:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107702"
}
```



---

archive/issue_events_107703.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:23:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-107703"
}
```
