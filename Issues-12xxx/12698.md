# Issue 12698: Add a warning not to install packages using the Sage shell

archive/issues_012526.json:
```json
{
    "body": "As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.\n\nThe problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.\n\nThis ticket is about adding a warning when running `sage --sh`.  After the patch:\n\n```\n$ ./sage --sh\n\nStarting subshell with Sage environment variables set.  Don't forget\nto exit when you are done.  Beware:\n * Do not do anything with other copies of Sage on your system.\n * Do not use this for installing Sage packages using \"sage -i\" or for\n   running \"make\" at Sage's root directory.  These should be done\n   outside the Sage shell.\n\nBypassing shell configuration files...\n\nNote: SAGE_ROOT=/usr/local/src/sage-5.0.beta8\n(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$\n```\n**Apply** [attachment:12698_sh_beware.patch\u200b] to SAGE_ROOT.\n\nAssignee: @nexttime\n\nReviewer: John Palmieri\n\nAuthor: Jeroen Demeyer\n\nMerged: sage-5.0.beta10\n\nDependencies: #11790\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12698\n\n",
    "closed_at": "2012-03-23T15:23:56Z",
    "created_at": "2012-03-19T14:50:18Z",
    "labels": [
        "component: scripts"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Add a warning not to install packages using the Sage shell",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12698",
    "user": "https://github.com/jdemeyer"
}
```
As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.

The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.

This ticket is about adding a warning when running `sage --sh`.  After the patch:

```
$ ./sage --sh

Starting subshell with Sage environment variables set.  Don't forget
to exit when you are done.  Beware:
 * Do not do anything with other copies of Sage on your system.
 * Do not use this for installing Sage packages using "sage -i" or for
   running "make" at Sage's root directory.  These should be done
   outside the Sage shell.

Bypassing shell configuration files...

Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8
(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$
```
**Apply** [attachment:12698_sh_beware.patch​] to SAGE_ROOT.

Assignee: @nexttime

Reviewer: John Palmieri

Author: Jeroen Demeyer

Merged: sage-5.0.beta10

Dependencies: #11790

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12698





---

archive/issue_comments_157411.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-19T15:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157411",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157412.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -2,7 +2,25 @@\n \n The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.\n \n-This ticket is about adding a warning when running `sage --sh`.\n+This ticket is about adding a warning when running `sage --sh`.  After the patch:\n+\n+```\n+$ ./sage --sh\n+\n+Starting subshell with Sage environment variables set.  Don't forget\n+to exit when you are done.  Beware:\n+ * Do not do anything with other copies of Sage on your system.\n+ * Do not use this for installing Sage packages using \"sage -i\" or for\n+   running \"make\".  These should be done outside the Sage shell.\n+\n+Bypassing shell configuration files...\n+\n+Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8\n+\n+(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$\n+```\n+\n+**Apply** [attachment:12698_sh_beware.patch\u200b] to SAGE_ROOT.\n \n Dependencies: #11790\n \n```\n",
    "created_at": "2012-03-19T15:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157412",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -2,7 +2,25 @@
 
 The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.
 
-This ticket is about adding a warning when running `sage --sh`.
+This ticket is about adding a warning when running `sage --sh`.  After the patch:
+
+```
+$ ./sage --sh
+
+Starting subshell with Sage environment variables set.  Don't forget
+to exit when you are done.  Beware:
+ * Do not do anything with other copies of Sage on your system.
+ * Do not use this for installing Sage packages using "sage -i" or for
+   running "make".  These should be done outside the Sage shell.
+
+Bypassing shell configuration files...
+
+Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8
+
+(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$
+```
+
+**Apply** [attachment:12698_sh_beware.patch​] to SAGE_ROOT.
 
 Dependencies: #11790
 
```




---

archive/issue_comments_157413.json:
```json
{
    "body": "<a id='comment:2'></a>The comment about not running `make` seems to conflict with the error message in `sage-spkg`:\n\n```\nInstead, the following commands setup all environment variables\ncorrectly and load a subshell for you to debug the error:\n  (cd '`pwd`' && '$SAGE_ROOT/sage' -sh)\nWhen you are done debugging, you can type \"exit\" to leave the subshell.\n```\n(It's not clear what should be done to \"debug the error\", but running `make` seems like a natural thing to do.)  Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?",
    "created_at": "2012-03-19T18:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157413",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>The comment about not running `make` seems to conflict with the error message in `sage-spkg`:

```
Instead, the following commands setup all environment variables
correctly and load a subshell for you to debug the error:
  (cd '`pwd`' && '$SAGE_ROOT/sage' -sh)
When you are done debugging, you can type "exit" to leave the subshell.
```
(It's not clear what should be done to "debug the error", but running `make` seems like a natural thing to do.)  Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?



---

archive/issue_comments_157414.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-20T07:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157414",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_157415.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 jhpalmieri]:\n> Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?\n\nI meant Sage's top-level \"make\" (or \"make\" inside `SAGE_ROOT/spkg` with #10492).  Running \"make\" inside a spkg directory is fine, and indeed one is encouraged to use the Sage shell for that.\n\nSo the wording should be improved.",
    "created_at": "2012-03-20T07:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157415",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Replying to [comment:2 jhpalmieri]:
> Not running `sage -i ...` makes sense, but can you clarify the issue about running `make`?

I meant Sage's top-level "make" (or "make" inside `SAGE_ROOT/spkg` with #10492).  Running "make" inside a spkg directory is fine, and indeed one is encouraged to use the Sage shell for that.

So the wording should be improved.



---

archive/issue_comments_157416.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-20T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157416",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_157417.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,25 @@\n+As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.\n \n+The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.\n+\n+This ticket is about adding a warning when running `sage --sh`.  After the patch:\n+\n+```\n+$ ./sage --sh\n+\n+Starting subshell with Sage environment variables set.  Don't forget\n+to exit when you are done.  Beware:\n+ * Do not do anything with other copies of Sage on your system.\n+ * Do not use this for installing Sage packages using \"sage -i\" or for\n+   running \"make\" at Sage's root directory.  These should be done\n+   outside the Sage shell.\n+\n+Bypassing shell configuration files...\n+\n+Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8\n+(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$\n+```\n+**Apply** [attachment:12698_sh_beware.patch\u200b] to SAGE_ROOT.\n \n Dependencies: #11790\n \n```\n",
    "created_at": "2012-03-20T09:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157417",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,25 @@
+As we found out in [http://trac.sagemath.org/sage_trac/ticket/12369#comment:189](http://trac.sagemath.org/sage_trac/ticket/12369#comment:189), you cannot use the Sage shell to install Sage packages.
 
+The problem is that `sage-env` has some conditional commands.  One of these commands is setting `LD_LIBRARY_PATH`.  With #12405, only existing directories are added to `LD_LIBRARY_PATH`.  Upon entering the Sage shell, `$SAGE_LOCAL/lib` might not exist yet, so that directory isn't added. Since now `SAGE_ENV_SOURCED=1`, the variable `LD_LIBRARY_PATH` is not changed anymore.  Similarly, `PYTHONHOME` and `PYTHONPATH` are only set when Python has been installed.
+
+This ticket is about adding a warning when running `sage --sh`.  After the patch:
+
+```
+$ ./sage --sh
+
+Starting subshell with Sage environment variables set.  Don't forget
+to exit when you are done.  Beware:
+ * Do not do anything with other copies of Sage on your system.
+ * Do not use this for installing Sage packages using "sage -i" or for
+   running "make" at Sage's root directory.  These should be done
+   outside the Sage shell.
+
+Bypassing shell configuration files...
+
+Note: SAGE_ROOT=/usr/local/src/sage-5.0.beta8
+(sage-sh) jdemeyer@arcanis:sage-5.0.beta8$
+```
+**Apply** [attachment:12698_sh_beware.patch​] to SAGE_ROOT.
 
 Dependencies: #11790
 
```




---

archive/issue_comments_157418.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [12698_sh_beware.patch](tarball://root/attachments/some-uuid/ticket12698/12698_sh_beware.patch) by @jhpalmieri created at 2012-03-20 18:34:04\n\nI think this is okay now.",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157418",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>Attachment [12698_sh_beware.patch](tarball://root/attachments/some-uuid/ticket12698/12698_sh_beware.patch) by @jhpalmieri created at 2012-03-20 18:34:04

I think this is okay now.



---

archive/issue_comments_157419.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-20T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157419",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_034437.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:23:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12698#event-34437"
}
```



---

archive/issue_comments_157420.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-23T15:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12698#issuecomment-157420",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
