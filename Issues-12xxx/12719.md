# Issue 12719: Upgrade to IPython 0.13

archive/issues_012547.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @gvol @vbraun @jasongrout alexanderdreyer @robertwb\n\nKeywords: sd40.5\n\nWe need to upgrade IPython to the shiny new thing. Well, not really - the shiny new thing was 0.11, and 0.13 is now stable. It's been mostly rewritten and is now a lot more modular, as I understand it. Definitely worth using in Sage.\n\nNote: To use the QT console (`sage -ipython qtconsole`), you need qt/qt-devel in your base OS install, the optional zeromq/pyzmq spkgs from #12843, and the optional sip/PyQt spkgs from #13022.\n\nInstall the IPython 0.13.1 spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/ipython-0.13.1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ipython-0.13.1.spkg)\n\n**apply**:\n\nTo the scripts repository: \n* [attachment:trac_12719-scripts-vb.patch]\n* [attachment:trac_12719_remove_sage_gdb_ipython.patch]\n* [attachment:12719-test-displayhook.patch]\n* [attachment:12719_run_cython.patch]\n* [attachment:trac_12719-hgignore.patch]\n* [attachment:trac_12719_purge_ipy_profile_sage.patch]\n\nTo the root repository:\n* [attachment:trac_12719_ROOT_configuration_files.patch]\n* [attachment:trac_12719-root-spkg-install.patch]\n\nTo the sage library:\n* [attachment:trac_12719-rebased-to-13211-vb.patch]\n* [attachment:trac_12719-move_to_preparser_rebased.patch]\n* [attachment:trac_12719_ipython_fixes.patch]\n* [attachment:trac_12719_dedent.patch]\n* [attachment:trac_12719-crash.patch]\n* [attachment:trac_12719-cellmagics013.patch]\n* [attachment:12719-newipython-take2.patch]\n* [attachment:12719-displayhook.patch]\n* [attachment:12719-fix-transformer.patch]\n* [attachment:12719-5.4rc1.patch]\n* [attachment:12719-remove-plugin.patch]\n* [attachment:12719-displayhook-library.patch]\n* [attachment:trac_12719-pager.patch]\n* [attachment:trac_12719-preparse-doctest.patch]\n* [attachment:trac_12719-gcd-repr.patch]\n* [attachment:12719-system.patch]\n* [attachment:trac-12719-always-preparse.patch]\n* [attachment:12719_ipython_test.patch]\n* [attachment:12719_ipython_no_history.patch]\n\nSo:\n\n```\ncd SAGE_ROOT\n\n./sage --hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_ROOT_configuration_files.patch\n./sage --hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-root-spkg-install.patch\n\n./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-scripts-vb.patch\n./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_remove_sage_gdb_ipython.patch\n./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-test-displayhook.patch\n./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719_run_cython.patch\n./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-hgignore.patch\n./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_purge_ipy_profile_sage.patch\n\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-rebased-to-13211-vb.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-move_to_preparser_rebased.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_ipython_fixes.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_dedent.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-crash.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-cellmagics013.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-newipython-take2.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-displayhook.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-fix-transformer.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-5.4rc1.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-remove-plugin.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-displayhook-library.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-pager.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-preparse-doctest.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-gcd-repr.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-system.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac-12719-always-preparse.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719_ipython_test.patch\n./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719_ipython_no_history.patch\n\n./sage -i http://sage.math.washington.edu/home/jason/ipython-0.13.1.spkg\n\n./sage -br\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/12719\n\n",
    "closed_at": "2013-01-26T09:53:28Z",
    "created_at": "2012-03-21T20:03:03Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Upgrade to IPython 0.13",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12719",
    "user": "https://github.com/kini"
}
```
Assignee: tbd

CC:  @gvol @vbraun @jasongrout alexanderdreyer @robertwb

Keywords: sd40.5

We need to upgrade IPython to the shiny new thing. Well, not really - the shiny new thing was 0.11, and 0.13 is now stable. It's been mostly rewritten and is now a lot more modular, as I understand it. Definitely worth using in Sage.

Note: To use the QT console (`sage -ipython qtconsole`), you need qt/qt-devel in your base OS install, the optional zeromq/pyzmq spkgs from #12843, and the optional sip/PyQt spkgs from #13022.

Install the IPython 0.13.1 spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/ipython-0.13.1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/ipython-0.13.1.spkg)

**apply**:

To the scripts repository: 
* [attachment:trac_12719-scripts-vb.patch]
* [attachment:trac_12719_remove_sage_gdb_ipython.patch]
* [attachment:12719-test-displayhook.patch]
* [attachment:12719_run_cython.patch]
* [attachment:trac_12719-hgignore.patch]
* [attachment:trac_12719_purge_ipy_profile_sage.patch]

To the root repository:
* [attachment:trac_12719_ROOT_configuration_files.patch]
* [attachment:trac_12719-root-spkg-install.patch]

To the sage library:
* [attachment:trac_12719-rebased-to-13211-vb.patch]
* [attachment:trac_12719-move_to_preparser_rebased.patch]
* [attachment:trac_12719_ipython_fixes.patch]
* [attachment:trac_12719_dedent.patch]
* [attachment:trac_12719-crash.patch]
* [attachment:trac_12719-cellmagics013.patch]
* [attachment:12719-newipython-take2.patch]
* [attachment:12719-displayhook.patch]
* [attachment:12719-fix-transformer.patch]
* [attachment:12719-5.4rc1.patch]
* [attachment:12719-remove-plugin.patch]
* [attachment:12719-displayhook-library.patch]
* [attachment:trac_12719-pager.patch]
* [attachment:trac_12719-preparse-doctest.patch]
* [attachment:trac_12719-gcd-repr.patch]
* [attachment:12719-system.patch]
* [attachment:trac-12719-always-preparse.patch]
* [attachment:12719_ipython_test.patch]
* [attachment:12719_ipython_no_history.patch]

So:

```
cd SAGE_ROOT

./sage --hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_ROOT_configuration_files.patch
./sage --hg qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-root-spkg-install.patch

./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-scripts-vb.patch
./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_remove_sage_gdb_ipython.patch
./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-test-displayhook.patch
./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719_run_cython.patch
./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-hgignore.patch
./sage --hg -R local/bin qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_purge_ipy_profile_sage.patch

./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-rebased-to-13211-vb.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-move_to_preparser_rebased.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_ipython_fixes.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719_dedent.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-crash.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-cellmagics013.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-newipython-take2.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-displayhook.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-fix-transformer.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-5.4rc1.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-remove-plugin.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-displayhook-library.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-pager.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-preparse-doctest.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac_12719-gcd-repr.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719-system.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/trac-12719-always-preparse.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719_ipython_test.patch
./sage --hg -R devel/sage qimport -P http://trac.sagemath.org/sage_trac/raw-attachment/ticket/12719/12719_ipython_no_history.patch

./sage -i http://sage.math.washington.edu/home/jason/ipython-0.13.1.spkg

./sage -br
```

Issue created by migration from https://trac.sagemath.org/ticket/12719





---

archive/issue_comments_148538.json:
```json
{
    "body": "See #12167 for a related ticket: how we deal with IPython configuration files.",
    "created_at": "2012-03-21T20:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148538",
    "user": "https://github.com/jhpalmieri"
}
```

See #12167 for a related ticket: how we deal with IPython configuration files.



---

archive/issue_comments_148539.json:
```json
{
    "body": "Would be nice but we need some porting, here is what typically happen if you try to use ipython-0.12 with sage (we had several reports in sage-on-gentoo before I pinned down the version used by sage):\n\n```\n$ sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/usr/bin/sage-ipython\", line 19, in <module>\n    from IPython.CrashHandler import CrashHandler\nImportError: No module named CrashHandler\n```",
    "created_at": "2012-03-22T00:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148539",
    "user": "https://github.com/kiwifb"
}
```

Would be nice but we need some porting, here is what typically happen if you try to use ipython-0.12 with sage (we had several reports in sage-on-gentoo before I pinned down the version used by sage):

```
$ sage
----------------------------------------------------------------------
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/usr/bin/sage-ipython", line 19, in <module>
    from IPython.CrashHandler import CrashHandler
ImportError: No module named CrashHandler
```



---

archive/issue_comments_148540.json:
```json
{
    "body": "Yes, obviously :) I'm just making this ticket since it is absolutely must be an eventual goal for us and nobody else has made a ticket yet, even though IPython 0.12 has been out for about three months.",
    "created_at": "2012-03-22T01:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148540",
    "user": "https://github.com/kini"
}
```

Yes, obviously :) I'm just making this ticket since it is absolutely must be an eventual goal for us and nobody else has made a ticket yet, even though IPython 0.12 has been out for about three months.



---

archive/issue_comments_148541.json:
```json
{
    "body": "To be honest Fernando Perez and I talked about it on the mailing list at the time of ipython 0.11 and I said I would tell him what happens when we use ipython 0.11+ with sage because he is interested. For various reason I haven't been able to go back to it. But some sage-on-gentoo users eventually got a taste of it when it finally landed in the portage tree.\n\nSo first hurdle: do something about the crash handling.",
    "created_at": "2012-03-22T01:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148541",
    "user": "https://github.com/kiwifb"
}
```

To be honest Fernando Perez and I talked about it on the mailing list at the time of ipython 0.11 and I said I would tell him what happens when we use ipython 0.11+ with sage because he is interested. For various reason I haven't been able to go back to it. But some sage-on-gentoo users eventually got a taste of it when it finally landed in the portage tree.

So first hurdle: do something about the crash handling.



---

archive/issue_comments_148542.json:
```json
{
    "body": "I'm working on this now, and have made quite a bit of progress.  As an added bonus, making the Sage customizations to IPython is quite a bit cleaner.  I should hopefully be able to clean out the mess in sage/misc/preparser_ipython.py and sage/misc/interpreter.py .",
    "created_at": "2012-03-23T22:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148542",
    "user": "https://github.com/mwhansen"
}
```

I'm working on this now, and have made quite a bit of progress.  As an added bonus, making the Sage customizations to IPython is quite a bit cleaner.  I should hopefully be able to clean out the mess in sage/misc/preparser_ipython.py and sage/misc/interpreter.py .



---

archive/issue_comments_148543.json:
```json
{
    "body": "This will fix #4413.",
    "created_at": "2012-03-29T07:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148543",
    "user": "https://github.com/mwhansen"
}
```

This will fix #4413.



---

archive/issue_comments_148544.json:
```json
{
    "body": "Great, I'm glad you're on the case! :)",
    "created_at": "2012-03-29T07:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148544",
    "user": "https://github.com/kini"
}
```

Great, I'm glad you're on the case! :)



---

archive/issue_comments_148545.json:
```json
{
    "body": "What about zmq/pyzmq? It would really add to the functionality and I'm interested in the parallel/cluster support. But, strictly speaking, its not necessary to run ipython. Its also used in the new notebook so maybe its time for it to become a standard package?",
    "created_at": "2012-04-02T18:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148545",
    "user": "https://github.com/vbraun"
}
```

What about zmq/pyzmq? It would really add to the functionality and I'm interested in the parallel/cluster support. But, strictly speaking, its not necessary to run ipython. Its also used in the new notebook so maybe its time for it to become a standard package?



---

archive/issue_comments_148546.json:
```json
{
    "body": "CCing Jason as he expressed interest on sage-devel.",
    "created_at": "2012-04-11T05:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148546",
    "user": "https://github.com/kini"
}
```

CCing Jason as he expressed interest on sage-devel.



---

archive/issue_comments_148547.json:
```json
{
    "body": "mhansen: we'd love to see your work-in-progress if it's available somewhere.  I just spent some time reading the IPython docs again and thinking about how we could use it to implement the notebook hub and worker processes.",
    "created_at": "2012-04-11T05:49:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148547",
    "user": "https://github.com/jasongrout"
}
```

mhansen: we'd love to see your work-in-progress if it's available somewhere.  I just spent some time reading the IPython docs again and thinking about how we could use it to implement the notebook hub and worker processes.



---

archive/issue_comments_148548.json:
```json
{
    "body": "I've posted patches which let Sage work with IPython 0.12 as well as cleaning up some old messy code.  These should be in a state where they're ready to review.\n\nI haven't done anything with preparing an spkg yet.",
    "created_at": "2012-04-11T06:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148548",
    "user": "https://github.com/mwhansen"
}
```

I've posted patches which let Sage work with IPython 0.12 as well as cleaning up some old messy code.  These should be in a state where they're ready to review.

I haven't done anything with preparing an spkg yet.



---

archive/issue_comments_148549.json:
```json
{
    "body": "I've updated the instructions in the description.  Please correct if I messed something up.",
    "created_at": "2012-04-11T06:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148549",
    "user": "https://github.com/jasongrout"
}
```

I've updated the instructions in the description.  Please correct if I messed something up.



---

archive/issue_comments_148550.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-11T06:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148550",
    "user": "https://github.com/jasongrout"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_148551.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-04-11T06:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148551",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148552.json:
```json
{
    "body": "Just curious: do your patches work with the current 0.12, or did you base them on the current git master (or does it not matter?).  On the IPython mailing list, they mentioned that 0.12 had some big bugs, so they were thinking about cutting a quick 0.12.1.  Also, they expect 0.13 in about a month.",
    "created_at": "2012-04-11T06:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148552",
    "user": "https://github.com/jasongrout"
}
```

Just curious: do your patches work with the current 0.12, or did you base them on the current git master (or does it not matter?).  On the IPython mailing list, they mentioned that 0.12 had some big bugs, so they were thinking about cutting a quick 0.12.1.  Also, they expect 0.13 in about a month.



---

archive/issue_comments_148553.json:
```json
{
    "body": "I was thinking more about security today with the zmq messages.  I think it may be more secure to have a default ipcontroller transport of IPC in a directory inside of $DOT_SAGE, rather than tcp over the loopback interface.  That would be more secure in that random people on your computer wouldn't be able to try to register with the IPython hub.  I emailed the IPython mailing list about it: http://thread.gmane.org/gmane.comp.python.ipython.devel/7789\n\nWhat do you think?",
    "created_at": "2012-04-11T06:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148553",
    "user": "https://github.com/jasongrout"
}
```

I was thinking more about security today with the zmq messages.  I think it may be more secure to have a default ipcontroller transport of IPC in a directory inside of $DOT_SAGE, rather than tcp over the loopback interface.  That would be more secure in that random people on your computer wouldn't be able to try to register with the IPython hub.  I emailed the IPython mailing list about it: http://thread.gmane.org/gmane.comp.python.ipython.devel/7789

What do you think?



---

archive/issue_comments_148554.json:
```json
{
    "body": "Replying to [comment:17 jason]:\n> Just curious: do your patches work with the current 0.12, or did you base them on the current git master (or does it not matter?).  On the IPython mailing list, they mentioned that 0.12 had some big bugs, so they were thinking about cutting a quick 0.12.1.  Also, they expect 0.13 in about a month.\n\n\nI've looked at the current git master as I was making these changes, and I think these changes should work fine with what's on there.  I'd be surprised if it made a difference.",
    "created_at": "2012-04-11T06:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148554",
    "user": "https://github.com/mwhansen"
}
```

Replying to [comment:17 jason]:
> Just curious: do your patches work with the current 0.12, or did you base them on the current git master (or does it not matter?).  On the IPython mailing list, they mentioned that 0.12 had some big bugs, so they were thinking about cutting a quick 0.12.1.  Also, they expect 0.13 in about a month.


I've looked at the current git master as I was making these changes, and I think these changes should work fine with what's on there.  I'd be surprised if it made a difference.



---

archive/issue_comments_148555.json:
```json
{
    "body": "I just tested things against git master and everything seems fine.",
    "created_at": "2012-04-11T07:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148555",
    "user": "https://github.com/mwhansen"
}
```

I just tested things against git master and everything seems fine.



---

archive/issue_comments_148556.json:
```json
{
    "body": "I'm trying to apply these to 5.0beta12.  I think I probably got the order wrong in the description, so it would be great if you could check that.  But regardless, none of the patches seem to apply to 5.0beta12 cleanly (each has rejects).",
    "created_at": "2012-04-12T03:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148556",
    "user": "https://github.com/jasongrout"
}
```

I'm trying to apply these to 5.0beta12.  I think I probably got the order wrong in the description, so it would be great if you could check that.  But regardless, none of the patches seem to apply to 5.0beta12 cleanly (each has rejects).



---

archive/issue_comments_148557.json:
```json
{
    "body": "I just tried applying to beta6 and the -scripts patch still had problems.",
    "created_at": "2012-04-12T03:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148557",
    "user": "https://github.com/jasongrout"
}
```

I just tried applying to beta6 and the -scripts patch still had problems.



---

archive/issue_comments_148558.json:
```json
{
    "body": "Attachment [trac_12719-move_to_preparser.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-move_to_preparser.patch) by @mwhansen created at 2012-04-12 03:34:02\n\nThe -scripts patch should apply fine to the scripts repository.  I've rebased the other ones to work on the newer 5.0 beta's.",
    "created_at": "2012-04-12T03:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148558",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12719-move_to_preparser.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-move_to_preparser.patch) by @mwhansen created at 2012-04-12 03:34:02

The -scripts patch should apply fine to the scripts repository.  I've rebased the other ones to work on the newer 5.0 beta's.



---

archive/issue_comments_148559.json:
```json
{
    "body": "After applying the patches to sage-5.0 beta12 I still have `ip = IPython.ipapi.get()` at the end of `sage/misc/edit_module.py`, which crashes Sage on startup.",
    "created_at": "2012-04-12T11:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148559",
    "user": "https://github.com/alexanderdreyer"
}
```

After applying the patches to sage-5.0 beta12 I still have `ip = IPython.ipapi.get()` at the end of `sage/misc/edit_module.py`, which crashes Sage on startup.



---

archive/issue_comments_148560.json:
```json
{
    "body": "I get a crash when I apply these (with a latest git IPython).  I've posted the crash report at http://sage.math.washington.edu/home/jason/Sage_crash_report.txt",
    "created_at": "2012-04-12T11:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148560",
    "user": "https://github.com/jasongrout"
}
```

I get a crash when I apply these (with a latest git IPython).  I've posted the crash report at http://sage.math.washington.edu/home/jason/Sage_crash_report.txt



---

archive/issue_comments_148561.json:
```json
{
    "body": "Is the zmq communication in ipython going through tcp/localhost sockets, or through UDS sockets?  I really think we should use UDS sockets with the files in $DOTSAGE so that it is more secure (i.e., random other people on the computer can't connect to the kernel).",
    "created_at": "2012-04-12T13:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148561",
    "user": "https://github.com/jasongrout"
}
```

Is the zmq communication in ipython going through tcp/localhost sockets, or through UDS sockets?  I really think we should use UDS sockets with the files in $DOTSAGE so that it is more secure (i.e., random other people on the computer can't connect to the kernel).



---

archive/issue_comments_148562.json:
```json
{
    "body": "By default we should not use zeromq. For example, if you want to fork you should do so before creating a zmq context. The zmq context creates threads and open file descriptors.\n\nApart from that, you should either use IPC or TCP+magic cookie, much like the X window system. Implementation wise its probably easiest to allow any socket and alway check the magic cookie.",
    "created_at": "2012-04-12T14:00:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148562",
    "user": "https://github.com/vbraun"
}
```

By default we should not use zeromq. For example, if you want to fork you should do so before creating a zmq context. The zmq context creates threads and open file descriptors.

Apart from that, you should either use IPC or TCP+magic cookie, much like the X window system. Implementation wise its probably easiest to allow any socket and alway check the magic cookie.



---

archive/issue_comments_148563.json:
```json
{
    "body": "I don't think we have a choice of whether or not to use zmq with the new ipython.  ZMQ is an integral part of how it communicates results from the backend to the frontend.  They do have a system for signing messages and ignoring unsigned messages (is that the magic cookie thing?).  UDS sockets is IPC, so we're good there.  My problem with TCP+magic cookie is that it still allows someone else to attempt to connect to the various sockets, whereas using IPC, with the socket files in $DOTSAGE, filesystem permissions prevent others from even attempting to connect.",
    "created_at": "2012-04-12T14:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148563",
    "user": "https://github.com/jasongrout"
}
```

I don't think we have a choice of whether or not to use zmq with the new ipython.  ZMQ is an integral part of how it communicates results from the backend to the frontend.  They do have a system for signing messages and ignoring unsigned messages (is that the magic cookie thing?).  UDS sockets is IPC, so we're good there.  My problem with TCP+magic cookie is that it still allows someone else to attempt to connect to the various sockets, whereas using IPC, with the socket files in $DOTSAGE, filesystem permissions prevent others from even attempting to connect.



---

archive/issue_comments_148564.json:
```json
{
    "body": "It may be that I'm misunderstanding how ipython is using zmq when you just execute 'ipython'.  It may be that it uses in-process communication (using zmq) instead of opening ports on localhost.  I've posted to the ipython-devel mailing list about this.",
    "created_at": "2012-04-12T14:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148564",
    "user": "https://github.com/jasongrout"
}
```

It may be that I'm misunderstanding how ipython is using zmq when you just execute 'ipython'.  It may be that it uses in-process communication (using zmq) instead of opening ports on localhost.  I've posted to the ipython-devel mailing list about this.



---

archive/issue_comments_148565.json:
```json
{
    "body": "Given that you can build IPython without zeromq support it surely must be possible to run without?\n\nI don't see the problem with tcp + magic cookie. Yes you can connect but your connection attempt will be ignored. And the difference in pyzmq to ipc + magic cookie is a single string.  So why bother with ipc without magic cookie?",
    "created_at": "2012-04-12T14:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148565",
    "user": "https://github.com/vbraun"
}
```

Given that you can build IPython without zeromq support it surely must be possible to run without?

I don't see the problem with tcp + magic cookie. Yes you can connect but your connection attempt will be ignored. And the difference in pyzmq to ipc + magic cookie is a single string.  So why bother with ipc without magic cookie?



---

archive/issue_comments_148566.json:
```json
{
    "body": "Thomas on the ipython mailing list confirmed that the plain ipython command doesn't use zmq, so that was a big misunderstanding I had about the new ipython.  So never mind what I said about sockets.",
    "created_at": "2012-04-12T14:48:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148566",
    "user": "https://github.com/jasongrout"
}
```

Thomas on the ipython mailing list confirmed that the plain ipython command doesn't use zmq, so that was a big misunderstanding I had about the new ipython.  So never mind what I said about sockets.



---

archive/issue_comments_148567.json:
```json
{
    "body": "Attachment [trac_12719.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719.patch) by @mwhansen created at 2012-04-12 18:59:13",
    "created_at": "2012-04-12T18:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148567",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12719.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719.patch) by @mwhansen created at 2012-04-12 18:59:13



---

archive/issue_comments_148568.json:
```json
{
    "body": "Okay, I fixed the problem with edit_module.\n\nSorry I wasn't clear about the default IPython not using zmq.  There is a experimental console shell that uses two processes which can be accessed with \"ipython console\", but we aren't using that at all.",
    "created_at": "2012-04-12T19:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148568",
    "user": "https://github.com/mwhansen"
}
```

Okay, I fixed the problem with edit_module.

Sorry I wasn't clear about the default IPython not using zmq.  There is a experimental console shell that uses two processes which can be accessed with "ipython console", but we aren't using that at all.



---

archive/issue_comments_148569.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-12T19:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148569",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148570.json:
```json
{
    "body": "For the record, the patches now apply to my 5.0beta12 and Sage starts up.",
    "created_at": "2012-04-12T19:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148570",
    "user": "https://github.com/jasongrout"
}
```

For the record, the patches now apply to my 5.0beta12 and Sage starts up.



---

archive/issue_comments_148571.json:
```json
{
    "body": "When doing %edit, I edit the sage library file, but the file isn't copied over to the library after editing, so the changes don't take effect.  This doesn't hold back this issue, though, since it didn't work before either.",
    "created_at": "2012-04-12T19:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148571",
    "user": "https://github.com/jasongrout"
}
```

When doing %edit, I edit the sage library file, but the file isn't copied over to the library after editing, so the changes don't take effect.  This doesn't hold back this issue, though, since it didn't work before either.



---

archive/issue_comments_148572.json:
```json
{
    "body": "Although zeromq is not, strictly speaking, necessary for IPython it might be of interest that I made zeromq and pyzmq spkgs at #12843",
    "created_at": "2012-04-14T20:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148572",
    "user": "https://github.com/vbraun"
}
```

Although zeromq is not, strictly speaking, necessary for IPython it might be of interest that I made zeromq and pyzmq spkgs at #12843



---

archive/issue_comments_148573.json:
```json
{
    "body": "Not working on sage-5.0.rc0 (system Darwin 10.8.0).\nI installed the spkg and applied the patches in the given order and places, but still have the following error lauching Sage :\n\n```\nTraceback (most recent call last):\n  File \"/Users/pece/sage-5.0.rc0/local/bin/sage-ipython\", line 19, in <module>\n    from IPython.CrashHandler import CrashHandler\nImportError: No module named CrashHandler\n```\n\nI even installed the patches from #12843 without any success.",
    "created_at": "2012-05-10T15:06:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148573",
    "user": "https://trac.sagemath.org/admin/accounts/users/PierreCagne"
}
```

Not working on sage-5.0.rc0 (system Darwin 10.8.0).
I installed the spkg and applied the patches in the given order and places, but still have the following error lauching Sage :

```
Traceback (most recent call last):
  File "/Users/pece/sage-5.0.rc0/local/bin/sage-ipython", line 19, in <module>
    from IPython.CrashHandler import CrashHandler
ImportError: No module named CrashHandler
```

I even installed the patches from #12843 without any success.



---

archive/issue_comments_148574.json:
```json
{
    "body": "I have OSX 10.6.8: `Darwin Kernel Version 10.8.0`.  I'm running the IPython git master and the patches, and it seems to work well.  Did you do `sage -b` to compile the patches?  Maybe the problem is in the IPython 0.12.1->0.13 changes.",
    "created_at": "2012-05-11T02:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148574",
    "user": "https://github.com/jasongrout"
}
```

I have OSX 10.6.8: `Darwin Kernel Version 10.8.0`.  I'm running the IPython git master and the patches, and it seems to work well.  Did you do `sage -b` to compile the patches?  Maybe the problem is in the IPython 0.12.1->0.13 changes.



---

archive/issue_comments_148575.json:
```json
{
    "body": "Hmmm, it looks like the scripts/ patch wasn't applied (the problematic line is deleted in the patch).  Can you check again that trac_12719-scripts.patch is applied to the SAGE_ROOT/local/bin repository?",
    "created_at": "2012-05-11T02:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148575",
    "user": "https://github.com/jasongrout"
}
```

Hmmm, it looks like the scripts/ patch wasn't applied (the problematic line is deleted in the patch).  Can you check again that trac_12719-scripts.patch is applied to the SAGE_ROOT/local/bin repository?



---

archive/issue_comments_148576.json:
```json
{
    "body": "Replying to [comment:39 jason]:\n> Maybe the problem is in the IPython 0.12.1->0.13 changes.\n\n\nOn sage-5.0.rc0, I managed to apply the three patches and sage starts correctly. So I guess it's not a matter of IPython 0.13 changes. Although, the sage prompt is not in color anymore (my file .sage/ipython/ipythonrc is set to dark background color).\n\nIs the ipython notebook suppose to work? How should I test it?\n\nAlso, doing `sage -ipython notebook` creates this error :\n\n```\n$ sage -ipython notebook\nTraceback (most recent call last):\n...\nImportError: The IPython Notebook requires tornado >= 2.1.0\n```",
    "created_at": "2012-05-13T18:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148576",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:39 jason]:
> Maybe the problem is in the IPython 0.12.1->0.13 changes.


On sage-5.0.rc0, I managed to apply the three patches and sage starts correctly. So I guess it's not a matter of IPython 0.13 changes. Although, the sage prompt is not in color anymore (my file .sage/ipython/ipythonrc is set to dark background color).

Is the ipython notebook suppose to work? How should I test it?

Also, doing `sage -ipython notebook` creates this error :

```
$ sage -ipython notebook
Traceback (most recent call last):
...
ImportError: The IPython Notebook requires tornado >= 2.1.0
```



---

archive/issue_comments_148577.json:
```json
{
    "body": "The first patch (`trac_12719.patch`) applies only with fuzz 2 on sage-5.0",
    "created_at": "2012-05-24T23:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148577",
    "user": "https://github.com/vbraun"
}
```

The first patch (`trac_12719.patch`) applies only with fuzz 2 on sage-5.0



---

archive/issue_comments_148578.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T04:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148578",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148579.json:
```json
{
    "body": "Lots of doctests fail because the display hook is not correctly set up. I'll have a look into this if nobody beats me to it...",
    "created_at": "2012-05-25T04:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148579",
    "user": "https://github.com/vbraun"
}
```

Lots of doctests fail because the display hook is not correctly set up. I'll have a look into this if nobody beats me to it...



---

archive/issue_comments_148580.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T04:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148580",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "" to "sd40.5".



---

archive/issue_comments_148581.json:
```json
{
    "body": "The new ipython configuration files are once more incompatible with the previous ones. My patch versions the directory now (that is, it is named .sage/ipython-VERSION) and deletes the SAGE_ROOT/ipythonrc stuff. I think all sage-specific configuration should go into `sage/misc/interface.py`",
    "created_at": "2012-05-26T17:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148581",
    "user": "https://github.com/vbraun"
}
```

The new ipython configuration files are once more incompatible with the previous ones. My patch versions the directory now (that is, it is named .sage/ipython-VERSION) and deletes the SAGE_ROOT/ipythonrc stuff. I think all sage-specific configuration should go into `sage/misc/interface.py`



---

archive/issue_comments_148582.json:
```json
{
    "body": "Here is some reasonable documentation about Prefilter vs. InputSplitter: http://mail.scipy.org/pipermail/ipython-dev/2011-March/007334.html",
    "created_at": "2012-05-27T17:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148582",
    "user": "https://github.com/vbraun"
}
```

Here is some reasonable documentation about Prefilter vs. InputSplitter: http://mail.scipy.org/pipermail/ipython-dev/2011-March/007334.html



---

archive/issue_comments_148583.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-05-27T20:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148583",
    "user": "https://github.com/vbraun"
}
```

Updated patch



---

archive/issue_comments_148584.json:
```json
{
    "body": "Attachment [trac_13013_ROOT_configuration_files.patch](tarball://root/attachments/some-uuid/ticket12719/trac_13013_ROOT_configuration_files.patch) by @vbraun created at 2012-05-27 20:34:16\n\nThe trac_12719_ipython_fixes.patch switches form Prefilter to InputSplitter. \n\nI'm giving a positive review to everything that Mike wrote.",
    "created_at": "2012-05-27T20:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148584",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_13013_ROOT_configuration_files.patch](tarball://root/attachments/some-uuid/ticket12719/trac_13013_ROOT_configuration_files.patch) by @vbraun created at 2012-05-27 20:34:16

The trac_12719_ipython_fixes.patch switches form Prefilter to InputSplitter. 

I'm giving a positive review to everything that Mike wrote.



---

archive/issue_comments_148585.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-27T20:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148585",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148586.json:
```json
{
    "body": "With the new patch `sage/misc/interpreter.py` has 100% coverage.",
    "created_at": "2012-05-27T22:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148586",
    "user": "https://github.com/vbraun"
}
```

With the new patch `sage/misc/interpreter.py` has 100% coverage.



---

archive/issue_comments_148587.json:
```json
{
    "body": "never mind.",
    "created_at": "2012-05-27T23:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148587",
    "user": "https://github.com/williamstein"
}
```

never mind.



---

archive/issue_comments_148588.json:
```json
{
    "body": "In Sage before this patch, the sage notebook, the Python command line, etc., we have:\n\n```\nfor i in range(10):\n    i\n```\noutputs the numbers up to 10.\n\nWith the new Ipython spkg, etc., we don't.  \n\n```\nsage: for i in range(10): i\nsage: \nExiting Sage (CPU time 0m0.07s, Wall time 2m3.22s).\nblastoff:sage wstein$ sage -ipython\nPython 2.7.2 (default, May 17 2012, 13:12:30) \nIn [1]: for i in range(10): i\nIn [2]: \n```\n\nI'm disappointed, especially because I thought this through and in sagews I recently wrote code so this works correctly in a single cell, even if there are several instances of this.  It's a matter of passing the 'single' option to exec, as is documented in the Python reference.  I wonder why they screwed this up in Ipython 0.12...?\n\nAnyway, I'm not saying this is a show stopper at all - I want the new ipython in sage.  I'm just a little concerned that literally the first thing I tried shows that they made what I consider a bad design choice.  Hopefully it was just bad luck.",
    "created_at": "2012-05-27T23:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148588",
    "user": "https://github.com/williamstein"
}
```

In Sage before this patch, the sage notebook, the Python command line, etc., we have:

```
for i in range(10):
    i
```
outputs the numbers up to 10.

With the new Ipython spkg, etc., we don't.  

```
sage: for i in range(10): i
sage: 
Exiting Sage (CPU time 0m0.07s, Wall time 2m3.22s).
blastoff:sage wstein$ sage -ipython
Python 2.7.2 (default, May 17 2012, 13:12:30) 
In [1]: for i in range(10): i
In [2]: 
```

I'm disappointed, especially because I thought this through and in sagews I recently wrote code so this works correctly in a single cell, even if there are several instances of this.  It's a matter of passing the 'single' option to exec, as is documented in the Python reference.  I wonder why they screwed this up in Ipython 0.12...?

Anyway, I'm not saying this is a show stopper at all - I want the new ipython in sage.  I'm just a little concerned that literally the first thing I tried shows that they made what I consider a bad design choice.  Hopefully it was just bad luck.



---

archive/issue_comments_148589.json:
```json
{
    "body": "Cool -- I tried out a bunch of other things including the new notebook (sage -ipython notebook) and didn't run into any serious issues.  So I'm happy with this from from a purely functional perspective.  Also, deleting tons of ugly code (done in the patches), looks great.",
    "created_at": "2012-05-28T00:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148589",
    "user": "https://github.com/williamstein"
}
```

Cool -- I tried out a bunch of other things including the new notebook (sage -ipython notebook) and didn't run into any serious issues.  So I'm happy with this from from a purely functional perspective.  Also, deleting tons of ugly code (done in the patches), looks great.



---

archive/issue_comments_148590.json:
```json
{
    "body": "It should be easy to get to get the correct functionality for `for i in range(10): i`. The  `shell.run_ast_nodes` method just has to be called with `interactivity=\"all\"` instead of `interactivity=\"last_expr\"`.",
    "created_at": "2012-05-28T00:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148590",
    "user": "https://github.com/mwhansen"
}
```

It should be easy to get to get the correct functionality for `for i in range(10): i`. The  `shell.run_ast_nodes` method just has to be called with `interactivity="all"` instead of `interactivity="last_expr"`.



---

archive/issue_comments_148591.json:
```json
{
    "body": "Here's a review of Volker's ipython_fixes patch:\n\n\n1. (minor) Remove \\ on line 1071\n2. Do one of the following:\n   a. Fix/deprecate/remove sage-gdb-ipython since it depends on SAGE_CLEAN\n   b. Just throw a deprecation warning with SAGE_CLEAN\n3. Turn autoindent back on.\n4. Why add debug=True and confirm_exit=False to default config.\n5. Load the startup file: line 1151",
    "created_at": "2012-05-28T04:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148591",
    "user": "https://github.com/mwhansen"
}
```

Here's a review of Volker's ipython_fixes patch:


1. (minor) Remove \ on line 1071
2. Do one of the following:
   a. Fix/deprecate/remove sage-gdb-ipython since it depends on SAGE_CLEAN
   b. Just throw a deprecation warning with SAGE_CLEAN
3. Turn autoindent back on.
4. Why add debug=True and confirm_exit=False to default config.
5. Load the startup file: line 1151



---

archive/issue_comments_148592.json:
```json
{
    "body": "Initial patch",
    "created_at": "2012-05-28T05:45:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148592",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_148593.json:
```json
{
    "body": "Attachment [trac_12719_dedent.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_dedent.patch) by @vbraun created at 2012-05-28 05:55:02\n\n1, 3, 5: done\n\n4: I removed the debug, but I (and most others, I asked) definitely want to keep `confirm_exit=False`. Yes I really want to quit, geez! \n\n2: I'm in favor of a) and removed it.\n\nI've also renamed trac_13013_ROOT_configuration_files.patch (wrong ticket number) and added a patch to auto-dedent and eval in loops. Now the following works:\n\n```\nsage:         for i in range(3): i\n0\n1\n2\n```",
    "created_at": "2012-05-28T05:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148593",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_12719_dedent.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_dedent.patch) by @vbraun created at 2012-05-28 05:55:02

1, 3, 5: done

4: I removed the debug, but I (and most others, I asked) definitely want to keep `confirm_exit=False`. Yes I really want to quit, geez! 

2: I'm in favor of a) and removed it.

I've also renamed trac_13013_ROOT_configuration_files.patch (wrong ticket number) and added a patch to auto-dedent and eval in loops. Now the following works:

```
sage:         for i in range(3): i
0
1
2
```



---

archive/issue_comments_148594.json:
```json
{
    "body": "Volker's changes look good to me.",
    "created_at": "2012-05-28T06:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148594",
    "user": "https://github.com/mwhansen"
}
```

Volker's changes look good to me.



---

archive/issue_comments_148595.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-28T06:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148595",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148596.json:
```json
{
    "body": "Attachment [trac_12719-crash.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-crash.patch) by @mwhansen created at 2012-05-28 20:25:37",
    "created_at": "2012-05-28T20:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148596",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12719-crash.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-crash.patch) by @mwhansen created at 2012-05-28 20:25:37



---

archive/issue_comments_148597.json:
```json
{
    "body": "Mike's addition of  trac_12719-crash.patch looks *great* to me as an addition.",
    "created_at": "2012-05-28T20:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148597",
    "user": "https://github.com/williamstein"
}
```

Mike's addition of  trac_12719-crash.patch looks *great* to me as an addition.



---

archive/issue_comments_148598.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-05-29T00:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148598",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148599.json:
```json
{
    "body": "Unfortunately, this doesn't apply to sage-5.1.beta1:\n\n```\napplying trac_12719.patch\npatching file doc/en/reference/misc.rst\nHunk #1 succeeded at 30 with fuzz 2 (offset 2 lines).\npatching file sage/misc/interpreter.py\nHunk #1 FAILED at 0\nHunk #3 FAILED at 271\nHunk #4 FAILED at 385\nHunk #5 FAILED at 449\n4 out of 5 hunks FAILED -- saving rejects to file sage/misc/interpreter.py.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh trac_12719.patch\n```",
    "created_at": "2012-05-29T00:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148599",
    "user": "https://github.com/jdemeyer"
}
```

Unfortunately, this doesn't apply to sage-5.1.beta1:

```
applying trac_12719.patch
patching file doc/en/reference/misc.rst
Hunk #1 succeeded at 30 with fuzz 2 (offset 2 lines).
patching file sage/misc/interpreter.py
Hunk #1 FAILED at 0
Hunk #3 FAILED at 271
Hunk #4 FAILED at 385
Hunk #5 FAILED at 449
4 out of 5 hunks FAILED -- saving rejects to file sage/misc/interpreter.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac_12719.patch
```



---

archive/issue_comments_148600.json:
```json
{
    "body": "I've rebased this on top of #11817.",
    "created_at": "2012-05-29T01:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148600",
    "user": "https://github.com/mwhansen"
}
```

I've rebased this on top of #11817.



---

archive/issue_comments_148601.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-29T01:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148601",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148602.json:
```json
{
    "body": "Now it applies but I get documentation errors:\n\n```\ndochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:12: WARNING: Block quote ends without a blank line; unexpected unindent.\ndochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:8: WARNING: Block quote ends without a blank line; unexpected unindent.\ndochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:8: WARNING: Block quote ends without a blank line; unexpected unindent.\ndochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:11: WARNING: Definition list ends without a blank line; unexpected unindent.\ndochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:13: ERROR: Unexpected indentation.\n```",
    "created_at": "2012-05-30T05:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148602",
    "user": "https://github.com/jdemeyer"
}
```

Now it applies but I get documentation errors:

```
dochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:12: WARNING: Block quote ends without a blank line; unexpected unindent.
dochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:8: WARNING: Block quote ends without a blank line; unexpected unindent.
dochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:8: WARNING: Block quote ends without a blank line; unexpected unindent.
dochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:11: WARNING: Definition list ends without a blank line; unexpected unindent.
dochtml.log:/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python2.7/site-packages/sage/misc/interpreter.py:docstring of sage.misc.interpreter:13: ERROR: Unexpected indentation.
```



---

archive/issue_comments_148603.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-30T05:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148603",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148604.json:
```json
{
    "body": "Also, [attachment:trac_12719-scripts.patch] needs a commit message.",
    "created_at": "2012-05-30T05:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148604",
    "user": "https://github.com/jdemeyer"
}
```

Also, [attachment:trac_12719-scripts.patch] needs a commit message.



---

archive/issue_comments_148605.json:
```json
{
    "body": "It seems that double question mark, like `trace??`, doesn't bring up the source code anymore, but just brings up the docstring.  It seems that trac_12719_ipython_fixes.patch broke this (double question marks work with just the first two patches, but not after that third patch).",
    "created_at": "2012-06-08T03:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148605",
    "user": "https://github.com/jasongrout"
}
```

It seems that double question mark, like `trace??`, doesn't bring up the source code anymore, but just brings up the docstring.  It seems that trac_12719_ipython_fixes.patch broke this (double question marks work with just the first two patches, but not after that third patch).



---

archive/issue_comments_148606.json:
```json
{
    "body": "Add two more patches to get the new IPython 0.13beta1 spkg above to work.",
    "created_at": "2012-06-20T13:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148606",
    "user": "https://github.com/jasongrout"
}
```

Add two more patches to get the new IPython 0.13beta1 spkg above to work.



---

archive/issue_comments_148607.json:
```json
{
    "body": "I rebased [attachment:trac_12719_ROOT_configuration_files.patch] to sage 5.1beta6",
    "created_at": "2012-06-25T16:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148607",
    "user": "https://github.com/jasongrout"
}
```

I rebased [attachment:trac_12719_ROOT_configuration_files.patch] to sage 5.1beta6



---

archive/issue_comments_148608.json:
```json
{
    "body": "I upgraded the spkg to 0.13, which was just released today.",
    "created_at": "2012-06-30T16:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148608",
    "user": "https://github.com/jasongrout"
}
```

I upgraded the spkg to 0.13, which was just released today.



---

archive/issue_comments_148609.json:
```json
{
    "body": "Replying to [comment:49 was]:\n> In Sage before this patch, the sage notebook, the Python command line, etc., we have:\n> \n> ```\n> for i in range(10):\n>     i\n> ```\n> outputs the numbers up to 10.\n> \n> With the new Ipython spkg, etc., we don't.  \n> \n> \n> ```\n> sage: for i in range(10): i\n> sage: \n> Exiting Sage (CPU time 0m0.07s, Wall time 2m3.22s).\n> blastoff:sage wstein$ sage -ipython\n> Python 2.7.2 (default, May 17 2012, 13:12:30) \n> In [1]: for i in range(10): i\n> In [2]: \n> ```\n> \n> I'm disappointed, especially because I thought this through and in sagews I recently wrote code so this works correctly in a single cell, even if there are several instances of this.  It's a matter of passing the 'single' option to exec, as is documented in the Python reference.  I wonder why they screwed this up in Ipython 0.12...?\n> \n> Anyway, I'm not saying this is a show stopper at all - I want the new ipython in sage.  I'm just a little concerned that literally the first thing I tried shows that they made what I consider a bad design choice.  Hopefully it was just bad luck. \n\n\nFernando Perez responded: \n\nBTW, regarding William's comment, that was not a mistake or omission: it was a very deliberate choice we made after lots of thought. Given that we manage numbered prompts and history, and that matplotlib produces so many plots as side effects, after much experimentation we found it worked much better to only execute with 'interactive' mode the last block.\n\nSage doesn't distinguish stdout from python sys.displayhook, so the opposite behavior may be more desirable, but we actually consider that a 'bad design choice' of sage, because it loses an important distinction and the cache management of output history.\n\nSo in summary: our choice is actually sensible and consistent given IPython's internal design :)",
    "created_at": "2012-06-30T17:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148609",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:49 was]:
> In Sage before this patch, the sage notebook, the Python command line, etc., we have:
> 
> ```
> for i in range(10):
>     i
> ```
> outputs the numbers up to 10.
> 
> With the new Ipython spkg, etc., we don't.  
> 
> 
> ```
> sage: for i in range(10): i
> sage: 
> Exiting Sage (CPU time 0m0.07s, Wall time 2m3.22s).
> blastoff:sage wstein$ sage -ipython
> Python 2.7.2 (default, May 17 2012, 13:12:30) 
> In [1]: for i in range(10): i
> In [2]: 
> ```
> 
> I'm disappointed, especially because I thought this through and in sagews I recently wrote code so this works correctly in a single cell, even if there are several instances of this.  It's a matter of passing the 'single' option to exec, as is documented in the Python reference.  I wonder why they screwed this up in Ipython 0.12...?
> 
> Anyway, I'm not saying this is a show stopper at all - I want the new ipython in sage.  I'm just a little concerned that literally the first thing I tried shows that they made what I consider a bad design choice.  Hopefully it was just bad luck. 


Fernando Perez responded: 

BTW, regarding William's comment, that was not a mistake or omission: it was a very deliberate choice we made after lots of thought. Given that we manage numbered prompts and history, and that matplotlib produces so many plots as side effects, after much experimentation we found it worked much better to only execute with 'interactive' mode the last block.

Sage doesn't distinguish stdout from python sys.displayhook, so the opposite behavior may be more desirable, but we actually consider that a 'bad design choice' of sage, because it loses an important distinction and the cache management of output history.

So in summary: our choice is actually sensible and consistent given IPython's internal design :)



---

archive/issue_comments_148610.json:
```json
{
    "body": "Fernando:  I looked in the IPython source, and it seems that IPython is a little more subtle than mentioned above.  By default, it only executes the last block as interactive (compile in 'single' mode) *if it is an expression*. In Sage, we (by default) execute the last block always in 'single' mode.  I think that is the difference here.\n\nGiven that (and if I understood correctly), could you explain again your reasoning for choosing to not compile in 'single' mode if it isn't an expression?\n\nNote to self for future reference: `for i in range(10): i` invokes sys.displayhook 10 times to display i if compiled in 'single' mode.",
    "created_at": "2012-06-30T18:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148610",
    "user": "https://github.com/jasongrout"
}
```

Fernando:  I looked in the IPython source, and it seems that IPython is a little more subtle than mentioned above.  By default, it only executes the last block as interactive (compile in 'single' mode) *if it is an expression*. In Sage, we (by default) execute the last block always in 'single' mode.  I think that is the difference here.

Given that (and if I understood correctly), could you explain again your reasoning for choosing to not compile in 'single' mode if it isn't an expression?

Note to self for future reference: `for i in range(10): i` invokes sys.displayhook 10 times to display i if compiled in 'single' mode.



---

archive/issue_comments_148611.json:
```json
{
    "body": "Also, note to William: it is an easy option to set to have IPython *always* execute the last block in interactive mode.  It's just not the default.",
    "created_at": "2012-06-30T18:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148611",
    "user": "https://github.com/jasongrout"
}
```

Also, note to William: it is an easy option to set to have IPython *always* execute the last block in interactive mode.  It's just not the default.



---

archive/issue_comments_148612.json:
```json
{
    "body": "Replying to [comment:76 jason]:\n> Fernando:  I looked in the IPython source, and it seems that IPython is a little more subtle than mentioned above.  By default, it only executes the last block as interactive (compile in 'single' mode) *if it is an expression*. In Sage, we (by default) execute the last block always in 'single' mode.  I think that is the difference here.\n> \n> Given that (and if I understood correctly), could you explain again your reasoning for choosing to not compile in 'single' mode if it isn't an expression?\n\n\nAnd here is Fernando's response:\n\nPrecisely so that if the last block has a loop, it doesn't produce multiple `Out [NN]` cells.  We want to keep a one-to-one mapping between a cell and its output.  For example it's quite common to write code like:\n\n```\nfor i in x:\n  plot(x[i], label='blah_i')\n```\n\nIf we compile that as 'single', we'd get all the Matplotlib line collection results piling up at the bottom, one for each plot call.\n\nWe played a *lot* with various options, and settled on this behavior after much experimentation.  After 2 years of using it, I remain convinced it's the right solution *for us*.  Not to say that Sage can't make a different choice that works better for you guys, of course!",
    "created_at": "2012-06-30T18:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148612",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:76 jason]:
> Fernando:  I looked in the IPython source, and it seems that IPython is a little more subtle than mentioned above.  By default, it only executes the last block as interactive (compile in 'single' mode) *if it is an expression*. In Sage, we (by default) execute the last block always in 'single' mode.  I think that is the difference here.
> 
> Given that (and if I understood correctly), could you explain again your reasoning for choosing to not compile in 'single' mode if it isn't an expression?


And here is Fernando's response:

Precisely so that if the last block has a loop, it doesn't produce multiple `Out [NN]` cells.  We want to keep a one-to-one mapping between a cell and its output.  For example it's quite common to write code like:

```
for i in x:
  plot(x[i], label='blah_i')
```

If we compile that as 'single', we'd get all the Matplotlib line collection results piling up at the bottom, one for each plot call.

We played a *lot* with various options, and settled on this behavior after much experimentation.  After 2 years of using it, I remain convinced it's the right solution *for us*.  Not to say that Sage can't make a different choice that works better for you guys, of course!



---

archive/issue_comments_148613.json:
```json
{
    "body": "To change this, we just need to set `ast_node_interactivity` to `\"last\"` in the InteractiveShell.",
    "created_at": "2012-06-30T18:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148613",
    "user": "https://github.com/jasongrout"
}
```

To change this, we just need to set `ast_node_interactivity` to `"last"` in the InteractiveShell.



---

archive/issue_comments_148614.json:
```json
{
    "body": "Replying to [comment:2 fbissey]:\n> Would be nice but we need some porting, here is what typically happen if you try to use ipython-0.12 with sage:\n> \n> ```\n> $ sage\n> ----------------------------------------------------------------------\n> | Sage Version 4.7.2, Release Date: 2011-10-29                       |\n> | Type notebook() for the GUI, and license() for information.        |\n> ----------------------------------------------------------------------\n> Traceback (most recent call last):\n>   File \"/usr/bin/sage-ipython\", line 19, in <module>\n>     from IPython.CrashHandler import CrashHandler\n> ImportError: No module named CrashHandler\n> ```\n\n\n\nHi fbissey, sorry for hijacking this a bit, but i had exactly the same problem over and over again. What I just found out (and I think it really helps) is to temporarily disable the paths containing \".local\" in sys.path in the sage-ipython file. The reason is, that ipython seems to import the \"site package\" (disable it for pure python via \"-S\"), because that's where my ipython 0.13 is.\n\nSo, by adding this to sage-ipython you I have both at the same time:\n\n```\n~~~ after import sys\noldpath = sys.path\nsys.path = filter(lambda s : '.local' not in s, sys.path)\nimport IPython\nsys.path = oldpath\n```",
    "created_at": "2012-07-14T20:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148614",
    "user": "https://github.com/haraldschilly"
}
```

Replying to [comment:2 fbissey]:
> Would be nice but we need some porting, here is what typically happen if you try to use ipython-0.12 with sage:
> 
> ```
> $ sage
> ----------------------------------------------------------------------
> | Sage Version 4.7.2, Release Date: 2011-10-29                       |
> | Type notebook() for the GUI, and license() for information.        |
> ----------------------------------------------------------------------
> Traceback (most recent call last):
>   File "/usr/bin/sage-ipython", line 19, in <module>
>     from IPython.CrashHandler import CrashHandler
> ImportError: No module named CrashHandler
> ```



Hi fbissey, sorry for hijacking this a bit, but i had exactly the same problem over and over again. What I just found out (and I think it really helps) is to temporarily disable the paths containing ".local" in sys.path in the sage-ipython file. The reason is, that ipython seems to import the "site package" (disable it for pure python via "-S"), because that's where my ipython 0.13 is.

So, by adding this to sage-ipython you I have both at the same time:

```
~~~ after import sys
oldpath = sys.path
sys.path = filter(lambda s : '.local' not in s, sys.path)
import IPython
sys.path = oldpath
```



---

archive/issue_comments_148615.json:
```json
{
    "body": "Attachment [trac_12719_ipython_fixes.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_ipython_fixes.patch) by @jasongrout created at 2012-07-17 14:29:42\n\nUpdated patch",
    "created_at": "2012-07-17T14:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148615",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac_12719_ipython_fixes.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_ipython_fixes.patch) by @jasongrout created at 2012-07-17 14:29:42

Updated patch



---

archive/issue_comments_148616.json:
```json
{
    "body": "I rebased the only rejected patch for 5.2beta1",
    "created_at": "2012-07-17T14:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148616",
    "user": "https://github.com/jasongrout"
}
```

I rebased the only rejected patch for 5.2beta1



---

archive/issue_comments_148617.json:
```json
{
    "body": "My 2 cents, after I forced myself to use this for the last few weeks on my laptop.  I have found the new ipython to be pretty annoying.  The cut and paste behavior and lack of autoindent at the command line is pretty painful.   The thing that made me finally give up and revert to the old 0.10 ipython was when I hit control-c at the wrong moment when starting Sage, and somehow the ipython history sqlite database got in a weird locked state.  Nothing I could think to do (including deleting $HOME/.sage/ipython) got this unstuck.  Maybe rebooting would have worked; I don't know.   I'm concerned about how stable and well-tested in the wild the new ipython is.     Proceed with caution.",
    "created_at": "2012-07-30T15:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148617",
    "user": "https://github.com/williamstein"
}
```

My 2 cents, after I forced myself to use this for the last few weeks on my laptop.  I have found the new ipython to be pretty annoying.  The cut and paste behavior and lack of autoindent at the command line is pretty painful.   The thing that made me finally give up and revert to the old 0.10 ipython was when I hit control-c at the wrong moment when starting Sage, and somehow the ipython history sqlite database got in a weird locked state.  Nothing I could think to do (including deleting $HOME/.sage/ipython) got this unstuck.  Maybe rebooting would have worked; I don't know.   I'm concerned about how stable and well-tested in the wild the new ipython is.     Proceed with caution.



---

archive/issue_comments_148618.json:
```json
{
    "body": "Working cut&past and working autoindent are contradictory goals. The terminal just sees a stream of characters, you either inject indentation or not. AFAIR I turned off auto-indent, we could turn that back on. Breaks pasting of indented text, of course.\n\nThe ipython dir is now versioned, you should have deleted `$DOT_SAGE/ipython-0.12` / `$DOT_SAGE/ipython-0.13`",
    "created_at": "2012-07-30T15:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148618",
    "user": "https://github.com/vbraun"
}
```

Working cut&past and working autoindent are contradictory goals. The terminal just sees a stream of characters, you either inject indentation or not. AFAIR I turned off auto-indent, we could turn that back on. Breaks pasting of indented text, of course.

The ipython dir is now versioned, you should have deleted `$DOT_SAGE/ipython-0.12` / `$DOT_SAGE/ipython-0.13`



---

archive/issue_comments_148619.json:
```json
{
    "body": "PS: Maybe you can upload your broken ipython dir somewhere, this would be a good testcase to catch the sqlite error...",
    "created_at": "2012-07-30T15:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148619",
    "user": "https://github.com/vbraun"
}
```

PS: Maybe you can upload your broken ipython dir somewhere, this would be a good testcase to catch the sqlite error...



---

archive/issue_comments_148620.json:
```json
{
    "body": "IMO, leave auto-indent on, and use `%paste` or `%cpaste` when you want to paste. `%paste` tries to automatically get the contents of your clipboard. If that's not working for whatever reason, `%cpaste` creates a prompt where you can paste text verbatim, which IPython doesn't read until you end input with Ctrl+D or a line containing only the text \"--\".",
    "created_at": "2012-07-30T15:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148620",
    "user": "https://github.com/kini"
}
```

IMO, leave auto-indent on, and use `%paste` or `%cpaste` when you want to paste. `%paste` tries to automatically get the contents of your clipboard. If that's not working for whatever reason, `%cpaste` creates a prompt where you can paste text verbatim, which IPython doesn't read until you end input with Ctrl+D or a line containing only the text "--".



---

archive/issue_comments_148621.json:
```json
{
    "body": "Replying to [comment:86 kini]:\n> IMO, leave auto-indent on, and use `%paste` or `%cpaste` when you want to paste.\n\n\nFor the record, thats not how I use the commandline. I paste code all the time, but I almost never enter multi-line statements manually. So I'd rather have autoindent off by default (and no need for `%cpaste`), and use `%autoindent` if I want it on. Though thats of course a matter of personal preferences, and I'm happy with whatever the majority prefers...",
    "created_at": "2012-07-30T16:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148621",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:86 kini]:
> IMO, leave auto-indent on, and use `%paste` or `%cpaste` when you want to paste.


For the record, thats not how I use the commandline. I paste code all the time, but I almost never enter multi-line statements manually. So I'd rather have autoindent off by default (and no need for `%cpaste`), and use `%autoindent` if I want it on. Though thats of course a matter of personal preferences, and I'm happy with whatever the majority prefers...



---

archive/issue_comments_148622.json:
```json
{
    "body": "Replying to [comment:87 vbraun]:\n> Replying to [comment:86 kini]:\n> > IMO, leave auto-indent on, and use `%paste` or `%cpaste` when you want to paste.\n\n> \n> For the record, thats not how I use the commandline. I paste code all the time, but I almost never enter multi-line statements manually. So I'd rather have autoindent off by default (and no need for `%cpaste`), and use `%autoindent` if I want it on. Though thats of course a matter of personal preferences, and I'm happy with whatever the majority prefers...\n\n\nAt least it is configurable, right?   I think it is best not to change the default from what it is already in all previous versions of Sage, whether or not that is what the majority prefers (unless it is a huge majority).    I'm not fan of changing UI's on people unless it is absolutely necessary.",
    "created_at": "2012-07-30T16:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148622",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:87 vbraun]:
> Replying to [comment:86 kini]:
> > IMO, leave auto-indent on, and use `%paste` or `%cpaste` when you want to paste.

> 
> For the record, thats not how I use the commandline. I paste code all the time, but I almost never enter multi-line statements manually. So I'd rather have autoindent off by default (and no need for `%cpaste`), and use `%autoindent` if I want it on. Though thats of course a matter of personal preferences, and I'm happy with whatever the majority prefers...


At least it is configurable, right?   I think it is best not to change the default from what it is already in all previous versions of Sage, whether or not that is what the majority prefers (unless it is a huge majority).    I'm not fan of changing UI's on people unless it is absolutely necessary.



---

archive/issue_comments_148623.json:
```json
{
    "body": "Well IPythons defaults changed, we didn't just change stuff for the fun of it. For starters, vanilla IPython now disallows any superfluous indentation, i.e. \n\n```\nIn [1]: 1\nOut[1]: 1\n\nIn [2]:  1\nIndentationError: unexpected indent (<ipython-input-2-0066badbf200>, line 1)\n```",
    "created_at": "2012-07-30T16:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148623",
    "user": "https://github.com/vbraun"
}
```

Well IPythons defaults changed, we didn't just change stuff for the fun of it. For starters, vanilla IPython now disallows any superfluous indentation, i.e. 

```
In [1]: 1
Out[1]: 1

In [2]:  1
IndentationError: unexpected indent (<ipython-input-2-0066badbf200>, line 1)
```



---

archive/issue_comments_148624.json:
```json
{
    "body": "Two more issues:\n\n- when Sage starts, any lines in my init.sage file are echoed to the screen after the first \"sage:\" prompt. They aren't executed until I hit the return key:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: # Here is the beginning of init.sage.\n| Sage Version 5.2, Release Date: 2012-07-25                         |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n2+2\n\n# Here is another comment\n\na = 5\n\n# Here is the end of init.sage.\n```\n At this point, hitting <RETURN> inserts a 4, a newline, and the \"sage:\" prompt, and `a` is defined to be 5.\n\n- when I evaluate or `plot` a graphics object, two plot windows are opened:\n\n```\nsage: P = plot(sin(x), (x, 0, 10))\nsage: P  # opens up two windows showing the same plot. Note also the blank line.\n\nsage: plot(P) # also opens up two windows.\n\nsage: show(P)  # opens up only one window.\n```",
    "created_at": "2012-07-30T21:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148624",
    "user": "https://github.com/jhpalmieri"
}
```

Two more issues:

- when Sage starts, any lines in my init.sage file are echoed to the screen after the first "sage:" prompt. They aren't executed until I hit the return key:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: # Here is the beginning of init.sage.
| Sage Version 5.2, Release Date: 2012-07-25                         |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
2+2

# Here is another comment

a = 5

# Here is the end of init.sage.
```
 At this point, hitting <RETURN> inserts a 4, a newline, and the "sage:" prompt, and `a` is defined to be 5.

- when I evaluate or `plot` a graphics object, two plot windows are opened:

```
sage: P = plot(sin(x), (x, 0, 10))
sage: P  # opens up two windows showing the same plot. Note also the blank line.

sage: plot(P) # also opens up two windows.

sage: show(P)  # opens up only one window.
```



---

archive/issue_comments_148625.json:
```json
{
    "body": "Regarding indentation, autoindent being on breaks sage inside Emacs (dumb terminal).  So I think it should be off, at least in a dumb terminal, until/unless I can figure out how to fix this in Emacs.  I haven't really looked into it at all, so it may be easy to fix inside Emacs by setting some environment variables or something.  See #10504.",
    "created_at": "2012-08-01T12:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148625",
    "user": "https://github.com/gvol"
}
```

Regarding indentation, autoindent being on breaks sage inside Emacs (dumb terminal).  So I think it should be off, at least in a dumb terminal, until/unless I can figure out how to fix this in Emacs.  I haven't really looked into it at all, so it may be easy to fix inside Emacs by setting some environment variables or something.  See #10504.



---

archive/issue_comments_148626.json:
```json
{
    "body": "+1 for autoindent being on by default.  That helps what is probably the vast majority of the cases---interactively typing into the command line.",
    "created_at": "2012-08-01T13:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148626",
    "user": "https://github.com/jasongrout"
}
```

+1 for autoindent being on by default.  That helps what is probably the vast majority of the cases---interactively typing into the command line.



---

archive/issue_comments_148627.json:
```json
{
    "body": "I'm having a weird problem when I use IPython.parallel in sage. Here's what happens:\n\n```\nfrom IPython.parallel import Client\nrc = Client('/home/seshu/.sage/ipython-new/profile_default/security/ipcontroller-client.json')\ndview = rc[:]\ndview.map_sync(lambda x: x**10, range(32))\n[0:apply]: \n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)<string> in <module>()\n<ipython-input-4-ad199b8d76dc> in <lambda>(x)\nNameError: global name 'Integer' is not defined\n```\n\nIf I do anything that doesn't involve integers like dview.map_sync(lambda x: \"hi\", range(32)), it works fine. Sorry if this isn't the appropriate place to ask these questions. I wasn't sure where to ask since this is a bit bleeding edge. I would like to be able to use IPython.parallel from the sage notebook if possible.",
    "created_at": "2012-08-12T23:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148627",
    "user": "https://trac.sagemath.org/admin/accounts/users/broken_symlink"
}
```

I'm having a weird problem when I use IPython.parallel in sage. Here's what happens:

```
from IPython.parallel import Client
rc = Client('/home/seshu/.sage/ipython-new/profile_default/security/ipcontroller-client.json')
dview = rc[:]
dview.map_sync(lambda x: x**10, range(32))
[0:apply]: 
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)<string> in <module>()
<ipython-input-4-ad199b8d76dc> in <lambda>(x)
NameError: global name 'Integer' is not defined
```

If I do anything that doesn't involve integers like dview.map_sync(lambda x: "hi", range(32)), it works fine. Sorry if this isn't the appropriate place to ask these questions. I wasn't sure where to ask since this is a bit bleeding edge. I would like to be able to use IPython.parallel from the sage notebook if possible.



---

archive/issue_comments_148628.json:
```json
{
    "body": "The ipython engines need to import the sage modules. The fix is dview.execute(\"from sage.all import *\"). Also I did sage -sh ipcluster start.",
    "created_at": "2012-08-13T16:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148628",
    "user": "https://trac.sagemath.org/admin/accounts/users/broken_symlink"
}
```

The ipython engines need to import the sage modules. The fix is dview.execute("from sage.all import *"). Also I did sage -sh ipcluster start.



---

archive/issue_comments_148629.json:
```json
{
    "body": "Just FYI, for the *next* version (so not an issue on this ticket), https://github.com/ipython/ipython/pull/2299 broke Sage, I think  by getting rid of PrefilterTransformer tricks.",
    "created_at": "2012-08-25T14:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148629",
    "user": "https://github.com/jasongrout"
}
```

Just FYI, for the *next* version (so not an issue on this ticket), https://github.com/ipython/ipython/pull/2299 broke Sage, I think  by getting rid of PrefilterTransformer tricks.



---

archive/issue_comments_148630.json:
```json
{
    "body": "So I think that the only issue with this ticket is turning back on auto-indentation and getting ?? to show the source code?  Any other issues?\n\nI think the parallel issues above should be moved to another ticket.",
    "created_at": "2012-08-25T14:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148630",
    "user": "https://github.com/jasongrout"
}
```

So I think that the only issue with this ticket is turning back on auto-indentation and getting ?? to show the source code?  Any other issues?

I think the parallel issues above should be moved to another ticket.



---

archive/issue_comments_148631.json:
```json
{
    "body": "Note: ?? shows the source code fine, it seems, in the notebook (at least there doesn't seem to be a regression; ?? shows source when doing tab completion, but not on evaluating, just like before the python upgrade).  It is a regression on the command line, though.",
    "created_at": "2012-08-25T14:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148631",
    "user": "https://github.com/jasongrout"
}
```

Note: ?? shows the source code fine, it seems, in the notebook (at least there doesn't seem to be a regression; ?? shows source when doing tab completion, but not on evaluating, just like before the python upgrade).  It is a regression on the command line, though.



---

archive/issue_comments_148632.json:
```json
{
    "body": "There are the issues [comment:90 I mentioned above]. Can anyone else reproduce them?",
    "created_at": "2012-08-25T14:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148632",
    "user": "https://github.com/jhpalmieri"
}
```

There are the issues [comment:90 I mentioned above]. Can anyone else reproduce them?



---

archive/issue_comments_148633.json:
```json
{
    "body": "The parallel issues only seem to effect the notebook. I've successfully gotten ipython.parallel and sage to run on a small 24 core amazon ec2 cluster, using ssh with the ipython 0.13.1 branch on github. According to the ipython guys, the ssh launcher in 0.13 is broken. I kinda have some idea of whats going with the parallel issues and the notebook as well, but i'm not sure how to fix it. I can write something for how to setup sage with ipython engines started over ssh if this package gets updated to 0.13.1.",
    "created_at": "2012-08-26T03:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148633",
    "user": "https://trac.sagemath.org/admin/accounts/users/broken_symlink"
}
```

The parallel issues only seem to effect the notebook. I've successfully gotten ipython.parallel and sage to run on a small 24 core amazon ec2 cluster, using ssh with the ipython 0.13.1 branch on github. According to the ipython guys, the ssh launcher in 0.13 is broken. I kinda have some idea of whats going with the parallel issues and the notebook as well, but i'm not sure how to fix it. I can write something for how to setup sage with ipython engines started over ssh if this package gets updated to 0.13.1.



---

archive/issue_comments_148634.json:
```json
{
    "body": "Well, hopefully this gets merged before 0.13.1 comes out.",
    "created_at": "2012-08-26T03:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148634",
    "user": "https://github.com/jasongrout"
}
```

Well, hopefully this gets merged before 0.13.1 comes out.



---

archive/issue_comments_148635.json:
```json
{
    "body": "jhpalmieri, I can confirm both of the issues that you saw.  I'm seeing them too.",
    "created_at": "2012-09-06T23:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148635",
    "user": "https://github.com/jasongrout"
}
```

jhpalmieri, I can confirm both of the issues that you saw.  I'm seeing them too.



---

archive/issue_comments_148636.json:
```json
{
    "body": "actually, it looks like autoindent was turned back on: http://trac.sagemath.org/sage_trac/ticket/12719#comment:52",
    "created_at": "2012-09-06T23:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148636",
    "user": "https://github.com/jasongrout"
}
```

actually, it looks like autoindent was turned back on: http://trac.sagemath.org/sage_trac/ticket/12719#comment:52



---

archive/issue_comments_148637.json:
```json
{
    "body": "Does anyone know where in the code init.sage is run?  I've searched the entire codebase for \"init.sage\" and I'm not finding anything that looks like it is responsible for running the file.",
    "created_at": "2012-09-06T23:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148637",
    "user": "https://github.com/jasongrout"
}
```

Does anyone know where in the code init.sage is run?  I've searched the entire codebase for "init.sage" and I'm not finding anything that looks like it is responsible for running the file.



---

archive/issue_comments_148638.json:
```json
{
    "body": "Ah, I found it.  It's the last line in sage/misc/interpreter.py, the one that says `self.shell.run_cell('%%load \"%s\"'%startup_file)`",
    "created_at": "2012-09-06T23:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148638",
    "user": "https://github.com/jasongrout"
}
```

Ah, I found it.  It's the last line in sage/misc/interpreter.py, the one that says `self.shell.run_cell('%%load "%s"'%startup_file)`



---

archive/issue_comments_148639.json:
```json
{
    "body": "Okay, it looks like the problem is that we punt to the ipython load, which *pastes* the content so you can edit it first: http://ipython.org/ipython-doc/dev/interactive/qtconsole.html#load",
    "created_at": "2012-09-07T00:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148639",
    "user": "https://github.com/jasongrout"
}
```

Okay, it looks like the problem is that we punt to the ipython load, which *pastes* the content so you can edit it first: http://ipython.org/ipython-doc/dev/interactive/qtconsole.html#load



---

archive/issue_comments_148640.json:
```json
{
    "body": "So our conclusion on https://github.com/ipython/ipython/pull/2299 was that Sage should make %load an alias for IPython's %run, and beef up IPython's %run to be able to handle remote files.  In fact, make IPython's %run use the same simple mechanism as IPython's %load would be great (though may not be possible---%run uses file-specific features in python and execfile, etc.)",
    "created_at": "2012-09-07T08:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148640",
    "user": "https://github.com/jasongrout"
}
```

So our conclusion on https://github.com/ipython/ipython/pull/2299 was that Sage should make %load an alias for IPython's %run, and beef up IPython's %run to be able to handle remote files.  In fact, make IPython's %run use the same simple mechanism as IPython's %load would be great (though may not be possible---%run uses file-specific features in python and execfile, etc.)



---

archive/issue_comments_148641.json:
```json
{
    "body": "Is there a reason we didn't use a profile config file for all of our customizations?\n\nI've started a different approach to the customizations we use here: https://github.com/jasongrout/sage-ipython-profile\n\nput these into the .sage/ipython-new directory and then start with `sage -ipython --profile=sage`",
    "created_at": "2012-09-08T19:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148641",
    "user": "https://github.com/jasongrout"
}
```

Is there a reason we didn't use a profile config file for all of our customizations?

I've started a different approach to the customizations we use here: https://github.com/jasongrout/sage-ipython-profile

put these into the .sage/ipython-new directory and then start with `sage -ipython --profile=sage`



---

archive/issue_comments_148642.json:
```json
{
    "body": "Attachment [12719-newipython-take2.patch](tarball://root/attachments/some-uuid/ticket12719/12719-newipython-take2.patch) by @jasongrout created at 2012-09-13 18:53:27",
    "created_at": "2012-09-13T18:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148642",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-newipython-take2.patch](tarball://root/attachments/some-uuid/ticket12719/12719-newipython-take2.patch) by @jasongrout created at 2012-09-13 18:53:27



---

archive/issue_comments_148643.json:
```json
{
    "body": "Okay, I think my \"take2\" patch significantly cleans things up and makes things more modular and more \"IPythonic\".\n\nIn particular, this seems to work nicely: do `sage -ipython notebook` to launch the ipython notebook, then evaluate `%load_ext sage.misc.sage_extension`. All preparsing is turned on, etc.  It's great!\n\nThere should probably be a bit more documentation in the sage_extension file, and full doctests should be run.  But I think it's ready for other people to hammer on it too.\n\nHere is one issue: something broke in `sage -startuptime`.  I'm not sure it's IPython's fault, though.\n\nOh, and I was working from IPython master, not IPython 0.13.  I hope that doesn't put a wrench in the works...",
    "created_at": "2012-09-13T18:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148643",
    "user": "https://github.com/jasongrout"
}
```

Okay, I think my "take2" patch significantly cleans things up and makes things more modular and more "IPythonic".

In particular, this seems to work nicely: do `sage -ipython notebook` to launch the ipython notebook, then evaluate `%load_ext sage.misc.sage_extension`. All preparsing is turned on, etc.  It's great!

There should probably be a bit more documentation in the sage_extension file, and full doctests should be run.  But I think it's ready for other people to hammer on it too.

Here is one issue: something broke in `sage -startuptime`.  I'm not sure it's IPython's fault, though.

Oh, and I was working from IPython master, not IPython 0.13.  I hope that doesn't put a wrench in the works...



---

archive/issue_comments_148644.json:
```json
{
    "body": "Preliminary tests seem to indicate that these patches and the new take work just fine with IPython 0.13 (at least when I revert my IPython git repository).  So it's still probably ready for more people to hammer on this.",
    "created_at": "2012-09-13T19:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148644",
    "user": "https://github.com/jasongrout"
}
```

Preliminary tests seem to indicate that these patches and the new take work just fine with IPython 0.13 (at least when I revert my IPython git repository).  So it's still probably ready for more people to hammer on this.



---

archive/issue_comments_148645.json:
```json
{
    "body": "My take2 patch seems to have solved the double plot window problem.  It also solved the init.sage/load problems, as well as the ?? problem.  So that was all of the issues listed...",
    "created_at": "2012-09-13T20:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148645",
    "user": "https://github.com/jasongrout"
}
```

My take2 patch seems to have solved the double plot window problem.  It also solved the init.sage/load problems, as well as the ?? problem.  So that was all of the issues listed...



---

archive/issue_comments_148646.json:
```json
{
    "body": "Attachment [12719-displayhook.patch](tarball://root/attachments/some-uuid/ticket12719/12719-displayhook.patch) by @jasongrout created at 2012-09-14 12:24:32\n\nSince we now hook into the IPython display hook, we can delete our special display hook.",
    "created_at": "2012-09-14T12:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148646",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-displayhook.patch](tarball://root/attachments/some-uuid/ticket12719/12719-displayhook.patch) by @jasongrout created at 2012-09-14 12:24:32

Since we now hook into the IPython display hook, we can delete our special display hook.



---

archive/issue_comments_148647.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-09-14T12:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148647",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148648.json:
```json
{
    "body": "Fixed the startup issue with new patch to scripts repository",
    "created_at": "2012-09-15T10:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148648",
    "user": "https://github.com/jasongrout"
}
```

Fixed the startup issue with new patch to scripts repository



---

archive/issue_comments_148649.json:
```json
{
    "body": "Attachment [12719-fix-transformer.patch](tarball://root/attachments/some-uuid/ticket12719/12719-fix-transformer.patch) by @jasongrout created at 2012-09-25 12:46:36",
    "created_at": "2012-09-25T12:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148649",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-fix-transformer.patch](tarball://root/attachments/some-uuid/ticket12719/12719-fix-transformer.patch) by @jasongrout created at 2012-09-25 12:46:36



---

archive/issue_comments_148650.json:
```json
{
    "body": "Fix a transforming issue: see http://mail.scipy.org/pipermail/ipython-dev/2012-September/010329.html or the commit message.",
    "created_at": "2012-09-25T12:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148650",
    "user": "https://github.com/jasongrout"
}
```

Fix a transforming issue: see http://mail.scipy.org/pipermail/ipython-dev/2012-September/010329.html or the commit message.



---

archive/issue_comments_148651.json:
```json
{
    "body": "This needs to be rebased to sage-5.4.rc0, in particular #13459.",
    "created_at": "2012-10-05T15:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148651",
    "user": "https://github.com/jdemeyer"
}
```

This needs to be rebased to sage-5.4.rc0, in particular #13459.



---

archive/issue_comments_148652.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-05T15:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148652",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148653.json:
```json
{
    "body": "Also, #13361 includes the change in the startuptime.py patch, so we can delete it.",
    "created_at": "2012-10-10T03:18:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148653",
    "user": "https://github.com/jasongrout"
}
```

Also, #13361 includes the change in the startuptime.py patch, so we can delete it.



---

archive/issue_comments_148654.json:
```json
{
    "body": "rebased to 5.4rc1",
    "created_at": "2012-10-10T03:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148654",
    "user": "https://github.com/jasongrout"
}
```

rebased to 5.4rc1



---

archive/issue_comments_148655.json:
```json
{
    "body": "Attachment [trac_12719-5.1beta1.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-5.1beta1.patch) by @jasongrout created at 2012-10-10 03:37:14\n\nrebased to 5.4rc1",
    "created_at": "2012-10-10T03:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148655",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac_12719-5.1beta1.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-5.1beta1.patch) by @jasongrout created at 2012-10-10 03:37:14

rebased to 5.4rc1



---

archive/issue_comments_148656.json:
```json
{
    "body": "Attachment [trac_12719_remove_sage_gdb_ipython.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_remove_sage_gdb_ipython.patch) by @jasongrout created at 2012-10-10 04:02:08\n\nAdd one more patch so we don't change directories anymore.",
    "created_at": "2012-10-10T04:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148656",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac_12719_remove_sage_gdb_ipython.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_remove_sage_gdb_ipython.patch) by @jasongrout created at 2012-10-10 04:02:08

Add one more patch so we don't change directories anymore.



---

archive/issue_comments_148657.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-10T04:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148657",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148658.json:
```json
{
    "body": "Something that seems to work fine now is starting up sage in the devel/sage directory.  So it seems that the issue discussed in #13361 is fixed in this ipython upgrade.",
    "created_at": "2012-10-10T04:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148658",
    "user": "https://github.com/jasongrout"
}
```

Something that seems to work fine now is starting up sage in the devel/sage directory.  So it seems that the issue discussed in #13361 is fixed in this ipython upgrade.



---

archive/issue_comments_148659.json:
```json
{
    "body": "Attachment [12719-remove-plugin.patch](tarball://root/attachments/some-uuid/ticket12719/12719-remove-plugin.patch) by @jasongrout created at 2012-10-10 04:44:49",
    "created_at": "2012-10-10T04:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148659",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-remove-plugin.patch](tarball://root/attachments/some-uuid/ticket12719/12719-remove-plugin.patch) by @jasongrout created at 2012-10-10 04:44:49



---

archive/issue_comments_148660.json:
```json
{
    "body": "Okay, I think this may be ready for review again.\n\nIt's a big enough change that maybe it would be good to shoot for one of the first patches in the 5.5 release, so it gets plenty of testing???",
    "created_at": "2012-10-10T05:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148660",
    "user": "https://github.com/jasongrout"
}
```

Okay, I think this may be ready for review again.

It's a big enough change that maybe it would be good to shoot for one of the first patches in the 5.5 release, so it gets plenty of testing???



---

archive/issue_comments_148661.json:
```json
{
    "body": "Replying to [comment:41 slabbe]:\n\n> Also, doing `sage -ipython notebook` creates this error :\n> \n> \n> ```\n> $ sage -ipython notebook\n> Traceback (most recent call last):\n> ...\n> ImportError: The IPython Notebook requires tornado >= 2.1.0\n> ```\n\n\nI get this too. Should I just install tornado somehow, or should this be fixed as part of this ticket?\n\nEdit: after installing tornado (with `sage --sh` and `easy_install tornado`), it said I had to install pyzmq. So I did that, and now the notebook runs. It looks very nice, and feels pretty snappy, maybe snappier than the Sage notebook.",
    "created_at": "2012-10-10T05:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148661",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:41 slabbe]:

> Also, doing `sage -ipython notebook` creates this error :
> 
> 
> ```
> $ sage -ipython notebook
> Traceback (most recent call last):
> ...
> ImportError: The IPython Notebook requires tornado >= 2.1.0
> ```


I get this too. Should I just install tornado somehow, or should this be fixed as part of this ticket?

Edit: after installing tornado (with `sage --sh` and `easy_install tornado`), it said I had to install pyzmq. So I did that, and now the notebook runs. It looks very nice, and feels pretty snappy, maybe snappier than the Sage notebook.



---

archive/issue_comments_148662.json:
```json
{
    "body": "Yes, tornado and zmq (pyzmq) are required for the ipython notebook.  That's not part of this ticket.\n\nAnd yes, the ipython notebook is very nice.  After loading it up, try doing \n\n```\n%load_ext sage.misc.sage_extension\n```\nto get some sage goodness, like the preparser, etc.!",
    "created_at": "2012-10-10T05:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148662",
    "user": "https://github.com/jasongrout"
}
```

Yes, tornado and zmq (pyzmq) are required for the ipython notebook.  That's not part of this ticket.

And yes, the ipython notebook is very nice.  After loading it up, try doing 

```
%load_ext sage.misc.sage_extension
```
to get some sage goodness, like the preparser, etc.!



---

archive/issue_comments_148663.json:
```json
{
    "body": "Replying to [comment:122 jason]:\n> Something that seems to work fine now is starting up sage in the devel/sage directory.\n\nFYI: this was fixed by #13459.",
    "created_at": "2012-10-10T06:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148663",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:122 jason]:
> Something that seems to work fine now is starting up sage in the devel/sage directory.

FYI: this was fixed by #13459.



---

archive/issue_comments_148664.json:
```json
{
    "body": "Replying to [comment:127 jdemeyer]:\n> Replying to [comment:122 jason]:\n> > Something that seems to work fine now is starting up sage in the devel/sage directory.\n\n> FYI: this was fixed by #13459.\n\nBut I reverted the \"import sage\" that #13459 does in [attachment:trac_12719-scripts.patch], and it still works fine for me (running sage in devel/sage and then `import sage` actually imports the site-packages sage).  Maybe IPython changed its handling of sys.path.  What I'm saying is that we should test that my reverting of part of #13459 (the part where we imported sage in sage-ipython) actually does what I think it does.",
    "created_at": "2012-10-10T13:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148664",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:127 jdemeyer]:
> Replying to [comment:122 jason]:
> > Something that seems to work fine now is starting up sage in the devel/sage directory.

> FYI: this was fixed by #13459.

But I reverted the "import sage" that #13459 does in [attachment:trac_12719-scripts.patch], and it still works fine for me (running sage in devel/sage and then `import sage` actually imports the site-packages sage).  Maybe IPython changed its handling of sys.path.  What I'm saying is that we should test that my reverting of part of #13459 (the part where we imported sage in sage-ipython) actually does what I think it does.



---

archive/issue_comments_148665.json:
```json
{
    "body": "I'm getting doctest failures because of how lists of matrices are printed. For example, with matrix2.pyx:\n\n```\nFile \".../sage-5.4.rc1/devel/sage/sage/matrix/matrix2.pyx\", line 11627:\n    sage: (d, u, v)\nExpected:\n    (\n    [     1      0]  [ 1  0]  [ 1 -w]\n    [     0 -w + 9], [-w  1], [ 0  1]\n    )\nGot:\n    ([     1      0]\n    [     0 -w + 9], [ 1  0]\n    [-w  1], [ 1 -w]\n    [ 0  1])\n```\nThat file has 7 failures altogether. Is this because you turned off Sage's displayhook?",
    "created_at": "2012-10-10T20:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148665",
    "user": "https://github.com/jhpalmieri"
}
```

I'm getting doctest failures because of how lists of matrices are printed. For example, with matrix2.pyx:

```
File ".../sage-5.4.rc1/devel/sage/sage/matrix/matrix2.pyx", line 11627:
    sage: (d, u, v)
Expected:
    (
    [     1      0]  [ 1  0]  [ 1 -w]
    [     0 -w + 9], [-w  1], [ 0  1]
    )
Got:
    ([     1      0]
    [     0 -w + 9], [ 1  0]
    [-w  1], [ 1 -w]
    [ 0  1])
```
That file has 7 failures altogether. Is this because you turned off Sage's displayhook?



---

archive/issue_comments_148666.json:
```json
{
    "body": "Interesting.  I thought I used Sage's displayhook (I know I was at one time anyway), but I've also noticed the same problems on my install with printing tuples of matrices and it's been frustrating to me.  I'll take a look at it.",
    "created_at": "2012-10-10T21:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148666",
    "user": "https://github.com/jasongrout"
}
```

Interesting.  I thought I used Sage's displayhook (I know I was at one time anyway), but I've also noticed the same problems on my install with printing tuples of matrices and it's been frustrating to me.  I'll take a look at it.



---

archive/issue_comments_148667.json:
```json
{
    "body": "[attachment:12719-displayhook.patch] looks relevant, in particular removing the lines\n\n```\nimport sage.misc.displayhook  \nsage.misc.displayhook.install() \n```\nand removing the corresponding functions from sage/misc/displayhook.py. But I've never worked with this aspect of Sage before.",
    "created_at": "2012-10-10T21:29:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148667",
    "user": "https://github.com/jhpalmieri"
}
```

[attachment:12719-displayhook.patch] looks relevant, in particular removing the lines

```
import sage.misc.displayhook  
sage.misc.displayhook.install() 
```
and removing the corresponding functions from sage/misc/displayhook.py. But I've never worked with this aspect of Sage before.



---

archive/issue_comments_148668.json:
```json
{
    "body": "When I use either `time` or `%time`, the rest of the line doesn't seem to be preparsed: try\n\n```\nsage: srange(1/10, 1/2, 1/10)\n[1/10, 1/5, 3/10, 2/5]\n```\nvs.\n\n```\nsage: %time srange(1/10, 1/2, 1/10)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: srange() step argument must not be zero\n```\nOr even\n\n```\nsage: %time 1/10\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\nWall time: 0.00 s\n0  <-- note the answer!\n```",
    "created_at": "2012-10-10T22:21:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148668",
    "user": "https://github.com/jhpalmieri"
}
```

When I use either `time` or `%time`, the rest of the line doesn't seem to be preparsed: try

```
sage: srange(1/10, 1/2, 1/10)
[1/10, 1/5, 3/10, 2/5]
```
vs.

```
sage: %time srange(1/10, 1/2, 1/10)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: srange() step argument must not be zero
```
Or even

```
sage: %time 1/10
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
0  <-- note the answer!
```



---

archive/issue_comments_148669.json:
```json
{
    "body": "The displayhook is activated when Sage is run (try running those matrix doctests from the command line).  The problem is that the doctesting framework does *not* use the interactive version of Sage; it seems to use straight python.  So the display hook is not set.\n\nIt seems that the display hook used to be set when just importing Sage as a library, maybe?  If so, I think that's the wrong approach.  Importing a library shouldn't obliterate the display hook.\n\nSo it sounds like we need to make the doctesting framework load the right Sage things, like the preparser, the display hook, etc.",
    "created_at": "2012-10-10T23:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148669",
    "user": "https://github.com/jasongrout"
}
```

The displayhook is activated when Sage is run (try running those matrix doctests from the command line).  The problem is that the doctesting framework does *not* use the interactive version of Sage; it seems to use straight python.  So the display hook is not set.

It seems that the display hook used to be set when just importing Sage as a library, maybe?  If so, I think that's the wrong approach.  Importing a library shouldn't obliterate the display hook.

So it sounds like we need to make the doctesting framework load the right Sage things, like the preparser, the display hook, etc.



---

archive/issue_comments_148670.json:
```json
{
    "body": "I'll take a look at %time.  That indeed seems to be a problem where the preparser isn't being run.",
    "created_at": "2012-10-10T23:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148670",
    "user": "https://github.com/jasongrout"
}
```

I'll take a look at %time.  That indeed seems to be a problem where the preparser isn't being run.



---

archive/issue_comments_148671.json:
```json
{
    "body": "For some reason, the preparser explicitly turned itself off for magic lines.  I'm not sure why but I'm posting a patch to fix that.",
    "created_at": "2012-10-11T02:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148671",
    "user": "https://github.com/jasongrout"
}
```

For some reason, the preparser explicitly turned itself off for magic lines.  I'm not sure why but I'm posting a patch to fix that.



---

archive/issue_comments_148672.json:
```json
{
    "body": "Attachment [12719-preparse-magic.patch](tarball://root/attachments/some-uuid/ticket12719/12719-preparse-magic.patch) by @jasongrout created at 2012-10-11 02:10:16",
    "created_at": "2012-10-11T02:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148672",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-preparse-magic.patch](tarball://root/attachments/some-uuid/ticket12719/12719-preparse-magic.patch) by @jasongrout created at 2012-10-11 02:10:16



---

archive/issue_comments_148673.json:
```json
{
    "body": "John, you know the doctest framework a lot better than I do.  If you start up sage-ipython and load the sage extension, it will install the display hook, import Sage, etc.  John, do you know how to get the doctest runner to execute this as part of ipython: `get_ipython().extension_manager.load_extension('sage.misc.sage_extension')`\n\n```\ngrout@tiny:~/sage% sage -ipython -ic \"get_ipython().extension_manager.load_extension('sage.misc.sage_extension')\"                    E:128\nPython 2.7.3 (default, Oct  9 2012, 11:53:24) \nType \"copyright\", \"credits\" or \"license\" for more information.\n\nIPython 0.13 -- An enhanced Interactive Python.\n?         -> Introduction and overview of IPython's features.\n%quickref -> Quick reference.\nhelp      -> Python's own help system.\nobject?   -> Details about 'object', use 'object??' for extra details.\n\nIn [1]: (identity_matrix(3), identity_matrix(5))\nOut[1]: \n(\n         [1 0 0 0 0]\n         [0 1 0 0 0]\n[1 0 0]  [0 0 1 0 0]\n[0 1 0]  [0 0 0 1 0]\n[0 0 1], [0 0 0 0 1]\n)\n```",
    "created_at": "2012-10-11T03:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148673",
    "user": "https://github.com/jasongrout"
}
```

John, you know the doctest framework a lot better than I do.  If you start up sage-ipython and load the sage extension, it will install the display hook, import Sage, etc.  John, do you know how to get the doctest runner to execute this as part of ipython: `get_ipython().extension_manager.load_extension('sage.misc.sage_extension')`

```
grout@tiny:~/sage% sage -ipython -ic "get_ipython().extension_manager.load_extension('sage.misc.sage_extension')"                    E:128
Python 2.7.3 (default, Oct  9 2012, 11:53:24) 
Type "copyright", "credits" or "license" for more information.

IPython 0.13 -- An enhanced Interactive Python.
?         -> Introduction and overview of IPython's features.
%quickref -> Quick reference.
help      -> Python's own help system.
object?   -> Details about 'object', use 'object??' for extra details.

In [1]: (identity_matrix(3), identity_matrix(5))
Out[1]: 
(
         [1 0 0 0 0]
         [0 1 0 0 0]
[1 0 0]  [0 0 1 0 0]
[0 1 0]  [0 0 0 1 0]
[0 0 1], [0 0 0 0 1]
)
```



---

archive/issue_comments_148674.json:
```json
{
    "body": "I guess one reason to turn off the preparser for magic lines is so that in a line like\n\n```\n%ed file1.py\n```\nthe \"1\" doesn't get preparsed. I don't know how the old \"time\" command was written; did it just call \"%time\"? If so, maybe that was to allow lines starting with \"time\" to be preparsed.\n\nFor doctesting, I don't know if IPython is used at all during doctesting. If it's possible to turn on this extension using pure Python, we can add it at the top of each file as it's doctested, with a patch like this to local/bin/sage-doctest:\n\n```diff\ndiff --git a/sage-doctest b/sage-doctest\n--- a/sage-doctest\n+++ b/sage-doctest\n@@ -490,6 +490,7 @@ def extract_doc(file_name, library_code=\n \n \"\"\"  % os.path.join(os.getcwd(), file_name)\n     s += \"from sage.all_cmdline import *; \\n\"\n+    s += \"ADD NEW CODE HERE\\n\"\n     s += \"import sage.plot.plot; sage.plot.plot.DOCTEST_MODE=True\\n\"  # turn off image popup\n     s += r\"\"\"\n def warning_function(f):\n```",
    "created_at": "2012-10-11T15:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148674",
    "user": "https://github.com/jhpalmieri"
}
```

I guess one reason to turn off the preparser for magic lines is so that in a line like

```
%ed file1.py
```
the "1" doesn't get preparsed. I don't know how the old "time" command was written; did it just call "%time"? If so, maybe that was to allow lines starting with "time" to be preparsed.

For doctesting, I don't know if IPython is used at all during doctesting. If it's possible to turn on this extension using pure Python, we can add it at the top of each file as it's doctested, with a patch like this to local/bin/sage-doctest:

```diff
diff --git a/sage-doctest b/sage-doctest
--- a/sage-doctest
+++ b/sage-doctest
@@ -490,6 +490,7 @@ def extract_doc(file_name, library_code=
 
 """  % os.path.join(os.getcwd(), file_name)
     s += "from sage.all_cmdline import *; \n"
+    s += "ADD NEW CODE HERE\n"
     s += "import sage.plot.plot; sage.plot.plot.DOCTEST_MODE=True\n"  # turn off image popup
     s += r"""
 def warning_function(f):
```



---

archive/issue_comments_148675.json:
```json
{
    "body": "Attachment [12719-test-displayhook.patch](tarball://root/attachments/some-uuid/ticket12719/12719-test-displayhook.patch) by @jasongrout created at 2012-10-11 16:36:00\n\napply to scripts repository in local/bin/",
    "created_at": "2012-10-11T16:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148675",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-test-displayhook.patch](tarball://root/attachments/some-uuid/ticket12719/12719-test-displayhook.patch) by @jasongrout created at 2012-10-11 16:36:00

apply to scripts repository in local/bin/



---

archive/issue_comments_148676.json:
```json
{
    "body": "Attachment [12719-displayhook-library.patch](tarball://root/attachments/some-uuid/ticket12719/12719-displayhook-library.patch) by @jasongrout created at 2012-10-11 16:46:13",
    "created_at": "2012-10-11T16:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148676",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-displayhook-library.patch](tarball://root/attachments/some-uuid/ticket12719/12719-displayhook-library.patch) by @jasongrout created at 2012-10-11 16:46:13



---

archive/issue_comments_148677.json:
```json
{
    "body": "Updated instructions for new display hook patch that sets the display hook when doctesting.",
    "created_at": "2012-10-11T16:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148677",
    "user": "https://github.com/jasongrout"
}
```

Updated instructions for new display hook patch that sets the display hook when doctesting.



---

archive/issue_comments_148678.json:
```json
{
    "body": "For the %time command, I filed an issue with IPython a while ago: https://github.com/ipython/ipython/pull/2403\n\nFor now, it appears like we'll have to ship that patch ourselves.",
    "created_at": "2012-10-11T20:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148678",
    "user": "https://github.com/jasongrout"
}
```

For the %time command, I filed an issue with IPython a while ago: https://github.com/ipython/ipython/pull/2403

For now, it appears like we'll have to ship that patch ourselves.



---

archive/issue_comments_148679.json:
```json
{
    "body": "The matrix-printing seems to work now, but I'm seeing a few other doctest failures:\n\n```\nsage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py\n**********************************************************************\nFile \"/scratch/palmieri/12719/sage-5.4.rc1/devel/sage-main/sage/interfaces/sage0.py\", line 489:\n    sage: sage0(4).gcd\nExpected:\n    <built-in method gcd of sage.rings.integer.Integer object at 0x...>\nGot:\n    <function gcd>\n**********************************************************************\n```\nand several failures in sage_extension.py, which would take up too much room to include here.",
    "created_at": "2012-10-11T21:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148679",
    "user": "https://github.com/jhpalmieri"
}
```

The matrix-printing seems to work now, but I'm seeing a few other doctest failures:

```
sage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py
**********************************************************************
File "/scratch/palmieri/12719/sage-5.4.rc1/devel/sage-main/sage/interfaces/sage0.py", line 489:
    sage: sage0(4).gcd
Expected:
    <built-in method gcd of sage.rings.integer.Integer object at 0x...>
Got:
    <function gcd>
**********************************************************************
```
and several failures in sage_extension.py, which would take up too much room to include here.



---

archive/issue_comments_148680.json:
```json
{
    "body": "I think the errors in `sage_extension.py` are because file names in `%runfile foo` are being preparsed: for example, the first error message is pretty long, but it ends with\n\n```\nIOError: did not find file '/home/palmieri/.sage/temp/sage.math.washington.edu/Integer(21508)/dir_0/run_cell.py' to load or attach\n```\nNote that `Integer(21508)` in the file name; this should presumably just be `21508`. This preparsing doesn't happen if the number is mixed in with letters, but for files or directories with purely numeric names, it seems to pop up. So from the command line:\n\n```\nsage: %runfile hello2.py   # works\nsage: %runfile 123/hello2.py   # fails\nsage: %runfile /home/palmieri/123/hello2.py   # fails\n```\nThe same thing happens with `%attach`, and I assume also with the other magic functions which take file names as arguments.",
    "created_at": "2012-10-15T20:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148680",
    "user": "https://github.com/jhpalmieri"
}
```

I think the errors in `sage_extension.py` are because file names in `%runfile foo` are being preparsed: for example, the first error message is pretty long, but it ends with

```
IOError: did not find file '/home/palmieri/.sage/temp/sage.math.washington.edu/Integer(21508)/dir_0/run_cell.py' to load or attach
```
Note that `Integer(21508)` in the file name; this should presumably just be `21508`. This preparsing doesn't happen if the number is mixed in with letters, but for files or directories with purely numeric names, it seems to pop up. So from the command line:

```
sage: %runfile hello2.py   # works
sage: %runfile 123/hello2.py   # fails
sage: %runfile /home/palmieri/123/hello2.py   # fails
```
The same thing happens with `%attach`, and I assume also with the other magic functions which take file names as arguments.



---

archive/issue_comments_148681.json:
```json
{
    "body": "I don't understand the `sage0.py` failure. Does the new IPython have a different default print representation for some objects? Before the  patches here:\n\n```\nsage: a = 4\nsage: a.gcd\n<built-in method gcd of sage.rings.integer.Integer object at 0x480e330>\nsage: a.gcd?\nType:\t\tbuiltin_function_or_method\nBase Class:\t<type 'builtin_function_or_method'>\nString Form:\t<built-in method gcd of sage.rings.integer.Integer object at 0x480e330>\nNamespace:\tInteractive\nDefinition:\ta.gcd(self, n)\nDocstring:\n     ...\n```\nWith the patches:\n\n```\nsage: a = 4\nsage: a.gcd\n<function gcd>\nsage: a.gcd?\nType:       builtin_function_or_method\nString Form:<built-in method gcd of sage.rings.integer.Integer object at 0x5b7c5a0>\nDefinition: a.gcd(self, n)\nDocstring:\n   ...\n```\nWith the old version, the print rep for `a.gcd` is the same as what's labeled the \"String Form\" when you do `a.gcd?`. With the new version, the print rep has changed but the \"String Form\" has not. I'm also confused by this behavior (with the patches):\n\n```\nsage: a = 4\nsage: G = a.gcd\nsage: G.__repr__()\n'<built-in method gcd of sage.rings.integer.Integer object at 0x4b685a0>'\nsage: G\n<function gcd>\nsage: str(G)\n'<built-in method gcd of sage.rings.integer.Integer object at 0x4b685a0>'\n```\nWhy isn't `G` printed using its `__repr__` method?\n\nI've tried out some other objects (e.g., matrices and elements of the Steenrod algebra) and my guess is that the print representations for methods defined in pyx files are getting changed to `<function ...>`, while those defined in py files haven't changed. Any ideas why? Looking at `ipython-0.10.2.p1/src/IPython/UserConfig/ipythonrc`, I see the configuration option `object_info_string_level 0`, which looks relevant, but we're not using this style of configuration, right?",
    "created_at": "2012-10-15T21:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148681",
    "user": "https://github.com/jhpalmieri"
}
```

I don't understand the `sage0.py` failure. Does the new IPython have a different default print representation for some objects? Before the  patches here:

```
sage: a = 4
sage: a.gcd
<built-in method gcd of sage.rings.integer.Integer object at 0x480e330>
sage: a.gcd?
Type:		builtin_function_or_method
Base Class:	<type 'builtin_function_or_method'>
String Form:	<built-in method gcd of sage.rings.integer.Integer object at 0x480e330>
Namespace:	Interactive
Definition:	a.gcd(self, n)
Docstring:
     ...
```
With the patches:

```
sage: a = 4
sage: a.gcd
<function gcd>
sage: a.gcd?
Type:       builtin_function_or_method
String Form:<built-in method gcd of sage.rings.integer.Integer object at 0x5b7c5a0>
Definition: a.gcd(self, n)
Docstring:
   ...
```
With the old version, the print rep for `a.gcd` is the same as what's labeled the "String Form" when you do `a.gcd?`. With the new version, the print rep has changed but the "String Form" has not. I'm also confused by this behavior (with the patches):

```
sage: a = 4
sage: G = a.gcd
sage: G.__repr__()
'<built-in method gcd of sage.rings.integer.Integer object at 0x4b685a0>'
sage: G
<function gcd>
sage: str(G)
'<built-in method gcd of sage.rings.integer.Integer object at 0x4b685a0>'
```
Why isn't `G` printed using its `__repr__` method?

I've tried out some other objects (e.g., matrices and elements of the Steenrod algebra) and my guess is that the print representations for methods defined in pyx files are getting changed to `<function ...>`, while those defined in py files haven't changed. Any ideas why? Looking at `ipython-0.10.2.p1/src/IPython/UserConfig/ipythonrc`, I see the configuration option `object_info_string_level 0`, which looks relevant, but we're not using this style of configuration, right?



---

archive/issue_comments_148682.json:
```json
{
    "body": "Just a heads up that iPython 0.13.1 is set to be released on Friday. It fixes all the bugs I was having with ipython.parallel.",
    "created_at": "2012-10-15T22:29:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148682",
    "user": "https://trac.sagemath.org/admin/accounts/users/broken_symlink"
}
```

Just a heads up that iPython 0.13.1 is set to be released on Friday. It fixes all the bugs I was having with ipython.parallel.



---

archive/issue_comments_148683.json:
```json
{
    "body": "Attachment [trac_12719-pager.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-pager.patch) by @jhpalmieri created at 2012-10-23 15:52:21",
    "created_at": "2012-10-23T15:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148683",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-pager.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-pager.patch) by @jhpalmieri created at 2012-10-23 15:52:21



---

archive/issue_comments_148684.json:
```json
{
    "body": "We need another patch, since the pager in IPython has moved. One instance of this was fixed in one of the patches, but we need to fix others.\n\nNote the change to sagedoc.py; this needs to be tested.",
    "created_at": "2012-10-23T15:53:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148684",
    "user": "https://github.com/jhpalmieri"
}
```

We need another patch, since the pager in IPython has moved. One instance of this was fixed in one of the patches, but we need to fix others.

Note the change to sagedoc.py; this needs to be tested.



---

archive/issue_comments_148685.json:
```json
{
    "body": "It seems like you caught all of the instances of the IPython pager:\n\n```\ngrout@tiny:~/sage/devel/sage/sage% ack genutils *\ninterfaces/gap3.py\n493:            import IPython.genutils\n494:            IPython.genutils.page(helptext)\n\nmisc/pager.py\n27:        import IPython.genutils\n28:        return IPython.genutils.page\n\nmisc/sagedoc.py\n833:        from IPython.genutils import page\n```",
    "created_at": "2012-10-23T18:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148685",
    "user": "https://github.com/jasongrout"
}
```

It seems like you caught all of the instances of the IPython pager:

```
grout@tiny:~/sage/devel/sage/sage% ack genutils *
interfaces/gap3.py
493:            import IPython.genutils
494:            IPython.genutils.page(helptext)

misc/pager.py
27:        import IPython.genutils
28:        return IPython.genutils.page

misc/sagedoc.py
833:        from IPython.genutils import page
```



---

archive/issue_comments_148686.json:
```json
{
    "body": "Positive review to the sagedoc.py change---search_src didn't work before, but it does work after the change.",
    "created_at": "2012-10-23T18:12:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148686",
    "user": "https://github.com/jasongrout"
}
```

Positive review to the sagedoc.py change---search_src didn't work before, but it does work after the change.



---

archive/issue_comments_148687.json:
```json
{
    "body": "I uploaded an IPython 0.13.1 spkg, updating to the latest stable.  (the old 0.13 spkg is still in my home directory too).",
    "created_at": "2012-10-23T18:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148687",
    "user": "https://github.com/jasongrout"
}
```

I uploaded an IPython 0.13.1 spkg, updating to the latest stable.  (the old 0.13 spkg is still in my home directory too).



---

archive/issue_comments_148688.json:
```json
{
    "body": "Attachment [trac_12719-move_to_preparser_rebased.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-move_to_preparser_rebased.patch) by @jhpalmieri created at 2012-10-23 19:06:39\n\n[attachment:trac_12719-move_to_preparser.patch] doesn't apply cleanly to 5.4.rc2. Here's a rebased version.",
    "created_at": "2012-10-23T19:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148688",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-move_to_preparser_rebased.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-move_to_preparser_rebased.patch) by @jhpalmieri created at 2012-10-23 19:06:39

[attachment:trac_12719-move_to_preparser.patch] doesn't apply cleanly to 5.4.rc2. Here's a rebased version.



---

archive/issue_comments_148689.json:
```json
{
    "body": "jhpalmieri: I uploaded a new IPython 0.13.1 spkg that applies https://github.com/ipython/ipython/pull/2403.  This means we can delete the  [attachment:12719-preparse-magic.patch] patch, which will solve the %runfile problems, but keep the preparsing for %time, %timeit, and %prun.\n\nI've updated the instructions.",
    "created_at": "2012-10-23T19:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148689",
    "user": "https://github.com/jasongrout"
}
```

jhpalmieri: I uploaded a new IPython 0.13.1 spkg that applies https://github.com/ipython/ipython/pull/2403.  This means we can delete the  [attachment:12719-preparse-magic.patch] patch, which will solve the %runfile problems, but keep the preparsing for %time, %timeit, and %prun.

I've updated the instructions.



---

archive/issue_comments_148690.json:
```json
{
    "body": "Whew, with all these patches---I can't wait until we move to using git (or even mercurial properly) and we have branches for this sort of thing.",
    "created_at": "2012-10-23T19:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148690",
    "user": "https://github.com/jasongrout"
}
```

Whew, with all these patches---I can't wait until we move to using git (or even mercurial properly) and we have branches for this sort of thing.



---

archive/issue_comments_148691.json:
```json
{
    "body": "The cython function printing issue appears to boil down to those functions being treated as builtin functions, so this line applies: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L669, rather than this line: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L671\n\nSuggestions for how to fix this?  How do we distinguish between built-in functions and Cython methods?",
    "created_at": "2012-10-23T19:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148691",
    "user": "https://github.com/jasongrout"
}
```

The cython function printing issue appears to boil down to those functions being treated as builtin functions, so this line applies: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L669, rather than this line: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L671

Suggestions for how to fix this?  How do we distinguish between built-in functions and Cython methods?



---

archive/issue_comments_148692.json:
```json
{
    "body": "I've posted to the IPython list about the Cython method printing: http://mail.scipy.org/pipermail/ipython-dev/2012-October/010503.html",
    "created_at": "2012-10-23T20:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148692",
    "user": "https://github.com/jasongrout"
}
```

I've posted to the IPython list about the Cython method printing: http://mail.scipy.org/pipermail/ipython-dev/2012-October/010503.html



---

archive/issue_comments_148693.json:
```json
{
    "body": "Are there any other outstanding issues other than the Cython method printing?",
    "created_at": "2012-10-23T20:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148693",
    "user": "https://github.com/jasongrout"
}
```

Are there any other outstanding issues other than the Cython method printing?



---

archive/issue_comments_148694.json:
```json
{
    "body": "Replying to [comment:152 jason]:\n> jhpalmieri: I uploaded a new IPython 0.13.1 spkg that applies https://github.com/ipython/ipython/pull/2403.  This means we can delete the  [attachment:12719-preparse-magic.patch] patch, which will solve the %runfile problems, but keep the preparsing for %time, %timeit, and %prun.\n\n\nCan you think of a way to doctest this? (I haven't tried anything at all, so it might be easy.)",
    "created_at": "2012-10-23T20:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148694",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:152 jason]:
> jhpalmieri: I uploaded a new IPython 0.13.1 spkg that applies https://github.com/ipython/ipython/pull/2403.  This means we can delete the  [attachment:12719-preparse-magic.patch] patch, which will solve the %runfile problems, but keep the preparsing for %time, %timeit, and %prun.


Can you think of a way to doctest this? (I haven't tried anything at all, so it might be easy.)



---

archive/issue_comments_148695.json:
```json
{
    "body": "If just putting in a magic `%timeit ...` doesn't work, then this should work *if* the doctesting framework is using IPython:\n\n```\nsage: get_ipython().run_line_magic('time', '594.factor()')\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\nWall time: 0.00 s\n2 * 3^3 * 11\n```",
    "created_at": "2012-10-23T20:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148695",
    "user": "https://github.com/jasongrout"
}
```

If just putting in a magic `%timeit ...` doesn't work, then this should work *if* the doctesting framework is using IPython:

```
sage: get_ipython().run_line_magic('time', '594.factor()')
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
2 * 3^3 * 11
```



---

archive/issue_comments_148696.json:
```json
{
    "body": "Hey, let's add another patch to the pile!",
    "created_at": "2012-10-23T20:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148696",
    "user": "https://github.com/jhpalmieri"
}
```

Hey, let's add another patch to the pile!



---

archive/issue_comments_148697.json:
```json
{
    "body": "Attachment [trac_12719-preparse-doctest.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-preparse-doctest.patch) by @jhpalmieri created at 2012-10-23 22:38:10",
    "created_at": "2012-10-23T22:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148697",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-preparse-doctest.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-preparse-doctest.patch) by @jhpalmieri created at 2012-10-23 22:38:10



---

archive/issue_comments_148698.json:
```json
{
    "body": "Replying to [comment:154 jason]:\n> The cython function printing issue appears to boil down to those functions being treated as builtin functions, so this line applies: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L669, rather than this line: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L671\n> \n> Suggestions for how to fix this?  How do we distinguish between built-in functions and Cython methods?\n\n\nI don't know. Even in previous versions of Sage:\n\n```\nsage: type(4.gcd)\n<type 'builtin_function_or_method'>\n```\nI wonder if changing this would require patching Cython. If we knew where the methods for Cython methods were defined, maybe we could just define a method `_repr_pretty_`, as described in https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L27. Line 3737-3740 of `local/lib/python/site-packages/Cython/Compiler/Nodes.py` says\n\n```\n        is_builtin_function_or_method = \"PyCFunction_Check(%s)\" % func_node_temp\n        is_overridden = \"(PyCFunction_GET_FUNCTION(%s) != (PyCFunction)%s)\" % (\n            func_node_temp, self.py_func.entry.func_cname)\n        code.putln(\"if (!%s || %s) {\" % (is_builtin_function_or_method, is_overridden))\n```\nIs this relevant?\n\nAlternatively, we could patch the file \"pretty.py\", modifying the definition of `_type_pprinters` somehow, although I'm not sure how.\n\nAlternatively, we could temporarily accept the new print representation for Cython-defined methods, and create a new ticket for fixing this. It seems like a small issue to me, and maybe it shouldn't hold up the rest of this ticket.",
    "created_at": "2012-10-24T21:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148698",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:154 jason]:
> The cython function printing issue appears to boil down to those functions being treated as builtin functions, so this line applies: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L669, rather than this line: https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L671
> 
> Suggestions for how to fix this?  How do we distinguish between built-in functions and Cython methods?


I don't know. Even in previous versions of Sage:

```
sage: type(4.gcd)
<type 'builtin_function_or_method'>
```
I wonder if changing this would require patching Cython. If we knew where the methods for Cython methods were defined, maybe we could just define a method `_repr_pretty_`, as described in https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py#L27. Line 3737-3740 of `local/lib/python/site-packages/Cython/Compiler/Nodes.py` says

```
        is_builtin_function_or_method = "PyCFunction_Check(%s)" % func_node_temp
        is_overridden = "(PyCFunction_GET_FUNCTION(%s) != (PyCFunction)%s)" % (
            func_node_temp, self.py_func.entry.func_cname)
        code.putln("if (!%s || %s) {" % (is_builtin_function_or_method, is_overridden))
```
Is this relevant?

Alternatively, we could patch the file "pretty.py", modifying the definition of `_type_pprinters` somehow, although I'm not sure how.

Alternatively, we could temporarily accept the new print representation for Cython-defined methods, and create a new ticket for fixing this. It seems like a small issue to me, and maybe it shouldn't hold up the rest of this ticket.



---

archive/issue_comments_148699.json:
```json
{
    "body": "Alternatively, we could post to the Cython list and ask them :).\n\nCcing robertwb (see the comment or two above about Cython function printing, as well as http://mail.scipy.org/pipermail/ipython-dev/2012-October/010503.html, which tries to lay out the issue more concisely).",
    "created_at": "2012-10-24T21:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148699",
    "user": "https://github.com/jasongrout"
}
```

Alternatively, we could post to the Cython list and ask them :).

Ccing robertwb (see the comment or two above about Cython function printing, as well as http://mail.scipy.org/pipermail/ipython-dev/2012-October/010503.html, which tries to lay out the issue more concisely).



---

archive/issue_comments_148700.json:
```json
{
    "body": "Asking the Cython developers is a great idea. Here's a real hack, but it seems to work: for built-in functions, if the print representation includes \"sage.\", we use that. (Now that I look at your post to the IPython list, it's just a version of the hack you described there.) This is a patch for IPython/lib/pretty.py:\n\n```diff\n--- pretty.py.orig\t2012-10-20 17:30:54.000000000 -0700\n+++ pretty.py\t2012-10-24 14:19:40.000000000 -0700\n@@ -616,11 +616,14 @@\n \n def _function_pprint(obj, p, cycle):\n     \"\"\"Base pprint for all functions and builtin functions.\"\"\"\n-    if obj.__module__ in ('__builtin__', 'exceptions') or not obj.__module__:\n-        name = obj.__name__\n+    if obj.__repr__().find('sage.') != -1:\n+        p.text(obj.__repr__())\n     else:\n-        name = obj.__module__ + '.' + obj.__name__\n-    p.text('<function %s>' % name)\n+        if obj.__module__ in ('__builtin__', 'exceptions') or not obj.__module__:\n+            name = obj.__name__\n+        else:\n+            name = obj.__module__ + '.' + obj.__name__\n+        p.text('<function %s>' % name)\n \n \n def _exception_pprint(obj, p, cycle):\n```",
    "created_at": "2012-10-24T21:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148700",
    "user": "https://github.com/jhpalmieri"
}
```

Asking the Cython developers is a great idea. Here's a real hack, but it seems to work: for built-in functions, if the print representation includes "sage.", we use that. (Now that I look at your post to the IPython list, it's just a version of the hack you described there.) This is a patch for IPython/lib/pretty.py:

```diff
--- pretty.py.orig	2012-10-20 17:30:54.000000000 -0700
+++ pretty.py	2012-10-24 14:19:40.000000000 -0700
@@ -616,11 +616,14 @@
 
 def _function_pprint(obj, p, cycle):
     """Base pprint for all functions and builtin functions."""
-    if obj.__module__ in ('__builtin__', 'exceptions') or not obj.__module__:
-        name = obj.__name__
+    if obj.__repr__().find('sage.') != -1:
+        p.text(obj.__repr__())
     else:
-        name = obj.__module__ + '.' + obj.__name__
-    p.text('<function %s>' % name)
+        if obj.__module__ in ('__builtin__', 'exceptions') or not obj.__module__:
+            name = obj.__name__
+        else:
+            name = obj.__module__ + '.' + obj.__name__
+        p.text('<function %s>' % name)
 
 
 def _exception_pprint(obj, p, cycle):
```



---

archive/issue_comments_148701.json:
```json
{
    "body": "On the [Cython users](https://groups.google.com/d/topic/cython-users/lVEMHM5keNI/discussion) mailing list, in which I essentially quoted Jason's message to the IPython list, Bradley Froehle says\n\n```\nThere's nothing to be done in Cython here.  As you point out, \na.seed is a builtin (i.e. compiled) method and type(a.seed) returns\n`builtin_function_or_method` correctly.\n```\nSo I think our options are\n\n- hack pretty.py\n- wait for a real IPython fix\n- change the doctests to match the current output for now, and open a new ticket to fix this later.\n\nPreferences? Am I missing any good choices?",
    "created_at": "2012-10-26T18:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148701",
    "user": "https://github.com/jhpalmieri"
}
```

On the [Cython users](https://groups.google.com/d/topic/cython-users/lVEMHM5keNI/discussion) mailing list, in which I essentially quoted Jason's message to the IPython list, Bradley Froehle says

```
There's nothing to be done in Cython here.  As you point out, 
a.seed is a builtin (i.e. compiled) method and type(a.seed) returns
`builtin_function_or_method` correctly.
```
So I think our options are

- hack pretty.py
- wait for a real IPython fix
- change the doctests to match the current output for now, and open a new ticket to fix this later.

Preferences? Am I missing any good choices?



---

archive/issue_comments_148702.json:
```json
{
    "body": "Ping. Any opinions?",
    "created_at": "2012-11-02T20:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148702",
    "user": "https://github.com/jhpalmieri"
}
```

Ping. Any opinions?



---

archive/issue_comments_148703.json:
```json
{
    "body": "Is it hard to change the doctests (how many?).  If that's easy, I'd say to change the doctests, especially given that any patch we make will take a long time to make it back into Sage through IPython.  I'd veto \"wait for a real IPython fix\".\n\nIs this the only thing holding us back now?",
    "created_at": "2012-11-02T20:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148703",
    "user": "https://github.com/jasongrout"
}
```

Is it hard to change the doctests (how many?).  If that's easy, I'd say to change the doctests, especially given that any patch we make will take a long time to make it back into Sage through IPython.  I'd veto "wait for a real IPython fix".

Is this the only thing holding us back now?



---

archive/issue_comments_148704.json:
```json
{
    "body": "I think there is only one failing doctest:\n\n```\nsage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py\n**********************************************************************\nFile \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/12719/sage-5.4.rc3/devel/sage-main/sage/interfaces/sage0.py\", \\\nline 489:\n    sage: sage0(4).gcd\nExpected:\n    <built-in method gcd of sage.rings.integer.Integer object at 0x...>\nGot:\n    <function gcd>\n**********************************************************************\n```\nand it should be trivial to fix. I also don't know how serious the issue is. I mean, it would be nice if `4.gcd` printed more information, but it doesn't seem crucial in any way.",
    "created_at": "2012-11-02T23:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148704",
    "user": "https://github.com/jhpalmieri"
}
```

I think there is only one failing doctest:

```
sage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py
**********************************************************************
File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/12719/sage-5.4.rc3/devel/sage-main/sage/interfaces/sage0.py", \
line 489:
    sage: sage0(4).gcd
Expected:
    <built-in method gcd of sage.rings.integer.Integer object at 0x...>
Got:
    <function gcd>
**********************************************************************
```
and it should be trivial to fix. I also don't know how serious the issue is. I mean, it would be nice if `4.gcd` printed more information, but it doesn't seem crucial in any way.



---

archive/issue_comments_148705.json:
```json
{
    "body": "Attachment [trac_12719-gcd-repr.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-gcd-repr.patch) by @jhpalmieri created at 2012-11-02 23:47:36",
    "created_at": "2012-11-02T23:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148705",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-gcd-repr.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-gcd-repr.patch) by @jhpalmieri created at 2012-11-02 23:47:36



---

archive/issue_comments_148706.json:
```json
{
    "body": "I'd say let's change our doctest, and then work with upstream to get a patch in.  When the patch comes down (probably in a few months to a year?), we'll change our doctest again.",
    "created_at": "2012-11-03T09:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148706",
    "user": "https://github.com/jasongrout"
}
```

I'd say let's change our doctest, and then work with upstream to get a patch in.  When the patch comes down (probably in a few months to a year?), we'll change our doctest again.



---

archive/issue_comments_148707.json:
```json
{
    "body": "I changed the doctest. All tests pass for me on sage.math. Since it was already positively reviewed once before, I think we can set it back to that. What do you think?",
    "created_at": "2012-11-03T15:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148707",
    "user": "https://github.com/jhpalmieri"
}
```

I changed the doctest. All tests pass for me on sage.math. Since it was already positively reviewed once before, I think we can set it back to that. What do you think?



---

archive/issue_comments_148708.json:
```json
{
    "body": "Yippee!!",
    "created_at": "2012-11-03T15:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148708",
    "user": "https://github.com/jasongrout"
}
```

Yippee!!



---

archive/issue_comments_148709.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-03T17:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148709",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_034511.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-05T07:43:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34511"
}
```



---

archive/issue_comments_148710.json:
```json
{
    "body": "jdemeyer -- it would be great if this were merged into one of the 5.5 betas.",
    "created_at": "2012-11-08T06:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148710",
    "user": "https://github.com/jasongrout"
}
```

jdemeyer -- it would be great if this were merged into one of the 5.5 betas.



---

archive/issue_comments_148711.json:
```json
{
    "body": "Of course, don't worry.",
    "created_at": "2012-11-08T08:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148711",
    "user": "https://github.com/jdemeyer"
}
```

Of course, don't worry.



---

archive/issue_comments_148712.json:
```json
{
    "body": "With #13211, I get\n\n```\napplying /release/merger/patches/trac_12719-5.1beta1.patch\npatching file sage/interfaces/gap.py\nHunk #2 FAILED at 1065\n1 out of 2 hunks FAILED -- saving rejects to file sage/interfaces/gap.py.rej\n```\n\nNote that #13211 isn't certain to be merged (there were some problems before and the fixes haven't been properly tested yet).",
    "created_at": "2012-11-08T14:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148712",
    "user": "https://github.com/jdemeyer"
}
```

With #13211, I get

```
applying /release/merger/patches/trac_12719-5.1beta1.patch
patching file sage/interfaces/gap.py
Hunk #2 FAILED at 1065
1 out of 2 hunks FAILED -- saving rejects to file sage/interfaces/gap.py.rej
```

Note that #13211 isn't certain to be merged (there were some problems before and the fixes haven't been properly tested yet).



---

archive/issue_events_034512.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-08T14:32:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34512"
}
```



---

archive/issue_events_034513.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-08T14:32:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34513"
}
```



---

archive/issue_comments_148713.json:
```json
{
    "body": "I don't think I've ever applied #13211, and I certainly don't have it applied now.  I didn't realize it was a dependency (I've just been pasting in the instructions in the description).  Can we just remove the dependency?  I'm not sure why we even have it.",
    "created_at": "2012-11-08T14:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148713",
    "user": "https://github.com/jasongrout"
}
```

I don't think I've ever applied #13211, and I certainly don't have it applied now.  I didn't realize it was a dependency (I've just been pasting in the instructions in the description).  Can we just remove the dependency?  I'm not sure why we even have it.



---

archive/issue_comments_148714.json:
```json
{
    "body": "My point is that it should be made a dependency and be rebased to #13211.",
    "created_at": "2012-11-08T15:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148714",
    "user": "https://github.com/jdemeyer"
}
```

My point is that it should be made a dependency and be rebased to #13211.



---

archive/issue_comments_148715.json:
```json
{
    "body": "But if #13211's future isn't sure yet, should we add that as a dependency?  Granted that the rebase (for either ticket) is a simple 1-2 line fix, but it'd be a shame if this huge work didn't get in because #13211 for some reason didn't pass muster.\n\nYou're the release manager, so you make the calls.  Do you still want me to rebase to depend on that ticket?  Does that hurt our chances of getting into 5.5?",
    "created_at": "2012-11-08T16:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148715",
    "user": "https://github.com/jasongrout"
}
```

But if #13211's future isn't sure yet, should we add that as a dependency?  Granted that the rebase (for either ticket) is a simple 1-2 line fix, but it'd be a shame if this huge work didn't get in because #13211 for some reason didn't pass muster.

You're the release manager, so you make the calls.  Do you still want me to rebase to depend on that ticket?  Does that hurt our chances of getting into 5.5?



---

archive/issue_comments_148716.json:
```json
{
    "body": "Replying to [comment:178 jason]:\n> You're the release manager, so you make the calls.  Do you still want me to rebase to depend on that ticket?  Does that hurt our chances of getting into 5.5?\n\nI will test #13211 and then I'll know better whether or not it will be merged. So let's wait for now.\n\nThe best chances for getting this merged is to respond quickly when I ask for it to be rebased.",
    "created_at": "2012-11-08T20:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148716",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:178 jason]:
> You're the release manager, so you make the calls.  Do you still want me to rebase to depend on that ticket?  Does that hurt our chances of getting into 5.5?

I will test #13211 and then I'll know better whether or not it will be merged. So let's wait for now.

The best chances for getting this merged is to respond quickly when I ask for it to be rebased.



---

archive/issue_comments_148717.json:
```json
{
    "body": "Attachment [trac_12719-rebased-to-13211.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-rebased-to-13211.patch) by @jhpalmieri created at 2012-11-08 20:34:23",
    "created_at": "2012-11-08T20:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148717",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-rebased-to-13211.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-rebased-to-13211.patch) by @jhpalmieri created at 2012-11-08 20:34:23



---

archive/issue_comments_148718.json:
```json
{
    "body": "Here's a patch rebased to #13211. Let's keep the old patch, too, just in case.",
    "created_at": "2012-11-08T20:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148718",
    "user": "https://github.com/jhpalmieri"
}
```

Here's a patch rebased to #13211. Let's keep the old patch, too, just in case.



---

archive/issue_comments_148719.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-09T09:29:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148719",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148720.json:
```json
{
    "body": "Attachment [12719_run_cython.patch](tarball://root/attachments/some-uuid/ticket12719/12719_run_cython.patch) by @jdemeyer created at 2012-11-09 09:31:45",
    "created_at": "2012-11-09T09:31:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148720",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [12719_run_cython.patch](tarball://root/attachments/some-uuid/ticket12719/12719_run_cython.patch) by @jdemeyer created at 2012-11-09 09:31:45



---

archive/issue_comments_148721.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-09T09:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148721",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148722.json:
```json
{
    "body": "[attachment:12719_run_cython.patch] needs review.",
    "created_at": "2012-11-09T09:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148722",
    "user": "https://github.com/jdemeyer"
}
```

[attachment:12719_run_cython.patch] needs review.



---

archive/issue_comments_148723.json:
```json
{
    "body": "I think this looks okay. I'm building and running doctests one more time to make sure.",
    "created_at": "2012-11-09T17:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148723",
    "user": "https://github.com/jhpalmieri"
}
```

I think this looks okay. I'm building and running doctests one more time to make sure.



---

archive/issue_comments_148724.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-09T20:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148724",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148725.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-10T20:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148725",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148726.json:
```json
{
    "body": "Attachment [trac_12719-hgignore.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-hgignore.patch) by @jhpalmieri created at 2012-11-10 20:14:01\n\n[attachment:trac_12719-hgignore.patch] needs review.",
    "created_at": "2012-11-10T20:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148726",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-hgignore.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-hgignore.patch) by @jhpalmieri created at 2012-11-10 20:14:01

[attachment:trac_12719-hgignore.patch] needs review.



---

archive/issue_comments_148727.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-10T20:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148727",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148728.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-11T09:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148728",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148729.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-12T08:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148729",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148730.json:
```json
{
    "body": "[attachment:trac_12719-scripts.patch] is missing a commit message.\n\n[attachment:12719-5.4rc1.patch] is missing a user name in the patch file.\n\n[attachment:trac_12719-cellmagics013.patch] has a commit message which is all on one line and too long. You should make sure that the lines in commit messages are not too long, but the first line should still be descriptive by itself, since that shows up in `hg log`.\n\npositive review to [attachment:trac_12719-hgignore.patch]",
    "created_at": "2012-11-12T08:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148730",
    "user": "https://github.com/jdemeyer"
}
```

[attachment:trac_12719-scripts.patch] is missing a commit message.

[attachment:12719-5.4rc1.patch] is missing a user name in the patch file.

[attachment:trac_12719-cellmagics013.patch] has a commit message which is all on one line and too long. You should make sure that the lines in commit messages are not too long, but the first line should still be descriptive by itself, since that shows up in `hg log`.

positive review to [attachment:trac_12719-hgignore.patch]



---

archive/issue_comments_148731.json:
```json
{
    "body": "In `SageInteractiveShell.system_raw`, does `libraries` refer to a global or is that variable simply unused?  Since `false` isn't guaranteed to return exit status 1 (on Solaris, it returns 255, POSIX specifies it must be non-zero), the doctest must be changed to something more portable. I also don't see this function discussed on #975.\n\nSo, I suggest the following patch:\n\n```patch\ndiff --git a/sage/misc/interpreter.py b/sage/misc/interpreter.py\n--- a/sage/misc/interpreter.py\n+++ b/sage/misc/interpreter.py\n@@ -161,26 +161,18 @@ class SageInteractiveShell(TerminalInter\n\n     def system_raw(self, cmd):\n         \"\"\"\n-        Adjust the libraries before calling system commands.  See Trac\n-        #975 for a discussion of this function.\n+        Run a system command.\n\n         EXAMPLES::\n\n             sage: from sage.misc.interpreter import get_test_shell\n             sage: shell = get_test_shell()\n             sage: shell.system_raw('false')\n-            sage: shell.user_ns['_exit_code']\n-            256\n+            sage: status = shell.user_ns['_exit_code']\n+            sage: os.WIFEXITED(status) and os.WEXITSTATUS(status) != 0\n+            True\n         \"\"\"\n-        sage_commands = os.listdir(os.environ['SAGE_ROOT']+\"/local/bin/\")\n-        DARWIN_SYSTEM = os.uname()[0]=='Darwin'\n-        if cmd in sage_commands:\n-            return super(SageInteractiveShell, self).system_raw(cmd)\n-        else:\n-            libraries = 'LD_LIBRARY_PATH=$$SAGE_ORIG_LD_LIBRARY_PATH;'\n-            if DARWIN_SYSTEM:\n-                libraries += 'DYLD_LIBRARY_PATH=$$SAGE_ORIG_DYLD_LIBRARY_PATH;'\n-            return super(SageInteractiveShell, self).system_raw(cmd)\n+        return super(SageInteractiveShell, self).system_raw(cmd)\n\n     def ask_exit(self):\n         \"\"\"\n```",
    "created_at": "2012-11-13T08:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148731",
    "user": "https://github.com/jdemeyer"
}
```

In `SageInteractiveShell.system_raw`, does `libraries` refer to a global or is that variable simply unused?  Since `false` isn't guaranteed to return exit status 1 (on Solaris, it returns 255, POSIX specifies it must be non-zero), the doctest must be changed to something more portable. I also don't see this function discussed on #975.

So, I suggest the following patch:

```patch
diff --git a/sage/misc/interpreter.py b/sage/misc/interpreter.py
--- a/sage/misc/interpreter.py
+++ b/sage/misc/interpreter.py
@@ -161,26 +161,18 @@ class SageInteractiveShell(TerminalInter

     def system_raw(self, cmd):
         """
-        Adjust the libraries before calling system commands.  See Trac
-        #975 for a discussion of this function.
+        Run a system command.

         EXAMPLES::

             sage: from sage.misc.interpreter import get_test_shell
             sage: shell = get_test_shell()
             sage: shell.system_raw('false')
-            sage: shell.user_ns['_exit_code']
-            256
+            sage: status = shell.user_ns['_exit_code']
+            sage: os.WIFEXITED(status) and os.WEXITSTATUS(status) != 0
+            True
         """
-        sage_commands = os.listdir(os.environ['SAGE_ROOT']+"/local/bin/")
-        DARWIN_SYSTEM = os.uname()[0]=='Darwin'
-        if cmd in sage_commands:
-            return super(SageInteractiveShell, self).system_raw(cmd)
-        else:
-            libraries = 'LD_LIBRARY_PATH=$$SAGE_ORIG_LD_LIBRARY_PATH;'
-            if DARWIN_SYSTEM:
-                libraries += 'DYLD_LIBRARY_PATH=$$SAGE_ORIG_DYLD_LIBRARY_PATH;'
-            return super(SageInteractiveShell, self).system_raw(cmd)
+        return super(SageInteractiveShell, self).system_raw(cmd)

     def ask_exit(self):
         """
```



---

archive/issue_comments_148732.json:
```json
{
    "body": "I've uploaded a patch to the system command.  The point is that we need to reset the original system libraries if we run a non-sage command.",
    "created_at": "2012-11-13T19:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148732",
    "user": "https://github.com/jasongrout"
}
```

I've uploaded a patch to the system command.  The point is that we need to reset the original system libraries if we run a non-sage command.



---

archive/issue_comments_148733.json:
```json
{
    "body": "Apply to sage repository",
    "created_at": "2012-11-13T19:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148733",
    "user": "https://github.com/jasongrout"
}
```

Apply to sage repository



---

archive/issue_comments_148734.json:
```json
{
    "body": "Attachment [trac_12719-scripts.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-scripts.patch) by @jasongrout created at 2012-11-13 19:57:48\n\nrebased to 5.4rc1",
    "created_at": "2012-11-13T19:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148734",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac_12719-scripts.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-scripts.patch) by @jasongrout created at 2012-11-13 19:57:48

rebased to 5.4rc1



---

archive/issue_comments_148735.json:
```json
{
    "body": "Attachment [12719-5.4rc1.patch](tarball://root/attachments/some-uuid/ticket12719/12719-5.4rc1.patch) by @jasongrout created at 2012-11-13 19:58:00",
    "created_at": "2012-11-13T19:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148735",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-5.4rc1.patch](tarball://root/attachments/some-uuid/ticket12719/12719-5.4rc1.patch) by @jasongrout created at 2012-11-13 19:58:00



---

archive/issue_comments_148736.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-13T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148736",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148737.json:
```json
{
    "body": "Okay, I think I've taken care of the outstanding issues with the patches.",
    "created_at": "2012-11-13T20:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148737",
    "user": "https://github.com/jasongrout"
}
```

Okay, I think I've taken care of the outstanding issues with the patches.



---

archive/issue_comments_148738.json:
```json
{
    "body": "I updated the system patch to also include a doctest checking to see if a system command is running with the Sage LD_LIBRARY_PATH.",
    "created_at": "2012-11-13T20:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148738",
    "user": "https://github.com/jasongrout"
}
```

I updated the system patch to also include a doctest checking to see if a system command is running with the Sage LD_LIBRARY_PATH.



---

archive/issue_comments_148739.json:
```json
{
    "body": "You should also doctest `system_raw` working succesfully.\n\nI think you can replace\n\n```\nos.file.isfile(FILE)\n```\nby\n\n```\nos.access(FILE, os.X_OK):\n```\nsince you want to check for an *executable* file.\n\nAlso, I assume that \"cmd\" uses shell syntax? Then you're doing it wrong. Correct shell syntax is\n\n```\nLD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\"; export LD_LIBRARY_PATH\n```",
    "created_at": "2012-11-13T20:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148739",
    "user": "https://github.com/jdemeyer"
}
```

You should also doctest `system_raw` working succesfully.

I think you can replace

```
os.file.isfile(FILE)
```
by

```
os.access(FILE, os.X_OK):
```
since you want to check for an *executable* file.

Also, I assume that "cmd" uses shell syntax? Then you're doing it wrong. Correct shell syntax is

```
LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH"; export LD_LIBRARY_PATH
```



---

archive/issue_comments_148740.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-13T20:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148740",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148741.json:
```json
{
    "body": "I'm not an expert on bash syntax (I assume this is using bash), but perhaps some (or all?) of these would work:\n\n```sh\nLD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\"; export LD_LIBRARY_PATH; ...\nexport LD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\"; ...\nenv LD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\"  ...   # note no semicolon\nLD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\"  ...       # ??\n```",
    "created_at": "2012-11-13T21:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148741",
    "user": "https://github.com/jhpalmieri"
}
```

I'm not an expert on bash syntax (I assume this is using bash), but perhaps some (or all?) of these would work:

```sh
LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH"; export LD_LIBRARY_PATH; ...
export LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH"; ...
env LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH"  ...   # note no semicolon
LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH"  ...       # ??
```



---

archive/issue_comments_148742.json:
```json
{
    "body": "I don't know whether we can assume bash, I would go for Posix `/bin/sh` compatible.\n\nFor example\n\n```\nexport LD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\";\n```\nis bash-specific and I'm not sure about\n\n```\nLD_LIBRARY_PATH=\"$SAGE_ORIG_LD_LIBRARY_PATH\"  ...\n```",
    "created_at": "2012-11-13T21:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148742",
    "user": "https://github.com/jdemeyer"
}
```

I don't know whether we can assume bash, I would go for Posix `/bin/sh` compatible.

For example

```
export LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH";
```
is bash-specific and I'm not sure about

```
LD_LIBRARY_PATH="$SAGE_ORIG_LD_LIBRARY_PATH"  ...
```



---

archive/issue_comments_148743.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-13T21:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148743",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148744.json:
```json
{
    "body": "I hope this redo is good!  Thanks for the tips.",
    "created_at": "2012-11-13T21:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148744",
    "user": "https://github.com/jasongrout"
}
```

I hope this redo is good!  Thanks for the tips.



---

archive/issue_comments_148745.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-13T21:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148745",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148746.json:
```json
{
    "body": "You should replace $$ by $.",
    "created_at": "2012-11-13T21:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148746",
    "user": "https://github.com/jdemeyer"
}
```

You should replace $$ by $.



---

archive/issue_comments_148747.json:
```json
{
    "body": "And please also doctest a non-Sage command working successfully. For example\n\n```\nsystem_raw(\"true\")\n```",
    "created_at": "2012-11-13T21:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148747",
    "user": "https://github.com/jdemeyer"
}
```

And please also doctest a non-Sage command working successfully. For example

```
system_raw("true")
```



---

archive/issue_comments_148748.json:
```json
{
    "body": "Attachment [12719-system.patch](tarball://root/attachments/some-uuid/ticket12719/12719-system.patch) by @jasongrout created at 2012-11-13 21:36:04\n\napply to sage repository",
    "created_at": "2012-11-13T21:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148748",
    "user": "https://github.com/jasongrout"
}
```

Attachment [12719-system.patch](tarball://root/attachments/some-uuid/ticket12719/12719-system.patch) by @jasongrout created at 2012-11-13 21:36:04

apply to sage repository



---

archive/issue_comments_148749.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-13T21:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148749",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148750.json:
```json
{
    "body": "All of the patches apply cleanly (on top of 5.5.beta0 + #9191), and the new [attachment:12719-system.patch] looks okay to me. Jeroen, what do you think?\n\nI have one mild complaint: if I do\n\n```\nsage: note[TAB]\n```\nit doesn't complete to \"notebook\" anymore, saying that \"%notebook\" is also a valid completion. Would it be possible, here or on a followup ticket, to rename the \"%notebook\" magic command to \"%ipython_notebook\" or something similar?",
    "created_at": "2012-11-14T20:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148750",
    "user": "https://github.com/jhpalmieri"
}
```

All of the patches apply cleanly (on top of 5.5.beta0 + #9191), and the new [attachment:12719-system.patch] looks okay to me. Jeroen, what do you think?

I have one mild complaint: if I do

```
sage: note[TAB]
```
it doesn't complete to "notebook" anymore, saying that "%notebook" is also a valid completion. Would it be possible, here or on a followup ticket, to rename the "%notebook" magic command to "%ipython_notebook" or something similar?



---

archive/issue_comments_148751.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-14T20:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148751",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148752.json:
```json
{
    "body": "Looks fine. As for the TAB-completion: a different ticket please.",
    "created_at": "2012-11-14T20:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148752",
    "user": "https://github.com/jdemeyer"
}
```

Looks fine. As for the TAB-completion: a different ticket please.



---

archive/issue_events_034514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-15T08:46:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34514"
}
```



---

archive/issue_events_034515.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-15T08:46:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34515"
}
```



---

archive/issue_comments_148753.json:
```json
{
    "body": "Upgrading from sage-4.5 fails with a trial version of sage-5.5.beta2 and this is the only ticket I can think of that could cause this problem. The error shows up in `Twisted` (part of `sagenb` now):\n\n```\nInstalled /release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.5.beta2/local/lib/python2.7/site-packages/Twisted-12.1.0-py2.7-linux-x86_64.egg\nProcessing dependencies for Twisted==12.1.0\nSearching for zope.interface\n\nLink to http://pypi.python.org/simple/zope.interface/ ***BLOCKED*** by --allow-hosts\n\nCouldn't find index page for 'zope.interface' (maybe misspelled?)\nScanning index of all packages (this may take a while)\n\nLink to http://pypi.python.org/simple/ ***BLOCKED*** by --allow-hosts\n\nNo local packages or download links found for zope.interface\nerror: Could not find suitable distribution for Requirement.parse('zope.interface')\nError installing Twisted-12.1.0.tar.bz2 !\n```",
    "created_at": "2012-11-16T12:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148753",
    "user": "https://github.com/jdemeyer"
}
```

Upgrading from sage-4.5 fails with a trial version of sage-5.5.beta2 and this is the only ticket I can think of that could cause this problem. The error shows up in `Twisted` (part of `sagenb` now):

```
Installed /release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.5.beta2/local/lib/python2.7/site-packages/Twisted-12.1.0-py2.7-linux-x86_64.egg
Processing dependencies for Twisted==12.1.0
Searching for zope.interface

Link to http://pypi.python.org/simple/zope.interface/ ***BLOCKED*** by --allow-hosts

Couldn't find index page for 'zope.interface' (maybe misspelled?)
Scanning index of all packages (this may take a while)

Link to http://pypi.python.org/simple/ ***BLOCKED*** by --allow-hosts

No local packages or download links found for zope.interface
error: Could not find suitable distribution for Requirement.parse('zope.interface')
Error installing Twisted-12.1.0.tar.bz2 !
```



---

archive/issue_comments_148754.json:
```json
{
    "body": "Whether or not IPython causes the zope.interface problem, I won't have time anyway to test it...",
    "created_at": "2012-11-16T12:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148754",
    "user": "https://github.com/jdemeyer"
}
```

Whether or not IPython causes the zope.interface problem, I won't have time anyway to test it...



---

archive/issue_events_034516.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-16T12:59:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34516"
}
```



---

archive/issue_events_034517.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-16T12:59:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34517"
}
```



---

archive/issue_comments_148755.json:
```json
{
    "body": "This seems like it has to be a sagenb problem (that we aren't requiring zope.interface, and thus packaging zope.interface, in our sagenb prereqs).\n\nUpgrading from sage 4.5?  I'm almost sure that it's the sagenb upgrade at #13121, not this ticket.",
    "created_at": "2012-11-16T14:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148755",
    "user": "https://github.com/jasongrout"
}
```

This seems like it has to be a sagenb problem (that we aren't requiring zope.interface, and thus packaging zope.interface, in our sagenb prereqs).

Upgrading from sage 4.5?  I'm almost sure that it's the sagenb upgrade at #13121, not this ticket.



---

archive/issue_comments_148756.json:
```json
{
    "body": "Okay, here's what makes sense: the old IPython required zope.interface, so it was always installed when we installed the new notebook, so we never noticed that we needed it for the sage notebook.  The new IPython no longer requires zope.interface, so when the notebook at #13121 checks for it, it isn't installed so sagenb tries to install it.\n\nThe correct fix is to make sagenb require and package zope.interface, like it should have before now, not to change this ticket.",
    "created_at": "2012-11-16T14:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148756",
    "user": "https://github.com/jasongrout"
}
```

Okay, here's what makes sense: the old IPython required zope.interface, so it was always installed when we installed the new notebook, so we never noticed that we needed it for the sage notebook.  The new IPython no longer requires zope.interface, so when the notebook at #13121 checks for it, it isn't installed so sagenb tries to install it.

The correct fix is to make sagenb require and package zope.interface, like it should have before now, not to change this ticket.



---

archive/issue_comments_148757.json:
```json
{
    "body": "I uploaded a new sagenb spkg at #13717",
    "created_at": "2012-11-16T16:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148757",
    "user": "https://github.com/jasongrout"
}
```

I uploaded a new sagenb spkg at #13717



---

archive/issue_comments_148758.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-11-16T19:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148758",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148759.json:
```json
{
    "body": "Another upgrade issue:\n\n```\nsage_root-5.5.beta2\nMachine:\nDarwin bsd.math.washington.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:32:41 PDT 2011; root:xnu-1504.15.3~1/RELEASE_X86_64 x86_64\nDeleting directories from past builds of previous/current versions of sage_root-5.5.beta2\nExtracting package /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/spkg/standard/sage_root-5.5.beta2.spkg ...\n-rw-r--r--  1 buildbot  staff  323619 Nov 16 04:38 /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/spkg/standard/sage_root-5.5.beta2.spkg\nFinished extraction\n****************************************************\nHost system\nuname -a:\nDarwin bsd.math.washington.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:32:41 PDT 2011; root:xnu-1504.15.3~1/RELEASE_X86_64 x86_64\n****************************************************\n****************************************************\nCC Version\ngcc -v\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local/libexec/gcc/x86_64-apple-darwin10.8.0/4.6.3/lto-wrapper\nTarget: x86_64-apple-darwin10.8.0\nConfigured with: ../src/configure --prefix=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-local-prefix=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-gmp=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-mpfr=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-mpc=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-system-zlib --disable-multilib  \nThread model: posix\ngcc version 4.6.3 (GCC) \n****************************************************\ncp: ipython: No such file or directory\nRoot repo: Error copying files from Sage root repo to /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2\n```\n\nThe file `spkg/root-spkg-install` should be fixed.",
    "created_at": "2012-11-16T19:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148759",
    "user": "https://github.com/jdemeyer"
}
```

Another upgrade issue:

```
sage_root-5.5.beta2
Machine:
Darwin bsd.math.washington.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:32:41 PDT 2011; root:xnu-1504.15.3~1/RELEASE_X86_64 x86_64
Deleting directories from past builds of previous/current versions of sage_root-5.5.beta2
Extracting package /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/spkg/standard/sage_root-5.5.beta2.spkg ...
-rw-r--r--  1 buildbot  staff  323619 Nov 16 04:38 /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/spkg/standard/sage_root-5.5.beta2.spkg
Finished extraction
****************************************************
Host system
uname -a:
Darwin bsd.math.washington.edu 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun  7 16:32:41 PDT 2011; root:xnu-1504.15.3~1/RELEASE_X86_64 x86_64
****************************************************
****************************************************
CC Version
gcc -v
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local/libexec/gcc/x86_64-apple-darwin10.8.0/4.6.3/lto-wrapper
Target: x86_64-apple-darwin10.8.0
Configured with: ../src/configure --prefix=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-local-prefix=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-gmp=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-mpfr=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-mpc=/Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2/local --with-system-zlib --disable-multilib  
Thread model: posix
gcc version 4.6.3 (GCC) 
****************************************************
cp: ipython: No such file or directory
Root repo: Error copying files from Sage root repo to /Users/buildbot/build/sage/bsd-1/bsd_upgrade_4.6.2/build/sage-5.5.beta2
```

The file `spkg/root-spkg-install` should be fixed.



---

archive/issue_comments_148760.json:
```json
{
    "body": "Jason: that makes sense.",
    "created_at": "2012-11-16T19:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148760",
    "user": "https://github.com/jdemeyer"
}
```

Jason: that makes sense.



---

archive/issue_comments_148761.json:
```json
{
    "body": "Attachment [trac_12719-root-spkg-install.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-root-spkg-install.patch) by @jhpalmieri created at 2012-11-16 19:27:00\n\nroot repo",
    "created_at": "2012-11-16T19:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148761",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12719-root-spkg-install.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-root-spkg-install.patch) by @jhpalmieri created at 2012-11-16 19:27:00

root repo



---

archive/issue_comments_148762.json:
```json
{
    "body": "I think this patch will fix the problem.",
    "created_at": "2012-11-16T19:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148762",
    "user": "https://github.com/jhpalmieri"
}
```

I think this patch will fix the problem.



---

archive/issue_comments_148763.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-16T19:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148763",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148764.json:
```json
{
    "body": "Here's another problem highlighted by https://github.com/sagemath/sagecell/issues/378: \n\n```\n\"\"\"string\n\"\"\"; type(1)\n```\ndoes no preparsing on the second line because IPython doesn't do transformations for the second line (since it's inside quotes).  IPython admits that this is a hackish and fragile strategy, and they are working on the issue.  For example, they are implementing [AST transformers](https://github.com/ipython/ipython/pull/2301) and [stateful line transformers](https://github.com/ipython/ipython/pull/2447).  However, for now, we should run at least our preparser on every line of input, since we *do* keep track of state, so we need to be preparsing that second line.\n\nI have a patch coming up shortly.",
    "created_at": "2012-11-29T04:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148764",
    "user": "https://github.com/jasongrout"
}
```

Here's another problem highlighted by https://github.com/sagemath/sagecell/issues/378: 

```
"""string
"""; type(1)
```
does no preparsing on the second line because IPython doesn't do transformations for the second line (since it's inside quotes).  IPython admits that this is a hackish and fragile strategy, and they are working on the issue.  For example, they are implementing [AST transformers](https://github.com/ipython/ipython/pull/2301) and [stateful line transformers](https://github.com/ipython/ipython/pull/2447).  However, for now, we should run at least our preparser on every line of input, since we *do* keep track of state, so we need to be preparsing that second line.

I have a patch coming up shortly.



---

archive/issue_comments_148765.json:
```json
{
    "body": "Attachment [trac-12719-always-preparse.patch](tarball://root/attachments/some-uuid/ticket12719/trac-12719-always-preparse.patch) by @jasongrout created at 2012-11-29 06:28:18\n\napply to sage library",
    "created_at": "2012-11-29T06:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148765",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac-12719-always-preparse.patch](tarball://root/attachments/some-uuid/ticket12719/trac-12719-always-preparse.patch) by @jasongrout created at 2012-11-29 06:28:18

apply to sage library



---

archive/issue_comments_148766.json:
```json
{
    "body": "Does this most recent patch need a doctest?",
    "created_at": "2012-11-29T19:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148766",
    "user": "https://github.com/jhpalmieri"
}
```

Does this most recent patch need a doctest?



---

archive/issue_comments_148767.json:
```json
{
    "body": "By the way, this passes all doctests. I also upgraded Sage 5.2 successfully from a source distribution prepared using the patches here.",
    "created_at": "2012-11-30T05:48:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148767",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, this passes all doctests. I also upgraded Sage 5.2 successfully from a source distribution prepared using the patches here.



---

archive/issue_events_034518.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T15:14:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34518"
}
```



---

archive/issue_events_034519.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-12T15:14:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34519"
}
```



---

archive/issue_comments_148768.json:
```json
{
    "body": "Attachment [trac_12719-scripts-vb.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-scripts-vb.patch) by @vbraun created at 2013-01-13 14:42:52\n\nUpdated patch",
    "created_at": "2013-01-13T14:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148768",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_12719-scripts-vb.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-scripts-vb.patch) by @vbraun created at 2013-01-13 14:42:52

Updated patch



---

archive/issue_comments_148769.json:
```json
{
    "body": "I've rediffed trac_12719-scripts-vb.patch to account for pure whitespace changes in #13899 (merged in sage-5.6.beta3)",
    "created_at": "2013-01-13T14:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148769",
    "user": "https://github.com/vbraun"
}
```

I've rediffed trac_12719-scripts-vb.patch to account for pure whitespace changes in #13899 (merged in sage-5.6.beta3)



---

archive/issue_comments_148770.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-14T11:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148770",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148771.json:
```json
{
    "body": "Works for me and as far as I can tell all remaining issues have been addressed.\n\nDoes not fix #11223, %bg is not implemented in ipython-0.13.1.",
    "created_at": "2013-01-14T11:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148771",
    "user": "https://github.com/vbraun"
}
```

Works for me and as far as I can tell all remaining issues have been addressed.

Does not fix #11223, %bg is not implemented in ipython-0.13.1.



---

archive/issue_comments_148772.json:
```json
{
    "body": "Rediffed patch",
    "created_at": "2013-01-17T15:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148772",
    "user": "https://github.com/jdemeyer"
}
```

Rediffed patch



---

archive/issue_comments_148773.json:
```json
{
    "body": "Attachment [trac_12719-rebased-to-13211-vb.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-rebased-to-13211-vb.patch) by @jdemeyer created at 2013-01-17 15:44:27",
    "created_at": "2013-01-17T15:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148773",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_12719-rebased-to-13211-vb.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-rebased-to-13211-vb.patch) by @jdemeyer created at 2013-01-17 15:44:27



---

archive/issue_comments_148774.json:
```json
{
    "body": "This seems to cause some problems on OpenSolaris.\n\nFirst a doctest time-out:\n\n```\nTrying:\n    sage0.eval('2+2')###line 320:_sage_    sage: sage0.eval('2+2')\nExpecting:\n    '4'\n[...hangs...]\n```\n\nInterrupting this and restarting Sage gives:\n\n```\nbuildbot@hawk:~/build/sage/hawk-1/hawk_suncc/build/sage$ ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n| Sage Version 5.7.beta0, Release Date: 2013-01-20                   |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n**********************************************************************\n\nOops, Sage crashed. We do our best to make it stable, but...\n\nA crash report was automatically generated with the following information:\n  - A verbatim copy of the crash traceback.\n  - A copy of your input history during this session.\n  - Data on your current Sage configuration.\n\nIt was left in the file named:\n        '/export/home/buildbot/.sage/ipython-new/Sage_crash_report.txt'\nIf you can email this file to the developers, the information in it will help\nthem in understanding and correcting the problem.\n\nYou can mail it to: sage-support at sage-support@googlegroups.com\nwith the subject 'Sage Crash Report'.\n\nIf you want to do it now, the following command will work (under Unix):\nmail -s 'Sage Crash Report' sage-support@googlegroups.com < /export/home/buildbot/.sage/ipython-new/Sage_crash_report.txt\n\nTo ensure accurate tracking of this issue, please file a report about it at:\nhttp://trac.sagemath.org/sage_trac\n\nHit <Enter> to quit (your terminal may close)\n```\n\nRemoving `$HOME/.sage` fixed that.",
    "created_at": "2013-01-20T21:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148774",
    "user": "https://github.com/jdemeyer"
}
```

This seems to cause some problems on OpenSolaris.

First a doctest time-out:

```
Trying:
    sage0.eval('2+2')###line 320:_sage_    sage: sage0.eval('2+2')
Expecting:
    '4'
[...hangs...]
```

Interrupting this and restarting Sage gives:

```
buildbot@hawk:~/build/sage/hawk-1/hawk_suncc/build/sage$ ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
| Sage Version 5.7.beta0, Release Date: 2013-01-20                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
**********************************************************************

Oops, Sage crashed. We do our best to make it stable, but...

A crash report was automatically generated with the following information:
  - A verbatim copy of the crash traceback.
  - A copy of your input history during this session.
  - Data on your current Sage configuration.

It was left in the file named:
        '/export/home/buildbot/.sage/ipython-new/Sage_crash_report.txt'
If you can email this file to the developers, the information in it will help
them in understanding and correcting the problem.

You can mail it to: sage-support at sage-support@googlegroups.com
with the subject 'Sage Crash Report'.

If you want to do it now, the following command will work (under Unix):
mail -s 'Sage Crash Report' sage-support@googlegroups.com < /export/home/buildbot/.sage/ipython-new/Sage_crash_report.txt

To ensure accurate tracking of this issue, please file a report about it at:
http://trac.sagemath.org/sage_trac

Hit <Enter> to quit (your terminal may close)
```

Removing `$HOME/.sage` fixed that.



---

archive/issue_comments_148775.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-20T21:22:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148775",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148776.json:
```json
{
    "body": "Can we have a beta0 with this ticket? Its a bit ridiculous to have to use a script to apply all these patches.\n\nAlso, `.sage/ipython-new`? What are we going to do the next time the configuration file format changes, `.sage/ipython-even-newer`?",
    "created_at": "2013-01-20T22:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148776",
    "user": "https://github.com/vbraun"
}
```

Can we have a beta0 with this ticket? Its a bit ridiculous to have to use a script to apply all these patches.

Also, `.sage/ipython-new`? What are we going to do the next time the configuration file format changes, `.sage/ipython-even-newer`?



---

archive/issue_comments_148777.json:
```json
{
    "body": "Replying to [comment:222 vbraun]:\n> Can we have a beta0 with this ticket?\n\nSee [http://sage.math.washington.edu/home/release/sage-5.7.beta1](http://sage.math.washington.edu/home/release/sage-5.7.beta1)",
    "created_at": "2013-01-21T10:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148777",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:222 vbraun]:
> Can we have a beta0 with this ticket?

See [http://sage.math.washington.edu/home/release/sage-5.7.beta1](http://sage.math.washington.edu/home/release/sage-5.7.beta1)



---

archive/issue_comments_148778.json:
```json
{
    "body": "Volker, you're right that the config file directory is still a bit clunky.  On the one hand, I didn't want to put the version number in there so that it changes every time we upgrade IPython.  On the other hand, calling something 'new' doesn't scale.\n\nWhat if we put the version number in there like this: `ipython-0.12-or-later`?  That's weird too, but it also means that people don't have to keep moving their configuration files if IPython upgrades, but the config format stays the same.",
    "created_at": "2013-01-21T15:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148778",
    "user": "https://github.com/jasongrout"
}
```

Volker, you're right that the config file directory is still a bit clunky.  On the one hand, I didn't want to put the version number in there so that it changes every time we upgrade IPython.  On the other hand, calling something 'new' doesn't scale.

What if we put the version number in there like this: `ipython-0.12-or-later`?  That's weird too, but it also means that people don't have to keep moving their configuration files if IPython upgrades, but the config format stays the same.



---

archive/issue_comments_148779.json:
```json
{
    "body": "I think we are smart enough to figure out that `ipython-0.12` is the directory for configuration files that were introduced with iPython 0.12 and that you might run a later (but still compatible) version.",
    "created_at": "2013-01-21T15:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148779",
    "user": "https://github.com/vbraun"
}
```

I think we are smart enough to figure out that `ipython-0.12` is the directory for configuration files that were introduced with iPython 0.12 and that you might run a later (but still compatible) version.



---

archive/issue_comments_148780.json:
```json
{
    "body": "But IIRC, Matplotlib uses a per-version config directory inside of .sage, so having two conventions could be confusing.",
    "created_at": "2013-01-21T19:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148780",
    "user": "https://github.com/jasongrout"
}
```

But IIRC, Matplotlib uses a per-version config directory inside of .sage, so having two conventions could be confusing.



---

archive/issue_comments_148781.json:
```json
{
    "body": "What about the name `IPython-0.12+`?",
    "created_at": "2013-01-21T19:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148781",
    "user": "https://github.com/jasongrout"
}
```

What about the name `IPython-0.12+`?



---

archive/issue_comments_148782.json:
```json
{
    "body": "I don't really care about the name as long as it has the version somewhere in there. Personally I find anything extra just confusing but feel free to pick what you like.",
    "created_at": "2013-01-21T19:42:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148782",
    "user": "https://github.com/vbraun"
}
```

I don't really care about the name as long as it has the version somewhere in there. Personally I find anything extra just confusing but feel free to pick what you like.



---

archive/issue_comments_148783.json:
```json
{
    "body": "Jeroen: can you attach the /export/home/buildbot/.sage/ipython-new/Sage_crash_report.txt",
    "created_at": "2013-01-21T19:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148783",
    "user": "https://github.com/vbraun"
}
```

Jeroen: can you attach the /export/home/buildbot/.sage/ipython-new/Sage_crash_report.txt



---

archive/issue_comments_148784.json:
```json
{
    "body": "I tested this on OpenIndiana (OpenSolaris clone) and I don't see the timeout that Jeroen has. I get occasional non-reproducible timeouts on OI though, it might be something generally wonky with their PTYs. Remind me again why something that nobody is using or has access to is a primary platform?",
    "created_at": "2013-01-21T22:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148784",
    "user": "https://github.com/vbraun"
}
```

I tested this on OpenIndiana (OpenSolaris clone) and I don't see the timeout that Jeroen has. I get occasional non-reproducible timeouts on OI though, it might be something generally wonky with their PTYs. Remind me again why something that nobody is using or has access to is a primary platform?



---

archive/issue_comments_148785.json:
```json
{
    "body": "I see a crash on David Kirkby's machine hawk. Crash log posted [here](http://sage.math.washington.edu/home/palmieri/misc/Sage_crash_report.txt).",
    "created_at": "2013-01-21T23:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148785",
    "user": "https://github.com/jhpalmieri"
}
```

I see a crash on David Kirkby's machine hawk. Crash log posted [here](http://sage.math.washington.edu/home/palmieri/misc/Sage_crash_report.txt).



---

archive/issue_comments_148786.json:
```json
{
    "body": "Sane catching of history database errors has been fixed upstream at https://github.com/ipython/ipython/commit/d347c347bab915df69d499521b4876d3c9b168b9, but not in a released version.\n\nSee also: https://github.com/ipython/ipython/issues/2097",
    "created_at": "2013-01-22T12:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148786",
    "user": "https://github.com/vbraun"
}
```

Sane catching of history database errors has been fixed upstream at https://github.com/ipython/ipython/commit/d347c347bab915df69d499521b4876d3c9b168b9, but not in a released version.

See also: https://github.com/ipython/ipython/issues/2097



---

archive/issue_comments_148787.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-22T13:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148787",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148788.json:
```json
{
    "body": "I've backported the changes to `history.py`, this should fix the startup failure.",
    "created_at": "2013-01-22T13:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148788",
    "user": "https://github.com/vbraun"
}
```

I've backported the changes to `history.py`, this should fix the startup failure.



---

archive/issue_comments_148789.json:
```json
{
    "body": "Keeping track, I guess there's one more thing to do: change the config directory back to .sage/ipython-0.12 in [attachment:trac_12719-ipythondir013.patch]",
    "created_at": "2013-01-22T16:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148789",
    "user": "https://github.com/jasongrout"
}
```

Keeping track, I guess there's one more thing to do: change the config directory back to .sage/ipython-0.12 in [attachment:trac_12719-ipythondir013.patch]



---

archive/issue_comments_148790.json:
```json
{
    "body": "Attachment [trac_12719-ipythondir013.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-ipythondir013.patch) by @jasongrout created at 2013-01-22 17:22:55\n\nrebased to 5.4rc1",
    "created_at": "2013-01-22T17:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148790",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac_12719-ipythondir013.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719-ipythondir013.patch) by @jasongrout created at 2013-01-22 17:22:55

rebased to 5.4rc1



---

archive/issue_comments_148791.json:
```json
{
    "body": "Okay, I changed the ipythondir013.patch to use the config directory ipython-0.12.  So that needs review too.",
    "created_at": "2013-01-22T17:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148791",
    "user": "https://github.com/jasongrout"
}
```

Okay, I changed the ipythondir013.patch to use the config directory ipython-0.12.  So that needs review too.



---

archive/issue_comments_148792.json:
```json
{
    "body": "Updating work issues with the things that need review.",
    "created_at": "2013-01-22T17:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148792",
    "user": "https://github.com/jasongrout"
}
```

Updating work issues with the things that need review.



---

archive/issue_comments_148793.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-22T19:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148793",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148794.json:
```json
{
    "body": "I'm fine with your patch for the directory name. Any expect interface on OpenIndiana occasionally crashes (maybe 1 in 20), but I've verified we are now not permanently stuck with a corrupted history file any more.",
    "created_at": "2013-01-22T19:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148794",
    "user": "https://github.com/vbraun"
}
```

I'm fine with your patch for the directory name. Any expect interface on OpenIndiana occasionally crashes (maybe 1 in 20), but I've verified we are now not permanently stuck with a corrupted history file any more.



---

archive/issue_comments_148795.json:
```json
{
    "body": "On hawk, I see a doctest failure, but I'm not sure how it could be related to this ticket:\n\n```\nsage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py                     \n**********************************************************************                    \nFile \"/export/home/palmieri/testing/clean/sage-5.7.beta1/devel/sage-main/sage/tests/frenc\\\nh_book/mpoly.py\", line 373:                                                               \n    sage: J.variety(RDF)                                                                  \nExpected:                                                                                 \n    [{y: 396340.89..., x: 26.61226...}]                                                   \nGot:                                                                                      \n    [{y: 396340.890167, x: -46.7888621592}]                                               \n**********************************************************************                    \n1 items had failures:                                                                     \n   1 of 151 in __main__.example_0                                                         \n***Test Failed*** 1 failures.                       \n```\nI also see a time out:\n\n```\nsage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py                            \n*** *** Error: TIMED OUT! PROCESS KILLED! *** ***                                         \n                                                                                          \n         [1800.2 s] \n```\nwhich perhaps is related to this ticket.",
    "created_at": "2013-01-22T20:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148795",
    "user": "https://github.com/jhpalmieri"
}
```

On hawk, I see a doctest failure, but I'm not sure how it could be related to this ticket:

```
sage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py                     
**********************************************************************                    
File "/export/home/palmieri/testing/clean/sage-5.7.beta1/devel/sage-main/sage/tests/frenc\
h_book/mpoly.py", line 373:                                                               
    sage: J.variety(RDF)                                                                  
Expected:                                                                                 
    [{y: 396340.89..., x: 26.61226...}]                                                   
Got:                                                                                      
    [{y: 396340.890167, x: -46.7888621592}]                                               
**********************************************************************                    
1 items had failures:                                                                     
   1 of 151 in __main__.example_0                                                         
***Test Failed*** 1 failures.                       
```
I also see a time out:

```
sage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py                            
*** *** Error: TIMED OUT! PROCESS KILLED! *** ***                                         
                                                                                          
         [1800.2 s] 
```
which perhaps is related to this ticket.



---

archive/issue_comments_148796.json:
```json
{
    "body": "Replying to [comment:238 jhpalmieri]:\n> sage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py                     \n\nNot related to this ticket.\n\n> {{{\n> sage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py                            \n> *** *** Error: TIMED OUT! PROCESS KILLED! *** ***                                         \n>                                                                                           \n>          [1800.2 s] \n> }}}\n\nThis is indeed related to this ticket, see [comment:221].  But I haven't tried with the latest version of the spkg.",
    "created_at": "2013-01-23T07:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148796",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:238 jhpalmieri]:
> sage -t  --long -force_lib devel/sage/sage/tests/french_book/mpoly.py                     

Not related to this ticket.

> {{{
> sage -t  --long -force_lib devel/sage/sage/interfaces/sage0.py                            
> *** *** Error: TIMED OUT! PROCESS KILLED! *** ***                                         
>                                                                                           
>          [1800.2 s] 
> }}}

This is indeed related to this ticket, see [comment:221].  But I haven't tried with the latest version of the spkg.



---

archive/issue_comments_148797.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-23T13:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148797",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148798.json:
```json
{
    "body": "Patches [attachment:trac_12719_ROOT_configuration_files.patch] and [attachment:trac_12719-ipythondir013.patch] combined and rebased.  And moved the setting of `IPYTHONDIR` to `sage-env` where it belongs.",
    "created_at": "2013-01-23T13:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148798",
    "user": "https://github.com/jdemeyer"
}
```

Patches [attachment:trac_12719_ROOT_configuration_files.patch] and [attachment:trac_12719-ipythondir013.patch] combined and rebased.  And moved the setting of `IPYTHONDIR` to `sage-env` where it belongs.



---

archive/issue_comments_148799.json:
```json
{
    "body": "Attachment [trac_12719_ROOT_configuration_files.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_ROOT_configuration_files.patch) by @jdemeyer created at 2013-01-23 13:51:21\n\nRebased to sage-5.7.beta0",
    "created_at": "2013-01-23T13:51:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148799",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [trac_12719_ROOT_configuration_files.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_ROOT_configuration_files.patch) by @jdemeyer created at 2013-01-23 13:51:21

Rebased to sage-5.7.beta0



---

archive/issue_comments_148800.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-23T13:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148800",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148801.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-23T15:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148801",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148802.json:
```json
{
    "body": "Sounds good to me.",
    "created_at": "2013-01-23T15:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148802",
    "user": "https://github.com/vbraun"
}
```

Sounds good to me.



---

archive/issue_events_034520.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-23T15:47:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34520"
}
```



---

archive/issue_events_034521.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-23T15:47:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "milestone": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34521"
}
```



---

archive/issue_comments_148803.json:
```json
{
    "body": "Volker and Jeroen: thanks for both of you working quickly on the last remaining issues!",
    "created_at": "2013-01-23T17:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148803",
    "user": "https://github.com/jasongrout"
}
```

Volker and Jeroen: thanks for both of you working quickly on the last remaining issues!



---

archive/issue_comments_148804.json:
```json
{
    "body": "One patch doesn't apply cleanly to 5.6.rc1:\n\n```\nadding trac_12719-rebased-to-13211-vb.patch to series file\napplying trac_12719-rebased-to-13211-vb.patch\npatching file sage/interfaces/gap.py\nHunk #1 FAILED at 177\n1 out of 2 hunks FAILED -- saving rejects to file sage/interfaces/gap.py.rej\n```\nI *think* that the hang on hawk is gone with the latest versions, but I'm testing again to make sure.",
    "created_at": "2013-01-23T20:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148804",
    "user": "https://github.com/jhpalmieri"
}
```

One patch doesn't apply cleanly to 5.6.rc1:

```
adding trac_12719-rebased-to-13211-vb.patch to series file
applying trac_12719-rebased-to-13211-vb.patch
patching file sage/interfaces/gap.py
Hunk #1 FAILED at 177
1 out of 2 hunks FAILED -- saving rejects to file sage/interfaces/gap.py.rej
```
I *think* that the hang on hawk is gone with the latest versions, but I'm testing again to make sure.



---

archive/issue_comments_148805.json:
```json
{
    "body": "Replying to [comment:246 jhpalmieri]:\n> One patch doesn't apply cleanly to 5.6.rc1:\n\n\nYou might be missing a dependency since the patch is in sage-5.7.beta1...",
    "created_at": "2013-01-23T20:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148805",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:246 jhpalmieri]:
> One patch doesn't apply cleanly to 5.6.rc1:


You might be missing a dependency since the patch is in sage-5.7.beta1...



---

archive/issue_comments_148806.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-23T20:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148806",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148807.json:
```json
{
    "body": "I didn't think that 5.7.beta0 had been released. Am I supposed to use the unofficial version of it?\n\nBy the way, since the file `ipy_profile_sage.py` has been deleted, any mention of it should also be removed from `sage-make_devel_packages` and `sage-spkg-install`.",
    "created_at": "2013-01-23T20:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148807",
    "user": "https://github.com/jhpalmieri"
}
```

I didn't think that 5.7.beta0 had been released. Am I supposed to use the unofficial version of it?

By the way, since the file `ipy_profile_sage.py` has been deleted, any mention of it should also be removed from `sage-make_devel_packages` and `sage-spkg-install`.



---

archive/issue_comments_148808.json:
```json
{
    "body": "Can someone test something really quick with the official version of the ticket, if it's convenient?\n\nDo:\n\n```\n1; 2\n```\n\nDoes it print out both 1 and 2 in both the command line and the notebook?  Right now, aleph only prints out 2, and I've narrowed it down to how IPython handles the 'print out the last expression' (IPython prints out the last expression, while Sage prints out the last physical line).",
    "created_at": "2013-01-23T20:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148808",
    "user": "https://github.com/jasongrout"
}
```

Can someone test something really quick with the official version of the ticket, if it's convenient?

Do:

```
1; 2
```

Does it print out both 1 and 2 in both the command line and the notebook?  Right now, aleph only prints out 2, and I've narrowed it down to how IPython handles the 'print out the last expression' (IPython prints out the last expression, while Sage prints out the last physical line).



---

archive/issue_comments_148809.json:
```json
{
    "body": "John, see comment:223. Since Jeroen linked to it I'd say its official ;-)\n\nJason, works for me (this is with the sagenb update but it shouldn't matter):\n\n```\n[vbraun@volker-desktop sage-5.7.beta1]$ ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nsage: \u00a01; 2\n1\n2\n```",
    "created_at": "2013-01-23T21:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148809",
    "user": "https://github.com/vbraun"
}
```

John, see comment:223. Since Jeroen linked to it I'd say its official ;-)

Jason, works for me (this is with the sagenb update but it shouldn't matter):

```
[vbraun@volker-desktop sage-5.7.beta1]$ ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
sage: 1; 2
1
2
```



---

archive/issue_comments_148810.json:
```json
{
    "body": "Initial patch",
    "created_at": "2013-01-23T22:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148810",
    "user": "https://github.com/vbraun"
}
```

Initial patch



---

archive/issue_comments_148811.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-23T22:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148811",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_148812.json:
```json
{
    "body": "Attachment [trac_12719_purge_ipy_profile_sage.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_purge_ipy_profile_sage.patch) by @vbraun created at 2013-01-23 22:29:14\n\nI've removed the last occurrences from `ipy_profile_sage.py`.",
    "created_at": "2013-01-23T22:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148812",
    "user": "https://github.com/vbraun"
}
```

Attachment [trac_12719_purge_ipy_profile_sage.patch](tarball://root/attachments/some-uuid/ticket12719/trac_12719_purge_ipy_profile_sage.patch) by @vbraun created at 2013-01-23 22:29:14

I've removed the last occurrences from `ipy_profile_sage.py`.



---

archive/issue_comments_148813.json:
```json
{
    "body": "Volker: and in the sage notebook, it does the same thing?  I think it should, but I just want to make sure.",
    "created_at": "2013-01-23T22:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148813",
    "user": "https://github.com/jasongrout"
}
```

Volker: and in the sage notebook, it does the same thing?  I think it should, but I just want to make sure.



---

archive/issue_comments_148814.json:
```json
{
    "body": "Replying to [comment:252 jason]:\n> Volker: and in the sage notebook, it does the same thing?\n\n\nYes, same (correct) output in the notebook (with the sagenb-0.10.4 spkg).",
    "created_at": "2013-01-23T22:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148814",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:252 jason]:
> Volker: and in the sage notebook, it does the same thing?


Yes, same (correct) output in the notebook (with the sagenb-0.10.4 spkg).



---

archive/issue_comments_148815.json:
```json
{
    "body": "Could somebody who knows this ticket please look at #12167 and #12926 to check whether they might be closed?",
    "created_at": "2013-01-24T08:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148815",
    "user": "https://github.com/jdemeyer"
}
```

Could somebody who knows this ticket please look at #12167 and #12926 to check whether they might be closed?



---

archive/issue_comments_148816.json:
```json
{
    "body": "I think both of those can be closed.  The new config system is set up with IPYTHONDIR, which is in DOTSAGE.  sage --ipython should use that now.",
    "created_at": "2013-01-24T08:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148816",
    "user": "https://github.com/jasongrout"
}
```

I think both of those can be closed.  The new config system is set up with IPYTHONDIR, which is in DOTSAGE.  sage --ipython should use that now.



---

archive/issue_comments_148817.json:
```json
{
    "body": "Hello,\n\nI just want to confirm that this is expected with this ticket:\n\n```\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: exit\n'Use Ctrl-D (i.e. EOF), %Exit, or %Quit to exit without confirmation.'\nsage: \n```\nWas \"just exit for exit\" a feature of old IPython or Sage?",
    "created_at": "2013-01-25T02:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148817",
    "user": "https://github.com/novoselt"
}
```

Hello,

I just want to confirm that this is expected with this ticket:

```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: exit
'Use Ctrl-D (i.e. EOF), %Exit, or %Quit to exit without confirmation.'
sage: 
```
Was "just exit for exit" a feature of old IPython or Sage?



---

archive/issue_comments_148818.json:
```json
{
    "body": "Attachment [12719_ipython_test.patch](tarball://root/attachments/some-uuid/ticket12719/12719_ipython_test.patch) by @jdemeyer created at 2013-01-25 09:02:39",
    "created_at": "2013-01-25T09:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148818",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [12719_ipython_test.patch](tarball://root/attachments/some-uuid/ticket12719/12719_ipython_test.patch) by @jdemeyer created at 2013-01-25 09:02:39



---

archive/issue_comments_148819.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-25T09:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148819",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148820.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-25T09:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148820",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148821.json:
```json
{
    "body": "[attachment:12719_ipython_test.patch] needs review",
    "created_at": "2013-01-25T09:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148821",
    "user": "https://github.com/jdemeyer"
}
```

[attachment:12719_ipython_test.patch] needs review



---

archive/issue_comments_148822.json:
```json
{
    "body": "I don't know whats up with the overly attached Python interpreter but at least Ctrl-D works. Imho exit should just do that but that can be done (and doctested) on another ticket.\n\nJeroen's patch looks good to me.",
    "created_at": "2013-01-25T09:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148822",
    "user": "https://github.com/vbraun"
}
```

I don't know whats up with the overly attached Python interpreter but at least Ctrl-D works. Imho exit should just do that but that can be done (and doctested) on another ticket.

Jeroen's patch looks good to me.



---

archive/issue_comments_148823.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-25T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148823",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148824.json:
```json
{
    "body": "The timeout on `hawk` of [comment:221] still exists, I'll have a look.",
    "created_at": "2013-01-25T13:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148824",
    "user": "https://github.com/jdemeyer"
}
```

The timeout on `hawk` of [comment:221] still exists, I'll have a look.



---

archive/issue_comments_148825.json:
```json
{
    "body": "This is the cause of the crash on `hawk`, it still has to do with the history database: [http://boxen.math.washington.edu/home/buildbot/crashlogs/hawk_ipython_crash.log](http://boxen.math.washington.edu/home/buildbot/crashlogs/hawk_ipython_crash.log)",
    "created_at": "2013-01-25T14:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148825",
    "user": "https://github.com/jdemeyer"
}
```

This is the cause of the crash on `hawk`, it still has to do with the history database: [http://boxen.math.washington.edu/home/buildbot/crashlogs/hawk_ipython_crash.log](http://boxen.math.washington.edu/home/buildbot/crashlogs/hawk_ipython_crash.log)



---

archive/issue_comments_148826.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-01-25T14:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148826",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_148827.json:
```json
{
    "body": "We should probably disable the command history for the `sage0()` interface, but I don't know how one can do that.",
    "created_at": "2013-01-25T14:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148827",
    "user": "https://github.com/jdemeyer"
}
```

We should probably disable the command history for the `sage0()` interface, but I don't know how one can do that.



---

archive/issue_comments_148828.json:
```json
{
    "body": "Can be done in IPython with \n\n```\nipython --HistoryManager.hist_file=:memory:\n```",
    "created_at": "2013-01-25T14:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148828",
    "user": "https://github.com/vbraun"
}
```

Can be done in IPython with 

```
ipython --HistoryManager.hist_file=:memory:
```



---

archive/issue_comments_148829.json:
```json
{
    "body": "How about we run sage0 with `--nodotsage`?",
    "created_at": "2013-01-25T14:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148829",
    "user": "https://github.com/vbraun"
}
```

How about we run sage0 with `--nodotsage`?



---

archive/issue_comments_148830.json:
```json
{
    "body": "Replying to [comment:266 vbraun]:\n> How about we run sage0 with `--nodotsage`?\n\nNo, having access to the IPython crash log would be good.\n\nI'm preparing a patch, hang on...",
    "created_at": "2013-01-25T14:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148830",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:266 vbraun]:
> How about we run sage0 with `--nodotsage`?

No, having access to the IPython crash log would be good.

I'm preparing a patch, hang on...



---

archive/issue_comments_148831.json:
```json
{
    "body": "Attachment [12719_ipython_no_history.patch](tarball://root/attachments/some-uuid/ticket12719/12719_ipython_no_history.patch) by @jdemeyer created at 2013-01-25 14:41:27",
    "created_at": "2013-01-25T14:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148831",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [12719_ipython_no_history.patch](tarball://root/attachments/some-uuid/ticket12719/12719_ipython_no_history.patch) by @jdemeyer created at 2013-01-25 14:41:27



---

archive/issue_comments_148832.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-01-25T14:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148832",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148833.json:
```json
{
    "body": "I've reported the issue upstream: https://github.com/ipython/ipython/issues/2845",
    "created_at": "2013-01-25T14:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148833",
    "user": "https://github.com/vbraun"
}
```

I've reported the issue upstream: https://github.com/ipython/ipython/issues/2845



---

archive/issue_comments_148834.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-25T14:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148834",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148835.json:
```json
{
    "body": "Sounds good to me. I've verified that this disables caching. I don't have a harddisk that is slow enough to trigger the locking issue ;-)",
    "created_at": "2013-01-25T14:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148835",
    "user": "https://github.com/vbraun"
}
```

Sounds good to me. I've verified that this disables caching. I don't have a harddisk that is slow enough to trigger the locking issue ;-)



---

archive/issue_comments_148836.json:
```json
{
    "body": "On `sage.math`, over NFS it's fairly easy to reproduce.",
    "created_at": "2013-01-25T15:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148836",
    "user": "https://github.com/jdemeyer"
}
```

On `sage.math`, over NFS it's fairly easy to reproduce.



---

archive/issue_events_034522.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-26T09:53:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12719#event-34522"
}
```



---

archive/issue_comments_148837.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-26T09:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148837",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_148838.json:
```json
{
    "body": "John Cremona reports on `sage-release`:\n\n```\njec@fermat%./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n/home/jec/sage-5.7.beta1/local/lib/python2.7/site-packages/IPython/utils/py3compat.pyc\nin execfile(fname, *where)\n    176             else:\n    177                 filename = fname\n--> 178             __builtin__.execfile(filename, *where)\n| Sage Version 5.7.beta1, Release Date: 2013-01-26                   |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n/home/jec/.sage/init.sage in <module>()\n----> 1 load /home/jec/sage/ecdb.py\n\nNameError: name 'load' is not defined\n```",
    "created_at": "2013-01-28T11:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148838",
    "user": "https://github.com/jdemeyer"
}
```

John Cremona reports on `sage-release`:

```
jec@fermat%./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
/home/jec/sage-5.7.beta1/local/lib/python2.7/site-packages/IPython/utils/py3compat.pyc
in execfile(fname, *where)
    176             else:
    177                 filename = fname
--> 178             __builtin__.execfile(filename, *where)
| Sage Version 5.7.beta1, Release Date: 2013-01-26                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
/home/jec/.sage/init.sage in <module>()
----> 1 load /home/jec/sage/ecdb.py

NameError: name 'load' is not defined
```



---

archive/issue_comments_148839.json:
```json
{
    "body": "Volker Braun reports:\n\n```\n/mnt/storage2TB/patchbot/Sage/sage-5.7.beta1/local/lib/python2.7/site-packages/sage/misc/sage_extension.pyc in print_branch(self=<sage.misc.sage_extension.SageCustomizations object>)\n    423     def set_quit_hook(self):\n    424         \"\"\"\n    425         Set the exit hook to cleanly exit Sage.  This does not work in all cases right now.\n    426         \"\"\"\n    427         def quit(shell):\n    428             import sage\n    429             sage.all.quit_sage()\n    430         self.shell.set_hook('shutdown_hook', quit)\n    431 \n    432     def print_branch(self):\n    433         \"\"\"\n    434         Print the branch we are on currently\n    435         \"\"\"\n    436         from sage.misc.misc import branch_current_hg_notice, branch_current_hg\n    437         branch = branch_current_hg_notice(branch_current_hg())\n--> 438         if branch and not self.shell.test_shell:\n        branch = 'Loading Sage library. Current Mercurial branch is: 0'\n        self.shell.test_shell = undefined\n    439             print branch\n    440 \n    441     def init_environment(self):\n    442         \"\"\"\n    443         Set up Sage command-line environment\n    444         \"\"\"\n    445         try:\n    446             self.shell.run_cell('from sage.all import Integer, RealNumber')\n    447         except Exception:\n    448             import traceback\n    449             print \"Error importing the Sage library\"\n    450             traceback.print_exc()\n    451             print\n    452             print \"To debug this, you can run:\"\n    453             print 'sage -ipython -i -c \"import sage.all\"'\n\nAttributeError: 'SageInteractiveShell' object has no attribute 'test_shell'\n```",
    "created_at": "2013-01-28T11:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148839",
    "user": "https://github.com/jdemeyer"
}
```

Volker Braun reports:

```
/mnt/storage2TB/patchbot/Sage/sage-5.7.beta1/local/lib/python2.7/site-packages/sage/misc/sage_extension.pyc in print_branch(self=<sage.misc.sage_extension.SageCustomizations object>)
    423     def set_quit_hook(self):
    424         """
    425         Set the exit hook to cleanly exit Sage.  This does not work in all cases right now.
    426         """
    427         def quit(shell):
    428             import sage
    429             sage.all.quit_sage()
    430         self.shell.set_hook('shutdown_hook', quit)
    431 
    432     def print_branch(self):
    433         """
    434         Print the branch we are on currently
    435         """
    436         from sage.misc.misc import branch_current_hg_notice, branch_current_hg
    437         branch = branch_current_hg_notice(branch_current_hg())
--> 438         if branch and not self.shell.test_shell:
        branch = 'Loading Sage library. Current Mercurial branch is: 0'
        self.shell.test_shell = undefined
    439             print branch
    440 
    441     def init_environment(self):
    442         """
    443         Set up Sage command-line environment
    444         """
    445         try:
    446             self.shell.run_cell('from sage.all import Integer, RealNumber')
    447         except Exception:
    448             import traceback
    449             print "Error importing the Sage library"
    450             traceback.print_exc()
    451             print
    452             print "To debug this, you can run:"
    453             print 'sage -ipython -i -c "import sage.all"'

AttributeError: 'SageInteractiveShell' object has no attribute 'test_shell'
```



---

archive/issue_comments_148840.json:
```json
{
    "body": "I've created #14024 to collect any patches that we need on top of Sage-5.7.beta1",
    "created_at": "2013-01-28T11:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148840",
    "user": "https://github.com/vbraun"
}
```

I've created #14024 to collect any patches that we need on top of Sage-5.7.beta1



---

archive/issue_comments_148841.json:
```json
{
    "body": "Please have a look at #14042, another follow-up.",
    "created_at": "2013-01-31T10:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148841",
    "user": "https://github.com/jdemeyer"
}
```

Please have a look at #14042, another follow-up.



---

archive/issue_comments_148842.json:
```json
{
    "body": "There is still this problem:\n\n```\njec@fermat%./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n/home/jec/sage-5.7.beta1/local/lib/python2.7/site-packages/IPython/utils/py3compat.pyc\nin execfile(fname, *where)\n    176             else:\n    177                 filename = fname\n--> 178             __builtin__.execfile(filename, *where)\n| Sage Version 5.7.beta1, Release Date: 2013-01-26                   |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\n/home/jec/.sage/init.sage in <module>()\n----> 1 load /home/jec/sage/ecdb.py\n\nNameError: name 'load' is not defined\n```",
    "created_at": "2013-02-01T12:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148842",
    "user": "https://github.com/jdemeyer"
}
```

There is still this problem:

```
jec@fermat%./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
/home/jec/sage-5.7.beta1/local/lib/python2.7/site-packages/IPython/utils/py3compat.pyc
in execfile(fname, *where)
    176             else:
    177                 filename = fname
--> 178             __builtin__.execfile(filename, *where)
| Sage Version 5.7.beta1, Release Date: 2013-01-26                   |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
/home/jec/.sage/init.sage in <module>()
----> 1 load /home/jec/sage/ecdb.py

NameError: name 'load' is not defined
```



---

archive/issue_comments_148843.json:
```json
{
    "body": "#14066 was opened to deal with all remaining issues.",
    "created_at": "2013-02-06T06:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148843",
    "user": "https://github.com/jasongrout"
}
```

#14066 was opened to deal with all remaining issues.



---

archive/issue_comments_148844.json:
```json
{
    "body": "How are users supposed to configure Sage's IPython now? See [sage-support](https://groups.google.com/d/topic/sage-support/yZ9W-un7Hlg/discussion). Right now, it looks like IPython's config files (either `.sage/ipython-0.12/profile_default/ipython_config.py` or `.sage/ipython-0.12/profile_sage/ipython_config.py`) are not loaded when Sage initializes its terminal. A possible solution:\n\n```diff\ndiff --git a/sage/misc/interpreter.py b/sage/misc/interpreter.py\n--- a/sage/misc/interpreter.py\n+++ b/sage/misc/interpreter.py\n@@ -672,9 +672,11 @@\n \n     def __init__(self, **kwargs):\n         # Overwrite the default Sage configuration with the user's.\n+        from IPython.frontend.terminal.ipapp import load_default_config\n         new_config = Config()\n         new_config._merge(DEFAULT_SAGE_CONFIG)\n         new_config._merge(kwargs.get('config', Config()))\n+        new_config._merge(load_default_config())\n         kwargs['config']=new_config\n         super(SageTerminalApp, self).__init__(**kwargs)\n \n```\nThen `.sage/ipython-0.12/profile_default/ipython_config.py` will be read and merged with Sage's configuration. Is this the right solution? Should I open a ticket? Or am I missing something?",
    "created_at": "2013-02-26T18:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148844",
    "user": "https://github.com/jhpalmieri"
}
```

How are users supposed to configure Sage's IPython now? See [sage-support](https://groups.google.com/d/topic/sage-support/yZ9W-un7Hlg/discussion). Right now, it looks like IPython's config files (either `.sage/ipython-0.12/profile_default/ipython_config.py` or `.sage/ipython-0.12/profile_sage/ipython_config.py`) are not loaded when Sage initializes its terminal. A possible solution:

```diff
diff --git a/sage/misc/interpreter.py b/sage/misc/interpreter.py
--- a/sage/misc/interpreter.py
+++ b/sage/misc/interpreter.py
@@ -672,9 +672,11 @@
 
     def __init__(self, **kwargs):
         # Overwrite the default Sage configuration with the user's.
+        from IPython.frontend.terminal.ipapp import load_default_config
         new_config = Config()
         new_config._merge(DEFAULT_SAGE_CONFIG)
         new_config._merge(kwargs.get('config', Config()))
+        new_config._merge(load_default_config())
         kwargs['config']=new_config
         super(SageTerminalApp, self).__init__(**kwargs)
 
```
Then `.sage/ipython-0.12/profile_default/ipython_config.py` will be read and merged with Sage's configuration. Is this the right solution? Should I open a ticket? Or am I missing something?



---

archive/issue_comments_148845.json:
```json
{
    "body": "Looks good to me",
    "created_at": "2013-02-26T18:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148845",
    "user": "https://github.com/vbraun"
}
```

Looks good to me



---

archive/issue_comments_148846.json:
```json
{
    "body": "See #14188.",
    "created_at": "2013-02-26T18:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148846",
    "user": "https://github.com/jhpalmieri"
}
```

See #14188.



---

archive/issue_comments_148847.json:
```json
{
    "body": "Replying to [comment:225 vbraun]:\n> I think we are smart enough to figure out that `ipython-0.12` is the directory for configuration files that were introduced with iPython 0.12 and that you might run a later (but still compatible) version.\n\n\nNo, we are not:\n\n```diff\ncommit 24ea89290988305d93f85988022cde7284268aeb\nAuthor: R. Andrew Ohana <andrew.ohana@gmail.com>\nDate:   Sun Feb 16 16:32:29 2014 -0800\n\n    dynamically set IPYTHONDIR based on the current version of ipython\n\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex a9021b7..fee3c56 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -359,7 +359,12 @@ if [ \"$SAGE_STARTUP_FILE\" = \"\" ]; then\n     export SAGE_STARTUP_FILE\n fi\n \n-export IPYTHONDIR=\"$DOT_SAGE/ipython-0.12\"\n+if [ -x \"$SAGE_LOCAL/bin/ipython\" ]; then\n+    export IPYTHONDIR=\"$DOT_SAGE/ipython-\"`ipython --version`\n+else\n+    # IPython is not yet installed\n+    export IPYTHONDIR=\"$DOT_SAGE/ipython-\"`sed 's+\\.p[0-9]*$++' \"$SAGE_ROOT\"/build/pkgs/ipython/package-version.txt`\n+fi\n \n if [ -d \"$SAGE_ROOT/local/lib/python\" ]; then\n     PYTHONPATH=\"$SAGE_ROOT/local/lib/python\"\n```\n\nI will change this back to a hardcoded version in #21430.",
    "created_at": "2016-09-06T08:31:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12719",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12719#issuecomment-148847",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:225 vbraun]:
> I think we are smart enough to figure out that `ipython-0.12` is the directory for configuration files that were introduced with iPython 0.12 and that you might run a later (but still compatible) version.


No, we are not:

```diff
commit 24ea89290988305d93f85988022cde7284268aeb
Author: R. Andrew Ohana <andrew.ohana@gmail.com>
Date:   Sun Feb 16 16:32:29 2014 -0800

    dynamically set IPYTHONDIR based on the current version of ipython

diff --git a/src/bin/sage-env b/src/bin/sage-env
index a9021b7..fee3c56 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -359,7 +359,12 @@ if [ "$SAGE_STARTUP_FILE" = "" ]; then
     export SAGE_STARTUP_FILE
 fi
 
-export IPYTHONDIR="$DOT_SAGE/ipython-0.12"
+if [ -x "$SAGE_LOCAL/bin/ipython" ]; then
+    export IPYTHONDIR="$DOT_SAGE/ipython-"`ipython --version`
+else
+    # IPython is not yet installed
+    export IPYTHONDIR="$DOT_SAGE/ipython-"`sed 's+\.p[0-9]*$++' "$SAGE_ROOT"/build/pkgs/ipython/package-version.txt`
+fi
 
 if [ -d "$SAGE_ROOT/local/lib/python" ]; then
     PYTHONPATH="$SAGE_ROOT/local/lib/python"
```

I will change this back to a hardcoded version in #21430.
