# Issue 12486: Make the Sage patchbot an optional spkg

archive/issues_012314.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "Anyone can run `sage --patchbot` to contribute.\n\n**Instructions:**\n\n* apply [attachment: patchbot-root-5.0.quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.quoted.patch.gz) to the SAGE_ROOT repo and\n* install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg\n\nCC:  @kini @dkrenn\n\nReviewer: **Volker Braun**\n\nAuthor: **Robert Bradshaw, Dan Drake**\n\nMerged: **sage-5.3.rc1**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12486_\n\n",
    "closed_at": "2012-08-30T11:41:26Z",
    "created_at": "2012-02-10T09:18:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make the Sage patchbot an optional spkg",
    "type": "issue",
    "updated_at": "2012-08-30T11:41:26Z",
    "url": "https://github.com/sagemath/sage/issues/12486",
    "user": "https://github.com/robertwb"
}
```
Anyone can run `sage --patchbot` to contribute.

**Instructions:**

* apply [attachment: patchbot-root-5.0.quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.quoted.patch.gz) to the SAGE_ROOT repo and
* install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg

CC:  @kini @dkrenn

Reviewer: **Volker Braun**

Author: **Robert Bradshaw, Dan Drake**

Merged: **sage-5.3.rc1**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/12486_





---

archive/issue_events_170890.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-02-10T09:18:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170890"
}
```



---

archive/issue_events_170891.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-02-10T09:18:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170891"
}
```



---

archive/issue_events_170892.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-02-10T09:18:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170892"
}
```



---

archive/issue_events_170893.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-02-10T09:18:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170893"
}
```



---

archive/issue_events_170894.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2012-02-10T09:18:39Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "subject": "https://github.com/robertwb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170894"
}
```



---

archive/issue_events_170895.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-02-10T09:26:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170895"
}
```



---

archive/issue_comments_137914.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[patchbot.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot.patch.gz)**\n\nnote that this doesn't apply to 5.0.beta3, since the `sage-sage` script has been deprecated. It looks like the relevant bit needs to be applied to `SAGE_ROOT/spkg/bin/sage` for 5.0.",
    "created_at": "2012-02-13T03:06:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137914",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[patchbot.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot.patch.gz)**

note that this doesn't apply to 5.0.beta3, since the `sage-sage` script has been deprecated. It looks like the relevant bit needs to be applied to `SAGE_ROOT/spkg/bin/sage` for 5.0.



---

archive/issue_comments_137915.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,12 @@\n Anyone can run `sage --patchbot` to contribute.\n+\n+*Instructions:*\n+\n+For versions before 5.0:\n+\n+* apply [attachment: patchbot.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot.patch.gz) to the scripts repo.\n+\n+For version 5.0 (and 5.0betaN, etc):\n+\n+* apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n+* apply [attachment: patchbot-scripts-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz) to the scripts repo.\n``````\n",
    "created_at": "2012-02-13T03:32:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137915",
    "user": "https://github.com/dandrake"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,12 @@
 Anyone can run `sage --patchbot` to contribute.
+
+*Instructions:*
+
+For versions before 5.0:
+
+* apply [attachment: patchbot.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot.patch.gz) to the scripts repo.
+
+For version 5.0 (and 5.0betaN, etc):
+
+* apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
+* apply [attachment: patchbot-scripts-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz) to the scripts repo.
``````




---

archive/issue_comments_137916.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI split the original patch, since in 5.0, the `sage` script is tracked by the root repo.",
    "created_at": "2012-02-13T03:32:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137916",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:4" align="right">comment:4</div>

I split the original patch, since in 5.0, the `sage` script is tracked by the root repo.



---

archive/issue_comments_137917.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWe should document the patchbot. Something better than \"read the code\" and \"ask Robert on sage-devel\". This is now #12505.",
    "created_at": "2012-02-13T13:58:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137917",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:5" align="right">comment:5</div>

We should document the patchbot. Something better than "read the code" and "ask Robert on sage-devel". This is now #12505.



---

archive/issue_comments_137918.json:
```json
{
    "body": "Attachment: **[patchbot-root-5.0.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz)**\n\nfor 5.0 series, apply to SAGE_ROOT repo",
    "created_at": "2012-02-15T02:14:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137918",
    "user": "https://github.com/dandrake"
}
```

Attachment: **[patchbot-root-5.0.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz)**

for 5.0 series, apply to SAGE_ROOT repo



---

archive/issue_comments_137919.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nNew patches (1) remove trailing whitespace, (2) include ticket number in commit message, and (3) have proper node and parent IDs, so patchbot knows where to apply them. These changes were prompted by looking at the patchbot's logs for this ticket. :)",
    "created_at": "2012-02-15T02:16:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137919",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:6" align="right">comment:6</div>

New patches (1) remove trailing whitespace, (2) include ticket number in commit message, and (3) have proper node and parent IDs, so patchbot knows where to apply them. These changes were prompted by looking at the patchbot's logs for this ticket. :)



---

archive/issue_comments_137920.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI tried this out (you'll see there are some results from `debian/squeeze/sid/x86_64/2.6.32-37-server/fermat` on the master patchbot server) and I got some strange behaviour. If you run the bot and give it a ticket number, with the ` --ticket ` command-line option, then it tests that ticket, but on finishing the test it gets stuck in an infinite loop of idling roundabout line 178 of patchbot.py (in particular, it never sends the test results back to the server). This is kind of annoying.",
    "created_at": "2012-03-10T14:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137920",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:8" align="right">comment:8</div>

I tried this out (you'll see there are some results from `debian/squeeze/sid/x86_64/2.6.32-37-server/fermat` on the master patchbot server) and I got some strange behaviour. If you run the bot and give it a ticket number, with the ` --ticket ` command-line option, then it tests that ticket, but on finishing the test it gets stuck in an infinite loop of idling roundabout line 178 of patchbot.py (in particular, it never sends the test results back to the server). This is kind of annoying.



---

archive/issue_comments_137921.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSorry, the issue I reported the last time is a non-issue (you just have to wait a bit longer for the Tee background process to notice that it's finished). \n\nBut there is an amusing bug which I spotted when running a patchbot under 5.0.beta10. The function that compares version numbers just splits on \".\" and sorts alphabetically, and hence it thinks beta1 < beta10 < beta2! This caused a bunch of spurious \"Apply Failed\" warnings when it tried to apply patches from tickets that had already been merged (listed as dependencies of open tickets). See for example the first of the two runs for ticket #10527.\n\nThe fix is to add the lines\n\n```python\na = a.replace(\"beta\", \"beta.\")\nb = b.replace(\"beta\", \"beta.\")\n```\n\nto util.compare_versions.",
    "created_at": "2012-03-25T13:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137921",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:9" align="right">comment:9</div>

Sorry, the issue I reported the last time is a non-issue (you just have to wait a bit longer for the Tee background process to notice that it's finished). 

But there is an amusing bug which I spotted when running a patchbot under 5.0.beta10. The function that compares version numbers just splits on "." and sorts alphabetically, and hence it thinks beta1 < beta10 < beta2! This caused a bunch of spurious "Apply Failed" warnings when it tried to apply patches from tickets that had already been merged (listed as dependencies of open tickets). See for example the first of the two runs for ticket #10527.

The fix is to add the lines

```python
a = a.replace("beta", "beta.")
b = b.replace("beta", "beta.")
```

to util.compare_versions.



---

archive/issue_comments_137922.json:
```json
{
    "body": "for 5 .0 series, apply to scripts repo",
    "created_at": "2012-04-02T01:58:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137922",
    "user": "https://github.com/dandrake"
}
```

for 5 .0 series, apply to scripts repo



---

archive/issue_comments_137923.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAttachment: **[patchbot-scripts-5.0.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz)**\n\nReplying to [@loefflerd](#comment:9):\n> The fix is to add the lines\n> \n> ```python\n> a = a.replace(\"beta\", \"beta.\")\n> b = b.replace(\"beta\", \"beta.\")\n> ```\n> \n> to util.compare_versions.\n\nThe updated patch does that. (It also is a bit more strict about catching a `ValueError` when doing `int(s)`, which probably isn't a big deal, but it seems like a good idea.)",
    "created_at": "2012-04-02T01:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137923",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:10" align="right">comment:10</div>

Attachment: **[patchbot-scripts-5.0.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz)**

Replying to [@loefflerd](#comment:9):
> The fix is to add the lines
> 
> ```python
> a = a.replace("beta", "beta.")
> b = b.replace("beta", "beta.")
> ```
> 
> to util.compare_versions.

The updated patch does that. (It also is a bit more strict about catching a `ValueError` when doing `int(s)`, which probably isn't a big deal, but it seems like a good idea.)



---

archive/issue_comments_137924.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks. I noticed that too.",
    "created_at": "2012-05-03T07:08:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137924",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks. I noticed that too.



---

archive/issue_comments_137925.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,6 @@\n Anyone can run `sage --patchbot` to contribute.\n \n-*Instructions:*\n-\n-For versions before 5.0:\n-\n-* apply [attachment: patchbot.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot.patch.gz) to the scripts repo.\n-\n-For version 5.0 (and 5.0betaN, etc):\n+**Instructions:**\n \n * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n * apply [attachment: patchbot-scripts-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz) to the scripts repo.\n``````\n",
    "created_at": "2012-05-30T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137925",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,6 @@
 Anyone can run `sage --patchbot` to contribute.
 
-*Instructions:*
-
-For versions before 5.0:
-
-* apply [attachment: patchbot.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot.patch.gz) to the scripts repo.
-
-For version 5.0 (and 5.0betaN, etc):
+**Instructions:**
 
 * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
 * apply [attachment: patchbot-scripts-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz) to the scripts repo.
``````




---

archive/issue_comments_137926.json:
```json
{
    "body": "Author: **Robert Bradshaw, Dan Drake**",
    "created_at": "2012-05-30T15:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137926",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Robert Bradshaw, Dan Drake**



---

archive/issue_comments_137927.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSince a while now, there is no requirement for the ticket number to be in the commit message, it's added automatically when merging in the standard format\n\n```\nTrac #12486: message from the patch file\n```",
    "created_at": "2012-05-30T15:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137927",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Since a while now, there is no requirement for the ticket number to be in the commit message, it's added automatically when merging in the standard format

```
Trac #12486: message from the patch file
```



---

archive/issue_comments_137928.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI noticed just now that on the buildbot arando, where I am running a patchbot on Sage 5.1.beta1, there were orphaned patchbot testing processes (i.e. instances of the python interpreter) left lying around, running things in `~/.sage/tmp/arando-*/`, of which many seemed to be named `maxima_abstract_*.py`, though there were several other filenames as well. These testing processes were not sleeping or waiting but running full steam, taking up most of arando's CPU time, so I killed them. I've noticed this happen once or twice before, as well.",
    "created_at": "2012-06-03T01:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137928",
    "user": "https://github.com/kini"
}
```

<div id="comment:14" align="right">comment:14</div>

I noticed just now that on the buildbot arando, where I am running a patchbot on Sage 5.1.beta1, there were orphaned patchbot testing processes (i.e. instances of the python interpreter) left lying around, running things in `~/.sage/tmp/arando-*/`, of which many seemed to be named `maxima_abstract_*.py`, though there were several other filenames as well. These testing processes were not sleeping or waiting but running full steam, taking up most of arando's CPU time, so I killed them. I've noticed this happen once or twice before, as well.



---

archive/issue_comments_137929.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nkini: I'd love to know which ticket causes the maxima_abstract failures.",
    "created_at": "2012-06-03T08:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137929",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

kini: I'd love to know which ticket causes the maxima_abstract failures.



---

archive/issue_comments_137930.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nBy the way: the \"Python keeps running after a doctest timeout\" bug is #11338.",
    "created_at": "2012-06-03T08:50:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137930",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

By the way: the "Python keeps running after a doctest timeout" bug is #11338.



---

archive/issue_comments_137931.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n\n```\n[2] patchbot@arando ~/.sage/tmp $ find | grep maxima_abstract | xargs grep \"^#.*devel/sage-\"\n./arando-13446/maxima_abstract_22717.py:# '/opt/patchbot-5.1.beta0/devel/sage-12214/sage/interfaces/maxima_abstract.py'.\n./arando-698/maxima_abstract_10001.py:# '/opt/patchbot-5.1.beta0/devel/sage-12120/sage/interfaces/maxima_abstract.py'.\n./arando-21967/maxima_abstract_10092.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.\n./arando-25899/maxima_abstract_2742.py:# '/opt/patchbot-5.1.beta0/devel/sage-12298/sage/interfaces/maxima_abstract.py'.\n./arando-25577/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.\n./arando-7379/maxima_abstract_27734.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.\n./arando-16948/maxima_abstract_3744.py:# '/opt/patchbot-5.1.beta1/devel/sage-12043/sage/interfaces/maxima_abstract.py'.\n./arando-5871/maxima_abstract_15144.py:# '/opt/patchbot-5.1.beta0/devel/sage-11726/sage/interfaces/maxima_abstract.py'.\n./arando-10252/maxima_abstract_30489.py:# '/opt/patchbot-5.1.beta0/devel/sage-12518/sage/interfaces/maxima_abstract.py'.\n./arando-25814/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.\n./arando-21669/maxima_abstract_30915.py:# '/opt/patchbot-5.0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.\n./arando-3379/maxima_abstract_22614.py:# '/opt/patchbot-5.1.beta1/devel/sage-12251/sage/interfaces/maxima_abstract.py'.\n./arando-23007/maxima_abstract_11131.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.\n./arando-7740/maxima_abstract_11922.py:# '/opt/patchbot-5.1.beta1/devel/sage-11930/sage/interfaces/maxima_abstract.py'.\n./arando-13364/maxima_abstract_22646.py:# '/opt/patchbot-5.1.beta0/devel/sage-11143/sage/interfaces/maxima_abstract.py'.\n./arando-12724/maxima_abstract_834.py:# '/opt/patchbot-5.1.beta0/devel/sage-12892/sage/interfaces/maxima_abstract.py'.\n./arando-20437/maxima_abstract_29714.py:# '/opt/patchbot-5.1.beta0/devel/sage-11895/sage/interfaces/maxima_abstract.py'.\n./arando-5929/maxima_abstract_15208.py:# '/opt/patchbot-5.1.beta0/devel/sage-12352/sage/interfaces/maxima_abstract.py'.\n./arando-4951/maxima_abstract_14224.py:# '/opt/patchbot-5.1.beta0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.\n```\n\nI don't know how many of these are files that these stalled processes were running and how many are just other temp files that happened not to have been cleaned up - next time this happens I'll grep `ps` instead. (The ticket numbers are in the path names of the form `*devel/sage-*`, not of the form `./arando-*`.)",
    "created_at": "2012-06-03T19:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137931",
    "user": "https://github.com/kini"
}
```

<div id="comment:17" align="right">comment:17</div>


```
[2] patchbot@arando ~/.sage/tmp $ find | grep maxima_abstract | xargs grep "^#.*devel/sage-"
./arando-13446/maxima_abstract_22717.py:# '/opt/patchbot-5.1.beta0/devel/sage-12214/sage/interfaces/maxima_abstract.py'.
./arando-698/maxima_abstract_10001.py:# '/opt/patchbot-5.1.beta0/devel/sage-12120/sage/interfaces/maxima_abstract.py'.
./arando-21967/maxima_abstract_10092.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.
./arando-25899/maxima_abstract_2742.py:# '/opt/patchbot-5.1.beta0/devel/sage-12298/sage/interfaces/maxima_abstract.py'.
./arando-25577/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.
./arando-7379/maxima_abstract_27734.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.
./arando-16948/maxima_abstract_3744.py:# '/opt/patchbot-5.1.beta1/devel/sage-12043/sage/interfaces/maxima_abstract.py'.
./arando-5871/maxima_abstract_15144.py:# '/opt/patchbot-5.1.beta0/devel/sage-11726/sage/interfaces/maxima_abstract.py'.
./arando-10252/maxima_abstract_30489.py:# '/opt/patchbot-5.1.beta0/devel/sage-12518/sage/interfaces/maxima_abstract.py'.
./arando-25814/maxima_abstract_13608.py:# '/opt/patchbot-5.1.beta0/devel/sage-6812/sage/interfaces/maxima_abstract.py'.
./arando-21669/maxima_abstract_30915.py:# '/opt/patchbot-5.0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.
./arando-3379/maxima_abstract_22614.py:# '/opt/patchbot-5.1.beta1/devel/sage-12251/sage/interfaces/maxima_abstract.py'.
./arando-23007/maxima_abstract_11131.py:# '/opt/patchbot-5.1.beta0/devel/sage-12989/sage/interfaces/maxima_abstract.py'.
./arando-7740/maxima_abstract_11922.py:# '/opt/patchbot-5.1.beta1/devel/sage-11930/sage/interfaces/maxima_abstract.py'.
./arando-13364/maxima_abstract_22646.py:# '/opt/patchbot-5.1.beta0/devel/sage-11143/sage/interfaces/maxima_abstract.py'.
./arando-12724/maxima_abstract_834.py:# '/opt/patchbot-5.1.beta0/devel/sage-12892/sage/interfaces/maxima_abstract.py'.
./arando-20437/maxima_abstract_29714.py:# '/opt/patchbot-5.1.beta0/devel/sage-11895/sage/interfaces/maxima_abstract.py'.
./arando-5929/maxima_abstract_15208.py:# '/opt/patchbot-5.1.beta0/devel/sage-12352/sage/interfaces/maxima_abstract.py'.
./arando-4951/maxima_abstract_14224.py:# '/opt/patchbot-5.1.beta0/devel/sage-2215/sage/interfaces/maxima_abstract.py'.
```

I don't know how many of these are files that these stalled processes were running and how many are just other temp files that happened not to have been cleaned up - next time this happens I'll grep `ps` instead. (The ticket numbers are in the path names of the form `*devel/sage-*`, not of the form `./arando-*`.)



---

archive/issue_comments_137932.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThere is no logic behind this, too many independent tickets have this issue.",
    "created_at": "2012-06-03T19:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137932",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

There is no logic behind this, too many independent tickets have this issue.



---

archive/issue_comments_137933.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nIs there a way how \"state\" could be preserved across patchbot runs?  Could it happen that the patchbot tests ticket X and somehow ticket X has a bug causing failures in *following* tickets the patchbot tests?  Because it looks like this is happening here.\n\nI did 600 test runs of `maxima_abstract.py` on vanilla sage-5.1.beta2 and found no error.  Nobody has reported this bug on the mailing list and I haven't seen it on the buildbot with sage-5.1.beta2 or earlier.  So I conclude that the bug is introduced by a not-yet-merged ticket.\n\nSince it is extremely unlikely that all the tickets in kini's list above cause the same bug, the most logical explanation is that somehow one ticket corrupted further patchbot runs.",
    "created_at": "2012-06-05T12:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137933",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Is there a way how "state" could be preserved across patchbot runs?  Could it happen that the patchbot tests ticket X and somehow ticket X has a bug causing failures in *following* tickets the patchbot tests?  Because it looks like this is happening here.

I did 600 test runs of `maxima_abstract.py` on vanilla sage-5.1.beta2 and found no error.  Nobody has reported this bug on the mailing list and I haven't seen it on the buildbot with sage-5.1.beta2 or earlier.  So I conclude that the bug is introduced by a not-yet-merged ticket.

Since it is extremely unlikely that all the tickets in kini's list above cause the same bug, the most logical explanation is that somehow one ticket corrupted further patchbot runs.



---

archive/issue_comments_137934.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nFor the record, here is the verbose output of the failure:\n\n```\nsage -t --long --verbose \"devel/sage/sage/interfaces/maxima_abstract.py\"\n[...]\nTrying:\n    ~f###line 2304:_sage_    >>> ~f\nExpecting:\n    1/sin(x)\n**********************************************************************\nFile \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/devel/sage/sage/interfaces/maxima_abstract.py\", line ?, in __main__.example_81\nFailed example:\n    ~f###line 2304:_sage_    >>> ~f\nException raised:\n    Traceback (most recent call last):\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_81[3]>\", line 1, in <module>\n        ~f###line 2304:_sage_    >>> ~f\n      File \"element.pyx\", line 1833, in sage.structure.element.RingElement.__invert__ (sage/structure/element.c:13904)\n      File \"element.pyx\", line 1799, in sage.structure.element.RingElement.__div__ (sage/structure/element.c:13362)\n      File \"coerce.pyx\", line 744, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6704)\n      File \"coerce.pyx\", line 858, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:7892)\n      File \"map.pyx\", line 1282, in sage.categories.map.FormalCompositeMap._call_ (sage/categories/map.c:6190)\n      File \"morphism.pyx\", line 159, in sage.categories.morphism.CallMorphism._call_ (sage/categories/morphism.c:3080)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 200, in __cal\nl__\n        return self._coerce_from_special_method(x)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 226, in _coer\nce_from_special_method\n        return (x.__getattribute__(s))(self)\n      File \"sage_object.pyx\", line 527, in sage.structure.sage_object.SageObject._maxima_ (sage/structure/sage_object.c:5444)\n        This function may call the magma interpreter when it runs.\n      File \"sage_object.pyx\", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3684)\n        X = I(s)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 198, in __call__\n        return cls(self, x, name=name)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py\", line 1155, in __init__\n        ExpectElement.__init__(self, parent, value, is_name=False, name=None)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/expect.py\", line 1331, in __init__\n        self._name = parent._create(value, name=name)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py\", line 388, in _create\n        self.set(name, value)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py\", line 1000, in set\n        self._eval_line(cmd)\n      File \"/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py\", line 756, in _eval_line\n        assert line_echo.strip() == line.strip()\n    AssertionError\n[...]\n4 items had no tests:\n    __main__\n    __main__.change_warning_output\n    __main__.check_with_tolerance\n    __main__.warning_function\n85 items passed all tests:\n   3 tests in __main__.example_0\n   6 tests in __main__.example_1\n[...]\n   4 tests in __main__.example_43\n   4 tests in __main__.example_44\n   4 tests in __main__.example_45\n   4 tests in __main__.example_46\n   4 tesException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\nException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored\n[...goes on forever until killed...]\n```",
    "created_at": "2012-06-05T12:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137934",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

For the record, here is the verbose output of the failure:

```
sage -t --long --verbose "devel/sage/sage/interfaces/maxima_abstract.py"
[...]
Trying:
    ~f###line 2304:_sage_    >>> ~f
Expecting:
    1/sin(x)
**********************************************************************
File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/devel/sage/sage/interfaces/maxima_abstract.py", line ?, in __main__.example_81
Failed example:
    ~f###line 2304:_sage_    >>> ~f
Exception raised:
    Traceback (most recent call last):
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_81[3]>", line 1, in <module>
        ~f###line 2304:_sage_    >>> ~f
      File "element.pyx", line 1833, in sage.structure.element.RingElement.__invert__ (sage/structure/element.c:13904)
      File "element.pyx", line 1799, in sage.structure.element.RingElement.__div__ (sage/structure/element.c:13362)
      File "coerce.pyx", line 744, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:6704)
      File "coerce.pyx", line 858, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:7892)
      File "map.pyx", line 1282, in sage.categories.map.FormalCompositeMap._call_ (sage/categories/map.c:6190)
      File "morphism.pyx", line 159, in sage.categories.morphism.CallMorphism._call_ (sage/categories/morphism.c:3080)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 200, in __cal
l__
        return self._coerce_from_special_method(x)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 226, in _coer
ce_from_special_method
        return (x.__getattribute__(s))(self)
      File "sage_object.pyx", line 527, in sage.structure.sage_object.SageObject._maxima_ (sage/structure/sage_object.c:5444)
        This function may call the magma interpreter when it runs.
      File "sage_object.pyx", line 439, in sage.structure.sage_object.SageObject._interface_ (sage/structure/sage_object.c:3684)
        X = I(s)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 198, in __call__
        return cls(self, x, name=name)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py", line 1155, in __init__
        ExpectElement.__init__(self, parent, value, is_name=False, name=None)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/expect.py", line 1331, in __init__
        self._name = parent._create(value, name=name)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/interface.py", line 388, in _create
        self.set(name, value)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py", line 1000, in set
        self._eval_line(cmd)
      File "/padic/scratch/jdemeyer/merger/sage-5.1.beta3/local/lib/python/site-packages/sage/interfaces/maxima.py", line 756, in _eval_line
        assert line_echo.strip() == line.strip()
    AssertionError
[...]
4 items had no tests:
    __main__
    __main__.change_warning_output
    __main__.check_with_tolerance
    __main__.warning_function
85 items passed all tests:
   3 tests in __main__.example_0
   6 tests in __main__.example_1
[...]
   4 tests in __main__.example_43
   4 tests in __main__.example_44
   4 tests in __main__.example_45
   4 tests in __main__.example_46
   4 tesException RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in  ignored
[...goes on forever until killed...]
```



---

archive/issue_comments_137935.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThis bug is now prominently in my top 3 of \"weirdest Sage bugs I encountered as release manager\", together with #12221 and #10609.",
    "created_at": "2012-06-05T12:27:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137935",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

This bug is now prominently in my top 3 of "weirdest Sage bugs I encountered as release manager", together with #12221 and #10609.



---

archive/issue_comments_137936.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nMy desktop does about 10 tickets/hour, each of which adds a `$SAGE_ROOT/devel/sage-<ticket>` directory of about 330MB. Is there a reason why the patchbot does not delete these? It kind of adds up, we are talking about >50 GB per day. Or should I get another harddisk to run the patchbot on?\n\nAbout the `maxima_abstract.py` error, I never observed it here. It might be a 32-bit issue (I'm running Fedora 17 x86_64). Although perhaps far-fetched, there is another bug where the sage-maxima interface goes into an infinite recursion (#13097).\n\nEven with these issues I'd be in favor of merging this ticket. Its useful functionality and it works for most. We can polish it in a follow-up ticket.",
    "created_at": "2012-06-10T11:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137936",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:22" align="right">comment:22</div>

My desktop does about 10 tickets/hour, each of which adds a `$SAGE_ROOT/devel/sage-<ticket>` directory of about 330MB. Is there a reason why the patchbot does not delete these? It kind of adds up, we are talking about >50 GB per day. Or should I get another harddisk to run the patchbot on?

About the `maxima_abstract.py` error, I never observed it here. It might be a 32-bit issue (I'm running Fedora 17 x86_64). Although perhaps far-fetched, there is another bug where the sage-maxima interface goes into an infinite recursion (#13097).

Even with these issues I'd be in favor of merging this ticket. Its useful functionality and it works for most. We can polish it in a follow-up ticket.



---

archive/issue_comments_137937.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThe patchbot deletes tickets directories when they are closed. It might be worth having an option to delete them after every run, but then a full re-clone and re-build would be required to test any additional patches (expensive). \n\nAs for space, all the build and .c files are hard linked from sage-main (unless they're changed), so the aggregate use of the directories is about 100MB each ticket (not each run). Even if we got up to, say, 500 open tickets you are looking at a stead state of 50GB total, not per day. \n\nIt will only apply patches to the sage-main tree, which it re-clones for every ticket, but the doctests and code itself could do anything, so one can't rule out any global state (though if there it's both strange and a bug).\n\nI'm all in favor of getting this in and iterating on it there. I made some minor changes and will try to refresh these patches shortly.",
    "created_at": "2012-06-11T19:03:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137937",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:23" align="right">comment:23</div>

The patchbot deletes tickets directories when they are closed. It might be worth having an option to delete them after every run, but then a full re-clone and re-build would be required to test any additional patches (expensive). 

As for space, all the build and .c files are hard linked from sage-main (unless they're changed), so the aggregate use of the directories is about 100MB each ticket (not each run). Even if we got up to, say, 500 open tickets you are looking at a stead state of 50GB total, not per day. 

It will only apply patches to the sage-main tree, which it re-clones for every ticket, but the doctests and code itself could do anything, so one can't rule out any global state (though if there it's both strange and a bug).

I'm all in favor of getting this in and iterating on it there. I made some minor changes and will try to refresh these patches shortly.



---

archive/issue_comments_137938.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMy patchbot processed 236 tickets so far and I'm at 80 gigabytes:\n\n```\n[patchbot@volker-desktop sage-5.1.beta3]$ du -sh .\n79G\t.\n[patchbot@volker-desktop sage-5.1.beta3]$ mount | grep /home\n/dev/sdc1 on /home type ext4 (rw,relatime,seclabel,data=ordered)\n```\nThats already accounting for hardlinks, `du` is smart enough to only count the linked file once. Turning this off (and overcounting) yields\n\n```\n[patchbot@volker-desktop sage-5.1.beta3]$ du -shl .\n336G\t.\n```\nSo it should probably stop just below 100G, still acceptable I think.",
    "created_at": "2012-06-11T19:14:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137938",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:24" align="right">comment:24</div>

My patchbot processed 236 tickets so far and I'm at 80 gigabytes:

```
[patchbot@volker-desktop sage-5.1.beta3]$ du -sh .
79G	.
[patchbot@volker-desktop sage-5.1.beta3]$ mount | grep /home
/dev/sdc1 on /home type ext4 (rw,relatime,seclabel,data=ordered)
```
Thats already accounting for hardlinks, `du` is smart enough to only count the linked file once. Turning this off (and overcounting) yields

```
[patchbot@volker-desktop sage-5.1.beta3]$ du -shl .
336G	.
```
So it should probably stop just below 100G, still acceptable I think.



---

archive/issue_comments_137939.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,4 +3,4 @@\n **Instructions:**\n \n * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n-* apply [attachment: patchbot-scripts-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz) to the scripts repo.\n+* apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.\n``````\n",
    "created_at": "2012-06-11T19:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137939",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,4 +3,4 @@
 **Instructions:**
 
 * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
-* apply [attachment: patchbot-scripts-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-scripts-5.0.patch.gz) to the scripts repo.
+* apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.
``````




---

archive/issue_comments_137940.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nHmm... that is quite a bit more than I'd expect. Certainly keeping only the most recently used N tickets would be an improvement, but between moving to git and cycache and ccache it will become irrelevant (one would simply specify the desired cache size) and 100G isn't overkill these days.",
    "created_at": "2012-06-11T19:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137940",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:26" align="right">comment:26</div>

Hmm... that is quite a bit more than I'd expect. Certainly keeping only the most recently used N tickets would be an improvement, but between moving to git and cycache and ccache it will become irrelevant (one would simply specify the desired cache size) and 100G isn't overkill these days.



---

archive/issue_comments_137941.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nMy experience with running patchbot has been that many tickets (notably those that add new modules to the reference manual) do seem to pollute the global state, particularly for documentation building purposes, where the docbuild log for running patchbot on ticket X will start complaining that it can't find a file that is added in some other ticket Y that it previously tested. (I think this is because the `sage-clone` script hard-links the Sphinx environment pickle.)\n\nMoreover, even without \"cross-branch contamination\", adding source files and then removing them tends to leave junk in the Sage build tree. Thus the patchbot isn't really doing its job properly, of simulating the effect of applying the latest set of patches to a clean copy of Sage. So I found it preferable to fiddle with the patchbot `test_a_ticket` code such that it always made a new branch, then deleted it afterwards.",
    "created_at": "2012-06-12T07:25:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137941",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:27" align="right">comment:27</div>

My experience with running patchbot has been that many tickets (notably those that add new modules to the reference manual) do seem to pollute the global state, particularly for documentation building purposes, where the docbuild log for running patchbot on ticket X will start complaining that it can't find a file that is added in some other ticket Y that it previously tested. (I think this is because the `sage-clone` script hard-links the Sphinx environment pickle.)

Moreover, even without "cross-branch contamination", adding source files and then removing them tends to leave junk in the Sage build tree. Thus the patchbot isn't really doing its job properly, of simulating the effect of applying the latest set of patches to a clean copy of Sage. So I found it preferable to fiddle with the patchbot `test_a_ticket` code such that it always made a new branch, then deleted it afterwards.



---

archive/issue_comments_137942.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nWell, this is a defect in sage -clone (which should hopefully go away with git). I'm not quite sure how \n\n```\nsage -clone ticket\n[test ticket]\nsage -b main\nsage -clone newticket\n```\n\nwould have different behavior from \n\n```\nsage -clone ticket\n[test ticket]\nsage -b main\nrm -rf /path/to/deve/sage-ticket\nsage -clone newticket\n```\n\nthough I have seen issues with the build directory getting messed up when files are added and then removed.",
    "created_at": "2012-06-12T09:16:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137942",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:28" align="right">comment:28</div>

Well, this is a defect in sage -clone (which should hopefully go away with git). I'm not quite sure how 

```
sage -clone ticket
[test ticket]
sage -b main
sage -clone newticket
```

would have different behavior from 

```
sage -clone ticket
[test ticket]
sage -b main
rm -rf /path/to/deve/sage-ticket
sage -clone newticket
```

though I have seen issues with the build directory getting messed up when files are added and then removed.



---

archive/issue_comments_137943.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nWith the updated patch I get:\n\n```\n[patchbot@volker-desktop sage-5.1.beta3]$ ./sage -patchbot\n/home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied\n```\nManually changing the permission works.",
    "created_at": "2012-06-13T12:38:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137943",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:29" align="right">comment:29</div>

With the updated patch I get:

```
[patchbot@volker-desktop sage-5.1.beta3]$ ./sage -patchbot
/home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied
```
Manually changing the permission works.



---

archive/issue_comments_137944.json:
```json
{
    "body": "Attachment: **[12486-patchbot-scripts-5.0-updated.patch.gz](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz)**\n\napply to $SAGE_LOCAL/bin",
    "created_at": "2012-06-21T19:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137944",
    "user": "https://github.com/kini"
}
```

Attachment: **[12486-patchbot-scripts-5.0-updated.patch.gz](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz)**

apply to $SAGE_LOCAL/bin



---

archive/issue_comments_137945.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@vbraun](#comment:29):\n> With the updated patch I get:\n> \n> ```\n> [patchbot@volker-desktop sage-5.1.beta3]$ ./sage -patchbot\n> /home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied\n> ```\n> Manually changing the permission works.\n\nI updated the patch.",
    "created_at": "2012-06-21T19:25:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137945",
    "user": "https://github.com/kini"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@vbraun](#comment:29):
> With the updated patch I get:
> 
> ```
> [patchbot@volker-desktop sage-5.1.beta3]$ ./sage -patchbot
> /home/patchbot/Sage/sage-5.1.beta3/spkg/bin/sage: line 877: /home/patchbot/Sage/sage-5.1.beta3/local/bin/patchbot/patchbot.py: Permission denied
> ```
> Manually changing the permission works.

I updated the patch.



---

archive/issue_comments_137946.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nHah - patchbot gives its own code a green circle despite there being no patches for the Sage library :)",
    "created_at": "2012-06-21T20:33:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137946",
    "user": "https://github.com/kini"
}
```

<div id="comment:31" align="right">comment:31</div>

Hah - patchbot gives its own code a green circle despite there being no patches for the Sage library :)



---

archive/issue_comments_137947.json:
```json
{
    "body": "Reviewer: **Volker Braun**",
    "created_at": "2012-06-25T14:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137947",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Volker Braun**



---

archive/issue_events_170896.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-06-25T14:59:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170896"
}
```



---

archive/issue_events_170897.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-06-25T14:59:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170897"
}
```



---

archive/issue_comments_137948.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nLooks good to me! \n\nThe perfect is the enemy of the good.",
    "created_at": "2012-06-25T14:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137948",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:32" align="right">comment:32</div>

Looks good to me! 

The perfect is the enemy of the good.



---

archive/issue_events_170898.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-25T15:32:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170898"
}
```



---

archive/issue_events_170899.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-25T15:32:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170899"
}
```



---

archive/issue_comments_137949.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nOn arando I am consistently getting a doctest failure in devel/sage-0/sage/rings/finite_rings/integer_mod.pyx when the patchbot first starts up and tests a vanilla Sage. When I doctest that particular file manually, there are no failures. Even when I run `make ptestlong`, there is no failure. But if I run `sage --patchbot`, it fails on that file. This has been happening since 5.1.beta5, as far as I can tell.",
    "created_at": "2012-06-26T02:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137949",
    "user": "https://github.com/kini"
}
```

<div id="comment:34" align="right">comment:34</div>

On arando I am consistently getting a doctest failure in devel/sage-0/sage/rings/finite_rings/integer_mod.pyx when the patchbot first starts up and tests a vanilla Sage. When I doctest that particular file manually, there are no failures. Even when I run `make ptestlong`, there is no failure. But if I run `sage --patchbot`, it fails on that file. This has been happening since 5.1.beta5, as far as I can tell.



---

archive/issue_comments_137950.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI tried it again while redirecting stdout to a text file which I later searched. The actual failure is apparently this:\n\n```\nsage -t  -force_lib devel/sage-0/sage/rings/finite_rings/integer_mod.pyx\n**********************************************************************\nFile \"/opt/patchbot-5.1.beta6/devel/sage-0/sage/rings/finite_rings/integer_mod.pyx\", line 2855:\n    sage: mod(5,13^5) == mod(5,13)                                                       \nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 items had failures:\n   1 of   8 in __main__.example_88\n***Test Failed*** 1 failures.\n```",
    "created_at": "2012-06-26T06:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137950",
    "user": "https://github.com/kini"
}
```

<div id="comment:35" align="right">comment:35</div>

I tried it again while redirecting stdout to a text file which I later searched. The actual failure is apparently this:

```
sage -t  -force_lib devel/sage-0/sage/rings/finite_rings/integer_mod.pyx
**********************************************************************
File "/opt/patchbot-5.1.beta6/devel/sage-0/sage/rings/finite_rings/integer_mod.pyx", line 2855:
    sage: mod(5,13^5) == mod(5,13)                                                       
Expected:
    True
Got:
    False
**********************************************************************
1 items had failures:
   1 of   8 in __main__.example_88
***Test Failed*** 1 failures.
```



---

archive/issue_comments_137951.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nKeshav: Try `make ptest` or `sage -tp <n> $SAGE_ROOT/devel/sage` to test multiple files and see if you can reproduce it. The patchbot doesn't do anything different.",
    "created_at": "2012-06-27T17:06:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137951",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:36" align="right">comment:36</div>

Keshav: Try `make ptest` or `sage -tp <n> $SAGE_ROOT/devel/sage` to test multiple files and see if you can reproduce it. The patchbot doesn't do anything different.



---

archive/issue_comments_137952.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI've tried this three or four times with the patchbot and three or four times with `make ptestlong`, and of these trials all the patchbot runs end with this failure, and all the `make ptestlong`s pass all doctests. I'm trying again now with a plain `make ptest` (without the long doctests).",
    "created_at": "2012-06-27T17:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137952",
    "user": "https://github.com/kini"
}
```

<div id="comment:37" align="right">comment:37</div>

I've tried this three or four times with the patchbot and three or four times with `make ptestlong`, and of these trials all the patchbot runs end with this failure, and all the `make ptestlong`s pass all doctests. I'm trying again now with a plain `make ptest` (without the long doctests).



---

archive/issue_comments_137953.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nYup, no errors with `make ptest`. Now trying `sage --patchbot` again for about the fifth time :)",
    "created_at": "2012-06-29T03:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137953",
    "user": "https://github.com/kini"
}
```

<div id="comment:38" align="right">comment:38</div>

Yup, no errors with `make ptest`. Now trying `sage --patchbot` again for about the fifth time :)



---

archive/issue_events_170900.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-29T06:47:23Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "title_is": "Add patchbot to Sage itself",
    "title_was": "Add patchbot to Sage itself.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170900"
}
```



---

archive/issue_comments_137954.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nMay I remind you about my feature request for \"patchbot log grepping\": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.",
    "created_at": "2012-06-29T06:47:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137954",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

May I remind you about my feature request for "patchbot log grepping": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.



---

archive/issue_comments_137955.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\n`sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)",
    "created_at": "2012-06-29T06:52:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137955",
    "user": "https://github.com/kini"
}
```

<div id="comment:40" align="right">comment:40</div>

`sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)



---

archive/issue_comments_137956.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThe patchbot just runs `sage -t`, its probably something in the doctesting framework that needs fixing. There is also the new doctesting framework at http://trac.sagemath.org/12415, maybe that'll fix it? In any case that discussion belongs to a different ticket. \n\nSame for feature requests, Jeroen ;-)",
    "created_at": "2012-06-29T12:12:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137956",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:41" align="right">comment:41</div>

The patchbot just runs `sage -t`, its probably something in the doctesting framework that needs fixing. There is also the new doctesting framework at http://trac.sagemath.org/12415, maybe that'll fix it? In any case that discussion belongs to a different ticket. 

Same for feature requests, Jeroen ;-)



---

archive/issue_comments_137957.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nIt seems that `sage-make_devel_packages` (I guess) needs to be updated, the `patchbot` files in `local/bin` are not picked up by `sage-sdist`.",
    "created_at": "2012-06-29T16:01:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137957",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

It seems that `sage-make_devel_packages` (I guess) needs to be updated, the `patchbot` files in `local/bin` are not picked up by `sage-sdist`.



---

archive/issue_comments_137958.json:
```json
{
    "body": "Work Issues: **sage-sdist**",
    "created_at": "2012-06-29T16:01:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137958",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **sage-sdist**



---

archive/issue_events_170901.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-29T16:01:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170901"
}
```



---

archive/issue_events_170902.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-29T16:01:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170902"
}
```



---

archive/issue_comments_137959.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@jdemeyer](#comment:39):\n> May I remind you about my feature request for \"patchbot log grepping\": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.\n\nYes, that would be nice. At the moment my energies are focused on (finally) trying to just get this in.",
    "created_at": "2012-07-01T05:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137959",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@jdemeyer](#comment:39):
> May I remind you about my feature request for "patchbot log grepping": given a doctest error, I would like to find out whether the patchbot has seen that failure and which ticket caused it.

Yes, that would be nice. At the moment my energies are focused on (finally) trying to just get this in.



---

archive/issue_comments_137960.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@kini](#comment:40):\n> `sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)\n\nI have no idea, but unless this is reproducible by others I don't think this should block it getting in.",
    "created_at": "2012-07-01T05:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137960",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@kini](#comment:40):
> `sage --patchbot` fails again on the same file. I think it's pretty clear that this is only happening when the patchbot runs the tests, though I can't imagine why. Is it worth setting the ticket to needs_work? Can anyone else reproduce this? (Try a 32-bit machine, I suppose...)

I have no idea, but unless this is reproducible by others I don't think this should block it getting in.



---

archive/issue_comments_137961.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI agree. Volker actually told me on IRC that he couldn't reproduce it on a 32-bit VM, so it must be something peculiar to arando.",
    "created_at": "2012-07-01T05:16:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137961",
    "user": "https://github.com/kini"
}
```

<div id="comment:45" align="right">comment:45</div>

I agree. Volker actually told me on IRC that he couldn't reproduce it on a 32-bit VM, so it must be something peculiar to arando.



---

archive/issue_comments_137962.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nIndeed, it's very strange, as it's just running the same sage -t in a subshell.",
    "created_at": "2012-07-01T05:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137962",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:46" align="right">comment:46</div>

Indeed, it's very strange, as it's just running the same sage -t in a subshell.



---

archive/issue_comments_137963.json:
```json
{
    "body": "Apply to $SAGE_LOCAL/bin.",
    "created_at": "2012-07-01T05:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137963",
    "user": "https://github.com/robertwb"
}
```

Apply to $SAGE_LOCAL/bin.



---

archive/issue_events_170903.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-07-01T05:32:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170903"
}
```



---

archive/issue_events_170904.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-07-01T05:32:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170904"
}
```



---

archive/issue_comments_137964.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nAttachment: **[12486-fix-sdist.patch.gz](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz)**\n\nWow, such ugliness here. I can't wait until we're set up with a unified repository...",
    "created_at": "2012-07-01T05:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137964",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:47" align="right">comment:47</div>

Attachment: **[12486-fix-sdist.patch.gz](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz)**

Wow, such ugliness here. I can't wait until we're set up with a unified repository...



---

archive/issue_comments_137965.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,3 +4,4 @@\n \n * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n * apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.\n+* apply [attachment: 12486-fix-sdist.patch](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz) to the scripts repo.\n``````\n",
    "created_at": "2012-07-01T05:32:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137965",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,3 +4,4 @@
 
 * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
 * apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.
+* apply [attachment: 12486-fix-sdist.patch](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz) to the scripts repo.
``````




---

archive/issue_comments_137966.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nFor the record, this is the 32-bit test VM passing the test: http://patchbot.sagemath.org/ticket/?machine=Fedora/16/i686/3.4.2-1.fc16.i686.PAE/sagevm&status=open In any case, this should not block the patchbot ticket going forward.\n\nI noticed that `$DOT_SAGE/cache` contains a file `$SAGE_ROOT-$PID-lazy_import_cache.pickle` that seems to be not cleaned up by the sage cleaner. So over time the patchbot will fill it with 32k files, one per possible pid. Not terrible, but could be nicer. Should probably be fixed in the sage-cleaner, though.\n\nRunning the patchbot for a long time seems to leak file descriptors for a pseudoterminal, after a few days I have\n\n```\n[root@volker-desktop 2040]# ps -p 2040 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot  2040  0.0  0.3 301676 99940 pts/2    S+   Jun30   0:57 python /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/local/bin/patchbot/patchbot.py\n[root@volker-desktop 2040]# ls -alv /proc/2040/fd/*\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/0 -> /dev/pts/2\nl-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/1 -> pipe:[3598117]\nl-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/2 -> pipe:[3598117]\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/3 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/4 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/5 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/6 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/7 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/8 -> /dev/pts/2\n[...]\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/319 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/320 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 13:14 /proc/2040/fd/321 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/322 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/323 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/324 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/325 -> /dev/pts/2\nlrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/326 -> /dev/pts/2\nl-wx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/328 -> pipe:[3598117]\n```",
    "created_at": "2012-07-01T12:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137966",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:48" align="right">comment:48</div>

For the record, this is the 32-bit test VM passing the test: http://patchbot.sagemath.org/ticket/?machine=Fedora/16/i686/3.4.2-1.fc16.i686.PAE/sagevm&status=open In any case, this should not block the patchbot ticket going forward.

I noticed that `$DOT_SAGE/cache` contains a file `$SAGE_ROOT-$PID-lazy_import_cache.pickle` that seems to be not cleaned up by the sage cleaner. So over time the patchbot will fill it with 32k files, one per possible pid. Not terrible, but could be nicer. Should probably be fixed in the sage-cleaner, though.

Running the patchbot for a long time seems to leak file descriptors for a pseudoterminal, after a few days I have

```
[root@volker-desktop 2040]# ps -p 2040 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot  2040  0.0  0.3 301676 99940 pts/2    S+   Jun30   0:57 python /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/local/bin/patchbot/patchbot.py
[root@volker-desktop 2040]# ls -alv /proc/2040/fd/*
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/0 -> /dev/pts/2
l-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/1 -> pipe:[3598117]
l-wx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/2 -> pipe:[3598117]
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/3 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/4 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/5 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/6 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/7 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/8 -> /dev/pts/2
[...]
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/319 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/320 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 13:14 /proc/2040/fd/321 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/322 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/323 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 12:54 /proc/2040/fd/324 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/325 -> /dev/pts/2
lrwx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/326 -> /dev/pts/2
l-wx------. 1 patchbot patchbot 64 Jul  1 13:16 /proc/2040/fd/328 -> pipe:[3598117]
```



---

archive/issue_comments_137967.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nPS: there are no spurious processes around as far as I can tell\n\n```\n[root@volker-desktop fd]# pstree -p 2040\npython(2040)\u2500\u252c\u2500bash(19705)\u2500\u2500\u2500bash(19707)\u2500\u2500\u2500python(19710)\u2500\u252c\u2500python(19711)\u2500\u2500\u2500bash(22440)\u2500\u2500\u2500python(22441)\u2500\u2500\u2500python(22442)\n             \u2502                                           \u251c\u2500python(19712)\u2500\u2500\u2500bash(22317)\u2500\u2500\u2500python(22318)\u2500\u2500\u2500python(22319)\u2500\u252c\u2500gp(22346)\n             \u2502                                           \u2502                                                             \u251c\u2500gp(22364)\n             \u2502                                           \u2502                                                             \u251c\u2500mwrank(22334)\n             \u2502                                           \u2502                                                             \u251c\u2500mwrank(22337)\n             \u2502                                           \u2502                                                             \u251c\u2500mwrank(22340)\n             \u2502                                           \u2502                                                             \u2514\u2500mwrank(22443)\n             \u2502                                           \u251c\u2500python(19713)\u2500\u2500\u2500bash(22450)\u2500\u2500\u2500python(22451)\u2500\u2500\u2500python(22452)\n             \u2502                                           \u251c\u2500{python}(19714)\n             \u2502                                           \u251c\u2500{python}(19715)\n             \u2502                                           \u2514\u2500{python}(19716)\n             \u251c\u2500python(19692)\n             \u2514\u2500tee(19283)\n[root@volker-desktop fd]# ps -p 19705 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot 19705  0.0  0.0 112096  1316 pts/2    S+   13:17   0:00 bash /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/sage -tp 3 -sagenb /mnt/storage2TB/patchbot/S\n[root@volker-desktop fd]# ps -p 19692 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot 19692  0.0  0.0      0     0 pts/2    Z+   13:17   0:00 [python] <defunct>\n[root@volker-desktop fd]# ps -p 19283 u\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\npatchbot 19283  0.0  0.0 106848   624 pts/2    S+   13:16   0:00 tee /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/logs/10764-log.txt\n```",
    "created_at": "2012-07-01T12:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137967",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:49" align="right">comment:49</div>

PS: there are no spurious processes around as far as I can tell

```
[root@volker-desktop fd]# pstree -p 2040
python(2040)─┬─bash(19705)───bash(19707)───python(19710)─┬─python(19711)───bash(22440)───python(22441)───python(22442)
             │                                           ├─python(19712)───bash(22317)───python(22318)───python(22319)─┬─gp(22346)
             │                                           │                                                             ├─gp(22364)
             │                                           │                                                             ├─mwrank(22334)
             │                                           │                                                             ├─mwrank(22337)
             │                                           │                                                             ├─mwrank(22340)
             │                                           │                                                             └─mwrank(22443)
             │                                           ├─python(19713)───bash(22450)───python(22451)───python(22452)
             │                                           ├─{python}(19714)
             │                                           ├─{python}(19715)
             │                                           └─{python}(19716)
             ├─python(19692)
             └─tee(19283)
[root@volker-desktop fd]# ps -p 19705 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot 19705  0.0  0.0 112096  1316 pts/2    S+   13:17   0:00 bash /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/sage -tp 3 -sagenb /mnt/storage2TB/patchbot/S
[root@volker-desktop fd]# ps -p 19692 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot 19692  0.0  0.0      0     0 pts/2    Z+   13:17   0:00 [python] <defunct>
[root@volker-desktop fd]# ps -p 19283 u
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
patchbot 19283  0.0  0.0 106848   624 pts/2    S+   13:16   0:00 tee /mnt/storage2TB/patchbot/Sage/sage-5.1.rc0/logs/10764-log.txt
```



---

archive/issue_comments_137968.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nAlso, for the life of me I can't figure out how to make the patchbot ignore the unused patches in #12544. Am I missing anything? Perhaps we need to support \"ignore file.patch\" in the comment text to explicitly tell the bot to ignore patches?",
    "created_at": "2012-07-01T14:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137968",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:50" align="right">comment:50</div>

Also, for the life of me I can't figure out how to make the patchbot ignore the unused patches in #12544. Am I missing anything? Perhaps we need to support "ignore file.patch" in the comment text to explicitly tell the bot to ignore patches?



---

archive/issue_comments_137969.json:
```json
{
    "body": "Attachment: **[trac_12486_fix_fd_leak.patch.gz](https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz)**\n\nInitial patch",
    "created_at": "2012-07-01T14:15:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137969",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_12486_fix_fd_leak.patch.gz](https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz)**

Initial patch



---

archive/issue_comments_137970.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nThe attached patch fixes the fd leak (2 per ticket) for me.",
    "created_at": "2012-07-01T14:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137970",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:51" align="right">comment:51</div>

The attached patch fixes the fd leak (2 per ticket) for me.



---

archive/issue_comments_137971.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,4 @@\n * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n * apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.\n * apply [attachment: 12486-fix-sdist.patch](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz) to the scripts repo.\n+* apply [attachment: trac_12486_fix_fd_leak.patch](https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz) to the scripts repo.\n``````\n",
    "created_at": "2012-07-01T14:16:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137971",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,4 @@
 * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
 * apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.
 * apply [attachment: 12486-fix-sdist.patch](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz) to the scripts repo.
+* apply [attachment: trac_12486_fix_fd_leak.patch](https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz) to the scripts repo.
``````




---

archive/issue_comments_137972.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI'm fine with the ticket going into Sage. Positive review for everything except my patch.",
    "created_at": "2012-07-01T14:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137972",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:52" align="right">comment:52</div>

I'm fine with the ticket going into Sage. Positive review for everything except my patch.



---

archive/issue_comments_137973.json:
```json
{
    "body": "Changed work issues from **sage-sdist** to none",
    "created_at": "2012-07-01T14:28:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137973",
    "user": "https://github.com/vbraun"
}
```

Changed work issues from **sage-sdist** to none



---

archive/issue_comments_137974.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nFor what it's worth, I'm no longer getting the failure on arando after I rebooted it and installed this ticket into 5.1.rc0 (I just got into Singapore today so I was able to physically access the machine again), so you can forget about that, I guess...",
    "created_at": "2012-07-03T00:57:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137974",
    "user": "https://github.com/kini"
}
```

<div id="comment:53" align="right">comment:53</div>

For what it's worth, I'm no longer getting the failure on arando after I rebooted it and installed this ticket into 5.1.rc0 (I just got into Singapore today so I was able to physically access the machine again), so you can forget about that, I guess...



---

archive/issue_comments_137975.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nAh, thanks for the file descriptor leak! Positive review on that patch. I'll look into the issue at #12544, but that seems to be an exceptional case.",
    "created_at": "2012-07-03T06:03:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137975",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:54" align="right">comment:54</div>

Ah, thanks for the file descriptor leak! Positive review on that patch. I'll look into the issue at #12544, but that seems to be an exceptional case.



---

archive/issue_events_170905.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-07-03T06:03:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170905"
}
```



---

archive/issue_events_170906.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-07-03T06:03:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170906"
}
```



---

archive/issue_events_170907.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-08T19:41:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170907"
}
```



---

archive/issue_events_170908.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-08T19:41:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170908"
}
```



---

archive/issue_comments_137976.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\n`sage-sdist` isn't fixed at all, the following files still disappear:\n\n```\n! patchbot/README.txt\n! patchbot/db.py\n! patchbot/http_post_file.py\n! patchbot/images/blue-blob.png\n! patchbot/images/green-blob.png\n! patchbot/images/purple-blob.png\n! patchbot/images/red-blob.png\n! patchbot/images/white-blob.png\n! patchbot/images/yellow-blob.png\n! patchbot/patchbot.py\n! patchbot/plugins.py\n! patchbot/run_server.py\n! patchbot/serve.py\n! patchbot/templates/base.html\n! patchbot/templates/ticket.html\n! patchbot/templates/ticket_list.html\n! patchbot/trac.py\n! patchbot/util.py\n```",
    "created_at": "2012-07-08T19:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137976",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

`sage-sdist` isn't fixed at all, the following files still disappear:

```
! patchbot/README.txt
! patchbot/db.py
! patchbot/http_post_file.py
! patchbot/images/blue-blob.png
! patchbot/images/green-blob.png
! patchbot/images/purple-blob.png
! patchbot/images/red-blob.png
! patchbot/images/white-blob.png
! patchbot/images/yellow-blob.png
! patchbot/patchbot.py
! patchbot/plugins.py
! patchbot/run_server.py
! patchbot/serve.py
! patchbot/templates/base.html
! patchbot/templates/ticket.html
! patchbot/templates/ticket_list.html
! patchbot/trac.py
! patchbot/util.py
```



---

archive/issue_comments_137977.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nArgh! OK, I'm going to rebase this on an entirely clean copy of Sage and git it fixed tonight.",
    "created_at": "2012-07-09T21:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137977",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:56" align="right">comment:56</div>

Argh! OK, I'm going to rebase this on an entirely clean copy of Sage and git it fixed tonight.



---

archive/issue_comments_137978.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nI'm not sure I see what the problem is; is the issue that the files aren't extracted in the spkg itself? That shouldn't matter at all, as they're in the history which is what's used to install the spkg.",
    "created_at": "2012-07-10T08:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137978",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:57" align="right">comment:57</div>

I'm not sure I see what the problem is; is the issue that the files aren't extracted in the spkg itself? That shouldn't matter at all, as they're in the history which is what's used to install the spkg.



---

archive/issue_comments_137979.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nThe issue is that the files are not copied *into* the spkg by `sage-sdist`.",
    "created_at": "2012-07-10T08:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137979",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:58" align="right">comment:58</div>

The issue is that the files are not copied *into* the spkg by `sage-sdist`.



---

archive/issue_comments_137980.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nMy question is more why do they need to be?",
    "created_at": "2012-07-10T09:11:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137980",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:59" align="right">comment:59</div>

My question is more why do they need to be?



---

archive/issue_comments_137981.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@robertwb](#comment:59):\n> My question is more why do they need to be?\n\nBecause we have always done things that way, and I don't see any reason why we should make an exception for the patchbot files.\n\nSurely our installation/packaging procedure can be improved, but that's the topic of #13015, not of this ticket.",
    "created_at": "2012-07-10T09:18:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137981",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@robertwb](#comment:59):
> My question is more why do they need to be?

Because we have always done things that way, and I don't see any reason why we should make an exception for the patchbot files.

Surely our installation/packaging procedure can be improved, but that's the topic of #13015, not of this ticket.



---

archive/issue_comments_137982.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nIf you really want to change the installation of the scripts spkg, make a separate ticket and add that as dependency here.",
    "created_at": "2012-07-10T09:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137982",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

If you really want to change the installation of the scripts spkg, make a separate ticket and add that as dependency here.



---

archive/issue_comments_137983.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nSure, I'll do that. (I just did that here as it seemed cleaner than explicitly adding a bunch of globs to copy, making sure I got everything we wanted and nothing we didn't.)",
    "created_at": "2012-07-10T09:46:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137983",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:62" align="right">comment:62</div>

Sure, I'll do that. (I just did that here as it seemed cleaner than explicitly adding a bunch of globs to copy, making sure I got everything we wanted and nothing we didn't.)



---

archive/issue_comments_137984.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\n*** ping ***",
    "created_at": "2012-08-08T13:04:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137984",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:63" align="right">comment:63</div>

*** ping ***



---

archive/issue_comments_137985.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nDoes the patchbot already feature the automatic deleting of old devel/sage-NNNNN directories?",
    "created_at": "2012-08-14T08:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137985",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:64" align="right">comment:64</div>

Does the patchbot already feature the automatic deleting of old devel/sage-NNNNN directories?



---

archive/issue_comments_137986.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nIt doesn't do so by default at the moment, at least.",
    "created_at": "2012-08-14T09:03:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137986",
    "user": "https://github.com/kini"
}
```

<div id="comment:65" align="right">comment:65</div>

It doesn't do so by default at the moment, at least.



---

archive/issue_comments_137987.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nSorry I haven't gotten back to this. I'll try to get to it within the week. Thanks for the ping.\n\nRegarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed.",
    "created_at": "2012-08-14T16:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137987",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:66" align="right">comment:66</div>

Sorry I haven't gotten back to this. I'll try to get to it within the week. Thanks for the ping.

Regarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed.



---

archive/issue_comments_137988.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nJust an idea concerning the distribution of the patchbot: maybe you could make a separate spkg for the patchbot instead of distributing it with `sage_scripts`?",
    "created_at": "2012-08-15T07:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137988",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:67" align="right">comment:67</div>

Just an idea concerning the distribution of the patchbot: maybe you could make a separate spkg for the patchbot instead of distributing it with `sage_scripts`?



---

archive/issue_comments_137989.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@robertwb](#comment:66):\n> Regarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed. \n\nI would propose something like: if there is no activitity on a ticket (meaning no patches are changed) for a certain time (one week?), then also delete the directory.",
    "created_at": "2012-08-15T07:31:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137989",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@robertwb](#comment:66):
> Regarding deleting the sage-NNNNN directories, It should delete them as the tickets get closed. 

I would propose something like: if there is no activitity on a ticket (meaning no patches are changed) for a certain time (one week?), then also delete the directory.



---

archive/issue_comments_137990.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nI've been running a patchbot for a while now and disk usage isn't really that much of a deal. Especially since there isn't any reason to keep old versions around as development goes on. What is much more annoying is that this ticket is still not merged so with each beta I have to install a handful of patches on a machine on the other side of the atlantic...",
    "created_at": "2012-08-15T13:39:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137990",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:69" align="right">comment:69</div>

I've been running a patchbot for a while now and disk usage isn't really that much of a deal. Especially since there isn't any reason to keep old versions around as development goes on. What is much more annoying is that this ticket is still not merged so with each beta I have to install a handful of patches on a machine on the other side of the atlantic...



---

archive/issue_comments_137991.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nI have this setup on arando:\n\n```\n[1] patchbot@arando /opt $ ls -hal\ntotal 4.4G\ndrwxrwxr-x  3 root     opt      4.0K Aug 15 21:42 .\ndrwxr-xr-x 22 root     root     4.0K Aug 13 18:32 ..\nlrwxrwxrwx  1 patchbot patchbot   18 Aug 13 20:12 patchbot -> patchbot-5.3.beta1\ndrwxr-xr-x 10 patchbot patchbot 4.0K Aug 13 23:49 patchbot-5.3.beta1\n-rw-rw-r--  1 patchbot patchbot 295M Jul  3 03:15 sage-5.0.1.tar\n-r--r--r--  1 kini     kini     294M May 15 17:54 sage-5.0.tar\n-rw-r--r--  1 kini     kini     294M May 18 02:09 sage-5.1.beta0.tar\n-rw-rw-r--  1 patchbot patchbot 294M May 29 05:40 sage-5.1.beta1.tar\n-rw-rw-r--  1 patchbot patchbot 290M Jun  4 00:58 sage-5.1.beta2.tar\n-rw-rw-r--  1 patchbot patchbot 290M Jun  7 17:37 sage-5.1.beta3.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jun 19 19:31 sage-5.1.beta5.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jun 25 19:30 sage-5.1.beta6.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jul  3 03:16 sage-5.1.rc0.tar\n-rw-rw-r--  1 patchbot patchbot 291M Jul  6 07:32 sage-5.1.rc1.tar\n-rw-rw-r--  1 patchbot patchbot 313M Jul 10 02:18 sage-5.2.beta0.tar\n-rw-rw-r--  1 patchbot patchbot 314M Jul 25 01:59 sage-5.2.rc1.tar\n-rw-rw-r--  1 patchbot patchbot 314M Jul 26 02:00 sage-5.2.tar\n-rw-rw-r--  1 patchbot patchbot 314M Aug  1 23:55 sage-5.3.beta0.tar\n-rw-rw-r--  1 patchbot patchbot 314M Aug 13 06:15 sage-5.3.beta1.tar\n-rwxrwxr-x  1 patchbot patchbot 1.3K Aug 15 21:42 setup-patchbot.sh\n[1] patchbot@arando /opt $ cat setup-patchbot.sh \n#!/bin/bash\n\n# This script upgrades the currently running patchbot in this directory.\n# Supply a Sage version number as an argument, and the script will\n# download, set up, and run the patchbot.\n\nVER=$1\n[ -n $VER ] || exit 1\n\n# Get new patchbot and extract it\nrm -f sage-$VER.tar\nwget http://boxen.math.washington.edu/home/release/sage-$VER/sage-$VER.tar\nrm -rf $(readlink patchbot)\n\n# Delete old patchbot dir (keep tarball) and move symlink to new\n# patchbot dir\nrm patchbot\ntar xf sage-$VER.tar\nmv sage-$VER patchbot-$VER\nln -s patchbot-$VER patchbot\n\n# Build new patchbot's Sage from source\ncd patchbot\nmake\n\n# Install the patchbot into the newly built Sage version (TODO: update\n# this when the patches on ticket #12486 change, or when #12486 is\n# merged)\nhg qimport -P https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz\nhg -R local/bin qimport -P https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz\nhg -R local/bin qimport -P https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz\nhg -R local/bin qimport -P https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz\n./sage -b\n\n# Start the patchbot\nexec ./sage --patchbot\n[1] patchbot@arando /opt $ \n```\n\nMakes it pretty easy...",
    "created_at": "2012-08-15T13:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137991",
    "user": "https://github.com/kini"
}
```

<div id="comment:70" align="right">comment:70</div>

I have this setup on arando:

```
[1] patchbot@arando /opt $ ls -hal
total 4.4G
drwxrwxr-x  3 root     opt      4.0K Aug 15 21:42 .
drwxr-xr-x 22 root     root     4.0K Aug 13 18:32 ..
lrwxrwxrwx  1 patchbot patchbot   18 Aug 13 20:12 patchbot -> patchbot-5.3.beta1
drwxr-xr-x 10 patchbot patchbot 4.0K Aug 13 23:49 patchbot-5.3.beta1
-rw-rw-r--  1 patchbot patchbot 295M Jul  3 03:15 sage-5.0.1.tar
-r--r--r--  1 kini     kini     294M May 15 17:54 sage-5.0.tar
-rw-r--r--  1 kini     kini     294M May 18 02:09 sage-5.1.beta0.tar
-rw-rw-r--  1 patchbot patchbot 294M May 29 05:40 sage-5.1.beta1.tar
-rw-rw-r--  1 patchbot patchbot 290M Jun  4 00:58 sage-5.1.beta2.tar
-rw-rw-r--  1 patchbot patchbot 290M Jun  7 17:37 sage-5.1.beta3.tar
-rw-rw-r--  1 patchbot patchbot 291M Jun 19 19:31 sage-5.1.beta5.tar
-rw-rw-r--  1 patchbot patchbot 291M Jun 25 19:30 sage-5.1.beta6.tar
-rw-rw-r--  1 patchbot patchbot 291M Jul  3 03:16 sage-5.1.rc0.tar
-rw-rw-r--  1 patchbot patchbot 291M Jul  6 07:32 sage-5.1.rc1.tar
-rw-rw-r--  1 patchbot patchbot 313M Jul 10 02:18 sage-5.2.beta0.tar
-rw-rw-r--  1 patchbot patchbot 314M Jul 25 01:59 sage-5.2.rc1.tar
-rw-rw-r--  1 patchbot patchbot 314M Jul 26 02:00 sage-5.2.tar
-rw-rw-r--  1 patchbot patchbot 314M Aug  1 23:55 sage-5.3.beta0.tar
-rw-rw-r--  1 patchbot patchbot 314M Aug 13 06:15 sage-5.3.beta1.tar
-rwxrwxr-x  1 patchbot patchbot 1.3K Aug 15 21:42 setup-patchbot.sh
[1] patchbot@arando /opt $ cat setup-patchbot.sh 
#!/bin/bash

# This script upgrades the currently running patchbot in this directory.
# Supply a Sage version number as an argument, and the script will
# download, set up, and run the patchbot.

VER=$1
[ -n $VER ] || exit 1

# Get new patchbot and extract it
rm -f sage-$VER.tar
wget http://boxen.math.washington.edu/home/release/sage-$VER/sage-$VER.tar
rm -rf $(readlink patchbot)

# Delete old patchbot dir (keep tarball) and move symlink to new
# patchbot dir
rm patchbot
tar xf sage-$VER.tar
mv sage-$VER patchbot-$VER
ln -s patchbot-$VER patchbot

# Build new patchbot's Sage from source
cd patchbot
make

# Install the patchbot into the newly built Sage version (TODO: update
# this when the patches on ticket #12486 change, or when #12486 is
# merged)
hg qimport -P https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz
hg -R local/bin qimport -P https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz
hg -R local/bin qimport -P https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz
hg -R local/bin qimport -P https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz
./sage -b

# Start the patchbot
exec ./sage --patchbot
[1] patchbot@arando /opt $ 
```

Makes it pretty easy...



---

archive/issue_comments_137992.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nI've created an spkg: http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg\n\nThe contents of this spkg should be identical to the (flattened) patches.",
    "created_at": "2012-08-23T09:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137992",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:71" align="right">comment:71</div>

I've created an spkg: http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg

The contents of this spkg should be identical to the (flattened) patches.



---

archive/issue_events_170909.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-08-23T09:31:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170909"
}
```



---

archive/issue_events_170910.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-08-23T09:31:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170910"
}
```



---

archive/issue_comments_137993.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,4 @@\n **Instructions:**\n \n * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n-* apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.\n-* apply [attachment: 12486-fix-sdist.patch](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz) to the scripts repo.\n-* apply [attachment: trac_12486_fix_fd_leak.patch](https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz) to the scripts repo.\n+* install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg\n``````\n",
    "created_at": "2012-08-23T09:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137993",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,4 @@
 **Instructions:**
 
 * apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
-* apply [attachment: 12486-patchbot-scripts-5.0-updated.patch](https://github.com/sagemath/sage/files/ticket12486/12486-patchbot-scripts-5.0-updated.patch.gz) to the scripts repo.
-* apply [attachment: 12486-fix-sdist.patch](https://github.com/sagemath/sage/files/ticket12486/12486-fix-sdist.patch.gz) to the scripts repo.
-* apply [attachment: trac_12486_fix_fd_leak.patch](https://github.com/sagemath/sage/files/ticket12486/trac_12486_fix_fd_leak.patch.gz) to the scripts repo.
+* install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg
``````




---

archive/issue_comments_137994.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nAdding a spkg requires changes to `spkg/standard/deps` and `spkg/install`.\n\nLeaving `$SAGE_LOCAL` unquoted is not so good:\n\n```\n$SAGE_LOCAL/bin/patchbot/patchbot.py\n```\n\nBetter is\n\n```\n\"$SAGE_LOCAL/bin/patchbot/patchbot.py\"\n```",
    "created_at": "2012-08-23T15:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137994",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:72" align="right">comment:72</div>

Adding a spkg requires changes to `spkg/standard/deps` and `spkg/install`.

Leaving `$SAGE_LOCAL` unquoted is not so good:

```
$SAGE_LOCAL/bin/patchbot/patchbot.py
```

Better is

```
"$SAGE_LOCAL/bin/patchbot/patchbot.py"
```



---

archive/issue_events_170911.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-23T15:02:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170911"
}
```



---

archive/issue_events_170912.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-23T15:02:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170912"
}
```



---

archive/issue_events_170913.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-08-23T15:58:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170913"
}
```



---

archive/issue_events_170914.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2012-08-23T15:58:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170914"
}
```



---

archive/issue_comments_137995.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nAttachment: **[patchbot-root-5.0.quoted.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.quoted.patch.gz)**",
    "created_at": "2012-08-23T15:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137995",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:73" align="right">comment:73</div>

Attachment: **[patchbot-root-5.0.quoted.patch.gz](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.quoted.patch.gz)**



---

archive/issue_comments_137996.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n **Instructions:**\n \n-* apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and\n+* apply [attachment: patchbot-root-5.0-quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0-quoted.patch.gz) to the SAGE_ROOT repo and\n * install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg\n``````\n",
    "created_at": "2012-08-23T15:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137996",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 **Instructions:**
 
-* apply [attachment: patchbot-root-5.0.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.patch.gz) to the SAGE_ROOT repo and
+* apply [attachment: patchbot-root-5.0-quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0-quoted.patch.gz) to the SAGE_ROOT repo and
 * install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg
``````




---

archive/issue_comments_137997.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,5 @@\n \n **Instructions:**\n \n-* apply [attachment: patchbot-root-5.0-quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0-quoted.patch.gz) to the SAGE_ROOT repo and\n+* apply [attachment: patchbot-root-5.0.quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.quoted.patch.gz) to the SAGE_ROOT repo and\n * install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg\n``````\n",
    "created_at": "2012-08-23T15:58:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137997",
    "user": "https://github.com/robertwb"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,5 @@
 
 **Instructions:**
 
-* apply [attachment: patchbot-root-5.0-quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0-quoted.patch.gz) to the SAGE_ROOT repo and
+* apply [attachment: patchbot-root-5.0.quoted.patch](https://github.com/sagemath/sage/files/ticket12486/patchbot-root-5.0.quoted.patch.gz) to the SAGE_ROOT repo and
 * install http://sage.math.washington.edu/home/robertwb/patches/patchbot-1.0.spkg
``````




---

archive/issue_comments_137998.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nAs Simon King pointed out on sage-devel a few days ago, the patchbot shouldn't report \"ApplyFailed\" when what failed was the downloading of the patches rather than the application of the patches.",
    "created_at": "2012-08-24T03:01:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137998",
    "user": "https://github.com/kini"
}
```

<div id="comment:75" align="right">comment:75</div>

As Simon King pointed out on sage-devel a few days ago, the patchbot shouldn't report "ApplyFailed" when what failed was the downloading of the patches rather than the application of the patches.



---

archive/issue_comments_137999.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nGood idea to package the bot. I think we should start by making the patchbot an optional spkg.   We don't need to modify `spkg/standard/deps` or add id to the `sage -advanced` help then. Once it is an optional spkg we can vote on sage-devel to make it standard (+1 from me). \n\nFor consistency the mercurial repo inside the spkg should have the bot committed and not as a patch queue. Apart from that its ready to go.",
    "created_at": "2012-08-25T15:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-137999",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:76" align="right">comment:76</div>

Good idea to package the bot. I think we should start by making the patchbot an optional spkg.   We don't need to modify `spkg/standard/deps` or add id to the `sage -advanced` help then. Once it is an optional spkg we can vote on sage-devel to make it standard (+1 from me). 

For consistency the mercurial repo inside the spkg should have the bot committed and not as a patch queue. Apart from that its ready to go.



---

archive/issue_events_170915.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-08-25T15:23:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "title_is": "Make the Sage patchbot an optional spkg",
    "title_was": "Add patchbot to Sage itself",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170915"
}
```



---

archive/issue_comments_138000.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nThe Mercurial repo inside the SPKG should not have the bot committed. The bot should be in the src/ directory and the src/ directory should be ignored in .hgignore. This is standard among SPKGs, and is also what is present in the current patch queue in the SPKG.",
    "created_at": "2012-08-25T15:31:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138000",
    "user": "https://github.com/kini"
}
```

<div id="comment:77" align="right">comment:77</div>

The Mercurial repo inside the SPKG should not have the bot committed. The bot should be in the src/ directory and the src/ directory should be ignored in .hgignore. This is standard among SPKGs, and is also what is present in the current patch queue in the SPKG.



---

archive/issue_comments_138001.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nThats what I meant. Sorry for not being clear. My point is that the `SPGK.txt`, ... files are in a mercurial queue right now.",
    "created_at": "2012-08-25T15:48:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138001",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:78" align="right">comment:78</div>

Thats what I meant. Sorry for not being clear. My point is that the `SPGK.txt`, ... files are in a mercurial queue right now.



---

archive/issue_comments_138002.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\n`patchbot.py` is not executable, so `sage --patchbot` fails to execute.",
    "created_at": "2012-08-25T17:53:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138002",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:79" align="right">comment:79</div>

`patchbot.py` is not executable, so `sage --patchbot` fails to execute.



---

archive/issue_comments_138003.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nOK, I've pushed a new commit to make patchbot.py executable and make the hg commit a real commit. It's nit-picky stuff like this that in part made me want to avoid making an spkg. I'd much rather spend time improving or cleaning up the patchbot than worrying about packaging details as I've done over the last 7 (!) months since filing this ticket (whether as a patch or an spkg) but it's a real pain to not have this in. Basically, we need to move to a better system soon... OK, done ranting.\n\nI also made it to qimport failing doesn't cause the ticket to fail.",
    "created_at": "2012-08-26T05:19:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138003",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:80" align="right">comment:80</div>

OK, I've pushed a new commit to make patchbot.py executable and make the hg commit a real commit. It's nit-picky stuff like this that in part made me want to avoid making an spkg. I'd much rather spend time improving or cleaning up the patchbot than worrying about packaging details as I've done over the last 7 (!) months since filing this ticket (whether as a patch or an spkg) but it's a real pain to not have this in. Basically, we need to move to a better system soon... OK, done ranting.

I also made it to qimport failing doesn't cause the ticket to fail.



---

archive/issue_comments_138004.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nAnd, to be clear, no offense to any of you intended, in fact I'm really grateful you're looking at this. It's the system that's to onerous.",
    "created_at": "2012-08-26T05:21:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138004",
    "user": "https://github.com/robertwb"
}
```

<div id="comment:81" align="right">comment:81</div>

And, to be clear, no offense to any of you intended, in fact I'm really grateful you're looking at this. It's the system that's to onerous.



---

archive/issue_events_170916.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-28T07:07:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170916"
}
```



---

archive/issue_events_170917.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-28T07:07:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "000080",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170917"
}
```



---

archive/issue_comments_138005.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nLooks good to me!",
    "created_at": "2012-08-29T13:44:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138005",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:83" align="right">comment:83</div>

Looks good to me!



---

archive/issue_events_170918.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-08-29T13:44:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170918"
}
```



---

archive/issue_events_170919.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-08-29T13:44:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170919"
}
```



---

archive/issue_comments_138006.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nthe optional spkg is on the server+mirrors now.",
    "created_at": "2012-08-30T09:49:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138006",
    "user": "https://github.com/haraldschilly"
}
```

<div id="comment:84" align="right">comment:84</div>

the optional spkg is on the server+mirrors now.



---

archive/issue_comments_138007.json:
```json
{
    "body": "Merged: **sage-5.3.rc1**",
    "created_at": "2012-08-30T11:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12486#issuecomment-138007",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.3.rc1**



---

archive/issue_events_170920.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-30T11:41:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170920"
}
```



---

archive/issue_events_170921.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-30T11:41:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12486",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12486#event-170921"
}
```
