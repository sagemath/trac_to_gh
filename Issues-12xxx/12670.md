# Issue 12670: Store lazy import caches in .sage/cache/ rather than in .sage

archive/issues_012498.json:
```json
{
    "assignees": [],
    "body": "After building and running many versions of Sage, my `.sage` directory is littered with files with names like\n\n```\n_Applications_sage_builds_sage-5.0.beta7-gcc_devel_sage-main-lazy_import_cache.pickle\n```\nWe should instead store these in a subdirectory of `.sage`. The attached patch makes this change.\n\n\n**Assignee:** @jasongrout\n\n**Reviewer:** Florent Hivert\n\n**Author:** John Palmieri\n\n**Merged:** sage-5.0.beta10\n\nIssue created by migration from https://trac.sagemath.org/ticket/12670\n\n",
    "closed_at": "2012-03-23T15:23:21Z",
    "created_at": "2012-03-14T20:55:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20misc",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Store lazy import caches in .sage/cache/ rather than in .sage",
    "type": "issue",
    "updated_at": "2012-03-23T15:23:21Z",
    "url": "https://github.com/sagemath/sage/issues/12670",
    "user": "https://github.com/jhpalmieri"
}
```
After building and running many versions of Sage, my `.sage` directory is littered with files with names like

```
_Applications_sage_builds_sage-5.0.beta7-gcc_devel_sage-main-lazy_import_cache.pickle
```
We should instead store these in a subdirectory of `.sage`. The attached patch makes this change.


**Assignee:** @jasongrout

**Reviewer:** Florent Hivert

**Author:** John Palmieri

**Merged:** sage-5.0.beta10

Issue created by migration from https://trac.sagemath.org/ticket/12670





---

archive/issue_events_147222.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T20:55:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147222"
}
```



---

archive/issue_events_147223.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T20:55:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20misc",
    "label_color": "08517b",
    "label_name": "component: misc",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147223"
}
```



---

archive/issue_events_147224.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T20:55:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147224"
}
```



---

archive/issue_events_147225.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T20:55:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147225"
}
```



---

archive/issue_comments_143554.json:
```json
{
    "body": "(Sage library)",
    "created_at": "2012-03-14T20:56:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143554",
    "user": "https://github.com/jhpalmieri"
}
```

(Sage library)



---

archive/issue_comments_143555.json:
```json
{
    "body": "<a id='comment:1'>**Comment 1:**</a>\n**Attachment:** [trac_12670-lazy-cache.patch.gz](https://github.com/sagemath/sage/files/ticket12670/trac_12670-lazy-cache.patch.gz)",
    "created_at": "2012-03-14T20:56:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143555",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'>**Comment 1:**</a>
**Attachment:** [trac_12670-lazy-cache.patch.gz](https://github.com/sagemath/sage/files/ticket12670/trac_12670-lazy-cache.patch.gz)



---

archive/issue_events_147226.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-03-14T20:56:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147226"
}
```



---

archive/issue_comments_143556.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nHi John,\n\nI noticed the same for me. Thanks for tacking care of that. By the way, in my `.sage` the mentioned file are all only 6 bytes long which seems to be rather small for a cache. Is it normal ? Is the cache actually working ?\n\nFlorent",
    "created_at": "2012-03-15T11:35:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143556",
    "user": "https://github.com/hivert"
}
```

<a id='comment:2'>**Comment 2:**</a>
Hi John,

I noticed the same for me. Thanks for tacking care of that. By the way, in my `.sage` the mentioned file are all only 6 bytes long which seems to be rather small for a cache. Is it normal ? Is the cache actually working ?

Florent



---

archive/issue_comments_143557.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nHi Florent,\n\nMy files are only 6 bytes long, too. I don't know anything about the actual code involved in the caches, so I don't know if they're working. (I think they may be the first step toward something more significant, but I'm not sure.)  In any case, it's certainly ridiculous to have files with ugly names over 80 characters long, especially if they only contain 6 bytes, stored in a semi-public place.",
    "created_at": "2012-03-15T15:09:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143557",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'>**Comment 3:**</a>
Hi Florent,

My files are only 6 bytes long, too. I don't know anything about the actual code involved in the caches, so I don't know if they're working. (I think they may be the first step toward something more significant, but I'm not sure.)  In any case, it's certainly ridiculous to have files with ugly names over 80 characters long, especially if they only contain 6 bytes, stored in a semi-public place.



---

archive/issue_comments_143558.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\n> My files are only 6 bytes long, too. I don't know anything about the actual code involved in the caches, so I don't know if they're working. (I think they may be the first step toward something more significant, but I'm not sure.)  In any case, it's certainly ridiculous to have files with ugly names over 80 characters long, especially if they only contain 6 bytes, stored in a semi-public place.\n\nSure ! I'm reviewing your code and ask for those file on sage-devel. Right no I think it is ready to go I just want to wait the results of the tests.\n\nFlorent",
    "created_at": "2012-03-16T08:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143558",
    "user": "https://github.com/hivert"
}
```

<a id='comment:4'>**Comment 4:**</a>
> My files are only 6 bytes long, too. I don't know anything about the actual code involved in the caches, so I don't know if they're working. (I think they may be the first step toward something more significant, but I'm not sure.)  In any case, it's certainly ridiculous to have files with ugly names over 80 characters long, especially if they only contain 6 bytes, stored in a semi-public place.

Sure ! I'm reviewing your code and ask for those file on sage-devel. Right no I think it is ready to go I just want to wait the results of the tests.

Florent



---

archive/issue_comments_143559.json:
```json
{
    "body": "**Reviewer:** Florent Hivert",
    "created_at": "2012-03-16T08:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143559",
    "user": "https://github.com/hivert"
}
```

**Reviewer:** Florent Hivert



---

archive/issue_comments_143560.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nThe only calls to `save_cache_file` I've been able to find are in `sage/all.py` (this file is apparently skipped by `search_src`) and in the doctest of `save_cache_file`. This cache only seems to be involved with `get_star_imports` and that only gets used in `sage.misc.lazy_import` if there is a \"*\" in the input. So indeed, this cache is never used as far as I can see.",
    "created_at": "2012-03-16T16:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143560",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:5'>**Comment 5:**</a>
The only calls to `save_cache_file` I've been able to find are in `sage/all.py` (this file is apparently skipped by `search_src`) and in the doctest of `save_cache_file`. This cache only seems to be involved with `get_star_imports` and that only gets used in `sage.misc.lazy_import` if there is a "*" in the input. So indeed, this cache is never used as far as I can see.



---

archive/issue_events_147227.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2012-03-17T09:40:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147227"
}
```



---

archive/issue_events_147228.json:
```json
{
    "actor": "https://github.com/hivert",
    "created_at": "2012-03-17T09:40:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147228"
}
```



---

archive/issue_comments_143561.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nThe test passes and the code looks good so I'm ok to set the positive review. However, something else has to be done: either to expand the cases where the cache is used or simply to remove it at all. In the mean time I feel that the patch here should enter sage.",
    "created_at": "2012-03-17T09:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143561",
    "user": "https://github.com/hivert"
}
```

<a id='comment:6'>**Comment 6:**</a>
The test passes and the code looks good so I'm ok to set the positive review. However, something else has to be done: either to expand the cases where the cache is used or simply to remove it at all. In the mean time I feel that the patch here should enter sage.



---

archive/issue_events_147229.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:23:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147229"
}
```



---

archive/issue_events_147230.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:23:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12670#event-147230"
}
```



---

archive/issue_comments_143562.json:
```json
{
    "body": "**Merged:** sage-5.0.beta10",
    "created_at": "2012-03-23T15:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12670",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12670#issuecomment-143562",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta10
