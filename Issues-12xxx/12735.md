# Issue 12735: doctest framework bug that was somehow observed via -- "optional magma doctest fails on sage-5.0.beta9"

archive/issues_012563.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "The following optional magma doctest fails on sage-5.0.bata9 using\nmagma-2.18-4.\n\n```\neno% ./sage -t -only-optional=magma \"devel/sage/sage/symbolic/integration/integral.py\"\nsage -t -only-optional=magma \"devel/sage/sage/symbolic/integration/integral.py\"\nTraceback (most recent call last):\n  File \"/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest\", line 924, in <module>\n    test_file(argv[1], library_code = library_code)\n  File \"/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest\", line 721, in test_file\n    s = extract_doc(file, library_code=library_code)\n  File \"/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest\", line 551, in extract_doc\n    doc = doc_preparse(F[i:j+3])\n  File \"/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest\", line 370, in doc_preparse\n    v = [i for i in range(len(t)) if only_optional_include(comment_modifiers[i])]\nIndexError: list index out of range\n         [0.2 s]\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n        sage -t -only-optional=magma \"devel/sage/sage/symbolic/integration/integral.py\" # File not found\n```\n\nFixed by #12493.\n\nCC:  @robertwb @mwhansen @williamstein\n\nKeywords: **sd40.5**\n\nReviewer: **William Stein, Mike Hansen**\n\nComponent: **doctest coverage**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12735_\n\n",
    "closed_at": "2012-06-02T13:23:42Z",
    "created_at": "2012-03-23T13:21:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/doctest%20coverage",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "doctest framework bug that was somehow observed via -- \"optional magma doctest fails on sage-5.0.beta9\"",
    "type": "issue",
    "updated_at": "2012-06-02T13:23:42Z",
    "url": "https://github.com/sagemath/sage/issues/12735",
    "user": "https://github.com/sagetrac-mariah"
}
```
The following optional magma doctest fails on sage-5.0.bata9 using
magma-2.18-4.

```
eno% ./sage -t -only-optional=magma "devel/sage/sage/symbolic/integration/integral.py"
sage -t -only-optional=magma "devel/sage/sage/symbolic/integration/integral.py"
Traceback (most recent call last):
  File "/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest", line 924, in <module>
    test_file(argv[1], library_code = library_code)
  File "/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest", line 721, in test_file
    s = extract_doc(file, library_code=library_code)
  File "/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest", line 551, in extract_doc
    doc = doc_preparse(F[i:j+3])
  File "/home/mariah/sage/sage-5.0.beta9-x86_64-Linux-core2-fc/local/bin/sage-doctest", line 370, in doc_preparse
    v = [i for i in range(len(t)) if only_optional_include(comment_modifiers[i])]
IndexError: list index out of range
         [0.2 s]
 
----------------------------------------------------------------------
The following tests failed:


        sage -t -only-optional=magma "devel/sage/sage/symbolic/integration/integral.py" # File not found
```

Fixed by #12493.

CC:  @robertwb @mwhansen @williamstein

Keywords: **sd40.5**

Reviewer: **William Stein, Mike Hansen**

Component: **doctest coverage**

_Issue created by migration from https://trac.sagemath.org/ticket/12735_





---

archive/issue_events_175386.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2012-03-23T13:21:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175386"
}
```



---

archive/issue_events_175387.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2012-03-23T13:21:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175387"
}
```



---

archive/issue_events_175388.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2012-03-23T13:21:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175388"
}
```



---

archive/issue_events_175389.json:
```json
{
    "actor": "https://github.com/sagetrac-mariah",
    "created_at": "2012-03-23T13:21:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175389"
}
```



---

archive/issue_events_175390.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-03-23T13:21:40Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "subject": "https://github.com/sagetrac-mariah",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175390"
}
```



---

archive/issue_comments_142651.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIs this reproducible?  It seems like more of a problem with `sage-doctest` than anything specific to Magma.",
    "created_at": "2012-05-25T06:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142651",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:1" align="right">comment:1</div>

Is this reproducible?  It seems like more of a problem with `sage-doctest` than anything specific to Magma.



---

archive/issue_comments_142652.json:
```json
{
    "body": "Changed keywords from none to **sd40.5**",
    "created_at": "2012-05-25T06:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142652",
    "user": "https://github.com/mwhansen"
}
```

Changed keywords from none to **sd40.5**



---

archive/issue_events_175391.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T17:15:25Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175391"
}
```



---

archive/issue_events_175392.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2012-05-25T17:15:25Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175392"
}
```



---

archive/issue_events_175393.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T17:15:25Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "title_is": "doctest framework bug that was somehow observed via -- \"optional magma doctest fails on sage-5.0.beta9\"",
    "title_was": "optional magma doctest fails on sage-5.0.beta9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175393"
}
```



---

archive/issue_events_175394.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T17:15:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175394"
}
```



---

archive/issue_events_175395.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T17:15:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/doctest%20coverage",
    "label_color": "696969",
    "label_name": "doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175395"
}
```



---

archive/issue_comments_142653.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nmhansen -- you are right -- this has nothing to do with Magma, a priori.   I'll change the title of the ticket.    It's a bug in the doctest framework, but I don't yet know how to trigger it.  I just looked through the relevant code in sage-doctest, and it's a mix of code I wrote and then later Robert Bradshaw extended with a \"tolerance\" ability.  My code assumes that the lists t and comment_modifiers have the same length, but I think Robert's doesn't and in some cases adds things to t but not comment_modifiers.",
    "created_at": "2012-05-25T17:15:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142653",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:3" align="right">comment:3</div>

mhansen -- you are right -- this has nothing to do with Magma, a priori.   I'll change the title of the ticket.    It's a bug in the doctest framework, but I don't yet know how to trigger it.  I just looked through the relevant code in sage-doctest, and it's a mix of code I wrote and then later Robert Bradshaw extended with a "tolerance" ability.  My code assumes that the lists t and comment_modifiers have the same length, but I think Robert's doesn't and in some cases adds things to t but not comment_modifiers.



---

archive/issue_comments_142654.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis has been fixed in sage-5.0 already as #12493.   I'm closing this as a dup.",
    "created_at": "2012-05-25T18:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142654",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:5" align="right">comment:5</div>

This has been fixed in sage-5.0 already as #12493.   I'm closing this as a dup.



---

archive/issue_events_175396.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T18:32:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175396"
}
```



---

archive/issue_events_175397.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T18:32:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175397"
}
```



---

archive/issue_events_175398.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-25T18:32:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175398"
}
```



---

archive/issue_events_175399.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-26T02:23:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175399"
}
```



---

archive/issue_comments_142655.json:
```json
{
    "body": "Reviewer: **William Stein, Mike Hansen**",
    "created_at": "2012-05-26T02:23:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142655",
    "user": "https://github.com/williamstein"
}
```

Reviewer: **William Stein, Mike Hansen**



---

archive/issue_events_175400.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-26T02:23:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175400"
}
```



---

archive/issue_events_175401.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-26T02:23:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175401"
}
```



---

archive/issue_events_175402.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-26T02:23:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175402"
}
```



---

archive/issue_comments_142656.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis should be closed as a dup.",
    "created_at": "2012-05-26T02:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142656",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:9" align="right">comment:9</div>

This should be closed as a dup.



---

archive/issue_events_175403.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-26T02:24:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175403"
}
```



---

archive/issue_events_175404.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2012-05-26T02:24:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175404"
}
```



---

archive/issue_events_175405.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T13:23:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175405"
}
```



---

archive/issue_events_175406.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T13:23:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175406"
}
```



---

archive/issue_events_175407.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T13:23:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12735#event-175407"
}
```



---

archive/issue_comments_142657.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -22,3 +22,5 @@\n \n         sage -t -only-optional=magma \"devel/sage/sage/symbolic/integration/integral.py\" # File not found\n ```\n+\n+Fixed by #12493.\n``````\n",
    "created_at": "2012-06-02T13:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12735",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12735#issuecomment-142657",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -22,3 +22,5 @@
 
         sage -t -only-optional=magma "devel/sage/sage/symbolic/integration/integral.py" # File not found
 ```
+
+Fixed by #12493.
``````

