# Issue 12051: LLL algorithm for matrices over QQ

archive/issues_011879.json:
```json
{
    "body": "Matrices over `QQ` do not have a method `LLL(...)` like matrices over `ZZ`. Here is a simple implementation:\n\n1. get rid of the denominator\n2. call the `LLL` method of integer matrices\n3. set the denominator back.\n\nNote: in previous version it was suggested that such an approach might be useful for matrices over `RR`. But it is not completely clear how to do that efficiently.\n\nAssignee: jason, was\n\nCC:  fschulze\n\nKeywords: LLL, rationals, QQ\n\nBranch/Commit: 9bc18b50d58d5fb4128d925c08d69fff524c420b\n\nReviewer: John Cremona\n\nAuthor: Johan Bosman\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12051\n\n",
    "closed_at": "2015-04-14T19:44:23Z",
    "created_at": "2011-11-17T18:14:21Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "LLL algorithm for matrices over QQ",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12051",
    "user": "https://github.com/dkrenn"
}
```
Matrices over `QQ` do not have a method `LLL(...)` like matrices over `ZZ`. Here is a simple implementation:

1. get rid of the denominator
2. call the `LLL` method of integer matrices
3. set the denominator back.

Note: in previous version it was suggested that such an approach might be useful for matrices over `RR`. But it is not completely clear how to do that efficiently.

Assignee: jason, was

CC:  fschulze

Keywords: LLL, rationals, QQ

Branch/Commit: 9bc18b50d58d5fb4128d925c08d69fff524c420b

Reviewer: John Cremona

Author: Johan Bosman

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12051





---

archive/issue_comments_143772.json:
```json
{
    "body": "<a id='comment:1'></a>You mean for matrices over `QQ` and `RR` whose entries happen to be integers?",
    "created_at": "2011-11-17T20:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143772",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:1'></a>You mean for matrices over `QQ` and `RR` whose entries happen to be integers?



---

archive/issue_comments_143773.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 mhansen]:\n\n> You mean for matrices over `QQ` and `RR` whose entries happen to be integers?\n\n\nNo. A strategy could be the following: For matrices over `QQ` you can multiply by the least common multiple of all denominators to get a matrix over `ZZ`, then apply LLL, and then scale back. For matrices over the reals (which are of finite precision), do also some scaling to get an integer-matrix.",
    "created_at": "2011-11-17T21:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143773",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:2'></a>Replying to [comment:1 mhansen]:

> You mean for matrices over `QQ` and `RR` whose entries happen to be integers?


No. A strategy could be the following: For matrices over `QQ` you can multiply by the least common multiple of all denominators to get a matrix over `ZZ`, then apply LLL, and then scale back. For matrices over the reals (which are of finite precision), do also some scaling to get an integer-matrix.



---

archive/issue_comments_143774.json:
```json
{
    "body": "<a id='comment:3'></a>It would definitely be good to have this!  For QQ, the proposed strategy obviously works.  For RR, it probably needs some thought what sort of scaling to do here.  For instance, if the matrix has very large as well as very small entries.",
    "created_at": "2011-12-11T11:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143774",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

<a id='comment:3'></a>It would definitely be good to have this!  For QQ, the proposed strategy obviously works.  For RR, it probably needs some thought what sort of scaling to do here.  For instance, if the matrix has very large as well as very small entries.



---

archive/issue_comments_143775.json:
```json
{
    "body": "<a id='comment:4'></a>We asked Andy Novocin about the case of matrices over `RR`. If one wants to use LLL for rational number reconstruction and has lots of decimal digits he proposed the algorithm in [http://www.cs.uwaterloo.ca/~astorjoh/issac11ratrecon.pdf](http://www.cs.uwaterloo.ca/~astorjoh/issac11ratrecon.pdf)",
    "created_at": "2011-12-21T10:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143775",
    "user": "https://trac.sagemath.org/admin/accounts/users/fschulze"
}
```

<a id='comment:4'></a>We asked Andy Novocin about the case of matrices over `RR`. If one wants to use LLL for rational number reconstruction and has lots of decimal digits he proposed the algorithm in [http://www.cs.uwaterloo.ca/~astorjoh/issac11ratrecon.pdf](http://www.cs.uwaterloo.ca/~astorjoh/issac11ratrecon.pdf)



---

archive/issue_comments_143776.json:
```json
{
    "body": "<a id='comment:5'></a>Attachment [12051_LLL_QQ.patch](tarball://root/attachments/some-uuid/ticket12051/12051_LLL_QQ.patch) by johanbosman created at 2011-12-22 20:48:37\n\nFor RR there is no perfect way to do this; the inexact nature of floating point arithmetic can make things extremely unpleasant.\n\nAndy suggested the following.   Scale and round the input matrix so that the largest entry has about 300 (or so?) bits.  Then augment it with the identity matrix and perform LLL on the augmented matrix.  The augmented part then contains the basis transformation that has to be performed.  Perform this transformation on the input matrix and repeat the procedure until things do not improve anymore (e.g. when the largest entry doesn't decrease anymore).\n\nThis sounds good as a general idea, but may fail big time in specific cases, for instance if the input L is an orthogonal sum L1 + L2 with L1 generated by very small vectors and L2 consisting of very large vectors.",
    "created_at": "2011-12-22T20:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143776",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

<a id='comment:5'></a>Attachment [12051_LLL_QQ.patch](tarball://root/attachments/some-uuid/ticket12051/12051_LLL_QQ.patch) by johanbosman created at 2011-12-22 20:48:37

For RR there is no perfect way to do this; the inexact nature of floating point arithmetic can make things extremely unpleasant.

Andy suggested the following.   Scale and round the input matrix so that the largest entry has about 300 (or so?) bits.  Then augment it with the identity matrix and perform LLL on the augmented matrix.  The augmented part then contains the basis transformation that has to be performed.  Perform this transformation on the input matrix and repeat the procedure until things do not improve anymore (e.g. when the largest entry doesn't decrease anymore).

This sounds good as a general idea, but may fail big time in specific cases, for instance if the input L is an orthogonal sum L1 + L2 with L1 generated by very small vectors and L2 consisting of very large vectors.



---

archive/issue_comments_143777.json:
```json
{
    "body": "<a id='comment:7'></a>Oops, wrong ticket.",
    "created_at": "2011-12-23T21:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143777",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

<a id='comment:7'></a>Oops, wrong ticket.



---

archive/issue_events_031983.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31983"
}
```



---

archive/issue_events_031984.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31984"
}
```



---

archive/issue_events_031985.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31985"
}
```



---

archive/issue_events_031986.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31986"
}
```



---

archive/issue_events_031987.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31987"
}
```



---

archive/issue_events_031988.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31988"
}
```



---

archive/issue_events_031989.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31989"
}
```



---

archive/issue_comments_143778.json:
```json
{
    "body": "<a id='comment:12'></a>transform the patch into a git branch (and remove trailing whitespaces)\n\n---\nNew commits:",
    "created_at": "2015-03-21T17:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143778",
    "user": "https://github.com/videlec"
}
```

<a id='comment:12'></a>transform the patch into a git branch (and remove trailing whitespaces)

---
New commits:



---

archive/issue_comments_143779.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,10 @@\n-Matrices over `QQ` or `RR` do not have an method `LLL(...)` like matrices over `ZZ`.\n+Matrices over `QQ` do not have a method `LLL(...)` like matrices over `ZZ`. Here is a simple implementation:\n \n-Keywords: LLL, rationals, reals, QQ, RR\n+1. get rid of the denominator\n+2. call the `LLL` method of integer matrices\n+3. set the denominator back.\n+\n+Note: in previous version it was suggested that such an approach might be useful for matrices over `RR`. But it is not completely clear how to do that efficiently.\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-03-22T10:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143779",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,10 @@
-Matrices over `QQ` or `RR` do not have an method `LLL(...)` like matrices over `ZZ`.
+Matrices over `QQ` do not have a method `LLL(...)` like matrices over `ZZ`. Here is a simple implementation:
 
-Keywords: LLL, rationals, reals, QQ, RR
+1. get rid of the denominator
+2. call the `LLL` method of integer matrices
+3. set the denominator back.
+
+Note: in previous version it was suggested that such an approach might be useful for matrices over `RR`. But it is not completely clear how to do that efficiently.
 
 Comment: 1
 
``````




---

archive/issue_comments_143780.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-22T10:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143780",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_143781.json:
```json
{
    "body": "Changing keywords from \"LLL, rationals, reals, QQ, RR\" to \"LLL, rationals, QQ\".",
    "created_at": "2015-03-22T10:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143781",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "LLL, rationals, reals, QQ, RR" to "LLL, rationals, QQ".



---

archive/issue_comments_143782.json:
```json
{
    "body": "<a id='comment:14'></a>Under review.",
    "created_at": "2015-03-22T17:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143782",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>Under review.



---

archive/issue_comments_143783.json:
```json
{
    "body": "<a id='comment:15'></a>Looks good to me, I tried lots of random tests and they work fine.",
    "created_at": "2015-03-22T19:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143783",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:15'></a>Looks good to me, I tried lots of random tests and they work fine.



---

archive/issue_comments_143784.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-03-22T19:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143784",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_143785.json:
```json
{
    "body": "<a id='comment:16'></a>I use this patch for a long time. I had no problem. I am wondering if a similar patch \nworks for BKZ.",
    "created_at": "2015-03-24T14:29:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143785",
    "user": "https://trac.sagemath.org/admin/accounts/users/drazioti"
}
```

<a id='comment:16'></a>I use this patch for a long time. I had no problem. I am wondering if a similar patch 
works for BKZ.



---

archive/issue_comments_143786.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T19:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12051#issuecomment-143786",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_031990.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T19:44:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12051",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12051#event-31990"
}
```
