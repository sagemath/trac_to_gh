# Issue 12121: floor/ceil can be very slow at integral values

archive/issues_011949.json:
```json
{
    "assignees": [
        "https://github.com/aghitza"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nReported (in slightly different form) on [ask.sagemath.org](http://ask.sagemath.org/question/964/lenlist-ceillog42-bugs):\n\n```\nsage: %timeit floor(log(3)/log(2))\n625 loops, best of 3: 586 \u00b5s per loop\nsage: %timeit floor(log(4)/log(2))\n5 loops, best of 3: 3.79 s per loop\n```\n\nThis happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (2 - epsilon, 2 + epsilon) and endpoints have different ceilings.\n\nWith the branch applied `math.floor` and `numpy.floor` are used directly\n\n```\nsage: floor(1.2r)\n1.0\nsage: type(_)\n<type 'float'>\n```\nwhich is distinct from the current Sage behavior\n\n```\nsage: floor(1.2r)\n1\nsage: type(_)\n<type 'sage.rings.integer.Integer'>\n```\n\nCC:  @kcrisman @jdemeyer @pelegm\n\nComponent: **basic arithmetic**\n\nWork Issues: **test failures**\n\nAuthor: **Vincent Delecroix**\n\nBranch/Commit: **[u/mmezzarobba/ticket/12121-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/12121-rebased) @ [`1b1a32a`](https://github.com/sagemath/sagetrac-mirror/commit/1b1a32abd788a451a7004c833f03c7a94f86753f)**\n\nReviewer: **Marc Mezzarobba, Ralf Stephan**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12121_\n\n",
    "created_at": "2011-12-06T15:35:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "floor/ceil can be very slow at integral values",
    "type": "issue",
    "updated_at": "2022-12-29T01:36:35Z",
    "url": "https://github.com/sagemath/sage/issues/12121",
    "user": "https://github.com/sagetrac-dsm"
}
```
<div id="comment:0"></div>

Reported (in slightly different form) on [ask.sagemath.org](http://ask.sagemath.org/question/964/lenlist-ceillog42-bugs):

```
sage: %timeit floor(log(3)/log(2))
625 loops, best of 3: 586 µs per loop
sage: %timeit floor(log(4)/log(2))
5 loops, best of 3: 3.79 s per loop
```

This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (2 - epsilon, 2 + epsilon) and endpoints have different ceilings.

With the branch applied `math.floor` and `numpy.floor` are used directly

```
sage: floor(1.2r)
1.0
sage: type(_)
<type 'float'>
```
which is distinct from the current Sage behavior

```
sage: floor(1.2r)
1
sage: type(_)
<type 'sage.rings.integer.Integer'>
```

CC:  @kcrisman @jdemeyer @pelegm

Component: **basic arithmetic**

Work Issues: **test failures**

Author: **Vincent Delecroix**

Branch/Commit: **[u/mmezzarobba/ticket/12121-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/12121-rebased) @ [`1b1a32a`](https://github.com/sagemath/sagetrac-mirror/commit/1b1a32abd788a451a7004c833f03c7a94f86753f)**

Reviewer: **Marc Mezzarobba, Ralf Stephan**

_Issue created by migration from https://trac.sagemath.org/ticket/12121_





---

archive/issue_events_162783.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2011-12-06T15:35:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162783"
}
```



---

archive/issue_events_162784.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2011-12-06T15:35:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162784"
}
```



---

archive/issue_events_162785.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2011-12-06T15:35:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162785"
}
```



---

archive/issue_events_162786.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2011-12-06T15:35:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162786"
}
```



---

archive/issue_events_162787.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2011-12-06T15:35:19Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "subject": "https://github.com/sagetrac-dsm",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162787"
}
```



---

archive/issue_comments_129653.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n 5 loops, best of 3: 3.79 s per loop\n ```\n \n-This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.\n+This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The RealInterval rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.\n \n One possible solution would be to try\n \n``````\n",
    "created_at": "2011-12-06T15:55:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129653",
    "user": "https://github.com/sagetrac-dsm"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 5 loops, best of 3: 3.79 s per loop
 ```
 
-This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.
+This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The RealInterval rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.
 
 One possible solution would be to try
 
``````




---

archive/issue_comments_129654.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,7 +12,7 @@\n 5 loops, best of 3: 3.79 s per loop\n ```\n \n-This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The RealInterval rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.\n+This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.\n \n One possible solution would be to try\n \n``````\n",
    "created_at": "2011-12-06T15:55:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129654",
    "user": "https://github.com/sagetrac-dsm"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,7 +12,7 @@
 5 loops, best of 3: 3.79 s per loop
 ```
 
-This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The RealInterval rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.
+This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.
 
 One possible solution would be to try
 
``````




---

archive/issue_comments_129655.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNote to self (and others): we can use is_int to decide when we should test for equality.  Test (once) the first time there's only one integer in the interval.  If you have equality there, you're done.  If not, you never will (or won't be able to prove it, anyway) and can carry on.",
    "created_at": "2012-03-03T16:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129655",
    "user": "https://github.com/sagetrac-dsm"
}
```

<div id="comment:3" align="right">comment:3</div>

Note to self (and others): we can use is_int to decide when we should test for equality.  Test (once) the first time there's only one integer in the interval.  If you have equality there, you're done.  If not, you never will (or won't be able to prove it, anyway) and can carry on.



---

archive/issue_comments_129656.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nApparently [is_int is deprecated](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/57910/).",
    "created_at": "2012-06-22T19:10:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129656",
    "user": "https://github.com/kini"
}
```

<div id="comment:4" align="right">comment:4</div>

Apparently [is_int is deprecated](http://thread.gmane.org/gmane.comp.mathematics.sage.devel/57910/).



---

archive/issue_events_162788.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162788"
}
```



---

archive/issue_events_162789.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162789"
}
```



---

archive/issue_events_162790.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162790"
}
```



---

archive/issue_events_162791.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162791"
}
```



---

archive/issue_events_162792.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162792"
}
```



---

archive/issue_events_162793.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162793"
}
```



---

archive/issue_events_162794.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162794"
}
```



---

archive/issue_events_162795.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162795"
}
```



---

archive/issue_comments_129657.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI'm not sure if this should go to this ticket, but the following never returns:\n\n```\nsage: z\n(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1\nsage: floor(z)\n```\nEven `floor(z, maximum_bits=53)` loops infinitely.\nShould I open a separate ticket?",
    "created_at": "2015-07-07T12:22:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129657",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:9" align="right">comment:9</div>

I'm not sure if this should go to this ticket, but the following never returns:

```
sage: z
(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1
sage: floor(z)
```
Even `floor(z, maximum_bits=53)` loops infinitely.
Should I open a separate ticket?



---

archive/issue_comments_129658.json:
```json
{
    "body": "Branch: **[u/ajagekar.akshay/Trac12121](https://github.com/sagemath/sagetrac-mirror/tree/u/ajagekar.akshay/Trac12121)**",
    "created_at": "2016-02-11T20:15:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129658",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

Branch: **[u/ajagekar.akshay/Trac12121](https://github.com/sagemath/sagetrac-mirror/tree/u/ajagekar.akshay/Trac12121)**



---

archive/issue_comments_129659.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b75d32ab5cc279a8566f0bc67acc2501bbb833e\"><code>6b75d32</code></a></td><td><code>Trac #12121: floor/ceil can be very slow at integral values</code></td></tr></table>\n",
    "created_at": "2016-02-11T20:17:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129659",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

<div id="comment:11"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b75d32ab5cc279a8566f0bc67acc2501bbb833e"><code>6b75d32</code></a></td><td><code>Trac #12121: floor/ceil can be very slow at integral values</code></td></tr></table>




---

archive/issue_comments_129660.json:
```json
{
    "body": "Author: **Akshay Ajagekar**",
    "created_at": "2016-02-11T20:17:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129660",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

Author: **Akshay Ajagekar**



---

archive/issue_comments_129661.json:
```json
{
    "body": "Commit: **[`6b75d32`](https://github.com/sagemath/sagetrac-mirror/commit/6b75d32ab5cc279a8566f0bc67acc2501bbb833e)**",
    "created_at": "2016-02-11T20:17:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129661",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

Commit: **[`6b75d32`](https://github.com/sagemath/sagetrac-mirror/commit/6b75d32ab5cc279a8566f0bc67acc2501bbb833e)**



---

archive/issue_events_162796.json:
```json
{
    "actor": "https://github.com/sagetrac-ajagekar-akshay",
    "created_at": "2016-02-11T20:17:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162796"
}
```



---

archive/issue_comments_129662.json:
```json
{
    "body": "Changed commit from **[`6b75d32`](https://github.com/sagemath/sagetrac-mirror/commit/6b75d32ab5cc279a8566f0bc67acc2501bbb833e)** to none",
    "created_at": "2016-02-29T15:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129662",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

Changed commit from **[`6b75d32`](https://github.com/sagemath/sagetrac-mirror/commit/6b75d32ab5cc279a8566f0bc67acc2501bbb833e)** to none



---

archive/issue_comments_129663.json:
```json
{
    "body": "Changed author from **Akshay Ajagekar** to none",
    "created_at": "2016-02-29T15:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129663",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

Changed author from **Akshay Ajagekar** to none



---

archive/issue_comments_129664.json:
```json
{
    "body": "Changed branch from **[u/ajagekar.akshay/Trac12121](https://github.com/sagemath/sagetrac-mirror/tree/u/ajagekar.akshay/Trac12121)** to none",
    "created_at": "2016-02-29T15:18:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129664",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

Changed branch from **[u/ajagekar.akshay/Trac12121](https://github.com/sagemath/sagetrac-mirror/tree/u/ajagekar.akshay/Trac12121)** to none



---

archive/issue_comments_129665.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@zimmermann6](#comment%3A9):\n> I'm not sure if this should go to this ticket, but the following never returns:\n> \n> ```\n> sage: z\n> (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1\n> sage: floor(z)\n> ```\n> Even `floor(z, maximum_bits=53)` loops infinitely.\n\nWhereas the following actually works\n\n```\nsage: bool(z == 1)\nTrue\n```\n\n> Should I open a separate ticket?\n\nI think that \"very slow\" includes \"infinite amount of time\". For me it is worth it to also fix this kind of endless loops in this ticket.",
    "created_at": "2016-03-09T18:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129665",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@zimmermann6](#comment%3A9):
> I'm not sure if this should go to this ticket, but the following never returns:
> 
> ```
> sage: z
> (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 1
> sage: floor(z)
> ```
> Even `floor(z, maximum_bits=53)` loops infinitely.

Whereas the following actually works

```
sage: bool(z == 1)
True
```

> Should I open a separate ticket?

I think that "very slow" includes "infinite amount of time". For me it is worth it to also fix this kind of endless loops in this ticket.



---

archive/issue_events_162797.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-09T18:56:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162797"
}
```



---

archive/issue_events_162798.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-09T18:56:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162798"
}
```



---

archive/issue_events_162799.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-09T18:56:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162799"
}
```



---

archive/issue_events_162800.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-09T18:56:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162800"
}
```



---

archive/issue_comments_129666.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n@sagetrac-ajagekar-akshay: why did you remove your branch? The commit lacks some examples (as the one of [comment:9](#comment%3A9)).",
    "created_at": "2016-03-09T18:56:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129666",
    "user": "https://github.com/videlec"
}
```

<div id="comment:14" align="right">comment:14</div>

@sagetrac-ajagekar-akshay: why did you remove your branch? The commit lacks some examples (as the one of [comment:9](#comment%3A9)).



---

archive/issue_comments_129667.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@videlec](#comment%3A14):\n> @sagetrac-ajagekar-akshay: why did you remove your branch? The commit lacks some examples (as the one of [comment:9](#comment%3A9)).\n\nSorry but I pushed that branch without testing, some tests failed.",
    "created_at": "2016-03-09T19:06:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129667",
    "user": "https://github.com/sagetrac-ajagekar-akshay"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@videlec](#comment%3A14):
> @sagetrac-ajagekar-akshay: why did you remove your branch? The commit lacks some examples (as the one of [comment:9](#comment%3A9)).

Sorry but I pushed that branch without testing, some tests failed.



---

archive/issue_comments_129668.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-ajagekar-akshay](#comment%3A15):\n> Replying to [@videlec](#comment%3A14):\n> > @sagetrac-ajagekar-akshay: why did you remove your branch? The commit lacks some examples (as the one of [comment:9](#comment%3A9)).\n> \n> Sorry but I pushed that branch without testing, some tests failed.\n\nThat is not a problem. Tickets can have different status: `closed`, `positive_review`, `needs_review`, `needs_work`, `new`. If there is no branch associated to a ticket it makes no sense to keep it into \"needs review\" state. (I already changed it to needs_work)",
    "created_at": "2016-03-09T19:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129668",
    "user": "https://github.com/videlec"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-ajagekar-akshay](#comment%3A15):
> Replying to [@videlec](#comment%3A14):
> > @sagetrac-ajagekar-akshay: why did you remove your branch? The commit lacks some examples (as the one of [comment:9](#comment%3A9)).
> 
> Sorry but I pushed that branch without testing, some tests failed.

That is not a problem. Tickets can have different status: `closed`, `positive_review`, `needs_review`, `needs_work`, `new`. If there is no branch associated to a ticket it makes no sense to keep it into "needs review" state. (I already changed it to needs_work)



---

archive/issue_comments_129669.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIndeed, your code was good... and there is a bug somewhere else in the conversion from `SR` to the real interval fields:\n\n```\nsage: RealIntervalField(256)(SR(10^50 + 10^(-50))).is_int()\n(True, 100000000000000000000000000000000000000000000000000)\n```\n\nSorry, I was wrong. The method `is_int` is **not** intended to test if the interval is actually restricted to one integer! It only tests if the interval contains only one integer.",
    "created_at": "2016-03-09T19:14:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129669",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

Indeed, your code was good... and there is a bug somewhere else in the conversion from `SR` to the real interval fields:

```
sage: RealIntervalField(256)(SR(10^50 + 10^(-50))).is_int()
(True, 100000000000000000000000000000000000000000000000000)
```

Sorry, I was wrong. The method `is_int` is **not** intended to test if the interval is actually restricted to one integer! It only tests if the interval contains only one integer.



---

archive/issue_comments_129670.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9821cadaa866f28a0178ce4c75b03dbc82aabd30\"><code>9821cad</code></a></td><td><code>Trac 12121: fix floor/ceil functions</code></td></tr></table>\n",
    "created_at": "2016-03-09T19:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129670",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9821cadaa866f28a0178ce4c75b03dbc82aabd30"><code>9821cad</code></a></td><td><code>Trac 12121: fix floor/ceil functions</code></td></tr></table>




---

archive/issue_comments_129671.json:
```json
{
    "body": "Branch: **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)**",
    "created_at": "2016-03-09T19:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129671",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)**



---

archive/issue_events_162801.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-09T19:46:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162801"
}
```



---

archive/issue_events_162802.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-09T19:46:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162802"
}
```



---

archive/issue_comments_129672.json:
```json
{
    "body": "Commit: **[`9821cad`](https://github.com/sagemath/sagetrac-mirror/commit/9821cadaa866f28a0178ce4c75b03dbc82aabd30)**",
    "created_at": "2016-03-09T19:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129672",
    "user": "https://github.com/videlec"
}
```

Commit: **[`9821cad`](https://github.com/sagemath/sagetrac-mirror/commit/9821cadaa866f28a0178ce4c75b03dbc82aabd30)**



---

archive/issue_comments_129673.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2016-03-09T19:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129673",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_129674.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/800d0ee77a1628f92faaf1b1e159d4aa3f1ed966\"><code>800d0ee</code></a></td><td><code>Trac 12121: fix floor/ceil functions</code></td></tr></table>\n",
    "created_at": "2016-03-09T19:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129674",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/800d0ee77a1628f92faaf1b1e159d4aa3f1ed966"><code>800d0ee</code></a></td><td><code>Trac 12121: fix floor/ceil functions</code></td></tr></table>




---

archive/issue_comments_129675.json:
```json
{
    "body": "Changed commit from **[`9821cad`](https://github.com/sagemath/sagetrac-mirror/commit/9821cadaa866f28a0178ce4c75b03dbc82aabd30)** to **[`800d0ee`](https://github.com/sagemath/sagetrac-mirror/commit/800d0ee77a1628f92faaf1b1e159d4aa3f1ed966)**",
    "created_at": "2016-03-09T19:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129675",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9821cad`](https://github.com/sagemath/sagetrac-mirror/commit/9821cadaa866f28a0178ce4c75b03dbc82aabd30)** to **[`800d0ee`](https://github.com/sagemath/sagetrac-mirror/commit/800d0ee77a1628f92faaf1b1e159d4aa3f1ed966)**



---

archive/issue_comments_129676.json:
```json
{
    "body": "Changed commit from **[`800d0ee`](https://github.com/sagemath/sagetrac-mirror/commit/800d0ee77a1628f92faaf1b1e159d4aa3f1ed966)** to **[`50bdaf3`](https://github.com/sagemath/sagetrac-mirror/commit/50bdaf3b31aecc326045e48524d2aa4d98186549)**",
    "created_at": "2016-03-10T02:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129676",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`800d0ee`](https://github.com/sagemath/sagetrac-mirror/commit/800d0ee77a1628f92faaf1b1e159d4aa3f1ed966)** to **[`50bdaf3`](https://github.com/sagemath/sagetrac-mirror/commit/50bdaf3b31aecc326045e48524d2aa4d98186549)**



---

archive/issue_comments_129677.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50bdaf3b31aecc326045e48524d2aa4d98186549\"><code>50bdaf3</code></a></td><td><code>Trac 12121: work around a bug with symbolics</code></td></tr></table>\n",
    "created_at": "2016-03-10T02:44:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129677",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50bdaf3b31aecc326045e48524d2aa4d98186549"><code>50bdaf3</code></a></td><td><code>Trac 12121: work around a bug with symbolics</code></td></tr></table>




---

archive/issue_comments_129678.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI pushed a tiny fix because we currently have\n\n```\nsage: log(8) / log(2) == 3\nFalse\n```\nSee the discussion at [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/xAlQmUF_cdU).",
    "created_at": "2016-03-10T02:45:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129678",
    "user": "https://github.com/videlec"
}
```

<div id="comment:21" align="right">comment:21</div>

I pushed a tiny fix because we currently have

```
sage: log(8) / log(2) == 3
False
```
See the discussion at [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/xAlQmUF_cdU).



---

archive/issue_comments_129679.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n#15786 is a partial duplicate. I find the fix posted there a bit cleaner, though it needs to be rebased.",
    "created_at": "2016-03-24T14:35:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129679",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:22" align="right">comment:22</div>

#15786 is a partial duplicate. I find the fix posted there a bit cleaner, though it needs to be rebased.



---

archive/issue_comments_129680.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nRebased on what!?\n\nThere is one thing I am not happy with. I think we should try to make the interval much smaller than 1 in\n\n```\nwhile x_interval.absolute_diameter() >= 1:\n    bits *= 2\n    x_interval = RealIntervalField(bits)(x)\n```\nbefore trying to simplify the expression. I guess that 2<sup>-30</sup> would be much more reasonable and avoid many attempts of (costly) simplification. What do you think?",
    "created_at": "2016-03-24T14:41:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129680",
    "user": "https://github.com/videlec"
}
```

<div id="comment:23" align="right">comment:23</div>

Rebased on what!?

There is one thing I am not happy with. I think we should try to make the interval much smaller than 1 in

```
while x_interval.absolute_diameter() >= 1:
    bits *= 2
    x_interval = RealIntervalField(bits)(x)
```
before trying to simplify the expression. I guess that 2<sup>-30</sup> would be much more reasonable and avoid many attempts of (costly) simplification. What do you think?



---

archive/issue_comments_129681.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nSorry if I wasn't clear. I'm saying that the *other* branch (the one at #15786) should be rebased.",
    "created_at": "2016-03-24T14:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129681",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:24" align="right">comment:24</div>

Sorry if I wasn't clear. I'm saying that the *other* branch (the one at #15786) should be rebased.



---

archive/issue_comments_129682.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nBe aware you might be using symbolics when doing bool( == ). To not end up with surprises you might want to break out the actual functionality you need out of `Expression.__nonzero__` or review #16397 and use `cmp`.",
    "created_at": "2016-03-24T14:59:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129682",
    "user": "https://github.com/rwst"
}
```

<div id="comment:25" align="right">comment:25</div>

Be aware you might be using symbolics when doing bool( == ). To not end up with surprises you might want to break out the actual functionality you need out of `Expression.__nonzero__` or review #16397 and use `cmp`.



---

archive/issue_comments_129683.json:
```json
{
    "body": "Changed commit from **[`50bdaf3`](https://github.com/sagemath/sagetrac-mirror/commit/50bdaf3b31aecc326045e48524d2aa4d98186549)** to **[`688ebfa`](https://github.com/sagemath/sagetrac-mirror/commit/688ebfa077f09ee9a2bc988833ddd4f0fc65a4a1)**",
    "created_at": "2016-03-24T15:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129683",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`50bdaf3`](https://github.com/sagemath/sagetrac-mirror/commit/50bdaf3b31aecc326045e48524d2aa4d98186549)** to **[`688ebfa`](https://github.com/sagemath/sagetrac-mirror/commit/688ebfa077f09ee9a2bc988833ddd4f0fc65a4a1)**



---

archive/issue_comments_129684.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/688ebfa077f09ee9a2bc988833ddd4f0fc65a4a1\"><code>688ebfa</code></a></td><td><code>Trac 12121: code improvements</code></td></tr></table>\n",
    "created_at": "2016-03-24T15:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129684",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/688ebfa077f09ee9a2bc988833ddd4f0fc65a4a1"><code>688ebfa</code></a></td><td><code>Trac 12121: code improvements</code></td></tr></table>




---

archive/issue_comments_129685.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@rwst](#comment%3A25):\n> Be aware you might be using symbolics when doing bool( == ). To not end up with surprises you might want to break out the actual functionality you need out of `Expression.__nonzero__` or review #16397 and use `cmp`.\n\nYou mean that there is no way to check that `expr1 == expr2`? I do not want to copy/paste anything from other place. If testing equality is not available, there is a big problem.\n\nUsing `cmp` for that purpose is a bad idea. The purpose of `cmp` in Python 2 is to sort things out. Not to compare.",
    "created_at": "2016-03-24T15:55:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129685",
    "user": "https://github.com/videlec"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@rwst](#comment%3A25):
> Be aware you might be using symbolics when doing bool( == ). To not end up with surprises you might want to break out the actual functionality you need out of `Expression.__nonzero__` or review #16397 and use `cmp`.

You mean that there is no way to check that `expr1 == expr2`? I do not want to copy/paste anything from other place. If testing equality is not available, there is a big problem.

Using `cmp` for that purpose is a bad idea. The purpose of `cmp` in Python 2 is to sort things out. Not to compare.



---

archive/issue_comments_129686.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nTesting equality of symbolics in general is undecidable. If you remove all expressions with variables however, it is easy: convert symbolic constants and function expressions to float as in `N()`, compare. Of course there are precision problems but that's nothing in comparison to what you get with variables.\n\nThe idea to abuse `cmp` is not mine. Somewhere here `RLF(1) < RLF(sqrt(2))` for example, symbolic `cmp` is called. Should I file a bug report for such usage?\n\nEDIT: typos",
    "created_at": "2016-03-24T16:11:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129686",
    "user": "https://github.com/rwst"
}
```

<div id="comment:28" align="right">comment:28</div>

Testing equality of symbolics in general is undecidable. If you remove all expressions with variables however, it is easy: convert symbolic constants and function expressions to float as in `N()`, compare. Of course there are precision problems but that's nothing in comparison to what you get with variables.

The idea to abuse `cmp` is not mine. Somewhere here `RLF(1) < RLF(sqrt(2))` for example, symbolic `cmp` is called. Should I file a bug report for such usage?

EDIT: typos



---

archive/issue_comments_129687.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@rwst](#comment%3A28):\n> Testing equality of symbolics in general is undecidable. If you remove all expressions with variables however, it is easy\n\nIt is unknown if it is decidable (afaik) even without variables.\n\n> The idea to abuse `cmp` is not mine. Somewhere here `RLF(1) < RLF(sqrt(2))` for example, symbolic `cmp` is called. Should I file a bug report for such usage?\n\nI'd say it probably is a bug. As to whether you should file a bug report, I don't know\u2014I doubt anyone really reads them, and the issue is probably already covered somewhere in the myriad of known bugs with comparisons...",
    "created_at": "2016-03-24T16:19:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129687",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@rwst](#comment%3A28):
> Testing equality of symbolics in general is undecidable. If you remove all expressions with variables however, it is easy

It is unknown if it is decidable (afaik) even without variables.

> The idea to abuse `cmp` is not mine. Somewhere here `RLF(1) < RLF(sqrt(2))` for example, symbolic `cmp` is called. Should I file a bug report for such usage?

I'd say it probably is a bug. As to whether you should file a bug report, I don't know—I doubt anyone really reads them, and the issue is probably already covered somewhere in the myriad of known bugs with comparisons...



---

archive/issue_comments_129688.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@rwst](#comment%3A28):\n> Testing equality of symbolics in general is undecidable. If you remove all expressions with variables however, it is easy: convert symbolic constants and function expressions to float as in `N()`, compare. Of course there are precision problems but that's nothing in comparison to what you get with variables.\n\nWhat I need is a method that either returns a reliable answer `True` or `False` or raise an error which can either be `This comparison is meaningless` or `I don't know how to compare this`.",
    "created_at": "2016-03-24T16:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129688",
    "user": "https://github.com/videlec"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@rwst](#comment%3A28):
> Testing equality of symbolics in general is undecidable. If you remove all expressions with variables however, it is easy: convert symbolic constants and function expressions to float as in `N()`, compare. Of course there are precision problems but that's nothing in comparison to what you get with variables.

What I need is a method that either returns a reliable answer `True` or `False` or raise an error which can either be `This comparison is meaningless` or `I don't know how to compare this`.



---

archive/issue_comments_129689.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@videlec](#comment%3A30):\n> What I need is a method that either returns a reliable answer `True` or `False` or raise an error which can either be `This comparison is meaningless` or `I don't know how to compare this`.\n\nThen `bool( == )` is right for the moment and may be replaced with #19040. As said don't be surprised if it takes a long time.",
    "created_at": "2016-03-24T16:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129689",
    "user": "https://github.com/rwst"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@videlec](#comment%3A30):
> What I need is a method that either returns a reliable answer `True` or `False` or raise an error which can either be `This comparison is meaningless` or `I don't know how to compare this`.

Then `bool( == )` is right for the moment and may be replaced with #19040. As said don't be surprised if it takes a long time.



---

archive/issue_comments_129690.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5ef94a5b27b302d813ac83538558b39a39c7267\"><code>a5ef94a</code></a></td><td><code>Trac 12121: note about #19040 + extra if</code></td></tr></table>\n",
    "created_at": "2016-03-24T18:20:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129690",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5ef94a5b27b302d813ac83538558b39a39c7267"><code>a5ef94a</code></a></td><td><code>Trac 12121: note about #19040 + extra if</code></td></tr></table>




---

archive/issue_comments_129691.json:
```json
{
    "body": "Changed commit from **[`688ebfa`](https://github.com/sagemath/sagetrac-mirror/commit/688ebfa077f09ee9a2bc988833ddd4f0fc65a4a1)** to **[`a5ef94a`](https://github.com/sagemath/sagetrac-mirror/commit/a5ef94a5b27b302d813ac83538558b39a39c7267)**",
    "created_at": "2016-03-24T18:20:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129691",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`688ebfa`](https://github.com/sagemath/sagetrac-mirror/commit/688ebfa077f09ee9a2bc988833ddd4f0fc65a4a1)** to **[`a5ef94a`](https://github.com/sagemath/sagetrac-mirror/commit/a5ef94a5b27b302d813ac83538558b39a39c7267)**



---

archive/issue_comments_129692.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@rwst](#comment%3A31):\n> Replying to [@videlec](#comment%3A30):\n> > What I need is a method that either returns a reliable answer `True` or `False` or raise an error which can either be `This comparison is meaningless` or `I don't know how to compare this`.\n> \n> Then `bool( == )` is right for the moment and may be replaced with #19040. As said don't be surprised if it takes a long time.\n\nI added a note about #19040.",
    "created_at": "2016-03-24T18:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129692",
    "user": "https://github.com/videlec"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@rwst](#comment%3A31):
> Replying to [@videlec](#comment%3A30):
> > What I need is a method that either returns a reliable answer `True` or `False` or raise an error which can either be `This comparison is meaningless` or `I don't know how to compare this`.
> 
> Then `bool( == )` is right for the moment and may be replaced with #19040. As said don't be surprised if it takes a long time.

I added a note about #19040.



---

archive/issue_comments_129693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,28 +1,15 @@\n Reported (in slightly different form) on [ask.sagemath.org](http://ask.sagemath.org/question/964/lenlist-ceillog42-bugs):\n-\n \n ```\n sage: %timeit floor(log(3)/log(2))\n 625 loops, best of 3: 586 \u00b5s per loop\n sage: %timeit floor(log(4)/log(2))\n 5 loops, best of 3: 3.79 s per loop\n-sage: %timeit ceil(log(3)/log(2))\n-625 loops, best of 3: 586 \u00b5s per loop\n-sage: %timeit ceil(log(4)/log(2))\n-5 loops, best of 3: 3.79 s per loop\n ```\n \n-This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.\n+This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (2 - epsilon, 2 + epsilon) and endpoints have different ceilings.\n \n-One possible solution would be to try\n-\n-```\n-sage: %timeit bool(log(4)/log(2) == round(log(4)/log(2)))\n-125 loops, best of 3: 5.57 ms per loop\n-```\n-\n-after some number (maybe even 1?) of `RealInterval` attempts, and then get back to increasing the precision.  Trying to think of use cases, ceil and floor are probably called 95%+ of the time on things which only require a round or two at most to determine the answer, so it makes sense to optimize that end. \n-\n-As well, the \"+100 bits\" approach (rather than going up by some factor each time, say) probably penalizes numbers requiring lots of bits too much relative to those requiring only a few, but the integer case is probably more important.\n-\n-\n+The proposal is to:\n+- first found an interval of reasonably small diameter (arbitrarily set to 2<sup>-30</sup>) and see whether this is enough to decide the ceiling\n+- then check equality with the only available candidate (possibly doing some simplification)\n+- start further refinement of the interval\n``````\n",
    "created_at": "2016-03-24T18:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129693",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,28 +1,15 @@
 Reported (in slightly different form) on [ask.sagemath.org](http://ask.sagemath.org/question/964/lenlist-ceillog42-bugs):
-
 
 ```
 sage: %timeit floor(log(3)/log(2))
 625 loops, best of 3: 586 µs per loop
 sage: %timeit floor(log(4)/log(2))
 5 loops, best of 3: 3.79 s per loop
-sage: %timeit ceil(log(3)/log(2))
-625 loops, best of 3: 586 µs per loop
-sage: %timeit ceil(log(4)/log(2))
-5 loops, best of 3: 3.79 s per loop
 ```
 
-This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (1.99999, 2.0000), and endpoints have different ceilings.
+This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (2 - epsilon, 2 + epsilon) and endpoints have different ceilings.
 
-One possible solution would be to try
-
-```
-sage: %timeit bool(log(4)/log(2) == round(log(4)/log(2)))
-125 loops, best of 3: 5.57 ms per loop
-```
-
-after some number (maybe even 1?) of `RealInterval` attempts, and then get back to increasing the precision.  Trying to think of use cases, ceil and floor are probably called 95%+ of the time on things which only require a round or two at most to determine the answer, so it makes sense to optimize that end. 
-
-As well, the "+100 bits" approach (rather than going up by some factor each time, say) probably penalizes numbers requiring lots of bits too much relative to those requiring only a few, but the integer case is probably more important.
-
-
+The proposal is to:
+- first found an interval of reasonably small diameter (arbitrarily set to 2<sup>-30</sup>) and see whether this is enough to decide the ceiling
+- then check equality with the only available candidate (possibly doing some simplification)
+- start further refinement of the interval
``````




---

archive/issue_events_162803.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-24T18:36:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-7.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162803"
}
```



---

archive/issue_events_162804.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-03-24T18:36:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162804"
}
```



---

archive/issue_comments_129694.json:
```json
{
    "body": "Reviewer: **Marc Mezzarobba**",
    "created_at": "2016-03-25T15:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129694",
    "user": "https://github.com/mezzarobba"
}
```

Reviewer: **Marc Mezzarobba**



---

archive/issue_comments_129695.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nHi Vincent,\n\nSorry for my unclear comments above, I didn't look closely enough at your code before posting them.\n\nBeside the issue with comparisons raised by Ralf, I find the code on your branch a bit complicated, and I don't like the fact that you drop the `maximum_bits` parameters at the risk of looping forever if you cannot prove that the input is an integer. I pushed to `u/mmezzarobba/12121-ceil` a rough attempt to fix these issues (in the case of `ceil` only at the moment, and not well tested yet), please tell me what you think of it.",
    "created_at": "2016-03-25T15:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129695",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:35" align="right">comment:35</div>

Hi Vincent,

Sorry for my unclear comments above, I didn't look closely enough at your code before posting them.

Beside the issue with comparisons raised by Ralf, I find the code on your branch a bit complicated, and I don't like the fact that you drop the `maximum_bits` parameters at the risk of looping forever if you cannot prove that the input is an integer. I pushed to `u/mmezzarobba/12121-ceil` a rough attempt to fix these issues (in the case of `ceil` only at the moment, and not well tested yet), please tell me what you think of it.



---

archive/issue_events_162805.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-03-25T15:59:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162805"
}
```



---

archive/issue_events_162806.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-03-25T15:59:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162806"
}
```



---

archive/issue_comments_129696.json:
```json
{
    "body": "Changed commit from **[`a5ef94a`](https://github.com/sagemath/sagetrac-mirror/commit/a5ef94a5b27b302d813ac83538558b39a39c7267)** to **[`60f0c29`](https://github.com/sagemath/sagetrac-mirror/commit/60f0c291adf28344156661ea7623c5721ed4a06b)**",
    "created_at": "2016-04-05T21:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129696",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a5ef94a`](https://github.com/sagemath/sagetrac-mirror/commit/a5ef94a5b27b302d813ac83538558b39a39c7267)** to **[`60f0c29`](https://github.com/sagemath/sagetrac-mirror/commit/60f0c291adf28344156661ea7623c5721ed4a06b)**



---

archive/issue_comments_129697.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60f0c291adf28344156661ea7623c5721ed4a06b\"><code>60f0c29</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr></table>\n",
    "created_at": "2016-04-05T21:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129697",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60f0c291adf28344156661ea7623c5721ed4a06b"><code>60f0c29</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr></table>




---

archive/issue_comments_129698.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nAll right. I factorized the two implementations in a new function `incremental_rounding`. It is cleaner and the parameter `maximum_bits` is reintroduced.",
    "created_at": "2016-04-05T21:12:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129698",
    "user": "https://github.com/videlec"
}
```

<div id="comment:37" align="right">comment:37</div>

All right. I factorized the two implementations in a new function `incremental_rounding`. It is cleaner and the parameter `maximum_bits` is reintroduced.



---

archive/issue_events_162807.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-05T21:12:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162807"
}
```



---

archive/issue_events_162808.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-04-05T21:12:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162808"
}
```



---

archive/issue_comments_129699.json:
```json
{
    "body": "Changed commit from **[`60f0c29`](https://github.com/sagemath/sagetrac-mirror/commit/60f0c291adf28344156661ea7623c5721ed4a06b)** to **[`d53c406`](https://github.com/sagemath/sagetrac-mirror/commit/d53c406171d73a0138d25336732728b41409c8b9)**",
    "created_at": "2016-04-06T01:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129699",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`60f0c29`](https://github.com/sagemath/sagetrac-mirror/commit/60f0c291adf28344156661ea7623c5721ed4a06b)** to **[`d53c406`](https://github.com/sagemath/sagetrac-mirror/commit/d53c406171d73a0138d25336732728b41409c8b9)**



---

archive/issue_comments_129700.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d53c406171d73a0138d25336732728b41409c8b9\"><code>d53c406</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr></table>\n",
    "created_at": "2016-04-06T01:57:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129700",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d53c406171d73a0138d25336732728b41409c8b9"><code>d53c406</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr></table>




---

archive/issue_comments_129701.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI fear I won't have time to review your new version in the next few days at least, but from a quick look at it there are a lot of things I don't understand. In no particular order:\n* why do you make `maximum_bits` an `Integer`?\n* what don't you like about `unique_integer()`?\n* is it really better to have an absolute bound for the diameter that makes us suspect we found an exact integer, rather than something that depends on the precision?\n* why do you insist on using `==` on symbolic expressions instead of `is_trivial_zero()`?\n* are you sure you want to raise an error when `maximum_bits` does not suffice to conclude? this is a symbolic function that may be buried deep in the middle of a symbolic expression; returning unevaluated seems more reasonable to me...\n* do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?",
    "created_at": "2016-04-06T08:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129701",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:39" align="right">comment:39</div>

I fear I won't have time to review your new version in the next few days at least, but from a quick look at it there are a lot of things I don't understand. In no particular order:
* why do you make `maximum_bits` an `Integer`?
* what don't you like about `unique_integer()`?
* is it really better to have an absolute bound for the diameter that makes us suspect we found an exact integer, rather than something that depends on the precision?
* why do you insist on using `==` on symbolic expressions instead of `is_trivial_zero()`?
* are you sure you want to raise an error when `maximum_bits` does not suffice to conclude? this is a symbolic function that may be buried deep in the middle of a symbolic expression; returning unevaluated seems more reasonable to me...
* do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?



---

archive/issue_comments_129702.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e9b2f21d6a6bc42e35302316ac0f6b3b7451450\"><code>0e9b2f2</code></a></td><td><code>Trac 12121: remove `__call__` and fix round</code></td></tr></table>\n",
    "created_at": "2016-04-06T17:17:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129702",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e9b2f21d6a6bc42e35302316ac0f6b3b7451450"><code>0e9b2f2</code></a></td><td><code>Trac 12121: remove `__call__` and fix round</code></td></tr></table>




---

archive/issue_comments_129703.json:
```json
{
    "body": "Changed commit from **[`d53c406`](https://github.com/sagemath/sagetrac-mirror/commit/d53c406171d73a0138d25336732728b41409c8b9)** to **[`0e9b2f2`](https://github.com/sagemath/sagetrac-mirror/commit/0e9b2f21d6a6bc42e35302316ac0f6b3b7451450)**",
    "created_at": "2016-04-06T17:17:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129703",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d53c406`](https://github.com/sagemath/sagetrac-mirror/commit/d53c406171d73a0138d25336732728b41409c8b9)** to **[`0e9b2f2`](https://github.com/sagemath/sagetrac-mirror/commit/0e9b2f21d6a6bc42e35302316ac0f6b3b7451450)**



---

archive/issue_comments_129704.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI removed the `__call__` in both `Function_floor` and `Function_ceil`. The code is now much simpler. Though there was some adaptation needed in `symbolic/expression.pyx`.\n\nReplying to [@mezzarobba](#comment%3A39):\n> I fear I won't have time to review your new version in the next few days at least, but from a quick look at it there are a lot of things I don't understand. In no particular order:\n> * why do you make `maximum_bits` an `Integer`?\n\nall right. `int` is fine as well.\n\n> * what don't you like about `unique_integer()`?\n\nan `assert` does not cost anything. And `unique_integer` silently fails if the interval does not enclose a unique integer.\n\n> * is it really better to have an absolute bound for the diameter that makes us suspect we found an exact integer, rather than something that depends on the precision?\n\nthe precision of what? there is the field used for the evaluation which is different from the diameter of the interval. If you have more than one integer in your interval which one are you using to test equality?\n\n> * why do you insist on using `==` on symbolic expressions instead of `is_trivial_zero()`?\n\nBecause I want to check equality with an integer. Not if it is a trivial equality.\n\n> * are you sure you want to raise an error when `maximum_bits` does not suffice to conclude? this is a symbolic function that may be buried deep in the middle of a symbolic expression; returning unevaluated seems more reasonable to me...\n\nDone with an example.\n\n> * do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?\n\nThe equality test is potentially costly. And we want to avoid it as much as possible. In particular, it makes no sense to test this equality within each step of the loop as it is in your version. On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`.",
    "created_at": "2016-04-06T17:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129704",
    "user": "https://github.com/videlec"
}
```

<div id="comment:41" align="right">comment:41</div>

I removed the `__call__` in both `Function_floor` and `Function_ceil`. The code is now much simpler. Though there was some adaptation needed in `symbolic/expression.pyx`.

Replying to [@mezzarobba](#comment%3A39):
> I fear I won't have time to review your new version in the next few days at least, but from a quick look at it there are a lot of things I don't understand. In no particular order:
> * why do you make `maximum_bits` an `Integer`?

all right. `int` is fine as well.

> * what don't you like about `unique_integer()`?

an `assert` does not cost anything. And `unique_integer` silently fails if the interval does not enclose a unique integer.

> * is it really better to have an absolute bound for the diameter that makes us suspect we found an exact integer, rather than something that depends on the precision?

the precision of what? there is the field used for the evaluation which is different from the diameter of the interval. If you have more than one integer in your interval which one are you using to test equality?

> * why do you insist on using `==` on symbolic expressions instead of `is_trivial_zero()`?

Because I want to check equality with an integer. Not if it is a trivial equality.

> * are you sure you want to raise an error when `maximum_bits` does not suffice to conclude? this is a symbolic function that may be buried deep in the middle of a symbolic expression; returning unevaluated seems more reasonable to me...

Done with an example.

> * do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?

The equality test is potentially costly. And we want to avoid it as much as possible. In particular, it makes no sense to test this equality within each step of the loop as it is in your version. On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`.



---

archive/issue_comments_129705.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@videlec](#comment%3A41):\n> Replying to [@mezzarobba](#comment%3A39):\n> > * do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?\n> \n> \n> The equality test is potentially costly. And we want to avoid it as much as possible. In particular, it makes no sense to test this equality within each step of the loop as it is in your version. On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`. \n\nAnd I also would like to use the very same function `incremental_rounding` for elements of `QQbar`. For the very same reason, you only want very lately the equality test.",
    "created_at": "2016-04-06T19:06:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129705",
    "user": "https://github.com/videlec"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@videlec](#comment%3A41):
> Replying to [@mezzarobba](#comment%3A39):
> > * do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?
> 
> 
> The equality test is potentially costly. And we want to avoid it as much as possible. In particular, it makes no sense to test this equality within each step of the loop as it is in your version. On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`. 

And I also would like to use the very same function `incremental_rounding` for elements of `QQbar`. For the very same reason, you only want very lately the equality test.



---

archive/issue_comments_129706.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/313c497daaec6324dfe4ffdeb684844e301a3f61\"><code>313c497</code></a></td><td><code>Trac 12121: fix doctests</code></td></tr></table>\n",
    "created_at": "2016-04-06T19:31:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129706",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/313c497daaec6324dfe4ffdeb684844e301a3f61"><code>313c497</code></a></td><td><code>Trac 12121: fix doctests</code></td></tr></table>




---

archive/issue_comments_129707.json:
```json
{
    "body": "Changed commit from **[`0e9b2f2`](https://github.com/sagemath/sagetrac-mirror/commit/0e9b2f21d6a6bc42e35302316ac0f6b3b7451450)** to **[`313c497`](https://github.com/sagemath/sagetrac-mirror/commit/313c497daaec6324dfe4ffdeb684844e301a3f61)**",
    "created_at": "2016-04-06T19:31:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129707",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0e9b2f2`](https://github.com/sagemath/sagetrac-mirror/commit/0e9b2f21d6a6bc42e35302316ac0f6b3b7451450)** to **[`313c497`](https://github.com/sagemath/sagetrac-mirror/commit/313c497daaec6324dfe4ffdeb684844e301a3f61)**



---

archive/issue_comments_129708.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,20 @@\n - first found an interval of reasonably small diameter (arbitrarily set to 2<sup>-30</sup>) and see whether this is enough to decide the ceiling\n - then check equality with the only available candidate (possibly doing some simplification)\n - start further refinement of the interval\n+\n+With the branch applied `math.floor` and `numpy.floor` are used directly\n+\n+```\n+sage: floor(1.2r)\n+1.0\n+sage: type(_)\n+<type 'float'>\n+```\n+which is distinct from the current Sage behavior\n+\n+```\n+sage: floor(1.2r)\n+1\n+sage: type(_)\n+<type 'sage.rings.integer.Integer'>\n+```\n``````\n",
    "created_at": "2016-04-06T19:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129708",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,20 @@
 - first found an interval of reasonably small diameter (arbitrarily set to 2<sup>-30</sup>) and see whether this is enough to decide the ceiling
 - then check equality with the only available candidate (possibly doing some simplification)
 - start further refinement of the interval
+
+With the branch applied `math.floor` and `numpy.floor` are used directly
+
+```
+sage: floor(1.2r)
+1.0
+sage: type(_)
+<type 'float'>
+```
+which is distinct from the current Sage behavior
+
+```
+sage: floor(1.2r)
+1
+sage: type(_)
+<type 'sage.rings.integer.Integer'>
+```
``````




---

archive/issue_comments_129709.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nping?!",
    "created_at": "2016-04-28T22:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129709",
    "user": "https://github.com/videlec"
}
```

<div id="comment:45" align="right">comment:45</div>

ping?!



---

archive/issue_comments_129710.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nSorry, I have about zero time for Sage development before at least 1-2 weeks. All I can say is that I wasn't completely convinced by your answers and would need to think things over more carefully. If someone wants to review the ticket in the meantime, please do.",
    "created_at": "2016-04-29T11:27:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129710",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:46" align="right">comment:46</div>

Sorry, I have about zero time for Sage development before at least 1-2 weeks. All I can say is that I wasn't completely convinced by your answers and would need to think things over more carefully. If someone wants to review the ticket in the meantime, please do.



---

archive/issue_comments_129711.json:
```json
{
    "body": "Changed commit from **[`313c497`](https://github.com/sagemath/sagetrac-mirror/commit/313c497daaec6324dfe4ffdeb684844e301a3f61)** to **[`602e515`](https://github.com/sagemath/sagetrac-mirror/commit/602e5158c5f37c6900a1dee8e27a228114af1319)**",
    "created_at": "2016-05-08T02:45:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129711",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`313c497`](https://github.com/sagemath/sagetrac-mirror/commit/313c497daaec6324dfe4ffdeb684844e301a3f61)** to **[`602e515`](https://github.com/sagemath/sagetrac-mirror/commit/602e5158c5f37c6900a1dee8e27a228114af1319)**



---

archive/issue_comments_129712.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9bfef80cf0a665960772a74505f9c9158db84163\"><code>9bfef80</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8abe9c9f1c3d9c47f0468ee355cf6bd14643ebe\"><code>c8abe9c</code></a></td><td><code>Trac 12121: remove `__call__` and fix round</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/602e5158c5f37c6900a1dee8e27a228114af1319\"><code>602e515</code></a></td><td><code>Trac 12121: fix doctests</code></td></tr></table>\n",
    "created_at": "2016-05-08T02:45:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129712",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9bfef80cf0a665960772a74505f9c9158db84163"><code>9bfef80</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8abe9c9f1c3d9c47f0468ee355cf6bd14643ebe"><code>c8abe9c</code></a></td><td><code>Trac 12121: remove `__call__` and fix round</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/602e5158c5f37c6900a1dee8e27a228114af1319"><code>602e515</code></a></td><td><code>Trac 12121: fix doctests</code></td></tr></table>




---

archive/issue_comments_129713.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nrebased on 7-2.rc1",
    "created_at": "2016-05-08T02:45:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129713",
    "user": "https://github.com/videlec"
}
```

<div id="comment:48" align="right">comment:48</div>

rebased on 7-2.rc1



---

archive/issue_comments_129714.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nOkay, I'm back. Sorry that it took so long.\n\nReplying to [@videlec](#comment%3A41):\n> > * what don't you like about `unique_integer()`?\n> \n> \n> an `assert` does not cost anything. And `unique_integer` silently fails if the interval does not enclose a unique integer.\n\nUh? No, it doesn't.\n\n> > * is it really better to have an absolute bound for the diameter that makes us suspect we found an exact integer, rather than something that depends on the precision?\n> \n> \n> the precision of what? there is the field used for the evaluation which is different from the diameter of the interval. If you have more than one integer in your interval which one are you using to test equality?\n\nThe precision of the interval computation, i.e. `bits`. The idea being that if we found an interval of width (say) 2\u207b\u00b2\u2070 containing an integer by computing with 1000 bits of precision, we may want to see if the width of the interval keeps decreasing when the precision increases and only run the symbolic part of the algorithm if that's the case. But I agree that this is a very minor issue at best.\n\n> > * why do you insist on using `==` on symbolic expressions instead of `is_trivial_zero()`?\n> \n> \n> Because I want to check equality with an integer. Not if it is a trivial equality.\n\nI mean using `is_trivial_zero()` after calling `full_simplify()` & co, as in my version: this is safer than relying on `==` and essentially as powerful.\n\n> > * do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?\n> \n> \n> The equality test is potentially costly. And we want to avoid it as much as possible. In particular, it makes no sense to test this equality within each step of the loop as it is in your version.\n\nYes\u2014as I said, my version was just a rough sketch of the changes I'd b tempted to make, nothing finished. As the code I was starting with used to loop forever in the typical situation where mine would do the symbolic test repeatedly (that is, `x` \u2208 \u2124 integer but we don't manage to prove it), I thought the additional cost would be acceptable. `;-)` But anyway, it is not hard to do the test only once while avoiding the code duplication.\n\n> On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`. \n\nCouldn't you just compute ceil(x-1/2)?\n\n---\n\nNow for some comments on the current code:\n\n* To summarize the above, I still think the main logic in `incremental_rounding()` could be shortened to something like (not tested):\n\n```\n    unique_rounding = getattr(RealIntervalFieldElement, 'unique_' + mode)\n    r = RR.one() >> 20\n\n    bits = 64\n    candidate = None\n    while bits < maximum_bits:\n        interval = RealIntervalField(bits)(x) # may raise a TypeError\n        try:\n            return unique_rounding(interval)\n        except ValueError:\n            pass\n        if candidate is None and interval.absolute_diameter() > r:\n            candidate = interval.unique_integer()\n            try:\n                delta = x - candidate\n                if (delta.is_zero()\n                        or SR(delta).full_simplify().canonicalize_radical()\n                                    .is_trivial_zero()\n                        or QQbar(delta).is_zero()):\n                    return candidate\n                except (TypeError, ValueError):\n                    pass\n        bits *= 2\n```\n\n* I'd also make `incremental_rounding()` private and dispense with the argument checking (and perhaps move it to `real_mpfi` if your plan is to use it from elsewhere)\u2014but I'm okay with keeping it as it is. An advantage of making it private is that you could take the \u201cunique rounding\u201d function on intervals as input instead of accessing it via `getattr()`. Another option would be to introduce a common base class for `Function_floor`, `Function_ceil` and `Function_round`.\n\n* I'm a little uneasy about the changes you made to `BuiltinFunction.__call__()`. The fact that it used to convert non-Element inputs to Elements looks intentional and pretty reasonable to me. Is it really necessary to change that behavior? That being said, I'm a bit lost in the maze of `Function.__call__`, `BuiltinFunction.__call__`, `_eval_`, `_evalf_`, `_evalf_try_` and friends, so if you tell me you are confident that the change is correct I'll trust you!\n\n* If these changes stay, then I guess this\n\n```\nif module is not None:\n    func = getattr(module, self._name, None)\n    if func is None and self._alt_name is not None:\n        func = getattr(module, self._name, None)\n                                    ^^^^^\n```\n  should be `_alt_name`.\n\n* Note that these changes also make\n\n```\nsage: sin(numpy.int32(0))\n0.0\n```\n  which is at odds with\n\n```\nsage: sin(ZZ(0)).parent()\nInteger Ring\n```\n  (perhaps not ideal, but predictable at least).\n\n* In `Function_*`, what is the point of calling `_evalf_()` from `_eval_()`?\n\n* And why isn't the logic for choosing `maximum_bits` in `_evalf_()` the same in `floor`, `ceil` and `round`?\n\n* I wouldn't bother with checking that `x` is not a relation. First, `_eval_()` methods of individual functions are probably not the right place for that (either `BuiltinFunction.__call__()` or perhaps methods `ceil()`, `floor()` etc. in a future subclass `RelationalExpression` of `Expression` would be more reasonable). Besides, various other nonsensical inputs (e.g. series, booleans) are accepted without error, so it is a bit strange to have an ad hoc check dealing with this one.",
    "created_at": "2016-05-17T13:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129714",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:49" align="right">comment:49</div>

Okay, I'm back. Sorry that it took so long.

Replying to [@videlec](#comment%3A41):
> > * what don't you like about `unique_integer()`?
> 
> 
> an `assert` does not cost anything. And `unique_integer` silently fails if the interval does not enclose a unique integer.

Uh? No, it doesn't.

> > * is it really better to have an absolute bound for the diameter that makes us suspect we found an exact integer, rather than something that depends on the precision?
> 
> 
> the precision of what? there is the field used for the evaluation which is different from the diameter of the interval. If you have more than one integer in your interval which one are you using to test equality?

The precision of the interval computation, i.e. `bits`. The idea being that if we found an interval of width (say) 2⁻²⁰ containing an integer by computing with 1000 bits of precision, we may want to see if the width of the interval keeps decreasing when the precision increases and only run the symbolic part of the algorithm if that's the case. But I agree that this is a very minor issue at best.

> > * why do you insist on using `==` on symbolic expressions instead of `is_trivial_zero()`?
> 
> 
> Because I want to check equality with an integer. Not if it is a trivial equality.

I mean using `is_trivial_zero()` after calling `full_simplify()` & co, as in my version: this is safer than relying on `==` and essentially as powerful.

> > * do we really need two loops that do essentially the same thing (including raising errors with the exact same message)?
> 
> 
> The equality test is potentially costly. And we want to avoid it as much as possible. In particular, it makes no sense to test this equality within each step of the loop as it is in your version.

Yes—as I said, my version was just a rough sketch of the changes I'd b tempted to make, nothing finished. As the code I was starting with used to loop forever in the typical situation where mine would do the symbolic test repeatedly (that is, `x` ∈ ℤ integer but we don't manage to prove it), I thought the additional cost would be acceptable. `;-)` But anyway, it is not hard to do the test only once while avoiding the code duplication.

> On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`. 

Couldn't you just compute ceil(x-1/2)?

---

Now for some comments on the current code:

* To summarize the above, I still think the main logic in `incremental_rounding()` could be shortened to something like (not tested):

```
    unique_rounding = getattr(RealIntervalFieldElement, 'unique_' + mode)
    r = RR.one() >> 20

    bits = 64
    candidate = None
    while bits < maximum_bits:
        interval = RealIntervalField(bits)(x) # may raise a TypeError
        try:
            return unique_rounding(interval)
        except ValueError:
            pass
        if candidate is None and interval.absolute_diameter() > r:
            candidate = interval.unique_integer()
            try:
                delta = x - candidate
                if (delta.is_zero()
                        or SR(delta).full_simplify().canonicalize_radical()
                                    .is_trivial_zero()
                        or QQbar(delta).is_zero()):
                    return candidate
                except (TypeError, ValueError):
                    pass
        bits *= 2
```

* I'd also make `incremental_rounding()` private and dispense with the argument checking (and perhaps move it to `real_mpfi` if your plan is to use it from elsewhere)—but I'm okay with keeping it as it is. An advantage of making it private is that you could take the “unique rounding” function on intervals as input instead of accessing it via `getattr()`. Another option would be to introduce a common base class for `Function_floor`, `Function_ceil` and `Function_round`.

* I'm a little uneasy about the changes you made to `BuiltinFunction.__call__()`. The fact that it used to convert non-Element inputs to Elements looks intentional and pretty reasonable to me. Is it really necessary to change that behavior? That being said, I'm a bit lost in the maze of `Function.__call__`, `BuiltinFunction.__call__`, `_eval_`, `_evalf_`, `_evalf_try_` and friends, so if you tell me you are confident that the change is correct I'll trust you!

* If these changes stay, then I guess this

```
if module is not None:
    func = getattr(module, self._name, None)
    if func is None and self._alt_name is not None:
        func = getattr(module, self._name, None)
                                    ^^^^^
```
  should be `_alt_name`.

* Note that these changes also make

```
sage: sin(numpy.int32(0))
0.0
```
  which is at odds with

```
sage: sin(ZZ(0)).parent()
Integer Ring
```
  (perhaps not ideal, but predictable at least).

* In `Function_*`, what is the point of calling `_evalf_()` from `_eval_()`?

* And why isn't the logic for choosing `maximum_bits` in `_evalf_()` the same in `floor`, `ceil` and `round`?

* I wouldn't bother with checking that `x` is not a relation. First, `_eval_()` methods of individual functions are probably not the right place for that (either `BuiltinFunction.__call__()` or perhaps methods `ceil()`, `floor()` etc. in a future subclass `RelationalExpression` of `Expression` would be more reasonable). Besides, various other nonsensical inputs (e.g. series, booleans) are accepted without error, so it is a bit strange to have an ad hoc check dealing with this one.



---

archive/issue_events_162809.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-05-17T13:42:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162809"
}
```



---

archive/issue_events_162810.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-05-17T13:42:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162810"
}
```



---

archive/issue_comments_129715.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nYou may be interested in #20624. It looks like implementing `_evalf_` by calling `_eval_` is VERY bad: currently evaluation of `ceil` may lead to running out the python call stack before doing anything useful. Obviously, this takes some time. Inheriting from `BuiltinFunction` is a real bugtrap: its init reassigns a whole bunch of methods.",
    "created_at": "2016-05-19T02:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129715",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:50" align="right">comment:50</div>

You may be interested in #20624. It looks like implementing `_evalf_` by calling `_eval_` is VERY bad: currently evaluation of `ceil` may lead to running out the python call stack before doing anything useful. Obviously, this takes some time. Inheriting from `BuiltinFunction` is a real bugtrap: its init reassigns a whole bunch of methods.



---

archive/issue_comments_129716.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@nbruin](#comment%3A50):\n> Inheriting from `BuiltinFunction` is a real bugtrap: its init reassigns a whole bunch of methods.\n\nThat must be the reason why Sage crashes all the time. Seriously, I agree the construction of functions is messy and it limits the developer somewhat, see \"other symbolic function tickets\" in http://trac.sagemath.org/wiki/symbolics/functions. Note also there are a bunch of tickets needing review there. However, I think the design is sound. You just have to read how other functions (the more recently implemented) are using it. In the end, I or someone will be transferring the Python you write to Pynac, anyway.\n\nCc: the author of the `_evalf_try_` mechanism.",
    "created_at": "2016-05-19T05:39:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129716",
    "user": "https://github.com/rwst"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@nbruin](#comment%3A50):
> Inheriting from `BuiltinFunction` is a real bugtrap: its init reassigns a whole bunch of methods.

That must be the reason why Sage crashes all the time. Seriously, I agree the construction of functions is messy and it limits the developer somewhat, see "other symbolic function tickets" in http://trac.sagemath.org/wiki/symbolics/functions. Note also there are a bunch of tickets needing review there. However, I think the design is sound. You just have to read how other functions (the more recently implemented) are using it. In the end, I or someone will be transferring the Python you write to Pynac, anyway.

Cc: the author of the `_evalf_try_` mechanism.



---

archive/issue_comments_129717.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)** to **[public/12121](https://github.com/sagemath/sagetrac-mirror/tree/public/12121)**",
    "created_at": "2016-06-11T15:37:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129717",
    "user": "https://github.com/rwst"
}
```

Changed branch from **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)** to **[public/12121](https://github.com/sagemath/sagetrac-mirror/tree/public/12121)**



---

archive/issue_comments_129718.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@nbruin](#comment%3A50):\n> You may be interested in #20624. It looks like implementing `_evalf_` by calling `_eval_` is VERY bad: currently evaluation of `ceil` may lead to running out the python call stack before doing anything useful.\n\nI may be mistaken but actually `_eval_` calls `_evalf_` here which is a completely different matter.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9bd70406da71c6e1083fc25cd57435788689018e\"><code>9bd7040</code></a></td><td><code>Merge branch 'develop' into t/12121/12121</code></td></tr></table>\n",
    "created_at": "2016-06-11T15:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129718",
    "user": "https://github.com/rwst"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@nbruin](#comment%3A50):
> You may be interested in #20624. It looks like implementing `_evalf_` by calling `_eval_` is VERY bad: currently evaluation of `ceil` may lead to running out the python call stack before doing anything useful.

I may be mistaken but actually `_eval_` calls `_evalf_` here which is a completely different matter.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9bd70406da71c6e1083fc25cd57435788689018e"><code>9bd7040</code></a></td><td><code>Merge branch 'develop' into t/12121/12121</code></td></tr></table>




---

archive/issue_comments_129719.json:
```json
{
    "body": "Changed commit from **[`602e515`](https://github.com/sagemath/sagetrac-mirror/commit/602e5158c5f37c6900a1dee8e27a228114af1319)** to **[`9bd7040`](https://github.com/sagemath/sagetrac-mirror/commit/9bd70406da71c6e1083fc25cd57435788689018e)**",
    "created_at": "2016-06-11T15:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129719",
    "user": "https://github.com/rwst"
}
```

Changed commit from **[`602e515`](https://github.com/sagemath/sagetrac-mirror/commit/602e5158c5f37c6900a1dee8e27a228114af1319)** to **[`9bd7040`](https://github.com/sagemath/sagetrac-mirror/commit/9bd70406da71c6e1083fc25cd57435788689018e)**



---

archive/issue_comments_129720.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@mezzarobba](#comment%3A49):\n> > On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`. \n> \n> \n> Couldn't you just compute ceil(x-1/2)?\n\n```\nsage: x = 0.5\nsage: print x.round() == (x-0.5).ceil()\nFalse\n```",
    "created_at": "2016-07-13T15:48:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129720",
    "user": "https://github.com/videlec"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@mezzarobba](#comment%3A49):
> > On a related note, I noticed that for `round` you need to test equality with elements of `ZZ + 1/2`. 
> 
> 
> Couldn't you just compute ceil(x-1/2)?

```
sage: x = 0.5
sage: print x.round() == (x-0.5).ceil()
False
```



---

archive/issue_comments_129721.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@mezzarobba](#comment%3A49):\n> * In `Function_*`, what is the point of calling `_evalf_()` from `_eval_()`?\n\nBecause I want the answer of `floor(pi)` to be `3`.",
    "created_at": "2016-07-13T16:23:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129721",
    "user": "https://github.com/videlec"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@mezzarobba](#comment%3A49):
> * In `Function_*`, what is the point of calling `_evalf_()` from `_eval_()`?

Because I want the answer of `floor(pi)` to be `3`.



---

archive/issue_events_162811.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T16:39:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162811"
}
```



---

archive/issue_events_162812.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T16:39:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162812"
}
```



---

archive/issue_events_162813.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T16:39:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162813"
}
```



---

archive/issue_events_162814.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-07-13T16:39:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162814"
}
```



---

archive/issue_comments_129722.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08ecc069c3f88c11060df2ca2383bcb92b2caf27\"><code>08ecc06</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2c5fbe9501e43e6e5e117aae4412db1f21bf1f2\"><code>b2c5fbe</code></a></td><td><code>Trac 12121: change `__call__` and workaround</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82ad3039d0913329de3e3ed514c6397483b7b93a\"><code>82ad303</code></a></td><td><code>Trac 12121: fix doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/194ba9976c58c367d01b767f405f4b4dae1dcad7\"><code>194ba99</code></a></td><td><code>Trac 12121: `_evalf_` more consistent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2719621b352b267d4aa31d95d8f0c22c08cd1c73\"><code>2719621</code></a></td><td><code>Trac 12121: do not check for relation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f392b8e7b2d562debabca7f99fa1b54180f83cb\"><code>6f392b8</code></a></td><td><code>Trac 12121: fix ._name -> ._alt_name</code></td></tr></table>\n",
    "created_at": "2016-07-13T16:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129722",
    "user": "https://github.com/videlec"
}
```

<div id="comment:57"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08ecc069c3f88c11060df2ca2383bcb92b2caf27"><code>08ecc06</code></a></td><td><code>Trac 12121: Fix floor/ceil</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2c5fbe9501e43e6e5e117aae4412db1f21bf1f2"><code>b2c5fbe</code></a></td><td><code>Trac 12121: change `__call__` and workaround</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82ad3039d0913329de3e3ed514c6397483b7b93a"><code>82ad303</code></a></td><td><code>Trac 12121: fix doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/194ba9976c58c367d01b767f405f4b4dae1dcad7"><code>194ba99</code></a></td><td><code>Trac 12121: `_evalf_` more consistent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2719621b352b267d4aa31d95d8f0c22c08cd1c73"><code>2719621</code></a></td><td><code>Trac 12121: do not check for relation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f392b8e7b2d562debabca7f99fa1b54180f83cb"><code>6f392b8</code></a></td><td><code>Trac 12121: fix ._name -> ._alt_name</code></td></tr></table>




---

archive/issue_comments_129723.json:
```json
{
    "body": "Changed commit from **[`9bd7040`](https://github.com/sagemath/sagetrac-mirror/commit/9bd70406da71c6e1083fc25cd57435788689018e)** to **[`6f392b8`](https://github.com/sagemath/sagetrac-mirror/commit/6f392b8e7b2d562debabca7f99fa1b54180f83cb)**",
    "created_at": "2016-07-13T16:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129723",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`9bd7040`](https://github.com/sagemath/sagetrac-mirror/commit/9bd70406da71c6e1083fc25cd57435788689018e)** to **[`6f392b8`](https://github.com/sagemath/sagetrac-mirror/commit/6f392b8e7b2d562debabca7f99fa1b54180f83cb)**



---

archive/issue_comments_129724.json:
```json
{
    "body": "Changed branch from **[public/12121](https://github.com/sagemath/sagetrac-mirror/tree/public/12121)** to **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)**",
    "created_at": "2016-07-13T16:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129724",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[public/12121](https://github.com/sagemath/sagetrac-mirror/tree/public/12121)** to **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)**



---

archive/issue_comments_129725.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,11 +8,6 @@\n ```\n \n This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (2 - epsilon, 2 + epsilon) and endpoints have different ceilings.\n-\n-The proposal is to:\n-- first found an interval of reasonably small diameter (arbitrarily set to 2<sup>-30</sup>) and see whether this is enough to decide the ceiling\n-- then check equality with the only available candidate (possibly doing some simplification)\n-- start further refinement of the interval\n \n With the branch applied `math.floor` and `numpy.floor` are used directly\n \n``````\n",
    "created_at": "2016-07-13T16:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129725",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,11 +8,6 @@
 ```
 
 This happens because ceil and floor first try to increase the precision of a coercion of the input argument to a `RealInterval` by 100 bits from 53 to 20000 before finally trying a full_simplify, which succeeds.  The `RealInterval` rounds all fail because the interval is always of the form (2 - epsilon, 2 + epsilon) and endpoints have different ceilings.
-
-The proposal is to:
-- first found an interval of reasonably small diameter (arbitrarily set to 2<sup>-30</sup>) and see whether this is enough to decide the ceiling
-- then check equality with the only available candidate (possibly doing some simplification)
-- start further refinement of the interval
 
 With the branch applied `math.floor` and `numpy.floor` are used directly
 
``````




---

archive/issue_comments_129726.json:
```json
{
    "body": "Changed reviewer from **Marc Mezzarobba** to **Marc Mezzarobba, Ralf Stephan**",
    "created_at": "2016-07-14T06:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129726",
    "user": "https://github.com/rwst"
}
```

Changed reviewer from **Marc Mezzarobba** to **Marc Mezzarobba, Ralf Stephan**



---

archive/issue_comments_129727.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\n`Function` mechanics looking very good. Can't comment on the `incremental_rounding()` function part.",
    "created_at": "2016-07-14T06:08:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129727",
    "user": "https://github.com/rwst"
}
```

<div id="comment:58" align="right">comment:58</div>

`Function` mechanics looking very good. Can't comment on the `incremental_rounding()` function part.



---

archive/issue_comments_129728.json:
```json
{
    "body": "Dependencies: **#21216**",
    "created_at": "2016-08-10T23:16:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129728",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#21216**



---

archive/issue_events_162815.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-08-10T23:16:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162815"
}
```



---

archive/issue_events_162816.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-08-10T23:16:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162816"
}
```



---

archive/issue_comments_129729.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d2f05f1665bd21f5ec708345f4becd48b1c0fc99\"><code>d2f05f1</code></a></td><td><code>Trac 12121: incremental rounding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f66febd75b8702831db61585d3591575d024c23b\"><code>f66febd</code></a></td><td><code>Trac 12121: use incremental_rounding in floor/ceil/round</code></td></tr></table>\n",
    "created_at": "2016-08-17T21:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129729",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d2f05f1665bd21f5ec708345f4becd48b1c0fc99"><code>d2f05f1</code></a></td><td><code>Trac 12121: incremental rounding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f66febd75b8702831db61585d3591575d024c23b"><code>f66febd</code></a></td><td><code>Trac 12121: use incremental_rounding in floor/ceil/round</code></td></tr></table>




---

archive/issue_comments_129730.json:
```json
{
    "body": "Changed commit from **[`6f392b8`](https://github.com/sagemath/sagetrac-mirror/commit/6f392b8e7b2d562debabca7f99fa1b54180f83cb)** to **[`f66febd`](https://github.com/sagemath/sagetrac-mirror/commit/f66febd75b8702831db61585d3591575d024c23b)**",
    "created_at": "2016-08-17T21:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129730",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6f392b8`](https://github.com/sagemath/sagetrac-mirror/commit/6f392b8e7b2d562debabca7f99fa1b54180f83cb)** to **[`f66febd`](https://github.com/sagemath/sagetrac-mirror/commit/f66febd75b8702831db61585d3591575d024c23b)**



---

archive/issue_events_162817.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-08-17T21:55:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162817"
}
```



---

archive/issue_events_162818.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-08-17T21:55:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162818"
}
```



---

archive/issue_comments_129731.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nRebased on the last beta (which includes #21216).\n\nI slightly modified `incremental_rounding`. The simplification part is implemented outside. As soon as there is a reliable `is_zero` available for elements of SR (as it is the case for `QQbar` with `is_zero`) we could make it cleaner.",
    "created_at": "2016-08-17T21:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129731",
    "user": "https://github.com/videlec"
}
```

<div id="comment:61" align="right">comment:61</div>

Rebased on the last beta (which includes #21216).

I slightly modified `incremental_rounding`. The simplification part is implemented outside. As soon as there is a reliable `is_zero` available for elements of SR (as it is the case for `QQbar` with `is_zero`) we could make it cleaner.



---

archive/issue_comments_129732.json:
```json
{
    "body": "Changed dependencies from **#21216** to none",
    "created_at": "2016-08-17T21:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129732",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#21216** to none



---

archive/issue_comments_129733.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nHi Vincent,\n\nSorry for taking so long to reply once again. The code is starting to look really good to me overall, but calling the buggy `is_zero()` causes regressions such as:\n\n```\nsage: foo = sin(1 + 10^(-30)) - sin(1)\nsage: ceil(foo)\n0\nsage: floor(foo)\n0\n```\nI know we already talked about that above, but are you sure you don't want `incremental_rounding()` to use `is_trivial_zero()` (probably after some simplification) instead?",
    "created_at": "2016-09-16T09:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129733",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:62" align="right">comment:62</div>

Hi Vincent,

Sorry for taking so long to reply once again. The code is starting to look really good to me overall, but calling the buggy `is_zero()` causes regressions such as:

```
sage: foo = sin(1 + 10^(-30)) - sin(1)
sage: ceil(foo)
0
sage: floor(foo)
0
```
I know we already talked about that above, but are you sure you don't want `incremental_rounding()` to use `is_trivial_zero()` (probably after some simplification) instead?



---

archive/issue_events_162819.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-09-16T09:59:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162819"
}
```



---

archive/issue_events_162820.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-09-16T09:59:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162820"
}
```



---

archive/issue_comments_129734.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI definitely want a `incremental_rounding` that is symbolic ring agnostic. A solution would be to have an optional argument `is_zero`. What do you think?",
    "created_at": "2016-09-17T07:05:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129734",
    "user": "https://github.com/videlec"
}
```

<div id="comment:63" align="right">comment:63</div>

I definitely want a `incremental_rounding` that is symbolic ring agnostic. A solution would be to have an optional argument `is_zero`. What do you think?



---

archive/issue_comments_129735.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\n(of course the argument would have default \"the_object.is_zero\")",
    "created_at": "2016-09-17T07:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129735",
    "user": "https://github.com/videlec"
}
```

<div id="comment:64" align="right">comment:64</div>

(of course the argument would have default "the_object.is_zero")



---

archive/issue_comments_129736.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@videlec](#comment%3A63):\n> I definitely want a `incremental_rounding` that is symbolic ring agnostic. A solution would be to have an optional argument `is_zero`. What do you think?\n\nThat sounds good.",
    "created_at": "2016-09-17T11:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129736",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@videlec](#comment%3A63):
> I definitely want a `incremental_rounding` that is symbolic ring agnostic. A solution would be to have an optional argument `is_zero`. What do you think?

That sounds good.



---

archive/issue_comments_129737.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nAnd `is_trivial_zero` could not be a solution anyway\n\n```\nsage: delta = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 2\nsage: delta.is_zero()\nTrue\nsage: delta.is_trivial_zero()\nFalse\nsage: delta2 = delta.full_simplify().canonicalize_radical()\nsage: delta2.is_zero()\nTrue\nsage: delta2.is_trivial_zero()\nFalse\n```",
    "created_at": "2016-09-17T11:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129737",
    "user": "https://github.com/videlec"
}
```

<div id="comment:66" align="right">comment:66</div>

And `is_trivial_zero` could not be a solution anyway

```
sage: delta = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 2
sage: delta.is_zero()
True
sage: delta.is_trivial_zero()
False
sage: delta2 = delta.full_simplify().canonicalize_radical()
sage: delta2.is_zero()
True
sage: delta2.is_trivial_zero()
False
```



---

archive/issue_comments_129738.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nEven better\n\n```\nsage: (sin(1 - 10^(-100)) - sin(1)).is_zero()\nTrue\nage: bool(sin(1 - 10^(-100)) - sin(1) == 0)\nTrue\n```\nI thought that we should only worry about false negatives...",
    "created_at": "2016-09-17T11:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129738",
    "user": "https://github.com/videlec"
}
```

<div id="comment:67" align="right">comment:67</div>

Even better

```
sage: (sin(1 - 10^(-100)) - sin(1)).is_zero()
True
age: bool(sin(1 - 10^(-100)) - sin(1) == 0)
True
```
I thought that we should only worry about false negatives...



---

archive/issue_comments_129739.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nSee the following thread\n\n    https://groups.google.com/forum/#!topic/sage-devel/qitYHanQiEo",
    "created_at": "2016-09-17T11:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129739",
    "user": "https://github.com/videlec"
}
```

<div id="comment:68" align="right">comment:68</div>

See the following thread

    https://groups.google.com/forum/#!topic/sage-devel/qitYHanQiEo



---

archive/issue_comments_129740.json:
```json
{
    "body": "Changed commit from **[`f66febd`](https://github.com/sagemath/sagetrac-mirror/commit/f66febd75b8702831db61585d3591575d024c23b)** to **[`83c0257`](https://github.com/sagemath/sagetrac-mirror/commit/83c025750342ffbc079e5d8c0c004d2f1b443f22)**",
    "created_at": "2016-09-17T13:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129740",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f66febd`](https://github.com/sagemath/sagetrac-mirror/commit/f66febd75b8702831db61585d3591575d024c23b)** to **[`83c0257`](https://github.com/sagemath/sagetrac-mirror/commit/83c025750342ffbc079e5d8c0c004d2f1b443f22)**



---

archive/issue_comments_129741.json:
```json
{
    "body": "<div id=\"comment:69\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ef7b9e16173ebec8bebc52f8b9a95b755fd94e3\"><code>0ef7b9e</code></a></td><td><code>Trac 12121: incremental rounding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/60759c5ee029464032103a0d04fa3915accbaa36\"><code>60759c5</code></a></td><td><code>Trac 12121: use incremental_rounding in floor/ceil/round</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e0396d869f835899ca6d5a75dbe62a8f8dce7413\"><code>e0396d8</code></a></td><td><code>Trac 12121: implement (broken) floor/ceil for expression</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83c025750342ffbc079e5d8c0c004d2f1b443f22\"><code>83c0257</code></a></td><td><code>Trac 12121: fix frac</code></td></tr></table>\n",
    "created_at": "2016-09-17T13:51:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129741",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:69"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ef7b9e16173ebec8bebc52f8b9a95b755fd94e3"><code>0ef7b9e</code></a></td><td><code>Trac 12121: incremental rounding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/60759c5ee029464032103a0d04fa3915accbaa36"><code>60759c5</code></a></td><td><code>Trac 12121: use incremental_rounding in floor/ceil/round</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e0396d869f835899ca6d5a75dbe62a8f8dce7413"><code>e0396d8</code></a></td><td><code>Trac 12121: implement (broken) floor/ceil for expression</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83c025750342ffbc079e5d8c0c004d2f1b443f22"><code>83c0257</code></a></td><td><code>Trac 12121: fix frac</code></td></tr></table>




---

archive/issue_events_162821.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-09-17T13:53:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162821"
}
```



---

archive/issue_events_162822.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-09-17T13:53:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162822"
}
```



---

archive/issue_comments_129742.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nYou removed the symbolic property of `frac()` and you didn't give any justification for it.",
    "created_at": "2016-09-17T14:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129742",
    "user": "https://github.com/rwst"
}
```

<div id="comment:71" align="right">comment:71</div>

You removed the symbolic property of `frac()` and you didn't give any justification for it.



---

archive/issue_comments_129743.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nPlease try to fix your code so previous frac doctests work.",
    "created_at": "2016-09-17T14:24:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129743",
    "user": "https://github.com/rwst"
}
```

<div id="comment:72" align="right">comment:72</div>

Please try to fix your code so previous frac doctests work.



---

archive/issue_events_162823.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-09-17T14:24:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162823"
}
```



---

archive/issue_events_162824.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2016-09-17T14:24:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162824"
}
```



---

archive/issue_comments_129744.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5713b9187762d6cd6512936bb6f3ae8674c75da1\"><code>5713b91</code></a></td><td><code>Trac 12121: fix frac</code></td></tr></table>\n",
    "created_at": "2016-09-17T16:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129744",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5713b9187762d6cd6512936bb6f3ae8674c75da1"><code>5713b91</code></a></td><td><code>Trac 12121: fix frac</code></td></tr></table>




---

archive/issue_comments_129745.json:
```json
{
    "body": "Changed commit from **[`83c0257`](https://github.com/sagemath/sagetrac-mirror/commit/83c025750342ffbc079e5d8c0c004d2f1b443f22)** to **[`5713b91`](https://github.com/sagemath/sagetrac-mirror/commit/5713b9187762d6cd6512936bb6f3ae8674c75da1)**",
    "created_at": "2016-09-17T16:19:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129745",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`83c0257`](https://github.com/sagemath/sagetrac-mirror/commit/83c025750342ffbc079e5d8c0c004d2f1b443f22)** to **[`5713b91`](https://github.com/sagemath/sagetrac-mirror/commit/5713b9187762d6cd6512936bb6f3ae8674c75da1)**



---

archive/issue_comments_129746.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nRalf, what do you call the \"symbolic property\" of `frac`?\n\nOn the other hand I have comments about the previous code of `frac`\n- it is the role of the function `floor` to call the method `floor` if needed. There is no need to redo it now and then\n- special casing `int` and `float` when the generic `x - floor(x)` does work is weird (not mentioning that this was not tested). In this case I would prefer that it behaves like floor and ceil (ie frac(float) returning float). The previous version returned Sage integer, why is that?\n\nI let the `frac(x + y)` not be transformed in `x + y - floor(x + y)` in my new last commit. Please tell me if you like it better.",
    "created_at": "2016-09-17T16:24:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129746",
    "user": "https://github.com/videlec"
}
```

<div id="comment:74" align="right">comment:74</div>

Ralf, what do you call the "symbolic property" of `frac`?

On the other hand I have comments about the previous code of `frac`
- it is the role of the function `floor` to call the method `floor` if needed. There is no need to redo it now and then
- special casing `int` and `float` when the generic `x - floor(x)` does work is weird (not mentioning that this was not tested). In this case I would prefer that it behaves like floor and ceil (ie frac(float) returning float). The previous version returned Sage integer, why is that?

I let the `frac(x + y)` not be transformed in `x + y - floor(x + y)` in my new last commit. Please tell me if you like it better.



---

archive/issue_events_162825.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-09-17T16:24:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162825"
}
```



---

archive/issue_events_162826.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2016-09-17T16:24:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162826"
}
```



---

archive/issue_comments_129747.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@videlec](#comment%3A66):\n> And `is_trivial_zero` could not be a solution anyway\n> \n> ```\n> sage: delta = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 2\n> ```\n\nWell, of course there will always be examples where the zero-test fails! Above I suggested to try both simplification followed by `is_trivial_zero()` and conversion to `QQbar`, this would take care of this example.",
    "created_at": "2016-09-17T17:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129747",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@videlec](#comment%3A66):
> And `is_trivial_zero` could not be a solution anyway
> 
> ```
> sage: delta = (11/9*sqrt(3)*sqrt(2) + 3)^(1/3) + 1/3/(11/9*sqrt(3)*sqrt(2) + 3)^(1/3) - 2
> ```

Well, of course there will always be examples where the zero-test fails! Above I suggested to try both simplification followed by `is_trivial_zero()` and conversion to `QQbar`, this would take care of this example.



---

archive/issue_comments_129748.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@videlec](#comment%3A67):\n> Even better\n> \n> ```\n> sage: (sin(1 - 10^(-100)) - sin(1)).is_zero()\n> True\n> age: bool(sin(1 - 10^(-100)) - sin(1) == 0)\n> True\n> ```\n\nYes; I thought that was what the comment about `is_zero()` being unreliable was about.",
    "created_at": "2016-09-17T17:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129748",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@videlec](#comment%3A67):
> Even better
> 
> ```
> sage: (sin(1 - 10^(-100)) - sin(1)).is_zero()
> True
> age: bool(sin(1 - 10^(-100)) - sin(1) == 0)
> True
> ```

Yes; I thought that was what the comment about `is_zero()` being unreliable was about.



---

archive/issue_comments_129749.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nReplying to [@mezzarobba](#comment%3A77):\n> Replying to [@videlec](#comment%3A67):\n> > Even better\n> > \n> > ```\n> > sage: (sin(1 - 10^(-100)) - sin(1)).is_zero()\n> > True\n> > age: bool(sin(1 - 10^(-100)) - sin(1) == 0)\n> > True\n> > ```\n> \n> \n> Yes; I thought that was what the comment about `is_zero()` being unreliable was about.\n\nFor me unreliable was \"sometimes there are false negative\". But it is not only that as there are \"false positive\". Meaning that\n\n```\ndef is_zero(x):\n    return randint(0, 1)\n```\nis equally good.",
    "created_at": "2016-09-17T19:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129749",
    "user": "https://github.com/videlec"
}
```

<div id="comment:78" align="right">comment:78</div>

Replying to [@mezzarobba](#comment%3A77):
> Replying to [@videlec](#comment%3A67):
> > Even better
> > 
> > ```
> > sage: (sin(1 - 10^(-100)) - sin(1)).is_zero()
> > True
> > age: bool(sin(1 - 10^(-100)) - sin(1) == 0)
> > True
> > ```
> 
> 
> Yes; I thought that was what the comment about `is_zero()` being unreliable was about.

For me unreliable was "sometimes there are false negative". But it is not only that as there are "false positive". Meaning that

```
def is_zero(x):
    return randint(0, 1)
```
is equally good.



---

archive/issue_comments_129750.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nIf you have a `reliable_is_zero_for_SR` I will of course include it ;-)",
    "created_at": "2016-09-17T19:04:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129750",
    "user": "https://github.com/videlec"
}
```

<div id="comment:79" align="right">comment:79</div>

If you have a `reliable_is_zero_for_SR` I will of course include it ;-)



---

archive/issue_comments_129751.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [@videlec](#comment%3A74):\n> Ralf, what do you call the \"symbolic property\" of `frac`?\n\nThat it can be part of expressions. In the first version of your \"fix frac\" commit you unconditionally expanded `frac(...)` and forced the user to use `hold=True` to get the symbolic `frac()`.\n\n> I let the `frac(x + y)` not be transformed in `x + y - floor(x + y)` in my new last commit. Please tell me if you like it better.\n\nI do!\n\nMarc:\n> Well, of course there will always be examples where the zero-test fails! Above I suggested to try both simplification followed by is_trivial_zero() and conversion to QQbar, this would take care of this example.\n\nIn #16397 I implemented this already in https://github.com/sagemath/sage/blob/master/src/sage/symbolic/comparison.pyx#L291 to have some code usable for `__nonzero__` later.",
    "created_at": "2016-09-18T06:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129751",
    "user": "https://github.com/rwst"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [@videlec](#comment%3A74):
> Ralf, what do you call the "symbolic property" of `frac`?

That it can be part of expressions. In the first version of your "fix frac" commit you unconditionally expanded `frac(...)` and forced the user to use `hold=True` to get the symbolic `frac()`.

> I let the `frac(x + y)` not be transformed in `x + y - floor(x + y)` in my new last commit. Please tell me if you like it better.

I do!

Marc:
> Well, of course there will always be examples where the zero-test fails! Above I suggested to try both simplification followed by is_trivial_zero() and conversion to QQbar, this would take care of this example.

In #16397 I implemented this already in https://github.com/sagemath/sage/blob/master/src/sage/symbolic/comparison.pyx#L291 to have some code usable for `__nonzero__` later.



---

archive/issue_events_162827.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-09-20T07:50:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162827"
}
```



---

archive/issue_events_162828.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2016-09-20T07:50:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162828"
}
```



---

archive/issue_comments_129752.json:
```json
{
    "body": "Work Issues: **test failures**",
    "created_at": "2016-09-20T07:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129752",
    "user": "https://github.com/mezzarobba"
}
```

Work Issues: **test failures**



---

archive/issue_comments_129753.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nA minor suggestion: perhaps make `rounding()` to `_rounding()`?\n\nAlso, I'm not sure how bad the existing implementation of `floor()` and friends is, but unless it is really terrible, I'd prefer to either avoid relying on `is_zero()` (even with known bugs marked as such) or to have `is_zero()` fixed before merging this ticket.",
    "created_at": "2016-09-20T08:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129753",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:82" align="right">comment:82</div>

A minor suggestion: perhaps make `rounding()` to `_rounding()`?

Also, I'm not sure how bad the existing implementation of `floor()` and friends is, but unless it is really terrible, I'd prefer to either avoid relying on `is_zero()` (even with known bugs marked as such) or to have `is_zero()` fixed before merging this ticket.



---

archive/issue_comments_129754.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@rwst](#comment%3A80):\n> > Well, of course there will always be examples where the zero-test fails! Above I suggested to try both simplification followed by is_trivial_zero() and conversion to QQbar, this would take care of this example.\n> \n> \n> In #16397 I implemented this already in https://github.com/sagemath/sage/blob/master/src/sage/symbolic/comparison.pyx#L291 to have some code usable for `__nonzero__` later.\n\nI think I don't follow you, sorry. The code you link to looks like it is intended to sort expressions for printing etc., not to provide reliable mathematical results, isn't it? Besides (but this is starting to be off-topic for this ticket), I'm tempted to think that, for non-relational expressions at least, `__nonzero__()` should simply be the negation of `is_trivial_zero()`. As far as I understand, what `__nonzero__()` is intended to test is whether something is \u201cempty\u201d, \u201ctrivial\u201d; it should be as fast as possible, and there is no expectation that it tries hard to prove the nullity of its argument. For a \u201cmathematical\u201d example, I'd find it entirely reasonable to have `(x - x)*y + 1 \u2208 SR[y]` be considered a polynomial of degree **one**\u2014and that's the kind of things `__nonzero__()` is for. I'm less certain about *relational* expressions: perhaps `bool(expr == 0)`, unlike `bool(expr)`, should keep trying hard to show that `expr` is zero.",
    "created_at": "2016-09-20T08:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129754",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@rwst](#comment%3A80):
> > Well, of course there will always be examples where the zero-test fails! Above I suggested to try both simplification followed by is_trivial_zero() and conversion to QQbar, this would take care of this example.
> 
> 
> In #16397 I implemented this already in https://github.com/sagemath/sage/blob/master/src/sage/symbolic/comparison.pyx#L291 to have some code usable for `__nonzero__` later.

I think I don't follow you, sorry. The code you link to looks like it is intended to sort expressions for printing etc., not to provide reliable mathematical results, isn't it? Besides (but this is starting to be off-topic for this ticket), I'm tempted to think that, for non-relational expressions at least, `__nonzero__()` should simply be the negation of `is_trivial_zero()`. As far as I understand, what `__nonzero__()` is intended to test is whether something is “empty”, “trivial”; it should be as fast as possible, and there is no expectation that it tries hard to prove the nullity of its argument. For a “mathematical” example, I'd find it entirely reasonable to have `(x - x)*y + 1 ∈ SR[y]` be considered a polynomial of degree **one**—and that's the kind of things `__nonzero__()` is for. I'm less certain about *relational* expressions: perhaps `bool(expr == 0)`, unlike `bool(expr)`, should keep trying hard to show that `expr` is zero.



---

archive/issue_comments_129755.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nSee also #22079.",
    "created_at": "2016-12-19T19:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129755",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:85" align="right">comment:85</div>

See also #22079.



---

archive/issue_comments_129756.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nRebased following the discussion at #22079.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1dc641831391e664f7a35940c9c3c37d46a8552a\"><code>1dc6418</code></a></td><td><code>Trac 12121: incremental rounding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4669e113d991290c6a98ae9229db7df8dfe26f48\"><code>4669e11</code></a></td><td><code>Trac 12121: use incremental_rounding in floor/ceil/round</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/00959ea2b73b8259935bb826f14c3114d2ba042f\"><code>00959ea</code></a></td><td><code>Trac 12121: implement (broken) floor/ceil for expression</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b1a32abd788a451a7004c833f03c7a94f86753f\"><code>1b1a32a</code></a></td><td><code>Trac 12121: fix frac</code></td></tr></table>\n",
    "created_at": "2017-09-04T14:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129756",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:86" align="right">comment:86</div>

Rebased following the discussion at #22079.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1dc641831391e664f7a35940c9c3c37d46a8552a"><code>1dc6418</code></a></td><td><code>Trac 12121: incremental rounding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4669e113d991290c6a98ae9229db7df8dfe26f48"><code>4669e11</code></a></td><td><code>Trac 12121: use incremental_rounding in floor/ceil/round</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/00959ea2b73b8259935bb826f14c3114d2ba042f"><code>00959ea</code></a></td><td><code>Trac 12121: implement (broken) floor/ceil for expression</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b1a32abd788a451a7004c833f03c7a94f86753f"><code>1b1a32a</code></a></td><td><code>Trac 12121: fix frac</code></td></tr></table>




---

archive/issue_comments_129757.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)** to **[u/mmezzarobba/ticket/12121-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/12121-rebased)**",
    "created_at": "2017-09-04T14:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129757",
    "user": "https://github.com/mezzarobba"
}
```

Changed branch from **[u/vdelecroix/12121](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/12121)** to **[u/mmezzarobba/ticket/12121-rebased](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/ticket/12121-rebased)**



---

archive/issue_comments_129758.json:
```json
{
    "body": "Changed commit from **[`5713b91`](https://github.com/sagemath/sagetrac-mirror/commit/5713b9187762d6cd6512936bb6f3ae8674c75da1)** to **[`1b1a32a`](https://github.com/sagemath/sagetrac-mirror/commit/1b1a32abd788a451a7004c833f03c7a94f86753f)**",
    "created_at": "2017-09-04T14:23:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129758",
    "user": "https://github.com/mezzarobba"
}
```

Changed commit from **[`5713b91`](https://github.com/sagemath/sagetrac-mirror/commit/5713b9187762d6cd6512936bb6f3ae8674c75da1)** to **[`1b1a32a`](https://github.com/sagemath/sagetrac-mirror/commit/1b1a32abd788a451a7004c833f03c7a94f86753f)**



---

archive/issue_comments_129759.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nI have an implementation fixing `floor()`/`ceil()` at #22079.",
    "created_at": "2017-09-04T15:04:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129759",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:87" align="right">comment:87</div>

I have an implementation fixing `floor()`/`ceil()` at #22079.



---

archive/issue_comments_129760.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nThis branch does a whole lot more than fixing `floor()`/`ceil()`. Now that this has been fixed in #22079, feel free to change the purpose of this ticket.",
    "created_at": "2017-11-29T15:53:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12121#issuecomment-129760",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:88" align="right">comment:88</div>

This branch does a whole lot more than fixing `floor()`/`ceil()`. Now that this has been fixed in #22079, feel free to change the purpose of this ticket.



---

archive/issue_events_162829.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:36:35Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12121",
    "milestone_number": null,
    "milestone_title": "sage-7.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12121#event-162829"
}
```
