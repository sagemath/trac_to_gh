# Issue 12571: Implementation of shifted shuffle of permutations

archive/issues_012399.json:
```json
{
    "body": "The shifted shuffle of two permutations can be expressed as a right permutohedron interval. We implements a method that computes in this way the shifted shuffle of two permutations.\n\nNote that this improve the efficiency of the former way to compute shifted shuffle of permutations:\n\n```\nsage: p1 = Permutations(10).random_element()\nsage: p2 = Permutations(7).random_element()\n```\n\n```\nsage: _ = [Permutation(p) for p in Word(p1).shifted_shuffle(Word(p2))]\n```\n\ntakes about 19.95 s CPU time on my computer, but\n\n```\nsage: _ = p1.shifted_shuffle(p2)\n```\n\ntakes about 3.94 s CPU time.\n\n\nWe also implements Loday-Ronco's over and under operations on permutations.\n\n**Assignee:** sage-combinat\n\n**CC:**  @KPanComputes @tscrim sage-combinat\n\n**Keywords:** Permutations, Shuffle\n\n**Reviewer:** Florent Hivert, Darij Grinberg\n\n**Author:** Samuele Giraudo\n\n**Merged:** sage-5.12.beta5\n\n**Dependencies:** #12569, #14772, #8386, #14519, #14808, #14143, #14015, #14516\n\nIssue created by migration from https://trac.sagemath.org/ticket/12571\n\n",
    "closed_at": "2013-09-02T10:20:24Z",
    "created_at": "2012-02-23T11:13:00Z",
    "labels": [
        "component: combinatorics",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "title": "Implementation of shifted shuffle of permutations",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12571",
    "user": "https://trac.sagemath.org/admin/accounts/users/giraudo"
}
```
The shifted shuffle of two permutations can be expressed as a right permutohedron interval. We implements a method that computes in this way the shifted shuffle of two permutations.

Note that this improve the efficiency of the former way to compute shifted shuffle of permutations:

```
sage: p1 = Permutations(10).random_element()
sage: p2 = Permutations(7).random_element()
```

```
sage: _ = [Permutation(p) for p in Word(p1).shifted_shuffle(Word(p2))]
```

takes about 19.95 s CPU time on my computer, but

```
sage: _ = p1.shifted_shuffle(p2)
```

takes about 3.94 s CPU time.


We also implements Loday-Ronco's over and under operations on permutations.

**Assignee:** sage-combinat

**CC:**  @KPanComputes @tscrim sage-combinat

**Keywords:** Permutations, Shuffle

**Reviewer:** Florent Hivert, Darij Grinberg

**Author:** Samuele Giraudo

**Merged:** sage-5.12.beta5

**Dependencies:** #12569, #14772, #8386, #14519, #14808, #14143, #14015, #14516

Issue created by migration from https://trac.sagemath.org/ticket/12571





---

archive/issue_comments_141777.json:
```json
{
    "body": "**Dependencies:** #12569",
    "created_at": "2012-02-23T11:15:26Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141777",
    "user": "https://trac.sagemath.org/admin/accounts/users/giraudo"
}
```

**Dependencies:** #12569



---

archive/issue_comments_141778.json:
```json
{
    "body": "**Reviewer:** Florent Hivert",
    "created_at": "2012-02-23T22:32:26Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141778",
    "user": "https://github.com/hivert"
}
```

**Reviewer:** Florent Hivert



---

archive/issue_comments_141779.json:
```json
{
    "body": "<a id='comment:2'></a>\nHi Samuele,\n\nGood to have you onboard ! \n\n- First of all, if you want a review you should check the `needs-review` button below. \n\n- when you put some example under the title `EXAMPLES::`\nthere is no need to but them in `TESTS::`. Both are tested alike.\n\n- You should add a rubric `INPUT::` explaining what `other` can\nbe. Here I think it could be a `Permutations`, a `list`, a `tuple`\nor any `iterable`. A few examples demonstrating this should also be added\n(see\n[documentation strings](http://www.sagemath.org/doc/developer/conventions.html#documentation-strings) for the precise syntax).\n\n- Are you sure that you didn't mixed up the convention for over/under ? To\nbreak the ambiguity, I'd rather call them `shifted_concatenation` and\n`shifted_anti_concatenation`. Or maybe only one function\n`shifted_concatenation`, with an optional parameter `shift` which can\nbe either `\"left\"` or `\"right\"`. Or even\n`shift_right (True by default)`...\nWhat do you think ? Maybe it is worth asking for a vote on\n`Sage-combinat-devel`.\n\n- You should add a \".. SEEALSO::\" rubric linking the three functions one to\nthe other (see also #12078 ;-)\n\n- Finally, You could add some consistency tests checking that for some\nrelatively large permutations, the cardinality of the interval in the correct\nbinomial coefficient.\n\nSorry for this long list of requests, once you gets used to Sage, you'll do all\nof this without thinking of it.\n\nAnd many thanks for taking care of this.\n\nFlorent",
    "created_at": "2012-02-23T22:32:26Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141779",
    "user": "https://github.com/hivert"
}
```

<a id='comment:2'></a>
Hi Samuele,

Good to have you onboard ! 

- First of all, if you want a review you should check the `needs-review` button below. 

- when you put some example under the title `EXAMPLES::`
there is no need to but them in `TESTS::`. Both are tested alike.

- You should add a rubric `INPUT::` explaining what `other` can
be. Here I think it could be a `Permutations`, a `list`, a `tuple`
or any `iterable`. A few examples demonstrating this should also be added
(see
[documentation strings](http://www.sagemath.org/doc/developer/conventions.html#documentation-strings) for the precise syntax).

- Are you sure that you didn't mixed up the convention for over/under ? To
break the ambiguity, I'd rather call them `shifted_concatenation` and
`shifted_anti_concatenation`. Or maybe only one function
`shifted_concatenation`, with an optional parameter `shift` which can
be either `"left"` or `"right"`. Or even
`shift_right (True by default)`...
What do you think ? Maybe it is worth asking for a vote on
`Sage-combinat-devel`.

- You should add a ".. SEEALSO::" rubric linking the three functions one to
the other (see also #12078 ;-)

- Finally, You could add some consistency tests checking that for some
relatively large permutations, the cardinality of the interval in the correct
binomial coefficient.

Sorry for this long list of requests, once you gets used to Sage, you'll do all
of this without thinking of it.

And many thanks for taking care of this.

Florent



---

archive/issue_comments_141780.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [hivert](#comment%3A2):\n> - Are you sure that you didn't mixed up the convention for over/under ? To\n> break the ambiguity, I'd rather call them `shifted_concatenation` and\n> `shifted_anti_concatenation`. Or maybe only one function\n> `shifted_concatenation`, with an optional parameter `shift` which can\n> be either `\"left\"` or `\"right\"`. Or even\n> `shift_right (True by default)`...\n\n\nQuite a few functions take an argument side=\"left\"/\"right\", more often\nthan not the default being \"right\". If\n\n```\n    x.shifted_concatenation(y, side=\"right\")\n```\n\nsounds unambiguous enough about the shift being on y (and not the\nconcatenation being on the right), I vote for this. Otherwise\nshift=\"left\"/\"right\"\n\nCheers,\n                      Nicolas",
    "created_at": "2012-02-23T22:42:10Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141780",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:3'></a>
Replying to [hivert](#comment%3A2):
> - Are you sure that you didn't mixed up the convention for over/under ? To
> break the ambiguity, I'd rather call them `shifted_concatenation` and
> `shifted_anti_concatenation`. Or maybe only one function
> `shifted_concatenation`, with an optional parameter `shift` which can
> be either `"left"` or `"right"`. Or even
> `shift_right (True by default)`...


Quite a few functions take an argument side="left"/"right", more often
than not the default being "right". If

```
    x.shifted_concatenation(y, side="right")
```

sounds unambiguous enough about the shift being on y (and not the
concatenation being on the right), I vote for this. Otherwise
shift="left"/"right"

Cheers,
                      Nicolas



---

archive/issue_events_103873.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/giraudo",
    "created_at": "2012-02-24T08:47:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103873"
}
```



---

archive/issue_comments_141781.json:
```json
{
    "body": "<a id='comment:5'></a>\nHi Florent, hi Nicolas,\n\nthanks a lot for the suggestions of improvement. I just have updated the patch.\n\nSamuele",
    "created_at": "2012-02-24T09:32:33Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141781",
    "user": "https://trac.sagemath.org/admin/accounts/users/giraudo"
}
```

<a id='comment:5'></a>
Hi Florent, hi Nicolas,

thanks a lot for the suggestions of improvement. I just have updated the patch.

Samuele



---

archive/issue_comments_141782.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis patch is disappeared? I think the shuffle on words is now efficient.\n\nThis post could be closed?\n\nJean-Baptiste",
    "created_at": "2013-01-08T19:37:42Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141782",
    "user": "https://trac.sagemath.org/admin/accounts/users/elixyre"
}
```

<a id='comment:6'></a>
This patch is disappeared? I think the shuffle on words is now efficient.

This post could be closed?

Jean-Baptiste



---

archive/issue_comments_141783.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [elixyre](#comment%3A6):\n> This patch is disappeared? I think the shuffle on words is now efficient.\n\n\nNot quite. Sage 5.6 takes 21.93 seconds. \n\n> \n> This post could be closed?\n\n\nSo, no I'd think. \n> \n> Jean-Baptiste\n",
    "created_at": "2013-02-03T10:26:46Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141783",
    "user": "https://github.com/KPanComputes"
}
```

<a id='comment:7'></a>
Replying to [elixyre](#comment%3A6):
> This patch is disappeared? I think the shuffle on words is now efficient.


Not quite. Sage 5.6 takes 21.93 seconds. 

> 
> This post could be closed?


So, no I'd think. 
> 
> Jean-Baptiste




---

archive/issue_events_103874.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-03-09T22:21:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103874"
}
```



---

archive/issue_events_103875.json:
```json
{
    "actor": "https://github.com/nathanncohen",
    "created_at": "2013-03-09T22:21:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103875"
}
```



---

archive/issue_comments_141784.json:
```json
{
    "body": "<a id='comment:9'></a>\nHelloooooooooooooooooo !!!\n\nThis patch looks good to go, but it would be nice to add your two new methods to the (new) index of methods at the top of permutation.py `:-)`\n\nNathann",
    "created_at": "2013-03-09T22:21:17Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141784",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>
Helloooooooooooooooooo !!!

This patch looks good to go, but it would be nice to add your two new methods to the (new) index of methods at the top of permutation.py `:-)`

Nathann



---

archive/issue_comments_141785.json:
```json
{
    "body": "**Changing dependencies** from \"#12569\" to \"#12569, #14772\".",
    "created_at": "2013-07-15T11:57:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141785",
    "user": "https://github.com/darijgr"
}
```

**Changing dependencies** from "#12569" to "#12569, #14772".



---

archive/issue_events_103876.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-07-15T11:57:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103876"
}
```



---

archive/issue_events_103877.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-07-15T11:57:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103877"
}
```



---

archive/issue_comments_141786.json:
```json
{
    "body": "<a id='comment:10'></a>\nMethods added to the index. Patch reviewed and rebased upon #14772.",
    "created_at": "2013-07-15T11:57:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141786",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:10'></a>
Methods added to the index. Patch reviewed and rebased upon #14772.



---

archive/issue_comments_141787.json:
```json
{
    "body": "**Changing reviewer** from \"Florent Hivert\" to \"Florent Hivert, Darij Grinberg\".",
    "created_at": "2013-07-15T11:57:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141787",
    "user": "https://github.com/darijgr"
}
```

**Changing reviewer** from "Florent Hivert" to "Florent Hivert, Darij Grinberg".



---

archive/issue_events_103878.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:28:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103878"
}
```



---

archive/issue_events_103879.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:28:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103879"
}
```



---

archive/issue_comments_141788.json:
```json
{
    "body": "**Changing dependencies** from \"#12569, #14772\" to \"#12569, #14772, #8386, #14519, #14808, #14143, #14015, #14516\".",
    "created_at": "2013-08-02T14:48:57Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141788",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#12569, #14772" to "#12569, #14772, #8386, #14519, #14808, #14143, #14015, #14516".



---

archive/issue_events_103880.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:48:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103880"
}
```



---

archive/issue_events_103881.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-02T14:48:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103881"
}
```



---

archive/issue_events_103882.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-11T01:09:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103882"
}
```



---

archive/issue_events_103883.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2013-08-11T01:09:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103883"
}
```



---

archive/issue_comments_141789.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe documentation has problems:\n\n```\ndochtml.log:[combinat ] /mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/combinat/permutation.py:docstring of sage.combinat.permutation:5: WARNING: Bullet list ends without a blank line; unexpected unindent.\n```",
    "created_at": "2013-08-21T12:15:13Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141789",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
The documentation has problems:

```
dochtml.log:[combinat ] /mazur/release/merger/sage-5.12.beta4/local/lib/python2.7/site-packages/sage/combinat/permutation.py:docstring of sage.combinat.permutation:5: WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

archive/issue_events_103884.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-21T12:15:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103884"
}
```



---

archive/issue_events_103885.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-21T12:15:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103885"
}
```



---

archive/attachments_016914.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12571-shifted_shuffle_of_permutations-reviewed.patch",
    "asset_url": "tarball://root/attachments/ticket12571/trac_12571-shifted_shuffle_of_permutations-reviewed.patch",
    "created_at": "2013-08-21T13:03:09Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12571/trac_12571-shifted_shuffle_of_permutations-reviewed.patch",
    "user": "https://github.com/darijgr"
}
```



---

archive/issue_comments_141790.json:
```json
{
    "body": "Attachment [trac_12571-shifted_shuffle_of_permutations-reviewed.patch](https://github.com/sagemath/sage/files/ticket12571/trac_12571-shifted_shuffle_of_permutations-reviewed.patch) by @darijgr created at 2013-08-21 13:03:09\n\nreviewed version, qfolded with the patch so as to avoid fuzz when applying the old patch after #14772. I added some more doctests and docstring text. Now rebased upon current version of #14772. Now with fixed docstring.",
    "created_at": "2013-08-21T13:03:09Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141790",
    "user": "https://github.com/darijgr"
}
```

Attachment [trac_12571-shifted_shuffle_of_permutations-reviewed.patch](https://github.com/sagemath/sage/files/ticket12571/trac_12571-shifted_shuffle_of_permutations-reviewed.patch) by @darijgr created at 2013-08-21 13:03:09

reviewed version, qfolded with the patch so as to avoid fuzz when applying the old patch after #14772. I added some more doctests and docstring text. Now rebased upon current version of #14772. Now with fixed docstring.



---

archive/issue_events_103886.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-08-21T13:04:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103886"
}
```



---

archive/issue_events_103887.json:
```json
{
    "actor": "https://github.com/darijgr",
    "created_at": "2013-08-21T13:04:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103887"
}
```



---

archive/issue_comments_141791.json:
```json
{
    "body": "<a id='comment:16'></a>\nGood point. There was an INPUT item split across two lines, and the second line was not indented to the same level as the first. I assume this was obvious enough to revert to positive_review.",
    "created_at": "2013-08-21T13:04:20Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141791",
    "user": "https://github.com/darijgr"
}
```

<a id='comment:16'></a>
Good point. There was an INPUT item split across two lines, and the second line was not indented to the same level as the first. I assume this was obvious enough to revert to positive_review.



---

archive/issue_comments_141792.json:
```json
{
    "body": "**Merged:** sage-5.12.beta5",
    "created_at": "2013-09-02T10:20:24Z",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12571#issuecomment-141792",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.12.beta5



---

archive/issue_events_103888.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-02T10:20:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103888"
}
```



---

archive/issue_events_103889.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-09-02T10:20:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12571",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12571#event-103889"
}
```
