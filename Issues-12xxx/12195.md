# Issue 12195: numerical_approx broken for vectors

archive/issues_012023.json:
```json
{
    "body": "#1294 implemented `n()` but not `N()` or the functional `numerical_approx`\n\n**Apply:**\n1.  [attachment:trac_12195-numerical-approx-v3.patch]\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @rbeezer @jasongrout\n\n**Keywords:** sd40.5\n\n**Reviewer:** Rob Beezer, William Stein, Dan Drake\n\n**Author:** Robert Bradshaw, Rob Beezer, William Stein\n\n**Merged:** sage-5.1.beta4\n\nIssue created by migration from https://trac.sagemath.org/ticket/12195\n\n",
    "closed_at": "2012-06-14T06:39:17Z",
    "created_at": "2011-12-20T09:27:33Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "numerical_approx broken for vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12195",
    "user": "https://github.com/robertwb"
}
```
#1294 implemented `n()` but not `N()` or the functional `numerical_approx`

**Apply:**
1.  [attachment:trac_12195-numerical-approx-v3.patch]

**Assignee:** @jasongrout, @williamstein

**CC:**  @rbeezer @jasongrout

**Keywords:** sd40.5

**Reviewer:** Rob Beezer, William Stein, Dan Drake

**Author:** Robert Bradshaw, Rob Beezer, William Stein

**Merged:** sage-5.1.beta4

Issue created by migration from https://trac.sagemath.org/ticket/12195





---

archive/attachments_016337.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "12195-numerical_approx.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12195/12195-numerical_approx.patch",
    "created_at": "2011-12-20T09:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_164246.json:
```json
{
    "body": "",
    "created_at": "2011-12-20T09:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164246",
    "user": "https://github.com/robertwb"
}
```





---

archive/issue_comments_164247.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-12-20T09:30:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164247",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_164248.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-#1294 implemented {{n()}} but not {{N()}} or the functional {{numerical_approx}}\n+#1294 implemented `n()` but not `N()` or the functional `numerical_approx`\n``````\n",
    "created_at": "2011-12-20T09:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164248",
    "user": "https://github.com/robertwb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-#1294 implemented {{n()}} but not {{N()}} or the functional {{numerical_approx}}
+#1294 implemented `n()` but not `N()` or the functional `numerical_approx`
``````




---

archive/issue_comments_164249.json:
```json
{
    "body": "<a id='comment:3'></a>\nRobert,\n\nLooks good, and very welcome.  I should have noticed, and fixed, this omission during my big push last year.  Looks ready for a positive review, but I have two questions.\n\n1.  Could this make the  `.n()` method (immediate prior in source) obsolete?\n\n2.  This does not seem to show up explicitly anywhere in the documentation.  Doing `v.N?` on an integer vector `v` seems to just give the generic documentation for a numerical approximation to a single scalar.  For matrices, the approach is different.  A bit more code, and not overriding the scalar method:  Plus: explicit documentation.  Minus: duplication of code, including a really bad approximation of `log 10` as discussed recently on sage-devel.\n\nA suggestion - add a doctest in this patch for the generic method exhibiting application to vectors.  If that's agreeable, I'll make a ticket to have matrices follow the model of this ticket (and maybe even do it).  \n\nRob",
    "created_at": "2011-12-20T18:28:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164249",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>
Robert,

Looks good, and very welcome.  I should have noticed, and fixed, this omission during my big push last year.  Looks ready for a positive review, but I have two questions.

1.  Could this make the  `.n()` method (immediate prior in source) obsolete?

2.  This does not seem to show up explicitly anywhere in the documentation.  Doing `v.N?` on an integer vector `v` seems to just give the generic documentation for a numerical approximation to a single scalar.  For matrices, the approach is different.  A bit more code, and not overriding the scalar method:  Plus: explicit documentation.  Minus: duplication of code, including a really bad approximation of `log 10` as discussed recently on sage-devel.

A suggestion - add a doctest in this patch for the generic method exhibiting application to vectors.  If that's agreeable, I'll make a ticket to have matrices follow the model of this ticket (and maybe even do it).  

Rob



---

archive/issue_comments_164250.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd40.5\".",
    "created_at": "2012-05-25T23:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164250",
    "user": "https://github.com/williamstein"
}
```

**Changing keywords** from "" to "sd40.5".



---

archive/issue_comments_164251.json:
```json
{
    "body": "**Author:** robertwb",
    "created_at": "2012-05-25T23:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164251",
    "user": "https://github.com/williamstein"
}
```

**Author:** robertwb



---

archive/issue_comments_164252.json:
```json
{
    "body": "**Reviewer:** Rob Beezer, William Stein",
    "created_at": "2012-05-25T23:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164252",
    "user": "https://github.com/williamstein"
}
```

**Reviewer:** Rob Beezer, William Stein



---

archive/issue_comments_164253.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis clearly needs work. Rob's point about there being an n method right before is serious.  That should be deleted, and was the result of somebody not understanding the architecture of N...",
    "created_at": "2012-05-25T23:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164253",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>
This clearly needs work. Rob's point about there being an n method right before is serious.  That should be deleted, and was the result of somebody not understanding the architecture of N...



---

archive/issue_comments_164254.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-05-25T23:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164254",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_164255.json:
```json
{
    "body": "I fixed the patch by deleting the n function before.  Looks great!",
    "created_at": "2012-05-26T06:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164255",
    "user": "https://github.com/williamstein"
}
```

I fixed the patch by deleting the n function before.  Looks great!



---

archive/attachments_016338.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "12195-numerical_approx.2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12195/12195-numerical_approx.2.patch",
    "created_at": "2012-05-26T06:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_164256.json:
```json
{
    "body": "<a id='comment:6'></a>\napply only:  12195-numerical_approx.2.patch",
    "created_at": "2012-05-26T06:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164256",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>
apply only:  12195-numerical_approx.2.patch



---

archive/issue_comments_164257.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2012-05-26T06:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164257",
    "user": "https://github.com/williamstein"
}
```

**Changing status** from needs_work to positive_review.



---

archive/attachments_016339.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12195-numerical-approx-v3.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12195/trac_12195-numerical-approx-v3.patch",
    "created_at": "2012-05-27T02:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/rbeezer"
}
```



---

archive/issue_comments_164258.json:
```json
{
    "body": "",
    "created_at": "2012-05-27T02:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164258",
    "user": "https://github.com/rbeezer"
}
```





---

archive/issue_comments_164259.json:
```json
{
    "body": "**Changing author** from \"robertwb\" to \"Robert Bradshaw, Rob Beezer, William Stein\".",
    "created_at": "2012-05-27T02:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164259",
    "user": "https://github.com/rbeezer"
}
```

**Changing author** from "robertwb" to "Robert Bradshaw, Rob Beezer, William Stein".



---

archive/issue_comments_164260.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n #1294 implemented `n()` but not `N()` or the functional `numerical_approx`\n+\n+**Apply:**\n+1.  [attachment:trac_12195-numerical-approx-v3.patch]\n``````\n",
    "created_at": "2012-05-27T02:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164260",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,4 @@
 #1294 implemented `n()` but not `N()` or the functional `numerical_approx`
+
+**Apply:**
+1.  [attachment:trac_12195-numerical-approx-v3.patch]
``````




---

archive/issue_comments_164261.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2012-05-27T02:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164261",
    "user": "https://github.com/rbeezer"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_164262.json:
```json
{
    "body": "<a id='comment:7'></a>\n* Previous patches had the `_numerical_approx` function in the generic dense class, and specialized classes (such as rational dense) derive directly from the plain free module element class.  Thus the method was invisible to those specialized classes and only \"generic\" vectors could use this.  So I took William's version of the function and moved it up to a higher level.\n\n  * Removed a pile of `n()` methods, but preserved many of their doctests in the new method.\n\n  * Could not resist poking at the documentation of `misc.functional.numerical_approx`, so there was a drive-by upgrade there.\n\n  * Improved the passing of `prec` and `digits` in one or two places.\n\n  * Reworked the sparse case slightly and added a doctest to make sure it was not being clobbered.\n\n  * Passes all tests.\n\n  * Seemingly other places to look for removal, almost all outside my expertise.  Maybe I should put these on a new ticket for safekeeping?  The one for graphs is OK and does not need any inspection.\n\n    ```        \n    sage: search_src('def n\\(')\n    modular/abvar/morphism.py:801:    def n(self):\n    modules/vector_mod2_dense.pyx:447:    def n(self, *args, **kwargs):\n    interfaces/qsieve.py:176:    def n(self):\n    schemes/elliptic_curves/heegner.py:4386:    def n(self):\n    schemes/elliptic_curves/ell_curve_isogeny.py:3468:    def n(self):\n    \n    sage: search_src('def N\\(')\n    modular/modsym/p1list.pyx:1165:    def N(self):\n    modular/modsym/p1list_nf.py:261:    def N(self):\n    modular/modsym/p1list_nf.py:642:    def N(self):\n    modular/quatalg/brandt.py:534:    def N(self):\n    graphs/generic_graph_pyx.pyx:356:def N(n):\n    \n    sage: search_src('def numerical_approx\\(')\n    misc/functional.py:1196:def numerical_approx(x, prec=None, digits=None):\n    schemes/elliptic_curves/heegner.py:3127:    def numerical_approx(self, prec=53):\n    schemes/elliptic_curves/heegner.py:3979:    def numerical_approx(self, prec=53):\n    \n    sage: search_src('def _numerical_approx\\(')\n    matrix/matrix2.pyx:10332:    def _numerical_approx(self,prec=None,digits=None):\n    modules/free_module_element.pyx:991:    def _numerical_approx(self, prec=None, digits=None):\n    modules/free_module_element.pyx:4361:    def _numerical_approx(self, prec=None, digits=None):\n    symbolic/expression.pyx:4053:    def _numerical_approx(self, prec=None, digits=None):\n```",
    "created_at": "2012-05-27T02:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164262",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:7'></a>
* Previous patches had the `_numerical_approx` function in the generic dense class, and specialized classes (such as rational dense) derive directly from the plain free module element class.  Thus the method was invisible to those specialized classes and only "generic" vectors could use this.  So I took William's version of the function and moved it up to a higher level.

  * Removed a pile of `n()` methods, but preserved many of their doctests in the new method.

  * Could not resist poking at the documentation of `misc.functional.numerical_approx`, so there was a drive-by upgrade there.

  * Improved the passing of `prec` and `digits` in one or two places.

  * Reworked the sparse case slightly and added a doctest to make sure it was not being clobbered.

  * Passes all tests.

  * Seemingly other places to look for removal, almost all outside my expertise.  Maybe I should put these on a new ticket for safekeeping?  The one for graphs is OK and does not need any inspection.

    ```        
    sage: search_src('def n\(')
    modular/abvar/morphism.py:801:    def n(self):
    modules/vector_mod2_dense.pyx:447:    def n(self, *args, **kwargs):
    interfaces/qsieve.py:176:    def n(self):
    schemes/elliptic_curves/heegner.py:4386:    def n(self):
    schemes/elliptic_curves/ell_curve_isogeny.py:3468:    def n(self):
    
    sage: search_src('def N\(')
    modular/modsym/p1list.pyx:1165:    def N(self):
    modular/modsym/p1list_nf.py:261:    def N(self):
    modular/modsym/p1list_nf.py:642:    def N(self):
    modular/quatalg/brandt.py:534:    def N(self):
    graphs/generic_graph_pyx.pyx:356:def N(n):
    
    sage: search_src('def numerical_approx\(')
    misc/functional.py:1196:def numerical_approx(x, prec=None, digits=None):
    schemes/elliptic_curves/heegner.py:3127:    def numerical_approx(self, prec=53):
    schemes/elliptic_curves/heegner.py:3979:    def numerical_approx(self, prec=53):
    
    sage: search_src('def _numerical_approx\(')
    matrix/matrix2.pyx:10332:    def _numerical_approx(self,prec=None,digits=None):
    modules/free_module_element.pyx:991:    def _numerical_approx(self, prec=None, digits=None):
    modules/free_module_element.pyx:4361:    def _numerical_approx(self, prec=None, digits=None):
    symbolic/expression.pyx:4053:    def _numerical_approx(self, prec=None, digits=None):
```



---

archive/issue_comments_164263.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-05-27T02:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164263",
    "user": "https://github.com/rbeezer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_164264.json:
```json
{
    "body": "<a id='comment:9'></a>\nHello patchbot, please apply trac_12195-numerical-approx-v3.patch\n\nThank you",
    "created_at": "2012-05-27T06:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164264",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:9'></a>
Hello patchbot, please apply trac_12195-numerical-approx-v3.patch

Thank you



---

archive/issue_comments_164265.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-27T06:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164265",
    "user": "https://github.com/dandrake"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_164266.json:
```json
{
    "body": "**Changing reviewer** from \"Rob Beezer, William Stein\" to \"Rob Beezer, William Stein, Dan Drake\".",
    "created_at": "2012-05-27T06:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164266",
    "user": "https://github.com/dandrake"
}
```

**Changing reviewer** from "Rob Beezer, William Stein" to "Rob Beezer, William Stein, Dan Drake".



---

archive/issue_events_038432.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-14T06:39:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12195#event-38432"
}
```



---

archive/issue_comments_164267.json:
```json
{
    "body": "**Merged:** sage-5.1.beta4",
    "created_at": "2012-06-14T06:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12195",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12195#issuecomment-164267",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta4
