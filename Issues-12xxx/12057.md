# Issue 12057: Upgrade R (r-project.org)

archive/issues_011885.json:
```json
{
    "body": "The current version of R (r-project) disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.\n\n\nThere is no other change except for the source code and a rediffed `patches/R.sh.in`\n\nOn an unrelated note, it would be nice if tickets talking about R would contain \"r-project\" on trac since it is otherwise hopeless to search for.\n\n**Apply**:\n1. spkg [http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg](http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg)\n2. [attachment:trac_12057_fix_doctests.patch](https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch)\n\nThe upgraded spkg also fixes #12065.\n\n**Assignee:** amhou\n\n**CC:**  @nexttime @jdemeyer @jasongrout\n\n**Keywords:** R spkg r-project graphics PNG X11\n\n**Author:** Volker Braun\n\n**Reviewer:** Karl-Dieter Crisman, Jeroen Demeyer\n\n**Merged:** sage-4.8.alpha4\n\nIssue created by migration from https://trac.sagemath.org/ticket/12057\n\n",
    "closed_at": "2011-12-10T10:40:58Z",
    "created_at": "2011-11-19T22:08:30Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "title": "Upgrade R (r-project.org)",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12057",
    "user": "https://github.com/vbraun"
}
```
The current version of R (r-project) disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.


There is no other change except for the source code and a rediffed `patches/R.sh.in`

On an unrelated note, it would be nice if tickets talking about R would contain "r-project" on trac since it is otherwise hopeless to search for.

**Apply**:
1. spkg [http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg](http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg)
2. [attachment:trac_12057_fix_doctests.patch](https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch)

The upgraded spkg also fixes #12065.

**Assignee:** amhou

**CC:**  @nexttime @jdemeyer @jasongrout

**Keywords:** R spkg r-project graphics PNG X11

**Author:** Volker Braun

**Reviewer:** Karl-Dieter Crisman, Jeroen Demeyer

**Merged:** sage-4.8.alpha4

Issue created by migration from https://trac.sagemath.org/ticket/12057





---

archive/issue_comments_130557.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n-The current version of R disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.\n+The current version of R (r-project) disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.\n \n-There is no other change.\n+http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg\n \n-On an unrelated note, it would be nice if R would be referred to as r-project on trac since it is otherwise hopeless to search for it.\n+There is no other change except for the source code and a rediffed `patches/R.sh.in`\n+\n+On an unrelated note, it would be nice if tickets talking about R would contain \"r-project\" on trac since it is otherwise hopeless to search for.\n``````\n",
    "created_at": "2011-11-19T22:13:16Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130557",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,7 @@
-The current version of R disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.
+The current version of R (r-project) disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.
 
-There is no other change.
+http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg
 
-On an unrelated note, it would be nice if R would be referred to as r-project on trac since it is otherwise hopeless to search for it.
+There is no other change except for the source code and a rediffed `patches/R.sh.in`
+
+On an unrelated note, it would be nice if tickets talking about R would contain "r-project" on trac since it is otherwise hopeless to search for.
``````




---

archive/issue_events_097644.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-11-19T22:13:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97644"
}
```



---

archive/issue_events_097645.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-11-19T22:13:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97645"
}
```



---

archive/issue_comments_130558.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis ticket obsoletes #8868",
    "created_at": "2011-11-19T22:18:40Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130558",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:2'></a>
This ticket obsoletes #8868



---

archive/issue_comments_130559.json:
```json
{
    "body": "<a id='comment:3'></a>\nHmm, I don't mind this in theory.  I'd want to test it out a little.   Can you point to one of the R announcements where they end up fixing this?  They have *very* detailed and thorough announcements, which I usually cannot make it all the way through when searching for this sort of thing.\n\nAlso, does this mean we don't need libpango or cairo or all that stuff?  Or would we still need that?\n\nSome relevant things.\n* Re: #8868 - One concern is whether it *always* makes graphics work - OS X, Linux, Solaris.  Otherwise I wouldn't want to re-enable the doctests, which are currently optional.  If they work, then this ticket should enable them.\n* Great idea on the r-project.  I always put R things that are not about statistics per se in the \"packages\" component.    I'm updating others now.\n* Leif has put a lot of work in separating rpy from R at #9906.  I'm not sure what should have priority, though, given that we are fairly behind the times and reviewing #9906 is a boatload of work.\n \nHere are a bunch of other relevant tickets which perhaps (?) should be addressed here, or at least mentioned.\n* #7865 R on 64-bit Solaris C and Fortran mixing\n* #7664 R and Latex\n* #9668 hardcoding paths in R binary\n* #11970 readline issues on Oneric Ocelot or something\n* #10967 more issues with the script\n* #11249 R graphics occasionally living in weird places",
    "created_at": "2011-11-20T01:25:28Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130559",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
Hmm, I don't mind this in theory.  I'd want to test it out a little.   Can you point to one of the R announcements where they end up fixing this?  They have *very* detailed and thorough announcements, which I usually cannot make it all the way through when searching for this sort of thing.

Also, does this mean we don't need libpango or cairo or all that stuff?  Or would we still need that?

Some relevant things.
* Re: #8868 - One concern is whether it *always* makes graphics work - OS X, Linux, Solaris.  Otherwise I wouldn't want to re-enable the doctests, which are currently optional.  If they work, then this ticket should enable them.
* Great idea on the r-project.  I always put R things that are not about statistics per se in the "packages" component.    I'm updating others now.
* Leif has put a lot of work in separating rpy from R at #9906.  I'm not sure what should have priority, though, given that we are fairly behind the times and reviewing #9906 is a boatload of work.
 
Here are a bunch of other relevant tickets which perhaps (?) should be addressed here, or at least mentioned.
* #7865 R on 64-bit Solaris C and Fortran mixing
* #7664 R and Latex
* #9668 hardcoding paths in R binary
* #11970 readline issues on Oneric Ocelot or something
* #10967 more issues with the script
* #11249 R graphics occasionally living in weird places



---

archive/issue_comments_130560.json:
```json
{
    "body": "<a id='comment:4'></a>\nYou still need cairo+pango+fontconfig+fonts; R doesn't include fonts or a font renderer. But it works now in the virtual machine without X installed. I don't have a reference for the release announcement where it was fixed.\n\nGiven that we get relatively frequent requests for R graphics in the virtual machine I would prefer it if we could get this ticket reviewed asap. Really all there is to do is regression testing, and the easiest way to do so is to run it on the build bot.",
    "created_at": "2011-11-20T11:27:19Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130560",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:4'></a>
You still need cairo+pango+fontconfig+fonts; R doesn't include fonts or a font renderer. But it works now in the virtual machine without X installed. I don't have a reference for the release announcement where it was fixed.

Given that we get relatively frequent requests for R graphics in the virtual machine I would prefer it if we could get this ticket reviewed asap. Really all there is to do is regression testing, and the easiest way to do so is to run it on the build bot.



---

archive/issue_comments_130561.json:
```json
{
    "body": "**Changing keywords** from \"R r-project graphics\" to \"R spkg r-project graphics PNG X11\".",
    "created_at": "2011-11-20T18:57:22Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130561",
    "user": "https://github.com/nexttime"
}
```

**Changing keywords** from "R r-project graphics" to "R spkg r-project graphics PNG X11".



---

archive/issue_comments_130562.json:
```json
{
    "body": "Replying to [ticket:12057 vbraun]:\n> On an unrelated note, it would be nice if tickets talking about R would contain \"r-project\" on trac since it is otherwise hopeless to search for.\n\nYou can also [search trac for \"R\" with Google](http://groups.google.com/group/sage-trac/search?group=sage-trac&q=R&hl=en).\n\n\n\n\nI intentionally did not (yet) update R or RPy on #9906 or #9668.  #11970 is rather unrelated to R itself; it fixes the readline spkg.  #10967 could in principle be closed as invalid, as the R script in `$SAGE_LOCAL/bin/` is not intended to be run directly; one should instead use `sage --R ...` (although adding a sanity check to the script doesn't hurt, which I did or intended to do on #9668, which depends on #9906...).",
    "created_at": "2011-11-20T18:57:22Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130562",
    "user": "https://github.com/nexttime"
}
```

Replying to [ticket:12057 vbraun]:
> On an unrelated note, it would be nice if tickets talking about R would contain "r-project" on trac since it is otherwise hopeless to search for.

You can also [search trac for "R" with Google](http://groups.google.com/group/sage-trac/search?group=sage-trac&q=R&hl=en).




I intentionally did not (yet) update R or RPy on #9906 or #9668.  #11970 is rather unrelated to R itself; it fixes the readline spkg.  #10967 could in principle be closed as invalid, as the R script in `$SAGE_LOCAL/bin/` is not intended to be run directly; one should instead use `sage --R ...` (although adding a sanity check to the script doesn't hurt, which I did or intended to do on #9668, which depends on #9906...).



---

archive/issue_events_097646.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-20T18:57:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97646"
}
```



---

archive/issue_events_097647.json:
```json
{
    "actor": "https://github.com/nexttime",
    "created_at": "2011-11-20T18:57:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97647"
}
```



---

archive/issue_events_097648.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-11-21T09:30:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97648"
}
```



---

archive/issue_comments_130563.json:
```json
{
    "body": "<a id='comment:6'></a>\nCan we get the updated R spkg into Sage before fixing the laundry list of unrelated issues? None of the tickets leif mentioned is close to resolution. This ticket is ready  to be reviewed and included right now, and I think a large group of users will benefit from being able to use graphics in the virtual machine.",
    "created_at": "2011-11-21T09:30:59Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130563",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Can we get the updated R spkg into Sage before fixing the laundry list of unrelated issues? None of the tickets leif mentioned is close to resolution. This ticket is ready  to be reviewed and included right now, and I think a large group of users will benefit from being able to use graphics in the virtual machine.



---

archive/issue_comments_130564.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vbraun](#comment%3A6):\n> Can we get the updated R spkg into Sage before fixing the laundry list of unrelated issues? None of the tickets leif mentioned is close to resolution. This ticket is ready  to be reviewed and included right now, and I think a large group of users will benefit from being able to use graphics in the virtual machine.\n\nI think that given Leif's lukewarmness on this and Volker's adamance, along with my own natural inclination, let's go for it.   My guess is that we may not even need to backport everything for the others... ?\n\nTesting on OSX 10.4 PPC now :)\n\nDid you notice whether  there were any needed patches in a `-t -long` situation?",
    "created_at": "2011-11-21T13:55:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130564",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
Replying to [vbraun](#comment%3A6):
> Can we get the updated R spkg into Sage before fixing the laundry list of unrelated issues? None of the tickets leif mentioned is close to resolution. This ticket is ready  to be reviewed and included right now, and I think a large group of users will benefit from being able to use graphics in the virtual machine.

I think that given Leif's lukewarmness on this and Volker's adamance, along with my own natural inclination, let's go for it.   My guess is that we may not even need to backport everything for the others... ?

Testing on OSX 10.4 PPC now :)

Did you notice whether  there were any needed patches in a `-t -long` situation?



---

archive/issue_comments_130565.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n There is no other change except for the source code and a rediffed `patches/R.sh.in`\n \n On an unrelated note, it would be nice if tickets talking about R would contain \"r-project\" on trac since it is otherwise hopeless to search for.\n+\n+Apply trac_12057_fix_doctests.patch\n``````\n",
    "created_at": "2011-11-21T17:02:45Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130565",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 There is no other change except for the source code and a rediffed `patches/R.sh.in`
 
 On an unrelated note, it would be nice if tickets talking about R would contain "r-project" on trac since it is otherwise hopeless to search for.
+
+Apply trac_12057_fix_doctests.patch
``````




---

archive/issue_comments_130566.json:
```json
{
    "body": "<a id='comment:8'></a>\nPatch attached for some small changes in `sage/interfaces/r.py`. Highlights are that R now returns the class as ordered list and that it doesn't accept the somewhat spurious 'source(file=file(...))' construct that we feed it.",
    "created_at": "2011-11-21T17:02:45Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130566",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Patch attached for some small changes in `sage/interfaces/r.py`. Highlights are that R now returns the class as ordered list and that it doesn't accept the somewhat spurious 'source(file=file(...))' construct that we feed it.



---

archive/issue_comments_130567.json:
```json
{
    "body": "<a id='comment:9'></a>\nQuestions:\n* Won't \n\n```\nreturn 'file=file(\"%s\",open=\"r\")\\nsource(file)'%filename \n```\n   cause problems if someone wants to use the `file` command again, or is that local in scope?\n* Also, might as well add to reference manual if it's now all formatted correctly?  Should just be one line adding it to the toc or something...\n* Is it possible to provide a VM doing what you showed works I could download into my VirtualBox, or is that too much work?\n\nOnce I'm done testing it installs I'll be more formal in looking at this.  What a great thing to do, thank you much!",
    "created_at": "2011-11-21T18:46:11Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130567",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
Questions:
* Won't 

```
return 'file=file("%s",open="r")\nsource(file)'%filename 
```
   cause problems if someone wants to use the `file` command again, or is that local in scope?
* Also, might as well add to reference manual if it's now all formatted correctly?  Should just be one line adding it to the toc or something...
* Is it possible to provide a VM doing what you showed works I could download into my VirtualBox, or is that too much work?

Once I'm done testing it installs I'll be more formal in looking at this.  What a great thing to do, thank you much!



---

archive/issue_comments_130568.json:
```json
{
    "body": "<a id='comment:10'></a>\nOn sage.math, I get:\n\n```\nmake[6]: Entering directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\nMakefile:111: *** multiple target patterns.  Stop.\nmake[6]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\nmake[5]: *** [R] Error 2\nmake[5]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\nmake[4]: *** [make.X11] Error 2\nmake[4]: *** Waiting for unfinished jobs....\n```",
    "created_at": "2011-11-21T19:53:54Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130568",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
On sage.math, I get:

```
make[6]: Entering directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
Makefile:111: *** multiple target patterns.  Stop.
make[6]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
make[5]: *** [R] Error 2
make[5]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
make[4]: *** [make.X11] Error 2
make[4]: *** Waiting for unfinished jobs....
```



---

archive/issue_events_097649.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-21T19:53:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97649"
}
```



---

archive/issue_events_097650.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-11-21T19:53:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97650"
}
```



---

archive/issue_comments_130569.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [kcrisman](#comment%3A9):\n> * Won't [...] cause problems if someone wants to use the `file` command again, or is that local in scope?\n\nFunctions can't be lvalues in R, so its fine though maybe not beautiful:\n\n```\n> file=123\n> file\n[1] 123\n> file('test.txt')\ndescription       class        mode        text      opened    can read \n \"test.txt\"      \"file\"         \"r\"      \"text\"    \"closed\"       \"yes\" \n  can write \n      \"yes\" \n> file\n[1] 123\n```\n\n> * Also, might as well add to reference manual if it's now all formatted correctly?  Should just be one line adding it to the toc or something...\n\nI only patched up the sphinx breakage where I fixed things. There are still 2kloc to go, but I didn't want to break each and every patch for `sage/interfaces/r.py` on trac...\n\n> * Is it possible to provide a VM doing what you showed works I could download into my VirtualBox, or is that too much work?\n\nYou just have to recompile the new R in my virtual machine and it'll basically work. You need to install fonts, though, otherwise all text in the plots will be emtpy squares.",
    "created_at": "2011-11-21T20:13:41Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130569",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:11'></a>
Replying to [kcrisman](#comment%3A9):
> * Won't [...] cause problems if someone wants to use the `file` command again, or is that local in scope?

Functions can't be lvalues in R, so its fine though maybe not beautiful:

```
> file=123
> file
[1] 123
> file('test.txt')
description       class        mode        text      opened    can read 
 "test.txt"      "file"         "r"      "text"    "closed"       "yes" 
  can write 
      "yes" 
> file
[1] 123
```

> * Also, might as well add to reference manual if it's now all formatted correctly?  Should just be one line adding it to the toc or something...

I only patched up the sphinx breakage where I fixed things. There are still 2kloc to go, but I didn't want to break each and every patch for `sage/interfaces/r.py` on trac...

> * Is it possible to provide a VM doing what you showed works I could download into my VirtualBox, or is that too much work?

You just have to recompile the new R in my virtual machine and it'll basically work. You need to install fonts, though, otherwise all text in the plots will be emtpy squares.



---

archive/attachments_016615.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12057_fix_doctests.patch",
    "asset_url": "tarball://root/attachments/ticket12057/trac_12057_fix_doctests.patch",
    "created_at": "2011-11-21T20:15:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch",
    "user": "https://github.com/vbraun"
}
```



---

archive/issue_comments_130570.json:
```json
{
    "body": "**Attachment:** [trac_12057_fix_doctests.patch](https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch)\n\nMinor docstring fix.",
    "created_at": "2011-11-21T20:15:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130570",
    "user": "https://github.com/vbraun"
}
```

**Attachment:** [trac_12057_fix_doctests.patch](https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch)

Minor docstring fix.



---

archive/issue_comments_130571.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jdemeyer](#comment%3A10):\n> On sage.math, I get:\n> \n> ```\n> make[6]: Entering directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\n> Makefile:111: *** multiple target patterns.  Stop.\n> make[6]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\n> make[5]: *** [R] Error 2\n> make[5]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\n> make[4]: *** [make.X11] Error 2\n> make[4]: *** Waiting for unfinished jobs....\n> ```\n\nI just built on sage.math and it worked for me (20x parallel). I'm using sage-4.8.alpha2, though. Did you merge anything in alpha3 that might cause this?",
    "created_at": "2011-11-21T20:59:35Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130571",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
Replying to [jdemeyer](#comment%3A10):
> On sage.math, I get:
> 
> ```
> make[6]: Entering directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
> Makefile:111: *** multiple target patterns.  Stop.
> make[6]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
> make[5]: *** [R] Error 2
> make[5]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
> make[4]: *** [make.X11] Error 2
> make[4]: *** Waiting for unfinished jobs....
> ```

I just built on sage.math and it worked for me (20x parallel). I'm using sage-4.8.alpha2, though. Did you merge anything in alpha3 that might cause this?



---

archive/issue_comments_130572.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [vbraun](#comment%3A12):\n> Replying to [jdemeyer](#comment%3A10):\n> > On sage.math, I get:\n> > \n> > ```\n> > make[6]: Entering directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\n> > Makefile:111: *** multiple target patterns.  Stop.\n> > make[6]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\n> > make[5]: *** [R] Error 2\n> > make[5]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'\n> > make[4]: *** [make.X11] Error 2\n> > make[4]: *** Waiting for unfinished jobs....\n> > ```\n\n> \n> I just built on sage.math and it worked for me (20x parallel). I'm using sage-4.8.alpha2, though.\n\nWell, it could be some strange error happening only sporadically.  Or, an error which happens only if Sage is built from scratch (as opposed to installing the spkg in an existing Sage build).  I will try again later.\n\n> Did you merge anything in alpha3 that might cause this?\n\nI don't think so.",
    "created_at": "2011-11-21T21:05:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130572",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [vbraun](#comment%3A12):
> Replying to [jdemeyer](#comment%3A10):
> > On sage.math, I get:
> > 
> > ```
> > make[6]: Entering directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
> > Makefile:111: *** multiple target patterns.  Stop.
> > make[6]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
> > make[5]: *** [R] Error 2
> > make[5]: Leaving directory `/mnt/usb1/scratch/jdemeyer/merger/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/src/modules/X11'
> > make[4]: *** [make.X11] Error 2
> > make[4]: *** Waiting for unfinished jobs....
> > ```

> 
> I just built on sage.math and it worked for me (20x parallel). I'm using sage-4.8.alpha2, though.

Well, it could be some strange error happening only sporadically.  Or, an error which happens only if Sage is built from scratch (as opposed to installing the spkg in an existing Sage build).  I will try again later.

> Did you merge anything in alpha3 that might cause this?

I don't think so.



---

archive/issue_comments_130573.json:
```json
{
    "body": "<a id='comment:14'></a>\nFor what it's worth, I took sage-4.8.alpha2, replaced the R spkg with this one, and merged the Sage library patch.  Then I built from scratch (on sage.math) and all tests passed.  I'm also trying on OS X 10.6.8: the build has succeeded, and doctests are still going.",
    "created_at": "2011-11-21T23:49:32Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130573",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
For what it's worth, I took sage-4.8.alpha2, replaced the R spkg with this one, and merged the Sage library patch.  Then I built from scratch (on sage.math) and all tests passed.  I'm also trying on OS X 10.6.8: the build has succeeded, and doctests are still going.



---

archive/issue_comments_130574.json:
```json
{
    "body": "<a id='comment:15'></a>\nThat answered most of my questions.\n> > * Is it possible to provide a VM doing what you showed works I could download into my VirtualBox, or is that too much work?\n\n> \n> You just have to recompile the new R in my virtual machine and it'll basically work. You need to install fonts, though, otherwise all text in the plots will be emtpy squares.\n\nOk, I'll try that.\n\nOther comments:\n* I have no problems on OS X 10.4 PPC with this or the patch.  Passes relevant long optional tests.  That's good!\n* Has anyone tested this on Solaris?   Just because sometimes there are config options which change there which have caused problems in the past.\n* I would suggest that perhaps this should then remove some of the bizarre stuff in spkg-install that checks for the X headers, etc. and only for this reason.   Though I suppose that could still be in another ticket, since that is for X support, and apparently the pngs still appear?  So maybe forget this...\n* This typo probably should be fixed in SPKG.txt, though:\n\n```\n=== r-2.14.0.p0 (Volker Braun, 19th November 2011) ===\n * #12057: upgrade to new upstram version\n```",
    "created_at": "2011-11-22T21:08:33Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130574",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
That answered most of my questions.
> > * Is it possible to provide a VM doing what you showed works I could download into my VirtualBox, or is that too much work?

> 
> You just have to recompile the new R in my virtual machine and it'll basically work. You need to install fonts, though, otherwise all text in the plots will be emtpy squares.

Ok, I'll try that.

Other comments:
* I have no problems on OS X 10.4 PPC with this or the patch.  Passes relevant long optional tests.  That's good!
* Has anyone tested this on Solaris?   Just because sometimes there are config options which change there which have caused problems in the past.
* I would suggest that perhaps this should then remove some of the bizarre stuff in spkg-install that checks for the X headers, etc. and only for this reason.   Though I suppose that could still be in another ticket, since that is for X support, and apparently the pngs still appear?  So maybe forget this...
* This typo probably should be fixed in SPKG.txt, though:

```
=== r-2.14.0.p0 (Volker Braun, 19th November 2011) ===
 * #12057: upgrade to new upstram version
```



---

archive/issue_comments_130575.json:
```json
{
    "body": "<a id='comment:16'></a>\n* I tested it on mark.skynet (sparc solaris) and it works fine\n* I don't want to rewrite the spkg-install right now. This should be done when rpy is separated out.\n* Fixed the typo.\n\nJeroen, did you figure out which problem you encountered on sage.math? It seems to be working for everyone else...",
    "created_at": "2011-11-23T11:37:08Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130575",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:16'></a>
* I tested it on mark.skynet (sparc solaris) and it works fine
* I don't want to rewrite the spkg-install right now. This should be done when rpy is separated out.
* Fixed the typo.

Jeroen, did you figure out which problem you encountered on sage.math? It seems to be working for everyone else...



---

archive/issue_events_097651.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-11-23T11:37:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97651"
}
```



---

archive/issue_events_097652.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2011-11-23T11:37:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97652"
}
```



---

archive/issue_comments_130576.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [vbraun](#comment%3A16):\n> * I tested it on mark.skynet (sparc solaris) and it works fine\n> * I don't want to rewrite the spkg-install right now. This should be done when rpy is separated out.\n> * Fixed the typo.\n> \n> Jeroen, did you figure out which problem you encountered on sage.math? It seems to be working for everyone else...\n\nI managed to compile R on the second attempt.  So it certainly *sometimes* works.  Could be a race condition.",
    "created_at": "2011-11-23T19:29:10Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130576",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [vbraun](#comment%3A16):
> * I tested it on mark.skynet (sparc solaris) and it works fine
> * I don't want to rewrite the spkg-install right now. This should be done when rpy is separated out.
> * Fixed the typo.
> 
> Jeroen, did you figure out which problem you encountered on sage.math? It seems to be working for everyone else...

I managed to compile R on the second attempt.  So it certainly *sometimes* works.  Could be a race condition.



---

archive/issue_comments_130577.json:
```json
{
    "body": "<a id='comment:18'></a>\nDid anyone install this with `SAGE_CHECK=yes`?   On PPC OSX 10.4 I get everything ok until \"running regression tests\" in which `reg-tests-1a` apparently gets an error.    I have not had time to check this on modern Mac or on Linux (sage.math) yet, just saw this when I walked in the office this morning.",
    "created_at": "2011-11-28T13:50:07Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130577",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
Did anyone install this with `SAGE_CHECK=yes`?   On PPC OSX 10.4 I get everything ok until "running regression tests" in which `reg-tests-1a` apparently gets an error.    I have not had time to check this on modern Mac or on Linux (sage.math) yet, just saw this when I walked in the office this morning.



---

archive/issue_comments_130578.json:
```json
{
    "body": "<a id='comment:19'></a>\nFor me (Linux x86_64), the `reg_tests_1a` passes. The testsuite errors out a little bit later on in \n\n```\nrunning tests of Internet and socket functions\n  expect some differences\nmake[3]: Entering directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'\nrunning code in 'internet.R' ...make[3]: *** [internet.Rout] Error 1\nmake[3]: Leaving directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'\nmake[2]: [test-Internet] Error 2 (ignored)\nmake[2]: Leaving directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'\nmake[1]: Leaving directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'\nNow cleaning up tmp files.\nMaking Sage/Python scripts relocatable...\nMaking script relocatable\nFinished installing r-2.14.0.p0.spkg\n```\nprobably because I'm behind a firewall. But it seems like they anticipated that and the error is caught in the R testsuite, so it does not lead to a test failure.",
    "created_at": "2011-11-28T15:34:40Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130578",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>
For me (Linux x86_64), the `reg_tests_1a` passes. The testsuite errors out a little bit later on in 

```
running tests of Internet and socket functions
  expect some differences
make[3]: Entering directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'
running code in 'internet.R' ...make[3]: *** [internet.Rout] Error 1
make[3]: Leaving directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'
make[2]: [test-Internet] Error 2 (ignored)
make[2]: Leaving directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'
make[1]: Leaving directory `/home/vbraun/opt/sage-4.8.alpha2/spkg/build/r-2.14.0.p0/src/tests'
Now cleaning up tmp files.
Making Sage/Python scripts relocatable...
Making script relocatable
Finished installing r-2.14.0.p0.spkg
```
probably because I'm behind a firewall. But it seems like they anticipated that and the error is caught in the R testsuite, so it does not lead to a test failure.



---

archive/issue_comments_130579.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n On an unrelated note, it would be nice if tickets talking about R would contain \"r-project\" on trac since it is otherwise hopeless to search for.\n \n Apply trac_12057_fix_doctests.patch\n+\n+The upgraded spkg also fixes #12065\n``````\n",
    "created_at": "2011-12-02T13:40:40Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130579",
    "user": "https://github.com/vbraun"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 On an unrelated note, it would be nice if tickets talking about R would contain "r-project" on trac since it is otherwise hopeless to search for.
 
 Apply trac_12057_fix_doctests.patch
+
+The upgraded spkg also fixes #12065
``````




---

archive/issue_comments_130580.json:
```json
{
    "body": "<a id='comment:21'></a>\nPlease delete the following from `spkg-install` (needed for #11073):\n\n```\n# sage -f \"$RPY_VER\".spkg # EVIL\n\n# Sanity check, should never happen:\nif [ ! -x \"$SAGE_LOCAL/bin/sage-spkg\" ]; then\n    echo \"Error: Fatal dependency error:\"\n    echo \"    $SAGE_LOCAL/bin/sage-spkg\"\n    echp \"does not (yet) exist (or isn't executable):\"\n    ls -l \"$SAGE_LOCAL/bin/sage-spkg\"\n    echo \"Please report this to one of the Google groups\"\n    echo \"    sage-devel or sage-release.\"\n    echo \"Error installing Rpy, which is part of the R spkg.\"\n    exit 1\nfi\n```\n(note also the typo \"echp\")\n\nIf `sage-spkg` really doesn't exist, then we will detect that failure when doing\n\n```\n\"$SAGE_ROOT/spkg/pipestatus\" \\\n    \"sage-spkg -f '$RPY_PKG' 2>&1\" \\\n    \"tee -a '$SAGE_ROOT/spkg/logs/'$RPY_VER.log\"\n```\nbelow.",
    "created_at": "2011-12-02T14:20:51Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130580",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Please delete the following from `spkg-install` (needed for #11073):

```
# sage -f "$RPY_VER".spkg # EVIL

# Sanity check, should never happen:
if [ ! -x "$SAGE_LOCAL/bin/sage-spkg" ]; then
    echo "Error: Fatal dependency error:"
    echo "    $SAGE_LOCAL/bin/sage-spkg"
    echp "does not (yet) exist (or isn't executable):"
    ls -l "$SAGE_LOCAL/bin/sage-spkg"
    echo "Please report this to one of the Google groups"
    echo "    sage-devel or sage-release."
    echo "Error installing Rpy, which is part of the R spkg."
    exit 1
fi
```
(note also the typo "echp")

If `sage-spkg` really doesn't exist, then we will detect that failure when doing

```
"$SAGE_ROOT/spkg/pipestatus" \
    "sage-spkg -f '$RPY_PKG' 2>&1" \
    "tee -a '$SAGE_ROOT/spkg/logs/'$RPY_VER.log"
```
below.



---

archive/issue_comments_130581.json:
```json
{
    "body": "<a id='comment:22'></a>\nDone!",
    "created_at": "2011-12-02T15:16:51Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130581",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
Done!



---

archive/issue_comments_130582.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,11 +1,12 @@\n The current version of R (r-project) disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.\n \n-http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg\n \n There is no other change except for the source code and a rediffed `patches/R.sh.in`\n \n On an unrelated note, it would be nice if tickets talking about R would contain \"r-project\" on trac since it is otherwise hopeless to search for.\n \n-Apply trac_12057_fix_doctests.patch\n+**Apply**:\n+1. spkg [http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg](http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg)\n+2. [attachment:trac_12057_fix_doctests.patch](https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch)\n \n-The upgraded spkg also fixes #12065\n+The upgraded spkg also fixes #12065.\n``````\n",
    "created_at": "2011-12-03T09:53:06Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130582",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,11 +1,12 @@
 The current version of R (r-project) disables graphics if no X11 is available even though `r.capabilities()` states that PNG is enabled. But you can't generate PNGs, which is why R graphics is broken in the Sage virtual machine. This is fixed in the newest upstream version, of which I made a new spkg.
 
-http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg
 
 There is no other change except for the source code and a rediffed `patches/R.sh.in`
 
 On an unrelated note, it would be nice if tickets talking about R would contain "r-project" on trac since it is otherwise hopeless to search for.
 
-Apply trac_12057_fix_doctests.patch
+**Apply**:
+1. spkg [http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg](http://www.stp.dias.ie/~vbraun/Sage/spkg/r-2.14.0.p0.spkg)
+2. [attachment:trac_12057_fix_doctests.patch](https://github.com/sagemath/sage/files/ticket12057/trac_12057_fix_doctests.patch)
 
-The upgraded spkg also fixes #12065
+The upgraded spkg also fixes #12065.
``````




---

archive/issue_comments_130583.json:
```json
{
    "body": "<a id='comment:24'></a>\nJeroen, what else needs to be done for positive review?",
    "created_at": "2011-12-03T15:29:48Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130583",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:24'></a>
Jeroen, what else needs to be done for positive review?



---

archive/issue_comments_130584.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman, Jeroen Demeyer",
    "created_at": "2011-12-03T15:29:48Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130584",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman, Jeroen Demeyer



---

archive/issue_comments_130585.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [kcrisman](#comment%3A24):\n> Jeroen, what else needs to be done for positive review?\n\nI don't know, I haven't actually reviewed the ticket.  I just tried to install it on various configurations.",
    "created_at": "2011-12-03T15:48:43Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130585",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'></a>
Replying to [kcrisman](#comment%3A24):
> Jeroen, what else needs to be done for positive review?

I don't know, I haven't actually reviewed the ticket.  I just tried to install it on various configurations.



---

archive/issue_events_097653.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-08T23:08:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "component: statistics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97653"
}
```



---

archive/issue_events_097654.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-08T23:08:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97654"
}
```



---

archive/issue_events_097655.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-08T23:08:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97655"
}
```



---

archive/issue_events_097656.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-08T23:08:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97656"
}
```



---

archive/issue_comments_130586.json:
```json
{
    "body": "<a id='comment:27'></a>\nI haven't checked that it fixes the problems mentioned in the ticket, but apart from that: looks good.  The spkg could do with some cleaning up (also, who's idea was it to put a spkg inside a spkg???), but I don't want to force this.  So, positive_review.",
    "created_at": "2011-12-08T23:08:23Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130586",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
I haven't checked that it fixes the problems mentioned in the ticket, but apart from that: looks good.  The spkg could do with some cleaning up (also, who's idea was it to put a spkg inside a spkg???), but I don't want to force this.  So, positive_review.



---

archive/issue_comments_130587.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jdemeyer](#comment%3A27):\n> I haven't checked that it fixes the problems mentioned in the ticket, but apart from that: looks good.  The spkg could do with some cleaning up (also, who's idea was it to put a spkg inside a spkg???), but I don't want to force this.  So, positive_review.\n\nAnd there are plenty of other tickets open about those things in any case :)",
    "created_at": "2011-12-08T23:15:09Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130587",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:28'></a>
Replying to [jdemeyer](#comment%3A27):
> I haven't checked that it fixes the problems mentioned in the ticket, but apart from that: looks good.  The spkg could do with some cleaning up (also, who's idea was it to put a spkg inside a spkg???), but I don't want to force this.  So, positive_review.

And there are plenty of other tickets open about those things in any case :)



---

archive/issue_events_097657.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-10T10:40:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97657"
}
```



---

archive/issue_events_097658.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-10T10:40:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12057#event-97658"
}
```



---

archive/issue_comments_130588.json:
```json
{
    "body": "**Merged:** sage-4.8.alpha4",
    "created_at": "2011-12-10T10:40:58Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130588",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.8.alpha4



---

archive/issue_comments_130589.json:
```json
{
    "body": "<a id='comment:30'></a>\nWith this new version, this doctest is problematic (line 352):\n\n```\n    sage: s = r.eval('capabilities(\"png\")') # Should be on Linux and Solaris\n```\nOn my Mac OS X 10.6.8 box, doctesting this starts up X Windows.  This is new: it didn't do this in Sage 4.8.alpha3.\n\n- Any ideas why?\n- I don't like this behavior: doctesting shouldn't start up external applications.  What should be done about it?",
    "created_at": "2011-12-16T17:13:27Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130589",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
With this new version, this doctest is problematic (line 352):

```
    sage: s = r.eval('capabilities("png")') # Should be on Linux and Solaris
```
On my Mac OS X 10.6.8 box, doctesting this starts up X Windows.  This is new: it didn't do this in Sage 4.8.alpha3.

- Any ideas why?
- I don't like this behavior: doctesting shouldn't start up external applications.  What should be done about it?



---

archive/issue_comments_130590.json:
```json
{
    "body": "<a id='comment:31'></a>\nI don't have a local OSX machine, so I can't debug it myself. Does it also happen if you start R and type in `capabilities(\"png\")`? If yes, does\n\n```\nSys.unsetenv(\"DISPLAY\")\n```\nchange anything?",
    "created_at": "2011-12-16T18:06:48Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130590",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:31'></a>
I don't have a local OSX machine, so I can't debug it myself. Does it also happen if you start R and type in `capabilities("png")`? If yes, does

```
Sys.unsetenv("DISPLAY")
```
change anything?



---

archive/issue_comments_130591.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [vbraun](#comment%3A31):\n> I don't have a local OSX machine, so I can't debug it myself. Does it also happen if you start R and type in `capabilities(\"png\")`? \n\nYes.  It also reports `TRUE` for this.\n\n> If yes, does\n\n\n ```\n Sys.unsetenv(\"DISPLAY\")\n ```\n> change anything?\n\nYes, X11 doesn't start, and it reports \"False\" for png:\n\n```\n> Sys.unsetenv(\"DISPLAY\") \n> capabilities(\"png\")\n  png \nFALSE \n> capabilities(\"aqua\")\naqua \nTRUE \n```\n(I don't know why there are leading spaces in the returned string \"  png\".)",
    "created_at": "2011-12-16T18:29:15Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130591",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:32'></a>
Replying to [vbraun](#comment%3A31):
> I don't have a local OSX machine, so I can't debug it myself. Does it also happen if you start R and type in `capabilities("png")`? 

Yes.  It also reports `TRUE` for this.

> If yes, does


 ```
 Sys.unsetenv("DISPLAY")
 ```
> change anything?

Yes, X11 doesn't start, and it reports "False" for png:

```
> Sys.unsetenv("DISPLAY") 
> capabilities("png")
  png 
FALSE 
> capabilities("aqua")
aqua 
TRUE 
```
(I don't know why there are leading spaces in the returned string "  png".)



---

archive/issue_comments_130592.json:
```json
{
    "body": "<a id='comment:33'></a>\nDoes R just start up X11 or does it also show anything in it? Can you strace the R execution and see where it executes X?",
    "created_at": "2011-12-16T18:58:23Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130592",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>
Does R just start up X11 or does it also show anything in it? Can you strace the R execution and see where it executes X?



---

archive/issue_comments_130593.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jhpalmieri](#comment%3A32):\n> Replying to [vbraun](#comment%3A31):\n> > I don't have a local OSX machine, so I can't debug it myself. Does it also happen if you start R and type in `capabilities(\"png\")`? \n\n> \n> Yes.  It also reports `TRUE` for this.\n\nWow, that is really unexpected.  Also weird, because I tested the entire library overnight on my local 4.8.alpha4 (for another ticket) and nothing happened like that, or I would have noticed this morning.\n\n```\n\nnew-host-2:sage-4.8.alpha4 karl-dietercrisman$ ./sage -t devel/sage/sage/interfaces/r.py \nsage -t  \"devel/sage/sage/interfaces/r.py\"                  \n\t [13.6 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 13.6 seconds\n```\nOf course, I also get\n\n```\n> capabilities(\"png\")\n  png \nFALSE \n```\nYour problem is that someone Sage got compiled with png support!  It's not supposed to on Mac, we try to configure it to use (only) Aqua.  Hence the doctest being a little unusual:\n\n```\n            sage: s = r.eval('capabilities(\"png\")') # Should be on Linux and Solaris\n            sage: t = r.eval('capabilities(\"aqua\")') # Should be on all supported Mac versions\n            sage: \"TRUE\" in s+t                      # optional -- rgraphics\n            True\n```\nMy guess is you have something set in your preferences or elsewhere that caused R to pick up a system version of something.  In general, getting R to compile on Mac with png support is interesting and hackish - I can't find the page I'm looking for right now, but it's referenced somewhere on one of the previous \"get graphics in R in Sage to work\" Trac tickets.\n\nIn other words, while not ideal, I wouldn't call this something to unmerge this new spkg for.",
    "created_at": "2011-12-16T21:05:28Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130593",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:34'></a>
Replying to [jhpalmieri](#comment%3A32):
> Replying to [vbraun](#comment%3A31):
> > I don't have a local OSX machine, so I can't debug it myself. Does it also happen if you start R and type in `capabilities("png")`? 

> 
> Yes.  It also reports `TRUE` for this.

Wow, that is really unexpected.  Also weird, because I tested the entire library overnight on my local 4.8.alpha4 (for another ticket) and nothing happened like that, or I would have noticed this morning.

```

new-host-2:sage-4.8.alpha4 karl-dietercrisman$ ./sage -t devel/sage/sage/interfaces/r.py 
sage -t  "devel/sage/sage/interfaces/r.py"                  
	 [13.6 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 13.6 seconds
```
Of course, I also get

```
> capabilities("png")
  png 
FALSE 
```
Your problem is that someone Sage got compiled with png support!  It's not supposed to on Mac, we try to configure it to use (only) Aqua.  Hence the doctest being a little unusual:

```
            sage: s = r.eval('capabilities("png")') # Should be on Linux and Solaris
            sage: t = r.eval('capabilities("aqua")') # Should be on all supported Mac versions
            sage: "TRUE" in s+t                      # optional -- rgraphics
            True
```
My guess is you have something set in your preferences or elsewhere that caused R to pick up a system version of something.  In general, getting R to compile on Mac with png support is interesting and hackish - I can't find the page I'm looking for right now, but it's referenced somewhere on one of the previous "get graphics in R in Sage to work" Trac tickets.

In other words, while not ideal, I wouldn't call this something to unmerge this new spkg for.



---

archive/issue_comments_130594.json:
```json
{
    "body": "<a id='comment:35'></a>\nvbraun:\n\n> Does R just start up X11 or does it also show anything in it? Can you strace the R execution and see where it executes X?\n\nX11 just starts up.  It doesn't seem to have any windows running.  I don't have strace installed on this computer, and I wouldn't know how to use it if I did ;)\n\nBy the way, if I log into an OS X box remotely, I don't have this problem.  It must correctly detect that I can't run X11, and it also says that I don't have 'png' capabilities.\n\nkcrisman: Do you have X11 installed on your Mac?  Maybe if it's not installed, it doesn't go through this check and returns \"FALSE\" for png capabilities.\n\nI remember seeing something about compiling R with png support on [http://ask.sagemath.org/](http://ask.sagemath.org/), but I don't remember beyond that.  I don't think I have a particularly unusual setup, but who knows what R looks at?  In the install log for R, I see this:\n\n```\n  Interfaces supported:      X11, aqua, tcltk\n  External libraries:        readline, ICU\n  Additional capabilities:   PNG, JPEG, NLS\n```\n\nAnyway, I'm not suggesting unmerging the spkg, but fixing the doctest somehow (in a followup ticket, if that's best).  Can we do the equivalent in Sage of\n\n```\nSys.unsetenv(\"DISPLAY\") \ncapabilities(\"png\")\ncapabilities(\"aqua\")\n```\nwithout breaking things on Linux or Solaris?",
    "created_at": "2011-12-16T22:16:03Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130594",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:35'></a>
vbraun:

> Does R just start up X11 or does it also show anything in it? Can you strace the R execution and see where it executes X?

X11 just starts up.  It doesn't seem to have any windows running.  I don't have strace installed on this computer, and I wouldn't know how to use it if I did ;)

By the way, if I log into an OS X box remotely, I don't have this problem.  It must correctly detect that I can't run X11, and it also says that I don't have 'png' capabilities.

kcrisman: Do you have X11 installed on your Mac?  Maybe if it's not installed, it doesn't go through this check and returns "FALSE" for png capabilities.

I remember seeing something about compiling R with png support on [http://ask.sagemath.org/](http://ask.sagemath.org/), but I don't remember beyond that.  I don't think I have a particularly unusual setup, but who knows what R looks at?  In the install log for R, I see this:

```
  Interfaces supported:      X11, aqua, tcltk
  External libraries:        readline, ICU
  Additional capabilities:   PNG, JPEG, NLS
```

Anyway, I'm not suggesting unmerging the spkg, but fixing the doctest somehow (in a followup ticket, if that's best).  Can we do the equivalent in Sage of

```
Sys.unsetenv("DISPLAY") 
capabilities("png")
capabilities("aqua")
```
without breaking things on Linux or Solaris?



---

archive/issue_comments_130595.json:
```json
{
    "body": "<a id='comment:36'></a>\n\n```\nr.eval('Sys.unsetenv(\"DISPLAY\")')\n```\nwhen starting up the R pexpect interface?\n\nIn any case, I prefer that you make a new ticket and move the discussion there.",
    "created_at": "2011-12-16T22:21:27Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130595",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>

```
r.eval('Sys.unsetenv("DISPLAY")')
```
when starting up the R pexpect interface?

In any case, I prefer that you make a new ticket and move the discussion there.



---

archive/issue_comments_130596.json:
```json
{
    "body": "<a id='comment:37'></a>\n> kcrisman: Do you have X11 installed on your Mac?  Maybe if it's not installed, it doesn't go through this check and returns \"FALSE\" for png capabilities.\n\nYes, I do.  \n> Anyway, I'm not suggesting unmerging the spkg, but fixing the doctest somehow (in a followup ticket, if that's best).  Can we \n\nBe sure to cc: me and Jason on that, then.",
    "created_at": "2011-12-17T01:14:28Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130596",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:37'></a>
> kcrisman: Do you have X11 installed on your Mac?  Maybe if it's not installed, it doesn't go through this check and returns "FALSE" for png capabilities.

Yes, I do.  
> Anyway, I'm not suggesting unmerging the spkg, but fixing the doctest somehow (in a followup ticket, if that's best).  Can we 

Be sure to cc: me and Jason on that, then.



---

archive/issue_comments_130597.json:
```json
{
    "body": "<a id='comment:38'></a>\nFollowup ticket is #12172",
    "created_at": "2011-12-17T11:32:36Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130597",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>
Followup ticket is #12172



---

archive/issue_comments_130598.json:
```json
{
    "body": "<a id='comment:39'></a>\nOn OS X 10.6.8 I cannot install this spkg in  sage-4.8.alpha3 (I build the alpha3 from source so the old spkg does install).\n\nDoing\n\n```\nmd:sage-4.8.alpha3 maarten$ ./sage -f ../sage-4.8.alpha4/spkg/standard/r-2.14.0.p0.spkg\n```\nHangs as described on:\nhttp://pastebin.com/7K7qLMJh\n\nThe guilty command is:\n/Users/maarten/Downloads/________________/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/bin/exec/R --no-restore --slave --args nextArg--pkglocknextArg--data-compress=xznextArg--byte-compilenextArg-lnextArg../../../librarynextArgMASS.tgz",
    "created_at": "2011-12-19T12:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130598",
    "user": "https://github.com/koffie"
}
```

<a id='comment:39'></a>
On OS X 10.6.8 I cannot install this spkg in  sage-4.8.alpha3 (I build the alpha3 from source so the old spkg does install).

Doing

```
md:sage-4.8.alpha3 maarten$ ./sage -f ../sage-4.8.alpha4/spkg/standard/r-2.14.0.p0.spkg
```
Hangs as described on:
http://pastebin.com/7K7qLMJh

The guilty command is:
/Users/maarten/Downloads/________________/sage-4.8.alpha3/spkg/build/r-2.14.0.p0/src/bin/exec/R --no-restore --slave --args nextArg--pkglocknextArg--data-compress=xznextArg--byte-compilenextArg-lnextArg../../../librarynextArgMASS.tgz



---

archive/issue_comments_130599.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [mderickx](#comment%3A39):\n> On OS X 10.6.8 I cannot install this spkg in  sage-4.8.alpha3 (I build the alpha3 from source so the old spkg does install).\n\nQuestions:\n* Do you have any unusual environment variables set?\n* Do you have any R env. variables, or another R installation separate from this one?\n* Is there anything unusual you have on your machine (I am currently on the exact same OS version, w/out problems) regarding compiling?\n\nUsually we've found that R problems are related to it picking up system versions or variables.  \n\nI'd recommend we open a new ticket for this, though, since \"most\" OS X 10.6 systems seem to be just fine.",
    "created_at": "2011-12-19T14:46:05Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130599",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:40'></a>
Replying to [mderickx](#comment%3A39):
> On OS X 10.6.8 I cannot install this spkg in  sage-4.8.alpha3 (I build the alpha3 from source so the old spkg does install).

Questions:
* Do you have any unusual environment variables set?
* Do you have any R env. variables, or another R installation separate from this one?
* Is there anything unusual you have on your machine (I am currently on the exact same OS version, w/out problems) regarding compiling?

Usually we've found that R problems are related to it picking up system versions or variables.  

I'd recommend we open a new ticket for this, though, since "most" OS X 10.6 systems seem to be just fine.



---

archive/issue_comments_130600.json:
```json
{
    "body": "<a id='comment:41'></a>\nOn the new ticket it would also be useful to attach dtrace to the hanging R process to see what it is doing.",
    "created_at": "2011-12-19T15:42:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130600",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:41'></a>
On the new ticket it would also be useful to attach dtrace to the hanging R process to see what it is doing.



---

archive/issue_comments_130601.json:
```json
{
    "body": "<a id='comment:42'></a>\nOk, I created #12201 . I try to answer your questions there.",
    "created_at": "2011-12-20T13:34:54Z",
    "issue": "https://github.com/sagemath/sage/issues/12057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12057#issuecomment-130601",
    "user": "https://github.com/koffie"
}
```

<a id='comment:42'></a>
Ok, I created #12201 . I try to answer your questions there.
