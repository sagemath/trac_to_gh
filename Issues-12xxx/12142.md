# Issue 12142: Speed up PARI finite field operations

archive/issues_011970.json:
```json
{
    "body": "Let us perform a simple addition of finite field elements that are represented using PARI.\n\n```\nsage: F.<a> = GF(3^11)\nsage: x = F.random_element()\nsage: y = F.random_element()\nsage: %timeit x + y\n625 loops, best of 3: 13.2 \u00b5s per loop\n```\nLet us now measure how much time the *actual* addition takes:\n\n```\nsage: vx = x._FiniteField_ext_pariElement__value\nsage: vy = y._FiniteField_ext_pariElement__value\nsage: %timeit vx + vy\n625 loops, best of 3: 4.6 \u00b5s per loop\n```\nThis means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!\n\nBut in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a\n\n```\nsage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), \"ffgen((%s).mod)\"%parix) \n\nsage: px = pari_ffelt(x)\nsage: py = pari_ffelt(y)\nsage: %timeit px + py\n625 loops, best of 3: 2.43 \u00b5s per loop\n```\nFor multiplication, we have the following timings:\n\n```\nsage: %timeit x * y\n625 loops, best of 3: 18.2 \u00b5s per loop\nsage: %timeit vx * vy\n625 loops, best of 3: 8.4 \u00b5s per loop\nsage: %timeit px * py\n625 loops, best of 3: 3.33 \u00b5s per loop\n```\n\nThis ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n\n```\nsage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n```\nThis implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.\n\nApply:\n* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch]\n* [attachment:trac_12142-singular_conversion.patch]\n* [attachment:trac_12142-reviewer.patch]\n* [attachment:trac_12142-doctest.patch]\n* [attachment:trac_12142-remove_cinit.patch]\n\n\nAssignee: @aghitza\n\nCC:  @koffie jpflori\n\nReviewer: Jean-Pierre Flori\n\nAuthor: Peter Bruin\n\nMerged: sage-5.12.beta3\n\nDependencies: #14817, #14818, #14832, #14833\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12142\n\n",
    "closed_at": "2013-08-20T12:55:32Z",
    "created_at": "2011-12-10T22:57:49Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "Speed up PARI finite field operations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12142",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```
Let us perform a simple addition of finite field elements that are represented using PARI.

```
sage: F.<a> = GF(3^11)
sage: x = F.random_element()
sage: y = F.random_element()
sage: %timeit x + y
625 loops, best of 3: 13.2 µs per loop
```
Let us now measure how much time the *actual* addition takes:

```
sage: vx = x._FiniteField_ext_pariElement__value
sage: vy = y._FiniteField_ext_pariElement__value
sage: %timeit vx + vy
625 loops, best of 3: 4.6 µs per loop
```
This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!

But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a

```
sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), "ffgen((%s).mod)"%parix) 

sage: px = pari_ffelt(x)
sage: py = pari_ffelt(y)
sage: %timeit px + py
625 loops, best of 3: 2.43 µs per loop
```
For multiplication, we have the following timings:

```
sage: %timeit x * y
625 loops, best of 3: 18.2 µs per loop
sage: %timeit vx * vy
625 loops, best of 3: 8.4 µs per loop
sage: %timeit px * py
625 loops, best of 3: 3.33 µs per loop
```

This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:

```
sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
```
This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.

Apply:
* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch]
* [attachment:trac_12142-singular_conversion.patch]
* [attachment:trac_12142-reviewer.patch]
* [attachment:trac_12142-doctest.patch]
* [attachment:trac_12142-remove_cinit.patch]


Assignee: @aghitza

CC:  @koffie jpflori

Reviewer: Jean-Pierre Flori

Author: Peter Bruin

Merged: sage-5.12.beta3

Dependencies: #14817, #14818, #14832, #14833

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12142





---

archive/issue_comments_145691.json:
```json
{
    "body": "<a id='comment:3'></a>Just a reminder for myself, it would also be nice to have a common cython interface to deal with finite fields elements, surely using templates as for polynomials.",
    "created_at": "2013-05-30T09:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145691",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:3'></a>Just a reminder for myself, it would also be nice to have a common cython interface to deal with finite fields elements, surely using templates as for polynomials.



---

archive/issue_comments_145692.json:
```json
{
    "body": "<a id='comment:4'></a>I have been working on an interface to PARI's implementation of finite fields (`t_FFELT`).  Like for the other interfaces (except the existing PARI polmod implementation), the field class is written in Python and the element class in Cython.  I hope to upload a patch soon after cleaning up the documentation and fixing a minor problem.\n\nThe speed improvement for addition and multiplication relative to the current implementation appears to vary roughly from a factor 3 to a factor 12, depending on the size of the field.\n\nFor small fields, this PARI interface is (of course) much slower than Givaro (a factor 4-6 for **F**_{3<sup>10</sup>}).  For fields of characteristic 2, it is slower than NTL+gf2x, but the difference is not that dramatic.",
    "created_at": "2013-06-24T19:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145692",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:4'></a>I have been working on an interface to PARI's implementation of finite fields (`t_FFELT`).  Like for the other interfaces (except the existing PARI polmod implementation), the field class is written in Python and the element class in Cython.  I hope to upload a patch soon after cleaning up the documentation and fixing a minor problem.

The speed improvement for addition and multiplication relative to the current implementation appears to vary roughly from a factor 3 to a factor 12, depending on the size of the field.

For small fields, this PARI interface is (of course) much slower than Givaro (a factor 4-6 for **F**_{3<sup>10</sup>}).  For fields of characteristic 2, it is slower than NTL+gf2x, but the difference is not that dramatic.



---

archive/issue_comments_145693.json:
```json
{
    "body": "<a id='comment:5'></a>This ticket led to several other patches, which I put into separate tickets; see the list of dependencies.  The dependence on #14817 is optional.\n\nA patch for this ticket is now practically ready.",
    "created_at": "2013-06-27T08:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145693",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:5'></a>This ticket led to several other patches, which I put into separate tickets; see the list of dependencies.  The dependence on #14817 is optional.

A patch for this ticket is now practically ready.



---

archive/issue_comments_145694.json:
```json
{
    "body": "<a id='comment:6'></a>The attached patch implements a new class `FiniteField_pari_ffelt` and associated element class `FiniteFieldElement_pari_ffelt`.  There is currently one doctest failure, related to conversion from and to Singular.",
    "created_at": "2013-06-27T11:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145694",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:6'></a>The attached patch implements a new class `FiniteField_pari_ffelt` and associated element class `FiniteFieldElement_pari_ffelt`.  There is currently one doctest failure, related to conversion from and to Singular.



---

archive/issue_comments_145695.json:
```json
{
    "body": "<a id='comment:7'></a>Attachment [trac_12142-singular_conversion.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-singular_conversion.patch) by @pjbruin created at 2013-06-27 19:19:55\n\nOK, converting between `FiniteFieldElement` and Singular was an easy generalisation of existing code.  I will try to make a small table comparing the performance of the various implementations.  In the meantime this is ready to be reviewed.",
    "created_at": "2013-06-27T19:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145695",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:7'></a>Attachment [trac_12142-singular_conversion.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-singular_conversion.patch) by @pjbruin created at 2013-06-27 19:19:55

OK, converting between `FiniteFieldElement` and Singular was an easy generalisation of existing code.  I will try to make a small table comparing the performance of the various implementations.  In the meantime this is ready to be reviewed.



---

archive/issue_comments_145696.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-06-27T19:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145696",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_145697.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -38,6 +38,16 @@\n 625 loops, best of 3: 3.33 \u00b5s per loop\n \\`\\`\\`\n \n+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It is not the default yet, but it can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n+\n+\\`\\`\\`\n+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n+\\`\\`\\`\n+This implementation should probably become the default for finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.\n+\n+Apply: [attachment:trac_12142-FiniteField_pari_ffelt.patch], [attachment:trac_12142-singular_conversion.patch]\n+\n+\n Comment: 1\n \n Summary: Speed up Pari finite field operations\n```\n",
    "created_at": "2013-06-27T19:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145697",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -38,6 +38,16 @@
 625 loops, best of 3: 3.33 µs per loop
 \`\`\`
 
+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It is not the default yet, but it can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:
+
+\`\`\`
+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
+\`\`\`
+This implementation should probably become the default for finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.
+
+Apply: [attachment:trac_12142-FiniteField_pari_ffelt.patch], [attachment:trac_12142-singular_conversion.patch]
+
+
 Comment: 1
 
 Summary: Speed up Pari finite field operations
```




---

archive/issue_comments_145698.json:
```json
{
    "body": "<a id='comment:8'></a>Here are some timings for addition and multiplication in the various implementations:\n\n```\nx, y random elements of a field of p^n elements\nall times in microseconds\n\nAddition:  %timeit -c -r 1 x + y\n\n(p, n)     ntl/gf2e  givaro  pari_ffelt  pari_mod\n\n(2, 15)    0.85      0.45    0.95        15.1\n(2, 5000)  1.06      ----    1.84        3300\n\n(3, 10)    ----      0.47    1.14        12.5\n(3, 80)    ----      ----    1.75        44\n\n(251, 2)   ----      0.51    1.30        9.0\n\nMultiplication:  %timeit -c -r 1 x * y\n\n(p, n)     ntl/gf2e  givaro  pari_ffelt  pari_mod\n\n(2, 15)    1.11      0.61    1.51        22\n(2, 1000)  5.0       ----    61          1060\n\n(3, 10)    ----      0.57    4.0         19\n(3, 80)    ----      ----    36          99\n\n(251, 2)   ----      0.56    1.69        12.1\n\n```",
    "created_at": "2013-06-27T21:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145698",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:8'></a>Here are some timings for addition and multiplication in the various implementations:

```
x, y random elements of a field of p^n elements
all times in microseconds

Addition:  %timeit -c -r 1 x + y

(p, n)     ntl/gf2e  givaro  pari_ffelt  pari_mod

(2, 15)    0.85      0.45    0.95        15.1
(2, 5000)  1.06      ----    1.84        3300

(3, 10)    ----      0.47    1.14        12.5
(3, 80)    ----      ----    1.75        44

(251, 2)   ----      0.51    1.30        9.0

Multiplication:  %timeit -c -r 1 x * y

(p, n)     ntl/gf2e  givaro  pari_ffelt  pari_mod

(2, 15)    1.11      0.61    1.51        22
(2, 1000)  5.0       ----    61          1060

(3, 10)    ----      0.57    4.0         19
(3, 80)    ----      ----    36          99

(251, 2)   ----      0.56    1.69        12.1

```



---

archive/issue_comments_145699.json:
```json
{
    "body": "<a id='comment:9'></a>Initialisation of finite field elements is too slow, and computing *a*/*b* raises a `ZeroDivisionError` if *a* = 0...  A fix will be ready soon.",
    "created_at": "2013-06-29T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145699",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:9'></a>Initialisation of finite field elements is too slow, and computing *a*/*b* raises a `ZeroDivisionError` if *a* = 0...  A fix will be ready soon.



---

archive/issue_comments_145700.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-06-29T09:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145700",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_145701.json:
```json
{
    "body": "based on 5.11.beta3",
    "created_at": "2013-06-29T21:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145701",
    "user": "https://github.com/pjbruin"
}
```

based on 5.11.beta3



---

archive/issue_comments_145702.json:
```json
{
    "body": "<a id='comment:10'></a>Attachment [trac_12142-FiniteField_pari_ffelt.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-FiniteField_pari_ffelt.patch) by @pjbruin created at 2013-06-29 21:21:15",
    "created_at": "2013-06-29T21:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145702",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:10'></a>Attachment [trac_12142-FiniteField_pari_ffelt.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-FiniteField_pari_ffelt.patch) by @pjbruin created at 2013-06-29 21:21:15



---

archive/issue_comments_145703.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-06-29T21:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145703",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_145704.json:
```json
{
    "body": "more speedups in element construction; initialisation from None allowed",
    "created_at": "2013-07-02T19:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145704",
    "user": "https://github.com/pjbruin"
}
```

more speedups in element construction; initialisation from None allowed



---

archive/issue_comments_145705.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,51 @@\n+Let us perform a simple addition of finite field elements that are represented using Pari.\n+\n+\\`\\`\\`\n+sage: F.<a> = GF(3^11)\n+sage: x = F.random_element()\n+sage: y = F.random_element()\n+sage: %timeit x + y\n+625 loops, best of 3: 13.2 \u00b5s per loop\n+\\`\\`\\`\n+Let us now measure how much time the *actual* addition takes:\n+\n+\\`\\`\\`\n+sage: vx = x._FiniteField_ext_pariElement__value\n+sage: vy = y._FiniteField_ext_pariElement__value\n+sage: %timeit vx + vy\n+625 loops, best of 3: 4.6 \u00b5s per loop\n+\\`\\`\\`\n+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!\n+\n+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a\n+\n+\\`\\`\\`\n+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), \"ffgen((%s).mod)\"%parix) \n+\n+sage: px = pari_ffelt(x)\n+sage: py = pari_ffelt(y)\n+sage: %timeit px + py\n+625 loops, best of 3: 2.43 \u00b5s per loop\n+\\`\\`\\`\n+For multiplication, we have the following timings:\n+\n+\\`\\`\\`\n+sage: %timeit x * y\n+625 loops, best of 3: 18.2 \u00b5s per loop\n+sage: %timeit vx * vy\n+625 loops, best of 3: 8.4 \u00b5s per loop\n+sage: %timeit px * py\n+625 loops, best of 3: 3.33 \u00b5s per loop\n+\\`\\`\\`\n+\n+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It is not the default yet, but it can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n+\n+\\`\\`\\`\n+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n+\\`\\`\\`\n+This implementation should probably become the default for finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.\n+\n+Apply: [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch], [attachment:trac_12142-singular_conversion.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2013-07-02T19:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145705",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,51 @@
+Let us perform a simple addition of finite field elements that are represented using Pari.
+
+\`\`\`
+sage: F.<a> = GF(3^11)
+sage: x = F.random_element()
+sage: y = F.random_element()
+sage: %timeit x + y
+625 loops, best of 3: 13.2 µs per loop
+\`\`\`
+Let us now measure how much time the *actual* addition takes:
+
+\`\`\`
+sage: vx = x._FiniteField_ext_pariElement__value
+sage: vy = y._FiniteField_ext_pariElement__value
+sage: %timeit vx + vy
+625 loops, best of 3: 4.6 µs per loop
+\`\`\`
+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!
+
+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a
+
+\`\`\`
+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), "ffgen((%s).mod)"%parix) 
+
+sage: px = pari_ffelt(x)
+sage: py = pari_ffelt(y)
+sage: %timeit px + py
+625 loops, best of 3: 2.43 µs per loop
+\`\`\`
+For multiplication, we have the following timings:
+
+\`\`\`
+sage: %timeit x * y
+625 loops, best of 3: 18.2 µs per loop
+sage: %timeit vx * vy
+625 loops, best of 3: 8.4 µs per loop
+sage: %timeit px * py
+625 loops, best of 3: 3.33 µs per loop
+\`\`\`
+
+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It is not the default yet, but it can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:
+
+\`\`\`
+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
+\`\`\`
+This implementation should probably become the default for finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.
+
+Apply: [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch], [attachment:trac_12142-singular_conversion.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_145706.json:
```json
{
    "body": "<a id='comment:11'></a>Attachment [trac_12142-FiniteField_pari_ffelt.improved.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-FiniteField_pari_ffelt.improved.patch) by @pjbruin created at 2013-07-02 19:44:24",
    "created_at": "2013-07-02T19:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145706",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:11'></a>Attachment [trac_12142-FiniteField_pari_ffelt.improved.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-FiniteField_pari_ffelt.improved.patch) by @pjbruin created at 2013-07-02 19:44:24



---

archive/issue_comments_145707.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,51 @@\n+Let us perform a simple addition of finite field elements that are represented using Pari.\n+\n+\\`\\`\\`\n+sage: F.<a> = GF(3^11)\n+sage: x = F.random_element()\n+sage: y = F.random_element()\n+sage: %timeit x + y\n+625 loops, best of 3: 13.2 \u00b5s per loop\n+\\`\\`\\`\n+Let us now measure how much time the *actual* addition takes:\n+\n+\\`\\`\\`\n+sage: vx = x._FiniteField_ext_pariElement__value\n+sage: vy = y._FiniteField_ext_pariElement__value\n+sage: %timeit vx + vy\n+625 loops, best of 3: 4.6 \u00b5s per loop\n+\\`\\`\\`\n+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!\n+\n+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a\n+\n+\\`\\`\\`\n+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), \"ffgen((%s).mod)\"%parix) \n+\n+sage: px = pari_ffelt(x)\n+sage: py = pari_ffelt(y)\n+sage: %timeit px + py\n+625 loops, best of 3: 2.43 \u00b5s per loop\n+\\`\\`\\`\n+For multiplication, we have the following timings:\n+\n+\\`\\`\\`\n+sage: %timeit x * y\n+625 loops, best of 3: 18.2 \u00b5s per loop\n+sage: %timeit vx * vy\n+625 loops, best of 3: 8.4 \u00b5s per loop\n+sage: %timeit px * py\n+625 loops, best of 3: 3.33 \u00b5s per loop\n+\\`\\`\\`\n+\n+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n+\n+\\`\\`\\`\n+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n+\\`\\`\\`\n+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.\n+\n+Apply: [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch], [attachment:trac_12142-singular_conversion.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2013-07-13T17:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145707",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,51 @@
+Let us perform a simple addition of finite field elements that are represented using Pari.
+
+\`\`\`
+sage: F.<a> = GF(3^11)
+sage: x = F.random_element()
+sage: y = F.random_element()
+sage: %timeit x + y
+625 loops, best of 3: 13.2 µs per loop
+\`\`\`
+Let us now measure how much time the *actual* addition takes:
+
+\`\`\`
+sage: vx = x._FiniteField_ext_pariElement__value
+sage: vy = y._FiniteField_ext_pariElement__value
+sage: %timeit vx + vy
+625 loops, best of 3: 4.6 µs per loop
+\`\`\`
+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!
+
+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a
+
+\`\`\`
+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), "ffgen((%s).mod)"%parix) 
+
+sage: px = pari_ffelt(x)
+sage: py = pari_ffelt(y)
+sage: %timeit px + py
+625 loops, best of 3: 2.43 µs per loop
+\`\`\`
+For multiplication, we have the following timings:
+
+\`\`\`
+sage: %timeit x * y
+625 loops, best of 3: 18.2 µs per loop
+sage: %timeit vx * vy
+625 loops, best of 3: 8.4 µs per loop
+sage: %timeit px * py
+625 loops, best of 3: 3.33 µs per loop
+\`\`\`
+
+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:
+
+\`\`\`
+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
+\`\`\`
+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.
+
+Apply: [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch], [attachment:trac_12142-singular_conversion.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_145708.json:
```json
{
    "body": "Attachment [trac_12142-reviewer.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-reviewer.patch) by jpflori created at 2013-07-15 12:06:26\n\nReviewer patch, trivial typo.",
    "created_at": "2013-07-15T12:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145708",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [trac_12142-reviewer.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-reviewer.patch) by jpflori created at 2013-07-15 12:06:26

Reviewer patch, trivial typo.



---

archive/issue_comments_145709.json:
```json
{
    "body": "<a id='comment:13'></a>Patches look fine, doctests pass and there is indeed a very nice speedup.",
    "created_at": "2013-07-15T12:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145709",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:13'></a>Patches look fine, doctests pass and there is indeed a very nice speedup.



---

archive/issue_comments_145710.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,54 @@\n+Let us perform a simple addition of finite field elements that are represented using Pari.\n \n+\\`\\`\\`\n+sage: F.<a> = GF(3^11)\n+sage: x = F.random_element()\n+sage: y = F.random_element()\n+sage: %timeit x + y\n+625 loops, best of 3: 13.2 \u00b5s per loop\n+\\`\\`\\`\n+Let us now measure how much time the *actual* addition takes:\n+\n+\\`\\`\\`\n+sage: vx = x._FiniteField_ext_pariElement__value\n+sage: vy = y._FiniteField_ext_pariElement__value\n+sage: %timeit vx + vy\n+625 loops, best of 3: 4.6 \u00b5s per loop\n+\\`\\`\\`\n+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!\n+\n+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a\n+\n+\\`\\`\\`\n+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), \"ffgen((%s).mod)\"%parix) \n+\n+sage: px = pari_ffelt(x)\n+sage: py = pari_ffelt(y)\n+sage: %timeit px + py\n+625 loops, best of 3: 2.43 \u00b5s per loop\n+\\`\\`\\`\n+For multiplication, we have the following timings:\n+\n+\\`\\`\\`\n+sage: %timeit x * y\n+625 loops, best of 3: 18.2 \u00b5s per loop\n+sage: %timeit vx * vy\n+625 loops, best of 3: 8.4 \u00b5s per loop\n+sage: %timeit px * py\n+625 loops, best of 3: 3.33 \u00b5s per loop\n+\\`\\`\\`\n+\n+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n+\n+\\`\\`\\`\n+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n+\\`\\`\\`\n+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.\n+\n+Apply:\n+* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch],\n+* [attachment:trac_12142-singular_conversion.patch],\n+* [attachment:trac_12142-reviewer.patch].\n \n Comment: 1\n \n```\n",
    "created_at": "2013-07-15T12:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145710",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,54 @@
+Let us perform a simple addition of finite field elements that are represented using Pari.
 
+\`\`\`
+sage: F.<a> = GF(3^11)
+sage: x = F.random_element()
+sage: y = F.random_element()
+sage: %timeit x + y
+625 loops, best of 3: 13.2 µs per loop
+\`\`\`
+Let us now measure how much time the *actual* addition takes:
+
+\`\`\`
+sage: vx = x._FiniteField_ext_pariElement__value
+sage: vy = y._FiniteField_ext_pariElement__value
+sage: %timeit vx + vy
+625 loops, best of 3: 4.6 µs per loop
+\`\`\`
+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!
+
+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a
+
+\`\`\`
+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), "ffgen((%s).mod)"%parix) 
+
+sage: px = pari_ffelt(x)
+sage: py = pari_ffelt(y)
+sage: %timeit px + py
+625 loops, best of 3: 2.43 µs per loop
+\`\`\`
+For multiplication, we have the following timings:
+
+\`\`\`
+sage: %timeit x * y
+625 loops, best of 3: 18.2 µs per loop
+sage: %timeit vx * vy
+625 loops, best of 3: 8.4 µs per loop
+sage: %timeit px * py
+625 loops, best of 3: 3.33 µs per loop
+\`\`\`
+
+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:
+
+\`\`\`
+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
+\`\`\`
+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.
+
+Apply:
+* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch],
+* [attachment:trac_12142-singular_conversion.patch],
+* [attachment:trac_12142-reviewer.patch].
 
 Comment: 1
 
```




---

archive/issue_comments_145711.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-15T12:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145711",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145712.json:
```json
{
    "body": "<a id='comment:14'></a>For patchbot:\n\nApply trac_12142-FiniteField_pari_ffelt.improved.patch, trac_12142-singular_conversion.patch, trac_12142-reviewer.patch",
    "created_at": "2013-07-16T11:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145712",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:14'></a>For patchbot:

Apply trac_12142-FiniteField_pari_ffelt.improved.patch, trac_12142-singular_conversion.patch, trac_12142-reviewer.patch



---

archive/issue_comments_145713.json:
```json
{
    "body": "<a id='comment:15'></a>\n```\nApply trac_12142-FiniteField_pari_ffelt.improved.patch, trac_12142-singular_conversion.patch, trac_12142-reviewer.patch \n```",
    "created_at": "2013-07-17T07:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145713",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:15'></a>
```
Apply trac_12142-FiniteField_pari_ffelt.improved.patch, trac_12142-singular_conversion.patch, trac_12142-reviewer.patch 
```



---

archive/issue_comments_145714.json:
```json
{
    "body": "add doctest",
    "created_at": "2013-07-17T14:10:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145714",
    "user": "https://github.com/pjbruin"
}
```

add doctest



---

archive/issue_comments_145715.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,56 @@\n+Let us perform a simple addition of finite field elements that are represented using Pari.\n+\n+\\`\\`\\`\n+sage: F.<a> = GF(3^11)\n+sage: x = F.random_element()\n+sage: y = F.random_element()\n+sage: %timeit x + y\n+625 loops, best of 3: 13.2 \u00b5s per loop\n+\\`\\`\\`\n+Let us now measure how much time the *actual* addition takes:\n+\n+\\`\\`\\`\n+sage: vx = x._FiniteField_ext_pariElement__value\n+sage: vy = y._FiniteField_ext_pariElement__value\n+sage: %timeit vx + vy\n+625 loops, best of 3: 4.6 \u00b5s per loop\n+\\`\\`\\`\n+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!\n+\n+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a\n+\n+\\`\\`\\`\n+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), \"ffgen((%s).mod)\"%parix) \n+\n+sage: px = pari_ffelt(x)\n+sage: py = pari_ffelt(y)\n+sage: %timeit px + py\n+625 loops, best of 3: 2.43 \u00b5s per loop\n+\\`\\`\\`\n+For multiplication, we have the following timings:\n+\n+\\`\\`\\`\n+sage: %timeit x * y\n+625 loops, best of 3: 18.2 \u00b5s per loop\n+sage: %timeit vx * vy\n+625 loops, best of 3: 8.4 \u00b5s per loop\n+sage: %timeit px * py\n+625 loops, best of 3: 3.33 \u00b5s per loop\n+\\`\\`\\`\n+\n+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n+\n+\\`\\`\\`\n+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n+\\`\\`\\`\n+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.\n+\n+Apply:\n+* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch]\n+* [attachment:trac_12142-singular_conversion.patch]\n+* [attachment:trac_12142-reviewer.patch]\n+* [attachment:trac_12142-doctest.patch]\n+* [attachment:trac_12142-remove_cinit.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2013-07-17T14:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145715",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,56 @@
+Let us perform a simple addition of finite field elements that are represented using Pari.
+
+\`\`\`
+sage: F.<a> = GF(3^11)
+sage: x = F.random_element()
+sage: y = F.random_element()
+sage: %timeit x + y
+625 loops, best of 3: 13.2 µs per loop
+\`\`\`
+Let us now measure how much time the *actual* addition takes:
+
+\`\`\`
+sage: vx = x._FiniteField_ext_pariElement__value
+sage: vy = y._FiniteField_ext_pariElement__value
+sage: %timeit vx + vy
+625 loops, best of 3: 4.6 µs per loop
+\`\`\`
+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!
+
+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a
+
+\`\`\`
+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), "ffgen((%s).mod)"%parix) 
+
+sage: px = pari_ffelt(x)
+sage: py = pari_ffelt(y)
+sage: %timeit px + py
+625 loops, best of 3: 2.43 µs per loop
+\`\`\`
+For multiplication, we have the following timings:
+
+\`\`\`
+sage: %timeit x * y
+625 loops, best of 3: 18.2 µs per loop
+sage: %timeit vx * vy
+625 loops, best of 3: 8.4 µs per loop
+sage: %timeit px * py
+625 loops, best of 3: 3.33 µs per loop
+\`\`\`
+
+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:
+
+\`\`\`
+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
+\`\`\`
+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.
+
+Apply:
+* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch]
+* [attachment:trac_12142-singular_conversion.patch]
+* [attachment:trac_12142-reviewer.patch]
+* [attachment:trac_12142-doctest.patch]
+* [attachment:trac_12142-remove_cinit.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_145716.json:
```json
{
    "body": "<a id='comment:16'></a>Attachment [trac_12142-doctest.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-doctest.patch) by @pjbruin created at 2013-07-17 14:42:48\n\nThe next patch removes the Cython constructor `__cinit__()`, which is unnecessary since it just sets an attribute to NULL which is already guaranteed to be NULL.  Actually, it just comments it out with an explanation for future reference.  This should fix the remaining doctest failure and may give another slight speed improvement.",
    "created_at": "2013-07-17T14:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145716",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:16'></a>Attachment [trac_12142-doctest.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-doctest.patch) by @pjbruin created at 2013-07-17 14:42:48

The next patch removes the Cython constructor `__cinit__()`, which is unnecessary since it just sets an attribute to NULL which is already guaranteed to be NULL.  Actually, it just comments it out with an explanation for future reference.  This should fix the remaining doctest failure and may give another slight speed improvement.



---

archive/issue_comments_145717.json:
```json
{
    "body": "Attachment [trac_12142-remove_cinit.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-remove_cinit.patch) by @pjbruin created at 2013-07-17 14:43:06",
    "created_at": "2013-07-17T14:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145717",
    "user": "https://github.com/pjbruin"
}
```

Attachment [trac_12142-remove_cinit.patch](tarball://root/attachments/some-uuid/ticket12142/trac_12142-remove_cinit.patch) by @pjbruin created at 2013-07-17 14:43:06



---

archive/issue_comments_145718.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-07-17T14:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145718",
    "user": "https://github.com/pjbruin"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_145719.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-17T14:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145719",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_145720.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-17T14:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145720",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145721.json:
```json
{
    "body": "<a id='comment:19'></a>This change looks ok to me, and is very well documented.\n\nI did not really pay attention to the doctests missing as you were copying from a large previous Sage file.\nMaybe we could take this opportunity to fix it as well and so increase coverage.",
    "created_at": "2013-07-17T14:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145721",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:19'></a>This change looks ok to me, and is very well documented.

I did not really pay attention to the doctests missing as you were copying from a large previous Sage file.
Maybe we could take this opportunity to fix it as well and so increase coverage.



---

archive/issue_events_032282.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:28:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12142#event-32282"
}
```



---

archive/issue_comments_145722.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,56 @@\n+Let us perform a simple addition of finite field elements that are represented using PARI.\n+\n+\\`\\`\\`\n+sage: F.<a> = GF(3^11)\n+sage: x = F.random_element()\n+sage: y = F.random_element()\n+sage: %timeit x + y\n+625 loops, best of 3: 13.2 \u00b5s per loop\n+\\`\\`\\`\n+Let us now measure how much time the *actual* addition takes:\n+\n+\\`\\`\\`\n+sage: vx = x._FiniteField_ext_pariElement__value\n+sage: vy = y._FiniteField_ext_pariElement__value\n+sage: %timeit vx + vy\n+625 loops, best of 3: 4.6 \u00b5s per loop\n+\\`\\`\\`\n+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!\n+\n+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a\n+\n+\\`\\`\\`\n+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), \"ffgen((%s).mod)\"%parix) \n+\n+sage: px = pari_ffelt(x)\n+sage: py = pari_ffelt(y)\n+sage: %timeit px + py\n+625 loops, best of 3: 2.43 \u00b5s per loop\n+\\`\\`\\`\n+For multiplication, we have the following timings:\n+\n+\\`\\`\\`\n+sage: %timeit x * y\n+625 loops, best of 3: 18.2 \u00b5s per loop\n+sage: %timeit vx * vy\n+625 loops, best of 3: 8.4 \u00b5s per loop\n+sage: %timeit px * py\n+625 loops, best of 3: 3.33 \u00b5s per loop\n+\\`\\`\\`\n+\n+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:\n+\n+\\`\\`\\`\n+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')\n+\\`\\`\\`\n+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.\n+\n+Apply:\n+* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch]\n+* [attachment:trac_12142-singular_conversion.patch]\n+* [attachment:trac_12142-reviewer.patch]\n+* [attachment:trac_12142-doctest.patch]\n+* [attachment:trac_12142-remove_cinit.patch]\n \n \n Comment: 1\n```\n",
    "created_at": "2013-07-21T21:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145722",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,56 @@
+Let us perform a simple addition of finite field elements that are represented using PARI.
+
+\`\`\`
+sage: F.<a> = GF(3^11)
+sage: x = F.random_element()
+sage: y = F.random_element()
+sage: %timeit x + y
+625 loops, best of 3: 13.2 µs per loop
+\`\`\`
+Let us now measure how much time the *actual* addition takes:
+
+\`\`\`
+sage: vx = x._FiniteField_ext_pariElement__value
+sage: vy = y._FiniteField_ext_pariElement__value
+sage: %timeit vx + vy
+625 loops, best of 3: 4.6 µs per loop
+\`\`\`
+This means two thirds of the execution time is used to wrap a ribbon around the result and only one third for the actual addition!
+
+But in fact Pari has a faster implementation for finite fields than this!  This was already mentioned at http://groups.google.com/group/sage-nt/browse_thread/thread/e2dbbc72caeb589a
+
+\`\`\`
+sage: def pari_ffelt(x): parix=pari(x); return parix.lift().subst(parix.variable(), "ffgen((%s).mod)"%parix) 
+
+sage: px = pari_ffelt(x)
+sage: py = pari_ffelt(y)
+sage: %timeit px + py
+625 loops, best of 3: 2.43 µs per loop
+\`\`\`
+For multiplication, we have the following timings:
+
+\`\`\`
+sage: %timeit x * y
+625 loops, best of 3: 18.2 µs per loop
+sage: %timeit vx * vy
+625 loops, best of 3: 8.4 µs per loop
+sage: %timeit px * py
+625 loops, best of 3: 3.33 µs per loop
+\`\`\`
+
+This ticket implements an interface to PARI's FFELT type for non-prime finite fields.  It can be tested by constructing finite fields as follows, for *p* prime and *n* >= 2:
+
+\`\`\`
+sage: F.<a> = FiniteField(p^n, impl='pari_ffelt')
+\`\`\`
+This implementation should probably become the default for non-prime finite fields of characteristic > 2 and cardinality > 2<sup>16</sup>, superseding the existing PARI polmod implementation.  This switch is the goal of ticket #14888.
+
+Apply:
+* [attachment:trac_12142-FiniteField_pari_ffelt.improved.patch]
+* [attachment:trac_12142-singular_conversion.patch]
+* [attachment:trac_12142-reviewer.patch]
+* [attachment:trac_12142-doctest.patch]
+* [attachment:trac_12142-remove_cinit.patch]
 
 
 Comment: 1
```




---

archive/issue_comments_145723.json:
```json
{
    "body": "<a id='comment:21'></a>Haven't read the code of #12142, but does pickling work properly and has it been doctested? If not, then #14888 should be set back to needs_work.",
    "created_at": "2013-07-21T21:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145723",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Haven't read the code of #12142, but does pickling work properly and has it been doctested? If not, then #14888 should be set back to needs_work.



---

archive/issue_comments_145724.json:
```json
{
    "body": "<a id='comment:22'></a>Yes, it works and there are doctests.  Finite field elements are not implemented as type `gen` (as in `libs/pari/gen.pyx`), so the fact that pickling does not work for a `gen` that happens to be a `t_FFELT` does not affect this ticket.",
    "created_at": "2013-07-21T21:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145724",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:22'></a>Yes, it works and there are doctests.  Finite field elements are not implemented as type `gen` (as in `libs/pari/gen.pyx`), so the fact that pickling does not work for a `gen` that happens to be a `t_FFELT` does not affect this ticket.



---

archive/issue_comments_145725.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:19 jpflori]:\n> I did not really pay attention to the doctests missing as you were copying from a large previous Sage file.\n> Maybe we could take this opportunity to fix it as well and so increase coverage.\n\nActually the doctest coverage of all files in `sage/rings/finite_rings` is 100%, except `integer_mod.pyx`, which has a coverage of only 99/150 functions.  Apart from that, I think I saw one or two colons that should be double colons.  I don't think it is really worth the trouble to spend time on that in this ticket.",
    "created_at": "2013-07-22T14:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145725",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:23'></a>Replying to [comment:19 jpflori]:
> I did not really pay attention to the doctests missing as you were copying from a large previous Sage file.
> Maybe we could take this opportunity to fix it as well and so increase coverage.

Actually the doctest coverage of all files in `sage/rings/finite_rings` is 100%, except `integer_mod.pyx`, which has a coverage of only 99/150 functions.  Apart from that, I think I saw one or two colons that should be double colons.  I don't think it is really worth the trouble to spend time on that in this ticket.



---

archive/issue_comments_145726.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-20T12:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12142#issuecomment-145726",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_032283.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:55:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12142",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12142#event-32283"
}
```
