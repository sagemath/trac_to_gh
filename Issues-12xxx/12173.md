# Issue 12173: Update FLINT to 2.3

archive/issues_012001.json:
```json
{
    "assignees": [],
    "body": "**Install**:\n* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg) (spkg diffs: [attachment: flint-2.3.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.diff.gz) and [attachment: flint-2.3.p1.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p1.diff.gz))\n\n**Apply**:\n* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);\n* [attachment: trac_12173-fixes-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v7.patch.gz), non-easily scriptable changes and fixes for spurious changes, together with reviewers fixes;\n* [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n\n**Apply** to SAGE_ROOT:\n* [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n\n**Upstream** bug with OS X PPC: [https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI](https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI)\n\nCC:  @jpflori @sagetrac-spancratz @williamstein @nexttime\n\nKeywords: **flint spkg**\n\nUpstream: **Reported upstream. Developers acknowledge bug.**\n\nReviewer: **John Cremona, Jeroen Demeyer, Burcin Erocal**\n\nAuthor: **Mike Hansen, Fredrik Johansson, Jean-Pierre Flori**\n\nMerged: **sage-5.10.beta3**\n\nComponent: **packages: standard**\n\nDependencies: **sage-5.9.beta5**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12173_\n\n",
    "closed_at": "2013-05-13T13:26:03Z",
    "created_at": "2011-12-17T19:13:29Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.10",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Update FLINT to 2.3",
    "type": "issue",
    "updated_at": "2013-05-17T11:51:34Z",
    "url": "https://github.com/sagemath/sage/issues/12173",
    "user": "https://github.com/mwhansen"
}
```
**Install**:
* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg) (spkg diffs: [attachment: flint-2.3.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.diff.gz) and [attachment: flint-2.3.p1.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p1.diff.gz))

**Apply**:
* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);
* [attachment: trac_12173-fixes-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v7.patch.gz), non-easily scriptable changes and fixes for spurious changes, together with reviewers fixes;
* [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.

**Apply** to SAGE_ROOT:
* [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).

**Upstream** bug with OS X PPC: [https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI](https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI)

CC:  @jpflori @sagetrac-spancratz @williamstein @nexttime

Keywords: **flint spkg**

Upstream: **Reported upstream. Developers acknowledge bug.**

Reviewer: **John Cremona, Jeroen Demeyer, Burcin Erocal**

Author: **Mike Hansen, Fredrik Johansson, Jean-Pierre Flori**

Merged: **sage-5.10.beta3**

Component: **packages: standard**

Dependencies: **sage-5.9.beta5**

_Issue created by migration from https://trac.sagemath.org/ticket/12173_





---

archive/issue_events_163653.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-12-17T19:13:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163653"
}
```



---

archive/issue_events_163654.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2011-12-17T19:13:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163654"
}
```



---

archive/issue_comments_130563.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nBuilding flint2 in Sage:\n\n- Update MPFR to 3.1.0 - #11666\n  http://sage.math.washington.edu/mpfr-3.1.0.spkg\n\n- Update MPFI to 1.5.0 - #12171\n  http://sage.math.washington.edu/home/mhansen/mpfi-1.5.0.spkg\n\n- Reinstall http://sagemath.org/packages/standard/libfplll-3.0.12.p1.spkg\n\n- Install flint2 spkg (beware, this will break Sage)\n  http://sage.math.washington.edu/flint-2.3.spkg\n\n- touch SAGE_ROOT/devel/sage/sage/combinat/partitions.*\n\n- Run \"sage -b\"",
    "created_at": "2011-12-17T19:15:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130563",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:1" align="right">comment:1</div>

Building flint2 in Sage:

- Update MPFR to 3.1.0 - #11666
  http://sage.math.washington.edu/mpfr-3.1.0.spkg

- Update MPFI to 1.5.0 - #12171
  http://sage.math.washington.edu/home/mhansen/mpfi-1.5.0.spkg

- Reinstall http://sagemath.org/packages/standard/libfplll-3.0.12.p1.spkg

- Install flint2 spkg (beware, this will break Sage)
  http://sage.math.washington.edu/flint-2.3.spkg

- touch SAGE_ROOT/devel/sage/sage/combinat/partitions.*

- Run "sage -b"



---

archive/issue_comments_130564.json:
```json
{
    "body": "Attachment: **[ulong_extras.patch.gz](https://github.com/sagemath/sage/files/ticket12173/ulong_extras.patch.gz)**",
    "created_at": "2011-12-18T13:31:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130564",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[ulong_extras.patch.gz](https://github.com/sagemath/sage/files/ticket12173/ulong_extras.patch.gz)**



---

archive/issue_comments_130565.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[zmod.patch.gz](https://github.com/sagemath/sage/files/ticket12173/zmod.patch.gz)**\n\nzmod.patch replaces references to zmod_poly with nmod_poly and (hopefully) fixes places where the interface of a function changed. Completely untested at this point, of course.\n\nSome remarks:\n\nI deleted the zmod_poly_pow function implemented in Sage, since FLINT now provides such a function.\n\nThere is no longer a _nmod_poly_set_coeff_ui, which was used in one place (creating a polynomial from a list). I replaced it with nmod_poly_set_coeff_ui rather than manipulating coefficients directly, which is a bit slower, but shouldn't matter that much.\n\nnmod_poly_resultant needs to be added in FLINT 2. If we don't get it done, the code calling it could just be commented out to fall back to the default Sage code that already handles the non-prime case.\n\nI didn't change any filenames or Sage types (so the corresponding Sage files/functions/types are all still called zmod_poly).\n\nThe new pxd file uses the GMP mp_limb_t (etc) types rather than unsigned long (etc). Some search and replace might be needed, or importing the types from gmp.h.",
    "created_at": "2011-12-18T16:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130565",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[zmod.patch.gz](https://github.com/sagemath/sage/files/ticket12173/zmod.patch.gz)**

zmod.patch replaces references to zmod_poly with nmod_poly and (hopefully) fixes places where the interface of a function changed. Completely untested at this point, of course.

Some remarks:

I deleted the zmod_poly_pow function implemented in Sage, since FLINT now provides such a function.

There is no longer a _nmod_poly_set_coeff_ui, which was used in one place (creating a polynomial from a list). I replaced it with nmod_poly_set_coeff_ui rather than manipulating coefficients directly, which is a bit slower, but shouldn't matter that much.

nmod_poly_resultant needs to be added in FLINT 2. If we don't get it done, the code calling it could just be commented out to fall back to the default Sage code that already handles the non-prime case.

I didn't change any filenames or Sage types (so the corresponding Sage files/functions/types are all still called zmod_poly).

The new pxd file uses the GMP mp_limb_t (etc) types rather than unsigned long (etc). Some search and replace might be needed, or importing the types from gmp.h.



---

archive/issue_comments_130566.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[fmpz.patch.gz](https://github.com/sagemath/sage/files/ticket12173/fmpz.patch.gz)**\n\nAdded another patch for fmpz_poly functions.\n\nfmpz_poly.pxi still needs rewriting, and I didn't touch the cases in polynomial_rational_flint.pyx (since that file needs fmpq_poly fixes as well).",
    "created_at": "2011-12-18T23:18:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130566",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[fmpz.patch.gz](https://github.com/sagemath/sage/files/ticket12173/fmpz.patch.gz)**

Added another patch for fmpz_poly functions.

fmpz_poly.pxi still needs rewriting, and I didn't touch the cases in polynomial_rational_flint.pyx (since that file needs fmpq_poly fixes as well).



---

archive/issue_comments_130567.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI just want to let you know that I have incorporated the current state of progress into an installation of Sage at \n\n    /scratch/spancratz/sflint\n\non sage.math.washington.edu.  Step by step, I have gotten rid of some of the problems, but I didn't have enough time last week to finish this.  By all means, please go ahead and continue working on this copy of the work.\n\nBest wishes\n\nSebastian",
    "created_at": "2012-02-28T17:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130567",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:5" align="right">comment:5</div>

I just want to let you know that I have incorporated the current state of progress into an installation of Sage at 

    /scratch/spancratz/sflint

on sage.math.washington.edu.  Step by step, I have gotten rid of some of the problems, but I didn't have enough time last week to finish this.  By all means, please go ahead and continue working on this copy of the work.

Best wishes

Sebastian



---

archive/issue_comments_130568.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThat might be a stupid question, but how do I access your working copy?\n\nShould I ask for an account on the mentioned machine (to whom?)?",
    "created_at": "2012-02-28T17:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130568",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:6" align="right">comment:6</div>

That might be a stupid question, but how do I access your working copy?

Should I ask for an account on the mentioned machine (to whom?)?



---

archive/issue_comments_130569.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYou should e-mail wstein@gmail.com and say you're working on getting FLINT into Sage.  He'll give you an account on sage.math.washington.edu",
    "created_at": "2012-03-04T05:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130569",
    "user": "https://github.com/roed314"
}
```

<div id="comment:7" align="right">comment:7</div>

You should e-mail wstein@gmail.com and say you're working on getting FLINT into Sage.  He'll give you an account on sage.math.washington.edu



---

archive/issue_events_163655.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-03-04T05:32:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163655"
}
```



---

archive/issue_events_163656.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-03-04T05:32:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163656"
}
```



---

archive/issue_comments_130570.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nWas the directory lost after the recent sage.math problems ?\nI can't locate a spancratz directory on /scratch...\nI'll have a look at the google groups in case I can find more info there.",
    "created_at": "2012-03-29T10:01:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130570",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:9" align="right">comment:9</div>

Was the directory lost after the recent sage.math problems ?
I can't locate a spancratz directory on /scratch...
I'll have a look at the google groups in case I can find more info there.



---

archive/issue_comments_130571.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYes, it seems to be gone.",
    "created_at": "2012-03-29T10:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130571",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:10" align="right">comment:10</div>

Yes, it seems to be gone.



---

archive/issue_comments_130572.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAny chance that one of you backed it up somewhere else ?",
    "created_at": "2012-03-29T13:18:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130572",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:11" align="right">comment:11</div>

Any chance that one of you backed it up somewhere else ?



---

archive/issue_comments_130573.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSebastian says he doesn't have a backup.",
    "created_at": "2012-04-04T23:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130573",
    "user": "https://github.com/roed314"
}
```

<div id="comment:12" align="right">comment:12</div>

Sebastian says he doesn't have a backup.



---

archive/issue_comments_130574.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThis new spkg and patch should apply to a clean install of sage-5.0, and almost completely allows building Sage against flint-2.3:\n\nhttp://sage.math.washington.edu/home/fredrik/flint-2.3.spkg\n\nhttp://sage.math.washington.edu/home/fredrik/flint-2.3-sage-5.0.diff\n\nThere is one small remaining issue building Sage: at one point, the definition of ulong in zn_poly.h apparently clashes with the one in flint. A quick workaround for development purposes is to add #ifndef ulong ... #endif in sage/local/include/zn_poly.h. I don't know the best proper fix. But with the workaround,\n\nsage -f flint-2.3.spkg\n\nsage -b\n\nshould work.\n\nWhen starting Sage, there is a link time error (finding fmpz_set_ZZ), so it seems that the NTL interface is not being built or included correctly. Presumably, fixing that, Sage will start up successfully, though most likely there will be some bugs to hunt down...",
    "created_at": "2012-05-24T03:05:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130574",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:13" align="right">comment:13</div>

This new spkg and patch should apply to a clean install of sage-5.0, and almost completely allows building Sage against flint-2.3:

http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg

http://sage.math.washington.edu/home/fredrik/flint-2.3-sage-5.0.diff

There is one small remaining issue building Sage: at one point, the definition of ulong in zn_poly.h apparently clashes with the one in flint. A quick workaround for development purposes is to add #ifndef ulong ... #endif in sage/local/include/zn_poly.h. I don't know the best proper fix. But with the workaround,

sage -f flint-2.3.spkg

sage -b

should work.

When starting Sage, there is a link time error (finding fmpz_set_ZZ), so it seems that the NTL interface is not being built or included correctly. Presumably, fixing that, Sage will start up successfully, though most likely there will be some bugs to hunt down...



---

archive/issue_comments_130575.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI've had a very quick look and the spkg needs major simplification.\nMost of the logic which was present is now in the flint configure script.\nI'll try to provide an updated version.\n\nI see that there was some restriction in the previous spkg-install reported by Michael Abshoff on an \"US IIIi\" with GCCC 4.3.2 which is not reflected in the configure script.\nSome reason for this ?\n\nTo answer my own question, by default -funroll-loops is not included by default, which covers the solaris case.",
    "created_at": "2012-05-24T09:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130575",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:14" align="right">comment:14</div>

I've had a very quick look and the spkg needs major simplification.
Most of the logic which was present is now in the flint configure script.
I'll try to provide an updated version.

I see that there was some restriction in the previous spkg-install reported by Michael Abshoff on an "US IIIi" with GCCC 4.3.2 which is not reflected in the configure script.
Some reason for this ?

To answer my own question, by default -funroll-loops is not included by default, which covers the solaris case.



---

archive/issue_comments_130576.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI've just reuploaded fredrik patch as an attachment so that it can be easily viewed in trac.",
    "created_at": "2012-05-24T10:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130576",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:15" align="right">comment:15</div>

I've just reuploaded fredrik patch as an attachment so that it can be easily viewed in trac.



---

archive/issue_comments_130577.json:
```json
{
    "body": "Attachment: **[flint-2.3-sage-5.0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.0.patch.gz)**\n\nFredrik's patch.",
    "created_at": "2012-05-24T10:00:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130577",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-sage-5.0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.0.patch.gz)**

Fredrik's patch.



---

archive/issue_comments_130578.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe NTL problem is just that interfaces/NTL-interface.lo is not included into libflint anymore.\nThe configure and Makefile.in files should be modified.\n\nThere was some partial magic added here (*_EXTRAS):\nhttps://github.com/wbhart/flint2/commit/64b5b59977cf1b29bc01faf4d4ff20e121ab7198\nbut removed here:\nhttps://github.com/wbhart/flint2/commit/0103ccbef63781436ad51e060a7adcb0e6b23865\nif I'm not wrong.\n\nViolently changing the Makefile.in to include NTL-interface.lo solves the problem, although this should certainly be included upstream rather than here.",
    "created_at": "2012-05-24T12:13:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130578",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:16" align="right">comment:16</div>

The NTL problem is just that interfaces/NTL-interface.lo is not included into libflint anymore.
The configure and Makefile.in files should be modified.

There was some partial magic added here (*_EXTRAS):
https://github.com/wbhart/flint2/commit/64b5b59977cf1b29bc01faf4d4ff20e121ab7198
but removed here:
https://github.com/wbhart/flint2/commit/0103ccbef63781436ad51e060a7adcb0e6b23865
if I'm not wrong.

Violently changing the Makefile.in to include NTL-interface.lo solves the problem, although this should certainly be included upstream rather than here.



---

archive/issue_comments_130579.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nNow sage launches but I get a crash when quitting due to an undefined symbol flint_stack_cleanup.\nI'll have a look later.",
    "created_at": "2012-05-24T12:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130579",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:17" align="right">comment:17</div>

Now sage launches but I get a crash when quitting due to an undefined symbol flint_stack_cleanup.
I'll have a look later.



---

archive/issue_comments_130580.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nAnother complication might be that the headers used to be installed into $SAGE_LOCAL/include/FLINT which is quite meaningful because there are a lot of them.\n\nIt would be nice to use the install target, but it would put everything into $S_L/include/.\n\nSomebody has a thought about that?\nModify flint Makefile? Install the headers into $S_L/include/ and modify Sage source (mainly the module thing at the top of Sage and flint*.px* files)? Continue to copy the files by hand?",
    "created_at": "2012-05-24T12:21:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130580",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:18" align="right">comment:18</div>

Another complication might be that the headers used to be installed into $SAGE_LOCAL/include/FLINT which is quite meaningful because there are a lot of them.

It would be nice to use the install target, but it would put everything into $S_L/include/.

Somebody has a thought about that?
Modify flint Makefile? Install the headers into $S_L/include/ and modify Sage source (mainly the module thing at the top of Sage and flint*.px* files)? Continue to copy the files by hand?



---

archive/issue_comments_130581.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe call to flint_stack_cleanup() should be replaced with a call to _fmpz_cleanup(), I think.\n\nI agree that it would be nice to keep the header files in a subdirectory. Dunno what the best solution is.",
    "created_at": "2012-05-24T13:38:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130581",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:19" align="right">comment:19</div>

The call to flint_stack_cleanup() should be replaced with a call to _fmpz_cleanup(), I think.

I agree that it would be nice to keep the header files in a subdirectory. Dunno what the best solution is.



---

archive/issue_comments_130582.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@fredrik-johansson](#comment%3A19):\n> I agree that it would be nice to keep the header files in a subdirectory. Dunno what the best solution is.\n\nMy prefered solution would be that make install puts them in a separate directory by default.\nI'll ask on flint-devel to get bill's preference.",
    "created_at": "2012-05-24T13:56:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130582",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@fredrik-johansson](#comment%3A19):
> I agree that it would be nice to keep the header files in a subdirectory. Dunno what the best solution is.

My prefered solution would be that make install puts them in a separate directory by default.
I'll ask on flint-devel to get bill's preference.



---

archive/issue_comments_130583.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@fredrik-johansson](#comment%3A19):\n> The call to flint_stack_cleanup() should be replaced with a call to _fmpz_cleanup(), I think.\n\nAfter quickly looking at the memory management in flint 1.* and flint 2.3, this seems the right solution to me (without real insight nonetheless) and indeed fixes the problem!",
    "created_at": "2012-05-24T16:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130583",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@fredrik-johansson](#comment%3A19):
> The call to flint_stack_cleanup() should be replaced with a call to _fmpz_cleanup(), I think.

After quickly looking at the memory management in flint 1.* and flint 2.3, this seems the right solution to me (without real insight nonetheless) and indeed fixes the problem!



---

archive/issue_comments_130584.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nNow I get a LOT of segfaults.\nFor example, running:\n\n```\nsage: GF(4, 'a')\n```",
    "created_at": "2012-05-24T17:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130584",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:22" align="right">comment:22</div>

Now I get a LOT of segfaults.
For example, running:

```
sage: GF(4, 'a')
```



---

archive/issue_comments_130585.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nTwo things :\n* the order of the structure changed, now exp is before p, not sure this is important...\n* n_factor_t has to be initialized.\n\nWith these changes I can create GF(4)!",
    "created_at": "2012-05-24T17:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130585",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:23" align="right">comment:23</div>

Two things :
* the order of the structure changed, now exp is before p, not sure this is important...
* n_factor_t has to be initialized.

With these changes I can create GF(4)!



---

archive/issue_comments_130586.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThe function n_factor is also called in descent_two_isogeny.",
    "created_at": "2012-05-24T17:31:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130586",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:24" align="right">comment:24</div>

The function n_factor is also called in descent_two_isogeny.



---

archive/issue_comments_130587.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nRunning make ptest raises a limited number of problem.\nThe first one I saw is quite bad: I get time out caused by some segfaults...\n\nApparently, something is now deallocated twice (I get a double linked blah from glibc, more precisely \"*** glibc detected *** python: corrupted double-linked list: 0x00... ***\").\n(This is not caused by the _fmps_cleanup() call, it also happens without it)\n\nThis is not sytemcan be reproduced by testing ell_tate_curve.py for example.",
    "created_at": "2012-05-25T07:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130587",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:25" align="right">comment:25</div>

Running make ptest raises a limited number of problem.
The first one I saw is quite bad: I get time out caused by some segfaults...

Apparently, something is now deallocated twice (I get a double linked blah from glibc, more precisely "*** glibc detected *** python: corrupted double-linked list: 0x00... ***").
(This is not caused by the _fmps_cleanup() call, it also happens without it)

This is not sytemcan be reproduced by testing ell_tate_curve.py for example.



---

archive/issue_comments_130588.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAa far as the other bugs are concerned, it seems that #6919 is back???\nAt least, the same doctest fails.",
    "created_at": "2012-05-25T07:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130588",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:26" align="right">comment:26</div>

Aa far as the other bugs are concerned, it seems that #6919 is back???
At least, the same doctest fails.



---

archive/issue_comments_130589.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@jpflori](#comment%3A26):\n> Aa far as the other bugs are concerned, it seems that #6919 is back???\n> At least, the same doctest fails.\n\nIt seems that this is unfortunately the case.\nI'll report on flint-devel.",
    "created_at": "2012-05-25T08:13:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130589",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@jpflori](#comment%3A26):
> Aa far as the other bugs are concerned, it seems that #6919 is back???
> At least, the same doctest fails.

It seems that this is unfortunately the case.
I'll report on flint-devel.



---

archive/issue_comments_130590.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAbout other easy errors:\n* failures in polynomial_zmod_flint are just a change in the behavior of _mul_trunc_opposite which calls nmod_poly_mulhigh\n* failures in combinat/sf/jack are just changes in ordering and normalization\n* a failure in rings.fraction_field_FpT is just a change in a choice of a sqrt, the other error is more mysterious, in fact it is just because of a different normalization (the minus goes into the denominator rather the numerator)... the problem is that equality testing is consequently wrong, or the result of sqrt should be normalized with the corresponding Sage function (note for later, the nmod_poly_cmp defined there should be removed and nmod_poly_equal used instead)\n* the failure in function_field_element is a chang in the choice of a sqrt\n\nThere is a segfault in function_field_ideal in a call to _nmod_poly_xgcd_euclidean\n\nThe error in flint.pyx is mentioned in the previous post.\n\nThe error in jacobian_morphism might be related to the FFT problem, otherwise, I have no idea.\nQuite strangely Q*239 where Q is a point on a jacobian of hyperelliptic curve should return Q because Q is of order 238...\nEvaluating Q*237+Q*2 is ok equal to Q, but Q*2+Q*237 is wrong equal to -Q !!\nThis is not true for 3, but true for 4, so I guess there is a problem when a point is doubled.\n\nAnd the following files (at least) randomly produced memory managment errors (although all test passed):\n* book_stein_modform\n* ell_tate_curve (less often, potentially different problem)\n* ell_padic_field\n* overconvergent/genus0",
    "created_at": "2012-05-25T09:12:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130590",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:28" align="right">comment:28</div>

About other easy errors:
* failures in polynomial_zmod_flint are just a change in the behavior of _mul_trunc_opposite which calls nmod_poly_mulhigh
* failures in combinat/sf/jack are just changes in ordering and normalization
* a failure in rings.fraction_field_FpT is just a change in a choice of a sqrt, the other error is more mysterious, in fact it is just because of a different normalization (the minus goes into the denominator rather the numerator)... the problem is that equality testing is consequently wrong, or the result of sqrt should be normalized with the corresponding Sage function (note for later, the nmod_poly_cmp defined there should be removed and nmod_poly_equal used instead)
* the failure in function_field_element is a chang in the choice of a sqrt

There is a segfault in function_field_ideal in a call to _nmod_poly_xgcd_euclidean

The error in flint.pyx is mentioned in the previous post.

The error in jacobian_morphism might be related to the FFT problem, otherwise, I have no idea.
Quite strangely Q*239 where Q is a point on a jacobian of hyperelliptic curve should return Q because Q is of order 238...
Evaluating Q*237+Q*2 is ok equal to Q, but Q*2+Q*237 is wrong equal to -Q !!
This is not true for 3, but true for 4, so I guess there is a problem when a point is doubled.

And the following files (at least) randomly produced memory managment errors (although all test passed):
* book_stein_modform
* ell_tate_curve (less often, potentially different problem)
* ell_padic_field
* overconvergent/genus0



---

archive/issue_comments_130591.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nGood work. I'll look at some of the failures tonight.\n\nUntil the FFT gets fixed, we could temporarily disable SS multiplication in _fmpz_poly_mul/low/high to suppress those errors.\n\nDo you have a diff of your edits so far?",
    "created_at": "2012-05-25T09:39:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130591",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:29" align="right">comment:29</div>

Good work. I'll look at some of the failures tonight.

Until the FFT gets fixed, we could temporarily disable SS multiplication in _fmpz_poly_mul/low/high to suppress those errors.

Do you have a diff of your edits so far?



---

archive/issue_comments_130592.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nSome progress:\nThe nmod_xgcd problem seems to be that it segfaults on constant input (that is polynomials of degree 0), this should be reported on flint-devel as well.",
    "created_at": "2012-05-25T09:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130592",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:30" align="right">comment:30</div>

Some progress:
The nmod_xgcd problem seems to be that it segfaults on constant input (that is polynomials of degree 0), this should be reported on flint-devel as well.



---

archive/issue_comments_130593.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@jpflori](#comment%3A30):\n> Some progress:\n> The nmod_xgcd problem seems to be that it segfaults on constant input (that is polynomials of degree 0), this should be reported on flint-devel as well.\n\nAh, great! I love when the segfault is due to \"constant input\" and not \"this specific product of five polynomials of length 2564148\" :-)",
    "created_at": "2012-05-25T09:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130593",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@jpflori](#comment%3A30):
> Some progress:
> The nmod_xgcd problem seems to be that it segfaults on constant input (that is polynomials of degree 0), this should be reported on flint-devel as well.

Ah, great! I love when the segfault is due to "constant input" and not "this specific product of five polynomials of length 2564148" :-)



---

archive/issue_comments_130594.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@fredrik-johansson](#comment%3A29):\n\n> Do you have a diff of your edits so far?\n\nI have.\nI also have to quit my office right now, but I'll quickly copy my working directory and try to upload something usable this afternoon.\nThe patch will surely not be clean, but sufficient to make further testing, because then I'll be away for 3 days (until tuesday morning).",
    "created_at": "2012-05-25T09:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130594",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@fredrik-johansson](#comment%3A29):

> Do you have a diff of your edits so far?

I have.
I also have to quit my office right now, but I'll quickly copy my working directory and try to upload something usable this afternoon.
The patch will surely not be clean, but sufficient to make further testing, because then I'll be away for 3 days (until tuesday morning).



---

archive/issue_comments_130595.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSorry, it seems I failed to upload anything...\n\nAnyway, I just found out that you can doctest a file within gdb which will vastly simplify solving the remaining issues!",
    "created_at": "2012-05-29T10:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130595",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:33" align="right">comment:33</div>

Sorry, it seems I failed to upload anything...

Anyway, I just found out that you can doctest a file within gdb which will vastly simplify solving the remaining issues!



---

archive/issue_comments_130596.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nQuite strangely, something got broken on my 5.0 install and I was not able to reinstall zn_poly while trying to provide a patched spkg (by the way I just found out #12433).\n\nThe problem seems to be that while building profiler.c, the inclusion of profiler.h is skipped so lots of things are undefined (even stderr!).\nI don't get why yet...\n\nAnyway I just started rebuilding stuff on top of a 5.1.beta0 install, first the updated zn_poly spkg from #12433) and then my wip flint-2.3 package and no more tweaking of zn_poly.h is needed to build flint-2.3, which is good news.\nI'm also able to rebuild zn_poly afterward, so maybe I just did something wrong on the previous install.\n\nFredrik's patch needs some rebasing to apply on top of 5.1.beta0.\nI'll rebase it and also upload the few further changes and an updated spkg I made for testing purposes.",
    "created_at": "2012-05-30T08:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130596",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:34" align="right">comment:34</div>

Quite strangely, something got broken on my 5.0 install and I was not able to reinstall zn_poly while trying to provide a patched spkg (by the way I just found out #12433).

The problem seems to be that while building profiler.c, the inclusion of profiler.h is skipped so lots of things are undefined (even stderr!).
I don't get why yet...

Anyway I just started rebuilding stuff on top of a 5.1.beta0 install, first the updated zn_poly spkg from #12433) and then my wip flint-2.3 package and no more tweaking of zn_poly.h is needed to build flint-2.3, which is good news.
I'm also able to rebuild zn_poly afterward, so maybe I just did something wrong on the previous install.

Fredrik's patch needs some rebasing to apply on top of 5.1.beta0.
I'll rebase it and also upload the few further changes and an updated spkg I made for testing purposes.



---

archive/issue_comments_130597.json:
```json
{
    "body": "Dependencies: **12433**",
    "created_at": "2012-05-30T08:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130597",
    "user": "https://github.com/jpflori"
}
```

Dependencies: **12433**



---

archive/issue_comments_130598.json:
```json
{
    "body": "Attachment: **[flint-2.3-sage-5.1.beta0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta0.patch.gz)**\n\nRebased patch for 5.1.beta0.",
    "created_at": "2012-05-30T08:40:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130598",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-sage-5.1.beta0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta0.patch.gz)**

Rebased patch for 5.1.beta0.



---

archive/issue_comments_130599.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAn updated spkg, including Fredrik's fix for the xgcd segfaults, NTL interface build, header files installation, simplified spkg-* scripts, is available at:\nhttp://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg\n\nThis is for testing only.",
    "created_at": "2012-05-30T08:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130599",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:36" align="right">comment:36</div>

An updated spkg, including Fredrik's fix for the xgcd segfaults, NTL interface build, header files installation, simplified spkg-* scripts, is available at:
http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg

This is for testing only.



---

archive/issue_comments_130600.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nOn top of my 5.1.beta0 installation (with #12313 and #12877 applied), I get additional failures in\n* number_field.py (random segfault when quitting).\n* heegner.py (146 doctests (!!!) when running make ptest and then just 2 because a 0.0000... became 0 when running the file doctests alone.)",
    "created_at": "2012-05-30T15:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130600",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:37" align="right">comment:37</div>

On top of my 5.1.beta0 installation (with #12313 and #12877 applied), I get additional failures in
* number_field.py (random segfault when quitting).
* heegner.py (146 doctests (!!!) when running make ptest and then just 2 because a 0.0000... became 0 when running the file doctests alone.)



---

archive/issue_comments_130601.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nMy bad... the memory problems were indeed caused by the call to _fmpz_cleanup as I found out using valgrind.\n\nI wrote pass instead of return so that the function was still called...",
    "created_at": "2012-05-31T12:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130601",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:38" align="right">comment:38</div>

My bad... the memory problems were indeed caused by the call to _fmpz_cleanup as I found out using valgrind.

I wrote pass instead of return so that the function was still called...



---

archive/issue_comments_130602.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI'm not sure how everything gets freed when Sage exits but I think I got the culprit (or one of them).\n\nWhen quit_all() in sage.all is called\n- in the beginning free_flint_stack() is called which calls _fmpz_cleanup(),\n- but then there must be other calls to fmpz_poly_clear() for example in ..quaternion_algebra_element._clear_globals(),\nwhence potential double free().\n\nAlso the `__dealloc__` methods of the classes based on fmp?_poly call fmp?_clear_poly.\nI don't know when Python objects are deallocated but if this happens after the call to _fmpz_cleanup(), that might be problematic.\n\nAs far as PARI is concerned, the `__dealloc__` function of gen objects first checks that the pointer to the PARI object is not 0, maybe the same should be done for Sage objects based on flint objects.\nHowever, calls to fmpz_poly_clear as in quaternion_algebra_element will be more tedious to deal with.\n\nAfter a first experiment, putting the call to free_flint_stack() a little later, just after twisted is closed solves memory corruption when doctesting ell_padic_field.\nThis is quite mysterious to me...",
    "created_at": "2012-05-31T12:50:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130602",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:39" align="right">comment:39</div>

I'm not sure how everything gets freed when Sage exits but I think I got the culprit (or one of them).

When quit_all() in sage.all is called
- in the beginning free_flint_stack() is called which calls _fmpz_cleanup(),
- but then there must be other calls to fmpz_poly_clear() for example in ..quaternion_algebra_element._clear_globals(),
whence potential double free().

Also the `__dealloc__` methods of the classes based on fmp?_poly call fmp?_clear_poly.
I don't know when Python objects are deallocated but if this happens after the call to _fmpz_cleanup(), that might be problematic.

As far as PARI is concerned, the `__dealloc__` function of gen objects first checks that the pointer to the PARI object is not 0, maybe the same should be done for Sage objects based on flint objects.
However, calls to fmpz_poly_clear as in quaternion_algebra_element will be more tedious to deal with.

After a first experiment, putting the call to free_flint_stack() a little later, just after twisted is closed solves memory corruption when doctesting ell_padic_field.
This is quite mysterious to me...



---

archive/issue_comments_130603.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nMmm, all of this seems quite more involved...\nThe calls to *_poly_clear should not be problematic, the problem comes from somewhere else.",
    "created_at": "2012-05-31T13:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130603",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:40" align="right">comment:40</div>

Mmm, all of this seems quite more involved...
The calls to *_poly_clear should not be problematic, the problem comes from somewhere else.



---

archive/issue_comments_130604.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nHere is some progress hopefully:\nthe easiiest way I found to reproduce the memory corruption error is through doctesting sage/schemes/elliptic_curves/ell_padic_field.py\n\nWithin this file the problem seems to come (meaning that if I remove it I cannont repoduce the bug in a reasonable time) from the line\n\n```\nuN = (1 + h(x0)/y0**(2*p)).sqrt()\n```\nand more precisely from the evaluation\n\n```\nh(x0)\n```\nAND because it is done within a locally defined function whereas h is defined in the outer function.\n\nI'm not sure all the memory corruption problems come from such a case, but at least sage/schemes/elliptic_curves/padics.py where I've seen one time such a bug and sage/schemes/elliptic_curves/ell_tate_curve.py where I've seen it several times use similarly locally defined functions.",
    "created_at": "2012-06-01T08:46:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130604",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:41" align="right">comment:41</div>

Here is some progress hopefully:
the easiiest way I found to reproduce the memory corruption error is through doctesting sage/schemes/elliptic_curves/ell_padic_field.py

Within this file the problem seems to come (meaning that if I remove it I cannont repoduce the bug in a reasonable time) from the line

```
uN = (1 + h(x0)/y0**(2*p)).sqrt()
```
and more precisely from the evaluation

```
h(x0)
```
AND because it is done within a locally defined function whereas h is defined in the outer function.

I'm not sure all the memory corruption problems come from such a case, but at least sage/schemes/elliptic_curves/padics.py where I've seen one time such a bug and sage/schemes/elliptic_curves/ell_tate_curve.py where I've seen it several times use similarly locally defined functions.



---

archive/issue_comments_130605.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThat's really strange. Does building flint in reentrant mode change anything?",
    "created_at": "2012-06-01T09:25:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130605",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:42" align="right">comment:42</div>

That's really strange. Does building flint in reentrant mode change anything?



---

archive/issue_comments_130606.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nI think that unfortunately the real reason is deeper but the error occurs only in this situation...\nI'll post some valgrind logs and point out what I think might be hintful.",
    "created_at": "2012-06-01T09:29:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130606",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:43" align="right">comment:43</div>

I think that unfortunately the real reason is deeper but the error occurs only in this situation...
I'll post some valgrind logs and point out what I think might be hintful.



---

archive/issue_comments_130607.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@fredrik-johansson](#comment%3A42):\n> That's really strange. Does building flint in reentrant mode change anything?\n\nCompiling flint in reentrant mode seems to \"solve\" the ell_padic_field error.\nI just launched \"make ptest\" and will report about that when it finishes.",
    "created_at": "2012-06-01T11:40:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130607",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@fredrik-johansson](#comment%3A42):
> That's really strange. Does building flint in reentrant mode change anything?

Compiling flint in reentrant mode seems to "solve" the ell_padic_field error.
I just launched "make ptest" and will report about that when it finishes.



---

archive/issue_comments_130608.json:
```json
{
    "body": "Changed dependencies from **12433** to **#12433**",
    "created_at": "2012-06-01T11:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130608",
    "user": "https://github.com/jpflori"
}
```

Changed dependencies from **12433** to **#12433**



---

archive/issue_comments_130609.json:
```json
{
    "body": "Rebase on 5.1.beta1 (this is basically the original 5.0 patch without fuzz)",
    "created_at": "2012-06-01T11:41:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130609",
    "user": "https://github.com/jpflori"
}
```

Rebase on 5.1.beta1 (this is basically the original 5.0 patch without fuzz)



---

archive/issue_comments_130610.json:
```json
{
    "body": "Attachment: **[flint-2.3-sage-5.1.beta1.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta1.patch.gz)**\n\nSome further changes. For testing only.",
    "created_at": "2012-06-01T11:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130610",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-sage-5.1.beta1.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta1.patch.gz)**

Some further changes. For testing only.



---

archive/issue_comments_130611.json:
```json
{
    "body": "Attachment: **[flint-2.3-jp.2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-jp.2.patch.gz)**\n\nDoctest of ell_padic_field.py on vanilla 5.1.beta1.",
    "created_at": "2012-06-01T11:43:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130611",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-jp.2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-jp.2.patch.gz)**

Doctest of ell_padic_field.py on vanilla 5.1.beta1.



---

archive/issue_comments_130612.json:
```json
{
    "body": "Attachment: **[ell_padic_field-5.1.beta1.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/ell_padic_field-5.1.beta1.valgrind.gz)**\n\nDoctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg.",
    "created_at": "2012-06-01T11:44:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130612",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[ell_padic_field-5.1.beta1.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/ell_padic_field-5.1.beta1.valgrind.gz)**

Doctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg.



---

archive/issue_comments_130613.json:
```json
{
    "body": "Attachment: **[ell_padic_field-5.1.beta1+zn_poly.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/8902e0bbc6c0bd0d3573054070cd8ebd.gz)**\n\nAttachment: **[ell_padic_field-5.1.beta1+flint2.3.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/c399ab9be678e7f3bae71f28a18eb210.gz)**\n\nDoctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg + new flint spkg.",
    "created_at": "2012-06-01T11:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130613",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[ell_padic_field-5.1.beta1+zn_poly.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/8902e0bbc6c0bd0d3573054070cd8ebd.gz)**

Attachment: **[ell_padic_field-5.1.beta1+flint2.3.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/c399ab9be678e7f3bae71f28a18eb210.gz)**

Doctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg + new flint spkg.



---

archive/issue_comments_130614.json:
```json
{
    "body": "Attachment: **[ell_padic_field-5.1.beta1+flint2.3+move.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/958edc68e7d5c73a093bc587892910ce.gz)**\n\nDoctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg + new flint spkg + moving the \"h =\" line.",
    "created_at": "2012-06-01T11:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130614",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[ell_padic_field-5.1.beta1+flint2.3+move.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/958edc68e7d5c73a093bc587892910ce.gz)**

Doctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg + new flint spkg + moving the "h =" line.



---

archive/issue_comments_130615.json:
```json
{
    "body": "Attachment: **[ell_padic_field-5.1.beta1+flint2.3+reentrant.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/d423604ced573e19395a9f54b844adb6.gz)**\n\nDoctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg + new flint spkg compiled reentrant.",
    "created_at": "2012-06-01T11:45:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130615",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[ell_padic_field-5.1.beta1+flint2.3+reentrant.valgrind.gz](https://github.com/sagemath/sage/files/ticket12173/d423604ced573e19395a9f54b844adb6.gz)**

Doctest of ell_padic_field.py on 5.1.beta1 + new zn_poly spkg + new flint spkg compiled reentrant.



---

archive/issue_comments_130616.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@jpflori](#comment%3A44):\n> Replying to [@fredrik-johansson](#comment%3A42):\n> > That's really strange. Does building flint in reentrant mode change anything?\n\n> Compiling flint in reentrant mode seems to \"solve\" the ell_padic_field error.\n> I just launched \"make ptest\" and will report about that when it finishes.\n\nIndeed, make ptest only returns non memory related errors.",
    "created_at": "2012-06-01T12:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130616",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@jpflori](#comment%3A44):
> Replying to [@fredrik-johansson](#comment%3A42):
> > That's really strange. Does building flint in reentrant mode change anything?

> Compiling flint in reentrant mode seems to "solve" the ell_padic_field error.
> I just launched "make ptest" and will report about that when it finishes.

Indeed, make ptest only returns non memory related errors.



---

archive/issue_comments_130617.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nHere is what might be the important part from the valgrind log of 5.1.beta1 + zn_poly + flint (single)\n\n```\n==17534== Invalid read of size 8\n==17534==    at 0x829DE0D: __gmpn_copyi (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/local/lib/libgmp.so.7.4.0)\n==17534==    by 0x8256F49: __gmpz_export (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/local/lib/libgmp.so.7.4.0)\n==17534==    by 0x1318FD2C: __pyx_f_4sage_4libs_4pari_3gen_12PariInstance__new_GEN_from_mpz_t (gen.c:43564)\n==17534==    by 0x131B31E2: __pyx_f_4sage_4libs_4pari_3gen_12PariInstance_new_gen_from_padic (gen.c:43941)\n==17534==    by 0x1DBFF444: __pyx_f_4sage_5rings_6padics_29padic_capped_relative_element_26pAdicCappedRelativeElement__to_gen (padic_capped_relative_element.c:15445)\n==17534==    by 0x1DBFECED: __pyx_pf_4sage_5rings_6padics_29padic_capped_relative_element_26pAdicCappedRelativeElement_25_pari_ (padic_capped_relative_element.c:15492)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x131ECF4D: __pyx_pf_4sage_4libs_4pari_3gen_12PariInstance_14__call__ (gen.c:44625)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x1D5A9CDB: __pyx_pf_4sage_5rings_6padics_21padic_generic_element_19pAdicGenericElement_19square_root (padic_generic_element.c:7417)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x1D398D26: __pyx_pf_4sage_5rings_6padics_21local_generic_element_19LocalGenericElement_6sqrt (local_generic_element.c:2604)\n==17534==    by 0x4F20DBC: PyEval_EvalFrameEx (ceval.c:4013)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4F20690: PyEval_EvalFrameEx (ceval.c:4109)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4F20690: PyEval_EvalFrameEx (ceval.c:4109)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4F22551: PyEval_EvalCode (ceval.c:667)\n==17534==    by 0x4F20C5E: PyEval_EvalFrameEx (ceval.c:4710)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4EA53DB: function_call (funcobject.c:526)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x4E8AD0E: instancemethod_call (classobject.c:2578)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==  Address 0x2f78a098 is 0 bytes after a block of size 8 alloc'd\n==17534==    at 0x4C2B313: malloc (vg_replace_malloc.c:263)\n==17534==    by 0x75DF272: sage_malloc (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/devel/sage-main/c_lib/libcsage.so)\n==17534==    by 0x75DF30D: sage_mpir_malloc (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/devel/sage-main/c_lib/libcsage.so)\n==17534==    by 0x14BDA9E9: __pyx_f_4sage_5rings_7integer_fast_tp_new (integer.c:33356)\n==17534==    by 0x14BFAB8A: __pyx_f_4sage_5rings_7integer_7Integer__valuation (integer.c:21279)\n==17534==    by 0x14BDB3F6: __pyx_pf_4sage_5rings_7integer_7Integer_65valuation (integer.c:21643)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x1DC06CF3: __pyx_pf_4sage_5rings_6padics_29padic_capped_relative_element_26pAdicCappedRelativeElement_6__pow__ (padic_capped_relative_element.c:9477)\n==17534==    by 0x4E78891: ternary_op.isra.9 (abstract.c:1065)\n==17534==    by 0x4F1CA3C: PyEval_EvalFrameEx (ceval.c:1254)\n==17534==    by 0x4F21260: PyEval_EvalFrameEx (ceval.c:4099)\n==17534==    by 0x4F21260: PyEval_EvalFrameEx (ceval.c:4099)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4EA53DB: function_call (funcobject.c:526)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x4E8AD0E: instancemethod_call (classobject.c:2578)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x4F1F46C: PyEval_EvalFrameEx (ceval.c:4231)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4EA53DB: function_call (funcobject.c:526)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x4E8AD0E: instancemethod_call (classobject.c:2578)\n==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)\n==17534==    by 0x4EDE2AF: slot_tp_init (typeobject.c:5657)\n==17534==    by 0x4EDA0A7: type_call (typeobject.c:737)\n==17534== \n==17534== Invalid write of size 8\n==17534==    at 0x14E76501: _fmpz_clear_mpz (fmpz.c:78)\n==17534==    by 0x14E86E2B: fmpz_poly_clear (fmpz.h:75)\n==17534==    by 0x1CD20BB8: __pyx_tp_dealloc_4sage_5rings_10polynomial_30polynomial_integer_dense_flint_Polynomial_integer_dense_flint(_object*) (polynomial_integer_dense_flint.cpp:4390)\n==17534==    by 0x4EB6F6E: dict_dealloc (dictobject.c:985)\n==17534==    by 0x4ED5EF3: subtype_dealloc (typeobject.c:999)\n==17534==    by 0x4E88E6D: cell_dealloc (cellobject.c:50)\n==17534==    by 0x4ED3282: tupledealloc (tupleobject.c:220)\n==17534==    by 0x4EA5646: func_dealloc (funcobject.c:461)\n==17534==    by 0x4EB8B1A: PyDict_Clear (dictobject.c:891)\n==17534==    by 0x4EB8C78: dict_tp_clear (dictobject.c:2088)\n==17534==    by 0x4F593B6: collect (gcmodule.c:769)\n==17534==    by 0x4F59F27: _PyObject_GC_Malloc (gcmodule.c:996)\n==17534==    by 0x4F59F8D: _PyObject_GC_NewVar (gcmodule.c:1477)\n==17534==    by 0x4ED374D: PyTuple_New (tupleobject.c:90)\n==17534==    by 0x4F3D20D: r_object (marshal.c:874)\n==17534==    by 0x4F3D743: r_object (marshal.c:1013)\n==17534==    by 0x4F3D254: r_object (marshal.c:880)\n==17534==    by 0x4F3D743: r_object (marshal.c:1013)\n==17534==    by 0x4F3FB47: PyMarshal_ReadObjectFromString (marshal.c:1181)\n==17534==    by 0x4F3FC2B: PyMarshal_ReadLastObjectFromFile (marshal.c:1142)\n==17534==    by 0x4F398F4: load_source_module (import.c:773)\n==17534==    by 0x4F3A97B: import_submodule (import.c:2596)\n==17534==    by 0x4F3AEFF: ensure_fromlist (import.c:2507)\n==17534==    by 0x4F3B393: import_module_level.isra.9 (import.c:2175)\n==17534==    by 0x4F3B849: PyImport_ImportModuleLevel (import.c:2189)\n==17534==  Address 0x60fac08 is 728 bytes inside a block of size 1,024 free'd\n==17534==    at 0x4C2A654: free (vg_replace_malloc.c:427)\n==17534==    by 0x14E765B0: _fmpz_cleanup (fmpz.c:88)\n==17534==    by 0x3C310E4A: __pyx_pf_4sage_4libs_5flint_5flint_free_flint_stack (flint.c:447)\n==17534==    by 0x4F20B52: PyEval_EvalFrameEx (ceval.c:3997)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4F20690: PyEval_EvalFrameEx (ceval.c:4109)\n==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)\n==17534==    by 0x4F22551: PyEval_EvalCode (ceval.c:667)\n==17534==    by 0x4F44CEF: PyRun_FileExFlags (pythonrun.c:1346)\n==17534==    by 0x4F4578E: PyRun_SimpleFileExFlags (pythonrun.c:936)\n==17534==    by 0x4F586B4: Py_Main (main.c:599)\n==17534==    by 0x544876C: (below main) (libc-start.c:226)\n```",
    "created_at": "2012-06-01T12:21:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130617",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:47" align="right">comment:47</div>

Here is what might be the important part from the valgrind log of 5.1.beta1 + zn_poly + flint (single)

```
==17534== Invalid read of size 8
==17534==    at 0x829DE0D: __gmpn_copyi (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/local/lib/libgmp.so.7.4.0)
==17534==    by 0x8256F49: __gmpz_export (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/local/lib/libgmp.so.7.4.0)
==17534==    by 0x1318FD2C: __pyx_f_4sage_4libs_4pari_3gen_12PariInstance__new_GEN_from_mpz_t (gen.c:43564)
==17534==    by 0x131B31E2: __pyx_f_4sage_4libs_4pari_3gen_12PariInstance_new_gen_from_padic (gen.c:43941)
==17534==    by 0x1DBFF444: __pyx_f_4sage_5rings_6padics_29padic_capped_relative_element_26pAdicCappedRelativeElement__to_gen (padic_capped_relative_element.c:15445)
==17534==    by 0x1DBFECED: __pyx_pf_4sage_5rings_6padics_29padic_capped_relative_element_26pAdicCappedRelativeElement_25_pari_ (padic_capped_relative_element.c:15492)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x131ECF4D: __pyx_pf_4sage_4libs_4pari_3gen_12PariInstance_14__call__ (gen.c:44625)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x1D5A9CDB: __pyx_pf_4sage_5rings_6padics_21padic_generic_element_19pAdicGenericElement_19square_root (padic_generic_element.c:7417)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x1D398D26: __pyx_pf_4sage_5rings_6padics_21local_generic_element_19LocalGenericElement_6sqrt (local_generic_element.c:2604)
==17534==    by 0x4F20DBC: PyEval_EvalFrameEx (ceval.c:4013)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4F20690: PyEval_EvalFrameEx (ceval.c:4109)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4F20690: PyEval_EvalFrameEx (ceval.c:4109)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4F22551: PyEval_EvalCode (ceval.c:667)
==17534==    by 0x4F20C5E: PyEval_EvalFrameEx (ceval.c:4710)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4EA53DB: function_call (funcobject.c:526)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x4E8AD0E: instancemethod_call (classobject.c:2578)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==  Address 0x2f78a098 is 0 bytes after a block of size 8 alloc'd
==17534==    at 0x4C2B313: malloc (vg_replace_malloc.c:263)
==17534==    by 0x75DF272: sage_malloc (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/devel/sage-main/c_lib/libcsage.so)
==17534==    by 0x75DF30D: sage_mpir_malloc (in /media/local/flori/sage/sage-5.1.beta1+flint-2.3/devel/sage-main/c_lib/libcsage.so)
==17534==    by 0x14BDA9E9: __pyx_f_4sage_5rings_7integer_fast_tp_new (integer.c:33356)
==17534==    by 0x14BFAB8A: __pyx_f_4sage_5rings_7integer_7Integer__valuation (integer.c:21279)
==17534==    by 0x14BDB3F6: __pyx_pf_4sage_5rings_7integer_7Integer_65valuation (integer.c:21643)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x1DC06CF3: __pyx_pf_4sage_5rings_6padics_29padic_capped_relative_element_26pAdicCappedRelativeElement_6__pow__ (padic_capped_relative_element.c:9477)
==17534==    by 0x4E78891: ternary_op.isra.9 (abstract.c:1065)
==17534==    by 0x4F1CA3C: PyEval_EvalFrameEx (ceval.c:1254)
==17534==    by 0x4F21260: PyEval_EvalFrameEx (ceval.c:4099)
==17534==    by 0x4F21260: PyEval_EvalFrameEx (ceval.c:4099)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4EA53DB: function_call (funcobject.c:526)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x4E8AD0E: instancemethod_call (classobject.c:2578)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x4F1F46C: PyEval_EvalFrameEx (ceval.c:4231)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4EA53DB: function_call (funcobject.c:526)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x4E8AD0E: instancemethod_call (classobject.c:2578)
==17534==    by 0x4E7D5B2: PyObject_Call (abstract.c:2529)
==17534==    by 0x4EDE2AF: slot_tp_init (typeobject.c:5657)
==17534==    by 0x4EDA0A7: type_call (typeobject.c:737)
==17534== 
==17534== Invalid write of size 8
==17534==    at 0x14E76501: _fmpz_clear_mpz (fmpz.c:78)
==17534==    by 0x14E86E2B: fmpz_poly_clear (fmpz.h:75)
==17534==    by 0x1CD20BB8: __pyx_tp_dealloc_4sage_5rings_10polynomial_30polynomial_integer_dense_flint_Polynomial_integer_dense_flint(_object*) (polynomial_integer_dense_flint.cpp:4390)
==17534==    by 0x4EB6F6E: dict_dealloc (dictobject.c:985)
==17534==    by 0x4ED5EF3: subtype_dealloc (typeobject.c:999)
==17534==    by 0x4E88E6D: cell_dealloc (cellobject.c:50)
==17534==    by 0x4ED3282: tupledealloc (tupleobject.c:220)
==17534==    by 0x4EA5646: func_dealloc (funcobject.c:461)
==17534==    by 0x4EB8B1A: PyDict_Clear (dictobject.c:891)
==17534==    by 0x4EB8C78: dict_tp_clear (dictobject.c:2088)
==17534==    by 0x4F593B6: collect (gcmodule.c:769)
==17534==    by 0x4F59F27: _PyObject_GC_Malloc (gcmodule.c:996)
==17534==    by 0x4F59F8D: _PyObject_GC_NewVar (gcmodule.c:1477)
==17534==    by 0x4ED374D: PyTuple_New (tupleobject.c:90)
==17534==    by 0x4F3D20D: r_object (marshal.c:874)
==17534==    by 0x4F3D743: r_object (marshal.c:1013)
==17534==    by 0x4F3D254: r_object (marshal.c:880)
==17534==    by 0x4F3D743: r_object (marshal.c:1013)
==17534==    by 0x4F3FB47: PyMarshal_ReadObjectFromString (marshal.c:1181)
==17534==    by 0x4F3FC2B: PyMarshal_ReadLastObjectFromFile (marshal.c:1142)
==17534==    by 0x4F398F4: load_source_module (import.c:773)
==17534==    by 0x4F3A97B: import_submodule (import.c:2596)
==17534==    by 0x4F3AEFF: ensure_fromlist (import.c:2507)
==17534==    by 0x4F3B393: import_module_level.isra.9 (import.c:2175)
==17534==    by 0x4F3B849: PyImport_ImportModuleLevel (import.c:2189)
==17534==  Address 0x60fac08 is 728 bytes inside a block of size 1,024 free'd
==17534==    at 0x4C2A654: free (vg_replace_malloc.c:427)
==17534==    by 0x14E765B0: _fmpz_cleanup (fmpz.c:88)
==17534==    by 0x3C310E4A: __pyx_pf_4sage_4libs_5flint_5flint_free_flint_stack (flint.c:447)
==17534==    by 0x4F20B52: PyEval_EvalFrameEx (ceval.c:3997)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4F20690: PyEval_EvalFrameEx (ceval.c:4109)
==17534==    by 0x4F22414: PyEval_EvalCodeEx (ceval.c:3253)
==17534==    by 0x4F22551: PyEval_EvalCode (ceval.c:667)
==17534==    by 0x4F44CEF: PyRun_FileExFlags (pythonrun.c:1346)
==17534==    by 0x4F4578E: PyRun_SimpleFileExFlags (pythonrun.c:936)
==17534==    by 0x4F586B4: Py_Main (main.c:599)
==17534==    by 0x544876C: (below main) (libc-start.c:226)
```



---

archive/issue_comments_130618.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nThe first Invalid read of size 8 is likely not a bug. On various platforms, mpn_copyi relies on page boundaries being aligned to a multiple of 16 bytes so that it can safely read an extra 8 bytes, IIRC. (This pops up all over the place when valgrinding flint unit tests, and it's convenient to add it to the valgrind suppression file.)\n\nThe second one has to be what it looks like: some polynomial lives until after _fmpz_cleanup has been called.\n\nSo the question is how we can guarantee that all Python objects referencing flint objects get deallocated before _fmpz_cleanup is called. \n\nIf this is impossible, I guess we could compile flint in reentrant mode for Sage (but this would slow things down, unfortunately). \n\nOne possibility is that we change _fmpz_cleanup to free all mpz limb data but leave the mpz array. This might still be a bit fragile, but if it works, it should solve the problem of polluting valgrind logs since there will only be one large block of unfreed memory.\n\nWe must also have this problem with flint_compute_primes.\n\nDoes Sage free the MPFR caches on exit, and if so where?\n\nPerhaps this should be brought to sage-devel.",
    "created_at": "2012-06-01T13:03:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130618",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:48" align="right">comment:48</div>

The first Invalid read of size 8 is likely not a bug. On various platforms, mpn_copyi relies on page boundaries being aligned to a multiple of 16 bytes so that it can safely read an extra 8 bytes, IIRC. (This pops up all over the place when valgrinding flint unit tests, and it's convenient to add it to the valgrind suppression file.)

The second one has to be what it looks like: some polynomial lives until after _fmpz_cleanup has been called.

So the question is how we can guarantee that all Python objects referencing flint objects get deallocated before _fmpz_cleanup is called. 

If this is impossible, I guess we could compile flint in reentrant mode for Sage (but this would slow things down, unfortunately). 

One possibility is that we change _fmpz_cleanup to free all mpz limb data but leave the mpz array. This might still be a bit fragile, but if it works, it should solve the problem of polluting valgrind logs since there will only be one large block of unfreed memory.

We must also have this problem with flint_compute_primes.

Does Sage free the MPFR caches on exit, and if so where?

Perhaps this should be brought to sage-devel.



---

archive/issue_comments_130619.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@fredrik-johansson](#comment%3A48):\n> Does Sage free the MPFR caches on exit, and if so where?\n\nActually, this is irrelevant, because it can't cause the same kind of errors.",
    "created_at": "2012-06-01T13:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130619",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@fredrik-johansson](#comment%3A48):
> Does Sage free the MPFR caches on exit, and if so where?

Actually, this is irrelevant, because it can't cause the same kind of errors.



---

archive/issue_comments_130620.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@fredrik-johansson](#comment%3A48):\n> The first Invalid read of size 8 is likely not a bug. On various platforms, mpn_copyi relies on page boundaries being aligned to a multiple of 16 bytes so that it can safely read an extra 8 bytes, IIRC. (This pops up all over the place when valgrinding flint unit tests, and it's convenient to add it to the valgrind suppression file.)\n\nThanks, I wasn't aware of that.\n> \n> The second one has to be what it looks like: some polynomial lives until after _fmpz_cleanup has been called.\n> \n> So the question is how we can guarantee that all Python objects referencing flint objects get deallocated before _fmpz_cleanup is called. \n\nI tried to modify the `__dealloc__` methods of all classes involving flint polynomials and in the different files directly using them by first checking that the pointer is not 0 before calling the clear function, but it did not solve the problem.\nSo either I forgot some of them or my test was stupid (I just copied the idea from the PARI's GEN class, I didn't actually think).\n> \n> If this is impossible, I guess we could compile flint in reentrant mode for Sage (but this would slow things down, unfortunately). \n\nSlowing down the library would not be that great.\nAs i mentioned earlier, jsut moving the call to _flint_cleanup within quit_sage solves the problem, even though this is surely not the \"right\" solution.\nI'm not convinced compiling flint in reentrant mode would be although I have no real knowledge of reentrancy.\n> \n> One possibility is that we change _fmpz_cleanup to free all mpz limb data but leave the mpz array. This might still be a bit fragile, but if it works, it should solve the problem of polluting valgrind logs since there will only be one large block of unfreed memory.\n> \n> We must also have this problem with flint_compute_primes.\n> \n> Does Sage free the MPFR caches on exit, and if so where?\n\nDeallocation is done by quit_sage() defined in $SAGE_ROOT/devel/sage/sage/all.py\n\nDifferent libraries are concerned, e.g. PARI, but MPFR is not.\nPotentially, and if this was possible, this was just forgotten.\n> \n> Perhaps this should be brought to sage-devel.",
    "created_at": "2012-06-01T13:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130620",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@fredrik-johansson](#comment%3A48):
> The first Invalid read of size 8 is likely not a bug. On various platforms, mpn_copyi relies on page boundaries being aligned to a multiple of 16 bytes so that it can safely read an extra 8 bytes, IIRC. (This pops up all over the place when valgrinding flint unit tests, and it's convenient to add it to the valgrind suppression file.)

Thanks, I wasn't aware of that.
> 
> The second one has to be what it looks like: some polynomial lives until after _fmpz_cleanup has been called.
> 
> So the question is how we can guarantee that all Python objects referencing flint objects get deallocated before _fmpz_cleanup is called. 

I tried to modify the `__dealloc__` methods of all classes involving flint polynomials and in the different files directly using them by first checking that the pointer is not 0 before calling the clear function, but it did not solve the problem.
So either I forgot some of them or my test was stupid (I just copied the idea from the PARI's GEN class, I didn't actually think).
> 
> If this is impossible, I guess we could compile flint in reentrant mode for Sage (but this would slow things down, unfortunately). 

Slowing down the library would not be that great.
As i mentioned earlier, jsut moving the call to _flint_cleanup within quit_sage solves the problem, even though this is surely not the "right" solution.
I'm not convinced compiling flint in reentrant mode would be although I have no real knowledge of reentrancy.
> 
> One possibility is that we change _fmpz_cleanup to free all mpz limb data but leave the mpz array. This might still be a bit fragile, but if it works, it should solve the problem of polluting valgrind logs since there will only be one large block of unfreed memory.
> 
> We must also have this problem with flint_compute_primes.
> 
> Does Sage free the MPFR caches on exit, and if so where?

Deallocation is done by quit_sage() defined in $SAGE_ROOT/devel/sage/sage/all.py

Different libraries are concerned, e.g. PARI, but MPFR is not.
Potentially, and if this was possible, this was just forgotten.
> 
> Perhaps this should be brought to sage-devel.



---

archive/issue_comments_130621.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@jpflori](#comment%3A50):\n> or my test was stupid (I just copied the idea from the PARI's GEN class, I didn't actually think).\n\nThis was surely the case :)",
    "created_at": "2012-06-01T13:19:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130621",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@jpflori](#comment%3A50):
> or my test was stupid (I just copied the idea from the PARI's GEN class, I didn't actually think).

This was surely the case :)



---

archive/issue_comments_130622.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI do think moving the _fmpz_cleanup call within quit_sage is the correct solution if it does work.\n\nIf it doesn't work, that means some part of Sage is hanging on to some Python objects, and that code should arguably be fixed so that they can be freed first (perhaps with an explicit call).",
    "created_at": "2012-06-01T13:24:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130622",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:52" align="right">comment:52</div>

I do think moving the _fmpz_cleanup call within quit_sage is the correct solution if it does work.

If it doesn't work, that means some part of Sage is hanging on to some Python objects, and that code should arguably be fixed so that they can be freed first (perhaps with an explicit call).



---

archive/issue_comments_130623.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@fredrik-johansson](#comment%3A52):\n> I do think moving the _fmpz_cleanup call within quit_sage is the correct solution if it does work.\n\nI'm quite ok with this decision, although, as I pointed before, I have no idea of when Python/Sage objects actually get deallocated, so this might be a flaky solution.\n\nNow I'm getting a little lost:\nI have trouble to understand how the error (in the different forms it takes, I assumed it was actually an underlying \"double free\") can be caused by a call to fmpz_poly_clean after _fmpz_cleanup was called.\nIndeed, all fmpz_poly_clean does is to deallocate the space needed to store pointers to the coefficients and write in the fmpz_unused_arr that the coeff itself can be reused.\nThis array was already deallocated by _fmpz_cleanup, so we end up writing somewhere we should not really, but whatever should I say: it is quite unlikely that this will actually break something.\n\nSorry if that sounds stupid or is deeply wrong, but I prefer to be sure everything is clear in my mind.",
    "created_at": "2012-06-01T14:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130623",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@fredrik-johansson](#comment%3A52):
> I do think moving the _fmpz_cleanup call within quit_sage is the correct solution if it does work.

I'm quite ok with this decision, although, as I pointed before, I have no idea of when Python/Sage objects actually get deallocated, so this might be a flaky solution.

Now I'm getting a little lost:
I have trouble to understand how the error (in the different forms it takes, I assumed it was actually an underlying "double free") can be caused by a call to fmpz_poly_clean after _fmpz_cleanup was called.
Indeed, all fmpz_poly_clean does is to deallocate the space needed to store pointers to the coefficients and write in the fmpz_unused_arr that the coeff itself can be reused.
This array was already deallocated by _fmpz_cleanup, so we end up writing somewhere we should not really, but whatever should I say: it is quite unlikely that this will actually break something.

Sorry if that sounds stupid or is deeply wrong, but I prefer to be sure everything is clear in my mind.



---

archive/issue_comments_130624.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nfmpz_poly_clear calls fmpz_clear on all its coefficients. fmpz_clear adds the pointer to the unused array to make it available for subsequent reuse. So we can't deallocate fmpz_unused_arr until all fmpz_clear calls have been made.",
    "created_at": "2012-06-01T15:03:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130624",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:54" align="right">comment:54</div>

fmpz_poly_clear calls fmpz_clear on all its coefficients. fmpz_clear adds the pointer to the unused array to make it available for subsequent reuse. So we can't deallocate fmpz_unused_arr until all fmpz_clear calls have been made.



---

archive/issue_comments_130625.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nOk, but then some fmpz won't be freed and that's all.\nThis won't lead to any segfault, memory error or horrible breaks.\n\nIn case someone actually used Sage in library mode, and played at launching and closing it several times, that would lead to memory leaks (surely among a lot of other ones), but nothing more.\n\nAnd I do not see any problematic calls to fmpz_clear within Sage.\nThe few ones (its definition within fmpz.pxi, 4 calls in polynomial_integer_dense_flint.pyx and one call in quaternion_algebra_element.pyx) are typically made on local variables which are allocated and freed within functions.",
    "created_at": "2012-06-01T15:12:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130625",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:55" align="right">comment:55</div>

Ok, but then some fmpz won't be freed and that's all.
This won't lead to any segfault, memory error or horrible breaks.

In case someone actually used Sage in library mode, and played at launching and closing it several times, that would lead to memory leaks (surely among a lot of other ones), but nothing more.

And I do not see any problematic calls to fmpz_clear within Sage.
The few ones (its definition within fmpz.pxi, 4 calls in polynomial_integer_dense_flint.pyx and one call in quaternion_algebra_element.pyx) are typically made on local variables which are allocated and freed within functions.



---

archive/issue_comments_130626.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nIt (calling some flint clear function after _fmpz_cleanup) can segfault -- fmpz_clear ends up writing to fmpz_unused_arr, and that array might have been freed.\n\nAny explicit \"local\" calls in Sage should be fine -- presumably those will only be triggered by explicit computation. What could go wrong is that Sage say caches some polynomial in some coercion or IO code somewhere, and due to some cyclic reference the cache doesn't gets deallocated until the Python interpreter shuts down (i.e. after having already gone through sage_exit).",
    "created_at": "2012-06-01T15:20:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130626",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:56" align="right">comment:56</div>

It (calling some flint clear function after _fmpz_cleanup) can segfault -- fmpz_clear ends up writing to fmpz_unused_arr, and that array might have been freed.

Any explicit "local" calls in Sage should be fine -- presumably those will only be triggered by explicit computation. What could go wrong is that Sage say caches some polynomial in some coercion or IO code somewhere, and due to some cyclic reference the cache doesn't gets deallocated until the Python interpreter shuts down (i.e. after having already gone through sage_exit).



---

archive/issue_comments_130627.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@fredrik-johansson](#comment%3A56):\n> It (calling some flint clear function after _fmpz_cleanup) can segfault -- fmpz_clear ends up writing to fmpz_unused_arr, and that array might have been freed.\n\nI agree with that.\nI would have just expected it to happen less often, especially that it doesn't segfault but return errors typical of a double free (from glibc, which seems to me even more unfortunate than getting a nice segfault).\nI indeed get an error every time I doctest ell_padic_field.py",
    "created_at": "2012-06-01T15:26:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130627",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@fredrik-johansson](#comment%3A56):
> It (calling some flint clear function after _fmpz_cleanup) can segfault -- fmpz_clear ends up writing to fmpz_unused_arr, and that array might have been freed.

I agree with that.
I would have just expected it to happen less often, especially that it doesn't segfault but return errors typical of a double free (from glibc, which seems to me even more unfortunate than getting a nice segfault).
I indeed get an error every time I doctest ell_padic_field.py



---

archive/issue_comments_130628.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nAnyway, after some more testing I'm rather convinced the call to fmpz_poly_clear is the problem.",
    "created_at": "2012-06-01T16:54:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130628",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:58" align="right">comment:58</div>

Anyway, after some more testing I'm rather convinced the call to fmpz_poly_clear is the problem.



---

archive/issue_comments_130629.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nAlthough there are several calls to fmpz_poly_clear in the quatalg stuff which does not seem to cause similar problem.\n\nAs a solution, let's just put the call to _fmpz_cleanup at the end of the quit_sage function and let the buildbot decide if it's really acceptable.\n\nI'll go on with the other problems now.",
    "created_at": "2012-06-04T08:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130629",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:59" align="right">comment:59</div>

Although there are several calls to fmpz_poly_clear in the quatalg stuff which does not seem to cause similar problem.

As a solution, let's just put the call to _fmpz_cleanup at the end of the quit_sage function and let the buildbot decide if it's really acceptable.

I'll go on with the other problems now.



---

archive/issue_comments_130630.json:
```json
{
    "body": "Attachment: **[sqrt_normalization_fix.diff.gz](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.diff.gz)**\n\nFix normalization of sqrt for fraction field elements",
    "created_at": "2012-06-04T15:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130630",
    "user": "https://github.com/fredrik-johansson"
}
```

Attachment: **[sqrt_normalization_fix.diff.gz](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.diff.gz)**

Fix normalization of sqrt for fraction field elements



---

archive/issue_comments_130631.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nThe patch makes the tests in fraction_field_FpT and function_field_element pass. I have not checked whether there are tests elsewhere in Sage that disagree with the chosen convention.",
    "created_at": "2012-06-04T15:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130631",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:60" align="right">comment:60</div>

The patch makes the tests in fraction_field_FpT and function_field_element pass. I have not checked whether there are tests elsewhere in Sage that disagree with the chosen convention.



---

archive/issue_comments_130632.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nWith the most recent changes in my repository, and moving the fmpz_cleanup call to the end of the quit function, the following no longer crash/fail: sage_object.pyx, elliptic_curves/padics.py, hyperelliptic_curves/jacobian_morphism.py, flint.pyx, modform/element.py, ell_point.py\n\nThe following still fail with what only appears to be simple normalization problems: polynomial_zmod_flint.pyx, combinat/sf/jack.py\n\nOnly one failure remains that appears to be a genuine bug: graphs/matchpoly.pyx\n\nThis one seems a bit difficult to debug. Anyone familiar with the math?",
    "created_at": "2012-06-05T09:15:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130632",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:61" align="right">comment:61</div>

With the most recent changes in my repository, and moving the fmpz_cleanup call to the end of the quit function, the following no longer crash/fail: sage_object.pyx, elliptic_curves/padics.py, hyperelliptic_curves/jacobian_morphism.py, flint.pyx, modform/element.py, ell_point.py

The following still fail with what only appears to be simple normalization problems: polynomial_zmod_flint.pyx, combinat/sf/jack.py

Only one failure remains that appears to be a genuine bug: graphs/matchpoly.pyx

This one seems a bit difficult to debug. Anyone familiar with the math?



---

archive/issue_comments_130633.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nAs far as jack.py goes, I'm not sure exactly where the difference in normalization comes from, but the new output is nicer, so I suggest just changing those doctests.",
    "created_at": "2012-06-05T09:19:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130633",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:62" align="right">comment:62</div>

As far as jack.py goes, I'm not sure exactly where the difference in normalization comes from, but the new output is nicer, so I suggest just changing those doctests.



---

archive/issue_comments_130634.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nJean-Pierre, could you push your changes to the build scripts so we can merge them in the official repository? (It would be nice to get a new 2.3 beta version out ASAP and base a new spkg on that.)",
    "created_at": "2012-06-05T09:28:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130634",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:63" align="right">comment:63</div>

Jean-Pierre, could you push your changes to the build scripts so we can merge them in the official repository? (It would be nice to get a new 2.3 beta version out ASAP and base a new spkg on that.)



---

archive/issue_comments_130635.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nUnfortunately, there are still memory errors; they just show up inconsistently. The ones that sometimes crash for me include:\n\n```\nsage -t  devel/sage-main/sage/modular/abvar/torsion_subgroup.py # Killed/crashed\nsage -t  devel/sage-main/sage/modular/modform/ambient_g1.py # Killed/crashed\nsage -t  devel/sage-main/sage/tests/book_stein_modform.py # Time out\nsage -t  devel/sage-main/sage/modular/hecke/element.py # Killed/crashed\n```",
    "created_at": "2012-06-05T10:27:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130635",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:64" align="right">comment:64</div>

Unfortunately, there are still memory errors; they just show up inconsistently. The ones that sometimes crash for me include:

```
sage -t  devel/sage-main/sage/modular/abvar/torsion_subgroup.py # Killed/crashed
sage -t  devel/sage-main/sage/modular/modform/ambient_g1.py # Killed/crashed
sage -t  devel/sage-main/sage/tests/book_stein_modform.py # Time out
sage -t  devel/sage-main/sage/modular/hecke/element.py # Killed/crashed
```



---

archive/issue_comments_130636.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@fredrik-johansson](#comment%3A63):\n> Jean-Pierre, could you push your changes to the build scripts so we can merge them in the official repository? (It would be nice to get a new 2.3 beta version out ASAP and base a new spkg on that.)\n\nI've got a github account with the same login as here.\nFeel free to get what you want from there, merge it, modify it, or whatever you want.\nIf you need me to do any further processing, please let me know.",
    "created_at": "2012-06-05T10:46:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130636",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@fredrik-johansson](#comment%3A63):
> Jean-Pierre, could you push your changes to the build scripts so we can merge them in the official repository? (It would be nice to get a new 2.3 beta version out ASAP and base a new spkg on that.)

I've got a github account with the same login as here.
Feel free to get what you want from there, merge it, modify it, or whatever you want.
If you need me to do any further processing, please let me know.



---

archive/issue_comments_130637.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@fredrik-johansson](#comment%3A64):\n> Unfortunately, there are still memory errors; they just show up inconsistently. The ones that sometimes crash for me include:\n> \n> ```\n> sage -t  devel/sage-main/sage/modular/abvar/torsion_subgroup.py # Killed/crashed\n> sage -t  devel/sage-main/sage/modular/modform/ambient_g1.py # Killed/crashed\n> sage -t  devel/sage-main/sage/tests/book_stein_modform.py # Time out\n> sage -t  devel/sage-main/sage/modular/hecke/element.py # Killed/crashed\n> ```\n\nToo bad...",
    "created_at": "2012-06-05T10:47:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130637",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@fredrik-johansson](#comment%3A64):
> Unfortunately, there are still memory errors; they just show up inconsistently. The ones that sometimes crash for me include:
> 
> ```
> sage -t  devel/sage-main/sage/modular/abvar/torsion_subgroup.py # Killed/crashed
> sage -t  devel/sage-main/sage/modular/modform/ambient_g1.py # Killed/crashed
> sage -t  devel/sage-main/sage/tests/book_stein_modform.py # Time out
> sage -t  devel/sage-main/sage/modular/hecke/element.py # Killed/crashed
> ```

Too bad...



---

archive/issue_comments_130638.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@fredrik-johansson](#comment%3A61):\n> With the most recent changes in my repository, and moving the fmpz_cleanup call to the end of the quit function, the following no longer crash/fail: sage_object.pyx, elliptic_curves/padics.py, hyperelliptic_curves/jacobian_morphism.py, flint.pyx, modform/element.py, ell_point.py\n> \n> The following still fail with what only appears to be simple normalization problems: polynomial_zmod_flint.pyx, combinat/sf/jack.py\n> \n> Only one failure remains that appears to be a genuine bug: graphs/matchpoly.pyx\n> \n> This one seems a bit difficult to debug. Anyone familiar with the math?\n\nThat's strange, I did not get this failure earlier.\nI'll have a look this afternoon.",
    "created_at": "2012-06-05T10:48:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130638",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@fredrik-johansson](#comment%3A61):
> With the most recent changes in my repository, and moving the fmpz_cleanup call to the end of the quit function, the following no longer crash/fail: sage_object.pyx, elliptic_curves/padics.py, hyperelliptic_curves/jacobian_morphism.py, flint.pyx, modform/element.py, ell_point.py
> 
> The following still fail with what only appears to be simple normalization problems: polynomial_zmod_flint.pyx, combinat/sf/jack.py
> 
> Only one failure remains that appears to be a genuine bug: graphs/matchpoly.pyx
> 
> This one seems a bit difficult to debug. Anyone familiar with the math?

That's strange, I did not get this failure earlier.
I'll have a look this afternoon.



---

archive/issue_comments_130639.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nNo memory errors if I comment out free_flint_stack(), so hopefully there really isn't anything else going on. We just need to figure out how to fix this one...",
    "created_at": "2012-06-05T11:13:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130639",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:68" align="right">comment:68</div>

No memory errors if I comment out free_flint_stack(), so hopefully there really isn't anything else going on. We just need to figure out how to fix this one...



---

archive/issue_comments_130640.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@jpflori](#comment%3A67):\n> Replying to [@fredrik-johansson](#comment%3A61):\n> > Only one failure remains that appears to be a genuine bug: graphs/matchpoly.pyx\n> > \n> > This one seems a bit difficult to debug. Anyone familiar with the math?\n\n> That's strange, I did not get this failure earlier.\n> I'll have a look this afternoon.\n\nI've just tested graphs/matchpoly.pyx with the latest flint's commit (see what is on my github account), together with all patches to the Sage library posted here (and some minor additional stuff including moving flint_free_stack just before cleaning symmetrica), and cannot repoduce errors in that file.\n\nCould you post a log here?",
    "created_at": "2012-06-05T16:34:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130640",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@jpflori](#comment%3A67):
> Replying to [@fredrik-johansson](#comment%3A61):
> > Only one failure remains that appears to be a genuine bug: graphs/matchpoly.pyx
> > 
> > This one seems a bit difficult to debug. Anyone familiar with the math?

> That's strange, I did not get this failure earlier.
> I'll have a look this afternoon.

I've just tested graphs/matchpoly.pyx with the latest flint's commit (see what is on my github account), together with all patches to the Sage library posted here (and some minor additional stuff including moving flint_free_stack just before cleaning symmetrica), and cannot repoduce errors in that file.

Could you post a log here?



---

archive/issue_comments_130641.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\n\n```\nFile \"/scratch/fjohanss/sage-5.1.beta1/devel/sage-main/sage/graphs/matchpoly.pyx\", line 333:\n    sage: len(str(f))\nExpected:\n    406824\nGot:\n    6179056\n```\n\nThe new value definitely seems to be wrong: complete_poly(n) has coefficients with about n digits for n = 100, 200, ..., 900, but then complete_poly(1000) evaluates to have coefficients with 6000 digits. \n\nThis is on a 32-bit system, by the way.",
    "created_at": "2012-06-05T16:45:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130641",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:70" align="right">comment:70</div>


```
File "/scratch/fjohanss/sage-5.1.beta1/devel/sage-main/sage/graphs/matchpoly.pyx", line 333:
    sage: len(str(f))
Expected:
    406824
Got:
    6179056
```

The new value definitely seems to be wrong: complete_poly(n) has coefficients with about n digits for n = 100, 200, ..., 900, but then complete_poly(1000) evaluates to have coefficients with 6000 digits. 

This is on a 32-bit system, by the way.



---

archive/issue_comments_130642.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nI'm on a 64 bit system and cannot see the error... we should get confirmation form someone else (on both architectures), it's possible something got screwed on my system.\n\nBy the way, it seems to me that the FFT bug is still present on my system although I've merged the latest commits.\nCould you confirm or infirm that (testing sage/libs/flint/flint.pyx)?",
    "created_at": "2012-06-05T16:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130642",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:71" align="right">comment:71</div>

I'm on a 64 bit system and cannot see the error... we should get confirmation form someone else (on both architectures), it's possible something got screwed on my system.

By the way, it seems to me that the FFT bug is still present on my system although I've merged the latest commits.
Could you confirm or infirm that (testing sage/libs/flint/flint.pyx)?



---

archive/issue_comments_130643.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nThe FFT bug is fixed for me (same system; the standalone .c program also works on a 64-bit system, but I have not tried Sage there).",
    "created_at": "2012-06-05T16:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130643",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:72" align="right">comment:72</div>

The FFT bug is fixed for me (same system; the standalone .c program also works on a 64-bit system, but I have not tried Sage there).



---

archive/issue_comments_130644.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nOk, so something went wrong on my side.\n\nI'll double check everything tomorrow.",
    "created_at": "2012-06-05T21:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130644",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:73" align="right">comment:73</div>

Ok, so something went wrong on my side.

I'll double check everything tomorrow.



---

archive/issue_comments_130645.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nI indeed ended up with a different version of my directory on the machine where I test Sage....",
    "created_at": "2012-06-06T06:52:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130645",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:74" align="right">comment:74</div>

I indeed ended up with a different version of my directory on the machine where I test Sage....



---

archive/issue_comments_130646.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nOk, everything should be fine now.\nI don't have errors anymore in flint.pyx,.\nNonetheless I cannot reproduce the problem in matchpoly.pyx, so this may indeed be related to a 32/64 bits difference?",
    "created_at": "2012-06-06T07:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130646",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:75" align="right">comment:75</div>

Ok, everything should be fine now.
I don't have errors anymore in flint.pyx,.
Nonetheless I cannot reproduce the problem in matchpoly.pyx, so this may indeed be related to a 32/64 bits difference?



---

archive/issue_comments_130647.json:
```json
{
    "body": "Attachment: **[headers.patch.gz](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz)**\n\nReplace FLINT by flint for headers inclusion.",
    "created_at": "2012-06-06T08:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130647",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[headers.patch.gz](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz)**

Replace FLINT by flint for headers inclusion.



---

archive/issue_comments_130648.json:
```json
{
    "body": "Attachment: **[multrunc.patch.gz](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz)**\n\nModify doctest for _mul_trunc_opposite",
    "created_at": "2012-06-06T08:05:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130648",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[multrunc.patch.gz](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz)**

Modify doctest for _mul_trunc_opposite



---

archive/issue_comments_130649.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nOn my amd64 Ubuntu 12.04 (processor must be some kind of Xeon), with sage 5.1.beta1 + the new zn_poly spkg at #12433 + custom flint 2.3 spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg + the following patches:\n- flint-2.3-sage-5.1.beta1.patch\n- flint-2.3-jp.patch (this one should be cleaned, split, etc.)\n- sqrt_normalization_fix.diff\n- headers.patch\n- multrunc.patch\nmake ptest only spat 3 errors:\n- the ordering problem in jack.py\n- memory error in ell_curve_is_isogeny.py\n- memory error in ell_tate_curve",
    "created_at": "2012-06-06T08:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130649",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:76" align="right">comment:76</div>

On my amd64 Ubuntu 12.04 (processor must be some kind of Xeon), with sage 5.1.beta1 + the new zn_poly spkg at #12433 + custom flint 2.3 spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg + the following patches:
- flint-2.3-sage-5.1.beta1.patch
- flint-2.3-jp.patch (this one should be cleaned, split, etc.)
- sqrt_normalization_fix.diff
- headers.patch
- multrunc.patch
make ptest only spat 3 errors:
- the ordering problem in jack.py
- memory error in ell_curve_is_isogeny.py
- memory error in ell_tate_curve



---

archive/issue_comments_130650.json:
```json
{
    "body": "Some further changes. For testing only.",
    "created_at": "2012-06-06T08:14:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130650",
    "user": "https://github.com/jpflori"
}
```

Some further changes. For testing only.



---

archive/issue_comments_130651.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nAttachment: **[flint-2.3-jp.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-jp.patch.gz)**\n\nI pushed an experimental alternative to _fmpz_cleanup that does not free the main arrays. Could you check if using this avoids memory problems?",
    "created_at": "2012-06-06T09:41:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130651",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:77" align="right">comment:77</div>

Attachment: **[flint-2.3-jp.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-jp.patch.gz)**

I pushed an experimental alternative to _fmpz_cleanup that does not free the main arrays. Could you check if using this avoids memory problems?



---

archive/issue_comments_130652.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nI'll test this once the doc of Sage 5.1.beta2 finally finishes to build.",
    "created_at": "2012-06-06T09:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130652",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:78" align="right">comment:78</div>

I'll test this once the doc of Sage 5.1.beta2 finally finishes to build.



---

archive/issue_comments_130653.json:
```json
{
    "body": "<div id=\"comment:79\" align=\"right\">comment:79</div>\n\nA quick test of the file ell_tate_curve which produced an error each time I ran it with the latest version of everything, seems to indicate that not freeing the array is enough.\n\nI've just launched a make ptest to be sure that the problem was not just moved somewhere else once more.",
    "created_at": "2012-06-06T10:22:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130653",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:79" align="right">comment:79</div>

A quick test of the file ell_tate_curve which produced an error each time I ran it with the latest version of everything, seems to indicate that not freeing the array is enough.

I've just launched a make ptest to be sure that the problem was not just moved somewhere else once more.



---

archive/issue_comments_130654.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nNo errors except for jack.py after a first make ptest.",
    "created_at": "2012-06-06T11:32:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130654",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:80" align="right">comment:80</div>

No errors except for jack.py after a first make ptest.



---

archive/issue_comments_130655.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nVery good news. I guess we should try running long tests as well?",
    "created_at": "2012-06-06T12:29:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130655",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:81" align="right">comment:81</div>

Very good news. I guess we should try running long tests as well?



---

archive/issue_comments_130656.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nSame results after a second make ptest on sage-5.1.beta1 and another one on sage-5.1.beta2: only errors in jack.py (no memory errors and no error in matchpoly)\n\nYes, we should try running the long tests at least once, but then that will be the patchbot job I think",
    "created_at": "2012-06-06T12:42:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130656",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:82" align="right">comment:82</div>

Same results after a second make ptest on sage-5.1.beta1 and another one on sage-5.1.beta2: only errors in jack.py (no memory errors and no error in matchpoly)

Yes, we should try running the long tests at least once, but then that will be the patchbot job I think



---

archive/issue_comments_130657.json:
```json
{
    "body": "Fredrik's patch; rebase on 5.1.beta2.",
    "created_at": "2012-06-06T12:43:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130657",
    "user": "https://github.com/jpflori"
}
```

Fredrik's patch; rebase on 5.1.beta2.



---

archive/issue_comments_130658.json:
```json
{
    "body": "Attachment: **[flint-2.3-sage-5.1.beta2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz)**\n\nReplace _fmpz_cleanup by fmpz_cleanup_mpz_content",
    "created_at": "2012-06-06T12:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130658",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-sage-5.1.beta2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz)**

Replace _fmpz_cleanup by fmpz_cleanup_mpz_content



---

archive/issue_comments_130659.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nAttachment: **[fmpz_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz)**\n\nBy the way, the only problem I get in jack.py is that some fractions which used to be \"minus sthg over minus sthg\" are now \"plus sthg over plus sthg\".",
    "created_at": "2012-06-06T12:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130659",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:83" align="right">comment:83</div>

Attachment: **[fmpz_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz)**

By the way, the only problem I get in jack.py is that some fractions which used to be "minus sthg over minus sthg" are now "plus sthg over plus sthg".



---

archive/issue_comments_130660.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@jpflori](#comment%3A83):\n> By the way, the only problem I get in jack.py is that some fractions which used to be \"minus sthg over minus sthg\" are now \"plus sthg over plus sthg\".\n\nYes, same here. The new output is clearly nicer, so we should just update the doctests.",
    "created_at": "2012-06-06T12:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130660",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@jpflori](#comment%3A83):
> By the way, the only problem I get in jack.py is that some fractions which used to be "minus sthg over minus sthg" are now "plus sthg over plus sthg".

Yes, same here. The new output is clearly nicer, so we should just update the doctests.



---

archive/issue_comments_130661.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nHere come some more proper patches.\n\nAfter running make ptestlong on 5.1.beta2 I got failures:\n- in jack.py as before\n- in sage/misc/cython.py because I renamed the FLINT directory into flint and fmpq.h is not found anymore, this also use the old fmpq_poly.c file which is now included in FLINT itself I guess. So the test has to be changed somehow.\n- in polynomial_rational_flint.pyx: time out...",
    "created_at": "2012-06-06T13:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130661",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:85" align="right">comment:85</div>

Here come some more proper patches.

After running make ptestlong on 5.1.beta2 I got failures:
- in jack.py as before
- in sage/misc/cython.py because I renamed the FLINT directory into flint and fmpq.h is not found anymore, this also use the old fmpq_poly.c file which is now included in FLINT itself I guess. So the test has to be changed somehow.
- in polynomial_rational_flint.pyx: time out...



---

archive/issue_comments_130662.json:
```json
{
    "body": "Attachment: **[degree.patch.gz](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz)**\n\nSet length to its correct value in a realloc",
    "created_at": "2012-06-06T13:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130662",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[degree.patch.gz](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz)**

Set length to its correct value in a realloc



---

archive/issue_comments_130663.json:
```json
{
    "body": "Attachment: **[doctests.patch.gz](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz)**\n\nFix formatting of different doctests; not really related to the ticket.",
    "created_at": "2012-06-06T13:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130663",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[doctests.patch.gz](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz)**

Fix formatting of different doctests; not really related to the ticket.



---

archive/issue_comments_130664.json:
```json
{
    "body": "Attachment: **[jack.patch.gz](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz)**\n\nChange doctests in jack.py",
    "created_at": "2012-06-06T13:59:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130664",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[jack.patch.gz](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz)**

Change doctests in jack.py



---

archive/issue_comments_130665.json:
```json
{
    "body": "Update n_factor structure and initialize it before use",
    "created_at": "2012-06-06T14:00:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130665",
    "user": "https://github.com/jpflori"
}
```

Update n_factor structure and initialize it before use



---

archive/issue_comments_130666.json:
```json
{
    "body": "Attachment: **[n_factor.patch.gz](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz)**\n\nFredrik's patch for sqrt normalization",
    "created_at": "2012-06-06T14:00:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130666",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[n_factor.patch.gz](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz)**

Fredrik's patch for sqrt normalization



---

archive/issue_comments_130667.json:
```json
{
    "body": "Attachment: **[sqrt_normalization_fix.patch.gz](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz)**\n\nReplace flint_stack_cleanup by _fmpz_cleanup",
    "created_at": "2012-06-06T14:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130667",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[sqrt_normalization_fix.patch.gz](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz)**

Replace flint_stack_cleanup by _fmpz_cleanup



---

archive/issue_comments_130668.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,20 @@\n+To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:\n+* the updated zn_poly spkg from #12433,\n+* the (functional but definitely not definitive) FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg;\n+apply:\n+* [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),\n+* [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),\n+* [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),\n+* [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),\n+* [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),\n+* [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),\n+* [attachment: headers.patch](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz),\n+* [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n+* [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n+* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz).\n \n+There remain some issues:\n+- a long test fails in sage/misc/cython.py because it uses a Sage specific file (fmpq_poly) which was integrated into FLINT 2,\n+- a long test timeouts in sage/rings/polynomial/polynomial_rational_flint.pyx,\n+- errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).\n+\n``````\n",
    "created_at": "2012-06-06T14:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130668",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,20 @@
+To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:
+* the updated zn_poly spkg from #12433,
+* the (functional but definitely not definitive) FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg;
+apply:
+* [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),
+* [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),
+* [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),
+* [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),
+* [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),
+* [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),
+* [attachment: headers.patch](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz),
+* [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
+* [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
+* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz).
 
+There remain some issues:
+- a long test fails in sage/misc/cython.py because it uses a Sage specific file (fmpq_poly) which was integrated into FLINT 2,
+- a long test timeouts in sage/rings/polynomial/polynomial_rational_flint.pyx,
+- errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).
+
``````




---

archive/issue_comments_130669.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nAttachment: **[flint_stack_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz)**",
    "created_at": "2012-06-06T14:12:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130669",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:86" align="right">comment:86</div>

Attachment: **[flint_stack_cleanup.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz)**



---

archive/issue_comments_130670.json:
```json
{
    "body": "Attachment: **[cython.patch.gz](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz)**\n\nFix for #11680 doctest in cython.py",
    "created_at": "2012-06-06T14:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130670",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[cython.patch.gz](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz)**

Fix for #11680 doctest in cython.py



---

archive/issue_comments_130671.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nThe cython stuff should be fixed now.",
    "created_at": "2012-06-06T14:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130671",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:87" align="right">comment:87</div>

The cython stuff should be fixed now.



---

archive/issue_comments_130672.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,10 +11,10 @@\n * [attachment: headers.patch](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz),\n * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n-* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz).\n+* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n+* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz).\n \n There remain some issues:\n-- a long test fails in sage/misc/cython.py because it uses a Sage specific file (fmpq_poly) which was integrated into FLINT 2,\n - a long test timeouts in sage/rings/polynomial/polynomial_rational_flint.pyx,\n - errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).\n \n``````\n",
    "created_at": "2012-06-06T14:31:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130672",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,10 +11,10 @@
 * [attachment: headers.patch](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz),
 * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
 * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
-* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz).
+* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
+* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz).
 
 There remain some issues:
-- a long test fails in sage/misc/cython.py because it uses a Sage specific file (fmpq_poly) which was integrated into FLINT 2,
 - a long test timeouts in sage/rings/polynomial/polynomial_rational_flint.pyx,
 - errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).
 
``````




---

archive/issue_comments_130673.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nThe polynomial_rational_flint timeout problem seem to be that calling \"__getitem__\" on a slice is indeed horribly slow.\nPlaying with the (only) long test of the file, Sage returns f[1:3] instantly but needs 2.6 seconds to return g[1:2] !!! And I've removed the test for signal activation.",
    "created_at": "2012-06-06T15:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130673",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:88" align="right">comment:88</div>

The polynomial_rational_flint timeout problem seem to be that calling "__getitem__" on a slice is indeed horribly slow.
Playing with the (only) long test of the file, Sage returns f[1:3] instantly but needs 2.6 seconds to return g[1:2] !!! And I've removed the test for signal activation.



---

archive/issue_comments_130674.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nUsing the same code as in polynomial_integer_dense_flint yields similar performance.\n\nMaybe there's a problem in fmpq_poly_get_slice, although the code seems ok at first sight.",
    "created_at": "2012-06-06T15:13:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130674",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:89" align="right">comment:89</div>

Using the same code as in polynomial_integer_dense_flint yields similar performance.

Maybe there's a problem in fmpq_poly_get_slice, although the code seems ok at first sight.



---

archive/issue_comments_130675.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nOr the call to \"len(list(self))\" to get the degree of the polynomial plus one is just too bizarre.",
    "created_at": "2012-06-06T15:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130675",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:90" align="right">comment:90</div>

Or the call to "len(list(self))" to get the degree of the polynomial plus one is just too bizarre.



---

archive/issue_comments_130676.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\nThat was this bizarre construction indeed.\nHere comes a fix.",
    "created_at": "2012-06-06T15:22:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130676",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:91" align="right">comment:91</div>

That was this bizarre construction indeed.
Here comes a fix.



---

archive/issue_comments_130677.json:
```json
{
    "body": "Make `__getitem__` for slices faster",
    "created_at": "2012-06-06T15:25:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130677",
    "user": "https://github.com/jpflori"
}
```

Make `__getitem__` for slices faster



---

archive/issue_comments_130678.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,9 +12,9 @@\n * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n-* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz).\n+* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n+* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz).\n \n-There remain some issues:\n-- a long test timeouts in sage/rings/polynomial/polynomial_rational_flint.pyx,\n+There remain one known issue:\n - errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).\n \n``````\n",
    "created_at": "2012-06-06T15:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130678",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,9 +12,9 @@
 * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
 * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
 * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
-* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz).
+* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
+* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz).
 
-There remain some issues:
-- a long test timeouts in sage/rings/polynomial/polynomial_rational_flint.pyx,
+There remain one known issue:
 - errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).
 
``````




---

archive/issue_comments_130679.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nAttachment: **[slice.patch.gz](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz)**",
    "created_at": "2012-06-06T15:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130679",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:92" align="right">comment:92</div>

Attachment: **[slice.patch.gz](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz)**



---

archive/issue_comments_130680.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nI've built Sage 5.1.beta2 within a 32 bits virtual machine running Ubuntu 12.04 and could reproduce the matchpoly error.",
    "created_at": "2012-06-07T12:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130680",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:93" align="right">comment:93</div>

I've built Sage 5.1.beta2 within a 32 bits virtual machine running Ubuntu 12.04 and could reproduce the matchpoly error.



---

archive/issue_comments_130681.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nRunning make ptestlong within the 32 bits virtual machine only raised this error as well (and another one in polynomial_real_mpfr_dense which could not be reproduced when ran alone).",
    "created_at": "2012-06-07T14:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130681",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:94" align="right">comment:94</div>

Running make ptestlong within the 32 bits virtual machine only raised this error as well (and another one in polynomial_real_mpfr_dense which could not be reproduced when ran alone).



---

archive/issue_comments_130682.json:
```json
{
    "body": "Attachment: **[ref_flint1.patch.gz](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz)**\n\nRemove a reference to FLINT 1.",
    "created_at": "2012-06-08T16:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130682",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[ref_flint1.patch.gz](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz)**

Remove a reference to FLINT 1.



---

archive/issue_comments_130683.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nI've updated the spkg available at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg with new git commits.\nMoreover it contains better cleaned up spkg-install and spkg-check scripts, together with an updated SPKG.txt (for the moment nothing is committed).\n\nI'm not sure about some stuff for that spkg :\n- There is some stuff related to Cygwin, I've tried to let it act as before, but have no idea why this was needed, nor if it's still needed.\n- There is some stuff related to 64 bits build when SAGE64 is set, not sure about the status of this (in fact I don't really know on what systems this is needed for any spkg, not usual Linux install for sure). With FLINT current configure system, behaving as before overwrites the default CFLAGS FLINT would have chosen (ok, the only relevant part is -O2 -g which is also set together with -m64 when SAGE64 is set, but I'm not really happy with such a solution, could FLINT use some kind of ABI variable?).\n- We could or should treat the SAGE_DEBUG flag correctly. As far as CFLAGS are concerned, we can set them ourselves but there is no way to prevent FLINT from using the FLINT_TUNE magic.\n- I've put Fredrik and I as maintainers for the moment, any more reasonable proposition is welcomed.",
    "created_at": "2012-06-08T16:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130683",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:95" align="right">comment:95</div>

I've updated the spkg available at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg with new git commits.
Moreover it contains better cleaned up spkg-install and spkg-check scripts, together with an updated SPKG.txt (for the moment nothing is committed).

I'm not sure about some stuff for that spkg :
- There is some stuff related to Cygwin, I've tried to let it act as before, but have no idea why this was needed, nor if it's still needed.
- There is some stuff related to 64 bits build when SAGE64 is set, not sure about the status of this (in fact I don't really know on what systems this is needed for any spkg, not usual Linux install for sure). With FLINT current configure system, behaving as before overwrites the default CFLAGS FLINT would have chosen (ok, the only relevant part is -O2 -g which is also set together with -m64 when SAGE64 is set, but I'm not really happy with such a solution, could FLINT use some kind of ABI variable?).
- We could or should treat the SAGE_DEBUG flag correctly. As far as CFLAGS are concerned, we can set them ourselves but there is no way to prevent FLINT from using the FLINT_TUNE magic.
- I've put Fredrik and I as maintainers for the moment, any more reasonable proposition is welcomed.



---

archive/issue_comments_130684.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,7 +13,8 @@\n * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n-* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz).\n+* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n+* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).\n \n There remain one known issue:\n - errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).\n``````\n",
    "created_at": "2012-06-08T16:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130684",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,7 +13,8 @@
 * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
 * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
 * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
-* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz).
+* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
+* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).
 
 There remain one known issue:
 - errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).
``````




---

archive/issue_comments_130685.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nThe spkg-check is in fact broken because of undefined symbols related to NTL in libflint.so.\nThis also occurs on my personal install of FLINT when built with the NTL interface.",
    "created_at": "2012-06-08T17:02:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130685",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:97" align="right">comment:97</div>

The spkg-check is in fact broken because of undefined symbols related to NTL in libflint.so.
This also occurs on my personal install of FLINT when built with the NTL interface.



---

archive/issue_comments_130686.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nMy bad, I forgot to add -lntl when building FLINT with the NTL interface.\nThis is now fixed on my github account and in the spkg.",
    "created_at": "2012-06-08T17:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130686",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:98" align="right">comment:98</div>

My bad, I forgot to add -lntl when building FLINT with the NTL interface.
This is now fixed on my github account and in the spkg.



---

archive/issue_comments_130687.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nI've uploaded a new spkg (same address) based on Fredrik's latest git commit (c644b926cd6f...) plus an additional modification to Makefile.in so that the NTL interface is correctly build (not committed, let's wait for Bill to properly fix it, if that's actually needed).\n\nWith this latest spkg, Sage 5.1.beta3 builds correctly and passes \"make ptestlong\" on my amd64 Ubuntu 12.04.\n\nWithin the 32 bits virtual machine, Sage 5.1.beta2 passes \"./sage -t sage/graphs/matchpoly.pyx\" (although the mul_SS bug is still present, now another algorithm is used I presume).\n\nSo I guess we just have to wait for a proper release of FLINT, potentially modify the way it is configure by spkg-install, and properly review every patch to the Sage library and changes to the spkg.",
    "created_at": "2012-06-11T11:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130687",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:99" align="right">comment:99</div>

I've uploaded a new spkg (same address) based on Fredrik's latest git commit (c644b926cd6f...) plus an additional modification to Makefile.in so that the NTL interface is correctly build (not committed, let's wait for Bill to properly fix it, if that's actually needed).

With this latest spkg, Sage 5.1.beta3 builds correctly and passes "make ptestlong" on my amd64 Ubuntu 12.04.

Within the 32 bits virtual machine, Sage 5.1.beta2 passes "./sage -t sage/graphs/matchpoly.pyx" (although the mul_SS bug is still present, now another algorithm is used I presume).

So I guess we just have to wait for a proper release of FLINT, potentially modify the way it is configure by spkg-install, and properly review every patch to the Sage library and changes to the spkg.



---

archive/issue_comments_130688.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,6 +16,3 @@\n * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).\n \n-There remain one known issue:\n-- errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).\n-\n``````\n",
    "created_at": "2012-06-11T11:15:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130688",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,6 +16,3 @@
 * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
 * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).
 
-There remain one known issue:
-- errors in sage/graphs/matchpoly.pyx caused by a bug in FLINT (only on 32 bits systems?).
-
``````




---

archive/issue_comments_130689.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:\n * the updated zn_poly spkg from #12433,\n-* the (functional but definitely not definitive) FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg;\n+* the FLINT spkg at http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg;\n apply:\n * [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),\n * [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),\n``````\n",
    "created_at": "2012-07-03T09:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130689",
    "user": "https://github.com/fredrik-johansson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:
 * the updated zn_poly spkg from #12433,
-* the (functional but definitely not definitive) FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.jp.spkg;
+* the FLINT spkg at http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg;
 apply:
 * [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),
 * [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),
``````




---

archive/issue_comments_130690.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nUpdated http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg to the release version.\n\nPossibly this now just needs changing the milestone to 5.2, rebasing any patches that have broken, and getting it reviewed?",
    "created_at": "2012-07-03T09:19:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130690",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:100" align="right">comment:100</div>

Updated http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg to the release version.

Possibly this now just needs changing the milestone to 5.2, rebasing any patches that have broken, and getting it reviewed?



---

archive/issue_comments_130691.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nI'm currently tweaking the spkg-install to take into account the build system changes in FLINT, should not be too long.\n\nI've also build 5.1.rc0 to rebase the patches on it.",
    "created_at": "2012-07-03T11:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130691",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:101" align="right">comment:101</div>

I'm currently tweaking the spkg-install to take into account the build system changes in FLINT, should not be too long.

I've also build 5.1.rc0 to rebase the patches on it.



---

archive/issue_comments_130692.json:
```json
{
    "body": "Attachment: **[headers-5.1.rc0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/headers-5.1.rc0.patch.gz)**\n\nUpdated patch for 5.1.rc0.",
    "created_at": "2012-07-03T14:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130692",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[headers-5.1.rc0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/headers-5.1.rc0.patch.gz)**

Updated patch for 5.1.rc0.



---

archive/issue_comments_130693.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,20 @@\n To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:\n+\n * the updated zn_poly spkg from #12433,\n * the FLINT spkg at http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg;\n+\n apply:\n+\n * [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),\n * [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),\n * [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),\n * [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),\n * [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),\n * [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),\n-* [attachment: headers.patch](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz),\n+* [attachment: headers-5.1.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/headers-5.1.rc0.patch.gz),\n * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).\n-\n``````\n",
    "created_at": "2012-07-03T14:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130693",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,20 @@
 To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:
+
 * the updated zn_poly spkg from #12433,
 * the FLINT spkg at http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg;
+
 apply:
+
 * [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),
 * [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),
 * [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),
 * [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),
 * [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),
 * [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),
-* [attachment: headers.patch](https://github.com/sagemath/sage/files/ticket12173/headers.patch.gz),
+* [attachment: headers-5.1.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/headers-5.1.rc0.patch.gz),
 * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
 * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
 * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
 * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
 * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
 * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).
-
``````




---

archive/issue_comments_130694.json:
```json
{
    "body": "<div id=\"comment:103\" align=\"right\">comment:103</div>\n\nThere is some work to be done to rebase on #10617.\nI'm working on this.\n\nAs far as the spkg is concerned, I think there is only the Cygwin question to deal with.\nIt seems to me that FLINT can not be build as a shared library on Cygwin (at least Bill disabled this possibility).\nI'm not sure this is required by Sage, but would guess so.\nSo potentially we should disable the Cygwin hacks altogether and only build a static library (which would link to the static NTL library).",
    "created_at": "2012-07-03T14:26:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130694",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:103" align="right">comment:103</div>

There is some work to be done to rebase on #10617.
I'm working on this.

As far as the spkg is concerned, I think there is only the Cygwin question to deal with.
It seems to me that FLINT can not be build as a shared library on Cygwin (at least Bill disabled this possibility).
I'm not sure this is required by Sage, but would guess so.
So potentially we should disable the Cygwin hacks altogether and only build a static library (which would link to the static NTL library).



---

archive/issue_comments_130695.json:
```json
{
    "body": "Attachment: **[17060.patch.gz](https://github.com/sagemath/sage/files/ticket12173/17060.patch.gz)**\n\nTake #10617 into account",
    "created_at": "2012-07-03T16:28:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130695",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[17060.patch.gz](https://github.com/sagemath/sage/files/ticket12173/17060.patch.gz)**

Take #10617 into account



---

archive/issue_comments_130696.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,4 +17,5 @@\n * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n-* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).\n+* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),\n+* [attachment: 17060.patch](https://github.com/sagemath/sage/files/ticket12173/17060.patch.gz).\n``````\n",
    "created_at": "2012-07-03T16:28:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130696",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,4 +17,5 @@
 * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
 * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
 * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
-* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz).
+* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),
+* [attachment: 17060.patch](https://github.com/sagemath/sage/files/ticket12173/17060.patch.gz).
``````




---

archive/issue_comments_130697.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nBy the way \"make ptest\" gives no error on my computer.",
    "created_at": "2012-07-03T16:29:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130697",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:105" align="right">comment:105</div>

By the way "make ptest" gives no error on my computer.



---

archive/issue_comments_130698.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nIs 17060.patch the right file? It just seems to be the flint1-based patch from #10617, which won't work.",
    "created_at": "2012-07-04T09:40:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130698",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:106" align="right">comment:106</div>

Is 17060.patch the right file? It just seems to be the flint1-based patch from #10617, which won't work.



---

archive/issue_comments_130699.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">comment:107</div>\n\nIndeed, wrong file.\nI just hope that I did not lose the patch on top of that one...",
    "created_at": "2012-07-04T11:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130699",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:107" align="right">comment:107</div>

Indeed, wrong file.
I just hope that I did not lose the patch on top of that one...



---

archive/issue_comments_130700.json:
```json
{
    "body": "Take #10617 into account",
    "created_at": "2012-07-04T11:29:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130700",
    "user": "https://github.com/jpflori"
}
```

Take #10617 into account



---

archive/issue_comments_130701.json:
```json
{
    "body": "<div id=\"comment:108\" align=\"right\">comment:108</div>\n\nAttachment: **[compose_eval.patch.gz](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz)**\n\nOk, this should be the right one.",
    "created_at": "2012-07-04T11:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130701",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:108" align="right">comment:108</div>

Attachment: **[compose_eval.patch.gz](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz)**

Ok, this should be the right one.



---

archive/issue_comments_130702.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,4 +18,4 @@\n * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),\n-* [attachment: 17060.patch](https://github.com/sagemath/sage/files/ticket12173/17060.patch.gz).\n+* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz).\n``````\n",
    "created_at": "2012-07-04T11:30:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130702",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,4 +18,4 @@
 * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
 * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
 * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),
-* [attachment: 17060.patch](https://github.com/sagemath/sage/files/ticket12173/17060.patch.gz).
+* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz).
``````




---

archive/issue_comments_130703.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nI can verify that the patches apply and build cleanly on 5.1-rc0, and the test suite passes (have not tried long tests).\n\nIs this ready for review? I guess updating the build scripts to use static libraries on Cygwin is necessary first?",
    "created_at": "2012-07-04T13:06:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130703",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:109" align="right">comment:109</div>

I can verify that the patches apply and build cleanly on 5.1-rc0, and the test suite passes (have not tried long tests).

Is this ready for review? I guess updating the build scripts to use static libraries on Cygwin is necessary first?



---

archive/issue_comments_130704.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nI've completely failed to croospost on both flint-devel and sage-devel yesterday, and have just posted on sage-devel to get some info about the shared/static and cygwin stuff.\n\nI'm also installing Cygwin right now to get a hint of what happens there.\n\nOnce I've gathered more info, I'll update the Cygwin part of spkg-install and I guess the spkg will be ready for review.\n\nOn the other hand, I guess that all the patches to the Sage library deserve proper review now.\nIf you feel ok with mine, please post about it here.\nI'll have a(nother) look at what Mike, Sebastian and you did to be sure we've not let anything go through.\n\nWhat might be nice to check is that all functions defined in the pxi files still correspond to actual functions (for example the compose stuff now has an _fmpz trailing), because Im not sure that defining something in these files that does not actually exist in the library would lead to a build failure (if it does, then there's no problem cos everything builds fine here :))",
    "created_at": "2012-07-04T13:39:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130704",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:110" align="right">comment:110</div>

I've completely failed to croospost on both flint-devel and sage-devel yesterday, and have just posted on sage-devel to get some info about the shared/static and cygwin stuff.

I'm also installing Cygwin right now to get a hint of what happens there.

Once I've gathered more info, I'll update the Cygwin part of spkg-install and I guess the spkg will be ready for review.

On the other hand, I guess that all the patches to the Sage library deserve proper review now.
If you feel ok with mine, please post about it here.
I'll have a(nother) look at what Mike, Sebastian and you did to be sure we've not let anything go through.

What might be nice to check is that all functions defined in the pxi files still correspond to actual functions (for example the compose stuff now has an _fmpz trailing), because Im not sure that defining something in these files that does not actually exist in the library would lead to a build failure (if it does, then there's no problem cos everything builds fine here :))



---

archive/issue_comments_130705.json:
```json
{
    "body": "<div id=\"comment:111\" align=\"right\">comment:111</div>\n\nWe should do something about this horrible horror:\n\n```\nsage: a = ZZ['x'](range(100000)); R = Integers(3)['x']                \nsage: %time R(a);\nCPU times: user 51.96 s, sys: 0.00 s, total: 51.96 s\n```\n\nIt was this slow before as well, but there's no reason not to fix it.",
    "created_at": "2012-07-05T11:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130705",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:111" align="right">comment:111</div>

We should do something about this horrible horror:

```
sage: a = ZZ['x'](range(100000)); R = Integers(3)['x']                
sage: %time R(a);
CPU times: user 51.96 s, sys: 0.00 s, total: 51.96 s
```

It was this slow before as well, but there's no reason not to fix it.



---

archive/issue_comments_130706.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nHmm, I seem to be unable to fix this in the obvious way. If I add\n\n```\nfrom sage.rings.polynomial.polynomial_integer_dense_flint cimport Polynomial_integer_dense_flint\n```\n\nto polynomial_zmod_flint.pyx in order to be able to access the value as an fmpz_poly_t, I get\n\n```\nIn file included from /scratch/fjohanss/sage-5.1.rc0/local/include/NTL/ZZ.h:19:0,\n                 from /scratch/fjohanss/sage-5.1.rc0/local/include/flint/NTL-interface.h:36,\n                 from sage/rings/polynomial/polynomial_zmod_flint.c:250:\n/scratch/fjohanss/sage-5.1.rc0/local/include/NTL/tools.h:11:19: fatal error: cstdlib: No such file or directory\n```\n\nAny idea how to fix this?",
    "created_at": "2012-07-06T09:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130706",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:112" align="right">comment:112</div>

Hmm, I seem to be unable to fix this in the obvious way. If I add

```
from sage.rings.polynomial.polynomial_integer_dense_flint cimport Polynomial_integer_dense_flint
```

to polynomial_zmod_flint.pyx in order to be able to access the value as an fmpz_poly_t, I get

```
In file included from /scratch/fjohanss/sage-5.1.rc0/local/include/NTL/ZZ.h:19:0,
                 from /scratch/fjohanss/sage-5.1.rc0/local/include/flint/NTL-interface.h:36,
                 from sage/rings/polynomial/polynomial_zmod_flint.c:250:
/scratch/fjohanss/sage-5.1.rc0/local/include/NTL/tools.h:11:19: fatal error: cstdlib: No such file or directory
```

Any idea how to fix this?



---

archive/issue_comments_130707.json:
```json
{
    "body": "<div id=\"comment:113\" align=\"right\">comment:113</div>\n\nIs this a flint related problem? If we convert `a` into a list first we get a huge speedup:\n\n```\nsage: a = ZZ['x'](range(100000))\nsage: R = Integers(3)['x']\nsage: %timeit R(list(a))\n5 loops, best of 3: 116 ms per loop\n```\nPerhaps we should look into `R._element_constructor_` for the root of the issue, maybe some ring coercion done in a weird way?",
    "created_at": "2012-07-14T18:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130707",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:113" align="right">comment:113</div>

Is this a flint related problem? If we convert `a` into a list first we get a huge speedup:

```
sage: a = ZZ['x'](range(100000))
sage: R = Integers(3)['x']
sage: %timeit R(list(a))
5 loops, best of 3: 116 ms per loop
```
Perhaps we should look into `R._element_constructor_` for the root of the issue, maybe some ring coercion done in a weird way?



---

archive/issue_comments_130708.json:
```json
{
    "body": "<div id=\"comment:114\" align=\"right\">comment:114</div>\n\nRight, this is not a flint problem as such, and we should probably open a separate ticket for it.\n\nBut in this particular case, we should be doing a direct conversion between the flint polynomial types, which will be much faster still.",
    "created_at": "2012-07-14T18:58:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130708",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:114" align="right">comment:114</div>

Right, this is not a flint problem as such, and we should probably open a separate ticket for it.

But in this particular case, we should be doing a direct conversion between the flint polynomial types, which will be much faster still.



---

archive/issue_comments_130709.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\nI have created #13257 for this issue.",
    "created_at": "2012-07-15T10:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130709",
    "user": "https://github.com/sagetrac-jlopez"
}
```

<div id="comment:115" align="right">comment:115</div>

I have created #13257 for this issue.



---

archive/issue_comments_130710.json:
```json
{
    "body": "<div id=\"comment:116\" align=\"right\">comment:116</div>\n\nI've posted an updated spkg on my website\n(http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg)\nbased on my github trunk.\nApart from updating the src directory to the FLINT final 2.3 release and committing, tagging the changes in the HG repository, nothing should really change (except for fixing bugs :) ).",
    "created_at": "2012-07-19T00:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130710",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:116" align="right">comment:116</div>

I've posted an updated spkg on my website
(http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg)
based on my github trunk.
Apart from updating the src directory to the FLINT final 2.3 release and committing, tagging the changes in the HG repository, nothing should really change (except for fixing bugs :) ).



---

archive/issue_comments_130711.json:
```json
{
    "body": "Changed keywords from none to **flint**",
    "created_at": "2012-07-19T00:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130711",
    "user": "https://github.com/jpflori"
}
```

Changed keywords from none to **flint**



---

archive/issue_comments_130712.json:
```json
{
    "body": "Author: **Mike Hansen, Fredrik Johansson, Jean-Pierre Flori**",
    "created_at": "2012-07-19T00:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130712",
    "user": "https://github.com/jpflori"
}
```

Author: **Mike Hansen, Fredrik Johansson, Jean-Pierre Flori**



---

archive/issue_comments_130713.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n-To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:\n+To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:\n \n * the updated zn_poly spkg from #12433,\n-* the FLINT spkg at http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg;\n+* the FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg;\n \n apply:\n \n``````\n",
    "created_at": "2012-07-19T00:44:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130713",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
-To test an alpha version of the upcoming FLINT release on Sage 5.1.beta2, install:
+To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:
 
 * the updated zn_poly spkg from #12433,
-* the FLINT spkg at http://sage.math.washington.edu/home/fredrik/flint-2.3.spkg;
+* the FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg;
 
 apply:
 
``````




---

archive/issue_comments_130714.json:
```json
{
    "body": "<div id=\"comment:118\" align=\"right\">comment:118</div>\n\nReplying to [@fredrik-johansson](#comment%3A112):\n> Hmm, I seem to be unable to fix this in the obvious way. If I add\n> \n> ```\n> from sage.rings.polynomial.polynomial_integer_dense_flint cimport Polynomial_integer_dense_flint\n> ```\n> \n> to polynomial_zmod_flint.pyx in order to be able to access the value as an fmpz_poly_t, I get\n> \n> ```\n> In file included from /scratch/fjohanss/sage-5.1.rc0/local/include/NTL/ZZ.h:19:0,\n>                  from /scratch/fjohanss/sage-5.1.rc0/local/include/flint/NTL-interface.h:36,\n>                  from sage/rings/polynomial/polynomial_zmod_flint.c:250:\n> /scratch/fjohanss/sage-5.1.rc0/local/include/NTL/tools.h:11:19: fatal error: cstdlib: No such file or directory\n> ```\n> \n> Any idea how to fix this?\n\nI once had such a problem.\nIIRC a hackish but working fix is to \"cdef extern blahblah\" directly the structure in the file where you want to use it, so that you avoid to include all of the corresponding file with cimport and the corresponding dependencies and conflicts hell, in particular here where C and C++ get mixed because of NTL.",
    "created_at": "2012-07-19T00:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130714",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:118" align="right">comment:118</div>

Replying to [@fredrik-johansson](#comment%3A112):
> Hmm, I seem to be unable to fix this in the obvious way. If I add
> 
> ```
> from sage.rings.polynomial.polynomial_integer_dense_flint cimport Polynomial_integer_dense_flint
> ```
> 
> to polynomial_zmod_flint.pyx in order to be able to access the value as an fmpz_poly_t, I get
> 
> ```
> In file included from /scratch/fjohanss/sage-5.1.rc0/local/include/NTL/ZZ.h:19:0,
>                  from /scratch/fjohanss/sage-5.1.rc0/local/include/flint/NTL-interface.h:36,
>                  from sage/rings/polynomial/polynomial_zmod_flint.c:250:
> /scratch/fjohanss/sage-5.1.rc0/local/include/NTL/tools.h:11:19: fatal error: cstdlib: No such file or directory
> ```
> 
> Any idea how to fix this?

I once had such a problem.
IIRC a hackish but working fix is to "cdef extern blahblah" directly the structure in the file where you want to use it, so that you avoid to include all of the corresponding file with cimport and the corresponding dependencies and conflicts hell, in particular here where C and C++ get mixed because of NTL.



---

archive/issue_comments_130715.json:
```json
{
    "body": "Rebase on 5.2",
    "created_at": "2012-07-30T17:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130715",
    "user": "https://github.com/jpflori"
}
```

Rebase on 5.2



---

archive/issue_comments_130716.json:
```json
{
    "body": "Attachment: **[01-flint-2.3-sage-5.2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz)**\n\nRebase on 5.2",
    "created_at": "2012-07-30T17:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130716",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[01-flint-2.3-sage-5.2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz)**

Rebase on 5.2



---

archive/issue_comments_130717.json:
```json
{
    "body": "<div id=\"comment:119\" align=\"right\">comment:119</div>\n\nAttachment: **[07-headers-sage-5.2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz)**\n\nI've rebased patches on top of 5.2.\nI guess this is quite of useless because all patches related to #715 should get remerged soon and we'll need to rebase on top of that which is basically the same as the latest 5.1 betas.\nAnyway...\n\nApart from that I've posted a patch to get faster conversion between integer and mod polys, this is quite dirty, but seems to work ok.\nI did not have the time to rerun the test suite yet.\n\nThe trick about ntl was to tell cython to use g++ rather than gcc.\n\nTwo other remarks:\n* there is some file still named zmod_poly, I guess that's from FLINT 1.x and zn_poly, we might rename it to nmod_poly,\n* the integer_dense class does not use the template thing used by other polynomial class, I guess it should be treated in another ticket, but will be potentially a big amount of work. this is also true for other classes there.\n* the fmpz_mod_poly module could be wrapped, once again a fairly big amount of work.",
    "created_at": "2012-07-30T17:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130717",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:119" align="right">comment:119</div>

Attachment: **[07-headers-sage-5.2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz)**

I've rebased patches on top of 5.2.
I guess this is quite of useless because all patches related to #715 should get remerged soon and we'll need to rebase on top of that which is basically the same as the latest 5.1 betas.
Anyway...

Apart from that I've posted a patch to get faster conversion between integer and mod polys, this is quite dirty, but seems to work ok.
I did not have the time to rerun the test suite yet.

The trick about ntl was to tell cython to use g++ rather than gcc.

Two other remarks:
* there is some file still named zmod_poly, I guess that's from FLINT 1.x and zn_poly, we might rename it to nmod_poly,
* the integer_dense class does not use the template thing used by other polynomial class, I guess it should be treated in another ticket, but will be potentially a big amount of work. this is also true for other classes there.
* the fmpz_mod_poly module could be wrapped, once again a fairly big amount of work.



---

archive/issue_comments_130718.json:
```json
{
    "body": "<div id=\"comment:120\" align=\"right\">comment:120</div>\n\nAnd obviously I did not changed the doc of the new function I created.\nAny more sensible name or code organization is welcomed.",
    "created_at": "2012-07-30T17:50:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130718",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:120" align="right">comment:120</div>

And obviously I did not changed the doc of the new function I created.
Any more sensible name or code organization is welcomed.



---

archive/issue_comments_130719.json:
```json
{
    "body": "<div id=\"comment:121\" align=\"right\">comment:121</div>\n\nI've updated a more proper spkg at the same address as before.\nAnd updated some patches.",
    "created_at": "2012-07-31T17:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130719",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:121" align="right">comment:121</div>

I've updated a more proper spkg at the same address as before.
And updated some patches.



---

archive/issue_comments_130720.json:
```json
{
    "body": "Faster conversion between integer and mod polys.",
    "created_at": "2012-07-31T17:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130720",
    "user": "https://github.com/jpflori"
}
```

Faster conversion between integer and mod polys.



---

archive/issue_comments_130721.json:
```json
{
    "body": "Attachment: **[15-integer_to_mod.patch.gz](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz)**\n\nAttachment: **[16-rename_zmod_to_nmod.patch.gz](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz)**\n\nRename zmod stuff to nmod",
    "created_at": "2012-07-31T17:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130721",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[15-integer_to_mod.patch.gz](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz)**

Attachment: **[16-rename_zmod_to_nmod.patch.gz](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz)**

Rename zmod stuff to nmod



---

archive/issue_events_163657.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-07-31T17:13:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163657"
}
```



---

archive/issue_comments_130722.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,17 +5,19 @@\n \n apply:\n \n-* [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),\n+* [attachment: 01-flint-2.3-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz),\n * [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),\n * [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),\n * [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),\n * [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),\n * [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),\n-* [attachment: headers-5.1.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/headers-5.1.rc0.patch.gz),\n+* [attachment: 07-headers-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz),\n * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),\n-* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz).\n+* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),\n+* [attachment: 15-integer_to_mod.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz),\n+* [attachment: 16-rename_zmod_to_nmod.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz).\n``````\n",
    "created_at": "2012-07-31T17:13:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130722",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,17 +5,19 @@
 
 apply:
 
-* [attachment: flint-2.3-sage-5.1.beta2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-sage-5.1.beta2.patch.gz),
+* [attachment: 01-flint-2.3-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz),
 * [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),
 * [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),
 * [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),
 * [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),
 * [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),
-* [attachment: headers-5.1.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/headers-5.1.rc0.patch.gz),
+* [attachment: 07-headers-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz),
 * [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
 * [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
 * [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
 * [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
 * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
 * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),
-* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz).
+* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),
+* [attachment: 15-integer_to_mod.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz),
+* [attachment: 16-rename_zmod_to_nmod.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz).
``````




---

archive/issue_comments_130723.json:
```json
{
    "body": "<div id=\"comment:123\" align=\"right\">comment:123</div>\n\nIn case this helps the patchbot:\n\nUse the spkg:\n* the FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg;\n\nApply:\n\n* [attachment: 01-flint-2.3-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz),\n* [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),\n* [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),\n* [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),\n* [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),\n* [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),\n* [attachment: 07-headers-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz),\n* [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n* [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),\n* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),\n* [attachment: 15-integer_to_mod.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz),\n* [attachment: 16-rename_zmod_to_nmod.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz).",
    "created_at": "2012-07-31T17:15:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130723",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:123" align="right">comment:123</div>

In case this helps the patchbot:

Use the spkg:
* the FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg;

Apply:

* [attachment: 01-flint-2.3-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz),
* [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),
* [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),
* [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),
* [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),
* [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),
* [attachment: 07-headers-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz),
* [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
* [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),
* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),
* [attachment: 15-integer_to_mod.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz),
* [attachment: 16-rename_zmod_to_nmod.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz).



---

archive/issue_comments_130724.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">comment:124</div>\n\nIs there a reason for not just using fmpz_poly_get_nmod_poly?",
    "created_at": "2012-07-31T17:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130724",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:124" align="right">comment:124</div>

Is there a reason for not just using fmpz_poly_get_nmod_poly?



---

archive/issue_comments_130725.json:
```json
{
    "body": "<div id=\"comment:125\" align=\"right\">comment:125</div>\n\nNot at all.\nExcept that I did not now it existed...",
    "created_at": "2012-07-31T17:18:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130725",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:125" align="right">comment:125</div>

Not at all.
Except that I did not now it existed...



---

archive/issue_comments_130726.json:
```json
{
    "body": "Attachment: **[15-integer_to_mod-v2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz)**",
    "created_at": "2012-07-31T17:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130726",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[15-integer_to_mod-v2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz)**



---

archive/issue_comments_130727.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">comment:126</div>\n\nAttachment: **[16-rename_zmod_to_nmod-v2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz)**\n\nHere you go.",
    "created_at": "2012-07-31T17:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130727",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:126" align="right">comment:126</div>

Attachment: **[16-rename_zmod_to_nmod-v2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz)**

Here you go.



---

archive/issue_comments_130728.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,5 +19,5 @@\n * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),\n * [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),\n-* [attachment: 15-integer_to_mod.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz),\n-* [attachment: 16-rename_zmod_to_nmod.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz).\n+* [attachment: 15-integer_to_mod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz),\n+* [attachment: 16-rename_zmod_to_nmod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz).\n``````\n",
    "created_at": "2012-07-31T17:52:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130728",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,5 +19,5 @@
 * [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
 * [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),
 * [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),
-* [attachment: 15-integer_to_mod.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod.patch.gz),
-* [attachment: 16-rename_zmod_to_nmod.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod.patch.gz).
+* [attachment: 15-integer_to_mod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz),
+* [attachment: 16-rename_zmod_to_nmod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz).
``````




---

archive/issue_events_163658.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-08-03T06:53:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163658"
}
```



---

archive/issue_events_163659.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-08-03T06:53:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163659"
}
```



---

archive/issue_comments_130729.json:
```json
{
    "body": "<div id=\"comment:127\" align=\"right\">comment:127</div>\n\nWe need to make sure the MPFR (and the PARI and NTL) spkg get build before FLINT.",
    "created_at": "2012-08-03T06:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130729",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:127" align="right">comment:127</div>

We need to make sure the MPFR (and the PARI and NTL) spkg get build before FLINT.



---

archive/issue_comments_130730.json:
```json
{
    "body": "Changed keywords from **flint** to **flint spkg**",
    "created_at": "2012-08-03T06:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130730",
    "user": "https://github.com/jpflori"
}
```

Changed keywords from **flint** to **flint spkg**



---

archive/issue_comments_130731.json:
```json
{
    "body": "Work Issues: **spkg order**",
    "created_at": "2012-08-03T06:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130731",
    "user": "https://github.com/jpflori"
}
```

Work Issues: **spkg order**



---

archive/issue_comments_130732.json:
```json
{
    "body": "<div id=\"comment:128\" align=\"right\">comment:128</div>\n\nJust as a reminder, we should updated the Singular spkg with FLINT support when this gets in.\nI've created #13331.",
    "created_at": "2012-08-03T10:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130732",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:128" align="right">comment:128</div>

Just as a reminder, we should updated the Singular spkg with FLINT support when this gets in.
I've created #13331.



---

archive/issue_comments_130733.json:
```json
{
    "body": "Attachment: **[00-mpfr.patch.gz](https://github.com/sagemath/sage/files/ticket12173/00-mpfr.patch.gz)**\n\nMake FLINT spkg depend on MPFR spkg",
    "created_at": "2012-08-03T11:50:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130733",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[00-mpfr.patch.gz](https://github.com/sagemath/sage/files/ticket12173/00-mpfr.patch.gz)**

Make FLINT spkg depend on MPFR spkg



---

archive/issue_events_163660.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-08-03T11:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163660"
}
```



---

archive/issue_events_163661.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2012-08-03T11:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163661"
}
```



---

archive/issue_comments_130734.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,3 +21,6 @@\n * [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),\n * [attachment: 15-integer_to_mod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz),\n * [attachment: 16-rename_zmod_to_nmod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz).\n+\n+Apply to SAGE_ROOT:\n+* [attachment: 00-mpfr.patch](https://github.com/sagemath/sage/files/ticket12173/00-mpfr.patch.gz).\n``````\n",
    "created_at": "2012-08-03T11:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130734",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,3 +21,6 @@
 * [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),
 * [attachment: 15-integer_to_mod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz),
 * [attachment: 16-rename_zmod_to_nmod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz).
+
+Apply to SAGE_ROOT:
+* [attachment: 00-mpfr.patch](https://github.com/sagemath/sage/files/ticket12173/00-mpfr.patch.gz).
``````




---

archive/issue_comments_130735.json:
```json
{
    "body": "Changed work issues from **spkg order** to none",
    "created_at": "2012-08-03T11:51:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130735",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **spkg order** to none



---

archive/issue_comments_130736.json:
```json
{
    "body": "<div id=\"comment:130\" align=\"right\">comment:130</div>\n\nI did not look into the patch, but according to Jean-Pierre, you had problems with segfaults at quitting Sage.\n\nI am pretty much sure that this comes from something similar I had to struggle with at #12215 in the case of Pari. Namely, if you want to deallocate C-data of pari, flint, ... instances, you should do so in a `__dealloc__` method, but *not* like this:\n\n```\n    import sage.matrix.matrix_mod2_dense\n    sage.matrix.matrix_mod2_dense.free_m4ri()\n\n    import sage.libs.flint.flint\n    sage.libs.flint.flint.free_flint_stack()\n\n    pari._unsafe_deallocate_pari_stack()\n```\nThat is code from sage.all.quit_sage. I have replaced the pari._unsafe_deallocate... by a proper `__dealloc__` method in #12215, but perhaps you should do the same for the flint stack here?",
    "created_at": "2012-08-24T11:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130736",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:130" align="right">comment:130</div>

I did not look into the patch, but according to Jean-Pierre, you had problems with segfaults at quitting Sage.

I am pretty much sure that this comes from something similar I had to struggle with at #12215 in the case of Pari. Namely, if you want to deallocate C-data of pari, flint, ... instances, you should do so in a `__dealloc__` method, but *not* like this:

```
    import sage.matrix.matrix_mod2_dense
    sage.matrix.matrix_mod2_dense.free_m4ri()

    import sage.libs.flint.flint
    sage.libs.flint.flint.free_flint_stack()

    pari._unsafe_deallocate_pari_stack()
```
That is code from sage.all.quit_sage. I have replaced the pari._unsafe_deallocate... by a proper `__dealloc__` method in #12215, but perhaps you should do the same for the flint stack here?



---

archive/issue_comments_130737.json:
```json
{
    "body": "<div id=\"comment:131\" align=\"right\">comment:131</div>\n\nI think there is two differences here which complicate the situation:\n* we don't have an equivalent of PARIUniqueInstance to which every Sage objects using (in)directly fmpz's could point to\n* I fear some classes keep C pointers to fmpz's without any Python level wrapping (such as gen in the PARI case) and free them when they are deleted.\n\nSo without implementing such a unique FLINT instance and pointing to it in every stuff using part of FLINT, it will be hard to ensure that every Sage object is deleted before calling the FLINT cleanup function.",
    "created_at": "2012-08-24T11:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130737",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:131" align="right">comment:131</div>

I think there is two differences here which complicate the situation:
* we don't have an equivalent of PARIUniqueInstance to which every Sage objects using (in)directly fmpz's could point to
* I fear some classes keep C pointers to fmpz's without any Python level wrapping (such as gen in the PARI case) and free them when they are deleted.

So without implementing such a unique FLINT instance and pointing to it in every stuff using part of FLINT, it will be hard to ensure that every Sage object is deleted before calling the FLINT cleanup function.



---

archive/issue_comments_130738.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">comment:132</div>\n\nHow is this going?  Is this waiting on a review or does the problem Simon mentioned need to be solved first?",
    "created_at": "2012-10-15T08:37:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130738",
    "user": "https://github.com/roed314"
}
```

<div id="comment:132" align="right">comment:132</div>

How is this going?  Is this waiting on a review or does the problem Simon mentioned need to be solved first?



---

archive/issue_comments_130739.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:\n \n * the updated zn_poly spkg from #12433,\n-* the FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg;\n+* the FLINT spkg at http://www.infres.enst.fr/~flori/sage/flint-2.3.spkg;\n \n apply:\n \n``````\n",
    "created_at": "2012-10-15T08:46:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130739",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:
 
 * the updated zn_poly spkg from #12433,
-* the FLINT spkg at http://perso.telecom-paristech.fr/~flori/sage/flint-2.3.spkg;
+* the FLINT spkg at http://www.infres.enst.fr/~flori/sage/flint-2.3.spkg;
 
 apply:
 
``````




---

archive/issue_comments_130740.json:
```json
{
    "body": "<div id=\"comment:133\" align=\"right\">comment:133</div>\n\nI think the spkg here is (almost?) completely usable.\n\nSimon's remark is sensible, but currently there should be no segfaults occurring at all.\nIt would surely lead to a better integration of Sage/Python and FLINT memory management, but this would need a huge amount of work, modifying all the pieces of code in Sage which directly use FLINT at the C/Cython level.\nThis could be a \"follow-up\" ticket (although the problem also exists with the previous versions of FLINT).\n\nThe main blocker now is to wait for the final FLINT 2.3 release.\n\n(I've update the spkg link to point to a working address)",
    "created_at": "2012-10-15T08:46:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130740",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:133" align="right">comment:133</div>

I think the spkg here is (almost?) completely usable.

Simon's remark is sensible, but currently there should be no segfaults occurring at all.
It would surely lead to a better integration of Sage/Python and FLINT memory management, but this would need a huge amount of work, modifying all the pieces of code in Sage which directly use FLINT at the C/Cython level.
This could be a "follow-up" ticket (although the problem also exists with the previous versions of FLINT).

The main blocker now is to wait for the final FLINT 2.3 release.

(I've update the spkg link to point to a working address)



---

archive/issue_comments_130741.json:
```json
{
    "body": "<div id=\"comment:134\" align=\"right\">comment:134</div>\n\n2.3 final is out.\n\nI guess we need a separate ticket for upgrading MPIR to 2.6.0?",
    "created_at": "2012-11-13T09:36:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130741",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:134" align="right">comment:134</div>

2.3 final is out.

I guess we need a separate ticket for upgrading MPIR to 2.6.0?



---

archive/issue_comments_130742.json:
```json
{
    "body": "<div id=\"comment:135\" align=\"right\">comment:135</div>\n\nReplying to [@fredrik-johansson](#comment%3A134):\n> 2.3 final is out.\n\nIndeed :)\n> \n> I guess we need a separate ticket for upgrading MPIR to 2.6.0?\n\nI don't think this is mandatory to upgrade FLINT? Of course it would be nice to update MPIR as well.\n\nI'll try to upload an updated spkg containing the 2.3 final later today, so this should quite trivially get positive review.",
    "created_at": "2012-11-19T10:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130742",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:135" align="right">comment:135</div>

Replying to [@fredrik-johansson](#comment%3A134):
> 2.3 final is out.

Indeed :)
> 
> I guess we need a separate ticket for upgrading MPIR to 2.6.0?

I don't think this is mandatory to upgrade FLINT? Of course it would be nice to update MPIR as well.

I'll try to upload an updated spkg containing the 2.3 final later today, so this should quite trivially get positive review.



---

archive/issue_comments_130743.json:
```json
{
    "body": "<div id=\"comment:136\" align=\"right\">comment:136</div>\n\nOops, I just updated my repo and saw that Bill made MPIR 2.6.0 a prereq for FLINT 2.3...",
    "created_at": "2012-11-19T10:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130743",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:136" align="right">comment:136</div>

Oops, I just updated my repo and saw that Bill made MPIR 2.6.0 a prereq for FLINT 2.3...



---

archive/issue_comments_130744.json:
```json
{
    "body": "<div id=\"comment:137\" align=\"right\">comment:137</div>\n\nThe MPIR upgrade could be dealt with in #13137, although this was originally targetted for 2.5.*.",
    "created_at": "2012-11-19T11:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130744",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:137" align="right">comment:137</div>

The MPIR upgrade could be dealt with in #13137, although this was originally targetted for 2.5.*.



---

archive/issue_comments_130745.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,26 +1,11 @@\n To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:\n \n * the updated zn_poly spkg from #12433,\n-* the FLINT spkg at http://www.infres.enst.fr/~flori/sage/flint-2.3.spkg;\n+* the FLINT spkg at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg;\n \n apply:\n \n-* [attachment: 01-flint-2.3-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz),\n-* [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),\n-* [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),\n-* [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),\n-* [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),\n-* [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),\n-* [attachment: 07-headers-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz),\n-* [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),\n-* [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),\n-* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),\n-* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),\n-* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),\n-* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),\n-* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),\n-* [attachment: 15-integer_to_mod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz),\n-* [attachment: 16-rename_zmod_to_nmod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz).\n+* [attachment: flint-2.3-combined-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.5.rc0.patch.gz)\n \n Apply to SAGE_ROOT:\n-* [attachment: 00-mpfr.patch](https://github.com/sagemath/sage/files/ticket12173/00-mpfr.patch.gz).\n+* [attachment: flint-2.3-root-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.5.rc0.patch.gz).\n``````\n",
    "created_at": "2012-11-23T16:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130745",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,26 +1,11 @@
 To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:
 
 * the updated zn_poly spkg from #12433,
-* the FLINT spkg at http://www.infres.enst.fr/~flori/sage/flint-2.3.spkg;
+* the FLINT spkg at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg;
 
 apply:
 
-* [attachment: 01-flint-2.3-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/01-flint-2.3-sage-5.2.patch.gz),
-* [attachment: doctests.patch](https://github.com/sagemath/sage/files/ticket12173/doctests.patch.gz) (optional),
-* [attachment: flint_stack_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/flint_stack_cleanup.patch.gz),
-* [attachment: n_factor.patch](https://github.com/sagemath/sage/files/ticket12173/n_factor.patch.gz),
-* [attachment: degree.patch](https://github.com/sagemath/sage/files/ticket12173/degree.patch.gz),
-* [attachment: sqrt_normalization_fix.patch](https://github.com/sagemath/sage/files/ticket12173/sqrt_normalization_fix.patch.gz),
-* [attachment: 07-headers-sage-5.2.patch](https://github.com/sagemath/sage/files/ticket12173/07-headers-sage-5.2.patch.gz),
-* [attachment: multrunc.patch](https://github.com/sagemath/sage/files/ticket12173/multrunc.patch.gz),
-* [attachment: fmpz_cleanup.patch](https://github.com/sagemath/sage/files/ticket12173/fmpz_cleanup.patch.gz),
-* [attachment: jack.patch](https://github.com/sagemath/sage/files/ticket12173/jack.patch.gz),
-* [attachment: cython.patch](https://github.com/sagemath/sage/files/ticket12173/cython.patch.gz),
-* [attachment: slice.patch](https://github.com/sagemath/sage/files/ticket12173/slice.patch.gz),
-* [attachment: ref_flint1.patch](https://github.com/sagemath/sage/files/ticket12173/ref_flint1.patch.gz),
-* [attachment: compose_eval.patch](https://github.com/sagemath/sage/files/ticket12173/compose_eval.patch.gz),
-* [attachment: 15-integer_to_mod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/15-integer_to_mod-v2.patch.gz),
-* [attachment: 16-rename_zmod_to_nmod-v2.patch](https://github.com/sagemath/sage/files/ticket12173/16-rename_zmod_to_nmod-v2.patch.gz).
+* [attachment: flint-2.3-combined-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.5.rc0.patch.gz)
 
 Apply to SAGE_ROOT:
-* [attachment: 00-mpfr.patch](https://github.com/sagemath/sage/files/ticket12173/00-mpfr.patch.gz).
+* [attachment: flint-2.3-root-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.5.rc0.patch.gz).
``````




---

archive/issue_comments_130746.json:
```json
{
    "body": "<div id=\"comment:138\" align=\"right\">comment:138</div>\n\nAttachment: **[flint-2.3-root-5.5.rc0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.5.rc0.patch.gz)**\n\nHere comes an updated spkg including FLINT 2.3 final at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg\nand two combined and rebased patch to apply to Sage 5.5.rc0.\n\nThe only real additions were make to jack.patch because a lot of new doctests were included in sage/combinat/sf/jack.py and had to be fixed as well.\n\nThe other rebasing stuff was quite trivial.\n\nI've not included the renaming done by the previous 16-... patch to stick with FLINT terminology as it was surely a bad idea and broke some unpickling tests in Sage.\nAnyway, it can be done later.\n\nRemark that as Sage only includes MPIR 2.4.x and not MPIR 2.5.x, the FLINT spkg builds correctly and its and Sage test suite pass, so we could first include this, then work on upgrading MPIR directly to 2.6.x, skipping the problematic 2.5.x versions.",
    "created_at": "2012-11-23T16:53:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130746",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:138" align="right">comment:138</div>

Attachment: **[flint-2.3-root-5.5.rc0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.5.rc0.patch.gz)**

Here comes an updated spkg including FLINT 2.3 final at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg
and two combined and rebased patch to apply to Sage 5.5.rc0.

The only real additions were make to jack.patch because a lot of new doctests were included in sage/combinat/sf/jack.py and had to be fixed as well.

The other rebasing stuff was quite trivial.

I've not included the renaming done by the previous 16-... patch to stick with FLINT terminology as it was surely a bad idea and broke some unpickling tests in Sage.
Anyway, it can be done later.

Remark that as Sage only includes MPIR 2.4.x and not MPIR 2.5.x, the FLINT spkg builds correctly and its and Sage test suite pass, so we could first include this, then work on upgrading MPIR directly to 2.6.x, skipping the problematic 2.5.x versions.



---

archive/issue_comments_130747.json:
```json
{
    "body": "Attachment: **[flint-2.3-combined-5.5.rc0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.5.rc0.patch.gz)**\n\nWorking version",
    "created_at": "2012-11-24T21:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130747",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-combined-5.5.rc0.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.5.rc0.patch.gz)**

Working version



---

archive/issue_comments_130748.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:\n+The following let you update to FLINT 2.3 final:\n \n * the updated zn_poly spkg from #12433,\n * the FLINT spkg at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg;\n``````\n",
    "created_at": "2012-11-24T21:39:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130748",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-To test a (slightly modified) beta 3 version of the upcoming FLINT release on Sage 5.1.beta2, install:
+The following let you update to FLINT 2.3 final:
 
 * the updated zn_poly spkg from #12433,
 * the FLINT spkg at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg;
``````




---

archive/issue_comments_130749.json:
```json
{
    "body": "<div id=\"comment:140\" align=\"right\">comment:140</div>\n\nI was delighted to see that people have done all the work in getting flint-2.3 into Sage, as I am planning to make it a dependency for eclib.\n\nI am happy to test the new spkg and patch from this ticket, and hope that doing so without reading all the above comments will still be useful input.",
    "created_at": "2012-12-31T16:51:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130749",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:140" align="right">comment:140</div>

I was delighted to see that people have done all the work in getting flint-2.3 into Sage, as I am planning to make it a dependency for eclib.

I am happy to test the new spkg and patch from this ticket, and hope that doing so without reading all the above comments will still be useful input.



---

archive/issue_comments_130750.json:
```json
{
    "body": "<div id=\"comment:141\" align=\"right\">comment:141</div>\n\nReplying to [@JohnCremona](#comment%3A140):\n> I was delighted to see that people have done all the work in getting flint-2.3 into Sage, as I am planning to make it a dependency for eclib.\n> \n> I am happy to test the new spkg and patch from this ticket, and hope that doing so without reading all the above comments will still be useful input.\n\nThe new spkg built fine for me (64-bit ubuntu), the patches both applied fine to sage-5.5, and all tests pass.  Hence:\n\n+1 to a positive review.",
    "created_at": "2012-12-31T17:40:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130750",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:141" align="right">comment:141</div>

Replying to [@JohnCremona](#comment%3A140):
> I was delighted to see that people have done all the work in getting flint-2.3 into Sage, as I am planning to make it a dependency for eclib.
> 
> I am happy to test the new spkg and patch from this ticket, and hope that doing so without reading all the above comments will still be useful input.

The new spkg built fine for me (64-bit ubuntu), the patches both applied fine to sage-5.5, and all tests pass.  Hence:

+1 to a positive review.



---

archive/issue_comments_130751.json:
```json
{
    "body": "<div id=\"comment:142\" align=\"right\">comment:142</div>\n\nThe spkg should be rebased to the flint-1.5.2.p2 package currently in Sage.\n\nAlso, the deprecated `_sig_on` and `_sig_off` should be replaced by `sig_on()` and `sig_off()`.",
    "created_at": "2013-01-11T16:17:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130751",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:142" align="right">comment:142</div>

The spkg should be rebased to the flint-1.5.2.p2 package currently in Sage.

Also, the deprecated `_sig_on` and `_sig_off` should be replaced by `sig_on()` and `sig_off()`.



---

archive/issue_comments_130752.json:
```json
{
    "body": "Root patch",
    "created_at": "2013-01-11T16:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130752",
    "user": "https://github.com/jpflori"
}
```

Root patch



---

archive/issue_comments_130753.json:
```json
{
    "body": "Attachment: **[flint-2.3-root-5.6.b3.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz)**\n\nAttachment: **[flint-2.3-combined-5.6.b3.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)**\n\nLibrary patch",
    "created_at": "2013-01-11T16:58:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130753",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-root-5.6.b3.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz)**

Attachment: **[flint-2.3-combined-5.6.b3.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)**

Library patch



---

archive/issue_comments_130754.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n \n apply:\n \n-* [attachment: flint-2.3-combined-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.5.rc0.patch.gz)\n+* [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)\n \n Apply to SAGE_ROOT:\n-* [attachment: flint-2.3-root-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.5.rc0.patch.gz).\n+* [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).\n``````\n",
    "created_at": "2013-01-11T16:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130754",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 
 apply:
 
-* [attachment: flint-2.3-combined-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.5.rc0.patch.gz)
+* [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)
 
 Apply to SAGE_ROOT:
-* [attachment: flint-2.3-root-5.5.rc0.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.5.rc0.patch.gz).
+* [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).
``````




---

archive/issue_comments_130755.json:
```json
{
    "body": "<div id=\"comment:143\" align=\"right\">comment:143</div>\n\nReplying to [@jdemeyer](#comment%3A142):\n> The spkg should be rebased to the flint-1.5.2.p2 package currently in Sage.\n> \n\nDone.\n> Also, the deprecated `_sig_on` and `_sig_off` should be replaced by `sig_on()` and `sig_off()`.\n\nDone.",
    "created_at": "2013-01-11T16:59:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130755",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:143" align="right">comment:143</div>

Replying to [@jdemeyer](#comment%3A142):
> The spkg should be rebased to the flint-1.5.2.p2 package currently in Sage.
> 

Done.
> Also, the deprecated `_sig_on` and `_sig_off` should be replaced by `sig_on()` and `sig_off()`.

Done.



---

archive/issue_comments_130756.json:
```json
{
    "body": "<div id=\"comment:144\" align=\"right\">comment:144</div>\n\nI removed the longlong patch as the asm code completely changed.\nHopefully no new fix is needed but that will need testing on ARM, not sure that was done during the FLINT release process.",
    "created_at": "2013-01-11T17:00:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130756",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:144" align="right">comment:144</div>

I removed the longlong patch as the asm code completely changed.
Hopefully no new fix is needed but that will need testing on ARM, not sure that was done during the FLINT release process.



---

archive/issue_comments_130757.json:
```json
{
    "body": "Reviewer: **John Cremona**",
    "created_at": "2013-01-11T20:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130757",
    "user": "https://github.com/JohnCremona"
}
```

Reviewer: **John Cremona**



---

archive/issue_comments_130758.json:
```json
{
    "body": "<div id=\"comment:145\" align=\"right\">comment:145</div>\n\nThe new spkg builds fine for me (64-bit ubuntu) with SAGE_CHECK=yes.  I am running a full test after applying both patches and doing sage -br.\n\nAll tests pass.  I'm not sure that I will test it again after Jeroen's suggested edits!",
    "created_at": "2013-01-11T20:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130758",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:145" align="right">comment:145</div>

The new spkg builds fine for me (64-bit ubuntu) with SAGE_CHECK=yes.  I am running a full test after applying both patches and doing sage -br.

All tests pass.  I'm not sure that I will test it again after Jeroen's suggested edits!



---

archive/issue_comments_130759.json:
```json
{
    "body": "<div id=\"comment:146\" align=\"right\">comment:146</div>\n\nAllow me to suggest a few small changes to `spkg-install`:\n\n1. Change\n\n```\nCFLAGS=\"-O0 -g\"; export CFLAGS\n```\nto\n\n```\nexport CFLAGS=\"-O0 -g $CFLAGS\"\n```\n\n2. Rename `$EXTRA_CONF` to `$FLINT_CONFIGURE` for analogy with other packages, **don't** quote it in the `./configure` invocation and change\n\n```\nEXTRA_CONF=\"--disable-static\"\n```\nto\n\n```\nFLINT_CONFIGURE=\"--disable-static $FLINT_CONFIGURE\"\n```\n\n3. Quote `$SAGE_LOCAL`:\n\n```\nrm -f \"$SAGE_LOCAL\"/lib/libflint* \nrm -rf \"$SAGE_LOCAL\"/include/flint \n```\n\n4. Why doesn't `spkg-check` have a newline at the end of the file?",
    "created_at": "2013-01-11T20:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130759",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:146" align="right">comment:146</div>

Allow me to suggest a few small changes to `spkg-install`:

1. Change

```
CFLAGS="-O0 -g"; export CFLAGS
```
to

```
export CFLAGS="-O0 -g $CFLAGS"
```

2. Rename `$EXTRA_CONF` to `$FLINT_CONFIGURE` for analogy with other packages, **don't** quote it in the `./configure` invocation and change

```
EXTRA_CONF="--disable-static"
```
to

```
FLINT_CONFIGURE="--disable-static $FLINT_CONFIGURE"
```

3. Quote `$SAGE_LOCAL`:

```
rm -f "$SAGE_LOCAL"/lib/libflint* 
rm -rf "$SAGE_LOCAL"/include/flint 
```

4. Why doesn't `spkg-check` have a newline at the end of the file?



---

archive/issue_comments_130760.json:
```json
{
    "body": "Attachment: **[flint-2.3+reviewer.diff.gz](https://github.com/sagemath/sage/files/ticket12173/e924223028b325f57b62c6dc9507757f.gz)**\n\nSpkg diff, for review only.",
    "created_at": "2013-01-11T22:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130760",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3+reviewer.diff.gz](https://github.com/sagemath/sage/files/ticket12173/e924223028b325f57b62c6dc9507757f.gz)**

Spkg diff, for review only.



---

archive/issue_comments_130761.json:
```json
{
    "body": "<div id=\"comment:147\" align=\"right\">comment:147</div>\n\nReplying to [@jdemeyer](#comment%3A146):\n> Allow me to suggest a few small changes to `spkg-install`:\n> \n> 1. Change\n> \n> ```\n> CFLAGS=\"-O0 -g\"; export CFLAGS\n> ```\n> to\n> \n> ```\n> export CFLAGS=\"-O0 -g $CFLAGS\"\n> ```\n\nDone for CFLAGS and similar exports.\n> \n> 2. Rename `$EXTRA_CONF` to `$FLINT_CONFIGURE` for analogy with other packages, **don't** quote it in the `./configure` invocation and change\n> \n> ```\n> EXTRA_CONF=\"--disable-static\"\n> ```\n> to\n> \n> ```\n> FLINT_CONFIGURE=\"--disable-static $FLINT_CONFIGURE\"\n> ```\n> \n\nDone.\nWhy not quote FLINT_CONFIGURE?\n> 3. Quote `$SAGE_LOCAL`:\n> \n> ```\n> rm -f \"$SAGE_LOCAL\"/lib/libflint* \n> rm -rf \"$SAGE_LOCAL\"/include/flint \n> ```\n\nDone.\n> \n> 4. Why doesn't `spkg-check` have a newline at the end of the file?\n\nNo reason, it's in now.",
    "created_at": "2013-01-11T22:53:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130761",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:147" align="right">comment:147</div>

Replying to [@jdemeyer](#comment%3A146):
> Allow me to suggest a few small changes to `spkg-install`:
> 
> 1. Change
> 
> ```
> CFLAGS="-O0 -g"; export CFLAGS
> ```
> to
> 
> ```
> export CFLAGS="-O0 -g $CFLAGS"
> ```

Done for CFLAGS and similar exports.
> 
> 2. Rename `$EXTRA_CONF` to `$FLINT_CONFIGURE` for analogy with other packages, **don't** quote it in the `./configure` invocation and change
> 
> ```
> EXTRA_CONF="--disable-static"
> ```
> to
> 
> ```
> FLINT_CONFIGURE="--disable-static $FLINT_CONFIGURE"
> ```
> 

Done.
Why not quote FLINT_CONFIGURE?
> 3. Quote `$SAGE_LOCAL`:
> 
> ```
> rm -f "$SAGE_LOCAL"/lib/libflint* 
> rm -rf "$SAGE_LOCAL"/include/flint 
> ```

Done.
> 
> 4. Why doesn't `spkg-check` have a newline at the end of the file?

No reason, it's in now.



---

archive/issue_comments_130762.json:
```json
{
    "body": "<div id=\"comment:148\" align=\"right\">comment:148</div>\n\nReplying to [@jpflori](#comment%3A147):\n> Why not quote FLINT_CONFIGURE?\n\nTo allow\n\n```\nFLINT_CONFIGURE=\"--enable-foo --disable-bar\"\n```\nYou want this to be two separate words, similar to how `$CC` and `$CFLAGS` should not be quoted.",
    "created_at": "2013-01-12T07:56:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130762",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:148" align="right">comment:148</div>

Replying to [@jpflori](#comment%3A147):
> Why not quote FLINT_CONFIGURE?

To allow

```
FLINT_CONFIGURE="--enable-foo --disable-bar"
```
You want this to be two separate words, similar to how `$CC` and `$CFLAGS` should not be quoted.



---

archive/issue_comments_130763.json:
```json
{
    "body": "<div id=\"comment:149\" align=\"right\">comment:149</div>\n\nThis breaks all over the place on OS X, see [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio)\n\nThis also shows that some `cdef` functions should have `except` clauses, in particular\n\n```\ncdef void _set_fmpz_poly(self, fmpz_poly_t)\n```\nOtherwise, what's the point of `sig_on()`?",
    "created_at": "2013-01-14T12:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130763",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:149" align="right">comment:149</div>

This breaks all over the place on OS X, see [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio)

This also shows that some `cdef` functions should have `except` clauses, in particular

```
cdef void _set_fmpz_poly(self, fmpz_poly_t)
```
Otherwise, what's the point of `sig_on()`?



---

archive/issue_events_163662.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-14T12:37:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163662"
}
```



---

archive/issue_events_163663.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-14T12:37:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163663"
}
```



---

archive/issue_comments_130764.json:
```json
{
    "body": "Work Issues: **cdef except**",
    "created_at": "2013-01-14T12:37:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130764",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **cdef except**



---

archive/issue_comments_130765.json:
```json
{
    "body": "<div id=\"comment:151\" align=\"right\">comment:151</div>\n\nReplying to [@jdemeyer](#comment%3A149):\n> This breaks all over the place on OS X, see [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio)\n\nDoes FLINT pass its testsuite there?\n(I don't have access to bsd so cannot check for myself.)\n> \n> This also shows that some `cdef` functions should have `except` clauses, in particular\n> \n> ```\n> cdef void _set_fmpz_poly(self, fmpz_poly_t)\n> ```\n> Otherwise, what's the point of `sig_on()`?",
    "created_at": "2013-01-14T12:43:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130765",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:151" align="right">comment:151</div>

Replying to [@jdemeyer](#comment%3A149):
> This breaks all over the place on OS X, see [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio)

Does FLINT pass its testsuite there?
(I don't have access to bsd so cannot check for myself.)
> 
> This also shows that some `cdef` functions should have `except` clauses, in particular
> 
> ```
> cdef void _set_fmpz_poly(self, fmpz_poly_t)
> ```
> Otherwise, what's the point of `sig_on()`?



---

archive/issue_comments_130766.json:
```json
{
    "body": "<div id=\"comment:152\" align=\"right\">comment:152</div>\n\nReplying to [@jpflori](#comment%3A151):\n> Replying to [@jdemeyer](#comment%3A149):\n> > This breaks all over the place on OS X, see [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio)\n\n> Does FLINT pass its testsuite there?\n\nYes, it does.",
    "created_at": "2013-01-14T14:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130766",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:152" align="right">comment:152</div>

Replying to [@jpflori](#comment%3A151):
> Replying to [@jdemeyer](#comment%3A149):
> > This breaks all over the place on OS X, see [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/192/steps/shell_7/logs/stdio)

> Does FLINT pass its testsuite there?

Yes, it does.



---

archive/issue_comments_130767.json:
```json
{
    "body": "<div id=\"comment:153\" align=\"right\">comment:153</div>\n\nThis is problematic:\n\n```\n     Extension('sage.rings.fraction_field_FpT',\n               sources = ['sage/rings/fraction_field_FpT.pyx'],\n               language = 'c++',\n               libraries = [\"csage\", \"flint\", \"gmp\", \"gmpxx\", \"ntl\", \"zn_poly\"],\n               extra_compile_args=[\"-std=c99\", \"-D_XPG6\"],\n               include_dirs = [SAGE_INC + 'flint/'],\n               depends = flint_depends),\n```\nA file cannot be both C++ and C99.\n\nThis causes a build failure on OpenSolaris (buildbot machine `hawk`).",
    "created_at": "2013-01-15T11:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130767",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:153" align="right">comment:153</div>

This is problematic:

```
     Extension('sage.rings.fraction_field_FpT',
               sources = ['sage/rings/fraction_field_FpT.pyx'],
               language = 'c++',
               libraries = ["csage", "flint", "gmp", "gmpxx", "ntl", "zn_poly"],
               extra_compile_args=["-std=c99", "-D_XPG6"],
               include_dirs = [SAGE_INC + 'flint/'],
               depends = flint_depends),
```
A file cannot be both C++ and C99.

This causes a build failure on OpenSolaris (buildbot machine `hawk`).



---

archive/issue_comments_130768.json:
```json
{
    "body": "Changed work issues from **cdef except** to **cdef except, C++/C99**",
    "created_at": "2013-01-15T11:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130768",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **cdef except** to **cdef except, C++/C99**



---

archive/issue_comments_130769.json:
```json
{
    "body": "<div id=\"comment:154\" align=\"right\">comment:154</div>\n\nAttachment: **[12173_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)**",
    "created_at": "2013-01-17T14:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130769",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:154" align="right">comment:154</div>

Attachment: **[12173_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)**



---

archive/issue_events_163664.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T14:09:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163664"
}
```



---

archive/issue_events_163665.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T14:09:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163665"
}
```



---

archive/issue_comments_130770.json:
```json
{
    "body": "Changed work issues from **cdef except, C++/C99** to none",
    "created_at": "2013-01-17T14:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130770",
    "user": "https://github.com/jdemeyer"
}
```

Changed work issues from **cdef except, C++/C99** to none



---

archive/issue_comments_130771.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n apply:\n \n * [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)\n+* [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)\n \n Apply to SAGE_ROOT:\n * [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).\n``````\n",
    "created_at": "2013-01-17T14:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130771",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 apply:
 
 * [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)
+* [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)
 
 Apply to SAGE_ROOT:
 * [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).
``````




---

archive/issue_comments_130772.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,9 @@\n-The following let you update to FLINT 2.3 final:\n+**Install**:\n+* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)\n \n-* the updated zn_poly spkg from #12433,\n-* the FLINT spkg at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg;\n-\n-apply:\n-\n+**Apply**:\n * [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)\n * [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)\n \n-Apply to SAGE_ROOT:\n+**Apply** to SAGE_ROOT:\n * [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).\n``````\n",
    "created_at": "2013-01-17T14:26:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130772",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,9 @@
-The following let you update to FLINT 2.3 final:
+**Install**:
+* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)
 
-* the updated zn_poly spkg from #12433,
-* the FLINT spkg at http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg;
-
-apply:
-
+**Apply**:
 * [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)
 * [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)
 
-Apply to SAGE_ROOT:
+**Apply** to SAGE_ROOT:
 * [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).
``````




---

archive/issue_events_163666.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-01-17T14:37:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163666"
}
```



---

archive/issue_events_163667.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-01-17T14:37:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163667"
}
```



---

archive/issue_comments_130773.json:
```json
{
    "body": "<div id=\"comment:156\" align=\"right\">comment:156</div>\n\nYour changes look good, so I'm putting back this to positive review with the idea it will relaunch a set of tests on the buildbots (am I wrong?) even though I cannot really think of how this could fix the bsd problems.",
    "created_at": "2013-01-17T14:37:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130773",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:156" align="right">comment:156</div>

Your changes look good, so I'm putting back this to positive review with the idea it will relaunch a set of tests on the buildbots (am I wrong?) even though I cannot really think of how this could fix the bsd problems.



---

archive/issue_events_163668.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T14:44:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "milestone_number": null,
    "milestone_title": "sage-5.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163668"
}
```



---

archive/issue_events_163669.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T14:44:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163669"
}
```



---

archive/issue_events_163670.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T14:44:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163670"
}
```



---

archive/issue_events_163671.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-17T14:44:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163671"
}
```



---

archive/issue_comments_130774.json:
```json
{
    "body": "<div id=\"comment:157\" align=\"right\">comment:157</div>\n\nReplying to [@jpflori](#comment%3A156):\n> Your changes look good, so I'm putting back this to positive review with the idea it will relaunch a set of tests on the buildbots (am I wrong?) even though I cannot really think of how this could fix the bsd problems.\n\nNot so fast.  First of all, the main FLINT patch never received positive_review.  And then indeed, it's unlikely the OS X problems are resolved.",
    "created_at": "2013-01-17T14:44:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130774",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:157" align="right">comment:157</div>

Replying to [@jpflori](#comment%3A156):
> Your changes look good, so I'm putting back this to positive review with the idea it will relaunch a set of tests on the buildbots (am I wrong?) even though I cannot really think of how this could fix the bsd problems.

Not so fast.  First of all, the main FLINT patch never received positive_review.  And then indeed, it's unlikely the OS X problems are resolved.



---

archive/issue_comments_130775.json:
```json
{
    "body": "<div id=\"comment:158\" align=\"right\">comment:158</div>\n\nReplying to [@jdemeyer](#comment%3A157):\n> Replying to [@jpflori](#comment%3A156):\n> > Your changes look good, so I'm putting back this to positive review with the idea it will relaunch a set of tests on the buildbots (am I wrong?) even though I cannot really think of how this could fix the bsd problems.\n\n> \n> Not so fast.  First of all, the main FLINT patch never received positive_review.\n\nHum, that's true.\n> And then indeed, it's unlikely the OS X problems are resolved.\n\nAnyway, it leaves you the pleasure to launch tests on bsd.\nCannot do much about that as I don't have access to such systems and I won't have time to stare at the code thinking about what goes wrong in factor() or whatever.",
    "created_at": "2013-01-17T14:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130775",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:158" align="right">comment:158</div>

Replying to [@jdemeyer](#comment%3A157):
> Replying to [@jpflori](#comment%3A156):
> > Your changes look good, so I'm putting back this to positive review with the idea it will relaunch a set of tests on the buildbots (am I wrong?) even though I cannot really think of how this could fix the bsd problems.

> 
> Not so fast.  First of all, the main FLINT patch never received positive_review.

Hum, that's true.
> And then indeed, it's unlikely the OS X problems are resolved.

Anyway, it leaves you the pleasure to launch tests on bsd.
Cannot do much about that as I don't have access to such systems and I won't have time to stare at the code thinking about what goes wrong in factor() or whatever.



---

archive/issue_comments_130776.json:
```json
{
    "body": "<div id=\"comment:159\" align=\"right\">comment:159</div>\n\nLooks like a chicken-and-egg situation, if the only way to get buildbots to test it is to give it a positive review!",
    "created_at": "2013-01-17T16:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130776",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:159" align="right">comment:159</div>

Looks like a chicken-and-egg situation, if the only way to get buildbots to test it is to give it a positive review!



---

archive/issue_comments_130777.json:
```json
{
    "body": "<div id=\"comment:160\" align=\"right\">comment:160</div>\n\nReplying to [@JohnCremona](#comment%3A159):\n> Looks like a chicken-and-egg situation, if the only way to get buildbots to test it is to give it a positive review!\n\nThat's not really true.  I sometimes test tickets (like this one) which don't have positive review.\n\nHowever: if a reviewer thinks a ticket is good, except perhaps that it hasn't been tested on some systems, then that reviewer should put the ticket to positive_review to get it tested.  But that's not the situation here, no reviewer has looked sufficiently well at the patch to approve it.",
    "created_at": "2013-01-17T18:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130777",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:160" align="right">comment:160</div>

Replying to [@JohnCremona](#comment%3A159):
> Looks like a chicken-and-egg situation, if the only way to get buildbots to test it is to give it a positive review!

That's not really true.  I sometimes test tickets (like this one) which don't have positive review.

However: if a reviewer thinks a ticket is good, except perhaps that it hasn't been tested on some systems, then that reviewer should put the ticket to positive_review to get it tested.  But that's not the situation here, no reviewer has looked sufficiently well at the patch to approve it.



---

archive/issue_comments_130778.json:
```json
{
    "body": "<div id=\"comment:161\" align=\"right\">comment:161</div>\n\nFor easier reviewing, it would really be good to split up the big patchbomb into a \"rename methods\" patch (e.g. from zmod to nmod) which does only that and should be automatically generated and a \"remainder\" patch.",
    "created_at": "2013-01-18T09:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130778",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:161" align="right">comment:161</div>

For easier reviewing, it would really be good to split up the big patchbomb into a "rename methods" patch (e.g. from zmod to nmod) which does only that and should be automatically generated and a "remainder" patch.



---

archive/issue_comments_130779.json:
```json
{
    "body": "<div id=\"comment:162\" align=\"right\">comment:162</div>\n\nIn fact the changes used to be split among different patches, but at some point I've gather them back together thinking it would be easier to maintain them that way.\n\nYou can see the previous bunch of patch in the diff at https://github.com/sagemath/sage/issues/12173#comment:138\nExcept for additional changes in jack.pyx and the removal of a bad change I made, the changes did not really evolve IIRC, maybe some rebasing only.\nI don't really feel like resplitting everything back now...",
    "created_at": "2013-01-18T09:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130779",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:162" align="right">comment:162</div>

In fact the changes used to be split among different patches, but at some point I've gather them back together thinking it would be easier to maintain them that way.

You can see the previous bunch of patch in the diff at https://github.com/sagemath/sage/issues/12173#comment:138
Except for additional changes in jack.pyx and the removal of a bad change I made, the changes did not really evolve IIRC, maybe some rebasing only.
I don't really feel like resplitting everything back now...



---

archive/issue_comments_130780.json:
```json
{
    "body": "<div id=\"comment:163\" align=\"right\">comment:163</div>\n\nIn any case, things still look very bad on OS X: [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/194/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/194/steps/shell_7/logs/stdio)",
    "created_at": "2013-01-18T13:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130780",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:163" align="right">comment:163</div>

In any case, things still look very bad on OS X: [http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/194/steps/shell_7/logs/stdio](http://build.sagemath.org/sage/builders/UW%20bsd%20%28OSX%2010.6%20x86_64%29/builds/194/steps/shell_7/logs/stdio)



---

archive/issue_comments_130781.json:
```json
{
    "body": "Work Issues: **OS X**",
    "created_at": "2013-01-18T13:17:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130781",
    "user": "https://github.com/jdemeyer"
}
```

Work Issues: **OS X**



---

archive/issue_comments_130782.json:
```json
{
    "body": "<div id=\"comment:164\" align=\"right\">comment:164</div>\n\nOn OS X 10.4 PPC, Sage doesn't even start:\n\n```\n\nTesting that Sage starts...\n[2013-01-18 19:51:11] Sage version 5.7.alpha0, released 2013-01-17\nTraceback (most recent call last):\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/bin/sage-eval\", line 4, in <module>\n    from sage.all import *\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/all.py\", line 66, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/misc/all.py\", line 83, in <module>\n    from functional import (additive_order,\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 36, in <module>\n    from sage.rings.complex_double import CDF\n  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:16552)\nImportError: dlopen(/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/rings/integer.so, 2): Symbol not found: _n_factor\n  Referenced from: /Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/rings/integer.so\n  Expected in: dynamic lookup\n```",
    "created_at": "2013-01-19T09:40:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130782",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:164" align="right">comment:164</div>

On OS X 10.4 PPC, Sage doesn't even start:

```

Testing that Sage starts...
[2013-01-18 19:51:11] Sage version 5.7.alpha0, released 2013-01-17
Traceback (most recent call last):
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/bin/sage-eval", line 4, in <module>
    from sage.all import *
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/all.py", line 66, in <module>
    from sage.misc.all       import *         # takes a while
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/misc/all.py", line 83, in <module>
    from functional import (additive_order,
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/misc/functional.py", line 36, in <module>
    from sage.rings.complex_double import CDF
  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:16552)
ImportError: dlopen(/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/rings/integer.so, 2): Symbol not found: _n_factor
  Referenced from: /Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.7.alpha0/local/lib/python2.7/site-packages/sage/rings/integer.so
  Expected in: dynamic lookup
```



---

archive/issue_comments_130783.json:
```json
{
    "body": "<div id=\"comment:165\" align=\"right\">comment:165</div>\n\nOn all buildbot systems which aren't OS X, this builds fine and all doctests pass.",
    "created_at": "2013-01-19T09:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130783",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:165" align="right">comment:165</div>

On all buildbot systems which aren't OS X, this builds fine and all doctests pass.



---

archive/issue_comments_130784.json:
```json
{
    "body": "<div id=\"comment:166\" align=\"right\">comment:166</div>\n\nSo are there any developers around with access to an OS X system who'd be able to take a look at this?",
    "created_at": "2013-01-25T09:59:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130784",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:166" align="right">comment:166</div>

So are there any developers around with access to an OS X system who'd be able to take a look at this?



---

archive/issue_comments_130785.json:
```json
{
    "body": "<div id=\"comment:167\" align=\"right\">comment:167</div>\n\nReplying to [@fredrik-johansson](#comment%3A166):\n> So are there any developers around with access to an OS X system who'd be able to take a look at this?\n\nDoes not look so.\nMaybe the easiest way is to ask William for access to bsd.",
    "created_at": "2013-01-25T10:19:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130785",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:167" align="right">comment:167</div>

Replying to [@fredrik-johansson](#comment%3A166):
> So are there any developers around with access to an OS X system who'd be able to take a look at this?

Does not look so.
Maybe the easiest way is to ask William for access to bsd.



---

archive/issue_comments_130786.json:
```json
{
    "body": "<div id=\"comment:168\" align=\"right\">comment:168</div>\n\nHum, that's not just OS X that OS X on PPC. By the look of the log I am wondering if flint was built properly. I don't know if the buildbot run with spkg-check but I would be curious to see the result on that machine. And the build log too.\n\nKarl-dieter has (or had) such a machine.",
    "created_at": "2013-01-25T10:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130786",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:168" align="right">comment:168</div>

Hum, that's not just OS X that OS X on PPC. By the look of the log I am wondering if flint was built properly. I don't know if the buildbot run with spkg-check but I would be curious to see the result on that machine. And the build log too.

Karl-dieter has (or had) such a machine.



---

archive/issue_comments_130787.json:
```json
{
    "body": "<div id=\"comment:169\" align=\"right\">comment:169</div>\n\nThere are problems on all OS X machines, it's just that the problem on OS X 10.4 PPC is *different* from the problems with other OS X versions.",
    "created_at": "2013-01-25T10:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130787",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:169" align="right">comment:169</div>

There are problems on all OS X machines, it's just that the problem on OS X 10.4 PPC is *different* from the problems with other OS X versions.



---

archive/issue_comments_130788.json:
```json
{
    "body": "<div id=\"comment:170\" align=\"right\">comment:170</div>\n\nThen I can have a look at it (10.5.8). I'll see if beta0 build at the same time, that may be another issue in and of itself.",
    "created_at": "2013-01-25T10:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130788",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:170" align="right">comment:170</div>

Then I can have a look at it (10.5.8). I'll see if beta0 build at the same time, that may be another issue in and of itself.



---

archive/issue_comments_130789.json:
```json
{
    "body": "<div id=\"comment:171\" align=\"right\">comment:171</div>\n\nIt built for me on 10.6.8 and all tests passed.  What kind of errors should I be looking for?",
    "created_at": "2013-01-27T09:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130789",
    "user": "https://github.com/roed314"
}
```

<div id="comment:171" align="right">comment:171</div>

It built for me on 10.6.8 and all tests passed.  What kind of errors should I be looking for?



---

archive/issue_comments_130790.json:
```json
{
    "body": "<div id=\"comment:172\" align=\"right\">comment:172</div>\n\nReplying to [@roed314](#comment%3A171):\n> It built for me on 10.6.8 and all tests passed.\n\nThat's totally wierd.  I doesn't work on any OS X buildbot machine (there are 3 of them).\n\n> What kind of errors should I be looking for?\n\n\n```\nThe following tests failed:\n\n\tsage -t  --long -force_lib devel/sage/doc/de/tutorial/tour_advanced.rst # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/doc/en/constructions/modular_forms.rst # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/doc/en/bordeaux_2008/birds_other.rst # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/doc/en/tutorial/tour_advanced.rst # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/doc/fr/tutorial/tour_advanced.rst # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/doc/ru/tutorial/tour_advanced.rst # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/matrix/matrix_modn_dense_template.pxi # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/matrix/matrix2.pyx # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modular/buzzard.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modular/abvar/abvar.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/abvar/torsion_subgroup.py # 4 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/ambient.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/eis_series.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/constructor.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/find_generators.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/hecke_operator_on_qexp.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/vm_basis.py # 2 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/space.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modsym/ambient.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modsym/subspace.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/overconvergent/genus0.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/overconvergent/hecke_series.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/rings/qqbar.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/rings/number_field/number_field.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/rings/number_field/number_field_element.pyx # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/rings/polynomial/complex_roots.py # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/rings/polynomial/polynomial_element.pyx # 1 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/gal_reps.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/heegner.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # Killed/crashed\n\tsage -t  --long -force_lib devel/sage/sage/modular/modform/element.py # Time out\n\tsage -t  --long -force_lib devel/sage/sage/tests/book_stein_modform.py # 2 doctests failed\n```",
    "created_at": "2013-01-27T10:37:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130790",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:172" align="right">comment:172</div>

Replying to [@roed314](#comment%3A171):
> It built for me on 10.6.8 and all tests passed.

That's totally wierd.  I doesn't work on any OS X buildbot machine (there are 3 of them).

> What kind of errors should I be looking for?


```
The following tests failed:

	sage -t  --long -force_lib devel/sage/doc/de/tutorial/tour_advanced.rst # 1 doctests failed
	sage -t  --long -force_lib devel/sage/doc/en/constructions/modular_forms.rst # 1 doctests failed
	sage -t  --long -force_lib devel/sage/doc/en/bordeaux_2008/birds_other.rst # 1 doctests failed
	sage -t  --long -force_lib devel/sage/doc/en/tutorial/tour_advanced.rst # 1 doctests failed
	sage -t  --long -force_lib devel/sage/doc/fr/tutorial/tour_advanced.rst # 1 doctests failed
	sage -t  --long -force_lib devel/sage/doc/ru/tutorial/tour_advanced.rst # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/matrix/matrix_modn_dense_template.pxi # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/matrix/matrix2.pyx # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modular/buzzard.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modular/abvar/abvar.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/abvar/torsion_subgroup.py # 4 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/ambient.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/eis_series.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/constructor.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/find_generators.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/hecke_operator_on_qexp.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/vm_basis.py # 2 doctests failed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/space.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/modsym/ambient.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/modsym/subspace.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/overconvergent/genus0.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/overconvergent/hecke_series.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/rings/qqbar.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/rings/number_field/number_field.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/rings/number_field/number_field_element.pyx # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/rings/polynomial/complex_roots.py # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/rings/polynomial/polynomial_element.pyx # 1 doctests failed
	sage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/gal_reps.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/heegner.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py # Killed/crashed
	sage -t  --long -force_lib devel/sage/sage/modular/modform/element.py # Time out
	sage -t  --long -force_lib devel/sage/sage/tests/book_stein_modform.py # 2 doctests failed
```



---

archive/issue_comments_130791.json:
```json
{
    "body": "<div id=\"comment:173\" align=\"right\">comment:173</div>\n\nThe first patch to the library doesn't apply properly over 5.7.beta0. Looking into it but I hope it won't need more changes for beta1.",
    "created_at": "2013-01-27T23:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130791",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:173" align="right">comment:173</div>

The first patch to the library doesn't apply properly over 5.7.beta0. Looking into it but I hope it won't need more changes for beta1.



---

archive/issue_comments_130792.json:
```json
{
    "body": "<div id=\"comment:174\" align=\"right\">comment:174</div>\n\nAll tests passed on top of 5.6.rc0 (which I had handy) on an iMAC core2 duo running 10.5.8. No clues what could go wrong on the build bots. This build used the gcc shipped with this particular version of sage.",
    "created_at": "2013-01-28T02:42:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130792",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:174" align="right">comment:174</div>

All tests passed on top of 5.6.rc0 (which I had handy) on an iMAC core2 duo running 10.5.8. No clues what could go wrong on the build bots. This build used the gcc shipped with this particular version of sage.



---

archive/issue_comments_130793.json:
```json
{
    "body": "<div id=\"comment:175\" align=\"right\">comment:175</div>\n\nReplying to [@kiwifb](#comment%3A174):\n> All tests passed on top of 5.6.rc0 (which I had handy) on an iMAC core2 duo running 10.5.8. No clues what could go wrong on the build bots.\n\nPerhaps you just have a lucky version? I could very well be that versions >= 10.6 have a problem and versions <= 10.4 a different problem.\n\n> This build used the gcc shipped with this particular version of sage. \n\nThe buildbot machines also.",
    "created_at": "2013-01-28T07:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130793",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:175" align="right">comment:175</div>

Replying to [@kiwifb](#comment%3A174):
> All tests passed on top of 5.6.rc0 (which I had handy) on an iMAC core2 duo running 10.5.8. No clues what could go wrong on the build bots.

Perhaps you just have a lucky version? I could very well be that versions >= 10.6 have a problem and versions <= 10.4 a different problem.

> This build used the gcc shipped with this particular version of sage. 

The buildbot machines also.



---

archive/issue_comments_130794.json:
```json
{
    "body": "<div id=\"comment:176\" align=\"right\">comment:176</div>\n\nBut I'm having no trouble with 10.6.8.  What version of OS X are the buildbot machines running?",
    "created_at": "2013-01-28T07:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130794",
    "user": "https://github.com/roed314"
}
```

<div id="comment:176" align="right">comment:176</div>

But I'm having no trouble with 10.6.8.  What version of OS X are the buildbot machines running?



---

archive/issue_comments_130795.json:
```json
{
    "body": "<div id=\"comment:177\" align=\"right\">comment:177</div>\n\nMay be the order things are done matters. I had a plain 5.6.rc0 on which I applied the patches. Then I updated flint. Finally I did sage -ba.\n\nI assume the buildbots never built flint-1.5 and used a prepatched sage-root and sage spkg. I cannot prepare this particular test before tomorrow.\n\nI actually cannot access my iMac before tomorrow (it's shutdown down and someone is borrowing it for video conferencing) but I am wondering if my build and David's still have an old dylib of the previous flint. The way flint is upgraded probably don't remove everything of flint 1.5/ It merely overwrite the common files and leave the other in place. If there is a versionned libflint-1.5.dylib it probably is still there.\n\nCould you try to find if there are still bits of flint 1.5 on your install and remove them David?",
    "created_at": "2013-01-28T08:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130795",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:177" align="right">comment:177</div>

May be the order things are done matters. I had a plain 5.6.rc0 on which I applied the patches. Then I updated flint. Finally I did sage -ba.

I assume the buildbots never built flint-1.5 and used a prepatched sage-root and sage spkg. I cannot prepare this particular test before tomorrow.

I actually cannot access my iMac before tomorrow (it's shutdown down and someone is borrowing it for video conferencing) but I am wondering if my build and David's still have an old dylib of the previous flint. The way flint is upgraded probably don't remove everything of flint 1.5/ It merely overwrite the common files and leave the other in place. If there is a versionned libflint-1.5.dylib it probably is still there.

Could you try to find if there are still bits of flint 1.5 on your install and remove them David?



---

archive/issue_comments_130796.json:
```json
{
    "body": "<div id=\"comment:178\" align=\"right\">comment:178</div>\n\nThe buildbots always do a complete install from source, so there was never a FLINT-1.5 with the buildbot tests.  The OS X buildbots are 10.4 PCC, 10.6 x86_64, 10.8 x86_64.",
    "created_at": "2013-01-28T08:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130796",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:178" align="right">comment:178</div>

The buildbots always do a complete install from source, so there was never a FLINT-1.5 with the buildbot tests.  The OS X buildbots are 10.4 PCC, 10.6 x86_64, 10.8 x86_64.



---

archive/issue_comments_130797.json:
```json
{
    "body": "<div id=\"comment:179\" align=\"right\">comment:179</div>\n\nOK my iMAC is 10.5 \"x86_32\" that may be part of it.",
    "created_at": "2013-01-28T08:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130797",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:179" align="right">comment:179</div>

OK my iMAC is 10.5 "x86_32" that may be part of it.



---

archive/issue_comments_130798.json:
```json
{
    "body": "Rebased on top of 5.7.beta1",
    "created_at": "2013-01-29T13:54:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130798",
    "user": "https://github.com/jpflori"
}
```

Rebased on top of 5.7.beta1



---

archive/issue_comments_130799.json:
```json
{
    "body": "<div id=\"comment:180\" align=\"right\">comment:180</div>\n\nAttachment: **[flint-2.3-combined-5.7.b1.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.7.b1.patch.gz)**",
    "created_at": "2013-01-29T13:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130799",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:180" align="right">comment:180</div>

Attachment: **[flint-2.3-combined-5.7.b1.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.7.b1.patch.gz)**



---

archive/issue_comments_130800.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)\n \n **Apply**:\n-* [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)\n+* [attachment: flint-2.3-combined-5.7.b1.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.7.b1.patch.gz)\n * [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)\n \n **Apply** to SAGE_ROOT:\n``````\n",
    "created_at": "2013-01-29T13:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130800",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)
 
 **Apply**:
-* [attachment: flint-2.3-combined-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.6.b3.patch.gz)
+* [attachment: flint-2.3-combined-5.7.b1.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.7.b1.patch.gz)
 * [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)
 
 **Apply** to SAGE_ROOT:
``````




---

archive/issue_comments_130801.json:
```json
{
    "body": "<div id=\"comment:181\" align=\"right\">comment:181</div>\n\nRebased patch on top of 5.7.beta1",
    "created_at": "2013-01-29T13:55:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130801",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:181" align="right">comment:181</div>

Rebased patch on top of 5.7.beta1



---

archive/issue_comments_130802.json:
```json
{
    "body": "<div id=\"comment:182\" align=\"right\">comment:182</div>\n\nReplying to [@kiwifb](#comment%3A177):\n> May be the order things are done matters. I had a plain 5.6.rc0 on which I applied the patches. Then I updated flint. Finally I did sage -ba.\n\nI started with a freshly built 5.6, installed the spkg and patches and then did sage -b.\n\n> The way flint is upgraded probably don't remove everything of flint 1.5/ It merely overwrite the common files and leave the other in place. If there is a versionned libflint-1.5.dylib it probably is still there.\n\nI ran \"find $SAGE_ROOT -name *flint* -print,\" and the only versioned files I found were\n\n```\n./spkg/installed/flint-1.5.2.p2\n./spkg/installed/flint-2.3\n./spkg/logs/flint-1.5.2.p2.log\n./spkg/logs/flint-2.3.log\n./spkg/optional/flint-2.3.spkg\n./spkg/standard/flint-1.5.2.p2.spkg\n```\n\nThe .a, .o, .so and .dylib files were all unversioned:\n\n```\n./devel/sage-main/build/temp.macosx-10.6-x86_64-2.7/sage/libs/flint/flint.o\n./local/lib/libflint.a\n./local/lib/libflint.dylib\n```\n\n> Could you try to find if there are still bits of flint 1.5 on your install and remove them David?\n\nAre there any of the above that actually matter removing?",
    "created_at": "2013-01-29T15:36:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130802",
    "user": "https://github.com/roed314"
}
```

<div id="comment:182" align="right">comment:182</div>

Replying to [@kiwifb](#comment%3A177):
> May be the order things are done matters. I had a plain 5.6.rc0 on which I applied the patches. Then I updated flint. Finally I did sage -ba.

I started with a freshly built 5.6, installed the spkg and patches and then did sage -b.

> The way flint is upgraded probably don't remove everything of flint 1.5/ It merely overwrite the common files and leave the other in place. If there is a versionned libflint-1.5.dylib it probably is still there.

I ran "find $SAGE_ROOT -name *flint* -print," and the only versioned files I found were

```
./spkg/installed/flint-1.5.2.p2
./spkg/installed/flint-2.3
./spkg/logs/flint-1.5.2.p2.log
./spkg/logs/flint-2.3.log
./spkg/optional/flint-2.3.spkg
./spkg/standard/flint-1.5.2.p2.spkg
```

The .a, .o, .so and .dylib files were all unversioned:

```
./devel/sage-main/build/temp.macosx-10.6-x86_64-2.7/sage/libs/flint/flint.o
./local/lib/libflint.a
./local/lib/libflint.dylib
```

> Could you try to find if there are still bits of flint 1.5 on your install and remove them David?

Are there any of the above that actually matter removing?



---

archive/issue_comments_130803.json:
```json
{
    "body": "<div id=\"comment:183\" align=\"right\">comment:183</div>\n\nReplying to [@roed314](#comment%3A182):\n> Replying to [@kiwifb](#comment%3A177):\n> > May be the order things are done matters. I had a plain 5.6.rc0 on which I applied the patches. Then I updated flint. Finally I did sage -ba.\n\n> \n> I started with a freshly built 5.6, installed the spkg and patches and then did sage -b.\n> \n> > The way flint is upgraded probably don't remove everything of flint 1.5/ It merely overwrite the common files and leave the other in place. If there is a versionned libflint-1.5.dylib it probably is still there.\n\n> \n> I ran \"find $SAGE_ROOT -name *flint* -print,\" and the only versioned files I found were\n> \n> ```\n> ./spkg/installed/flint-1.5.2.p2\n> ./spkg/installed/flint-2.3\n> ./spkg/logs/flint-1.5.2.p2.log\n> ./spkg/logs/flint-2.3.log\n> ./spkg/optional/flint-2.3.spkg\n> ./spkg/standard/flint-1.5.2.p2.spkg\n> ```\n> \n> The .a, .o, .so and .dylib files were all unversioned:\n> \n> ```\n> ./devel/sage-main/build/temp.macosx-10.6-x86_64-2.7/sage/libs/flint/flint.o\n> ./local/lib/libflint.a\n> ./local/lib/libflint.dylib\n> ```\n> \n> > Could you try to find if there are still bits of flint 1.5 on your install and remove them David?\n\n> \n> Are there any of the above that actually matter removing?\n\nIt was an idea that I had but it turns out flint is indeed unversioned and the spkg tries to clean previous install before putting the new libs. So that's a dead end. No need to remove anything. I am trying with a build including flint 2.3 from scratch.",
    "created_at": "2013-01-29T17:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130803",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:183" align="right">comment:183</div>

Replying to [@roed314](#comment%3A182):
> Replying to [@kiwifb](#comment%3A177):
> > May be the order things are done matters. I had a plain 5.6.rc0 on which I applied the patches. Then I updated flint. Finally I did sage -ba.

> 
> I started with a freshly built 5.6, installed the spkg and patches and then did sage -b.
> 
> > The way flint is upgraded probably don't remove everything of flint 1.5/ It merely overwrite the common files and leave the other in place. If there is a versionned libflint-1.5.dylib it probably is still there.

> 
> I ran "find $SAGE_ROOT -name *flint* -print," and the only versioned files I found were
> 
> ```
> ./spkg/installed/flint-1.5.2.p2
> ./spkg/installed/flint-2.3
> ./spkg/logs/flint-1.5.2.p2.log
> ./spkg/logs/flint-2.3.log
> ./spkg/optional/flint-2.3.spkg
> ./spkg/standard/flint-1.5.2.p2.spkg
> ```
> 
> The .a, .o, .so and .dylib files were all unversioned:
> 
> ```
> ./devel/sage-main/build/temp.macosx-10.6-x86_64-2.7/sage/libs/flint/flint.o
> ./local/lib/libflint.a
> ./local/lib/libflint.dylib
> ```
> 
> > Could you try to find if there are still bits of flint 1.5 on your install and remove them David?

> 
> Are there any of the above that actually matter removing?

It was an idea that I had but it turns out flint is indeed unversioned and the spkg tries to clean previous install before putting the new libs. So that's a dead end. No need to remove anything. I am trying with a build including flint 2.3 from scratch.



---

archive/issue_comments_130804.json:
```json
{
    "body": "<div id=\"comment:184\" align=\"right\">comment:184</div>\n\nThe build from scratch didn't behave any differently on my system, all tests pass. So is flint making weird assumptions about OS X on ppc and x86_64?",
    "created_at": "2013-01-31T00:24:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130804",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:184" align="right">comment:184</div>

The build from scratch didn't behave any differently on my system, all tests pass. So is flint making weird assumptions about OS X on ppc and x86_64?



---

archive/issue_comments_130805.json:
```json
{
    "body": "<div id=\"comment:185\" align=\"right\">comment:185</div>\n\nFlint has some inline assembly for x86, x86_64, arm and itanium, but nothing for ppc. You could try editing longlong.h to fall back to the generic code and see if that changes anything on x86_64.\n\nThe only way to get to the bottom of this is probably to take one of the failing tests and isolate the point in the code where results start to differ from a passing system...",
    "created_at": "2013-01-31T08:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130805",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:185" align="right">comment:185</div>

Flint has some inline assembly for x86, x86_64, arm and itanium, but nothing for ppc. You could try editing longlong.h to fall back to the generic code and see if that changes anything on x86_64.

The only way to get to the bottom of this is probably to take one of the failing tests and isolate the point in the code where results start to differ from a passing system...



---

archive/issue_comments_130806.json:
```json
{
    "body": "<div id=\"comment:186\" align=\"right\">comment:186</div>\n\nI could put my hand on a Mac OS X 10.7 where the problems occur.\n\nAt least one of the really worrying things is as follow:\n* converting an integer coefficients poly to a rational coeffs one kill all coeffs after any coeff whose size is larger than 64.stg bits.\n* but they are not really killed as the poly is still aware of it degree and you can still test equality of the original int poly with the new rat poly and get True.\nThat's the problem behind all the factor() calls giving stupid results (and maybe other failing doctests).\n\nThere seems to be a problem in the call to fmpq_poly_set_fmpz_poly in polynomial_rational_flint.pyx at line 257.",
    "created_at": "2013-03-05T17:15:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130806",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:186" align="right">comment:186</div>

I could put my hand on a Mac OS X 10.7 where the problems occur.

At least one of the really worrying things is as follow:
* converting an integer coefficients poly to a rational coeffs one kill all coeffs after any coeff whose size is larger than 64.stg bits.
* but they are not really killed as the poly is still aware of it degree and you can still test equality of the original int poly with the new rat poly and get True.
That's the problem behind all the factor() calls giving stupid results (and maybe other failing doctests).

There seems to be a problem in the call to fmpq_poly_set_fmpz_poly in polynomial_rational_flint.pyx at line 257.



---

archive/issue_comments_130807.json:
```json
{
    "body": "<div id=\"comment:187\" align=\"right\">comment:187</div>\n\nIt's quite funny, if I call fmpz_poly_print before entering fmpq_poly_set_fmpz_poly then its ok, but inside I get 0s instead of the right MPZ values (for things not stored directly).\nAnd when outside again, its ok.\n\nAnd if I first create an fmpq_poly with small coeffs and then multipliy it and convert it to int coeffs and convert it back to rat coeffs its ok...",
    "created_at": "2013-03-05T18:41:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130807",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:187" align="right">comment:187</div>

It's quite funny, if I call fmpz_poly_print before entering fmpq_poly_set_fmpz_poly then its ok, but inside I get 0s instead of the right MPZ values (for things not stored directly).
And when outside again, its ok.

And if I first create an fmpq_poly with small coeffs and then multipliy it and convert it to int coeffs and convert it back to rat coeffs its ok...



---

archive/issue_comments_130808.json:
```json
{
    "body": "<div id=\"comment:188\" align=\"right\">comment:188</div>\n\nThanks a bunch for looking at this, jp.\n\nIt sounds really bizarre. Just from looking at the code, I see no reason that it should fail.\n\nWhat happens if you manually print the actual values of the fmpzs (as longs) in both the input fmpz_poly and the output fmpq_poly, and what does the output show?\n\nDoes reentrant mode help?",
    "created_at": "2013-03-05T18:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130808",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:188" align="right">comment:188</div>

Thanks a bunch for looking at this, jp.

It sounds really bizarre. Just from looking at the code, I see no reason that it should fail.

What happens if you manually print the actual values of the fmpzs (as longs) in both the input fmpz_poly and the output fmpq_poly, and what does the output show?

Does reentrant mode help?



---

archive/issue_comments_130809.json:
```json
{
    "body": "<div id=\"comment:189\" align=\"right\">comment:189</div>\n\nReplying to [@fredrik-johansson](#comment%3A188):\n> What happens if you manually print the actual values of the fmpzs (as longs) in both the input fmpz_poly and the output fmpq_poly, and what does the output show?\n\nInside fmpq_set_fmpz_poly, printing each (in fact Ive tried to bedug only the case a*x where a is either 1 or huge so \"each\" is \"the two\") fmpz independently using fmpz_print(op->coeffs+i) or through fmpz_print_poly gives the same result: I get 0 for what are actually mpz_t rather than (tweaked) longs (IIRC I don't have access to the Mac right now) which at least is consistent.\nWhat disturbing is that calling COEFF_IS_MPZ gives the correct answer inside the function call (i.e. 1 for the x coefficient when a is huge, although 0 is printed, and 0 for the constant coefficient which is 0).\n\nI've checked the value of x._ _poly/ op is the same outside and inside the function call, and the address op->coeffs inside the function call looks fine.\n> \n> Does reentrant mode help?\n\nI'll try that tomorrow.\n\nFYI I tried using the fallback routines in longlong.h and that did not solve the problem.",
    "created_at": "2013-03-05T21:17:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130809",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:189" align="right">comment:189</div>

Replying to [@fredrik-johansson](#comment%3A188):
> What happens if you manually print the actual values of the fmpzs (as longs) in both the input fmpz_poly and the output fmpq_poly, and what does the output show?

Inside fmpq_set_fmpz_poly, printing each (in fact Ive tried to bedug only the case a*x where a is either 1 or huge so "each" is "the two") fmpz independently using fmpz_print(op->coeffs+i) or through fmpz_print_poly gives the same result: I get 0 for what are actually mpz_t rather than (tweaked) longs (IIRC I don't have access to the Mac right now) which at least is consistent.
What disturbing is that calling COEFF_IS_MPZ gives the correct answer inside the function call (i.e. 1 for the x coefficient when a is huge, although 0 is printed, and 0 for the constant coefficient which is 0).

I've checked the value of x._ _poly/ op is the same outside and inside the function call, and the address op->coeffs inside the function call looks fine.
> 
> Does reentrant mode help?

I'll try that tomorrow.

FYI I tried using the fallback routines in longlong.h and that did not solve the problem.



---

archive/issue_comments_130810.json:
```json
{
    "body": "<div id=\"comment:190\" align=\"right\">comment:190</div>\n\nI was wondering what would show if you print them with printf(\"%ld\", poly[i])",
    "created_at": "2013-03-05T21:25:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130810",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:190" align="right">comment:190</div>

I was wondering what would show if you print them with printf("%ld", poly[i])



---

archive/issue_comments_130811.json:
```json
{
    "body": "<div id=\"comment:191\" align=\"right\">comment:191</div>\n\nUsing a reentrant version did not solve the problem...\nReplying to [@fredrik-johansson](#comment%3A190):\n> I was wondering what would show if you print them with printf(\"%ld\", poly[i])\n\nI modified FLINT as follow:\n* in fmpz_poly.h:\n\n```\nstatic __inline__\nint fmpz_poly_print(const fmpz_poly_t poly)\n{\n  int i = 0;\n\tfor (; i < fmpz_poly_length(poly); i++)\n\t{\n\t    printf(\"exp: %d \", i);\n\t    printf(\"MPZ: %d \", (COEFF_IS_MPZ(*(poly->coeffs+i)))?1:0);\n\t    printf(\"addr: %lX \", (unsigned long) poly->coeffs+i);\n\t    printf(\"val: %ld \", *(poly->coeffs+i));\n\t    printf(\"val: %lX \", *(poly->coeffs+i));\n\t    printf(\"fmpz: \");\n            fmpz_print(poly->coeffs+i);\n\t    printf(\" !! \");\n\t}\n\tprintf(\"\\n\");\n    return fmpz_poly_fprint(stdout, poly);\n}\n```\n* in fmpq_poly/set_fmpz_poly.c:\n\n```\nvoid fmpq_poly_set_fmpz_poly(fmpq_poly_t rop, const fmpz_poly_t op)\n{\n    if (fmpz_poly_is_zero(op))\n    {\n        fmpq_poly_zero(rop);\n    }\n    else\n    {\n        int i = 0;\n        fmpz_poly_print(op);\n        printf(\"\\n\");\n        fmpq_poly_fit_length(rop, fmpz_poly_length(op));\n        fmpz_poly_print(op);\n        printf(\"\\n\");\n        _fmpq_poly_set_length(rop, fmpz_poly_length(op));\n\tprintf(\"length = %ld\\n\", fmpz_poly_length(op));\n\tprintf(\"id = %lX\\n\", (unsigned long)op);\n\tfmpz_poly_print(op);\n\tprintf(\"\\n\");\n\tfor (; i < fmpz_poly_length(op); i++)\n\t{\n\t    printf(\"exp: %d \", i);\n\t    printf(\"MPZ: %d \", (COEFF_IS_MPZ(*(op->coeffs+i)))?1:0);\n\t    printf(\"addr: %lX \", (unsigned long) op->coeffs+i);\n\t    printf(\"val: %ld \", *(op->coeffs+i));\n\t    printf(\"val: %lX \", *(op->coeffs+i));\n\t    printf(\"fmpz: \");\n            fmpz_print(op->coeffs+i);\n\t    printf(\" !! \");\n\t}\n\tprintf(\"\\n\");\n        _fmpz_vec_set(rop->coeffs, op->coeffs, rop->length);\n        fmpz_one(rop->den);\n    }\n}\n```\n\nIn Sage:\n* in polynomial_integer_dense_flint.pyx:\n\n```\n    def jprint(self):\n        fmpz_poly_print(self.__poly)\n```\n* in polynomial_rational_flint.pyx\n\n```\n        elif PY_TYPE_CHECK(x, Polynomial_integer_dense_flint):\n            print hex(<long>((<Polynomial_integer_dense_flint>x).__poly))\n            printf(\"%X\\n\",(<Polynomial_integer_dense_flint>x).__poly)\n            print x\n            x.jprint()\n            print \"\"\n            (<Polynomial_integer_dense_flint>x).jprint()\n            print \"\"\n            fmpq_poly_set_fmpz_poly(self.__poly, (<Polynomial_integer_dense_flint>x).__poly)\n```\n\nHere is some data after modifying Sage and FLINT:\n\n```\nsage: a = 2**61\nsage: b = 2**62\nsage: c = 2**63\nsage: R.<x> = ZZ[]\nsage: f = R([1,2,3,a,b,c,3,2,1])\nsage: f.change_ring(QQ)\n0x1152447d0\n152447D0\nx^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\nexp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nexp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nexp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nexp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nlength = 9\nid = 1152447D0\nexp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nexp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! \nx^8 + 2*x^7 + 3*x^6 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\n```",
    "created_at": "2013-03-06T10:32:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130811",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:191" align="right">comment:191</div>

Using a reentrant version did not solve the problem...
Replying to [@fredrik-johansson](#comment%3A190):
> I was wondering what would show if you print them with printf("%ld", poly[i])

I modified FLINT as follow:
* in fmpz_poly.h:

```
static __inline__
int fmpz_poly_print(const fmpz_poly_t poly)
{
  int i = 0;
	for (; i < fmpz_poly_length(poly); i++)
	{
	    printf("exp: %d ", i);
	    printf("MPZ: %d ", (COEFF_IS_MPZ(*(poly->coeffs+i)))?1:0);
	    printf("addr: %lX ", (unsigned long) poly->coeffs+i);
	    printf("val: %ld ", *(poly->coeffs+i));
	    printf("val: %lX ", *(poly->coeffs+i));
	    printf("fmpz: ");
            fmpz_print(poly->coeffs+i);
	    printf(" !! ");
	}
	printf("\n");
    return fmpz_poly_fprint(stdout, poly);
}
```
* in fmpq_poly/set_fmpz_poly.c:

```
void fmpq_poly_set_fmpz_poly(fmpq_poly_t rop, const fmpz_poly_t op)
{
    if (fmpz_poly_is_zero(op))
    {
        fmpq_poly_zero(rop);
    }
    else
    {
        int i = 0;
        fmpz_poly_print(op);
        printf("\n");
        fmpq_poly_fit_length(rop, fmpz_poly_length(op));
        fmpz_poly_print(op);
        printf("\n");
        _fmpq_poly_set_length(rop, fmpz_poly_length(op));
	printf("length = %ld\n", fmpz_poly_length(op));
	printf("id = %lX\n", (unsigned long)op);
	fmpz_poly_print(op);
	printf("\n");
	for (; i < fmpz_poly_length(op); i++)
	{
	    printf("exp: %d ", i);
	    printf("MPZ: %d ", (COEFF_IS_MPZ(*(op->coeffs+i)))?1:0);
	    printf("addr: %lX ", (unsigned long) op->coeffs+i);
	    printf("val: %ld ", *(op->coeffs+i));
	    printf("val: %lX ", *(op->coeffs+i));
	    printf("fmpz: ");
            fmpz_print(op->coeffs+i);
	    printf(" !! ");
	}
	printf("\n");
        _fmpz_vec_set(rop->coeffs, op->coeffs, rop->length);
        fmpz_one(rop->den);
    }
}
```

In Sage:
* in polynomial_integer_dense_flint.pyx:

```
    def jprint(self):
        fmpz_poly_print(self.__poly)
```
* in polynomial_rational_flint.pyx

```
        elif PY_TYPE_CHECK(x, Polynomial_integer_dense_flint):
            print hex(<long>((<Polynomial_integer_dense_flint>x).__poly))
            printf("%X\n",(<Polynomial_integer_dense_flint>x).__poly)
            print x
            x.jprint()
            print ""
            (<Polynomial_integer_dense_flint>x).jprint()
            print ""
            fmpq_poly_set_fmpz_poly(self.__poly, (<Polynomial_integer_dense_flint>x).__poly)
```

Here is some data after modifying Sage and FLINT:

```
sage: a = 2**61
sage: b = 2**62
sage: c = 2**63
sage: R.<x> = ZZ[]
sage: f = R([1,2,3,a,b,c,3,2,1])
sage: f.change_ring(QQ)
0x1152447d0
152447D0
x^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
exp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
exp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
exp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
exp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
length = 9
id = 1152447D0
exp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
exp: 0 MPZ: 0 addr: 7FE1D1919410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FE1D1919411 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FE1D1919412 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FE1D1919413 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FE1D1919414 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FE1D1919415 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FE1D1919416 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FE1D1919417 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FE1D1919418 val: 1 val: 1 fmpz: 1 !! 
x^8 + 2*x^7 + 3*x^6 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
```



---

archive/issue_comments_130812.json:
```json
{
    "body": "<div id=\"comment:192\" align=\"right\">comment:192</div>\n\nIf I'm reading this right, it prints the fmpz_poly four times before even entering fmpq_poly, and it's wrong the third time, that is, when calling (<Polynomial_integer_dense_flint>x).jprint()?\n\nBut the fmpz coefficients are the same, so it is (seemingly) the entries in flint's global mpz array that are being zeroed when they shouldn't.\n\nIt smells a lot like one of the bugs we've had in the past with the non-reentrant mode, i.e., somewhere, some code loads an mpz pointer, and hangs on to it while the mpz array gets resized. It could potentially be triggered by a compiler bug which, say, makes it overlook constness somewhere.\n\nYou might be able to track down exactly where the mpz gets zeroed (say, by saving the pointer somewhere, and printing it in various places). Or, since the fmpz just encodes an index into the mpz array, you could perhaps edit the COEFF_TO_PTR macro to print the index, and find out the places where the particular indices of the mpzs in the coefficients of this polynomial are being accessed. It might also help to print where mpz array is being resized.",
    "created_at": "2013-03-06T11:14:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130812",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:192" align="right">comment:192</div>

If I'm reading this right, it prints the fmpz_poly four times before even entering fmpq_poly, and it's wrong the third time, that is, when calling (<Polynomial_integer_dense_flint>x).jprint()?

But the fmpz coefficients are the same, so it is (seemingly) the entries in flint's global mpz array that are being zeroed when they shouldn't.

It smells a lot like one of the bugs we've had in the past with the non-reentrant mode, i.e., somewhere, some code loads an mpz pointer, and hangs on to it while the mpz array gets resized. It could potentially be triggered by a compiler bug which, say, makes it overlook constness somewhere.

You might be able to track down exactly where the mpz gets zeroed (say, by saving the pointer somewhere, and printing it in various places). Or, since the fmpz just encodes an index into the mpz array, you could perhaps edit the COEFF_TO_PTR macro to print the index, and find out the places where the particular indices of the mpzs in the coefficients of this polynomial are being accessed. It might also help to print where mpz array is being resized.



---

archive/issue_comments_130813.json:
```json
{
    "body": "<div id=\"comment:193\" align=\"right\">comment:193</div>\n\nReplying to [@fredrik-johansson](#comment%3A192):\n> If I'm reading this right, it prints the fmpz_poly four times before even entering fmpq_poly, and it's wrong the third time, that is, when calling (<Polynomial_integer_dense_flint>x).jprint()?\n> \n\nNope, the first wrong printing is the the first one inside fmpq_set_fmpz_poly.\nThe first \"print x\" command at the Sage level corresponds to \"x^8 + 2*x^7 + 3*x^6 + 92233...\".\n\n> But the fmpz coefficients are the same, so it is (seemingly) the entries in flint's global mpz array that are being zeroed when they shouldn't.\n\nI'm not sure they really get zeroed.\nOk it sounds fishy, but I'm able to print again f correctly after having done f.change_ring(QQ)...\n\nI'll give the same piece of code a shot on Linux to see if anything looks different but I doubt it, then I'll try to watch the addresses with gdb.",
    "created_at": "2013-03-06T12:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130813",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:193" align="right">comment:193</div>

Replying to [@fredrik-johansson](#comment%3A192):
> If I'm reading this right, it prints the fmpz_poly four times before even entering fmpq_poly, and it's wrong the third time, that is, when calling (<Polynomial_integer_dense_flint>x).jprint()?
> 

Nope, the first wrong printing is the the first one inside fmpq_set_fmpz_poly.
The first "print x" command at the Sage level corresponds to "x^8 + 2*x^7 + 3*x^6 + 92233...".

> But the fmpz coefficients are the same, so it is (seemingly) the entries in flint's global mpz array that are being zeroed when they shouldn't.

I'm not sure they really get zeroed.
Ok it sounds fishy, but I'm able to print again f correctly after having done f.change_ring(QQ)...

I'll give the same piece of code a shot on Linux to see if anything looks different but I doubt it, then I'll try to watch the addresses with gdb.



---

archive/issue_comments_130814.json:
```json
{
    "body": "<div id=\"comment:194\" align=\"right\">comment:194</div>\n\nReplying to [@jpflori](#comment%3A191):\nThis line\n> \n> ```\n> void fmpq_poly_set_fmpz_poly(fmpq_poly_t rop, const fmpz_poly_t op)\n> {\n>           ....\n> \t    printf(\"addr: %lX \", (unsigned long) op->coeffs+i);\n>           ....\n> ```\n\nwas supposed to be\n\n```\nvoid fmpq_poly_set_fmpz_poly(fmpq_poly_t rop, const fmpz_poly_t op)\n{\n          ....\n\t    printf(\"addr: %lX \", (unsigned long) (op->coeffs+i));\n          ....\n```\n\nThe additional one appearing sometimes there is strange:\n> \n> ```\n> 0x1152447d0\n> 152447D0\n> ...\n> id = 1152447D0\n> ```\n\nMaybe some casting problems?\n\nOn Linux, I get the same value the three times.",
    "created_at": "2013-03-06T12:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130814",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:194" align="right">comment:194</div>

Replying to [@jpflori](#comment%3A191):
This line
> 
> ```
> void fmpq_poly_set_fmpz_poly(fmpq_poly_t rop, const fmpz_poly_t op)
> {
>           ....
> 	    printf("addr: %lX ", (unsigned long) op->coeffs+i);
>           ....
> ```

was supposed to be

```
void fmpq_poly_set_fmpz_poly(fmpq_poly_t rop, const fmpz_poly_t op)
{
          ....
	    printf("addr: %lX ", (unsigned long) (op->coeffs+i));
          ....
```

The additional one appearing sometimes there is strange:
> 
> ```
> 0x1152447d0
> 152447D0
> ...
> id = 1152447D0
> ```

Maybe some casting problems?

On Linux, I get the same value the three times.



---

archive/issue_comments_130815.json:
```json
{
    "body": "<div id=\"comment:195\" align=\"right\">comment:195</div>\n\nMy bad, its just because I used %X and on the Mac, the address is more than 4 bytes.",
    "created_at": "2013-03-06T13:26:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130815",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:195" align="right">comment:195</div>

My bad, its just because I used %X and on the Mac, the address is more than 4 bytes.



---

archive/issue_comments_130816.json:
```json
{
    "body": "<div id=\"comment:196\" align=\"right\">comment:196</div>\n\nIt seems there have been some problems when updating FLINT, with a flint directory created, but a FLINT one somehow still there.\n\nI did not test reentrant mode correctly because there were multiple spaces before --reentrant and it was not parsed by FLINT configure.",
    "created_at": "2013-03-06T14:03:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130816",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:196" align="right">comment:196</div>

It seems there have been some problems when updating FLINT, with a flint directory created, but a FLINT one somehow still there.

I did not test reentrant mode correctly because there were multiple spaces before --reentrant and it was not parsed by FLINT configure.



---

archive/issue_comments_130817.json:
```json
{
    "body": "<div id=\"comment:197\" align=\"right\">comment:197</div>\n\nAnd with reentrant mode, the problem goes away:\n\n```\nsage: a = 2**61\nsage: b = 2**62\nsage: c = 2**63\nsage: R.<x> = ZZ[]\nsage: f = R([1,2,3,a,b,c,3,2,1])\nsage: f.change_ring(QQ)\n0x1118f67d0L\n1118F67D0\nx^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\nexp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nexp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nexp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nexp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nlength = 9\nid = 1118F67D0\nexp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nexp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! \nx^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\n```",
    "created_at": "2013-03-06T14:08:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130817",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:197" align="right">comment:197</div>

And with reentrant mode, the problem goes away:

```
sage: a = 2**61
sage: b = 2**62
sage: c = 2**63
sage: R.<x> = ZZ[]
sage: f = R([1,2,3,a,b,c,3,2,1])
sage: f.change_ring(QQ)
0x1118f67d0L
1118F67D0
x^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
exp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
exp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
exp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
exp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
length = 9
id = 1118F67D0
exp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
exp: 0 MPZ: 0 addr: 7FFA4B407410 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FFA4B407418 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FFA4B407420 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FFA4B407428 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FFA4B407430 val: 4611721196672653224 val: 40001FFE92D017A8 fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FFA4B407438 val: 4611721196672654616 val: 40001FFE92D01D18 fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FFA4B407440 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FFA4B407448 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FFA4B407450 val: 1 val: 1 fmpz: 1 !! 
x^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
```



---

archive/issue_comments_130818.json:
```json
{
    "body": "<div id=\"comment:198\" align=\"right\">comment:198</div>\n\nReplying to [@fredrik-johansson](#comment%3A192):\n> If I'm reading this right, it prints the fmpz_poly four times before even entering fmpq_poly, and it's wrong the third time, that is, when calling (<Polynomial_integer_dense_flint>x).jprint()?\n> \n> But the fmpz coefficients are the same, so it is (seemingly) the entries in flint's global mpz array that are being zeroed when they shouldn't.\n\nSo that must be it.\n> \n> It smells a lot like one of the bugs we've had in the past with the non-reentrant mode, i.e., somewhere, some code loads an mpz pointer, and hangs on to it while the mpz array gets resized. It could potentially be triggered by a compiler bug which, say, makes it overlook constness somewhere.\n> \n> You might be able to track down exactly where the mpz gets zeroed (say, by saving the pointer somewhere, and printing it in various places). Or, since the fmpz just encodes an index into the mpz array, you could perhaps edit the COEFF_TO_PTR macro to print the index, and find out the places where the particular indices of the mpzs in the coefficients of this polynomial are being accessed. It might also help to print where mpz array is being resized.\n\nI'll try this now.",
    "created_at": "2013-03-06T14:14:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130818",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:198" align="right">comment:198</div>

Replying to [@fredrik-johansson](#comment%3A192):
> If I'm reading this right, it prints the fmpz_poly four times before even entering fmpq_poly, and it's wrong the third time, that is, when calling (<Polynomial_integer_dense_flint>x).jprint()?
> 
> But the fmpz coefficients are the same, so it is (seemingly) the entries in flint's global mpz array that are being zeroed when they shouldn't.

So that must be it.
> 
> It smells a lot like one of the bugs we've had in the past with the non-reentrant mode, i.e., somewhere, some code loads an mpz pointer, and hangs on to it while the mpz array gets resized. It could potentially be triggered by a compiler bug which, say, makes it overlook constness somewhere.
> 
> You might be able to track down exactly where the mpz gets zeroed (say, by saving the pointer somewhere, and printing it in various places). Or, since the fmpz just encodes an index into the mpz array, you could perhaps edit the COEFF_TO_PTR macro to print the index, and find out the places where the particular indices of the mpzs in the coefficients of this polynomial are being accessed. It might also help to print where mpz array is being resized.

I'll try this now.



---

archive/issue_comments_130819.json:
```json
{
    "body": "<div id=\"comment:199\" align=\"right\">comment:199</div>\n\nI does not seem the global array gets resized.\nIve put some printf lines in the if(fmpz_allocated) part of _fmpz_new_mpz and ot does not get triggered.\n\nBut somehow the fmpz_arr value changes...\n\n```\n\nsage: f.change_ring(QQ)\n0x1170d57d0L\n1170D57D0\nx^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\nglobal array at 0x7FEB3C002A00\nexp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nglobal array at 0x7FEB3C002A00\nexp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nglobal array at 0x7FEB3BBCF200\nglobal array at 0x7FEB3BBCF200\nexp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nglobal array at 0x7FEB3BBCF200\nexp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nlength = 9\nid = 1170D57D0\nglobal array at 0x7FEB3BBCF200\nexp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nexp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! \nx^8 + 2*x^7 + 3*x^6 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\n```",
    "created_at": "2013-03-06T14:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130819",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:199" align="right">comment:199</div>

I does not seem the global array gets resized.
Ive put some printf lines in the if(fmpz_allocated) part of _fmpz_new_mpz and ot does not get triggered.

But somehow the fmpz_arr value changes...

```

sage: f.change_ring(QQ)
0x1170d57d0L
1170D57D0
x^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
global array at 0x7FEB3C002A00
exp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
global array at 0x7FEB3C002A00
exp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
global array at 0x7FEB3BBCF200
global array at 0x7FEB3BBCF200
exp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
global array at 0x7FEB3BBCF200
exp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
length = 9
id = 1170D57D0
global array at 0x7FEB3BBCF200
exp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
exp: 0 MPZ: 0 addr: 7FEB3B304C80 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FEB3B304C88 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FEB3B304C90 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FEB3B304C98 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FEB3B304CA0 val: 4611686018427387966 val: 400000000000003E fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FEB3B304CA8 val: 4611686018427387965 val: 400000000000003D fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FEB3B304CB0 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FEB3B304CB8 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FEB3B304CC0 val: 1 val: 1 fmpz: 1 !! 
x^8 + 2*x^7 + 3*x^6 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
```



---

archive/issue_comments_130820.json:
```json
{
    "body": "<div id=\"comment:200\" align=\"right\">comment:200</div>\n\nBut somehow it seems we get two global arrays:\n\n```\n\n**********************************************************************\n*                                                                    *\n* Warning: this is a prerelease version, and it may be unstable.     *\n*                                                                    *\n**********************************************************************\nAllocating fmpz_arr at 0x7FC702AC2600\nAllocating fmpz_unused_arr at 0x7FC704123480\nsage: a = 2**61\nsage: b = 2**62\nsage: c = 2**63\nsage: R.<x> = ZZ[]\nsage: f = R([1,2,3,a,b,c,3,2,1])\nAllocating fmpz_arr at 0x7FC703850000\nAllocating fmpz_unused_arr at 0x7FC702366530\nsage: f = R([1,2,3,a,b,c,3,2,1])\nsage: f.jprint()\nglobal array at 0x7FC703850000\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \n9  1 2f.change_ring(QQ)\n0x10dce0838L\n10DCE0838\nx^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\nglobal array at 0x7FC703850000\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nglobal array at 0x7FC703850000\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1\nglobal array at 0x7FC702AC2600\nglobal array at 0x7FC702AC2600\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nglobal array at 0x7FC702AC2600\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nlength = 9\nid = 10DCE0838\nglobal array at 0x7FC702AC2600\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \n9  1 2 3 2305843009213693952 0 0 3 2 1\nexp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! \nx^8 + 2*x^7 + 3*x^6 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1\nsage: \n```",
    "created_at": "2013-03-06T14:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130820",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:200" align="right">comment:200</div>

But somehow it seems we get two global arrays:

```

**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
Allocating fmpz_arr at 0x7FC702AC2600
Allocating fmpz_unused_arr at 0x7FC704123480
sage: a = 2**61
sage: b = 2**62
sage: c = 2**63
sage: R.<x> = ZZ[]
sage: f = R([1,2,3,a,b,c,3,2,1])
Allocating fmpz_arr at 0x7FC703850000
Allocating fmpz_unused_arr at 0x7FC702366530
sage: f = R([1,2,3,a,b,c,3,2,1])
sage: f.jprint()
global array at 0x7FC703850000
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
9  1 2f.change_ring(QQ)
0x10dce0838L
10DCE0838
x^8 + 2*x^7 + 3*x^6 + 9223372036854775808*x^5 + 4611686018427387904*x^4 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
global array at 0x7FC703850000
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
global array at 0x7FC703850000
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 4611686018427387904 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 9223372036854775808 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 4611686018427387904 9223372036854775808 3 2 1
global array at 0x7FC702AC2600
global array at 0x7FC702AC2600
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
global array at 0x7FC702AC2600
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
length = 9
id = 10DCE0838
global array at 0x7FC702AC2600
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
9  1 2 3 2305843009213693952 0 0 3 2 1
exp: 0 MPZ: 0 addr: 7FC7026D2530 val: 1 val: 1 fmpz: 1 !! exp: 1 MPZ: 0 addr: 7FC7026D2538 val: 2 val: 2 fmpz: 2 !! exp: 2 MPZ: 0 addr: 7FC7026D2540 val: 3 val: 3 fmpz: 3 !! exp: 3 MPZ: 0 addr: 7FC7026D2548 val: 2305843009213693952 val: 2000000000000000 fmpz: 2305843009213693952 !! exp: 4 MPZ: 1 addr: 7FC7026D2550 val: 4611686018427387964 val: 400000000000003C fmpz: 0 !! exp: 5 MPZ: 1 addr: 7FC7026D2558 val: 4611686018427387963 val: 400000000000003B fmpz: 0 !! exp: 6 MPZ: 0 addr: 7FC7026D2560 val: 3 val: 3 fmpz: 3 !! exp: 7 MPZ: 0 addr: 7FC7026D2568 val: 2 val: 2 fmpz: 2 !! exp: 8 MPZ: 0 addr: 7FC7026D2570 val: 1 val: 1 fmpz: 1 !! 
x^8 + 2*x^7 + 3*x^6 + 2305843009213693952*x^3 + 3*x^2 + 2*x + 1
sage: 
```



---

archive/issue_comments_130821.json:
```json
{
    "body": "<div id=\"comment:201\" align=\"right\">comment:201</div>\n\nThis is stranger than ever :-)\n\nIf you can figure out where the two arrays are coming from, it might just be the solution of the problem.\n\nIf nothing else works, perhaps we could just update flint to include the patch https://github.com/fredrik-johansson/flint2/commit/03487ed18f40f08cea7f5a71dcfd43cb6fd70115 but with the `__thread` prefixes removed. (If my own benchmarking was correct, this will even make flint faster, too.)",
    "created_at": "2013-03-06T16:22:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130821",
    "user": "https://github.com/fredrik-johansson"
}
```

<div id="comment:201" align="right">comment:201</div>

This is stranger than ever :-)

If you can figure out where the two arrays are coming from, it might just be the solution of the problem.

If nothing else works, perhaps we could just update flint to include the patch https://github.com/fredrik-johansson/flint2/commit/03487ed18f40f08cea7f5a71dcfd43cb6fd70115 but with the `__thread` prefixes removed. (If my own benchmarking was correct, this will even make flint faster, too.)



---

archive/issue_comments_130822.json:
```json
{
    "body": "<div id=\"comment:202\" align=\"right\">comment:202</div>\n\nThink I got it.\nSomething does not like the dylib64 extension so some parts of Sage where linked with the static libflint.a, but some others with libflint.dylib64.\n\nIve copied libflint.dylib64 to liblint.dylib, touched everything in sage/libs/flint and sage/rings/polynomial and rebuilt Sage and could not reproduce the error.\n\nAll of this is because of me...\nhttps://groups.google.com/d/msg/flint-devel/Vy0PlkeEgf8/TbpSDTZBgg8J\nSo keeping dylib64 extension from FLINT 1 series was not a good idea.",
    "created_at": "2013-03-06T17:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130822",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:202" align="right">comment:202</div>

Think I got it.
Something does not like the dylib64 extension so some parts of Sage where linked with the static libflint.a, but some others with libflint.dylib64.

Ive copied libflint.dylib64 to liblint.dylib, touched everything in sage/libs/flint and sage/rings/polynomial and rebuilt Sage and could not reproduce the error.

All of this is because of me...
https://groups.google.com/d/msg/flint-devel/Vy0PlkeEgf8/TbpSDTZBgg8J
So keeping dylib64 extension from FLINT 1 series was not a good idea.



---

archive/issue_comments_130823.json:
```json
{
    "body": "<div id=\"comment:203\" align=\"right\">comment:203</div>\n\nIn fact I think I got confused between the make target and the extension of the library in FLINT 1.\nSorry about that.",
    "created_at": "2013-03-06T17:16:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130823",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:203" align="right">comment:203</div>

In fact I think I got confused between the make target and the extension of the library in FLINT 1.
Sorry about that.



---

archive/issue_comments_130824.json:
```json
{
    "body": "<div id=\"comment:204\" align=\"right\">comment:204</div>\n\nUpdated spkg.\nPlease test.",
    "created_at": "2013-03-06T17:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130824",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:204" align="right">comment:204</div>

Updated spkg.
Please test.



---

archive/issue_events_163672.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-03-06T17:29:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163672"
}
```



---

archive/issue_events_163673.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-03-06T17:29:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163673"
}
```



---

archive/issue_comments_130825.json:
```json
{
    "body": "Changed work issues from **OS X** to none",
    "created_at": "2013-03-06T17:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130825",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **OS X** to none



---

archive/issue_comments_130826.json:
```json
{
    "body": "Attachment: **[dylib.diff.gz](https://github.com/sagemath/sage/files/ticket12173/dylib.diff.gz)**\n\nFix for darwin, spkg diff, only for review.",
    "created_at": "2013-03-06T17:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130826",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[dylib.diff.gz](https://github.com/sagemath/sage/files/ticket12173/dylib.diff.gz)**

Fix for darwin, spkg diff, only for review.



---

archive/issue_comments_130827.json:
```json
{
    "body": "Attachment: **[flint-2.3-library-5.8.b2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)**\n\nPatch for the Sage library.",
    "created_at": "2013-03-06T17:30:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130827",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-library-5.8.b2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)**

Patch for the Sage library.



---

archive/issue_comments_130828.json:
```json
{
    "body": "Attachment: **[flint-2.3-root-5.8.b2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz)**\n\nRoot patch",
    "created_at": "2013-03-06T17:30:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130828",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3-root-5.8.b2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz)**

Root patch



---

archive/issue_comments_130829.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,8 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)\n \n **Apply**:\n-* [attachment: flint-2.3-combined-5.7.b1.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.7.b1.patch.gz)\n-* [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)\n+* [attachment: flint-2.3-library-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)\n \n **Apply** to SAGE_ROOT:\n-* [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).\n+* [attachment: flint-2.3-root-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz).\n``````\n",
    "created_at": "2013-03-06T17:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130829",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,8 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)
 
 **Apply**:
-* [attachment: flint-2.3-combined-5.7.b1.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-combined-5.7.b1.patch.gz)
-* [attachment: 12173_fixes.patch](https://github.com/sagemath/sage/files/ticket12173/12173_fixes.patch.gz)
+* [attachment: flint-2.3-library-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)
 
 **Apply** to SAGE_ROOT:
-* [attachment: flint-2.3-root-5.6.b3.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.6.b3.patch.gz).
+* [attachment: flint-2.3-root-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz).
``````




---

archive/issue_comments_130830.json:
```json
{
    "body": "<div id=\"comment:205\" align=\"right\">comment:205</div>\n\nPatches corrected and rebased on top of 5.8.b2, hoping that b3 did not break them...",
    "created_at": "2013-03-06T17:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130830",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:205" align="right">comment:205</div>

Patches corrected and rebased on top of 5.8.b2, hoping that b3 did not break them...



---

archive/issue_comments_130831.json:
```json
{
    "body": "<div id=\"comment:206\" align=\"right\">comment:206</div>\n\nI've just reupped an spkg which actually apply the patch.",
    "created_at": "2013-03-06T17:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130831",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:206" align="right">comment:206</div>

I've just reupped an spkg which actually apply the patch.



---

archive/issue_comments_130832.json:
```json
{
    "body": "<div id=\"comment:207\" align=\"right\">comment:207</div>\n\nNow it's also clear why this problem affects only OS X systems.",
    "created_at": "2013-03-06T20:36:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130832",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:207" align="right">comment:207</div>

Now it's also clear why this problem affects only OS X systems.



---

archive/issue_comments_130833.json:
```json
{
    "body": "<div id=\"comment:208\" align=\"right\">comment:208</div>\n\nThis should be rebased on top of #14241 (expect for hg and SPKG.txt history this should be trivial).",
    "created_at": "2013-03-14T17:05:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130833",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:208" align="right">comment:208</div>

This should be rebased on top of #14241 (expect for hg and SPKG.txt history this should be trivial).



---

archive/issue_comments_130834.json:
```json
{
    "body": "<div id=\"comment:209\" align=\"right\">comment:209</div>\n\nAnd even on top of #14268",
    "created_at": "2013-03-14T17:05:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130834",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:209" align="right">comment:209</div>

And even on top of #14268



---

archive/issue_comments_130835.json:
```json
{
    "body": "<div id=\"comment:211\" align=\"right\">comment:211</div>\n\nSo, what needs to be done on this ticket?  Is it just the rebase?  It would be great to finally get this in Sage (#14304 depends on it for example).",
    "created_at": "2013-03-22T18:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130835",
    "user": "https://github.com/roed314"
}
```

<div id="comment:211" align="right">comment:211</div>

So, what needs to be done on this ticket?  Is it just the rebase?  It would be great to finally get this in Sage (#14304 depends on it for example).



---

archive/issue_comments_130836.json:
```json
{
    "body": "<div id=\"comment:212\" align=\"right\">comment:212</div>\n\nReplying to [@roed314](#comment%3A211):\n> So, what needs to be done on this ticket?  Is it just the rebase?  It would be great to finally get this in Sage (#14304 depends on it for example).\n\nI'd say it \"just\" needs review now that the crap I introduced for OS X is fixed.\nJohn Cremona was already happy with the patches if that's relevant.\nSee some comment above.\n\nAs far as rebasing is concerned, I did it not so long ago, but it might need another one unfortunately...",
    "created_at": "2013-03-22T19:04:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130836",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:212" align="right">comment:212</div>

Replying to [@roed314](#comment%3A211):
> So, what needs to be done on this ticket?  Is it just the rebase?  It would be great to finally get this in Sage (#14304 depends on it for example).

I'd say it "just" needs review now that the crap I introduced for OS X is fixed.
John Cremona was already happy with the patches if that's relevant.
See some comment above.

As far as rebasing is concerned, I did it not so long ago, but it might need another one unfortunately...



---

archive/issue_comments_130837.json:
```json
{
    "body": "<div id=\"comment:213\" align=\"right\">comment:213</div>\n\nWhat has been done beyond the patches listed at comment 123?  Anything besides OS X fixes and rebasing?",
    "created_at": "2013-03-22T19:14:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130837",
    "user": "https://github.com/roed314"
}
```

<div id="comment:213" align="right">comment:213</div>

What has been done beyond the patches listed at comment 123?  Anything besides OS X fixes and rebasing?



---

archive/issue_comments_130838.json:
```json
{
    "body": "<div id=\"comment:214\" align=\"right\">comment:214</div>\n\nReplying to [@roed314](#comment%3A213):\n> What has been done beyond the patches listed at comment 123?  Anything besides OS X fixes and rebasing?\n\nI don't think they really changed except for the fact they were merged together without the last of the list which was not such a good idea, or at least deserve more thoughts.\n\nAfter comment 123 they were basically just rebased over and over, and at some point additional fixes were added by Jeroen, see https://github.com/sagemath/sage/issues/12173?replyto=213#comment:153.\n\nThe spkg itself needs rebasing for sure, on top of #14241 and potentially #14268.\nI could surely do that next week.\nDon't know about the patches to the Sage library.",
    "created_at": "2013-03-23T17:27:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130838",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:214" align="right">comment:214</div>

Replying to [@roed314](#comment%3A213):
> What has been done beyond the patches listed at comment 123?  Anything besides OS X fixes and rebasing?

I don't think they really changed except for the fact they were merged together without the last of the list which was not such a good idea, or at least deserve more thoughts.

After comment 123 they were basically just rebased over and over, and at some point additional fixes were added by Jeroen, see https://github.com/sagemath/sage/issues/12173?replyto=213#comment:153.

The spkg itself needs rebasing for sure, on top of #14241 and potentially #14268.
I could surely do that next week.
Don't know about the patches to the Sage library.



---

archive/issue_comments_130839.json:
```json
{
    "body": "<div id=\"comment:215\" align=\"right\">comment:215</div>\n\nOk I've reupped a rebased p0 spkg including the OS X fix and porting the ulong stuff from #14268.\nNot completely sure the ulong stuff is completely right, but it seems to pass all tests.\n\nSpkg at:\n* http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg\n\nPlease review the new spkg and the Sage's library patches!",
    "created_at": "2013-03-27T13:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130839",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:215" align="right">comment:215</div>

Ok I've reupped a rebased p0 spkg including the OS X fix and porting the ulong stuff from #14268.
Not completely sure the ulong stuff is completely right, but it seems to pass all tests.

Spkg at:
* http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg

Please review the new spkg and the Sage's library patches!



---

archive/issue_comments_130840.json:
```json
{
    "body": "Changed dependencies from **#12433** to **#12433, #14268**",
    "created_at": "2013-03-27T13:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130840",
    "user": "https://github.com/jpflori"
}
```

Changed dependencies from **#12433** to **#12433, #14268**



---

archive/issue_comments_130841.json:
```json
{
    "body": "<div id=\"comment:216\" align=\"right\">comment:216</div>\n\n(Of course there may be some proper spkg rebasing hell because #14268 is not merged yet and so the flint spkg there is not tagged.)",
    "created_at": "2013-03-27T13:34:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130841",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:216" align="right">comment:216</div>

(Of course there may be some proper spkg rebasing hell because #14268 is not merged yet and so the flint spkg there is not tagged.)



---

archive/issue_comments_130842.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n **Install**:\n-* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)\n+* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n * [attachment: flint-2.3-library-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)\n``````\n",
    "created_at": "2013-03-27T13:34:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130842",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 **Install**:
-* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.spkg)
+* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
 * [attachment: flint-2.3-library-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)
``````




---

archive/issue_comments_130843.json:
```json
{
    "body": "<div id=\"comment:218\" align=\"right\">comment:218</div>\n\nShould it really depend on #14268?\n\nMinor thing: `spkg-check`: No newline at end of file.",
    "created_at": "2013-03-27T13:54:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130843",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:218" align="right">comment:218</div>

Should it really depend on #14268?

Minor thing: `spkg-check`: No newline at end of file.



---

archive/issue_comments_130844.json:
```json
{
    "body": "<div id=\"comment:219\" align=\"right\">comment:219</div>\n\nI think `spkg-install` still needs some clean-up (overwriting `CFLAGS`, quoting, superfluous `;` :-) ... )\n\nHaven't tested anything yet...",
    "created_at": "2013-03-27T14:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130844",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:219" align="right">comment:219</div>

I think `spkg-install` still needs some clean-up (overwriting `CFLAGS`, quoting, superfluous `;` :-) ... )

Haven't tested anything yet...



---

archive/issue_comments_130845.json:
```json
{
    "body": "<div id=\"comment:220\" align=\"right\">comment:220</div>\n\nP.S.:  For consistency, we could also support a user-definable `FLINT_CONFIGURE` (and [append to and] use that instead of `$EXTRA_CONF`).",
    "created_at": "2013-03-27T14:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130845",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:220" align="right">comment:220</div>

P.S.:  For consistency, we could also support a user-definable `FLINT_CONFIGURE` (and [append to and] use that instead of `$EXTRA_CONF`).



---

archive/issue_comments_130846.json:
```json
{
    "body": "<div id=\"comment:221\" align=\"right\">comment:221</div>\n\nReplying to [@nexttime](#comment%3A218):\n> Should it really depend on #14268?\n\nI think the changes from #14268 make sense.\nUsing one typedef rather than macros (and bunch of #undef in FLINT 2.3 all over the code to mitigate conflicts with system headers in FLINT itself) is a good thing.\nI'll report it upstream and that will hopefully change in a future minor release (also including the OS X fix).\n\nSo even though the patch for FLINT 2.3 is completely different from the one from #14268, the idea is from there and I think it's a good think maybe not to depend on the ticket itself, but at least to inherit from the spkg there.\nTherefore if we get this ticket positively reviewed before #14268 we could just remove the dependency on #14268 and the 1.5.2.p4 spkg from there.\nI don't think making #14268 on this ticket would be fair.\n> \n> Minor thing: `spkg-check`: No newline at end of file.\n\nI'll fix that.",
    "created_at": "2013-03-27T14:06:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130846",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:221" align="right">comment:221</div>

Replying to [@nexttime](#comment%3A218):
> Should it really depend on #14268?

I think the changes from #14268 make sense.
Using one typedef rather than macros (and bunch of #undef in FLINT 2.3 all over the code to mitigate conflicts with system headers in FLINT itself) is a good thing.
I'll report it upstream and that will hopefully change in a future minor release (also including the OS X fix).

So even though the patch for FLINT 2.3 is completely different from the one from #14268, the idea is from there and I think it's a good think maybe not to depend on the ticket itself, but at least to inherit from the spkg there.
Therefore if we get this ticket positively reviewed before #14268 we could just remove the dependency on #14268 and the 1.5.2.p4 spkg from there.
I don't think making #14268 on this ticket would be fair.
> 
> Minor thing: `spkg-check`: No newline at end of file.

I'll fix that.



---

archive/issue_comments_130847.json:
```json
{
    "body": "Attachment: **[flint-2.3.p0.diff.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.diff.gz)**\n\nSpkg diff, for review only.",
    "created_at": "2013-03-27T14:13:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130847",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3.p0.diff.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.diff.gz)**

Spkg diff, for review only.



---

archive/issue_comments_130848.json:
```json
{
    "body": "<div id=\"comment:222\" align=\"right\">comment:222</div>\n\nOk I've reupped a cleaner spkg.\nIn fact most of the spkg-* fixes were in a previous version, but I must have mixed up some versions when working on the OS X fix and was too lazy to double check that.",
    "created_at": "2013-03-27T14:15:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130848",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:222" align="right">comment:222</div>

Ok I've reupped a cleaner spkg.
In fact most of the spkg-* fixes were in a previous version, but I must have mixed up some versions when working on the OS X fix and was too lazy to double check that.



---

archive/issue_comments_130849.json:
```json
{
    "body": "<div id=\"comment:223\" align=\"right\">comment:223</div>\n\nFWIW, I don't see how you compile FLINT as C99.",
    "created_at": "2013-03-27T14:42:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130849",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:223" align="right">comment:223</div>

FWIW, I don't see how you compile FLINT as C99.



---

archive/issue_comments_130850.json:
```json
{
    "body": "<div id=\"comment:224\" align=\"right\">comment:224</div>\n\nI think we don't...\n\nDo you suggest we keep the \"#define ulong unsigned long\"?\nI don't really care.",
    "created_at": "2013-03-27T14:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130850",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:224" align="right">comment:224</div>

I think we don't...

Do you suggest we keep the "#define ulong unsigned long"?
I don't really care.



---

archive/issue_comments_130851.json:
```json
{
    "body": "<div id=\"comment:225\" align=\"right\">comment:225</div>\n\nReplying to [@jpflori](#comment%3A224):\n> Do you suggest we keep the \"#define ulong unsigned long\"?\n> I don't really care.\n\nI think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).",
    "created_at": "2013-03-27T14:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130851",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:225" align="right">comment:225</div>

Replying to [@jpflori](#comment%3A224):
> Do you suggest we keep the "#define ulong unsigned long"?
> I don't really care.

I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).



---

archive/issue_comments_130852.json:
```json
{
    "body": "<div id=\"comment:226\" align=\"right\">comment:226</div>\n\nI cannot review the Sage library patch, \"since the file size exceeds 262144 bytes\"... ;-)",
    "created_at": "2013-03-27T15:01:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130852",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:226" align="right">comment:226</div>

I cannot review the Sage library patch, "since the file size exceeds 262144 bytes"... ;-)



---

archive/issue_comments_130853.json:
```json
{
    "body": "<div id=\"comment:227\" align=\"right\">comment:227</div>\n\nReplying to [@nexttime](#comment%3A225):\n> Replying to [@jpflori](#comment%3A224):\n> > Do you suggest we keep the \"#define ulong unsigned long\"?\n> > I don't really care.\n\n> \n> I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).\n\nYou can just propose whatever changes you want to include here, I'm in close contact with upstream, especially for the build system, so I'll take care of coordination.\nI agree there is some fishy things going on with FLINT_TUNE and CFLAGS and surely other things.\n\nAnd don't say \"let's switch to autotools\" unless you wanna be in charge of the build system maintenance as Bill Hart will definitely not want to maintain it.\n\nBe also aware there won't be any FLINT release before at least the dev meeting in may.\nSo I think we should just make minor modifications and get this in quickly.\nIt's been bitrotting for so long...\nI'll up another spkg based on #14241  not touching the ulong stuff.",
    "created_at": "2013-03-27T15:04:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130853",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:227" align="right">comment:227</div>

Replying to [@nexttime](#comment%3A225):
> Replying to [@jpflori](#comment%3A224):
> > Do you suggest we keep the "#define ulong unsigned long"?
> > I don't really care.

> 
> I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).

You can just propose whatever changes you want to include here, I'm in close contact with upstream, especially for the build system, so I'll take care of coordination.
I agree there is some fishy things going on with FLINT_TUNE and CFLAGS and surely other things.

And don't say "let's switch to autotools" unless you wanna be in charge of the build system maintenance as Bill Hart will definitely not want to maintain it.

Be also aware there won't be any FLINT release before at least the dev meeting in may.
So I think we should just make minor modifications and get this in quickly.
It's been bitrotting for so long...
I'll up another spkg based on #14241  not touching the ulong stuff.



---

archive/issue_comments_130854.json:
```json
{
    "body": "<div id=\"comment:228\" align=\"right\">comment:228</div>\n\nReplying to [@nexttime](#comment%3A226):\n> I cannot review the Sage library patch, \"since the file size exceeds 262144 bytes\"... ;-)\n\nThe big patch bomb is modulo rebasing issues made from the patches at\n* https://github.com/sagemath/sage/issues/12173?replyto=226#comment:123\nplus fixes by Jeroen from\n* https://github.com/sagemath/sage/issues/12173?replyto=226#comment:153",
    "created_at": "2013-03-27T15:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130854",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:228" align="right">comment:228</div>

Replying to [@nexttime](#comment%3A226):
> I cannot review the Sage library patch, "since the file size exceeds 262144 bytes"... ;-)

The big patch bomb is modulo rebasing issues made from the patches at
* https://github.com/sagemath/sage/issues/12173?replyto=226#comment:123
plus fixes by Jeroen from
* https://github.com/sagemath/sage/issues/12173?replyto=226#comment:153



---

archive/issue_comments_130855.json:
```json
{
    "body": "Spkg diff, for review only. Based on #14268.",
    "created_at": "2013-03-27T15:21:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130855",
    "user": "https://github.com/jpflori"
}
```

Spkg diff, for review only. Based on #14268.



---

archive/issue_comments_130856.json:
```json
{
    "body": "Attachment: **[flint-2.3.p0.diff.14268.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.diff.14268.gz)**\n\nAttachment: **[flint-2.3.p0.spkg.14241.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.spkg.14241.gz)**\n\nWrong file...",
    "created_at": "2013-03-27T15:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130856",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3.p0.diff.14268.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.diff.14268.gz)**

Attachment: **[flint-2.3.p0.spkg.14241.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.spkg.14241.gz)**

Wrong file...



---

archive/issue_comments_130857.json:
```json
{
    "body": "<div id=\"comment:229\" align=\"right\">comment:229</div>\n\nOk so we have now:\n* http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg.14241 based on #14241, and mirrored at http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg,\n* http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg.14268 based on #14268.\n\nRename the one you prefer and give it a try.",
    "created_at": "2013-03-27T15:23:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130857",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:229" align="right">comment:229</div>

Ok so we have now:
* http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg.14241 based on #14241, and mirrored at http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg,
* http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg.14268 based on #14268.

Rename the one you prefer and give it a try.



---

archive/issue_comments_130858.json:
```json
{
    "body": "Changed dependencies from **#12433, #14268** to **#12433**",
    "created_at": "2013-03-27T15:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130858",
    "user": "https://github.com/jpflori"
}
```

Changed dependencies from **#12433, #14268** to **#12433**



---

archive/issue_comments_130859.json:
```json
{
    "body": "<div id=\"comment:231\" align=\"right\">comment:231</div>\n\nReplying to [@jpflori](#comment%3A227):\n> Replying to [@nexttime](#comment%3A225):\n> > Replying to [@jpflori](#comment%3A224):\n> > > Do you suggest we keep the \"#define ulong unsigned long\"?\n> > > I don't really care.\n\n`for f in $SOURCES; do sed -i 's/ulong/mp_limb_t/g' $f; done` ;-)\n\n\n\n\n> > I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).\n\n> You can just propose whatever changes you want to include here, I'm in close contact with upstream, especially for the build system, so I'll take care of coordination.\n> I agree there is some fishy things going on with FLINT_TUNE and CFLAGS and surely other things.\n> \n> And don't say \"let's switch to autotools\" unless you wanna be in charge of the build system maintenance as Bill Hart will definitely not want to maintain it.\n\n:-)  Yes.  I just meant I don't know if there are any changes in progress w.r.t. this.\n\nIt doesn't seem we'd need any *Sage-specific* changes, so IMHO we should take fixes from upstream, or push (generic) changes there.\n\n \n> Be also aware there won't be any FLINT release before at least the dev meeting in may.\n\nYes.  But FLINT 2.3.1 should (already) include any fixes we (and others) need, see above.",
    "created_at": "2013-03-27T15:33:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130859",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:231" align="right">comment:231</div>

Replying to [@jpflori](#comment%3A227):
> Replying to [@nexttime](#comment%3A225):
> > Replying to [@jpflori](#comment%3A224):
> > > Do you suggest we keep the "#define ulong unsigned long"?
> > > I don't really care.

`for f in $SOURCES; do sed -i 's/ulong/mp_limb_t/g' $f; done` ;-)




> > I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).

> You can just propose whatever changes you want to include here, I'm in close contact with upstream, especially for the build system, so I'll take care of coordination.
> I agree there is some fishy things going on with FLINT_TUNE and CFLAGS and surely other things.
> 
> And don't say "let's switch to autotools" unless you wanna be in charge of the build system maintenance as Bill Hart will definitely not want to maintain it.

:-)  Yes.  I just meant I don't know if there are any changes in progress w.r.t. this.

It doesn't seem we'd need any *Sage-specific* changes, so IMHO we should take fixes from upstream, or push (generic) changes there.

 
> Be also aware there won't be any FLINT release before at least the dev meeting in may.

Yes.  But FLINT 2.3.1 should (already) include any fixes we (and others) need, see above.



---

archive/issue_comments_130860.json:
```json
{
    "body": "<div id=\"comment:232\" align=\"right\">comment:232</div>\n\nReplying to [@nexttime](#comment%3A231):\n> Replying to [@jpflori](#comment%3A227):\n> > Replying to [@nexttime](#comment%3A225):\n> > > Replying to [@jpflori](#comment%3A224):\n> > > > Do you suggest we keep the \"#define ulong unsigned long\"?\n> > > > I don't really care.\n\n> \n> `for f in $SOURCES; do sed -i 's/ulong/mp_limb_t/g' $f; done` ;-)\n> \n> \n\n> \n> > > I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).\n\n> > You can just propose whatever changes you want to include here, I'm in close contact with upstream, especially for the build system, so I'll take care of coordination.\n> > I agree there is some fishy things going on with FLINT_TUNE and CFLAGS and surely other things.\n> > \n> > And don't say \"let's switch to autotools\" unless you wanna be in charge of the build system maintenance as Bill Hart will definitely not want to maintain it.\n\n> \n> :-)  Yes.  I just meant I don't know if there are any changes in progress w.r.t. this.\n\nNot that I am aware of, so unless Bill posts here and rants we all should assume so.\n> \n> It doesn't seem we'd need any *Sage-specific* changes, so IMHO we should take fixes from upstream, or push (generic) changes there.\n> \n>  \n> > Be also aware there won't be any FLINT release before at least the dev meeting in may.\n\n> \n> Yes.  But FLINT 2.3.1 should (already) include any fixes we (and others) need, see above.\n\nOf course, its just I'm getting tired by this ticket and don't want to wait for the 2.3.1 release which at best will happen in mid-may and then all the stuff here will have to be rebased again...\nAnd that's optimistic because I guess most people at the FLINT meeting will expect to work with FLINT 2.3 and this spkg and will implement new features in FLINT/Sage, rather than working on the FLINT build system and trying to push a new release.\n\nSo I feel our best shot is to get http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg.14241 in as it just modifies flint-2.3 minimally to make it work on OS X.\nLet's keep the C99, strange env variables fun for a later FLINT release/Sage spkg if its not definitely needed to let Sage work on supported systems.",
    "created_at": "2013-03-27T16:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130860",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:232" align="right">comment:232</div>

Replying to [@nexttime](#comment%3A231):
> Replying to [@jpflori](#comment%3A227):
> > Replying to [@nexttime](#comment%3A225):
> > > Replying to [@jpflori](#comment%3A224):
> > > > Do you suggest we keep the "#define ulong unsigned long"?
> > > > I don't really care.

> 
> `for f in $SOURCES; do sed -i 's/ulong/mp_limb_t/g' $f; done` ;-)
> 
> 

> 
> > > I think we should [better?] coordinate that with upstream (probably including changes to the weird `configure` and `Makefile.in`, too -- haven't looked at FLINT's current state recently at all).

> > You can just propose whatever changes you want to include here, I'm in close contact with upstream, especially for the build system, so I'll take care of coordination.
> > I agree there is some fishy things going on with FLINT_TUNE and CFLAGS and surely other things.
> > 
> > And don't say "let's switch to autotools" unless you wanna be in charge of the build system maintenance as Bill Hart will definitely not want to maintain it.

> 
> :-)  Yes.  I just meant I don't know if there are any changes in progress w.r.t. this.

Not that I am aware of, so unless Bill posts here and rants we all should assume so.
> 
> It doesn't seem we'd need any *Sage-specific* changes, so IMHO we should take fixes from upstream, or push (generic) changes there.
> 
>  
> > Be also aware there won't be any FLINT release before at least the dev meeting in may.

> 
> Yes.  But FLINT 2.3.1 should (already) include any fixes we (and others) need, see above.

Of course, its just I'm getting tired by this ticket and don't want to wait for the 2.3.1 release which at best will happen in mid-may and then all the stuff here will have to be rebased again...
And that's optimistic because I guess most people at the FLINT meeting will expect to work with FLINT 2.3 and this spkg and will implement new features in FLINT/Sage, rather than working on the FLINT build system and trying to push a new release.

So I feel our best shot is to get http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg.14241 in as it just modifies flint-2.3 minimally to make it work on OS X.
Let's keep the C99, strange env variables fun for a later FLINT release/Sage spkg if its not definitely needed to let Sage work on supported systems.



---

archive/issue_comments_130861.json:
```json
{
    "body": "<div id=\"comment:233\" align=\"right\">comment:233</div>\n\nOk, too many uploads today, it seems the last version I posted are broken.\nPlease wait for a couple of minutes so that I fix that.",
    "created_at": "2013-03-27T17:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130861",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:233" align="right">comment:233</div>

Ok, too many uploads today, it seems the last version I posted are broken.
Please wait for a couple of minutes so that I fix that.



---

archive/issue_comments_130862.json:
```json
{
    "body": "Attachment: **[flint-2.3.p0.diff.14241.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.diff.14241.gz)**\n\nSpkg diff, for review only. Based on #14241.",
    "created_at": "2013-03-27T17:07:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130862",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[flint-2.3.p0.diff.14241.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p0.diff.14241.gz)**

Spkg diff, for review only. Based on #14241.



---

archive/issue_comments_130863.json:
```json
{
    "body": "<div id=\"comment:234\" align=\"right\">comment:234</div>\n\nShould be ok now.\nAt least I've checked the two spkgs seem to build and pass their testsuite on my system.",
    "created_at": "2013-03-27T17:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130863",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:234" align="right">comment:234</div>

Should be ok now.
At least I've checked the two spkgs seem to build and pass their testsuite on my system.



---

archive/issue_comments_130864.json:
```json
{
    "body": "One additional doctest change for 5.9.beta2",
    "created_at": "2013-03-29T18:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130864",
    "user": "https://github.com/jpflori"
}
```

One additional doctest change for 5.9.beta2



---

archive/issue_comments_130865.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: flint-2.3-library-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)\n+* [attachment: flint-2.3-library-5.9.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz)\n \n **Apply** to SAGE_ROOT:\n * [attachment: flint-2.3-root-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz).\n``````\n",
    "created_at": "2013-03-29T18:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130865",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: flint-2.3-library-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.8.b2.patch.gz)
+* [attachment: flint-2.3-library-5.9.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz)
 
 **Apply** to SAGE_ROOT:
 * [attachment: flint-2.3-root-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz).
``````




---

archive/issue_comments_130866.json:
```json
{
    "body": "<div id=\"comment:235\" align=\"right\">comment:235</div>\n\nAttachment: **[flint-2.3-library-5.9.b2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz)**",
    "created_at": "2013-03-29T18:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130866",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:235" align="right">comment:235</div>

Attachment: **[flint-2.3-library-5.9.b2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz)**



---

archive/issue_comments_130867.json:
```json
{
    "body": "<div id=\"comment:236\" align=\"right\">comment:236</div>\n\nWorks fine on the buildbot.",
    "created_at": "2013-04-04T17:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130867",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:236" align="right">comment:236</div>

Works fine on the buildbot.



---

archive/issue_comments_130868.json:
```json
{
    "body": "<div id=\"comment:237\" align=\"right\">comment:237</div>\n\nAs for `ulong`: I think the correct solution is\n\n```\ntypedef unsigned long ulong;\n```\ninstead of `#define`. This `typedef` is compatible with the common C libraries. Of course, the workaround currently in `zn_poly` would need to be removed too.",
    "created_at": "2013-04-04T17:37:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130868",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:237" align="right">comment:237</div>

As for `ulong`: I think the correct solution is

```
typedef unsigned long ulong;
```
instead of `#define`. This `typedef` is compatible with the common C libraries. Of course, the workaround currently in `zn_poly` would need to be removed too.



---

archive/issue_comments_130869.json:
```json
{
    "body": "<div id=\"comment:238\" align=\"right\">comment:238</div>\n\nReplying to [@jdemeyer](#comment%3A236):\n> Works fine on the buildbot.\n\nI've also tested it with Sage 5.9.beta2 on Linux x86 (GCC 4.7.2, with '-O3') and Linux x86_64 (GCC 4.8.0, with '-O3') without any issues, i.e., patches apply, `sage -b` works as expected (all modules that need rebuilding get rebuilt -- no need to brute-force `sage -ba`), and all long tests ([p]testlong) passed.\n\nI haven't reviewed the 8000+ lines patch though...",
    "created_at": "2013-04-04T19:51:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130869",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:238" align="right">comment:238</div>

Replying to [@jdemeyer](#comment%3A236):
> Works fine on the buildbot.

I've also tested it with Sage 5.9.beta2 on Linux x86 (GCC 4.7.2, with '-O3') and Linux x86_64 (GCC 4.8.0, with '-O3') without any issues, i.e., patches apply, `sage -b` works as expected (all modules that need rebuilding get rebuilt -- no need to brute-force `sage -ba`), and all long tests ([p]testlong) passed.

I haven't reviewed the 8000+ lines patch though...



---

archive/issue_comments_130870.json:
```json
{
    "body": "<div id=\"comment:239\" align=\"right\">comment:239</div>\n\nReplying to [@jdemeyer](#comment%3A237):\n> As for `ulong`: I think the correct solution is\n> \n> ```\n> typedef unsigned long ulong;\n> ```\n> instead of `#define`. This `typedef` is compatible with the common C libraries. Of course, the workaround currently in `zn_poly` would need to be removed too.\n\nWell, the disadvantage of `typedef`s (vs. `#define`s) is always that there's no way to test (with the preprocessor) whether a type is already (`type`)def'd (other than checking such in `configure` and defining `HAVE_TYPEDEF_FOO` etc.).\n\nAs mentioned elsewhere, in the present cases it would IMHO be cleaner to use `mp_limb_t` anyway (which of course isn't that much shorter or easier to type than `unsigned long`).",
    "created_at": "2013-04-04T20:02:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130870",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:239" align="right">comment:239</div>

Replying to [@jdemeyer](#comment%3A237):
> As for `ulong`: I think the correct solution is
> 
> ```
> typedef unsigned long ulong;
> ```
> instead of `#define`. This `typedef` is compatible with the common C libraries. Of course, the workaround currently in `zn_poly` would need to be removed too.

Well, the disadvantage of `typedef`s (vs. `#define`s) is always that there's no way to test (with the preprocessor) whether a type is already (`type`)def'd (other than checking such in `configure` and defining `HAVE_TYPEDEF_FOO` etc.).

As mentioned elsewhere, in the present cases it would IMHO be cleaner to use `mp_limb_t` anyway (which of course isn't that much shorter or easier to type than `unsigned long`).



---

archive/issue_comments_130871.json:
```json
{
    "body": "<div id=\"comment:240\" align=\"right\">comment:240</div>\n\nReplying to [@nexttime](#comment%3A238):\n> I've also tested it with Sage 5.9.beta2 on Linux x86 (GCC 4.7.2, with '-O3') and Linux x86_64 (GCC 4.8.0, with '-O3') without any issues, i.e., patches apply, `sage -b` works as expected (all modules that need rebuilding get rebuilt -- no need to brute-force `sage -ba`), and all long tests ([p]testlong) passed.\n\nOh, and of course FLINT 2.3's test suite passed in both cases as well; I just noticed there's no message regarding that (and when running the test suite in parallel, the output isn't synced, i.e., you may get `foo...bar...` and a couple of `PASS`s where it's not obvious what they refer to, which isn't really a problem until a test fails).",
    "created_at": "2013-04-04T20:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130871",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:240" align="right">comment:240</div>

Replying to [@nexttime](#comment%3A238):
> I've also tested it with Sage 5.9.beta2 on Linux x86 (GCC 4.7.2, with '-O3') and Linux x86_64 (GCC 4.8.0, with '-O3') without any issues, i.e., patches apply, `sage -b` works as expected (all modules that need rebuilding get rebuilt -- no need to brute-force `sage -ba`), and all long tests ([p]testlong) passed.

Oh, and of course FLINT 2.3's test suite passed in both cases as well; I just noticed there's no message regarding that (and when running the test suite in parallel, the output isn't synced, i.e., you may get `foo...bar...` and a couple of `PASS`s where it's not obvious what they refer to, which isn't really a problem until a test fails).



---

archive/issue_comments_130872.json:
```json
{
    "body": "<div id=\"comment:241\" align=\"right\">comment:241</div>\n\nAbout the typedef thing, I propose we wait until the FLINT meeting in early may which I should attend.\nI'll discuss it there with Bill Hart.\n\nBut if you think its really an issue and want #14268 merged first (or at the same time, I mean going from define to typedef in FLINT whether its 1.x or 2.x), feel free to discuss it on flint-devel group.\nYou can then use the spkg a few comments above I based on the one from #14268.\n\nAnd it's know that the output of tests are out of sync when run in parallel, but before they were not even run in parallel, so I think the situation is better now, although not optimal.",
    "created_at": "2013-04-04T20:34:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130872",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:241" align="right">comment:241</div>

About the typedef thing, I propose we wait until the FLINT meeting in early may which I should attend.
I'll discuss it there with Bill Hart.

But if you think its really an issue and want #14268 merged first (or at the same time, I mean going from define to typedef in FLINT whether its 1.x or 2.x), feel free to discuss it on flint-devel group.
You can then use the spkg a few comments above I based on the one from #14268.

And it's know that the output of tests are out of sync when run in parallel, but before they were not even run in parallel, so I think the situation is better now, although not optimal.



---

archive/issue_comments_130873.json:
```json
{
    "body": "<div id=\"comment:242\" align=\"right\">comment:242</div>\n\nReplying to [@jpflori](#comment%3A241):\n> About the typedef thing, I propose we wait until the FLINT meeting in early may which I should attend.\n> I'll discuss it there with Bill Hart.\n> \n> But if you think its really an issue and want #14268 merged first (or at the same time, I mean going from define to typedef in FLINT whether its 1.x or 2.x), feel free to discuss it on flint-devel group.\n> You can then use the spkg a few comments above I based on the one from #14268.\n\nI think we should postpone that to a follow-up ticket, i.e., get FLINT 2.3 in as is first.\n\n\n\n\n> And it's know that the output of tests are out of sync when run in parallel, but before they were not even run in parallel, so I think the situation is better now, although not optimal.\n\n:-)  Yes, but adding (back?) a message to `spkg-check` in case all tests passed wouldn't be bad, nor hard...\n\nThe end of the log currently looks like this:\n\n```\n...\ng++-4.8.0 -march=native -mtune=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS -funroll-loops -I${SAGE_ROOT}/spkg/build/flint-2.3.p0/src -I${SAGE_ROOT}/local/include -I${SAGE_ROOT}/local/include -I${SAGE_ROOT}/local/include interfaces/test/t-NTL-interface.cpp build/interfaces/NTL-interface.o -o build/interfaces/test/t-NTL-interface -L${SAGE_ROOT}/spkg/build/flint-2.3.p0/src -L${SAGE_ROOT}/local/lib -L${SAGE_ROOT}/local/lib -L${SAGE_ROOT}/local/lib -lflint -lntl -lmpfr -lmpir -lm -lpthread;\nmake[1]: Leaving directory `${SAGE_ROOT}/spkg/build/flint-2.3.p0/src'\nZZ_to_fmpz....PASS\nZZX_to_fmpz_poly....PASS\n\nreal\t57m16.835s\nuser\t50m49.950s\nsys\t1m56.670s\nDeleting temporary build directory\n${SAGE_ROOT}/spkg/build/flint-2.3.p0\nFinished installing flint-2.3.p0.spkg\n```",
    "created_at": "2013-04-04T21:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130873",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:242" align="right">comment:242</div>

Replying to [@jpflori](#comment%3A241):
> About the typedef thing, I propose we wait until the FLINT meeting in early may which I should attend.
> I'll discuss it there with Bill Hart.
> 
> But if you think its really an issue and want #14268 merged first (or at the same time, I mean going from define to typedef in FLINT whether its 1.x or 2.x), feel free to discuss it on flint-devel group.
> You can then use the spkg a few comments above I based on the one from #14268.

I think we should postpone that to a follow-up ticket, i.e., get FLINT 2.3 in as is first.




> And it's know that the output of tests are out of sync when run in parallel, but before they were not even run in parallel, so I think the situation is better now, although not optimal.

:-)  Yes, but adding (back?) a message to `spkg-check` in case all tests passed wouldn't be bad, nor hard...

The end of the log currently looks like this:

```
...
g++-4.8.0 -march=native -mtune=native -O3 -fno-strict-aliasing -DHONORS_CFLAGS -funroll-loops -I${SAGE_ROOT}/spkg/build/flint-2.3.p0/src -I${SAGE_ROOT}/local/include -I${SAGE_ROOT}/local/include -I${SAGE_ROOT}/local/include interfaces/test/t-NTL-interface.cpp build/interfaces/NTL-interface.o -o build/interfaces/test/t-NTL-interface -L${SAGE_ROOT}/spkg/build/flint-2.3.p0/src -L${SAGE_ROOT}/local/lib -L${SAGE_ROOT}/local/lib -L${SAGE_ROOT}/local/lib -lflint -lntl -lmpfr -lmpir -lm -lpthread;
make[1]: Leaving directory `${SAGE_ROOT}/spkg/build/flint-2.3.p0/src'
ZZ_to_fmpz....PASS
ZZX_to_fmpz_poly....PASS

real	57m16.835s
user	50m49.950s
sys	1m56.670s
Deleting temporary build directory
${SAGE_ROOT}/spkg/build/flint-2.3.p0
Finished installing flint-2.3.p0.spkg
```



---

archive/issue_comments_130874.json:
```json
{
    "body": "<div id=\"comment:243\" align=\"right\">comment:243</div>\n\nReplying to [@jpflori](#comment%3A241):\n> About the typedef thing, I propose we wait until the FLINT meeting in early may which I should attend.\n> I'll discuss it there with Bill Hart.\n\nI agree. The main argument in favour of `typedef` is that some other libraries (including `glibc`, which should be a strong precedent and `zn_poly`) also use `typedef`. And it's not a problem to have the same `typedef` twice.",
    "created_at": "2013-04-04T21:37:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130874",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:243" align="right">comment:243</div>

Replying to [@jpflori](#comment%3A241):
> About the typedef thing, I propose we wait until the FLINT meeting in early may which I should attend.
> I'll discuss it there with Bill Hart.

I agree. The main argument in favour of `typedef` is that some other libraries (including `glibc`, which should be a strong precedent and `zn_poly`) also use `typedef`. And it's not a problem to have the same `typedef` twice.



---

archive/issue_comments_130875.json:
```json
{
    "body": "<div id=\"comment:244\" align=\"right\">comment:244</div>\n\nReplying to [@jdemeyer](#comment%3A243):\n> The main argument in favour of `typedef` is that some other libraries (including `glibc`, which should be a strong precedent and `zn_poly`) also use `typedef`. And it's not a problem to have the same `typedef` twice.\n\n```C\ntypedef unsigned long ulong;\n\ntypedef unsigned long ulong;\n```\ngives an error (redefinition of ulong) at least with earlier versions of GCC.  `clang` is more verbose:\n\n```\ntypedef.c:3:23: warning: redefinition of typedef 'ulong' is a C11 feature [-Wtypedef-redefinition]\ntypedef unsigned long ulong;\n                      ^\ntypedef.c:1:23: note: previous definition is here\ntypedef unsigned long ulong;\n                      ^\n1 warning generated.\n```",
    "created_at": "2013-04-04T21:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130875",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:244" align="right">comment:244</div>

Replying to [@jdemeyer](#comment%3A243):
> The main argument in favour of `typedef` is that some other libraries (including `glibc`, which should be a strong precedent and `zn_poly`) also use `typedef`. And it's not a problem to have the same `typedef` twice.

```C
typedef unsigned long ulong;

typedef unsigned long ulong;
```
gives an error (redefinition of ulong) at least with earlier versions of GCC.  `clang` is more verbose:

```
typedef.c:3:23: warning: redefinition of typedef 'ulong' is a C11 feature [-Wtypedef-redefinition]
typedef unsigned long ulong;
                      ^
typedef.c:1:23: note: previous definition is here
typedef unsigned long ulong;
                      ^
1 warning generated.
```



---

archive/issue_comments_130876.json:
```json
{
    "body": "<div id=\"comment:245\" align=\"right\">comment:245</div>\n\nGCC 4.6.3 warns with `-pedantic`:\n\n```\ntypedef.c:2:23: warning: redefinition of typedef 'ulong' [-pedantic]\ntypedef.c:1:23: note: previous declaration of 'ulong' was here\n```\nWithout `-pedantic` (even with `-Wall -Wextra`), there is no warning or error.",
    "created_at": "2013-04-04T22:01:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130876",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:245" align="right">comment:245</div>

GCC 4.6.3 warns with `-pedantic`:

```
typedef.c:2:23: warning: redefinition of typedef 'ulong' [-pedantic]
typedef.c:1:23: note: previous declaration of 'ulong' was here
```
Without `-pedantic` (even with `-Wall -Wextra`), there is no warning or error.



---

archive/issue_comments_130877.json:
```json
{
    "body": "<div id=\"comment:246\" align=\"right\">comment:246</div>\n\nGCC 4.4.3 errors out, regardless what `-std` is active.",
    "created_at": "2013-04-04T22:06:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130877",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:246" align="right">comment:246</div>

GCC 4.4.3 errors out, regardless what `-std` is active.



---

archive/issue_comments_130878.json:
```json
{
    "body": "<div id=\"comment:247\" align=\"right\">comment:247</div>\n\nBut g++ always accepts it, this is legal in C++.",
    "created_at": "2013-04-04T22:08:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130878",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:247" align="right">comment:247</div>

But g++ always accepts it, this is legal in C++.



---

archive/issue_comments_130879.json:
```json
{
    "body": "<div id=\"comment:248\" align=\"right\">comment:248</div>\n\nReplying to [@jdemeyer](#comment%3A247):\n> But g++ always accepts it, this is legal in C++.\n\n... while both FLINT and zn_poly are (mostly) written in C, not C++. ;-)",
    "created_at": "2013-04-04T22:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130879",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:248" align="right">comment:248</div>

Replying to [@jdemeyer](#comment%3A247):
> But g++ always accepts it, this is legal in C++.

... while both FLINT and zn_poly are (mostly) written in C, not C++. ;-)



---

archive/issue_comments_130880.json:
```json
{
    "body": "<div id=\"comment:249\" align=\"right\">comment:249</div>\n\nSome good read: [http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c](http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c)",
    "created_at": "2013-04-04T22:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130880",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:249" align="right">comment:249</div>

Some good read: [http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c](http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c)



---

archive/issue_comments_130881.json:
```json
{
    "body": "<div id=\"comment:250\" align=\"right\">comment:250</div>\n\nReplying to [@jdemeyer](#comment%3A249):\n> Some good read: [http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c](http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c)\n\nSo the optimal solution is\n\n```C\n#define typedef please typedef\n\n...\n\ntypedef unsigned long ulong;\n```",
    "created_at": "2013-04-04T22:22:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130881",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:250" align="right">comment:250</div>

Replying to [@jdemeyer](#comment%3A249):
> Some good read: [http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c](http://stackoverflow.com/questions/8594954/repeated-typedefs-invalid-in-c-but-valid-in-c)

So the optimal solution is

```C
#define typedef please typedef

...

typedef unsigned long ulong;
```



---

archive/issue_comments_130882.json:
```json
{
    "body": "<div id=\"comment:251\" align=\"right\">comment:251</div>\n\nOr maybe, a bit safer:\n\n```C\n#ifndef typedef\n#define typedef please typedef\n#endif\n\n...\n```",
    "created_at": "2013-04-04T22:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130882",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:251" align="right">comment:251</div>

Or maybe, a bit safer:

```C
#ifndef typedef
#define typedef please typedef
#endif

...
```



---

archive/issue_events_163674.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-05T09:18:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "milestone_number": null,
    "milestone_title": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163674"
}
```



---

archive/issue_events_163675.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-05T09:18:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "milestone_number": null,
    "milestone_title": "sage-5.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163675"
}
```



---

archive/issue_comments_130883.json:
```json
{
    "body": "<div id=\"comment:253\" align=\"right\">comment:253</div>\n\nReminder:\n\nReplying to [@jdemeyer](#comment%3A161):\n> For easier reviewing, it would really be good to split up the big patchbomb into a \"rename methods\" patch (e.g. from zmod to nmod) which does only that and should be automatically generated and a \"remainder\" patch.",
    "created_at": "2013-04-09T13:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130883",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:253" align="right">comment:253</div>

Reminder:

Replying to [@jdemeyer](#comment%3A161):
> For easier reviewing, it would really be good to split up the big patchbomb into a "rename methods" patch (e.g. from zmod to nmod) which does only that and should be automatically generated and a "remainder" patch.



---

archive/issue_comments_130884.json:
```json
{
    "body": "<div id=\"comment:254\" align=\"right\">comment:254</div>\n\nThis should be rebased to #14393.",
    "created_at": "2013-04-09T13:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130884",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:254" align="right">comment:254</div>

This should be rebased to #14393.



---

archive/issue_events_163676.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-09T13:58:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163676"
}
```



---

archive/issue_events_163677.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-09T13:58:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163677"
}
```



---

archive/issue_comments_130885.json:
```json
{
    "body": "Changed dependencies from **#12433** to **#12433, #14393**",
    "created_at": "2013-04-09T13:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130885",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#12433** to **#12433, #14393**



---

archive/issue_comments_130886.json:
```json
{
    "body": "<div id=\"comment:255\" align=\"right\">comment:255</div>\n\nReplying to [@jpflori](#comment%3A162):\n> I don't really feel like resplitting everything back now...\n\nBut you expect a reviewer to do it... not me.",
    "created_at": "2013-04-09T13:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130886",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:255" align="right">comment:255</div>

Replying to [@jpflori](#comment%3A162):
> I don't really feel like resplitting everything back now...

But you expect a reviewer to do it... not me.



---

archive/issue_comments_130887.json:
```json
{
    "body": "<div id=\"comment:256\" align=\"right\">comment:256</div>\n\nAs I pointed above before, all the content of the patchbomb is from:\n* https://github.com/sagemath/sage/issues/12173#comment:123\nexcept that:\n* the last patch from there is omitted in the merged patchbomb;\n* the patch bomb was rebased several times;\n* one or two newly introduced doctests had to be changed;\n* your fixes from https://github.com/sagemath/sage/issues/12173?replyto=213#comment:153 were included.\n\nBut if you feel we must really have the latest version resplitted to do a proper review, I'll give it a try when rebasing once more against #14393.",
    "created_at": "2013-04-11T09:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130887",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:256" align="right">comment:256</div>

As I pointed above before, all the content of the patchbomb is from:
* https://github.com/sagemath/sage/issues/12173#comment:123
except that:
* the last patch from there is omitted in the merged patchbomb;
* the patch bomb was rebased several times;
* one or two newly introduced doctests had to be changed;
* your fixes from https://github.com/sagemath/sage/issues/12173?replyto=213#comment:153 were included.

But if you feel we must really have the latest version resplitted to do a proper review, I'll give it a try when rebasing once more against #14393.



---

archive/issue_comments_130888.json:
```json
{
    "body": "Work Issues: **rebasing, split patches back**",
    "created_at": "2013-04-11T09:16:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130888",
    "user": "https://github.com/jpflori"
}
```

Work Issues: **rebasing, split patches back**



---

archive/issue_comments_130889.json:
```json
{
    "body": "<div id=\"comment:258\" align=\"right\">comment:258</div>\n\nReplying to [@jpflori](#comment%3A256):\n> But if you feel we must really have the latest version resplitted to do a proper review\n\nYou don't need to resplit everything as before. The problem is that a large part of this patch is simply renaming stuff. This should be done automatically (e.g. with a `sed` command).\n\nThat's the minimal thing that I require: a script which does the automatic parts of the patch, so I can review that script instead of its output (which is much more).",
    "created_at": "2013-04-11T09:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130889",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:258" align="right">comment:258</div>

Replying to [@jpflori](#comment%3A256):
> But if you feel we must really have the latest version resplitted to do a proper review

You don't need to resplit everything as before. The problem is that a large part of this patch is simply renaming stuff. This should be done automatically (e.g. with a `sed` command).

That's the minimal thing that I require: a script which does the automatic parts of the patch, so I can review that script instead of its output (which is much more).



---

archive/issue_comments_130890.json:
```json
{
    "body": "Result of script.sh",
    "created_at": "2013-04-15T13:11:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130890",
    "user": "https://github.com/jpflori"
}
```

Result of script.sh



---

archive/issue_comments_130891.json:
```json
{
    "body": "Attachment: **[trac_12173-script-v5.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v5.patch.gz)**\n\nAttachment: **[trac_12173-fixes-v4.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz)**\n\nFixes after running script.sh",
    "created_at": "2013-04-15T13:11:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130891",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_12173-script-v5.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v5.patch.gz)**

Attachment: **[trac_12173-fixes-v4.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz)**

Fixes after running script.sh



---

archive/issue_comments_130892.json:
```json
{
    "body": "Attachment: **[trac_12173-doctests.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz)**\n\nDoctests.",
    "created_at": "2013-04-15T13:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130892",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_12173-doctests.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz)**

Doctests.



---

archive/issue_comments_130893.json:
```json
{
    "body": "<div id=\"comment:259\" align=\"right\">comment:259</div>\n\nOk here you go.\nAt least Sage builds correctly, I've just launched make ptestlong.",
    "created_at": "2013-04-15T13:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130893",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:259" align="right">comment:259</div>

Ok here you go.
At least Sage builds correctly, I've just launched make ptestlong.



---

archive/issue_comments_130894.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,9 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: flint-2.3-library-5.9.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz)\n+* [attachment: trac_12173-script.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script.patch.gz), this is the result of running script.sh;\n+* [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n+* [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.\n \n **Apply** to SAGE_ROOT:\n-* [attachment: flint-2.3-root-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz).\n+* [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n``````\n",
    "created_at": "2013-04-15T13:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130894",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,9 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: flint-2.3-library-5.9.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz)
+* [attachment: trac_12173-script.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script.patch.gz), this is the result of running script.sh;
+* [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;
+* [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.
 
 **Apply** to SAGE_ROOT:
-* [attachment: flint-2.3-root-5.8.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-root-5.8.b2.patch.gz).
+* [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
``````




---

archive/issue_events_163678.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-15T13:16:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163678"
}
```



---

archive/issue_events_163679.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-15T13:16:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163679"
}
```



---

archive/issue_comments_130895.json:
```json
{
    "body": "Changed work issues from **rebasing, split patches back** to none",
    "created_at": "2013-04-15T13:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130895",
    "user": "https://github.com/jpflori"
}
```

Changed work issues from **rebasing, split patches back** to none



---

archive/issue_comments_130896.json:
```json
{
    "body": "Root patch",
    "created_at": "2013-04-15T13:16:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130896",
    "user": "https://github.com/jpflori"
}
```

Root patch



---

archive/issue_comments_130897.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script.patch.gz), this is the result of running script.sh;\n+* [attachment: trac_12173-script-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v5.patch.gz), this is the result of running script.sh;\n * [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.\n \n``````\n",
    "created_at": "2013-04-15T13:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130897",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script.patch.gz), this is the result of running script.sh;
+* [attachment: trac_12173-script-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v5.patch.gz), this is the result of running script.sh;
 * [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.
 
``````




---

archive/issue_comments_130898.json:
```json
{
    "body": "<div id=\"comment:260\" align=\"right\">comment:260</div>\n\nAttachment: **[trac_12173-root.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz)**",
    "created_at": "2013-04-15T13:17:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130898",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:260" align="right">comment:260</div>

Attachment: **[trac_12173-root.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz)**



---

archive/issue_comments_130899.json:
```json
{
    "body": "<div id=\"comment:261\" align=\"right\">comment:261</div>\n\nRemainder: the current spkg does not take #14268 into account, anyway it is not merged yet, so could rather be rebased on top of this ticket.\nFor an spkg based on #14268, look at the links at comment 229: https://github.com/sagemath/sage/issues/12173#comment:229.",
    "created_at": "2013-04-15T13:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130899",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:261" align="right">comment:261</div>

Remainder: the current spkg does not take #14268 into account, anyway it is not merged yet, so could rather be rebased on top of this ticket.
For an spkg based on #14268, look at the links at comment 229: https://github.com/sagemath/sage/issues/12173#comment:229.



---

archive/issue_comments_130900.json:
```json
{
    "body": "<div id=\"comment:262\" align=\"right\">comment:262</div>\n\nHum, there is something wrong. Having a look at it right now.",
    "created_at": "2013-04-15T13:22:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130900",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:262" align="right">comment:262</div>

Hum, there is something wrong. Having a look at it right now.



---

archive/issue_comments_130901.json:
```json
{
    "body": "<div id=\"comment:263\" align=\"right\">comment:263</div>\n\n(when testing cython.py)",
    "created_at": "2013-04-15T13:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130901",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:263" align="right">comment:263</div>

(when testing cython.py)



---

archive/issue_comments_130902.json:
```json
{
    "body": "<div id=\"comment:264\" align=\"right\">comment:264</div>\n\nThe last version of script.sh does not delete fmpq_poly.h...",
    "created_at": "2013-04-15T13:25:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130902",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:264" align="right">comment:264</div>

The last version of script.sh does not delete fmpq_poly.h...



---

archive/issue_comments_130903.json:
```json
{
    "body": "<div id=\"comment:265\" align=\"right\">comment:265</div>\n\nIn fact that's not the good script...\nReuploading everything in a few minutes.",
    "created_at": "2013-04-15T13:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130903",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:265" align="right">comment:265</div>

In fact that's not the good script...
Reuploading everything in a few minutes.



---

archive/issue_comments_130904.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v5.patch.gz), this is the result of running script.sh;\n+* [attachment: trac_12173-script-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v6.patch.gz), this is the result of running [attachment: script.sh](https://github.com/sagemath/sage/files/ticket12173/script.sh.gz);\n * [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.\n \n``````\n",
    "created_at": "2013-04-15T13:59:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130904",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v5.patch.gz), this is the result of running script.sh;
+* [attachment: trac_12173-script-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v6.patch.gz), this is the result of running [attachment: script.sh](https://github.com/sagemath/sage/files/ticket12173/script.sh.gz);
 * [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.
 
``````




---

archive/issue_comments_130905.json:
```json
{
    "body": "Attachment: **[script.sh.gz](https://github.com/sagemath/sage/files/ticket12173/script.sh.gz)**\n\nUpdate script.",
    "created_at": "2013-04-15T14:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130905",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[script.sh.gz](https://github.com/sagemath/sage/files/ticket12173/script.sh.gz)**

Update script.



---

archive/issue_comments_130906.json:
```json
{
    "body": "Result of script.sh",
    "created_at": "2013-04-15T14:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130906",
    "user": "https://github.com/jpflori"
}
```

Result of script.sh



---

archive/issue_comments_130907.json:
```json
{
    "body": "Attachment: **[trac_12173-script-v6.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v6.patch.gz)**\n\nMore readable patch for nmod_poly.pxd",
    "created_at": "2013-04-15T14:12:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130907",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_12173-script-v6.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v6.patch.gz)**

More readable patch for nmod_poly.pxd



---

archive/issue_comments_130908.json:
```json
{
    "body": "<div id=\"comment:267\" align=\"right\">comment:267</div>\n\nAttachment: **[nmod_poly.patch.gz](https://github.com/sagemath/sage/files/ticket12173/nmod_poly.patch.gz)**\n\nI've upped [attachment: nmod_poly.patch](https://github.com/sagemath/sage/files/ticket12173/nmod_poly.patch.gz) which gives a more readable view of the changes in nmod_poly.pxd than what mercurial spits out in [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz).",
    "created_at": "2013-04-15T14:13:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130908",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:267" align="right">comment:267</div>

Attachment: **[nmod_poly.patch.gz](https://github.com/sagemath/sage/files/ticket12173/nmod_poly.patch.gz)**

I've upped [attachment: nmod_poly.patch](https://github.com/sagemath/sage/files/ticket12173/nmod_poly.patch.gz) which gives a more readable view of the changes in nmod_poly.pxd than what mercurial spits out in [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz).



---

archive/issue_comments_130909.json:
```json
{
    "body": "<div id=\"comment:268\" align=\"right\">comment:268</div>\n\n\"make ptestlong\" went fine on a 64 bits Ubuntu 12.04.2 install (except for two unrelated files, cachefunc.py wich passes when run afterward and gen_interpreters.py which fails because of NFS timestamps issues).",
    "created_at": "2013-04-15T14:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130909",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:268" align="right">comment:268</div>

"make ptestlong" went fine on a 64 bits Ubuntu 12.04.2 install (except for two unrelated files, cachefunc.py wich passes when run afterward and gen_interpreters.py which fails because of NFS timestamps issues).



---

archive/issue_comments_130910.json:
```json
{
    "body": "<div id=\"comment:269\" align=\"right\">comment:269</div>\n\nWill this package make it possible to drop the flintqs spkg too?",
    "created_at": "2013-04-15T16:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130910",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:269" align="right">comment:269</div>

Will this package make it possible to drop the flintqs spkg too?



---

archive/issue_comments_130911.json:
```json
{
    "body": "<div id=\"comment:270\" align=\"right\">comment:270</div>\n\nEverything went fine on a fresh 5.9.beta5 build with the patched ecl package as at #14426 (which has been merged into 5.9.rc0 now).  I did not do make ptestlong, but I did do sage -tp10 --long on the whole library and had no failures.\n\nI don't know the answer to the question about flintqs.",
    "created_at": "2013-04-16T09:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130911",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:270" align="right">comment:270</div>

Everything went fine on a fresh 5.9.beta5 build with the patched ecl package as at #14426 (which has been merged into 5.9.rc0 now).  I did not do make ptestlong, but I did do sage -tp10 --long on the whole library and had no failures.

I don't know the answer to the question about flintqs.



---

archive/issue_comments_130912.json:
```json
{
    "body": "<div id=\"comment:271\" align=\"right\">comment:271</div>\n\nReplying to [@JohnCremona](#comment%3A270):\n> I don't know the answer to the question about flintqs.\n\nNor do I.\nLatest info I remember is from:\n* https://groups.google.com/d/msg/flint-devel/lmRdEPV6el8/TjHd0NzSOWsJ\n* https://groups.google.com/d/msg/flint-devel/lmRdEPV6el8/JNbZ4eTy_n0J\nbut it seems Julien is aware of that.\n\nAnyway, this should be dealt with at #11792.",
    "created_at": "2013-04-16T10:10:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130912",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:271" align="right">comment:271</div>

Replying to [@JohnCremona](#comment%3A270):
> I don't know the answer to the question about flintqs.

Nor do I.
Latest info I remember is from:
* https://groups.google.com/d/msg/flint-devel/lmRdEPV6el8/TjHd0NzSOWsJ
* https://groups.google.com/d/msg/flint-devel/lmRdEPV6el8/JNbZ4eTy_n0J
but it seems Julien is aware of that.

Anyway, this should be dealt with at #11792.



---

archive/issue_comments_130913.json:
```json
{
    "body": "<div id=\"comment:272\" align=\"right\">comment:272</div>\n\nJust to be clear: these three patches when applied should result in exactly the same end result as the original [attachment: flint-2.3-library-5.9.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz), right?",
    "created_at": "2013-04-17T10:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130913",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:272" align="right">comment:272</div>

Just to be clear: these three patches when applied should result in exactly the same end result as the original [attachment: flint-2.3-library-5.9.b2.patch](https://github.com/sagemath/sage/files/ticket12173/flint-2.3-library-5.9.b2.patch.gz), right?



---

archive/issue_comments_130914.json:
```json
{
    "body": "<div id=\"comment:273\" align=\"right\">comment:273</div>\n\nNo.",
    "created_at": "2013-04-17T11:17:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130914",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:273" align="right">comment:273</div>

No.



---

archive/issue_comments_130915.json:
```json
{
    "body": "<div id=\"comment:274\" align=\"right\">comment:274</div>\n\nBut functionally yes.\n\nHere is what I did:\n* look thru the original patch and write the sed script;\n* remove the scripted part from the original part by hand;\n* remove the purely doctests, doc, parts of the original part and put them apart;\n* fix the punctured original patch by hand, and especially, completely reorder the nmod_poly.pxd part so that it can be read by a human;\n* remark some other parts could be scripted and go back to the first step until Sage builds and passes its testsuite.",
    "created_at": "2013-04-17T11:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130915",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:274" align="right">comment:274</div>

But functionally yes.

Here is what I did:
* look thru the original patch and write the sed script;
* remove the scripted part from the original part by hand;
* remove the purely doctests, doc, parts of the original part and put them apart;
* fix the punctured original patch by hand, and especially, completely reorder the nmod_poly.pxd part so that it can be read by a human;
* remark some other parts could be scripted and go back to the first step until Sage builds and passes its testsuite.



---

archive/issue_comments_130916.json:
```json
{
    "body": "<div id=\"comment:275\" align=\"right\">comment:275</div>\n\nSlightly updated. Now the three patches together are exactly the same as the original, except for changes in `module_list.py` (which needed rebasing anyway) and except for the CRLF line endings.",
    "created_at": "2013-04-17T11:31:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130916",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:275" align="right">comment:275</div>

Slightly updated. Now the three patches together are exactly the same as the original, except for changes in `module_list.py` (which needed rebasing anyway) and except for the CRLF line endings.



---

archive/issue_comments_130917.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,9 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v6.patch.gz), this is the result of running [attachment: script.sh](https://github.com/sagemath/sage/files/ticket12173/script.sh.gz);\n-* [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n-* [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.\n+* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12713_script.sh](https://github.com/sagemath/sage/files/ticket12173/12713_script.sh.gz);\n+* [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n+* [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n \n **Apply** to SAGE_ROOT:\n * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n``````\n",
    "created_at": "2013-04-17T11:32:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130917",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,9 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v6.patch.gz), this is the result of running [attachment: script.sh](https://github.com/sagemath/sage/files/ticket12173/script.sh.gz);
-* [attachment: trac_12173-fixes-v4.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v4.patch.gz), non-easily scriptable changes and fixes for spurious changes;
-* [attachment: trac_12173-doctests.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests.patch.gz), fix doctests, add some.
+* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12713_script.sh](https://github.com/sagemath/sage/files/ticket12173/12713_script.sh.gz);
+* [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;
+* [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
 
 **Apply** to SAGE_ROOT:
 * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
``````




---

archive/issue_comments_130918.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12713_script.sh](https://github.com/sagemath/sage/files/ticket12173/12713_script.sh.gz);\n+* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);\n * [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n \n``````\n",
    "created_at": "2013-04-17T11:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130918",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12713_script.sh](https://github.com/sagemath/sage/files/ticket12173/12713_script.sh.gz);
+* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);
 * [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
 
``````




---

archive/issue_comments_130919.json:
```json
{
    "body": "<div id=\"comment:278\" align=\"right\">comment:278</div>\n\nSorry, I was wrong. The three patches aren't the same as the original, there is an additional move of `zmod_poly.pxd` to `nmod_poly.pxd` and similar for `zmod_poly_linkage.pxi`.",
    "created_at": "2013-04-17T11:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130919",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:278" align="right">comment:278</div>

Sorry, I was wrong. The three patches aren't the same as the original, there is an additional move of `zmod_poly.pxd` to `nmod_poly.pxd` and similar for `zmod_poly_linkage.pxi`.



---

archive/issue_comments_130920.json:
```json
{
    "body": "<div id=\"comment:279\" align=\"right\">comment:279</div>\n\nExcept for the renaming of the two zmod_ files to nmod_, except for the CRLF line endings and except for `module_list.py`, the first three patches correspond the the previous split-in-3 patches, while the four patches (with [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz)) correspond to the original all-in-one patch.\n\nTherefore, the file [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz) contains some unexplained changes which were in the original all-in-one patch but not in jpflori's 3 patches. This needs to be clarified.",
    "created_at": "2013-04-17T12:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130920",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:279" align="right">comment:279</div>

Except for the renaming of the two zmod_ files to nmod_, except for the CRLF line endings and except for `module_list.py`, the first three patches correspond the the previous split-in-3 patches, while the four patches (with [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz)) correspond to the original all-in-one patch.

Therefore, the file [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz) contains some unexplained changes which were in the original all-in-one patch but not in jpflori's 3 patches. This needs to be clarified.



---

archive/issue_comments_130921.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,7 @@\n * [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);\n * [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n+* [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz), unexplained changes.\n \n **Apply** to SAGE_ROOT:\n * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n``````\n",
    "created_at": "2013-04-17T12:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130921",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,7 @@
 * [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);
 * [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
+* [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz), unexplained changes.
 
 **Apply** to SAGE_ROOT:
 * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
``````




---

archive/issue_events_163680.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-17T12:05:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163680"
}
```



---

archive/issue_events_163681.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-17T12:05:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163681"
}
```



---

archive/issue_comments_130922.json:
```json
{
    "body": "Changed reviewer from **John Cremona** to **John Cremona, Jeroen Demeyer**",
    "created_at": "2013-04-17T12:05:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130922",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **John Cremona** to **John Cremona, Jeroen Demeyer**



---

archive/issue_comments_130923.json:
```json
{
    "body": "<div id=\"comment:281\" align=\"right\">comment:281</div>\n\nIndeed, some pieces went missing or were inadvertently added.\n* sage/ext/gen_interpreters.py, spurious case change not fixed in the \"fixes\" patch, so this hunk is needed;\n* sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify \"s|sage\\.libs\\.flint\\.long_extras|sage.libs.flint.ulong_extras|g\" in the script by omitting the \"sage.libs\" part\n* sage/libs/flint/fmpq_poly.pxd, ignore this hunk, it just adds a spurious newline\n* sage/libs/flint/fmpz_poly.pxi, the first hunk is needed, not sure where it went; the second hunk is more or less moving lines, in fact we could even order the lines better; the third hunk was plain wrong and now defines twice \"fmpz_poly_scalar_fdiv_ui\", so the solution is to remove that line completely.\n* sage/libs/flint/ntl_interface.pxd, should be applied; ZZ_limbs does not exists anymore, and in fact the previous declaration of fmpz_to_mpz here was misplaced... even though fmpz_get_ZZ is unused, its place is here so the all in one patch is right.\n* sage/modular/modform/eis_series.py, discard this hunk, we forgot to rename a zmod to nmod before (within a comment).\n\nAn additional change would make sense:\n* sage/libs/flint/fmpz_poly.pxi: replace \"fmpz_t fmpz_poly_get_coeff_ptr\" by \"fmpz* fmpz_poly_get_coeff_ptr\", and maybe remove the commented out line (fmpz_poly_scalar_mul), cleanup spaces",
    "created_at": "2013-04-17T12:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130923",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:281" align="right">comment:281</div>

Indeed, some pieces went missing or were inadvertently added.
* sage/ext/gen_interpreters.py, spurious case change not fixed in the "fixes" patch, so this hunk is needed;
* sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify "s|sage\.libs\.flint\.long_extras|sage.libs.flint.ulong_extras|g" in the script by omitting the "sage.libs" part
* sage/libs/flint/fmpq_poly.pxd, ignore this hunk, it just adds a spurious newline
* sage/libs/flint/fmpz_poly.pxi, the first hunk is needed, not sure where it went; the second hunk is more or less moving lines, in fact we could even order the lines better; the third hunk was plain wrong and now defines twice "fmpz_poly_scalar_fdiv_ui", so the solution is to remove that line completely.
* sage/libs/flint/ntl_interface.pxd, should be applied; ZZ_limbs does not exists anymore, and in fact the previous declaration of fmpz_to_mpz here was misplaced... even though fmpz_get_ZZ is unused, its place is here so the all in one patch is right.
* sage/modular/modform/eis_series.py, discard this hunk, we forgot to rename a zmod to nmod before (within a comment).

An additional change would make sense:
* sage/libs/flint/fmpz_poly.pxi: replace "fmpz_t fmpz_poly_get_coeff_ptr" by "fmpz* fmpz_poly_get_coeff_ptr", and maybe remove the commented out line (fmpz_poly_scalar_mul), cleanup spaces



---

archive/issue_comments_130924.json:
```json
{
    "body": "Attachment: **[12173_script.sh.gz](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz)**",
    "created_at": "2013-04-17T12:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130924",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[12173_script.sh.gz](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz)**



---

archive/issue_comments_130925.json:
```json
{
    "body": "Attachment: **[trac_12173-script-v7.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz)**",
    "created_at": "2013-04-17T12:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130925",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[trac_12173-script-v7.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz)**



---

archive/issue_comments_130926.json:
```json
{
    "body": "Attachment: **[trac_12173-fixes-v5.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz)**",
    "created_at": "2013-04-17T12:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130926",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[trac_12173-fixes-v5.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz)**



---

archive/issue_comments_130927.json:
```json
{
    "body": "<div id=\"comment:282\" align=\"right\">comment:282</div>\n\nRemoved trailing whitespace from all patches.",
    "created_at": "2013-04-17T12:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130927",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:282" align="right">comment:282</div>

Removed trailing whitespace from all patches.



---

archive/issue_comments_130928.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n * [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n * [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz), unexplained changes.\n+* [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.\n \n **Apply** to SAGE_ROOT:\n * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n``````\n",
    "created_at": "2013-04-17T12:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130928",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 * [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
 * [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz), unexplained changes.
+* [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.
 
 **Apply** to SAGE_ROOT:
 * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
``````




---

archive/issue_comments_130929.json:
```json
{
    "body": "<div id=\"comment:283\" align=\"right\">comment:283</div>\n\nReplying to [@jpflori](#comment%3A281):\n> * sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify \"s|sage\\.libs\\.flint\\.long_extras|sage.libs.flint.ulong_extras|g\" in the script by omitting the \"sage.libs\" part\n\nDone.",
    "created_at": "2013-04-17T12:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130929",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:283" align="right">comment:283</div>

Replying to [@jpflori](#comment%3A281):
> * sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify "s|sage\.libs\.flint\.long_extras|sage.libs.flint.ulong_extras|g" in the script by omitting the "sage.libs" part

Done.



---

archive/issue_comments_130930.json:
```json
{
    "body": "<div id=\"comment:284\" align=\"right\">comment:284</div>\n\nReplying to [@jdemeyer](#comment%3A283):\n> Replying to [@jpflori](#comment%3A281):\n> > * sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify \"s|sage\\.libs\\.flint\\.long_extras|sage.libs.flint.ulong_extras|g\" in the script by omitting the \"sage.libs\" part\n\n> Done.\n\nDon't you mind taking care of the changes I proposed?\nI also started modifying the script and the fixes patch, but let's not duplicate work.",
    "created_at": "2013-04-17T12:55:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130930",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:284" align="right">comment:284</div>

Replying to [@jdemeyer](#comment%3A283):
> Replying to [@jpflori](#comment%3A281):
> > * sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify "s|sage\.libs\.flint\.long_extras|sage.libs.flint.ulong_extras|g" in the script by omitting the "sage.libs" part

> Done.

Don't you mind taking care of the changes I proposed?
I also started modifying the script and the fixes patch, but let's not duplicate work.



---

archive/issue_comments_130931.json:
```json
{
    "body": "<div id=\"comment:285\" align=\"right\">comment:285</div>\n\nReplying to [@jdemeyer](#comment%3A283):\n> Replying to [@jpflori](#comment%3A281):\n> > * sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify \"s|sage\\.libs\\.flint\\.long_extras|sage.libs.flint.ulong_extras|g\" in the script by omitting the \"sage.libs\" part\n\n> Done.\n\nNevermind, that won't fix the problem.\nWe should rather add \"s|flint/long_extras\\.h|flint/ulong_extras\\.h|g\".\nI'm taking care of that and other fixes now.",
    "created_at": "2013-04-17T13:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130931",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:285" align="right">comment:285</div>

Replying to [@jdemeyer](#comment%3A283):
> Replying to [@jpflori](#comment%3A281):
> > * sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi, I missed this one, we should modify "s|sage\.libs\.flint\.long_extras|sage.libs.flint.ulong_extras|g" in the script by omitting the "sage.libs" part

> Done.

Nevermind, that won't fix the problem.
We should rather add "s|flint/long_extras\.h|flint/ulong_extras\.h|g".
I'm taking care of that and other fixes now.



---

archive/issue_comments_130932.json:
```json
{
    "body": "<div id=\"comment:286\" align=\"right\">comment:286</div>\n\nOops, me too.",
    "created_at": "2013-04-17T13:18:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130932",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:286" align="right">comment:286</div>

Oops, me too.



---

archive/issue_comments_130933.json:
```json
{
    "body": "Attachment: **[trac_12173-doctests-v2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz)**\n\nAttachment: **[trac_12173-extra.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz)**",
    "created_at": "2013-04-17T13:20:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130933",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[trac_12173-doctests-v2.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz)**

Attachment: **[trac_12173-extra.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz)**



---

archive/issue_comments_130934.json:
```json
{
    "body": "Attachment: **[undo.patch.gz](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz)**\n\nOriginal changes, not applied anymore",
    "created_at": "2013-04-17T13:20:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130934",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[undo.patch.gz](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz)**

Original changes, not applied anymore



---

archive/issue_comments_130935.json:
```json
{
    "body": "<div id=\"comment:287\" align=\"right\">comment:287</div>\n\nOK, not making further changes.\n\nI *removed* some hunks and, for reference, I put all removed hunks in [attachment: undo.patch](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz). So this should not be applied, it contains stuff from the original all-in-one patch which are undone.",
    "created_at": "2013-04-17T13:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130935",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:287" align="right">comment:287</div>

OK, not making further changes.

I *removed* some hunks and, for reference, I put all removed hunks in [attachment: undo.patch](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz). So this should not be applied, it contains stuff from the original all-in-one patch which are undone.



---

archive/issue_comments_130936.json:
```json
{
    "body": "<div id=\"comment:288\" align=\"right\">comment:288</div>\n\nReplying to [@jpflori](#comment%3A285):\n> We should rather add \"s|flint/long_extras\\.h|flint/ulong_extras\\.h|g\".\n\nThat's essentially the change I made, it works.",
    "created_at": "2013-04-17T13:23:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130936",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:288" align="right">comment:288</div>

Replying to [@jpflori](#comment%3A285):
> We should rather add "s|flint/long_extras\.h|flint/ulong_extras\.h|g".

That's essentially the change I made, it works.



---

archive/issue_comments_130937.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,10 +2,9 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);\n-* [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n+* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);\n+* [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n-* [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz), unexplained changes.\n * [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.\n \n **Apply** to SAGE_ROOT:\n``````\n",
    "created_at": "2013-04-17T13:41:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130937",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,10 +2,9 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);
-* [attachment: trac_12173-fixes-v5.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v5.patch.gz), non-easily scriptable changes and fixes for spurious changes;
+* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);
+* [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
-* [attachment: trac_12173-extra.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-extra.patch.gz), unexplained changes.
 * [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.
 
 **Apply** to SAGE_ROOT:
``````




---

archive/issue_comments_130938.json:
```json
{
    "body": "<div id=\"comment:290\" align=\"right\">comment:290</div>\n\nYour patches actually undid some of the changes that I made, please fix this. For example, I don't think it is needed to change the script.",
    "created_at": "2013-04-17T13:45:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130938",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:290" align="right">comment:290</div>

Your patches actually undid some of the changes that I made, please fix this. For example, I don't think it is needed to change the script.



---

archive/issue_comments_130939.json:
```json
{
    "body": "<div id=\"comment:291\" align=\"right\">comment:291</div>\n\nIndeed, I did not have the latest version of your script...",
    "created_at": "2013-04-17T13:49:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130939",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:291" align="right">comment:291</div>

Indeed, I did not have the latest version of your script...



---

archive/issue_events_163682.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-17T14:19:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163682"
}
```



---

archive/issue_events_163683.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-17T14:19:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163683"
}
```



---

archive/issue_comments_130940.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);\n+* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);\n * [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n * [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.\n``````\n",
    "created_at": "2013-04-17T14:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130940",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);
+* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);
 * [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
 * [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.
``````




---

archive/issue_comments_130941.json:
```json
{
    "body": "<div id=\"comment:292\" align=\"right\">comment:292</div>\n\nShould be fixed now, I'm getting lost on what versions of everything I actually use now.\n\nApart from the suggestion you had not inlcuded yet,\nI only modified the \"fixes\" patch including new cosmetic changes to \"fmpz_poly.pxi\".\nThe v6 is based on the v5 you posted (and that I hopefully got the right version of and did not mess with some versions I crafted earlier).",
    "created_at": "2013-04-17T14:19:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130941",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:292" align="right">comment:292</div>

Should be fixed now, I'm getting lost on what versions of everything I actually use now.

Apart from the suggestion you had not inlcuded yet,
I only modified the "fixes" patch including new cosmetic changes to "fmpz_poly.pxi".
The v6 is based on the v5 you posted (and that I hopefully got the right version of and did not mess with some versions I crafted earlier).



---

archive/issue_comments_130942.json:
```json
{
    "body": "<div id=\"comment:293\" align=\"right\">comment:293</div>\n\nI also remove a blank line at the top of sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi and break a long line in fmpq_poly.pxd.\nThat should be all.\n\nI did not split long lines in nmod_poly.pxd, there are too many of them and that would not be so useful and the patch would be even less readable, so unless someone really want that we conform strictly to our coding guidelines in that file, I won't do it.",
    "created_at": "2013-04-17T14:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130942",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:293" align="right">comment:293</div>

I also remove a blank line at the top of sage/groups/perm_gps/partn_ref/data_structures_pxd.pxi and break a long line in fmpq_poly.pxd.
That should be all.

I did not split long lines in nmod_poly.pxd, there are too many of them and that would not be so useful and the patch would be even less readable, so unless someone really want that we conform strictly to our coding guidelines in that file, I won't do it.



---

archive/issue_comments_130943.json:
```json
{
    "body": "<div id=\"comment:294\" align=\"right\">comment:294</div>\n\nThere is still something wrong, your [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz) doesn't actually apply cleanly on top of [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz) (probably because I removed some trailing white space).",
    "created_at": "2013-04-17T15:21:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130943",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:294" align="right">comment:294</div>

There is still something wrong, your [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz) doesn't actually apply cleanly on top of [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz) (probably because I removed some trailing white space).



---

archive/issue_comments_130944.json:
```json
{
    "body": "<div id=\"comment:295\" align=\"right\">comment:295</div>\n\nI think I know how to fix the merge conflict, but I give you a chance to fix it first.",
    "created_at": "2013-04-17T15:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130944",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:295" align="right">comment:295</div>

I think I know how to fix the merge conflict, but I give you a chance to fix it first.



---

archive/issue_comments_130945.json:
```json
{
    "body": "<div id=\"comment:296\" align=\"right\">comment:296</div>\n\nAttachment: **[trac_12173-fixes-v6.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz)**\n\nI think the patch was not copied onto my USB key.\nThis one should be ok.",
    "created_at": "2013-04-17T15:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130945",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:296" align="right">comment:296</div>

Attachment: **[trac_12173-fixes-v6.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz)**

I think the patch was not copied onto my USB key.
This one should be ok.



---

archive/issue_comments_130946.json:
```json
{
    "body": "<div id=\"comment:297\" align=\"right\">comment:297</div>\n\nOK, now let's continue the actual review...",
    "created_at": "2013-04-17T15:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130946",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:297" align="right">comment:297</div>

OK, now let's continue the actual review...



---

archive/issue_comments_130947.json:
```json
{
    "body": "<div id=\"comment:298\" align=\"right\">comment:298</div>\n\njpflori: please confirm that you agree **to not apply** the stuff in [attachment: undo.patch](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz)",
    "created_at": "2013-04-17T15:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130947",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:298" align="right">comment:298</div>

jpflori: please confirm that you agree **to not apply** the stuff in [attachment: undo.patch](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz)



---

archive/issue_comments_130948.json:
```json
{
    "body": "<div id=\"comment:299\" align=\"right\">comment:299</div>\n\nReplying to [@jdemeyer](#comment%3A298):\n> jpflori: please confirm that you agree **to not apply** the stuff in [attachment: undo.patch](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz)\n\nYes, I do.",
    "created_at": "2013-04-17T15:40:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130948",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:299" align="right">comment:299</div>

Replying to [@jdemeyer](#comment%3A298):
> jpflori: please confirm that you agree **to not apply** the stuff in [attachment: undo.patch](https://github.com/sagemath/sage/files/ticket12173/undo.patch.gz)

Yes, I do.



---

archive/issue_comments_130949.json:
```json
{
    "body": "Attachment: **[trac_12173-review.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz)**",
    "created_at": "2013-04-18T09:21:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130949",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[trac_12173-review.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz)**



---

archive/issue_comments_130950.json:
```json
{
    "body": "<div id=\"comment:300\" align=\"right\">comment:300</div>\n\nThe following is quite strange:\n\n```\nConfiguring FLINT.\nConfiguring...x86_64-Linux\nTesting __builtin_popcountl...yes\nTesting native popcount..../configure : ligne 315 :  8361 Instruction non permise build/test-popcnt > /dev/null 2>&1\nno\nBuilding FLINT shared library.\n```\n\nThe configure script *dies*, but the result is still zero, so spkg-install still starts to compile!\n\nNotice that the death of the configure script is present in upstream's 2.3 and today's git checkout, so it's not sage-specific.\n\nI have tried to get more information about it : on x86_64, compiling with -mpopcnt works, but running the resulting test file raises an illegal instruction... which kills the configure script without error (!).\n\nI still haven't reported upstream because I saw the problem while testing the spkg in this report. You'll have to actually look at your spkg/logs/flint-2.3.p0.log to see the problem, because the package compiles perfectly.",
    "created_at": "2013-04-21T08:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130950",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:300" align="right">comment:300</div>

The following is quite strange:

```
Configuring FLINT.
Configuring...x86_64-Linux
Testing __builtin_popcountl...yes
Testing native popcount..../configure : ligne 315 :  8361 Instruction non permise build/test-popcnt > /dev/null 2>&1
no
Building FLINT shared library.
```

The configure script *dies*, but the result is still zero, so spkg-install still starts to compile!

Notice that the death of the configure script is present in upstream's 2.3 and today's git checkout, so it's not sage-specific.

I have tried to get more information about it : on x86_64, compiling with -mpopcnt works, but running the resulting test file raises an illegal instruction... which kills the configure script without error (!).

I still haven't reported upstream because I saw the problem while testing the spkg in this report. You'll have to actually look at your spkg/logs/flint-2.3.p0.log to see the problem, because the package compiles perfectly.



---

archive/issue_events_163684.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-04-21T08:15:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163684"
}
```



---

archive/issue_events_163685.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-04-21T08:15:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163685"
}
```



---

archive/issue_comments_130951.json:
```json
{
    "body": "<div id=\"comment:301\" align=\"right\">comment:301</div>\n\nReplying to [@SnarkBoojum](#comment%3A300):\n> The configure script *dies*\n\nAre you sure about this? I'm pretty sure it's not the `configure` script which dies, but a subprogram started by `configure` to test popcount. The `test-popcnt` program dies a horrible death and `configure` correctly concludes (note the \"no\") there is no popcount support.",
    "created_at": "2013-04-21T10:30:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130951",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:301" align="right">comment:301</div>

Replying to [@SnarkBoojum](#comment%3A300):
> The configure script *dies*

Are you sure about this? I'm pretty sure it's not the `configure` script which dies, but a subprogram started by `configure` to test popcount. The `test-popcnt` program dies a horrible death and `configure` correctly concludes (note the "no") there is no popcount support.



---

archive/issue_events_163686.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-21T10:30:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163686"
}
```



---

archive/issue_events_163687.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-21T10:30:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163687"
}
```



---

archive/issue_comments_130952.json:
```json
{
    "body": "<div id=\"comment:302\" align=\"right\">comment:302</div>\n\nReplying to [@SnarkBoojum](#comment%3A300):\n> The following is quite strange:\n> \n> ```\n> Configuring FLINT.\n> Configuring...x86_64-Linux\n> Testing __builtin_popcountl...yes\n> Testing native popcount..../configure : ligne 315 :  8361 Instruction non permise build/test-popcnt > /dev/null 2>&1\n> no\n> Building FLINT shared library.\n> ```\n\nWhat does `bash --version` say?",
    "created_at": "2013-04-21T10:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130952",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:302" align="right">comment:302</div>

Replying to [@SnarkBoojum](#comment%3A300):
> The following is quite strange:
> 
> ```
> Configuring FLINT.
> Configuring...x86_64-Linux
> Testing __builtin_popcountl...yes
> Testing native popcount..../configure : ligne 315 :  8361 Instruction non permise build/test-popcnt > /dev/null 2>&1
> no
> Building FLINT shared library.
> ```

What does `bash --version` say?



---

archive/issue_comments_130953.json:
```json
{
    "body": "<div id=\"comment:303\" align=\"right\">comment:303</div>\n\nConfirmed with `GNU bash, version 4.2.37(1)-release (x86_64-pc-linux-gnu)`\n\nBut really, the bug is just that\n\n```\n./configure : ligne 315 :  8361 Illegal instruction build/test-popcnt > /dev/null 2>&1\n```\nis displayed.\n\nImagine the output simply says\n\n```\nConfiguring FLINT.\nConfiguring...x86_64-Linux\nTesting __builtin_popcountl...yes\nTesting native popcount... no\nBuilding FLINT shared library.\n```",
    "created_at": "2013-04-21T10:47:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130953",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:303" align="right">comment:303</div>

Confirmed with `GNU bash, version 4.2.37(1)-release (x86_64-pc-linux-gnu)`

But really, the bug is just that

```
./configure : ligne 315 :  8361 Illegal instruction build/test-popcnt > /dev/null 2>&1
```
is displayed.

Imagine the output simply says

```
Configuring FLINT.
Configuring...x86_64-Linux
Testing __builtin_popcountl...yes
Testing native popcount... no
Building FLINT shared library.
```



---

archive/issue_comments_130954.json:
```json
{
    "body": "<div id=\"comment:304\" align=\"right\">comment:304</div>\n\nOh, indeed! This is in fact the last test, so it's normal that no more tests are shown. I'll perhaps write and propose a patch to upstream to make the configure script less noisy about this error, and more noisy about the fact that it successfully generated a few files.\n\nI'll just review this ticket from the start now that is settled.",
    "created_at": "2013-04-21T12:21:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130954",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:304" align="right">comment:304</div>

Oh, indeed! This is in fact the last test, so it's normal that no more tests are shown. I'll perhaps write and propose a patch to upstream to make the configure script less noisy about this error, and more noisy about the fact that it successfully generated a few files.

I'll just review this ticket from the start now that is settled.



---

archive/issue_comments_130955.json:
```json
{
    "body": "<div id=\"comment:305\" align=\"right\">comment:305</div>\n\nIn the doctests-v2 patch, I notice there are comments about \"todo: missing auto normalization\" ; but isn't the chunk about normalizing, in which case the comments should go too?\n\nThe patches don't apply to sage-5.8 ; the description didn't mention I was to use something else than the latest stable version.",
    "created_at": "2013-04-21T13:47:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130955",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:305" align="right">comment:305</div>

In the doctests-v2 patch, I notice there are comments about "todo: missing auto normalization" ; but isn't the chunk about normalizing, in which case the comments should go too?

The patches don't apply to sage-5.8 ; the description didn't mention I was to use something else than the latest stable version.



---

archive/issue_events_163688.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-04-21T13:47:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163688"
}
```



---

archive/issue_events_163689.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2013-04-21T13:47:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163689"
}
```



---

archive/issue_comments_130956.json:
```json
{
    "body": "Changed dependencies from **#12433, #14393** to **sage-5.9.beta5**",
    "created_at": "2013-04-21T14:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130956",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#12433, #14393** to **sage-5.9.beta5**



---

archive/issue_comments_130957.json:
```json
{
    "body": "<div id=\"comment:307\" align=\"right\">comment:307</div>\n\nReplying to [@SnarkBoojum](#comment%3A305):\n> The patches don't apply to sage-5.8 ; the description didn't mention I was to use something else than the latest stable version.\n\nWell, the patches' names tell you what they're based on.",
    "created_at": "2013-04-21T14:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130957",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:307" align="right">comment:307</div>

Replying to [@SnarkBoojum](#comment%3A305):
> The patches don't apply to sage-5.8 ; the description didn't mention I was to use something else than the latest stable version.

Well, the patches' names tell you what they're based on.



---

archive/issue_comments_130958.json:
```json
{
    "body": "<div id=\"comment:308\" align=\"right\">comment:308</div>\n\nReplying to [@nexttime](#comment%3A307):\n> Replying to [@SnarkBoojum](#comment%3A305):\n> > The patches don't apply to sage-5.8 ; the description didn't mention I was to use something else than the latest stable version.\n\n> \n> Well, the patches' names tell you what they're based on.\n\nOoops, sorry, they *used to*.",
    "created_at": "2013-04-21T14:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130958",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:308" align="right">comment:308</div>

Replying to [@nexttime](#comment%3A307):
> Replying to [@SnarkBoojum](#comment%3A305):
> > The patches don't apply to sage-5.8 ; the description didn't mention I was to use something else than the latest stable version.

> 
> Well, the patches' names tell you what they're based on.

Ooops, sorry, they *used to*.



---

archive/issue_events_163690.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-22T14:59:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163690"
}
```



---

archive/issue_events_163691.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-04-22T14:59:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163691"
}
```



---

archive/issue_comments_130959.json:
```json
{
    "body": "<div id=\"comment:309\" align=\"right\">comment:309</div>\n\nI think the auto normalizaiton thing has nothing to do with FLINT, it something with the Sage code used.\n\nThe fact that the output of the doctests slightly changed, is because FLINT now deals with fractions a little differently and is better at normalizing the output (less minus signs), but that's not the same normalization as the one quoted in the comment I think.",
    "created_at": "2013-04-22T14:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130959",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:309" align="right">comment:309</div>

I think the auto normalizaiton thing has nothing to do with FLINT, it something with the Sage code used.

The fact that the output of the doctests slightly changed, is because FLINT now deals with fractions a little differently and is better at normalizing the output (less minus signs), but that's not the same normalization as the one quoted in the comment I think.



---

archive/issue_comments_130960.json:
```json
{
    "body": "<div id=\"comment:310\" align=\"right\">comment:310</div>\n\nUnfortunately, there is a problem on OS X 10.4 PPC:\n\n```\nTraceback (most recent call last):\n  File \"./spkg-install\", line 4, in <module>\n    from sage.all import save\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/all.py\", line 81, in <module>\n    from sage.misc.all       import *         # takes a while\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/all.py\", line 87, in <module>\n    from functional import (additive_order,\n  File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 36, in <module>\n    from sage.rings.complex_double import CDF\n  File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:16711)\nImportError: dlopen(/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so, 2): Symbol not found: _n_factor\n  Referenced from: /Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so\n  Expected in: dynamic lookup\n```",
    "created_at": "2013-04-28T10:29:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130960",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:310" align="right">comment:310</div>

Unfortunately, there is a problem on OS X 10.4 PPC:

```
Traceback (most recent call last):
  File "./spkg-install", line 4, in <module>
    from sage.all import save
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/all.py", line 81, in <module>
    from sage.misc.all       import *         # takes a while
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/all.py", line 87, in <module>
    from functional import (additive_order,
  File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/functional.py", line 36, in <module>
    from sage.rings.complex_double import CDF
  File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:16711)
ImportError: dlopen(/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so, 2): Symbol not found: _n_factor
  Referenced from: /Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so
  Expected in: dynamic lookup
```



---

archive/issue_events_163692.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-28T10:29:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163692"
}
```



---

archive/issue_events_163693.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-28T10:29:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163693"
}
```



---

archive/issue_comments_130961.json:
```json
{
    "body": "<div id=\"comment:311\" align=\"right\">comment:311</div>\n\nHere are some comments after reading [attachment: trac_12173-fixes-v6.patch.](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch..gz)\n\nI don't understand this hunk:\n\n```\ndiff --git a/sage/libs/flint/fmpz_poly.pyx b/sage/libs/flint/fmpz_poly.pyx\n--- a/sage/libs/flint/fmpz_poly.pyx\n+++ b/sage/libs/flint/fmpz_poly.pyx\n@@ -53,7 +53,7 @@\n         cdef long c\n         cdef Integer w\n         if PY_TYPE_CHECK(v, str):\n-            if fmpz_poly_set_str(self.poly, v):\n+            if not fmpz_poly_set_str(self.poly, v):\n                 return\n             else:\n                 raise ValueError, \"Unable to create Fmpz_poly from that string.\"\n```\n\n\n`nmod_poly_pow(..., 2)` should be used below instead of `nmod_poly_mul()`.\n\n```\ndiff --git a/sage/libs/flint/nmod_poly_linkage.pxi b/sage/libs/flint/nmod_poly_linkage.pxi\n--- a/sage/libs/flint/nmod_poly_linkage.pxi\n+++ b/sage/libs/flint/nmod_poly_linkage.pxi\n@@ -496,7 +495,7 @@\n     elif e == 1:\n         nmod_poly_set(res, x)\n     elif e == 2:\n-        nmod_poly_sqr(res, x)\n+        nmod_poly_mul(res, x, x)\n     else:\n         if res == x:\n             nmod_poly_set(tmp, x)\n@@ -510,7 +509,7 @@\n             nmod_poly_set_coeff_ui(res, 0, 1)\n         e = e >> 1\n         while(e != 0):\n-            nmod_poly_sqr(pow2, pow2)\n+            nmod_poly_mul(pow2, pow2, pow2)\n             if e % 2:\n                 nmod_poly_mul(res, res, pow2)\n             e = e >> 1\n```\n\nThis seems to remove the fast exit path:\n\n```\ndiff --git a/sage/rings/fraction_field_FpT.pyx b/sage/rings/fraction_field_FpT.pyx\n--- a/sage/rings/fraction_field_FpT.pyx\n+++ b/sage/rings/fraction_field_FpT.pyx\n@@ -688,26 +688,34 @@\n         \"\"\"\n         if nmod_poly_degree(self._numer) == -1:\n             return self\n-        if not nmod_poly_sqrt_check(self._numer) or not nmod_poly_sqrt_check(self._denom):\n-            return None\n```\n\nFredrik says that FLINT also does the same checks in `nmod_poly_sqrt()`, but some memory allocations are performed by the time we get to that point. If the input to this function is not a perfect square most of the time, then IMHO removing these checks will introduce a performance regression.\n\nIn the same hunk as above:\n\n```\n+            # Make denominator monic\n+            a = nmod_poly_leading(denom)\n+            if a != 1:\n+                a = mod_inverse_int(a, self.p)\n+                nmod_poly_scalar_mul_nmod(numer, numer, a)\n+                nmod_poly_scalar_mul_nmod(denom, denom, a)\n+            # Choose numerator with smaller leading coefficient\n+            a = nmod_poly_leading(numer)\n+            if a > self.p - a:\n+                nmod_poly_neg(numer, numer)\n```\n\nIs this necessary? If the input is normalized, the denominator will have 1 as a leading coefficient anyway. If we really want to normalize, the `normalize()` method in the same file should be used.\n\n\n`_nmod_poly_set_coeff_ui()` was removed from FLINT2. Removing the underscore introduces a potential branch for each function call. Shall we implement our own underscore version?\n\n```\ndiff --git a/sage/rings/polynomial/polynomial_zmod_flint.pyx b/sage/rings/polynomial/polynomial_zmod_flint.pyx\n--- a/sage/rings/polynomial/polynomial_zmod_flint.pyx\n+++ b/sage/rings/polynomial/polynomial_zmod_flint.pyx\n@@ -157,17 +170,47 @@\n<snip>\n+        sig_on()\n         for i from 0 <= i < length:\n-            _nmod_poly_set_coeff_ui(&self.x, i, l_in[i])\n-        # we need to set the length manually, we used _nmod_poly_set_coeff_ui\n-        self.x.length = length\n+            nmod_poly_set_coeff_ui(&self.x, i, l_in[i])\n+        sig_off()\n+        return 0\n```",
    "created_at": "2013-05-05T16:58:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130961",
    "user": "https://github.com/burcin"
}
```

<div id="comment:311" align="right">comment:311</div>

Here are some comments after reading [attachment: trac_12173-fixes-v6.patch.](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch..gz)

I don't understand this hunk:

```
diff --git a/sage/libs/flint/fmpz_poly.pyx b/sage/libs/flint/fmpz_poly.pyx
--- a/sage/libs/flint/fmpz_poly.pyx
+++ b/sage/libs/flint/fmpz_poly.pyx
@@ -53,7 +53,7 @@
         cdef long c
         cdef Integer w
         if PY_TYPE_CHECK(v, str):
-            if fmpz_poly_set_str(self.poly, v):
+            if not fmpz_poly_set_str(self.poly, v):
                 return
             else:
                 raise ValueError, "Unable to create Fmpz_poly from that string."
```


`nmod_poly_pow(..., 2)` should be used below instead of `nmod_poly_mul()`.

```
diff --git a/sage/libs/flint/nmod_poly_linkage.pxi b/sage/libs/flint/nmod_poly_linkage.pxi
--- a/sage/libs/flint/nmod_poly_linkage.pxi
+++ b/sage/libs/flint/nmod_poly_linkage.pxi
@@ -496,7 +495,7 @@
     elif e == 1:
         nmod_poly_set(res, x)
     elif e == 2:
-        nmod_poly_sqr(res, x)
+        nmod_poly_mul(res, x, x)
     else:
         if res == x:
             nmod_poly_set(tmp, x)
@@ -510,7 +509,7 @@
             nmod_poly_set_coeff_ui(res, 0, 1)
         e = e >> 1
         while(e != 0):
-            nmod_poly_sqr(pow2, pow2)
+            nmod_poly_mul(pow2, pow2, pow2)
             if e % 2:
                 nmod_poly_mul(res, res, pow2)
             e = e >> 1
```

This seems to remove the fast exit path:

```
diff --git a/sage/rings/fraction_field_FpT.pyx b/sage/rings/fraction_field_FpT.pyx
--- a/sage/rings/fraction_field_FpT.pyx
+++ b/sage/rings/fraction_field_FpT.pyx
@@ -688,26 +688,34 @@
         """
         if nmod_poly_degree(self._numer) == -1:
             return self
-        if not nmod_poly_sqrt_check(self._numer) or not nmod_poly_sqrt_check(self._denom):
-            return None
```

Fredrik says that FLINT also does the same checks in `nmod_poly_sqrt()`, but some memory allocations are performed by the time we get to that point. If the input to this function is not a perfect square most of the time, then IMHO removing these checks will introduce a performance regression.

In the same hunk as above:

```
+            # Make denominator monic
+            a = nmod_poly_leading(denom)
+            if a != 1:
+                a = mod_inverse_int(a, self.p)
+                nmod_poly_scalar_mul_nmod(numer, numer, a)
+                nmod_poly_scalar_mul_nmod(denom, denom, a)
+            # Choose numerator with smaller leading coefficient
+            a = nmod_poly_leading(numer)
+            if a > self.p - a:
+                nmod_poly_neg(numer, numer)
```

Is this necessary? If the input is normalized, the denominator will have 1 as a leading coefficient anyway. If we really want to normalize, the `normalize()` method in the same file should be used.


`_nmod_poly_set_coeff_ui()` was removed from FLINT2. Removing the underscore introduces a potential branch for each function call. Shall we implement our own underscore version?

```
diff --git a/sage/rings/polynomial/polynomial_zmod_flint.pyx b/sage/rings/polynomial/polynomial_zmod_flint.pyx
--- a/sage/rings/polynomial/polynomial_zmod_flint.pyx
+++ b/sage/rings/polynomial/polynomial_zmod_flint.pyx
@@ -157,17 +170,47 @@
<snip>
+        sig_on()
         for i from 0 <= i < length:
-            _nmod_poly_set_coeff_ui(&self.x, i, l_in[i])
-        # we need to set the length manually, we used _nmod_poly_set_coeff_ui
-        self.x.length = length
+            nmod_poly_set_coeff_ui(&self.x, i, l_in[i])
+        sig_off()
+        return 0
```



---

archive/issue_comments_130962.json:
```json
{
    "body": "<div id=\"comment:312\" align=\"right\">comment:312</div>\n\nReplying to [@burcin](#comment%3A311):\n> Here are some comments after reading [attachment: trac_12173-fixes-v6.patch.](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch..gz)\n> \n> I don't understand this hunk:\n> \n> ```\n> diff --git a/sage/libs/flint/fmpz_poly.pyx b/sage/libs/flint/fmpz_poly.pyx\n> --- a/sage/libs/flint/fmpz_poly.pyx\n> +++ b/sage/libs/flint/fmpz_poly.pyx\n> @@ -53,7 +53,7 @@\n>          cdef long c\n>          cdef Integer w\n>          if PY_TYPE_CHECK(v, str):\n> -            if fmpz_poly_set_str(self.poly, v):\n> +            if not fmpz_poly_set_str(self.poly, v):\n>                  return\n>              else:\n>                  raise ValueError, \"Unable to create Fmpz_poly from that string.\"\n> ```\n\nIndeed, this looks wrong.\nThis also shows this function does not seem to be well tested.\n> \n> \n> `nmod_poly_pow(..., 2)` should be used below instead of `nmod_poly_mul()`.\n> \n> ```\n> diff --git a/sage/libs/flint/nmod_poly_linkage.pxi b/sage/libs/flint/nmod_poly_linkage.pxi\n> --- a/sage/libs/flint/nmod_poly_linkage.pxi\n> +++ b/sage/libs/flint/nmod_poly_linkage.pxi\n> @@ -496,7 +495,7 @@\n>      elif e == 1:\n>          nmod_poly_set(res, x)\n>      elif e == 2:\n> -        nmod_poly_sqr(res, x)\n> +        nmod_poly_mul(res, x, x)\n>      else:\n>          if res == x:\n>              nmod_poly_set(tmp, x)\n> @@ -510,7 +509,7 @@\n>              nmod_poly_set_coeff_ui(res, 0, 1)\n>          e = e >> 1\n>          while(e != 0):\n> -            nmod_poly_sqr(pow2, pow2)\n> +            nmod_poly_mul(pow2, pow2, pow2)\n>              if e % 2:\n>                  nmod_poly_mul(res, res, pow2)\n>              e = e >> 1\n> ```\n\nsure, but I wouldn't say that's a critical issue.\n> \n> This seems to remove the fast exit path:\n> \n> ```\n> diff --git a/sage/rings/fraction_field_FpT.pyx b/sage/rings/fraction_field_FpT.pyx\n> --- a/sage/rings/fraction_field_FpT.pyx\n> +++ b/sage/rings/fraction_field_FpT.pyx\n> @@ -688,26 +688,34 @@\n>          \"\"\"\n>          if nmod_poly_degree(self._numer) == -1:\n>              return self\n> -        if not nmod_poly_sqrt_check(self._numer) or not nmod_poly_sqrt_check(self._denom):\n> -            return None\n> ```\n> \n> Fredrik says that FLINT also does the same checks in `nmod_poly_sqrt()`, but some memory allocations are performed by the time we get to that point. If the input to this function is not a perfect square most of the time, then IMHO removing these checks will introduce a performance regression.\n\nI think the best place for such a function would be in FLINT itself.\nThe problem is that if we plan on integrating this ticket without calling this to be implemented function (I'd prefer to go this way, let's not wait for another couple of monthes/years to merge this ticket), we should make sure to not forget to call it from Sage when it actually gets implemented in (a stable release of) FLINT, so we should surely open a follow-up ticket.\n> \n> In the same hunk as above:\n> \n> ```\n> +            # Make denominator monic\n> +            a = nmod_poly_leading(denom)\n> +            if a != 1:\n> +                a = mod_inverse_int(a, self.p)\n> +                nmod_poly_scalar_mul_nmod(numer, numer, a)\n> +                nmod_poly_scalar_mul_nmod(denom, denom, a)\n> +            # Choose numerator with smaller leading coefficient\n> +            a = nmod_poly_leading(numer)\n> +            if a > self.p - a:\n> +                nmod_poly_neg(numer, numer)\n> ```\n> \n> Is this necessary? If the input is normalized, the denominator will have 1 as a leading coefficient anyway. If we really want to normalize, the `normalize()` method in the same file should be used.\n\nSure, I'll have  alook at the code.\n> \n> \n> `_nmod_poly_set_coeff_ui()` was removed from FLINT2. Removing the underscore introduces a potential branch for each function call. Shall we implement our own underscore version?\n> \n\nI'd say no, if that's useful, it should be in FLINT.\n> \n> ```\n> diff --git a/sage/rings/polynomial/polynomial_zmod_flint.pyx b/sage/rings/polynomial/polynomial_zmod_flint.pyx\n> --- a/sage/rings/polynomial/polynomial_zmod_flint.pyx\n> +++ b/sage/rings/polynomial/polynomial_zmod_flint.pyx\n> @@ -157,17 +170,47 @@\n> <snip>\n> +        sig_on()\n>          for i from 0 <= i < length:\n> -            _nmod_poly_set_coeff_ui(&self.x, i, l_in[i])\n> -        # we need to set the length manually, we used _nmod_poly_set_coeff_ui\n> -        self.x.length = length\n> +            nmod_poly_set_coeff_ui(&self.x, i, l_in[i])\n> +        sig_off()\n> +        return 0\n> ```",
    "created_at": "2013-05-06T11:35:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130962",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:312" align="right">comment:312</div>

Replying to [@burcin](#comment%3A311):
> Here are some comments after reading [attachment: trac_12173-fixes-v6.patch.](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch..gz)
> 
> I don't understand this hunk:
> 
> ```
> diff --git a/sage/libs/flint/fmpz_poly.pyx b/sage/libs/flint/fmpz_poly.pyx
> --- a/sage/libs/flint/fmpz_poly.pyx
> +++ b/sage/libs/flint/fmpz_poly.pyx
> @@ -53,7 +53,7 @@
>          cdef long c
>          cdef Integer w
>          if PY_TYPE_CHECK(v, str):
> -            if fmpz_poly_set_str(self.poly, v):
> +            if not fmpz_poly_set_str(self.poly, v):
>                  return
>              else:
>                  raise ValueError, "Unable to create Fmpz_poly from that string."
> ```

Indeed, this looks wrong.
This also shows this function does not seem to be well tested.
> 
> 
> `nmod_poly_pow(..., 2)` should be used below instead of `nmod_poly_mul()`.
> 
> ```
> diff --git a/sage/libs/flint/nmod_poly_linkage.pxi b/sage/libs/flint/nmod_poly_linkage.pxi
> --- a/sage/libs/flint/nmod_poly_linkage.pxi
> +++ b/sage/libs/flint/nmod_poly_linkage.pxi
> @@ -496,7 +495,7 @@
>      elif e == 1:
>          nmod_poly_set(res, x)
>      elif e == 2:
> -        nmod_poly_sqr(res, x)
> +        nmod_poly_mul(res, x, x)
>      else:
>          if res == x:
>              nmod_poly_set(tmp, x)
> @@ -510,7 +509,7 @@
>              nmod_poly_set_coeff_ui(res, 0, 1)
>          e = e >> 1
>          while(e != 0):
> -            nmod_poly_sqr(pow2, pow2)
> +            nmod_poly_mul(pow2, pow2, pow2)
>              if e % 2:
>                  nmod_poly_mul(res, res, pow2)
>              e = e >> 1
> ```

sure, but I wouldn't say that's a critical issue.
> 
> This seems to remove the fast exit path:
> 
> ```
> diff --git a/sage/rings/fraction_field_FpT.pyx b/sage/rings/fraction_field_FpT.pyx
> --- a/sage/rings/fraction_field_FpT.pyx
> +++ b/sage/rings/fraction_field_FpT.pyx
> @@ -688,26 +688,34 @@
>          """
>          if nmod_poly_degree(self._numer) == -1:
>              return self
> -        if not nmod_poly_sqrt_check(self._numer) or not nmod_poly_sqrt_check(self._denom):
> -            return None
> ```
> 
> Fredrik says that FLINT also does the same checks in `nmod_poly_sqrt()`, but some memory allocations are performed by the time we get to that point. If the input to this function is not a perfect square most of the time, then IMHO removing these checks will introduce a performance regression.

I think the best place for such a function would be in FLINT itself.
The problem is that if we plan on integrating this ticket without calling this to be implemented function (I'd prefer to go this way, let's not wait for another couple of monthes/years to merge this ticket), we should make sure to not forget to call it from Sage when it actually gets implemented in (a stable release of) FLINT, so we should surely open a follow-up ticket.
> 
> In the same hunk as above:
> 
> ```
> +            # Make denominator monic
> +            a = nmod_poly_leading(denom)
> +            if a != 1:
> +                a = mod_inverse_int(a, self.p)
> +                nmod_poly_scalar_mul_nmod(numer, numer, a)
> +                nmod_poly_scalar_mul_nmod(denom, denom, a)
> +            # Choose numerator with smaller leading coefficient
> +            a = nmod_poly_leading(numer)
> +            if a > self.p - a:
> +                nmod_poly_neg(numer, numer)
> ```
> 
> Is this necessary? If the input is normalized, the denominator will have 1 as a leading coefficient anyway. If we really want to normalize, the `normalize()` method in the same file should be used.

Sure, I'll have  alook at the code.
> 
> 
> `_nmod_poly_set_coeff_ui()` was removed from FLINT2. Removing the underscore introduces a potential branch for each function call. Shall we implement our own underscore version?
> 

I'd say no, if that's useful, it should be in FLINT.
> 
> ```
> diff --git a/sage/rings/polynomial/polynomial_zmod_flint.pyx b/sage/rings/polynomial/polynomial_zmod_flint.pyx
> --- a/sage/rings/polynomial/polynomial_zmod_flint.pyx
> +++ b/sage/rings/polynomial/polynomial_zmod_flint.pyx
> @@ -157,17 +170,47 @@
> <snip>
> +        sig_on()
>          for i from 0 <= i < length:
> -            _nmod_poly_set_coeff_ui(&self.x, i, l_in[i])
> -        # we need to set the length manually, we used _nmod_poly_set_coeff_ui
> -        self.x.length = length
> +            nmod_poly_set_coeff_ui(&self.x, i, l_in[i])
> +        sig_off()
> +        return 0
> ```



---

archive/issue_comments_130963.json:
```json
{
    "body": "<div id=\"comment:313\" align=\"right\">comment:313</div>\n\nReplying to [@jdemeyer](#comment%3A310):\n> Unfortunately, there is a problem on OS X 10.4 PPC:\n> \n> ```\n> Traceback (most recent call last):\n>   File \"./spkg-install\", line 4, in <module>\n>     from sage.all import save\n>   File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/all.py\", line 81, in <module>\n>     from sage.misc.all       import *         # takes a while\n>   File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/all.py\", line 87, in <module>\n>     from functional import (additive_order,\n>   File \"/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/functional.py\", line 36, in <module>\n>     from sage.rings.complex_double import CDF\n>   File \"integer.pxd\", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:16711)\n> ImportError: dlopen(/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so, 2): Symbol not found: _n_factor\n>   Referenced from: /Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so\n>   Expected in: dynamic lookup\n> ```\n\nAny chance to get the FLINt build log? (and to know what file it produced? libflint.dylib i presume.)\nAnd some \"otool -L\" output on integer.so?\n(By the way is it expected that the cython produced file end in .so and not in .dylib on Mac OS?)",
    "created_at": "2013-05-06T12:56:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130963",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:313" align="right">comment:313</div>

Replying to [@jdemeyer](#comment%3A310):
> Unfortunately, there is a problem on OS X 10.4 PPC:
> 
> ```
> Traceback (most recent call last):
>   File "./spkg-install", line 4, in <module>
>     from sage.all import save
>   File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/all.py", line 81, in <module>
>     from sage.misc.all       import *         # takes a while
>   File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/all.py", line 87, in <module>
>     from functional import (additive_order,
>   File "/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/misc/functional.py", line 36, in <module>
>     from sage.rings.complex_double import CDF
>   File "integer.pxd", line 9, in init sage.rings.complex_double (sage/rings/complex_double.c:16711)
> ImportError: dlopen(/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so, 2): Symbol not found: _n_factor
>   Referenced from: /Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta1/local/lib/python2.7/site-packages/sage/rings/integer.so
>   Expected in: dynamic lookup
> ```

Any chance to get the FLINt build log? (and to know what file it produced? libflint.dylib i presume.)
And some "otool -L" output on integer.so?
(By the way is it expected that the cython produced file end in .so and not in .dylib on Mac OS?)



---

archive/issue_comments_130964.json:
```json
{
    "body": "<div id=\"comment:314\" align=\"right\">comment:314</div>\n\nI think i found one build log at http://build.sagemath.org/sage/builders/UGent%20moufang%20%28OSX%2010.4%20ppc32%29/builds/197/steps/shell_6/logs/flint\n\nAnd it seems something is broken in FLINT configuration:\n\n```\ngcc -fPIC -O2 -g -ansi -pedantic -Wall   -m64 -mcpu=970 -mtune=970 -mpowerpc64 -falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16 -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/spkg/build/flint-2.3.p0/src -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/local/include -c clz_tab.c -o build/clz_tab.lo;\n```\ndoes not look that good on a ppc32 (which I assume to be 32 bits) computer.",
    "created_at": "2013-05-06T13:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130964",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:314" align="right">comment:314</div>

I think i found one build log at http://build.sagemath.org/sage/builders/UGent%20moufang%20%28OSX%2010.4%20ppc32%29/builds/197/steps/shell_6/logs/flint

And it seems something is broken in FLINT configuration:

```
gcc -fPIC -O2 -g -ansi -pedantic -Wall   -m64 -mcpu=970 -mtune=970 -mpowerpc64 -falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16 -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/spkg/build/flint-2.3.p0/src -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta0/local/include -c clz_tab.c -o build/clz_tab.lo;
```
does not look that good on a ppc32 (which I assume to be 32 bits) computer.



---

archive/issue_comments_130965.json:
```json
{
    "body": "<div id=\"comment:315\" align=\"right\">comment:315</div>\n\nAnd the problematic lines are:\n\n```\n   elif [ \"$KERNEL\" = \"Darwin\" -a \"$ARCH\" = \"ppc\" ]; then\n      FLINT_TUNE=\" -funroll-loops\"\n   elif [ \"`uname -p`\" = \"powerpc\" ]; then\n      FLINT_TUNE=\"-m64 -mcpu=970 -mtune=970 -mpowerpc64 -falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16\"\n```\nin FLINT configure.\nOf course I don't remember for which kind of cpus the uname -p stuff was put in FLINT 1.",
    "created_at": "2013-05-06T13:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130965",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:315" align="right">comment:315</div>

And the problematic lines are:

```
   elif [ "$KERNEL" = "Darwin" -a "$ARCH" = "ppc" ]; then
      FLINT_TUNE=" -funroll-loops"
   elif [ "`uname -p`" = "powerpc" ]; then
      FLINT_TUNE="-m64 -mcpu=970 -mtune=970 -mpowerpc64 -falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16"
```
in FLINT configure.
Of course I don't remember for which kind of cpus the uname -p stuff was put in FLINT 1.



---

archive/issue_comments_130966.json:
```json
{
    "body": "<div id=\"comment:316\" align=\"right\">comment:316</div>\n\nHum, its not from FLINT 1, but was added in FLINT 2 to catch PowerG5 cpus I guess.\nThe problem is likely to be that Sage builds 32 bits by default on OS X 10.4 (and 10.5) (see http://www.sagemath.org/doc/installation/source.html and the stuff about SAGE64), but FLINT 2 wants to be too smart and forces the build of a 64 bits library (because it has detected the cpu has such capabilities).",
    "created_at": "2013-05-06T13:20:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130966",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:316" align="right">comment:316</div>

Hum, its not from FLINT 1, but was added in FLINT 2 to catch PowerG5 cpus I guess.
The problem is likely to be that Sage builds 32 bits by default on OS X 10.4 (and 10.5) (see http://www.sagemath.org/doc/installation/source.html and the stuff about SAGE64), but FLINT 2 wants to be too smart and forces the build of a 64 bits library (because it has detected the cpu has such capabilities).



---

archive/issue_comments_130967.json:
```json
{
    "body": "<div id=\"comment:317\" align=\"right\">comment:317</div>\n\nReplying to [@jpflori](#comment%3A312):\n> The problem is that if we plan on integrating this ticket without calling this to be implemented function (I'd prefer to go this way, let's not wait for another couple of monthes/years to merge this ticket), we should make sure to not forget to call it from Sage when it actually gets implemented in (a stable release of) FLINT, so we should surely open a follow-up ticket.\n\nI suggest we revert these hunks and put the code for `nmod_poly_sqrt_check()` back. I wasn't trying to suggest that we implement these in FLINT and wait for the next release. I'd really like to get this ticket resolved by the end of the week.",
    "created_at": "2013-05-06T13:21:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130967",
    "user": "https://github.com/burcin"
}
```

<div id="comment:317" align="right">comment:317</div>

Replying to [@jpflori](#comment%3A312):
> The problem is that if we plan on integrating this ticket without calling this to be implemented function (I'd prefer to go this way, let's not wait for another couple of monthes/years to merge this ticket), we should make sure to not forget to call it from Sage when it actually gets implemented in (a stable release of) FLINT, so we should surely open a follow-up ticket.

I suggest we revert these hunks and put the code for `nmod_poly_sqrt_check()` back. I wasn't trying to suggest that we implement these in FLINT and wait for the next release. I'd really like to get this ticket resolved by the end of the week.



---

archive/issue_comments_130968.json:
```json
{
    "body": "<div id=\"comment:318\" align=\"right\">comment:318</div>\n\nReplying to [@jpflori](#comment%3A316):\n> FLINT 2 wants to be too smart\n\nFor certain values of \"smart\" I guess. Rolling your own `configure` system is almost certainly a bad idea. One should never just add `-m32` or `-m64` to the `CFLAGS`. I would also avoid adding the `-mtune` and `-mcpu` options.",
    "created_at": "2013-05-06T13:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130968",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:318" align="right">comment:318</div>

Replying to [@jpflori](#comment%3A316):
> FLINT 2 wants to be too smart

For certain values of "smart" I guess. Rolling your own `configure` system is almost certainly a bad idea. One should never just add `-m32` or `-m64` to the `CFLAGS`. I would also avoid adding the `-mtune` and `-mcpu` options.



---

archive/issue_comments_130969.json:
```json
{
    "body": "<div id=\"comment:319\" align=\"right\">comment:319</div>\n\nReplying to [@burcin](#comment%3A317):\n> Replying to [@jpflori](#comment%3A312):\n> > The problem is that if we plan on integrating this ticket without calling this to be implemented function (I'd prefer to go this way, let's not wait for another couple of monthes/years to merge this ticket), we should make sure to not forget to call it from Sage when it actually gets implemented in (a stable release of) FLINT, so we should surely open a follow-up ticket.\n\n> \n> I suggest we revert these hunks and put the code for `nmod_poly_sqrt_check()` back. I \n> wasn't trying to suggest that we implement these in FLINT and wait for the next release. \n\nThe function used to be three lines of calls to FLINT C functions, so it should be trivial to add to FLINT 2 (although refactoring the nmod_poly_sqrt function so that it uses the _check function in a proper way could need (a little) more thoughts).\nTherefore, what I'd prefer to do is to push something on github and let Bill pull it to FLINT's trunk.\nAnd we should then use this backported patch in our spkg.\nSo when this gets into a stable version of FLINT, we'll only have to update the spkg and delete the patch.\nSame feeling for the underscore set_ui method.\n>I'd really like to get this ticket resolved by the end of the week.\n\nSame here!",
    "created_at": "2013-05-06T13:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130969",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:319" align="right">comment:319</div>

Replying to [@burcin](#comment%3A317):
> Replying to [@jpflori](#comment%3A312):
> > The problem is that if we plan on integrating this ticket without calling this to be implemented function (I'd prefer to go this way, let's not wait for another couple of monthes/years to merge this ticket), we should make sure to not forget to call it from Sage when it actually gets implemented in (a stable release of) FLINT, so we should surely open a follow-up ticket.

> 
> I suggest we revert these hunks and put the code for `nmod_poly_sqrt_check()` back. I 
> wasn't trying to suggest that we implement these in FLINT and wait for the next release. 

The function used to be three lines of calls to FLINT C functions, so it should be trivial to add to FLINT 2 (although refactoring the nmod_poly_sqrt function so that it uses the _check function in a proper way could need (a little) more thoughts).
Therefore, what I'd prefer to do is to push something on github and let Bill pull it to FLINT's trunk.
And we should then use this backported patch in our spkg.
So when this gets into a stable version of FLINT, we'll only have to update the spkg and delete the patch.
Same feeling for the underscore set_ui method.
>I'd really like to get this ticket resolved by the end of the week.

Same here!



---

archive/issue_comments_130970.json:
```json
{
    "body": "<div id=\"comment:320\" align=\"right\">comment:320</div>\n\nReplying to [@jdemeyer](#comment%3A318):\n> Replying to [@jpflori](#comment%3A316):\n> > FLINT 2 wants to be too smart\n\n> For certain values of \"smart\" I guess. Rolling your own `configure` system is almost certainly a bad idea. One should never just add `-m32` or `-m64` to the `CFLAGS`. I would also avoid adding the `-mtune` and `-mcpu` options.\n\nI agree, the compiler should be smart enough to decide what to compile by default, and the user should take the responsibility to pass such options.",
    "created_at": "2013-05-06T14:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130970",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:320" align="right">comment:320</div>

Replying to [@jdemeyer](#comment%3A318):
> Replying to [@jpflori](#comment%3A316):
> > FLINT 2 wants to be too smart

> For certain values of "smart" I guess. Rolling your own `configure` system is almost certainly a bad idea. One should never just add `-m32` or `-m64` to the `CFLAGS`. I would also avoid adding the `-mtune` and `-mcpu` options.

I agree, the compiler should be smart enough to decide what to compile by default, and the user should take the responsibility to pass such options.



---

archive/issue_comments_130971.json:
```json
{
    "body": "Fix for PowerPC G5",
    "created_at": "2013-05-06T15:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130971",
    "user": "https://github.com/jpflori"
}
```

Fix for PowerPC G5



---

archive/issue_comments_130972.json:
```json
{
    "body": "Attachment: **[powerpcg5.patch.gz](https://github.com/sagemath/sage/files/ticket12173/powerpcg5.patch.gz)**\n\nAttachment: **[trac_12173-ffixes.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-ffixes.patch.gz)**\n\nFurther fixes",
    "created_at": "2013-05-07T09:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130972",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[powerpcg5.patch.gz](https://github.com/sagemath/sage/files/ticket12173/powerpcg5.patch.gz)**

Attachment: **[trac_12173-ffixes.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-ffixes.patch.gz)**

Further fixes



---

archive/issue_comments_130973.json:
```json
{
    "body": "Attachment: **[powerpcg5.diff.gz](https://github.com/sagemath/sage/files/ticket12173/powerpcg5.diff.gz)**\n\nPowerPC G5 spkg diff, review only.",
    "created_at": "2013-05-07T09:27:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130973",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[powerpcg5.diff.gz](https://github.com/sagemath/sage/files/ticket12173/powerpcg5.diff.gz)**

PowerPC G5 spkg diff, review only.



---

archive/issue_comments_130974.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n * [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n * [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.\n+* [attachment: trac_12173-ffixes.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-ffixes.patch.gz), further fixes after Burcin's review.\n \n **Apply** to SAGE_ROOT:\n * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n``````\n",
    "created_at": "2013-05-07T09:31:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130974",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 * [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
 * [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.
+* [attachment: trac_12173-ffixes.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-ffixes.patch.gz), further fixes after Burcin's review.
 
 **Apply** to SAGE_ROOT:
 * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
``````




---

archive/issue_events_163694.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-05-07T09:31:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163694"
}
```



---

archive/issue_events_163695.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-05-07T09:31:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163695"
}
```



---

archive/issue_comments_130975.json:
```json
{
    "body": "<div id=\"comment:321\" align=\"right\">comment:321</div>\n\nOk, here comes a new patch to apply taking Burcin's review into account.\n\nThe spkg at the previous address has been updated to include the fix for PowerPC G5.\nIt's being discussed upstream and should get in at some point.\n\nI'm starting a \"make ptestlong\" right now on top of 5.10.beta1 (already tested some files directly related to FLINT).",
    "created_at": "2013-05-07T09:31:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130975",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:321" align="right">comment:321</div>

Ok, here comes a new patch to apply taking Burcin's review into account.

The spkg at the previous address has been updated to include the fix for PowerPC G5.
It's being discussed upstream and should get in at some point.

I'm starting a "make ptestlong" right now on top of 5.10.beta1 (already tested some files directly related to FLINT).



---

archive/issue_comments_130976.json:
```json
{
    "body": "<div id=\"comment:322\" align=\"right\">comment:322</div>\n\nBy the way, the doctests in fmpz_poly.pyx are formatted in an ugly way.",
    "created_at": "2013-05-07T09:33:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130976",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:322" align="right">comment:322</div>

By the way, the doctests in fmpz_poly.pyx are formatted in an ugly way.



---

archive/issue_comments_130977.json:
```json
{
    "body": "<div id=\"comment:323\" align=\"right\">comment:323</div>\n\nIll be updating the script to clean up that file and merge patch which should be (i.e fixes + review + ffixes) when I've built a clean Sage 5.10.beta1.",
    "created_at": "2013-05-07T09:54:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130977",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:323" align="right">comment:323</div>

Ill be updating the script to clean up that file and merge patch which should be (i.e fixes + review + ffixes) when I've built a clean Sage 5.10.beta1.



---

archive/issue_comments_130978.json:
```json
{
    "body": "Update script to cleanup fmpz_poly.pyx",
    "created_at": "2013-05-07T11:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130978",
    "user": "https://github.com/jpflori"
}
```

Update script to cleanup fmpz_poly.pyx



---

archive/issue_comments_130979.json:
```json
{
    "body": "Attachment: **[12173_script-v2.sh.gz](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz)**\n\nAttachment: **[trac_12173-script-v8.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz)**",
    "created_at": "2013-05-07T11:23:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130979",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[12173_script-v2.sh.gz](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz)**

Attachment: **[trac_12173-script-v8.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz)**



---

archive/issue_comments_130980.json:
```json
{
    "body": "Attachment: **[trac_12173-fixes-v7.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v7.patch.gz)**\n\nMerged fixes",
    "created_at": "2013-05-07T11:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130980",
    "user": "https://github.com/jpflori"
}
```

Attachment: **[trac_12173-fixes-v7.patch.gz](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v7.patch.gz)**

Merged fixes



---

archive/issue_comments_130981.json:
```json
{
    "body": "<div id=\"comment:324\" align=\"right\">comment:324</div>\n\nI've updated the patch, please check tat I've not messed up everything.\nApart from that, I think what really needs to be done is to check that the spkg works fine on PowerPC G5 OS X 10.4.",
    "created_at": "2013-05-07T11:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130981",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:324" align="right">comment:324</div>

I've updated the patch, please check tat I've not messed up everything.
Apart from that, I think what really needs to be done is to check that the spkg works fine on PowerPC G5 OS X 10.4.



---

archive/issue_comments_130982.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,11 +2,9 @@\n * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n \n **Apply**:\n-* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);\n-* [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;\n+* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);\n+* [attachment: trac_12173-fixes-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v7.patch.gz), non-easily scriptable changes and fixes for spurious changes, together with reviewers fixes;\n * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.\n-* [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.\n-* [attachment: trac_12173-ffixes.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-ffixes.patch.gz), further fixes after Burcin's review.\n \n **Apply** to SAGE_ROOT:\n * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n``````\n",
    "created_at": "2013-05-07T11:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130982",
    "user": "https://github.com/jpflori"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,11 +2,9 @@
 * the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
 
 **Apply**:
-* [attachment: trac_12173-script-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v7.patch.gz), this is the result of running [attachment: 12173_script.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script.sh.gz);
-* [attachment: trac_12173-fixes-v6.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v6.patch.gz), non-easily scriptable changes and fixes for spurious changes;
+* [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);
+* [attachment: trac_12173-fixes-v7.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-fixes-v7.patch.gz), non-easily scriptable changes and fixes for spurious changes, together with reviewers fixes;
 * [attachment: trac_12173-doctests-v2.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-doctests-v2.patch.gz), fix doctests, add some.
-* [attachment: trac_12173-review.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-review.patch.gz), reviewer patch.
-* [attachment: trac_12173-ffixes.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-ffixes.patch.gz), further fixes after Burcin's review.
 
 **Apply** to SAGE_ROOT:
 * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
``````




---

archive/issue_comments_130983.json:
```json
{
    "body": "<div id=\"comment:325\" align=\"right\">comment:325</div>\n\nFor `powerpc`, why not remove the whole\n\n```\nelif [ \"`uname -p`\" = \"powerpc\" ]; then\n    FLINT_TUNE=\"-falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16\"\n```\nblock?",
    "created_at": "2013-05-07T12:32:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130983",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:325" align="right">comment:325</div>

For `powerpc`, why not remove the whole

```
elif [ "`uname -p`" = "powerpc" ]; then
    FLINT_TUNE="-falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16"
```
block?



---

archive/issue_comments_130984.json:
```json
{
    "body": "Changed reviewer from **John Cremona, Jeroen Demeyer** to **John Cremona, Jeroen Demeyer, Burcin Erocal**",
    "created_at": "2013-05-07T12:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130984",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **John Cremona, Jeroen Demeyer** to **John Cremona, Jeroen Demeyer, Burcin Erocal**



---

archive/issue_comments_130985.json:
```json
{
    "body": "<div id=\"comment:327\" align=\"right\">comment:327</div>\n\nReplying to [@jdemeyer](#comment%3A325):\n> For `powerpc`, why not remove the whole\n> \n> ```\n> elif [ \"`uname -p`\" = \"powerpc\" ]; then\n>     FLINT_TUNE=\"-falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16\"\n> ```\n> block?\n\nI'd say to perform minimal modification.\nI don't really care.\nIn fact I'd prefer that FLINT gets its flags from gmp/mpfr if CFLAGS is empty and does not do anything if not.",
    "created_at": "2013-05-07T12:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130985",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:327" align="right">comment:327</div>

Replying to [@jdemeyer](#comment%3A325):
> For `powerpc`, why not remove the whole
> 
> ```
> elif [ "`uname -p`" = "powerpc" ]; then
>     FLINT_TUNE="-falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16"
> ```
> block?

I'd say to perform minimal modification.
I don't really care.
In fact I'd prefer that FLINT gets its flags from gmp/mpfr if CFLAGS is empty and does not do anything if not.



---

archive/issue_comments_130986.json:
```json
{
    "body": "<div id=\"comment:328\" align=\"right\">comment:328</div>\n\nLooks good to me.\n\nMany thanks for the great work.",
    "created_at": "2013-05-07T15:33:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130986",
    "user": "https://github.com/burcin"
}
```

<div id="comment:328" align="right">comment:328</div>

Looks good to me.

Many thanks for the great work.



---

archive/issue_events_163696.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-05-07T15:33:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163696"
}
```



---

archive/issue_events_163697.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2013-05-07T15:33:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163697"
}
```



---

archive/issue_comments_130987.json:
```json
{
    "body": "<div id=\"comment:329\" align=\"right\">comment:329</div>\n\nIt doesn't actually build on OS X 10.4 PPC G5:\n\n```\ng++ -fPIC -O2 -g -ansi -pedantic -Wall   -falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16 -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/spkg/build/flint-2.3.p0/src -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/local/include -c interfaces/NTL-interface.cpp -o build/interfaces/NTL-interface.lo;\n/usr/bin/ld: common symbols not allowed with MH_DYLIB output format with the -multi_module option\nbuild/fmpz.lo definition of common _fmpz_arr (size 4)\nbuild/profiler.lo definition of common _clock_accum (size 160)\nbuild/profiler.lo definition of common _clock_last (size 160)\nbuild/ulong_extras.lo definition of common _flint_num_primes_mutex (size 44)\nbuild/ulong_extras.lo definition of common _flint_prime_inverses (size 4)\nbuild/ulong_extras.lo definition of common _flint_primes (size 4)\nbuild/ulong_extras.lo definition of common _sieve (size 4)\nbuild/fmpz.lo definition of common _fmpz_unused_arr (size 4)\ncollect2: error: ld returned 1 exit status\nmake[4]: *** [libflint.dylib] Error 1\nmake[3]: *** [library] Error 2\nmake[3]: Target `all' not remade because of errors.\nError: Failed to build FLINT shared library.\n```\n\nI can try a few variations of the flags to see if that helps.",
    "created_at": "2013-05-08T07:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130987",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:329" align="right">comment:329</div>

It doesn't actually build on OS X 10.4 PPC G5:

```
g++ -fPIC -O2 -g -ansi -pedantic -Wall   -falign-loops=16 -falign-functions=16 -falign-labels=16 -falign-jumps=16 -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/spkg/build/flint-2.3.p0/src -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/local/include -I/Users/buildbot/build/sage/moufang-1/moufang_full/build/sage-5.10.beta2/local/include -c interfaces/NTL-interface.cpp -o build/interfaces/NTL-interface.lo;
/usr/bin/ld: common symbols not allowed with MH_DYLIB output format with the -multi_module option
build/fmpz.lo definition of common _fmpz_arr (size 4)
build/profiler.lo definition of common _clock_accum (size 160)
build/profiler.lo definition of common _clock_last (size 160)
build/ulong_extras.lo definition of common _flint_num_primes_mutex (size 44)
build/ulong_extras.lo definition of common _flint_prime_inverses (size 4)
build/ulong_extras.lo definition of common _flint_primes (size 4)
build/ulong_extras.lo definition of common _sieve (size 4)
build/fmpz.lo definition of common _fmpz_unused_arr (size 4)
collect2: error: ld returned 1 exit status
make[4]: *** [libflint.dylib] Error 1
make[3]: *** [library] Error 2
make[3]: Target `all' not remade because of errors.
Error: Failed to build FLINT shared library.
```

I can try a few variations of the flags to see if that helps.



---

archive/issue_events_163698.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-08T07:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163698"
}
```



---

archive/issue_events_163699.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-08T07:39:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163699"
}
```



---

archive/issue_comments_130988.json:
```json
{
    "body": "<div id=\"comment:330\" align=\"right\">comment:330</div>\n\nNeeds to pass \"-fno-common\" on darwin. [http://gcc.gnu.org/ml/gcc/2005-06/msg00375.html](http://gcc.gnu.org/ml/gcc/2005-06/msg00375.html) and follow up is interesting on that subject.",
    "created_at": "2013-05-08T10:01:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130988",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:330" align="right">comment:330</div>

Needs to pass "-fno-common" on darwin. [http://gcc.gnu.org/ml/gcc/2005-06/msg00375.html](http://gcc.gnu.org/ml/gcc/2005-06/msg00375.html) and follow up is interesting on that subject.



---

archive/issue_comments_130989.json:
```json
{
    "body": "<div id=\"comment:331\" align=\"right\">comment:331</div>\n\nOK, I am making and testing a new spkg. Please leave yours alone in order to avoid duplicate work.",
    "created_at": "2013-05-08T10:06:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130989",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:331" align="right">comment:331</div>

OK, I am making and testing a new spkg. Please leave yours alone in order to avoid duplicate work.



---

archive/issue_events_163700.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-08T10:17:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163700"
}
```



---

archive/issue_events_163701.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-08T10:17:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163701"
}
```



---

archive/issue_comments_130990.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n **Install**:\n-* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)\n+* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg)\n \n **Apply**:\n * [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);\n``````\n",
    "created_at": "2013-05-08T10:17:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130990",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 **Install**:
-* the FLINT spkg at [http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg](http://boxen.math.washington.edu/home/jpflori/flint-2.3.p0.spkg)
+* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg)
 
 **Apply**:
 * [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);
``````




---

archive/issue_comments_130991.json:
```json
{
    "body": "Diff flint-2.3 -> flint-2.3.p1",
    "created_at": "2013-05-08T10:17:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130991",
    "user": "https://github.com/jdemeyer"
}
```

Diff flint-2.3 -> flint-2.3.p1



---

archive/issue_comments_130992.json:
```json
{
    "body": "<div id=\"comment:333\" align=\"right\">comment:333</div>\n\nAttachment: **[flint-2.3.p1.diff.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p1.diff.gz)**",
    "created_at": "2013-05-08T10:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130992",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:333" align="right">comment:333</div>

Attachment: **[flint-2.3.p1.diff.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p1.diff.gz)**



---

archive/issue_comments_130993.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n **Install**:\n-* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg)\n+* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg) (spkg diffs: [attachment: flint-2.3.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.diff.gz) and [attachment: flint-2.3.p1.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p1.diff.gz))\n \n **Apply**:\n * [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);\n``````\n",
    "created_at": "2013-05-08T10:19:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130993",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 **Install**:
-* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg)
+* the FLINT spkg at [http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/flint-2.3.p1.spkg) (spkg diffs: [attachment: flint-2.3.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.diff.gz) and [attachment: flint-2.3.p1.diff](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.p1.diff.gz))
 
 **Apply**:
 * [attachment: trac_12173-script-v8.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-script-v8.patch.gz), this is the result of running [attachment: 12173_script-v2.sh](https://github.com/sagemath/sage/files/ticket12173/12173_script-v2.sh.gz);
``````




---

archive/issue_comments_130994.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2013-05-08T10:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130994",
    "user": "https://github.com/jdemeyer"
}
```

Spkg diff, for review only.



---

archive/issue_comments_130995.json:
```json
{
    "body": "<div id=\"comment:334\" align=\"right\">comment:334</div>\n\nAttachment: **[flint-2.3.diff.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.diff.gz)**\n\nThe new spkg with `-fno-common` at least builds on OS X 10.4 PPC G5. I'll need some more time to actually completely test it.",
    "created_at": "2013-05-08T10:24:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130995",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:334" align="right">comment:334</div>

Attachment: **[flint-2.3.diff.gz](https://github.com/sagemath/sage/files/ticket12173/flint-2.3.diff.gz)**

The new spkg with `-fno-common` at least builds on OS X 10.4 PPC G5. I'll need some more time to actually completely test it.



---

archive/issue_comments_130996.json:
```json
{
    "body": "Upstream: **Not yet reported upstream; Will do shortly.**",
    "created_at": "2013-05-08T10:25:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130996",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Not yet reported upstream; Will do shortly.**



---

archive/issue_comments_130997.json:
```json
{
    "body": "<div id=\"comment:336\" align=\"right\">comment:336</div>\n\nFLINT's testsuite (`./sage -i -c`) passes on OS X 10.4 PPC G5.",
    "created_at": "2013-05-08T11:20:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130997",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:336" align="right">comment:336</div>

FLINT's testsuite (`./sage -i -c`) passes on OS X 10.4 PPC G5.



---

archive/issue_comments_130998.json:
```json
{
    "body": "<div id=\"comment:337\" align=\"right\">comment:337</div>\n\nJeroen, could you please test te spkg on the PPC G5 with FLINT_TUNE=\"-fno-common -funroll-loops\"?\nIf that works fine, I guess we should just go with that upstream rather than the \"*=16\" thing.",
    "created_at": "2013-05-09T10:12:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130998",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:337" align="right">comment:337</div>

Jeroen, could you please test te spkg on the PPC G5 with FLINT_TUNE="-fno-common -funroll-loops"?
If that works fine, I guess we should just go with that upstream rather than the "*=16" thing.



---

archive/issue_events_163702.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-05-09T13:37:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163702"
}
```



---

archive/issue_events_163703.json:
```json
{
    "actor": "https://github.com/jpflori",
    "created_at": "2013-05-09T13:37:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163703"
}
```



---

archive/issue_comments_130999.json:
```json
{
    "body": "<div id=\"comment:338\" align=\"right\">comment:338</div>\n\nAnyway, I'm ok with Jeroen changes to the spkg/patches, so I'm putting this back to positive_review.",
    "created_at": "2013-05-09T13:37:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-130999",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:338" align="right">comment:338</div>

Anyway, I'm ok with Jeroen changes to the spkg/patches, so I'm putting this back to positive_review.



---

archive/issue_comments_131000.json:
```json
{
    "body": "Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. Developers acknowledge bug.**",
    "created_at": "2013-05-09T13:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-131000",
    "user": "https://github.com/jpflori"
}
```

Changed upstream from **Not yet reported upstream; Will do shortly.** to **Reported upstream. Developers acknowledge bug.**



---

archive/issue_comments_131001.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n \n **Apply** to SAGE_ROOT:\n * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).\n+\n+**Upstream** bug with OS X PPC: [https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI](https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI)\n``````\n",
    "created_at": "2013-05-09T18:28:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-131001",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
 
 **Apply** to SAGE_ROOT:
 * [attachment: trac_12173-root.patch](https://github.com/sagemath/sage/files/ticket12173/trac_12173-root.patch.gz).
+
+**Upstream** bug with OS X PPC: [https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI](https://groups.google.com/forum/?hl=en&fromgroups#!topic/flint-devel/KrgY0v09SwI)
``````




---

archive/issue_comments_131002.json:
```json
{
    "body": "<div id=\"comment:341\" align=\"right\">comment:341</div>\n\nFYI, some patches similar to what Jeroen did have been integrated upstream and should be in the next release (and the other patch about dylib64 as well).",
    "created_at": "2013-05-10T10:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-131002",
    "user": "https://github.com/jpflori"
}
```

<div id="comment:341" align="right">comment:341</div>

FYI, some patches similar to what Jeroen did have been integrated upstream and should be in the next release (and the other patch about dylib64 as well).



---

archive/issue_comments_131003.json:
```json
{
    "body": "Merged: **sage-5.10.beta3**",
    "created_at": "2013-05-13T13:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-131003",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.10.beta3**



---

archive/issue_events_163704.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:26:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163704"
}
```



---

archive/issue_events_163705.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-05-13T13:26:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12173#event-163705"
}
```



---

archive/issue_comments_131004.json:
```json
{
    "body": "<div id=\"comment:343\" align=\"right\">comment:343</div>\n\nIt would probably be better to keep a symlink `$SAGE_LOCAL/include/FLINT -> flint` for a while...  which would also have avoided [comment:ticket:14600:4 this].",
    "created_at": "2013-05-17T00:55:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-131004",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:343" align="right">comment:343</div>

It would probably be better to keep a symlink `$SAGE_LOCAL/include/FLINT -> flint` for a while...  which would also have avoided [comment:ticket:14600:4 this].



---

archive/issue_comments_131005.json:
```json
{
    "body": "<div id=\"comment:344\" align=\"right\">comment:344</div>\n\nThe FLINT include directory issue (`FLINT` vs. `flint`) is now #14603.",
    "created_at": "2013-05-17T11:51:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12173",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12173#issuecomment-131005",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:344" align="right">comment:344</div>

The FLINT include directory issue (`FLINT` vs. `flint`) is now #14603.
