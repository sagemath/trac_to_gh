# Issue 12991: Don't doctest autogenerated rst files

archive/issues_012819.json:
```json
{
    "body": "When we build the Sage documentation, we create lots of files which look like the following (`SAGE_ROOT/devel/sage/doc/en/reference/sage/algebras/free_algebra_quotient_element.rst`):\n\n```\n.. _sage.algebras.free_algebra_quotient_element:\n\nFree algebra quotient elements\n==============================\n\n.. This file has been autogenerated.\n\n\n.. automodule:: sage.algebras.free_algebra_quotient_element\n   :members:\n   :undoc-members:\n   :show-inheritance:\n```\nWhen we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\\n.. This file has been autogenerated.\\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).\n\n\n\n**Assignee:** mvngu\n\n**Reviewer:** Keshav Kini\n\n**Author:** John Palmieri\n\n**Merged:** sage-5.1.beta2\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12991\n\n",
    "closed_at": "2012-06-02T12:16:23Z",
    "created_at": "2012-05-22T20:31:08Z",
    "labels": [
        "component: doctest coverage",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Don't doctest autogenerated rst files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12991",
    "user": "https://github.com/jhpalmieri"
}
```
When we build the Sage documentation, we create lots of files which look like the following (`SAGE_ROOT/devel/sage/doc/en/reference/sage/algebras/free_algebra_quotient_element.rst`):

```
.. _sage.algebras.free_algebra_quotient_element:

Free algebra quotient elements
==============================

.. This file has been autogenerated.


.. automodule:: sage.algebras.free_algebra_quotient_element
   :members:
   :undoc-members:
   :show-inheritance:
```
When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).



**Assignee:** mvngu

**Reviewer:** Keshav Kini

**Author:** John Palmieri

**Merged:** sage-5.1.beta2

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/12991





---

archive/issue_comments_196275.json:
```json
{
    "body": "Attachment [trac_12991-doctest.patch](tarball://root/attachments/some-uuid/ticket12991/trac_12991-doctest.patch) by @jhpalmieri created at 2012-05-22 20:31:32",
    "created_at": "2012-05-22T20:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196275",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_12991-doctest.patch](tarball://root/attachments/some-uuid/ticket12991/trac_12991-doctest.patch) by @jhpalmieri created at 2012-05-22 20:31:32



---

archive/issue_comments_196276.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,6 +14,6 @@\n    :undoc-members:\n    :show-inheritance:\n ```\n-When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\\n.. This file has been autogenerated.\\n', or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).\n+When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\\n.. This file has been autogenerated.\\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).\n \n \n``````\n",
    "created_at": "2012-05-22T20:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196276",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,6 +14,6 @@
    :undoc-members:
    :show-inheritance:
 ```
-When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n', or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).
+When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).
 
 
``````




---

archive/issue_comments_196277.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-05-22T20:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196277",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_196278.json:
```json
{
    "body": "<a id='comment:2'></a>\nFor the first approach, apply a patch like this to `SAGE_ROOT/local/bin`:\n\n```diff\ndiff --git a/sage-ptest b/sage-ptest\n--- a/sage-ptest\n+++ b/sage-ptest\n@@ -133,9 +133,11 @@ def skip(F):\n         sys.stdout.flush()\n         printmutex.release()\n         return True\n+    TEXT = open(G).read()\n     filenm = os.path.split(F)[1]\n     if (filenm[0] == '.' or (os.path.sep + '.' in G.lstrip(os.path.sep + '.'))\n-        or 'nodoctest' in open(G).read()[:50]):\n+        or 'nodoctest' in TEXT[:50]\n+        or '\\n.. This file has been autogenerated.\\n' in TEXT):\n         return True\n     if G.find(os.path.join('doc', 'output')) != -1:\n         return True\n```",
    "created_at": "2012-05-22T20:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196278",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
For the first approach, apply a patch like this to `SAGE_ROOT/local/bin`:

```diff
diff --git a/sage-ptest b/sage-ptest
--- a/sage-ptest
+++ b/sage-ptest
@@ -133,9 +133,11 @@ def skip(F):
         sys.stdout.flush()
         printmutex.release()
         return True
+    TEXT = open(G).read()
     filenm = os.path.split(F)[1]
     if (filenm[0] == '.' or (os.path.sep + '.' in G.lstrip(os.path.sep + '.'))
-        or 'nodoctest' in open(G).read()[:50]):
+        or 'nodoctest' in TEXT[:50]
+        or '\n.. This file has been autogenerated.\n' in TEXT):
         return True
     if G.find(os.path.join('doc', 'output')) != -1:
         return True
```



---

archive/issue_comments_196279.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe approach of your patch (rather than your comment) seems to me to be the correct one. It also passes tests on 5.0.beta1, and the code looks reasonable, so positive review from me.",
    "created_at": "2012-05-22T21:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196279",
    "user": "https://github.com/kini"
}
```

<a id='comment:3'></a>
The approach of your patch (rather than your comment) seems to me to be the correct one. It also passes tests on 5.0.beta1, and the code looks reasonable, so positive review from me.



---

archive/issue_comments_196280.json:
```json
{
    "body": "**Reviewer:** Keshav Kini",
    "created_at": "2012-05-22T21:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196280",
    "user": "https://github.com/kini"
}
```

**Reviewer:** Keshav Kini



---

archive/issue_comments_196281.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2012-05-22T21:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196281",
    "user": "https://github.com/kini"
}
```

**Author:** John Palmieri



---

archive/issue_comments_196282.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-22T21:31:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196282",
    "user": "https://github.com/kini"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_196283.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-06-02T12:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196283",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_events_041519.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T12:16:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12991#event-41519"
}
```



---

archive/issue_comments_196284.json:
```json
{
    "body": "**Merged:** sage-5.1.beta2",
    "created_at": "2012-06-02T12:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12991#issuecomment-196284",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta2
