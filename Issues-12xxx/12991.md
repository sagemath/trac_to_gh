# Issue 12991: Don't doctest autogenerated rst files

archive/issues_012819.json:
```json
{
    "assignees": [],
    "body": "When we build the Sage documentation, we create lots of files which look like the following (`SAGE_ROOT/devel/sage/doc/en/reference/sage/algebras/free_algebra_quotient_element.rst`):\n\n```\n.. _sage.algebras.free_algebra_quotient_element:\n\nFree algebra quotient elements\n==============================\n\n.. This file has been autogenerated.\n\n\n.. automodule:: sage.algebras.free_algebra_quotient_element\n   :members:\n   :undoc-members:\n   :show-inheritance:\n```\nWhen we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\\n.. This file has been autogenerated.\\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).\n\n\n\n**Assignee:** mvngu\n\n**Reviewer:** Keshav Kini\n\n**Author:** John Palmieri\n\n**Merged:** sage-5.1.beta2\n\nIssue created by migration from https://trac.sagemath.org/ticket/12991\n\n",
    "closed_at": "2012-06-02T12:16:23Z",
    "created_at": "2012-05-22T20:31:08Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
        "https://github.com/sagemath/sage/labels/minor",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Don't doctest autogenerated rst files",
    "type": "issue",
    "updated_at": "2012-06-02T12:16:23Z",
    "url": "https://github.com/sagemath/sage/issues/12991",
    "user": "https://github.com/jhpalmieri"
}
```
When we build the Sage documentation, we create lots of files which look like the following (`SAGE_ROOT/devel/sage/doc/en/reference/sage/algebras/free_algebra_quotient_element.rst`):

```
.. _sage.algebras.free_algebra_quotient_element:

Free algebra quotient elements
==============================

.. This file has been autogenerated.


.. automodule:: sage.algebras.free_algebra_quotient_element
   :members:
   :undoc-members:
   :show-inheritance:
```
When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).



**Assignee:** mvngu

**Reviewer:** Keshav Kini

**Author:** John Palmieri

**Merged:** sage-5.1.beta2

Issue created by migration from https://trac.sagemath.org/ticket/12991





---

archive/issue_events_152156.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-05-22T20:31:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152156"
}
```



---

archive/issue_events_152157.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-05-22T20:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
    "label_color": "08517b",
    "label_name": "component: doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152157"
}
```



---

archive/issue_events_152158.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-05-22T20:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152158"
}
```



---

archive/issue_events_152159.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-05-22T20:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152159"
}
```



---

archive/issue_comments_149891.json:
```json
{
    "body": "**Attachment:** [trac_12991-doctest.patch.gz](https://github.com/sagemath/sage/files/ticket12991/trac_12991-doctest.patch.gz)",
    "created_at": "2012-05-22T20:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149891",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_12991-doctest.patch.gz](https://github.com/sagemath/sage/files/ticket12991/trac_12991-doctest.patch.gz)



---

archive/issue_comments_149892.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -14,6 +14,6 @@\n    :undoc-members:\n    :show-inheritance:\n ```\n-When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\\n.. This file has been autogenerated.\\n', or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).\n+When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\\n.. This file has been autogenerated.\\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).\n \n \n``````\n",
    "created_at": "2012-05-22T20:42:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149892",
    "user": "https://github.com/kini"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -14,6 +14,6 @@
    :undoc-members:
    :show-inheritance:
 ```
-When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n', or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).
+When we run `make ptestlong`, these files get doctested. I don't think there is a good reason for this: we should skip these files when doctesting. There are two ways of doing this: patch the doctesting scripts to skip files containing `\n.. This file has been autogenerated.\n`, or write `.. nodoctest` as the first line of each of these files. The attached patch does the second of these (a patch to do the first is given in a comment below).
 
 
``````




---

archive/issue_events_152160.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-05-22T20:54:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152160"
}
```



---

archive/issue_comments_149893.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nFor the first approach, apply a patch like this to `SAGE_ROOT/local/bin`:\n\n```diff\ndiff --git a/sage-ptest b/sage-ptest\n--- a/sage-ptest\n+++ b/sage-ptest\n@@ -133,9 +133,11 @@ def skip(F):\n         sys.stdout.flush()\n         printmutex.release()\n         return True\n+    TEXT = open(G).read()\n     filenm = os.path.split(F)[1]\n     if (filenm[0] == '.' or (os.path.sep + '.' in G.lstrip(os.path.sep + '.'))\n-        or 'nodoctest' in open(G).read()[:50]):\n+        or 'nodoctest' in TEXT[:50]\n+        or '\\n.. This file has been autogenerated.\\n' in TEXT):\n         return True\n     if G.find(os.path.join('doc', 'output')) != -1:\n         return True\n```",
    "created_at": "2012-05-22T20:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149893",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'>**Comment 2:**</a>
For the first approach, apply a patch like this to `SAGE_ROOT/local/bin`:

```diff
diff --git a/sage-ptest b/sage-ptest
--- a/sage-ptest
+++ b/sage-ptest
@@ -133,9 +133,11 @@ def skip(F):
         sys.stdout.flush()
         printmutex.release()
         return True
+    TEXT = open(G).read()
     filenm = os.path.split(F)[1]
     if (filenm[0] == '.' or (os.path.sep + '.' in G.lstrip(os.path.sep + '.'))
-        or 'nodoctest' in open(G).read()[:50]):
+        or 'nodoctest' in TEXT[:50]
+        or '\n.. This file has been autogenerated.\n' in TEXT):
         return True
     if G.find(os.path.join('doc', 'output')) != -1:
         return True
```



---

archive/issue_comments_149894.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nThe approach of your patch (rather than your comment) seems to me to be the correct one. It also passes tests on 5.0.beta1, and the code looks reasonable, so positive review from me.",
    "created_at": "2012-05-22T21:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149894",
    "user": "https://github.com/kini"
}
```

<a id='comment:3'>**Comment 3:**</a>
The approach of your patch (rather than your comment) seems to me to be the correct one. It also passes tests on 5.0.beta1, and the code looks reasonable, so positive review from me.



---

archive/issue_comments_149895.json:
```json
{
    "body": "**Reviewer:** Keshav Kini",
    "created_at": "2012-05-22T21:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149895",
    "user": "https://github.com/kini"
}
```

**Reviewer:** Keshav Kini



---

archive/issue_comments_149896.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2012-05-22T21:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149896",
    "user": "https://github.com/kini"
}
```

**Author:** John Palmieri



---

archive/issue_events_152161.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-05-22T21:31:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152161"
}
```



---

archive/issue_events_152162.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-05-22T21:31:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152162"
}
```



---

archive/issue_events_152163.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T12:16:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152163"
}
```



---

archive/issue_events_152164.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-02T12:16:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12991#event-152164"
}
```



---

archive/issue_comments_149897.json:
```json
{
    "body": "**Merged:** sage-5.1.beta2",
    "created_at": "2012-06-02T12:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12991",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12991#issuecomment-149897",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta2
