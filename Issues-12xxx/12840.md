# Issue 12840: update M4RI to newest upstream release

archive/issues_012668.json:
```json
{
    "assignees": [],
    "body": "As the title says.\n\n**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120613.spkg\n\n**Apply:** [[attachment:trac_12840-rebased-on-13109.patch](https://github.com/sagemath/sage/files/ticket12840/89705cda39230dae36baa9cebcb2ba60.patch](https://github.com/sagemath/sage/files/ticket12840/52f8a13c598f950af6b7b10b98049a51.patch),)\n\n**Apply** to `SAGE_ROOT`: [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)\n\nDepends on #12841\n\nDepends on #13109\n\n**Reviewer:** Simon King, Volker Braun\n\n**Author:** Martin Albrecht, John Palmieri\n\n**Merged:** sage-5.3.beta0\n\n**Dependencies:** to be merged with #12841, #13109\n\nIssue created by migration from https://trac.sagemath.org/ticket/12840\n\n",
    "closed_at": "2012-08-01T12:10:47Z",
    "created_at": "2012-04-13T19:33:46Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "update M4RI to newest upstream release",
    "type": "issue",
    "updated_at": "2012-08-01T12:10:47Z",
    "url": "https://github.com/sagemath/sage/issues/12840",
    "user": "https://github.com/malb"
}
```
As the title says.

**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120613.spkg

**Apply:** [[attachment:trac_12840-rebased-on-13109.patch](https://github.com/sagemath/sage/files/ticket12840/89705cda39230dae36baa9cebcb2ba60.patch](https://github.com/sagemath/sage/files/ticket12840/52f8a13c598f950af6b7b10b98049a51.patch),)

**Apply** to `SAGE_ROOT`: [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)

Depends on #12841

Depends on #13109

**Reviewer:** Simon King, Volker Braun

**Author:** Martin Albrecht, John Palmieri

**Merged:** sage-5.3.beta0

**Dependencies:** to be merged with #12841, #13109

Issue created by migration from https://trac.sagemath.org/ticket/12840





---

archive/issue_events_149821.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-04-13T19:33:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149821"
}
```



---

archive/issue_events_149822.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-04-13T19:33:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "08517b",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149822"
}
```



---

archive/issue_events_149823.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-04-13T19:33:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149823"
}
```



---

archive/issue_comments_146892.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n As the title says.\n+\n+**Install:\u00a0**!http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n``````\n",
    "created_at": "2012-04-13T19:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146892",
    "user": "https://github.com/malb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 As the title says.
+
+**Install: **!http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
``````




---

archive/issue_comments_146893.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n As the title says.\n \n-**Install:\u00a0**!http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n+**Install:\u00a0**http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n``````\n",
    "created_at": "2012-04-13T19:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146893",
    "user": "https://github.com/malb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 As the title says.
 
-**Install: **!http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
``````




---

archive/issue_comments_146894.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n As the title says.\n \n-**Install:\u00a0**http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n+\n+**Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)\n``````\n",
    "created_at": "2012-04-13T19:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146894",
    "user": "https://github.com/malb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 As the title says.
 
-**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
+
+**Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)
``````




---

archive/issue_comments_146895.json:
```json
{
    "body": "**Dependencies:** #12841",
    "created_at": "2012-04-13T20:27:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146895",
    "user": "https://github.com/malb"
}
```

**Dependencies:** #12841



---

archive/issue_events_149824.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-04-13T23:10:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149824"
}
```



---

archive/issue_comments_146896.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\n**Attachment:** [trac_12840_m4ri_new_version.patch.gz](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch.gz)\n\nUpdated the patch because I forgot to raise a `ZeroDivisionError` in `__invert__`. Fixed now.",
    "created_at": "2012-04-14T10:51:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146896",
    "user": "https://github.com/malb"
}
```

<a id='comment:7'>**Comment 7:**</a>
**Attachment:** [trac_12840_m4ri_new_version.patch.gz](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch.gz)

Updated the patch because I forgot to raise a `ZeroDivisionError` in `__invert__`. Fixed now.



---

archive/issue_comments_146897.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nAfter applying the patch and the spkg and rebuilding the polybori spkg, sage -br failed with\n\n```\ngcc -pthread -shared -L/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/lib build/temp.linux-x86_64-2.7/sage/matrix/matrix_integer_dense.o -L/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/lib -L/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/lib -lcsage -liml -lpari -lm -lgmp -lcblas -latlas -lstdc++ -lntl -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/matrix/matrix_integer_dense.so\nerror: command 'gcc' failed with exit status 1\nError installing modified sage library code.\n```\nNo error message, I am afraid.",
    "created_at": "2012-05-03T14:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146897",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'>**Comment 8:**</a>
After applying the patch and the spkg and rebuilding the polybori spkg, sage -br failed with

```
gcc -pthread -shared -L/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/lib build/temp.linux-x86_64-2.7/sage/matrix/matrix_integer_dense.o -L/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/lib -L/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/lib -lcsage -liml -lpari -lm -lgmp -lcblas -latlas -lstdc++ -lntl -lpython2.7 -o build/lib.linux-x86_64-2.7/sage/matrix/matrix_integer_dense.so
error: command 'gcc' failed with exit status 1
Error installing modified sage library code.
```
No error message, I am afraid.



---

archive/issue_comments_146898.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nPS: That was with sage-5.0.beta13 plus a lot of patches, but none of them changing matrices.",
    "created_at": "2012-05-03T14:22:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146898",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:9'>**Comment 9:**</a>
PS: That was with sage-5.0.beta13 plus a lot of patches, but none of them changing matrices.



---

archive/issue_comments_146899.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nAnd repeating sage -br, I finally got a proper error:\n\n```\nIn file included from /mnt/local/king/SAGE/stable/sage-5.0.beta13/local/include/m4rie/m4rie.h:56,\n                 from sage/matrix/matrix_mod2e_dense.cpp:240:\n/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/include/m4rie/permutation.h:30:30: error: m4ri/permutation.h: Datei oder Verzeichnis nicht gefunden\nerror: command 'gcc' failed with exit status 1\nError installing modified sage library code.\n```",
    "created_at": "2012-05-03T14:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146899",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'>**Comment 10:**</a>
And repeating sage -br, I finally got a proper error:

```
In file included from /mnt/local/king/SAGE/stable/sage-5.0.beta13/local/include/m4rie/m4rie.h:56,
                 from sage/matrix/matrix_mod2e_dense.cpp:240:
/mnt/local/king/SAGE/stable/sage-5.0.beta13/local/include/m4rie/permutation.h:30:30: error: m4ri/permutation.h: Datei oder Verzeichnis nicht gefunden
error: command 'gcc' failed with exit status 1
Error installing modified sage library code.
```



---

archive/issue_comments_146900.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nPS: permutation.h seems not to be present in the sources.",
    "created_at": "2012-05-03T14:25:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146900",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:11'>**Comment 11:**</a>
PS: permutation.h seems not to be present in the sources.



---

archive/issue_comments_146901.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nPS: The same error occurs when trying to rebuild libm4rie spkg: M4RIE expects permutation.h",
    "created_at": "2012-05-03T14:27:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146901",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'>**Comment 12:**</a>
PS: The same error occurs when trying to rebuild libm4rie spkg: M4RIE expects permutation.h



---

archive/issue_comments_146902.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nYes, #12841 is a dependency of this ticket.",
    "created_at": "2012-05-03T14:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146902",
    "user": "https://github.com/malb"
}
```

<a id='comment:13'>**Comment 13:**</a>
Yes, #12841 is a dependency of this ticket.



---

archive/issue_comments_146903.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nOuch. I missed #12841. Sorry.",
    "created_at": "2012-05-03T15:50:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146903",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'>**Comment 14:**</a>
Ouch. I missed #12841. Sorry.



---

archive/issue_comments_146904.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nAm I right that both spkgs have to be installed, but #12840 goes before #12841?",
    "created_at": "2012-05-03T15:54:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146904",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'>**Comment 15:**</a>
Am I right that both spkgs have to be installed, but #12840 goes before #12841?



---

archive/issue_comments_146905.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nYippie! Applying the patches from #12840 and #12841, installing the new m4ri spkg from here, then installing the new m4rie spkg from #12841 (why is it on a different ticket? Can one live without the other?), re-installing polybori and finally sage -br, Sage starts!",
    "created_at": "2012-05-03T16:04:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146905",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:16'>**Comment 16:**</a>
Yippie! Applying the patches from #12840 and #12841, installing the new m4ri spkg from here, then installing the new m4rie spkg from #12841 (why is it on a different ticket? Can one live without the other?), re-installing polybori and finally sage -br, Sage starts!



---

archive/issue_comments_146906.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nReplying to [@simon-king-jena](#comment%3A16):\n> Yippie! Applying the patches from #12840 and #12841, installing the new m4ri spkg from here, then installing the new m4rie spkg from #12841 (why is it on a different ticket? Can one live without the other?), \n\nNo, you're right, they are co-dependent.",
    "created_at": "2012-05-03T16:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146906",
    "user": "https://github.com/malb"
}
```

<a id='comment:17'>**Comment 17:**</a>
Replying to [@simon-king-jena](#comment%3A16):
> Yippie! Applying the patches from #12840 and #12841, installing the new m4ri spkg from here, then installing the new m4rie spkg from #12841 (why is it on a different ticket? Can one live without the other?), 

No, you're right, they are co-dependent.



---

archive/issue_comments_146907.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nFirst of all: make ptestlong works with the two new spkgs (even though I have a few other patches applied...).\n\nHere is a small timing.\n\nVanilla Sage-5.0.rc0:\n\n```\nsage: K = GF(2)\nsage: %time A = random_matrix(K,20000,20000)\nCPU times: user 0.29 s, sys: 0.02 s, total: 0.31 s\nWall time: 0.31 s\nsage: %time B = random_matrix(K,20000,20000)\nCPU times: user 0.23 s, sys: 0.03 s, total: 0.26 s\nWall time: 0.27 s\nsage: %time (A*B).rank()\nCPU times: user 11.70 s, sys: 0.05 s, total: 11.75 s\nWall time: 11.81 s\n19937\n```\n\nSage-5.0.beta13 with the new spkgs (and some other patches that shouldn't affect the timing for matrix multiplication):\n\n```\nsage: K = GF(2)\nsage: %time A = random_matrix(K,20000,20000)\nCPU times: user 0.30 s, sys: 0.03 s, total: 0.33 s\nWall time: 0.33 s\nsage: %time B = random_matrix(K,20000,20000)\nCPU times: user 0.32 s, sys: 0.01 s, total: 0.33 s\nWall time: 0.33 s\nsage: %time (A*B).rank()\nCPU times: user 11.70 s, sys: 0.10 s, total: 11.80 s\nWall time: 11.83 s\n19937\n```\nWell, at least there is no slow-down...\n\nDo you claim that the new version of M4RI is faster? You do claim a speed-up for M4RIE, on #12841.",
    "created_at": "2012-05-03T19:28:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146907",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:18'>**Comment 18:**</a>
First of all: make ptestlong works with the two new spkgs (even though I have a few other patches applied...).

Here is a small timing.

Vanilla Sage-5.0.rc0:

```
sage: K = GF(2)
sage: %time A = random_matrix(K,20000,20000)
CPU times: user 0.29 s, sys: 0.02 s, total: 0.31 s
Wall time: 0.31 s
sage: %time B = random_matrix(K,20000,20000)
CPU times: user 0.23 s, sys: 0.03 s, total: 0.26 s
Wall time: 0.27 s
sage: %time (A*B).rank()
CPU times: user 11.70 s, sys: 0.05 s, total: 11.75 s
Wall time: 11.81 s
19937
```

Sage-5.0.beta13 with the new spkgs (and some other patches that shouldn't affect the timing for matrix multiplication):

```
sage: K = GF(2)
sage: %time A = random_matrix(K,20000,20000)
CPU times: user 0.30 s, sys: 0.03 s, total: 0.33 s
Wall time: 0.33 s
sage: %time B = random_matrix(K,20000,20000)
CPU times: user 0.32 s, sys: 0.01 s, total: 0.33 s
Wall time: 0.33 s
sage: %time (A*B).rank()
CPU times: user 11.70 s, sys: 0.10 s, total: 11.80 s
Wall time: 11.83 s
19937
```
Well, at least there is no slow-down...

Do you claim that the new version of M4RI is faster? You do claim a speed-up for M4RIE, on #12841.



---

archive/issue_comments_146908.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [@simon-king-jena](#comment%3A18):\n> Do you claim that the new version of M4RI is faster? You do claim a speed-up for M4RIE, on #12841.\n\nNo, M4RI shouldn't have changed (at least the stuff, only bugfixes & refactoring. \n\nThat said, there's a new function for inverting upper triangular matrices which is much faster than the generic method, but it's not exposed yet. I need to implement the same for lower triangular matrices, then we can speed up inversions in general.\n\nFurthermore, M4RI ships its own PNG reader/writer now which is much faster than what we have in Sage and uses much less memory. Again, it's not used yet. This patch just gets the new version in.",
    "created_at": "2012-05-03T20:44:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146908",
    "user": "https://github.com/malb"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [@simon-king-jena](#comment%3A18):
> Do you claim that the new version of M4RI is faster? You do claim a speed-up for M4RIE, on #12841.

No, M4RI shouldn't have changed (at least the stuff, only bugfixes & refactoring. 

That said, there's a new function for inverting upper triangular matrices which is much faster than the generic method, but it's not exposed yet. I need to implement the same for lower triangular matrices, then we can speed up inversions in general.

Furthermore, M4RI ships its own PNG reader/writer now which is much faster than what we have in Sage and uses much less memory. Again, it's not used yet. This patch just gets the new version in.



---

archive/issue_comments_146909.json:
```json
{
    "body": "**Reviewer:** Simon King",
    "created_at": "2012-05-04T11:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146909",
    "user": "https://github.com/simon-king-jena"
}
```

**Reviewer:** Simon King



---

archive/issue_events_149825.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-05-04T11:21:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149825"
}
```



---

archive/issue_events_149826.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-05-04T11:21:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149826"
}
```



---

archive/issue_comments_146910.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nSince make ptestlong passes and the hg repository in the package is fine and SPKG.txt is up to date, I think I can give a positive review. However, I only tested on one platform. So, if the release manager believes that this is not enough, then please speak up!",
    "created_at": "2012-05-04T11:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146910",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:20'>**Comment 20:**</a>
Since make ptestlong passes and the hg repository in the package is fine and SPKG.txt is up to date, I think I can give a positive review. However, I only tested on one platform. So, if the release manager believes that this is not enough, then please speak up!



---

archive/issue_comments_146911.json:
```json
{
    "body": "**Changing dependencies** from \"#12841\" to \"to be merged wth #12841\".",
    "created_at": "2012-05-07T06:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146911",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#12841" to "to be merged wth #12841".



---

archive/issue_comments_146912.json:
```json
{
    "body": "**Changing dependencies** from \"to be merged wth #12841\" to \"to be merged with #12841\".",
    "created_at": "2012-05-07T06:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146912",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "to be merged wth #12841" to "to be merged with #12841".



---

archive/issue_comments_146913.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nThis fails to install on the Skynet machine \"eno\" (Fedora 16 x86_64):\n\n```\n/bin/sh ./libtool --tag=CC   --mode=link gcc -std=gnu99 -mmmx -msse -msse2 -msse3   -g -fPIC -Wall -pedantic -O2 -release 0.0.20111203 -no\n-undefined  -o libm4ri.la -rpath /home/buildbot/build/sage/eno-1/eno_full/build/sage-5.1.beta1/local/lib brilliantrussian.lo misc.lo mzd.l\no graycode.lo strassen.lo mzp.lo triangular.lo triangular_russian.lo ple.lo ple_russian.lo solve.lo echelonform.lo mmc.lo debug_dump.lo io\n.lo -lm -lpng\nlibtool: link: gcc -shared  -fPIC -DPIC  .libs/brilliantrussian.o .libs/misc.o .libs/mzd.o .libs/graycode.o .libs/strassen.o .libs/mzp.o .\nlibs/triangular.o .libs/triangular_russian.o .libs/ple.o .libs/ple_russian.o .libs/solve.o .libs/echelonform.o .libs/mmc.o .libs/debug_dum\np.o .libs/io.o   -lm -lpng  -mmmx -msse -msse2 -msse3 -O2   -Wl,-soname -Wl,libm4ri-0.0.20111203.so -o .libs/libm4ri-0.0.20111203.so\n/usr/bin/ld: cannot find -lpng\ncollect2: ld returned 1 exit status\nmake[1]: *** [libm4ri.la] Error 1\nmake[1]: Leaving directory `/home/buildbot/build/sage/eno-1/eno_full/build/sage-5.1.beta1/spkg/build/libm4ri-20120415/src'\nmake: *** [all] Error 2\nError building libm4ri\n```\n\n```\n$ ls -l local/lib/libpng*\n36k -rw-r--r-- 1 buildbot sage 828k May  8 06:16 local/lib/libpng12.a\n4.1k -rwxr-xr-x 1 buildbot sage 1.1k May  8 06:16 local/lib/libpng12.la*\n   0 lrwxrwxrwx 1 buildbot sage   18 May  8 06:16 local/lib/libpng12.so -> libpng12.so.0.35.0*\n   0 lrwxrwxrwx 1 buildbot sage   18 May  8 06:16 local/lib/libpng12.so.0 -> libpng12.so.0.35.0*\n467k -rwxr-xr-x 1 buildbot sage 460k May  8 06:16 local/lib/libpng12.so.0.35.0*\n\n$ ls -l /lib*/libpng* /usr/lib*/libpng*\nls: cannot access /lib*/libpng*: No such file or directory\n   0 lrwxrwxrwx 1 root root   16 May  2 11:53 /usr/lib64/libpng.so.3 -> libpng.so.3.49.0*\n173k -rwxr-xr-x 1 root root 172k Apr  7 14:33 /usr/lib64/libpng.so.3.49.0*\n   0 lrwxrwxrwx 1 root root   18 May  2 11:53 /usr/lib64/libpng12.so.0 -> libpng12.so.0.49.0*\n164k -rwxr-xr-x 1 root root 162k Apr  7 14:33 /usr/lib64/libpng12.so.0.49.0*\n```\n\nNote that there is no file `/usr/lib64/libpng.so`, so obviously there cannot be proper PNG support on this machine.  I consider this to be an upstream (not Sage) error.\n\n```\n$ grep -i png spkg/logs/libm4ri-20120415.log\nchecking whether to build with PNG support... yes\nchecking for PNG... no\nchecking for PNG... yes\n/bin/sh ./libtool --tag=CC   --mode=link gcc -std=gnu99 -mmmx -msse -msse2 -msse3   -g -fPIC -Wall -pedantic -O2 -release 0.0.20111203 -no-undefined  -o libm4ri.la -rpath /home/buildbot/build/sage/eno-1/eno_full/build/sage-5.1.beta1/local/lib brilliantrussian.lo misc.lo mzd.lo graycode.lo strassen.lo mzp.lo triangular.lo triangular_russian.lo ple.lo ple_russian.lo solve.lo echelonform.lo mmc.lo debug_dump.lo io.lo -lm -lpng\nlibtool: link: gcc -shared  -fPIC -DPIC  .libs/brilliantrussian.o .libs/misc.o .libs/mzd.o .libs/graycode.o .libs/strassen.o .libs/mzp.o .libs/triangular.o .libs/triangular_russian.o .libs/ple.o .libs/ple_russian.o .libs/solve.o .libs/echelonform.o .libs/mmc.o .libs/debug_dump.o .libs/io.o   -lm -lpng  -mmmx -msse -msse2 -msse3 -O2   -Wl,-soname -Wl,libm4ri-0.0.20111203.so -o .libs/libm4ri-0.0.20111203.so\n/usr/bin/ld: cannot find -lpng\n```",
    "created_at": "2012-05-08T12:02:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146913",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>**Comment 23:**</a>
This fails to install on the Skynet machine "eno" (Fedora 16 x86_64):

```
/bin/sh ./libtool --tag=CC   --mode=link gcc -std=gnu99 -mmmx -msse -msse2 -msse3   -g -fPIC -Wall -pedantic -O2 -release 0.0.20111203 -no
-undefined  -o libm4ri.la -rpath /home/buildbot/build/sage/eno-1/eno_full/build/sage-5.1.beta1/local/lib brilliantrussian.lo misc.lo mzd.l
o graycode.lo strassen.lo mzp.lo triangular.lo triangular_russian.lo ple.lo ple_russian.lo solve.lo echelonform.lo mmc.lo debug_dump.lo io
.lo -lm -lpng
libtool: link: gcc -shared  -fPIC -DPIC  .libs/brilliantrussian.o .libs/misc.o .libs/mzd.o .libs/graycode.o .libs/strassen.o .libs/mzp.o .
libs/triangular.o .libs/triangular_russian.o .libs/ple.o .libs/ple_russian.o .libs/solve.o .libs/echelonform.o .libs/mmc.o .libs/debug_dum
p.o .libs/io.o   -lm -lpng  -mmmx -msse -msse2 -msse3 -O2   -Wl,-soname -Wl,libm4ri-0.0.20111203.so -o .libs/libm4ri-0.0.20111203.so
/usr/bin/ld: cannot find -lpng
collect2: ld returned 1 exit status
make[1]: *** [libm4ri.la] Error 1
make[1]: Leaving directory `/home/buildbot/build/sage/eno-1/eno_full/build/sage-5.1.beta1/spkg/build/libm4ri-20120415/src'
make: *** [all] Error 2
Error building libm4ri
```

```
$ ls -l local/lib/libpng*
36k -rw-r--r-- 1 buildbot sage 828k May  8 06:16 local/lib/libpng12.a
4.1k -rwxr-xr-x 1 buildbot sage 1.1k May  8 06:16 local/lib/libpng12.la*
   0 lrwxrwxrwx 1 buildbot sage   18 May  8 06:16 local/lib/libpng12.so -> libpng12.so.0.35.0*
   0 lrwxrwxrwx 1 buildbot sage   18 May  8 06:16 local/lib/libpng12.so.0 -> libpng12.so.0.35.0*
467k -rwxr-xr-x 1 buildbot sage 460k May  8 06:16 local/lib/libpng12.so.0.35.0*

$ ls -l /lib*/libpng* /usr/lib*/libpng*
ls: cannot access /lib*/libpng*: No such file or directory
   0 lrwxrwxrwx 1 root root   16 May  2 11:53 /usr/lib64/libpng.so.3 -> libpng.so.3.49.0*
173k -rwxr-xr-x 1 root root 172k Apr  7 14:33 /usr/lib64/libpng.so.3.49.0*
   0 lrwxrwxrwx 1 root root   18 May  2 11:53 /usr/lib64/libpng12.so.0 -> libpng12.so.0.49.0*
164k -rwxr-xr-x 1 root root 162k Apr  7 14:33 /usr/lib64/libpng12.so.0.49.0*
```

Note that there is no file `/usr/lib64/libpng.so`, so obviously there cannot be proper PNG support on this machine.  I consider this to be an upstream (not Sage) error.

```
$ grep -i png spkg/logs/libm4ri-20120415.log
checking whether to build with PNG support... yes
checking for PNG... no
checking for PNG... yes
/bin/sh ./libtool --tag=CC   --mode=link gcc -std=gnu99 -mmmx -msse -msse2 -msse3   -g -fPIC -Wall -pedantic -O2 -release 0.0.20111203 -no-undefined  -o libm4ri.la -rpath /home/buildbot/build/sage/eno-1/eno_full/build/sage-5.1.beta1/local/lib brilliantrussian.lo misc.lo mzd.lo graycode.lo strassen.lo mzp.lo triangular.lo triangular_russian.lo ple.lo ple_russian.lo solve.lo echelonform.lo mmc.lo debug_dump.lo io.lo -lm -lpng
libtool: link: gcc -shared  -fPIC -DPIC  .libs/brilliantrussian.o .libs/misc.o .libs/mzd.o .libs/graycode.o .libs/strassen.o .libs/mzp.o .libs/triangular.o .libs/triangular_russian.o .libs/ple.o .libs/ple_russian.o .libs/solve.o .libs/echelonform.o .libs/mmc.o .libs/debug_dump.o .libs/io.o   -lm -lpng  -mmmx -msse -msse2 -msse3 -O2   -Wl,-soname -Wl,libm4ri-0.0.20111203.so -o .libs/libm4ri-0.0.20111203.so
/usr/bin/ld: cannot find -lpng
```



---

archive/issue_events_149827.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T12:02:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149827"
}
```



---

archive/issue_events_149828.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T12:02:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149828"
}
```



---

archive/issue_comments_146914.json:
```json
{
    "body": "<a id='comment:24'>**Comment 24:**</a>\nWhy are you using `PKG_CHECK_MODULES()` to check for PNG support in `configure.ac`?  Why not `AC_CHECK_LIB()` or `AC_SEARCH_LIBS()`?",
    "created_at": "2012-05-08T12:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146914",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'>**Comment 24:**</a>
Why are you using `PKG_CHECK_MODULES()` to check for PNG support in `configure.ac`?  Why not `AC_CHECK_LIB()` or `AC_SEARCH_LIBS()`?



---

archive/issue_comments_146915.json:
```json
{
    "body": "<a id='comment:25'>**Comment 25:**</a>\nExactly the same problem with `-lpng` happens on Skynet \"cleo\" (RHEL 5.3 ia64)",
    "created_at": "2012-05-08T13:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146915",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:25'>**Comment 25:**</a>
Exactly the same problem with `-lpng` happens on Skynet "cleo" (RHEL 5.3 ia64)



---

archive/issue_comments_146916.json:
```json
{
    "body": "<a id='comment:26'>**Comment 26:**</a>\nReplying to [@jdemeyer](#comment%3A24):\n> Why are you using `PKG_CHECK_MODULES()` to check for PNG support in `configure.ac`?  Why not `AC_CHECK_LIB()` or `AC_SEARCH_LIBS()`?\n\nWe are doing both. We try `pkg-config` first and if that fails we fall back to `AC_CHECK_LIB`. In your log above, `PKG_CHECK_MODULES()` fails to find libpng and `AC_CHECK_LIB()` finds it.",
    "created_at": "2012-05-08T20:28:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146916",
    "user": "https://github.com/malb"
}
```

<a id='comment:26'>**Comment 26:**</a>
Replying to [@jdemeyer](#comment%3A24):
> Why are you using `PKG_CHECK_MODULES()` to check for PNG support in `configure.ac`?  Why not `AC_CHECK_LIB()` or `AC_SEARCH_LIBS()`?

We are doing both. We try `pkg-config` first and if that fails we fall back to `AC_CHECK_LIB`. In your log above, `PKG_CHECK_MODULES()` fails to find libpng and `AC_CHECK_LIB()` finds it.



---

archive/issue_comments_146917.json:
```json
{
    "body": "<a id='comment:27'>**Comment 27:**</a>\nNote that stand-alone M4RI builds fine on eno.\n\n```\nchecking pkg-config is at least version 0.9.0... yes\nchecking for PNG... no\nchecking for PNG... no\nchecking for PNG... no\nchecking for PNG... no\nchecking for png_create_write_struct in -lpng... no\n```\n\nSo I don't know why it fails when built inside Sage. In any case, Sage **ships** libpng so we should adapt `deps` to make M4RI dependent on libpng. I'll provide a patch to that effect.",
    "created_at": "2012-05-08T20:33:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146917",
    "user": "https://github.com/malb"
}
```

<a id='comment:27'>**Comment 27:**</a>
Note that stand-alone M4RI builds fine on eno.

```
checking pkg-config is at least version 0.9.0... yes
checking for PNG... no
checking for PNG... no
checking for PNG... no
checking for PNG... no
checking for png_create_write_struct in -lpng... no
```

So I don't know why it fails when built inside Sage. In any case, Sage **ships** libpng so we should adapt `deps` to make M4RI dependent on libpng. I'll provide a patch to that effect.



---

archive/issue_comments_146918.json:
```json
{
    "body": "<a id='comment:28'>**Comment 28:**</a>\n**Attachment:** [trac_12840_m4ri_png.patch.gz](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch.gz)\n\nReplying to [@malb](#comment%3A26):\n> In your log above, `PKG_CHECK_MODULES()` fails to find libpng and `AC_CHECK_LIB()` finds it.\n\nActually, it's not quite like that.  `PKG_CHECK_MODULES()` found `libpng12`  but you still try to link with `-lpng` instead of `-lpng12` (the first failure comes from the `libpng14` check).  `AC_CHECK_LIB()` isn't called (but it would fail).",
    "created_at": "2012-05-08T20:34:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146918",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'>**Comment 28:**</a>
**Attachment:** [trac_12840_m4ri_png.patch.gz](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch.gz)

Replying to [@malb](#comment%3A26):
> In your log above, `PKG_CHECK_MODULES()` fails to find libpng and `AC_CHECK_LIB()` finds it.

Actually, it's not quite like that.  `PKG_CHECK_MODULES()` found `libpng12`  but you still try to link with `-lpng` instead of `-lpng12` (the first failure comes from the `libpng14` check).  `AC_CHECK_LIB()` isn't called (but it would fail).



---

archive/issue_events_149829.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-05-08T20:34:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149829"
}
```



---

archive/issue_events_149830.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-05-08T20:34:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149830"
}
```



---

archive/issue_comments_146919.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n **Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n \n **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)\n+\n+**Apply:** [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)\n``````\n",
    "created_at": "2012-05-08T20:34:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146919",
    "user": "https://github.com/malb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 **Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
 
 **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)
+
+**Apply:** [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)
``````




---

archive/issue_comments_146920.json:
```json
{
    "body": "<a id='comment:30'>**Comment 30:**</a>\nI recommend against using `PKG_CHECK_MODULES()` and would use only `AC_SEARCH_LIBS()`.",
    "created_at": "2012-05-08T20:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146920",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'>**Comment 30:**</a>
I recommend against using `PKG_CHECK_MODULES()` and would use only `AC_SEARCH_LIBS()`.



---

archive/issue_comments_146921.json:
```json
{
    "body": "<a id='comment:31'>**Comment 31:**</a>\nThe patch you attached is probably good, but that's just part of the problem.",
    "created_at": "2012-05-08T20:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146921",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'>**Comment 31:**</a>
The patch you attached is probably good, but that's just part of the problem.



---

archive/issue_events_149831.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T20:36:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149831"
}
```



---

archive/issue_events_149832.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T20:36:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149832"
}
```



---

archive/issue_comments_146922.json:
```json
{
    "body": "<a id='comment:32'>**Comment 32:**</a>\nReplying to [@jdemeyer](#comment%3A31):\n> The patch you attached is probably good, but that's just part of the problem.\n\nCan you elaborate on that? I don't understand.",
    "created_at": "2012-05-08T20:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146922",
    "user": "https://github.com/malb"
}
```

<a id='comment:32'>**Comment 32:**</a>
Replying to [@jdemeyer](#comment%3A31):
> The patch you attached is probably good, but that's just part of the problem.

Can you elaborate on that? I don't understand.



---

archive/issue_comments_146923.json:
```json
{
    "body": "<a id='comment:33'>**Comment 33:**</a>\nReplying to [@malb](#comment%3A32):\n> Can you elaborate on that? I don't understand.\n\nWell, I tried to explain in [https://github.com/sagemath/sage/issues/12840#comment:28](https://github.com/sagemath/sage/issues/12840#comment:28).  The fact that\n\n```\nPKG_CHECK_MODULES([PNG], [libpng12])\n```\nsucceeds, does not imply that the library file `libpng.so` exists.  I don't see what you're trying to accomplish with those `PKG_CHECK_MODULES()` checks.",
    "created_at": "2012-05-09T06:42:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146923",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>**Comment 33:**</a>
Replying to [@malb](#comment%3A32):
> Can you elaborate on that? I don't understand.

Well, I tried to explain in [https://github.com/sagemath/sage/issues/12840#comment:28](https://github.com/sagemath/sage/issues/12840#comment:28).  The fact that

```
PKG_CHECK_MODULES([PNG], [libpng12])
```
succeeds, does not imply that the library file `libpng.so` exists.  I don't see what you're trying to accomplish with those `PKG_CHECK_MODULES()` checks.



---

archive/issue_comments_146924.json:
```json
{
    "body": "<a id='comment:34'>**Comment 34:**</a>\nI can try to write a patch if you like.",
    "created_at": "2012-05-09T06:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146924",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>**Comment 34:**</a>
I can try to write a patch if you like.



---

archive/issue_comments_146925.json:
```json
{
    "body": "<a id='comment:35'>**Comment 35:**</a>\nReplying to [@jdemeyer](#comment%3A33):\n> Replying to [@malb](#comment%3A32):\n> > Can you elaborate on that? I don't understand.\n\n> \n> ```\n> PKG_CHECK_MODULES([PNG], [libpng12])\n> ```\n> succeeds, does not imply that the library file `libpng.so` exists.  \n\nAh, right. It would need `-lpng12`. Yep, that's a bug. I'll fix that next week-ish.\n\n> I don't see what you're trying to accomplish with those `PKG_CHECK_MODULES()` checks.\n\nI am trying to use pkg-config for what it's intended. Making linking easier.",
    "created_at": "2012-05-10T08:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146925",
    "user": "https://github.com/malb"
}
```

<a id='comment:35'>**Comment 35:**</a>
Replying to [@jdemeyer](#comment%3A33):
> Replying to [@malb](#comment%3A32):
> > Can you elaborate on that? I don't understand.

> 
> ```
> PKG_CHECK_MODULES([PNG], [libpng12])
> ```
> succeeds, does not imply that the library file `libpng.so` exists.  

Ah, right. It would need `-lpng12`. Yep, that's a bug. I'll fix that next week-ish.

> I don't see what you're trying to accomplish with those `PKG_CHECK_MODULES()` checks.

I am trying to use pkg-config for what it's intended. Making linking easier.



---

archive/issue_comments_146926.json:
```json
{
    "body": "<a id='comment:36'>**Comment 36:**</a>\nMaybe you're using it for *what* it's intended, but not *how* it's intended.",
    "created_at": "2012-05-10T09:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146926",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'>**Comment 36:**</a>
Maybe you're using it for *what* it's intended, but not *how* it's intended.



---

archive/issue_comments_146927.json:
```json
{
    "body": "<a id='comment:37'>**Comment 37:**</a>\nReplying to [@jdemeyer](#comment%3A28):\n> Replying to [@malb](#comment%3A26):\n> > In your log above, `PKG_CHECK_MODULES()` fails to find libpng and `AC_CHECK_LIB()` finds it.\n\n> Actually, it's not quite like that.  `PKG_CHECK_MODULES()` found `libpng12`  but you still try to link with `-lpng` instead of `-lpng12` (the first failure comes from the `libpng14` check).  `AC_CHECK_LIB()` isn't called (but it would fail).\n\nFor some reason I missed this comment earlier, sorry. That makes sense & is an upstream bug which I intend to fix.",
    "created_at": "2012-05-10T11:33:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146927",
    "user": "https://github.com/malb"
}
```

<a id='comment:37'>**Comment 37:**</a>
Replying to [@jdemeyer](#comment%3A28):
> Replying to [@malb](#comment%3A26):
> > In your log above, `PKG_CHECK_MODULES()` fails to find libpng and `AC_CHECK_LIB()` finds it.

> Actually, it's not quite like that.  `PKG_CHECK_MODULES()` found `libpng12`  but you still try to link with `-lpng` instead of `-lpng12` (the first failure comes from the `libpng14` check).  `AC_CHECK_LIB()` isn't called (but it would fail).

For some reason I missed this comment earlier, sorry. That makes sense & is an upstream bug which I intend to fix.



---

archive/issue_comments_146928.json:
```json
{
    "body": "<a id='comment:38'>**Comment 38:**</a>\nReplying to [@jdemeyer](#comment%3A36):\n> Maybe you're using it for *what* it's intended, but not *how* it's intended.\n\nThis is a remarkably unhelpful comment.",
    "created_at": "2012-05-10T11:34:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146928",
    "user": "https://github.com/malb"
}
```

<a id='comment:38'>**Comment 38:**</a>
Replying to [@jdemeyer](#comment%3A36):
> Maybe you're using it for *what* it's intended, but not *how* it's intended.

This is a remarkably unhelpful comment.



---

archive/issue_comments_146929.json:
```json
{
    "body": "<a id='comment:39'>**Comment 39:**</a>\nReplying to [@malb](#comment%3A38):\n> This is a remarkably unhelpful comment.\n\nI know, but I have never done anything with pkgconfig, so I can't help more.",
    "created_at": "2012-05-10T11:53:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146929",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:39'>**Comment 39:**</a>
Replying to [@malb](#comment%3A38):
> This is a remarkably unhelpful comment.

I know, but I have never done anything with pkgconfig, so I can't help more.



---

archive/issue_comments_146930.json:
```json
{
    "body": "<a id='comment:40'>**Comment 40:**</a>\nI've updated the SPKG with a new upstream release which should fix the png issue.\n\nhttp://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120522.spkg",
    "created_at": "2012-05-22T15:36:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146930",
    "user": "https://github.com/malb"
}
```

<a id='comment:40'>**Comment 40:**</a>
I've updated the SPKG with a new upstream release which should fix the png issue.

http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120522.spkg



---

archive/issue_comments_146931.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n As the title says.\n \n-**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg\n+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120522.spkg\n \n **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)\n \n``````\n",
    "created_at": "2012-05-22T15:36:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146931",
    "user": "https://github.com/malb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 As the title says.
 
-**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120415.spkg
+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120522.spkg
 
 **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)
 
``````




---

archive/issue_events_149833.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-05-22T15:36:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149833"
}
```



---

archive/issue_events_149834.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-05-22T15:36:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149834"
}
```



---

archive/issue_comments_146932.json:
```json
{
    "body": "<a id='comment:42'>**Comment 42:**</a>\nCould someone please review this. I am looking into updating LinBox and updating M4RIE is a requirement for that (long story involving Givaro).",
    "created_at": "2012-06-06T20:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146932",
    "user": "https://github.com/malb"
}
```

<a id='comment:42'>**Comment 42:**</a>
Could someone please review this. I am looking into updating LinBox and updating M4RIE is a requirement for that (long story involving Givaro).



---

archive/issue_comments_146933.json:
```json
{
    "body": "<a id='comment:43'>**Comment 43:**</a>\nReplying to [@malb](#comment%3A42):\n> Could someone please review this. I am looking into updating LinBox and updating M4RIE is a requirement for that (long story involving Givaro).\n\nI could test the code on one or two linuxes. But I couldn't test whether the png problems on eno (as observed by Jeroen) are fixed. Jeroen, could you finish the review?",
    "created_at": "2012-06-07T09:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146933",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:43'>**Comment 43:**</a>
Replying to [@malb](#comment%3A42):
> Could someone please review this. I am looking into updating LinBox and updating M4RIE is a requirement for that (long story involving Givaro).

I could test the code on one or two linuxes. But I couldn't test whether the png problems on eno (as observed by Jeroen) are fixed. Jeroen, could you finish the review?



---

archive/issue_comments_146934.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)\n \n-**Apply:** [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)\n+**Apply** to `SAGE_ROOT`: [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)\n``````\n",
    "created_at": "2012-06-07T12:36:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146934",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)
 
-**Apply:** [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)
+**Apply** to `SAGE_ROOT`: [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)
``````




---

archive/issue_comments_146935.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n As the title says.\n \n-**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120522.spkg\n+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120613.spkg\n \n **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)\n \n``````\n",
    "created_at": "2012-06-07T16:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146935",
    "user": "https://github.com/malb"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 As the title says.
 
-**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120522.spkg
+**Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120613.spkg
 
 **Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)
 
``````




---

archive/issue_comments_146936.json:
```json
{
    "body": "<a id='comment:46'>**Comment 46:**</a>\nThe **previous** version installed fine on eno within Sage.  It seems the `libpng` check is totally gone now.",
    "created_at": "2012-06-07T16:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146936",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:46'>**Comment 46:**</a>
The **previous** version installed fine on eno within Sage.  It seems the `libpng` check is totally gone now.



---

archive/issue_comments_146937.json:
```json
{
    "body": "<a id='comment:47'>**Comment 47:**</a>\nReplying to [@jdemeyer](#comment%3A46):\n> The **previous** version installed fine on eno within Sage. \n\n\n>It seems the `libpng` check is totally gone now.\n\nThat's strange, it doesn't check?\n\nI had to update SPKG because I didn't add \"-I$SAGE_LOCAL/include\" before but we need it now because of the PNG dependency. The newest SPKG installs fine on geom.math which doesn't have a system libpng-dev.",
    "created_at": "2012-06-07T16:55:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146937",
    "user": "https://github.com/malb"
}
```

<a id='comment:47'>**Comment 47:**</a>
Replying to [@jdemeyer](#comment%3A46):
> The **previous** version installed fine on eno within Sage. 


>It seems the `libpng` check is totally gone now.

That's strange, it doesn't check?

I had to update SPKG because I didn't add "-I$SAGE_LOCAL/include" before but we need it now because of the PNG dependency. The newest SPKG installs fine on geom.math which doesn't have a system libpng-dev.



---

archive/issue_comments_146938.json:
```json
{
    "body": "<a id='comment:48'>**Comment 48:**</a>\nI've tried this on Fedora 17 (which doesn't have libpng12 either, its up to libpng15 now) and configure works as intended:\n\n```\nchecking whether to build with PNG support... yes\nchecking for pkg-config... /usr/bin/pkg-config\nchecking pkg-config is at least version 0.9.0... yes\nchecking for PNG... yes\n```\nJeroen, you might have overlooked this part in the log since it comes after the lengthy \"checking for cache sizes...\".\n\nI'm building on eno right now and if it works I'll set this ticket to positive review.",
    "created_at": "2012-06-17T13:08:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146938",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:48'>**Comment 48:**</a>
I've tried this on Fedora 17 (which doesn't have libpng12 either, its up to libpng15 now) and configure works as intended:

```
checking whether to build with PNG support... yes
checking for pkg-config... /usr/bin/pkg-config
checking pkg-config is at least version 0.9.0... yes
checking for PNG... yes
```
Jeroen, you might have overlooked this part in the log since it comes after the lengthy "checking for cache sizes...".

I'm building on eno right now and if it works I'll set this ticket to positive review.



---

archive/issue_comments_146939.json:
```json
{
    "body": "<a id='comment:49'>**Comment 49:**</a>\nSo Fedora has libpng.so then? I am asking because I am not checking for png15 explicitly.\n\n```\nif test \"x${want_png}\" = \"xyes\" ; then\n   PKG_CHECK_MODULES([PNG], [libpng],\n      [have_libpng=\"yes\"; LIBPNG_LIBADD=`pkg-config --libs libpng`],\n      [have_libpng=\"no\"])\n   if ! test \"x${have_libpng}\" = \"xyes\" ; then\n      AC_CHECK_LIB([png],\n         [png_create_write_struct],\n         [have_libpng=\"yes\"; LIBPNG_LIBADD=\"-lpng\"],\n         [AC_CHECK_LIB([png14],\n            [png_create_write_struct],\n            [have_libpng=\"yes\"; LIBPNG_LIBADD=\"-lpng14\"],\n            [AC_CHECK_LIB([png12],\n               [png_create_write_struct],\n               [have_libpng=\"yes\"; LIBPNG_LIBADD=\"-lpng12\"],\n               [AC_CHECK_LIB([png10],\n                  [png_create_write_struct],\n                  [have_libpng=\"yes\"; LIBPNG_LIBADD=\"-lpng10\"],\n                  [have_libpng=\"no\"])\n               ])\n            ])\n        ])\n   fi\n   if test \"x${have_libpng}\" = \"xno\" ; then\n      AC_MSG_WARN([Can not find a usuable PNG library. Make sure that CPPFLAGS and LDFLAGS are correctly set.])\n   fi\nfi\n\n```",
    "created_at": "2012-06-17T13:48:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146939",
    "user": "https://github.com/malb"
}
```

<a id='comment:49'>**Comment 49:**</a>
So Fedora has libpng.so then? I am asking because I am not checking for png15 explicitly.

```
if test "x${want_png}" = "xyes" ; then
   PKG_CHECK_MODULES([PNG], [libpng],
      [have_libpng="yes"; LIBPNG_LIBADD=`pkg-config --libs libpng`],
      [have_libpng="no"])
   if ! test "x${have_libpng}" = "xyes" ; then
      AC_CHECK_LIB([png],
         [png_create_write_struct],
         [have_libpng="yes"; LIBPNG_LIBADD="-lpng"],
         [AC_CHECK_LIB([png14],
            [png_create_write_struct],
            [have_libpng="yes"; LIBPNG_LIBADD="-lpng14"],
            [AC_CHECK_LIB([png12],
               [png_create_write_struct],
               [have_libpng="yes"; LIBPNG_LIBADD="-lpng12"],
               [AC_CHECK_LIB([png10],
                  [png_create_write_struct],
                  [have_libpng="yes"; LIBPNG_LIBADD="-lpng10"],
                  [have_libpng="no"])
               ])
            ])
        ])
   fi
   if test "x${have_libpng}" = "xno" ; then
      AC_MSG_WARN([Can not find a usuable PNG library. Make sure that CPPFLAGS and LDFLAGS are correctly set.])
   fi
fi

```



---

archive/issue_comments_146940.json:
```json
{
    "body": "<a id='comment:50'>**Comment 50:**</a>\nReplying to [@malb](#comment%3A49):\n\n> So Fedora has libpng.so then? I am asking because I am not checking for png15 explicitly.\u00a0\n\nArgh, I am stupid. It would find libpng12 as included in Sage. Sorry bout the noise.",
    "created_at": "2012-06-17T13:50:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146940",
    "user": "https://github.com/malb"
}
```

<a id='comment:50'>**Comment 50:**</a>
Replying to [@malb](#comment%3A49):

> So Fedora has libpng.so then? I am asking because I am not checking for png15 explicitly. 

Argh, I am stupid. It would find libpng12 as included in Sage. Sorry bout the noise.



---

archive/issue_comments_146941.json:
```json
{
    "body": "**Changing reviewer** from \"Simon King\" to \"Simon King, Volker Braun\".",
    "created_at": "2012-06-18T10:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146941",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "Simon King" to "Simon King, Volker Braun".



---

archive/issue_comments_146942.json:
```json
{
    "body": "<a id='comment:51'>**Comment 51:**</a>\nYes the `PKG_CHECK_MODULES` test wins in Sage, which is the way it should be. pkg-config is the way to go imho. Though if libpng were to use standard libtool versioning we would live in a better world, too ;-)\n\nIn any case, built and tested fine on eno. Positive review.",
    "created_at": "2012-06-18T10:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146942",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:51'>**Comment 51:**</a>
Yes the `PKG_CHECK_MODULES` test wins in Sage, which is the way it should be. pkg-config is the way to go imho. Though if libpng were to use standard libtool versioning we would live in a better world, too ;-)

In any case, built and tested fine on eno. Positive review.



---

archive/issue_events_149835.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-06-18T10:58:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149835"
}
```



---

archive/issue_events_149836.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-06-18T10:58:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149836"
}
```



---

archive/issue_events_149837.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T13:32:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149837"
}
```



---

archive/issue_events_149838.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T13:32:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149838"
}
```



---

archive/issue_comments_146943.json:
```json
{
    "body": "**Attachment:** [trac_12840-rebased-on-13109.patch.gz](https://github.com/sagemath/sage/files/ticket12840/trac_12840-rebased-on-13109.patch.gz)",
    "created_at": "2012-06-30T17:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146943",
    "user": "https://github.com/jhpalmieri"
}
```

**Attachment:** [trac_12840-rebased-on-13109.patch.gz](https://github.com/sagemath/sage/files/ticket12840/trac_12840-rebased-on-13109.patch.gz)



---

archive/issue_comments_146944.json:
```json
{
    "body": "<a id='comment:53'>**Comment 53:**</a>\nThe deprecations here should use the format from #13109.",
    "created_at": "2012-06-30T17:58:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146944",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:53'>**Comment 53:**</a>
The deprecations here should use the format from #13109.



---

archive/issue_events_149839.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-30T17:58:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149839"
}
```



---

archive/issue_events_149840.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-30T17:58:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149840"
}
```



---

archive/issue_comments_146945.json:
```json
{
    "body": "**Changing dependencies** from \"to be merged with #12841\" to \"to be merged with #12841, #13109\".",
    "created_at": "2012-06-30T17:58:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146945",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing dependencies** from "to be merged with #12841" to "to be merged with #12841, #13109".



---

archive/issue_comments_146946.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n **Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120613.spkg\n \n-**Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)\n+**Apply:** [[attachment:trac_12840-rebased-on-13109.patch](https://github.com/sagemath/sage/files/ticket12840/89705cda39230dae36baa9cebcb2ba60.patch](https://github.com/sagemath/sage/files/ticket12840/52f8a13c598f950af6b7b10b98049a51.patch),)\n \n **Apply** to `SAGE_ROOT`: [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)\n``````\n",
    "created_at": "2012-06-30T17:58:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146946",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 **Install: **http://sage.math.washington.edu/home/malb/spkgs/libm4ri-20120613.spkg
 
-**Apply:** [attachment:trac_12840_m4ri_new_version.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_new_version.patch)
+**Apply:** [[attachment:trac_12840-rebased-on-13109.patch](https://github.com/sagemath/sage/files/ticket12840/89705cda39230dae36baa9cebcb2ba60.patch](https://github.com/sagemath/sage/files/ticket12840/52f8a13c598f950af6b7b10b98049a51.patch),)
 
 **Apply** to `SAGE_ROOT`: [attachment:trac_12840_m4ri_png.patch](https://github.com/sagemath/sage/files/ticket12840/trac_12840_m4ri_png.patch)
``````




---

archive/issue_events_149841.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-30T17:58:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149841"
}
```



---

archive/issue_events_149842.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-06-30T17:58:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149842"
}
```



---

archive/issue_comments_146947.json:
```json
{
    "body": "<a id='comment:55'>**Comment 55:**</a>\nThe deprecations are not doctested.",
    "created_at": "2012-06-30T19:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146947",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:55'>**Comment 55:**</a>
The deprecations are not doctested.



---

archive/issue_events_149843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-06-30T19:49:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149843"
}
```



---

archive/issue_events_149844.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-06-30T19:49:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149844"
}
```



---

archive/issue_comments_146948.json:
```json
{
    "body": "<a id='comment:56'>**Comment 56:**</a>\nHmm deprecations (and any other warnings) don't work in cdef methods. I guess we can't doctest them, for now.",
    "created_at": "2012-06-30T19:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146948",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:56'>**Comment 56:**</a>
Hmm deprecations (and any other warnings) don't work in cdef methods. I guess we can't doctest them, for now.



---

archive/issue_comments_146949.json:
```json
{
    "body": "**Changing author** from \"Martin Albrecht\" to \"Martin Albrecht, John Palmieri\".",
    "created_at": "2012-06-30T19:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146949",
    "user": "https://github.com/vbraun"
}
```

**Changing author** from "Martin Albrecht" to "Martin Albrecht, John Palmieri".



---

archive/issue_events_149845.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-01T18:51:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149845"
}
```



---

archive/issue_events_149846.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-01T18:51:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149846"
}
```



---

archive/issue_events_149847.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-27T20:25:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149847"
}
```



---

archive/issue_events_149848.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-27T20:25:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/pending",
    "label_color": "008080",
    "label_name": "pending",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149848"
}
```



---

archive/issue_events_149849.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-27T20:36:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149849"
}
```



---

archive/issue_events_149850.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-27T20:36:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149850"
}
```



---

archive/issue_comments_146950.json:
```json
{
    "body": "<a id='comment:59'>**Comment 59:**</a>\nThis needs to be rebased to sage-5.2.rc1.",
    "created_at": "2012-07-27T20:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146950",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:59'>**Comment 59:**</a>
This needs to be rebased to sage-5.2.rc1.



---

archive/issue_comments_146951.json:
```json
{
    "body": "<a id='comment:60'>**Comment 60:**</a>\nCan you clarify the rebasing issues? I have no problems applying the patches from here and from #12841 on top of sage-5.2.rc1.",
    "created_at": "2012-07-27T21:53:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146951",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:60'>**Comment 60:**</a>
Can you clarify the rebasing issues? I have no problems applying the patches from here and from #12841 on top of sage-5.2.rc1.



---

archive/issue_comments_146952.json:
```json
{
    "body": "<a id='comment:61'>**Comment 61:**</a>\nI'm with John here, I've been carrying the mari/e/givaro/linbox patches in my queue for a while now and there was no breakage in sage-5.2.rc1 as far as I can tell.",
    "created_at": "2012-07-28T03:45:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146952",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:61'>**Comment 61:**</a>
I'm with John here, I've been carrying the mari/e/givaro/linbox patches in my queue for a while now and there was no breakage in sage-5.2.rc1 as far as I can tell.



---

archive/issue_events_149851.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-28T09:30:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149851"
}
```



---

archive/issue_events_149852.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-07-28T09:30:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149852"
}
```



---

archive/issue_comments_146953.json:
```json
{
    "body": "<a id='comment:62'>**Comment 62:**</a>\nMy mistake, I only applied the second Sage library patch and that didn't work.",
    "created_at": "2012-07-28T09:30:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146953",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'>**Comment 62:**</a>
My mistake, I only applied the second Sage library patch and that didn't work.



---

archive/issue_events_149853.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-01T12:10:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149853"
}
```



---

archive/issue_events_149854.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-01T12:10:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12840#event-149854"
}
```



---

archive/issue_comments_146954.json:
```json
{
    "body": "**Merged:** sage-5.3.beta0",
    "created_at": "2012-08-01T12:10:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12840#issuecomment-146954",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.3.beta0
