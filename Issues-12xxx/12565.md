# Issue 12565: E = EllipticCurve('10a1') gives a stupid traceback (rather than a smart one)

archive/issues_012393.json:
```json
{
    "body": "I don't like this error:\n\n```\nsage: E = EllipticCurve('10a1')\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/Users/wstein/sage/install/sage-5.0.beta2/devel/sage-git/sage/modular/modsym/padic_lseries/<ipython console> in <module>()\n\n/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)\n    293         \n    294     if isinstance(x, str):\n--> 295         return ell_rational_field.EllipticCurve_rational_field(x)\n    296         \n    297     if rings.is_RingElement(x) and y is None:\n\n/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)\n    197             label = ainvs\n    198             X = sage.databases.cremona.CremonaDatabase()[label]\n--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))\n    200             self.__np = {}\n    201             self.__gens = {}\n\nAttributeError: 'NoneType' object has no attribute 'a_invariants'\n```\n\nI would expect something like:\n\n```\nValueError: no known curve with Cremona label '10a1' \n```\n\nAnother bug.  If you use Sage for a level outside the Cremona range and you're using a system-wide Sage install, this is the error you get, which is pretty scary looking:\n\n```\nsage: E = EllipticCurve('10050000s1')\nTraceback (most recent call last):\n  File \"/usr/local/share/sage-4.8/local/bin/sage-list-packages\", line 21, in <module>\n    os.makedirs(SAGE_ROOT_TMP)\n  File \"/usr/local/share/sage-4.8/local/lib/python/os.py\", line 157, in makedirs\n    mkdir(name, mode)\nOSError: [Errno 13] Permission denied: '/usr/local/share/sage-4.8/tmp'\nUsing SAGE Server http://www.sagemath.org//packages\n\nOptional package list (shown above) appears to be currently not available or corrupted (network error?).\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/home/wstein/<ipython console> in <module>()\n\n/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)\n    293         \n    294     if isinstance(x, str):\n--> 295         return ell_rational_field.EllipticCurve_rational_field(x)\n    296         \n    297     if rings.is_RingElement(x) and y is None:\n\n/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)\n    197             label = ainvs\n    198             X = sage.databases.cremona.CremonaDatabase()[label]\n--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))\n    200             self.__np = {}\n    201             self.__gens = {}\n\nAttributeError: 'NoneType' object has no attribute 'a_invariants'\n```\n\n\n---\n\nApply patch at #12341\n\nApply attachment:trac_12565-rebase.patch\n\nAssignee: @JohnCremona\n\nReviewer: John Cremona\n\nAuthor: R. Andrew Ohana\n\nMerged: sage-5.5.beta2\n\nDependencies: #12341\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12565\n\n",
    "closed_at": "2012-11-13T08:20:42Z",
    "created_at": "2012-02-22T18:46:16Z",
    "labels": [
        "component: elliptic curves",
        "trivial",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "E = EllipticCurve('10a1') gives a stupid traceback (rather than a smart one)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12565",
    "user": "https://github.com/williamstein"
}
```
I don't like this error:

```
sage: E = EllipticCurve('10a1')
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/Users/wstein/sage/install/sage-5.0.beta2/devel/sage-git/sage/modular/modsym/padic_lseries/<ipython console> in <module>()

/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)
    293         
    294     if isinstance(x, str):
--> 295         return ell_rational_field.EllipticCurve_rational_field(x)
    296         
    297     if rings.is_RingElement(x) and y is None:

/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)
    197             label = ainvs
    198             X = sage.databases.cremona.CremonaDatabase()[label]
--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))
    200             self.__np = {}
    201             self.__gens = {}

AttributeError: 'NoneType' object has no attribute 'a_invariants'
```

I would expect something like:

```
ValueError: no known curve with Cremona label '10a1' 
```

Another bug.  If you use Sage for a level outside the Cremona range and you're using a system-wide Sage install, this is the error you get, which is pretty scary looking:

```
sage: E = EllipticCurve('10050000s1')
Traceback (most recent call last):
  File "/usr/local/share/sage-4.8/local/bin/sage-list-packages", line 21, in <module>
    os.makedirs(SAGE_ROOT_TMP)
  File "/usr/local/share/sage-4.8/local/lib/python/os.py", line 157, in makedirs
    mkdir(name, mode)
OSError: [Errno 13] Permission denied: '/usr/local/share/sage-4.8/tmp'
Using SAGE Server http://www.sagemath.org//packages

Optional package list (shown above) appears to be currently not available or corrupted (network error?).
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/wstein/<ipython console> in <module>()

/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)
    293         
    294     if isinstance(x, str):
--> 295         return ell_rational_field.EllipticCurve_rational_field(x)
    296         
    297     if rings.is_RingElement(x) and y is None:

/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)
    197             label = ainvs
    198             X = sage.databases.cremona.CremonaDatabase()[label]
--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))
    200             self.__np = {}
    201             self.__gens = {}

AttributeError: 'NoneType' object has no attribute 'a_invariants'
```


---

Apply patch at #12341

Apply attachment:trac_12565-rebase.patch

Assignee: @JohnCremona

Reviewer: John Cremona

Author: R. Andrew Ohana

Merged: sage-5.5.beta2

Dependencies: #12341

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12565





---

archive/issue_comments_155146.json:
```json
{
    "body": "<a id='comment:1'></a>That is really stupid.  I'm sure it never used to do that --but why is there not a dictest for this construction on a failing string?  I wonder if this came in with the new database implmentation.  The error should surely be raised in the call to teh class contructor with the string, not just returning None.",
    "created_at": "2012-02-23T09:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155146",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>That is really stupid.  I'm sure it never used to do that --but why is there not a dictest for this construction on a failing string?  I wonder if this came in with the new database implmentation.  The error should surely be raised in the call to teh class contructor with the string, not just returning None.



---

archive/issue_comments_155147.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 cremona]:\n> I wonder if this came in with the new database implementation.\n\nYup, with 4.7.2 (pre database change)\n\n```\nsage: EllipticCurve('10a1')\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()\n\n/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)\n    293         \n    294     if isinstance(x, str):\n--> 295         return ell_rational_field.EllipticCurve_rational_field(x)\n    296         \n    297     if rings.is_RingElement(x) and y is None:\n\n/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)\n    196         if isinstance(ainvs, str):\n    197             label = ainvs\n--> 198             X = sage.databases.cremona.CremonaDatabase()[label]\n    199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))\n    200             self.__np = {}\n\n/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/databases/cremona.pyc in __getitem__(self, N)\n    453                 return sage.databases.db.Database.__getitem__(self, N)\n    454             else:\n--> 455                 return self.elliptic_curve(N)\n    456         try:\n    457             N = int(N)\n\n/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/databases/cremona.pyc in elliptic_curve(self, label)\n    693             else:\n    694                 message = \"There is no elliptic curve with label \"+label+\" in the currently available databases\"\n--> 695             raise RuntimeError, message\n    696         \n    697         F = elliptic.EllipticCurve(e[0])\n\nRuntimeError: There is no elliptic curve with label 10a1 in the database (note: use lower case letters!)\n```\n\nI'll go see about fixing this now.\n\nFor the other bug, that looks like it might not be specific to the cremona database.",
    "created_at": "2012-02-23T17:49:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155147",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:2'></a>Replying to [comment:1 cremona]:
> I wonder if this came in with the new database implementation.

Yup, with 4.7.2 (pre database change)

```
sage: EllipticCurve('10a1')
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/<ipython console> in <module>()

/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)
    293         
    294     if isinstance(x, str):
--> 295         return ell_rational_field.EllipticCurve_rational_field(x)
    296         
    297     if rings.is_RingElement(x) and y is None:

/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)
    196         if isinstance(ainvs, str):
    197             label = ainvs
--> 198             X = sage.databases.cremona.CremonaDatabase()[label]
    199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))
    200             self.__np = {}

/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/databases/cremona.pyc in __getitem__(self, N)
    453                 return sage.databases.db.Database.__getitem__(self, N)
    454             else:
--> 455                 return self.elliptic_curve(N)
    456         try:
    457             N = int(N)

/home/ohanar/sage-dev/sage-4.7.2-sage.math.washington.edu-x86_64-Linux/local/lib/python2.6/site-packages/sage/databases/cremona.pyc in elliptic_curve(self, label)
    693             else:
    694                 message = "There is no elliptic curve with label "+label+" in the currently available databases"
--> 695             raise RuntimeError, message
    696         
    697         F = elliptic.EllipticCurve(e[0])

RuntimeError: There is no elliptic curve with label 10a1 in the database (note: use lower case letters!)
```

I'll go see about fixing this now.

For the other bug, that looks like it might not be specific to the cremona database.



---

archive/issue_comments_155148.json:
```json
{
    "body": "<a id='comment:3'></a>ok, that first bug was really stupid. The error message was being created, but it was never being raised. This also gives the correct error for the other end of the spectrum, but it doesn't fix the scary permissions error. I'm going to see what that is about now.",
    "created_at": "2012-02-23T18:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155148",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:3'></a>ok, that first bug was really stupid. The error message was being created, but it was never being raised. This also gives the correct error for the other end of the spectrum, but it doesn't fix the scary permissions error. I'm going to see what that is about now.



---

archive/issue_comments_155149.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-23T18:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155149",
    "user": "https://github.com/ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_155150.json:
```json
{
    "body": "<a id='comment:4'></a>so #12341 fixes the other issue, please review these two tickets",
    "created_at": "2012-02-23T18:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155150",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:4'></a>so #12341 fixes the other issue, please review these two tickets



---

archive/issue_comments_155151.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-23T19:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155151",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155152.json:
```json
{
    "body": "<a id='comment:5'></a>I think this error message is annoying: \n\n```\nRuntimeError: There is no elliptic curve with label 10a1 in the database (note: use lower case letters!) \n```\nI can see putting \" (note: use lower case letters!) \" if the user input \"10A1\", but if they already input lower case letters, why add that remark!?",
    "created_at": "2012-02-23T19:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155152",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:5'></a>I think this error message is annoying: 

```
RuntimeError: There is no elliptic curve with label 10a1 in the database (note: use lower case letters!) 
```
I can see putting " (note: use lower case letters!) " if the user input "10A1", but if they already input lower case letters, why add that remark!?



---

archive/issue_comments_155153.json:
```json
{
    "body": "<a id='comment:6'></a>ok, changed that by making it accept old cremona labels (and having the label parser actually throw errors if there is a problem with the label)",
    "created_at": "2012-02-23T19:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155153",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:6'></a>ok, changed that by making it accept old cremona labels (and having the label parser actually throw errors if there is a problem with the label)



---

archive/issue_comments_155154.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-23T19:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155154",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155155.json:
```json
{
    "body": "<a id='comment:7'></a>dependency was added since otherwise this patch no longer applies cleanly",
    "created_at": "2012-02-23T19:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155155",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:7'></a>dependency was added since otherwise this patch no longer applies cleanly



---

archive/issue_comments_155156.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-23T19:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155156",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155157.json:
```json
{
    "body": "<a id='comment:8'></a>Include an example that illustrates the following: \"accept old cremona labels\"",
    "created_at": "2012-02-23T19:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155157",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'></a>Include an example that illustrates the following: "accept old cremona labels"



---

archive/issue_comments_155158.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 was]:\n> Include an example that illustrates the following: \"accept old cremona labels\"\n\n\nWhere? In the elliptic curve constructor, the database method, or both?",
    "created_at": "2012-02-23T19:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155158",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:9'></a>Replying to [comment:8 was]:
> Include an example that illustrates the following: "accept old cremona labels"


Where? In the elliptic curve constructor, the database method, or both?



---

archive/issue_comments_155159.json:
```json
{
    "body": "<a id='comment:10'></a>> In the elliptic curve constructor, the database method, or both?\n\n\nIn both, and use different examples in each case (it's your chance to be creative!)",
    "created_at": "2012-02-23T19:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155159",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:10'></a>> In the elliptic curve constructor, the database method, or both?


In both, and use different examples in each case (it's your chance to be creative!)



---

archive/issue_comments_155160.json:
```json
{
    "body": "Attachment [trac12565.patch](tarball://root/attachments/some-uuid/ticket12565/trac12565.patch) by @ohanar created at 2012-02-23 20:04:50",
    "created_at": "2012-02-23T20:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155160",
    "user": "https://github.com/ohanar"
}
```

Attachment [trac12565.patch](tarball://root/attachments/some-uuid/ticket12565/trac12565.patch) by @ohanar created at 2012-02-23 20:04:50



---

archive/issue_comments_155161.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-23T20:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155161",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155162.json:
```json
{
    "body": "<a id='comment:11'></a>ok, hopefully there that satisfies all of your complaints :)",
    "created_at": "2012-02-23T20:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155162",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:11'></a>ok, hopefully there that satisfies all of your complaints :)



---

archive/issue_comments_155163.json:
```json
{
    "body": "<a id='comment:12'></a>oops, put the wrong ticket as the dependency",
    "created_at": "2012-02-23T20:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155163",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:12'></a>oops, put the wrong ticket as the dependency



---

archive/issue_comments_155164.json:
```json
{
    "body": "<a id='comment:13'></a>I found the root of the permissions issue that #12341 avoids and have made the ticket #12578 for it.",
    "created_at": "2012-02-23T21:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155164",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:13'></a>I found the root of the permissions issue that #12341 avoids and have made the ticket #12578 for it.



---

archive/issue_comments_155165.json:
```json
{
    "body": "<a id='comment:14'></a>I get an error applying the patch to 5.0.beta5, at line 677 in sage/databases/cremona.py with reject messsage\n\n```\nHunk #4 FAILED at 677\n1 out of 5 hunks FAILED -- saving rejects to file sage/databases/cremona.py.rej\npatch failed, unable to continue (try -v)\npatch failed, rejects left in working dir\nerrors during apply, please fix and refresh trac12565.patch\n```\nbut I'm not sure what is causing this.  the patch looks fine to me.  After app;lying the patch (without that hunk) I still get\n\n```\nsage: EllipticCurve('10a1')\n...\nRuntimeError: There is no elliptic curve with label 10a1 in the database (note: use lower case letters!)\n```\nIf you can fix this I'm sure I'll be able to give a positive review quickly.",
    "created_at": "2012-02-24T14:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155165",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>I get an error applying the patch to 5.0.beta5, at line 677 in sage/databases/cremona.py with reject messsage

```
Hunk #4 FAILED at 677
1 out of 5 hunks FAILED -- saving rejects to file sage/databases/cremona.py.rej
patch failed, unable to continue (try -v)
patch failed, rejects left in working dir
errors during apply, please fix and refresh trac12565.patch
```
but I'm not sure what is causing this.  the patch looks fine to me.  After app;lying the patch (without that hunk) I still get

```
sage: EllipticCurve('10a1')
...
RuntimeError: There is no elliptic curve with label 10a1 in the database (note: use lower case letters!)
```
If you can fix this I'm sure I'll be able to give a positive review quickly.



---

archive/issue_comments_155166.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-24T14:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155166",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_155167.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-24T18:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155167",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155168.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 cremona]:\n> I get an error applying the patch to 5.0.beta5, at line 677 in sage/databases/cremona.py with reject messsage\n\n\nThis patch was based off of #12341 which also touches this file, which is why I added it as a dependency. (The reason why it fails is due to the line following the one that generates the error message, it is changed in #12341)",
    "created_at": "2012-02-24T18:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155168",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:15'></a>Replying to [comment:14 cremona]:
> I get an error applying the patch to 5.0.beta5, at line 677 in sage/databases/cremona.py with reject messsage


This patch was based off of #12341 which also touches this file, which is why I added it as a dependency. (The reason why it fails is due to the line following the one that generates the error message, it is changed in #12341)



---

archive/issue_comments_155169.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -65,6 +65,13 @@\n AttributeError: 'NoneType' object has no attribute 'a_invariants'\n ```\n \n+\n+---\n+\n+Apply patch at #12341\n+\n+Apply attachment:trac12565.patch\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/12565\n``````\n",
    "created_at": "2012-02-24T18:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155169",
    "user": "https://github.com/ohanar"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -65,6 +65,13 @@
 AttributeError: 'NoneType' object has no attribute 'a_invariants'
 ```
 
+
+---
+
+Apply patch at #12341
+
+Apply attachment:trac12565.patch
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/12565
``````




---

archive/issue_comments_155170.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:15 ohanar]:\n> Replying to [comment:14 cremona]:\n> > I get an error applying the patch to 5.0.beta5, at line 677 in sage/databases/cremona.py with reject messsage\n\n> \n> This patch was based off of #12341 which also touches this file, which is why I added it as a dependency. (The reason why it fails is due to the line following the one that generates the error message, it is changed in #12341)\n\n\nSorry, my mistake -- I did not notice the dependency.  I will get back to it.",
    "created_at": "2012-02-25T12:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155170",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'></a>Replying to [comment:15 ohanar]:
> Replying to [comment:14 cremona]:
> > I get an error applying the patch to 5.0.beta5, at line 677 in sage/databases/cremona.py with reject messsage

> 
> This patch was based off of #12341 which also touches this file, which is why I added it as a dependency. (The reason why it fails is due to the line following the one that generates the error message, it is changed in #12341)


Sorry, my mistake -- I did not notice the dependency.  I will get back to it.



---

archive/issue_comments_155171.json:
```json
{
    "body": "<a id='comment:18'></a>With #12341 this applies (to 5.0.beta5) and works fine.",
    "created_at": "2012-02-25T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155171",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:18'></a>With #12341 this applies (to 5.0.beta5) and works fine.



---

archive/issue_comments_155172.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-25T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155172",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_033966.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-07T10:00:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12565#event-33966"
}
```



---

archive/issue_comments_155173.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-10-11T11:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155173",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_155174.json:
```json
{
    "body": "Rebasing after #12341's rebase",
    "created_at": "2012-10-11T11:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155174",
    "user": "https://github.com/JohnCremona"
}
```

Rebasing after #12341's rebase



---

archive/issue_comments_155175.json:
```json
{
    "body": "<a id='comment:21'></a>Attachment [trac_12565-rebase.patch](tarball://root/attachments/some-uuid/ticket12565/trac_12565-rebase.patch) by @JohnCremona created at 2012-10-11 12:01:49\n\nI have rebased the patch so that it now works after the rebased #12341.\n\nThis was not quite trivial as a little extra coding was needed so that \"Old Cremona labels\" could be parsed properly using the regexp method.\n\nI tested sage/databses/cremona.py and all in sage/schemes/elliptic_curves.",
    "created_at": "2012-10-11T12:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155175",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:21'></a>Attachment [trac_12565-rebase.patch](tarball://root/attachments/some-uuid/ticket12565/trac_12565-rebase.patch) by @JohnCremona created at 2012-10-11 12:01:49

I have rebased the patch so that it now works after the rebased #12341.

This was not quite trivial as a little extra coding was needed so that "Old Cremona labels" could be parsed properly using the regexp method.

I tested sage/databses/cremona.py and all in sage/schemes/elliptic_curves.



---

archive/issue_comments_155176.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-10-11T12:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155176",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_155177.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,76 @@\n+I don't like this error:\n \n+```\n+sage: E = EllipticCurve('10a1')\n+---------------------------------------------------------------------------\n+AttributeError                            Traceback (most recent call last)\n+\n+/Users/wstein/sage/install/sage-5.0.beta2/devel/sage-git/sage/modular/modsym/padic_lseries/<ipython console> in <module>()\n+\n+/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)\n+    293         \n+    294     if isinstance(x, str):\n+--> 295         return ell_rational_field.EllipticCurve_rational_field(x)\n+    296         \n+    297     if rings.is_RingElement(x) and y is None:\n+\n+/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)\n+    197             label = ainvs\n+    198             X = sage.databases.cremona.CremonaDatabase()[label]\n+--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))\n+    200             self.__np = {}\n+    201             self.__gens = {}\n+\n+AttributeError: 'NoneType' object has no attribute 'a_invariants'\n+```\n+\n+I would expect something like:\n+\n+```\n+ValueError: no known curve with Cremona label '10a1' \n+```\n+\n+Another bug.  If you use Sage for a level outside the Cremona range and you're using a system-wide Sage install, this is the error you get, which is pretty scary looking:\n+\n+```\n+sage: E = EllipticCurve('10050000s1')\n+Traceback (most recent call last):\n+  File \"/usr/local/share/sage-4.8/local/bin/sage-list-packages\", line 21, in <module>\n+    os.makedirs(SAGE_ROOT_TMP)\n+  File \"/usr/local/share/sage-4.8/local/lib/python/os.py\", line 157, in makedirs\n+    mkdir(name, mode)\n+OSError: [Errno 13] Permission denied: '/usr/local/share/sage-4.8/tmp'\n+Using SAGE Server http://www.sagemath.org//packages\n+\n+Optional package list (shown above) appears to be currently not available or corrupted (network error?).\n+---------------------------------------------------------------------------\n+AttributeError                            Traceback (most recent call last)\n+\n+/home/wstein/<ipython console> in <module>()\n+\n+/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)\n+    293         \n+    294     if isinstance(x, str):\n+--> 295         return ell_rational_field.EllipticCurve_rational_field(x)\n+    296         \n+    297     if rings.is_RingElement(x) and y is None:\n+\n+/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)\n+    197             label = ainvs\n+    198             X = sage.databases.cremona.CremonaDatabase()[label]\n+--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))\n+    200             self.__np = {}\n+    201             self.__gens = {}\n+\n+AttributeError: 'NoneType' object has no attribute 'a_invariants'\n+```\n+\n+\n+---\n+\n+Apply patch at #12341\n+\n+Apply attachment:trac_12565-rebase.patch\n \n Comment: 1\n \n``````\n",
    "created_at": "2012-10-11T12:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155177",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,76 @@
+I don't like this error:
 
+```
+sage: E = EllipticCurve('10a1')
+---------------------------------------------------------------------------
+AttributeError                            Traceback (most recent call last)
+
+/Users/wstein/sage/install/sage-5.0.beta2/devel/sage-git/sage/modular/modsym/padic_lseries/<ipython console> in <module>()
+
+/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)
+    293         
+    294     if isinstance(x, str):
+--> 295         return ell_rational_field.EllipticCurve_rational_field(x)
+    296         
+    297     if rings.is_RingElement(x) and y is None:
+
+/Users/wstein/sage/install/sage-5.0.beta2/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)
+    197             label = ainvs
+    198             X = sage.databases.cremona.CremonaDatabase()[label]
+--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))
+    200             self.__np = {}
+    201             self.__gens = {}
+
+AttributeError: 'NoneType' object has no attribute 'a_invariants'
+```
+
+I would expect something like:
+
+```
+ValueError: no known curve with Cremona label '10a1' 
+```
+
+Another bug.  If you use Sage for a level outside the Cremona range and you're using a system-wide Sage install, this is the error you get, which is pretty scary looking:
+
+```
+sage: E = EllipticCurve('10050000s1')
+Traceback (most recent call last):
+  File "/usr/local/share/sage-4.8/local/bin/sage-list-packages", line 21, in <module>
+    os.makedirs(SAGE_ROOT_TMP)
+  File "/usr/local/share/sage-4.8/local/lib/python/os.py", line 157, in makedirs
+    mkdir(name, mode)
+OSError: [Errno 13] Permission denied: '/usr/local/share/sage-4.8/tmp'
+Using SAGE Server http://www.sagemath.org//packages
+
+Optional package list (shown above) appears to be currently not available or corrupted (network error?).
+---------------------------------------------------------------------------
+AttributeError                            Traceback (most recent call last)
+
+/home/wstein/<ipython console> in <module>()
+
+/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/constructor.pyc in EllipticCurve(x, y, j)
+    293         
+    294     if isinstance(x, str):
+--> 295         return ell_rational_field.EllipticCurve_rational_field(x)
+    296         
+    297     if rings.is_RingElement(x) and y is None:
+
+/usr/local/share/sage-4.8/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_rational_field.pyc in __init__(self, ainvs, extra)
+    197             label = ainvs
+    198             X = sage.databases.cremona.CremonaDatabase()[label]
+--> 199             EllipticCurve_number_field.__init__(self, Q, list(X.a_invariants()))
+    200             self.__np = {}
+    201             self.__gens = {}
+
+AttributeError: 'NoneType' object has no attribute 'a_invariants'
+```
+
+
+---
+
+Apply patch at #12341
+
+Apply attachment:trac_12565-rebase.patch
 
 Comment: 1
 
``````




---

archive/issue_comments_155178.json:
```json
{
    "body": "<a id='comment:22'></a>The regexp code looks good to me.",
    "created_at": "2012-10-11T23:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155178",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:22'></a>The regexp code looks good to me.



---

archive/issue_comments_155179.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-10-12T08:06:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155179",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_155180.json:
```json
{
    "body": "<a id='comment:24'></a>To confirm: I checked that the rebased patch applies to 5.4.rc1+trac_12341.patch (after that was rebased), and that all tests in schemes/elliptic_curves pass (1) without database_ell_cremona installed, (2) with it installed, without \"-optional database_cremona_ellcurve\", (3) with it installed and with \"-optional database_cremona_ellcurve\".\n\nThe only failed test is the one in heegner.py which fails when the optional database is installed for reasons spelled out elsewhere and to be fixed in #13547.",
    "created_at": "2012-10-15T12:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155180",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>To confirm: I checked that the rebased patch applies to 5.4.rc1+trac_12341.patch (after that was rebased), and that all tests in schemes/elliptic_curves pass (1) without database_ell_cremona installed, (2) with it installed, without "-optional database_cremona_ellcurve", (3) with it installed and with "-optional database_cremona_ellcurve".

The only failed test is the one in heegner.py which fails when the optional database is installed for reasons spelled out elsewhere and to be fixed in #13547.



---

archive/issue_events_033967.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-01T12:17:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12565#event-33967"
}
```



---

archive/issue_events_033968.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-01T12:17:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "milestone": "sage-5.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12565#event-33968"
}
```



---

archive/issue_comments_155181.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-13T08:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12565#issuecomment-155181",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_033969.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-11-13T08:20:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12565",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12565#event-33969"
}
```
