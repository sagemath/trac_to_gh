# Issue 12828: get_memory_usage and top under FreeBSD

archive/issues_012656.json:
```json
{
    "body": "Suggested changes to sage/misc/getusage.py:\n\n```\n--- sage-5.0.beta13/sage/misc/getusage.py-orig  2012-04-11 00:14:47.000000000 +0000\n+++ sage-5.0.beta13/sage/misc/getusage.py       2012-04-11 00:47:03.000000000 +0000\n@@ -20,6 +20,8 @@\n     \"\"\"\n     Return the 'top' or 'prstat' line that contains this running Sage\n     process.\n+    For FreeBSD, return the line containing this running Sage process from\n+    'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm'.\n\n     OUTPUT:\n\n@@ -53,6 +55,8 @@\n         cmd = 'top -l 1 |grep \"^ *%s \"' % pid\n     elif U == 'sunos':\n         cmd = '/usr/bin/prstat -n 100000 1 1  | grep \"^ *%s \"' % pid\n+    elif U == 'freebsd':\n+        cmd = 'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm | grep \"^ *%s \"' % pid\n     else:\n         raise NotImplementedError(\"top not implemented on platform %s\" % U)\n\n@@ -83,6 +87,9 @@\n       usage, ``prstat`` will output the data in KB, MB or GB. In each\n       case, the value returned by this function will always be in MB.\n\n+    - ``FreeBSD`` - Returns float number (in megabytes) that matches\n+      RSS column of ``ps -auxwww``\n+\n     - ``other`` - not implemented for any other operating systems\n\n     EXAMPLES::\n@@ -129,6 +136,9 @@\n             m = float(memory_in_KB_MB_or_GB.strip(\"M\"))\n         elif memory_in_KB_MB_or_GB.endswith(\"G\"):\n             m = float(memory_in_KB_MB_or_GB.strip(\"G\")) * 1024\n+    elif U == 'freebsd':\n+        memory_in_KB = top().split()[3]\n+        m = float(memory_in_KB) / 1024\n     else:\n         raise NotImplementedError(\"memory usage not implemented on platform %s\" % U)\n```\n\nApply [attachment:trac_12828.patch].\n\n**Assignee:** @peterjeremy\n\n**CC:**  jpflori\n\n**Reviewer:** Karl-Dieter Crisman\n\n**Author:** Stephen Montgomery-Smith\n\n**Merged:** sage-5.9.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/12828\n\n",
    "closed_at": "2013-03-14T08:11:15Z",
    "created_at": "2012-04-11T03:44:35Z",
    "labels": [
        "component: porting: bsd",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "get_memory_usage and top under FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12828",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```
Suggested changes to sage/misc/getusage.py:

```
--- sage-5.0.beta13/sage/misc/getusage.py-orig  2012-04-11 00:14:47.000000000 +0000
+++ sage-5.0.beta13/sage/misc/getusage.py       2012-04-11 00:47:03.000000000 +0000
@@ -20,6 +20,8 @@
     """
     Return the 'top' or 'prstat' line that contains this running Sage
     process.
+    For FreeBSD, return the line containing this running Sage process from
+    'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm'.

     OUTPUT:

@@ -53,6 +55,8 @@
         cmd = 'top -l 1 |grep "^ *%s "' % pid
     elif U == 'sunos':
         cmd = '/usr/bin/prstat -n 100000 1 1  | grep "^ *%s "' % pid
+    elif U == 'freebsd':
+        cmd = 'ps -axwww -o pid,user,vsz,rss,state,pri,nice,time,cpu,comm | grep "^ *%s "' % pid
     else:
         raise NotImplementedError("top not implemented on platform %s" % U)

@@ -83,6 +87,9 @@
       usage, ``prstat`` will output the data in KB, MB or GB. In each
       case, the value returned by this function will always be in MB.

+    - ``FreeBSD`` - Returns float number (in megabytes) that matches
+      RSS column of ``ps -auxwww``
+
     - ``other`` - not implemented for any other operating systems

     EXAMPLES::
@@ -129,6 +136,9 @@
             m = float(memory_in_KB_MB_or_GB.strip("M"))
         elif memory_in_KB_MB_or_GB.endswith("G"):
             m = float(memory_in_KB_MB_or_GB.strip("G")) * 1024
+    elif U == 'freebsd':
+        memory_in_KB = top().split()[3]
+        m = float(memory_in_KB) / 1024
     else:
         raise NotImplementedError("memory usage not implemented on platform %s" % U)
```

Apply [attachment:trac_12828.patch].

**Assignee:** @peterjeremy

**CC:**  jpflori

**Reviewer:** Karl-Dieter Crisman

**Author:** Stephen Montgomery-Smith

**Merged:** sage-5.9.beta0

Issue created by migration from https://trac.sagemath.org/ticket/12828





---

archive/issue_comments_148208.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis just needs to be a patch for us to review it.  Thanks for all the work on this.",
    "created_at": "2012-06-20T19:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148208",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:1'></a>
This just needs to be a patch for us to review it.  Thanks for all the work on this.



---

archive/issue_comments_148209.json:
```json
{
    "body": "**Author:** Stephen Montgomery-Smith",
    "created_at": "2012-06-20T19:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148209",
    "user": "https://github.com/kcrisman"
}
```

**Author:** Stephen Montgomery-Smith



---

archive/issue_comments_148210.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis comment is mostly a reminder to myself to turn this into a patch file.  Nice find, though, and hopefully it will help us with #9170 as well.",
    "created_at": "2013-01-16T01:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148210",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:2'></a>
This comment is mostly a reminder to myself to turn this into a patch file.  Nice find, though, and hopefully it will help us with #9170 as well.



---

archive/issue_comments_148211.json:
```json
{
    "body": "<a id='comment:3'></a>\nI guess it was a patch all along.",
    "created_at": "2013-03-12T14:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148211",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:3'></a>
I guess it was a patch all along.



---

archive/attachments_017285.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12828.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12828/trac_12828.patch",
    "created_at": "2013-03-12T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/kcrisman"
}
```



---

archive/issue_comments_148212.json:
```json
{
    "body": "<a id='comment:4'></a>\n",
    "created_at": "2013-03-12T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148212",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:4'></a>




---

archive/issue_comments_148213.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -41,3 +41,5 @@\n      else:\n          raise NotImplementedError(\"memory usage not implemented on platform %s\" % U)\n ```\n+\n+Apply [attachment:trac_12828.patch].\n``````\n",
    "created_at": "2013-03-12T14:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148213",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -41,3 +41,5 @@
      else:
          raise NotImplementedError("memory usage not implemented on platform %s" % U)
 ```
+
+Apply [attachment:trac_12828.patch].
``````




---

archive/issue_events_109352.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-03-12T14:31:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109352"
}
```



---

archive/issue_comments_148214.json:
```json
{
    "body": "**Reviewer:** Karl-Dieter Crisman",
    "created_at": "2013-03-12T14:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148214",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Karl-Dieter Crisman



---

archive/issue_comments_148215.json:
```json
{
    "body": "<a id='comment:5'></a>\nI don't there is anyone else currently doing much with FreeBSD that is active enough to review this (JP?), so let's say we trust Stephen :)\n\nUnfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.",
    "created_at": "2013-03-12T14:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148215",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:5'></a>
I don't there is anyone else currently doing much with FreeBSD that is active enough to review this (JP?), so let's say we trust Stephen :)

Unfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.



---

archive/issue_events_109353.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-03-12T14:33:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109353"
}
```



---

archive/issue_events_109354.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-03-12T14:33:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109354"
}
```



---

archive/issue_comments_148216.json:
```json
{
    "body": "<a id='comment:6'></a>\n> Unfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.\n\nI don't know why I said that.",
    "created_at": "2013-03-12T14:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148216",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:6'></a>
> Unfortunately, it will need rebase on 5.8.beta4 and #9170, but that should be pretty easy.

I don't know why I said that.



---

archive/issue_events_109355.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-03-12T14:34:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109355"
}
```



---

archive/issue_events_109356.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-03-12T14:34:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109356"
}
```



---

archive/issue_comments_148217.json:
```json
{
    "body": "<a id='comment:7'></a>\nAlso, to release manager... this shouldn't affect any other platform, and we have no such buildbot yet, so it could still make it into 5.8 if you are amenable to this.",
    "created_at": "2013-03-12T14:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148217",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:7'></a>
Also, to release manager... this shouldn't affect any other platform, and we have no such buildbot yet, so it could still make it into 5.8 if you are amenable to this.



---

archive/issue_comments_148218.json:
```json
{
    "body": "<a id='comment:8'></a>\nActually I am in no hurry.  I have hit a road block in sage-5.8.beta4 in that document building is not working correctly.  It is probably something wrong with semaphores.  It may take me a while to figure it out.",
    "created_at": "2013-03-13T01:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148218",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

<a id='comment:8'></a>
Actually I am in no hurry.  I have hit a road block in sage-5.8.beta4 in that document building is not working correctly.  It is probably something wrong with semaphores.  It may take me a while to figure it out.



---

archive/issue_events_109357.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T10:50:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "milestone": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109357"
}
```



---

archive/issue_events_109358.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-13T10:50:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "milestone": "sage-5.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109358"
}
```



---

archive/issue_events_109359.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-14T08:11:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109359"
}
```



---

archive/issue_events_109360.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-14T08:11:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12828#event-109360"
}
```



---

archive/issue_comments_148219.json:
```json
{
    "body": "**Merged:** sage-5.9.beta0",
    "created_at": "2013-03-14T08:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12828",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12828#issuecomment-148219",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.9.beta0
