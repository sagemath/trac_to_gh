# Issue 12135: Multiple loops handling in c_graph

archive/issues_011963.json:
```json
{
    "body": "Sage handles multiple loops on one vertex inconsistently.\n\n```\nsage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation=\"c_graph\")\nsage:g.edges()\n[(0, 0, None), (0, 0, None)]\nsage:g.delete_edge(0,0)\nsage:g.edges()\n[]\n```\n\nCompare with\n\n```\nsage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation=\"networkx\")\nsage:g.edges()\n[(0, 0, None), (0, 0, None)]\nsage:g.delete_edge(0,0)\nsage:g.edges()\n[(0, 0, None)]\n```\n\nand\n\n```\nsage:g=Graph({0:[1,1]}, loops=True, multiedges=True, implementation=\"c_graph\")\nsage:g.edges()\n[(0, 1, None), (0, 1, None)]\nsage:g.delete_edge(0,1)\nsage:g.edges()\n[(0, 1, None)]\n```\n\nApply:\n\n* [attachment:trac_12135_loop_removal.patch]\n* [attachment:trac_12135_review.patch]\n\nAssignee: jason, ncohen, rlm\n\nKeywords: Cernay2012\n\nResolution: fixed\n\nAuthor: Luk\u00e1\u0161 L\u00e1nsk\u00fd\n\nReviewer: Nathann Cohen\n\nMerged: sage-5.0.beta4\n\nIssue created by migration from https://trac.sagemath.org/ticket/12135\n\n",
    "closed_at": "2012-02-14T14:21:10Z",
    "created_at": "2011-12-09T19:46:27Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Multiple loops handling in c_graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12135",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```
Sage handles multiple loops on one vertex inconsistently.

```
sage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation="c_graph")
sage:g.edges()
[(0, 0, None), (0, 0, None)]
sage:g.delete_edge(0,0)
sage:g.edges()
[]
```

Compare with

```
sage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation="networkx")
sage:g.edges()
[(0, 0, None), (0, 0, None)]
sage:g.delete_edge(0,0)
sage:g.edges()
[(0, 0, None)]
```

and

```
sage:g=Graph({0:[1,1]}, loops=True, multiedges=True, implementation="c_graph")
sage:g.edges()
[(0, 1, None), (0, 1, None)]
sage:g.delete_edge(0,1)
sage:g.edges()
[(0, 1, None)]
```

Apply:

* [attachment:trac_12135_loop_removal.patch]
* [attachment:trac_12135_review.patch]

Assignee: jason, ncohen, rlm

Keywords: Cernay2012

Resolution: fixed

Author: Lukáš Lánský

Reviewer: Nathann Cohen

Merged: sage-5.0.beta4

Issue created by migration from https://trac.sagemath.org/ticket/12135





---

archive/issue_comments_174670.json:
```json
{
    "body": "<a id='comment:1'></a>\nA loop is stored as a single arc, but del_edge removes both ends:\n\n```\nself._cg.del_arc_label(u_int, v_int, l_int)\nself._cg.del_arc_label(v_int, u_int, l_int)\n```\n\nSo...\n\n```\nsage: g=Graph({0:[0]*11}); len(g.edges())\n11\nsage: g.delete_edge(0,0); len(g.edges())\n9\nsage: g.delete_edge(0,0); len(g.edges())\n7\nsage: g.delete_edge(0,0); len(g.edges())\n5\n```",
    "created_at": "2012-02-06T12:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174670",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:1'></a>
A loop is stored as a single arc, but del_edge removes both ends:

```
self._cg.del_arc_label(u_int, v_int, l_int)
self._cg.del_arc_label(v_int, u_int, l_int)
```

So...

```
sage: g=Graph({0:[0]*11}); len(g.edges())
11
sage: g.delete_edge(0,0); len(g.edges())
9
sage: g.delete_edge(0,0); len(g.edges())
7
sage: g.delete_edge(0,0); len(g.edges())
5
```



---

archive/issue_comments_174671.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n Sage handles multiple loops on one vertex inconsistently.\n \n ```\n-sage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\n+sage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation=\"c_graph\")\n sage:g.edges()\n [(0, 0, None), (0, 0, None)]\n sage:g.delete_edge(0,0)\n@@ -12,7 +12,7 @@\n Compare with\n \n ```\n-sage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation=\"networkx\")\n+sage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation=\"networkx\")\n sage:g.edges()\n [(0, 0, None), (0, 0, None)]\n sage:g.delete_edge(0,0)\n@@ -23,7 +23,7 @@\n and\n \n ```\n-sage:g=Graph({0:[1,1]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\n+sage:g=Graph({0:[1,1]}, loops=True, multiedges=True, implementation=\"c_graph\")\n sage:g.edges()\n [(0, 1, None), (0, 1, None)]\n sage:g.delete_edge(0,1)\n@@ -34,11 +34,11 @@\n Another c_graph backend functions work in this spirit: for example add_edges won't add any new loops to the vertex where some already exist. Well, that is not precise. Look:\n \n ```\n-sage:g=Graph({0: [0]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\n+sage:g=Graph({0: [0]}, loops=True, multiedges=True, implementation=\"c_graph\")\n sage:g.add_edges([(0,0), (0,0)])\n sage:g.edges()\n [(0, 0, None)]\n-sage:h=Graph({0: [0,0]}, loops=True, multiple_edges=True, implementation=\"c_graph\")\n+sage:h=Graph({0: [0,0]}, loops=True, multiedges=True, implementation=\"c_graph\")\n sage:h.add_edges([(0,0), (0,0)])\n sage:h.edges()\n [(0, 0, None), (0, 0, None), (0, 0, None), (0, 0, None)]\n@@ -46,4 +46,4 @@\n \n I guess that multiple loops can be handy to have, for example when you want to preserve edges in repeated contractions. It is also consistent with the meaning of the two options \"allow loops\" and \"allow multiple edges\" -- it would be weird if \"allow multiple edges\" stopped work in the previously allowed case of (v,v) edge.\n \n-But I'm not very experiences mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)\n+But I'm not very experienced mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)\n``````\n",
    "created_at": "2012-02-06T12:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174671",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 Sage handles multiple loops on one vertex inconsistently.
 
 ```
-sage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation="c_graph")
+sage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation="c_graph")
 sage:g.edges()
 [(0, 0, None), (0, 0, None)]
 sage:g.delete_edge(0,0)
@@ -12,7 +12,7 @@
 Compare with
 
 ```
-sage:g=Graph({0:[0,0]}, loops=True, multiple_edges=True, implementation="networkx")
+sage:g=Graph({0:[0,0]}, loops=True, multiedges=True, implementation="networkx")
 sage:g.edges()
 [(0, 0, None), (0, 0, None)]
 sage:g.delete_edge(0,0)
@@ -23,7 +23,7 @@
 and
 
 ```
-sage:g=Graph({0:[1,1]}, loops=True, multiple_edges=True, implementation="c_graph")
+sage:g=Graph({0:[1,1]}, loops=True, multiedges=True, implementation="c_graph")
 sage:g.edges()
 [(0, 1, None), (0, 1, None)]
 sage:g.delete_edge(0,1)
@@ -34,11 +34,11 @@
 Another c_graph backend functions work in this spirit: for example add_edges won't add any new loops to the vertex where some already exist. Well, that is not precise. Look:
 
 ```
-sage:g=Graph({0: [0]}, loops=True, multiple_edges=True, implementation="c_graph")
+sage:g=Graph({0: [0]}, loops=True, multiedges=True, implementation="c_graph")
 sage:g.add_edges([(0,0), (0,0)])
 sage:g.edges()
 [(0, 0, None)]
-sage:h=Graph({0: [0,0]}, loops=True, multiple_edges=True, implementation="c_graph")
+sage:h=Graph({0: [0,0]}, loops=True, multiedges=True, implementation="c_graph")
 sage:h.add_edges([(0,0), (0,0)])
 sage:h.edges()
 [(0, 0, None), (0, 0, None), (0, 0, None), (0, 0, None)]
@@ -46,4 +46,4 @@
 
 I guess that multiple loops can be handy to have, for example when you want to preserve edges in repeated contractions. It is also consistent with the meaning of the two options "allow loops" and "allow multiple edges" -- it would be weird if "allow multiple edges" stopped work in the previously allowed case of (v,v) edge.
 
-But I'm not very experiences mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)
+But I'm not very experienced mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)
``````




---

archive/issue_comments_174672.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,20 +30,3 @@\n sage:g.edges()\n [(0, 1, None)]\n ```\n-\n-Another c_graph backend functions work in this spirit: for example add_edges won't add any new loops to the vertex where some already exist. Well, that is not precise. Look:\n-\n-```\n-sage:g=Graph({0: [0]}, loops=True, multiedges=True, implementation=\"c_graph\")\n-sage:g.add_edges([(0,0), (0,0)])\n-sage:g.edges()\n-[(0, 0, None)]\n-sage:h=Graph({0: [0,0]}, loops=True, multiedges=True, implementation=\"c_graph\")\n-sage:h.add_edges([(0,0), (0,0)])\n-sage:h.edges()\n-[(0, 0, None), (0, 0, None), (0, 0, None), (0, 0, None)]\n-```\n-\n-I guess that multiple loops can be handy to have, for example when you want to preserve edges in repeated contractions. It is also consistent with the meaning of the two options \"allow loops\" and \"allow multiple edges\" -- it would be weird if \"allow multiple edges\" stopped work in the previously allowed case of (v,v) edge.\n-\n-But I'm not very experienced mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)\n``````\n",
    "created_at": "2012-02-06T12:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174672",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,20 +30,3 @@
 sage:g.edges()
 [(0, 1, None)]
 ```
-
-Another c_graph backend functions work in this spirit: for example add_edges won't add any new loops to the vertex where some already exist. Well, that is not precise. Look:
-
-```
-sage:g=Graph({0: [0]}, loops=True, multiedges=True, implementation="c_graph")
-sage:g.add_edges([(0,0), (0,0)])
-sage:g.edges()
-[(0, 0, None)]
-sage:h=Graph({0: [0,0]}, loops=True, multiedges=True, implementation="c_graph")
-sage:h.add_edges([(0,0), (0,0)])
-sage:h.edges()
-[(0, 0, None), (0, 0, None), (0, 0, None), (0, 0, None)]
-```
-
-I guess that multiple loops can be handy to have, for example when you want to preserve edges in repeated contractions. It is also consistent with the meaning of the two options "allow loops" and "allow multiple edges" -- it would be weird if "allow multiple edges" stopped work in the previously allowed case of (v,v) edge.
-
-But I'm not very experienced mathematician, so I can't decide what behavior is right. I just see that the current state is... bizzare... :-)
``````




---

archive/issue_comments_174673.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK, this was rather easy.",
    "created_at": "2012-02-06T12:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174673",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:2'></a>
OK, this was rather easy.



---

archive/issue_comments_174674.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-06T12:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174674",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_174675.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_12135_loop_removal.patch](tarball://root/attachments/some-uuid/ticket12135/trac_12135_loop_removal.patch) by @nathanncohen created at 2012-02-06 14:50:37\n\nHelloooooooo !!!\n\nHere is a one-line patch to add the \"::\" at the end of the line before the tests. If if it ok with you, the patch can be set to \"positive_review\". `:-)`\n\nNathann\n\n(and I changed the subject because I am at Cernay with the combinat team, and that is how they want to remember which patches we worked on... Sorry about that `^^;`)",
    "created_at": "2012-02-06T14:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174675",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:3'></a>
Attachment [trac_12135_loop_removal.patch](tarball://root/attachments/some-uuid/ticket12135/trac_12135_loop_removal.patch) by @nathanncohen created at 2012-02-06 14:50:37

Helloooooooo !!!

Here is a one-line patch to add the "::" at the end of the line before the tests. If if it ok with you, the patch can be set to "positive_review". `:-)`

Nathann

(and I changed the subject because I am at Cernay with the combinat team, and that is how they want to remember which patches we worked on... Sorry about that `^^;`)



---

archive/issue_events_037994.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "rename": {
        "from": "Multiple loops handling in c_graph",
        "to": "Multiple loops handling in c_graph -- Cernay2012"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12135#event-37994"
}
```



---

archive/issue_comments_174676.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [trac_12135_review.patch](tarball://root/attachments/some-uuid/ticket12135/trac_12135_review.patch) by brunellus created at 2012-02-06 15:12:02\n\nSorry, I keep forgetting about that. :-/ Thanks for the review. :-)",
    "created_at": "2012-02-06T15:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174676",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

<a id='comment:5'></a>
Attachment [trac_12135_review.patch](tarball://root/attachments/some-uuid/ticket12135/trac_12135_review.patch) by brunellus created at 2012-02-06 15:12:02

Sorry, I keep forgetting about that. :-/ Thanks for the review. :-)



---

archive/issue_comments_174677.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-06T15:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174677",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_174678.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Nathann Cohen\"",
    "created_at": "2012-02-06T15:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174678",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Changing reviewer from "" to "Nathann Cohen"



---

archive/issue_comments_174679.json:
```json
{
    "body": "Changing author from \"\" to \"Luk\u00e1\u0161 L\u00e1nsk\u00fd\"",
    "created_at": "2012-02-06T15:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174679",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Changing author from "" to "Lukáš Lánský"



---

archive/issue_comments_174680.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,3 +30,8 @@\n sage:g.edges()\n [(0, 1, None)]\n ```\n+\n+Apply:\n+\n+* [attachment:trac_12135_loop_removal.patch]\n+* [attachment:trac_12135_review.patch]\n``````\n",
    "created_at": "2012-02-06T15:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174680",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,3 +30,8 @@
 sage:g.edges()
 [(0, 1, None)]
 ```
+
+Apply:
+
+* [attachment:trac_12135_loop_removal.patch]
+* [attachment:trac_12135_review.patch]
``````




---

archive/issue_events_037995.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "rename": {
        "from": "Multiple loops handling in c_graph -- Cernay2012",
        "to": "Multiple loops handling in c_graph"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12135#event-37995"
}
```



---

archive/issue_comments_174681.json:
```json
{
    "body": "<a id='comment:7'></a>\nLooks like it shouldn't be in the topic but in the keywords... `^^;`\n\nThank you for the patches and the names `:-)`\n\nNathann",
    "created_at": "2012-02-06T15:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174681",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:7'></a>
Looks like it shouldn't be in the topic but in the keywords... `^^;`

Thank you for the patches and the names `:-)`

Nathann



---

archive/issue_comments_174682.json:
```json
{
    "body": "Changing keywords from \"\" to \"Cernay2012\".",
    "created_at": "2012-02-06T15:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174682",
    "user": "https://github.com/nathanncohen"
}
```

Changing keywords from "" to "Cernay2012".



---

archive/issue_comments_174683.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-14T14:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174683",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_174684.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.0.beta4\"",
    "created_at": "2012-02-14T14:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12135#issuecomment-174684",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.0.beta4"



---

archive/issue_events_037996.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-14T14:21:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12135",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12135#event-37996"
}
```
