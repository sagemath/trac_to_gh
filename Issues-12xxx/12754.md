# Issue 12754: Fix scoping / name look-up issue in PolyBoRi 0.8.1 and support flags from the environment

archive/issues_012582.json:
```json
{
    "body": "The following was found out here:\nhttp://groups.google.com/group/sage-release/browse_thread/thread/e2a87c73dc1625f2\n\n```\n* PolyBoRi fails to build due to stricter (C++11) scoping / name look-up rules.\n    Unfortunately PolyBoRi doesn't honor CXXFLAGS, so I had to use CXX=\"g++-4.7.0 -fpermissive\" to make the spkg build. \n```\n\nThe scoping issue should be fixed here:\nhttps://bitbucket.org/brickenstein/polybori/changeset/43b3931ceed7/raw/\n\nAlso, we should support CXXFLAGS and CFLAGS (ANd CPPFLAGS?) in the spkg.\n\nWe just have to merge the latest changes from polybori-0.8.0.p2 in #12750 :\n\nThis fixes building with GCC-4.7.0, see #12751 for the GCC-4.7.0 metaticket as well as building on Solaris and OpenSolaris, see #12655.\n\n### Current spkg\n* **Install** http://boxen.math.washington.edu/home/dreyer/spkg/polybori-0.8.1.p1.spkg\n\nDepends on #12750\n\n**Assignee:** @alexanderdreyer\n\n**CC:**  @nexttime PolyBoRi @malb @burcin\n\n**Upstream:** Reported upstream. Little or no feedback.\n\n**Reviewer:** Alexander Dreyer, Leif Leonhardy, Martin Albrecht, Burcin Erocal\n\nIssue created by migration from https://trac.sagemath.org/ticket/12754\n\n",
    "closed_at": "2012-04-02T21:06:40Z",
    "created_at": "2012-03-26T22:26:55Z",
    "labels": [
        "component: algebra",
        "bug",
        "duplicate"
    ],
    "title": "Fix scoping / name look-up issue in PolyBoRi 0.8.1 and support flags from the environment",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12754",
    "user": "https://github.com/alexanderdreyer"
}
```
The following was found out here:
http://groups.google.com/group/sage-release/browse_thread/thread/e2a87c73dc1625f2

```
* PolyBoRi fails to build due to stricter (C++11) scoping / name look-up rules.
    Unfortunately PolyBoRi doesn't honor CXXFLAGS, so I had to use CXX="g++-4.7.0 -fpermissive" to make the spkg build. 
```

The scoping issue should be fixed here:
https://bitbucket.org/brickenstein/polybori/changeset/43b3931ceed7/raw/

Also, we should support CXXFLAGS and CFLAGS (ANd CPPFLAGS?) in the spkg.

We just have to merge the latest changes from polybori-0.8.0.p2 in #12750 :

This fixes building with GCC-4.7.0, see #12751 for the GCC-4.7.0 metaticket as well as building on Solaris and OpenSolaris, see #12655.

### Current spkg
* **Install** http://boxen.math.washington.edu/home/dreyer/spkg/polybori-0.8.1.p1.spkg

Depends on #12750

**Assignee:** @alexanderdreyer

**CC:**  @nexttime PolyBoRi @malb @burcin

**Upstream:** Reported upstream. Little or no feedback.

**Reviewer:** Alexander Dreyer, Leif Leonhardy, Martin Albrecht, Burcin Erocal

Issue created by migration from https://trac.sagemath.org/ticket/12754





---

archive/issue_comments_145217.json:
```json
{
    "body": "**Changing assignee** from @aghitza to @alexanderdreyer.",
    "created_at": "2012-03-26T22:27:45Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145217",
    "user": "https://github.com/alexanderdreyer"
}
```

**Changing assignee** from @aghitza to @alexanderdreyer.



---

archive/issue_comments_145218.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,5 +13,7 @@\n \n We just have to merge the latest changes from polybori-0.8.0.p2 in #12750 :\n \n+This fixes building with GCC-4.7.0, see #12751 for the GCC-4.7.0 metaticket as well as building on Solaris and OpenSolaris, see #12655.\n+\n ### Current spkg\n * **Install** http://boxen.math.washington.edu/home/dreyer/spkg/polybori-0.8.1.p1.spkg\n``````\n",
    "created_at": "2012-03-29T07:58:27Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145218",
    "user": "https://github.com/alexanderdreyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,5 +13,7 @@
 
 We just have to merge the latest changes from polybori-0.8.0.p2 in #12750 :
 
+This fixes building with GCC-4.7.0, see #12751 for the GCC-4.7.0 metaticket as well as building on Solaris and OpenSolaris, see #12655.
+
 ### Current spkg
 * **Install** http://boxen.math.washington.edu/home/dreyer/spkg/polybori-0.8.1.p1.spkg
``````




---

archive/issue_events_106102.json:
```json
{
    "actor": "https://github.com/alexanderdreyer",
    "created_at": "2012-03-29T07:58:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106102"
}
```



---

archive/issue_comments_145219.json:
```json
{
    "body": "**Description changed:**\n``````diff\n\n``````\n",
    "created_at": "2012-03-29T07:59:14Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145219",
    "user": "https://github.com/alexanderdreyer"
}
```

**Description changed:**
``````diff

``````




---

archive/issue_comments_145220.json:
```json
{
    "body": "**Changing author** from \"AlexanderDreyer\" to \"Alexander Dreyer\".",
    "created_at": "2012-03-29T14:54:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145220",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "AlexanderDreyer" to "Alexander Dreyer".



---

archive/issue_comments_145221.json:
```json
{
    "body": "**Changing reviewer** from \"leif, PolyBoRi, malb, burcin\" to \"Leif Leonhardy, Martin Albrecht, Burcin Erocal\".",
    "created_at": "2012-03-29T14:54:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145221",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "leif, PolyBoRi, malb, burcin" to "Leif Leonhardy, Martin Albrecht, Burcin Erocal".



---

archive/issue_comments_145222.json:
```json
{
    "body": "**Dependencies:** #12750",
    "created_at": "2012-03-29T14:54:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145222",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #12750



---

archive/issue_comments_145223.json:
```json
{
    "body": "<a id='comment:6'></a>\nSo we now have the *same* spkgs at #12655 and here?\n\nI've added #12655 as a dependency, as *someone*<sup>TM</sup> should (independently) review the upgrade there, such that we here just have to review that the changes coming from #12750 are properly merged.\n\n(Alternatively, we could just make #12655 depend on #12750, which already has positive review, and probably close *this* ticket as a duplicate of #12750.)\n\n\n\n\n[Argh, concurrent editing, with a slow connection on my side btw. -- you now already changed the reviewers and added #12750 as a dependency...]",
    "created_at": "2012-03-29T15:01:04Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145223",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>
So we now have the *same* spkgs at #12655 and here?

I've added #12655 as a dependency, as *someone*<sup>TM</sup> should (independently) review the upgrade there, such that we here just have to review that the changes coming from #12750 are properly merged.

(Alternatively, we could just make #12655 depend on #12750, which already has positive review, and probably close *this* ticket as a duplicate of #12750.)




[Argh, concurrent editing, with a slow connection on my side btw. -- you now already changed the reviewers and added #12750 as a dependency...]



---

archive/issue_comments_145224.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [leif](#comment%3A6):\n> (Alternatively, we could just make #12655 depend on #12750, which already has positive review, and probably close *this* ticket as a duplicate of #12750.)\n\nI'd prefer this solution. What can do it? (Obviously I can't.)",
    "created_at": "2012-03-29T19:08:54Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145224",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:7'></a>
Replying to [leif](#comment%3A6):
> (Alternatively, we could just make #12655 depend on #12750, which already has positive review, and probably close *this* ticket as a duplicate of #12750.)

I'd prefer this solution. What can do it? (Obviously I can't.)



---

archive/issue_comments_145225.json:
```json
{
    "body": "<a id='comment:8'></a>\nFor convenience I put the diffs of patchsets here (they arise from merging #12750 into #12655):\n\n{{{ #!diff\n--- diff-0.8.1.p0.109-115.patch 2012-03-29 21:29:27.063819557 +0200                      \n+++ diff-0.8.1.p1.111-119.patch      2012-03-29 21:42:55.422372689 +0200              \n@@ -1,7 +1,7 @@                                                                          \n-diff -r f05b48d16bc7 -r 0ff1dee2843e SPKG.txt                                           \n+diff -r 82bcfd079628 -r 666438ae9200 SPKG.txt                                           \n --- a/SPKG.txt Mon Mar 12 16:08:02 2012 +0100                                           \n-+++ b/SPKG.txt Thu Mar 22 17:21:37 2012 +0100                                           \n-@@ -36,6 +36,10 @@                                                                      \n++++ b/SPKG.txt Mon Mar 26 23:47:06 2012 +0200                                           \n+@@ -36,8 +36,15 @@                                                                      \n* png/libpng12 (accomplished because Python and gd depend on it, too)                 \n* libz         (accomplished because e.g. libpng depends on it)                       \n                                                                                         \n@@ -11,18 +11,32 @@                                                                      \n +                                                                                       \n  == Releases ==                                                                         \n                                                                                         \n++=== polybori-0.8.1.p1 (Alexander Dreyer, March 26th, 2012) ===                         \n++ * Rebased spkg on polybori-0.8.0.p2                                                   \n++                                                                                       \n  === polybori-0.8.1.p0 (Alexander Dreyer, March 7th, 2012) ===                          \n-diff -r f05b48d16bc7 -r 0ff1dee2843e custom.py                                          \n+  * Updating sources to PolyBoRi's release 0.8.1                                        \n+                                                                                        \n+diff -r 82bcfd079628 -r 666438ae9200 custom.py                                          \n --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                           \n-+++ b/custom.py        Thu Mar 22 17:21:37 2012 +0100                                   \n-@@ -0,0 +1,64 @@                                                                        \n++++ b/custom.py        Mon Mar 26 23:47:06 2012 +0200                                   \n+@@ -0,0 +1,73 @@                                                                        \n +import os                                                                              \n +import sys                                                                             \n +                                                                                       \n +# FIXME: Do we really want to *overwrite* the flags (e.g. if set by the user)?         \n-+CCFLAGS=[\"-O3 -Wno-long-long -Wreturn-type -g -fPIC\"]                                  \n-+#CXXFLAGS=CCFLAGS+[\"-ftemplate-depth-100 -g -fPIC\"]                                    \n-+CXXFLAGS=CCFLAGS+[\"-ftemplate-depth-100\"]                                              \n++# Answer: Should be fixed now.                                                         \n++CCFLAGS += [\"-Wno-long-long\", \"-Wreturn-type\"]                                         \n++                                                                                       \n++# Note: PolyBoRi still appends DEFAULT_*FLAGS (overwrite those, if necessary)          \n++if 'CFLAGS' in os.environ:                                                             \n++  CFLAGS = os.environ['CFLAGS'].split(' ')                                             \n++                                                                                       \n++if 'CXXFLAGS' in os.environ:                                                           \n++  CXXFLAGS = os.environ['CXXFLAGS'].split(' ')                                         \n++                                                                                       \n++if 'CPPFLAGS' in os.environ:                                                           \n++  CCFLAGS = os.environ['CPPFLAGS'].split(' ')                                          \n +                                                                                       \n +GD_LIBS+=[\"png12\",\"z\"]                                                                 \n +                                                                                       \n@@ -80,7 +94,7 @@                                                                        \n +  CXX = os.environ['CXX']                                                              \n +except:                                                                                \n +  pass                                                                                 \n-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/PyPolyBoRi.patch                           \n+diff -r 82bcfd079628 -r 666438ae9200 patches/PyPolyBoRi.patch                           \n --- a/patches/PyPolyBoRi.patch Mon Mar 12 16:08:02 2012 +0100                           \n +++ /dev/null  Thu Jan 01 00:00:00 1970 +0000                                           \n @@ -1,253 +0,0 @@                                                                       \n@@ -337,7 +351,7 @@                                                                      \n -+Polynomial = PolynomialFactory()                                                      \n -+Variable = VariableFactory()                                                          \n-                                                                                       \n-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/PyPolyBoRi.py                              \n+diff -r 82bcfd079628 -r 666438ae9200 patches/PyPolyBoRi.py                              \n --- a/patches/PyPolyBoRi.py    Mon Mar 12 16:08:02 2012 +0100                           \n +++ /dev/null  Thu Jan 01 00:00:00 1970 +0000                                           \n @@ -1,47 +0,0 @@                                                                        \n@@ -388,17 +402,40 @@                                                                    \n -Polynomial = PolynomialFactory()                                                       \n -Variable = VariableFactory()                                                           \n-                                                                                       \n-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/custom.py                                  \n+diff -r 82bcfd079628 -r 666438ae9200 patches/base_lookup.patch                          \n+--- a/patches/base_lookup.patch        Mon Mar 12 16:08:02 2012 +0100                   \n++++ b/patches/base_lookup.patch        Mon Mar 26 23:47:06 2012 +0200                   \n+@@ -8,7 +8,7 @@                                                                         \n+ diff -r 617ce1a715329d16e5ebde0bfdde9c4d09072451 -r 43b3931ceed7b57c4c5385442de6ff45bd0f477c libpolybori/include/polybori/iterators/CTermStack.h                                                                                                              \n+ --- a/libpolybori/include/polybori/iterators/CTermStack.h     Mon Mar 19 22:53:46 2012 +0100                                  \n+ +++ b/libpolybori/include/polybori/iterators/CTermStack.h     Wed Mar 21 22:18:37 2012 +0100                                  \n+-@@ -853,7 +853,7 @@                                                                                                           \n++@@ -854,7 +854,7 @@                                                                                                           \n+      PBORI_ASSERT(m_zero.isValid());                                                                                          \n+      PBORI_ASSERT(m_zero.isEmpty());                                                                                          \n+                                                                                                                               \n+diff -r 82bcfd079628 -r 666438ae9200 patches/custom.py                                                                         \n --- a/patches/custom.py        Mon Mar 12 16:08:02 2012 +0100                                                                  \n +++ /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  \n-@@ -1,64 +0,0 @@                                                                                                               \n+@@ -1,75 +0,0 @@                                                                                                               \n -import os                                                                                                                     \n -import sys                                                                                                                    \n-                                                                                                                              \n -# FIXME: Do we really want to *overwrite* the flags (e.g. if set by the user)?                                                \n+-# Note: there will be better ways in PolyBoRi 0.8.1                                                                           \n -CCFLAGS=[\"-O3 -Wno-long-long -Wreturn-type -g -fPIC\"]                                                                         \n -#CXXFLAGS=CCFLAGS+[\"-ftemplate-depth-100 -g -fPIC\"]                                                                           \n -CXXFLAGS=CCFLAGS+[\"-ftemplate-depth-100\"]                                                                                     \n+-CFLAGS=[\"-std=c99\"]                                                                                                           \n+-                                                                                                                              \n+-if 'CFLAGS' in os.environ:                                                                                                    \n+-  CFLAGS += os.environ['CFLAGS'].split(' ')                                                                                   \n+-                                                                                                                              \n+-if 'CXXFLAGS' in os.environ:                                                                                                  \n+-  CXXFLAGS += os.environ['CXXFLAGS'].split(' ')                                                                               \n+-                                                                                                                              \n+-if 'CPPFLAGS' in os.environ:                                                                                                  \n+-  CCFLAGS += os.environ['CPPFLAGS'].split(' ')                                                                                \n-                                                                                                                              \n -GD_LIBS+=[\"png12\",\"z\"]                                                                                                        \n-                                                                                                                              \n@@ -456,9 +493,9 @@                                                                                                             \n-  CXX = os.environ['CXX']                                                                                                     \n -except:                                                                                                                       \n-  pass                                                                                                                        \n-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/gbcore.py.patch                                                                   \n+diff -r 82bcfd079628 -r 666438ae9200 patches/gbcore.py.patch                                                                   \n --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  \n-+++ b/patches/gbcore.py.patch  Thu Mar 22 17:21:37 2012 +0100                                                                  \n++++ b/patches/gbcore.py.patch  Mon Mar 26 23:47:06 2012 +0200                                                                  \n @@ -0,0 +1,33 @@                                                                                                               \n +# HG changeset patch                                                                                                          \n +# User Alexander Dreyer <adreyer@gmx.de>                                                                                      \n@@ -493,9 +530,9 @@                                                                                                             \n +     ocode=old_ring.get_order_code()                                                                                          \n +     try:                                                                                                                     \n +         new_ring = old_ring.clone(ordering=options[\"switch_to\"])                                                             \n-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/ipbori.patch                                                                      \n+diff -r 82bcfd079628 -r 666438ae9200 patches/ipbori.patch                                                                      \n --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  \n-+++ b/patches/ipbori.patch     Thu Mar 22 17:21:37 2012 +0100                                                                  \n++++ b/patches/ipbori.patch     Mon Mar 26 23:47:06 2012 +0200                                                                  \n @@ -0,0 +1,24 @@                                                                                                               \n +# HG changeset patch                                                                                                          \n +# User Alexander Dreyer <adreyer@gmx.de>                                                                                      \n@@ -521,9 +558,9 @@                                                                                                             \n +     except:                                                                                                                  \n +         return False                                                                                                         \n +                                                                                                                              \n-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/nf.h.patch                                                                        \n+diff -r 82bcfd079628 -r 666438ae9200 patches/nf.h.patch                                                                        \n --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  \n-+++ b/patches/nf.h.patch       Thu Mar 22 17:21:37 2012 +0100                                                                  \n++++ b/patches/nf.h.patch       Mon Mar 26 23:47:06 2012 +0200                                                                  \n @@ -0,0 +1,19 @@                                                                                                               \n +# HG changeset patch                                                                                                          \n +# User Alexander Dreyer <adreyer@gmx.de>                                                                                      \n@@ -544,14 +581,14 @@                                                                                                           \n + extern \"C\"{                                                                                                                  \n + #include <m4ri/m4ri.h>                                                                                                       \n +                                                                                                                              \n-diff -r f05b48d16bc7 -r 0ff1dee2843e spkg-install                                                                              \n+diff -r 82bcfd079628 -r 666438ae9200 spkg-install                                                                              \n --- a/spkg-install     Mon Mar 12 16:08:02 2012 +0100                                                                          \n-+++ b/spkg-install     Thu Mar 22 17:21:37 2012 +0100                                                                          \n-@@ -10,17 +10,30 @@                                                                                                            \n++++ b/spkg-install     Mon Mar 26 23:47:06 2012 +0200                                                                          \n+@@ -10,21 +10,30 @@                                                                                                            \n  WORKDIR=${PWD}/src                                                                                                            \n  SCONS=scons                                                                                                                   \n                                                                                                                                \n--patch()                                                                                                                       \n+-prepare()                                                                                                                     \n +prepare_polybori()                                                                                                            \n  {                                                                                                                             \n      if [ $UNAME = \"CYGWIN\" ]; then                                                                                            \n@@ -561,7 +598,9 @@                                                                                                             \n-    cp patches/custom.py             src/${PBDIR}                                                                             \n-    cp patches/PyPolyBoRi.py         src/${PBDIR}/pyroot/polybori                                                             \n +    cd ${PBDIR}                                                                                                               \n-+                                                                                                                              \n+                                                                                                                               \n+-    cd ${WORKDIR}/${PBDIR}                                                                                                    \n+-    patch -p1 < ../../patches/base_lookup.patch                                                                               \n +    # place configuration file                                                                                                \n +    cp ../../custom.py .                                                                                                      \n +                                                                                                                              \n@@ -575,22 +614,21 @@                                                                                                           \n +        fi                                                                                                                    \n +    done\n +\n-+    cd ${WORKDIR}\n+     cd ${WORKDIR}\n  }\n\n -\n  build_polybori()\n  {\n      cd ${PBDIR}\n-@@ -57,9 +70,9 @@\n+@@ -61,8 +70,9 @@\n      rm -rf ${SAGE_LOCAL}/include/cudd\n  }\n\n--patch\n+-prepare\n +cd ${WORKDIR}\n\n--cd src\n +prepare_polybori\n-\n  echo \"Starting build...\"\n\n+ echo \"Removing old PolyBoRi install...\"\n}}}",
    "created_at": "2012-03-29T19:53:19Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145225",
    "user": "https://github.com/alexanderdreyer"
}
```

<a id='comment:8'></a>
For convenience I put the diffs of patchsets here (they arise from merging #12750 into #12655):

{{{ #!diff
--- diff-0.8.1.p0.109-115.patch 2012-03-29 21:29:27.063819557 +0200                      
+++ diff-0.8.1.p1.111-119.patch      2012-03-29 21:42:55.422372689 +0200              
@@ -1,7 +1,7 @@                                                                          
-diff -r f05b48d16bc7 -r 0ff1dee2843e SPKG.txt                                           
+diff -r 82bcfd079628 -r 666438ae9200 SPKG.txt                                           
 --- a/SPKG.txt Mon Mar 12 16:08:02 2012 +0100                                           
-+++ b/SPKG.txt Thu Mar 22 17:21:37 2012 +0100                                           
-@@ -36,6 +36,10 @@                                                                      
++++ b/SPKG.txt Mon Mar 26 23:47:06 2012 +0200                                           
+@@ -36,8 +36,15 @@                                                                      
* png/libpng12 (accomplished because Python and gd depend on it, too)                 
* libz         (accomplished because e.g. libpng depends on it)                       
                                                                                         
@@ -11,18 +11,32 @@                                                                      
 +                                                                                       
  == Releases ==                                                                         
                                                                                         
++=== polybori-0.8.1.p1 (Alexander Dreyer, March 26th, 2012) ===                         
++ * Rebased spkg on polybori-0.8.0.p2                                                   
++                                                                                       
  === polybori-0.8.1.p0 (Alexander Dreyer, March 7th, 2012) ===                          
-diff -r f05b48d16bc7 -r 0ff1dee2843e custom.py                                          
+  * Updating sources to PolyBoRi's release 0.8.1                                        
+                                                                                        
+diff -r 82bcfd079628 -r 666438ae9200 custom.py                                          
 --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                           
-+++ b/custom.py        Thu Mar 22 17:21:37 2012 +0100                                   
-@@ -0,0 +1,64 @@                                                                        
++++ b/custom.py        Mon Mar 26 23:47:06 2012 +0200                                   
+@@ -0,0 +1,73 @@                                                                        
 +import os                                                                              
 +import sys                                                                             
 +                                                                                       
 +# FIXME: Do we really want to *overwrite* the flags (e.g. if set by the user)?         
-+CCFLAGS=["-O3 -Wno-long-long -Wreturn-type -g -fPIC"]                                  
-+#CXXFLAGS=CCFLAGS+["-ftemplate-depth-100 -g -fPIC"]                                    
-+CXXFLAGS=CCFLAGS+["-ftemplate-depth-100"]                                              
++# Answer: Should be fixed now.                                                         
++CCFLAGS += ["-Wno-long-long", "-Wreturn-type"]                                         
++                                                                                       
++# Note: PolyBoRi still appends DEFAULT_*FLAGS (overwrite those, if necessary)          
++if 'CFLAGS' in os.environ:                                                             
++  CFLAGS = os.environ['CFLAGS'].split(' ')                                             
++                                                                                       
++if 'CXXFLAGS' in os.environ:                                                           
++  CXXFLAGS = os.environ['CXXFLAGS'].split(' ')                                         
++                                                                                       
++if 'CPPFLAGS' in os.environ:                                                           
++  CCFLAGS = os.environ['CPPFLAGS'].split(' ')                                          
 +                                                                                       
 +GD_LIBS+=["png12","z"]                                                                 
 +                                                                                       
@@ -80,7 +94,7 @@                                                                        
 +  CXX = os.environ['CXX']                                                              
 +except:                                                                                
 +  pass                                                                                 
-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/PyPolyBoRi.patch                           
+diff -r 82bcfd079628 -r 666438ae9200 patches/PyPolyBoRi.patch                           
 --- a/patches/PyPolyBoRi.patch Mon Mar 12 16:08:02 2012 +0100                           
 +++ /dev/null  Thu Jan 01 00:00:00 1970 +0000                                           
 @@ -1,253 +0,0 @@                                                                       
@@ -337,7 +351,7 @@                                                                      
 -+Polynomial = PolynomialFactory()                                                      
 -+Variable = VariableFactory()                                                          
-                                                                                       
-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/PyPolyBoRi.py                              
+diff -r 82bcfd079628 -r 666438ae9200 patches/PyPolyBoRi.py                              
 --- a/patches/PyPolyBoRi.py    Mon Mar 12 16:08:02 2012 +0100                           
 +++ /dev/null  Thu Jan 01 00:00:00 1970 +0000                                           
 @@ -1,47 +0,0 @@                                                                        
@@ -388,17 +402,40 @@                                                                    
 -Polynomial = PolynomialFactory()                                                       
 -Variable = VariableFactory()                                                           
-                                                                                       
-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/custom.py                                  
+diff -r 82bcfd079628 -r 666438ae9200 patches/base_lookup.patch                          
+--- a/patches/base_lookup.patch        Mon Mar 12 16:08:02 2012 +0100                   
++++ b/patches/base_lookup.patch        Mon Mar 26 23:47:06 2012 +0200                   
+@@ -8,7 +8,7 @@                                                                         
+ diff -r 617ce1a715329d16e5ebde0bfdde9c4d09072451 -r 43b3931ceed7b57c4c5385442de6ff45bd0f477c libpolybori/include/polybori/iterators/CTermStack.h                                                                                                              
+ --- a/libpolybori/include/polybori/iterators/CTermStack.h     Mon Mar 19 22:53:46 2012 +0100                                  
+ +++ b/libpolybori/include/polybori/iterators/CTermStack.h     Wed Mar 21 22:18:37 2012 +0100                                  
+-@@ -853,7 +853,7 @@                                                                                                           
++@@ -854,7 +854,7 @@                                                                                                           
+      PBORI_ASSERT(m_zero.isValid());                                                                                          
+      PBORI_ASSERT(m_zero.isEmpty());                                                                                          
+                                                                                                                               
+diff -r 82bcfd079628 -r 666438ae9200 patches/custom.py                                                                         
 --- a/patches/custom.py        Mon Mar 12 16:08:02 2012 +0100                                                                  
 +++ /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  
-@@ -1,64 +0,0 @@                                                                                                               
+@@ -1,75 +0,0 @@                                                                                                               
 -import os                                                                                                                     
 -import sys                                                                                                                    
-                                                                                                                              
 -# FIXME: Do we really want to *overwrite* the flags (e.g. if set by the user)?                                                
+-# Note: there will be better ways in PolyBoRi 0.8.1                                                                           
 -CCFLAGS=["-O3 -Wno-long-long -Wreturn-type -g -fPIC"]                                                                         
 -#CXXFLAGS=CCFLAGS+["-ftemplate-depth-100 -g -fPIC"]                                                                           
 -CXXFLAGS=CCFLAGS+["-ftemplate-depth-100"]                                                                                     
+-CFLAGS=["-std=c99"]                                                                                                           
+-                                                                                                                              
+-if 'CFLAGS' in os.environ:                                                                                                    
+-  CFLAGS += os.environ['CFLAGS'].split(' ')                                                                                   
+-                                                                                                                              
+-if 'CXXFLAGS' in os.environ:                                                                                                  
+-  CXXFLAGS += os.environ['CXXFLAGS'].split(' ')                                                                               
+-                                                                                                                              
+-if 'CPPFLAGS' in os.environ:                                                                                                  
+-  CCFLAGS += os.environ['CPPFLAGS'].split(' ')                                                                                
-                                                                                                                              
 -GD_LIBS+=["png12","z"]                                                                                                        
-                                                                                                                              
@@ -456,9 +493,9 @@                                                                                                             
-  CXX = os.environ['CXX']                                                                                                     
 -except:                                                                                                                       
-  pass                                                                                                                        
-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/gbcore.py.patch                                                                   
+diff -r 82bcfd079628 -r 666438ae9200 patches/gbcore.py.patch                                                                   
 --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  
-+++ b/patches/gbcore.py.patch  Thu Mar 22 17:21:37 2012 +0100                                                                  
++++ b/patches/gbcore.py.patch  Mon Mar 26 23:47:06 2012 +0200                                                                  
 @@ -0,0 +1,33 @@                                                                                                               
 +# HG changeset patch                                                                                                          
 +# User Alexander Dreyer <adreyer@gmx.de>                                                                                      
@@ -493,9 +530,9 @@                                                                                                             
 +     ocode=old_ring.get_order_code()                                                                                          
 +     try:                                                                                                                     
 +         new_ring = old_ring.clone(ordering=options["switch_to"])                                                             
-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/ipbori.patch                                                                      
+diff -r 82bcfd079628 -r 666438ae9200 patches/ipbori.patch                                                                      
 --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  
-+++ b/patches/ipbori.patch     Thu Mar 22 17:21:37 2012 +0100                                                                  
++++ b/patches/ipbori.patch     Mon Mar 26 23:47:06 2012 +0200                                                                  
 @@ -0,0 +1,24 @@                                                                                                               
 +# HG changeset patch                                                                                                          
 +# User Alexander Dreyer <adreyer@gmx.de>                                                                                      
@@ -521,9 +558,9 @@                                                                                                             
 +     except:                                                                                                                  
 +         return False                                                                                                         
 +                                                                                                                              
-diff -r f05b48d16bc7 -r 0ff1dee2843e patches/nf.h.patch                                                                        
+diff -r 82bcfd079628 -r 666438ae9200 patches/nf.h.patch                                                                        
 --- /dev/null  Thu Jan 01 00:00:00 1970 +0000                                                                                  
-+++ b/patches/nf.h.patch       Thu Mar 22 17:21:37 2012 +0100                                                                  
++++ b/patches/nf.h.patch       Mon Mar 26 23:47:06 2012 +0200                                                                  
 @@ -0,0 +1,19 @@                                                                                                               
 +# HG changeset patch                                                                                                          
 +# User Alexander Dreyer <adreyer@gmx.de>                                                                                      
@@ -544,14 +581,14 @@                                                                                                           
 + extern "C"{                                                                                                                  
 + #include <m4ri/m4ri.h>                                                                                                       
 +                                                                                                                              
-diff -r f05b48d16bc7 -r 0ff1dee2843e spkg-install                                                                              
+diff -r 82bcfd079628 -r 666438ae9200 spkg-install                                                                              
 --- a/spkg-install     Mon Mar 12 16:08:02 2012 +0100                                                                          
-+++ b/spkg-install     Thu Mar 22 17:21:37 2012 +0100                                                                          
-@@ -10,17 +10,30 @@                                                                                                            
++++ b/spkg-install     Mon Mar 26 23:47:06 2012 +0200                                                                          
+@@ -10,21 +10,30 @@                                                                                                            
  WORKDIR=${PWD}/src                                                                                                            
  SCONS=scons                                                                                                                   
                                                                                                                                
--patch()                                                                                                                       
+-prepare()                                                                                                                     
 +prepare_polybori()                                                                                                            
  {                                                                                                                             
      if [ $UNAME = "CYGWIN" ]; then                                                                                            
@@ -561,7 +598,9 @@                                                                                                             
-    cp patches/custom.py             src/${PBDIR}                                                                             
-    cp patches/PyPolyBoRi.py         src/${PBDIR}/pyroot/polybori                                                             
 +    cd ${PBDIR}                                                                                                               
-+                                                                                                                              
+                                                                                                                               
+-    cd ${WORKDIR}/${PBDIR}                                                                                                    
+-    patch -p1 < ../../patches/base_lookup.patch                                                                               
 +    # place configuration file                                                                                                
 +    cp ../../custom.py .                                                                                                      
 +                                                                                                                              
@@ -575,22 +614,21 @@                                                                                                           
 +        fi                                                                                                                    
 +    done
 +
-+    cd ${WORKDIR}
+     cd ${WORKDIR}
  }

 -
  build_polybori()
  {
      cd ${PBDIR}
-@@ -57,9 +70,9 @@
+@@ -61,8 +70,9 @@
      rm -rf ${SAGE_LOCAL}/include/cudd
  }

--patch
+-prepare
 +cd ${WORKDIR}

--cd src
 +prepare_polybori
-
  echo "Starting build..."

+ echo "Removing old PolyBoRi install..."
}}}



---

archive/issue_comments_145226.json:
```json
{
    "body": "**Changing reviewer** from \"Leif Leonhardy, Martin Albrecht, Burcin Erocal\" to \"Alexander Dreyer, Leif Leonhardy, Martin Albrecht, Burcin Erocal\".",
    "created_at": "2012-04-02T07:29:09Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145226",
    "user": "https://github.com/jdemeyer"
}
```

**Changing reviewer** from "Leif Leonhardy, Martin Albrecht, Burcin Erocal" to "Alexander Dreyer, Leif Leonhardy, Martin Albrecht, Burcin Erocal".



---

archive/issue_events_106103.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T07:29:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106103"
}
```



---

archive/issue_events_106104.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T07:29:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106104"
}
```



---

archive/issue_comments_145227.json:
```json
{
    "body": "<a id='comment:9'></a>\nDuplicate of #12750 and #12655.",
    "created_at": "2012-04-02T07:29:09Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145227",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Duplicate of #12750 and #12655.



---

archive/issue_comments_145228.json:
```json
{
    "body": "**Changing author** from \"Alexander Dreyer\" to \"\".",
    "created_at": "2012-04-02T07:29:09Z",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12754#issuecomment-145228",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Alexander Dreyer" to "".



---

archive/issue_events_106105.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T07:29:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106105"
}
```



---

archive/issue_events_106106.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T21:06:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106106"
}
```



---

archive/issue_events_106107.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T21:06:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106107"
}
```



---

archive/issue_events_106108.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T21:06:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "label": "duplicate",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106108"
}
```



---

archive/issue_events_106109.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-02T21:06:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12754",
    "rename": {
        "from": "Fix scoping / name look-up issue und PolyBoRi 0.8.1 and support flags from the envrionment",
        "to": "Fix scoping / name look-up issue in PolyBoRi 0.8.1 and support flags from the environment"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12754#event-106109"
}
```
