# Issue 12577: Make Expression._convert a visible method

archive/issues_012405.json:
```json
{
    "body": "It would be nice if the  `_convert()` method of symbolic expressions were made visible (and possibly renamed, if \"convert\" is too general). This has come up in two or three times before, and I needed it long before I bothered to ask for help:\n\n* http://groups.google.com/group/sage-support/browse_thread/thread/88e48ccbccfc56cd\n\n* http://groups.google.com/group/sage-support/browse_thread/thread/70e4c1eaaa632056\n\n\n**Assignee:** @burcin\n\nIssue created by migration from https://trac.sagemath.org/ticket/12577\n\n",
    "created_at": "2012-02-23T20:25:22Z",
    "labels": [
        "component: symbolics",
        "minor",
        "enhancement",
        "wishlist"
    ],
    "title": "Make Expression._convert a visible method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12577",
    "user": "https://github.com/orlitzky"
}
```
It would be nice if the  `_convert()` method of symbolic expressions were made visible (and possibly renamed, if "convert" is too general). This has come up in two or three times before, and I needed it long before I bothered to ask for help:

* http://groups.google.com/group/sage-support/browse_thread/thread/88e48ccbccfc56cd

* http://groups.google.com/group/sage-support/browse_thread/thread/70e4c1eaaa632056


**Assignee:** @burcin

Issue created by migration from https://trac.sagemath.org/ticket/12577





---

archive/issue_events_106307.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106307"
}
```



---

archive/issue_events_106308.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106308"
}
```



---

archive/issue_events_106309.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106309"
}
```



---

archive/issue_events_106310.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106310"
}
```



---

archive/issue_events_106311.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106311"
}
```



---

archive/issue_events_106312.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106312"
}
```



---

archive/issue_events_106313.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106313"
}
```



---

archive/issue_events_106314.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106314"
}
```



---

archive/issue_events_106315.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2015-09-06T13:43:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "label": "good first issue",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106315"
}
```



---

archive/issue_events_106316.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-22T12:44:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106316"
}
```



---

archive/issue_comments_143490.json:
```json
{
    "body": "<a id='comment:7'></a>\nI wonder if, rather than just directly expose `_convert`, there could either be a flag for `numerical_approx`, or some sister-method to `numerical_approx` which is similar but only converts already numerical terms in the expression (as `_convert` itself does).  But the API should be more user-friendly, more along the lines of `numerical_approx`.\n\nThe problem with `numerical_approx` is it ends with some checks like:\n\n```\n        # we have to consider constants as well, since infinity is a constant\n        # in pynac\n        if is_a_numeric(x._gobj):\n            res = py_object_from_numeric(x._gobj)\n        elif  is_a_constant(x._gobj):\n            res = x.pyobject()\n        else:\n            raise TypeError(\"cannot evaluate symbolic expression numerically\")\n```\n\nwhere the last case is what you get if you tried to convert some arbitrary expression (like a polynomial, or solution to a DE) to \"numerical\".\n\nSo yes, what we probably want here is something more like `_convert`, but still a wrapper around it that specifies the allowed keyword arguments, and is maybe specifically geared toward arbitrary-precision numerical results.",
    "created_at": "2019-01-22T12:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12577#issuecomment-143490",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
I wonder if, rather than just directly expose `_convert`, there could either be a flag for `numerical_approx`, or some sister-method to `numerical_approx` which is similar but only converts already numerical terms in the expression (as `_convert` itself does).  But the API should be more user-friendly, more along the lines of `numerical_approx`.

The problem with `numerical_approx` is it ends with some checks like:

```
        # we have to consider constants as well, since infinity is a constant
        # in pynac
        if is_a_numeric(x._gobj):
            res = py_object_from_numeric(x._gobj)
        elif  is_a_constant(x._gobj):
            res = x.pyobject()
        else:
            raise TypeError("cannot evaluate symbolic expression numerically")
```

where the last case is what you get if you tried to convert some arbitrary expression (like a polynomial, or solution to a DE) to "numerical".

So yes, what we probably want here is something more like `_convert`, but still a wrapper around it that specifies the allowed keyword arguments, and is maybe specifically geared toward arbitrary-precision numerical results.



---

archive/issue_comments_143491.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think it's useful in general to be able to change \"back\" from an approximate ring to an exact one. A trivial example:\n\n```\nsage: f = RR(1)*x\nsage: f\n1.00000000000000*x\nsage: f._convert(QQ)\nx\n```\n\nBut I agree that the user interface is key. The name \"convert\" is no good -- it's too general anyway but doesn't tell you what's being converted. Partially as a result of those two things, it's also not discoverable via tab-completion.\n\nThe best altername name that I've been able to come up with so far is `change_ring_of_constants`. It mirrors the `change_ring` method for e.g. vectors and matrices, and will be obviously what you want if you see it in the tab-completion list.",
    "created_at": "2019-01-22T14:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12577#issuecomment-143491",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:8'></a>
I think it's useful in general to be able to change "back" from an approximate ring to an exact one. A trivial example:

```
sage: f = RR(1)*x
sage: f
1.00000000000000*x
sage: f._convert(QQ)
x
```

But I agree that the user interface is key. The name "convert" is no good -- it's too general anyway but doesn't tell you what's being converted. Partially as a result of those two things, it's also not discoverable via tab-completion.

The best altername name that I've been able to come up with so far is `change_ring_of_constants`. It mirrors the `change_ring` method for e.g. vectors and matrices, and will be obviously what you want if you see it in the tab-completion list.



---

archive/issue_comments_143492.json:
```json
{
    "body": "<a id='comment:9'></a>\n`change_ring_of_constants` is not a terrible name--it's pretty accurate.  Maybe we could do a bit better but I think long an clear is better than short and vague.",
    "created_at": "2019-01-23T12:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12577#issuecomment-143492",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
`change_ring_of_constants` is not a terrible name--it's pretty accurate.  Maybe we could do a bit better but I think long an clear is better than short and vague.



---

archive/issue_comments_143493.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe problem with \"change\" also kind of problematic since it implies (to me anyways) an in-place modification, when really you're returning a new expression.  Maybe `convert_constants_to_ring(RR)`?",
    "created_at": "2019-01-23T12:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12577#issuecomment-143493",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
The problem with "change" also kind of problematic since it implies (to me anyways) an in-place modification, when really you're returning a new expression.  Maybe `convert_constants_to_ring(RR)`?



---

archive/issue_comments_143494.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe benefit of `change_ring...` is that it's name is \"obvious\" if you're familiar with the same functionality for lattices, matrices, vectors, modules, etc. It's been years, but I'd like to think that when I was looking for this method, I tried `expr.change<tab>` first. And for better or worse, the ring-changing methods already return a copy rather than switching the ring in-place:\n\n```\nsage: A = identity_matrix(QQ,3)\nsage: A.change_ring(ZZ)\n[1 0 0]\n[0 1 0]\n[0 0 1]\nsage: A.base_ring()\nRational Field\n```\n\nSo, returning a copy is at least consistent. But aside from the nominal similarity to `change_ring`, I don't have a strong preference for the name. Something like `expr.with_constants_in_ring(R)` could also work.",
    "created_at": "2019-01-23T21:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12577#issuecomment-143494",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
The benefit of `change_ring...` is that it's name is "obvious" if you're familiar with the same functionality for lattices, matrices, vectors, modules, etc. It's been years, but I'd like to think that when I was looking for this method, I tried `expr.change<tab>` first. And for better or worse, the ring-changing methods already return a copy rather than switching the ring in-place:

```
sage: A = identity_matrix(QQ,3)
sage: A.change_ring(ZZ)
[1 0 0]
[0 1 0]
[0 0 1]
sage: A.base_ring()
Rational Field
```

So, returning a copy is at least consistent. But aside from the nominal similarity to `change_ring`, I don't have a strong preference for the name. Something like `expr.with_constants_in_ring(R)` could also work.



---

archive/issue_comments_143495.json:
```json
{
    "body": "<a id='comment:12'></a>\nRemoving the \"beginner\" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.\n\nRelated ticket: #24850.",
    "created_at": "2020-05-27T02:49:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12577#issuecomment-143495",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:12'></a>
Removing the "beginner" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.

Related ticket: #24850.



---

archive/issue_events_106317.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-05-27T02:49:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12577",
    "label": "good first issue",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12577#event-106317"
}
```
