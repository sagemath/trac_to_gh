# Issue 12577: Make Expression._convert a visible method

archive/issues_012405.json:
```json
{
    "assignees": [
        "https://github.com/burcin"
    ],
    "body": "It would be nice if the  `_convert()` method of symbolic expressions were made visible (and possibly renamed, if \"convert\" is too general). This has come up in two or three times before, and I needed it long before I bothered to ask for help:\n\n* http://groups.google.com/group/sage-support/browse_thread/thread/88e48ccbccfc56cd\n\n* http://groups.google.com/group/sage-support/browse_thread/thread/70e4c1eaaa632056\n\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12577_\n\n",
    "created_at": "2012-02-23T20:25:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/wishlist%20item"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make Expression._convert a visible method",
    "type": "issue",
    "updated_at": "2020-05-27T02:49:38Z",
    "url": "https://github.com/sagemath/sage/issues/12577",
    "user": "https://github.com/orlitzky"
}
```
It would be nice if the  `_convert()` method of symbolic expressions were made visible (and possibly renamed, if "convert" is too general). This has come up in two or three times before, and I needed it long before I bothered to ask for help:

* http://groups.google.com/group/sage-support/browse_thread/thread/88e48ccbccfc56cd

* http://groups.google.com/group/sage-support/browse_thread/thread/70e4c1eaaa632056


Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/12577_





---

archive/issue_events_173285.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-02-23T20:25:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173285"
}
```



---

archive/issue_events_173286.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-02-23T20:25:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173286"
}
```



---

archive/issue_events_173287.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-02-23T20:25:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173287"
}
```



---

archive/issue_events_173288.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2012-02-23T20:25:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173288"
}
```



---

archive/issue_events_173289.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-23T20:25:22Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "subject": "https://github.com/orlitzky",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173289"
}
```



---

archive/issue_events_173290.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173290"
}
```



---

archive/issue_events_173291.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173291"
}
```



---

archive/issue_events_173292.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173292"
}
```



---

archive/issue_events_173293.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173293"
}
```



---

archive/issue_events_173294.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173294"
}
```



---

archive/issue_events_173295.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173295"
}
```



---

archive/issue_events_173296.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173296"
}
```



---

archive/issue_events_173297.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173297"
}
```



---

archive/issue_events_173298.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2015-09-06T13:43:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "label": "https://github.com/sagemath/sage/labels/good%20first%20issue",
    "label_color": "7057ff",
    "label_name": "good first issue",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173298"
}
```



---

archive/issue_events_173299.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-22T12:44:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173299"
}
```



---

archive/issue_events_173300.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-22T12:44:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173300"
}
```



---

archive/issue_comments_139618.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI wonder if, rather than just directly expose `_convert`, there could either be a flag for `numerical_approx`, or some sister-method to `numerical_approx` which is similar but only converts already numerical terms in the expression (as `_convert` itself does).  But the API should be more user-friendly, more along the lines of `numerical_approx`.\n\nThe problem with `numerical_approx` is it ends with some checks like:\n\n```\n        # we have to consider constants as well, since infinity is a constant\n        # in pynac\n        if is_a_numeric(x._gobj):\n            res = py_object_from_numeric(x._gobj)\n        elif  is_a_constant(x._gobj):\n            res = x.pyobject()\n        else:\n            raise TypeError(\"cannot evaluate symbolic expression numerically\")\n```\n\nwhere the last case is what you get if you tried to convert some arbitrary expression (like a polynomial, or solution to a DE) to \"numerical\".\n\nSo yes, what we probably want here is something more like `_convert`, but still a wrapper around it that specifies the allowed keyword arguments, and is maybe specifically geared toward arbitrary-precision numerical results.",
    "created_at": "2019-01-22T12:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12577#issuecomment-139618",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

I wonder if, rather than just directly expose `_convert`, there could either be a flag for `numerical_approx`, or some sister-method to `numerical_approx` which is similar but only converts already numerical terms in the expression (as `_convert` itself does).  But the API should be more user-friendly, more along the lines of `numerical_approx`.

The problem with `numerical_approx` is it ends with some checks like:

```
        # we have to consider constants as well, since infinity is a constant
        # in pynac
        if is_a_numeric(x._gobj):
            res = py_object_from_numeric(x._gobj)
        elif  is_a_constant(x._gobj):
            res = x.pyobject()
        else:
            raise TypeError("cannot evaluate symbolic expression numerically")
```

where the last case is what you get if you tried to convert some arbitrary expression (like a polynomial, or solution to a DE) to "numerical".

So yes, what we probably want here is something more like `_convert`, but still a wrapper around it that specifies the allowed keyword arguments, and is maybe specifically geared toward arbitrary-precision numerical results.



---

archive/issue_comments_139619.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI think it's useful in general to be able to change \"back\" from an approximate ring to an exact one. A trivial example:\n\n```\nsage: f = RR(1)*x\nsage: f\n1.00000000000000*x\nsage: f._convert(QQ)\nx\n```\n\nBut I agree that the user interface is key. The name \"convert\" is no good -- it's too general anyway but doesn't tell you what's being converted. Partially as a result of those two things, it's also not discoverable via tab-completion.\n\nThe best altername name that I've been able to come up with so far is `change_ring_of_constants`. It mirrors the `change_ring` method for e.g. vectors and matrices, and will be obviously what you want if you see it in the tab-completion list.",
    "created_at": "2019-01-22T14:00:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12577#issuecomment-139619",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:8" align="right">comment:8</div>

I think it's useful in general to be able to change "back" from an approximate ring to an exact one. A trivial example:

```
sage: f = RR(1)*x
sage: f
1.00000000000000*x
sage: f._convert(QQ)
x
```

But I agree that the user interface is key. The name "convert" is no good -- it's too general anyway but doesn't tell you what's being converted. Partially as a result of those two things, it's also not discoverable via tab-completion.

The best altername name that I've been able to come up with so far is `change_ring_of_constants`. It mirrors the `change_ring` method for e.g. vectors and matrices, and will be obviously what you want if you see it in the tab-completion list.



---

archive/issue_comments_139620.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n`change_ring_of_constants` is not a terrible name--it's pretty accurate.  Maybe we could do a bit better but I think long an clear is better than short and vague.",
    "created_at": "2019-01-23T12:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12577#issuecomment-139620",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

`change_ring_of_constants` is not a terrible name--it's pretty accurate.  Maybe we could do a bit better but I think long an clear is better than short and vague.



---

archive/issue_comments_139621.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe problem with \"change\" also kind of problematic since it implies (to me anyways) an in-place modification, when really you're returning a new expression.  Maybe `convert_constants_to_ring(RR)`?",
    "created_at": "2019-01-23T12:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12577#issuecomment-139621",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

The problem with "change" also kind of problematic since it implies (to me anyways) an in-place modification, when really you're returning a new expression.  Maybe `convert_constants_to_ring(RR)`?



---

archive/issue_comments_139622.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe benefit of `change_ring...` is that it's name is \"obvious\" if you're familiar with the same functionality for lattices, matrices, vectors, modules, etc. It's been years, but I'd like to think that when I was looking for this method, I tried `expr.change<tab>` first. And for better or worse, the ring-changing methods already return a copy rather than switching the ring in-place:\n\n```\nsage: A = identity_matrix(QQ,3)\nsage: A.change_ring(ZZ)\n[1 0 0]\n[0 1 0]\n[0 0 1]\nsage: A.base_ring()\nRational Field\n```\n\nSo, returning a copy is at least consistent. But aside from the nominal similarity to `change_ring`, I don't have a strong preference for the name. Something like `expr.with_constants_in_ring(R)` could also work.",
    "created_at": "2019-01-23T21:21:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12577#issuecomment-139622",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:11" align="right">comment:11</div>

The benefit of `change_ring...` is that it's name is "obvious" if you're familiar with the same functionality for lattices, matrices, vectors, modules, etc. It's been years, but I'd like to think that when I was looking for this method, I tried `expr.change<tab>` first. And for better or worse, the ring-changing methods already return a copy rather than switching the ring in-place:

```
sage: A = identity_matrix(QQ,3)
sage: A.change_ring(ZZ)
[1 0 0]
[0 1 0]
[0 0 1]
sage: A.base_ring()
Rational Field
```

So, returning a copy is at least consistent. But aside from the nominal similarity to `change_ring`, I don't have a strong preference for the name. Something like `expr.with_constants_in_ring(R)` could also work.



---

archive/issue_comments_139623.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nRemoving the \"beginner\" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.\n\nRelated ticket: #24850.",
    "created_at": "2020-05-27T02:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12577#issuecomment-139623",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:12" align="right">comment:12</div>

Removing the "beginner" tag from old tickets. Some could be returned to beginner-friendly status by adding a comment about what needs to be done. Some others might be easy for an experienced developer to finish.

Related ticket: #24850.



---

archive/issue_events_173301.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2020-05-27T02:49:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12577",
    "label": "https://github.com/sagemath/sage/labels/good%20first%20issue",
    "label_color": "7057ff",
    "label_name": "good first issue",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12577#event-173301"
}
```
