# Issue 12657: Better implementation of Frobenius automorphism

archive/issues_012485.json:
```json
{
    "assignees": [],
    "body": "The Frobenius automorphism of *p*-adic fields was added in #8241.  The implementation is horribly inefficient and should use Hensel lifting directly rather than decomposing into a list of Teichmuller representatives.\n\nThis optimization should probably wait on #12555.\n\nDepends on #14304\n\nAssignee: **@roed314**\n\nCC:  jpflori @xcaruso\n\nKeywords: **sd87**\n\nBranch/Commit: **[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)**\n\nReviewer: **GaYee Park, Xavier Caruso**\n\nAuthor: **Ander Steele, Ricky Magner**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12657_\n\n",
    "closed_at": "2017-07-29T19:27:02Z",
    "created_at": "2012-03-12T19:40:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20padics",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Better implementation of Frobenius automorphism",
    "type": "issue",
    "updated_at": "2017-07-29T19:27:02Z",
    "url": "https://github.com/sagemath/sage/issues/12657",
    "user": "https://github.com/roed314"
}
```
The Frobenius automorphism of *p*-adic fields was added in #8241.  The implementation is horribly inefficient and should use Hensel lifting directly rather than decomposing into a list of Teichmuller representatives.

This optimization should probably wait on #12555.

Depends on #14304

Assignee: **@roed314**

CC:  jpflori @xcaruso

Keywords: **sd87**

Branch/Commit: **[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)**

Reviewer: **GaYee Park, Xavier Caruso**

Author: **Ander Steele, Ricky Magner**

_Issue created by migration from https://trac.sagemath.org/ticket/12657_





---

archive/issue_events_153654.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-03-12T19:40:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153654"
}
```



---

archive/issue_events_153655.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-03-12T19:40:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20padics",
    "label_color": "0000ff",
    "label_name": "component: padics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153655"
}
```



---

archive/issue_events_153656.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-03-12T19:40:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153656"
}
```



---

archive/issue_events_153657.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2012-03-12T19:40:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153657"
}
```



---

archive/issue_events_153658.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153658"
}
```



---

archive/issue_events_153659.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153659"
}
```



---

archive/issue_comments_143355.json:
```json
{
    "body": "Dependencies: **#14304**",
    "created_at": "2014-01-06T21:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143355",
    "user": "https://github.com/roed314"
}
```

Dependencies: **#14304**



---

archive/issue_comments_143356.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThe method that needs to be improved is `frobenius_unram` in `src/sage/libs/linkages/padics/unram_shared.pxi`.  This may want to wait on some more p-adic polynomial developments, but could also be done now.",
    "created_at": "2014-01-06T21:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143356",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'>Comment 2:</a>
The method that needs to be improved is `frobenius_unram` in `src/sage/libs/linkages/padics/unram_shared.pxi`.  This may want to wait on some more p-adic polynomial developments, but could also be done now.



---

archive/issue_events_153660.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153660"
}
```



---

archive/issue_events_153661.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153661"
}
```



---

archive/issue_events_153662.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153662"
}
```



---

archive/issue_events_153663.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153663"
}
```



---

archive/issue_events_153664.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153664"
}
```



---

archive/issue_events_153665.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153665"
}
```



---

archive/issue_comments_143357.json:
```json
{
    "body": "Changed keywords from **** to **sd87**",
    "created_at": "2017-07-17T17:38:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143357",
    "user": "https://github.com/roed314"
}
```

Changed keywords from **** to **sd87**



---

archive/issue_comments_143358.json:
```json
{
    "body": "Branch: **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)**",
    "created_at": "2017-07-19T19:57:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143358",
    "user": "https://github.com/andersteele"
}
```

Branch: **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)**



---

archive/issue_comments_143359.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a280e0d22e449a981086f98c80a23408d89ae06\">9a280e0</a></td><td><code>Add cached method for computing frob of generator of unramified extension. Speeds up general frob</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61\">ffcb86c</a></td><td><code>Make frob_gen() method private</code></td></tr></table>\n",
    "created_at": "2017-07-19T21:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143359",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'>Comment 9:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a280e0d22e449a981086f98c80a23408d89ae06">9a280e0</a></td><td><code>Add cached method for computing frob of generator of unramified extension. Speeds up general frob</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61">ffcb86c</a></td><td><code>Make frob_gen() method private</code></td></tr></table>




---

archive/issue_comments_143360.json:
```json
{
    "body": "Commit: **[ffcb86c](https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61)**",
    "created_at": "2017-07-19T21:02:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143360",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[ffcb86c](https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61)**



---

archive/issue_comments_143361.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493\">3a03a51</a></td><td><code>Add doctest for _frob_gen()</code></td></tr></table>\n",
    "created_at": "2017-07-19T21:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143361",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493">3a03a51</a></td><td><code>Add doctest for _frob_gen()</code></td></tr></table>




---

archive/issue_comments_143362.json:
```json
{
    "body": "Changed commit from **[ffcb86c](https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61)** to **[3a03a51](https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493)**",
    "created_at": "2017-07-19T21:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143362",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ffcb86c](https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61)** to **[3a03a51](https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493)**



---

archive/issue_events_153666.json:
```json
{
    "actor": "https://github.com/andersteele",
    "created_at": "2017-07-20T02:07:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153666"
}
```



---

archive/issue_events_153667.json:
```json
{
    "actor": "https://github.com/sagetrac-gpark",
    "created_at": "2017-07-20T16:02:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153667"
}
```



---

archive/issue_events_153668.json:
```json
{
    "actor": "https://github.com/sagetrac-gpark",
    "created_at": "2017-07-20T16:02:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153668"
}
```



---

archive/issue_comments_143363.json:
```json
{
    "body": "Reviewer: **GaYee Park**",
    "created_at": "2017-07-20T16:02:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143363",
    "user": "https://github.com/sagetrac-gpark"
}
```

Reviewer: **GaYee Park**



---

archive/issue_comments_143364.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nAll test passed.",
    "created_at": "2017-07-20T16:02:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143364",
    "user": "https://github.com/sagetrac-gpark"
}
```

<a id='comment:12'>Comment 12:</a>
All test passed.



---

archive/issue_events_153669.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-20T23:17:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153669"
}
```



---

archive/issue_events_153670.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-20T23:17:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153670"
}
```



---

archive/issue_comments_143365.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nAuthor name missing.",
    "created_at": "2017-07-20T23:17:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143365",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'>Comment 13:</a>
Author name missing.



---

archive/issue_events_153671.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-20T23:17:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153671"
}
```



---

archive/issue_events_153672.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-20T23:17:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "milestone_number": null,
    "milestone_title": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153672"
}
```



---

archive/issue_comments_143366.json:
```json
{
    "body": "Author: **asteele, Ricky Magner**",
    "created_at": "2017-07-20T23:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143366",
    "user": "https://github.com/andersteele"
}
```

Author: **asteele, Ricky Magner**



---

archive/issue_events_153673.json:
```json
{
    "actor": "https://github.com/andersteele",
    "created_at": "2017-07-20T23:30:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153673"
}
```



---

archive/issue_events_153674.json:
```json
{
    "actor": "https://github.com/andersteele",
    "created_at": "2017-07-20T23:30:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153674"
}
```



---

archive/issue_comments_143367.json:
```json
{
    "body": "Changed reviewer from **GaYee Park** to **GaYee Park, Xavier Caruso**",
    "created_at": "2017-07-21T03:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143367",
    "user": "https://github.com/xcaruso"
}
```

Changed reviewer from **GaYee Park** to **GaYee Park, Xavier Caruso**



---

archive/issue_comments_143368.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI don't understand why you need to redo Newton iteration in `frobenius_unram`.\n\nAlternatively, instead of storing the powers of `frob_a` in a dictonary, you can use Horner scheme.",
    "created_at": "2017-07-21T03:40:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143368",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:15'>Comment 15:</a>
I don't understand why you need to redo Newton iteration in `frobenius_unram`.

Alternatively, instead of storing the powers of `frob_a` in a dictonary, you can use Horner scheme.



---

archive/issue_comments_143369.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nWe redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.\n\nAs for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.",
    "created_at": "2017-07-21T04:10:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143369",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:16'>Comment 16:</a>
We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.

As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.



---

archive/issue_comments_143370.json:
```json
{
    "body": "Changed author from **asteele, Ricky Magner** to **Ander Steele, Ricky Magner**",
    "created_at": "2017-07-21T04:53:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143370",
    "user": "https://github.com/roed314"
}
```

Changed author from **asteele, Ricky Magner** to **Ander Steele, Ricky Magner**



---

archive/issue_comments_143371.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@andersteele](#comment%3A16):\n> We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.\n\nI wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? \n\n> As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.\n\nI don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.",
    "created_at": "2017-07-21T05:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143371",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@andersteele](#comment%3A16):
> We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.

I wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? 

> As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.

I don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.



---

archive/issue_comments_143372.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea18e00487a1c2e054e42f823df00e3f93423ff0\">ea18e00</a></td><td><code>fix whitespace</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905\">62cec73</a></td><td><code>Remove duplicated code</code></td></tr></table>\n",
    "created_at": "2017-07-21T09:07:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143372",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:19'>Comment 19:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea18e00487a1c2e054e42f823df00e3f93423ff0">ea18e00</a></td><td><code>fix whitespace</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905">62cec73</a></td><td><code>Remove duplicated code</code></td></tr></table>




---

archive/issue_comments_143373.json:
```json
{
    "body": "Changed commit from **[3a03a51](https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493)** to **[62cec73](https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905)**",
    "created_at": "2017-07-21T09:07:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143373",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3a03a51](https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493)** to **[62cec73](https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905)**



---

archive/issue_comments_143374.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nAha, thanks for catching that! That was a mistake, and has been fixed.\n\nReplying to [@xcaruso](#comment%3A18):\n> Replying to [@andersteele](#comment%3A16):\n> > We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.\n\n> \n> I wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? \n\n>\n\nI just tested the Horner method and it is roughly 10 times slower in Zq(5<sup>100</sup>,100). It seems that multiplying elements of the extension by elements in Q_p is very fast, but multiplying elements in the extension is generally slow. Cacheing the expensive multiplications  (and maybe performing more multiplications over all) appears to be a good strategy in very high degree.\n\n> > As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.\n\n> \n> I don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.",
    "created_at": "2017-07-21T10:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143374",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:20'>Comment 20:</a>
Aha, thanks for catching that! That was a mistake, and has been fixed.

Replying to [@xcaruso](#comment%3A18):
> Replying to [@andersteele](#comment%3A16):
> > We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.

> 
> I wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? 

>

I just tested the Horner method and it is roughly 10 times slower in Zq(5<sup>100</sup>,100). It seems that multiplying elements of the extension by elements in Q_p is very fast, but multiplying elements in the extension is generally slow. Cacheing the expensive multiplications  (and maybe performing more multiplications over all) appears to be a good strategy in very high degree.

> > As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.

> 
> I don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.



---

archive/issue_comments_143375.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nLet me disagree :-).\n\nOn my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.\n\nBy the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.",
    "created_at": "2017-07-21T14:47:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143375",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:21'>Comment 21:</a>
Let me disagree :-).

On my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.

By the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.



---

archive/issue_comments_143376.json:
```json
{
    "body": "Changed branch from **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)** to **[u/caruso/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/better_implementation_of_frobenius_automorphism)**",
    "created_at": "2017-07-21T14:48:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143376",
    "user": "https://github.com/xcaruso"
}
```

Changed branch from **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)** to **[u/caruso/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/better_implementation_of_frobenius_automorphism)**



---

archive/issue_comments_143377.json:
```json
{
    "body": "Changed commit from **[62cec73](https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905)** to **[8ae9f8a](https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140)**",
    "created_at": "2017-07-21T14:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143377",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[62cec73](https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905)** to **[8ae9f8a](https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140)**



---

archive/issue_comments_143378.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140\">8ae9f8a</a></td><td><code>Use Horner scheme</code></td></tr></table>\n",
    "created_at": "2017-07-21T14:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143378",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140">8ae9f8a</a></td><td><code>Use Horner scheme</code></td></tr></table>




---

archive/issue_comments_143379.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nFantastic! I see your implementation of Horner is much better than what I was doing, and I have reproduced the performance increase on k8s: After `_frob_gen()` is cached, your scheme computes frobenius of random elements of ` Zq(5^100,100) ` in approximately 60 ms, while the previous method was taking 800ms. Your current implementation is definitely the way to go (and is roughly 1000 times faster than what is currently in Sage)\n\nReplying to [@xcaruso](#comment%3A21):\n> Let me disagree :-).\n> \n> On my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.\n> \n> By the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.",
    "created_at": "2017-07-22T16:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143379",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:24'>Comment 24:</a>
Fantastic! I see your implementation of Horner is much better than what I was doing, and I have reproduced the performance increase on k8s: After `_frob_gen()` is cached, your scheme computes frobenius of random elements of ` Zq(5^100,100) ` in approximately 60 ms, while the previous method was taking 800ms. Your current implementation is definitely the way to go (and is roughly 1000 times faster than what is currently in Sage)

Replying to [@xcaruso](#comment%3A21):
> Let me disagree :-).
> 
> On my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.
> 
> By the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.



---

archive/issue_comments_143380.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nmaybe the iteration `+    for i in range(len(coefs)):`\ncould be replaced by just `+    for ci in coefs:` ?",
    "created_at": "2017-07-23T08:17:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143380",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'>Comment 25:</a>
maybe the iteration `+    for i in range(len(coefs)):`
could be replaced by just `+    for ci in coefs:` ?



---

archive/issue_comments_143381.json:
```json
{
    "body": "Changed branch from **[u/caruso/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/better_implementation_of_frobenius_automorphism)** to **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)**",
    "created_at": "2017-07-25T20:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143381",
    "user": "https://github.com/andersteele"
}
```

Changed branch from **[u/caruso/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/caruso/better_implementation_of_frobenius_automorphism)** to **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)**



---

archive/issue_comments_143382.json:
```json
{
    "body": "Changed commit from **[8ae9f8a](https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140)** to **[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)**",
    "created_at": "2017-07-25T20:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143382",
    "user": "https://github.com/andersteele"
}
```

Changed commit from **[8ae9f8a](https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140)** to **[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)**



---

archive/issue_comments_143383.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI've cleaned up the code a little bit, removing the previous method (which contained the non-pythonic iteration `for i in range(len(coefs))` ). Code now uses Xavier's implementation of Horner' scheme, passes all doctests and, I think, is ready for review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d\">5c9d33c</a></td><td><code>remove extraneous code</code></td></tr></table>\n",
    "created_at": "2017-07-25T20:16:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143383",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:27'>Comment 27:</a>
I've cleaned up the code a little bit, removing the previous method (which contained the non-pythonic iteration `for i in range(len(coefs))` ). Code now uses Xavier's implementation of Horner' scheme, passes all doctests and, I think, is ready for review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d">5c9d33c</a></td><td><code>remove extraneous code</code></td></tr></table>




---

archive/issue_events_153675.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-07-28T18:06:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153675"
}
```



---

archive/issue_events_153676.json:
```json
{
    "actor": "https://github.com/xcaruso",
    "created_at": "2017-07-28T18:06:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153676"
}
```



---

archive/issue_comments_143384.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nOk, positive review (through it would be even faster to use the method `polynomial` of ticket #14825 but it still needs work).",
    "created_at": "2017-07-28T18:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143384",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:28'>Comment 28:</a>
Ok, positive review (through it would be even faster to use the method `polynomial` of ticket #14825 but it still needs work).



---

archive/issue_comments_143385.json:
```json
{
    "body": "Changed branch from **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)** to **[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)**",
    "created_at": "2017-07-29T19:27:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12657#issuecomment-143385",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/asteele/better_implementation_of_frobenius_automorphism](https://github.com/sagemath/sagetrac-mirror/tree/u/asteele/better_implementation_of_frobenius_automorphism)** to **[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)**



---

archive/issue_events_153677.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T19:27:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153677"
}
```



---

archive/issue_events_153678.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "b2f4c27fbdfbe4d0037b9133b78ff39e97add0aa",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2017-07-29T19:27:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12657",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12657#event-153678"
}
```
