# Issue 12657: Better implementation of Frobenius automorphism

archive/issues_012485.json:
```json
{
    "body": "The Frobenius automorphism of *p*-adic fields was added in #8241.  The implementation is horribly inefficient and should use Hensel lifting directly rather than decomposing into a list of Teichmuller representatives.\n\nThis optimization should probably wait on #12555.\n\nAssignee: @roed314\n\nCC:  jpflori @xcaruso\n\nKeywords: sd87\n\nBranch/Commit: 5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d\n\nReviewer: GaYee Park, Xavier Caruso\n\nAuthor: Ander Steele, Ricky Magner\n\nDependencies: #14304\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12657\n\n",
    "closed_at": "2017-07-29T19:27:02Z",
    "created_at": "2012-03-12T19:40:12Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Better implementation of Frobenius automorphism",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12657",
    "user": "https://github.com/roed314"
}
```
The Frobenius automorphism of *p*-adic fields was added in #8241.  The implementation is horribly inefficient and should use Hensel lifting directly rather than decomposing into a list of Teichmuller representatives.

This optimization should probably wait on #12555.

Assignee: @roed314

CC:  jpflori @xcaruso

Keywords: sd87

Branch/Commit: 5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d

Reviewer: GaYee Park, Xavier Caruso

Author: Ander Steele, Ricky Magner

Dependencies: #14304

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12657





---

archive/issue_events_047852.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47852"
}
```



---

archive/issue_comments_180031.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#14304\"",
    "created_at": "2014-01-06T21:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180031",
    "user": "https://github.com/roed314"
}
```

Changing dependencies from "" to "#14304"



---

archive/issue_comments_180032.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe method that needs to be improved is `frobenius_unram` in `src/sage/libs/linkages/padics/unram_shared.pxi`.  This may want to wait on some more p-adic polynomial developments, but could also be done now.",
    "created_at": "2014-01-06T21:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180032",
    "user": "https://github.com/roed314"
}
```

<a id='comment:2'></a>
The method that needs to be improved is `frobenius_unram` in `src/sage/libs/linkages/padics/unram_shared.pxi`.  This may want to wait on some more p-adic polynomial developments, but could also be done now.



---

archive/issue_events_047853.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47853"
}
```



---

archive/issue_events_047854.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47854"
}
```



---

archive/issue_events_047855.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47855"
}
```



---

archive/issue_events_047856.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47856"
}
```



---

archive/issue_events_047857.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47857"
}
```



---

archive/issue_events_047858.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47858"
}
```



---

archive/issue_comments_180033.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd87\".",
    "created_at": "2017-07-17T17:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180033",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "sd87".



---

archive/issue_comments_180034.json:
```json
{
    "body": "Changing branch from \"\" to \"u/asteele/better_implementation_of_frobenius_automorphism\"",
    "created_at": "2017-07-19T19:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180034",
    "user": "https://github.com/andersteele"
}
```

Changing branch from "" to "u/asteele/better_implementation_of_frobenius_automorphism"



---

archive/issue_comments_180035.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|\n|[9a280e0](https://github.com/sagemath/sagetrac-mirror/commit/9a280e0d22e449a981086f98c80a23408d89ae06)|`Add cached method for computing frob of generator of unramified extension. Speeds up general frob`|\n|[ffcb86c](https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61)|`Make frob_gen() method private`|",
    "created_at": "2017-07-19T21:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------|
|[9a280e0](https://github.com/sagemath/sagetrac-mirror/commit/9a280e0d22e449a981086f98c80a23408d89ae06)|`Add cached method for computing frob of generator of unramified extension. Speeds up general frob`|
|[ffcb86c](https://github.com/sagemath/sagetrac-mirror/commit/ffcb86ca34e2f45641ec8639b2a045527f5c1e61)|`Make frob_gen() method private`|



---

archive/issue_comments_180036.json:
```json
{
    "body": "Changing commit from \"\" to \"ffcb86ca34e2f45641ec8639b2a045527f5c1e61\"",
    "created_at": "2017-07-19T21:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "ffcb86ca34e2f45641ec8639b2a045527f5c1e61"



---

archive/issue_comments_180037.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[3a03a51](https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493)|`Add doctest for _frob_gen()`|",
    "created_at": "2017-07-19T21:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[3a03a51](https://github.com/sagemath/sagetrac-mirror/commit/3a03a51b0875bc8d72e3f51b787245938e464493)|`Add doctest for _frob_gen()`|



---

archive/issue_comments_180038.json:
```json
{
    "body": "Changing commit from \"ffcb86ca34e2f45641ec8639b2a045527f5c1e61\" to \"3a03a51b0875bc8d72e3f51b787245938e464493\"",
    "created_at": "2017-07-19T21:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ffcb86ca34e2f45641ec8639b2a045527f5c1e61" to "3a03a51b0875bc8d72e3f51b787245938e464493"



---

archive/issue_comments_180039.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-20T02:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180039",
    "user": "https://github.com/andersteele"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_180040.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-20T16:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180040",
    "user": "https://trac.sagemath.org/admin/accounts/users/gpark"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180041.json:
```json
{
    "body": "Changing reviewer from \"\" to \"GaYee Park\"",
    "created_at": "2017-07-20T16:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180041",
    "user": "https://trac.sagemath.org/admin/accounts/users/gpark"
}
```

Changing reviewer from "" to "GaYee Park"



---

archive/issue_comments_180042.json:
```json
{
    "body": "<a id='comment:12'></a>\nAll test passed.",
    "created_at": "2017-07-20T16:02:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180042",
    "user": "https://trac.sagemath.org/admin/accounts/users/gpark"
}
```

<a id='comment:12'></a>
All test passed.



---

archive/issue_comments_180043.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-20T23:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180043",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_180044.json:
```json
{
    "body": "<a id='comment:13'></a>\nAuthor name missing.",
    "created_at": "2017-07-20T23:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180044",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Author name missing.



---

archive/issue_events_047859.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-20T23:17:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47859"
}
```



---

archive/issue_events_047860.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2017-07-20T23:17:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "milestone": "sage-8.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47860"
}
```



---

archive/issue_comments_180045.json:
```json
{
    "body": "Changing author from \"\" to \"asteele, Ricky Magner\"",
    "created_at": "2017-07-20T23:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180045",
    "user": "https://github.com/andersteele"
}
```

Changing author from "" to "asteele, Ricky Magner"



---

archive/issue_comments_180046.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-20T23:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180046",
    "user": "https://github.com/andersteele"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180047.json:
```json
{
    "body": "Changing reviewer from \"GaYee Park\" to \"GaYee Park, Xavier Caruso\"",
    "created_at": "2017-07-21T03:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180047",
    "user": "https://github.com/xcaruso"
}
```

Changing reviewer from "GaYee Park" to "GaYee Park, Xavier Caruso"



---

archive/issue_comments_180048.json:
```json
{
    "body": "<a id='comment:15'></a>\nI don't understand why you need to redo Newton iteration in `frobenius_unram`.\n\nAlternatively, instead of storing the powers of `frob_a` in a dictonary, you can use Horner scheme.",
    "created_at": "2017-07-21T03:40:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180048",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:15'></a>
I don't understand why you need to redo Newton iteration in `frobenius_unram`.

Alternatively, instead of storing the powers of `frob_a` in a dictonary, you can use Horner scheme.



---

archive/issue_comments_180049.json:
```json
{
    "body": "<a id='comment:16'></a>\nWe redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.\n\nAs for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.",
    "created_at": "2017-07-21T04:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180049",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:16'></a>
We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.

As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.



---

archive/issue_comments_180050.json:
```json
{
    "body": "Changing author from \"asteele, Ricky Magner\" to \"Ander Steele, Ricky Magner\"",
    "created_at": "2017-07-21T04:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180050",
    "user": "https://github.com/roed314"
}
```

Changing author from "asteele, Ricky Magner" to "Ander Steele, Ricky Magner"



---

archive/issue_comments_180051.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [asteele](#comment%3A16):\n> We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.\n\n\nI wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? \n\n> As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.\n\n\nI don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.",
    "created_at": "2017-07-21T05:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180051",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:18'></a>
Replying to [asteele](#comment%3A16):
> We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.


I wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? 

> As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.


I don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.



---

archive/issue_comments_180052.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|\n|[ea18e00](https://github.com/sagemath/sagetrac-mirror/commit/ea18e00487a1c2e054e42f823df00e3f93423ff0)|`fix whitespace`|\n|[62cec73](https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905)|`Remove duplicated code`|",
    "created_at": "2017-07-21T09:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|
|[ea18e00](https://github.com/sagemath/sagetrac-mirror/commit/ea18e00487a1c2e054e42f823df00e3f93423ff0)|`fix whitespace`|
|[62cec73](https://github.com/sagemath/sagetrac-mirror/commit/62cec73f79f300e700cc683b9a2486d796777905)|`Remove duplicated code`|



---

archive/issue_comments_180053.json:
```json
{
    "body": "Changing commit from \"3a03a51b0875bc8d72e3f51b787245938e464493\" to \"62cec73f79f300e700cc683b9a2486d796777905\"",
    "created_at": "2017-07-21T09:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3a03a51b0875bc8d72e3f51b787245938e464493" to "62cec73f79f300e700cc683b9a2486d796777905"



---

archive/issue_comments_180054.json:
```json
{
    "body": "<a id='comment:20'></a>\nAha, thanks for catching that! That was a mistake, and has been fixed.\n\nReplying to [caruso](#comment%3A18):\n> Replying to [asteele](#comment%3A16):\n> > We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.\n\n> \n> I wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? \n\n>\n\nI just tested the Horner method and it is roughly 10 times slower in Zq(5<sup>100</sup>,100). It seems that multiplying elements of the extension by elements in Q_p is very fast, but multiplying elements in the extension is generally slow. Cacheing the expensive multiplications  (and maybe performing more multiplications over all) appears to be a good strategy in very high degree.\n\n> > As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.\n\n> \n> I don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.",
    "created_at": "2017-07-21T10:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180054",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:20'></a>
Aha, thanks for catching that! That was a mistake, and has been fixed.

Replying to [caruso](#comment%3A18):
> Replying to [asteele](#comment%3A16):
> > We redid the Newton iteration in _frob_gen() because that was easier (for me) than finding & adapting an existing method. The only method I see is .hensel_lift(p,e) in  sage.rings.polynomial.polynomial_element.Polynomial, and I don't see the advantage of adapting that.

> 
> I wanted to say that you redid Newton iteration in `_frob_gen()` and in `frobenius_unram()`. Is there a reason for that? 

>

I just tested the Horner method and it is roughly 10 times slower in Zq(5<sup>100</sup>,100). It seems that multiplying elements of the extension by elements in Q_p is very fast, but multiplying elements in the extension is generally slow. Cacheing the expensive multiplications  (and maybe performing more multiplications over all) appears to be a good strategy in very high degree.

> > As for the horner scheme--our experiments suggested that the expensive operation was multiplication (in large degree unramified extensions). For example, In R.<a> = Zq(37<sup>100</sup>,100), addition of two random elements takes ~80 micro seconds, while muliplication takes ~80 milli seconds. My naive guess is that cacheing the powers of frob_a in the dictionary and paying the cost of addition will be much faster than paying the repeated cost of multiplication. In any case, storing the powers in a dict or computing the polynomials via horner are much faster than the previous method of computing frobenius.

> 
> I don't understand why Horner method is more costly in terms of multiplications. On the contrary, I think that it is (a bit) less costly.



---

archive/issue_comments_180055.json:
```json
{
    "body": "<a id='comment:21'></a>\nLet me disagree :-).\n\nOn my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.\n\nBy the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.",
    "created_at": "2017-07-21T14:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180055",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:21'></a>
Let me disagree :-).

On my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.

By the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.



---

archive/issue_comments_180056.json:
```json
{
    "body": "Changing branch from \"u/asteele/better_implementation_of_frobenius_automorphism\" to \"u/caruso/better_implementation_of_frobenius_automorphism\"",
    "created_at": "2017-07-21T14:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180056",
    "user": "https://github.com/xcaruso"
}
```

Changing branch from "u/asteele/better_implementation_of_frobenius_automorphism" to "u/caruso/better_implementation_of_frobenius_automorphism"



---

archive/issue_comments_180057.json:
```json
{
    "body": "Changing commit from \"62cec73f79f300e700cc683b9a2486d796777905\" to \"8ae9f8aff0648ed4a3a90e137a6640945f208140\"",
    "created_at": "2017-07-21T14:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180057",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "62cec73f79f300e700cc683b9a2486d796777905" to "8ae9f8aff0648ed4a3a90e137a6640945f208140"



---

archive/issue_comments_180058.json:
```json
{
    "body": "<a id='comment:23'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------|\n|[8ae9f8a](https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140)|`Use Horner scheme`|",
    "created_at": "2017-07-21T14:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180058",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------|
|[8ae9f8a](https://github.com/sagemath/sagetrac-mirror/commit/8ae9f8aff0648ed4a3a90e137a6640945f208140)|`Use Horner scheme`|



---

archive/issue_comments_180059.json:
```json
{
    "body": "<a id='comment:24'></a>\nFantastic! I see your implementation of Horner is much better than what I was doing, and I have reproduced the performance increase on k8s: After `_frob_gen()` is cached, your scheme computes frobenius of random elements of ` Zq(5^100,100) ` in approximately 60 ms, while the previous method was taking 800ms. Your current implementation is definitely the way to go (and is roughly 1000 times faster than what is currently in Sage)\n\nReplying to [caruso](#comment%3A21):\n> Let me disagree :-).\n> \n> On my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.\n> \n> By the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.",
    "created_at": "2017-07-22T16:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180059",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:24'></a>
Fantastic! I see your implementation of Horner is much better than what I was doing, and I have reproduced the performance increase on k8s: After `_frob_gen()` is cached, your scheme computes frobenius of random elements of ` Zq(5^100,100) ` in approximately 60 ms, while the previous method was taking 800ms. Your current implementation is definitely the way to go (and is roughly 1000 times faster than what is currently in Sage)

Replying to [caruso](#comment%3A21):
> Let me disagree :-).
> 
> On my laptop, with your current implementation, it takes about 1s to compute the Frobenius of a random element over `Zq(5^100,100)` (without taking in account the computation of the Frobenius of the generator) while it takes less than 0.1s using the Horner scheme (cf implementation attached). It is then about 10 times faster.
> 
> By the way, as far as I understand, an element of Zq is representated as P(a) where a is the generator and P is a polynomial over Z. What we do currently is to write all the coefficients of P in radix p (this is done by the method `list`), and then just after recompose them into actual integers. It would be better to avoid this useful computation and access directly to the coefficients of P but I'm not sure it's easy to do it.



---

archive/issue_comments_180060.json:
```json
{
    "body": "<a id='comment:25'></a>\nmaybe the iteration `+    for i in range(len(coefs)):`\ncould be replaced by just `+    for ci in coefs:` ?",
    "created_at": "2017-07-23T08:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180060",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
maybe the iteration `+    for i in range(len(coefs)):`
could be replaced by just `+    for ci in coefs:` ?



---

archive/issue_comments_180061.json:
```json
{
    "body": "Changing branch from \"u/caruso/better_implementation_of_frobenius_automorphism\" to \"u/asteele/better_implementation_of_frobenius_automorphism\"",
    "created_at": "2017-07-25T20:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180061",
    "user": "https://github.com/andersteele"
}
```

Changing branch from "u/caruso/better_implementation_of_frobenius_automorphism" to "u/asteele/better_implementation_of_frobenius_automorphism"



---

archive/issue_comments_180062.json:
```json
{
    "body": "Changing commit from \"8ae9f8aff0648ed4a3a90e137a6640945f208140\" to \"5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d\"",
    "created_at": "2017-07-25T20:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180062",
    "user": "https://github.com/andersteele"
}
```

Changing commit from "8ae9f8aff0648ed4a3a90e137a6640945f208140" to "5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d"



---

archive/issue_comments_180063.json:
```json
{
    "body": "<a id='comment:27'></a>\nI've cleaned up the code a little bit, removing the previous method (which contained the non-pythonic iteration `for i in range(len(coefs))` ). Code now uses Xavier's implementation of Horner' scheme, passes all doctests and, I think, is ready for review.\n\n---\nNew commits:\n|                                                                                                                                          |                        |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|\n|[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)|`remove extraneous code`|",
    "created_at": "2017-07-25T20:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180063",
    "user": "https://github.com/andersteele"
}
```

<a id='comment:27'></a>
I've cleaned up the code a little bit, removing the previous method (which contained the non-pythonic iteration `for i in range(len(coefs))` ). Code now uses Xavier's implementation of Horner' scheme, passes all doctests and, I think, is ready for review.

---
New commits:
|                                                                                                                                          |                        |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------|
|[5c9d33c](https://github.com/sagemath/sagetrac-mirror/commit/5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d)|`remove extraneous code`|



---

archive/issue_comments_180064.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-28T18:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180064",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180065.json:
```json
{
    "body": "<a id='comment:28'></a>\nOk, positive review (through it would be even faster to use the method `polynomial` of ticket #14825 but it still needs work).",
    "created_at": "2017-07-28T18:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180065",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:28'></a>
Ok, positive review (through it would be even faster to use the method `polynomial` of ticket #14825 but it still needs work).



---

archive/issue_comments_180066.json:
```json
{
    "body": "Changing branch from \"u/asteele/better_implementation_of_frobenius_automorphism\" to \"5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d\"",
    "created_at": "2017-07-29T19:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180066",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/asteele/better_implementation_of_frobenius_automorphism" to "5c9d33c72a8993cde39ebd9d1ccf774bfb65b07d"



---

archive/issue_comments_180067.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-07-29T19:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12657#issuecomment-180067",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_047861.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-07-29T19:27:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12657",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12657#event-47861"
}
```
