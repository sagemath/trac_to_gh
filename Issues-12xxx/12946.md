# Issue 12946: Bug in Compositions

archive/issues_012774.json:
```json
{
    "body": "When using the optional 'outer' argument, Compositions gives a bug if 'outer' is itself a composition (as opposed to a list). Also needs to be fixed for 'inner'.\n\nFor instance:\n\nsage: c = Compositions(3, outer = Composition([3,2]))\n\nsage: for x in c:\n....:     print x\n....:     \n\n---\nTypeError                                 Traceback (most recent call last)\n\n/Applications/sage/devel/sage-combinat/.hg/patches/<ipython console> in <module>()\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in __iter__(self)\n   1023         args = self.build_args()\n   1024         for n in self.n_range:\n-> 1025             l =  first(n, *args)\n   1026             while l is not None:\n   1027                 yield self._element_constructor_(l)\n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in first(n, min_length, max_length, floor, ceiling, min_slope, max_slope)\n     72             return None\n     73 \n---> 74         if ceiling(min_length) == 0 and max_slope <= 0:\n     75             return None\n     76 \n\n/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in <lambda>(i)\n    994         \"\"\"\n    995         return [self.min_length, self.max_length,\n--> 996                 lambda i: self.floor(i-1), lambda i: self.ceiling(i-1),\n    997                 self.min_slope, self.max_slope]\n    998 \n\nTypeError: 'Composition_class' object is not callable\n\n\nAssignee: tbd\n\nKeywords: Compositions\n\nReviewer: Andrew Mathas\n\nAuthor: Mike Hansen\n\nMerged: sage-5.4.beta0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12946\n\n",
    "closed_at": "2012-08-27T10:37:12Z",
    "created_at": "2012-05-13T20:28:59Z",
    "labels": [
        "component: combinatorics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.4",
    "title": "Bug in Compositions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12946",
    "user": "https://trac.sagemath.org/admin/accounts/users/chrisjamesberg"
}
```
When using the optional 'outer' argument, Compositions gives a bug if 'outer' is itself a composition (as opposed to a list). Also needs to be fixed for 'inner'.

For instance:

sage: c = Compositions(3, outer = Composition([3,2]))

sage: for x in c:
....:     print x
....:     

---
TypeError                                 Traceback (most recent call last)

/Applications/sage/devel/sage-combinat/.hg/patches/<ipython console> in <module>()

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in __iter__(self)
   1023         args = self.build_args()
   1024         for n in self.n_range:
-> 1025             l =  first(n, *args)
   1026             while l is not None:
   1027                 yield self._element_constructor_(l)

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in first(n, min_length, max_length, floor, ceiling, min_slope, max_slope)
     72             return None
     73 
---> 74         if ceiling(min_length) == 0 and max_slope <= 0:
     75             return None
     76 

/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.pyc in <lambda>(i)
    994         """
    995         return [self.min_length, self.max_length,
--> 996                 lambda i: self.floor(i-1), lambda i: self.ceiling(i-1),
    997                 self.min_slope, self.max_slope]
    998 

TypeError: 'Composition_class' object is not callable


Assignee: tbd

Keywords: Compositions

Reviewer: Andrew Mathas

Author: Mike Hansen

Merged: sage-5.4.beta0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12946





---

archive/issue_comments_195143.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-14T23:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195143",
    "user": "https://github.com/mwhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_195144.json:
```json
{
    "body": "Changing author from \"Chris Berg\" to \"Mike Hansen\"",
    "created_at": "2012-05-14T23:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195144",
    "user": "https://github.com/mwhansen"
}
```

Changing author from "Chris Berg" to "Mike Hansen"



---

archive/issue_comments_195145.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Andrew Mathas\"",
    "created_at": "2012-08-22T07:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195145",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing reviewer from "" to "Andrew Mathas"



---

archive/issue_comments_195146.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe documentation on what outer and inner do is not particularly clear to me, so so I think that it would not hurt to explain this better, but I'll leave that decision up to you. \n\nMore importantly, the patch doesn't work when inner is a composition, so I am marking the patch as `needs work`:\n\n```\n\nsage: Compositions(4, inner=Composition([3,1,2])).list()\nTraceback (most recent call last):\n...\nTypeError: 'Composition_class' object is not callable\n\n\n```\n\nOf course, the fix is trivial: as you did with outer you need to replace line 984 with:\n\n```\ninner = list(kwargs['inner'])\n```\n\nCheers,\nAndrew",
    "created_at": "2012-08-22T07:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195146",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:2'></a>
The documentation on what outer and inner do is not particularly clear to me, so so I think that it would not hurt to explain this better, but I'll leave that decision up to you. 

More importantly, the patch doesn't work when inner is a composition, so I am marking the patch as `needs work`:

```

sage: Compositions(4, inner=Composition([3,1,2])).list()
Traceback (most recent call last):
...
TypeError: 'Composition_class' object is not callable


```

Of course, the fix is trivial: as you did with outer you need to replace line 984 with:

```
inner = list(kwargs['inner'])
```

Cheers,
Andrew



---

archive/issue_comments_195147.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-22T07:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195147",
    "user": "https://github.com/AndrewAtLarge"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_195148.json:
```json
{
    "body": "<a id='comment:4'></a>\nHi Mike,\n\nTo save time I just uploaded a reviewer patch which fixes the inner problem above and adds a test for it. If you are happy with this, and if the tests all pass, then I'm happy to give it a positive review.\n\nAndrew\n\n--\n\nFor the patchbot:\n\nApply trac_12946.patch trac_12946-review.patch",
    "created_at": "2012-08-22T07:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195148",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:4'></a>
Hi Mike,

To save time I just uploaded a reviewer patch which fixes the inner problem above and adds a test for it. If you are happy with this, and if the tests all pass, then I'm happy to give it a positive review.

Andrew

--

For the patchbot:

Apply trac_12946.patch trac_12946-review.patch



---

archive/issue_comments_195149.json:
```json
{
    "body": "<a id='comment:5'></a>\nAll of the tests passed so if you are happy with the review patch I'll give this a positive review.\n\nAndrew\n\nApply trac_12946.patch trac_12946-review.patch",
    "created_at": "2012-08-22T23:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195149",
    "user": "https://github.com/AndrewAtLarge"
}
```

<a id='comment:5'></a>
All of the tests passed so if you are happy with the review patch I'll give this a positive review.

Andrew

Apply trac_12946.patch trac_12946-review.patch



---

archive/issue_comments_195150.json:
```json
{
    "body": "<a id='comment:6'></a>\nLooks good to me.",
    "created_at": "2012-08-23T04:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195150",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:6'></a>
Looks good to me.



---

archive/issue_comments_195151.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2012-08-23T04:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195151",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_041329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-23T13:17:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "milestone": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12946#event-41329"
}
```



---

archive/issue_comments_195152.json:
```json
{
    "body": "<a id='comment:8'></a>\nPlease add a more proper commit message (\"Update of #12946\" is quite meaningless).",
    "created_at": "2012-08-23T15:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195152",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Please add a more proper commit message ("Update of #12946" is quite meaningless).



---

archive/issue_comments_195153.json:
```json
{
    "body": "Attachment [trac_12946.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946.patch) by @mwhansen created at 2012-08-23 20:05:23",
    "created_at": "2012-08-23T20:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195153",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12946.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946.patch) by @mwhansen created at 2012-08-23 20:05:23



---

archive/issue_comments_195154.json:
```json
{
    "body": "Attachment [trac_12946-review.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946-review.patch) by @mwhansen created at 2012-08-23 20:06:24\n\nRemoving some garbage from the top of the file",
    "created_at": "2012-08-23T20:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195154",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12946-review.patch](tarball://root/attachments/some-uuid/ticket12946/trac_12946-review.patch) by @mwhansen created at 2012-08-23 20:06:24

Removing some garbage from the top of the file



---

archive/issue_comments_195155.json:
```json
{
    "body": "<a id='comment:9'></a>\nI've fixed the commit message in  trac_12946-review.patch.",
    "created_at": "2012-08-23T20:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195155",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:9'></a>
I've fixed the commit message in  trac_12946-review.patch.



---

archive/issue_events_041330.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-27T10:37:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12946#event-41330"
}
```



---

archive/issue_comments_195156.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-27T10:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195156",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_195157.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.4.beta0\"",
    "created_at": "2012-08-27T10:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12946#issuecomment-195157",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.4.beta0"
