# Issue 12449: Improve the way that sage evaluates symbolic functions on basic types

archive/issues_012277.json:
```json
{
    "body": "Currently when a symbolic function (e.g. gamma(), exp(), sin()) gets a python float, it passes it off to ginac, and let's ginac evaluate it. This can be very slow, e.g.:\n\n```\nsage: timeit('exp(6.0r)')\n625 loops, best of 3: 476 \u00b5s per loop\n```\nThis also leads to possibly undesirable inconsistencies across different platforms: for example, ginac ends up calling the local libc tgammal to evaluate the gamma function, and even when this tgammal is evaluated by the same version of eglibc on two different platforms the answer varies depending on whether 80 bit doubles are available.\n\nTo fix this, we make Sage check its types which correspond most closely to python type for the function that should be called, and use the functions for those types if available.\n\nNow we have\n\n```\nsage: timeit('exp(6.0r)')\n625 loops, best of 3: 1.02 \u00b5s per loop\n```\nFor the specific case of the gamma function, the is also a change here to make RDF use python's math.gamma(). It is more accurate than gsl. It is perhaps not as accurate as eglibc's gamma(), but it should give reliable results on different platforms.\n\nI think this will fix 3 of the 4 failing numerical accuracy doctests on ARM, though the test for binomial(.5r, 5) had to be weakened slightly.  (see http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c ) binomial() is currently not computed in a very good way, though, so it is reasonable to weaken this test temporarily. (see https://github.com/sagemath/sage/issues/12448 )\n\nFinally, I'll remark that these improvements could probably be much better. The above timings should be compared to\n\n```\nsage: timeit('math.exp(6.0r)')\n625 loops, best of 3: 112 ns per loop\n```\nApply:\n\n* [attachment:trac12449.patch](https://github.com/sagemath/sage/files/ticket12449/trac12449.patch)\n\nDepends on #4498\n\nDepends on #12507\n\nDepends on #9130\n\n**Assignee:** bober\n\n**CC:**  Snark @eviatarbach\n\n**Keywords:** gamma function\n\n**Reviewer:** Burcin Erocal, Jonathan Bober\n\n**Author:** Jonathan Bober, Burcin Erocal\n\nIssue created by migration from https://trac.sagemath.org/ticket/12449\n\n",
    "closed_at": "2018-08-14T17:43:26Z",
    "created_at": "2012-02-05T21:53:23Z",
    "labels": [
        "component: symbolics",
        "enhancement",
        "worksforme",
        "invalid"
    ],
    "title": "Improve the way that sage evaluates symbolic functions on basic types",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12449",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```
Currently when a symbolic function (e.g. gamma(), exp(), sin()) gets a python float, it passes it off to ginac, and let's ginac evaluate it. This can be very slow, e.g.:

```
sage: timeit('exp(6.0r)')
625 loops, best of 3: 476 µs per loop
```
This also leads to possibly undesirable inconsistencies across different platforms: for example, ginac ends up calling the local libc tgammal to evaluate the gamma function, and even when this tgammal is evaluated by the same version of eglibc on two different platforms the answer varies depending on whether 80 bit doubles are available.

To fix this, we make Sage check its types which correspond most closely to python type for the function that should be called, and use the functions for those types if available.

Now we have

```
sage: timeit('exp(6.0r)')
625 loops, best of 3: 1.02 µs per loop
```
For the specific case of the gamma function, the is also a change here to make RDF use python's math.gamma(). It is more accurate than gsl. It is perhaps not as accurate as eglibc's gamma(), but it should give reliable results on different platforms.

I think this will fix 3 of the 4 failing numerical accuracy doctests on ARM, though the test for binomial(.5r, 5) had to be weakened slightly.  (see http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c ) binomial() is currently not computed in a very good way, though, so it is reasonable to weaken this test temporarily. (see https://github.com/sagemath/sage/issues/12448 )

Finally, I'll remark that these improvements could probably be much better. The above timings should be compared to

```
sage: timeit('math.exp(6.0r)')
625 loops, best of 3: 112 ns per loop
```
Apply:

* [attachment:trac12449.patch](https://github.com/sagemath/sage/files/ticket12449/trac12449.patch)

Depends on #4498

Depends on #12507

Depends on #9130

**Assignee:** bober

**CC:**  Snark @eviatarbach

**Keywords:** gamma function

**Reviewer:** Burcin Erocal, Jonathan Bober

**Author:** Jonathan Bober, Burcin Erocal

Issue created by migration from https://trac.sagemath.org/ticket/12449





---

archive/issue_events_102329.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-08T00:06:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102329"
}
```



---

archive/issue_comments_139474.json:
```json
{
    "body": "**Author:** bober",
    "created_at": "2012-02-08T00:06:24Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139474",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

**Author:** bober



---

archive/issue_comments_139475.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,15 +1,28 @@\n-There are numerical inaccuracies in the gamma function on python floats on some platforms. See, e.g. \n-http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c\n-\n-Also, the current implementation is slower than it should be on basic types:\n+Currently when a symbolic function (e.g. gamma(), exp(), sin()) gets a python float, it passes it off to ginac, and let's ginac evaluate it. This can be very slow, e.g.:\n \n ```\n-sage: timeit('gamma(6.0r)')\n-625 loops, best of 3: 32 \u00b5s per loop\n-sage: timeit('gamma(6r)')\n-625 loops, best of 3: 44.3 \u00b5s per loop\n-sage: timeit('gamma(6.0)')\n-625 loops, best of 3: 22.9 \u00b5s per loop\n-sage: timeit('gamma(6)')\n-625 loops, best of 3: 3.29 \u00b5s per loop\n+sage: timeit('exp(6.0r)')\n+625 loops, best of 3: 476 \u00b5s per loop\n ```\n+\n+This also leads to possibly undesirable inconsistencies across different platforms: for example, ginac ends up calling the local libc tgammal to evaluate the gamma function, and even when this tgammal is evaluated by the same version of eglibc on two different platforms the answer varies depending on whether 80 bit doubles are available.\n+\n+To fix this, we make Sage check its types which correspond most closely to python type for the function that should be called, and use the functions for those types if available.\n+\n+Now we have\n+\n+```\n+sage: timeit('exp(6.0r)')\n+625 loops, best of 3: 1.02 \u00b5s per loop\n+```\n+\n+For the specific case of the gamma function, the is also a change here to make RDF use python's math.gamma(). It is more accurate than gsl. It is perhaps not as accurate as eglibc's gamma(), but it should give reliable results on different platforms.\n+\n+I think this will fix 3 of the 4 failing numerical accuracy doctests on ARM, though the test for binomial(.5r, 5) had to be weakened slightly.  (see http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c ) binomial() is currently not computed in a very good way, though, so it is reasonable to weaken this test temporarily. (see https://github.com/sagemath/sage/issues/12448 )\n+\n+Finally, I'll remark that these improvements could probably be much better. The above timings should be compared to\n+\n+```\n+sage: timeit('math.exp(6.0r)')\n+625 loops, best of 3: 112 ns per loop\n+```\n``````\n",
    "created_at": "2012-02-08T00:06:24Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139475",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,15 +1,28 @@
-There are numerical inaccuracies in the gamma function on python floats on some platforms. See, e.g. 
-http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c
-
-Also, the current implementation is slower than it should be on basic types:
+Currently when a symbolic function (e.g. gamma(), exp(), sin()) gets a python float, it passes it off to ginac, and let's ginac evaluate it. This can be very slow, e.g.:
 
 ```
-sage: timeit('gamma(6.0r)')
-625 loops, best of 3: 32 µs per loop
-sage: timeit('gamma(6r)')
-625 loops, best of 3: 44.3 µs per loop
-sage: timeit('gamma(6.0)')
-625 loops, best of 3: 22.9 µs per loop
-sage: timeit('gamma(6)')
-625 loops, best of 3: 3.29 µs per loop
+sage: timeit('exp(6.0r)')
+625 loops, best of 3: 476 µs per loop
 ```
+
+This also leads to possibly undesirable inconsistencies across different platforms: for example, ginac ends up calling the local libc tgammal to evaluate the gamma function, and even when this tgammal is evaluated by the same version of eglibc on two different platforms the answer varies depending on whether 80 bit doubles are available.
+
+To fix this, we make Sage check its types which correspond most closely to python type for the function that should be called, and use the functions for those types if available.
+
+Now we have
+
+```
+sage: timeit('exp(6.0r)')
+625 loops, best of 3: 1.02 µs per loop
+```
+
+For the specific case of the gamma function, the is also a change here to make RDF use python's math.gamma(). It is more accurate than gsl. It is perhaps not as accurate as eglibc's gamma(), but it should give reliable results on different platforms.
+
+I think this will fix 3 of the 4 failing numerical accuracy doctests on ARM, though the test for binomial(.5r, 5) had to be weakened slightly.  (see http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c ) binomial() is currently not computed in a very good way, though, so it is reasonable to weaken this test temporarily. (see https://github.com/sagemath/sage/issues/12448 )
+
+Finally, I'll remark that these improvements could probably be much better. The above timings should be compared to
+
+```
+sage: timeit('math.exp(6.0r)')
+625 loops, best of 3: 112 ns per loop
+```
``````




---

archive/issue_events_102330.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-08T00:06:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "rename": {
        "from": "Improve the gamma function",
        "to": "Improve the way that sage evaluates symbolic functions on basic types"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102330"
}
```



---

archive/issue_events_102331.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-08T00:06:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "component: basic arithmetic",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102331"
}
```



---

archive/issue_events_102332.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-08T00:06:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "component: symbolics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102332"
}
```



---

archive/issue_events_102333.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-08T12:28:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102333"
}
```



---

archive/issue_events_102334.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-08T12:28:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102334"
}
```



---

archive/issue_comments_139476.json:
```json
{
    "body": "<a id='comment:2'></a>\nThanks for the patch. I agree that considering float and complex types separately in the fast evaluation path makes sense for speed. However, this causes inconsistencies with the results you get when a value is substituted into the expression.\n\nWe still need to modify the `py_tgamma()` function in `sage/symbolic/pynac.pyx` to fix this:\n\n```\nsage: gamma(x).subs(x=6.r)          \n120.0\n```\n\nAFAICT (without applying the patch and testing), [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch) removes the `try/except` block around `return getattr(args[0], self._name)()`, disabling the call to `BuiltinFunction.__call__` later on in the function body.\n\nThis would be a good occasion to merge my patch from [attachment:trac_1173-move_call.patch:ticket:1173](https://github.com/sagemath/sage/files/ticket12449/70ae67b84c28aa4487c42f2bb70e13ca.patch:ticket:1173)I'll try to rebase your patch on top of that.",
    "created_at": "2012-02-08T12:28:11Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139476",
    "user": "https://github.com/burcin"
}
```

<a id='comment:2'></a>
Thanks for the patch. I agree that considering float and complex types separately in the fast evaluation path makes sense for speed. However, this causes inconsistencies with the results you get when a value is substituted into the expression.

We still need to modify the `py_tgamma()` function in `sage/symbolic/pynac.pyx` to fix this:

```
sage: gamma(x).subs(x=6.r)          
120.0
```

AFAICT (without applying the patch and testing), [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch) removes the `try/except` block around `return getattr(args[0], self._name)()`, disabling the call to `BuiltinFunction.__call__` later on in the function body.

This would be a good occasion to merge my patch from [attachment:trac_1173-move_call.patch:ticket:1173](https://github.com/sagemath/sage/files/ticket12449/70ae67b84c28aa4487c42f2bb70e13ca.patch:ticket:1173)I'll try to rebase your patch on top of that.



---

archive/issue_comments_139477.json:
```json
{
    "body": "**Changing author** from \"bober\" to \"Jonathan Bober\".",
    "created_at": "2012-02-08T12:28:11Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139477",
    "user": "https://github.com/burcin"
}
```

**Changing author** from "bober" to "Jonathan Bober".



---

archive/issue_comments_139478.json:
```json
{
    "body": "**Reviewer:** Burcin Erocal",
    "created_at": "2012-02-08T12:28:11Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139478",
    "user": "https://github.com/burcin"
}
```

**Reviewer:** Burcin Erocal



---

archive/issue_comments_139479.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [burcin](#comment%3A2):\n\n> AFAICT (without applying the patch and testing), [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch) removes the `try/except` block around `return getattr(args[0], self._name)()`, disabling the call to `BuiltinFunction.__call__` later on in the function body.\n\nSorry. I was looking at the code after applying [attachment:trac_1173-move_call.patch:ticket:1173](https://github.com/sagemath/sage/files/ticket12449/70ae67b84c28aa4487c42f2bb70e13ca.patch:ticket:1173)There is no `try/except` block in the original code.\n\nRegarding the changes to `sage/rings/real_double.pyx`: IIRC, python's math module just calls the underlying libc functions. On ARM won't this introduce new errors?",
    "created_at": "2012-02-08T12:45:48Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139479",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>
Replying to [burcin](#comment%3A2):

> AFAICT (without applying the patch and testing), [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch) removes the `try/except` block around `return getattr(args[0], self._name)()`, disabling the call to `BuiltinFunction.__call__` later on in the function body.

Sorry. I was looking at the code after applying [attachment:trac_1173-move_call.patch:ticket:1173](https://github.com/sagemath/sage/files/ticket12449/70ae67b84c28aa4487c42f2bb70e13ca.patch:ticket:1173)There is no `try/except` block in the original code.

Regarding the changes to `sage/rings/real_double.pyx`: IIRC, python's math module just calls the underlying libc functions. On ARM won't this introduce new errors?



---

archive/issue_comments_139480.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [burcin](#comment%3A3):\n> Replying to [burcin](#comment%3A2):\n> \n> > AFAICT (without applying the patch and testing), [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch) removes the `try/except` block around `return getattr(args[0], self._name)()`, disabling the call to `BuiltinFunction.__call__` later on in the function body.\n\n> \n> Sorry. I was looking at the code after applying [attachment:trac_1173-move_call.patch:ticket:1173](https://github.com/sagemath/sage/files/ticket12449/70ae67b84c28aa4487c42f2bb70e13ca.patch:ticket:1173)There is no `try/except` block in the original code.\n> \n> Regarding the changes to `sage/rings/real_double.pyx`: IIRC, python's math module just calls the underlying libc functions. On ARM won't this introduce new errors?\n\nFor the gamma function, at least, python has its own implementation. Of course, that function itself might call some underlying libc functions, so maybe it won't be entirely consistent, now that I think about it.\n\nIn the bit of testing that I did, math.gamma was less accurate than tgammal on my computer, but much more accurate than gsl's gamma function.",
    "created_at": "2012-02-08T12:51:33Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139480",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:4'></a>
Replying to [burcin](#comment%3A3):
> Replying to [burcin](#comment%3A2):
> 
> > AFAICT (without applying the patch and testing), [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch) removes the `try/except` block around `return getattr(args[0], self._name)()`, disabling the call to `BuiltinFunction.__call__` later on in the function body.

> 
> Sorry. I was looking at the code after applying [attachment:trac_1173-move_call.patch:ticket:1173](https://github.com/sagemath/sage/files/ticket12449/70ae67b84c28aa4487c42f2bb70e13ca.patch:ticket:1173)There is no `try/except` block in the original code.
> 
> Regarding the changes to `sage/rings/real_double.pyx`: IIRC, python's math module just calls the underlying libc functions. On ARM won't this introduce new errors?

For the gamma function, at least, python has its own implementation. Of course, that function itself might call some underlying libc functions, so maybe it won't be entirely consistent, now that I think about it.

In the bit of testing that I did, math.gamma was less accurate than tgammal on my computer, but much more accurate than gsl's gamma function.



---

archive/issue_comments_139481.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -26,3 +26,7 @@\n sage: timeit('math.exp(6.0r)')\n 625 loops, best of 3: 112 ns per loop\n ```\n+\n+Apply:\n+- [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch)\n+- [attachment:trac_12449-py_tgamma.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449-py_tgamma.patch)\n``````\n",
    "created_at": "2012-02-13T11:08:57Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139481",
    "user": "https://github.com/burcin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -26,3 +26,7 @@
 sage: timeit('math.exp(6.0r)')
 625 loops, best of 3: 112 ns per loop
 ```
+
+Apply:
+- [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch)
+- [attachment:trac_12449-py_tgamma.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449-py_tgamma.patch)
``````




---

archive/issue_comments_139482.json:
```json
{
    "body": "**Changing author** from \"Jonathan Bober\" to \"Jonathan Bober, Burcin Erocal\".",
    "created_at": "2012-02-13T11:08:57Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139482",
    "user": "https://github.com/burcin"
}
```

**Changing author** from "Jonathan Bober" to "Jonathan Bober, Burcin Erocal".



---

archive/issue_events_102335.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-13T11:08:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102335"
}
```



---

archive/issue_events_102336.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-13T11:08:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102336"
}
```



---

archive/issue_comments_139483.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt turns out that Python implements the gamma function itself:\n\nhttp://hg.python.org/cpython/file/58bd6a58365d/Modules/mathmodule.c#l226\n\nI uploaded a new patch that changes `py_tgamma()` in `sage/symbolic/pynac.pyx` to use Python's gamma implementation.\n\nI give a positive review to [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch)If someone can review my patch we can switch this to positive review.\n\nBTW, this will fix #9162. We should close that as a duplicate.",
    "created_at": "2012-02-13T11:08:57Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139483",
    "user": "https://github.com/burcin"
}
```

<a id='comment:5'></a>
It turns out that Python implements the gamma function itself:

http://hg.python.org/cpython/file/58bd6a58365d/Modules/mathmodule.c#l226

I uploaded a new patch that changes `py_tgamma()` in `sage/symbolic/pynac.pyx` to use Python's gamma implementation.

I give a positive review to [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch)If someone can review my patch we can switch this to positive review.

BTW, this will fix #9162. We should close that as a duplicate.



---

archive/issue_comments_139484.json:
```json
{
    "body": "<a id='comment:6'></a>\nI uploaded a new version of my patch since the previous function had a typo that make doctests fail.",
    "created_at": "2012-02-13T14:31:41Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139484",
    "user": "https://github.com/burcin"
}
```

<a id='comment:6'></a>
I uploaded a new version of my patch since the previous function had a typo that make doctests fail.



---

archive/issue_comments_139485.json:
```json
{
    "body": "<a id='comment:7'></a>\nWell, I suppose that I will just go ahead and give it a positive review, since your changes are simple and orthogonal to mine (and I checked that all tests still pass on my machine). I would like to get some confirmation that this fixes things on ARM, but I suppose that we'll find that out eventually; that's a secondary point as far as this patch goes, though, so it isn't that important.",
    "created_at": "2012-02-15T06:17:21Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139485",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:7'></a>
Well, I suppose that I will just go ahead and give it a positive review, since your changes are simple and orthogonal to mine (and I checked that all tests still pass on my machine). I would like to get some confirmation that this fixes things on ARM, but I suppose that we'll find that out eventually; that's a secondary point as far as this patch goes, though, so it isn't that important.



---

archive/issue_comments_139486.json:
```json
{
    "body": "**Changing reviewer** from \"Burcin Erocal\" to \"Burcin Erocal, Jonathan Bober\".",
    "created_at": "2012-02-15T06:17:21Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139486",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

**Changing reviewer** from "Burcin Erocal" to "Burcin Erocal, Jonathan Bober".



---

archive/issue_events_102337.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-15T06:17:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102337"
}
```



---

archive/issue_events_102338.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-15T06:17:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102338"
}
```



---

archive/issue_comments_139487.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis should be rebased to #4498 + #12507 + #9130.",
    "created_at": "2012-02-24T08:34:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139487",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
This should be rebased to #4498 + #12507 + #9130.



---

archive/issue_comments_139488.json:
```json
{
    "body": "**Dependencies:** #4498, #12507, #9130",
    "created_at": "2012-02-24T08:34:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139488",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #4498, #12507, #9130



---

archive/issue_events_102339.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-24T08:34:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102339"
}
```



---

archive/issue_events_102340.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-24T08:34:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102340"
}
```



---

archive/issue_comments_139489.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -28,5 +28,4 @@\n ```\n \n Apply:\n-- [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch)\n-- [attachment:trac_12449-py_tgamma.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449-py_tgamma.patch)\n+- [attachment:trac_12449_rebase.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase.patch)\n``````\n",
    "created_at": "2012-02-28T01:03:56Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139489",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -28,5 +28,4 @@
 ```
 
 Apply:
-- [attachment:12449.patch](https://github.com/sagemath/sage/files/ticket12449/12449.patch)
-- [attachment:trac_12449-py_tgamma.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449-py_tgamma.patch)
+- [attachment:trac_12449_rebase.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase.patch)
``````




---

archive/issue_comments_139490.json:
```json
{
    "body": "<a id='comment:9'></a>\nI've attached a patch rebased to 5.0-beta5. I had no problem applying the patches, so I just made sure all tests still pass.\n\nMaybe I should just go ahead and put it back to positive review, but I'll give Burcin a day or so to take a look at it.",
    "created_at": "2012-02-28T01:03:56Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139490",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:9'></a>
I've attached a patch rebased to 5.0-beta5. I had no problem applying the patches, so I just made sure all tests still pass.

Maybe I should just go ahead and put it back to positive review, but I'll give Burcin a day or so to take a look at it.



---

archive/issue_events_102341.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-28T01:03:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102341"
}
```



---

archive/issue_events_102342.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-02-28T01:03:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102342"
}
```



---

archive/issue_events_102343.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-28T07:57:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102343"
}
```



---

archive/issue_events_102344.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2012-02-28T07:57:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102344"
}
```



---

archive/issue_comments_139491.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooks good to me.",
    "created_at": "2012-02-28T07:57:07Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139491",
    "user": "https://github.com/burcin"
}
```

<a id='comment:10'></a>
Looks good to me.



---

archive/issue_comments_139492.json:
```json
{
    "body": "<a id='comment:11'></a>\nRebasing to sage-5.0.beta5 isn't sufficient, since #9130 was only merged in sage-5.0.beta**6**.  So, this patch still needs an extra rebase.",
    "created_at": "2012-02-28T21:36:35Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139492",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Rebasing to sage-5.0.beta5 isn't sufficient, since #9130 was only merged in sage-5.0.beta**6**.  So, this patch still needs an extra rebase.



---

archive/issue_events_102345.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-28T21:36:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102345"
}
```



---

archive/issue_events_102346.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-28T21:36:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102346"
}
```



---

archive/issue_comments_139493.json:
```json
{
    "body": "<a id='comment:12'></a>\nOops. I guess that explains why I didn't actually need to do anything to rebase. I'll try to remember to update this later today.",
    "created_at": "2012-02-28T23:11:53Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139493",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:12'></a>
Oops. I guess that explains why I didn't actually need to do anything to rebase. I'll try to remember to update this later today.



---

archive/issue_comments_139494.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -28,4 +28,4 @@\n ```\n \n Apply:\n-- [attachment:trac_12449_rebase.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase.patch)\n+- [attachment:trac_12449_rebase_beta7.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase_beta7.patch)\n``````\n",
    "created_at": "2012-03-06T07:22:21Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139494",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -28,4 +28,4 @@
 ```
 
 Apply:
-- [attachment:trac_12449_rebase.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase.patch)
+- [attachment:trac_12449_rebase_beta7.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase_beta7.patch)
``````




---

archive/issue_events_102347.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-03-06T07:23:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102347"
}
```



---

archive/issue_events_102348.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-03-06T07:23:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102348"
}
```



---

archive/issue_comments_139495.json:
```json
{
    "body": "<a id='comment:14'></a>\nOk, now it is rebased to 5.0beta7.",
    "created_at": "2012-03-06T07:23:06Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139495",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:14'></a>
Ok, now it is rebased to 5.0beta7.



---

archive/issue_events_102349.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-12T12:58:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102349"
}
```



---

archive/issue_events_102350.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-12T12:58:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102350"
}
```



---

archive/issue_comments_139496.json:
```json
{
    "body": "<a id='comment:15'></a>\nThere is numerical noise.  On hawk (OpenSolaris 06.2009-32):\n\n```\nsage -t  --long -force_lib devel/sage/sage/symbolic/function.pyx\nWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta8/devel/sage-main/sage/symbolic/function.pyx\", line 185:\n    sage: cot(complex(1,2))\nExpected:\n    (0.03279775553375259-0.9843292264581908j)\nGot:\n    (0.03279775553375261-0.9843292264581911j)\n**********************************************************************\nsage -t  --long -force_lib devel/sage/sage/functions/hyperbolic.py\nWarning: divide by zero encountered in divide\nWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta8/devel/sage-main/sage/functions/hyperbolic.py\", line 543:\n    sage: float(arccoth(2))\nExpected:\n    0.5493061443340548\nGot:\n    0.5493061443340549\n**********************************************************************\n```",
    "created_at": "2012-03-12T12:58:13Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139496",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
There is numerical noise.  On hawk (OpenSolaris 06.2009-32):

```
sage -t  --long -force_lib devel/sage/sage/symbolic/function.pyx
Warning: divide by zero encountered in divide
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta8/devel/sage-main/sage/symbolic/function.pyx", line 185:
    sage: cot(complex(1,2))
Expected:
    (0.03279775553375259-0.9843292264581908j)
Got:
    (0.03279775553375261-0.9843292264581911j)
**********************************************************************
sage -t  --long -force_lib devel/sage/sage/functions/hyperbolic.py
Warning: divide by zero encountered in divide
Warning: divide by zero encountered in divide
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta8/devel/sage-main/sage/functions/hyperbolic.py", line 543:
    sage: float(arccoth(2))
Expected:
    0.5493061443340548
Got:
    0.5493061443340549
**********************************************************************
```



---

archive/issue_comments_139497.json:
```json
{
    "body": "<a id='comment:16'></a>\nOn bsd (OS X 10.6 64-bit):\n\n```\nsage -t  --long -force_lib devel/sage/sage/functions/hyperbolic.py\nWarning: divide by zero encountered in divide\nWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/Users/buildbot/build/sage/bsd-1/bsd_64_full/build/sage-5.0.beta8/devel/sage-main/sage/functions/hyperbolic.py\", line 543:\n    sage: float(arccoth(2))\nExpected:\n    0.5493061443340548\nGot:\n    0.5493061443340549\n**********************************************************************\n```",
    "created_at": "2012-03-12T13:00:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139497",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
On bsd (OS X 10.6 64-bit):

```
sage -t  --long -force_lib devel/sage/sage/functions/hyperbolic.py
Warning: divide by zero encountered in divide
Warning: divide by zero encountered in divide
**********************************************************************
File "/Users/buildbot/build/sage/bsd-1/bsd_64_full/build/sage-5.0.beta8/devel/sage-main/sage/functions/hyperbolic.py", line 543:
    sage: float(arccoth(2))
Expected:
    0.5493061443340548
Got:
    0.5493061443340549
**********************************************************************
```



---

archive/issue_comments_139498.json:
```json
{
    "body": "<a id='comment:17'></a>\nOn iras (ia64):\n\n```\nsage -t  --long -force_lib devel/sage/sage/rings/arith.py\n**********************************************************************\nFile \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8/devel/sage-main/sage/rings/arith.py\", line 3066:\n    sage: abs(binomial(0.5r, 5) - 0.02734375) < 1e-17r\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```",
    "created_at": "2012-03-12T20:54:32Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139498",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
On iras (ia64):

```
sage -t  --long -force_lib devel/sage/sage/rings/arith.py
**********************************************************************
File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8/devel/sage-main/sage/rings/arith.py", line 3066:
    sage: abs(binomial(0.5r, 5) - 0.02734375) < 1e-17r
Expected:
    True
Got:
    False
**********************************************************************
```



---

archive/issue_comments_139499.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A17):\n> On iras (ia64):\n> \n> ```\n> sage -t  --long -force_lib devel/sage/sage/rings/arith.py\n> **********************************************************************\n> File \"/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8/devel/sage-main/sage/rings/arith.py\", line 3066:\n>     sage: abs(binomial(0.5r, 5) - 0.02734375) < 1e-17r\n> Expected:\n>     True\n> Got:\n>     False\n> **********************************************************************\n> ```\n\nThree remarks:\n1. that test is also one that is failing on ARM ; and there's a trac ticket about binomial's implementation being pretty wrong (#12448).\n2. should that test use \"#tol abs\" instead of doing the computation itself?\n3. shouldn't it be even a \"#tol rel\" ?",
    "created_at": "2012-03-13T06:57:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139499",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A17):
> On iras (ia64):
> 
> ```
> sage -t  --long -force_lib devel/sage/sage/rings/arith.py
> **********************************************************************
> File "/home/buildbot/build/sage/cleo-1/cleo_full/build/sage-5.0.beta8/devel/sage-main/sage/rings/arith.py", line 3066:
>     sage: abs(binomial(0.5r, 5) - 0.02734375) < 1e-17r
> Expected:
>     True
> Got:
>     False
> **********************************************************************
> ```

Three remarks:
1. that test is also one that is failing on ARM ; and there's a trac ticket about binomial's implementation being pretty wrong (#12448).
2. should that test use "#tol abs" instead of doing the computation itself?
3. shouldn't it be even a "#tol rel" ?



---

archive/issue_comments_139500.json:
```json
{
    "body": "<a id='comment:19'></a>\nOn cicero (Linux i386):\n\n```\nsage -t  --long -force_lib devel/sage/sage/symbolic/function.pyx\nWarning: divide by zero encountered in divide\n**********************************************************************\nFile \"/home/buildbot/build/sage/cicero-1/cicero_full/build/sage-5.0.beta8/devel/sage-main/sage/symbolic/function.pyx\", line 185:\n    sage: cot(complex(1,2))\nExpected:\n    (0.03279775553375259-0.9843292264581908j)\nGot:\n    (0.032797755533752596-0.9843292264581911j)\n**********************************************************************\n```",
    "created_at": "2012-03-13T12:44:48Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139500",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
On cicero (Linux i386):

```
sage -t  --long -force_lib devel/sage/sage/symbolic/function.pyx
Warning: divide by zero encountered in divide
**********************************************************************
File "/home/buildbot/build/sage/cicero-1/cicero_full/build/sage-5.0.beta8/devel/sage-main/sage/symbolic/function.pyx", line 185:
    sage: cot(complex(1,2))
Expected:
    (0.03279775553375259-0.9843292264581908j)
Got:
    (0.032797755533752596-0.9843292264581911j)
**********************************************************************
```



---

archive/issue_events_102351.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-05-25T03:11:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102351"
}
```



---

archive/issue_events_102352.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-05-25T03:11:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102352"
}
```



---

archive/issue_comments_139501.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,6 @@\n sage: timeit('exp(6.0r)')\n 625 loops, best of 3: 476 \u00b5s per loop\n ```\n-\n This also leads to possibly undesirable inconsistencies across different platforms: for example, ginac ends up calling the local libc tgammal to evaluate the gamma function, and even when this tgammal is evaluated by the same version of eglibc on two different platforms the answer varies depending on whether 80 bit doubles are available.\n \n To fix this, we make Sage check its types which correspond most closely to python type for the function that should be called, and use the functions for those types if available.\n@@ -15,7 +14,6 @@\n sage: timeit('exp(6.0r)')\n 625 loops, best of 3: 1.02 \u00b5s per loop\n ```\n-\n For the specific case of the gamma function, the is also a change here to make RDF use python's math.gamma(). It is more accurate than gsl. It is perhaps not as accurate as eglibc's gamma(), but it should give reliable results on different platforms.\n \n I think this will fix 3 of the 4 failing numerical accuracy doctests on ARM, though the test for binomial(.5r, 5) had to be weakened slightly.  (see http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c ) binomial() is currently not computed in a very good way, though, so it is reasonable to weaken this test temporarily. (see https://github.com/sagemath/sage/issues/12448 )\n@@ -26,6 +24,6 @@\n sage: timeit('math.exp(6.0r)')\n 625 loops, best of 3: 112 ns per loop\n ```\n+Apply:\n \n-Apply:\n-- [attachment:trac_12449_rebase_beta7.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase_beta7.patch)\n+* [attachment:trac12449.patch](https://github.com/sagemath/sage/files/ticket12449/trac12449.patch)\n``````\n",
    "created_at": "2012-05-25T03:11:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139501",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,6 @@
 sage: timeit('exp(6.0r)')
 625 loops, best of 3: 476 µs per loop
 ```
-
 This also leads to possibly undesirable inconsistencies across different platforms: for example, ginac ends up calling the local libc tgammal to evaluate the gamma function, and even when this tgammal is evaluated by the same version of eglibc on two different platforms the answer varies depending on whether 80 bit doubles are available.
 
 To fix this, we make Sage check its types which correspond most closely to python type for the function that should be called, and use the functions for those types if available.
@@ -15,7 +14,6 @@
 sage: timeit('exp(6.0r)')
 625 loops, best of 3: 1.02 µs per loop
 ```
-
 For the specific case of the gamma function, the is also a change here to make RDF use python's math.gamma(). It is more accurate than gsl. It is perhaps not as accurate as eglibc's gamma(), but it should give reliable results on different platforms.
 
 I think this will fix 3 of the 4 failing numerical accuracy doctests on ARM, though the test for binomial(.5r, 5) had to be weakened slightly.  (see http://groups.google.com/group/sage-devel/browse_thread/thread/3c8c61ea113ea60c ) binomial() is currently not computed in a very good way, though, so it is reasonable to weaken this test temporarily. (see https://github.com/sagemath/sage/issues/12448 )
@@ -26,6 +24,6 @@
 sage: timeit('math.exp(6.0r)')
 625 loops, best of 3: 112 ns per loop
 ```
+Apply:
 
-Apply:
-- [attachment:trac_12449_rebase_beta7.patch](https://github.com/sagemath/sage/files/ticket12449/trac_12449_rebase_beta7.patch)
+* [attachment:trac12449.patch](https://github.com/sagemath/sage/files/ticket12449/trac12449.patch)
``````




---

archive/issue_comments_139502.json:
```json
{
    "body": "<a id='comment:21'></a>\nOk, here is a version that should quiet those numerical errors. I'm leaving this as need review for the moment instead of putting it back to positive review in case someone wants to revisit the issue of whether or not we might want to make sure that we don't return different results on different machines.",
    "created_at": "2012-05-25T03:13:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139502",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:21'></a>
Ok, here is a version that should quiet those numerical errors. I'm leaving this as need review for the moment instead of putting it back to positive review in case someone wants to revisit the issue of whether or not we might want to make sure that we don't return different results on different machines.



---

archive/issue_comments_139503.json:
```json
{
    "body": "<a id='comment:22'></a>\nI think it's better to use `RR` (= `RealField(53)`) or `CC` (=`ComplexField(53)`) instead of `RDF` or `CDF`.  That should give more consistent results.",
    "created_at": "2012-05-25T05:07:52Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139503",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
I think it's better to use `RR` (= `RealField(53)`) or `CC` (=`ComplexField(53)`) instead of `RDF` or `CDF`.  That should give more consistent results.



---

archive/issue_comments_139504.json:
```json
{
    "body": "<a id='comment:23'></a>\nMissing \"-\":\n\n```\n            sage: abs(float(arccoth(2)) - 0.5493061443340548) < 1e16 \n```",
    "created_at": "2012-05-25T17:55:06Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139504",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:23'></a>
Missing "-":

```
            sage: abs(float(arccoth(2)) - 0.5493061443340548) < 1e16 
```



---

archive/issue_comments_139505.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [dsm](#comment%3A23):\n> Missing \"-\":\n> \n> ```\n>             sage: abs(float(arccoth(2)) - 0.5493061443340548) < 1e16 \n> ```\n\nOops. That is fixed, and the 16 is changed to a 15, since 16 is actually too large, I think. I also took the opportunity to write a better commit message. \n\nOf course, I'm still not sure if this is the right way to do things.",
    "created_at": "2012-05-27T21:27:30Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139505",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:24'></a>
Replying to [dsm](#comment%3A23):
> Missing "-":
> 
> ```
>             sage: abs(float(arccoth(2)) - 0.5493061443340548) < 1e16 
> ```

Oops. That is fixed, and the 16 is changed to a 15, since 16 is actually too large, I think. I also took the opportunity to write a better commit message. 

Of course, I'm still not sure if this is the right way to do things.



---

archive/issue_events_102353.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-05-31T22:28:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102353"
}
```



---

archive/issue_events_102354.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/bober",
    "created_at": "2012-05-31T22:28:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102354"
}
```



---

archive/attachments_017324.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac12449.patch",
    "asset_url": "tarball://root/attachments/ticket12449/trac12449.patch",
    "created_at": "2012-05-31T22:28:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12449/trac12449.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```



---

archive/issue_comments_139506.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Attachment:** [trac12449.patch](https://github.com/sagemath/sage/files/ticket12449/trac12449.patch)\n\nOk, after a brief discussion at SD 40.5 (after Jeroen went to sleep and wasn't there to complain) I'm restoring this to positive review. A few people seemed to agree that if a function is called on a machine floating point type then it is reasonable for it to give machine dependent answers.\n\nI hope that all the tests actually pass now. Also, I've twice updated the patch to remove trailing whitespace, so I hope that I actually got it all this time.\n\n(Of course, Jeroen will still have an opportunity to object...)",
    "created_at": "2012-05-31T22:28:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139506",
    "user": "https://trac.sagemath.org/admin/accounts/users/bober"
}
```

<a id='comment:25'></a>
**Attachment:** [trac12449.patch](https://github.com/sagemath/sage/files/ticket12449/trac12449.patch)

Ok, after a brief discussion at SD 40.5 (after Jeroen went to sleep and wasn't there to complain) I'm restoring this to positive review. A few people seemed to agree that if a function is called on a machine floating point type then it is reasonable for it to give machine dependent answers.

I hope that all the tests actually pass now. Also, I've twice updated the patch to remove trailing whitespace, so I hope that I actually got it all this time.

(Of course, Jeroen will still have an opportunity to object...)



---

archive/issue_events_102355.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-01T08:51:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102355"
}
```



---

archive/issue_events_102356.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-01T08:51:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102356"
}
```



---

archive/issue_comments_139507.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [bober](#comment%3A25):\n> A few people seemed to agree that if a function is called on a machine floating point type then it is reasonable for it to give machine dependent answers.\n\nObviously the following comment doesn't apply then:\n\n```\n# It is more accurate than gsl's gamma function and \n# should provide consistant results across platforms. \n```\n\nAlso: you should add tests for the infinity stuff that you added.",
    "created_at": "2012-06-01T08:51:44Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139507",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [bober](#comment%3A25):
> A few people seemed to agree that if a function is called on a machine floating point type then it is reasonable for it to give machine dependent answers.

Obviously the following comment doesn't apply then:

```
# It is more accurate than gsl's gamma function and 
# should provide consistant results across platforms. 
```

Also: you should add tests for the infinity stuff that you added.



---

archive/issue_comments_139508.json:
```json
{
    "body": "<a id='comment:27'></a>\n*** ping ***\n\nThe issues I mentioned in the last comment are fairly trivial.",
    "created_at": "2013-04-17T16:17:45Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139508",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
*** ping ***

The issues I mentioned in the last comment are fairly trivial.



---

archive/issue_events_102357.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102357"
}
```



---

archive/issue_events_102358.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102358"
}
```



---

archive/issue_events_102359.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102359"
}
```



---

archive/issue_events_102360.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102360"
}
```



---

archive/issue_events_102361.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102361"
}
```



---

archive/issue_events_102362.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102362"
}
```



---

archive/issue_events_102363.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102363"
}
```



---

archive/issue_events_102364.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102364"
}
```



---

archive/issue_comments_139509.json:
```json
{
    "body": "<a id='comment:33'></a>\nThe patch actually contains code that switches FP `sage_tgamma1` from GSL to `python_gamma` which might be a good thing, but requires a separate ticket. The timings are identical, so I suspect that the implementation might be too.",
    "created_at": "2015-02-02T15:05:06Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139509",
    "user": "https://github.com/rwst"
}
```

<a id='comment:33'></a>
The patch actually contains code that switches FP `sage_tgamma1` from GSL to `python_gamma` which might be a good thing, but requires a separate ticket. The timings are identical, so I suspect that the implementation might be too.



---

archive/issue_comments_139510.json:
```json
{
    "body": "<a id='comment:34'></a>\n`@`Jeroen: Is the patch still relevant after the changes you made to `BuiltinFunction.__call__`?",
    "created_at": "2015-02-02T15:57:40Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139510",
    "user": "https://github.com/rwst"
}
```

<a id='comment:34'></a>
`@`Jeroen: Is the patch still relevant after the changes you made to `BuiltinFunction.__call__`?



---

archive/issue_events_102365.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-02T15:58:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102365"
}
```



---

archive/issue_events_102366.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2015-02-02T15:58:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102366"
}
```



---

archive/issue_comments_139511.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [rws](#comment%3A34):\n> `@`Jeroen: Is the patch still relevant after the changes you made to `BuiltinFunction.__call__`?\n\nNo, this overlaps a lot with #17130.",
    "created_at": "2015-02-02T16:37:16Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139511",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>
Replying to [rws](#comment%3A34):
> `@`Jeroen: Is the patch still relevant after the changes you made to `BuiltinFunction.__call__`?

No, this overlaps a lot with #17130.



---

archive/issue_events_102367.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T07:45:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102367"
}
```



---

archive/issue_events_102368.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T07:45:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102368"
}
```



---

archive/issue_events_102369.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2018-03-16T07:45:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102369"
}
```



---

archive/issue_comments_139512.json:
```json
{
    "body": "<a id='comment:37'></a>\nThe original issue seems resolved:\n\n```\nsage: %timeit('exp(6.0r)')\n100000000 loops, best of 3: 7.31 ns per loop\nsage: %timeit('math.exp(6.0r)')\n100000000 loops, best of 3: 7.28 ns per loop\n```",
    "created_at": "2018-03-16T07:45:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12449#issuecomment-139512",
    "user": "https://github.com/rwst"
}
```

<a id='comment:37'></a>
The original issue seems resolved:

```
sage: %timeit('exp(6.0r)')
100000000 loops, best of 3: 7.31 ns per loop
sage: %timeit('math.exp(6.0r)')
100000000 loops, best of 3: 7.28 ns per loop
```



---

archive/issue_events_102370.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-14T17:43:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102370"
}
```



---

archive/issue_events_102371.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-14T17:43:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102371"
}
```



---

archive/issue_events_102372.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-14T17:43:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12449",
    "label": "worksforme",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12449#event-102372"
}
```
