# Issue 12510: Add consistency tests for __nonzero__ in TestSuite.

archive/issues_012338.json:
```json
{
    "body": "With many datastructure for elements, comparison to zero could be faster than\ncomparison of two elements. The pythonic way to do that is to use indirectly\n`e.__nonzero__()` for example in `if not e: ...`. However, to be able\nto use consistently this idiom, we have to make sure that the return value of\n`e == e.parent().zero()` agrees with `bool(e)`. The purpose of this\npatch is to add this tests to the standard test suite and to fixe the Sage\nlibrary according to this policy.\n\nOn the way, I discovered that for a some morphism of modules, pickling can be\nbroken if the zero morphism is asked. I also fixes this issue.\n\nSee also discussion on #12508. Finally, I left to #12526 the question of removing `__nonzero__` from element and writing tuned implantation for all data structures.\n\n\nAssignee: @hivert\n\nCC:  stumpc5 sage-combinat\n\nReviewer: Nathann Cohen\n\nAuthor: Florent Hivert\n\nMerged: sage-5.7.beta1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12510\n\n",
    "closed_at": "2013-01-26T09:53:19Z",
    "created_at": "2012-02-15T08:06:12Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.7",
    "title": "Add consistency tests for __nonzero__ in TestSuite.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12510",
    "user": "https://github.com/hivert"
}
```
With many datastructure for elements, comparison to zero could be faster than
comparison of two elements. The pythonic way to do that is to use indirectly
`e.__nonzero__()` for example in `if not e: ...`. However, to be able
to use consistently this idiom, we have to make sure that the return value of
`e == e.parent().zero()` agrees with `bool(e)`. The purpose of this
patch is to add this tests to the standard test suite and to fixe the Sage
library according to this policy.

On the way, I discovered that for a some morphism of modules, pickling can be
broken if the zero morphism is asked. I also fixes this issue.

See also discussion on #12508. Finally, I left to #12526 the question of removing `__nonzero__` from element and writing tuned implantation for all data structures.


Assignee: @hivert

CC:  stumpc5 sage-combinat

Reviewer: Nathann Cohen

Author: Florent Hivert

Merged: sage-5.7.beta1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12510





---

archive/issue_comments_145073.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-17T08:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145073",
    "user": "https://github.com/hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_145074.json:
```json
{
    "body": "Changing assignee from @nthiery to @hivert.",
    "created_at": "2012-02-17T09:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145074",
    "user": "https://github.com/hivert"
}
```

Changing assignee from @nthiery to @hivert.



---

archive/issue_comments_145075.json:
```json
{
    "body": "<a id='comment:5'></a>Helloooooooo !!\n\nWell, as far as I understand this code I think that it is good to go, except for this thing I just told you about : the new content of `QuotientRingElement.__nonzero__` creates this problem\n\n```\nsage: a = e.lift()\nsage: any([e])\nTrue\nsage: b = e.lift()\n# Now b and a are not necessarily equal anymore\n```\n\nIf you think that this is not a problem after all, then you can set this ticket to `positive_review`.\n\nHave fuuuuuuuuuuuuuuuuuuuuuuuunnn !!\n\nNathann",
    "created_at": "2013-01-21T17:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145075",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:5'></a>Helloooooooo !!

Well, as far as I understand this code I think that it is good to go, except for this thing I just told you about : the new content of `QuotientRingElement.__nonzero__` creates this problem

```
sage: a = e.lift()
sage: any([e])
True
sage: b = e.lift()
# Now b and a are not necessarily equal anymore
```

If you think that this is not a problem after all, then you can set this ticket to `positive_review`.

Have fuuuuuuuuuuuuuuuuuuuuuuuunnn !!

Nathann



---

archive/issue_comments_145076.json:
```json
{
    "body": "<a id='comment:6'></a>The returned result was wrong so I switched back to raising not implemented. I created #13999 to have the problem fixed. Please review,\n\nFlorent",
    "created_at": "2013-01-24T11:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145076",
    "user": "https://github.com/hivert"
}
```

<a id='comment:6'></a>The returned result was wrong so I switched back to raising not implemented. I created #13999 to have the problem fixed. Please review,

Florent



---

archive/issue_comments_145077.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-01-24T12:03:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145077",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_145078.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-01-24T12:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145078",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_145079.json:
```json
{
    "body": "<a id='comment:8'></a>Attachment [trac_12510-nonzero_equal_consistency-fh.patch](tarball://root/attachments/some-uuid/ticket12510/trac_12510-nonzero_equal_consistency-fh.patch) by @nathanncohen created at 2013-01-24 12:33:18\n\nGooooooooooooooooooooooood to go !!!\n\nLe jury appr\u00e9cie : la qualit\u00e9 des workarounds `:-D`\n\nNathnan",
    "created_at": "2013-01-24T12:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145079",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:8'></a>Attachment [trac_12510-nonzero_equal_consistency-fh.patch](tarball://root/attachments/some-uuid/ticket12510/trac_12510-nonzero_equal_consistency-fh.patch) by @nathanncohen created at 2013-01-24 12:33:18

Gooooooooooooooooooooooood to go !!!

Le jury apprécie : la qualité des workarounds `:-D`

Nathnan



---

archive/issue_comments_145080.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks Nathan !!!",
    "created_at": "2013-01-24T12:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145080",
    "user": "https://github.com/hivert"
}
```

<a id='comment:9'></a>Thanks Nathan !!!



---

archive/issue_comments_145081.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-01-26T09:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12510#issuecomment-145081",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_033702.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-26T09:53:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12510",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12510#event-33702"
}
```
