# Issue 12118: Fix parallel building of libgpg_error

archive/issues_011946.json:
```json
{
    "body": "The build of `libgpg_error` can fail due to a race condition.  This has been seen on Mac OS X and Linux.\n\nThe attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)\n\n**Assignee:** @jdemeyer\n\n**CC:**  @jdemeyer georgsweber\n\n**Resolution:** fixed\n\n**Author:** Jeroen Demeyer, Justin Walker\n\n**Reviewer:** Justin Walker\n\n**Upstream:** None of the above - read trac for reasoning.\n\n**Merged:** sage-4.8.alpha5\n\nIssue created by migration from https://trac.sagemath.org/ticket/12118\n\n",
    "closed_at": "2011-12-17T09:10:49Z",
    "created_at": "2011-12-04T22:03:12Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.8",
    "title": "Fix parallel building of libgpg_error",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12118",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```
The build of `libgpg_error` can fail due to a race condition.  This has been seen on Mac OS X and Linux.

The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)

**Assignee:** @jdemeyer

**CC:**  @jdemeyer georgsweber

**Resolution:** fixed

**Author:** Jeroen Demeyer, Justin Walker

**Reviewer:** Justin Walker

**Upstream:** None of the above - read trac for reasoning.

**Merged:** sage-4.8.alpha5

Issue created by migration from https://trac.sagemath.org/ticket/12118





---

archive/issue_comments_174245.json:
```json
{
    "body": "Attachment [libgpg_error-1.6.p3.log](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p3.log) by justin created at 2011-12-04 22:04:10\n\nBuild log from a \"-j24\" build of libgpg_error-1.6.p3",
    "created_at": "2011-12-04T22:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174245",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

Attachment [libgpg_error-1.6.p3.log](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p3.log) by justin created at 2011-12-04 22:04:10

Build log from a "-j24" build of libgpg_error-1.6.p3



---

archive/issue_comments_174246.json:
```json
{
    "body": "Updated spkg",
    "created_at": "2011-12-05T01:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174246",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

Updated spkg



---

archive/issue_comments_174247.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [libgpg_error-1.6.p4.spkg](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p4.spkg) by justin created at 2011-12-05 01:41:51\n\nNot sure what I was smoking, but a second look found undecorated (non-macro) mkdir's in src/Makefile.  I added a leading \"-\" to these, and the build succeeded (as did a subsequent \"ptestlong\").",
    "created_at": "2011-12-05T01:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174247",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:2'></a>
Attachment [libgpg_error-1.6.p4.spkg](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p4.spkg) by justin created at 2011-12-05 01:41:51

Not sure what I was smoking, but a second look found undecorated (non-macro) mkdir's in src/Makefile.  I added a leading "-" to these, and the build succeeded (as did a subsequent "ptestlong").



---

archive/issue_comments_174248.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2011-12-05T01:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174248",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_174249.json:
```json
{
    "body": "<a id='comment:3'></a>\nI should add that the build used \"make -j24\".",
    "created_at": "2011-12-05T04:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174249",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:3'></a>
I should add that the build used "make -j24".



---

archive/issue_comments_174250.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis should be reported upstream.",
    "created_at": "2011-12-05T09:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174250",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
This should be reported upstream.



---

archive/issue_comments_174251.json:
```json
{
    "body": "**Changing author** from \"justin\" to \"Justin Walker\".",
    "created_at": "2011-12-05T09:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174251",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "justin" to "Justin Walker".



---

archive/issue_events_037922.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12118#event-37922"
}
```



---

archive/issue_comments_174252.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,6 +4,4 @@\n \n His comment on the list that \"hyperthreading\" may be the problem, I think, is not the case.  For me, the build fails on a dual 6-core Xeon Mac Pro for \"-j24\", \"-h12\", and \"-j8\".  It succeeds with \"-j4\".\n \n-It appears that the directories are made in a shell file, rather than a Makefile.  If so, the usual \"-mkdir\" Makefile trick won't work.  However, at least on Mac OS X, using \"mkdir -p\" will ignore failures because the directory exists.\n-\n-Is this portable across all the systems we support?  The man page implies that it is.\n+I found an undecorated (non-macro) mkdir's in src/Makefile. I added a leading \"-\" to these, and the build succeeded (as did a subsequent \"ptestlong\").\n``````\n",
    "created_at": "2011-12-05T09:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174252",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,6 +4,4 @@
 
 His comment on the list that "hyperthreading" may be the problem, I think, is not the case.  For me, the build fails on a dual 6-core Xeon Mac Pro for "-j24", "-h12", and "-j8".  It succeeds with "-j4".
 
-It appears that the directories are made in a shell file, rather than a Makefile.  If so, the usual "-mkdir" Makefile trick won't work.  However, at least on Mac OS X, using "mkdir -p" will ignore failures because the directory exists.
-
-Is this portable across all the systems we support?  The man page implies that it is.
+I found an undecorated (non-macro) mkdir's in src/Makefile. I added a leading "-" to these, and the build succeeded (as did a subsequent "ptestlong").
``````




---

archive/issue_events_037923.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "rename": {
        "from": "Parallel build of Sage is broken",
        "to": "Parallel build of libgpg_error is broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12118#event-37923"
}
```



---

archive/issue_comments_174253.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. Little or no feedback.\".",
    "created_at": "2011-12-13T17:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174253",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing upstream** from "N/A" to "Reported upstream. Little or no feedback.".



---

archive/issue_comments_174254.json:
```json
{
    "body": "<a id='comment:5'></a>\nReported upstream (to the libgpg mailing list).  No reply to me yet.",
    "created_at": "2011-12-13T17:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174254",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:5'></a>
Reported upstream (to the libgpg mailing list).  No reply to me yet.



---

archive/issue_comments_174255.json:
```json
{
    "body": "Updated .spkg",
    "created_at": "2011-12-14T04:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174255",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

Updated .spkg



---

archive/issue_comments_174256.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [libgpg_error-1.6.p4.2.spkg](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p4.2.spkg) by justin created at 2011-12-14 04:15:59\n\nUpdates:\n\nFirst, a new spkg with the correct directory name.  This replaces the previous .spkg.\n\nSecond, after checking on the upstream website, I saw that my email had not yet appeared.  I bit the bullet and joined up and resent my email today.  The email made it to the archives; we'll see what happens.",
    "created_at": "2011-12-14T04:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174256",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:6'></a>
Attachment [libgpg_error-1.6.p4.2.spkg](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p4.2.spkg) by justin created at 2011-12-14 04:15:59

Updates:

First, a new spkg with the correct directory name.  This replaces the previous .spkg.

Second, after checking on the upstream website, I saw that my email had not yet appeared.  I bit the bullet and joined up and resent my email today.  The email made it to the archives; we'll see what happens.



---

archive/issue_comments_174257.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n His comment on the list that \"hyperthreading\" may be the problem, I think, is not the case.  For me, the build fails on a dual 6-core Xeon Mac Pro for \"-j24\", \"-h12\", and \"-j8\".  It succeeds with \"-j4\".\n \n-I found an undecorated (non-macro) mkdir's in src/Makefile. I added a leading \"-\" to these, and the build succeeded (as did a subsequent \"ptestlong\").\n+I found undecorated (non-macro) mkdir's in src/Makefile. I added a leading \"-\" to each of these, and the build succeeded (as did a subsequent \"ptestlong\").\n``````\n",
    "created_at": "2011-12-14T04:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174257",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 His comment on the list that "hyperthreading" may be the problem, I think, is not the case.  For me, the build fails on a dual 6-core Xeon Mac Pro for "-j24", "-h12", and "-j8".  It succeeds with "-j4".
 
-I found an undecorated (non-macro) mkdir's in src/Makefile. I added a leading "-" to these, and the build succeeded (as did a subsequent "ptestlong").
+I found undecorated (non-macro) mkdir's in src/Makefile. I added a leading "-" to each of these, and the build succeeded (as did a subsequent "ptestlong").
``````




---

archive/issue_comments_174258.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-12-14T21:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174258",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_174259.json:
```json
{
    "body": "**Changing upstream** from \"Reported upstream. Little or no feedback.\" to \"None of the above - read trac for reasoning.\".",
    "created_at": "2011-12-14T21:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174259",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing upstream** from "Reported upstream. Little or no feedback." to "None of the above - read trac for reasoning.".



---

archive/issue_comments_174260.json:
```json
{
    "body": "<a id='comment:8'></a>\nI changed this to \"needs work\" since it, well, needs work.  Not quite sure why it worked in the past, but it doesn't do the job now.\n\nAlso, a response from upstream: \"The current version is 1.1.0.  Please test again with that one.\"  I don't understand the numbering scheme, but I'll fool around with \"the current version\".  Anyone know why this would be A Bad Idea?",
    "created_at": "2011-12-14T21:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174260",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:8'></a>
I changed this to "needs work" since it, well, needs work.  Not quite sure why it worked in the past, but it doesn't do the job now.

Also, a response from upstream: "The current version is 1.1.0.  Please test again with that one."  I don't understand the numbering scheme, but I'll fool around with "the current version".  Anyone know why this would be A Bad Idea?



---

archive/issue_comments_174261.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [justin](#comment%3A8):\n> I changed this to \"needs work\" since it, well, needs work.  Not quite sure why it worked in the past, but it doesn't do the job now.\n\nPlease explain.  What is the problem?",
    "created_at": "2011-12-16T08:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174261",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
Replying to [justin](#comment%3A8):
> I changed this to "needs work" since it, well, needs work.  Not quite sure why it worked in the past, but it doesn't do the job now.

Please explain.  What is the problem?



---

archive/issue_comments_174262.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,3 @@\n-Beginning with the first 4.8 alpha, the build will fail if the build system is sufficiently fast, and perhaps, with sufficiently many cores available.\n+On OS X, the build of `libgpg_error` will fail due to a race condition.\n \n-The attached log file (from a 4.8.a3 build) shows that the spkg libgpg_error-1.6.p3 blows up because it tries to make a directory that already exists.  Georg Weber (gsw') seems to have an explanation: while the Makefile does check to see that the file exists, if the build is sufficiently parallel, two checks can occur at the same time, see no directory, and then both try to make the directory.  Only one can succeed.\n-\n-His comment on the list that \"hyperthreading\" may be the problem, I think, is not the case.  For me, the build fails on a dual 6-core Xeon Mac Pro for \"-j24\", \"-h12\", and \"-j8\".  It succeeds with \"-j4\".\n-\n-I found undecorated (non-macro) mkdir's in src/Makefile. I added a leading \"-\" to each of these, and the build succeeded (as did a subsequent \"ptestlong\").\n+The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n``````\n",
    "created_at": "2011-12-16T12:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174262",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,3 @@
-Beginning with the first 4.8 alpha, the build will fail if the build system is sufficiently fast, and perhaps, with sufficiently many cores available.
+On OS X, the build of `libgpg_error` will fail due to a race condition.
 
-The attached log file (from a 4.8.a3 build) shows that the spkg libgpg_error-1.6.p3 blows up because it tries to make a directory that already exists.  Georg Weber (gsw') seems to have an explanation: while the Makefile does check to see that the file exists, if the build is sufficiently parallel, two checks can occur at the same time, see no directory, and then both try to make the directory.  Only one can succeed.
-
-His comment on the list that "hyperthreading" may be the problem, I think, is not the case.  For me, the build fails on a dual 6-core Xeon Mac Pro for "-j24", "-h12", and "-j8".  It succeeds with "-j4".
-
-I found undecorated (non-macro) mkdir's in src/Makefile. I added a leading "-" to each of these, and the build succeeded (as did a subsequent "ptestlong").
+The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.
``````




---

archive/issue_comments_174263.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-12-16T12:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174263",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_174264.json:
```json
{
    "body": "**Changing author** from \"Justin Walker\" to \"Jeroen Demeyer, Justin Walker\".",
    "created_at": "2011-12-16T12:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174264",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Justin Walker" to "Jeroen Demeyer, Justin Walker".



---

archive/issue_comments_174265.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n On OS X, the build of `libgpg_error` will fail due to a race condition.\n \n The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n+\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)\n``````\n",
    "created_at": "2011-12-16T12:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174265",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 On OS X, the build of `libgpg_error` will fail due to a race condition.
 
 The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.
+
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)
``````




---

archive/issue_events_037924.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "rename": {
        "from": "Parallel build of libgpg_error is broken",
        "to": "Fix parallel building of libgpg_error"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12118#event-37924"
}
```



---

archive/issue_comments_174266.json:
```json
{
    "body": "Diff for the spkg, for review only",
    "created_at": "2011-12-16T13:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174266",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the spkg, for review only



---

archive/issue_comments_174267.json:
```json
{
    "body": "<a id='comment:13'></a>\nAttachment [libgpg_error-1.6.p4-p5.diff](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p4-p5.diff) by @jdemeyer created at 2011-12-16 13:32:49",
    "created_at": "2011-12-16T13:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174267",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Attachment [libgpg_error-1.6.p4-p5.diff](tarball://root/attachments/some-uuid/ticket12118/libgpg_error-1.6.p4-p5.diff) by @jdemeyer created at 2011-12-16 13:32:49



---

archive/issue_comments_174268.json:
```json
{
    "body": "<a id='comment:14'></a>\nApplied patch to the .p4 version from #12131.  The build broke, as usual (-j24) on libgpg-error.  More to come, after I look at the log file some more.",
    "created_at": "2011-12-16T18:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174268",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:14'></a>
Applied patch to the .p4 version from #12131.  The build broke, as usual (-j24) on libgpg-error.  More to come, after I look at the log file some more.



---

archive/issue_comments_174269.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-12-16T18:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174269",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_174270.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [justin](#comment%3A14):\n> Applied patch to the .p4 version from #12131.  The build broke, as usual (-j24) on libgpg-error.  More to come, after I look at the log file some more.\n\nI am certain that my patch did fix *some bug*.  So there must be more than one bug then...\n\nCan you post the log?",
    "created_at": "2011-12-16T19:51:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174270",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [justin](#comment%3A14):
> Applied patch to the .p4 version from #12131.  The build broke, as usual (-j24) on libgpg-error.  More to come, after I look at the log file some more.

I am certain that my patch did fix *some bug*.  So there must be more than one bug then...

Can you post the log?



---

archive/issue_comments_174271.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On OS X, the build of `libgpg_error` will fail due to a race condition.\n+On sufficiently fast systems with multiple cores/threads, the build of `libgpg_error` will fail due to a race condition.  This has been seen on Mac OS X and Linux.\n \n The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n \n``````\n",
    "created_at": "2011-12-16T20:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174271",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On OS X, the build of `libgpg_error` will fail due to a race condition.
+On sufficiently fast systems with multiple cores/threads, the build of `libgpg_error` will fail due to a race condition.  This has been seen on Mac OS X and Linux.
 
 The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.
 
``````




---

archive/issue_comments_174272.json:
```json
{
    "body": "**Changing assignee** from GeorgSWeber to @jdemeyer.",
    "created_at": "2011-12-16T20:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174272",
    "user": "https://github.com/jdemeyer"
}
```

**Changing assignee** from GeorgSWeber to @jdemeyer.



---

archive/issue_comments_174273.json:
```json
{
    "body": "<a id='comment:17'></a>\nI have not been able to reproduce this on Linux, logs please.",
    "created_at": "2011-12-16T20:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174273",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
I have not been able to reproduce this on Linux, logs please.



---

archive/issue_comments_174274.json:
```json
{
    "body": "<a id='comment:18'></a>\nI've asked Georg to verify this; he joined the discussion at some point, saying that he had observed this on his system (can't find the mail; I think he mentioned a linux derivative).",
    "created_at": "2011-12-16T20:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174274",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:18'></a>
I've asked Georg to verify this; he joined the discussion at some point, saying that he had observed this on his system (can't find the mail; I think he mentioned a linux derivative).



---

archive/issue_comments_174275.json:
```json
{
    "body": "<a id='comment:19'></a>\nPlease try again, I forget to make the patched `install-sh` executable.",
    "created_at": "2011-12-16T20:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174275",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Please try again, I forget to make the patched `install-sh` executable.



---

archive/issue_comments_174276.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-12-16T20:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174276",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_174277.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-On sufficiently fast systems with multiple cores/threads, the build of `libgpg_error` will fail due to a race condition.  This has been seen on Mac OS X and Linux.\n+The build of `libgpg_error` can fail due to a race condition.  This has been seen on Mac OS X and Linux.\n \n The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n \n``````\n",
    "created_at": "2011-12-16T20:59:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174277",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-On sufficiently fast systems with multiple cores/threads, the build of `libgpg_error` will fail due to a race condition.  This has been seen on Mac OS X and Linux.
+The build of `libgpg_error` can fail due to a race condition.  This has been seen on Mac OS X and Linux.
 
 The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.
 
``````




---

archive/issue_comments_174278.json:
```json
{
    "body": "<a id='comment:21'></a>\nGrumble...I took the p5 .spkg, enabled 'x' mode for install-sh, re-tarred, copied it into a fresh 4.8-a4 tree.  The build still blows up, and install-sh is no longer executable.  Is this something that has to be done in \"spkg-install\"?\n\nNote: I've verified that the tarball in spkg/standard has an executable \"install-sh\", but the one in spkg/build does not.",
    "created_at": "2011-12-16T21:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174278",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:21'></a>
Grumble...I took the p5 .spkg, enabled 'x' mode for install-sh, re-tarred, copied it into a fresh 4.8-a4 tree.  The build still blows up, and install-sh is no longer executable.  Is this something that has to be done in "spkg-install"?

Note: I've verified that the tarball in spkg/standard has an executable "install-sh", but the one in spkg/build does not.



---

archive/issue_comments_174279.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2011-12-16T21:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174279",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_174280.json:
```json
{
    "body": "<a id='comment:22'></a>\nFirst, be sure to double-check that you really have the newly updated spkg.\n\nCould you please go into the `build` directory and do\n\n```\nls -l . src patches\n```\n\nNext, what happens if you untar the tarball by hand and then do\n\n```\nls -l . src patches\n```",
    "created_at": "2011-12-16T21:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174280",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
First, be sure to double-check that you really have the newly updated spkg.

Could you please go into the `build` directory and do

```
ls -l . src patches
```

Next, what happens if you untar the tarball by hand and then do

```
ls -l . src patches
```



---

archive/issue_comments_174281.json:
```json
{
    "body": "<a id='comment:23'></a>\nAh...light dawns...new knowledge awaits in the new day.\n\nSo: 'patches/install-sh' was *not* executable.  Making it so caused the build to continue chugging past the libgpg-error spkg.  It continues to chug.\n\nThanks for the pointers, Jeroen.",
    "created_at": "2011-12-16T21:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174281",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:23'></a>
Ah...light dawns...new knowledge awaits in the new day.

So: 'patches/install-sh' was *not* executable.  Making it so caused the build to continue chugging past the libgpg-error spkg.  It continues to chug.

Thanks for the pointers, Jeroen.



---

archive/issue_comments_174282.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2011-12-16T21:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174282",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_174283.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n \n-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg)\n``````\n",
    "created_at": "2011-12-16T22:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174283",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.
 
-**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg)
``````




---

archive/issue_comments_174284.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2011-12-16T23:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174284",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_174285.json:
```json
{
    "body": "<a id='comment:25'></a>\nI'll give this a positive review.  It clearly works, and since we (Jeroen) just pulled in a new install-sh from upstream, we rely on them (once it seems to work).",
    "created_at": "2011-12-16T23:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174285",
    "user": "https://trac.sagemath.org/admin/accounts/users/justin"
}
```

<a id='comment:25'></a>
I'll give this a positive review.  It clearly works, and since we (Jeroen) just pulled in a new install-sh from upstream, we rely on them (once it seems to work).



---

archive/issue_comments_174286.json:
```json
{
    "body": "**Reviewer:** Justin Walker",
    "created_at": "2011-12-17T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174286",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Justin Walker



---

archive/issue_comments_174287.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.\n \n-**spkg**: [http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg)\n+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)\n``````\n",
    "created_at": "2011-12-17T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174287",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 The attached log file (from a sage-4.8.alpha3 build) shows that the spkg `libgpg_error-1.6.p3` blows up because it tries to make a directory that already exists.  The problem seems to be a broken `install-sh` script.
 
-**spkg**: [http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/justin/spkg/libgpg_error-1.6.p5.spkg)
+**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/libgpg_error-1.6.p5.spkg)
``````




---

archive/issue_comments_174288.json:
```json
{
    "body": "<a id='comment:26'></a>\nWhy did you change the spkg link?  Mine also has an executable `patches/install-sh`, yours has uncommitted changes.  Changing back to mine.",
    "created_at": "2011-12-17T09:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174288",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Why did you change the spkg link?  Mine also has an executable `patches/install-sh`, yours has uncommitted changes.  Changing back to mine.



---

archive/issue_comments_174289.json:
```json
{
    "body": "**Merged:** sage-4.8.alpha5",
    "created_at": "2011-12-17T09:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174289",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-4.8.alpha5



---

archive/issue_comments_174290.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2011-12-17T09:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12118#issuecomment-174290",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_events_037925.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-12-17T09:10:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12118",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12118#event-37925"
}
```
