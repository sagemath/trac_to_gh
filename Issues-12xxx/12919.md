# Issue 12919: Typo in Parent.discover_coerce_map_from

archive/issues_012747.json:
```json
{
    "body": "This patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.\n\nIf someone wants to play further, here is the kind of thing I (unsuccessfully) tried:\n\n```\nclass P(Parent):\n    def __init__(self):\n        Parent.__init__(self, category=Sets())\n    Element=ElementWrapper\nA = P(); a = A(\"a\")\nB = P(); b = A(\"b\")\nC = P(); c = A(\"c\")\nD = P(); d = A(\"d\")\nHom(A,B)(lambda x: b).register_as_coercion()\nHom(B,C)(lambda x: c).register_as_coercion()\nHom(C,D)(lambda x: d).register_as_coercion()\nHom(D,A)(lambda x: a).register_as_coercion()\n```\n\nBut I guess this patch is obvious enough to could go as is\n\n**Assignee:** @robertwb\n\n**CC:**  sage-combinat @mguaypaq\n\n**Keywords:** days38\n\n**Reviewer:** Andr\u00e9 Apitzsch\n\n**Author:** Nicolas M. Thi\u00e9ry, Mathieu Guay-Paquet\n\n**Merged:** sage-5.1.beta1\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12919\n\n",
    "closed_at": "2012-05-23T21:37:02Z",
    "created_at": "2012-05-07T16:44:11Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Typo in Parent.discover_coerce_map_from",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12919",
    "user": "https://github.com/nthiery"
}
```
This patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.

If someone wants to play further, here is the kind of thing I (unsuccessfully) tried:

```
class P(Parent):
    def __init__(self):
        Parent.__init__(self, category=Sets())
    Element=ElementWrapper
A = P(); a = A("a")
B = P(); b = A("b")
C = P(); c = A("c")
D = P(); d = A("d")
Hom(A,B)(lambda x: b).register_as_coercion()
Hom(B,C)(lambda x: c).register_as_coercion()
Hom(C,D)(lambda x: d).register_as_coercion()
Hom(D,A)(lambda x: a).register_as_coercion()
```

But I guess this patch is obvious enough to could go as is

**Assignee:** @robertwb

**CC:**  sage-combinat @mguaypaq

**Keywords:** days38

**Reviewer:** André Apitzsch

**Author:** Nicolas M. Thiéry, Mathieu Guay-Paquet

**Merged:** sage-5.1.beta1

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/12919





---

archive/issue_comments_194627.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-05-07T18:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194627",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_194628.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"days38\".",
    "created_at": "2012-05-07T18:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194628",
    "user": "https://github.com/nthiery"
}
```

**Changing keywords** from "" to "days38".



---

archive/issue_comments_194629.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.\n \n-If someone wants to play further, here is the kind of thing I tried:\n+If someone wants to play further, here is the kind of thing I (unsuccessfully) tried:\n \n ```\n class P(Parent):\n@@ -17,4 +17,4 @@\n Hom(D,A)(lambda x: a).register_as_coercion()\n ```\n \n-But I guess it could go as is\n+But I guess this patch is obvious enough to could go as is\n``````\n",
    "created_at": "2012-05-07T18:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194629",
    "user": "https://github.com/nthiery"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This patch fixes an obvious typo in discover_action. Alas, it's in a seldom used branch, and I could not extract a suitable regression test (I stumbled on the issue with a large coercion graph using quite some experimental code). And even then, the regression would not necessarily robustly catch the broken branch.
 
-If someone wants to play further, here is the kind of thing I tried:
+If someone wants to play further, here is the kind of thing I (unsuccessfully) tried:
 
 ```
 class P(Parent):
@@ -17,4 +17,4 @@
 Hom(D,A)(lambda x: a).register_as_coercion()
 ```
 
-But I guess it could go as is
+But I guess this patch is obvious enough to could go as is
``````




---

archive/issue_comments_194630.json:
```json
{
    "body": "<a id='comment:3'></a>\nTypo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.",
    "created_at": "2012-05-07T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194630",
    "user": "https://github.com/a-andre"
}
```

<a id='comment:3'></a>
Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.



---

archive/issue_comments_194631.json:
```json
{
    "body": "**Work_Issues:** commit message",
    "created_at": "2012-05-07T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194631",
    "user": "https://github.com/a-andre"
}
```

**Work_Issues:** commit message



---

archive/issue_events_041230.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "rename": {
        "from": "Typo in Parent.discover_action",
        "to": "Typo in Parent.discover_coerce_map_from"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12919#event-41230"
}
```



---

archive/issue_comments_194632.json:
```json
{
    "body": "**Reviewer:** Andr\u00e9 Apitzsch",
    "created_at": "2012-05-07T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194632",
    "user": "https://github.com/a-andre"
}
```

**Reviewer:** André Apitzsch



---

archive/issue_comments_194633.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-05-07T21:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194633",
    "user": "https://github.com/a-andre"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_194634.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [aapitzsch](#comment%3A3):\n> Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.\n\n\nGood catch, thanks :-)",
    "created_at": "2012-05-07T23:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194634",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:4'></a>
Replying to [aapitzsch](#comment%3A3):
> Typo is in `Parent.discover_coerce_map_from` and not in `Parent.discover_action` as your commit message says.


Good catch, thanks :-)



---

archive/issue_comments_194635.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-05-07T23:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194635",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_194636.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-08T07:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194636",
    "user": "https://github.com/robertwb"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_194637.json:
```json
{
    "body": "**Changing work_issues** from \"commit message\" to \"\".",
    "created_at": "2012-05-08T08:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194637",
    "user": "https://github.com/a-andre"
}
```

**Changing work_issues** from "commit message" to "".



---

archive/issue_comments_194638.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks!",
    "created_at": "2012-05-08T13:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194638",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:8'></a>
Thanks!



---

archive/issue_comments_194639.json:
```json
{
    "body": "<a id='comment:9'></a>\nHere is a minimal example which illustrates the problem:\n\n```\nsage: class P(Parent):\n....:\u00a0\u00a0\u00a0\u00a0 def __init__(self):\n....:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Parent.__init__(self, category=Sets())\n....:\u00a0\u00a0\u00a0\u00a0 Element=ElementWrapper\n....:\u00a0\u00a0\u00a0\u00a0 \nsage: A = P(); a = A('a')\nsage: B = P(); b = B('b')\nsage: C = P(); c = C('c')\nsage: D = P(); d = D('d')\nsage: Hom(A, B)(lambda x: b).register_as_coercion()\nsage: Hom(B, A)(lambda x: a).register_as_coercion()\nsage: Hom(C, B)(lambda x: b).register_as_coercion()\nsage: Hom(D, C)(lambda x: c).register_as_coercion()\nsage: A(d)\n---------------------------------------------------------------------------\nUnboundLocalError\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Traceback (most recent call last)\n\n/home/mguaypaq/<ipython console> in <module>()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7906)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.convert_map_from (sage/structure/parent.c:15248)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_convert_map_from (sage/structure/parent.c:15399)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14958)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()\n\n/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14966)()\n\nUnboundLocalError: local variable 'connecting' referenced before assignment\n```\nWith the patch, the output is now (as it should be):\n\n```\nsage: class P(Parent):\n....:     def __init__(self):\n....:         Parent.__init__(self, category=Sets())\n....:     Element=ElementWrapper\n....:     \nsage: A = P(); a = A('a')\nsage: B = P(); b = B('b')\nsage: C = P(); c = C('c')\nsage: D = P(); d = D('d')\nsage: Hom(A, B)(lambda x: b).register_as_coercion()\nsage: Hom(B, A)(lambda x: a).register_as_coercion()\nsage: Hom(C, B)(lambda x: b).register_as_coercion()\nsage: Hom(D, C)(lambda x: c).register_as_coercion()\nsage: A(d)\n'a'\n```\nThis could be added as a doctest to detect the problem, but maybe it's not necessary for such a clear typo. I would also note that [this comment](http://trac.sagemath.org/sage_trac/ticket/7420#comment:3) from #7420 points out a cleaner way to fix the problem, but this patch is fine too.",
    "created_at": "2012-05-15T17:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194639",
    "user": "https://github.com/mguaypaq"
}
```

<a id='comment:9'></a>
Here is a minimal example which illustrates the problem:

```
sage: class P(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, category=Sets())
....:     Element=ElementWrapper
....:     
sage: A = P(); a = A('a')
sage: B = P(); b = B('b')
sage: C = P(); c = C('c')
sage: D = P(); d = D('d')
sage: Hom(A, B)(lambda x: b).register_as_coercion()
sage: Hom(B, A)(lambda x: a).register_as_coercion()
sage: Hom(C, B)(lambda x: b).register_as_coercion()
sage: Hom(D, C)(lambda x: c).register_as_coercion()
sage: A(d)
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)

/home/mguaypaq/<ipython console> in <module>()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7906)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.convert_map_from (sage/structure/parent.c:15248)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_convert_map_from (sage/structure/parent.c:15399)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14958)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:14021)()

/opt/sage-5.0.rc0/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:14966)()

UnboundLocalError: local variable 'connecting' referenced before assignment
```
With the patch, the output is now (as it should be):

```
sage: class P(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, category=Sets())
....:     Element=ElementWrapper
....:     
sage: A = P(); a = A('a')
sage: B = P(); b = B('b')
sage: C = P(); c = C('c')
sage: D = P(); d = D('d')
sage: Hom(A, B)(lambda x: b).register_as_coercion()
sage: Hom(B, A)(lambda x: a).register_as_coercion()
sage: Hom(C, B)(lambda x: b).register_as_coercion()
sage: Hom(D, C)(lambda x: c).register_as_coercion()
sage: A(d)
'a'
```
This could be added as a doctest to detect the problem, but maybe it's not necessary for such a clear typo. I would also note that [this comment](http://trac.sagemath.org/sage_trac/ticket/7420#comment:3) from #7420 points out a cleaner way to fix the problem, but this patch is fine too.



---

archive/issue_comments_194640.json:
```json
{
    "body": "**Changing author** from \"Nicolas M. Thi\u00e9ry\" to \"Nicolas M. Thi\u00e9ry, Mathieu Guay-Paquet\".",
    "created_at": "2012-05-17T04:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194640",
    "user": "https://github.com/nthiery"
}
```

**Changing author** from "Nicolas M. Thiéry" to "Nicolas M. Thiéry, Mathieu Guay-Paquet".



---

archive/issue_comments_194641.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2012-05-17T04:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194641",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_194642.json:
```json
{
    "body": "<a id='comment:11'></a>\nExcellent, thanks for the doctest! I confirm it catches the issue on my machine. I'll upload shortly an updated patch, and set the ticket back to needs review. Please double check, and set back to positive review.",
    "created_at": "2012-05-17T04:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194642",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:11'></a>
Excellent, thanks for the doctest! I confirm it catches the issue on my machine. I'll upload shortly an updated patch, and set the ticket back to needs review. Please double check, and set back to positive review.



---

archive/issue_comments_194643.json:
```json
{
    "body": "Attachment [trac_12919_coercion_typo_parent-nt.patch](tarball://root/attachments/some-uuid/ticket12919/trac_12919_coercion_typo_parent-nt.patch) by @nthiery created at 2012-05-17 04:09:33",
    "created_at": "2012-05-17T04:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194643",
    "user": "https://github.com/nthiery"
}
```

Attachment [trac_12919_coercion_typo_parent-nt.patch](tarball://root/attachments/some-uuid/ticket12919/trac_12919_coercion_typo_parent-nt.patch) by @nthiery created at 2012-05-17 04:09:33



---

archive/issue_comments_194644.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-05-17T04:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194644",
    "user": "https://github.com/nthiery"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_194645.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-05-17T09:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194645",
    "user": "https://github.com/a-andre"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_194646.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [aapitzsch](#comment%3A13):\n> positive review\n\n\nThanks!",
    "created_at": "2012-05-19T04:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194646",
    "user": "https://github.com/nthiery"
}
```

<a id='comment:14'></a>
Replying to [aapitzsch](#comment%3A13):
> positive review


Thanks!



---

archive/issue_comments_194647.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-05-23T21:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194647",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_events_041231.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-23T21:37:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12919#event-41231"
}
```



---

archive/issue_comments_194648.json:
```json
{
    "body": "**Merged:** sage-5.1.beta1",
    "created_at": "2012-05-23T21:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194648",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta1



---

archive/issue_comments_194649.json:
```json
{
    "body": "<a id='comment:16'></a>\nIt seems #12990 is a duplicate of this. Should we keep the doctest on the patch at #12990, and add it to the doctest you guys added? Or just scrap that ticket?",
    "created_at": "2012-05-26T17:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12919#issuecomment-194649",
    "user": "https://github.com/kini"
}
```

<a id='comment:16'></a>
It seems #12990 is a duplicate of this. Should we keep the doctest on the patch at #12990, and add it to the doctest you guys added? Or just scrap that ticket?
