# Issue 12825: Fine-tune auto-detection of whether to install GCC

archive/issues_012653.json:
```json
{
    "body": "1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.\n\n2. When Debian multiarch is detected, do not install GCC.  The stderr of \"gcc -v -E -x c /dev/null\" says:\n\n```\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) \nCOLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'\n /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s\nGNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)\ncompiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\nwarning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.\nGGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072\nignoring nonexistent directory \"/usr/local/include/x86_64-linux-gnu\"\nignoring nonexistent directory \"/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include\"\n#include \"...\" search starts here:\n#include <...> search starts here:\n /usr/local/include\n /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include\n /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed\n /usr/include/x86_64-linux-gnu\n /usr/include\nEnd of search list.\n```\nWe can detect the '/usr/include/x86_64-linux-gnu' line here.\n\n3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n\n**Apply** to SAGE_ROOT repository:\n1. [attachment:12825_detect_gcc.patch]\n2. [attachment:12825_change_include_grep.patch]\n\nAssignee: GeorgSWeber\n\nReviewer: Dan Drake, Leif Leonhardy\n\nAuthor: Jeroen Demeyer\n\nMerged: sage-5.0.beta14\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12825\n\n",
    "closed_at": "2012-04-19T06:40:26Z",
    "created_at": "2012-04-10T10:36:35Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Fine-tune auto-detection of whether to install GCC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12825",
    "user": "https://github.com/jdemeyer"
}
```
1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.

2. When Debian multiarch is detected, do not install GCC.  The stderr of "gcc -v -E -x c /dev/null" says:

```
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) 
COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'
 /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s
GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)
compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
ignoring nonexistent directory "/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include"
#include "..." search starts here:
#include <...> search starts here:
 /usr/local/include
 /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include
 /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed
 /usr/include/x86_64-linux-gnu
 /usr/include
End of search list.
```
We can detect the '/usr/include/x86_64-linux-gnu' line here.

3. Sage currently doesn't build with GCC-4.7.x, see #12751.

**Apply** to SAGE_ROOT repository:
1. [attachment:12825_detect_gcc.patch]
2. [attachment:12825_change_include_grep.patch]

Assignee: GeorgSWeber

Reviewer: Dan Drake, Leif Leonhardy

Author: Jeroen Demeyer

Merged: sage-5.0.beta14

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12825





---

archive/issue_comments_160194.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -29,6 +29,8 @@\n \\`\\`\\`\n We can detect the '/usr/include/x86_64-linux-gnu' line here.\n \n+3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n+\n Comment: 1\n \n Issue created by migration from https://trac.sagemath.org/ticket/12825\n```\n",
    "created_at": "2012-04-10T13:21:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160194",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -29,6 +29,8 @@
 \`\`\`
 We can detect the '/usr/include/x86_64-linux-gnu' line here.
 
+3. Sage currently doesn't build with GCC-4.7.x, see #12751.
+
 Comment: 1
 
 Issue created by migration from https://trac.sagemath.org/ticket/12825
```




---

archive/issue_comments_160195.json:
```json
{
    "body": "Attachment [12825_detect_gcc.patch](tarball://root/attachments/some-uuid/ticket12825/12825_detect_gcc.patch) by @jdemeyer created at 2012-04-10 13:22:46",
    "created_at": "2012-04-10T13:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160195",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [12825_detect_gcc.patch](tarball://root/attachments/some-uuid/ticket12825/12825_detect_gcc.patch) by @jdemeyer created at 2012-04-10 13:22:46



---

archive/issue_comments_160196.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-11T06:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160196",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_160197.json:
```json
{
    "body": "<a id='comment:3'></a>Your `grep` also matches e.g.\n\n```\nConfigured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...\n```\nwhich is unrelated to multi-arch, but probably not that uncommon.",
    "created_at": "2012-04-11T19:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160197",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:3'></a>Your `grep` also matches e.g.

```
Configured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...
```
which is unrelated to multi-arch, but probably not that uncommon.



---

archive/issue_comments_160198.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 leif]:\n> Your `grep` also matches e.g.\n> \n> ```\n> Configured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...\n> ```\n> which is unrelated to multi-arch, but probably not that uncommon.\n\n\nMaybe a leading space or `grep '[^=]/usr/include/.'` is sufficient?",
    "created_at": "2012-04-11T19:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160198",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:4'></a>Replying to [comment:3 leif]:
> Your `grep` also matches e.g.
> 
> ```
> Configured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...
> ```
> which is unrelated to multi-arch, but probably not that uncommon.


Maybe a leading space or `grep '[^=]/usr/include/.'` is sufficient?



---

archive/issue_comments_160199.json:
```json
{
    "body": "<a id='comment:5'></a>Perhaps rather `grep '[^=]*/usr/include/.'` ...",
    "created_at": "2012-04-11T19:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160199",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:5'></a>Perhaps rather `grep '[^=]*/usr/include/.'` ...



---

archive/issue_comments_160200.json:
```json
{
    "body": "<a id='comment:6'></a>P.S.: I've created new spkgs for all open GCC 4.7.0 issues (except ia64 brokenness), all still needing review... (see #12751)\n\nI could also fix the MPFR spkg (adding `-O0 ...` on ia64), since it is also a prerequisite for building GCC.  (Btw., R -- IIRC -- fails to build on ia64 without `-O0`, too, but not due to an \"impossible reload\".  `ptestlong` gives a single doctest error related to Singular.)",
    "created_at": "2012-04-11T20:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160200",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:6'></a>P.S.: I've created new spkgs for all open GCC 4.7.0 issues (except ia64 brokenness), all still needing review... (see #12751)

I could also fix the MPFR spkg (adding `-O0 ...` on ia64), since it is also a prerequisite for building GCC.  (Btw., R -- IIRC -- fails to build on ia64 without `-O0`, too, but not due to an "impossible reload".  `ptestlong` gives a single doctest error related to Singular.)



---

archive/issue_comments_160201.json:
```json
{
    "body": "<a id='comment:7'></a>The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.\n\nNote that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the \"old method\" still worked there?) Also, I don't think we need to prioritize support for that release.\n\nSo, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.",
    "created_at": "2012-04-13T05:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160201",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:7'></a>The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.

Note that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the "old method" still worked there?) Also, I don't think we need to prioritize support for that release.

So, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.



---

archive/issue_comments_160202.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-13T05:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160202",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160203.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 ddrake]:\n> The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.\n> \n> Note that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the \"old method\" still worked there?) Also, I don't think we need to prioritize support for that release.\n> \n> So, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.\n\n\nI'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.\n\nBtw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)\n\n---\n\nAccording to GCC bugzilla, the two bugs referred to for [FSF] GCC 4.6.![01] are both fixed in 4.6.1, so I'm not sure whether 4.6.1 would be [too] broken for Sage, or on which platforms.",
    "created_at": "2012-04-13T15:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160203",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>Replying to [comment:7 ddrake]:
> The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.
> 
> Note that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the "old method" still worked there?) Also, I don't think we need to prioritize support for that release.
> 
> So, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.


I'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.

Btw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)

---

According to GCC bugzilla, the two bugs referred to for [FSF] GCC 4.6.![01] are both fixed in 4.6.1, so I'm not sure whether 4.6.1 would be [too] broken for Sage, or on which platforms.



---

archive/issue_comments_160204.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,39 @@\n+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616.\n \n+2. When Debian multiarch is detected, do not install GCC.  The stderr of \"gcc -v -E -x c /dev/null\" says:\n+\n+\\`\\`\\`\n+Using built-in specs.\n+COLLECT_GCC=gcc\n+COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper\n+Target: x86_64-linux-gnu\n+Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\n+Thread model: posix\n+gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) \n+COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s\n+GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)\n+\tcompiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\n+warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.\n+GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072\n+ignoring nonexistent directory \"/usr/local/include/x86_64-linux-gnu\"\n+ignoring nonexistent directory \"/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include\"\n+#include \"...\" search starts here:\n+#include <...> search starts here:\n+ /usr/local/include\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed\n+ /usr/include/x86_64-linux-gnu\n+ /usr/include\n+End of search list.\n+\\`\\`\\`\n+We can detect the '/usr/include/x86_64-linux-gnu' line here.\n+\n+3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n+\n+**Apply** to SAGE_ROOT repository:\n+1. [attachment:12825_detect_gcc.patch]\n+2. [attachment:12825_change_include_grep.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2012-04-14T11:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160204",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,39 @@
+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616.
 
+2. When Debian multiarch is detected, do not install GCC.  The stderr of "gcc -v -E -x c /dev/null" says:
+
+\`\`\`
+Using built-in specs.
+COLLECT_GCC=gcc
+COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper
+Target: x86_64-linux-gnu
+Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
+Thread model: posix
+gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) 
+COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s
+GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)
+	compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
+warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.
+GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
+ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
+ignoring nonexistent directory "/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include"
+#include "..." search starts here:
+#include <...> search starts here:
+ /usr/local/include
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed
+ /usr/include/x86_64-linux-gnu
+ /usr/include
+End of search list.
+\`\`\`
+We can detect the '/usr/include/x86_64-linux-gnu' line here.
+
+3. Sage currently doesn't build with GCC-4.7.x, see #12751.
+
+**Apply** to SAGE_ROOT repository:
+1. [attachment:12825_detect_gcc.patch]
+2. [attachment:12825_change_include_grep.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_160205.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-04-14T11:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160205",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_160206.json:
```json
{
    "body": "<a id='comment:10'></a>Please review [attachment:12825_change_include_grep.patch]",
    "created_at": "2012-04-14T11:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160206",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Please review [attachment:12825_change_include_grep.patch]



---

archive/issue_comments_160207.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-04-14T11:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160207",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_160208.json:
```json
{
    "body": "<a id='comment:11'></a>Added a reference to the MPFR ticket (#12837, GCC 4.7.0 on ia64 issue).",
    "created_at": "2012-04-14T22:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160208",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:11'></a>Added a reference to the MPFR ticket (#12837, GCC 4.7.0 on ia64 issue).



---

archive/issue_comments_160209.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,39 @@\n+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.\n \n+2. When Debian multiarch is detected, do not install GCC.  The stderr of \"gcc -v -E -x c /dev/null\" says:\n+\n+\\`\\`\\`\n+Using built-in specs.\n+COLLECT_GCC=gcc\n+COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper\n+Target: x86_64-linux-gnu\n+Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\n+Thread model: posix\n+gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) \n+COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s\n+GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)\n+\tcompiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\n+warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.\n+GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072\n+ignoring nonexistent directory \"/usr/local/include/x86_64-linux-gnu\"\n+ignoring nonexistent directory \"/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include\"\n+#include \"...\" search starts here:\n+#include <...> search starts here:\n+ /usr/local/include\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed\n+ /usr/include/x86_64-linux-gnu\n+ /usr/include\n+End of search list.\n+\\`\\`\\`\n+We can detect the '/usr/include/x86_64-linux-gnu' line here.\n+\n+3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n+\n+**Apply** to SAGE_ROOT repository:\n+1. [attachment:12825_detect_gcc.patch]\n+2. [attachment:12825_change_include_grep.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2012-04-14T22:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160209",
    "user": "https://github.com/nexttime"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,39 @@
+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.
 
+2. When Debian multiarch is detected, do not install GCC.  The stderr of "gcc -v -E -x c /dev/null" says:
+
+\`\`\`
+Using built-in specs.
+COLLECT_GCC=gcc
+COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper
+Target: x86_64-linux-gnu
+Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
+Thread model: posix
+gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) 
+COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s
+GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)
+	compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
+warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.
+GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
+ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
+ignoring nonexistent directory "/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include"
+#include "..." search starts here:
+#include <...> search starts here:
+ /usr/local/include
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed
+ /usr/include/x86_64-linux-gnu
+ /usr/include
+End of search list.
+\`\`\`
+We can detect the '/usr/include/x86_64-linux-gnu' line here.
+
+3. Sage currently doesn't build with GCC-4.7.x, see #12751.
+
+**Apply** to SAGE_ROOT repository:
+1. [attachment:12825_detect_gcc.patch]
+2. [attachment:12825_change_include_grep.patch]
 
 Comment: 1
 
```




---

archive/issue_comments_160210.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 jdemeyer]:\n> Please review [attachment:12825_change_include_grep.patch]\n\n\nHmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).\n\nThe `grep` should be ok, although the safest way would probably be to search for (literally) `multiarch`, which is contained in the configure options (e.g. `--enable-multiarch`), and/or the command line of `cc1` (`-imultiarch <system triplet>`).\n\n---\n\nCan you elaborate in which way GCC 4.6.**1** is broken for Sage?",
    "created_at": "2012-04-14T22:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160210",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:12'></a>Replying to [comment:10 jdemeyer]:
> Please review [attachment:12825_change_include_grep.patch]


Hmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).

The `grep` should be ok, although the safest way would probably be to search for (literally) `multiarch`, which is contained in the configure options (e.g. `--enable-multiarch`), and/or the command line of `cc1` (`-imultiarch <system triplet>`).

---

Can you elaborate in which way GCC 4.6.**1** is broken for Sage?



---

archive/issue_comments_160211.json:
```json
{
    "body": "<a id='comment:13'></a>We might also move the multi-arch check further down, since it is not directly related to the version of GCC.  (I'd prefer fixing the GCC spkg anyway, by setting one or two environment variables.)",
    "created_at": "2012-04-14T22:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160211",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:13'></a>We might also move the multi-arch check further down, since it is not directly related to the version of GCC.  (I'd prefer fixing the GCC spkg anyway, by setting one or two environment variables.)



---

archive/issue_comments_160212.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 leif]:\n> Can you elaborate in which way GCC 4.6.**1** is broken for Sage?\n\nGCC 4.6.1 as released doesn't have these bugs, but pre-releases of GCC-4.6.1 do still have those bugs.  Basically I provided a work-around for this GCC bug in some spkg but somebody still had problems because he had a pre-release of GCC 4.6.1 (I don't know whether it came with the system or whether he installed it himself).",
    "created_at": "2012-04-15T09:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160212",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>Replying to [comment:12 leif]:
> Can you elaborate in which way GCC 4.6.**1** is broken for Sage?

GCC 4.6.1 as released doesn't have these bugs, but pre-releases of GCC-4.6.1 do still have those bugs.  Basically I provided a work-around for this GCC bug in some spkg but somebody still had problems because he had a pre-release of GCC 4.6.1 (I don't know whether it came with the system or whether he installed it himself).



---

archive/issue_comments_160213.json:
```json
{
    "body": "<a id='comment:15'></a>Attachment [12825_change_include_grep.patch](tarball://root/attachments/some-uuid/ticket12825/12825_change_include_grep.patch) by @jdemeyer created at 2012-04-15 09:57:27\n\nReplying to [comment:12 leif]:\n> Hmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).\n\nFixed.",
    "created_at": "2012-04-15T09:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160213",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Attachment [12825_change_include_grep.patch](tarball://root/attachments/some-uuid/ticket12825/12825_change_include_grep.patch) by @jdemeyer created at 2012-04-15 09:57:27

Replying to [comment:12 leif]:
> Hmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).

Fixed.



---

archive/issue_comments_160214.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-16T02:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160214",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_160215.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:8 leif]:\n> I'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.\n\n\nPositive review to attachment:12825_change_include_grep.patch, which works correctly in Ubuntu 11.10 and 12.04.\n\n> Btw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)\n\n\nIn my 12.04 virtual machine, there's no symlink in `/usr/include`. If I don't set the include paths, gcc fails to build. I don't know about Debian, as I don't have any Debian VMs installed.",
    "created_at": "2012-04-16T02:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160215",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:16'></a>Replying to [comment:8 leif]:
> I'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.


Positive review to attachment:12825_change_include_grep.patch, which works correctly in Ubuntu 11.10 and 12.04.

> Btw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)


In my 12.04 virtual machine, there's no symlink in `/usr/include`. If I don't set the include paths, gcc fails to build. I don't know about Debian, as I don't have any Debian VMs installed.



---

archive/issue_comments_160216.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-19T06:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160216",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_034918.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T06:40:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12825#event-34918"
}
```



---

archive/issue_comments_160217.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,39 @@\n+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.\n \n+2. When Debian multiarch is detected, do not install GCC.  The stderr of \"gcc -v -E -x c /dev/null\" says:\n+\n+\\`\\`\\`\n+Using built-in specs.\n+COLLECT_GCC=gcc\n+COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper\n+Target: x86_64-linux-gnu\n+Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\n+Thread model: posix\n+gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) \n+COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s\n+GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)\n+compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\n+warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.\n+GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072\n+ignoring nonexistent directory \"/usr/local/include/x86_64-linux-gnu\"\n+ignoring nonexistent directory \"/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include\"\n+#include \"...\" search starts here:\n+#include <...> search starts here:\n+ /usr/local/include\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include\n+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed\n+ /usr/include/x86_64-linux-gnu\n+ /usr/include\n+End of search list.\n+\\`\\`\\`\n+We can detect the '/usr/include/x86_64-linux-gnu' line here.\n+\n+3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n+\n+**Apply** to SAGE_ROOT repository:\n+1. [attachment:12825_detect_gcc.patch]\n+2. [attachment:12825_change_include_grep.patch]\n \n Comment: 1\n \n```\n",
    "created_at": "2015-09-06T15:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12825#issuecomment-160217",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,39 @@
+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.
 
+2. When Debian multiarch is detected, do not install GCC.  The stderr of "gcc -v -E -x c /dev/null" says:
+
+\`\`\`
+Using built-in specs.
+COLLECT_GCC=gcc
+COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper
+Target: x86_64-linux-gnu
+Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
+Thread model: posix
+gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) 
+COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s
+GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)
+compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
+warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.
+GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
+ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
+ignoring nonexistent directory "/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include"
+#include "..." search starts here:
+#include <...> search starts here:
+ /usr/local/include
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include
+ /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed
+ /usr/include/x86_64-linux-gnu
+ /usr/include
+End of search list.
+\`\`\`
+We can detect the '/usr/include/x86_64-linux-gnu' line here.
+
+3. Sage currently doesn't build with GCC-4.7.x, see #12751.
+
+**Apply** to SAGE_ROOT repository:
+1. [attachment:12825_detect_gcc.patch]
+2. [attachment:12825_change_include_grep.patch]
 
 Comment: 1
 
```

