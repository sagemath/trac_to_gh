# Issue 12825: Fine-tune auto-detection of whether to install GCC

archive/issues_012653.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.\n\n2. When Debian multiarch is detected, do not install GCC.  The stderr of \"gcc -v -E -x c /dev/null\" says:\n\n```\nUsing built-in specs.\nCOLLECT_GCC=gcc\nCOLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper\nTarget: x86_64-linux-gnu\nConfigured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\nThread model: posix\ngcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) \nCOLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'\n /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s\nGNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)\ncompiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\nwarning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.\nGGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072\nignoring nonexistent directory \"/usr/local/include/x86_64-linux-gnu\"\nignoring nonexistent directory \"/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include\"\n#include \"...\" search starts here:\n#include <...> search starts here:\n /usr/local/include\n /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include\n /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed\n /usr/include/x86_64-linux-gnu\n /usr/include\nEnd of search list.\n```\nWe can detect the '/usr/include/x86_64-linux-gnu' line here.\n\n3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n\n**Apply** to SAGE_ROOT repository:\n1. [attachment: 12825_detect_gcc.patch](https://github.com/sagemath/sage/files/ticket12825/12825_detect_gcc.patch.gz)\n2. [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)\n\nComponent: **build**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **Dan Drake, Leif Leonhardy**\n\nMerged: **sage-5.0.beta14**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12825_\n\n",
    "closed_at": "2012-04-19T06:40:26Z",
    "created_at": "2012-04-10T10:36:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fine-tune auto-detection of whether to install GCC",
    "type": "issue",
    "updated_at": "2015-09-06T15:49:40Z",
    "url": "https://github.com/sagemath/sage/issues/12825",
    "user": "https://github.com/jdemeyer"
}
```
1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.

2. When Debian multiarch is detected, do not install GCC.  The stderr of "gcc -v -E -x c /dev/null" says:

```
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Ubuntu/Linaro 4.5.2-8ubuntu4' --with-bugurl=file:///usr/share/doc/gcc-4.5/README.Bugs --enable-languages=c,c++,fortran,objc,obj-c++ --prefix=/usr --program-suffix=-4.5 --enable-shared --enable-multiarch --with-multiarch-defaults=x86_64-linux-gnu --enable-linker-build-id --with-system-zlib --libexecdir=/usr/lib/x86_64-linux-gnu --without-included-gettext --enable-threads=posix --with-gxx-include-dir=/usr/include/c++/4.5 --libdir=/usr/lib/x86_64-linux-gnu --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-plugin --enable-gold --enable-ld=default --with-plugin-ld=ld.gold --enable-objc-gc --disable-werror --with-arch-32=i686 --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 4.5.2 (Ubuntu/Linaro 4.5.2-8ubuntu4) 
COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'
 /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s
GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)
compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.
GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
ignoring nonexistent directory "/usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/../../../../../x86_64-linux-gnu/include"
#include "..." search starts here:
#include <...> search starts here:
 /usr/local/include
 /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include
 /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/include-fixed
 /usr/include/x86_64-linux-gnu
 /usr/include
End of search list.
```
We can detect the '/usr/include/x86_64-linux-gnu' line here.

3. Sage currently doesn't build with GCC-4.7.x, see #12751.

**Apply** to SAGE_ROOT repository:
1. [attachment: 12825_detect_gcc.patch](https://github.com/sagemath/sage/files/ticket12825/12825_detect_gcc.patch.gz)
2. [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)

Component: **build**

Author: **Jeroen Demeyer**

Reviewer: **Dan Drake, Leif Leonhardy**

Merged: **sage-5.0.beta14**

_Issue created by migration from https://trac.sagemath.org/ticket/12825_





---

archive/issue_events_175165.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-10T10:36:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175165"
}
```



---

archive/issue_events_175166.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-10T10:36:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175166"
}
```



---

archive/issue_events_175167.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-10T10:36:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175167"
}
```



---

archive/issue_events_175168.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-10T10:36:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175168"
}
```



---

archive/issue_events_175169.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-04-10T10:36:35Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175169"
}
```



---

archive/issue_comments_144241.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,3 +28,5 @@\n End of search list.\n ```\n We can detect the '/usr/include/x86_64-linux-gnu' line here.\n+\n+3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n``````\n",
    "created_at": "2012-04-10T13:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144241",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,3 +28,5 @@
 End of search list.
 ```
 We can detect the '/usr/include/x86_64-linux-gnu' line here.
+
+3. Sage currently doesn't build with GCC-4.7.x, see #12751.
``````




---

archive/issue_comments_144242.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2012-04-10T13:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144242",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_144243.json:
```json
{
    "body": "Attachment: **[12825_detect_gcc.patch.gz](https://github.com/sagemath/sage/files/ticket12825/12825_detect_gcc.patch.gz)**",
    "created_at": "2012-04-10T13:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144243",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[12825_detect_gcc.patch.gz](https://github.com/sagemath/sage/files/ticket12825/12825_detect_gcc.patch.gz)**



---

archive/issue_events_175170.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-11T06:43:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175170"
}
```



---

archive/issue_comments_144244.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nYour `grep` also matches e.g.\n\n```\nConfigured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...\n```\nwhich is unrelated to multi-arch, but probably not that uncommon.",
    "created_at": "2012-04-11T19:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144244",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:3" align="right">comment:3</div>

Your `grep` also matches e.g.

```
Configured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...
```
which is unrelated to multi-arch, but probably not that uncommon.



---

archive/issue_comments_144245.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@nexttime](#comment%3A3):\n> Your `grep` also matches e.g.\n> \n> ```\n> Configured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...\n> ```\n> which is unrelated to multi-arch, but probably not that uncommon.\n\nMaybe a leading space or `grep '[^=]/usr/include/.'` is sufficient?",
    "created_at": "2012-04-11T19:38:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144245",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@nexttime](#comment%3A3):
> Your `grep` also matches e.g.
> 
> ```
> Configured with: ... --with-gxx-include-dir=/usr/include/c++/4.6 ...
> ```
> which is unrelated to multi-arch, but probably not that uncommon.

Maybe a leading space or `grep '[^=]/usr/include/.'` is sufficient?



---

archive/issue_comments_144246.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPerhaps rather `grep '[^=]*/usr/include/.'` ...",
    "created_at": "2012-04-11T19:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144246",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:5" align="right">comment:5</div>

Perhaps rather `grep '[^=]*/usr/include/.'` ...



---

archive/issue_comments_144247.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nP.S.: I've created new spkgs for all open GCC 4.7.0 issues (except ia64 brokenness), all still needing review... (see #12751)\n\nI could also fix the MPFR spkg (adding `-O0 ...` on ia64), since it is also a prerequisite for building GCC.  (Btw., R -- IIRC -- fails to build on ia64 without `-O0`, too, but not due to an \"impossible reload\".  `ptestlong` gives a single doctest error related to Singular.)",
    "created_at": "2012-04-11T20:16:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144247",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:6" align="right">comment:6</div>

P.S.: I've created new spkgs for all open GCC 4.7.0 issues (except ia64 brokenness), all still needing review... (see #12751)

I could also fix the MPFR spkg (adding `-O0 ...` on ia64), since it is also a prerequisite for building GCC.  (Btw., R -- IIRC -- fails to build on ia64 without `-O0`, too, but not due to an "impossible reload".  `ptestlong` gives a single doctest error related to Singular.)



---

archive/issue_comments_144248.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.\n\nNote that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the \"old method\" still worked there?) Also, I don't think we need to prioritize support for that release.\n\nSo, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.",
    "created_at": "2012-04-13T05:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144248",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:7" align="right">comment:7</div>

The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.

Note that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the "old method" still worked there?) Also, I don't think we need to prioritize support for that release.

So, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.



---

archive/issue_comments_144249.json:
```json
{
    "body": "Reviewer: **Dan Drake**",
    "created_at": "2012-04-13T05:49:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144249",
    "user": "https://github.com/dandrake"
}
```

Reviewer: **Dan Drake**



---

archive/issue_events_175171.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-04-13T05:49:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175171"
}
```



---

archive/issue_events_175172.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-04-13T05:49:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175172"
}
```



---

archive/issue_comments_144250.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@dandrake](#comment%3A7):\n> The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.\n> \n> Note that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the \"old method\" still worked there?) Also, I don't think we need to prioritize support for that release.\n> \n> So, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.\n\nI'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.\n\nBtw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)\n\n---\n\nAccording to GCC bugzilla, the two bugs referred to for [FSF] GCC 4.6.![01] are both fixed in 4.6.1, so I'm not sure whether 4.6.1 would be [too] broken for Sage, or on which platforms.",
    "created_at": "2012-04-13T15:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144250",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@dandrake](#comment%3A7):
> The multiarch detection works on Ubuntu 11.10, x86-64, and Ubuntu 12.04, i386. I also tested this on Arch Linux, which just upgraded to gcc 4.7, and it correctly decided to install our gcc spkg.
> 
> Note that Ubuntu 11.04 (with gcc-4.5.2) uses the multiarch stuff, and your script misses that because it looks for version 4.6.*. However, the compilation seems to work properly. (That was Ubuntu's first multiarch release, so perhaps the "old method" still worked there?) Also, I don't think we need to prioritize support for that release.
> 
> So, positive review, unless someone objects to building our gcc if the system gcc is older than 4.4.

I'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.

Btw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)

---

According to GCC bugzilla, the two bugs referred to for [FSF] GCC 4.6.![01] are both fixed in 4.6.1, so I'm not sure whether 4.6.1 would be [too] broken for Sage, or on which platforms.



---

archive/issue_comments_144251.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -30,3 +30,7 @@\n We can detect the '/usr/include/x86_64-linux-gnu' line here.\n \n 3. Sage currently doesn't build with GCC-4.7.x, see #12751.\n+\n+**Apply** to SAGE_ROOT repository:\n+1. [attachment: 12825_detect_gcc.patch](https://github.com/sagemath/sage/files/ticket12825/12825_detect_gcc.patch.gz)\n+2. [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)\n``````\n",
    "created_at": "2012-04-14T11:31:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144251",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -30,3 +30,7 @@
 We can detect the '/usr/include/x86_64-linux-gnu' line here.
 
 3. Sage currently doesn't build with GCC-4.7.x, see #12751.
+
+**Apply** to SAGE_ROOT repository:
+1. [attachment: 12825_detect_gcc.patch](https://github.com/sagemath/sage/files/ticket12825/12825_detect_gcc.patch.gz)
+2. [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)
``````




---

archive/issue_events_175173.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-14T11:31:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175173"
}
```



---

archive/issue_events_175174.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-14T11:31:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175174"
}
```



---

archive/issue_comments_144252.json:
```json
{
    "body": "Changed reviewer from **Dan Drake** to **Dan Drake, Leif Leonhardy**",
    "created_at": "2012-04-14T11:32:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144252",
    "user": "https://github.com/jdemeyer"
}
```

Changed reviewer from **Dan Drake** to **Dan Drake, Leif Leonhardy**



---

archive/issue_comments_144253.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nPlease review [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)",
    "created_at": "2012-04-14T11:32:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144253",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Please review [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)



---

archive/issue_events_175175.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-14T11:32:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175175"
}
```



---

archive/issue_events_175176.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-14T11:32:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175176"
}
```



---

archive/issue_comments_144254.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAdded a reference to the MPFR ticket (#12837, GCC 4.7.0 on ia64 issue).",
    "created_at": "2012-04-14T22:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144254",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:11" align="right">comment:11</div>

Added a reference to the MPFR ticket (#12837, GCC 4.7.0 on ia64 issue).



---

archive/issue_comments_144255.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616.\n+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.\n \n 2. When Debian multiarch is detected, do not install GCC.  The stderr of \"gcc -v -E -x c /dev/null\" says:\n \n``````\n",
    "created_at": "2012-04-14T22:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144255",
    "user": "https://github.com/nexttime"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616.
+1. GCC-4.7.x on ia64 is very broken.  We should install GCC in this case.  Note that currently it won't actually work as MPIR and MPFR fail to build with gcc-4.7.x on ia64.  For MPIR, see #11616; for MPFR, see #12837.
 
 2. When Debian multiarch is detected, do not install GCC.  The stderr of "gcc -v -E -x c /dev/null" says:
 
``````




---

archive/issue_comments_144256.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment%3A10):\n> Please review [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)\n\nHmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).\n\nThe `grep` should be ok, although the safest way would probably be to search for (literally) `multiarch`, which is contained in the configure options (e.g. `--enable-multiarch`), and/or the command line of `cc1` (`-imultiarch <system triplet>`).\n\n---\n\nCan you elaborate in which way GCC 4.6.**1** is broken for Sage?",
    "created_at": "2012-04-14T22:37:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144256",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment%3A10):
> Please review [attachment: 12825_change_include_grep.patch](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)

Hmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).

The `grep` should be ok, although the safest way would probably be to search for (literally) `multiarch`, which is contained in the configure options (e.g. `--enable-multiarch`), and/or the command line of `cc1` (`-imultiarch <system triplet>`).

---

Can you elaborate in which way GCC 4.6.**1** is broken for Sage?



---

archive/issue_comments_144257.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWe might also move the multi-arch check further down, since it is not directly related to the version of GCC.  (I'd prefer fixing the GCC spkg anyway, by setting one or two environment variables.)",
    "created_at": "2012-04-14T22:57:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144257",
    "user": "https://github.com/nexttime"
}
```

<div id="comment:13" align="right">comment:13</div>

We might also move the multi-arch check further down, since it is not directly related to the version of GCC.  (I'd prefer fixing the GCC spkg anyway, by setting one or two environment variables.)



---

archive/issue_comments_144258.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@nexttime](#comment%3A12):\n> Can you elaborate in which way GCC 4.6.**1** is broken for Sage?\n\nGCC 4.6.1 as released doesn't have these bugs, but pre-releases of GCC-4.6.1 do still have those bugs.  Basically I provided a work-around for this GCC bug in some spkg but somebody still had problems because he had a pre-release of GCC 4.6.1 (I don't know whether it came with the system or whether he installed it himself).",
    "created_at": "2012-04-15T09:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144258",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@nexttime](#comment%3A12):
> Can you elaborate in which way GCC 4.6.**1** is broken for Sage?

GCC 4.6.1 as released doesn't have these bugs, but pre-releases of GCC-4.6.1 do still have those bugs.  Basically I provided a work-around for this GCC bug in some spkg but somebody still had problems because he had a pre-release of GCC 4.6.1 (I don't know whether it came with the system or whether he installed it himself).



---

archive/issue_comments_144259.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nAttachment: **[12825_change_include_grep.patch.gz](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)**\n\nReplying to [@nexttime](#comment%3A12):\n> Hmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).\n\nFixed.",
    "created_at": "2012-04-15T09:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144259",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Attachment: **[12825_change_include_grep.patch.gz](https://github.com/sagemath/sage/files/ticket12825/12825_change_include_grep.patch.gz)**

Replying to [@nexttime](#comment%3A12):
> Hmmm, `gcc` should actually be `$CC`, since we tested the version of the latter (and would use that one to build GCC anyway).

Fixed.



---

archive/issue_events_175177.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-04-16T02:35:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175177"
}
```



---

archive/issue_events_175178.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2012-04-16T02:35:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175178"
}
```



---

archive/issue_comments_144260.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@nexttime](#comment%3A8):\n> I'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.\n\nPositive review to [attachment: 12825_change_include_grep.patch,](https://github.com/sagemath/sage/files/ticket12825/427b0268ef236c02796df2ce6b156ee4.gz) which works correctly in Ubuntu 11.10 and 12.04.\n\n> Btw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)\n\nIn my 12.04 virtual machine, there's no symlink in `/usr/include`. If I don't set the include paths, gcc fails to build. I don't know about Debian, as I don't have any Debian VMs installed.",
    "created_at": "2012-04-16T02:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144260",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@nexttime](#comment%3A8):
> I'd still change the `grep` pattern to not match typical `--with-gxx-include-dir` `configure` options.

Positive review to [attachment: 12825_change_include_grep.patch,](https://github.com/sagemath/sage/files/ticket12825/427b0268ef236c02796df2ce6b156ee4.gz) which works correctly in Ubuntu 11.10 and 12.04.

> Btw., it seems Ubuntu / Debian changed the multi-arch stuff in 12.04 such that there only setting `LIBRARY_PATH`  would be necessary (unless one created symbolic links for `crt?.o`); i.e., there's now a symbolic link from `/usr/include/asm/` to (e.g.) `x86_64-linux-gnu/asm/`.  (Dan, can you confirm that?  In your case it would presumably be a link to `i386-linux-gnu/asm/`.)

In my 12.04 virtual machine, there's no symlink in `/usr/include`. If I don't set the include paths, gcc fails to build. I don't know about Debian, as I don't have any Debian VMs installed.



---

archive/issue_events_175179.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T06:40:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175179"
}
```



---

archive/issue_events_175180.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T06:40:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12825#event-175180"
}
```



---

archive/issue_comments_144261.json:
```json
{
    "body": "Merged: **sage-5.0.beta14**",
    "created_at": "2012-04-19T06:40:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144261",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta14**



---

archive/issue_comments_144262.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,7 +13,7 @@\n COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'\n  /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s\n GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)\n-\tcompiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\n+compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9\n warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.\n GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072\n ignoring nonexistent directory \"/usr/local/include/x86_64-linux-gnu\"\n``````\n",
    "created_at": "2015-09-06T15:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12825",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12825#issuecomment-144262",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,7 +13,7 @@
 COLLECT_GCC_OPTIONS='-v' '-c' '-mtune=generic' '-march=x86-64'
  /usr/lib/x86_64-linux-gnu/gcc/x86_64-linux-gnu/4.5.2/cc1 -quiet -v /dev/null -D_FORTIFY_SOURCE=2 -quiet -dumpbase null -mtune=generic -march=x86-64 -auxbase null -version -fstack-protector -o /tmp/ccPmIBIJ.s
 GNU C (Ubuntu/Linaro 4.5.2-8ubuntu4) version 4.5.2 (x86_64-linux-gnu)
-	compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
+compiled by GNU C version 4.5.2, GMP version 4.3.2, MPFR version 3.0.0-p8, MPC version 0.9
 warning: MPFR header version 3.0.0-p8 differs from library version 3.0.0.
 GGC heuristics: --param ggc-min-expand=100 --param ggc-min-heapsize=131072
 ignoring nonexistent directory "/usr/local/include/x86_64-linux-gnu"
``````

