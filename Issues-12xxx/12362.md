# Issue 12362: Improvement of GNP generators for graphs and digraphs

archive/issues_012190.json:
```json
{
    "body": "The RandomDirectedGNP generator is quit slow because it is written in python. Also I propose to rewrite it in Cython.\n\nWith this ticket, I propose to create a file graph_generators_pyx.pyx containing graphs and digraphs generators in cython and to provide a faster implementation of the GNP generator for both graphs and digraphs.\n\nAPPLY:\n* [attachment:trac_12362_random_gnp.patch]\n* [attachment:trac_12362-rev.patch]\n* [attachment:trac_12362-rev-rev.patch]\n* [attachment:trac_12362-edge_disjoint_spanning_tree.patch]\n\nAssignee: jason, ncohen, rlm\n\nCC:  @nathanncohen\n\nKeywords: directed graphs, generators\n\nReviewer: Nathann Cohen\n\nAuthor: David Coudert\n\nMerged: sage-5.0.beta9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12362\n\n",
    "closed_at": "2012-03-21T22:08:16Z",
    "created_at": "2012-01-26T10:58:04Z",
    "labels": [
        "component: graph theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Improvement of GNP generators for graphs and digraphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12362",
    "user": "https://github.com/dcoudert"
}
```
The RandomDirectedGNP generator is quit slow because it is written in python. Also I propose to rewrite it in Cython.

With this ticket, I propose to create a file graph_generators_pyx.pyx containing graphs and digraphs generators in cython and to provide a faster implementation of the GNP generator for both graphs and digraphs.

APPLY:
* [attachment:trac_12362_random_gnp.patch]
* [attachment:trac_12362-rev.patch]
* [attachment:trac_12362-rev-rev.patch]
* [attachment:trac_12362-edge_disjoint_spanning_tree.patch]

Assignee: jason, ncohen, rlm

CC:  @nathanncohen

Keywords: directed graphs, generators

Reviewer: Nathann Cohen

Author: David Coudert

Merged: sage-5.0.beta9

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12362





---

archive/issue_comments_141791.json:
```json
{
    "body": "<a id='comment:1'></a>The patchs are not working yet :(\n\nHere the modifications are not taken into account by sage -b.\nSomething is missing but I don't know what.\nI'm still a beginner with sage...\n\nAny help, advise,... is more than welcome !\n\nD.",
    "created_at": "2012-01-26T11:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141791",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>The patchs are not working yet :(

Here the modifications are not taken into account by sage -b.
Something is missing but I don't know what.
I'm still a beginner with sage...

Any help, advise,... is more than welcome !

D.



---

archive/issue_comments_141792.json:
```json
{
    "body": "<a id='comment:4'></a>Another proposal for RandomDirectedGNP.\n\nThe function is generic and also works for RandomGNP, but I haven't modified the graph_generators.py file because further benchmark are required: networkx implementation versus this implementation.\n\nHow can I remove useless attachments of this ticket ??\n\nThanks,\n\nD.",
    "created_at": "2012-01-31T16:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141792",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:4'></a>Another proposal for RandomDirectedGNP.

The function is generic and also works for RandomGNP, but I haven't modified the graph_generators.py file because further benchmark are required: networkx implementation versus this implementation.

How can I remove useless attachments of this ticket ??

Thanks,

D.



---

archive/issue_comments_141793.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-07T23:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141793",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_141794.json:
```json
{
    "body": "<a id='comment:5'></a>I have changed the status from new to need_review.\n\nWithout this patch\n\n```\nsage: %timeit digraphs.RandomDirectedGNP(1000,0.001)\n5 loops, best of 3: 2.58 s per loop\nsage: %timeit networkx.random_graphs.directed_gnp_random_graph(1000,0.001)\n5 loops, best of 3: 2.08 s per loop\n```\n\nWith this patch\n\n```\nsage: %timeit digraphs.RandomDirectedGNP(1000,0.001)\n5 loops, best of 3: 26.6 ms per loop\n```\n\nThis patch could be used for undirected graphs, but the networkx implementation is competitive.\n\nWaiting for your feedback.\n\nD.",
    "created_at": "2012-02-07T23:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141794",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>I have changed the status from new to need_review.

Without this patch

```
sage: %timeit digraphs.RandomDirectedGNP(1000,0.001)
5 loops, best of 3: 2.58 s per loop
sage: %timeit networkx.random_graphs.directed_gnp_random_graph(1000,0.001)
5 loops, best of 3: 2.08 s per loop
```

With this patch

```
sage: %timeit digraphs.RandomDirectedGNP(1000,0.001)
5 loops, best of 3: 26.6 ms per loop
```

This patch could be used for undirected graphs, but the networkx implementation is competitive.

Waiting for your feedback.

D.



---

archive/issue_comments_141795.json:
```json
{
    "body": "<a id='comment:6'></a>Helloooooo !!!\n\nNice speedup `:-D`\n\nDuring the Sage week we also found a similar speedup in a Poset code, by replacing a ``m[i][j]`` by a ``m[i,j]`` `:-P`\n\nAbout the length of the code : it can be divided by two at no cost by removing the \"else\" on the \"loops\" argument. If you try to build an edge between i and i in a graph that that has been built with loops = False the edge is silently *not* created. And there should be no noticeable difference in the runtime if the code with loops is applied to the case where loops are forbidden.\n\nIt is also possible to write the two codes \n\n```\nfor 0 <= i < n:                                                                                                                                                                                                                                                 \n   for 0 <= j < n:                                                                                                                                                                                                                                             \n      if random() < pp:                                                                                                                                                                                                                                       \n         G.add_edge(i,j)   \n```\nand\n\n```\n# Standard GNP generator for graphs                                                                                                                                                                                                                                 \nfor 0 <= i < n-1:                                                                                                                                                                                                                                                   \n   for i+1 <= j <n:                                                                                                                                                                                                                                                \n       if random() < pp:                                                                                                                                                                                                                                           \n          G.add_edge(i,j)   \n```\n\nas\n\n```                                                                                                                                                                                                                                \nfor 0 <= i < n-1:                                                                                                                                                                                                                                                   \n   for (i+1 if directed else 0) <= j <n:                                                                                                                                                                                                                                                \n      if random() < pp:                                                                                                                                                                                                                                           \n         G.add_edge(i,j)   \n```\n\nSame thing here, a \"if\" in a loop (with branch prediction !) should not weigh much `:-)`\n\nNathann",
    "created_at": "2012-02-09T20:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141795",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:6'></a>Helloooooo !!!

Nice speedup `:-D`

During the Sage week we also found a similar speedup in a Poset code, by replacing a ``m[i][j]`` by a ``m[i,j]`` `:-P`

About the length of the code : it can be divided by two at no cost by removing the "else" on the "loops" argument. If you try to build an edge between i and i in a graph that that has been built with loops = False the edge is silently *not* created. And there should be no noticeable difference in the runtime if the code with loops is applied to the case where loops are forbidden.

It is also possible to write the two codes 

```
for 0 <= i < n:                                                                                                                                                                                                                                                 
   for 0 <= j < n:                                                                                                                                                                                                                                             
      if random() < pp:                                                                                                                                                                                                                                       
         G.add_edge(i,j)   
```
and

```
# Standard GNP generator for graphs                                                                                                                                                                                                                                 
for 0 <= i < n-1:                                                                                                                                                                                                                                                   
   for i+1 <= j <n:                                                                                                                                                                                                                                                
       if random() < pp:                                                                                                                                                                                                                                           
          G.add_edge(i,j)   
```

as

```                                                                                                                                                                                                                                
for 0 <= i < n-1:                                                                                                                                                                                                                                                   
   for (i+1 if directed else 0) <= j <n:                                                                                                                                                                                                                                                
      if random() < pp:                                                                                                                                                                                                                                           
         G.add_edge(i,j)   
```

Same thing here, a "if" in a loop (with branch prediction !) should not weigh much `:-)`

Nathann



---

archive/issue_comments_141796.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-09T20:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141796",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_141797.json:
```json
{
    "body": "<a id='comment:7'></a>Thank you Nathann for the good advices. \n\nI have changed accordingly the standard GNP algorithm.\nI have also contracted the fast algorithm but it is a bit more difficult to read now. The extra cost for N = 10000 and p=0.0001 is 5ms which is acceptable ;-)\n\nSome running time. The fast algorithm is better for large sparse graphs. Otherwise, the standard GNP algorithm is now fast enough.\n\n```\nsage: %timeit G = digraphs.RandomDirectedGNP(1000,0.001,loops=True,fast=True)\n5 loops, best of 3: 55.8 ms per loop\nsage: %timeit G = digraphs.RandomDirectedGNP(1000,0.001,loops=True)\n25 loops, best of 3: 15.8 ms per loop\nsage: %timeit G = digraphs.RandomDirectedGNP(10000,0.0001,loops=True,fast=True)\n5 loops, best of 3: 558 ms per loop\nsage: %timeit G = digraphs.RandomDirectedGNP(10000,0.0001,loops=True)\n5 loops, best of 3: 1.07 s per loop\nsage: %timeit G = digraphs.RandomDirectedGNP(10000,0.001,loops=True,fast=True)\n5 loops, best of 3: 5.31 s per loop\nsage: %timeit G = digraphs.RandomDirectedGNP(10000,0.001,loops=True)\n5 loops, best of 3: 1.5 s per loop\n```\n\n\nD.\n\n\nPS: concerning m[i][j] versus m[i,j], is it for python or cython ? which kind of data structure ?\n\nPS2: in general in C, m[i][j] is faster than m[i*N+j], so if you have a NxN matrix encoded in a 1D array A, it is interesting to create a **B array of size N and to assign B[i]=A+i*N. Then, we have B[i,j]==A[i*N+j]. OK, I had real C course.",
    "created_at": "2012-02-09T23:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141797",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>Thank you Nathann for the good advices. 

I have changed accordingly the standard GNP algorithm.
I have also contracted the fast algorithm but it is a bit more difficult to read now. The extra cost for N = 10000 and p=0.0001 is 5ms which is acceptable ;-)

Some running time. The fast algorithm is better for large sparse graphs. Otherwise, the standard GNP algorithm is now fast enough.

```
sage: %timeit G = digraphs.RandomDirectedGNP(1000,0.001,loops=True,fast=True)
5 loops, best of 3: 55.8 ms per loop
sage: %timeit G = digraphs.RandomDirectedGNP(1000,0.001,loops=True)
25 loops, best of 3: 15.8 ms per loop
sage: %timeit G = digraphs.RandomDirectedGNP(10000,0.0001,loops=True,fast=True)
5 loops, best of 3: 558 ms per loop
sage: %timeit G = digraphs.RandomDirectedGNP(10000,0.0001,loops=True)
5 loops, best of 3: 1.07 s per loop
sage: %timeit G = digraphs.RandomDirectedGNP(10000,0.001,loops=True,fast=True)
5 loops, best of 3: 5.31 s per loop
sage: %timeit G = digraphs.RandomDirectedGNP(10000,0.001,loops=True)
5 loops, best of 3: 1.5 s per loop
```


D.


PS: concerning m[i][j] versus m[i,j], is it for python or cython ? which kind of data structure ?

PS2: in general in C, m[i][j] is faster than m[i*N+j], so if you have a NxN matrix encoded in a 1D array A, it is interesting to create a **B array of size N and to assign B[i]=A+i*N. Then, we have B[i,j]==A[i*N+j]. OK, I had real C course.



---

archive/issue_comments_141798.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-09T23:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141798",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_141799.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-10T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141799",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_141800.json:
```json
{
    "body": "<a id='comment:9'></a>Hellooooooo !!!\n\n> Some running time. The fast algorithm is better for large sparse graphs. \n\n\nNice ! Could you advertise it in the doc ? Something like \"the fast algorithm is only faster for *LARGE* instances (try it to know whether it is useful for you)\" ?\n\nI tried to improve it a bit because I still find weird that networkx could beat us at this game, but found nothing yet... I'll try again later `:-p`\n\nThis being said, I was thinking of two things. The first of the two you reported yourself some time ago : the means seem to be below what is expected...\n\n```\nsage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)]) \n0.0990303030303030\nsage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)])\n0.0985575757575757\nsage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)])\n0.0989050505050506\nsage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)])\n0.0993535353535353\n```\n\nAnd there is also this \"detail\" `:-p`\n\n```\nsage: mean([digraphs.RandomDirectedGNP(100,.1, fast = False).density()+.0 for i in range(50)])\n0.0498989898989899\nsage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)]) \n0.0987434343434344\n```\n\nCould you also add the file to the documentation (the files in devel/sage-yourbranch/doc/en/reference/) and make the method available (through an optional argument) in graphs.RandomGNP ? Even though it can not be the default method, as networkx is faster (why the hell should it be ? `O_o`), it would be nice to have around.\n\nAnd about the matrix : it was not about C arrays but about Sage matrices, and this is why the speedup was so huge (#12476). It is because a field was accessed in Python as ``m[x][y]`` which translates as \"build a copy of the x^th row of m, and return its y^th element\". A bit more than what was necessary `:-P`\n\nNathann",
    "created_at": "2012-02-10T11:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141800",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:9'></a>Hellooooooo !!!

> Some running time. The fast algorithm is better for large sparse graphs. 


Nice ! Could you advertise it in the doc ? Something like "the fast algorithm is only faster for *LARGE* instances (try it to know whether it is useful for you)" ?

I tried to improve it a bit because I still find weird that networkx could beat us at this game, but found nothing yet... I'll try again later `:-p`

This being said, I was thinking of two things. The first of the two you reported yourself some time ago : the means seem to be below what is expected...

```
sage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)]) 
0.0990303030303030
sage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)])
0.0985575757575757
sage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)])
0.0989050505050506
sage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)])
0.0993535353535353
```

And there is also this "detail" `:-p`

```
sage: mean([digraphs.RandomDirectedGNP(100,.1, fast = False).density()+.0 for i in range(50)])
0.0498989898989899
sage: mean([digraphs.RandomDirectedGNP(100,.1, fast = True).density()+.0 for i in range(50)]) 
0.0987434343434344
```

Could you also add the file to the documentation (the files in devel/sage-yourbranch/doc/en/reference/) and make the method available (through an optional argument) in graphs.RandomGNP ? Even though it can not be the default method, as networkx is faster (why the hell should it be ? `O_o`), it would be nice to have around.

And about the matrix : it was not about C arrays but about Sage matrices, and this is why the speedup was so huge (#12476). It is because a field was accessed in Python as ``m[x][y]`` which translates as "build a copy of the x^th row of m, and return its y^th element". A bit more than what was necessary `:-P`

Nathann



---

archive/issue_comments_141801.json:
```json
{
    "body": "<a id='comment:10'></a>I have addressed all your remarks. The \"detail\" was because I have stupidly copy/paste your ``(i+1 if directed else 0)``. It should be ``(0 if directed else i+1)`` ;)\n\nFor graphs, I have decided to let the networkx method as default. \n\n```\nsage: %timeit networkx.gnp_random_graph(1000,0.01)\n5 loops, best of 3: 1.03 s per loop\nsage: %timeit graphs.RandomGNP(1000,0.01,method='sage')\n5 loops, best of 3: 233 ms per loop\nsage: %timeit graphs.RandomGNP(1000,0.01,method='networkx')\n5 loops, best of 3: 66.5 ms per loop\nsage: %timeit networkx.gnp_random_graph(100,0.05,method='sage')\n25 loops, best of 3: 10.9 ms per loop\nsage: %timeit graphs.RandomGNP(100,0.05,method='sage')\n25 loops, best of 3: 11.4 ms per loop\nsage: %timeit graphs.RandomGNP(100,0.05,method='networkx')\n125 loops, best of 3: 3.45 ms per loop\n```\n\nConcerning the average density, it is seems correct with larger sample.\n\n```\nsage: mean([digraphs.RandomDirectedGNP(100,.1, loops = True).density()+.0 for i in range(500)])\n0.100094400000000\nsage: mean([digraphs.RandomDirectedGNP(100,.1, loops = False).density()+.0 for i in range(500)]) \n0.100155555555556\nsage: mean([digraphs.RandomDirectedGNP(100,.1, loops = False, fast = True).density()+.0 for i in range(500)]) \n0.0989579797979798\nsage: mean([digraphs.RandomDirectedGNP(100,.1, loops = True, fast = True).density()+.0 for i in range(500)]) \n0.0988469999999999\nsage: mean([graphs.RandomGNP(100,.1, fast = False, method='sage').density()+.0 for i in range(500)]) \n0.100131313131313\nsage: mean([graphs.RandomGNP(100,.1, fast = False, method='networkx').density()+.0 for i in range(500)]) \n0.100190707070707\nsage: mean([graphs.RandomGNP(100,.1, fast = True, method='networkx').density()+.0 for i in range(500)]) \n0.100002424242424\nsage: mean([graphs.RandomGNP(100,.1, fast = True, method='sage').density()+.0 for i in range(500)]) \n0.104045165676905\n```\n\nA possible improvement for RandomDirectedGNP is to return a complete digraph (with or without loops) when p=1. However, no such function exists and it is not relevant in this patch. I let it for another patch.\n\nD.",
    "created_at": "2012-02-10T23:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141801",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>I have addressed all your remarks. The "detail" was because I have stupidly copy/paste your ``(i+1 if directed else 0)``. It should be ``(0 if directed else i+1)`` ;)

For graphs, I have decided to let the networkx method as default. 

```
sage: %timeit networkx.gnp_random_graph(1000,0.01)
5 loops, best of 3: 1.03 s per loop
sage: %timeit graphs.RandomGNP(1000,0.01,method='sage')
5 loops, best of 3: 233 ms per loop
sage: %timeit graphs.RandomGNP(1000,0.01,method='networkx')
5 loops, best of 3: 66.5 ms per loop
sage: %timeit networkx.gnp_random_graph(100,0.05,method='sage')
25 loops, best of 3: 10.9 ms per loop
sage: %timeit graphs.RandomGNP(100,0.05,method='sage')
25 loops, best of 3: 11.4 ms per loop
sage: %timeit graphs.RandomGNP(100,0.05,method='networkx')
125 loops, best of 3: 3.45 ms per loop
```

Concerning the average density, it is seems correct with larger sample.

```
sage: mean([digraphs.RandomDirectedGNP(100,.1, loops = True).density()+.0 for i in range(500)])
0.100094400000000
sage: mean([digraphs.RandomDirectedGNP(100,.1, loops = False).density()+.0 for i in range(500)]) 
0.100155555555556
sage: mean([digraphs.RandomDirectedGNP(100,.1, loops = False, fast = True).density()+.0 for i in range(500)]) 
0.0989579797979798
sage: mean([digraphs.RandomDirectedGNP(100,.1, loops = True, fast = True).density()+.0 for i in range(500)]) 
0.0988469999999999
sage: mean([graphs.RandomGNP(100,.1, fast = False, method='sage').density()+.0 for i in range(500)]) 
0.100131313131313
sage: mean([graphs.RandomGNP(100,.1, fast = False, method='networkx').density()+.0 for i in range(500)]) 
0.100190707070707
sage: mean([graphs.RandomGNP(100,.1, fast = True, method='networkx').density()+.0 for i in range(500)]) 
0.100002424242424
sage: mean([graphs.RandomGNP(100,.1, fast = True, method='sage').density()+.0 for i in range(500)]) 
0.104045165676905
```

A possible improvement for RandomDirectedGNP is to return a complete digraph (with or without loops) when p=1. However, no such function exists and it is not relevant in this patch. I let it for another patch.

D.



---

archive/issue_comments_141802.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-10T23:37:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141802",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_141803.json:
```json
{
    "body": "<a id='comment:11'></a>I have added some ``set_random_seed(0)`` before the tests to ensure that the results are always the same. I have also removed annoying TABs and spaces.\nThe patch should now pass all tests (at least it is the case on my computer).\n\nHowever, I don't know how to set the seed inside a cython function. This could be a nice improvement to this patch. I have checked the ``sage.misc.randstate`` documentation, but I don't understand how to proceed. Any help is more than welcome.\n\nD.",
    "created_at": "2012-02-20T23:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141803",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:11'></a>I have added some ``set_random_seed(0)`` before the tests to ensure that the results are always the same. I have also removed annoying TABs and spaces.
The patch should now pass all tests (at least it is the case on my computer).

However, I don't know how to set the seed inside a cython function. This could be a nice improvement to this patch. I have checked the ``sage.misc.randstate`` documentation, but I don't understand how to proceed. Any help is more than welcome.

D.



---

archive/issue_comments_141804.json:
```json
{
    "body": "Attachment [trac_12362_random_gnp.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362_random_gnp.patch) by @dcoudert created at 2012-02-21 10:04:49",
    "created_at": "2012-02-21T10:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141804",
    "user": "https://github.com/dcoudert"
}
```

Attachment [trac_12362_random_gnp.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362_random_gnp.patch) by @dcoudert created at 2012-02-21 10:04:49



---

archive/issue_comments_141805.json:
```json
{
    "body": "<a id='comment:12'></a>Hellooooooo David !\n\nWell, I don't think not being able to define the seed *as a parameter* of the function is so bad. As it works fine when you set it globally for the doctests anyway....\n\nNow, here is a small patch with some modifications. It adds a few tests, check that the given method is \"networkx\" or \"Sage\" but nothing else (that's how we do it usually). I also added a \"(Cython)\" to the title of the new file you create. It makes more sense this way when you look at the documentation. Otherwise, you would have:\n* Digraph generators\n* Graph Generators\n* Digraph and Graph generators\nNow there is a \"Cython\" at the end of the third one, and there's some logic to it `:-)`\n\nThis being said, I added one test which does *not* pass... Here it is :\n\n```\nsage: from sage.graphs.graph_generators_pyx import RandomGNP\nsage: abs(mean([RandomGNP(150,.2, fast = True).density() for i in range(30)])-.2) < .001\nFalse \n```\n\nIt looks like there is some deviation with the \"fast\" algorithm, which does not occur with the usual one :\n\n```\nsage: sage: abs(mean([RandomGNP(200,.2).density() for i in range(30)])-.2)\n0.000443886097152429\nsage: sage: abs(mean([RandomGNP(200,.2, fast = True).density() for i in range(30)])-.2)\n0.0163283739008691\n```\n\nWell, that's already 1% of edges too much. I don't think the deviation with the first algorithm is very bad (though for some reason it is always positive on my tests, and I do not like that), but I'm no big fan of the deviation for the second implementation\nThe \"fast\" algorithm is also.... *MUCH SLOWER* on most cases... Is it better than the other one in some interesting situations ?\n\nOh, and I also noticed that the graphs returned did not necessarily have n vertices when p was too low. I fixed that in the patch too `:-)`\n\nNathann",
    "created_at": "2012-02-23T12:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141805",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:12'></a>Hellooooooo David !

Well, I don't think not being able to define the seed *as a parameter* of the function is so bad. As it works fine when you set it globally for the doctests anyway....

Now, here is a small patch with some modifications. It adds a few tests, check that the given method is "networkx" or "Sage" but nothing else (that's how we do it usually). I also added a "(Cython)" to the title of the new file you create. It makes more sense this way when you look at the documentation. Otherwise, you would have:
* Digraph generators
* Graph Generators
* Digraph and Graph generators
Now there is a "Cython" at the end of the third one, and there's some logic to it `:-)`

This being said, I added one test which does *not* pass... Here it is :

```
sage: from sage.graphs.graph_generators_pyx import RandomGNP
sage: abs(mean([RandomGNP(150,.2, fast = True).density() for i in range(30)])-.2) < .001
False 
```

It looks like there is some deviation with the "fast" algorithm, which does not occur with the usual one :

```
sage: sage: abs(mean([RandomGNP(200,.2).density() for i in range(30)])-.2)
0.000443886097152429
sage: sage: abs(mean([RandomGNP(200,.2, fast = True).density() for i in range(30)])-.2)
0.0163283739008691
```

Well, that's already 1% of edges too much. I don't think the deviation with the first algorithm is very bad (though for some reason it is always positive on my tests, and I do not like that), but I'm no big fan of the deviation for the second implementation
The "fast" algorithm is also.... *MUCH SLOWER* on most cases... Is it better than the other one in some interesting situations ?

Oh, and I also noticed that the graphs returned did not necessarily have n vertices when p was too low. I fixed that in the patch too `:-)`

Nathann



---

archive/issue_comments_141806.json:
```json
{
    "body": "<a id='comment:13'></a>Attachment [trac_12362-rev.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362-rev.patch) by @dcoudert created at 2012-02-23 13:17:40\n\nHello Nathann,\n\nThe ``fast`` method is expected to be faster for *large* and *sparse* graphs, e.g., ``N=10000`` and ``p=0.0001``. But even for such values, the standard method is already fast. Otherwise, the standard method is sufficient.\nSince I don't know how to solve the deviation problem you have pointed out (I'm not the designer of the algorithm) and that it is not so useful, I propose to simply remove it from the Cython RandomGNP function and from the RandomDirectedGNP function. For the ``graphs.RandomGNP`` function, the fast method of ``networkx`` has no deviation so we can let it.\n\nWe should also remove the tests with cputime. They are quite old and will differ from one computer to another.\n\nIf you agree with these proposition, I will prepare a rev-rev patch ;-)\n\nD.",
    "created_at": "2012-02-23T13:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141806",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:13'></a>Attachment [trac_12362-rev.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362-rev.patch) by @dcoudert created at 2012-02-23 13:17:40

Hello Nathann,

The ``fast`` method is expected to be faster for *large* and *sparse* graphs, e.g., ``N=10000`` and ``p=0.0001``. But even for such values, the standard method is already fast. Otherwise, the standard method is sufficient.
Since I don't know how to solve the deviation problem you have pointed out (I'm not the designer of the algorithm) and that it is not so useful, I propose to simply remove it from the Cython RandomGNP function and from the RandomDirectedGNP function. For the ``graphs.RandomGNP`` function, the fast method of ``networkx`` has no deviation so we can let it.

We should also remove the tests with cputime. They are quite old and will differ from one computer to another.

If you agree with these proposition, I will prepare a rev-rev patch ;-)

D.



---

archive/issue_comments_141807.json:
```json
{
    "body": "<a id='comment:14'></a>> If you agree with these proposition, I will prepare a rev-rev patch ;-)\n\n\n+1 `:-)`\n\nNathann",
    "created_at": "2012-02-23T13:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141807",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:14'></a>> If you agree with these proposition, I will prepare a rev-rev patch ;-)


+1 `:-)`

Nathann



---

archive/issue_comments_141808.json:
```json
{
    "body": "<a id='comment:15'></a>I have incorporated all proposed modification and updated some tests (mainly adding set_random_seed(0)).\n\nLet me know if it is better now.\n\nBest,\n\nD.",
    "created_at": "2012-02-23T13:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141808",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>I have incorporated all proposed modification and updated some tests (mainly adding set_random_seed(0)).

Let me know if it is better now.

Best,

D.



---

archive/issue_comments_141809.json:
```json
{
    "body": "<a id='comment:16'></a>> Let me know if it is better now.\n\n\nWell.. I see nothing wrong with it, now `:-)`\n\nIf you are fine with all that, you can set the ticket to \"positive review\". It looks good to me ! `:-)` \n\nNathann",
    "created_at": "2012-02-23T14:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141809",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:16'></a>> Let me know if it is better now.


Well.. I see nothing wrong with it, now `:-)`

If you are fine with all that, you can set the ticket to "positive review". It looks good to me ! `:-)` 

Nathann



---

archive/issue_comments_141810.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-23T14:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141810",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_141811.json:
```json
{
    "body": "<a id='comment:18'></a>Thank you for your help Nathann. The gnp generator for digraphs is now reasonably fast. \n\nOther contributors can propose a suitable implementation of the fast algorithm for digraphs.\n\nOne more patch for sage-5 ;-)\n\nD.",
    "created_at": "2012-02-23T14:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141811",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'></a>Thank you for your help Nathann. The gnp generator for digraphs is now reasonably fast. 

Other contributors can propose a suitable implementation of the fast algorithm for digraphs.

One more patch for sage-5 ;-)

D.



---

archive/issue_comments_141812.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-03-01T17:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141812",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_141813.json:
```json
{
    "body": "<a id='comment:20'></a>On sage.math, this causes a doctest timeout:\n\n```\nThe following tests failed:\n\n\n        sage -t --verbose --long -force_lib \"devel/sage/sage/graphs/generic_graph.py\" # Time out\nTotal time for all tests: 1800.5 seconds\n```",
    "created_at": "2012-03-01T17:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141813",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>On sage.math, this causes a doctest timeout:

```
The following tests failed:


        sage -t --verbose --long -force_lib "devel/sage/sage/graphs/generic_graph.py" # Time out
Total time for all tests: 1800.5 seconds
```



---

archive/issue_comments_141814.json:
```json
{
    "body": "Attachment [trac_12362-rev-rev.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362-rev-rev.patch) by @dcoudert created at 2012-03-01 21:01:56",
    "created_at": "2012-03-01T21:01:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141814",
    "user": "https://github.com/dcoudert"
}
```

Attachment [trac_12362-rev-rev.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362-rev-rev.patch) by @dcoudert created at 2012-03-01 21:01:56



---

archive/issue_comments_141815.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-01T21:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141815",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_141816.json:
```json
{
    "body": "<a id='comment:21'></a>The problem was in test results in function `is_isomorphic` on random digraphs. \nThe problem is fixed and the patch pass the tests successfully on my computer (with 5.0 beta6).\n\nLet's hope this patch will not cause further problems.\n\nD.",
    "created_at": "2012-03-01T21:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141816",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:21'></a>The problem was in test results in function `is_isomorphic` on random digraphs. 
The problem is fixed and the patch pass the tests successfully on my computer (with 5.0 beta6).

Let's hope this patch will not cause further problems.

D.



---

archive/issue_comments_141817.json:
```json
{
    "body": "<a id='comment:22'></a>Hellooooooooooo !!!!\n\nOn my machine I was also getting a timeout when running the doctests with the -long flag. It was caused by the edge_disjoint_spanning_trees method, for which the \"random digraph\" returned by the new random graph generator was a bad instance.\n\nThere actually was not any problem, short of the fact that GLPK was having a hard time. The problem did not occur when CPLEX was installed which is probably why it did not happen on your computer.\n\nThe small patch I add does the following :\n1) changes the value of epsilon from 1/10*n to 1/3*n\n2) adds a verification at the end of edge_disjoint_spanning_tree so that we aresure the answers computed by the LP solver are correct.\n\nTheoretically speaking, setting epsilon to 1/2*n is sufficient, but I often set the value to something smaller \"just to be sure\". 1/10*n seems to be a bit too low, and for this reason GLPK had a hard time finding the solutions. It would have found it eventually, but with a low value of epsilon it has more branches to explore.\n\nSo, with this small patch I am adding the value of epsilon goes to 1/3, which is till more than necessary and should not cause any problem. And \"just to be sure\", I also added a test at the end of the function, to ensure that the results returned are indeed correct (that each graph is connected).\n\nIt passes all long tests on my machine, is faster than before, and \"if you agree with those new modifications [...]\" `:-)`\n\nNathann",
    "created_at": "2012-03-04T14:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141817",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:22'></a>Hellooooooooooo !!!!

On my machine I was also getting a timeout when running the doctests with the -long flag. It was caused by the edge_disjoint_spanning_trees method, for which the "random digraph" returned by the new random graph generator was a bad instance.

There actually was not any problem, short of the fact that GLPK was having a hard time. The problem did not occur when CPLEX was installed which is probably why it did not happen on your computer.

The small patch I add does the following :
1) changes the value of epsilon from 1/10*n to 1/3*n
2) adds a verification at the end of edge_disjoint_spanning_tree so that we aresure the answers computed by the LP solver are correct.

Theoretically speaking, setting epsilon to 1/2*n is sufficient, but I often set the value to something smaller "just to be sure". 1/10*n seems to be a bit too low, and for this reason GLPK had a hard time finding the solutions. It would have found it eventually, but with a low value of epsilon it has more branches to explore.

So, with this small patch I am adding the value of epsilon goes to 1/3, which is till more than necessary and should not cause any problem. And "just to be sure", I also added a test at the end of the function, to ensure that the results returned are indeed correct (that each graph is connected).

It passes all long tests on my machine, is faster than before, and "if you agree with those new modifications [...]" `:-)`

Nathann



---

archive/issue_comments_141818.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-04T15:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141818",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_141819.json:
```json
{
    "body": "<a id='comment:24'></a>I would not have been able to find this problem alone. Thanks Nathann.\n\nWith your extra patch: installation OK, short/long tests OK, docbuild OK.\n\nI think it's now good to go...",
    "created_at": "2012-03-04T15:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141819",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:24'></a>I would not have been able to find this problem alone. Thanks Nathann.

With your extra patch: installation OK, short/long tests OK, docbuild OK.

I think it's now good to go...



---

archive/issue_comments_141820.json:
```json
{
    "body": "<a id='comment:25'></a>oups sorry, I see some \"trailing spaces\" in the file :(",
    "created_at": "2012-03-04T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141820",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:25'></a>oups sorry, I see some "trailing spaces" in the file :(



---

archive/issue_comments_141821.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-03-04T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141821",
    "user": "https://github.com/dcoudert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_141822.json:
```json
{
    "body": "<a id='comment:26'></a>> oups sorry, I see some \"trailing spaces\" in the file :(\n\n\nNow with *less* trailing spaces in the file. Actually, without the trailing spaces from the function I touched.\n\nThe point with trailing spaces is that there shold not be any, but that whenever a file like generic_graph is massively modified (for instance if all trailing spaces were to be removed at once) the guys from Sage combinat would have to rebase they monstruous patch queue immediately. They already threatened several times to kill me if I ever did that `:-P`\n\nNathann",
    "created_at": "2012-03-04T16:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141822",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:26'></a>> oups sorry, I see some "trailing spaces" in the file :(


Now with *less* trailing spaces in the file. Actually, without the trailing spaces from the function I touched.

The point with trailing spaces is that there shold not be any, but that whenever a file like generic_graph is massively modified (for instance if all trailing spaces were to be removed at once) the guys from Sage combinat would have to rebase they monstruous patch queue immediately. They already threatened several times to kill me if I ever did that `:-P`

Nathann



---

archive/issue_comments_141823.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-04T16:00:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141823",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_141824.json:
```json
{
    "body": "<a id='comment:27'></a>That's much better ! For me the patch is ready to do :))\n\nD.",
    "created_at": "2012-03-04T17:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141824",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:27'></a>That's much better ! For me the patch is ready to do :))

D.



---

archive/issue_comments_141825.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-04T17:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141825",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_141826.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-03-12T13:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141826",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_141827.json:
```json
{
    "body": "<a id='comment:28'></a>On hawk, this yields\n\n```\nsage -t  --long -force_lib devel/sage/sage/graphs/generic_graph.py\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta8/devel/sage-main/sage/graphs/generic_graph.py\", line 5830:\n    sage: g.flow(0,1, method=\"FF\") == g.flow(0,1,method=\"LP\")\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\nThis is probably a bug uncovered by this patch, rather than caused by this patch.  But anyway, it should be looked at.",
    "created_at": "2012-03-12T13:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141827",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>On hawk, this yields

```
sage -t  --long -force_lib devel/sage/sage/graphs/generic_graph.py
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-5.0.beta8/devel/sage-main/sage/graphs/generic_graph.py", line 5830:
    sage: g.flow(0,1, method="FF") == g.flow(0,1,method="LP")
Expected:
    True
Got:
    False
**********************************************************************
```

This is probably a bug uncovered by this patch, rather than caused by this patch.  But anyway, it should be looked at.



---

archive/issue_comments_141828.json:
```json
{
    "body": "<a id='comment:29'></a>Updated ! It must be because of some numerical noise on that machine. Actually, this doctest breaks when the CBC package is installed too, for the same reason. Let it be fixed with the updated version of ``trac_12362-edge_disjoint_spanning_tree.patch``.\n\nNathann",
    "created_at": "2012-03-14T13:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141828",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:29'></a>Updated ! It must be because of some numerical noise on that machine. Actually, this doctest breaks when the CBC package is installed too, for the same reason. Let it be fixed with the updated version of ``trac_12362-edge_disjoint_spanning_tree.patch``.

Nathann



---

archive/issue_comments_141829.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-14T13:06:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141829",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_141830.json:
```json
{
    "body": "Attachment [trac_12362-edge_disjoint_spanning_tree.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362-edge_disjoint_spanning_tree.patch) by @nathanncohen created at 2012-03-14 13:06:42",
    "created_at": "2012-03-14T13:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141830",
    "user": "https://github.com/nathanncohen"
}
```

Attachment [trac_12362-edge_disjoint_spanning_tree.patch](tarball://root/attachments/some-uuid/ticket12362/trac_12362-edge_disjoint_spanning_tree.patch) by @nathanncohen created at 2012-03-14 13:06:42



---

archive/issue_comments_141831.json:
```json
{
    "body": "<a id='comment:30'></a>The patch works perfectly with sage-5.0.beta7 on my computer. Tests are also OK.\n\n```\ncompote:~/Soft/sage-5.0.beta7> ./sage -t --long -force_lib generic_graph.py\nsage -t --long -force_lib \"devel/sage-myclone/sage/graphs/generic_graph.py\"\n         [74.6 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 74.6 seconds\n```\nThe long tests are also OK for all .py and .pyx files of `sage/graphs/`.\n\nThanks Nathann for last update.\n\nD.",
    "created_at": "2012-03-14T21:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141831",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:30'></a>The patch works perfectly with sage-5.0.beta7 on my computer. Tests are also OK.

```
compote:~/Soft/sage-5.0.beta7> ./sage -t --long -force_lib generic_graph.py
sage -t --long -force_lib "devel/sage-myclone/sage/graphs/generic_graph.py"
         [74.6 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 74.6 seconds
```
The long tests are also OK for all .py and .pyx files of `sage/graphs/`.

Thanks Nathann for last update.

D.



---

archive/issue_comments_141832.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-14T21:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141832",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_141833.json:
```json
{
    "body": "<a id='comment:31'></a>Long tests are also OK on a fresh new install of sage-5.0.beta8.\n\n```\ncompote:~/sage-5.0.beta8> ./sage -t --long -force_lib devel/sage-myclone/sage/graphs/generic_graph.py\nsage -t --long -force_lib \"devel/sage-myclone/sage/graphs/generic_graph.py\"\n         [75.5 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 75.5 seconds\n```",
    "created_at": "2012-03-15T12:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141833",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:31'></a>Long tests are also OK on a fresh new install of sage-5.0.beta8.

```
compote:~/sage-5.0.beta8> ./sage -t --long -force_lib devel/sage-myclone/sage/graphs/generic_graph.py
sage -t --long -force_lib "devel/sage-myclone/sage/graphs/generic_graph.py"
         [75.5 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 75.5 seconds
```



---

archive/issue_comments_141834.json:
```json
{
    "body": "<a id='comment:32'></a>Nathann,\n\nI don't know if it is a requirement, but there is no ticket number inside files trac_12362-rev.patch and trac_12362-edge_disjoint_spanning_tree.patch\n\n```\n# HG changeset patch\n# User Nathann Cohen <nathann.cohen@gmail.com>\n# Date 1329999818 -3600\n# Node ID 283e6da5d8af82c7d8b8ae19c16572d55ca06e08\n# Parent  34d93e382b071f0f17bb633c6168c1950d901fde\nImprovement of GNP generators for graphs and digraphs -- Cython\n\ndiff --git a/module_list.py b/module_list.py\n```\nBest,\nD.",
    "created_at": "2012-03-17T10:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141834",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:32'></a>Nathann,

I don't know if it is a requirement, but there is no ticket number inside files trac_12362-rev.patch and trac_12362-edge_disjoint_spanning_tree.patch

```
# HG changeset patch
# User Nathann Cohen <nathann.cohen@gmail.com>
# Date 1329999818 -3600
# Node ID 283e6da5d8af82c7d8b8ae19c16572d55ca06e08
# Parent  34d93e382b071f0f17bb633c6168c1950d901fde
Improvement of GNP generators for graphs and digraphs -- Cython

diff --git a/module_list.py b/module_list.py
```
Best,
D.



---

archive/issue_comments_141835.json:
```json
{
    "body": "<a id='comment:33'></a>> I don't know if it is a requirement, but there is no ticket number inside files trac_12362-rev.patch and trac_12362-edge_disjoint_spanning_tree.patch\n\n\nThat's a very controversial point in Sage development `:-D`\n\nIf I did not miss the latest updates, the moral is : it used to be a requirement, and it is now done automatically with scripts. If you put it anyway Jeroen will remove it himself, but you spare him that if you do not add it. But these things changes faster than lightning `:-)`\n\nBy the way, have you ever played the role of mentor in a \"Google Summer of Code\" project ? Looks like two people asked to participate in one for Sage : the first about Graphs, the other with LP... I should really work on my application right now, but I still must think f that too O_o;;;\n\nNathann",
    "created_at": "2012-03-17T10:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141835",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:33'></a>> I don't know if it is a requirement, but there is no ticket number inside files trac_12362-rev.patch and trac_12362-edge_disjoint_spanning_tree.patch


That's a very controversial point in Sage development `:-D`

If I did not miss the latest updates, the moral is : it used to be a requirement, and it is now done automatically with scripts. If you put it anyway Jeroen will remove it himself, but you spare him that if you do not add it. But these things changes faster than lightning `:-)`

By the way, have you ever played the role of mentor in a "Google Summer of Code" project ? Looks like two people asked to participate in one for Sage : the first about Graphs, the other with LP... I should really work on my application right now, but I still must think f that too O_o;;;

Nathann



---

archive/issue_comments_141836.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 ncohen]:\n> it used to be a requirement, and it is now done automatically with scripts.\n\nExactly.\n\n> If you put it anyway Jeroen will remove it himself\n\nThat's false.  If you put it anyway, you end up with a commit message like\n\n```\nTrac #12362: #12362: foo bar\n```",
    "created_at": "2012-03-17T13:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141836",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>Replying to [comment:33 ncohen]:
> it used to be a requirement, and it is now done automatically with scripts.

Exactly.

> If you put it anyway Jeroen will remove it himself

That's false.  If you put it anyway, you end up with a commit message like

```
Trac #12362: #12362: foo bar
```



---

archive/issue_comments_141837.json:
```json
{
    "body": "<a id='comment:35'></a>OK, so let me know if I have something to do.\n\nBest,\n\nDavid.",
    "created_at": "2012-03-17T13:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141837",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:35'></a>OK, so let me know if I have something to do.

Best,

David.



---

archive/issue_events_033125.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-21T22:08:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12362#event-33125"
}
```



---

archive/issue_comments_141838.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-21T22:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141838",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_141839.json:
```json
{
    "body": "<a id='comment:37'></a>This patch is bad.\n\nBefore:\n\n```\nsage: timeit('graphs.RandomGNP(2000, .01)')\n5 loops, best of 3: 263 ms per loop\n```\n\nAfter:\n\n```\nsage: timeit('graphs.RandomGNP(2000, .01)')\n5 loops, best of 3: 3.73 s per loop\n```",
    "created_at": "2012-04-28T14:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141839",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>This patch is bad.

Before:

```
sage: timeit('graphs.RandomGNP(2000, .01)')
5 loops, best of 3: 263 ms per loop
```

After:

```
sage: timeit('graphs.RandomGNP(2000, .01)')
5 loops, best of 3: 3.73 s per loop
```



---

archive/issue_comments_141840.json:
```json
{
    "body": "<a id='comment:38'></a>OOch `O_O;;;;`\n\nDavid ? You know where that comes from ? `O_o;;;;`\n\nNathann",
    "created_at": "2012-04-28T14:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141840",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:38'></a>OOch `O_O;;;;`

David ? You know where that comes from ? `O_o;;;;`

Nathann



---

archive/issue_comments_141841.json:
```json
{
    "body": "<a id='comment:39'></a>Well, actually our own code is still faster....\n\n```\nsage: %timeit graphs.RandomGNP(2000,.01, method=\"Sage\")\n5 loops, best of 3: 157 ms per loop\n```\n\nBut did something change with networkx since ? `O_o`",
    "created_at": "2012-04-28T14:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141841",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:39'></a>Well, actually our own code is still faster....

```
sage: %timeit graphs.RandomGNP(2000,.01, method="Sage")
5 loops, best of 3: 157 ms per loop
```

But did something change with networkx since ? `O_o`



---

archive/issue_comments_141842.json:
```json
{
    "body": "<a id='comment:40'></a>Hello,\n\nthe default method is networkx (as before this patch) and so when used with default parameters this patch has no impact on the running time.  When I wrote this patch, we decided to let networkx as default algorithm because the running time was faster with new method only for large graphs.\n\nSomething has changed with networkx. It is now surprisingly slow...\n\n```\nsage: %timeit networkx.gnp_random_graph(2000,0.01)\n5 loops, best of 3: 4.31 s per loop\nsage: %timeit graphs.RandomGNP(2000, .01, method='networkx')\n5 loops, best of 3: 4.47 s per loop\nsage: %timeit Graph(networkx.gnp_random_graph(2000,0.01))\n5 loops, best of 3: 4.49 s per loop\nsage: %timeit graphs.RandomGNP(2000, .01, method='Sage')\n5 loops, best of 3: 173 ms per loop\nsage:\nsage: %timeit graphs.RandomGNP(100, .01, method='networkx')\n25 loops, best of 3: 11.2 ms per loop\nsage: %timeit graphs.RandomGNP(100, .01, method='Sage')\n625 loops, best of 3: 659 \u00b5s per loop\n```\n\nIf we are unable to find why networkx is now slow, we can open a ticket to put Sage as default algorithm.\n\nFor directed graphs, our implementation was always faster than networkx, and so we removed the networkx one.",
    "created_at": "2012-04-28T15:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141842",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:40'></a>Hello,

the default method is networkx (as before this patch) and so when used with default parameters this patch has no impact on the running time.  When I wrote this patch, we decided to let networkx as default algorithm because the running time was faster with new method only for large graphs.

Something has changed with networkx. It is now surprisingly slow...

```
sage: %timeit networkx.gnp_random_graph(2000,0.01)
5 loops, best of 3: 4.31 s per loop
sage: %timeit graphs.RandomGNP(2000, .01, method='networkx')
5 loops, best of 3: 4.47 s per loop
sage: %timeit Graph(networkx.gnp_random_graph(2000,0.01))
5 loops, best of 3: 4.49 s per loop
sage: %timeit graphs.RandomGNP(2000, .01, method='Sage')
5 loops, best of 3: 173 ms per loop
sage:
sage: %timeit graphs.RandomGNP(100, .01, method='networkx')
25 loops, best of 3: 11.2 ms per loop
sage: %timeit graphs.RandomGNP(100, .01, method='Sage')
625 loops, best of 3: 659 µs per loop
```

If we are unable to find why networkx is now slow, we can open a ticket to put Sage as default algorithm.

For directed graphs, our implementation was always faster than networkx, and so we removed the networkx one.



---

archive/issue_comments_141843.json:
```json
{
    "body": "<a id='comment:41'></a>Yeah, something must have changed in networkx, but the last update seems to be 1.2 a veeeeeeery long time ago. Where the hell does this come from ? `O_o`",
    "created_at": "2012-04-28T15:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141843",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:41'></a>Yeah, something must have changed in networkx, but the last update seems to be 1.2 a veeeeeeery long time ago. Where the hell does this come from ? `O_o`



---

archive/issue_comments_141844.json:
```json
{
    "body": "<a id='comment:42'></a>Here's the code of RandomGNP in beta8 \n\n```\n        if seed is None:\n            seed = current_randstate().long_seed()\n        if p == 1:\n            return graphs.CompleteGraph(n)\n        import networkx\n        if fast:\n            G = networkx.fast_gnp_random_graph(n, p, seed=seed)\n        else:\n            G = networkx.gnp_random_graph(n, p, seed=seed)\n        return graph.Graph(G)\n```\nand in beta14\n\n```\n        if n < 0:\n            raise ValueError(\"The number of nodes must be positive or null.\")\n        if 0.0 > p or 1.0 < p:\n            raise ValueError(\"The probability p must be in [0..1].\")\n\n        if seed is None:\n            seed = current_randstate().long_seed()\n        if p == 1:\n            return graphs.CompleteGraph(n)\n\n        if method == 'networkx':\n            import networkx\n            if fast:\n                G = networkx.fast_gnp_random_graph(n, p, seed=seed)\n            else:\n                G = networkx.gnp_random_graph(n, p, seed=seed)\n            return graph.Graph(G)\n        elif method == \"Sage\":\n            # We use the Sage generator\n            from sage.graphs.graph_generators_pyx import RandomGNP as sageGNP\n            return sageGNP(n, p)\n        else:\n            raise ValueError(\"'method' must be equal to 'networkx' or to 'Sage'.\")\n```",
    "created_at": "2012-04-28T15:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141844",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:42'></a>Here's the code of RandomGNP in beta8 

```
        if seed is None:
            seed = current_randstate().long_seed()
        if p == 1:
            return graphs.CompleteGraph(n)
        import networkx
        if fast:
            G = networkx.fast_gnp_random_graph(n, p, seed=seed)
        else:
            G = networkx.gnp_random_graph(n, p, seed=seed)
        return graph.Graph(G)
```
and in beta14

```
        if n < 0:
            raise ValueError("The number of nodes must be positive or null.")
        if 0.0 > p or 1.0 < p:
            raise ValueError("The probability p must be in [0..1].")

        if seed is None:
            seed = current_randstate().long_seed()
        if p == 1:
            return graphs.CompleteGraph(n)

        if method == 'networkx':
            import networkx
            if fast:
                G = networkx.fast_gnp_random_graph(n, p, seed=seed)
            else:
                G = networkx.gnp_random_graph(n, p, seed=seed)
            return graph.Graph(G)
        elif method == "Sage":
            # We use the Sage generator
            from sage.graphs.graph_generators_pyx import RandomGNP as sageGNP
            return sageGNP(n, p)
        else:
            raise ValueError("'method' must be equal to 'networkx' or to 'Sage'.")
```



---

archive/issue_comments_141845.json:
```json
{
    "body": "<a id='comment:43'></a>GOT IT !!!!\n\nThe flag \"fast\" used to be \"True\", it is now \"False\". We set it to False because our \"fast\" algorithm is slower than the usual one, so for the Sage algorithm it is better to set it to False.\nFor networkx, however, it is much better to use the \"Fast\" version, and so the default value has to be set to \"True\" again, as the default method is networkx !\n\nNathann",
    "created_at": "2012-04-28T15:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141845",
    "user": "https://github.com/nathanncohen"
}
```

<a id='comment:43'></a>GOT IT !!!!

The flag "fast" used to be "True", it is now "False". We set it to False because our "fast" algorithm is slower than the usual one, so for the Sage algorithm it is better to set it to False.
For networkx, however, it is much better to use the "Fast" version, and so the default value has to be set to "True" again, as the default method is networkx !

Nathann



---

archive/issue_comments_141846.json:
```json
{
    "body": "<a id='comment:44'></a>Bravo !\n\n```\nsage: %timeit graphs.RandomGNP(2000, .01, method='networkx', fast = True)\n5 loops, best of 3: 234 ms per loop\nsage: %timeit graphs.RandomGNP(2000, .01, method='Sage')\n5 loops, best of 3: 163 ms per loop\nsage: %timeit graphs.RandomGNP(2000, .001, method='networkx', fast = True)\n25 loops, best of 3: 27.7 ms per loop\nsage: %timeit graphs.RandomGNP(2000, .001, method='Sage')\n5 loops, best of 3: 50.2 ms per loop\nsage: %timeit graphs.RandomGNP(2000, .1, method='networkx', fast = True)\n5 loops, best of 3: 2.38 s per loop\nsage: %timeit graphs.RandomGNP(2000, .1, method='Sage')\n5 loops, best of 3: 1.33 s per loop\n```\n\nI will open a new ticket to correct this. Sorry.\n\nA remaining question is which should be the default algorithm. Apparently, the Sage implementation is often faster than the networkx one, except for large sparse graphs\n\n```\nsage: %timeit graphs.RandomGNP(10000, 0.001, method='Sage')\n5 loops, best of 3: 1.21 s per loop\nsage: %timeit graphs.RandomGNP(10000, 0.001, method='networkx', fast = True)\n5 loops, best of 3: 612 ms per loop\nsage: %timeit graphs.RandomGNP(10000, 0.01, method='Sage')\n5 loops, best of 3: 4.17 s per loop\nsage: %timeit graphs.RandomGNP(10000, 0.01, method='networkx', fast = True)\n5 loops, best of 3: 6.09 s per loop\n```",
    "created_at": "2012-04-28T18:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12362",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12362#issuecomment-141846",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:44'></a>Bravo !

```
sage: %timeit graphs.RandomGNP(2000, .01, method='networkx', fast = True)
5 loops, best of 3: 234 ms per loop
sage: %timeit graphs.RandomGNP(2000, .01, method='Sage')
5 loops, best of 3: 163 ms per loop
sage: %timeit graphs.RandomGNP(2000, .001, method='networkx', fast = True)
25 loops, best of 3: 27.7 ms per loop
sage: %timeit graphs.RandomGNP(2000, .001, method='Sage')
5 loops, best of 3: 50.2 ms per loop
sage: %timeit graphs.RandomGNP(2000, .1, method='networkx', fast = True)
5 loops, best of 3: 2.38 s per loop
sage: %timeit graphs.RandomGNP(2000, .1, method='Sage')
5 loops, best of 3: 1.33 s per loop
```

I will open a new ticket to correct this. Sorry.

A remaining question is which should be the default algorithm. Apparently, the Sage implementation is often faster than the networkx one, except for large sparse graphs

```
sage: %timeit graphs.RandomGNP(10000, 0.001, method='Sage')
5 loops, best of 3: 1.21 s per loop
sage: %timeit graphs.RandomGNP(10000, 0.001, method='networkx', fast = True)
5 loops, best of 3: 612 ms per loop
sage: %timeit graphs.RandomGNP(10000, 0.01, method='Sage')
5 loops, best of 3: 4.17 s per loop
sage: %timeit graphs.RandomGNP(10000, 0.01, method='networkx', fast = True)
5 loops, best of 3: 6.09 s per loop
```
