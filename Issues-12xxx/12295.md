# Issue 12295: maple interface broken

archive/issues_012123.json:
```json
{
    "assignees": [],
    "body": "With sage-4.7 (and maple 14) it works:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.7, Release Date: 2011-05-23                         |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: maple('1+1')\n2\nsage:\n```\n\nBut with 4.7.2 all maple commands end in this traceback:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.7.2, Release Date: 2011-10-29                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nsage: maple('1+1')\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (17, 0))\n\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/home/luther/<ipython console> in <module>()\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in __call__(self, arg)\n    550 \n    551             # and now call a possibly user-defined print mechanism\n--> 552             manipulated_val = self.display(arg)\n    553             \n    554             # user display hooks can change the variable to be stored in\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in _display(self, arg)\n    576             return IPython.generics.result_display(arg)\n    577         except TryNext:            \n--> 578             return self.shell.hooks.result_display(arg)\n    579 \n    580     # Assign the default display method:\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/hooks.pyc in __call__(self, *args, **kw)\n    139             #print \"prio\",prio,\"cmd\",cmd #dbg\n    140             try:\n--> 141                 ret = cmd(*args, **kw)\n    142                 return ret\n    143             except ipapi.TryNext, exc:\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in result_display(ip_self, obj)\n    148     # IPython's default result_display() uses the IPython.genutils.Term.cout stream.\n    149     # See also local/lib/python2.6/site-packages/IPython/hooks.py.\n--> 150     print_obj(IPython.genutils.Term.cout, obj)\n    151 \n    152 def displayhook(obj):\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in print_obj(out_stream, obj)\n    140             if _check_tall_list_and_print(out_stream, obj):\n    141                 return\n--> 142     print >>out_stream, `obj`\n    143 \n    144 def result_display(ip_self, obj):\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in __repr__(self)\n   1056         \"\"\"\n   1057         self._check_valid()\n-> 1058         return self.parent().get(self._name)\n   1059 \n   1060     def _latex_(self):\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in get(self, var)\n    609             '2'\n    610         \"\"\"\n--> 611         s = self.eval('printf(\"%%q\",%s)'%var)\n    612         return s\n    613 \n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)\n   1034                 if (split_lines is \"nofile\" and allow_use_file and\n   1035                         self._eval_using_file_cutoff and len(code) > self._eval_using_file_cutoff):\n-> 1036                     return self._eval_line_using_file(code)\n   1037                 elif split_lines:\n   1038                     return '\\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in _eval_line_using_file(self, line)\n    653             tmp_to_use = self._remote_tmpfile()\n    654         try:\n--> 655             s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False)\n    656         except pexpect.EOF, msg:\n    657             if self._quit_string() in line:\n\n/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt)\n    559                 e.expect('__sage__;')\n    560                 e.expect(self._prompt)            \n--> 561                 raise RuntimeError, \"An error occurred running a Maple command:\\nINPUT:\\n%s\\nOUTPUT:\\n%s\"%(line, z)\n    562         return z\n    563 \n\nRuntimeError: An error occurred running a Maple command:\nINPUT:\nread \"/home/luther/.sage//temp/dirac/18306//interface//tmp18309\";\nOUTPUT:\non line 2, unexpected end of input\nError, while reading\n`/home/luther/.sage//temp/dirac/18306//interface//tmp18309`\n```\n\n\nsee also #2120, #11288\n\nAssignee: **@williamstein**\n\nKeywords: **maple interface**\n\nBranch/Commit: **[a8321cc](https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton, Volker Braun**\n\nAuthor: **J Miguel Farto**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12295_\n\n",
    "closed_at": "2014-09-27T12:57:12Z",
    "created_at": "2012-01-11T13:46:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "maple interface broken",
    "type": "issue",
    "updated_at": "2014-09-27T12:57:12Z",
    "url": "https://github.com/sagemath/sage/issues/12295",
    "user": "https://github.com/sagetrac-sluther"
}
```
With sage-4.7 (and maple 14) it works:

```
----------------------------------------------------------------------
| Sage Version 4.7, Release Date: 2011-05-23                         |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: maple('1+1')
2
sage:
```

But with 4.7.2 all maple commands end in this traceback:

```
----------------------------------------------------------------------
| Sage Version 4.7.2, Release Date: 2011-10-29                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
sage: maple('1+1')
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (17, 0))

---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/home/luther/<ipython console> in <module>()

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in __call__(self, arg)
    550 
    551             # and now call a possibly user-defined print mechanism
--> 552             manipulated_val = self.display(arg)
    553             
    554             # user display hooks can change the variable to be stored in

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/Prompts.pyc in _display(self, arg)
    576             return IPython.generics.result_display(arg)
    577         except TryNext:            
--> 578             return self.shell.hooks.result_display(arg)
    579 
    580     # Assign the default display method:

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/IPython/hooks.pyc in __call__(self, *args, **kw)
    139             #print "prio",prio,"cmd",cmd #dbg
    140             try:
--> 141                 ret = cmd(*args, **kw)
    142                 return ret
    143             except ipapi.TryNext, exc:

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in result_display(ip_self, obj)
    148     # IPython's default result_display() uses the IPython.genutils.Term.cout stream.
    149     # See also local/lib/python2.6/site-packages/IPython/hooks.py.
--> 150     print_obj(IPython.genutils.Term.cout, obj)
    151 
    152 def displayhook(obj):

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/misc/displayhook.pyc in print_obj(out_stream, obj)
    140             if _check_tall_list_and_print(out_stream, obj):
    141                 return
--> 142     print >>out_stream, `obj`
    143 
    144 def result_display(ip_self, obj):

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in __repr__(self)
   1056         """
   1057         self._check_valid()
-> 1058         return self.parent().get(self._name)
   1059 
   1060     def _latex_(self):

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in get(self, var)
    609             '2'
    610         """
--> 611         s = self.eval('printf("%%q",%s)'%var)
    612         return s
    613 

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in eval(self, code, strip, synchronize, locals, allow_use_file, split_lines, **kwds)
   1034                 if (split_lines is "nofile" and allow_use_file and
   1035                         self._eval_using_file_cutoff and len(code) > self._eval_using_file_cutoff):
-> 1036                     return self._eval_line_using_file(code)
   1037                 elif split_lines:
   1038                     return '\n'.join([self._eval_line(L, allow_use_file=allow_use_file, **kwds)

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/expect.pyc in _eval_line_using_file(self, line)
    653             tmp_to_use = self._remote_tmpfile()
    654         try:
--> 655             s = self._eval_line(self._read_in_file_command(tmp_to_use), allow_use_file=False)
    656         except pexpect.EOF, msg:
    657             if self._quit_string() in line:

/home/luther/sage-4.7.2-linux-64bit-ubuntu_10.04.3_lts-x86_64-Linux/local/lib/python2.6/site-packages/sage/interfaces/maple.pyc in _eval_line(self, line, allow_use_file, wait_for_prompt)
    559                 e.expect('__sage__;')
    560                 e.expect(self._prompt)            
--> 561                 raise RuntimeError, "An error occurred running a Maple command:\nINPUT:\n%s\nOUTPUT:\n%s"%(line, z)
    562         return z
    563 

RuntimeError: An error occurred running a Maple command:
INPUT:
read "/home/luther/.sage//temp/dirac/18306//interface//tmp18309";
OUTPUT:
on line 2, unexpected end of input
Error, while reading
`/home/luther/.sage//temp/dirac/18306//interface//tmp18309`
```


see also #2120, #11288

Assignee: **@williamstein**

Keywords: **maple interface**

Branch/Commit: **[a8321cc](https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544)**

Reviewer: **Frédéric Chapoton, Volker Braun**

Author: **J Miguel Farto**

_Issue created by migration from https://trac.sagemath.org/ticket/12295_





---

archive/issue_events_153064.json:
```json
{
    "actor": "https://github.com/sagetrac-sluther",
    "created_at": "2012-01-11T13:46:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153064"
}
```



---

archive/issue_events_153065.json:
```json
{
    "actor": "https://github.com/sagetrac-sluther",
    "created_at": "2012-01-11T13:46:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "component: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153065"
}
```



---

archive/issue_events_153066.json:
```json
{
    "actor": "https://github.com/sagetrac-sluther",
    "created_at": "2012-01-11T13:46:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153066"
}
```



---

archive/issue_events_153067.json:
```json
{
    "actor": "https://github.com/sagetrac-sluther",
    "created_at": "2012-01-11T13:46:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153067"
}
```



---

archive/issue_comments_135348.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\n* **Patch to apply:** trac-12295-maple_interface_20130115.patch\n* **Versions:**\n  * Sage 5.6\n  * Maple 13\n  * Linux Mint 14 cinnamon edition x86_64\n* **Dependencies:** None\n* **Causes:** \n  1. Maple command line interface automatically breaks input lines so pexpect interface sometimes fails (e.g. when the Sage user's home has a *long* route).\n  2. When this is fixed, a new bug appears because the method sage.interfaces.maple.Maple._eval_line_using_file did not manage the Maple's \";\"-stuff.\n  3. When these bugs are corrected, a new issue appears in sage.interfaces.maple.Maple._keyboard_interrupt. If we expect two maple prompts, the interface freezes when hitting ctrl-c once to stop a long calculation.\n* **Fixes:**\n  The Maple command passed to sage.interfaces.expect.Expect contains now a Maple configuration command.\n    1. Now, Maple command line interface does not break input lines.\n    2. When an Maple syntax error occurs, the command line interface does not enter in edit mode. Thus, we are not restricted to only use the expect file interface.\n* **Additional changes:**\n    1. The method sage.interfaces.maple.Maple.clear was modified to provide a standard way to eventually *clear* a Maple variable.\n    2. Some docstrings are changed to pass the doctests.\n    3. A docstring is changed in sage.symbolic.integration.integral to pass the tests of Ticket #2120\n* **Related tickets:** The issues of Tickets #2120 and #1465 could be also fixed with this patch, but not sure.\n* **Tests passed:**\n\n  ```\n  sage -coverage devel/sage-maple/sage/interfaces/maple.py\n  sage -t -optional devel/sage-maple/sage/interfaces/maple.py\n  sage -t --only-optional=maple devel/sage-maple/sage/interfaces/maple.py\n  sage -t --only-optional=maple devel/sage/sage/symbolic/expression.pyx  \n  sage -t --only-optional=maple devel/sage/sage/symbolic/integration/integral.py\n  sage -t --only-optional=maple devel/sage/sage/calculus/calculus.py\n  sage -t --only-optional=maple devel/sage/sage/misc/functional.py\n  sage -t --only-optional=maple devel/sage/sage/tests/benchmark.py\n  sage -t --only-optional=maple devel/sage/sage/interfaces/maple.py\n  sage --testall --long\n  sage -docbuild reference html\n  sage -docbuild reference pdf\n  ```",
    "created_at": "2013-02-15T15:38:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135348",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

<div id="comment:1" align="right">Comment 1</div>

* **Patch to apply:** trac-12295-maple_interface_20130115.patch
* **Versions:**
  * Sage 5.6
  * Maple 13
  * Linux Mint 14 cinnamon edition x86_64
* **Dependencies:** None
* **Causes:** 
  1. Maple command line interface automatically breaks input lines so pexpect interface sometimes fails (e.g. when the Sage user's home has a *long* route).
  2. When this is fixed, a new bug appears because the method sage.interfaces.maple.Maple._eval_line_using_file did not manage the Maple's ";"-stuff.
  3. When these bugs are corrected, a new issue appears in sage.interfaces.maple.Maple._keyboard_interrupt. If we expect two maple prompts, the interface freezes when hitting ctrl-c once to stop a long calculation.
* **Fixes:**
  The Maple command passed to sage.interfaces.expect.Expect contains now a Maple configuration command.
    1. Now, Maple command line interface does not break input lines.
    2. When an Maple syntax error occurs, the command line interface does not enter in edit mode. Thus, we are not restricted to only use the expect file interface.
* **Additional changes:**
    1. The method sage.interfaces.maple.Maple.clear was modified to provide a standard way to eventually *clear* a Maple variable.
    2. Some docstrings are changed to pass the doctests.
    3. A docstring is changed in sage.symbolic.integration.integral to pass the tests of Ticket #2120
* **Related tickets:** The issues of Tickets #2120 and #1465 could be also fixed with this patch, but not sure.
* **Tests passed:**

  ```
  sage -coverage devel/sage-maple/sage/interfaces/maple.py
  sage -t -optional devel/sage-maple/sage/interfaces/maple.py
  sage -t --only-optional=maple devel/sage-maple/sage/interfaces/maple.py
  sage -t --only-optional=maple devel/sage/sage/symbolic/expression.pyx  
  sage -t --only-optional=maple devel/sage/sage/symbolic/integration/integral.py
  sage -t --only-optional=maple devel/sage/sage/calculus/calculus.py
  sage -t --only-optional=maple devel/sage/sage/misc/functional.py
  sage -t --only-optional=maple devel/sage/sage/tests/benchmark.py
  sage -t --only-optional=maple devel/sage/sage/interfaces/maple.py
  sage --testall --long
  sage -docbuild reference html
  sage -docbuild reference pdf
  ```



---

archive/issue_comments_135349.json:
```json
{
    "body": "Fix Maple interface",
    "created_at": "2013-02-15T15:39:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135349",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

Fix Maple interface



---

archive/issue_comments_135350.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nAttachment: **[trac-12295-maple_interface_20130115.patch.gz](https://github.com/sagemath/sage/files/ticket12295/trac-12295-maple_interface_20130115.patch.gz)**\n\n* trac-12295-maple_interface_20130115.patch works with Sage 5.6 and 5.7\n  * trac-12295-maple_interface_20130321.patch is a similar patch but for Sage 5.8\n  * trac-12295-maple_interface_5.9_20130614.patch is a similar patch but for Sage 5.9",
    "created_at": "2013-03-21T13:50:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135350",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

<div id="comment:2" align="right">Comment 2</div>

Attachment: **[trac-12295-maple_interface_20130115.patch.gz](https://github.com/sagemath/sage/files/ticket12295/trac-12295-maple_interface_20130115.patch.gz)**

* trac-12295-maple_interface_20130115.patch works with Sage 5.6 and 5.7
  * trac-12295-maple_interface_20130321.patch is a similar patch but for Sage 5.8
  * trac-12295-maple_interface_5.9_20130614.patch is a similar patch but for Sage 5.9



---

archive/issue_comments_135351.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nPlease put your real name on both the patch and the ticket \"Author\" description.",
    "created_at": "2013-04-16T21:22:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135351",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:3" align="right">Comment 3</div>

Please put your real name on both the patch and the ticket "Author" description.



---

archive/issue_events_153068.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-04-16T21:22:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153068"
}
```



---

archive/issue_comments_135352.json:
```json
{
    "body": "Attachment: **[trac-12295-maple_interface_20130321.patch.gz](https://github.com/sagemath/sage/files/ticket12295/trac-12295-maple_interface_20130321.patch.gz)**\n\nMaple interface fix for Sage 5.8",
    "created_at": "2013-04-16T21:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135352",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

Attachment: **[trac-12295-maple_interface_20130321.patch.gz](https://github.com/sagemath/sage/files/ticket12295/trac-12295-maple_interface_20130321.patch.gz)**

Maple interface fix for Sage 5.8



---

archive/issue_comments_135353.json:
```json
{
    "body": "Author: **J Miguel Farto**",
    "created_at": "2013-04-16T21:42:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135353",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

Author: **J Miguel Farto**



---

archive/issue_comments_135354.json:
```json
{
    "body": "Maple interface fix for Sage 5.9",
    "created_at": "2013-06-14T17:01:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135354",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

Maple interface fix for Sage 5.9



---

archive/issue_comments_135355.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nAttachment: **[trac-12295-maple_interface_5.9_20130614.patch.gz](https://github.com/sagemath/sage/files/ticket12295/trac-12295-maple_interface_5.9_20130614.patch.gz)**",
    "created_at": "2013-08-13T15:35:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135355",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">Comment 5</div>

Attachment: **[trac-12295-maple_interface_5.9_20130614.patch.gz](https://github.com/sagemath/sage/files/ticket12295/trac-12295-maple_interface_5.9_20130614.patch.gz)**



---

archive/issue_events_153069.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153069"
}
```



---

archive/issue_events_153070.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153070"
}
```



---

archive/issue_events_153071.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153071"
}
```



---

archive/issue_events_153072.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153072"
}
```



---

archive/issue_comments_135356.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n+With sage-4.7 (and maple 14) it works:\n \n ```\n-With sage-4.7 (and maple 14) it works:\n ----------------------------------------------------------------------\n | Sage Version 4.7, Release Date: 2011-05-23                         |\n | Type notebook() for the GUI, and license() for information.        |\n@@ -8,10 +8,11 @@\n sage: maple('1+1')\n 2\n sage:\n-\n+```\n \n But with 4.7.2 all maple commands end in this traceback:\n \n+```\n ----------------------------------------------------------------------\n | Sage Version 4.7.2, Release Date: 2011-10-29                       |\n | Type notebook() for the GUI, and license() for information.        |\n@@ -104,3 +105,6 @@\n Error, while reading\n `/home/luther/.sage//temp/dirac/18306//interface//tmp18309`\n ```\n+\n+\n+see also #2120\n``````\n",
    "created_at": "2014-03-15T18:36:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135356",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
+With sage-4.7 (and maple 14) it works:
 
 ```
-With sage-4.7 (and maple 14) it works:
 ----------------------------------------------------------------------
 | Sage Version 4.7, Release Date: 2011-05-23                         |
 | Type notebook() for the GUI, and license() for information.        |
@@ -8,10 +8,11 @@
 sage: maple('1+1')
 2
 sage:
-
+```
 
 But with 4.7.2 all maple commands end in this traceback:
 
+```
 ----------------------------------------------------------------------
 | Sage Version 4.7.2, Release Date: 2011-10-29                       |
 | Type notebook() for the GUI, and license() for information.        |
@@ -104,3 +105,6 @@
 Error, while reading
 `/home/luther/.sage//temp/dirac/18306//interface//tmp18309`
 ```
+
+
+see also #2120
``````




---

archive/issue_comments_135357.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -107,4 +107,4 @@\n ```\n \n \n-see also #2120\n+see also #2120, #11288\n``````\n",
    "created_at": "2014-03-15T18:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135357",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -107,4 +107,4 @@
 ```
 
 
-see also #2120
+see also #2120, #11288
``````




---

archive/issue_events_153073.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-03-30T16:42:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153073"
}
```



---

archive/issue_events_153074.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-03-30T16:42:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153074"
}
```



---

archive/issue_events_153075.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153075"
}
```



---

archive/issue_events_153076.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153076"
}
```



---

archive/issue_comments_135358.json:
```json
{
    "body": "Changed keywords from **** to **maple interface**",
    "created_at": "2014-07-24T13:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135358",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from **** to **maple interface**



---

archive/issue_comments_135359.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nHere is a git branch. Could somebody please have a look before it rosts ?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67871caedf019bbefec1c8127e65a226169c8a4d\">67871ca</a></td><td><code>maple interface fix for sage 5.8</code></td></tr></table>\n",
    "created_at": "2014-07-24T13:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135359",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:11" align="right">Comment 11</div>

Here is a git branch. Could somebody please have a look before it rosts ?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67871caedf019bbefec1c8127e65a226169c8a4d">67871ca</a></td><td><code>maple interface fix for sage 5.8</code></td></tr></table>




---

archive/issue_comments_135360.json:
```json
{
    "body": "Commit: **[67871ca](https://github.com/sagemath/sagetrac-mirror/commit/67871caedf019bbefec1c8127e65a226169c8a4d)**",
    "created_at": "2014-07-24T13:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135360",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[67871ca](https://github.com/sagemath/sagetrac-mirror/commit/67871caedf019bbefec1c8127e65a226169c8a4d)**



---

archive/issue_comments_135361.json:
```json
{
    "body": "Branch: **[u/chapoton/12295](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/12295)**",
    "created_at": "2014-07-24T13:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135361",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/12295](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/12295)**



---

archive/issue_events_153077.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153077"
}
```



---

archive/issue_events_153078.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153078"
}
```



---

archive/issue_comments_135362.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nBranch u/chapoton/12295 merged with 6.3 sources.\nTested for Linux mint 17 and maple 13.\nIt works fine.",
    "created_at": "2014-09-15T18:13:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135362",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

<div id="comment:13" align="right">Comment 13</div>

Branch u/chapoton/12295 merged with 6.3 sources.
Tested for Linux mint 17 and maple 13.
It works fine.



---

archive/issue_comments_135363.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nWould you give a positive review, then ?",
    "created_at": "2014-09-22T09:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135363",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">Comment 14</div>

Would you give a positive review, then ?



---

archive/issue_comments_135364.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nI have been successfully using the fix for more than a year.",
    "created_at": "2014-09-22T21:27:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135364",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

<div id="comment:15" align="right">Comment 15</div>

I have been successfully using the fix for more than a year.



---

archive/issue_comments_135365.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nThen could you please put this ticket in positive review, so that it can be closed ?",
    "created_at": "2014-09-23T07:45:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135365",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:16" align="right">Comment 16</div>

Then could you please put this ticket in positive review, so that it can be closed ?



---

archive/issue_events_153079.json:
```json
{
    "actor": "https://github.com/sagetrac-migeruhito",
    "created_at": "2014-09-23T07:53:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153079"
}
```



---

archive/issue_events_153080.json:
```json
{
    "actor": "https://github.com/sagetrac-migeruhito",
    "created_at": "2014-09-23T07:53:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153080"
}
```



---

archive/issue_events_153081.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-09-23T07:53:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153081"
}
```



---

archive/issue_events_153082.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2014-09-23T07:53:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153082"
}
```



---

archive/issue_comments_135366.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\n@fchapoton:  Umm... Miguel **IS** the author!  So he definitely can't review it.  However, if it solves the problem for you as well (perhaps on a different platform? having someone test on Mac would be good) that would be great for positive review.  I'll put a note on sage-devel.",
    "created_at": "2014-09-23T07:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135366",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:18" align="right">Comment 18</div>

@fchapoton:  Umm... Miguel **IS** the author!  So he definitely can't review it.  However, if it solves the problem for you as well (perhaps on a different platform? having someone test on Mac would be good) that would be great for positive review.  I'll put a note on sage-devel.



---

archive/issue_comments_135367.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nWhy are those marked random? This should have deterministic output (depending on maple of course):\n\n```\n-        sage: g = maple(f); g                             # optional - maple\n+        sage: g = maple(f); g                  # random ; optional - maple\n         sin(x^2)+y^z\n-        sage: g.integrate(x)                              # optional - maple\n+        sage: g.integrate(x)                   # random ; optional - maple\n         1/2*2^(1/2)*Pi^(1/2)*FresnelS(2^(1/2)/Pi^(1/2)*x)+y^z*x\n```",
    "created_at": "2014-09-23T08:01:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135367",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">Comment 19</div>

Why are those marked random? This should have deterministic output (depending on maple of course):

```
-        sage: g = maple(f); g                             # optional - maple
+        sage: g = maple(f); g                  # random ; optional - maple
         sin(x^2)+y^z
-        sage: g.integrate(x)                              # optional - maple
+        sage: g.integrate(x)                   # random ; optional - maple
         1/2*2^(1/2)*Pi^(1/2)*FresnelS(2^(1/2)/Pi^(1/2)*x)+y^z*x
```



---

archive/issue_comments_135368.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nThe order of the operands is session-dependent in maple. Sometimes the tests didn't passed due to this fact, when I performed them (long time ago). I know that this \"random\" setting makes the tests (mathematically) useless, but I don't know how to address this problem. Maybe now the test suite takes into account this issue.",
    "created_at": "2014-09-23T08:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135368",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

<div id="comment:20" align="right">Comment 20</div>

The order of the operands is session-dependent in maple. Sometimes the tests didn't passed due to this fact, when I performed them (long time ago). I know that this "random" setting makes the tests (mathematically) useless, but I don't know how to address this problem. Maybe now the test suite takes into account this issue.



---

archive/issue_comments_135369.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@sagetrac-migeruhito](#comment%3A20):\n> The order of the operands is session-dependent in maple.\n\nI believe starting maple with option `--setsort=1` and then calling (maple's) `sort()` on the result before sending it back to sage should make the output deterministic, at least on these examples.",
    "created_at": "2014-09-23T09:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135369",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@sagetrac-migeruhito](#comment%3A20):
> The order of the operands is session-dependent in maple.

I believe starting maple with option `--setsort=1` and then calling (maple's) `sort()` on the result before sending it back to sage should make the output deterministic, at least on these examples.



---

archive/issue_comments_135370.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.\n\nI think that \"random\" must be removed from the tests and `--setsort=1` must not be added in the call parameters of the maple interface. Then, the status of the question would be:\n\n* For Maple prior to v. 11, the tests will randomly pass.\n* For Maple from v. 12, the tests will probably pass. (From Maple documentation:: \"The --setsort=orderNumber option changes the sort order for Maple sets\". I believe that maple expressions are ordered like sets, but not sure).",
    "created_at": "2014-09-23T12:59:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135370",
    "user": "https://github.com/sagetrac-migeruhito"
}
```

<div id="comment:22" align="right">Comment 22</div>

I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.

I think that "random" must be removed from the tests and `--setsort=1` must not be added in the call parameters of the maple interface. Then, the status of the question would be:

* For Maple prior to v. 11, the tests will randomly pass.
* For Maple from v. 12, the tests will probably pass. (From Maple documentation:: "The --setsort=orderNumber option changes the sort order for Maple sets". I believe that maple expressions are ordered like sets, but not sure).



---

archive/issue_comments_135371.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nSounds good to me.",
    "created_at": "2014-09-23T13:03:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135371",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">Comment 23</div>

Sounds good to me.



---

archive/issue_comments_135372.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@sagetrac-migeruhito](#comment%3A22):\n> I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.\n\nYes, I forgot that `setsort=1` was in fact the default. However, while *sets* are sorted by default under recent versions of Maple, it looks like expressions aren't. For example, with Maple\u00a017, I get:\n\n```\n$ maple -t\n#-->sin(x^2)+y^z;\nsin(x^2)+y^z\n#-->{sin(x^2),y^z};\n{y^z, sin(x^2)}\n#-->sort(%%);\ny^z+sin(x^2)\n```\nSo I would say that adding the command-line option is indeed not necessary, but we do need to call `sort()` to make the tests deterministic under Maple 12+.\n\n> I believe that maple expressions are ordered like sets, but not sure).\n\nSame for me.",
    "created_at": "2014-09-23T14:20:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135372",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@sagetrac-migeruhito](#comment%3A22):
> I performed my tests with maple 11. Prior to Maple 12, the only sort option available is session dependent, and I think `--setsort` option is not available at all. By including it, we will probably break the interface for older versions of maple. In the other hand, `--setsort=1` seems to be deterministic for these examples as mmezzarobba said, but it is the default from version 12. `sort()` is not necessary in this case.

Yes, I forgot that `setsort=1` was in fact the default. However, while *sets* are sorted by default under recent versions of Maple, it looks like expressions aren't. For example, with Maple 17, I get:

```
$ maple -t
#-->sin(x^2)+y^z;
sin(x^2)+y^z
#-->{sin(x^2),y^z};
{y^z, sin(x^2)}
#-->sort(%%);
y^z+sin(x^2)
```
So I would say that adding the command-line option is indeed not necessary, but we do need to call `sort()` to make the tests deterministic under Maple 12+.

> I believe that maple expressions are ordered like sets, but not sure).

Same for me.



---

archive/issue_comments_135373.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/864f11172d9f5541c4f3bcd8ebf99e73bf620422\">864f111</a></td><td><code>Merge with 6.4.beta3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d256c5c337eb6853fb2c1ec574d9b56c8ec6802d\">d256c5c</a></td><td><code>trac #12295 using .sort() to make the tests deterministic</code></td></tr></table>\n",
    "created_at": "2014-09-23T20:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135373",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25" align="right">Comment 25</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/864f11172d9f5541c4f3bcd8ebf99e73bf620422">864f111</a></td><td><code>Merge with 6.4.beta3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d256c5c337eb6853fb2c1ec574d9b56c8ec6802d">d256c5c</a></td><td><code>trac #12295 using .sort() to make the tests deterministic</code></td></tr></table>




---

archive/issue_comments_135374.json:
```json
{
    "body": "Changed commit from **[67871ca](https://github.com/sagemath/sagetrac-mirror/commit/67871caedf019bbefec1c8127e65a226169c8a4d)** to **[d256c5c](https://github.com/sagemath/sagetrac-mirror/commit/d256c5c337eb6853fb2c1ec574d9b56c8ec6802d)**",
    "created_at": "2014-09-23T20:26:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135374",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[67871ca](https://github.com/sagemath/sagetrac-mirror/commit/67871caedf019bbefec1c8127e65a226169c8a4d)** to **[d256c5c](https://github.com/sagemath/sagetrac-mirror/commit/d256c5c337eb6853fb2c1ec574d9b56c8ec6802d)**



---

archive/issue_comments_135375.json:
```json
{
    "body": "Changed commit from **[d256c5c](https://github.com/sagemath/sagetrac-mirror/commit/d256c5c337eb6853fb2c1ec574d9b56c8ec6802d)** to **[a8321cc](https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544)**",
    "created_at": "2014-09-23T20:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135375",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d256c5c](https://github.com/sagemath/sagetrac-mirror/commit/d256c5c337eb6853fb2c1ec574d9b56c8ec6802d)** to **[a8321cc](https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544)**



---

archive/issue_comments_135376.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544\">a8321cc</a></td><td><code>trac #12295 remove bad internet optional tag</code></td></tr></table>\n",
    "created_at": "2014-09-23T20:35:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135376",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26" align="right">Comment 26</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544">a8321cc</a></td><td><code>trac #12295 remove bad internet optional tag</code></td></tr></table>




---

archive/issue_comments_135377.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nIs this ok like that ?\n\nI regret that testing `optional=something` does not run the \"not-optional\" tests. This prevents from the `optional=maple` tests to pass for me in this ticket in the current state.\n\nBut the `optional=all` do pass (except for the mathematica optional ones, cause I do not have that.",
    "created_at": "2014-09-24T18:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135377",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:27" align="right">Comment 27</div>

Is this ok like that ?

I regret that testing `optional=something` does not run the "not-optional" tests. This prevents from the `optional=maple` tests to pass for me in this ticket in the current state.

But the `optional=all` do pass (except for the mathematica optional ones, cause I do not have that.



---

archive/issue_events_153083.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2014-09-24T18:37:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153083"
}
```



---

archive/issue_events_153084.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2014-09-24T18:37:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153084"
}
```



---

archive/issue_comments_135378.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nYou can run standard + optional maple tests with \n\n```\nsage -t --optional=sage,maple src/sage/foo.py\n```",
    "created_at": "2014-09-24T19:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135378",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:28" align="right">Comment 28</div>

You can run standard + optional maple tests with 

```
sage -t --optional=sage,maple src/sage/foo.py
```



---

archive/issue_comments_135379.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton, Volker Braun**",
    "created_at": "2014-09-25T12:13:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135379",
    "user": "https://github.com/vbraun"
}
```

Reviewer: **Frédéric Chapoton, Volker Braun**



---

archive/issue_events_153085.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-25T12:13:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153085"
}
```



---

archive/issue_events_153086.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-25T12:13:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153086"
}
```



---

archive/issue_comments_135380.json:
```json
{
    "body": "Changed branch from **[u/chapoton/12295](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/12295)** to **[a8321cc](https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544)**",
    "created_at": "2014-09-27T12:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12295#issuecomment-135380",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/12295](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/12295)** to **[a8321cc](https://github.com/sagemath/sagetrac-mirror/commit/a8321ccd24b7d87df44d7668484e99eb8f767544)**



---

archive/issue_events_153087.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-09-27T12:57:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153087"
}
```



---

archive/issue_events_153088.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4aa251f523a617b8badb1087b39ec2beefde835d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2014-09-27T12:57:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12295",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12295#event-153088"
}
```
