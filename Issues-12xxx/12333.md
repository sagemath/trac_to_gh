# Issue 12333: Restore --grep and --grepdoc command line options

archive/issues_012161.json:
```json
{
    "body": "I just tried one of my *favorite* command line options in Sage-4.8:\n\n```\n$ sage -grep optional |grep gap # and all kinds of other awesome command line stuff \n```\nand was very surprised and disappointed that (a) `sage -grep` is just gone, and (b) there is no other equivalent command line functionality. \n\nSearching reveals that #12190 removed `sage -grep` from sage.  You can't just remove functionality without any comment.  At a minimum it would have to be deprecated for a year, and should also be discussed on sage-devel.  \n\nI'm able to accomplish what I want via\n\n```\n./sage -c \"search_src('optional', 'gap')\"\n```\nHowever, this requires starting up Sage, which is much slower than the old `sage -grep`.   I admit that \"-grep\" wasn't the best command line option name -- search_src would have been better. \n\nThe optimal fix for this ticket would be to refactor the code in sage/misc/sagedoc.py (if possible) so it can be imported without importing all Sage, then use it to implement a command line \"-search_src\", and add back \"-grep\" with a 1-year deprecation. \n\nFailing that, just revert #12190 for 1 year. \n\n---\n\nApply:\n\n- [attachment:trac_12333_restore_grep_root.patch] to the root repo\n- [attachment:trac_12333_restore_grep_scripts.patch] to the scripts repo\n- [attachment:trac_12333-documentation.patch] to the main Sage library repo\n\n \n\n**Assignee:** @jasongrout\n\n**Resolution:** fixed\n\n**Author:** Francis Clarke\n\n**Reviewer:** William Stein, John Palmieri\n\n**Merged:** sage-5.0.beta6\n\nIssue created by migration from https://trac.sagemath.org/ticket/12333\n\n",
    "closed_at": "2012-02-27T11:22:33Z",
    "created_at": "2012-01-21T20:44:17Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Restore --grep and --grepdoc command line options",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12333",
    "user": "https://github.com/williamstein"
}
```
I just tried one of my *favorite* command line options in Sage-4.8:

```
$ sage -grep optional |grep gap # and all kinds of other awesome command line stuff 
```
and was very surprised and disappointed that (a) `sage -grep` is just gone, and (b) there is no other equivalent command line functionality. 

Searching reveals that #12190 removed `sage -grep` from sage.  You can't just remove functionality without any comment.  At a minimum it would have to be deprecated for a year, and should also be discussed on sage-devel.  

I'm able to accomplish what I want via

```
./sage -c "search_src('optional', 'gap')"
```
However, this requires starting up Sage, which is much slower than the old `sage -grep`.   I admit that "-grep" wasn't the best command line option name -- search_src would have been better. 

The optimal fix for this ticket would be to refactor the code in sage/misc/sagedoc.py (if possible) so it can be imported without importing all Sage, then use it to implement a command line "-search_src", and add back "-grep" with a 1-year deprecation. 

Failing that, just revert #12190 for 1 year. 

---

Apply:

- [attachment:trac_12333_restore_grep_root.patch] to the root repo
- [attachment:trac_12333_restore_grep_scripts.patch] to the scripts repo
- [attachment:trac_12333-documentation.patch] to the main Sage library repo

 

**Assignee:** @jasongrout

**Resolution:** fixed

**Author:** Francis Clarke

**Reviewer:** William Stein, John Palmieri

**Merged:** sage-5.0.beta6

Issue created by migration from https://trac.sagemath.org/ticket/12333





---

archive/issue_comments_179711.json:
```json
{
    "body": "**Author:** Francis Clarke",
    "created_at": "2012-01-25T09:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179711",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Author:** Francis Clarke



---

archive/issue_comments_179712.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [trac_12333_restore_sage_-grep.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333_restore_sage_-grep.patch) by fwclarke created at 2012-01-25 09:11:27\n\nThe patch restore `sage -grep`, and `sage -grepdoc`, but uses a new simpler, one-line grep.  This has the following advantages:\n\n* It is significantly faster;\n* The files are searched in lexicographical order, rather than putting all the \".py\" files before the \".pyx\" files, etc.\n\nIn addition a new header is provided, which doesn't include the irrelevant \"Type notebook() ...\", and which shows the branch (if it isn't main).",
    "created_at": "2012-01-25T09:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179712",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:1'></a>
Attachment [trac_12333_restore_sage_-grep.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333_restore_sage_-grep.patch) by fwclarke created at 2012-01-25 09:11:27

The patch restore `sage -grep`, and `sage -grepdoc`, but uses a new simpler, one-line grep.  This has the following advantages:

* It is significantly faster;
* The files are searched in lexicographical order, rather than putting all the ".py" files before the ".pyx" files, etc.

In addition a new header is provided, which doesn't include the irrelevant "Type notebook() ...", and which shows the branch (if it isn't main).



---

archive/issue_comments_179713.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2012-01-25T09:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179713",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_179714.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2012-01-25T18:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179714",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_179715.json:
```json
{
    "body": "<a id='comment:2'></a>\nUnfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris. These are supported platforms for Sage, so we need another approach.\n\nAs far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it.\n\nFinally, this should be rebased to some beta release of Ssge 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.",
    "created_at": "2012-01-25T18:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179715",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris. These are supported platforms for Sage, so we need another approach.

As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it.

Finally, this should be rebased to some beta release of Ssge 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.



---

archive/issue_comments_179716.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [jhpalmieri](#comment%3A2):\n> Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris. These are supported platforms for Sage, so we need another approach.\n> \n\n\nBut please keep `grep --recursive` for everything but Solaris. \n\n> As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it.\n\n\nAgreed. \n\n> Finally, this should be rebased to some beta release of Ssge 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.",
    "created_at": "2012-01-25T18:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179716",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
Replying to [jhpalmieri](#comment%3A2):
> Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris. These are supported platforms for Sage, so we need another approach.
> 


But please keep `grep --recursive` for everything but Solaris. 

> As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it.


Agreed. 

> Finally, this should be rebased to some beta release of Ssge 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.



---

archive/issue_comments_179717.json:
```json
{
    "body": "Attachment [trac_12333_restore_grep_root.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333_restore_grep_root.patch) by fwclarke created at 2012-01-27 19:36:19\n\napply to root repository",
    "created_at": "2012-01-27T19:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179717",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

Attachment [trac_12333_restore_grep_root.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333_restore_grep_root.patch) by fwclarke created at 2012-01-27 19:36:19

apply to root repository



---

archive/issue_comments_179718.json:
```json
{
    "body": "apply to scripts repository",
    "created_at": "2012-01-27T19:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179718",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

apply to scripts repository



---

archive/issue_comments_179719.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2012-01-27T19:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179719",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_179720.json:
```json
{
    "body": "<a id='comment:4'></a>\nAttachment [trac_12333_restore_grep_scripts.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333_restore_grep_scripts.patch) by fwclarke created at 2012-01-27 19:58:01\n\nReplying to [jhpalmieri](#comment%3A2):\n\n> Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris.\n\n\nThe code in the new [attachment:trac_12333_restore_grep_scripts.patch] should work much more generally.  It seems to be no slower than the previous approach.\n\n> As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it. Finally, this should be rebased to some beta release of Sage 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.\n\n\nThe attachment [attachment:trac_12333_restore_grep_root.patch] patches `SAGE_ROOT/spkg/bin/sage`, removes the banner, and allows `-search_src` as a synonym for `-grep`, and `-search_doc` for `-grepdoc`.\n\nOne other modification to earlier behaviour: the `grep` option `-i` is no longer hard-wired, but it can be restored, as can other options.  For example:\n\n```\n$ sage -search_src -il clarke\nsage/rings/morphism.pyx\nsage/rings/number_field/number_field.py\nsage/rings/number_field/number_field_element.pyx\nsage/rings/number_field/number_field_ideal.py\nsage/rings/number_field/unit_group.py\nsage/rings/polynomial/polynomial_element_generic.py\n```",
    "created_at": "2012-01-27T19:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179720",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:4'></a>
Attachment [trac_12333_restore_grep_scripts.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333_restore_grep_scripts.patch) by fwclarke created at 2012-01-27 19:58:01

Replying to [jhpalmieri](#comment%3A2):

> Unfortunately, `grep --recursive ...` does not work on Solaris or OpenSolaris.


The code in the new [attachment:trac_12333_restore_grep_scripts.patch] should work much more generally.  It seems to be no slower than the previous approach.

> As far as the banner occurs, maybe it shouldn't be there at all? Set `SAGE_BANNER=no`, as in `sage -c ...`, to omit it. Finally, this should be rebased to some beta release of Sage 5.0: the script sage-sage is no longer there; instead, patch `SAGE_ROOT/spkg/bin/sage`.


The attachment [attachment:trac_12333_restore_grep_root.patch] patches `SAGE_ROOT/spkg/bin/sage`, removes the banner, and allows `-search_src` as a synonym for `-grep`, and `-search_doc` for `-grepdoc`.

One other modification to earlier behaviour: the `grep` option `-i` is no longer hard-wired, but it can be restored, as can other options.  For example:

```
$ sage -search_src -il clarke
sage/rings/morphism.pyx
sage/rings/number_field/number_field.py
sage/rings/number_field/number_field_element.pyx
sage/rings/number_field/number_field_ideal.py
sage/rings/number_field/unit_group.py
sage/rings/polynomial/polynomial_element_generic.py
```



---

archive/issue_comments_179721.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,4 +17,13 @@\n The optimal fix for this ticket would be to refactor the code in sage/misc/sagedoc.py (if possible) so it can be imported without importing all Sage, then use it to implement a command line \"-search_src\", and add back \"-grep\" with a 1-year deprecation. \n \n Failing that, just revert #12190 for 1 year. \n+\n+---\n+\n+Apply:\n+\n+- [attachment:trac_12333_restore_grep_root.patch] to the root repo\n+- [attachment:trac_12333_restore_grep_scripts.patch] to the scripts repo\n+- [attachment:trac_12333-documentation.patch] to the main Sage library repo\n+\n  \n``````\n",
    "created_at": "2012-02-23T20:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179721",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,4 +17,13 @@
 The optimal fix for this ticket would be to refactor the code in sage/misc/sagedoc.py (if possible) so it can be imported without importing all Sage, then use it to implement a command line "-search_src", and add back "-grep" with a 1-year deprecation. 
 
 Failing that, just revert #12190 for 1 year. 
+
+---
+
+Apply:
+
+- [attachment:trac_12333_restore_grep_root.patch] to the root repo
+- [attachment:trac_12333_restore_grep_scripts.patch] to the scripts repo
+- [attachment:trac_12333-documentation.patch] to the main Sage library repo
+
  
``````




---

archive/issue_comments_179722.json:
```json
{
    "body": "<a id='comment:5'></a>\nLooks good, works on sage.math, OS X, OpenSolaris. So there don't seem to be any cross-platform issues.\n\nI'm happy with the two main patches: positive review for those. What do you think of the attached patch for the reference manual?",
    "created_at": "2012-02-23T20:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179722",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
Looks good, works on sage.math, OS X, OpenSolaris. So there don't seem to be any cross-platform issues.

I'm happy with the two main patches: positive review for those. What do you think of the attached patch for the reference manual?



---

archive/issue_comments_179723.json:
```json
{
    "body": "**Reviewer:** William Stein, John Palmieri",
    "created_at": "2012-02-23T20:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179723",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** William Stein, John Palmieri



---

archive/issue_comments_179724.json:
```json
{
    "body": "Sage library",
    "created_at": "2012-02-23T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179724",
    "user": "https://github.com/jhpalmieri"
}
```

Sage library



---

archive/issue_comments_179725.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [trac_12333-documentation.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333-documentation.patch) by fwclarke created at 2012-02-26 12:57:08\n\nReplying to [jhpalmieri](#comment%3A5):\n\n> ... What do you think of the attached patch for the reference manual?\n\n\nLooks good to me, so positive review for the documentation change.",
    "created_at": "2012-02-26T12:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179725",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

<a id='comment:6'></a>
Attachment [trac_12333-documentation.patch](tarball://root/attachments/some-uuid/ticket12333/trac_12333-documentation.patch) by fwclarke created at 2012-02-26 12:57:08

Replying to [jhpalmieri](#comment%3A5):

> ... What do you think of the attached patch for the reference manual?


Looks good to me, so positive review for the documentation change.



---

archive/issue_comments_179726.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2012-02-26T12:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179726",
    "user": "https://trac.sagemath.org/admin/accounts/users/fwclarke"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_038809.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "rename": {
        "from": "Add back functionality that was inadvertantly deleted from Sage",
        "to": "Restore --grep and --grepdoc command line options"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12333#event-38809"
}
```



---

archive/issue_comments_179727.json:
```json
{
    "body": "**Merged:** sage-5.0.beta6",
    "created_at": "2012-02-27T11:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179727",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta6



---

archive/issue_comments_179728.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2012-02-27T11:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12333#issuecomment-179728",
    "user": "https://github.com/jdemeyer"
}
```

**Resolution:** fixed



---

archive/issue_events_038810.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-27T11:22:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12333",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12333#event-38810"
}
```
