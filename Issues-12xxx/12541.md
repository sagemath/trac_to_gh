# Issue 12541: Remove Sequence test in span

archive/issues_012369.json:
```json
{
    "body": "In Sage-5.0.beta4:\n\n```\nsage: span({0:vector([0,1])}, QQ)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/novoselt/Dropbox/Research/The 14th Case (personal copy)/<ipython console> in <module>()\n\n/home/novoselt/sage-5.0.beta4/local/lib/python2.7/site-packages/sage/modules/free_module.pyc in span(gens, base_ring, check, already_echelonized)\n    518         else:\n    519             M = x.parent()\n--> 520         return M.span(gens=gens, base_ring=base_ring, check=check, already_echelonized=already_echelonized)\n    521 \n    522 ###############################################################################\n\n/home/novoselt/sage-5.0.beta4/local/lib/python2.7/site-packages/sage/modules/free_module.pyc in span(self, gens, base_ring, check, already_echelonized)\n   2553         if is_FreeModule(gens):\n   2554             gens = gens.gens()\n-> 2555         if not isinstance(gens, (list, tuple, Sequence)):\n   2556             raise TypeError, \"Argument gens (= %s) must be a list, tuple, or sequence.\"%gens\n   2557         if base_ring is None or base_ring == self.base_ring():\n\nTypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types\n```\nSuch a command is likely to be a mistake, but the error message is irrelevant and is triggered by using a function name `Sequence` in `isinstance`. The attached patch removes this test as sequences are instances of lists and are correctly recognized anyway.\n\n**Apply:**\n\n[attachment:trac_12541_decrease_span_typechecking.patch]\n\n**Assignee:** @jasongrout, @williamstein\n\n**CC:**  @rbeezer\n\n**Keywords:** rd2\n\n**Reviewer:** Rob Beezer\n\n**Author:** Andrey Novoseltsev\n\n**Merged:** sage-5.0.beta10\n\nIssue created by migration from https://trac.sagemath.org/ticket/12541\n\n",
    "closed_at": "2012-03-23T15:21:33Z",
    "created_at": "2012-02-19T19:30:03Z",
    "labels": [
        "component: linear algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Remove Sequence test in span",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12541",
    "user": "https://github.com/novoselt"
}
```
In Sage-5.0.beta4:

```
sage: span({0:vector([0,1])}, QQ)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/novoselt/Dropbox/Research/The 14th Case (personal copy)/<ipython console> in <module>()

/home/novoselt/sage-5.0.beta4/local/lib/python2.7/site-packages/sage/modules/free_module.pyc in span(gens, base_ring, check, already_echelonized)
    518         else:
    519             M = x.parent()
--> 520         return M.span(gens=gens, base_ring=base_ring, check=check, already_echelonized=already_echelonized)
    521 
    522 ###############################################################################

/home/novoselt/sage-5.0.beta4/local/lib/python2.7/site-packages/sage/modules/free_module.pyc in span(self, gens, base_ring, check, already_echelonized)
   2553         if is_FreeModule(gens):
   2554             gens = gens.gens()
-> 2555         if not isinstance(gens, (list, tuple, Sequence)):
   2556             raise TypeError, "Argument gens (= %s) must be a list, tuple, or sequence."%gens
   2557         if base_ring is None or base_ring == self.base_ring():

TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types
```
Such a command is likely to be a mistake, but the error message is irrelevant and is triggered by using a function name `Sequence` in `isinstance`. The attached patch removes this test as sequences are instances of lists and are correctly recognized anyway.

**Apply:**

[attachment:trac_12541_decrease_span_typechecking.patch]

**Assignee:** @jasongrout, @williamstein

**CC:**  @rbeezer

**Keywords:** rd2

**Reviewer:** Rob Beezer

**Author:** Andrey Novoseltsev

**Merged:** sage-5.0.beta10

Issue created by migration from https://trac.sagemath.org/ticket/12541





---

archive/issue_events_105786.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-19T19:33:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105786"
}
```



---

archive/issue_comments_142652.json:
```json
{
    "body": "<a id='comment:2'></a>\nSome linear algebra results come back as Sequence objects, so maybe that's the reason.  But you are right, it doesn't seem to matter.  With patch:\n\n```\nsage: A = matrix(QQ, 5, range(25))\nsage: eigen = A.eigenvectors_right()\nsage: basis = eigen[0][1]\nsage: basis\n[\n(1, 0, 0, -4, 3),\n(0, 1, 0, -3, 2),\n(0, 0, 1, -2, 1)\n]\nsage: type(basis)\n<class 'sage.structure.sequence.Sequence_generic'>\nsage: U = span(basis)\nsage: U\nVector space of degree 5 and dimension 3 over Rational Field\nBasis matrix:\n[ 1  0  0 -4  3]\n[ 0  1  0 -3  2]\n[ 0  0  1 -2  1]\n```\n\nRunning tests right now.",
    "created_at": "2012-02-19T21:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142652",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:2'></a>
Some linear algebra results come back as Sequence objects, so maybe that's the reason.  But you are right, it doesn't seem to matter.  With patch:

```
sage: A = matrix(QQ, 5, range(25))
sage: eigen = A.eigenvectors_right()
sage: basis = eigen[0][1]
sage: basis
[
(1, 0, 0, -4, 3),
(0, 1, 0, -3, 2),
(0, 0, 1, -2, 1)
]
sage: type(basis)
<class 'sage.structure.sequence.Sequence_generic'>
sage: U = span(basis)
sage: U
Vector space of degree 5 and dimension 3 over Rational Field
Basis matrix:
[ 1  0  0 -4  3]
[ 0  1  0 -3  2]
[ 0  0  1 -2  1]
```

Running tests right now.



---

archive/issue_comments_142653.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks like the new test is missing one line of output.  Doesn't it need a starting line for the error message `\"Traceback...`?  The new test is failing for me in 5.0.beta1. Otherwise, I think it looks good.",
    "created_at": "2012-02-19T22:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142653",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'></a>
Looks like the new test is missing one line of output.  Doesn't it need a starting line for the error message `"Traceback...`?  The new test is failing for me in 5.0.beta1. Otherwise, I think it looks good.



---

archive/issue_events_105787.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-19T22:29:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105787"
}
```



---

archive/issue_events_105788.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-19T22:29:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105788"
}
```



---

archive/attachments_016863.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12541_remove_isinstance_Sequence_in_span.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12541/trac_12541_remove_isinstance_Sequence_in_span.patch",
    "created_at": "2012-02-19T22:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/novoselt"
}
```



---

archive/issue_comments_142654.json:
```json
{
    "body": "",
    "created_at": "2012-02-19T22:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142654",
    "user": "https://github.com/novoselt"
}
```





---

archive/issue_comments_142655.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt certainly does! While fixing it, I noticed the same construction in another place, so I fixed it everywhere in this file.",
    "created_at": "2012-02-19T22:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142655",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:4'></a>
It certainly does! While fixing it, I noticed the same construction in another place, so I fixed it everywhere in this file.



---

archive/issue_events_105789.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-19T22:48:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105789"
}
```



---

archive/issue_events_105790.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-19T22:48:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105790"
}
```



---

archive/issue_events_105791.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-19T23:06:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105791"
}
```



---

archive/issue_events_105792.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-19T23:06:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105792"
}
```



---

archive/issue_comments_142656.json:
```json
{
    "body": "<a id='comment:5'></a>\nOn a related note: how about I will try to rewrite these functions in such a way, that they are happy with any iterable? I have a class at #11400 which wraps tuple without inheritance and it would be nice if it worked with spans, but adding another class to `isinstance` does not feel like a great idea...",
    "created_at": "2012-02-19T23:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142656",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:5'></a>
On a related note: how about I will try to rewrite these functions in such a way, that they are happy with any iterable? I have a class at #11400 which wraps tuple without inheritance and it would be nice if it worked with spans, but adding another class to `isinstance` does not feel like a great idea...



---

archive/issue_events_105793.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-20T05:49:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105793"
}
```



---

archive/issue_events_105794.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-20T05:49:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105794"
}
```



---

archive/issue_comments_142657.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [novoselt](#comment%3A5):\n> On a related note: how about I will try to rewrite these functions in such a way, that they are happy with any iterable? \n\n\nThat sounds like a good idea.  I've never been too excited about Sequence, I think it does a lot of work to get a common parent (which can be useful, but is often overkill).\n\nI'm going to give this a positive review, it passes all tests.  Documentation looks good (except on my 5.0.beta1 I don't have the new trac/sphinx role).  So maybe further improvements can go on another ticket?  If so, cc me on it, even though things are going to get hectic again for me.\n\nRob",
    "created_at": "2012-02-20T05:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142657",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:6'></a>
Replying to [novoselt](#comment%3A5):
> On a related note: how about I will try to rewrite these functions in such a way, that they are happy with any iterable? 


That sounds like a good idea.  I've never been too excited about Sequence, I think it does a lot of work to get a common parent (which can be useful, but is often overkill).

I'm going to give this a positive review, it passes all tests.  Documentation looks good (except on my 5.0.beta1 I don't have the new trac/sphinx role).  So maybe further improvements can go on another ticket?  If so, cc me on it, even though things are going to get hectic again for me.

Rob



---

archive/issue_comments_142658.json:
```json
{
    "body": "**Reviewer:** Rob Beezer",
    "created_at": "2012-02-20T05:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142658",
    "user": "https://github.com/rbeezer"
}
```

**Reviewer:** Rob Beezer



---

archive/issue_events_105795.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-20T05:49:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105795"
}
```



---

archive/issue_events_105796.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-20T05:49:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105796"
}
```



---

archive/issue_comments_142659.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -24,3 +24,7 @@\n TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types\n ```\n Such a command is likely to be a mistake, but the error message is irrelevant and is triggered by using a function name `Sequence` in `isinstance`. The attached patch removes this test as sequences are instances of lists and are correctly recognized anyway.\n+\n+**Apply:**\n+\n+[attachment:trac_12541_remove_isinstance_Sequence_in_span.patch]\n``````\n",
    "created_at": "2012-02-20T05:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142659",
    "user": "https://github.com/rbeezer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -24,3 +24,7 @@
 TypeError: isinstance() arg 2 must be a class, type, or tuple of classes and types
 ```
 Such a command is likely to be a mistake, but the error message is irrelevant and is triggered by using a function name `Sequence` in `isinstance`. The attached patch removes this test as sequences are instances of lists and are correctly recognized anyway.
+
+**Apply:**
+
+[attachment:trac_12541_remove_isinstance_Sequence_in_span.patch]
``````




---

archive/issue_comments_142660.json:
```json
{
    "body": "<a id='comment:9'></a>\nSorry Rob, how about this alternative patch? It affects mostly the same lines, but instead of removing `Sequence` gets rid of this `isinstance` completely. My reasoning for this:\n* the present tests are wrong as stated in the description: the condition is either True or raises a confusing exception, not the intended one;\n* the same check is repeated all over the place in functions that do nothing with the input except passing it further down - this makes it difficult to get the real processing place and figure out what has to be done;\n* `isinstance` in general is not encouraged in Python - in my situation I have a perfectly good class resembling a tuple and working flawlessly if I get rid of these checks (in fact, `PointCollection` can be more suitable as a container for bases of modules than `Sequence`, although I don't intend to push this direction);\n* totally wrong input still will produce some exception, e.g. using dictionaries gives \"no span for integers\" message;\n* all tests pass with this alternative patch.\n\nIf you agree with my reasons, I'd rather use this solution.",
    "created_at": "2012-02-20T06:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142660",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:9'></a>
Sorry Rob, how about this alternative patch? It affects mostly the same lines, but instead of removing `Sequence` gets rid of this `isinstance` completely. My reasoning for this:
* the present tests are wrong as stated in the description: the condition is either True or raises a confusing exception, not the intended one;
* the same check is repeated all over the place in functions that do nothing with the input except passing it further down - this makes it difficult to get the real processing place and figure out what has to be done;
* `isinstance` in general is not encouraged in Python - in my situation I have a perfectly good class resembling a tuple and working flawlessly if I get rid of these checks (in fact, `PointCollection` can be more suitable as a container for bases of modules than `Sequence`, although I don't intend to push this direction);
* totally wrong input still will produce some exception, e.g. using dictionaries gives "no span for integers" message;
* all tests pass with this alternative patch.

If you agree with my reasons, I'd rather use this solution.



---

archive/issue_events_105797.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-20T06:15:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105797"
}
```



---

archive/issue_events_105798.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-02-20T06:15:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105798"
}
```



---

archive/issue_comments_142661.json:
```json
{
    "body": "<a id='comment:10'></a>\nI've posted my current work in progress at #12544 - to make it work, I either need the alternative patch here, or tweak `FreeModule` to recognize `PointCollection` and treat it as tuple, or write things like `span(tuple(cone.rays()))` in toric code, which mitigates the point of `cone.rays()` returning an \"almost tuple\"...",
    "created_at": "2012-02-20T06:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142661",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:10'></a>
I've posted my current work in progress at #12544 - to make it work, I either need the alternative patch here, or tweak `FreeModule` to recognize `PointCollection` and treat it as tuple, or write things like `span(tuple(cone.rays()))` in toric code, which mitigates the point of `cone.rays()` returning an "almost tuple"...



---

archive/issue_comments_142662.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [novoselt](#comment%3A9):\n> If you agree with my reasons, I'd rather use this solution.\n\n\nUnderstood.  Super-busy for a few days.  Feel free to ping me if this slips, but I'll try to look at it later this week.\n\nRob",
    "created_at": "2012-02-20T15:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142662",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:11'></a>
Replying to [novoselt](#comment%3A9):
> If you agree with my reasons, I'd rather use this solution.


Understood.  Super-busy for a few days.  Feel free to ping me if this slips, but I'll try to look at it later this week.

Rob



---

archive/issue_events_105799.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-20T15:43:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105799"
}
```



---

archive/issue_events_105800.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-02-20T15:43:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105800"
}
```



---

archive/issue_comments_142663.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -27,4 +27,4 @@\n \n **Apply:**\n \n-[attachment:trac_12541_remove_isinstance_Sequence_in_span.patch]\n+[attachment:trac_12541_decrease_span_typechecking.patch]\n``````\n",
    "created_at": "2012-03-11T16:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142663",
    "user": "https://github.com/loefflerd"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -27,4 +27,4 @@
 
 **Apply:**
 
-[attachment:trac_12541_remove_isinstance_Sequence_in_span.patch]
+[attachment:trac_12541_decrease_span_typechecking.patch]
``````




---

archive/issue_comments_142664.json:
```json
{
    "body": "<a id='comment:12'></a>\nPing! Do I understand correctly that there's a consensus to use this second patch, but that it hasn't yet been reviewed?\n\nApply trac_12541_decrease_span_typechecking.patch\n\n(for the patchbot).",
    "created_at": "2012-03-11T16:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142664",
    "user": "https://github.com/loefflerd"
}
```

<a id='comment:12'></a>
Ping! Do I understand correctly that there's a consensus to use this second patch, but that it hasn't yet been reviewed?

Apply trac_12541_decrease_span_typechecking.patch

(for the patchbot).



---

archive/issue_comments_142665.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [davidloeffler](#comment%3A12):\n> Ping! Do I understand correctly that there's a consensus to use this second patch, but that it hasn't yet been reviewed?\n\n\nYes I want to merge the second patch, feel free to review it ;-) It should be easy, provided that you agree with the idea of the change. To see the problems that this patch solves, you can play with #12544 without this one.",
    "created_at": "2012-03-11T17:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142665",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:13'></a>
Replying to [davidloeffler](#comment%3A12):
> Ping! Do I understand correctly that there's a consensus to use this second patch, but that it hasn't yet been reviewed?


Yes I want to merge the second patch, feel free to review it ;-) It should be easy, provided that you agree with the idea of the change. To see the problems that this patch solves, you can play with #12544 without this one.



---

archive/issue_comments_142666.json:
```json
{
    "body": "<a id='comment:14'></a>\nI find the error message in the doctest still somewhat cryptic.  Here's a simplified explanation of what happens:\n    \n\n```\nsage: span(QQ, [0])            \n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<snip>\nAttributeError: 'sage.rings.integer_ring.IntegerRing_class' object has no attribute 'span'\n```\n\nIt appears that the span() **function** in free_module.pyx  mostly tries to find an appropriate parent for the generators, and then hands everything off to the .span() **method** of the parent.\n\nSo here, the integer zero is construed to be the first generator, and the class of integers has no span method.\n\nWhat do you think of checking if the first generator is a list, or if it is a free module element (`is_FreeModuleElement`), before proceeding with a supposed parent?  This would allow an informative error message, such as - \"generators must be lists of ring elements, or free module elements\"",
    "created_at": "2012-03-15T00:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142666",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:14'></a>
I find the error message in the doctest still somewhat cryptic.  Here's a simplified explanation of what happens:
    

```
sage: span(QQ, [0])            
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<snip>
AttributeError: 'sage.rings.integer_ring.IntegerRing_class' object has no attribute 'span'
```

It appears that the span() **function** in free_module.pyx  mostly tries to find an appropriate parent for the generators, and then hands everything off to the .span() **method** of the parent.

So here, the integer zero is construed to be the first generator, and the class of integers has no span method.

What do you think of checking if the first generator is a list, or if it is a free module element (`is_FreeModuleElement`), before proceeding with a supposed parent?  This would allow an informative error message, such as - "generators must be lists of ring elements, or free module elements"



---

archive/issue_events_105801.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-03-15T00:40:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105801"
}
```



---

archive/issue_events_105802.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-03-15T00:40:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105802"
}
```



---

archive/issue_comments_142667.json:
```json
{
    "body": "Now with a doctest",
    "created_at": "2012-03-15T02:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142667",
    "user": "https://github.com/novoselt"
}
```

Now with a doctest



---

archive/attachments_016864.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12541_decrease_span_typechecking.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12541/trac_12541_decrease_span_typechecking.patch",
    "created_at": "2012-03-15T02:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/novoselt"
}
```



---

archive/issue_comments_142668.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, I've rewritten span function a bit to catch more issues and eliminate isinstance. Seems to work fine although I didn't run full tests yet.",
    "created_at": "2012-03-15T02:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142668",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'></a>
OK, I've rewritten span function a bit to catch more issues and eliminate isinstance. Seems to work fine although I didn't run full tests yet.



---

archive/issue_events_105803.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-15T04:11:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105803"
}
```



---

archive/issue_events_105804.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-15T04:11:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105804"
}
```



---

archive/issue_comments_142669.json:
```json
{
    "body": "<a id='comment:16'></a>\nAll tests pass on beta8 with the new version!",
    "created_at": "2012-03-15T04:11:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142669",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:16'></a>
All tests pass on beta8 with the new version!



---

archive/issue_events_105805.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-03-18T18:34:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105805"
}
```



---

archive/issue_events_105806.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-03-18T18:34:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105806"
}
```



---

archive/issue_comments_142670.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [novoselt](#comment%3A15):\n> OK, I've rewritten span function a bit to catch more issues and eliminate isinstance.\n\n\nI like the looks of the new version.  I did discover one problem.\n\n```\nsage: V = span(ZZ, [[1,2,3/4]])\nsage: V\nFree module of degree 3 and rank 1 over Integer Ring\nEchelon basis matrix:\n[  1   2 3/4]\n```\n\nI think this can be fixed by passing `R` into the final `span` method in the return (rather than `base_ring`.)  This should have been caught by the span method, which seems to be the real fault here, I've isolated that at #12688.\n\nI might write a few more doctests for the span() function as part of final testing for this.",
    "created_at": "2012-03-18T18:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142670",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:17'></a>
Replying to [novoselt](#comment%3A15):
> OK, I've rewritten span function a bit to catch more issues and eliminate isinstance.


I like the looks of the new version.  I did discover one problem.

```
sage: V = span(ZZ, [[1,2,3/4]])
sage: V
Free module of degree 3 and rank 1 over Integer Ring
Echelon basis matrix:
[  1   2 3/4]
```

I think this can be fixed by passing `R` into the final `span` method in the return (rather than `base_ring`.)  This should have been caught by the span method, which seems to be the real fault here, I've isolated that at #12688.

I might write a few more doctests for the span() function as part of final testing for this.



---

archive/issue_events_105807.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-18T18:50:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105807"
}
```



---

archive/issue_events_105808.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2012-03-18T18:50:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105808"
}
```



---

archive/issue_comments_142671.json:
```json
{
    "body": "<a id='comment:18'></a>\nI knew about this behaviour and was sure that this is intended. What we have in your example is a an integral span of elements of a rational vector space. I suspect I may have even used it somewhere. So if you think that it has to be changed, perhaps we should discuss it on sage-devel first.\n\nIn any case it seems orthogonal to this ticket which does the fix that I need for #12544,  improves error messages from span, and did not affect the above behaviour. So I still propose merging the current version ;-)",
    "created_at": "2012-03-18T18:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142671",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:18'></a>
I knew about this behaviour and was sure that this is intended. What we have in your example is a an integral span of elements of a rational vector space. I suspect I may have even used it somewhere. So if you think that it has to be changed, perhaps we should discuss it on sage-devel first.

In any case it seems orthogonal to this ticket which does the fix that I need for #12544,  improves error messages from span, and did not affect the above behaviour. So I still propose merging the current version ;-)



---

archive/issue_comments_142672.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe first test in the documentation actually shows integral span of rational vectors, so I really think that this was intended...",
    "created_at": "2012-03-18T18:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142672",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:19'></a>
The first test in the documentation actually shows integral span of rational vectors, so I really think that this was intended...



---

archive/issue_comments_142673.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [novoselt](#comment%3A18):\n> I knew about this behaviour and was sure that this is intended. What we have in your example is a an integral span of elements of a rational vector space. I suspect I may have even used it somewhere. So if you think that it has to be changed, perhaps we should discuss it on sage-devel first.\n\n\nOK, that makes sense, and I see the test that allows this.  Misunderstanding on my part.  \n\nBut something more explicit in the documentation about this would help.  How about\n\n1.  I look at this ticket a bit more with an eye to merging it as-is.\n2.  I add some documentation on #12688 extending this change.",
    "created_at": "2012-03-18T19:11:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142673",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:20'></a>
Replying to [novoselt](#comment%3A18):
> I knew about this behaviour and was sure that this is intended. What we have in your example is a an integral span of elements of a rational vector space. I suspect I may have even used it somewhere. So if you think that it has to be changed, perhaps we should discuss it on sage-devel first.


OK, that makes sense, and I see the test that allows this.  Misunderstanding on my part.  

But something more explicit in the documentation about this would help.  How about

1.  I look at this ticket a bit more with an eye to merging it as-is.
2.  I add some documentation on #12688 extending this change.



---

archive/issue_comments_142674.json:
```json
{
    "body": "<a id='comment:21'></a>\nPasses all tests and is a big improvement.  So positive review.\n\nThere are still a few scenarios which give semi-cryptic error messages, so I think there is still room for impovement in this constructor.",
    "created_at": "2012-03-19T04:33:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142674",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:21'></a>
Passes all tests and is a big improvement.  So positive review.

There are still a few scenarios which give semi-cryptic error messages, so I think there is still room for impovement in this constructor.



---

archive/issue_events_105809.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-03-19T04:33:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105809"
}
```



---

archive/issue_events_105810.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2012-03-19T04:33:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105810"
}
```



---

archive/issue_comments_142675.json:
```json
{
    "body": "<a id='comment:22'></a>\nDocumentation is going up on #12688 (wrong ticket on comment 20, which I just **edited**).",
    "created_at": "2012-03-19T04:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142675",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:22'></a>
Documentation is going up on #12688 (wrong ticket on comment 20, which I just **edited**).



---

archive/issue_comments_142676.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"rd2\".",
    "created_at": "2012-03-19T04:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142676",
    "user": "https://github.com/rbeezer"
}
```

**Changing keywords** from "" to "rd2".



---

archive/issue_comments_142677.json:
```json
{
    "body": "<a id='comment:24'></a>\nThank you! And thanks for pointing out that comments are editable now!",
    "created_at": "2012-03-19T14:25:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142677",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:24'></a>
Thank you! And thanks for pointing out that comments are editable now!



---

archive/issue_comments_142678.json:
```json
{
    "body": "**Merged:** sage-5.0.beta10",
    "created_at": "2012-03-23T15:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12541#issuecomment-142678",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta10



---

archive/issue_events_105811.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:21:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105811"
}
```



---

archive/issue_events_105812.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-03-23T15:21:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12541",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12541#event-105812"
}
```
