# Issue 12074: real nth root function

archive/issues_011902.json:
```json
{
    "body": "See sage-devel threads at:\n\nhttp://groups.google.com/group/sage-devel/t/cea9b562ea49c9c1\n\nand \n\nhttps://groups.google.com/forum/#!topic/sage-devel/Q8VLKBypcJk\n\nAssignee: @burcin\n\nCC:  @orlitzky @kcrisman karsten.naert@gmail.com @eviatarbach @slel\n\nReviewer: Karl-Dieter Crisman, Nils Bruin, Kwankyu Lee\n\nAuthor: Burcin Erocal, Kwankyu Lee\n\nBranch: f8cb7a0429c2e696dc69db8466ecc077b0bf0f32\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12074\n\n",
    "closed_at": "2020-07-08T19:32:43Z",
    "created_at": "2011-11-23T14:43:09Z",
    "labels": [
        "component: symbolics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "real nth root function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12074",
    "user": "https://github.com/burcin"
}
```
See sage-devel threads at:

http://groups.google.com/group/sage-devel/t/cea9b562ea49c9c1

and 

https://groups.google.com/forum/#!topic/sage-devel/Q8VLKBypcJk

Assignee: @burcin

CC:  @orlitzky @kcrisman karsten.naert@gmail.com @eviatarbach @slel

Reviewer: Karl-Dieter Crisman, Nils Bruin, Kwankyu Lee

Author: Burcin Erocal, Kwankyu Lee

Branch: f8cb7a0429c2e696dc69db8466ecc077b0bf0f32

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12074





---

archive/issue_comments_167380.json:
```json
{
    "body": "Changing work_issues from \"\" to \"needs tests and documentation\"",
    "created_at": "2011-11-23T14:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167380",
    "user": "https://github.com/burcin"
}
```

Changing work_issues from "" to "needs tests and documentation"



---

archive/issue_comments_167381.json:
```json
{
    "body": "<a id='comment:2'></a>Is there any chance this could be made into a function that we can do calculus with, like computing derivatives, integrals, solving equations...  (I'm afraid the answer will be no though because we need maxima).",
    "created_at": "2011-11-23T19:32:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167381",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Is there any chance this could be made into a function that we can do calculus with, like computing derivatives, integrals, solving equations...  (I'm afraid the answer will be no though because we need maxima).



---

archive/issue_comments_167382.json:
```json
{
    "body": "<a id='comment:3'></a>Attachment [trac_12074-nth_root.patch](tarball://root/attachments/some-uuid/ticket12074/trac_12074-nth_root.patch) by @burcin created at 2011-11-24 12:06:14\n\nReplying to [comment:2 jdemeyer]:\n> Is there any chance this could be made into a function that we can do calculus with, like computing derivatives, integrals, solving equations...  (I'm afraid the answer will be no though because we need maxima).\n\n\nThis is already a symbolic function, so it plays well with symbolics generally (as opposed to piecewise functions for instance):\n\n```\nsage: v = nth_root(x,3)\nsage: v*sin(x) + x^2\nx^2 + real_nth_root(x, 3)*sin(x)\n```\n\nI updated the patch to add custom exponentiation and derivative methods as well:\n\n```\nsage: v^2\nreal_nth_root(x, 3/2)\nsage: v*v\nreal_nth_root(x, 3/2)\nsage: v.diff(x)\n1/3*real_nth_root(x, -3/2)\n```\n\nThis all needs a lot of work of course.\n\nFor integration and solving equations we call out to maxima. One way to get sensible results from these calls would be to convert this function to a regular `(base)^(exp)` representation when passing it to maxima. I don't think there is any way to read it back from the maxima result though.",
    "created_at": "2011-11-24T12:06:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167382",
    "user": "https://github.com/burcin"
}
```

<a id='comment:3'></a>Attachment [trac_12074-nth_root.patch](tarball://root/attachments/some-uuid/ticket12074/trac_12074-nth_root.patch) by @burcin created at 2011-11-24 12:06:14

Replying to [comment:2 jdemeyer]:
> Is there any chance this could be made into a function that we can do calculus with, like computing derivatives, integrals, solving equations...  (I'm afraid the answer will be no though because we need maxima).


This is already a symbolic function, so it plays well with symbolics generally (as opposed to piecewise functions for instance):

```
sage: v = nth_root(x,3)
sage: v*sin(x) + x^2
x^2 + real_nth_root(x, 3)*sin(x)
```

I updated the patch to add custom exponentiation and derivative methods as well:

```
sage: v^2
real_nth_root(x, 3/2)
sage: v*v
real_nth_root(x, 3/2)
sage: v.diff(x)
1/3*real_nth_root(x, -3/2)
```

This all needs a lot of work of course.

For integration and solving equations we call out to maxima. One way to get sensible results from these calls would be to convert this function to a regular `(base)^(exp)` representation when passing it to maxima. I don't think there is any way to read it back from the maxima result though.



---

archive/issue_events_032077.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32077"
}
```



---

archive/issue_events_032078.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32078"
}
```



---

archive/issue_events_032079.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32079"
}
```



---

archive/issue_events_032080.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32080"
}
```



---

archive/issue_events_032081.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32081"
}
```



---

archive/issue_events_032082.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32082"
}
```



---

archive/issue_events_032083.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32083"
}
```



---

archive/issue_events_032084.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-06-11T03:21:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32084"
}
```



---

archive/issue_events_032085.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-06-11T03:21:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32085"
}
```



---

archive/issue_comments_167383.json:
```json
{
    "body": "<a id='comment:10'></a>See also sympy's `real_root`\n\n- https://docs.sympy.org/latest/modules/functions/elementary.html#real-root",
    "created_at": "2019-06-11T03:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167383",
    "user": "https://github.com/slel"
}
```

<a id='comment:10'></a>See also sympy's `real_root`

- https://docs.sympy.org/latest/modules/functions/elementary.html#real-root



---

archive/issue_comments_167384.json:
```json
{
    "body": "<a id='comment:11'></a>There is some interest in this again, due to an upcoming book's 2nd edition.\n\nSympy's solution may be more elegant in some ways, because it uses `Abs(x)**(1/3)*sign(x)` for `real_root(x,3)`, apparently.   If that solution (in Sage, of course, with translations to Sympy) has better support overall in Sage we could just do that instead (for odd roots).\n\nHere's the full Sympy code. They have better handling of complicated piecewise things, I guess.\n\n```\n    from sympy.functions.elementary.complexes import Abs, im, sign\n    from sympy.functions.elementary.piecewise import Piecewise\n    if n is not None:\n        return Piecewise(\n            (root(arg, n, evaluate=evaluate), Or(Eq(n, S.One), Eq(n, S.NegativeOne))),\n            (Mul(sign(arg), root(Abs(arg), n, evaluate=evaluate), evaluate=evaluate),\n            And(Eq(im(arg), S.Zero), Eq(Mod(n, 2), S.One))),\n            (root(arg, n, evaluate=evaluate), True))\n    rv = sympify(arg)\n    n1pow = Transform(lambda x: -(-x.base)**x.exp,\n                      lambda x:\n                      x.is_Pow and\n                      x.base.is_negative and\n                      x.exp.is_Rational and\n                      x.exp.p == 1 and x.exp.q % 2)\n    return rv.xreplace(n1pow)\n```",
    "created_at": "2020-06-11T17:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167384",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>There is some interest in this again, due to an upcoming book's 2nd edition.

Sympy's solution may be more elegant in some ways, because it uses `Abs(x)**(1/3)*sign(x)` for `real_root(x,3)`, apparently.   If that solution (in Sage, of course, with translations to Sympy) has better support overall in Sage we could just do that instead (for odd roots).

Here's the full Sympy code. They have better handling of complicated piecewise things, I guess.

```
    from sympy.functions.elementary.complexes import Abs, im, sign
    from sympy.functions.elementary.piecewise import Piecewise
    if n is not None:
        return Piecewise(
            (root(arg, n, evaluate=evaluate), Or(Eq(n, S.One), Eq(n, S.NegativeOne))),
            (Mul(sign(arg), root(Abs(arg), n, evaluate=evaluate), evaluate=evaluate),
            And(Eq(im(arg), S.Zero), Eq(Mod(n, 2), S.One))),
            (root(arg, n, evaluate=evaluate), True))
    rv = sympify(arg)
    n1pow = Transform(lambda x: -(-x.base)**x.exp,
                      lambda x:
                      x.is_Pow and
                      x.base.is_negative and
                      x.exp.is_Rational and
                      x.exp.p == 1 and x.exp.q % 2)
    return rv.xreplace(n1pow)
```



---

archive/issue_comments_167385.json:
```json
{
    "body": "Changing author from \"Burcin Erocal\" to \"Burcin Erocal; Kwankyu Lee\"",
    "created_at": "2020-06-12T13:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167385",
    "user": "https://github.com/kwankyu"
}
```

Changing author from "Burcin Erocal" to "Burcin Erocal; Kwankyu Lee"



---

archive/issue_comments_167386.json:
```json
{
    "body": "Changing branch from \"\" to \"public/12074\"",
    "created_at": "2020-06-12T13:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167386",
    "user": "https://github.com/kwankyu"
}
```

Changing branch from "" to "public/12074"



---

archive/issue_comments_167387.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-12T13:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167387",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_167388.json:
```json
{
    "body": "Changing commit from \"\" to \"5028e22e1d4bbd112a14983efd13f7aa43adf168\"",
    "created_at": "2020-06-12T13:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167388",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "5028e22e1d4bbd112a14983efd13f7aa43adf168"



---

archive/issue_comments_167389.json:
```json
{
    "body": "<a id='comment:14'></a>Revived Burcin's implementation of `real_nth_root` symbolic function. \n\nIt is in public. Feel free to improve.",
    "created_at": "2020-06-12T13:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167389",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'></a>Revived Burcin's implementation of `real_nth_root` symbolic function. 

It is in public. Feel free to improve.



---

archive/issue_comments_167390.json:
```json
{
    "body": "Changing work_issues from \"needs tests and documentation\" to \"\"",
    "created_at": "2020-06-12T13:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167390",
    "user": "https://github.com/kwankyu"
}
```

Changing work_issues from "needs tests and documentation" to ""



---

archive/issue_comments_167391.json:
```json
{
    "body": "Changing keywords from \"nth_root\" to \"\".",
    "created_at": "2020-06-12T13:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167391",
    "user": "https://github.com/kwankyu"
}
```

Changing keywords from "nth_root" to "".



---

archive/issue_events_032086.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2020-06-12T13:38:22Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32086"
}
```



---

archive/issue_events_032087.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2020-06-12T13:38:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32087"
}
```



---

archive/issue_comments_167392.json:
```json
{
    "body": "Changing author from \"Burcin Erocal; Kwankyu Lee\" to \"Burcin Erocal, Kwankyu Lee\"",
    "created_at": "2020-06-12T13:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167392",
    "user": "https://github.com/kwankyu"
}
```

Changing author from "Burcin Erocal; Kwankyu Lee" to "Burcin Erocal, Kwankyu Lee"



---

archive/issue_comments_167393.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-12T13:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167393",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167394.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,10 @@\n-See sage-devel thread at:\n+See sage-devel threads at:\n \n http://groups.google.com/group/sage-devel/t/cea9b562ea49c9c1\n \n-Keywords: nth_root\n+and \n+\n+https://groups.google.com/forum/#!topic/sage-devel/Q8VLKBypcJk\n \n Author: Burcin Erocal\n \n``````\n",
    "created_at": "2020-06-12T13:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167394",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,10 @@
-See sage-devel thread at:
+See sage-devel threads at:
 
 http://groups.google.com/group/sage-devel/t/cea9b562ea49c9c1
 
-Keywords: nth_root
+and 
+
+https://groups.google.com/forum/#!topic/sage-devel/Q8VLKBypcJk
 
 Author: Burcin Erocal
 
``````




---

archive/issue_comments_167395.json:
```json
{
    "body": "<a id='comment:19'></a>Kwankyu (\uad00\uaddc?), thanks so much for getting that ball rolling, and the doctests/doc looks good so far.\n\nHere are some questions/comments (for anyone, not necessarily for klee):\n* See [this list of plot methods for this](https://github.com/sagemath/sage/blob/develop/src/sage/plot/plot.py#L1502) in the plot doc.  We should add this, perhaps as the first-order approximation.\n* The file [faq-usage.rst](https://github.com/sagemath/sage/blob/develop/src/doc/en/faq/faq-usage.rst) also should be amended since it mentions the same issue.\n* Maybe even there should be a plot example in this file, and then a link to this function from the plot doc?\n* Does this one work with derivatives/integrals?  Maybe in the meantime we don't need the custom method.\n* Apparently Mathematica now has something like this, called [Surd](https://reference.wolfram.com/language/ref/Surd.html) which, while perhaps technically a correct name, is not exactly inspiring to anyone who has taken math since 1950 ... Perhaps this is because Maple [also has the same name](https://www.maplesoft.com/support/help/Maple/view.aspx?path=surd) though not capitalized.  I like the !Sage/Sympy name *much* better, but anyway these can be added to the conversions.  (I don't think Maxima has an equivalent for now.)",
    "created_at": "2020-06-12T14:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167395",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>Kwankyu (관규?), thanks so much for getting that ball rolling, and the doctests/doc looks good so far.

Here are some questions/comments (for anyone, not necessarily for klee):
* See [this list of plot methods for this](https://github.com/sagemath/sage/blob/develop/src/sage/plot/plot.py#L1502) in the plot doc.  We should add this, perhaps as the first-order approximation.
* The file [faq-usage.rst](https://github.com/sagemath/sage/blob/develop/src/doc/en/faq/faq-usage.rst) also should be amended since it mentions the same issue.
* Maybe even there should be a plot example in this file, and then a link to this function from the plot doc?
* Does this one work with derivatives/integrals?  Maybe in the meantime we don't need the custom method.
* Apparently Mathematica now has something like this, called [Surd](https://reference.wolfram.com/language/ref/Surd.html) which, while perhaps technically a correct name, is not exactly inspiring to anyone who has taken math since 1950 ... Perhaps this is because Maple [also has the same name](https://www.maplesoft.com/support/help/Maple/view.aspx?path=surd) though not capitalized.  I like the !Sage/Sympy name *much* better, but anyway these can be added to the conversions.  (I don't think Maxima has an equivalent for now.)



---

archive/issue_comments_167396.json:
```json
{
    "body": "<a id='comment:20'></a>The current behavior of integer/float exponentiation is due to python, I guess?\n\n```\n$ python\nPython 3.7.7 (default, May  8 2020, 10:21:17) \n[GCC 9.3.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> (-1)**(1/3)\n(0.5000000000000001+0.8660254037844386j)\n```\n\nOtherwise the question can be asked: why not make that return real numbers when the argument is real? Which leads me to this question: would it make sense to call this function `nth_root`, and to have it return the real/complex answer depending on whether or not the argument is real/complex?\n\n(I also like having the codomain of a function be explicit, so I'm not really advocating for this, just wondering out loud.)",
    "created_at": "2020-06-12T15:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167396",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:20'></a>The current behavior of integer/float exponentiation is due to python, I guess?

```
$ python
Python 3.7.7 (default, May  8 2020, 10:21:17) 
[GCC 9.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> (-1)**(1/3)
(0.5000000000000001+0.8660254037844386j)
```

Otherwise the question can be asked: why not make that return real numbers when the argument is real? Which leads me to this question: would it make sense to call this function `nth_root`, and to have it return the real/complex answer depending on whether or not the argument is real/complex?

(I also like having the codomain of a function be explicit, so I'm not really advocating for this, just wondering out loud.)



---

archive/issue_comments_167397.json:
```json
{
    "body": "<a id='comment:21'></a>Some comments:\n- I think evalf needs some care to work properly on real ball fields and real interval fields.\n- I think we need a derivative implementation. I'd say just the formal rule `d/dx real_nth_root(x,n) = 1/n*sgn(x)*real_nth_root(x,n)^(1/n-1)`. Naturally, we don't have to support differentiation with respect to the second variable.\n- I think `real_nth_root(x,n)^m` should not simplify to `real_nth_root(x^m,n)`. For instance, for `real_nth_root(-1,2)^2` this goes wrong.",
    "created_at": "2020-06-12T16:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167397",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:21'></a>Some comments:
- I think evalf needs some care to work properly on real ball fields and real interval fields.
- I think we need a derivative implementation. I'd say just the formal rule `d/dx real_nth_root(x,n) = 1/n*sgn(x)*real_nth_root(x,n)^(1/n-1)`. Naturally, we don't have to support differentiation with respect to the second variable.
- I think `real_nth_root(x,n)^m` should not simplify to `real_nth_root(x^m,n)`. For instance, for `real_nth_root(-1,2)^2` this goes wrong.



---

archive/issue_comments_167398.json:
```json
{
    "body": "<a id='comment:22'></a>More concretely, then, for this ticket:\n* Current branch + things that are probably necessary just to use:\n  * Derivative and evaluation (can follow Sympy or Nils with the former, perhaps).  Can we just use the syntax in Burcin's patch for the derivative, or do we no longer have that underscore method?  \n  * I can't remember if we support a custom integration but could include something in the documentation saying to use Sympy if you have to integrate?\n  * Possibly fix the simplification - is the one in the branch the same as Burcin's, or Nils'?  (Indeed, should we have this function work for `n` even and negative `x`?)\n  * Might as well add the extra conversions.\n\nAfter all, the point of this function (note how Sympy and the Ms handle this) is for something we know doesn't really behave well with respect to branch cuts etc., intentionally.  So no one should necessarily be using it for production symbolics, but rather really mostly just for classroom usage in situations (which are *legion*) where we have to explicitly exclude complex stuff.  Luckily for the logarithm this is a little easier to hide from the student, except for in an antiderivative of 1/x, but here it's not as \"nice\".\n\nThen a separate ticket could do:\n* Improve things like simplification/codomains from the most necessary.",
    "created_at": "2020-06-12T16:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167398",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>More concretely, then, for this ticket:
* Current branch + things that are probably necessary just to use:
  * Derivative and evaluation (can follow Sympy or Nils with the former, perhaps).  Can we just use the syntax in Burcin's patch for the derivative, or do we no longer have that underscore method?  
  * I can't remember if we support a custom integration but could include something in the documentation saying to use Sympy if you have to integrate?
  * Possibly fix the simplification - is the one in the branch the same as Burcin's, or Nils'?  (Indeed, should we have this function work for `n` even and negative `x`?)
  * Might as well add the extra conversions.

After all, the point of this function (note how Sympy and the Ms handle this) is for something we know doesn't really behave well with respect to branch cuts etc., intentionally.  So no one should necessarily be using it for production symbolics, but rather really mostly just for classroom usage in situations (which are *legion*) where we have to explicitly exclude complex stuff.  Luckily for the logarithm this is a little easier to hide from the student, except for in an antiderivative of 1/x, but here it's not as "nice".

Then a separate ticket could do:
* Improve things like simplification/codomains from the most necessary.



---

archive/issue_comments_167399.json:
```json
{
    "body": "Changing commit from \"5028e22e1d4bbd112a14983efd13f7aa43adf168\" to \"e188fa24b1857152b234551950eab526870811ca\"",
    "created_at": "2020-06-17T13:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167399",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5028e22e1d4bbd112a14983efd13f7aa43adf168" to "e188fa24b1857152b234551950eab526870811ca"



---

archive/issue_comments_167400.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-17T13:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_167401.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:19 kcrisman]:\n> Kwankyu (\uad00\uaddc?)\n\n\nCorrect!\n\n> Here are some questions/comments (for anyone, not necessarily for klee):\n> * See [this list of plot methods for this](https://github.com/sagemath/sage/blob/develop/src/sage/plot/plot.py#L1502) in the plot doc.  We should add this, perhaps as the first-order approximation.\n\n\nDone.\n\n> * The file [faq-usage.rst](https://github.com/sagemath/sage/blob/develop/src/doc/en/faq/faq-usage.rst) also should be amended since it mentions the same issue.\n\n\nDone.\n\n> * Maybe even there should be a plot example in this file, and then a link to this function from the plot doc?\n\n\nMade a link from the plot doc.\n\n> * Does this one work with derivatives/integrals?  Maybe in the meantime we don't need the custom method.\n\n\nAlmost.\n\n```\nsage: f = real_nth_root(x,3)\nsage: f.diff()\n1/3*real_nth_root(x^(-2), 3)\nsage: f.integrate(x)\nintegrate(abs(x)^(1/3)*sgn(x), x)\nsage: _.diff()\nabs(x)^(1/3)*sgn(x)\n```\n\n> * Apparently Mathematica now has something like this, called [Surd](https://reference.wolfram.com/language/ref/Surd.html) which, while perhaps technically a correct name, is not exactly inspiring to anyone who has taken math since 1950 ... Perhaps this is because Maple [also has the same name](https://www.maplesoft.com/support/help/Maple/view.aspx?path=surd) though not capitalized.  I like the !Sage/Sympy name *much* better, but anyway these can be added to the conversions.  (I don't think Maxima has an equivalent for now.)\n\n\nDone. But I could not test them as I have no Mathematica nor Maple.",
    "created_at": "2020-06-17T13:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167401",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:24'></a>Replying to [comment:19 kcrisman]:
> Kwankyu (관규?)


Correct!

> Here are some questions/comments (for anyone, not necessarily for klee):
> * See [this list of plot methods for this](https://github.com/sagemath/sage/blob/develop/src/sage/plot/plot.py#L1502) in the plot doc.  We should add this, perhaps as the first-order approximation.


Done.

> * The file [faq-usage.rst](https://github.com/sagemath/sage/blob/develop/src/doc/en/faq/faq-usage.rst) also should be amended since it mentions the same issue.


Done.

> * Maybe even there should be a plot example in this file, and then a link to this function from the plot doc?


Made a link from the plot doc.

> * Does this one work with derivatives/integrals?  Maybe in the meantime we don't need the custom method.


Almost.

```
sage: f = real_nth_root(x,3)
sage: f.diff()
1/3*real_nth_root(x^(-2), 3)
sage: f.integrate(x)
integrate(abs(x)^(1/3)*sgn(x), x)
sage: _.diff()
abs(x)^(1/3)*sgn(x)
```

> * Apparently Mathematica now has something like this, called [Surd](https://reference.wolfram.com/language/ref/Surd.html) which, while perhaps technically a correct name, is not exactly inspiring to anyone who has taken math since 1950 ... Perhaps this is because Maple [also has the same name](https://www.maplesoft.com/support/help/Maple/view.aspx?path=surd) though not capitalized.  I like the !Sage/Sympy name *much* better, but anyway these can be added to the conversions.  (I don't think Maxima has an equivalent for now.)


Done. But I could not test them as I have no Mathematica nor Maple.



---

archive/issue_comments_167402.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:20 mjo]:\n> The current behavior of integer/float exponentiation is due to python, I guess?\n> \n> \n> ```\n> $ python\n> Python 3.7.7 (default, May  8 2020, 10:21:17) \n> [GCC 9.3.0] on linux\n> Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n> >>> (-1)**(1/3)\n> (0.5000000000000001+0.8660254037844386j)\n> ```\n\n\nThis convention is shared by other symbolic algebra systems.",
    "created_at": "2020-06-17T13:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167402",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:25'></a>Replying to [comment:20 mjo]:
> The current behavior of integer/float exponentiation is due to python, I guess?
> 
> 
> ```
> $ python
> Python 3.7.7 (default, May  8 2020, 10:21:17) 
> [GCC 9.3.0] on linux
> Type "help", "copyright", "credits" or "license" for more information.
> >>> (-1)**(1/3)
> (0.5000000000000001+0.8660254037844386j)
> ```


This convention is shared by other symbolic algebra systems.



---

archive/issue_comments_167403.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:21 nbruin]:\n> Some comments:\n> - I think evalf needs some care to work properly on real ball fields and real interval fields.\n\n\nNow it works for real ball fields: \n\n```\nsage: a = RBF(-2)\nsage: real_nth_root(a, 3)\n[-1.259921049894873 +/- 3.92e-16]\n```\nand for real interval fields:\n\n```\nsage: a = RIF(-2)\nsage: real_nth_root(a, 3)\n-1.259921049894873?\n```\n\n>  - I think we need a derivative implementation. I'd say just the formal rule `d/dx real_nth_root(x,n) = 1/n*sgn(x)*real_nth_root(x,n)^(1/n-1)`. Naturally, we don't have to support differentiation with respect to the second variable.\n\n\nI guess you meant `d/dx real_nth_root(x,n) = 1/n*real_nth_root(x,n)^(1-n)`. Done.\n\n>  - I think `real_nth_root(x,n)^m` should not simplify to `real_nth_root(x^m,n)`. For instance, for `real_nth_root(-1,2)^2` this goes wrong.\n\n\n`real_nth_root(-1,2)` now raises `ValueError`. The simplification is valid for other cases.",
    "created_at": "2020-06-17T13:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167403",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:26'></a>Replying to [comment:21 nbruin]:
> Some comments:
> - I think evalf needs some care to work properly on real ball fields and real interval fields.


Now it works for real ball fields: 

```
sage: a = RBF(-2)
sage: real_nth_root(a, 3)
[-1.259921049894873 +/- 3.92e-16]
```
and for real interval fields:

```
sage: a = RIF(-2)
sage: real_nth_root(a, 3)
-1.259921049894873?
```

>  - I think we need a derivative implementation. I'd say just the formal rule `d/dx real_nth_root(x,n) = 1/n*sgn(x)*real_nth_root(x,n)^(1/n-1)`. Naturally, we don't have to support differentiation with respect to the second variable.


I guess you meant `d/dx real_nth_root(x,n) = 1/n*real_nth_root(x,n)^(1-n)`. Done.

>  - I think `real_nth_root(x,n)^m` should not simplify to `real_nth_root(x^m,n)`. For instance, for `real_nth_root(-1,2)^2` this goes wrong.


`real_nth_root(-1,2)` now raises `ValueError`. The simplification is valid for other cases.



---

archive/issue_comments_167404.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:22 kcrisman]:\n\n> After all, the point of this function (note how Sympy and the Ms handle this) is for something we know doesn't really behave well with respect to branch cuts etc., intentionally.  So no one should necessarily be using it for production symbolics, but rather really mostly just for classroom usage in situations (which are *legion*) where we have to explicitly exclude complex stuff.  Luckily for the logarithm this is a little easier to hide from the student, except for in an antiderivative of 1/x, but here it's not as \"nice\".\n\n\nSchool math just works:\n\n```\nsage: f = real_nth_root(x^2, 2)\nsage: g = f.diff()\nsage: f.plot()\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\nsage: g.plot()\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```",
    "created_at": "2020-06-17T13:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167404",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:27'></a>Replying to [comment:22 kcrisman]:

> After all, the point of this function (note how Sympy and the Ms handle this) is for something we know doesn't really behave well with respect to branch cuts etc., intentionally.  So no one should necessarily be using it for production symbolics, but rather really mostly just for classroom usage in situations (which are *legion*) where we have to explicitly exclude complex stuff.  Luckily for the logarithm this is a little easier to hide from the student, except for in an antiderivative of 1/x, but here it's not as "nice".


School math just works:

```
sage: f = real_nth_root(x^2, 2)
sage: g = f.diff()
sage: f.plot()
Launched png viewer for Graphics object consisting of 1 graphics primitive
sage: g.plot()
Launched png viewer for Graphics object consisting of 1 graphics primitive
```



---

archive/issue_comments_167405.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-17T14:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167405",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_167406.json:
```json
{
    "body": "Changing commit from \"e188fa24b1857152b234551950eab526870811ca\" to \"7cef50b2542c2b90e8a60b88beb6fc6d09d0d380\"",
    "created_at": "2020-06-17T14:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e188fa24b1857152b234551950eab526870811ca" to "7cef50b2542c2b90e8a60b88beb6fc6d09d0d380"



---

archive/issue_comments_167407.json:
```json
{
    "body": "<a id='comment:29'></a>Okay, this is ready enough that I will (try to) upgrade my Sage develop branch just for this ticket.  I still have a few thoughts - notably about seeing whether we can get Sympy to give us an integral for this, and about the derivative.  Maybe we can get someone to even test out the M* conversion...  Thanks for this work.  Only took us how many years?",
    "created_at": "2020-06-17T14:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167407",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:29'></a>Okay, this is ready enough that I will (try to) upgrade my Sage develop branch just for this ticket.  I still have a few thoughts - notably about seeing whether we can get Sympy to give us an integral for this, and about the derivative.  Maybe we can get someone to even test out the M* conversion...  Thanks for this work.  Only took us how many years?



---

archive/issue_comments_167408.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-18T00:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_167409.json:
```json
{
    "body": "Changing commit from \"7cef50b2542c2b90e8a60b88beb6fc6d09d0d380\" to \"d12ab31283e8bf8905fb1534d653df97619ba575\"",
    "created_at": "2020-06-18T00:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167409",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7cef50b2542c2b90e8a60b88beb6fc6d09d0d380" to "d12ab31283e8bf8905fb1534d653df97619ba575"



---

archive/issue_comments_167410.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:20 mjo]:\n\n> Otherwise the question can be asked: why not make that return real numbers when the argument is real? Which leads me to this question: would it make sense to call this function `nth_root`, and to have it return the real/complex answer depending on whether or not the argument is real/complex?\n\n\nIt is possible to get this behavior\n\n```\nsage: f = x^(1/3)\nsage: f(-8)\n2*(-1)^(1/3)\nsage: f(-2.)\n0.629960524947437 + 1.09112363597172*I\nsage: assume(x, 'real')\nsage: g = x^(1/3)\nsage: g(-2.)\n-1.25992104989487\nsage: g\nreal_nth_root(x, 3)\nsage: g.diff()\n1/3*real_nth_root(x^(-2), 3)\nsage: g.plot()\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```\n\nby injecting some code into `expression.pyx`. The question is whether we want this.",
    "created_at": "2020-06-18T05:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167410",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:31'></a>Replying to [comment:20 mjo]:

> Otherwise the question can be asked: why not make that return real numbers when the argument is real? Which leads me to this question: would it make sense to call this function `nth_root`, and to have it return the real/complex answer depending on whether or not the argument is real/complex?


It is possible to get this behavior

```
sage: f = x^(1/3)
sage: f(-8)
2*(-1)^(1/3)
sage: f(-2.)
0.629960524947437 + 1.09112363597172*I
sage: assume(x, 'real')
sage: g = x^(1/3)
sage: g(-2.)
-1.25992104989487
sage: g
real_nth_root(x, 3)
sage: g.diff()
1/3*real_nth_root(x^(-2), 3)
sage: g.plot()
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

by injecting some code into `expression.pyx`. The question is whether we want this.



---

archive/issue_comments_167411.json:
```json
{
    "body": "<a id='comment:32'></a>> by injecting some code into `expression.pyx`. The question is whether we want this.\n\nI'm gonna say no on that - not without some healthy sage-devel discussion.  I do think some people use the assume command for precisely this purpose, though.\n\nI'm going to look at this branch later today, thank you again for putting it in \"modern\" shape!",
    "created_at": "2020-06-18T11:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167411",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:32'></a>> by injecting some code into `expression.pyx`. The question is whether we want this.

I'm gonna say no on that - not without some healthy sage-devel discussion.  I do think some people use the assume command for precisely this purpose, though.

I'm going to look at this branch later today, thank you again for putting it in "modern" shape!



---

archive/issue_comments_167412.json:
```json
{
    "body": "<a id='comment:33'></a>Here come a bunch of questions now that I have played around with this. They don't necessarily all need changes, but I think they are reasonable to ask even if they end up not needing change.  But I'm not letting the perfect be the enemy of the good; as long as we document and open new tickets, that would be the important part.\n\n\n---\n\n\n* Do we want a latex method?  E.g. `latex_name=r\"\\mathrm{abs}\"` used elsewhere in this file.  This is obviously not ideal:\n\n```\nsage: latex(F)\n{\\rm real}_{{\\rm nth}_{{\\rm root}}}\\left(x, 5\\right)\n```\n  But I'm not sure whether just using the usual root syntax is \"correct\" either since we have a different function now.  Using `abs(x)^(1/3)*sgn(x)` doesn't work for even `n`, else I'd recommend that for latex.\n* Integration, perhaps surprisingly, works, as you mention [comment:24 above]:\n\n```\nsage: f = real_nth_root(x,3)\nsage: f.diff()\n1/3*real_nth_root(x^(-2), 3)\nsage: f.integrate(x)\nintegrate(abs(x)^(1/3)*sgn(x), x)\nsage: _.diff()\nabs(x)^(1/3)*sgn(x)\n```\n  Apparently integration now tries Maxima, Giac, and then Sympy, so that explains it.  We should probably document this behavior.\n* Upon further consideration, maybe the derivative can be a little better.  Because aren't we sort of assuming this is real input?  Maybe we aren't.  Here is Sympy.\n\n```\n>>> from sympy import root, real_root, Rational\n>>> from sympy.abc import x, n\n>>> real_root(x,5)\nPiecewise((Abs(x)**(1/5)*sign(x), Eq(im(x), 0)), (x**(1/5), True))\n>>> diff(real_root(x,5),x)\nPiecewise((Abs(x)**(1/5)*Derivative(sign(x), x) + (re(x)*Derivative(re(x), x) + im(x)*Derivative(im(x), x))*sign(x)**2/(5*x*Abs(x)**(4/5)), Eq(im(x), 0)), (1/(5*x**(4/5)), True))\n>>> x = Symbol('x', real=True)\n>>> diff(real_root(x,5),x)\n2*Abs(x)**(1/5)*DiracDelta(x) + sign(x)**2/(5*Abs(x)**(4/5))\n```\n  and here is Sage\n\n```\nsage: G = abs(x)^(1/5)*sgn(x)\nsage: G\nabs(x)^(1/5)*sgn(x)\nsage: G.diff(x)\n2*abs(x)^(1/5)*dirac_delta(x) + 1/10*(x + conjugate(x))*sgn(x)/abs(x)^(9/5)\nsage: G.diff(x).simplify()\n2*abs(x)^(1/5)*dirac_delta(x) + 1/5*x*sgn(x)/abs(x)^(9/5)\n```\n  at least\n\n```\nsage: assume(x,'real')\nsage: F.diff(x)\n1/5*real_nth_root(x^(-4), 5)\n```\n  should mimic this, if not perhaps always.   Any thoughts on this?\n* To elaborate, Sympy's function somehow allows complex input, but do we want to?\n\n```\nsage: real_nth_root(3.*I,5)\n1.18476052767182 + 0.384952030759866*I # should this happen?\n```\n  That's of course related to Nils question regarding negative input too.\n\n```\nsage: H = real_nth_root(x,2)\nsage: (H.subs(x=-1))^2\n---------------------------------------------------------------------------\n...\nValueError: no real nth root of negative real number with even n\nsage: ((H)^2).subs(x=-1)\n1\n```\n  I'm not sure the latter should be allowed or not.",
    "created_at": "2020-06-18T17:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167412",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:33'></a>Here come a bunch of questions now that I have played around with this. They don't necessarily all need changes, but I think they are reasonable to ask even if they end up not needing change.  But I'm not letting the perfect be the enemy of the good; as long as we document and open new tickets, that would be the important part.


---


* Do we want a latex method?  E.g. `latex_name=r"\mathrm{abs}"` used elsewhere in this file.  This is obviously not ideal:

```
sage: latex(F)
{\rm real}_{{\rm nth}_{{\rm root}}}\left(x, 5\right)
```
  But I'm not sure whether just using the usual root syntax is "correct" either since we have a different function now.  Using `abs(x)^(1/3)*sgn(x)` doesn't work for even `n`, else I'd recommend that for latex.
* Integration, perhaps surprisingly, works, as you mention [comment:24 above]:

```
sage: f = real_nth_root(x,3)
sage: f.diff()
1/3*real_nth_root(x^(-2), 3)
sage: f.integrate(x)
integrate(abs(x)^(1/3)*sgn(x), x)
sage: _.diff()
abs(x)^(1/3)*sgn(x)
```
  Apparently integration now tries Maxima, Giac, and then Sympy, so that explains it.  We should probably document this behavior.
* Upon further consideration, maybe the derivative can be a little better.  Because aren't we sort of assuming this is real input?  Maybe we aren't.  Here is Sympy.

```
>>> from sympy import root, real_root, Rational
>>> from sympy.abc import x, n
>>> real_root(x,5)
Piecewise((Abs(x)**(1/5)*sign(x), Eq(im(x), 0)), (x**(1/5), True))
>>> diff(real_root(x,5),x)
Piecewise((Abs(x)**(1/5)*Derivative(sign(x), x) + (re(x)*Derivative(re(x), x) + im(x)*Derivative(im(x), x))*sign(x)**2/(5*x*Abs(x)**(4/5)), Eq(im(x), 0)), (1/(5*x**(4/5)), True))
>>> x = Symbol('x', real=True)
>>> diff(real_root(x,5),x)
2*Abs(x)**(1/5)*DiracDelta(x) + sign(x)**2/(5*Abs(x)**(4/5))
```
  and here is Sage

```
sage: G = abs(x)^(1/5)*sgn(x)
sage: G
abs(x)^(1/5)*sgn(x)
sage: G.diff(x)
2*abs(x)^(1/5)*dirac_delta(x) + 1/10*(x + conjugate(x))*sgn(x)/abs(x)^(9/5)
sage: G.diff(x).simplify()
2*abs(x)^(1/5)*dirac_delta(x) + 1/5*x*sgn(x)/abs(x)^(9/5)
```
  at least

```
sage: assume(x,'real')
sage: F.diff(x)
1/5*real_nth_root(x^(-4), 5)
```
  should mimic this, if not perhaps always.   Any thoughts on this?
* To elaborate, Sympy's function somehow allows complex input, but do we want to?

```
sage: real_nth_root(3.*I,5)
1.18476052767182 + 0.384952030759866*I # should this happen?
```
  That's of course related to Nils question regarding negative input too.

```
sage: H = real_nth_root(x,2)
sage: (H.subs(x=-1))^2
---------------------------------------------------------------------------
...
ValueError: no real nth root of negative real number with even n
sage: ((H)^2).subs(x=-1)
1
```
  I'm not sure the latter should be allowed or not.



---

archive/issue_comments_167413.json:
```json
{
    "body": "<a id='comment:34'></a>\n```\nsage -t src/doc/en/faq/faq-usage.rst\n**********************************************************************\nFile \"src/doc/en/faq/faq-usage.rst\", line 692, in doc.en.faq.faq-usage\nFailed example:\n    plot(x^(1/3), (x, -1, 1))\nExpected nothing\nGot:\n    verbose 0 (3834: plot.py, generate_plot_points) WARNING: When plotting, failed to evaluate function at 100 points.\n    verbose 0 (3834: plot.py, generate_plot_points) Last error message: 'can't convert complex to float'\n    Graphics object consisting of 1 graphics primitive\n**********************************************************************\n```\nSo you'll have to make that not tested (I think there is a way to mark it as such other than `# not tested` but anyway...).",
    "created_at": "2020-06-18T18:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167413",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:34'></a>
```
sage -t src/doc/en/faq/faq-usage.rst
**********************************************************************
File "src/doc/en/faq/faq-usage.rst", line 692, in doc.en.faq.faq-usage
Failed example:
    plot(x^(1/3), (x, -1, 1))
Expected nothing
Got:
    verbose 0 (3834: plot.py, generate_plot_points) WARNING: When plotting, failed to evaluate function at 100 points.
    verbose 0 (3834: plot.py, generate_plot_points) Last error message: 'can't convert complex to float'
    Graphics object consisting of 1 graphics primitive
**********************************************************************
```
So you'll have to make that not tested (I think there is a way to mark it as such other than `# not tested` but anyway...).



---

archive/issue_comments_167414.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-18T18:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167414",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_167415.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:32 kcrisman]:\n> > by injecting some code into `expression.pyx`. The question is whether we want this.\n\n> I'm gonna say no on that - not without some healthy sage-devel discussion.  I do think some people use the assume command for precisely this purpose, though.\n\nInjecting the code incur many doctest failures in other places. So I give up this idea.",
    "created_at": "2020-06-19T01:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167415",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:36'></a>Replying to [comment:32 kcrisman]:
> > by injecting some code into `expression.pyx`. The question is whether we want this.

> I'm gonna say no on that - not without some healthy sage-devel discussion.  I do think some people use the assume command for precisely this purpose, though.

Injecting the code incur many doctest failures in other places. So I give up this idea.



---

archive/issue_comments_167416.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:33 kcrisman]:\n\n> * Do we want a latex method?  E.g. `latex_name=r\"\\mathrm{abs}\"` used elsewhere in this file.  This is obviously not ideal:\n> \n> ```\n> sage: latex(F)\n> {\\rm real}_{{\\rm nth}_{{\\rm root}}}\\left(x, 5\\right)\n> ```\n>   But I'm not sure whether just using the usual root syntax is \"correct\" either since we have a different function now.  Using `abs(x)^(1/3)*sgn(x)` doesn't work for even `n`, else I'd recommend that for latex.\n\n\nI see `real_nth_root` as representing the real function x<sup>1/n</sup> with variable x taking real numbers (possibly negative for odd n). The latex print is for humans. So why not just print x<sup>1/n</sup>?\n\n\n> * Integration, perhaps surprisingly, works, as you mention [comment:24 above]:\n> \n> ```\n> sage: f = real_nth_root(x,3)\n> sage: f.diff()\n> 1/3*real_nth_root(x^(-2), 3)\n> sage: f.integrate(x)\n> integrate(abs(x)^(1/3)*sgn(x), x)\n> sage: _.diff()\n> abs(x)^(1/3)*sgn(x)\n> ```\n>   Apparently integration now tries Maxima, Giac, and then Sympy, so that explains it.  We should probably document this behavior.\n\n\nDone.\n\n> * Upon further consideration, maybe the derivative can be a little better.  Because aren't we sort of assuming this is real input?  Maybe we aren't.  Here is Sympy.\n> \n> ```\n> >>> from sympy import root, real_root, Rational\n> >>> from sympy.abc import x, n\n> >>> real_root(x,5)\n> Piecewise((Abs(x)**(1/5)*sign(x), Eq(im(x), 0)), (x**(1/5), True))\n> >>> diff(real_root(x,5),x)\n> Piecewise((Abs(x)**(1/5)*Derivative(sign(x), x) + (re(x)*Derivative(re(x), x) + im(x)*Derivative(im(x), x))*sign(x)**2/(5*x*Abs(x)**(4/5)), Eq(im(x), 0)), (1/(5*x**(4/5)), True))\n> >>> x = Symbol('x', real=True)\n> >>> diff(real_root(x,5),x)\n> 2*Abs(x)**(1/5)*DiracDelta(x) + sign(x)**2/(5*Abs(x)**(4/5))\n> ```\n>   and here is Sage\n> \n> ```\n> sage: G = abs(x)^(1/5)*sgn(x)\n> sage: G\n> abs(x)^(1/5)*sgn(x)\n> sage: G.diff(x)\n> 2*abs(x)^(1/5)*dirac_delta(x) + 1/10*(x + conjugate(x))*sgn(x)/abs(x)^(9/5)\n> sage: G.diff(x).simplify()\n> 2*abs(x)^(1/5)*dirac_delta(x) + 1/5*x*sgn(x)/abs(x)^(9/5)\n> ```\n>   at least\n> \n> ```\n> sage: assume(x,'real')\n> sage: F.diff(x)\n> 1/5*real_nth_root(x^(-4), 5)\n> ```\n>   should mimic this, if not perhaps always.   Any thoughts on this?\n\n\nI don't get your concern. I think there is nothing wrong with\n\n```\nsage: f = real_nth_root(x,3)\nsage: f.diff()\n1/3*real_nth_root(x^(-2), 3)\n```\n\n> * To elaborate, Sympy's function somehow allows complex input, but do we want to?\n> \n> ```\n> sage: real_nth_root(3.*I,5)\n> 1.18476052767182 + 0.384952030759866*I # should this happen?\n> ```\n>   That's of course related to Nils question regarding negative input too.\n> \n> ```\n> sage: H = real_nth_root(x,2)\n> sage: (H.subs(x=-1))^2\n> ---------------------------------------------------------------------------\n> ...\n> ValueError: no real nth root of negative real number with even n\n> sage: ((H)^2).subs(x=-1)\n> 1\n> ```\n>   I'm not sure the latter should be allowed or not.\n\n\nNo. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.",
    "created_at": "2020-06-19T02:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167416",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:37'></a>Replying to [comment:33 kcrisman]:

> * Do we want a latex method?  E.g. `latex_name=r"\mathrm{abs}"` used elsewhere in this file.  This is obviously not ideal:
> 
> ```
> sage: latex(F)
> {\rm real}_{{\rm nth}_{{\rm root}}}\left(x, 5\right)
> ```
>   But I'm not sure whether just using the usual root syntax is "correct" either since we have a different function now.  Using `abs(x)^(1/3)*sgn(x)` doesn't work for even `n`, else I'd recommend that for latex.


I see `real_nth_root` as representing the real function x<sup>1/n</sup> with variable x taking real numbers (possibly negative for odd n). The latex print is for humans. So why not just print x<sup>1/n</sup>?


> * Integration, perhaps surprisingly, works, as you mention [comment:24 above]:
> 
> ```
> sage: f = real_nth_root(x,3)
> sage: f.diff()
> 1/3*real_nth_root(x^(-2), 3)
> sage: f.integrate(x)
> integrate(abs(x)^(1/3)*sgn(x), x)
> sage: _.diff()
> abs(x)^(1/3)*sgn(x)
> ```
>   Apparently integration now tries Maxima, Giac, and then Sympy, so that explains it.  We should probably document this behavior.


Done.

> * Upon further consideration, maybe the derivative can be a little better.  Because aren't we sort of assuming this is real input?  Maybe we aren't.  Here is Sympy.
> 
> ```
> >>> from sympy import root, real_root, Rational
> >>> from sympy.abc import x, n
> >>> real_root(x,5)
> Piecewise((Abs(x)**(1/5)*sign(x), Eq(im(x), 0)), (x**(1/5), True))
> >>> diff(real_root(x,5),x)
> Piecewise((Abs(x)**(1/5)*Derivative(sign(x), x) + (re(x)*Derivative(re(x), x) + im(x)*Derivative(im(x), x))*sign(x)**2/(5*x*Abs(x)**(4/5)), Eq(im(x), 0)), (1/(5*x**(4/5)), True))
> >>> x = Symbol('x', real=True)
> >>> diff(real_root(x,5),x)
> 2*Abs(x)**(1/5)*DiracDelta(x) + sign(x)**2/(5*Abs(x)**(4/5))
> ```
>   and here is Sage
> 
> ```
> sage: G = abs(x)^(1/5)*sgn(x)
> sage: G
> abs(x)^(1/5)*sgn(x)
> sage: G.diff(x)
> 2*abs(x)^(1/5)*dirac_delta(x) + 1/10*(x + conjugate(x))*sgn(x)/abs(x)^(9/5)
> sage: G.diff(x).simplify()
> 2*abs(x)^(1/5)*dirac_delta(x) + 1/5*x*sgn(x)/abs(x)^(9/5)
> ```
>   at least
> 
> ```
> sage: assume(x,'real')
> sage: F.diff(x)
> 1/5*real_nth_root(x^(-4), 5)
> ```
>   should mimic this, if not perhaps always.   Any thoughts on this?


I don't get your concern. I think there is nothing wrong with

```
sage: f = real_nth_root(x,3)
sage: f.diff()
1/3*real_nth_root(x^(-2), 3)
```

> * To elaborate, Sympy's function somehow allows complex input, but do we want to?
> 
> ```
> sage: real_nth_root(3.*I,5)
> 1.18476052767182 + 0.384952030759866*I # should this happen?
> ```
>   That's of course related to Nils question regarding negative input too.
> 
> ```
> sage: H = real_nth_root(x,2)
> sage: (H.subs(x=-1))^2
> ---------------------------------------------------------------------------
> ...
> ValueError: no real nth root of negative real number with even n
> sage: ((H)^2).subs(x=-1)
> 1
> ```
>   I'm not sure the latter should be allowed or not.


No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.



---

archive/issue_comments_167417.json:
```json
{
    "body": "Changing commit from \"d12ab31283e8bf8905fb1534d653df97619ba575\" to \"00380b09135e8171593108059f17490a23f554ad\"",
    "created_at": "2020-06-19T02:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d12ab31283e8bf8905fb1534d653df97619ba575" to "00380b09135e8171593108059f17490a23f554ad"



---

archive/issue_comments_167418.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-19T02:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_167419.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:36 klee]:\n> \n> Injecting the code incur many doctest failures in other places. So I give up this idea. \n\n\nI was thinking of something simpler, like\n\n```\nsage: nth_root(RR(-1), 3)\n-1.00000000000000\nsage: nth_root(CC(-1), 3)\n0.500000000000000 + 0.866025403784439*I\n```",
    "created_at": "2020-06-19T02:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167419",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:39'></a>Replying to [comment:36 klee]:
> 
> Injecting the code incur many doctest failures in other places. So I give up this idea. 


I was thinking of something simpler, like

```
sage: nth_root(RR(-1), 3)
-1.00000000000000
sage: nth_root(CC(-1), 3)
0.500000000000000 + 0.866025403784439*I
```



---

archive/issue_comments_167420.json:
```json
{
    "body": "<a id='comment:40'></a>Thanks for all these fixes - we are converging :-)  Couple more questions/comments:\n\n---\n\n* I don't think you needed to make this one not tested; it should have passed fine.  Only the subsequent one would have thrown an error.\n\n```diff\n-    sage: plot(real_nth_root(x, 3), (x, -1, 1))\n-    Graphics object consisting of 1 graphics primitive\n+    sage: plot(real_nth_root(x, 3), (x, -1, 1))  # not tested\n```\n\n* latex:\n> I see `real_nth_root` as representing the real function x<sup>1/n</sup> with variable x taking real numbers (possibly negative for odd n). The latex print is for humans. So why not just print x<sup>1/n</sup>?\n\n  It's a little tricky, because the humans it is intended for might not realize it's not quite the same.  mjo or Nils, any thoughts?  I can go with it for now.\n\n* calculus:\n> Done.\nThanks.  However, that brings up the related issue that the online documentation is only going to show the `_init_` method doc (and apparently not the tests?).  \n\n  If you are up for it, I'd recommend making a more \"narrative\" structure which includes examples of calculus, plotting, etc., more like [real_part](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/other.py?id=00380b09135e8171593108059f17490a23f554ad#n1208) does.  If you'd prefer me to do that, I can - might just take a little longer as I recall how to add to a public branch :-)\n\n* diff output:\n> > {{{\n> > sage: assume(x,'real')\n> > sage: F.diff(x)\n> > 1/5*real_nth_root(x^(-4), 5)\n> > }}}\n> >   should mimic this, if not perhaps always.   Any thoughts on this?\n\n> \n> I don't get your concern. I think there is nothing wrong with\n> \n> ```\n> sage: f = real_nth_root(x,3)\n> sage: f.diff()\n> 1/3*real_nth_root(x^(-2), 3)\n> ```\n> \n\n  If `n` is odd, though, `2*abs(x)^(1/5)*dirac_delta(x) + 1/5*x*sgn(x)/abs(x)^(9/5)` is somehow \"better\", and available.  Just thinking out loud; could be for a followup ticket.\n\n* input:\n> > {{{\n> > sage: H = real_nth_root(x,2)\n> > sage: (H.subs(x=-1))^2\n> > \n> > ---\n> > ...\n> > ValueError: no real nth root of negative real number with even n\n> > sage: ((H)^2).subs(x=-1)\n> > 1\n> > }}}\n> >   I'm not sure the latter should be allowed or not.\n\n> \n> No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.\n\n  Wait, so are you saying that we should disallow that function with `x=-1` to be evaluated?  Because `1/x` blows up if we inject `x=0` - though then again Sage simplifies `1/x*x =1` which isn't technically correct.  Anyway, I think this is Nils' point.",
    "created_at": "2020-06-19T14:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167420",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:40'></a>Thanks for all these fixes - we are converging :-)  Couple more questions/comments:

---

* I don't think you needed to make this one not tested; it should have passed fine.  Only the subsequent one would have thrown an error.

```diff
-    sage: plot(real_nth_root(x, 3), (x, -1, 1))
-    Graphics object consisting of 1 graphics primitive
+    sage: plot(real_nth_root(x, 3), (x, -1, 1))  # not tested
```

* latex:
> I see `real_nth_root` as representing the real function x<sup>1/n</sup> with variable x taking real numbers (possibly negative for odd n). The latex print is for humans. So why not just print x<sup>1/n</sup>?

  It's a little tricky, because the humans it is intended for might not realize it's not quite the same.  mjo or Nils, any thoughts?  I can go with it for now.

* calculus:
> Done.
Thanks.  However, that brings up the related issue that the online documentation is only going to show the `_init_` method doc (and apparently not the tests?).  

  If you are up for it, I'd recommend making a more "narrative" structure which includes examples of calculus, plotting, etc., more like [real_part](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/other.py?id=00380b09135e8171593108059f17490a23f554ad#n1208) does.  If you'd prefer me to do that, I can - might just take a little longer as I recall how to add to a public branch :-)

* diff output:
> > {{{
> > sage: assume(x,'real')
> > sage: F.diff(x)
> > 1/5*real_nth_root(x^(-4), 5)
> > }}}
> >   should mimic this, if not perhaps always.   Any thoughts on this?

> 
> I don't get your concern. I think there is nothing wrong with
> 
> ```
> sage: f = real_nth_root(x,3)
> sage: f.diff()
> 1/3*real_nth_root(x^(-2), 3)
> ```
> 

  If `n` is odd, though, `2*abs(x)^(1/5)*dirac_delta(x) + 1/5*x*sgn(x)/abs(x)^(9/5)` is somehow "better", and available.  Just thinking out loud; could be for a followup ticket.

* input:
> > {{{
> > sage: H = real_nth_root(x,2)
> > sage: (H.subs(x=-1))^2
> > 
> > ---
> > ...
> > ValueError: no real nth root of negative real number with even n
> > sage: ((H)^2).subs(x=-1)
> > 1
> > }}}
> >   I'm not sure the latter should be allowed or not.

> 
> No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.

  Wait, so are you saying that we should disallow that function with `x=-1` to be evaluated?  Because `1/x` blows up if we inject `x=0` - though then again Sage simplifies `1/x*x =1` which isn't technically correct.  Anyway, I think this is Nils' point.



---

archive/issue_comments_167421.json:
```json
{
    "body": "<a id='comment:41'></a>> I was thinking of something simpler, like\n> \n> \n> ```\n> sage: nth_root(RR(-1), 3)\n> -1.00000000000000\n> sage: nth_root(CC(-1), 3)\n> 0.500000000000000 + 0.866025403784439*I\n> ```\n\n\nI feel like this would be another ticket, and need sage-devel discussion.  This ticket is about adding something to aid in plotting, and then making sure it has enough bells and whistles that it doesn't end up causing confusion.  I'm a little uncomfortable with this since\n\n```\nsage: RR(-1) == CC(-1)\nTrue\n```\nand the point of the function is strictly for pedagogical purposes (which should also be made clear in the documentation).",
    "created_at": "2020-06-19T14:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167421",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:41'></a>> I was thinking of something simpler, like
> 
> 
> ```
> sage: nth_root(RR(-1), 3)
> -1.00000000000000
> sage: nth_root(CC(-1), 3)
> 0.500000000000000 + 0.866025403784439*I
> ```


I feel like this would be another ticket, and need sage-devel discussion.  This ticket is about adding something to aid in plotting, and then making sure it has enough bells and whistles that it doesn't end up causing confusion.  I'm a little uncomfortable with this since

```
sage: RR(-1) == CC(-1)
True
```
and the point of the function is strictly for pedagogical purposes (which should also be made clear in the documentation).



---

archive/issue_comments_167422.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:41 kcrisman]:\n> \n> I feel like this would be another ticket, and need sage-devel discussion.  This ticket is about adding something to aid in plotting, and then making sure it has enough bells and whistles that it doesn't end up causing confusion.  I'm a little uncomfortable with this since\n> \n> ```\n> sage: RR(-1) == CC(-1)\n> True\n> ```\n> and the point of the function is strictly for pedagogical purposes (which should also be made clear in the documentation).\n\n\nWe run into that same problem whenever we have a subclass method that does something different from its superclass method. I was only trying to clear up my previous suggestion. If the authors/reviewers don't think this is a good idea, feel free to ignore it.",
    "created_at": "2020-06-19T14:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167422",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:42'></a>Replying to [comment:41 kcrisman]:
> 
> I feel like this would be another ticket, and need sage-devel discussion.  This ticket is about adding something to aid in plotting, and then making sure it has enough bells and whistles that it doesn't end up causing confusion.  I'm a little uncomfortable with this since
> 
> ```
> sage: RR(-1) == CC(-1)
> True
> ```
> and the point of the function is strictly for pedagogical purposes (which should also be made clear in the documentation).


We run into that same problem whenever we have a subclass method that does something different from its superclass method. I was only trying to clear up my previous suggestion. If the authors/reviewers don't think this is a good idea, feel free to ignore it.



---

archive/issue_comments_167423.json:
```json
{
    "body": "<a id='comment:43'></a>> I was only trying to clear up my previous suggestion. \n\nFair enough.  \n> If the authors/reviewers don't think this is a good idea, feel free to ignore it.\n\nIf this gets merged, why not open a new ticket for an `nth_root` function if you think it's more generally useful?  SymPy has some explicit warnings about these things for its function but we could follow that model (its function is intended for more than the current ticket, I believe).",
    "created_at": "2020-06-19T14:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167423",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:43'></a>> I was only trying to clear up my previous suggestion. 

Fair enough.  
> If the authors/reviewers don't think this is a good idea, feel free to ignore it.

If this gets merged, why not open a new ticket for an `nth_root` function if you think it's more generally useful?  SymPy has some explicit warnings about these things for its function but we could follow that model (its function is intended for more than the current ticket, I believe).



---

archive/issue_comments_167424.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:43 kcrisman]:\n> If this gets merged, why not open a new ticket for an `nth_root` function if you think it's more generally useful?  SymPy has some explicit warnings about these things for its function but we could follow that model (its function is intended for more than the current ticket, I believe).\n\n\nI'm not 100% convinced it's the right thing to do either. Especially if we already have `real_nth_root`, then we have `^(1/n)` for the complex root, and... presumably you know which one you want? I dunno. But until someone finds the existing methods lacking, adding them proactively just increases the chances that we'll have gotten it wrong when the need does arise.",
    "created_at": "2020-06-19T15:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167424",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:44'></a>Replying to [comment:43 kcrisman]:
> If this gets merged, why not open a new ticket for an `nth_root` function if you think it's more generally useful?  SymPy has some explicit warnings about these things for its function but we could follow that model (its function is intended for more than the current ticket, I believe).


I'm not 100% convinced it's the right thing to do either. Especially if we already have `real_nth_root`, then we have `^(1/n)` for the complex root, and... presumably you know which one you want? I dunno. But until someone finds the existing methods lacking, adding them proactively just increases the chances that we'll have gotten it wrong when the need does arise.



---

archive/issue_comments_167425.json:
```json
{
    "body": "Changing commit from \"00380b09135e8171593108059f17490a23f554ad\" to \"f8cb7a0429c2e696dc69db8466ecc077b0bf0f32\"",
    "created_at": "2020-06-22T01:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "00380b09135e8171593108059f17490a23f554ad" to "f8cb7a0429c2e696dc69db8466ecc077b0bf0f32"



---

archive/issue_comments_167426.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T01:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167426",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_167427.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:40 kcrisman]:\n> However, that brings up the related issue that the online documentation is only going to show the `_init_` method doc (and apparently not the tests?).  \n> \n>   If you are up for it, I'd recommend making a more \"narrative\" structure which includes examples of calculus, plotting, etc., more like [real_part](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/other.py?id=00380b09135e8171593108059f17490a23f554ad#n1208) does.  If you'd prefer me to do that, I can - might just take a little longer as I recall how to add to a public branch :-)\n\n\nDone. \n \n> * input:\n> > > {{{\n> > > sage: H = real_nth_root(x,2)\n> > > sage: (H.subs(x=-1))^2\n> > > \n> > > ---\n> > > ...\n> > > ValueError: no real nth root of negative real number with even n\n> > > sage: ((H)^2).subs(x=-1)\n> > > 1\n> > > }}}\n> > >   I'm not sure the latter should be allowed or not.\n\n> > \n> > No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.\n  \n>   Wait, so are you saying that we should disallow that function with `x=-1` to be evaluated?  \n\nYes. What should `real_nth_root(-1, 2)` evaluate to?\n\n> Sage simplifies `1/x*x =1` which isn't technically correct. \n\n\nWhy is it not correct? It is correct but you should not evaluate 1/x at x=0.",
    "created_at": "2020-06-22T02:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167427",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:46'></a>Replying to [comment:40 kcrisman]:
> However, that brings up the related issue that the online documentation is only going to show the `_init_` method doc (and apparently not the tests?).  
> 
>   If you are up for it, I'd recommend making a more "narrative" structure which includes examples of calculus, plotting, etc., more like [real_part](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/other.py?id=00380b09135e8171593108059f17490a23f554ad#n1208) does.  If you'd prefer me to do that, I can - might just take a little longer as I recall how to add to a public branch :-)


Done. 
 
> * input:
> > > {{{
> > > sage: H = real_nth_root(x,2)
> > > sage: (H.subs(x=-1))^2
> > > 
> > > ---
> > > ...
> > > ValueError: no real nth root of negative real number with even n
> > > sage: ((H)^2).subs(x=-1)
> > > 1
> > > }}}
> > >   I'm not sure the latter should be allowed or not.

> > 
> > No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.
  
>   Wait, so are you saying that we should disallow that function with `x=-1` to be evaluated?  

Yes. What should `real_nth_root(-1, 2)` evaluate to?

> Sage simplifies `1/x*x =1` which isn't technically correct. 


Why is it not correct? It is correct but you should not evaluate 1/x at x=0.



---

archive/issue_comments_167428.json:
```json
{
    "body": "<a id='comment:47'></a>> Done. \n  \nThanks, I'll check that out momentarily to confirm it builds properly.  Looks good so far.\n>  \n  \n> > * input:\n> > > > {{{\n> > > > sage: H = real_nth_root(x,2)\n> > > > sage: (H.subs(x=-1))^2\n> > > > \n> > > > ---\n> > > > ...\n> > > > ValueError: no real nth root of negative real number with even n\n> > > > sage: ((H)^2).subs(x=-1)\n> > > > 1\n> > > > }}}\n> > > >   I'm not sure the latter should be allowed or not.\n\n> > > \n> > > No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.\n  \n> >   Wait, so are you saying that we should disallow that function with `x=-1` to be evaluated?  \n> \n> Yes. What should `real_nth_root(-1, 2)` evaluate to?\n  \nI meant `((real_nth_root(x, 2))^2).subs(x=-1)`.  Are you saying this should be allowed or not allowed?\n> \n> > Sage simplifies `1/x*x =1` which isn't technically correct. \n\n> \n> Why is it not correct? It is correct but you should not evaluate 1/x at x=0.\n\nDepends on whether such expressions are meant to include domains - but anyway that is not directly relevant.",
    "created_at": "2020-06-22T12:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167428",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:47'></a>> Done. 
  
Thanks, I'll check that out momentarily to confirm it builds properly.  Looks good so far.
>  
  
> > * input:
> > > > {{{
> > > > sage: H = real_nth_root(x,2)
> > > > sage: (H.subs(x=-1))^2
> > > > 
> > > > ---
> > > > ...
> > > > ValueError: no real nth root of negative real number with even n
> > > > sage: ((H)^2).subs(x=-1)
> > > > 1
> > > > }}}
> > > >   I'm not sure the latter should be allowed or not.

> > > 
> > > No. `real_nth_root` takes real input and outputs real. For the symbolic function `1/x`, we assume `x` takes nonzero value. Likewise, we assume real value x for `real_nth_root(x, 3)`.
  
> >   Wait, so are you saying that we should disallow that function with `x=-1` to be evaluated?  
> 
> Yes. What should `real_nth_root(-1, 2)` evaluate to?
  
I meant `((real_nth_root(x, 2))^2).subs(x=-1)`.  Are you saying this should be allowed or not allowed?
> 
> > Sage simplifies `1/x*x =1` which isn't technically correct. 

> 
> Why is it not correct? It is correct but you should not evaluate 1/x at x=0.

Depends on whether such expressions are meant to include domains - but anyway that is not directly relevant.



---

archive/issue_comments_167429.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Karl-Dieter Crisman, Nils Bruin, Kwanyku Lee\"",
    "created_at": "2020-06-22T18:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167429",
    "user": "https://github.com/kcrisman"
}
```

Changing reviewer from "" to "Karl-Dieter Crisman, Nils Bruin, Kwanyku Lee"



---

archive/issue_comments_167430.json:
```json
{
    "body": "<a id='comment:48'></a>Thank you for all the good work - this is really *long* since overdue.  \n\n> > Yes. What should `real_nth_root(-1, 2)` evaluate to?\n  \n> I meant `((real_nth_root(x, 2))^2).subs(x=-1)`.  Are you saying this should be allowed or not allowed?\n\nAgain, see comment:21.  It is good that `real_nth_root(-1, 2)` does not evaluate, but the question is whether the *symbolic* simplification should do this when `((real_nth_root(x, 2))^2)` doesn't really make sense for `x=-1`.  Here is another example.\n\n```\nsage: ((real_nth_root(x, 2))^2)\nreal_nth_root(x^2, 2)\nsage: f(x) = _\nsage: f\nx |--> real_nth_root(x^2, 2)\nsage: f(-1)\n1\n```\nI think if in `_power_` we had something like\n\n```\nif exp % 2 == 1:\n    return self(base**power_param, exp)\nelse:\n ....\n```\nthat might solve it (suitable tests included).  What do you think?   Unfortunately the most naive things I tried for the `else` clause led to nasty errors; I wasted about 20 minutes on abort errors, so I have a feeling that what I did leads to Pynac problems.  (Anyone else interested in this particular question other than me or Kwankyu?)\n\nProbably we don't need to `assert` that `n` is a positive integer since the documentation clearly says so and since why would anyone use it any other way?  (Famous last words.)",
    "created_at": "2020-06-22T18:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167430",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:48'></a>Thank you for all the good work - this is really *long* since overdue.  

> > Yes. What should `real_nth_root(-1, 2)` evaluate to?
  
> I meant `((real_nth_root(x, 2))^2).subs(x=-1)`.  Are you saying this should be allowed or not allowed?

Again, see comment:21.  It is good that `real_nth_root(-1, 2)` does not evaluate, but the question is whether the *symbolic* simplification should do this when `((real_nth_root(x, 2))^2)` doesn't really make sense for `x=-1`.  Here is another example.

```
sage: ((real_nth_root(x, 2))^2)
real_nth_root(x^2, 2)
sage: f(x) = _
sage: f
x |--> real_nth_root(x^2, 2)
sage: f(-1)
1
```
I think if in `_power_` we had something like

```
if exp % 2 == 1:
    return self(base**power_param, exp)
else:
 ....
```
that might solve it (suitable tests included).  What do you think?   Unfortunately the most naive things I tried for the `else` clause led to nasty errors; I wasted about 20 minutes on abort errors, so I have a feeling that what I did leads to Pynac problems.  (Anyone else interested in this particular question other than me or Kwankyu?)

Probably we don't need to `assert` that `n` is a positive integer since the documentation clearly says so and since why would anyone use it any other way?  (Famous last words.)



---

archive/issue_comments_167431.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:48 kcrisman]:\n> Thank you for all the good work - this is really *long* since overdue.  \n> \n> > > Yes. What should `real_nth_root(-1, 2)` evaluate to?\n  \n> > I meant `((real_nth_root(x, 2))^2).subs(x=-1)`.  Are you saying this should be allowed or not allowed?\n> \n\n\nAllowed. This is exactly the same problem with\n\n```\nsage: (1/x)*x\n1\nsage: _.subs(x=0)\n1\n```\n\nwhich we don't bother to fix in any way. If you argue the cases are different because the difference of the domains of definition is of measure zero, then how about this:\n\n```\nsage: f = 1/floor(abs(x))*floor(abs(x))\nsage: f.subs(x=1/2)\n1\n```\n\nPerhaps it is important that these things do not cause real problems because the domain of definition never gets smaller from the initial domain of definition that one starts with.",
    "created_at": "2020-06-23T00:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167431",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:49'></a>Replying to [comment:48 kcrisman]:
> Thank you for all the good work - this is really *long* since overdue.  
> 
> > > Yes. What should `real_nth_root(-1, 2)` evaluate to?
  
> > I meant `((real_nth_root(x, 2))^2).subs(x=-1)`.  Are you saying this should be allowed or not allowed?
> 


Allowed. This is exactly the same problem with

```
sage: (1/x)*x
1
sage: _.subs(x=0)
1
```

which we don't bother to fix in any way. If you argue the cases are different because the difference of the domains of definition is of measure zero, then how about this:

```
sage: f = 1/floor(abs(x))*floor(abs(x))
sage: f.subs(x=1/2)
1
```

Perhaps it is important that these things do not cause real problems because the domain of definition never gets smaller from the initial domain of definition that one starts with.



---

archive/issue_comments_167432.json:
```json
{
    "body": "<a id='comment:50'></a>> Allowed. This is exactly the same problem with\n\n\nOkay, I'll roll with that.  Haven't heard from any of the other people regarding that here, I don't have a big commitment here since this isn't really switchable to \"regular\" root functions.  Thank you!",
    "created_at": "2020-06-23T01:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167432",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:50'></a>> Allowed. This is exactly the same problem with


Okay, I'll roll with that.  Haven't heard from any of the other people regarding that here, I don't have a big commitment here since this isn't really switchable to "regular" root functions.  Thank you!



---

archive/issue_comments_167433.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-06-23T01:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167433",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_167434.json:
```json
{
    "body": "<a id='comment:51'></a>Thank you!",
    "created_at": "2020-06-23T06:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167434",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:51'></a>Thank you!



---

archive/issue_comments_167435.json:
```json
{
    "body": "<a id='comment:52'></a>Thank you very much for making this happen!",
    "created_at": "2020-06-29T22:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167435",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:52'></a>Thank you very much for making this happen!



---

archive/issue_comments_167436.json:
```json
{
    "body": "Changing branch from \"public/12074\" to \"f8cb7a0429c2e696dc69db8466ecc077b0bf0f32\"",
    "created_at": "2020-07-08T19:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167436",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/12074" to "f8cb7a0429c2e696dc69db8466ecc077b0bf0f32"



---

archive/issue_events_032088.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-08T19:32:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12074#event-32088"
}
```



---

archive/issue_comments_167437.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T19:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167437",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_167438.json:
```json
{
    "body": "Changing reviewer from \"Karl-Dieter Crisman, Nils Bruin, Kwanyku Lee\" to \"Karl-Dieter Crisman, Nils Bruin, Kwankyu Lee\"",
    "created_at": "2020-10-24T20:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167438",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "Karl-Dieter Crisman, Nils Bruin, Kwanyku Lee" to "Karl-Dieter Crisman, Nils Bruin, Kwankyu Lee"



---

archive/issue_comments_167439.json:
```json
{
    "body": "Changing commit from \"f8cb7a0429c2e696dc69db8466ecc077b0bf0f32\" to \"\"",
    "created_at": "2020-10-24T20:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12074#issuecomment-167439",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "f8cb7a0429c2e696dc69db8466ecc077b0bf0f32" to ""
