# Issue 12161: Make Sage App on Mac work right all the time on OS X 10.7 Lion, and OS X 10.6 Snow Leopard also

archive/issues_011989.json:
```json
{
    "body": "[This ask.sagemath.org question](http://ask.sagemath.org/question/740/app-installation-problem-on-mac-os-x-lion) has no fewer than eight users who have had trouble using the Mac app bundle from Snow Leopard on Lion.\n\nMost of the errors seem to look like\n\n```\n$ '/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage/'/sage --notebook\nTraceback (most recent call last):\n  File \"/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage//local/bin/sage-notebook\", line 3, in <module>\n    import os, sys, socket\n  File \"/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage/local/lib/python/socket.py\", line 46, in <module>\n    import _socket\nImportError: No module named _socket\n```\nwhen the app is started.  Then we told people to try\n\n```\n/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage/sage\n```\nor the equivalent, and that pretty much uniformly led to an IPython import error.\n\nHowever, nearly everyone was able to solve the problem by one of \n* Installing the new Xcode\n* Installing IPython\n* Upgrading the system Python\n\nNote that **none** of these things should have anything to do with Sage running from the app!\n\nAnyway, it seems to all be the same or very similar problems, so I'm making this a ticket.    I wouldn't be surprised if it was a deployment target thing, even.\n\nPossible solutions that would close this:\n* Getting the app bundle to build right on Lion with Xcode 4 and distributing that\n* Getting the Xcode 3/Snow Leopard one to work right on Lion\n\nHome base is #11881; we probably shouldn't release a Sage 5.0 that doesn't have a working app bundle on Lion.\n\nApply trac_12161-re-source-sage-env.patch  to the EXTCODE repository.\n\n**CC:**  @gvol @williamstein\n\n**Author:** Ivan Andrus\n\n**Reviewer:** Georg S. Weber\n\n**Merged:** sage-5.0.beta6\n\nIssue created by migration from https://trac.sagemath.org/ticket/12161\n\n",
    "closed_at": "2012-02-27T11:21:25Z",
    "created_at": "2011-12-16T02:17:32Z",
    "labels": [
        "component: distribution",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "title": "Make Sage App on Mac work right all the time on OS X 10.7 Lion, and OS X 10.6 Snow Leopard also",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12161",
    "user": "https://github.com/kcrisman"
}
```
[This ask.sagemath.org question](http://ask.sagemath.org/question/740/app-installation-problem-on-mac-os-x-lion) has no fewer than eight users who have had trouble using the Mac app bundle from Snow Leopard on Lion.

Most of the errors seem to look like

```
$ '/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage/'/sage --notebook
Traceback (most recent call last):
  File "/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage//local/bin/sage-notebook", line 3, in <module>
    import os, sys, socket
  File "/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage/local/lib/python/socket.py", line 46, in <module>
    import _socket
ImportError: No module named _socket
```
when the app is started.  Then we told people to try

```
/Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/sage/sage
```
or the equivalent, and that pretty much uniformly led to an IPython import error.

However, nearly everyone was able to solve the problem by one of 
* Installing the new Xcode
* Installing IPython
* Upgrading the system Python

Note that **none** of these things should have anything to do with Sage running from the app!

Anyway, it seems to all be the same or very similar problems, so I'm making this a ticket.    I wouldn't be surprised if it was a deployment target thing, even.

Possible solutions that would close this:
* Getting the app bundle to build right on Lion with Xcode 4 and distributing that
* Getting the Xcode 3/Snow Leopard one to work right on Lion

Home base is #11881; we probably shouldn't release a Sage 5.0 that doesn't have a working app bundle on Lion.

Apply trac_12161-re-source-sage-env.patch  to the EXTCODE repository.

**CC:**  @gvol @williamstein

**Author:** Ivan Andrus

**Reviewer:** Georg S. Weber

**Merged:** sage-5.0.beta6

Issue created by migration from https://trac.sagemath.org/ticket/12161





---

archive/issue_comments_132562.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -25,4 +25,11 @@\n \n Note that **none** of these things should have anything to do with Sage running from the app!\n \n-Anyway, it seems to all be the same or very similar problems, so I'm making this a ticket.\n+Anyway, it seems to all be the same or very similar problems, so I'm making this a ticket.    I wouldn't be surprised if it was a deployment target thing, even.\n+\n+Possible solutions that would close this:\n+* Getting the app bundle to build right on Lion with Xcode 4 and distributing that\n+* Getting the Xcode 3/Snow Leopard one to work right on Lion\n+\n+Home base is #11881; we probably shouldn't release a Sage 5.0 that doesn't have a working app bundle on Lion.\n+\n``````\n",
    "created_at": "2011-12-16T02:20:15Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132562",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -25,4 +25,11 @@
 
 Note that **none** of these things should have anything to do with Sage running from the app!
 
-Anyway, it seems to all be the same or very similar problems, so I'm making this a ticket.
+Anyway, it seems to all be the same or very similar problems, so I'm making this a ticket.    I wouldn't be surprised if it was a deployment target thing, even.
+
+Possible solutions that would close this:
+* Getting the app bundle to build right on Lion with Xcode 4 and distributing that
+* Getting the Xcode 3/Snow Leopard one to work right on Lion
+
+Home base is #11881; we probably shouldn't release a Sage 5.0 that doesn't have a working app bundle on Lion.
+
``````




---

archive/issue_comments_132563.json:
```json
{
    "body": "<a id='comment:2'></a>\ndiff --git a/sage/ext/mac-app/start-sage.sh b/sage/ext/mac-app/start-sage.sh\n--- a/sage/ext/mac-app/start-sage.sh\n+++ b/sage/ext/mac-app/start-sage.sh\n@@ -53,6 +53,7 @@\n     ./sage --notebook >> \"$SAGE_LOG\" 2>> \"$SAGE_LOG\"\n else\n     echo Starting Notebook in Terminal >> \"$SAGE_LOG\"\n+    export SAGE_ENV_SOURCED=\"\"\n     sage-native-execute osascript \\\n         -e 'tell app \"Terminal\"' \\\n         -e '    activate' \\",
    "created_at": "2012-01-21T20:47:55Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132563",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:2'></a>
diff --git a/sage/ext/mac-app/start-sage.sh b/sage/ext/mac-app/start-sage.sh
--- a/sage/ext/mac-app/start-sage.sh
+++ b/sage/ext/mac-app/start-sage.sh
@@ -53,6 +53,7 @@
     ./sage --notebook >> "$SAGE_LOG" 2>> "$SAGE_LOG"
 else
     echo Starting Notebook in Terminal >> "$SAGE_LOG"
+    export SAGE_ENV_SOURCED=""
     sage-native-execute osascript \
         -e 'tell app "Terminal"' \
         -e '    activate' \



---

archive/issue_comments_132564.json:
```json
{
    "body": "<a id='comment:3'></a>\nSorry,\n\nI do know how to properly attach patches to trac, of course. But I don't know either how soon I get around to find enough time to do so. And the one-liner in the comment above (add to the extcode hg repo, or in a \"live install\" to the file \"start-sage-sh\" under /Applications/Sage-xyz/Contents/Resources/sage) was simply too tempting to be kept entirely unposted.\n\nThe story: In this \"start-sage.sh\" when called in a fresh install, the directory \"$DOT_SAGE/sage_notebook.sagenb\" is checked for existence and will not exist. Then (and only then) some different means to start up the Notebook server is chosen, by some call to Terminal. Under OS X Lion, it seems this way leads to some strange re-sorting of the entries in PATH variable (which had been properly set before in \"start-sage.sh\"). As a result, /usr/bin/python is called instead of Sage's python --- hence the failures to find \"_socket\" and \"IPython\"!\n\nThe one line added cares for when sage-env is sourced a second time (which is the case), the environment variables are set again (which wouldn't be done if SAGE_ENV is kept set to \"1\"), including PATH now being what we want.\n\nOnce the Notebook server has started once up (where the user has to set in the terminal the admin password and such), the one directory checked for exists, and the a different codepath is taken (which works without changes).",
    "created_at": "2012-01-21T20:58:08Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132564",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:3'></a>
Sorry,

I do know how to properly attach patches to trac, of course. But I don't know either how soon I get around to find enough time to do so. And the one-liner in the comment above (add to the extcode hg repo, or in a "live install" to the file "start-sage-sh" under /Applications/Sage-xyz/Contents/Resources/sage) was simply too tempting to be kept entirely unposted.

The story: In this "start-sage.sh" when called in a fresh install, the directory "$DOT_SAGE/sage_notebook.sagenb" is checked for existence and will not exist. Then (and only then) some different means to start up the Notebook server is chosen, by some call to Terminal. Under OS X Lion, it seems this way leads to some strange re-sorting of the entries in PATH variable (which had been properly set before in "start-sage.sh"). As a result, /usr/bin/python is called instead of Sage's python --- hence the failures to find "_socket" and "IPython"!

The one line added cares for when sage-env is sourced a second time (which is the case), the environment variables are set again (which wouldn't be done if SAGE_ENV is kept set to "1"), including PATH now being what we want.

Once the Notebook server has started once up (where the user has to set in the terminal the admin password and such), the one directory checked for exists, and the a different codepath is taken (which works without changes).



---

archive/issue_comments_132565.json:
```json
{
    "body": "<a id='comment:4'></a>\nCorrections:\n\nIn a live install \"start-sage.sh\" lives under /Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/ (or the like, but not lower).\n\nThe environment variable alluded to is not named SAGE_ENV, but SAGE_ENV_SOURCED (as in the diff).",
    "created_at": "2012-01-21T21:07:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132565",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:4'></a>
Corrections:

In a live install "start-sage.sh" lives under /Applications/Sage-4.7.1-OSX-64bit-10.6.app/Contents/Resources/ (or the like, but not lower).

The environment variable alluded to is not named SAGE_ENV, but SAGE_ENV_SOURCED (as in the diff).



---

archive/issue_comments_132566.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [GeorgSWeber](#comment%3A3):\n> Sorry,\n> \n> I do know how to properly attach patches to trac, of course. But I don't know either how soon I get around to find enough time to do so. And the one-liner in the comment above (add to the extcode hg repo, or in a \"live install\" to the file \"start-sage-sh\" under /Applications/Sage-xyz/Contents/Resources/sage) was simply too tempting to be kept entirely unposted.\n\n\nI'm happy to make a patch (it will be up in a few minutes).  In fact if this fixes it, I'll reach out through the internet and give you a big kiss (or cup of coffee whichever you prefer :-)\n\n> The story: In this \"start-sage.sh\" when called in a fresh install, the directory \"$DOT_SAGE/sage_notebook.sagenb\" is checked for existence and will not exist. Then (and only then) some different means to start up the Notebook server is chosen, by some call to Terminal. Under OS X Lion, it seems this way leads to some strange re-sorting of the entries in PATH variable (which had been properly set before in \"start-sage.sh\"). As a result, /usr/bin/python is called instead of Sage's python --- hence the failures to find \"_socket\" and \"IPython\"!\n\n\n> The one line added cares for when sage-env is sourced a second time (which is the case), the environment variables are set again (which wouldn't be done if SAGE_ENV is kept set to \"1\"), including PATH now being what we want.\n\n\nI would have thought is was impossible to pass environment variables via the applescript.  I just checked it however and it depends on if Terminal.app was already started.  If it was then the variables aren't \"passed\".  If the call to osascript opens Terminal.app though, it does inherit the variables from the environment.  This is just weird, but does make sense in a way.  \n\n> Once the Notebook server has started once up (where the user has to set in the terminal the admin password and such), the one directory checked for exists, and the a different codepath is taken (which works without changes).\n\n\nThis explains why I (and others) could never reproduce this.  It was because we all had sage notebooks already.  And when I did test with no notebook, my PATH was such that it didn't cause problems.\n\nI just hope this is the only problem.",
    "created_at": "2012-01-21T21:22:32Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132566",
    "user": "https://github.com/gvol"
}
```

<a id='comment:5'></a>
Replying to [GeorgSWeber](#comment%3A3):
> Sorry,
> 
> I do know how to properly attach patches to trac, of course. But I don't know either how soon I get around to find enough time to do so. And the one-liner in the comment above (add to the extcode hg repo, or in a "live install" to the file "start-sage-sh" under /Applications/Sage-xyz/Contents/Resources/sage) was simply too tempting to be kept entirely unposted.


I'm happy to make a patch (it will be up in a few minutes).  In fact if this fixes it, I'll reach out through the internet and give you a big kiss (or cup of coffee whichever you prefer :-)

> The story: In this "start-sage.sh" when called in a fresh install, the directory "$DOT_SAGE/sage_notebook.sagenb" is checked for existence and will not exist. Then (and only then) some different means to start up the Notebook server is chosen, by some call to Terminal. Under OS X Lion, it seems this way leads to some strange re-sorting of the entries in PATH variable (which had been properly set before in "start-sage.sh"). As a result, /usr/bin/python is called instead of Sage's python --- hence the failures to find "_socket" and "IPython"!


> The one line added cares for when sage-env is sourced a second time (which is the case), the environment variables are set again (which wouldn't be done if SAGE_ENV is kept set to "1"), including PATH now being what we want.


I would have thought is was impossible to pass environment variables via the applescript.  I just checked it however and it depends on if Terminal.app was already started.  If it was then the variables aren't "passed".  If the call to osascript opens Terminal.app though, it does inherit the variables from the environment.  This is just weird, but does make sense in a way.  

> Once the Notebook server has started once up (where the user has to set in the terminal the admin password and such), the one directory checked for exists, and the a different codepath is taken (which works without changes).


This explains why I (and others) could never reproduce this.  It was because we all had sage notebooks already.  And when I did test with no notebook, my PATH was such that it didn't cause problems.

I just hope this is the only problem.



---

archive/issue_comments_132567.json:
```json
{
    "body": "<a id='comment:6'></a>\nI ran some tests and this does solve what we suppose the problem to be.  We won't really know until someone who reported the bug tries it though.  \n\nPerhaps unsetting of `SAGE_ENV_SOURCED` should be done in `sage-native-execute`.  I don't think `sage-native-execute` was ever intended to run a sage command. :-)",
    "created_at": "2012-01-21T21:58:43Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132567",
    "user": "https://github.com/gvol"
}
```

<a id='comment:6'></a>
I ran some tests and this does solve what we suppose the problem to be.  We won't really know until someone who reported the bug tries it though.  

Perhaps unsetting of `SAGE_ENV_SOURCED` should be done in `sage-native-execute`.  I don't think `sage-native-execute` was ever intended to run a sage command. :-)



---

archive/issue_events_098833.json:
```json
{
    "actor": "https://github.com/gvol",
    "created_at": "2012-01-21T21:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98833"
}
```



---

archive/issue_comments_132568.json:
```json
{
    "body": "**Author:** Georg S. Weber",
    "created_at": "2012-01-21T21:58:43Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132568",
    "user": "https://github.com/gvol"
}
```

**Author:** Georg S. Weber



---

archive/issue_comments_132569.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [iandrus](#comment%3A6):\n> Perhaps unsetting of `SAGE_ENV_SOURCED` should be done in `sage-native-execute`.  I don't think `sage-native-execute` was ever intended to run a sage command. :-)\n\nSee also #9386 for other problems with `sage-native-execute`",
    "created_at": "2012-01-21T23:01:50Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132569",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:7'></a>
Replying to [iandrus](#comment%3A6):
> Perhaps unsetting of `SAGE_ENV_SOURCED` should be done in `sage-native-execute`.  I don't think `sage-native-execute` was ever intended to run a sage command. :-)

See also #9386 for other problems with `sage-native-execute`



---

archive/issue_comments_132570.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe commit message \"unset SAGE_ENV_SOURCED in the case of a new user\" doesn't make sense to me.",
    "created_at": "2012-01-23T18:08:30Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132570",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
The commit message "unset SAGE_ENV_SOURCED in the case of a new user" doesn't make sense to me.



---

archive/attachments_016216.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12161-re-source-sage-env.patch",
    "asset_url": "tarball://root/attachments/ticket12161/trac_12161-re-source-sage-env.patch",
    "created_at": "2012-01-23T19:45:03Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12161/trac_12161-re-source-sage-env.patch",
    "user": "https://github.com/gvol"
}
```



---

archive/issue_comments_132571.json:
```json
{
    "body": "Attachment [trac_12161-re-source-sage-env.patch](https://github.com/sagemath/sage/files/ticket12161/trac_12161-re-source-sage-env.patch) by @gvol created at 2012-01-23 19:45:03",
    "created_at": "2012-01-23T19:45:03Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132571",
    "user": "https://github.com/gvol"
}
```

Attachment [trac_12161-re-source-sage-env.patch](https://github.com/sagemath/sage/files/ticket12161/trac_12161-re-source-sage-env.patch) by @gvol created at 2012-01-23 19:45:03



---

archive/issue_comments_132572.json:
```json
{
    "body": "<a id='comment:9'></a>\nHow should this be reviewed?  It sounds like Georg is the author here (any reason that we don't \"export\" in the actual patch?  I assume that in the .sh file that doesn't matter or something?) and Ivan confirms that this solves the problem, and Georg confirms that Ivan's confirmation is right.  Modulo someone with the problem actually trying it. \n\nThere is also the weird thing about one of the posters on the ask.sagemath question actually having IPython installed in his 'usual' install, yet getting that error.\n\nAnyway, do the author and reviewer think this is enough for positive review?  It would be really, really good to be able to merge this quickly and then post some beta binaries for newbies to test - maybe even mentioning this at the ask.sagemath question which started it all.  Not having this work consistently in 5.0 would be bad news.",
    "created_at": "2012-01-27T03:24:49Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132572",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
How should this be reviewed?  It sounds like Georg is the author here (any reason that we don't "export" in the actual patch?  I assume that in the .sh file that doesn't matter or something?) and Ivan confirms that this solves the problem, and Georg confirms that Ivan's confirmation is right.  Modulo someone with the problem actually trying it. 

There is also the weird thing about one of the posters on the ask.sagemath question actually having IPython installed in his 'usual' install, yet getting that error.

Anyway, do the author and reviewer think this is enough for positive review?  It would be really, really good to be able to merge this quickly and then post some beta binaries for newbies to test - maybe even mentioning this at the ask.sagemath question which started it all.  Not having this work consistently in 5.0 would be bad news.



---

archive/issue_comments_132573.json:
```json
{
    "body": "**Reviewer:** Ivan Andrus",
    "created_at": "2012-01-27T03:24:49Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132573",
    "user": "https://github.com/kcrisman"
}
```

**Reviewer:** Ivan Andrus



---

archive/issue_comments_132574.json:
```json
{
    "body": "<a id='comment:10'></a>\nHi,\n\nfrom a mere \"formal/technical\" point of view, I would be happy naming Ivan the \"author\" and myself then \"reviewing\" it ;-)\n\nAs for the commit message,\n\n\"trac #12161: work around some PATH issue, when using the Terminal on OS X 10.7 Lion, on first start of Sage for a new user\"\n\nmight be an alternative choice. As for the testing/reviewing, this needs someone with an OS X 10.7 Lion install, of course. I thought about creating some \"sage-4.8+trac12161-OSX-64bit-10.6-x86_64-Darwin-app.dmg\" (note the attribution to this trac ticket) and upload it e.g. to \"http://sage.math.washington.edu/home/weberg/bdist/\", eventually even giving eager OS X 10.7 users a pointer to that \"unofficial\" location.\nBut in the end, the \"correct\" solution for reviewing would be to set up some OS X 10.7 machine amongst the buildbots --- we want that anyway, since William seems to be inclined to support the LLVM-backend-based gcc, that Apple uses in newer XCode (additionally to the FSF-backend based gcc).\n\n\n`@`Jeroen:\n\nHow is the status of adding an OS X 10.7 build bot/system to the Sage deployment machine park? Has this task been started (or even thought of) yet?\n\n\nCheers,\nGeorg",
    "created_at": "2012-01-27T07:34:32Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132574",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:10'></a>
Hi,

from a mere "formal/technical" point of view, I would be happy naming Ivan the "author" and myself then "reviewing" it ;-)

As for the commit message,

"trac #12161: work around some PATH issue, when using the Terminal on OS X 10.7 Lion, on first start of Sage for a new user"

might be an alternative choice. As for the testing/reviewing, this needs someone with an OS X 10.7 Lion install, of course. I thought about creating some "sage-4.8+trac12161-OSX-64bit-10.6-x86_64-Darwin-app.dmg" (note the attribution to this trac ticket) and upload it e.g. to "http://sage.math.washington.edu/home/weberg/bdist/", eventually even giving eager OS X 10.7 users a pointer to that "unofficial" location.
But in the end, the "correct" solution for reviewing would be to set up some OS X 10.7 machine amongst the buildbots --- we want that anyway, since William seems to be inclined to support the LLVM-backend-based gcc, that Apple uses in newer XCode (additionally to the FSF-backend based gcc).


`@`Jeroen:

How is the status of adding an OS X 10.7 build bot/system to the Sage deployment machine park? Has this task been started (or even thought of) yet?


Cheers,
Georg



---

archive/issue_comments_132575.json:
```json
{
    "body": "<a id='comment:11'></a>\n> `@`Jeroen:\n> How is the status of adding an OS X 10.7 build bot/system to the Sage deployment \n> machine park? Has this task been started (or even thought of) yet?\n\n\nI visited my 10.7 online machine, and it is fubar'd; I think the hardware is faulty.   I have a 10.6.8 imac machine in the Sage lab, and Andrew Ohana is planning to put 10.7 on it.  If that works, it can be the machine.",
    "created_at": "2012-01-27T09:54:17Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132575",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'></a>
> `@`Jeroen:
> How is the status of adding an OS X 10.7 build bot/system to the Sage deployment 
> machine park? Has this task been started (or even thought of) yet?


I visited my 10.7 online machine, and it is fubar'd; I think the hardware is faulty.   I have a 10.6.8 imac machine in the Sage lab, and Andrew Ohana is planning to put 10.7 on it.  If that works, it can be the machine.



---

archive/issue_comments_132576.json:
```json
{
    "body": "<a id='comment:12'></a>\nOh, Andrew is planning to do this tomorrow...",
    "created_at": "2012-01-27T09:54:31Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132576",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
Oh, Andrew is planning to do this tomorrow...



---

archive/issue_comments_132577.json:
```json
{
    "body": "**Changing reviewer** from \"Ivan Andrus\" to \"Georg S. Weber\".",
    "created_at": "2012-01-27T12:11:07Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132577",
    "user": "https://github.com/gvol"
}
```

**Changing reviewer** from "Ivan Andrus" to "Georg S. Weber".



---

archive/issue_comments_132578.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [kcrisman](#comment%3A9):\n> How should this be reviewed?  It sounds like Georg is the author here (any reason that we don't \"export\" in the actual patch?  I assume that in the .sh file that doesn't matter or something?) \n\n\nIt's already exported in sage-env.  If it wasn't then it wouldn't be a problem.\n\n> There is also the weird thing about one of the posters on the ask.sagemath question actually having IPython installed in his 'usual' install, yet getting that error.\n\n\nIt might be related to mismatching PATH and PYTHON_PATH\n\n> Anyway, do the author and reviewer think this is enough for positive review?  It would be really, really good to be able to merge this quickly and then post some beta binaries for newbies to test - maybe even mentioning this at the ask.sagemath question which started it all.  Not having this work consistently in 5.0 would be bad news.\n\n\nIndeed.\n\n\nReplying to [GeorgSWeber](#comment%3A10):\n> Hi,\n> \n> from a mere \"formal/technical\" point of view, I would be happy naming Ivan the \"author\" and myself then \"reviewing\" it ;-)\n\n\nFine by me.\n\n> As for the commit message,\n> \n> \"trac #12161: work around some PATH issue, when using the Terminal on OS X 10.7 Lion, on first start of Sage for a new user\"\n> \n> might be an alternative choice. \n\n\nTo be fair, at the time the patch had a rather nonsensical commit message which I have since changed.  I'm happy to change it again if desired.",
    "created_at": "2012-01-27T12:11:07Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132578",
    "user": "https://github.com/gvol"
}
```

<a id='comment:13'></a>
Replying to [kcrisman](#comment%3A9):
> How should this be reviewed?  It sounds like Georg is the author here (any reason that we don't "export" in the actual patch?  I assume that in the .sh file that doesn't matter or something?) 


It's already exported in sage-env.  If it wasn't then it wouldn't be a problem.

> There is also the weird thing about one of the posters on the ask.sagemath question actually having IPython installed in his 'usual' install, yet getting that error.


It might be related to mismatching PATH and PYTHON_PATH

> Anyway, do the author and reviewer think this is enough for positive review?  It would be really, really good to be able to merge this quickly and then post some beta binaries for newbies to test - maybe even mentioning this at the ask.sagemath question which started it all.  Not having this work consistently in 5.0 would be bad news.


Indeed.


Replying to [GeorgSWeber](#comment%3A10):
> Hi,
> 
> from a mere "formal/technical" point of view, I would be happy naming Ivan the "author" and myself then "reviewing" it ;-)


Fine by me.

> As for the commit message,
> 
> "trac #12161: work around some PATH issue, when using the Terminal on OS X 10.7 Lion, on first start of Sage for a new user"
> 
> might be an alternative choice. 


To be fair, at the time the patch had a rather nonsensical commit message which I have since changed.  I'm happy to change it again if desired.



---

archive/issue_comments_132579.json:
```json
{
    "body": "**Changing author** from \"Georg S. Weber\" to \"Ivan Andrus\".",
    "created_at": "2012-01-27T12:11:07Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132579",
    "user": "https://github.com/gvol"
}
```

**Changing author** from "Georg S. Weber" to "Ivan Andrus".



---

archive/issue_comments_132580.json:
```json
{
    "body": "<a id='comment:14'></a>\n> To be fair, at the time the patch had a rather nonsensical commit message which I have since changed.  I'm happy to change it again if desired.\n\nThe commit message is fine, I checked that, Ivan is right about the history of this comment.",
    "created_at": "2012-01-27T15:46:07Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132580",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:14'></a>
> To be fair, at the time the patch had a rather nonsensical commit message which I have since changed.  I'm happy to change it again if desired.

The commit message is fine, I checked that, Ivan is right about the history of this comment.



---

archive/issue_comments_132581.json:
```json
{
    "body": "<a id='comment:15'></a>\nJust **bumping** because this has been a hot topic on [sage-devel](http://groups.google.com/group/sage-devel/t/ba4f5db9c4359d25) the last few days - assuming that is the same problem as this one, which it might not be.",
    "created_at": "2012-02-08T03:39:01Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132581",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:15'></a>
Just **bumping** because this has been a hot topic on [sage-devel](http://groups.google.com/group/sage-devel/t/ba4f5db9c4359d25) the last few days - assuming that is the same problem as this one, which it might not be.



---

archive/issue_comments_132582.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -33,3 +33,4 @@\n \n Home base is #11881; we probably shouldn't release a Sage 5.0 that doesn't have a working app bundle on Lion.\n \n+Apply trac_12161-re-source-sage-env.patch  to the EXTCODE repository.\n``````\n",
    "created_at": "2012-02-08T09:19:47Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132582",
    "user": "https://github.com/gvol"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -33,3 +33,4 @@
 
 Home base is #11881; we probably shouldn't release a Sage 5.0 that doesn't have a working app bundle on Lion.
 
+Apply trac_12161-re-source-sage-env.patch  to the EXTCODE repository.
``````




---

archive/issue_comments_132583.json:
```json
{
    "body": "<a id='comment:17'></a>\nGood goodness, I finally found the time to test the necessary bits and pieces (building Sage-4.8 from scratch and bdist it as \"app\", then apply the patch here and bdist that as another \"app\" --- both times on a OS X 10.6 installation --- and then test these two apps on a vanilla OS X 10.7 installation, i.e. without resp. an empty \".sage\" folder, that the first app barfs (with the _socket syndrom) and that the second app does work fine).\n\nIt was reported that under certain circumstances, the first app might barf also on some OS X 10.6 installations, but I couldn't verify this up to now.\n\n\nCheers, Georg",
    "created_at": "2012-02-21T22:52:30Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132583",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:17'></a>
Good goodness, I finally found the time to test the necessary bits and pieces (building Sage-4.8 from scratch and bdist it as "app", then apply the patch here and bdist that as another "app" --- both times on a OS X 10.6 installation --- and then test these two apps on a vanilla OS X 10.7 installation, i.e. without resp. an empty ".sage" folder, that the first app barfs (with the _socket syndrom) and that the second app does work fine).

It was reported that under certain circumstances, the first app might barf also on some OS X 10.6 installations, but I couldn't verify this up to now.


Cheers, Georg



---

archive/issue_events_098834.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2012-02-21T22:52:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98834"
}
```



---

archive/issue_events_098835.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2012-02-21T22:52:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98835"
}
```



---

archive/issue_events_098836.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2012-02-21T23:08:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "rename": {
        "from": "Make Sage App on Mac work right all the time on OS X Lion",
        "to": "Make Sage App on Mac work right all the time on OS X 10.7 Lion, and OS X 10.6 Snow Leopard also"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98836"
}
```



---

archive/issue_events_098837.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber",
    "created_at": "2012-02-21T23:08:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "label": "blocker",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98837"
}
```



---

archive/issue_comments_132584.json:
```json
{
    "body": "<a id='comment:18'></a>\nUpdate:\n\nWell, I *could* verify that indeed, at least on one of my own OS X 10.6 installations (the one that is located on my QuadCore PowerBook, i.e. starting native in 64bit resp. pressing \"6\" and \"4\" on bootup on any 64bit capable OS X installation should show the problem with some high probability), when $HOME/\".sage\" is nuked, the first app just doesn't come up! The symptom has already been described elsewhere in sage-devel, it hangs as on OS X 10.7, but the error message in the terminal does not show \"_socket\", but something about \"Symbol not found: _PyUnicodeUCS4_AsUTF8String\"!\n\nI thus added OS X 10.6.\"Snow Leopard\" to the title line, and enhanced the priority of this patch to \"blocker\"!!\n\n\nCheers, Georg",
    "created_at": "2012-02-21T23:08:14Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132584",
    "user": "https://trac.sagemath.org/admin/accounts/users/GeorgSWeber"
}
```

<a id='comment:18'></a>
Update:

Well, I *could* verify that indeed, at least on one of my own OS X 10.6 installations (the one that is located on my QuadCore PowerBook, i.e. starting native in 64bit resp. pressing "6" and "4" on bootup on any 64bit capable OS X installation should show the problem with some high probability), when $HOME/".sage" is nuked, the first app just doesn't come up! The symptom has already been described elsewhere in sage-devel, it hangs as on OS X 10.7, but the error message in the terminal does not show "_socket", but something about "Symbol not found: _PyUnicodeUCS4_AsUTF8String"!

I thus added OS X 10.6."Snow Leopard" to the title line, and enhanced the priority of this patch to "blocker"!!


Cheers, Georg



---

archive/issue_comments_132585.json:
```json
{
    "body": "<a id='comment:19'></a>\nYou rock.",
    "created_at": "2012-02-22T01:39:54Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132585",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:19'></a>
You rock.



---

archive/issue_comments_132586.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [kcrisman](#comment%3A19):\n> You rock.\n\n\nI concur.  Thanks a ton Georg.",
    "created_at": "2012-02-22T08:36:36Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132586",
    "user": "https://github.com/gvol"
}
```

<a id='comment:20'></a>
Replying to [kcrisman](#comment%3A19):
> You rock.


I concur.  Thanks a ton Georg.



---

archive/issue_events_098838.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-27T11:21:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98838"
}
```



---

archive/issue_events_098839.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-27T11:21:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12161#event-98839"
}
```



---

archive/issue_comments_132587.json:
```json
{
    "body": "**Merged:** sage-5.0.beta6",
    "created_at": "2012-02-27T11:21:25Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132587",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta6



---

archive/issue_comments_132588.json:
```json
{
    "body": "<a id='comment:22'></a>\nJust to follow up: Apparently there is still the missing `IPython` issue, presumably after one has already tried to use the app bundle.  Will this fix that as well?  See [this ask.sagemath.org question](http://ask.sagemath.org/question/1211/sage-on-mac-os-x-lion), where the user has already tried all the tricks from the original question about this.",
    "created_at": "2012-03-06T14:28:05Z",
    "issue": "https://github.com/sagemath/sage/issues/12161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12161#issuecomment-132588",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:22'></a>
Just to follow up: Apparently there is still the missing `IPython` issue, presumably after one has already tried to use the app bundle.  Will this fix that as well?  See [this ask.sagemath.org question](http://ask.sagemath.org/question/1211/sage-on-mac-os-x-lion), where the user has already tried all the tricks from the original question about this.
