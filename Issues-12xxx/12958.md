# Issue 12958: Fix sageinspect to slightly better support old style classes

archive/issues_012786.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-mvngu"
    ],
    "body": "See the patch.\n\nCC:  @sagetrac-sage-combinat @simon-king-jena\n\nKeywords: **sageinspect**\n\nReviewer: **Ralf Stephan**\n\nAuthor: **Nicolas M. Thi\u00e9ry**\n\nComponent: **documentation**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12958_\n\n",
    "closed_at": "2014-02-19T18:57:15Z",
    "created_at": "2012-05-17T06:19:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/wontfix"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix sageinspect to slightly better support old style classes",
    "type": "issue",
    "updated_at": "2014-02-19T18:57:15Z",
    "url": "https://github.com/sagemath/sage/issues/12958",
    "user": "https://github.com/nthiery"
}
```
See the patch.

CC:  @sagetrac-sage-combinat @simon-king-jena

Keywords: **sageinspect**

Reviewer: **Ralf Stephan**

Author: **Nicolas M. Thi√©ry**

Component: **documentation**

_Issue created by migration from https://trac.sagemath.org/ticket/12958_





---

archive/issue_events_177558.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T06:19:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177558"
}
```



---

archive/issue_events_177559.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T06:19:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177559"
}
```



---

archive/issue_events_177560.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T06:19:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177560"
}
```



---

archive/issue_events_177561.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T06:19:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177561"
}
```



---

archive/issue_events_177562.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2012-05-17T06:19:22Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "subject": "https://github.com/nthiery",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177562"
}
```



---

archive/issue_comments_146907.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWhat attached fix?\n\nCould you verify that what you intend to attach is not a duplicate of #11791?",
    "created_at": "2012-05-17T06:26:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146907",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:1" align="right">comment:1</div>

What attached fix?

Could you verify that what you intend to attach is not a duplicate of #11791?



---

archive/issue_events_177563.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T06:42:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "title_is": "Fix sageinspect to better support old style classes",
    "title_was": "Fix sageinspect to better support classes with metaclasses.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177563"
}
```



---

archive/issue_events_177564.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T06:42:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177564"
}
```



---

archive/issue_comments_146908.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@simon-king-jena](#comment:1):\n> What attached fix?\n\nThere it is; I decided at the last minute to add some doctests.\n\n> Could you verify that what you intend to attach is not a duplicate of #11791?\n\nI actually fixed the title since it's more about old style classes. If the tests I put in the patch pass, I am happy to have this ticket closed as dup of #11791.\n\nCheers,",
    "created_at": "2012-05-17T06:43:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146908",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@simon-king-jena](#comment:1):
> What attached fix?

There it is; I decided at the last minute to add some doctests.

> Could you verify that what you intend to attach is not a duplicate of #11791?

I actually fixed the title since it's more about old style classes. If the tests I put in the patch pass, I am happy to have this ticket closed as dup of #11791.

Cheers,



---

archive/issue_comments_146909.json:
```json
{
    "body": "Attachment: **[trac_12958-sage_inspect_for_classes-nt.patch.gz](https://github.com/sagemath/sage/files/ticket12958/trac_12958-sage_inspect_for_classes-nt.patch.gz)**",
    "created_at": "2012-05-17T06:45:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146909",
    "user": "https://github.com/nthiery"
}
```

Attachment: **[trac_12958-sage_inspect_for_classes-nt.patch.gz](https://github.com/sagemath/sage/files/ticket12958/trac_12958-sage_inspect_for_classes-nt.patch.gz)**



---

archive/issue_comments_146910.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI am not sure what the two doc tests are supposed to demonstrate, as they just test against errors being raised.\n\nAnyway, with #11791 (plus dependencies plus something more, so, someone else should cross verify), I get\n\n```\nsage: from sage.misc.sageinspect import sage_getsourcelines\nsage: class Foo: pass\n....: \nsage: sage_getsourcelines(Foo)  # Is it intended to fix this?\nTraceback (most recent call last):\n...\nIOError: could not find class definition\nsage: import inspect \nsage: inspect.findsource(Sets.ParentMethods) # Why is Python's inspect module tested??\nTraceback (most recent call last):\n...\nIOError: could not find class definition\nsage: L = sage_getsourcelines(Sets.ParentMethods)  # works just fine\nsage: print ''.join(L[0])\n    class ParentMethods:\n#         # currently overriden by the default implementation in sage.structure.Parent\n#         def __call__(self, *args, **options):\n#             return self.element_class(*args, **options)\n\n        # Todo: simplify the _element_constructor definition logic\n...\n            \"\"\"\n            if category is None:\n                category = self.category()\n            from sage.combinat.free_module import CombinatorialFreeModule\n            return CombinatorialFreeModule(base_ring, self, category = category.Algebras(base_ring))\n```\n\nThe code line that is changed in your patch is not touched by #11791. So, how does it actually change things?",
    "created_at": "2012-05-17T07:07:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146910",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:4" align="right">comment:4</div>

I am not sure what the two doc tests are supposed to demonstrate, as they just test against errors being raised.

Anyway, with #11791 (plus dependencies plus something more, so, someone else should cross verify), I get

```
sage: from sage.misc.sageinspect import sage_getsourcelines
sage: class Foo: pass
....: 
sage: sage_getsourcelines(Foo)  # Is it intended to fix this?
Traceback (most recent call last):
...
IOError: could not find class definition
sage: import inspect 
sage: inspect.findsource(Sets.ParentMethods) # Why is Python's inspect module tested??
Traceback (most recent call last):
...
IOError: could not find class definition
sage: L = sage_getsourcelines(Sets.ParentMethods)  # works just fine
sage: print ''.join(L[0])
    class ParentMethods:
#         # currently overriden by the default implementation in sage.structure.Parent
#         def __call__(self, *args, **options):
#             return self.element_class(*args, **options)

        # Todo: simplify the _element_constructor definition logic
...
            """
            if category is None:
                category = self.category()
            from sage.combinat.free_module import CombinatorialFreeModule
            return CombinatorialFreeModule(base_ring, self, category = category.Algebras(base_ring))
```

The code line that is changed in your patch is not touched by #11791. So, how does it actually change things?



---

archive/issue_comments_146911.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@simon-king-jena](#comment:4):\n> I am not sure what the two doc tests are supposed to demonstrate, as they just test against errors being raised.\n\nThe error is worst without the patch :-)\n\n> Anyway, with #11791 (plus dependencies plus something more, so, someone else should cross verify), I get\n> \n> ```\n> sage: from sage.misc.sageinspect import sage_getsourcelines\n> sage: class Foo: pass\n> ....: \n> sage: sage_getsourcelines(Foo)  # Is it intended to fix this?\n> Traceback (most recent call last):\n> ...\n> IOError: could not find class definition\n> sage: import inspect \n> sage: inspect.findsource(Sets.ParentMethods) # Why is Python's inspect module tested??\n> Traceback (most recent call last):\n> ...\n> IOError: could not find class definition\n> sage: L = sage_getsourcelines(Sets.ParentMethods)  # works just fine\n> ```\n\nCool.\n\n> The code line that is changed in your patch is not touched by #11791. So, how does it actually change things?\n\nFrom the brief look I had at your path, the line is still there, but\nthe logic has changed a bit before. I don't know, and honestly I don't\nwant to spend more time on this. I guess I'll simply change #12953 to\nsimply not test introspection too deeply since it will get better\nsoon. Then it won't depend on this ticket and/or #11971.\n\nFeel free to mark this one as a dup if you want!\n\nCheers,\n                          Nicolas",
    "created_at": "2012-05-17T07:38:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146911",
    "user": "https://github.com/nthiery"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@simon-king-jena](#comment:4):
> I am not sure what the two doc tests are supposed to demonstrate, as they just test against errors being raised.

The error is worst without the patch :-)

> Anyway, with #11791 (plus dependencies plus something more, so, someone else should cross verify), I get
> 
> ```
> sage: from sage.misc.sageinspect import sage_getsourcelines
> sage: class Foo: pass
> ....: 
> sage: sage_getsourcelines(Foo)  # Is it intended to fix this?
> Traceback (most recent call last):
> ...
> IOError: could not find class definition
> sage: import inspect 
> sage: inspect.findsource(Sets.ParentMethods) # Why is Python's inspect module tested??
> Traceback (most recent call last):
> ...
> IOError: could not find class definition
> sage: L = sage_getsourcelines(Sets.ParentMethods)  # works just fine
> ```

Cool.

> The code line that is changed in your patch is not touched by #11791. So, how does it actually change things?

From the brief look I had at your path, the line is still there, but
the logic has changed a bit before. I don't know, and honestly I don't
want to spend more time on this. I guess I'll simply change #12953 to
simply not test introspection too deeply since it will get better
soon. Then it won't depend on this ticket and/or #11971.

Feel free to mark this one as a dup if you want!

Cheers,
                          Nicolas



---

archive/issue_comments_146912.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-I need the attached tiny fix for #12953.\n+See the patch.\n``````\n",
    "created_at": "2012-05-17T07:43:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146912",
    "user": "https://github.com/nthiery"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-I need the attached tiny fix for #12953.
+See the patch.
``````




---

archive/issue_events_177565.json:
```json
{
    "actor": "https://github.com/nthiery",
    "created_at": "2012-05-17T07:43:20Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "title_is": "Fix sageinspect to slightly better support old style classes",
    "title_was": "Fix sageinspect to better support old style classes",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177565"
}
```



---

archive/issue_events_177566.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177566"
}
```



---

archive/issue_events_177567.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177567"
}
```



---

archive/issue_events_177568.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177568"
}
```



---

archive/issue_events_177569.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177569"
}
```



---

archive/issue_events_177570.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-17T17:43:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177570"
}
```



---

archive/issue_events_177571.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-17T17:43:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177571"
}
```



---

archive/issue_comments_146913.json:
```json
{
    "body": "Reviewer: **Ralf Stephan**",
    "created_at": "2014-02-17T17:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146913",
    "user": "https://github.com/rwst"
}
```

Reviewer: **Ralf Stephan**



---

archive/issue_events_177572.json:
```json
{
    "actor": "https://github.com/rwst",
    "created_at": "2014-02-17T17:43:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177572"
}
```



---

archive/issue_comments_146914.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAppears to be no longer relevant.",
    "created_at": "2014-02-17T17:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12958#issuecomment-146914",
    "user": "https://github.com/rwst"
}
```

<div id="comment:9" align="right">comment:9</div>

Appears to be no longer relevant.



---

archive/issue_events_177573.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-19T18:57:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177573"
}
```



---

archive/issue_events_177574.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-19T18:57:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177574"
}
```



---

archive/issue_events_177575.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-19T18:57:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177575"
}
```



---

archive/issue_events_177576.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-02-19T18:57:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12958",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12958#event-177576"
}
```
