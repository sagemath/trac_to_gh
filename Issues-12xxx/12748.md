# Issue 12748: An inconsistent term order must not be accepted as input of a polynomial ring construction

archive/issues_012576.json:
```json
{
    "body": "[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:\n\n```\nsage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])\nsage: x1 in I\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: Segmentation fault\n```\n\nSo, two problems:\n\n* I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.\n* One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.\n\n\n\n\n**Assignee:** @malb\n\n**Keywords:** polynomial ring termorder\n\n**Reviewer:** Simon King\n\n**Author:** Martin Albrecht\n\n**Merged:** sage-5.1.beta0\n\nIssue created by migration from https://trac.sagemath.org/ticket/12748\n\n",
    "closed_at": "2012-05-06T12:16:28Z",
    "created_at": "2012-03-26T05:33:11Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.1",
    "title": "An inconsistent term order must not be accepted as input of a polynomial ring construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/12748",
    "user": "https://github.com/simon-king-jena"
}
```
[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:

```
sage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])
sage: x1 in I
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Segmentation fault
```

So, two problems:

* I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.
* One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.




**Assignee:** @malb

**Keywords:** polynomial ring termorder

**Reviewer:** Simon King

**Author:** Martin Albrecht

**Merged:** sage-5.1.beta0

Issue created by migration from https://trac.sagemath.org/ticket/12748





---

archive/issue_events_106030.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2012-04-13T18:41:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106030"
}
```



---

archive/attachments_017770.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12748_term_order.patch",
    "asset_url": "tarball://root/attachments/ticket12748/trac_12748_term_order.patch",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12748/trac_12748_term_order.patch",
    "user": "https://github.com/malb"
}
```



---

archive/issue_comments_145108.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [trac_12748_term_order.patch](https://github.com/sagemath/sage/files/ticket12748/trac_12748_term_order.patch)\n\nThe attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145108",
    "user": "https://github.com/malb"
}
```

<a id='comment:1'></a>
**Attachment:** [trac_12748_term_order.patch](https://github.com/sagemath/sage/files/ticket12748/trac_12748_term_order.patch)

The attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.



---

archive/issue_comments_145109.json:
```json
{
    "body": "**Author:** Martin Albrecht",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145109",
    "user": "https://github.com/malb"
}
```

**Author:** Martin Albrecht



---

archive/issue_comments_145110.json:
```json
{
    "body": "<a id='comment:2'></a>\nTowards a review:\n\n* The patch does apply to sage-5.0.beta13.\n* The fix looks fine to me.\n* I am now running `make test`, and at least the first couple of tests pass.\n* The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.",
    "created_at": "2012-04-15T07:46:37Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145110",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
Towards a review:

* The patch does apply to sage-5.0.beta13.
* The fix looks fine to me.
* I am now running `make test`, and at least the first couple of tests pass.
* The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.



---

archive/issue_comments_145111.json:
```json
{
    "body": "**Reviewer:** Simon King",
    "created_at": "2012-04-15T09:54:05Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145111",
    "user": "https://github.com/simon-king-jena"
}
```

**Reviewer:** Simon King



---

archive/issue_comments_145112.json:
```json
{
    "body": "<a id='comment:3'></a>\nAll tests pass. Some criticism:\n\n* The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.\n* In fact, I think the error *should* be raised in the copy constructor.\n* One should use the :trac: directive.\n\nSo, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.",
    "created_at": "2012-04-15T09:54:05Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145112",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>
All tests pass. Some criticism:

* The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
* In fact, I think the error *should* be raised in the copy constructor.
* One should use the :trac: directive.

So, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.



---

archive/issue_events_106031.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-15T10:14:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106031"
}
```



---

archive/issue_events_106032.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-15T10:14:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106032"
}
```



---

archive/issue_comments_145113.json:
```json
{
    "body": "<a id='comment:4'></a>\nI experimented with moving the error to the `__copy` method. However, it turns out that\n\n```\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed\n```\nbecause the copy method is called with (say) 6 variables on an input of (say) 5 variables.\n\nQuestion: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\nIf the answer is \"yes\", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.\n\nIf the answer is \"no\", then what shall we do? Apparently the `__copy` method *is* called with different numbers of variables. Shall we deal with that on a different ticket or here?",
    "created_at": "2012-04-15T10:14:19Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145113",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>
I experimented with moving the error to the `__copy` method. However, it turns out that

```
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed
```
because the copy method is called with (say) 6 variables on an input of (say) 5 variables.

Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

If the answer is "yes", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.

If the answer is "no", then what shall we do? Apparently the `__copy` method *is* called with different numbers of variables. Shall we deal with that on a different ticket or here?



---

archive/issue_comments_145114.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@simon-king-jena](#comment%3A4):\n> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\nThe following use cases come to mind:\n* homogenisation\n* specialisation of a ring to those variables actually appearing in a set of polynomials\n* `change_ring()` in general\n\nSo I vote \"yes\".",
    "created_at": "2012-04-15T11:08:11Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145114",
    "user": "https://github.com/malb"
}
```

<a id='comment:5'></a>
Replying to [@simon-king-jena](#comment%3A4):
> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

The following use cases come to mind:
* homogenisation
* specialisation of a ring to those variables actually appearing in a set of polynomials
* `change_ring()` in general

So I vote "yes".



---

archive/issue_comments_145115.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@simon-king-jena](#comment%3A3):\n> All tests pass. Some criticism:\n> \n> * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.\n> * In fact, I think the error *should* be raised in the copy constructor.\n\nMy emphasis was on copy **constructor**, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`\n\n> * One should use the :trac: directive.\n\nAh, thanks for the reminder. I can updated the patch or review your reviewers patch.",
    "created_at": "2012-04-15T11:11:57Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145115",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>
Replying to [@simon-king-jena](#comment%3A3):
> All tests pass. Some criticism:
> 
> * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
> * In fact, I think the error *should* be raised in the copy constructor.

My emphasis was on copy **constructor**, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`

> * One should use the :trac: directive.

Ah, thanks for the reminder. I can updated the patch or review your reviewers patch.



---

archive/issue_comments_145116.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@malb](#comment%3A5):\n> Replying to [@simon-king-jena](#comment%3A4):\n> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\n> \n> ...\n\n>\n> So I vote \"yes\".\n\nOK, then I'll simply produce a little reviewer patch...",
    "created_at": "2012-04-17T08:39:35Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145116",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>
Replying to [@malb](#comment%3A5):
> Replying to [@simon-king-jena](#comment%3A4):
> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

> 
> ...

>
> So I vote "yes".

OK, then I'll simply produce a little reviewer patch...



---

archive/attachments_017771.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12748_reviewer.patch",
    "asset_url": "tarball://root/attachments/ticket12748/trac_12748_reviewer.patch",
    "created_at": "2012-04-17T08:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket12748/trac_12748_reviewer.patch",
    "user": "https://github.com/simon-king-jena"
}
```



---

archive/issue_comments_145117.json:
```json
{
    "body": "**Attachment:** [trac_12748_reviewer.patch](https://github.com/sagemath/sage/files/ticket12748/trac_12748_reviewer.patch)",
    "created_at": "2012-04-17T08:52:42Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145117",
    "user": "https://github.com/simon-king-jena"
}
```

**Attachment:** [trac_12748_reviewer.patch](https://github.com/sagemath/sage/files/ticket12748/trac_12748_reviewer.patch)



---

archive/issue_comments_145118.json:
```json
{
    "body": "<a id='comment:8'></a>\nThe reviewer patch is up.",
    "created_at": "2012-04-17T08:53:18Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145118",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>
The reviewer patch is up.



---

archive/issue_events_106033.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-17T08:53:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106033"
}
```



---

archive/issue_events_106034.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-17T08:53:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106034"
}
```



---

archive/issue_events_106035.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-17T08:53:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106035"
}
```



---

archive/issue_events_106036.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2012-04-17T08:53:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106036"
}
```



---

archive/issue_events_106037.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T09:47:07Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "milestone": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106037"
}
```



---

archive/issue_events_106038.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T09:47:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106038"
}
```



---

archive/issue_comments_145119.json:
```json
{
    "body": "**Merged:** sage-5.1.beta0",
    "created_at": "2012-05-06T12:16:28Z",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12748#issuecomment-145119",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.1.beta0



---

archive/issue_events_106039.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-06T12:16:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106039"
}
```



---

archive/issue_events_106040.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-06T12:16:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12748",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12748#event-106040"
}
```
