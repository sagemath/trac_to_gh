# Issue 12748: An inconsistent term order must not be accepted as input of a polynomial ring construction

archive/issues_012576.json:
```json
{
    "body": "[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:\n\n```\nsage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])\nsage: x1 in I\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n...\nRuntimeError: Segmentation fault\n```\n\nSo, two problems:\n\n* I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.\n* One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.\n\n\n\n\nAssignee: @malb\n\nKeywords: polynomial ring termorder\n\nReviewer: Simon King\n\nAuthor: Martin Albrecht\n\nMerged: sage-5.1.beta0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12748\n\n",
    "closed_at": "2012-05-06T12:16:28Z",
    "created_at": "2012-03-26T05:33:11Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "An inconsistent term order must not be accepted as input of a polynomial ring construction",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12748",
    "user": "https://github.com/simon-king-jena"
}
```
[Ben Hutz](http://groups.google.com/group/sage-devel/browse_thread/thread/1fe4a837a625754c) pointed out the following:

```
sage: R.<x0,y0,z0,x1,y1,z1,a0,a1,a2,a3,a4,a5,a6,a7,a8>=PolynomialRing(QQ,order=TermOrder('degrevlex', 6) + TermOrder('degrevlex',10))sage: I = Ideal([a0])
sage: x1 in I
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Segmentation fault
```

So, two problems:

* I think a `ValueError` should be raised if one tries to define a polynomial ring in 15 variables, but provide a term order for 16 variables.
* One should try to have a less scary error message. Ben understood that he got a segmentation fault, but if I understand correctly one really gets not more than a harmless `RuntimeError`.




Assignee: @malb

Keywords: polynomial ring termorder

Reviewer: Simon King

Author: Martin Albrecht

Merged: sage-5.1.beta0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12748





---

archive/issue_comments_184916.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184916",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_184917.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [trac_12748_term_order.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_term_order.patch) by @malb created at 2012-04-13 18:41:27\n\nThe attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184917",
    "user": "https://github.com/malb"
}
```

<a id='comment:1'></a>Attachment [trac_12748_term_order.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_term_order.patch) by @malb created at 2012-04-13 18:41:27

The attached patch raises ValueError when the number of variables in the TermOrder don't match the number of variables in the ring.



---

archive/issue_comments_184918.json:
```json
{
    "body": "Changing author from \"\" to \"Martin Albrecht\"",
    "created_at": "2012-04-13T18:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184918",
    "user": "https://github.com/malb"
}
```

Changing author from "" to "Martin Albrecht"



---

archive/issue_comments_184919.json:
```json
{
    "body": "<a id='comment:2'></a>Towards a review:\n\n* The patch does apply to sage-5.0.beta13.\n* The fix looks fine to me.\n* I am now running `make test`, and at least the first couple of tests pass.\n* The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.",
    "created_at": "2012-04-15T07:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184919",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>Towards a review:

* The patch does apply to sage-5.0.beta13.
* The fix looks fine to me.
* I am now running `make test`, and at least the first couple of tests pass.
* The patch removes an abundance of redundant whitespace. That's good, but let's hope that the patch goes in soon, since otherwise it may soon bit rot.



---

archive/issue_comments_184920.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Simon King\"",
    "created_at": "2012-04-15T09:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184920",
    "user": "https://github.com/simon-king-jena"
}
```

Changing reviewer from "" to "Simon King"



---

archive/issue_comments_184921.json:
```json
{
    "body": "<a id='comment:3'></a>All tests pass. Some criticism:\n\n* The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.\n* In fact, I think the error *should* be raised in the copy constructor.\n* One should use the :trac: directive.\n\nSo, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.",
    "created_at": "2012-04-15T09:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184921",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:3'></a>All tests pass. Some criticism:

* The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
* In fact, I think the error *should* be raised in the copy constructor.
* One should use the :trac: directive.

So, I think I'm going to produce a reviewer patch. But I think, when moving the error from `__init__` to `__copy`, that my patch will require a (cross) review.



---

archive/issue_comments_184922.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-04-15T10:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184922",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_184923.json:
```json
{
    "body": "<a id='comment:4'></a>I experimented with moving the error to the `__copy` method. However, it turns out that\n\n```\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed\n        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed\n```\nbecause the copy method is called with (say) 6 variables on an input of (say) 5 variables.\n\nQuestion: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\nIf the answer is \"yes\", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.\n\nIf the answer is \"no\", then what shall we do? Apparently the `__copy` method *is* called with different numbers of variables. Shall we deal with that on a different ticket or here?",
    "created_at": "2012-04-15T10:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184923",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:4'></a>I experimented with moving the error to the `__copy` method. However, it turns out that

```
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_ideal.py # 23 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/plural.pyx # 9 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_libsingular.pyx # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial_element.py # 2 doctests failed
        sage -t  devel/sage-main/sage/rings/polynomial/multi_polynomial.pyx # 5 doctests failed
```
because the copy method is called with (say) 6 variables on an input of (say) 5 variables.

Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

If the answer is "yes", then I give your patch a positive review and provide a small reviewer patch using the :trac: directive.

If the answer is "no", then what shall we do? Apparently the `__copy` method *is* called with different numbers of variables. Shall we deal with that on a different ticket or here?



---

archive/issue_comments_184924.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 SimonKing]:\n> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\n\nThe following use cases come to mind:\n* homogenisation\n* specialisation of a ring to those variables actually appearing in a set of polynomials\n* `change_ring()` in general\n\nSo I vote \"yes\".",
    "created_at": "2012-04-15T11:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184924",
    "user": "https://github.com/malb"
}
```

<a id='comment:5'></a>Replying to [comment:4 SimonKing]:
> Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?


The following use cases come to mind:
* homogenisation
* specialisation of a ring to those variables actually appearing in a set of polynomials
* `change_ring()` in general

So I vote "yes".



---

archive/issue_comments_184925.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:3 SimonKing]:\n> All tests pass. Some criticism:\n> \n> * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.\n> * In fact, I think the error *should* be raised in the copy constructor.\n\n\nMy emphasis was on copy **constructor**, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`\n\n>  * One should use the :trac: directive.\n\n\nAh, thanks for the reminder. I can updated the patch or review your reviewers patch.",
    "created_at": "2012-04-15T11:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184925",
    "user": "https://github.com/malb"
}
```

<a id='comment:6'></a>Replying to [comment:3 SimonKing]:
> All tests pass. Some criticism:
> 
> * The error is raised during initalisation, but the error message claims that the error occurs in the copy constructor.
> * In fact, I think the error *should* be raised in the copy constructor.


My emphasis was on copy **constructor**, i.e., not in `__copy` which is an internal function but when one calls `T = TermOrder(T)`

>  * One should use the :trac: directive.


Ah, thanks for the reminder. I can updated the patch or review your reviewers patch.



---

archive/issue_comments_184926.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 malb]:\n> Replying to [comment:4 SimonKing]:\n> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?\n\n> \n> ...\n\n>\n> So I vote \"yes\".\n\n\nOK, then I'll simply produce a little reviewer patch...",
    "created_at": "2012-04-17T08:39:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184926",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:7'></a>Replying to [comment:5 malb]:
> Replying to [comment:4 SimonKing]:
> > Question: If T is a term order with a known number of variables, do we really want that `T.__copy(t)` works, where t is a term order with a different number of variables?

> 
> ...

>
> So I vote "yes".


OK, then I'll simply produce a little reviewer patch...



---

archive/issue_comments_184927.json:
```json
{
    "body": "Attachment [trac_12748_reviewer.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_reviewer.patch) by @simon-king-jena created at 2012-04-17 08:52:42",
    "created_at": "2012-04-17T08:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184927",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment [trac_12748_reviewer.patch](tarball://root/attachments/some-uuid/ticket12748/trac_12748_reviewer.patch) by @simon-king-jena created at 2012-04-17 08:52:42



---

archive/issue_comments_184928.json:
```json
{
    "body": "<a id='comment:8'></a>The reviewer patch is up.",
    "created_at": "2012-04-17T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184928",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:8'></a>The reviewer patch is up.



---

archive/issue_comments_184929.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-04-17T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184929",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_184930.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-17T08:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184930",
    "user": "https://github.com/simon-king-jena"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_034662.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T09:47:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "milestone": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12748#event-34662"
}
```



---

archive/issue_comments_184931.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.1.beta0\"",
    "created_at": "2012-05-06T12:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184931",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.1.beta0"



---

archive/issue_events_034663.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-06T12:16:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12748#event-34663"
}
```



---

archive/issue_comments_184932.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-05-06T12:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12748",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12748#issuecomment-184932",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
