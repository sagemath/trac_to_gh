# Issue 12994: Serialization of setuptools targets in spkg/standard/deps

archive/issues_012822.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "The attached patch implements the serialization of setuptools target through the use of helper stamp targets, as discussed recently on the sage-devel mailing-list\n\nThe current situation is that some packages have wrong dependencies to force a serialization.\n\nThe patch corrects the dependencies, and forces serialization through stamp targets. Notice that on the mailing-list, the sample code created the stamps in . (ie: spkg/), while the current patch puts them in build/ (ie: spkg/build/), since that seemed more logical.\n\n**Apply** [attachment: trac12994.patch](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz)\n\nDepends on #11874\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **R. Andrew Ohana**\n\nMerged: **sage-5.4.beta1**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12994_\n\n",
    "closed_at": "2012-09-04T17:15:33Z",
    "created_at": "2012-05-23T15:30:20Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Serialization of setuptools targets in spkg/standard/deps",
    "type": "issue",
    "updated_at": "2023-01-08T08:32:03Z",
    "url": "https://github.com/sagemath/sage/issues/12994",
    "user": "https://github.com/SnarkBoojum"
}
```
The attached patch implements the serialization of setuptools target through the use of helper stamp targets, as discussed recently on the sage-devel mailing-list

The current situation is that some packages have wrong dependencies to force a serialization.

The patch corrects the dependencies, and forces serialization through stamp targets. Notice that on the mailing-list, the sample code created the stamps in . (ie: spkg/), while the current patch puts them in build/ (ie: spkg/build/), since that seemed more logical.

**Apply** [attachment: trac12994.patch](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz)

Depends on #11874

Reviewer: **Jeroen Demeyer**

Author: **R. Andrew Ohana**

Merged: **sage-5.4.beta1**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/12994_





---

archive/issue_events_178169.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-05-23T15:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178169"
}
```



---

archive/issue_events_178170.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-05-23T15:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178170"
}
```



---

archive/issue_events_178171.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-05-23T15:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178171"
}
```



---

archive/issue_events_178172.json:
```json
{
    "actor": "https://github.com/SnarkBoojum",
    "created_at": "2012-05-23T15:30:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178172"
}
```



---

archive/issue_events_178173.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-05-23T15:30:20Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "subject": "https://github.com/SnarkBoojum",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178173"
}
```



---

archive/issue_comments_147624.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPlease clarify or remove the following sentence:\n\n```\nNote: To avoid branching, we haven't given explicit dependencies, but the chain's order is important.\n```",
    "created_at": "2012-05-23T18:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147624",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

Please clarify or remove the following sentence:

```
Note: To avoid branching, we haven't given explicit dependencies, but the chain's order is important.
```



---

archive/issue_comments_147625.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYour patch makes the mistaken assumption that the directory `build/` exists.  In any case, `$(INST)` might be a better directory for this.",
    "created_at": "2012-05-23T18:58:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147625",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

Your patch makes the mistaken assumption that the directory `build/` exists.  In any case, `$(INST)` might be a better directory for this.



---

archive/issue_comments_147626.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSeems like your proposal actually makes the `deps` file more complicated, so I'm not sure I like it...\n\nWhy not simply do\n\n```\n$(INST)/$(ZODB): $(INST)/$(TWISTED)\n```\ninstead of\n\n```\nbuild/setuptools-serial-1-stamp: $(INST)/$(TWISTED)\n        touch $@\n$(INST)/$(ZODB): build/setuptools-serial-1-stamp\n```",
    "created_at": "2012-05-23T19:06:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147626",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">comment:3</div>

Seems like your proposal actually makes the `deps` file more complicated, so I'm not sure I like it...

Why not simply do

```
$(INST)/$(ZODB): $(INST)/$(TWISTED)
```
instead of

```
build/setuptools-serial-1-stamp: $(INST)/$(TWISTED)
        touch $@
$(INST)/$(ZODB): build/setuptools-serial-1-stamp
```



---

archive/issue_comments_147627.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@jdemeyer](#comment%3A1):\n> Please clarify or remove the following sentence:\n> \n> ```\n> Note: To avoid branching, we haven't given explicit dependencies, but the chain's order is important.\n> ```\n\nMy patch removes that sentence, so I don't understand what you expect :-/\n\nReplying to [@jdemeyer](#comment%3A2):\n> Your patch makes the mistaken assumption that the directory build/ exists.\n\nThat directory is created in base/prereq-1.0-install (it's even the first thing it does!), so what can happen?\n\nReplying to [@jdemeyer](#comment%3A2):\n> In any case, $(INST) might be a better directory for this.\n\nI pondered for a while between spkg/build/ and spkg/installed/ indeed, because they're the obvious two possible choices, but finally I opted :\n* against spkg/installed/, considering that was where sage documents what features are installed, and you can't consider a stamp file as a feature ;\n* for spkg/build/, considering that directory was the one used as scratch space during compilations -- and the stamp files seem to fit that description.\n\nReplying to [@jdemeyer](#comment%3A3):\n> Seems like your proposal actually makes the deps file more complicated, so I'm not sure I like it... \n\nThe current deps works around a problem by cheating on the dependencies : it takes the correct dependencies, and makes them incorrect just so something else doesn't break. My patch is about letting correct things stay correct, and providing the fix for the something which is bad.\n\nA comparison might help : if you bang your head against the wall, it hurts. The current solution is to soften the wall, and my patch is to stop banging.",
    "created_at": "2012-05-23T19:28:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147627",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@jdemeyer](#comment%3A1):
> Please clarify or remove the following sentence:
> 
> ```
> Note: To avoid branching, we haven't given explicit dependencies, but the chain's order is important.
> ```

My patch removes that sentence, so I don't understand what you expect :-/

Replying to [@jdemeyer](#comment%3A2):
> Your patch makes the mistaken assumption that the directory build/ exists.

That directory is created in base/prereq-1.0-install (it's even the first thing it does!), so what can happen?

Replying to [@jdemeyer](#comment%3A2):
> In any case, $(INST) might be a better directory for this.

I pondered for a while between spkg/build/ and spkg/installed/ indeed, because they're the obvious two possible choices, but finally I opted :
* against spkg/installed/, considering that was where sage documents what features are installed, and you can't consider a stamp file as a feature ;
* for spkg/build/, considering that directory was the one used as scratch space during compilations -- and the stamp files seem to fit that description.

Replying to [@jdemeyer](#comment%3A3):
> Seems like your proposal actually makes the deps file more complicated, so I'm not sure I like it... 

The current deps works around a problem by cheating on the dependencies : it takes the correct dependencies, and makes them incorrect just so something else doesn't break. My patch is about letting correct things stay correct, and providing the fix for the something which is bad.

A comparison might help : if you bang your head against the wall, it hurts. The current solution is to soften the wall, and my patch is to stop banging.



---

archive/issue_comments_147628.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nCould you make your patch using Mercurial? Also, I personally don't like that when done building, the BUILD directory is polluted with 6 empty files.",
    "created_at": "2012-05-23T19:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147628",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Could you make your patch using Mercurial? Also, I personally don't like that when done building, the BUILD directory is polluted with 6 empty files.



---

archive/issue_comments_147629.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@SnarkBoojum](#comment%3A4):\n> My patch removes that sentence, so I don't understand what you expect :-/\n\nActually, your patch simply *moves* that sentence.",
    "created_at": "2012-05-23T20:10:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147629",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@SnarkBoojum](#comment%3A4):
> My patch removes that sentence, so I don't understand what you expect :-/

Actually, your patch simply *moves* that sentence.



---

archive/issue_comments_147630.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@SnarkBoojum](#comment%3A4):\n> Replying to [@jdemeyer](#comment%3A1):\n> Replying to [@jdemeyer](#comment%3A2):\n> > Your patch makes the mistaken assumption that the directory build/ exists.\n\n> \n> That directory is created in base/prereq-1.0-install (it's even the first thing it does!), so what can happen?\n\nActually, prereq-1.0-install creates `SAGE_BUILD_DIR` if this variable is set, `spkg/build` if not. So I guess you should do the same check here: if `SAGE_BUILD_DIR` is set, use it; otherwise use `build/`?",
    "created_at": "2012-05-23T20:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147630",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@SnarkBoojum](#comment%3A4):
> Replying to [@jdemeyer](#comment%3A1):
> Replying to [@jdemeyer](#comment%3A2):
> > Your patch makes the mistaken assumption that the directory build/ exists.

> 
> That directory is created in base/prereq-1.0-install (it's even the first thing it does!), so what can happen?

Actually, prereq-1.0-install creates `SAGE_BUILD_DIR` if this variable is set, `spkg/build` if not. So I guess you should do the same check here: if `SAGE_BUILD_DIR` is set, use it; otherwise use `build/`?



---

archive/issue_comments_147631.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe new version of the patch :\n* is a mercurial patch ;\n* removes the unclear sentence I hadn't written but merely moved ;\n* respects SAGE_BUILD_DIR ;\n* cleans the stamp files after the build is complete.",
    "created_at": "2012-05-24T13:35:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147631",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:8" align="right">comment:8</div>

The new version of the patch :
* is a mercurial patch ;
* removes the unclear sentence I hadn't written but merely moved ;
* respects SAGE_BUILD_DIR ;
* cleans the stamp files after the build is complete.



---

archive/issue_comments_147632.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSigh. I had hand-edited the patch before uploading because I wondered why I had written rm -f $SAGE_BUILD_DIR/*stamp and not rm -f $(SAGE_BUILD_DIR)/*stamp -- in fact I shouldn't have done that, as it breaks the stamp files cleaning. Let me put up a patch that has been tested and not stupidly modified by hand afterwards.",
    "created_at": "2012-05-26T09:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147632",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:9" align="right">comment:9</div>

Sigh. I had hand-edited the patch before uploading because I wondered why I had written rm -f $SAGE_BUILD_DIR/*stamp and not rm -f $(SAGE_BUILD_DIR)/*stamp -- in fact I shouldn't have done that, as it breaks the stamp files cleaning. Let me put up a patch that has been tested and not stupidly modified by hand afterwards.



---

archive/issue_comments_147633.json:
```json
{
    "body": "Attachment: **[setuptools-serial.patch.gz](https://github.com/sagemath/sage/files/ticket12994/setuptools-serial.patch.gz)**\n\nPatch fixing the issue",
    "created_at": "2012-05-26T09:21:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147633",
    "user": "https://github.com/SnarkBoojum"
}
```

Attachment: **[setuptools-serial.patch.gz](https://github.com/sagemath/sage/files/ticket12994/setuptools-serial.patch.gz)**

Patch fixing the issue



---

archive/issue_comments_147634.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhat is the current status of this ticket? Is it ready for review?",
    "created_at": "2012-07-01T19:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147634",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:10" align="right">comment:10</div>

What is the current status of this ticket? Is it ready for review?



---

archive/issue_comments_147635.json:
```json
{
    "body": "Attachment: **[trac12994.patch.gz](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz)**\n\napply only this patch to the root repo",
    "created_at": "2012-07-03T21:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147635",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[trac12994.patch.gz](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz)**

apply only this patch to the root repo



---

archive/issue_comments_147636.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIMHO making these stamps are unnecessary. I've posted a patch containing my solution, which simply separates out the linearization, and puts it at the bottom of deps.",
    "created_at": "2012-07-03T21:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147636",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:11" align="right">comment:11</div>

IMHO making these stamps are unnecessary. I've posted a patch containing my solution, which simply separates out the linearization, and puts it at the bottom of deps.



---

archive/issue_events_178174.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-07-03T21:46:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178174"
}
```



---

archive/issue_comments_147637.json:
```json
{
    "body": "Author: **R. Andrew Ohana**",
    "created_at": "2012-07-03T21:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147637",
    "user": "https://github.com/ohanar"
}
```

Author: **R. Andrew Ohana**



---

archive/issue_comments_147638.json:
```json
{
    "body": "Dependencies: **#11874**",
    "created_at": "2012-07-03T21:46:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147638",
    "user": "https://github.com/ohanar"
}
```

Dependencies: **#11874**



---

archive/issue_events_178175.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-07-03T21:46:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178175"
}
```



---

archive/issue_events_178176.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2012-07-03T21:46:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178176"
}
```



---

archive/issue_comments_147639.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYour patch doesn't solve the problem of lying dependencies. Those packages don't depend on each other, so the deps file must not say otherwise.",
    "created_at": "2012-07-04T08:25:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147639",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:12" align="right">comment:12</div>

Your patch doesn't solve the problem of lying dependencies. Those packages don't depend on each other, so the deps file must not say otherwise.



---

archive/issue_comments_147640.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@SnarkBoojum](#comment%3A12):\n> Your patch doesn't solve the problem of lying dependencies. Those packages don't depend on each other, so the deps file must not say otherwise.\n\nYour patch also lies about the dependencies, it just does so implicitly rather than explicitly. As far as I know, you can't force the linearization without either implicitly or explicitly specifying a dependency. I think the cleaner solution is to use explicit dependencies to force the linearization, but to keep these separate from the real dependencies.",
    "created_at": "2012-07-04T08:52:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147640",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@SnarkBoojum](#comment%3A12):
> Your patch doesn't solve the problem of lying dependencies. Those packages don't depend on each other, so the deps file must not say otherwise.

Your patch also lies about the dependencies, it just does so implicitly rather than explicitly. As far as I know, you can't force the linearization without either implicitly or explicitly specifying a dependency. I think the cleaner solution is to use explicit dependencies to force the linearization, but to keep these separate from the real dependencies.



---

archive/issue_comments_147641.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nMy patch doesn't lie : it explicitly adds virtual dependencies, and makes it very clear they are virtual. Your patch doesn't bring anything to the table, as it basically does the same as what is currently done : explicit **bogus** dependencies between packages.\n\nI have used a script to visualize dependencies between sage packages ; the resulting graph had strange edges. I grepped, and indeed I saw the very explicit rules giving those edges, so my script was right. I checked the code, and it was pretty clear those rules had nothing to do there. I checked deps again by directly reading it, and found the comments stating they were **bogus**. I claim this isn't a normal situation, and should be fixed, hence the ticket -- and hence my patch.\n\nWith it, you can use a script, grep or directly read -- it doesn't matter, you can't miss that the added edges (and vertexes) only deal with the problem of serializing setuptools packages.",
    "created_at": "2012-07-04T09:46:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147641",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:14" align="right">comment:14</div>

My patch doesn't lie : it explicitly adds virtual dependencies, and makes it very clear they are virtual. Your patch doesn't bring anything to the table, as it basically does the same as what is currently done : explicit **bogus** dependencies between packages.

I have used a script to visualize dependencies between sage packages ; the resulting graph had strange edges. I grepped, and indeed I saw the very explicit rules giving those edges, so my script was right. I checked the code, and it was pretty clear those rules had nothing to do there. I checked deps again by directly reading it, and found the comments stating they were **bogus**. I claim this isn't a normal situation, and should be fixed, hence the ticket -- and hence my patch.

With it, you can use a script, grep or directly read -- it doesn't matter, you can't miss that the added edges (and vertexes) only deal with the problem of serializing setuptools packages.



---

archive/issue_comments_147642.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI prefer the second patch, because it's simpler while it does essentially the same thing.\n\nJust wondering: why did you reorder the dependencies in that way?\n\nThe Sage library depends on `jinja2` to build, so maybe it's best to build `jinja2` first.",
    "created_at": "2012-07-04T09:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147642",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

I prefer the second patch, because it's simpler while it does essentially the same thing.

Just wondering: why did you reorder the dependencies in that way?

The Sage library depends on `jinja2` to build, so maybe it's best to build `jinja2` first.



---

archive/issue_comments_147643.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@jdemeyer](#comment%3A15):\n> Just wondering: why did you reorder the dependencies in that way?\n\nJust based off of the dependencies of the packages -- I placed the ones with fewer dependencies earlier in the serial build. I'm not really attached to the ordering I put, I just figured there might be a little less waiting.\n\nI'm looking into fixing this issue in setuptools/distribute directly (I already got my hands dirty in the code fixing another issue), so hopefully this becomes irrelevant.",
    "created_at": "2012-07-04T10:14:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147643",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@jdemeyer](#comment%3A15):
> Just wondering: why did you reorder the dependencies in that way?

Just based off of the dependencies of the packages -- I placed the ones with fewer dependencies earlier in the serial build. I'm not really attached to the ordering I put, I just figured there might be a little less waiting.

I'm looking into fixing this issue in setuptools/distribute directly (I already got my hands dirty in the code fixing another issue), so hopefully this becomes irrelevant.



---

archive/issue_comments_147644.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@ohanar](#comment%3A16):\n> Replying to [@jdemeyer](#comment%3A15):\n> > Just wondering: why did you reorder the dependencies in that way?\n\n> Just based off of the dependencies of the packages -- I placed the ones with fewer dependencies earlier in the serial build. I'm not really attached to the ordering I put, I just figured there might be a little less waiting.\n\nThe path PYTHON -> DOCUTILS -> JINJA2 is faster than\nPYHTON -> ZODB -> SQLALCHEMY -> PYGMENTS -> JINJA2.\n\nThe build time for ZODB and SQLALCHEMY doesn't matter because nothing depends on it.\n\nOf course it's a detail, but since you were reordering anyway...",
    "created_at": "2012-07-04T10:38:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147644",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@ohanar](#comment%3A16):
> Replying to [@jdemeyer](#comment%3A15):
> > Just wondering: why did you reorder the dependencies in that way?

> Just based off of the dependencies of the packages -- I placed the ones with fewer dependencies earlier in the serial build. I'm not really attached to the ordering I put, I just figured there might be a little less waiting.

The path PYTHON -> DOCUTILS -> JINJA2 is faster than
PYHTON -> ZODB -> SQLALCHEMY -> PYGMENTS -> JINJA2.

The build time for ZODB and SQLALCHEMY doesn't matter because nothing depends on it.

Of course it's a detail, but since you were reordering anyway...



---

archive/issue_comments_147645.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment%3A17):\n> The path PYTHON -> DOCUTILS -> JINJA2 is faster than\n> PYHTON -> ZODB -> SQLALCHEMY -> PYGMENTS -> JINJA2.\n> \n> The build time for ZODB and SQLALCHEMY doesn't matter because nothing depends on it.\n\nSure, but [http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg](http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg) now includes a patch that fixes the issue with setuptools, and allows for parallel use of setuptools. We still, for the time being, have to have sagenb be the last setuptools spkg to build until #13197 is rebased off of this spkg.",
    "created_at": "2012-07-04T11:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147645",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment%3A17):
> The path PYTHON -> DOCUTILS -> JINJA2 is faster than
> PYHTON -> ZODB -> SQLALCHEMY -> PYGMENTS -> JINJA2.
> 
> The build time for ZODB and SQLALCHEMY doesn't matter because nothing depends on it.

Sure, but [http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg](http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg) now includes a patch that fixes the issue with setuptools, and allows for parallel use of setuptools. We still, for the time being, have to have sagenb be the last setuptools spkg to build until #13197 is rebased off of this spkg.



---

archive/issue_comments_147646.json:
```json
{
    "body": "use with spkg",
    "created_at": "2012-07-04T11:20:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147646",
    "user": "https://github.com/ohanar"
}
```

use with spkg



---

archive/issue_comments_147647.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAttachment: **[trac12994-spkg-fix.patch.gz](https://github.com/sagemath/sage/files/ticket12994/trac12994-spkg-fix.patch.gz)**\n\nReplying to [@jdemeyer](#comment%3A15):\n> I prefer the second patch, because it's simpler while it does essentially the same thing.\n\n\nThe second patch basically does nothing at all : it serializes things precisely like I complain shouldn't be done, by adding wrong but correct-looking edges in the dependency graph.\n\nThis is a typical application of the quote : \u201cFor every problem there is a solution which is simple, clean and wrong.\u201d\n\nIf that problem goes away by getting the original issue down, that's perfect : my goal isn't to make my patch go in -- it's to get things right :  there must not be a \"$(INST)/$(FOO): $(INST)/$(BAR)\" rule in deps between actual packages which doesn't correspond to an actual dependency.",
    "created_at": "2012-07-04T12:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147647",
    "user": "https://github.com/SnarkBoojum"
}
```

<div id="comment:19" align="right">comment:19</div>

Attachment: **[trac12994-spkg-fix.patch.gz](https://github.com/sagemath/sage/files/ticket12994/trac12994-spkg-fix.patch.gz)**

Replying to [@jdemeyer](#comment%3A15):
> I prefer the second patch, because it's simpler while it does essentially the same thing.


The second patch basically does nothing at all : it serializes things precisely like I complain shouldn't be done, by adding wrong but correct-looking edges in the dependency graph.

This is a typical application of the quote : “For every problem there is a solution which is simple, clean and wrong.”

If that problem goes away by getting the original issue down, that's perfect : my goal isn't to make my patch go in -- it's to get things right :  there must not be a "$(INST)/$(FOO): $(INST)/$(BAR)" rule in deps between actual packages which doesn't correspond to an actual dependency.



---

archive/issue_comments_147648.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@ohanar](#comment%3A18):\n> Sure, but [http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg](http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg) now includes a patch that fixes the issue with setuptools, and allows for parallel use of setuptools. We still, for the time being, have to have sagenb be the last setuptools spkg to build until #13197 is rebased off of this spkg.\n\nDoes this spkg belong to this ticket or a different ticket?  If the former, add it in the ticket description.  If the latter, add the correct Dependency of the ticket.",
    "created_at": "2012-07-04T15:01:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147648",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@ohanar](#comment%3A18):
> Sure, but [http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg](http://wstein.org/home/ohanar/spkgs/setuptools-0.6.16.p1.spkg) now includes a patch that fixes the issue with setuptools, and allows for parallel use of setuptools. We still, for the time being, have to have sagenb be the last setuptools spkg to build until #13197 is rebased off of this spkg.

Does this spkg belong to this ticket or a different ticket?  If the former, add it in the ticket description.  If the latter, add the correct Dependency of the ticket.



---

archive/issue_comments_147649.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@SnarkBoojum](#comment%3A19):\n> The second patch basically does nothing at all : it serializes things precisely like I complain shouldn't be done, by adding wrong but correct-looking edges in the dependency graph.\n> \n> This is a typical application of the quote : \u201cFor every problem there is a solution which is simple, clean and wrong.\u201d\n> \n> If that problem goes away by getting the original issue down, that's perfect : my goal isn't to make my patch go in -- it's to get things right :  there must not be a \"$(INST)/$(FOO): $(INST)/$(BAR)\" rule in deps between actual packages which doesn't correspond to an actual dependency.\n\nI think we all made our point and have to realize that we don't agree.",
    "created_at": "2012-07-04T15:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147649",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@SnarkBoojum](#comment%3A19):
> The second patch basically does nothing at all : it serializes things precisely like I complain shouldn't be done, by adding wrong but correct-looking edges in the dependency graph.
> 
> This is a typical application of the quote : “For every problem there is a solution which is simple, clean and wrong.”
> 
> If that problem goes away by getting the original issue down, that's perfect : my goal isn't to make my patch go in -- it's to get things right :  there must not be a "$(INST)/$(FOO): $(INST)/$(BAR)" rule in deps between actual packages which doesn't correspond to an actual dependency.

I think we all made our point and have to realize that we don't agree.



---

archive/issue_comments_147650.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment%3A20):\n> Does this spkg belong to this ticket or a different ticket?  If the former, add it in the ticket description.  If the latter, add the correct Dependency of the ticket.\n\nIt should belong to a different ticket, I just hadn't made one last night, and I needed to go to bed. This spkg (and corresponding patch) are now at #13201.",
    "created_at": "2012-07-04T22:26:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147650",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment%3A20):
> Does this spkg belong to this ticket or a different ticket?  If the former, add it in the ticket description.  If the latter, add the correct Dependency of the ticket.

It should belong to a different ticket, I just hadn't made one last night, and I needed to go to bed. This spkg (and corresponding patch) are now at #13201.



---

archive/issue_comments_147651.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI would say: let's not depend on #13201 here.  Instead, you could fix `spkg/standard/deps` at #13201.  So I assume that [attachment: trac12994.patch](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz) is still the subject of review.",
    "created_at": "2012-08-31T08:36:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147651",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

I would say: let's not depend on #13201 here.  Instead, you could fix `spkg/standard/deps` at #13201.  So I assume that [attachment: trac12994.patch](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz) is still the subject of review.



---

archive/issue_comments_147652.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2012-09-04T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147652",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_147653.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,4 @@\n \n The patch corrects the dependencies, and forces serialization through stamp targets. Notice that on the mailing-list, the sample code created the stamps in . (ie: spkg/), while the current patch puts them in build/ (ie: spkg/build/), since that seemed more logical.\n \n-I checked on sage.math that parallel compilation works, and that compilation with checks passes.\n+**Apply** [attachment: trac12994.patch](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz)\n``````\n",
    "created_at": "2012-09-04T08:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147653",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,4 @@
 
 The patch corrects the dependencies, and forces serialization through stamp targets. Notice that on the mailing-list, the sample code created the stamps in . (ie: spkg/), while the current patch puts them in build/ (ie: spkg/build/), since that seemed more logical.
 
-I checked on sage.math that parallel compilation works, and that compilation with checks passes.
+**Apply** [attachment: trac12994.patch](https://github.com/sagemath/sage/files/ticket12994/trac12994.patch.gz)
``````




---

archive/issue_events_178177.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T11:59:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178177"
}
```



---

archive/issue_events_178178.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T11:59:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178178"
}
```



---

archive/issue_events_178179.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T15:22:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178179"
}
```



---

archive/issue_events_178180.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T15:22:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "milestone_number": null,
    "milestone_title": "sage-5.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178180"
}
```



---

archive/issue_events_178181.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T17:15:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178181"
}
```



---

archive/issue_events_178182.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-09-04T17:15:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12994#event-178182"
}
```



---

archive/issue_comments_147654.json:
```json
{
    "body": "Merged: **sage-5.4.beta1**",
    "created_at": "2012-09-04T17:15:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12994",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12994#issuecomment-147654",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.4.beta1**
