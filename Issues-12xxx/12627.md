# Issue 12627: The spkg/bin/sage script engraves paths to executables

archive/issues_012455.json:
```json
{
    "body": "There is no need to make full paths explicit - it is even an hindrance when one moves things around.\n\nSince sage-env already sets PATH correctly, let's just use that.\n\nThe use of 'command' to test for the presence of an executable in the path is portable, as documented in this [stackoverflow question](http://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script).\n\nAssignee: @nexttime\n\nCC:  @kini\n\nKeywords: rd2\n\nReviewer: R. Andrew Ohana\n\nAuthor: Julien Puydt, Volker Braun\n\nBranch: u/vbraun/use_path_for_binaries\n\nCommit: 44c4cf1d27b8562200c5b1978d29ad7b70b2f687\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12627\n\n",
    "closed_at": "2013-12-17T19:55:47Z",
    "created_at": "2012-03-04T08:02:58Z",
    "labels": [
        "component: scripts",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "The spkg/bin/sage script engraves paths to executables",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12627",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```
There is no need to make full paths explicit - it is even an hindrance when one moves things around.

Since sage-env already sets PATH correctly, let's just use that.

The use of 'command' to test for the presence of an executable in the path is portable, as documented in this [stackoverflow question](http://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script).

Assignee: @nexttime

CC:  @kini

Keywords: rd2

Reviewer: R. Andrew Ohana

Author: Julien Puydt, Volker Braun

Branch: u/vbraun/use_path_for_binaries

Commit: 44c4cf1d27b8562200c5b1978d29ad7b70b2f687

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12627





---

archive/issue_comments_181807.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-04T08:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181807",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_181808.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis needs to be rebased to Sage 5.0: `sage-sage` no longer exists; the relevant script is `$SAGE_ROOT/spkg/bin/sage` and is in the root repository.",
    "created_at": "2012-03-04T16:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181808",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
This needs to be rebased to Sage 5.0: `sage-sage` no longer exists; the relevant script is `$SAGE_ROOT/spkg/bin/sage` and is in the root repository.



---

archive/issue_comments_181809.json:
```json
{
    "body": "<a id='comment:3'></a>\nDone ; it wasn't just a case of applying the same patch, as now 'R' can be called through the script.",
    "created_at": "2012-03-04T17:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181809",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:3'></a>
Done ; it wasn't just a case of applying the same patch, as now 'R' can be called through the script.



---

archive/issue_comments_181810.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis patch doesn't seem like a bad idea, but I don't know if it's actually useful for anything. Using the environment variable `SAGE_LOCAL` is supposed to make these paths portable already, so I'm not sure I understand the comment about the current situation being \"an hindrance when one moves things around\". Another way to say it: sage-env sets the `PATH` by using `SAGE_LOCAL`, so with or without this patch, if `SAGE_LOCAL` is right, these commands will work, while if it is wrong, they won't.",
    "created_at": "2012-03-05T20:48:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181810",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
This patch doesn't seem like a bad idea, but I don't know if it's actually useful for anything. Using the environment variable `SAGE_LOCAL` is supposed to make these paths portable already, so I'm not sure I understand the comment about the current situation being "an hindrance when one moves things around". Another way to say it: sage-env sets the `PATH` by using `SAGE_LOCAL`, so with or without this patch, if `SAGE_LOCAL` is right, these commands will work, while if it is wrong, they won't.



---

archive/issue_comments_181811.json:
```json
{
    "body": "<a id='comment:5'></a>\nWith the current situation, sage-env makes sure the rest of sage has a good environment to work, but sage-sage decides it knows better and shortcuts it.\n\nThis is one of the situations I denounced on the sage-devel mailing-list, where sage is supposed to be modular but in fact isn't, because the modules don't just depend on each other's work : there are hidden, subtle places where they do their own thing.\n\nI have a few patches up my sleeve to move things around ; they're not supposed to go upstream anytime soon. But they make some hidden things appear, so I fix them, and as it's interesting for upstream, I report immediately, with a proper fix, independent of my experiments.\n\nTo be fully honest, the goal of my not-for-upstream experiments is precisely to find modularity problems and fix them...",
    "created_at": "2012-03-06T07:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181811",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:5'></a>
With the current situation, sage-env makes sure the rest of sage has a good environment to work, but sage-sage decides it knows better and shortcuts it.

This is one of the situations I denounced on the sage-devel mailing-list, where sage is supposed to be modular but in fact isn't, because the modules don't just depend on each other's work : there are hidden, subtle places where they do their own thing.

I have a few patches up my sleeve to move things around ; they're not supposed to go upstream anytime soon. But they make some hidden things appear, so I fix them, and as it's interesting for upstream, I report immediately, with a proper fix, independent of my experiments.

To be fully honest, the goal of my not-for-upstream experiments is precisely to find modularity problems and fix them...



---

archive/issue_comments_181812.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe patch looks good to me and works properly for me.",
    "created_at": "2012-03-18T02:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181812",
    "user": "https://github.com/ohanar"
}
```

<a id='comment:6'></a>
The patch looks good to me and works properly for me.



---

archive/issue_comments_181813.json:
```json
{
    "body": "Changing reviewer from \"\" to \"R. Andrew Ohana\"",
    "created_at": "2012-03-18T02:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181813",
    "user": "https://github.com/ohanar"
}
```

Changing reviewer from "" to "R. Andrew Ohana"



---

archive/issue_comments_181814.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-18T02:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181814",
    "user": "https://github.com/ohanar"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_181815.json:
```json
{
    "body": "Changing keywords from \"\" to \"rd2\".",
    "created_at": "2012-03-18T02:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181815",
    "user": "https://github.com/ohanar"
}
```

Changing keywords from "" to "rd2".



---

archive/issue_comments_181816.json:
```json
{
    "body": "Changing author from \"\" to \"Julien Puydt\"",
    "created_at": "2012-03-18T02:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181816",
    "user": "https://github.com/ohanar"
}
```

Changing author from "" to "Julien Puydt"



---

archive/issue_comments_181817.json:
```json
{
    "body": "<a id='comment:7'></a>\nJulien, I'm not sure whether you're aware of that, but your patch changes in at least *some* situations the *fully intentional* behavior.\n\nFor example, a couple of Sage components / programs are *optional*, like e.g. `kash` or `Macaulay2`, and it is **not** intended to run a system-wide / non-Sage version of `kash` (that might be found along `PATH`) if one types `sage --kash`.  (Although I admit that the current response in case Sage's version *isn't* installed -- *\"File not found\"* -- is quite odd, i.e., not very user-friendly.)\n\nIn other cases a path is prepended *to make sure* we really run the correct instance of a Sage script, namely that of the *\"current\"* Sage installation, given by `SAGE_ROOT` (or `SAGE_LOCAL`), or to make sure our assumptions about the current directory (or other variable settings) are correct -- especially since different people develop things, sometimes perhaps too independently.  Not very pythonic, but similar to `assert()`, which at least *signals* errors [before things get worse and untraceable].\n\nRedundancy is *necessary* to achieve some robustness, catch (and hopefully appropriately handle) errors when they occur, or as early as possible, e.g. if a script or program doesn't exist where it is supposed to be located, since we cannot rule out an installation gets messed up -- probably by Sage itself, due to bugs, if not by a user...",
    "created_at": "2012-03-18T05:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181817",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:7'></a>
Julien, I'm not sure whether you're aware of that, but your patch changes in at least *some* situations the *fully intentional* behavior.

For example, a couple of Sage components / programs are *optional*, like e.g. `kash` or `Macaulay2`, and it is **not** intended to run a system-wide / non-Sage version of `kash` (that might be found along `PATH`) if one types `sage --kash`.  (Although I admit that the current response in case Sage's version *isn't* installed -- *"File not found"* -- is quite odd, i.e., not very user-friendly.)

In other cases a path is prepended *to make sure* we really run the correct instance of a Sage script, namely that of the *"current"* Sage installation, given by `SAGE_ROOT` (or `SAGE_LOCAL`), or to make sure our assumptions about the current directory (or other variable settings) are correct -- especially since different people develop things, sometimes perhaps too independently.  Not very pythonic, but similar to `assert()`, which at least *signals* errors [before things get worse and untraceable].

Redundancy is *necessary* to achieve some robustness, catch (and hopefully appropriately handle) errors when they occur, or as early as possible, e.g. if a script or program doesn't exist where it is supposed to be located, since we cannot rule out an installation gets messed up -- probably by Sage itself, due to bugs, if not by a user...



---

archive/issue_comments_181818.json:
```json
{
    "body": "<a id='comment:8'></a>\nOh, forgot, the `PATH` issue reminds me of [this...](http://holistic.xkcd.com/) (Web 3.0)",
    "created_at": "2012-03-18T05:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181818",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:8'></a>
Oh, forgot, the `PATH` issue reminds me of [this...](http://holistic.xkcd.com/) (Web 3.0)



---

archive/issue_comments_181819.json:
```json
{
    "body": "<a id='comment:9'></a>\n`@`leif: I did check sage-env prepended to PATH before proposing the patch, so I can confirm that sage will run what it wants when it wants something, and perhaps still run something even if it isn't sure what it wants. And when one moves things around, that is useful. So, positive review?",
    "created_at": "2012-03-18T10:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181819",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:9'></a>
`@`leif: I did check sage-env prepended to PATH before proposing the patch, so I can confirm that sage will run what it wants when it wants something, and perhaps still run something even if it isn't sure what it wants. And when one moves things around, that is useful. So, positive review?



---

archive/issue_comments_181820.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2012-03-18T11:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181820",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_181821.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [leif](#comment%3A7):\n> Julien, I'm not sure whether you're aware of that, but your patch changes in at least *some* situations the *fully intentional* behavior.\n> \n> For example, a couple of Sage components / programs are *optional*, like e.g. `kash` or `Macaulay2`, and it is **not** intended to run a system-wide / non-Sage version of `kash` (that might be found along `PATH`) if one types `sage --kash`.  (Although I admit that the current response in case Sage's version *isn't* installed -- *\"File not found\"* -- is quite odd, i.e., not very user-friendly.)\n\nI think this still needs an answer.",
    "created_at": "2012-03-18T11:28:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181821",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [leif](#comment%3A7):
> Julien, I'm not sure whether you're aware of that, but your patch changes in at least *some* situations the *fully intentional* behavior.
> 
> For example, a couple of Sage components / programs are *optional*, like e.g. `kash` or `Macaulay2`, and it is **not** intended to run a system-wide / non-Sage version of `kash` (that might be found along `PATH`) if one types `sage --kash`.  (Although I admit that the current response in case Sage's version *isn't* installed -- *"File not found"* -- is quite odd, i.e., not very user-friendly.)

I think this still needs an answer.



---

archive/issue_comments_181822.json:
```json
{
    "body": "<a id='comment:12'></a>\nWell, in fact I did answer, but apparently I wasn't clear enough ; let's rephrase it with arrays.\n\nThe current situation is :\n|         |             |            |\n|---------|-------------|------------|\n| in-sage | out-of-sage | what runs? |\n| yes | yes | in-sage |\n| yes | no \u00a0| in-sage |\n| no | yes | error |\n| no | no | error |\n\nwith my patch :\n|         |             |            |\n|---------|-------------|------------|\n| in-sage | out-of-sage | what runs? |\n| yes | yes | in-sage |\n| yes | no  | in-sage |\n| no | yes | out-of-sage |\n| no | no | error |\n\nand additionnally, using PATH instead of putting the PATH inside removes implicit dependencies, which makes sage really more modular (things can move around and that won't break).",
    "created_at": "2012-03-18T12:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181822",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:12'></a>
Well, in fact I did answer, but apparently I wasn't clear enough ; let's rephrase it with arrays.

The current situation is :
|         |             |            |
|---------|-------------|------------|
| in-sage | out-of-sage | what runs? |
| yes | yes | in-sage |
| yes | no  | in-sage |
| no | yes | error |
| no | no | error |

with my patch :
|         |             |            |
|---------|-------------|------------|
| in-sage | out-of-sage | what runs? |
| yes | yes | in-sage |
| yes | no  | in-sage |
| no | yes | out-of-sage |
| no | no | error |

and additionnally, using PATH instead of putting the PATH inside removes implicit dependencies, which makes sage really more modular (things can move around and that won't break).



---

archive/issue_comments_181823.json:
```json
{
    "body": "<a id='comment:13'></a>\nI think the current behaviour is better.  I certainly would not expect\n\n```\nsage --kash\n```\nto run some random `kash` which happens to be installed on my system.  I expect `sage --kash` to run the `kash` from `sage` and give an error message when `kash` is not installed in Sage.\n\nReplying to [Snark](#comment%3A12):\n> and additionnally, using PATH instead of putting the PATH inside removes implicit dependencies, which makes sage really more modular (things can move around and that won't break).\n\nI really don't see the need for this.  Maybe you should be more explicit about the patches on your sleeve.",
    "created_at": "2012-03-18T12:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181823",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
I think the current behaviour is better.  I certainly would not expect

```
sage --kash
```
to run some random `kash` which happens to be installed on my system.  I expect `sage --kash` to run the `kash` from `sage` and give an error message when `kash` is not installed in Sage.

Replying to [Snark](#comment%3A12):
> and additionnally, using PATH instead of putting the PATH inside removes implicit dependencies, which makes sage really more modular (things can move around and that won't break).

I really don't see the need for this.  Maybe you should be more explicit about the patches on your sleeve.



---

archive/issue_comments_181824.json:
```json
{
    "body": "<a id='comment:14'></a>\nIf there is a kash on your system, there shouldn't be any problem using it. Just because it doesn't come from sage doesn't mean it's wrong.\n\nMy patch makes sage less fragile (less error cases) and more portable (use of 'command' to test the presence of an executable) and less surprising (don't go against what sage-env says it PATH). It doesn't have the side effect of running something out-of-sage when it's available in-sage. What exactly is the problem?\n\n[I can't make more patches public : I already made public those that looked good (see #12623, #12624, #12639 in addition of this one), and the rest were too hackish and are probably obsolete now. Besides, this one patch here has enough merits of its own.]",
    "created_at": "2012-03-18T14:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181824",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:14'></a>
If there is a kash on your system, there shouldn't be any problem using it. Just because it doesn't come from sage doesn't mean it's wrong.

My patch makes sage less fragile (less error cases) and more portable (use of 'command' to test the presence of an executable) and less surprising (don't go against what sage-env says it PATH). It doesn't have the side effect of running something out-of-sage when it's available in-sage. What exactly is the problem?

[I can't make more patches public : I already made public those that looked good (see #12623, #12624, #12639 in addition of this one), and the rest were too hackish and are probably obsolete now. Besides, this one patch here has enough merits of its own.]



---

archive/issue_comments_181825.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [Snark](#comment%3A12):\n> using PATH instead of putting the PATH inside removes implicit dependencies, which makes sage really more modular (things can move around and that won't break).\n\n\nI don't really understand what you want to \"move around\".\n\nAs mentioned, the explicit paths, although (or because they are -- in a perfect world) redundant, are for safety reasons, since they lead to errors if a script is missing, i.e., not where it is supposed to be located.  That's IMHO just fine.  And I don't see what you want to make \"more modular\" there.\n\nW.r.t. `sage --PROGRAM`:\n\nIf you want to run a system-wide installed version of R, type (*outside of* a Sage subshell) `R`.\n\nIf you want to run Sage's version of R, type `sage --R`, or type `R` from within a Sage subshell.\n\nSame for optional components.  The following part of your patch is IMHO plain wrong:\n\n```patch\ndiff -r 959bec9e01d9 -r a46cac822f1e spkg/bin/sage\n--- a/spkg/bin/sage Sun Mar 04 18:00:53 2012 +0100\n+++ b/spkg/bin/sage Sun Mar 04 18:03:11 2012 +0100\n@@ -92,11 +92,11 @@\n     echo \"  -ipython [...]      -- run Sage's IPython using the default environment (not\"\n     echo \"                         Sage), passing additional options to IPython\"\n     echo \"  -kash [...]         -- run Sage's Kash with given arguments\"\n-    test -x \"$SAGE_LOCAL/bin/kash\" || \\\n+    command -v kash &>/dev/null || \\\n     echo \"                         (not installed currently, run sage -i kash)\"\n     echo \"  -lisp [...]         -- run Lisp interpreter included with Sage\"\n     echo \"  -M2 [...]           -- run Sage's Macaulay2 with given arguments\"\n-    test -x \"$SAGE_LOCAL/bin/M2\" || \\\n+    command -v M2 &>/dev/null || \\\n     echo \"                         (not installed currently, run sage -i macaulay2)\"\n     echo \"  -maxima [...]       -- run Sage's Maxima with given arguments\"\n     echo \"  -mwrank [...]       -- run Sage's mwrank with given arguments\"\n```\n\nalong with\n\n```patch\ndiff -r 959bec9e01d9 -r a46cac822f1e spkg/bin/sage\n--- a/spkg/bin/sage Sun Mar 04 18:00:53 2012 +0100\n+++ b/spkg/bin/sage Sun Mar 04 18:03:11 2012 +0100\n@@ -417,7 +417,7 @@\n if [ \"$1\" = '-kash'  -o \"$1\" = '--kash' ]; then\n     cd \"$CUR\"\n     shift\n-    \"$SAGE_LOCAL/bin/kash\" \"$@\"\n+    kash \"$@\"\n     exit $?\n fi\n\n```\n\nand\n\n```patch\ndiff -r 959bec9e01d9 -r a46cac822f1e spkg/bin/sage\n--- a/spkg/bin/sage Sun Mar 04 18:00:53 2012 +0100\n+++ b/spkg/bin/sage Sun Mar 04 18:03:11 2012 +0100\n@@ -445,7 +445,7 @@\n if [ \"$1\" = '-M2'  -o \"$1\" = '--M2' ]; then\n     cd \"$CUR\"\n     shift\n-    \"$SAGE_LOCAL/bin/M2\" \"$@\"\n+    M2 \"$@\"\n     exit $?\n fi\n\n```\n\n(Instead, we should use `test -x \"$SAGE_LOCAL\"/bin/<program>` there, too, and tell the user how to install it in case it's not.  You could of course also use `case \"`command -v <program>`\" in ...`, although the latter might give unexpected results with symlinks; I'm not 100% sure about that.)\n\nSimilar for *standard* components (and other scripts) of Sage, since if -- for whatever reason -- `$SAGE_LOCAL/bin/<program>` is missing, which **is** an error, no other program along the path which happens to have the same name should be run; instead, an appropriate error message should be printed.\n\nIf you want to \"move things around\", why not create symbolic links in `$SAGE_LOCAL/bin/`?\n\nOr you have to be more explicit with *what* you want to move, or what should be more customizable.\n\n\n\n\nSlightly related:\n\n```\nTo install small scripts to directly run Sage's versions of GAP,\nthe PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.\njust 'gap' or 'gp') into a standard 'bin' directory, start Sage\nby typing 'sage' (or './sage') and enter something like\n\n    install_scripts('/usr/local/bin')\n\nat the Sage command prompt ('sage:').\n```\n(Type `install_scripts?` at the Sage prompt for more information, i.e., options to it.)",
    "created_at": "2012-03-19T03:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181825",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:15'></a>
Replying to [Snark](#comment%3A12):
> using PATH instead of putting the PATH inside removes implicit dependencies, which makes sage really more modular (things can move around and that won't break).


I don't really understand what you want to "move around".

As mentioned, the explicit paths, although (or because they are -- in a perfect world) redundant, are for safety reasons, since they lead to errors if a script is missing, i.e., not where it is supposed to be located.  That's IMHO just fine.  And I don't see what you want to make "more modular" there.

W.r.t. `sage --PROGRAM`:

If you want to run a system-wide installed version of R, type (*outside of* a Sage subshell) `R`.

If you want to run Sage's version of R, type `sage --R`, or type `R` from within a Sage subshell.

Same for optional components.  The following part of your patch is IMHO plain wrong:

```patch
diff -r 959bec9e01d9 -r a46cac822f1e spkg/bin/sage
--- a/spkg/bin/sage Sun Mar 04 18:00:53 2012 +0100
+++ b/spkg/bin/sage Sun Mar 04 18:03:11 2012 +0100
@@ -92,11 +92,11 @@
     echo "  -ipython [...]      -- run Sage's IPython using the default environment (not"
     echo "                         Sage), passing additional options to IPython"
     echo "  -kash [...]         -- run Sage's Kash with given arguments"
-    test -x "$SAGE_LOCAL/bin/kash" || \
+    command -v kash &>/dev/null || \
     echo "                         (not installed currently, run sage -i kash)"
     echo "  -lisp [...]         -- run Lisp interpreter included with Sage"
     echo "  -M2 [...]           -- run Sage's Macaulay2 with given arguments"
-    test -x "$SAGE_LOCAL/bin/M2" || \
+    command -v M2 &>/dev/null || \
     echo "                         (not installed currently, run sage -i macaulay2)"
     echo "  -maxima [...]       -- run Sage's Maxima with given arguments"
     echo "  -mwrank [...]       -- run Sage's mwrank with given arguments"
```

along with

```patch
diff -r 959bec9e01d9 -r a46cac822f1e spkg/bin/sage
--- a/spkg/bin/sage Sun Mar 04 18:00:53 2012 +0100
+++ b/spkg/bin/sage Sun Mar 04 18:03:11 2012 +0100
@@ -417,7 +417,7 @@
 if [ "$1" = '-kash'  -o "$1" = '--kash' ]; then
     cd "$CUR"
     shift
-    "$SAGE_LOCAL/bin/kash" "$@"
+    kash "$@"
     exit $?
 fi

```

and

```patch
diff -r 959bec9e01d9 -r a46cac822f1e spkg/bin/sage
--- a/spkg/bin/sage Sun Mar 04 18:00:53 2012 +0100
+++ b/spkg/bin/sage Sun Mar 04 18:03:11 2012 +0100
@@ -445,7 +445,7 @@
 if [ "$1" = '-M2'  -o "$1" = '--M2' ]; then
     cd "$CUR"
     shift
-    "$SAGE_LOCAL/bin/M2" "$@"
+    M2 "$@"
     exit $?
 fi

```

(Instead, we should use `test -x "$SAGE_LOCAL"/bin/<program>` there, too, and tell the user how to install it in case it's not.  You could of course also use `case "`command -v <program>`" in ...`, although the latter might give unexpected results with symlinks; I'm not 100% sure about that.)

Similar for *standard* components (and other scripts) of Sage, since if -- for whatever reason -- `$SAGE_LOCAL/bin/<program>` is missing, which **is** an error, no other program along the path which happens to have the same name should be run; instead, an appropriate error message should be printed.

If you want to "move things around", why not create symbolic links in `$SAGE_LOCAL/bin/`?

Or you have to be more explicit with *what* you want to move, or what should be more customizable.




Slightly related:

```
To install small scripts to directly run Sage's versions of GAP,
the PARI/GP interpreter, Maxima, or Singular etc. (by typing e.g.
just 'gap' or 'gp') into a standard 'bin' directory, start Sage
by typing 'sage' (or './sage') and enter something like

    install_scripts('/usr/local/bin')

at the Sage command prompt ('sage:').
```
(Type `install_scripts?` at the Sage prompt for more information, i.e., options to it.)



---

archive/issue_comments_181826.json:
```json
{
    "body": "<a id='comment:16'></a>\nSigh.\n\nFirst, you still mention \"test -x\" although I pointed out it's not the recommended way to check for an executable.\n\nSecond, as I already pointed out, my patch makes sage run sage versions by default if available. And if not available in sage, if they are available on the system, use that. The only error case is the one where indeed, it is really not available. That makes sense.\n\nThere seem to be a high dose of paranoia in sage developers about everything that doesn't come out of sage.\n\nYou still have to show me why I should be more cautious about running /usr/bin/kash : after all, sage runs on the system bash and uses the system libc! And for that last one, there are definitive reports where that gives problems and failed doctests -- I know it well, it's on ubuntu/ARM and I did the port!\n\nMy point is simple : from a sage-whatever-beta_n to sage-whatever-beta_{n+1}, 90% of the spkg are the same. So if I could make foo-3.14.spkg install in $HOME/sage/foo-3.14 and make the rest of sage use that (this is modularity -- the contrary of a one-block where nothing can move an hair's width without everything collapsing), then that means I can gain 90% of build time. And I have the room to have more versions of sage installed simultaneously.\n\nAnd maintaining a big chunk of symlinks is a bad solution to a wrong problem.",
    "created_at": "2012-03-19T06:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181826",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:16'></a>
Sigh.

First, you still mention "test -x" although I pointed out it's not the recommended way to check for an executable.

Second, as I already pointed out, my patch makes sage run sage versions by default if available. And if not available in sage, if they are available on the system, use that. The only error case is the one where indeed, it is really not available. That makes sense.

There seem to be a high dose of paranoia in sage developers about everything that doesn't come out of sage.

You still have to show me why I should be more cautious about running /usr/bin/kash : after all, sage runs on the system bash and uses the system libc! And for that last one, there are definitive reports where that gives problems and failed doctests -- I know it well, it's on ubuntu/ARM and I did the port!

My point is simple : from a sage-whatever-beta_n to sage-whatever-beta_{n+1}, 90% of the spkg are the same. So if I could make foo-3.14.spkg install in $HOME/sage/foo-3.14 and make the rest of sage use that (this is modularity -- the contrary of a one-block where nothing can move an hair's width without everything collapsing), then that means I can gain 90% of build time. And I have the room to have more versions of sage installed simultaneously.

And maintaining a big chunk of symlinks is a bad solution to a wrong problem.



---

archive/issue_comments_181827.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [Snark](#comment%3A16):\n> Sigh.\n> \n> First, you still mention \"test -x\" although I pointed out it's not the recommended way to check for an executable.\n\nYou \"pointed out\" without saying why.  I think `test -x` is used perfectly here.\n\n> Second, as I already pointed out, my patch makes sage run sage versions by default if available. And if not available in sage, if they are available on the system, use that. The only error case is the one where indeed, it is really not available.\n\nAs I (and leif, for once I agree with him) have said, sage --COMMAND is supposed to run the Sage version of COMMAND.\n\n> There seem to be a high dose of paranoia in sage developers about everything that doesn't come out of sage.\n\nThat's not really the point.  Within Sage, we have more control over the versions of the optional packages.  Also, nothing prevents you from running in a shell (either a Sage shell or not):\n\n```\n$ kash\n```\nIt's as easy as that.\n\n> My point is simple : from a sage-whatever-beta_n to sage-whatever-beta_{n+1}, 90% of the spkg are the same. So if I could make foo-3.14.spkg install in $HOME/sage/foo-3.14 and make the rest of sage use that (this is modularity -- the contrary of a one-block where nothing can move an hair's width without everything collapsing), then that means I can gain 90% of build time. And I have the room to have more versions of sage installed simultaneously.\n\nYou could play with environment variables to solve this: apply patch #12647 and write in your `.sage/sagerc`:\n\n```\nexport PATH=\"$PATH:$HOME/sage/foo-3.14/local/bin\"\nexport LD_LIBRARY_PATH=\"$LD_LIBRARY_PATH:$HOME/sage/foo-3.14/local/lib\"\n```\nor something like this.",
    "created_at": "2012-03-19T08:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181827",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Replying to [Snark](#comment%3A16):
> Sigh.
> 
> First, you still mention "test -x" although I pointed out it's not the recommended way to check for an executable.

You "pointed out" without saying why.  I think `test -x` is used perfectly here.

> Second, as I already pointed out, my patch makes sage run sage versions by default if available. And if not available in sage, if they are available on the system, use that. The only error case is the one where indeed, it is really not available.

As I (and leif, for once I agree with him) have said, sage --COMMAND is supposed to run the Sage version of COMMAND.

> There seem to be a high dose of paranoia in sage developers about everything that doesn't come out of sage.

That's not really the point.  Within Sage, we have more control over the versions of the optional packages.  Also, nothing prevents you from running in a shell (either a Sage shell or not):

```
$ kash
```
It's as easy as that.

> My point is simple : from a sage-whatever-beta_n to sage-whatever-beta_{n+1}, 90% of the spkg are the same. So if I could make foo-3.14.spkg install in $HOME/sage/foo-3.14 and make the rest of sage use that (this is modularity -- the contrary of a one-block where nothing can move an hair's width without everything collapsing), then that means I can gain 90% of build time. And I have the room to have more versions of sage installed simultaneously.

You could play with environment variables to solve this: apply patch #12647 and write in your `.sage/sagerc`:

```
export PATH="$PATH:$HOME/sage/foo-3.14/local/bin"
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:$HOME/sage/foo-3.14/local/lib"
```
or something like this.



---

archive/issue_comments_181828.json:
```json
{
    "body": "<a id='comment:18'></a>\n1. the .sagerc trick depends on setting PATH, but my point is precisely that spkg/bin/sage doesn't use PATH, but instead points directly to where it insists things must be (one of my dirty definitely-not-for-upstream patch was precisely modifying sage-env to set PATH, LD_LIBRARY_PATH and the rest...) ;\n   2. \"test -x\" is nice when you know exactly where things must be ; but if they can be in another place, then that doesn't fly. \"command -v\" is portable and will find things in PATH.",
    "created_at": "2012-03-19T09:05:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181828",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:18'></a>
1. the .sagerc trick depends on setting PATH, but my point is precisely that spkg/bin/sage doesn't use PATH, but instead points directly to where it insists things must be (one of my dirty definitely-not-for-upstream patch was precisely modifying sage-env to set PATH, LD_LIBRARY_PATH and the rest...) ;
   2. "test -x" is nice when you know exactly where things must be ; but if they can be in another place, then that doesn't fly. "command -v" is portable and will find things in PATH.



---

archive/issue_comments_181829.json:
```json
{
    "body": "<a id='comment:19'></a>\nWhy do you **insist** on running\n\n```\nsage --kash\n```\nas opposed to\n\n```\nkash\n```",
    "created_at": "2012-03-19T09:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181829",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
Why do you **insist** on running

```
sage --kash
```
as opposed to

```
kash
```



---

archive/issue_comments_181830.json:
```json
{
    "body": "<a id='comment:20'></a>\nI don't insist on running \"sage --kash\".\n\nI ran \"make ptestlong\" and it tried to run things using \"sage --something\".\n\nKash wasn't the problem ; I don't remember if it was ecl or scons... or something else... Of course the test failed : even though I made sure in sage-env it had what it takes in the PATH, the script didn't even see it!\n\nI claim sage-as-it-is is broken because it can't accept a small change in a place without breaking in an unrelated place for no serious reason.\n\nMy patch doesn't break sage-as-it-is, and makes it more easy to modify in the future: tomorrow, you'll decide to put the executables in $SAGE/whatever/bin instead of $SAGE_LOCAL/bin. Of course, you'll modify sage-env to cope with the change. And it will still not work. Why? Because that script doesn't care about sage-env, it does it's own thing... and I claim that is wrong.\n\nMy patch makes it possible to change where sage finds executables in one sensible place instead of several.\n\nI'm not telling you: \"There is a theoretical issue, drop everything you do and work on it for me!\". I'm telling you : \"I made private changes, hit a practical issue, and even though you might not have met it yet, there's a chance you will, and here is a simple nice fix.\"\n\nDoes it sound that unreasonable?",
    "created_at": "2012-03-19T09:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181830",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:20'></a>
I don't insist on running "sage --kash".

I ran "make ptestlong" and it tried to run things using "sage --something".

Kash wasn't the problem ; I don't remember if it was ecl or scons... or something else... Of course the test failed : even though I made sure in sage-env it had what it takes in the PATH, the script didn't even see it!

I claim sage-as-it-is is broken because it can't accept a small change in a place without breaking in an unrelated place for no serious reason.

My patch doesn't break sage-as-it-is, and makes it more easy to modify in the future: tomorrow, you'll decide to put the executables in $SAGE/whatever/bin instead of $SAGE_LOCAL/bin. Of course, you'll modify sage-env to cope with the change. And it will still not work. Why? Because that script doesn't care about sage-env, it does it's own thing... and I claim that is wrong.

My patch makes it possible to change where sage finds executables in one sensible place instead of several.

I'm not telling you: "There is a theoretical issue, drop everything you do and work on it for me!". I'm telling you : "I made private changes, hit a practical issue, and even though you might not have met it yet, there's a chance you will, and here is a simple nice fix."

Does it sound that unreasonable?



---

archive/issue_comments_181831.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jdemeyer](#comment%3A17):\n> Replying to [Snark](#comment%3A16):\n> > First, you still mention \"test -x\" although I pointed out it's not the recommended way to check for an executable.\n\n\nThat's simply bu!**sh!**.  First of all, I did mention `command -v` as well, and more importantly, `test -x` and `command` have different use cases.  Nobody claimed that `command` wasn't portable; we use it in many places of Sage -- *where it is appropriate*.\n\n\n\n\n> You \"pointed out\" without saying why.  I think `test -x` is used perfectly here.\n\n\nIt is.\n\n\n\n\n> > Second, as I already pointed out, my patch makes sage run sage versions by default if available. And if not available in sage, if they are available on the system, use that. The only error case is the one where indeed, it is really not available.\n\n> As I (and leif, for once I agree with him)\n\n:-)\n\n> have said, sage --COMMAND is supposed to run the Sage version of COMMAND.\n\n\nAnd if `sage --PROGRAM` should run external versions at all, then the help messages would have to be changed as well, which your patch **doesn't**, although it changes the (btw. intuitive) behavior:\n\n```sh\n     echo \"  -kash [...]         -- run Sage's Kash with given arguments\"\n...\n     echo \"  -M2 [...]           -- run Sage's Macaulay2 with given arguments\"\n```\n\n(And if there happen to be system-wide versions along the path, there's no mention that Sage's optional packages could be installed [in case they aren't already].  People frequently have completely outdated, incompatible or broken versions installed -- sometimes even not to their knowledge, which is *one* reason Sage ships such a lot, or at least offers such components as optional packages.)  \n\n\n\n\n> > There seem to be a high dose of paranoia in sage developers about everything that doesn't come out of sage.\n\n\nSometimes for good reason; see above.\n\nAnd as mentioned, it's better to not blindly trust even the Sage installation itself, since its integrity is not necessarily an invariant, especially if users (and developers, which most people of the Sage community intentionally don't differentiate) \"play\" with it.",
    "created_at": "2012-03-19T17:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181831",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:21'></a>
Replying to [jdemeyer](#comment%3A17):
> Replying to [Snark](#comment%3A16):
> > First, you still mention "test -x" although I pointed out it's not the recommended way to check for an executable.


That's simply bu!**sh!**.  First of all, I did mention `command -v` as well, and more importantly, `test -x` and `command` have different use cases.  Nobody claimed that `command` wasn't portable; we use it in many places of Sage -- *where it is appropriate*.




> You "pointed out" without saying why.  I think `test -x` is used perfectly here.


It is.




> > Second, as I already pointed out, my patch makes sage run sage versions by default if available. And if not available in sage, if they are available on the system, use that. The only error case is the one where indeed, it is really not available.

> As I (and leif, for once I agree with him)

:-)

> have said, sage --COMMAND is supposed to run the Sage version of COMMAND.


And if `sage --PROGRAM` should run external versions at all, then the help messages would have to be changed as well, which your patch **doesn't**, although it changes the (btw. intuitive) behavior:

```sh
     echo "  -kash [...]         -- run Sage's Kash with given arguments"
...
     echo "  -M2 [...]           -- run Sage's Macaulay2 with given arguments"
```

(And if there happen to be system-wide versions along the path, there's no mention that Sage's optional packages could be installed [in case they aren't already].  People frequently have completely outdated, incompatible or broken versions installed -- sometimes even not to their knowledge, which is *one* reason Sage ships such a lot, or at least offers such components as optional packages.)  




> > There seem to be a high dose of paranoia in sage developers about everything that doesn't come out of sage.


Sometimes for good reason; see above.

And as mentioned, it's better to not blindly trust even the Sage installation itself, since its integrity is not necessarily an invariant, especially if users (and developers, which most people of the Sage community intentionally don't differentiate) "play" with it.



---

archive/issue_comments_181832.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [Snark](#comment%3A20):\n> I ran \"make ptestlong\" and it tried to run things using \"sage --something\".\n> \n> Kash wasn't the problem ; I don't remember if it was ecl or scons... or something else... Of course the test failed : even though I made sure in sage-env it had what it takes in the PATH, the script didn't even see it!\n> \n> I claim sage-as-it-is is broken because it can't accept a small change in a place without breaking in an unrelated place for no serious reason.\n\n\nNot in an \"unrelated place\", nor for no reason: `ptestlong` checks whether the installation went (or is still) ok, and testing whether programs installed by Sage *are* where they belong (or have been installed), and whether they work, is just part of that.\n\nIf you change their locations, you'd obviously also have to change these tests.",
    "created_at": "2012-03-19T17:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181832",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:22'></a>
Replying to [Snark](#comment%3A20):
> I ran "make ptestlong" and it tried to run things using "sage --something".
> 
> Kash wasn't the problem ; I don't remember if it was ecl or scons... or something else... Of course the test failed : even though I made sure in sage-env it had what it takes in the PATH, the script didn't even see it!
> 
> I claim sage-as-it-is is broken because it can't accept a small change in a place without breaking in an unrelated place for no serious reason.


Not in an "unrelated place", nor for no reason: `ptestlong` checks whether the installation went (or is still) ok, and testing whether programs installed by Sage *are* where they belong (or have been installed), and whether they work, is just part of that.

If you change their locations, you'd obviously also have to change these tests.



---

archive/issue_comments_181833.json:
```json
{
    "body": "<a id='comment:23'></a>\nOh, dear, that was the thing I missed to understand!\n\nOk, so when \"make ptestlong\" runs \"sage --something\", it really checks :\n1. things are at the right place ;\n2. things work ;\n3. things work correctly.\n\nI was only considering points 2 and 3 since the beginning! My patch does indeed break point 1.\n\nNow, I still think there are things to fix :\n1. checking that something was installed at the right place should be done by something.spkg, not in somewhere unrelated -- that will cover 1 where it should be covered ;\n2. and then my patch should be applied, because now the implicit constraint will be satisfied in an explicit way by a proper test somewhere.",
    "created_at": "2012-03-19T18:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181833",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:23'></a>
Oh, dear, that was the thing I missed to understand!

Ok, so when "make ptestlong" runs "sage --something", it really checks :
1. things are at the right place ;
2. things work ;
3. things work correctly.

I was only considering points 2 and 3 since the beginning! My patch does indeed break point 1.

Now, I still think there are things to fix :
1. checking that something was installed at the right place should be done by something.spkg, not in somewhere unrelated -- that will cover 1 where it should be covered ;
2. and then my patch should be applied, because now the implicit constraint will be satisfied in an explicit way by a proper test somewhere.



---

archive/issue_comments_181834.json:
```json
{
    "body": "<a id='comment:24'></a>\nHow about introducing `SAGE_BINARIES_PATH`? (to be optionally set by the user; containing a colon-separated list of directories to search for *Sage* programs and scripts)\n\n(`sage-env` would probably *pre*pend e.g. `\"$SAGE_LOCAL/bin:\"` if `SAGE_BINARIES_PATH` is non-empty, otherwise set it to the former.)\n\nThen we could use (logically)\n\n```sh\nPATH=\"$SAGE_BINARIES_PATH\" command -v FOO >/dev/null || echo \"Sage's FOO is not installed...\"\n```\nor\n\n```sh\nPATH=\"$SAGE_BINARIES_PATH\" command FOO\n# exit status 127 would (usually) tell that FOO wasn't found (along $SAGE_BINARIES_PATH)\n```\nand similar.\n\nA potential problem being that FOO would inherit the modified `PATH` in the second example; we could therefore also use\n\n```sh\nprog=`PATH=\"$SAGE_BINARIES_PATH\" command -v FOO`\nif [[ -z $prog ]]; then\n    # FOO isn't installed anywhere along $SAGE_BINARIES_PATH\nelse\n    # found; for example run FOO:\n    $prog\nfi\n```\n\n\n\n\nBetter names appreciated.  `SAGE_PATH` is unfortunately already used for a slightly different purpose.",
    "created_at": "2012-03-19T19:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181834",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:24'></a>
How about introducing `SAGE_BINARIES_PATH`? (to be optionally set by the user; containing a colon-separated list of directories to search for *Sage* programs and scripts)

(`sage-env` would probably *pre*pend e.g. `"$SAGE_LOCAL/bin:"` if `SAGE_BINARIES_PATH` is non-empty, otherwise set it to the former.)

Then we could use (logically)

```sh
PATH="$SAGE_BINARIES_PATH" command -v FOO >/dev/null || echo "Sage's FOO is not installed..."
```
or

```sh
PATH="$SAGE_BINARIES_PATH" command FOO
# exit status 127 would (usually) tell that FOO wasn't found (along $SAGE_BINARIES_PATH)
```
and similar.

A potential problem being that FOO would inherit the modified `PATH` in the second example; we could therefore also use

```sh
prog=`PATH="$SAGE_BINARIES_PATH" command -v FOO`
if [[ -z $prog ]]; then
    # FOO isn't installed anywhere along $SAGE_BINARIES_PATH
else
    # found; for example run FOO:
    $prog
fi
```




Better names appreciated.  `SAGE_PATH` is unfortunately already used for a slightly different purpose.



---

archive/issue_comments_181835.json:
```json
{
    "body": "<a id='comment:25'></a>\nI'm not sure the idea is that neat, but SAGE_EXEC_PATH could be a better name for it ;-)\n\n\"PATH\" does it already... doesn't it?",
    "created_at": "2012-03-19T19:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181835",
    "user": "https://trac.sagemath.org/admin/accounts/users/Snark"
}
```

<a id='comment:25'></a>
I'm not sure the idea is that neat, but SAGE_EXEC_PATH could be a better name for it ;-)

"PATH" does it already... doesn't it?



---

archive/issue_comments_181836.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [Snark](#comment%3A25):\n> \"PATH\" does it already... doesn't it?\n\n\n`PATH` contains arbitrary things... (and we still don't want to remove parts from it ;-) )",
    "created_at": "2012-03-19T19:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181836",
    "user": "https://github.com/nexttime"
}
```

<a id='comment:26'></a>
Replying to [Snark](#comment%3A25):
> "PATH" does it already... doesn't it?


`PATH` contains arbitrary things... (and we still don't want to remove parts from it ;-) )



---

archive/issue_comments_181837.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe build system proposed in http://wiki.sagemath.org/BuildSystemSEP (#14796), provides options to disable packages (and falling back to already installed things outside of sage). also sage (the library) needs to work without the distribution.\n\nFinally, under some circumstances, sage --PROGRAM needs to just use plain $PATH. And it always should.\n\nSo lets solve this problem at its root:\n* sage (the distribution) places a dummy into $SAGE_LOCAL/bin/p for all enabled packages p, if such a file doesnt exist (or more dummies if needed)\n* installation of a package will replace these dummies\n* sage (the distribution) clears these dummies upon disabling a package (which also triggers uninstall)\n* sage (the environment) just sets PATH=$(SAGE_LOCAL)/bin:$PATH (as it currently does)\n* sage (the library) works outside sage (the distribution) without headache\n\nTo deal with even more paranoia, sage (the distribution) could also include a list of header and library locations for each package. Placed in a similar way, respective files could make sure gcc won't fall back to /usr/include or /usr/lib without your consent.",
    "created_at": "2013-06-22T22:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181837",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

<a id='comment:28'></a>
The build system proposed in http://wiki.sagemath.org/BuildSystemSEP (#14796), provides options to disable packages (and falling back to already installed things outside of sage). also sage (the library) needs to work without the distribution.

Finally, under some circumstances, sage --PROGRAM needs to just use plain $PATH. And it always should.

So lets solve this problem at its root:
* sage (the distribution) places a dummy into $SAGE_LOCAL/bin/p for all enabled packages p, if such a file doesnt exist (or more dummies if needed)
* installation of a package will replace these dummies
* sage (the distribution) clears these dummies upon disabling a package (which also triggers uninstall)
* sage (the environment) just sets PATH=$(SAGE_LOCAL)/bin:$PATH (as it currently does)
* sage (the library) works outside sage (the distribution) without headache

To deal with even more paranoia, sage (the distribution) could also include a list of header and library locations for each package. Placed in a similar way, respective files could make sure gcc won't fall back to /usr/include or /usr/lib without your consent.



---

archive/issue_comments_181838.json:
```json
{
    "body": "<a id='comment:29'></a>\nThis is now implemented in #14796 (Component: 'build'). Here, Sage (the distribution) creates/removes dummies depending on how it is configured. `$PATH` is made to contain `SAGE_LOCAL/bin`, `PATH where the dummies are`, `the system PATH` in that order.\n\nWith this mechanism, `sage --PROGRAM` may safely use `$PATH` without accidentally running into system executables from within sage (the distribution).",
    "created_at": "2013-08-09T10:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181838",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

<a id='comment:29'></a>
This is now implemented in #14796 (Component: 'build'). Here, Sage (the distribution) creates/removes dummies depending on how it is configured. `$PATH` is made to contain `SAGE_LOCAL/bin`, `PATH where the dummies are`, `the system PATH` in that order.

With this mechanism, `sage --PROGRAM` may safely use `$PATH` without accidentally running into system executables from within sage (the distribution).



---

archive/issue_events_034206.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12627#event-34206"
}
```



---

archive/issue_comments_181839.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-11-26T19:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181839",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_181840.json:
```json
{
    "body": "<a id='comment:32'></a>\nPlease rebase this:\n\n```\n(sage-sh) Nav1ZWFD@compute4a:bin$ hg import trac-12627.patch\napplying trac-12627.patch\npatching file spkg/bin/sage\nHunk #2 FAILED at 265\nHunk #3 FAILED at 367\nHunk #4 FAILED at 402\nHunk #5 FAILED at 430\nHunk #6 FAILED at 465\nHunk #7 FAILED at 548\n6 out of 7 hunks FAILED -- saving rejects to file spkg/bin/sage.rej\nabort: patch failed to apply\n```\n\nThere's exec's at the beginning of many of the lines in sage, which cause the patch to be rejected.  Otherwise, I think this should go into Sage soon-ish, since the change makes sense, and will help with the OS X port ticket (e.g., because there we use the system-wide sqlite3, but we still want `sage --sqlite3` to be portable and work).",
    "created_at": "2013-11-26T19:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181840",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:32'></a>
Please rebase this:

```
(sage-sh) Nav1ZWFD@compute4a:bin$ hg import trac-12627.patch
applying trac-12627.patch
patching file spkg/bin/sage
Hunk #2 FAILED at 265
Hunk #3 FAILED at 367
Hunk #4 FAILED at 402
Hunk #5 FAILED at 430
Hunk #6 FAILED at 465
Hunk #7 FAILED at 548
6 out of 7 hunks FAILED -- saving rejects to file spkg/bin/sage.rej
abort: patch failed to apply
```

There's exec's at the beginning of many of the lines in sage, which cause the patch to be rejected.  Otherwise, I think this should go into Sage soon-ish, since the change makes sense, and will help with the OS X port ticket (e.g., because there we use the system-wide sqlite3, but we still want `sage --sqlite3` to be portable and work).



---

archive/issue_comments_181841.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-11-26T19:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181841",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_181842.json:
```json
{
    "body": "<a id='comment:34'></a>\nThere are disagreements about whether the changes here make sense, and I'm not even sure what the status of this ticket is. Is it subsumed by #14796? I'll post a suggestion about sqlite3 to #15433.",
    "created_at": "2013-11-26T19:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181842",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>
There are disagreements about whether the changes here make sense, and I'm not even sure what the status of this ticket is. Is it subsumed by #14796? I'll post a suggestion about sqlite3 to #15433.



---

archive/issue_comments_181843.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [jhpalmieri](#comment%3A34):\n> Is it subsumed by #14796?\n\n\nyes, in #14796, '$PATH' is used to locate executables. it is a good idea to to so, whether or not a dummy wall or a configuarable toplevel build system exists.\n\n... and while you/someone are/is at it: the code may be reworded to\n\n```\narg=${1/--/-}\ncase $arg in\n    -axiom|-combinat|-gap|-gp|-singular|-sqlite3|-twistd|-ecl|\\\n    -kash|-maxima|-mwrank|-M2|-scons|-python|-ipython|-R)\n        shift\n        exec \"${arg#-}\" \"$@\"\n    ;;\n    -lisp)\n        shift\n        exec \"ecl\" \"$@\"\n    ;;\nesac\n```\n, so it will even fit on a single screen.",
    "created_at": "2013-11-26T19:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181843",
    "user": "https://trac.sagemath.org/admin/accounts/users/felixs"
}
```

<a id='comment:35'></a>
Replying to [jhpalmieri](#comment%3A34):
> Is it subsumed by #14796?


yes, in #14796, '$PATH' is used to locate executables. it is a good idea to to so, whether or not a dummy wall or a configuarable toplevel build system exists.

... and while you/someone are/is at it: the code may be reworded to

```
arg=${1/--/-}
case $arg in
    -axiom|-combinat|-gap|-gp|-singular|-sqlite3|-twistd|-ecl|\
    -kash|-maxima|-mwrank|-M2|-scons|-python|-ipython|-R)
        shift
        exec "${arg#-}" "$@"
    ;;
    -lisp)
        shift
        exec "ecl" "$@"
    ;;
esac
```
, so it will even fit on a single screen.



---

archive/issue_comments_181844.json:
```json
{
    "body": "<a id='comment:36'></a>\nNew commits:\n|                                                                                                         |                                         |\n|---------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[44c4cf1](http://git.sagemath.org/sage.git/commit/?id=44c4cf1)|Use foo from path when running sage --foo|",
    "created_at": "2013-11-26T19:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181844",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:36'></a>
New commits:
|                                                                                                         |                                         |
|---------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[44c4cf1](http://git.sagemath.org/sage.git/commit/?id=44c4cf1)|Use foo from path when running sage --foo|



---

archive/issue_comments_181845.json:
```json
{
    "body": "Changing commit from \"\" to \"44c4cf1d27b8562200c5b1978d29ad7b70b2f687\"",
    "created_at": "2013-11-26T19:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181845",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "" to "44c4cf1d27b8562200c5b1978d29ad7b70b2f687"



---

archive/issue_comments_181846.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vbraun/use_path_for_binaries\"",
    "created_at": "2013-11-26T19:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181846",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "" to "u/vbraun/use_path_for_binaries"



---

archive/issue_comments_181847.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-11-26T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181847",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_181848.json:
```json
{
    "body": "<a id='comment:37'></a>\nIMHO the whole `sage -foo` script is a mistake. If you want to use Sage's version of binaries, you put them into your path, should be as easy as that. Of course this assumes proper rpaths for libraries instead of the `LD_LIBRARY_PATH` hack.\n\nIn any case, until then we should just implement the proposed workaround.",
    "created_at": "2013-11-26T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181848",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:37'></a>
IMHO the whole `sage -foo` script is a mistake. If you want to use Sage's version of binaries, you put them into your path, should be as easy as that. Of course this assumes proper rpaths for libraries instead of the `LD_LIBRARY_PATH` hack.

In any case, until then we should just implement the proposed workaround.



---

archive/issue_comments_181849.json:
```json
{
    "body": "Changing author from \"Julien Puydt\" to \"Julien Puydt, Volker Braun\"",
    "created_at": "2013-11-26T20:25:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181849",
    "user": "https://github.com/vbraun"
}
```

Changing author from "Julien Puydt" to "Julien Puydt, Volker Braun"



---

archive/issue_comments_181850.json:
```json
{
    "body": "<a id='comment:38'></a>\nPasses doctests.",
    "created_at": "2013-11-26T21:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181850",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>
Passes doctests.



---

archive/issue_comments_181851.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-11-26T21:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181851",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_034207.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-27T15:34:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12627#event-34207"
}
```



---

archive/issue_events_034208.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-11-27T15:34:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "milestone": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12627#event-34208"
}
```



---

archive/issue_events_034209.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "milestone": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12627#event-34209"
}
```



---

archive/issue_events_034210.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12627#event-34210"
}
```



---

archive/issue_comments_181852.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-17T19:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181852",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_034211.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-17T19:55:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12627#event-34211"
}
```



---

archive/issue_comments_181853.json:
```json
{
    "body": "<a id='comment:42'></a>\n- if you run `sage --kash`, should it run a system version of kash if Sage's optional kash spkg hasn't been installed, or not?\n\nDWIM (http://en.wikipedia.org/wiki/DWIM) is pretty unambiguous here. Having typed that command, do I want kash to run or do I want to get some obscure error even though kash is actually on my computer?\n\n- in the old version there was some redundancy: the path to `gap`, for example, was explicit, to make sure that Sage's version of GAP was used. Is this redundancy important?\n\nThats really just a corollary to the first point---we should make the best effort to get gap up and running, otherwise our user interface is crap.\n\n- the message for `sage --help` says that `sage --M2` (for example) runs \"Sage's Macaulay2\", but this is no longer accurate with the current patch.\n\nThis is now #15538",
    "created_at": "2013-12-17T20:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12627",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12627#issuecomment-181853",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:42'></a>
- if you run `sage --kash`, should it run a system version of kash if Sage's optional kash spkg hasn't been installed, or not?

DWIM (http://en.wikipedia.org/wiki/DWIM) is pretty unambiguous here. Having typed that command, do I want kash to run or do I want to get some obscure error even though kash is actually on my computer?

- in the old version there was some redundancy: the path to `gap`, for example, was explicit, to make sure that Sage's version of GAP was used. Is this redundancy important?

Thats really just a corollary to the first point---we should make the best effort to get gap up and running, otherwise our user interface is crap.

- the message for `sage --help` says that `sage --M2` (for example) runs "Sage's Macaulay2", but this is no longer accurate with the current patch.

This is now #15538
