# Issue 12248: Do not run "make -q" when upgrading

archive/issues_012076.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-GeorgSWeber"
    ],
    "body": "The script `spkg/install` contains the lines\n\n```\n# Skip the rest if nothing to do (i.e., to [re]build):\n# If \"make\" doesn't understand the -q option (although we require\n# GNU make, which supports it), it should exit with a non-zero status\n# which is not a problem.\nif ${MAKE:-make} -q -f standard/deps $1; then\n    echo \"Nothing to (re)build / all up-to-date.\"\n    exit 0\nfi\n```\n\nThis runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  This changed recently, before #12016 `make -q` didn't run `sage-spkg`.\n\nWhen upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build errors (only visible in the log files), for example in `spkg/logs/patch-2.5.9.p2.log`.\n\nThis is a problem introduced by #12016.\n\nKeywords: **sd35.5**\n\nComponent: **build**\n\nAuthor: **Jeroen Demeyer**\n\nReviewer: **John Palmieri, Volker Braun**\n\nMerged: **sage-4.8.rc0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12248_\n\n",
    "closed_at": "2012-01-11T09:57:46Z",
    "created_at": "2012-01-02T19:48:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Do not run \"make -q\" when upgrading",
    "type": "issue",
    "updated_at": "2012-01-11T09:57:46Z",
    "url": "https://github.com/sagemath/sage/issues/12248",
    "user": "https://github.com/jdemeyer"
}
```
The script `spkg/install` contains the lines

```
# Skip the rest if nothing to do (i.e., to [re]build):
# If "make" doesn't understand the -q option (although we require
# GNU make, which supports it), it should exit with a non-zero status
# which is not a problem.
if ${MAKE:-make} -q -f standard/deps $1; then
    echo "Nothing to (re)build / all up-to-date."
    exit 0
fi
```

This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  This changed recently, before #12016 `make -q` didn't run `sage-spkg`.

When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build errors (only visible in the log files), for example in `spkg/logs/patch-2.5.9.p2.log`.

This is a problem introduced by #12016.

Keywords: **sd35.5**

Component: **build**

Author: **Jeroen Demeyer**

Reviewer: **John Palmieri, Volker Braun**

Merged: **sage-4.8.rc0**

_Issue created by migration from https://trac.sagemath.org/ticket/12248_





---

archive/issue_events_166657.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-02T19:48:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "milestone_number": null,
    "milestone_title": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166657"
}
```



---

archive/issue_events_166658.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-02T19:48:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166658"
}
```



---

archive/issue_events_166659.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-02T19:48:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166659"
}
```



---

archive/issue_events_166660.json:
```json
{
    "actor": "https://github.com/sagetrac-GeorgSWeber",
    "created_at": "2012-01-02T19:48:05Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166660"
}
```



---

archive/issue_events_166661.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-02T19:48:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166661"
}
```



---

archive/issue_comments_132567.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2012-01-04T22:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132567",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_132568.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,4 @@\n fi\n ```\n \n-This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.\n+This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.\n``````\n",
    "created_at": "2012-01-04T22:29:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132568",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,4 @@
 fi
 ```
 
-This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.
+This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.
``````




---

archive/issue_comments_132569.json:
```json
{
    "body": "Attachment: **[12248_make_q.patch.gz](https://github.com/sagemath/sage/files/ticket12248/12248_make_q.patch.gz)**",
    "created_at": "2012-01-04T22:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132569",
    "user": "https://github.com/jdemeyer"
}
```

Attachment: **[12248_make_q.patch.gz](https://github.com/sagemath/sage/files/ticket12248/12248_make_q.patch.gz)**



---

archive/issue_events_166662.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-05T07:53:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166662"
}
```



---

archive/issue_comments_132570.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,4 +11,6 @@\n fi\n ```\n \n-This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.\n+This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  This changed recently, before #12016 `make -q` didn't run `sage-spkg`.\n+\n+When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.\n``````\n",
    "created_at": "2012-01-05T14:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132570",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,4 +11,6 @@
 fi
 ```
 
-This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.
+This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  This changed recently, before #12016 `make -q` didn't run `sage-spkg`.
+
+When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.
``````




---

archive/issue_comments_132571.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSuccessfully tested building from scratch and upgrading from sage-4.5.1.",
    "created_at": "2012-01-05T14:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132571",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Successfully tested building from scratch and upgrading from sage-4.5.1.



---

archive/issue_comments_132572.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWhy did #12016 cause this?  Is it because of all of the plus signs in spkg/standard/deps?",
    "created_at": "2012-01-06T02:13:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132572",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

Why did #12016 cause this?  Is it because of all of the plus signs in spkg/standard/deps?



---

archive/issue_comments_132573.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nUnless I made a mistake, I was able to upgrade from 4.4 and 4.5.3 to Sage 4.8.alpha6 plus #9958 and its prerequisites (since that's what I was looking at earlier).  I was also able to upgrade after applying the patch here.  The patch looks okay to me, but I'm not sure it should be a blocker.",
    "created_at": "2012-01-06T03:27:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132573",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Unless I made a mistake, I was able to upgrade from 4.4 and 4.5.3 to Sage 4.8.alpha6 plus #9958 and its prerequisites (since that's what I was looking at earlier).  I was also able to upgrade after applying the patch here.  The patch looks okay to me, but I'm not sure it should be a blocker.



---

archive/issue_comments_132574.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,4 +13,6 @@\n \n This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  This changed recently, before #12016 `make -q` didn't run `sage-spkg`.\n \n-When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.\n+When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build errors (only visible in the log files), for example in `spkg/logs/patch-2.5.9.p2.log`.\n+\n+This is a problem introduced by #12016.\n``````\n",
    "created_at": "2012-01-06T08:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132574",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,4 +13,6 @@
 
 This runs `make` with the `-q` option, which (via the makefile `spkg/standard/deps`) in turn runs `sage-spkg`.  This changed recently, before #12016 `make -q` didn't run `sage-spkg`.
 
-When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build failures.  This is a problem introduced by #12016.
+When upgrading, the file `sage-spkg` is not automatically upgraded, so we can have an old `sage-spkg` which does not understand the `-q` option which causes build errors (only visible in the log files), for example in `spkg/logs/patch-2.5.9.p2.log`.
+
+This is a problem introduced by #12016.
``````




---

archive/issue_comments_132575.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jhpalmieri](#comment:6):\n> Why did #12016 cause this?  Is it because of all of the plus signs in spkg/standard/deps?\n\nYes.  Those plus signs mark a make rule as recursive.\n\nReplying to [@jhpalmieri](#comment:7):\n> Unless I made a mistake, I was able to upgrade from 4.4 and 4.5.3 to Sage 4.8.alpha6 plus #9958 and its prerequisites (since that's what I was looking at earlier).  I was also able to upgrade after applying the patch here.\n\nPerhaps I should have been more clear.  The upgrade might work without this patch, but you will see a failed build attempt for example in `spkg/logs/patch-2.5.9.p2.log`.",
    "created_at": "2012-01-06T08:23:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132575",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jhpalmieri](#comment:6):
> Why did #12016 cause this?  Is it because of all of the plus signs in spkg/standard/deps?

Yes.  Those plus signs mark a make rule as recursive.

Replying to [@jhpalmieri](#comment:7):
> Unless I made a mistake, I was able to upgrade from 4.4 and 4.5.3 to Sage 4.8.alpha6 plus #9958 and its prerequisites (since that's what I was looking at earlier).  I was also able to upgrade after applying the patch here.

Perhaps I should have been more clear.  The upgrade might work without this patch, but you will see a failed build attempt for example in `spkg/logs/patch-2.5.9.p2.log`.



---

archive/issue_comments_132576.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jhpalmieri](#comment:7):\n> The patch looks okay to me\n\nMeaning \"positive review\"?\n\n> I'm not sure it should be a blocker.\n\nI disagree since it causes non-fatal build errors.  Seeing a scary message \"An error occured... please contact sage-devel...\" isn't good.  Besides, this might possibly lead to an actual build failure.",
    "created_at": "2012-01-06T11:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132576",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jhpalmieri](#comment:7):
> The patch looks okay to me

Meaning "positive review"?

> I'm not sure it should be a blocker.

I disagree since it causes non-fatal build errors.  Seeing a scary message "An error occured... please contact sage-devel..." isn't good.  Besides, this might possibly lead to an actual build failure.



---

archive/issue_comments_132577.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2012-01-06T11:15:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132577",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_166663.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-01-09T15:23:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166663"
}
```



---

archive/issue_events_166664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2012-01-09T15:23:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166664"
}
```



---

archive/issue_comments_132578.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nLooks good to me!",
    "created_at": "2012-01-09T15:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132578",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:10" align="right">comment:10</div>

Looks good to me!



---

archive/issue_comments_132579.json:
```json
{
    "body": "Changed reviewer from **John Palmieri** to **John Palmieri, Volker Braun**",
    "created_at": "2012-01-09T15:23:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132579",
    "user": "https://github.com/vbraun"
}
```

Changed reviewer from **John Palmieri** to **John Palmieri, Volker Braun**



---

archive/issue_comments_132580.json:
```json
{
    "body": "Changed keywords from none to **sd35.5**",
    "created_at": "2012-01-09T15:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132580",
    "user": "https://github.com/vbraun"
}
```

Changed keywords from none to **sd35.5**



---

archive/issue_comments_132581.json:
```json
{
    "body": "Merged: **sage-4.8.rc0**",
    "created_at": "2012-01-11T09:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12248#issuecomment-132581",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-4.8.rc0**



---

archive/issue_events_166665.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-11T09:57:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166665"
}
```



---

archive/issue_events_166666.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-11T09:57:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12248",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12248#event-166666"
}
```
