# Issue 12181: random_DAG does not terminate on it's default inputs

archive/issues_012009.json:
```json
{
    "body": "Try:\n\n```\nrandom_DAG(5)\n```\n\nit will run forever!\n\napply only trac_12181_random_dag-fc.patch\n\nAssignee: tbd\n\nKeywords: random digraph\n\nReviewer: David Coudert\n\nAuthor: Douglas McNeil, Fr\u00e9d\u00e9ric Chapoton\n\nMerged: sage-5.3.beta2\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12181\n\n",
    "closed_at": "2012-08-14T07:02:37Z",
    "created_at": "2011-12-18T16:02:41Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.3",
    "title": "random_DAG does not terminate on it's default inputs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12181",
    "user": "https://github.com/koffie"
}
```
Try:

```
random_DAG(5)
```

it will run forever!

apply only trac_12181_random_dag-fc.patch

Assignee: tbd

Keywords: random digraph

Reviewer: David Coudert

Author: Douglas McNeil, Frédéric Chapoton

Merged: sage-5.3.beta2

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12181





---

archive/issue_comments_170498.json:
```json
{
    "body": "Replying to [ticket:12181 mderickx]:\n> Try:\n> \n> \n> ```\n> random_DAG(5)\n> ```\n> \n> it will run forever!",
    "created_at": "2011-12-19T02:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170498",
    "user": "https://trac.sagemath.org/admin/accounts/users/bbanu"
}
```

Replying to [ticket:12181 mderickx]:
> Try:
> 
> 
> ```
> random_DAG(5)
> ```
> 
> it will run forever!



---

archive/issue_comments_170499.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,17 @@\n \n it will run forever!\n \n+It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n+   4904             for j in range(i):\n+-> 4905                 if p > random():\n+This is the same behavior as \n+\n+```\n+random_DAG(5, 0)\n+```\n+\n+It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.\n+\n Comment: description.1\n \n Component: PLEASE CHANGE\n``````\n",
    "created_at": "2011-12-19T02:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170499",
    "user": "https://trac.sagemath.org/admin/accounts/users/bbanu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,17 @@
 
 it will run forever!
 
+It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at
+   4904             for j in range(i):
+-> 4905                 if p > random():
+This is the same behavior as 
+
+```
+random_DAG(5, 0)
+```
+
+It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.
+
 Comment: description.1
 
 Component: PLEASE CHANGE
``````




---

archive/issue_comments_170500.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+Try:\n \n+```\n+random_DAG(5)\n+```\n+\n+it will run forever!\n \n Comment: description.1\n \n``````\n",
    "created_at": "2011-12-19T02:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170500",
    "user": "https://trac.sagemath.org/admin/accounts/users/bbanu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+Try:
 
+```
+random_DAG(5)
+```
+
+it will run forever!
 
 Comment: description.1
 
``````




---

archive/issue_comments_170501.json:
```json
{
    "body": "Replying to [ticket:12181 mderickx]:\n> Try:\n> \n> \n> ```\n> random_DAG(5)\n> ```\n> \n> it will run forever!\n> \n> It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n>    4904             for j in range(i):\n> -> 4905                 if p > random():\n> This is the same behavior as \n> \n> ```\n> random_DAG(5, 0)\n> ```\n> \n> It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.",
    "created_at": "2011-12-19T02:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170501",
    "user": "https://trac.sagemath.org/admin/accounts/users/bbanu"
}
```

Replying to [ticket:12181 mderickx]:
> Try:
> 
> 
> ```
> random_DAG(5)
> ```
> 
> it will run forever!
> 
> It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at
>    4904             for j in range(i):
> -> 4905                 if p > random():
> This is the same behavior as 
> 
> ```
> random_DAG(5, 0)
> ```
> 
> It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.



---

archive/issue_comments_170502.json:
```json
{
    "body": "<a id='comment:3'></a>It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n\n   4904             for j in range(i):\n-> 4905                 if p > random():\n\nThis is the same behavior as \n\n```\nrandom_DAG(5, 0)\n```\n\nIt appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.",
    "created_at": "2011-12-19T02:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170502",
    "user": "https://trac.sagemath.org/admin/accounts/users/bbanu"
}
```

<a id='comment:3'></a>It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at

   4904             for j in range(i):
-> 4905                 if p > random():

This is the same behavior as 

```
random_DAG(5, 0)
```

It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.



---

archive/issue_comments_170503.json:
```json
{
    "body": "<a id='comment:4'></a>even the following runs forever:\n\n```\nsage: random_DAG(1)\n```\nPaul",
    "created_at": "2011-12-19T11:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170503",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'></a>even the following runs forever:

```
sage: random_DAG(1)
```
Paul



---

archive/issue_comments_170504.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-13T07:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170504",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_170505.json:
```json
{
    "body": "<a id='comment:5'></a>random_digraph had the same issue (as did, to a lesser degree, one of the positioning dictionaries.)  Patch attached.",
    "created_at": "2012-02-13T07:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170505",
    "user": "https://trac.sagemath.org/admin/accounts/users/dsm"
}
```

<a id='comment:5'></a>random_digraph had the same issue (as did, to a lesser degree, one of the positioning dictionaries.)  Patch attached.



---

archive/issue_comments_170506.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2012-04-30T11:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170506",
    "user": "https://github.com/fchapoton"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_170507.json:
```json
{
    "body": "Changing keywords from \"\" to \"random digraph\".",
    "created_at": "2012-04-30T11:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170507",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "random digraph".



---

archive/issue_comments_170508.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-04-30T15:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170508",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_170509.json:
```json
{
    "body": "<a id='comment:7'></a>Can you please check what happens, with your patch applied, to the command\n\nsage: random_DAG(5,p=0)\n\nI suspect that the problem is not only the fact that 1/2=0, but also that the program fails when p=0.",
    "created_at": "2012-04-30T15:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170509",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>Can you please check what happens, with your patch applied, to the command

sage: random_DAG(5,p=0)

I suspect that the problem is not only the fact that 1/2=0, but also that the program fails when p=0.



---

archive/issue_comments_170510.json:
```json
{
    "body": "<a id='comment:8'></a>Indeed, the algorithm is an infinite loop when p=0.\n\nWhat behaviour should be expected for p=0 ?\n\nMaybe one should add an assumption : \n\nassert p>0 and p<1, \"The probability p=%s should satisfy 0<p<1.\" %p",
    "created_at": "2012-04-30T15:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170510",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Indeed, the algorithm is an infinite loop when p=0.

What behaviour should be expected for p=0 ?

Maybe one should add an assumption : 

assert p>0 and p<1, "The probability p=%s should satisfy 0<p<1." %p



---

archive/issue_comments_170511.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-06-05T18:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170511",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_170512.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-06-05T18:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170512",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_170513.json:
```json
{
    "body": "<a id='comment:11'></a>I have made a modified patch, which checks that p>0.\n\napply only trac_12181_random_dag-fc.patch",
    "created_at": "2012-06-08T13:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170513",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I have made a modified patch, which checks that p>0.

apply only trac_12181_random_dag-fc.patch



---

archive/issue_comments_170514.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Try:\n \n+```\n+random_DAG(5)\n+```\n+\n+it will run forever!\n+\n+apply only trac_12181_random_dag-fc.patch\n \n Comment: description.1\n \n``````\n",
    "created_at": "2012-06-08T13:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170514",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Try:
 
+```
+random_DAG(5)
+```
+
+it will run forever!
+
+apply only trac_12181_random_dag-fc.patch
 
 Comment: description.1
 
``````




---

archive/issue_comments_170515.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-06-08T13:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170515",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_032414.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T07:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12181#event-32414"
}
```



---

archive/issue_events_032415.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T13:40:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "milestone": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12181#event-32415"
}
```



---

archive/issue_events_032416.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T13:40:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "milestone": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12181#event-32416"
}
```



---

archive/issue_comments_170516.json:
```json
{
    "body": "Changing author from \"\" to \"dsm, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2012-07-10T13:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170516",
    "user": "https://github.com/fchapoton"
}
```

Changing author from "" to "dsm, Frédéric Chapoton"



---

archive/issue_comments_170517.json:
```json
{
    "body": "<a id='comment:14'></a>apply only trac_12181_random_dag-fc.2.patch\n\nnew patch, with better doc only",
    "created_at": "2012-07-23T12:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170517",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>apply only trac_12181_random_dag-fc.2.patch

new patch, with better doc only



---

archive/issue_comments_170518.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Try:\n \n+```\n+random_DAG(5)\n+```\n+\n+it will run forever!\n+\n+apply only trac_12181_random_dag-fc.2.patch\n \n Comment: description.1\n \n``````\n",
    "created_at": "2012-07-23T12:38:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170518",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Try:
 
+```
+random_DAG(5)
+```
+
+it will run forever!
+
+apply only trac_12181_random_dag-fc.2.patch
 
 Comment: description.1
 
``````




---

archive/issue_comments_170519.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-08-04T11:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170519",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_170520.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2012-08-04T11:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170520",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_170521.json:
```json
{
    "body": "<a id='comment:15'></a>Hello,\n\nThe patch needs further improvements.\n\n1) The test on p should be improved since I can give p=2 without error. For instance,\n\n```\nif p < 0 or p > 1:\n   raise ValueError('The parameter p must be in [0..1].')\n```\n\n2) A test is needed for parameter weight_max:\n\n```\nsage: random_DAG(5, .5, -1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\n...\nValueError: empty range for randrange() (1,0, -1)\n```\nand\n\n```\nsage: random_DAG(5, .5, .5)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\n...\nValueError: non-integer stop for randrange()\n```\n\n3) It should be clearly indicated in the documentation that the function returns a dictionary storing the edges of the DAG.\n\n4) The resulting number of vertices is not n but n+1:\n\n```\nsage: d = DiGraph(random_DAG(5, .5))\nsage: d\nDigraph on 6 vertices\n```\n\n5) I don't understand why this digraph generator is not part of ```sage.graphs.digraph_generators.py```. The function could have an optional parameter to return a dictionary instead of a digraph if relevant.",
    "created_at": "2012-08-04T11:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170521",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>Hello,

The patch needs further improvements.

1) The test on p should be improved since I can give p=2 without error. For instance,

```
if p < 0 or p > 1:
   raise ValueError('The parameter p must be in [0..1].')
```

2) A test is needed for parameter weight_max:

```
sage: random_DAG(5, .5, -1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
...
ValueError: empty range for randrange() (1,0, -1)
```
and

```
sage: random_DAG(5, .5, .5)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
...
ValueError: non-integer stop for randrange()
```

3) It should be clearly indicated in the documentation that the function returns a dictionary storing the edges of the DAG.

4) The resulting number of vertices is not n but n+1:

```
sage: d = DiGraph(random_DAG(5, .5))
sage: d
Digraph on 6 vertices
```

5) I don't understand why this digraph generator is not part of ```sage.graphs.digraph_generators.py```. The function could have an optional parameter to return a dictionary instead of a digraph if relevant.



---

archive/issue_comments_170522.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-04T18:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170522",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_170523.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Try:\n \n+```\n+random_DAG(5)\n+```\n+\n+it will run forever!\n+\n+apply only trac_12181_random_dag-fc.patch\n \n Comment: description.1\n \n``````\n",
    "created_at": "2012-08-04T18:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170523",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Try:
 
+```
+random_DAG(5)
+```
+
+it will run forever!
+
+apply only trac_12181_random_dag-fc.patch
 
 Comment: description.1
 
``````




---

archive/issue_comments_170524.json:
```json
{
    "body": "<a id='comment:16'></a>new patch. \n\nI have made all the required changes, except for the last point. It is certainly true that the procedure could be moved, and changed to return a digraph. I would rather let that for another ticket..\n\napply only trac_12181_random_dag-fc.patch",
    "created_at": "2012-08-04T18:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170524",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>new patch. 

I have made all the required changes, except for the last point. It is certainly true that the procedure could be moved, and changed to return a digraph. I would rather let that for another ticket..

apply only trac_12181_random_dag-fc.patch



---

archive/issue_comments_170525.json:
```json
{
    "body": "<a id='comment:17'></a>This is much better.\n\n- The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?\n\n```\nsage: random_DAG(5,.5,1.5)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: Attempt to coerce non-integral RealNumber to Integer\n```\n\n- The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.\n\n- I'm unable to build/find the documentation. Are you able to build it?\n\n- I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.",
    "created_at": "2012-08-04T23:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170525",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:17'></a>This is much better.

- The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?

```
sage: random_DAG(5,.5,1.5)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: Attempt to coerce non-integral RealNumber to Integer
```

- The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.

- I'm unable to build/find the documentation. Are you able to build it?

- I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.



---

archive/issue_comments_170526.json:
```json
{
    "body": "<a id='comment:18'></a>> - The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?\n> \n> ```\n> sage: random_DAG(5,.5,1.5)\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> ...\n> TypeError: Attempt to coerce non-integral RealNumber to Integer\n> ```\n\n\nYes, indeed. Well, this seems to be a reasonable way to ensure that the input is of correct type, as specified in the documentation. The problem is that one should accept both **int** and **Integers** as third argument. This is the case with what I have written, which tries to coerce to Integers.\n\n\n \n> - The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.\n\n\nWell, a dictionary of dictionaries is a dictionary, isn't it ? And by the way, I have not found any place in the sources of Sage where this procedure is used.\n\n\n> - I'm unable to build/find the documentation. Are you able to build it?\n\n\nSorry, I do not understand this remark. I have only tried the doc in a terminal. Should I try it in the notebook too ? Should I do something else ? Could you pinpoint a specific problem ?\n\n\n> - I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.\n\n\nWell, this ticket is here to solve a specific problem, and the rest can be postponed to some other ticket.",
    "created_at": "2012-08-05T07:48:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170526",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>> - The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?
> 
> ```
> sage: random_DAG(5,.5,1.5)
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> ...
> TypeError: Attempt to coerce non-integral RealNumber to Integer
> ```


Yes, indeed. Well, this seems to be a reasonable way to ensure that the input is of correct type, as specified in the documentation. The problem is that one should accept both **int** and **Integers** as third argument. This is the case with what I have written, which tries to coerce to Integers.


 
> - The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.


Well, a dictionary of dictionaries is a dictionary, isn't it ? And by the way, I have not found any place in the sources of Sage where this procedure is used.


> - I'm unable to build/find the documentation. Are you able to build it?


Sorry, I do not understand this remark. I have only tried the doc in a terminal. Should I try it in the notebook too ? Should I do something else ? Could you pinpoint a specific problem ?


> - I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.


Well, this ticket is here to solve a specific problem, and the rest can be postponed to some other ticket.



---

archive/issue_comments_170527.json:
```json
{
    "body": "<a id='comment:19'></a>There is now a mismatch between doc and tests : should we allow p to be equal to 1 or not ?",
    "created_at": "2012-08-05T09:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170527",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>There is now a mismatch between doc and tests : should we allow p to be equal to 1 or not ?



---

archive/issue_comments_170528.json:
```json
{
    "body": "<a id='comment:20'></a>That's right, you should change the test to\n\n```\nassert 0 < p and p <= 1, \"The parameter p must satisfy 0 < p <= 1.\"\n```\nYou don't have the change the rest of the code since the `random()` function returns a value strictly less than 1.\n\nConcerning the documentation. For (almost?) all modules, you can find the functions in the reference manual of sage (http://www.sagemath.org/doc/reference/). Then, when testing a patch, we use the command\n`sage -docbuild reference html`\nto build the reference manual including patch's changes. Same for `thematic_tutorials` if any.\n\nHowever, the sandpile model is not included in the reference manual.\nI have open a new ticket to address this issue (#13342).\n\n\nSo, you have to:\n- change the test on p\n- change the commit message of this patch. It is currently\n\n```\n#12181 bug in random digraphs with probability zero\n```\nIt should be something like\n\n```\ntrac #12181 -- Fix bugs with the input parameters of the random_DAG function\n```",
    "created_at": "2012-08-05T10:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170528",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:20'></a>That's right, you should change the test to

```
assert 0 < p and p <= 1, "The parameter p must satisfy 0 < p <= 1."
```
You don't have the change the rest of the code since the `random()` function returns a value strictly less than 1.

Concerning the documentation. For (almost?) all modules, you can find the functions in the reference manual of sage (http://www.sagemath.org/doc/reference/). Then, when testing a patch, we use the command
`sage -docbuild reference html`
to build the reference manual including patch's changes. Same for `thematic_tutorials` if any.

However, the sandpile model is not included in the reference manual.
I have open a new ticket to address this issue (#13342).


So, you have to:
- change the test on p
- change the commit message of this patch. It is currently

```
#12181 bug in random digraphs with probability zero
```
It should be something like

```
trac #12181 -- Fix bugs with the input parameters of the random_DAG function
```



---

archive/issue_comments_170529.json:
```json
{
    "body": "<a id='comment:21'></a>Changes done in the new version of the patch",
    "created_at": "2012-08-05T16:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170529",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>Changes done in the new version of the patch



---

archive/issue_comments_170530.json:
```json
{
    "body": "<a id='comment:22'></a>For me the patch is OK now.",
    "created_at": "2012-08-05T20:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170530",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'></a>For me the patch is OK now.



---

archive/issue_comments_170531.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-08-05T20:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170531",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_170532.json:
```json
{
    "body": "<a id='comment:23'></a>I strongly suggest against using `assert` statements for error checking (bad input should throw `ValueError`, not `AssertionError`). Also, add doctests for this bad input.",
    "created_at": "2012-08-06T13:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170532",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>I strongly suggest against using `assert` statements for error checking (bad input should throw `ValueError`, not `AssertionError`). Also, add doctests for this bad input.



---

archive/issue_comments_170533.json:
```json
{
    "body": "Changing author from \"dsm, Fr\u00e9d\u00e9ric Chapoton\" to \"Douglas McNeil, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2012-08-06T13:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170533",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "dsm, Frédéric Chapoton" to "Douglas McNeil, Frédéric Chapoton"



---

archive/issue_comments_170534.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-08-06T13:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170534",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_170535.json:
```json
{
    "body": "Attachment [trac_12181_random_dag-fc.patch](tarball://root/attachments/some-uuid/ticket12181/trac_12181_random_dag-fc.patch) by @fchapoton created at 2012-08-08 15:32:10",
    "created_at": "2012-08-08T15:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170535",
    "user": "https://github.com/fchapoton"
}
```

Attachment [trac_12181_random_dag-fc.patch](tarball://root/attachments/some-uuid/ticket12181/trac_12181_random_dag-fc.patch) by @fchapoton created at 2012-08-08 15:32:10



---

archive/issue_comments_170536.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-08T15:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170536",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_170537.json:
```json
{
    "body": "<a id='comment:24'></a>New patch, with suggested changes made.",
    "created_at": "2012-08-08T15:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170537",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>New patch, with suggested changes made.



---

archive/issue_comments_170538.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-08-08T23:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170538",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_170539.json:
```json
{
    "body": "<a id='comment:25'></a>For me the patch is fine (install, long tests, etc.).",
    "created_at": "2012-08-08T23:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170539",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:25'></a>For me the patch is fine (install, long tests, etc.).



---

archive/issue_comments_170540.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.3.beta2\"",
    "created_at": "2012-08-14T07:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170540",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.3.beta2"



---

archive/issue_comments_170541.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-08-14T07:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12181#issuecomment-170541",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_032417.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-14T07:02:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12181",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12181#event-32417"
}
```
