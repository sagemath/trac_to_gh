# Issue 12181: random_DAG does not terminate on it's default inputs

archive/issues_012009.json:
```json
{
    "assignees": [],
    "body": "Try:\n\n```\nrandom_DAG(5)\n```\n\nit will run forever!\n\napply only trac_12181_random_dag-fc.patch\n\nKeywords: **random digraph**\n\nReviewer: **David Coudert**\n\nAuthor: **Douglas McNeil, Fr\u00e9d\u00e9ric Chapoton**\n\nMerged: **sage-5.3.beta2**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12181_\n\n",
    "closed_at": "2012-08-14T07:02:37Z",
    "created_at": "2011-12-18T16:02:41Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "random_DAG does not terminate on it's default inputs",
    "type": "issue",
    "updated_at": "2012-08-14T07:02:37Z",
    "url": "https://github.com/sagemath/sage/issues/12181",
    "user": "https://github.com/koffie"
}
```
Try:

```
random_DAG(5)
```

it will run forever!

apply only trac_12181_random_dag-fc.patch

Keywords: **random digraph**

Reviewer: **David Coudert**

Author: **Douglas McNeil, Frédéric Chapoton**

Merged: **sage-5.3.beta2**

_Issue created by migration from https://trac.sagemath.org/ticket/12181_





---

archive/issue_events_151292.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-12-18T16:02:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151292"
}
```



---

archive/issue_events_151293.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-12-18T16:02:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151293"
}
```



---

archive/issue_events_151294.json:
```json
{
    "actor": "https://github.com/koffie",
    "created_at": "2011-12-18T16:02:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151294"
}
```



---

archive/issue_comments_133411.json:
```json
{
    "body": "Replying to [ticket:12181 mderickx]:\n> Try:\n> \n> ```\n> random_DAG(5)\n> ```\n> \n> it will run forever!",
    "created_at": "2011-12-19T02:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133411",
    "user": "https://github.com/sagetrac-bbanu"
}
```

Replying to [ticket:12181 mderickx]:
> Try:
> 
> ```
> random_DAG(5)
> ```
> 
> it will run forever!



---

archive/issue_comments_133412.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,14 @@\n ```\n \n it will run forever!\n+\n+It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n+   4904             for j in range(i):\n+-> 4905                 if p > random():\n+This is the same behavior as \n+\n+```\n+random_DAG(5, 0)\n+```\n+\n+It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.\n``````\n",
    "created_at": "2011-12-19T02:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133412",
    "user": "https://github.com/sagetrac-bbanu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,14 @@
 ```
 
 it will run forever!
+
+It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at
+   4904             for j in range(i):
+-> 4905                 if p > random():
+This is the same behavior as 
+
+```
+random_DAG(5, 0)
+```
+
+It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.
``````




---

archive/issue_comments_133413.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,14 +5,3 @@\n ```\n \n it will run forever!\n-\n-It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n-   4904             for j in range(i):\n--> 4905                 if p > random():\n-This is the same behavior as \n-\n-```\n-random_DAG(5, 0)\n-```\n-\n-It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.\n``````\n",
    "created_at": "2011-12-19T02:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133413",
    "user": "https://github.com/sagetrac-bbanu"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,14 +5,3 @@
 ```
 
 it will run forever!
-
-It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at
-   4904             for j in range(i):
--> 4905                 if p > random():
-This is the same behavior as 
-
-```
-random_DAG(5, 0)
-```
-
-It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.
``````




---

archive/issue_comments_133414.json:
```json
{
    "body": "Replying to [ticket:12181 mderickx]:\n> Try:\n> \n> ```\n> random_DAG(5)\n> ```\n> \n> it will run forever!\n> \n> It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n>    4904             for j in range(i):\n> -> 4905                 if p > random():\n> This is the same behavior as \n> \n> ```\n> random_DAG(5, 0)\n> ```\n> \n> It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.",
    "created_at": "2011-12-19T02:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133414",
    "user": "https://github.com/sagetrac-bbanu"
}
```

Replying to [ticket:12181 mderickx]:
> Try:
> 
> ```
> random_DAG(5)
> ```
> 
> it will run forever!
> 
> It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at
>    4904             for j in range(i):
> -> 4905                 if p > random():
> This is the same behavior as 
> 
> ```
> random_DAG(5, 0)
> ```
> 
> It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.



---

archive/issue_comments_133415.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nIt appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at\n\n   4904             for j in range(i):\n-> 4905                 if p > random():\n\nThis is the same behavior as \n\n```\nrandom_DAG(5, 0)\n```\n\nIt appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.",
    "created_at": "2011-12-19T02:44:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133415",
    "user": "https://github.com/sagetrac-bbanu"
}
```

<a id='comment:3'>Comment 3:</a>
It appears it is stuck in /local/lib/python2.6/site-packages/sage/sandpiles/sandpile.pyc at

   4904             for j in range(i):
-> 4905                 if p > random():

This is the same behavior as 

```
random_DAG(5, 0)
```

It appears p=1/2 from the definition of random_DAG is evaluated to 0 (so there are no possible connections), hence p = 0.5 should fix it.



---

archive/issue_comments_133416.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\neven the following runs forever:\n\n```\nsage: random_DAG(1)\n```\nPaul",
    "created_at": "2011-12-19T11:50:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133416",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:4'>Comment 4:</a>
even the following runs forever:

```
sage: random_DAG(1)
```
Paul



---

archive/issue_events_151295.json:
```json
{
    "actor": "https://github.com/sagetrac-dsm",
    "created_at": "2012-02-13T07:32:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151295"
}
```



---

archive/issue_comments_133417.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nrandom_digraph had the same issue (as did, to a lesser degree, one of the positioning dictionaries.)  Patch attached.",
    "created_at": "2012-02-13T07:32:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133417",
    "user": "https://github.com/sagetrac-dsm"
}
```

<a id='comment:5'>Comment 5:</a>
random_digraph had the same issue (as did, to a lesser degree, one of the positioning dictionaries.)  Patch attached.



---

archive/issue_events_151296.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-04-30T11:20:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151296"
}
```



---

archive/issue_comments_133418.json:
```json
{
    "body": "Changed keywords from **** to **random digraph**",
    "created_at": "2012-04-30T11:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133418",
    "user": "https://github.com/fchapoton"
}
```

Changed keywords from **** to **random digraph**



---

archive/issue_events_151297.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-04-30T15:08:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151297"
}
```



---

archive/issue_events_151298.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-04-30T15:08:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151298"
}
```



---

archive/issue_comments_133419.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nCan you please check what happens, with your patch applied, to the command\n\nsage: random_DAG(5,p=0)\n\nI suspect that the problem is not only the fact that 1/2=0, but also that the program fails when p=0.",
    "created_at": "2012-04-30T15:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133419",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'>Comment 7:</a>
Can you please check what happens, with your patch applied, to the command

sage: random_DAG(5,p=0)

I suspect that the problem is not only the fact that 1/2=0, but also that the program fails when p=0.



---

archive/issue_comments_133420.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nIndeed, the algorithm is an infinite loop when p=0.\n\nWhat behaviour should be expected for p=0 ?\n\nMaybe one should add an assumption : \n\nassert p>0 and p<1, \"The probability p=%s should satisfy 0<p<1.\" %p",
    "created_at": "2012-04-30T15:24:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133420",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'>Comment 8:</a>
Indeed, the algorithm is an infinite loop when p=0.

What behaviour should be expected for p=0 ?

Maybe one should add an assumption : 

assert p>0 and p<1, "The probability p=%s should satisfy 0<p<1." %p



---

archive/issue_events_151299.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-06-05T18:45:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151299"
}
```



---

archive/issue_events_151300.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-06-05T18:45:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151300"
}
```



---

archive/issue_events_151301.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-06-05T18:45:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151301"
}
```



---

archive/issue_events_151302.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-06-05T18:45:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151302"
}
```



---

archive/issue_comments_133421.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI have made a modified patch, which checks that p>0.\n\napply only trac_12181_random_dag-fc.patch",
    "created_at": "2012-06-08T13:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133421",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'>Comment 11:</a>
I have made a modified patch, which checks that p>0.

apply only trac_12181_random_dag-fc.patch



---

archive/issue_comments_133422.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,5 @@\n ```\n \n it will run forever!\n+\n+apply only trac_12181_random_dag-fc.patch\n``````\n",
    "created_at": "2012-06-08T13:58:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133422",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,5 @@
 ```
 
 it will run forever!
+
+apply only trac_12181_random_dag-fc.patch
``````




---

archive/issue_events_151303.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-06-08T13:58:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151303"
}
```



---

archive/issue_events_151304.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-06-08T13:58:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151304"
}
```



---

archive/issue_events_151305.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T07:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151305"
}
```



---

archive/issue_events_151306.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T07:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151306"
}
```



---

archive/issue_events_151307.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T13:40:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "milestone_number": null,
    "milestone_title": "sage-5.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151307"
}
```



---

archive/issue_events_151308.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-07-10T13:40:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "milestone_number": null,
    "milestone_title": "sage-5.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151308"
}
```



---

archive/issue_comments_133423.json:
```json
{
    "body": "Author: **dsm, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2012-07-10T13:40:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133423",
    "user": "https://github.com/fchapoton"
}
```

Author: **dsm, Frédéric Chapoton**



---

archive/issue_comments_133424.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\napply only trac_12181_random_dag-fc.2.patch\n\nnew patch, with better doc only",
    "created_at": "2012-07-23T12:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133424",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'>Comment 14:</a>
apply only trac_12181_random_dag-fc.2.patch

new patch, with better doc only



---

archive/issue_comments_133425.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,4 @@\n \n it will run forever!\n \n-apply only trac_12181_random_dag-fc.patch\n+apply only trac_12181_random_dag-fc.2.patch\n``````\n",
    "created_at": "2012-07-23T12:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133425",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,4 @@
 
 it will run forever!
 
-apply only trac_12181_random_dag-fc.patch
+apply only trac_12181_random_dag-fc.2.patch
``````




---

archive/issue_events_151309.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-04T11:09:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151309"
}
```



---

archive/issue_events_151310.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-04T11:09:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151310"
}
```



---

archive/issue_comments_133426.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2012-08-04T11:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133426",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_133427.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nHello,\n\nThe patch needs further improvements.\n\n1) The test on p should be improved since I can give p=2 without error. For instance,\n\n```\nif p < 0 or p > 1:\n   raise ValueError('The parameter p must be in [0..1].')\n```\n\n2) A test is needed for parameter weight_max:\n\n```\nsage: random_DAG(5, .5, -1)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\n...\nValueError: empty range for randrange() (1,0, -1)\n```\nand\n\n```\nsage: random_DAG(5, .5, .5)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\n...\nValueError: non-integer stop for randrange()\n```\n\n3) It should be clearly indicated in the documentation that the function returns a dictionary storing the edges of the DAG.\n\n4) The resulting number of vertices is not n but n+1:\n\n```\nsage: d = DiGraph(random_DAG(5, .5))\nsage: d\nDigraph on 6 vertices\n```\n\n5) I don't understand why this digraph generator is not part of ```sage.graphs.digraph_generators.py```. The function could have an optional parameter to return a dictionary instead of a digraph if relevant.",
    "created_at": "2012-08-04T11:09:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133427",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'>Comment 15:</a>
Hello,

The patch needs further improvements.

1) The test on p should be improved since I can give p=2 without error. For instance,

```
if p < 0 or p > 1:
   raise ValueError('The parameter p must be in [0..1].')
```

2) A test is needed for parameter weight_max:

```
sage: random_DAG(5, .5, -1)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
...
ValueError: empty range for randrange() (1,0, -1)
```
and

```
sage: random_DAG(5, .5, .5)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
...
ValueError: non-integer stop for randrange()
```

3) It should be clearly indicated in the documentation that the function returns a dictionary storing the edges of the DAG.

4) The resulting number of vertices is not n but n+1:

```
sage: d = DiGraph(random_DAG(5, .5))
sage: d
Digraph on 6 vertices
```

5) I don't understand why this digraph generator is not part of ```sage.graphs.digraph_generators.py```. The function could have an optional parameter to return a dictionary instead of a digraph if relevant.



---

archive/issue_events_151311.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-08-04T18:29:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151311"
}
```



---

archive/issue_events_151312.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-08-04T18:29:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151312"
}
```



---

archive/issue_comments_133428.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,4 @@\n \n it will run forever!\n \n-apply only trac_12181_random_dag-fc.2.patch\n+apply only trac_12181_random_dag-fc.patch\n``````\n",
    "created_at": "2012-08-04T18:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133428",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,4 @@
 
 it will run forever!
 
-apply only trac_12181_random_dag-fc.2.patch
+apply only trac_12181_random_dag-fc.patch
``````




---

archive/issue_comments_133429.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nnew patch. \n\nI have made all the required changes, except for the last point. It is certainly true that the procedure could be moved, and changed to return a digraph. I would rather let that for another ticket..\n\napply only trac_12181_random_dag-fc.patch",
    "created_at": "2012-08-04T18:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133429",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'>Comment 16:</a>
new patch. 

I have made all the required changes, except for the last point. It is certainly true that the procedure could be moved, and changed to return a digraph. I would rather let that for another ticket..

apply only trac_12181_random_dag-fc.patch



---

archive/issue_comments_133430.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThis is much better.\n\n- The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?\n\n```\nsage: random_DAG(5,.5,1.5)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: Attempt to coerce non-integral RealNumber to Integer\n```\n\n- The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.\n\n- I'm unable to build/find the documentation. Are you able to build it?\n\n- I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.",
    "created_at": "2012-08-04T23:31:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133430",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:17'>Comment 17:</a>
This is much better.

- The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?

```
sage: random_DAG(5,.5,1.5)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: Attempt to coerce non-integral RealNumber to Integer
```

- The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.

- I'm unable to build/find the documentation. Are you able to build it?

- I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.



---

archive/issue_comments_133431.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\n> - The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?\n> \n> ```\n> sage: random_DAG(5,.5,1.5)\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> ...\n> TypeError: Attempt to coerce non-integral RealNumber to Integer\n> ```\n\nYes, indeed. Well, this seems to be a reasonable way to ensure that the input is of correct type, as specified in the documentation. The problem is that one should accept both **int** and **Integers** as third argument. This is the case with what I have written, which tries to coerce to Integers.\n\n\n \n> - The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.\n\nWell, a dictionary of dictionaries is a dictionary, isn't it ? And by the way, I have not found any place in the sources of Sage where this procedure is used.\n\n\n> - I'm unable to build/find the documentation. Are you able to build it?\n\nSorry, I do not understand this remark. I have only tried the doc in a terminal. Should I try it in the notebook too ? Should I do something else ? Could you pinpoint a specific problem ?\n\n\n> - I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.\n\nWell, this ticket is here to solve a specific problem, and the rest can be postponed to some other ticket.",
    "created_at": "2012-08-05T07:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133431",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'>Comment 18:</a>
> - The instruction `weight_max=ZZ(weight_max)` is before the test on weights. Is this what you expect?
> 
> ```
> sage: random_DAG(5,.5,1.5)
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> ...
> TypeError: Attempt to coerce non-integral RealNumber to Integer
> ```

Yes, indeed. Well, this seems to be a reasonable way to ensure that the input is of correct type, as specified in the documentation. The problem is that one should accept both **int** and **Integers** as third argument. This is the case with what I have written, which tries to coerce to Integers.


 
> - The output is not only a dictionary but a dictionary of dictionary. You should perhaps add a warning comment since the space requirement for large values of n could be too high. I don't know the usual size of the DAG used in this context.

Well, a dictionary of dictionaries is a dictionary, isn't it ? And by the way, I have not found any place in the sources of Sage where this procedure is used.


> - I'm unable to build/find the documentation. Are you able to build it?

Sorry, I do not understand this remark. I have only tried the doc in a terminal. Should I try it in the notebook too ? Should I do something else ? Could you pinpoint a specific problem ?


> - I agree that moving this function into digraphs_generator could be done as part of another patch. It should in particular have an optional argument allowing to have multiple sinks (and so avoiding the while loop). With current setting, I'm not sure that the average number of arcs is ``p*n``.

Well, this ticket is here to solve a specific problem, and the rest can be postponed to some other ticket.



---

archive/issue_comments_133432.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nThere is now a mismatch between doc and tests : should we allow p to be equal to 1 or not ?",
    "created_at": "2012-08-05T09:41:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133432",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'>Comment 19:</a>
There is now a mismatch between doc and tests : should we allow p to be equal to 1 or not ?



---

archive/issue_comments_133433.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nThat's right, you should change the test to\n\n```\nassert 0 < p and p <= 1, \"The parameter p must satisfy 0 < p <= 1.\"\n```\nYou don't have the change the rest of the code since the `random()` function returns a value strictly less than 1.\n\nConcerning the documentation. For (almost?) all modules, you can find the functions in the reference manual of sage (http://www.sagemath.org/doc/reference/). Then, when testing a patch, we use the command\n`sage -docbuild reference html`\nto build the reference manual including patch's changes. Same for `thematic_tutorials` if any.\n\nHowever, the sandpile model is not included in the reference manual.\nI have open a new ticket to address this issue (#13342).\n\n\nSo, you have to:\n- change the test on p\n- change the commit message of this patch. It is currently\n\n```\n#12181 bug in random digraphs with probability zero\n```\nIt should be something like\n\n```\ntrac #12181 -- Fix bugs with the input parameters of the random_DAG function\n```",
    "created_at": "2012-08-05T10:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133433",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:20'>Comment 20:</a>
That's right, you should change the test to

```
assert 0 < p and p <= 1, "The parameter p must satisfy 0 < p <= 1."
```
You don't have the change the rest of the code since the `random()` function returns a value strictly less than 1.

Concerning the documentation. For (almost?) all modules, you can find the functions in the reference manual of sage (http://www.sagemath.org/doc/reference/). Then, when testing a patch, we use the command
`sage -docbuild reference html`
to build the reference manual including patch's changes. Same for `thematic_tutorials` if any.

However, the sandpile model is not included in the reference manual.
I have open a new ticket to address this issue (#13342).


So, you have to:
- change the test on p
- change the commit message of this patch. It is currently

```
#12181 bug in random digraphs with probability zero
```
It should be something like

```
trac #12181 -- Fix bugs with the input parameters of the random_DAG function
```



---

archive/issue_comments_133434.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nChanges done in the new version of the patch",
    "created_at": "2012-08-05T16:23:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133434",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'>Comment 21:</a>
Changes done in the new version of the patch



---

archive/issue_comments_133435.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nFor me the patch is OK now.",
    "created_at": "2012-08-05T20:08:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133435",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'>Comment 22:</a>
For me the patch is OK now.



---

archive/issue_events_151313.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-05T20:08:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151313"
}
```



---

archive/issue_events_151314.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-05T20:08:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151314"
}
```



---

archive/issue_comments_133436.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI strongly suggest against using `assert` statements for error checking (bad input should throw `ValueError`, not `AssertionError`). Also, add doctests for this bad input.",
    "created_at": "2012-08-06T13:09:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133436",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'>Comment 23:</a>
I strongly suggest against using `assert` statements for error checking (bad input should throw `ValueError`, not `AssertionError`). Also, add doctests for this bad input.



---

archive/issue_comments_133437.json:
```json
{
    "body": "Changed author from **dsm, Fr\u00e9d\u00e9ric Chapoton** to **Douglas McNeil, Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2012-08-06T13:09:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133437",
    "user": "https://github.com/jdemeyer"
}
```

Changed author from **dsm, Frédéric Chapoton** to **Douglas McNeil, Frédéric Chapoton**



---

archive/issue_events_151315.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-06T13:09:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151315"
}
```



---

archive/issue_events_151316.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-06T13:09:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151316"
}
```



---

archive/issue_comments_133438.json:
```json
{
    "body": "Attachment: **[trac_12181_random_dag-fc.patch.gz](https://github.com/sagemath/sage/files/ticket12181/trac_12181_random_dag-fc.patch.gz)**",
    "created_at": "2012-08-08T15:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133438",
    "user": "https://github.com/fchapoton"
}
```

Attachment: **[trac_12181_random_dag-fc.patch.gz](https://github.com/sagemath/sage/files/ticket12181/trac_12181_random_dag-fc.patch.gz)**



---

archive/issue_events_151317.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-08-08T15:32:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151317"
}
```



---

archive/issue_events_151318.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2012-08-08T15:32:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151318"
}
```



---

archive/issue_comments_133439.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nNew patch, with suggested changes made.",
    "created_at": "2012-08-08T15:32:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133439",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'>Comment 24:</a>
New patch, with suggested changes made.



---

archive/issue_events_151319.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-08T23:34:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151319"
}
```



---

archive/issue_events_151320.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2012-08-08T23:34:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151320"
}
```



---

archive/issue_comments_133440.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nFor me the patch is fine (install, long tests, etc.).",
    "created_at": "2012-08-08T23:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133440",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:25'>Comment 25:</a>
For me the patch is fine (install, long tests, etc.).



---

archive/issue_comments_133441.json:
```json
{
    "body": "Merged: **sage-5.3.beta2**",
    "created_at": "2012-08-14T07:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12181#issuecomment-133441",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.3.beta2**



---

archive/issue_events_151321.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-14T07:02:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151321"
}
```



---

archive/issue_events_151322.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-08-14T07:02:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12181",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12181#event-151322"
}
```
