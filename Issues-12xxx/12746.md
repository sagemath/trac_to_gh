# Issue 12746: Another coercion problem with QQbar

archive/issues_012574.json:
```json
{
    "body": "We had a ticket recently (#12665) for ` QQbar(zeta(7)) `. Amusingly, ` QQbar(zeta(6)) ` fails in a completely different way:\n\n```\nsage: QQbar(zeta(6))\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (1327, 0))\n\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n\n/storage/masiao/sage-5.0.beta10/devel/sage-main/<ipython console> in <module>()\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7940)()\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3344)()\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3247)()\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in _element_constructor_(self, x)\n    793             return AlgebraicNumber(x._descr)\n    794         elif hasattr(x, '_algebraic_'):\n--> 795             return x._algebraic_(QQbar)\n    796         return AlgebraicNumber(x)\n    797 \n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._algebraic_ (sage/symbolic/expression.cpp:6286)()\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in algebraic(ex, field)\n    830         0\n    831     \"\"\"\n--> 832     return AlgebraicConverter(field)(ex)\n    833 \n    834 ##############\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n    212                 div = self.get_fake_div(ex)\n    213                 return self.arithmetic(div, div.operator())\n--> 214             return self.arithmetic(ex, operator)\n    215         elif operator in relation_operators:\n    216             return self.relation(ex, operator)\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)\n    717                 return self.field(base**expt)\n    718             else:\n--> 719                 return reduce(operator, map(self, ex.operands()))\n    720         except TypeError:\n    721             if operator is _operator.pow:\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)\n    212                 div = self.get_fake_div(ex)\n    213                 return self.arithmetic(div, div.operator())\n--> 214             return self.arithmetic(ex, operator)\n    215         elif operator in relation_operators:\n    216             return self.relation(ex, operator)\n\n/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)\n    721             if operator is _operator.pow:\n    722                 from sage.symbolic.constants import e, pi, I\n--> 723                 base, expt = self._operands\n    724                 if base == e and expt / (pi*I) in QQ:\n    725                     return exp(expt)._algebraic_(self.field)\n\nAttributeError: 'AlgebraicConverter' object has no attribute '_operands'\n```\n\nThis is pretty minor -- the conversion is obviously absurd, and all that needs to be changed is to get it to return a more informative error message. (Amazing the bugs you can discover from a typo; when I typed ` QQbar(zeta(7)) ` it was a typo for ` QQbar.zeta(7) ` !)\n\nAssignee: @aghitza\n\nReviewer: Robert Bradshaw\n\nAuthor: Mike Hansen\n\nMerged: sage-5.1.beta5\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12746\n\n",
    "closed_at": "2012-06-18T10:23:57Z",
    "created_at": "2012-03-25T21:05:01Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.1",
    "title": "Another coercion problem with QQbar",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12746",
    "user": "https://github.com/loefflerd"
}
```
We had a ticket recently (#12665) for ` QQbar(zeta(7)) `. Amusingly, ` QQbar(zeta(6)) ` fails in a completely different way:

```
sage: QQbar(zeta(6))
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (1327, 0))

---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/storage/masiao/sage-5.0.beta10/devel/sage-main/<ipython console> in <module>()

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:7940)()

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3344)()

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (sage/structure/coerce_maps.c:3247)()

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/rings/qqbar.pyc in _element_constructor_(self, x)
    793             return AlgebraicNumber(x._descr)
    794         elif hasattr(x, '_algebraic_'):
--> 795             return x._algebraic_(QQbar)
    796         return AlgebraicNumber(x)
    797 

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._algebraic_ (sage/symbolic/expression.cpp:6286)()

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in algebraic(ex, field)
    830         0
    831     """
--> 832     return AlgebraicConverter(field)(ex)
    833 
    834 ##############

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
    212                 div = self.get_fake_div(ex)
    213                 return self.arithmetic(div, div.operator())
--> 214             return self.arithmetic(ex, operator)
    215         elif operator in relation_operators:
    216             return self.relation(ex, operator)

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)
    717                 return self.field(base**expt)
    718             else:
--> 719                 return reduce(operator, map(self, ex.operands()))
    720         except TypeError:
    721             if operator is _operator.pow:

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in __call__(self, ex)
    212                 div = self.get_fake_div(ex)
    213                 return self.arithmetic(div, div.operator())
--> 214             return self.arithmetic(ex, operator)
    215         elif operator in relation_operators:
    216             return self.relation(ex, operator)

/storage/masiao/sage-5.0.beta10/local/lib/python2.7/site-packages/sage/symbolic/expression_conversions.pyc in arithmetic(self, ex, operator)
    721             if operator is _operator.pow:
    722                 from sage.symbolic.constants import e, pi, I
--> 723                 base, expt = self._operands
    724                 if base == e and expt / (pi*I) in QQ:
    725                     return exp(expt)._algebraic_(self.field)

AttributeError: 'AlgebraicConverter' object has no attribute '_operands'
```

This is pretty minor -- the conversion is obviously absurd, and all that needs to be changed is to get it to return a more informative error message. (Amazing the bugs you can discover from a typo; when I typed ` QQbar(zeta(7)) ` it was a typo for ` QQbar.zeta(7) ` !)

Assignee: @aghitza

Reviewer: Robert Bradshaw

Author: Mike Hansen

Merged: sage-5.1.beta5

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12746





---

archive/issue_comments_182220.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-We had a ticket recently for ` QQbar(zeta(7)) `. Amusingly, ` QQbar(zeta(6)) ` fails in a completely different way:\n+We had a ticket recently (#12665) for ` QQbar(zeta(7)) `. Amusingly, ` QQbar(zeta(6)) ` fails in a completely different way:\n \n ```\n sage: QQbar(zeta(6))\n``````\n",
    "created_at": "2012-03-25T21:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182220",
    "user": "https://github.com/loefflerd"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-We had a ticket recently for ` QQbar(zeta(7)) `. Amusingly, ` QQbar(zeta(6)) ` fails in a completely different way:
+We had a ticket recently (#12665) for ` QQbar(zeta(7)) `. Amusingly, ` QQbar(zeta(6)) ` fails in a completely different way:
 
 ```
 sage: QQbar(zeta(6))
``````




---

archive/issue_comments_182221.json:
```json
{
    "body": "Attachment [trac_12746.patch](tarball://root/attachments/some-uuid/ticket12746/trac_12746.patch) by @mwhansen created at 2012-03-26 04:47:24",
    "created_at": "2012-03-26T04:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182221",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12746.patch](tarball://root/attachments/some-uuid/ticket12746/trac_12746.patch) by @mwhansen created at 2012-03-26 04:47:24



---

archive/issue_comments_182222.json:
```json
{
    "body": "Changing author from \"\" to \"Mike Hansen\"",
    "created_at": "2012-03-26T04:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182222",
    "user": "https://github.com/mwhansen"
}
```

Changing author from "" to "Mike Hansen"



---

archive/issue_comments_182223.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-26T04:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182223",
    "user": "https://github.com/mwhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_182224.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-06T07:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182224",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_182225.json:
```json
{
    "body": "<a id='comment:3'></a>\nLooks good to me.",
    "created_at": "2012-06-06T07:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182225",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:3'></a>
Looks good to me.



---

archive/issue_comments_182226.json:
```json
{
    "body": "<a id='comment:4'></a>\nPlease fill in your real name in the Author / Reviewer fields.",
    "created_at": "2012-06-09T19:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182226",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Please fill in your real name in the Author / Reviewer fields.



---

archive/issue_comments_182227.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Robert Bradshaw\"",
    "created_at": "2012-06-09T19:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182227",
    "user": "https://github.com/mwhansen"
}
```

Changing reviewer from "" to "Robert Bradshaw"



---

archive/issue_comments_182228.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-18T10:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182228",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_048251.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-06-18T10:23:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12746#event-48251"
}
```



---

archive/issue_comments_182229.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.1.beta5\"",
    "created_at": "2012-06-18T10:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12746",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12746#issuecomment-182229",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.1.beta5"
