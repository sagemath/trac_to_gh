# Issue 12487: build the sage library in place

archive/issues_012487.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  wstein @kini @fchapoton @jhpalmieri\n\nUse distutils to build the Sage library inplace to save on space / make it clearer which files are actually being used in runtime.\n\nSee the discussion at http://groups.google.com/group/sage-devel/browse_thread/thread/d5aef15acc4d178b\n\nIssue created by migration from https://trac.sagemath.org/ticket/12659\n\n",
    "closed_at": "2020-09-13T09:20:54Z",
    "created_at": "2012-03-13T05:07:38Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "build the sage library in place",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12487",
    "user": "https://github.com/mwhansen"
}
```
Assignee: GeorgSWeber

CC:  wstein @kini @fchapoton @jhpalmieri

Use distutils to build the Sage library inplace to save on space / make it clearer which files are actually being used in runtime.

See the discussion at http://groups.google.com/group/sage-devel/browse_thread/thread/d5aef15acc4d178b

Issue created by migration from https://trac.sagemath.org/ticket/12659





---

archive/issue_comments_147649.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-13T05:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147649",
    "user": "https://github.com/mwhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_147650.json:
```json
{
    "body": "Hey Mike, could you explain briefly why you delete (not move) all this code?  Just curious. \n\n```\n747\t \t        # if cython worked, copy the file to the build directory \n748\t \t        pyx_inst_file = '%s/%s'%(SITE_PACKAGES, f) \n749\t \t        retval = os.system('cp %s %s 2>/dev/null'%(f, pyx_inst_file)) \n750\t \t        # we could do this more elegantly -- load the files, use \n751\t \t        # os.path.exists to check that they exist, etc. ... but the \n752\t \t        # *vast* majority of the time, the copy just works. so this is \n753\t \t        # just specializing for the most common use case. \n754\t \t        if retval: \n755\t \t            dirname, filename = os.path.split(pyx_inst_file) \n756\t \t            try: \n757\t \t                os.makedirs(dirname) \n758\t \t            except OSError, e: \n759\t \t                assert e.errno==errno.EEXIST, 'Cannot create %s.' % dirname \n760\t \t            retval = os.system('cp %s %s 2>/dev/null'%(f, pyx_inst_file)) \n761\t \t            if retval: \n762\t \t                raise OSError, \"cannot copy %s to %s\"%(f,pyx_inst_file) \n763\t \t        print \"%s --> %s\"%(f, pyx_inst_file) \n764\t \t         \n743\t            return r         \n```",
    "created_at": "2012-03-13T06:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147650",
    "user": "https://github.com/williamstein"
}
```

Hey Mike, could you explain briefly why you delete (not move) all this code?  Just curious. 

```
747	 	        # if cython worked, copy the file to the build directory 
748	 	        pyx_inst_file = '%s/%s'%(SITE_PACKAGES, f) 
749	 	        retval = os.system('cp %s %s 2>/dev/null'%(f, pyx_inst_file)) 
750	 	        # we could do this more elegantly -- load the files, use 
751	 	        # os.path.exists to check that they exist, etc. ... but the 
752	 	        # *vast* majority of the time, the copy just works. so this is 
753	 	        # just specializing for the most common use case. 
754	 	        if retval: 
755	 	            dirname, filename = os.path.split(pyx_inst_file) 
756	 	            try: 
757	 	                os.makedirs(dirname) 
758	 	            except OSError, e: 
759	 	                assert e.errno==errno.EEXIST, 'Cannot create %s.' % dirname 
760	 	            retval = os.system('cp %s %s 2>/dev/null'%(f, pyx_inst_file)) 
761	 	            if retval: 
762	 	                raise OSError, "cannot copy %s to %s"%(f,pyx_inst_file) 
763	 	        print "%s --> %s"%(f, pyx_inst_file) 
764	 	         
743	            return r         
```



---

archive/issue_comments_147651.json:
```json
{
    "body": "I removed it since we don't need to copy those files anymore -- they're already in the right place.",
    "created_at": "2012-03-13T06:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147651",
    "user": "https://github.com/mwhansen"
}
```

I removed it since we don't need to copy those files anymore -- they're already in the right place.



---

archive/issue_comments_147652.json:
```json
{
    "body": "Mike -- that makes sense.  However, why do we have this code still:\n\n```\n\t422\t        if not self.inplace: \n \t423\t            relative_ext_dir = os.path.split(relative_ext_filename)[0] \n \t424\t            prefixes = ['', self.build_lib, self.build_temp] \n \t425\t            for prefix in prefixes: \n \t426\t                path = os.path.join(prefix, relative_ext_dir) \n \t427\t                try: \n \t428\t                    os.makedirs(path) \n \t429\t                except OSError, e: \n \t430\t                    assert e.errno==errno.EEXIST, 'Cannot create %s.' % path \n```\nWouldn't the above only be run if we are not building in place?   It seems to me that it would be best to either keep the code discussed in the comment above, or should replace all the code above by\n\n```\n\t422\t        if not self.inplace: \n        423                ERROR MESSAGE\n```\n\nI'm in favor of the latter, unless I'm misunderstanding things.",
    "created_at": "2012-03-13T07:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147652",
    "user": "https://github.com/williamstein"
}
```

Mike -- that makes sense.  However, why do we have this code still:

```
	422	        if not self.inplace: 
 	423	            relative_ext_dir = os.path.split(relative_ext_filename)[0] 
 	424	            prefixes = ['', self.build_lib, self.build_temp] 
 	425	            for prefix in prefixes: 
 	426	                path = os.path.join(prefix, relative_ext_dir) 
 	427	                try: 
 	428	                    os.makedirs(path) 
 	429	                except OSError, e: 
 	430	                    assert e.errno==errno.EEXIST, 'Cannot create %s.' % path 
```
Wouldn't the above only be run if we are not building in place?   It seems to me that it would be best to either keep the code discussed in the comment above, or should replace all the code above by

```
	422	        if not self.inplace: 
        423                ERROR MESSAGE
```

I'm in favor of the latter, unless I'm misunderstanding things.



---

archive/issue_comments_147653.json:
```json
{
    "body": "Attachment [trac_12659.patch](tarball://root/attachments/some-uuid/ticket12659/trac_12659.patch) by @mwhansen created at 2012-03-13 07:22:28\n\nAgreed -- I've put an updated patch.",
    "created_at": "2012-03-13T07:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147653",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12659.patch](tarball://root/attachments/some-uuid/ticket12659/trac_12659.patch) by @mwhansen created at 2012-03-13 07:22:28

Agreed -- I've put an updated patch.



---

archive/issue_comments_147654.json:
```json
{
    "body": "Regarding everything else about this patch, it seems to work perfectly (though I'm running a few tests), and in fact is REALLY, REALLY AWESOME.  This must go into Sage ASAP!  It's wonderful.",
    "created_at": "2012-03-13T07:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147654",
    "user": "https://github.com/williamstein"
}
```

Regarding everything else about this patch, it seems to work perfectly (though I'm running a few tests), and in fact is REALLY, REALLY AWESOME.  This must go into Sage ASAP!  It's wonderful.



---

archive/issue_comments_147655.json:
```json
{
    "body": "Thanks!",
    "created_at": "2012-03-13T07:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147655",
    "user": "https://github.com/mwhansen"
}
```

Thanks!



---

archive/issue_comments_147656.json:
```json
{
    "body": "It seems to me that if this get's merged then we should undo the changes at #11235",
    "created_at": "2012-03-13T13:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147656",
    "user": "https://github.com/koffie"
}
```

It seems to me that if this get's merged then we should undo the changes at #11235



---

archive/issue_comments_147657.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-14T02:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147657",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_147658.json:
```json
{
    "body": "I'm happy with this code. \n\nAnd indeed the work at #11235 seems not necessary anymore.",
    "created_at": "2012-03-14T02:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147658",
    "user": "https://github.com/williamstein"
}
```

I'm happy with this code. 

And indeed the work at #11235 seems not necessary anymore.



---

archive/issue_comments_147659.json:
```json
{
    "body": "Could this have caused\n\n```\nsage -t  \"devel/sage-main/sage/graphs/graph_decompositions/rankwidth.pyx\"\n**********************************************************************\nFile \"/tmp/jdemeyer/merger/sage-5.0.beta9/devel/sage-main/sage/graphs/graph_decompositions/rankwidth.pyx\", line 47:\n    sage: rw, tree = g.rank_decomposition()\nException raised:\n    Traceback (most recent call last):\n      File \"/tmp/jdemeyer/merger/sage-5.0.beta9/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/tmp/jdemeyer/merger/sage-5.0.beta9/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/tmp/jdemeyer/merger/sage-5.0.beta9/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_0[3]>\", line 1, in <module>\n        rw, tree = g.rank_decomposition()###line 47:\n    sage: rw, tree = g.rank_decomposition()\n      File \"/tmp/jdemeyer/merger/sage-5.0.beta9/local/lib/python/site-packages/sage/graphs/graph.py\", line 2959, in rank_decomposition\n        from sage.graphs.graph_decompositions.rankwidth import rank_decomposition\n    ImportError: cannot import name rank_decomposition\n**********************************************************************\n```",
    "created_at": "2012-03-15T14:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147659",
    "user": "https://github.com/jdemeyer"
}
```

Could this have caused

```
sage -t  "devel/sage-main/sage/graphs/graph_decompositions/rankwidth.pyx"
**********************************************************************
File "/tmp/jdemeyer/merger/sage-5.0.beta9/devel/sage-main/sage/graphs/graph_decompositions/rankwidth.pyx", line 47:
    sage: rw, tree = g.rank_decomposition()
Exception raised:
    Traceback (most recent call last):
      File "/tmp/jdemeyer/merger/sage-5.0.beta9/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/tmp/jdemeyer/merger/sage-5.0.beta9/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/tmp/jdemeyer/merger/sage-5.0.beta9/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_0[3]>", line 1, in <module>
        rw, tree = g.rank_decomposition()###line 47:
    sage: rw, tree = g.rank_decomposition()
      File "/tmp/jdemeyer/merger/sage-5.0.beta9/local/lib/python/site-packages/sage/graphs/graph.py", line 2959, in rank_decomposition
        from sage.graphs.graph_decompositions.rankwidth import rank_decomposition
    ImportError: cannot import name rank_decomposition
**********************************************************************
```



---

archive/issue_comments_147660.json:
```json
{
    "body": "Indeed, it is.  I have no explanation for the fact that only the import of this particular module fails.  It was recently added in #11754, but how should that be relevant?",
    "created_at": "2012-03-15T19:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147660",
    "user": "https://github.com/jdemeyer"
}
```

Indeed, it is.  I have no explanation for the fact that only the import of this particular module fails.  It was recently added in #11754, but how should that be relevant?



---

archive/issue_comments_147661.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-03-15T19:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147661",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_147662.json:
```json
{
    "body": "How did you get that particular error?  How did you merge in the patch here?",
    "created_at": "2012-03-16T00:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147662",
    "user": "https://github.com/mwhansen"
}
```

How did you get that particular error?  How did you merge in the patch here?



---

archive/issue_comments_147663.json:
```json
{
    "body": "Dumbest question ever, I'm sure, but I'll ask it - will this affect upgrades at all?",
    "created_at": "2012-03-16T01:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147663",
    "user": "https://github.com/kcrisman"
}
```

Dumbest question ever, I'm sure, but I'll ask it - will this affect upgrades at all?



---

archive/issue_comments_147664.json:
```json
{
    "body": "Replying to [comment:15 mhansen]:\n> How did you get that particular error?  How did you merge in the patch here?\n\nApply the patch, sdist, build Sage from scratch.",
    "created_at": "2012-03-16T08:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147664",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 mhansen]:
> How did you get that particular error?  How did you merge in the patch here?

Apply the patch, sdist, build Sage from scratch.



---

archive/issue_comments_147665.json:
```json
{
    "body": "Replying to [comment:16 kcrisman]:\n> Dumbest question ever, I'm sure, but I'll ask it - will this affect upgrades at all?\n\nI certainly don't think this is a dumb question, in fact it is a very good question.  I don't know the answer though.",
    "created_at": "2012-03-16T08:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147665",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:16 kcrisman]:
> Dumbest question ever, I'm sure, but I'll ask it - will this affect upgrades at all?

I certainly don't think this is a dumb question, in fact it is a very good question.  I don't know the answer though.



---

archive/issue_comments_147666.json:
```json
{
    "body": "Upgrades should be fine -- when `sage -b` gets run, the site-packages link will update to the new location, and the new extension modules should be built in place.",
    "created_at": "2012-03-16T15:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147666",
    "user": "https://github.com/mwhansen"
}
```

Upgrades should be fine -- when `sage -b` gets run, the site-packages link will update to the new location, and the new extension modules should be built in place.



---

archive/issue_comments_147667.json:
```json
{
    "body": "> Upgrades should be fine -- when `sage -b` gets run, the site-packages link will update to the new location, and the new extension modules should be built in place.\n\nSo the first time an upgrade happens, the entire Sage library will have to rebuild its extensions and then put them in the new location, correct?",
    "created_at": "2012-03-16T16:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147667",
    "user": "https://github.com/kcrisman"
}
```

> Upgrades should be fine -- when `sage -b` gets run, the site-packages link will update to the new location, and the new extension modules should be built in place.

So the first time an upgrade happens, the entire Sage library will have to rebuild its extensions and then put them in the new location, correct?



---

archive/issue_comments_147668.json:
```json
{
    "body": "Yes -- it does not try to copy existing extension modules over.",
    "created_at": "2012-03-16T16:15:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147668",
    "user": "https://github.com/mwhansen"
}
```

Yes -- it does not try to copy existing extension modules over.



---

archive/issue_comments_147669.json:
```json
{
    "body": "By the way, I had the same experience as Jeroen: I applied the patches, did `./sage -b` and `./sage --sdist ...`.  Then I built Sage from the resulting tar file, and got doctest failures:\n\n```\n\tsage -t  --long -force_lib devel/sage/sage/graphs/graph.py # 4 doctests failed\n\tsage -t  --long -force_lib devel/sage/sage/graphs/graph_decompositions/rankwidth.pyx # 11 doctests failed\n```\nIs the issue the C code in the directory `sage/graphs/graph_decompositions/rankwidth/`? Somehow that code is now not being found by the Python and Cython code that uses it?",
    "created_at": "2012-03-16T16:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147669",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, I had the same experience as Jeroen: I applied the patches, did `./sage -b` and `./sage --sdist ...`.  Then I built Sage from the resulting tar file, and got doctest failures:

```
	sage -t  --long -force_lib devel/sage/sage/graphs/graph.py # 4 doctests failed
	sage -t  --long -force_lib devel/sage/sage/graphs/graph_decompositions/rankwidth.pyx # 11 doctests failed
```
Is the issue the C code in the directory `sage/graphs/graph_decompositions/rankwidth/`? Somehow that code is now not being found by the Python and Cython code that uses it?



---

archive/issue_comments_147670.json:
```json
{
    "body": "Looking at #11754, I think the issue is that there is a extension module sage.graphs.graph_decompositions.rankwidth as well as a package (with `__init__.py`) sage/graphs/decompositions/rankwidth/ .  I think that should really be fixed as it's ambiguous which should be used.",
    "created_at": "2012-03-16T17:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147670",
    "user": "https://github.com/mwhansen"
}
```

Looking at #11754, I think the issue is that there is a extension module sage.graphs.graph_decompositions.rankwidth as well as a package (with `__init__.py`) sage/graphs/decompositions/rankwidth/ .  I think that should really be fixed as it's ambiguous which should be used.



---

archive/issue_comments_147671.json:
```json
{
    "body": "The code here should work fine when #12684 is applied.",
    "created_at": "2012-03-17T17:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147671",
    "user": "https://github.com/mwhansen"
}
```

The code here should work fine when #12684 is applied.



---

archive/issue_comments_147672.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-17T17:01:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147672",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_147673.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-21T14:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147673",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_147674.json:
```json
{
    "body": "The code at #12684 fixes the problems with the graph files. For me, though, the banner is not getting updated when I run `sage --sdist ...`. The file `devel/sage/sage/version.py` is correct, but the file `devel/sage/build/sage/version.py` is not.  (This is after applying the patches here, running `./sage -b`, then `./sage --sdist ...`.)",
    "created_at": "2012-03-21T14:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147674",
    "user": "https://github.com/jhpalmieri"
}
```

The code at #12684 fixes the problems with the graph files. For me, though, the banner is not getting updated when I run `sage --sdist ...`. The file `devel/sage/sage/version.py` is correct, but the file `devel/sage/build/sage/version.py` is not.  (This is after applying the patches here, running `./sage -b`, then `./sage --sdist ...`.)



---

archive/issue_comments_147675.json:
```json
{
    "body": "I took a fresh Sage tarball, applied the patch here to the sage spkg, and then built Sage.  Then I ran `./sage --sdist ...`. I got this error:\n\n```\nrunning build_ext\nTraceback (most recent call last):\n  File \"setup.py\", line 983, in <module>\n    include_dirs = include_dirs)\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/core.py\", line 152, in setup\n    dist.run_commands()\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py\", line 953, in run_commands\n    self.run_command(cmd)\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py\", line 972, in run_command\n    cmd_obj.run()\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/command/install.py\", line 563, in run\n    self.run_command('build')\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/cmd.py\", line 326, in run_command\n    self.distribution.run_command(command)\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py\", line 972, in run_command\n    cmd_obj.run()\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/command/build.py\", line 127, in run\n    self.run_command(cmd_name)\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/cmd.py\", line 326, in run_command\n    self.distribution.run_command(command)\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py\", line 972, in run_command\n    cmd_obj.run()\n  File \"/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/command/build_ext.py\", line 340, in run\n    self.build_extensions()\n  File \"setup.py\", line 318, in build_extensions\n    raise RuntimeError, \"only in-place builds are currently supported\"\nRuntimeError: only in-place builds are currently supported\n```\nThis doesn't stop the build, but do we need to worry about it? If not, we should suppress it.\n\nAlso, as mentioned above, I took an existing Sage installation, applied the patch to devel/sage, and ran `sage --sdist ...`. I got the same error message.  Also, in the existing Sage installation, while `devel/sage/sage/version.py` was correct, `devel/sage/build/sage/version.py` was not. `local/lib/python/site-packages/sage` linked to `build/sage/`, and this is what led to the incorrect sage-banner that I mentioned earlier. Should the installation instructions include forcibly relinking `local/lib/.../sage` to the correct thing, if applying to an existing Sage installation?",
    "created_at": "2012-03-29T23:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147675",
    "user": "https://github.com/jhpalmieri"
}
```

I took a fresh Sage tarball, applied the patch here to the sage spkg, and then built Sage.  Then I ran `./sage --sdist ...`. I got this error:

```
running build_ext
Traceback (most recent call last):
  File "setup.py", line 983, in <module>
    include_dirs = include_dirs)
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/core.py", line 152, in setup
    dist.run_commands()
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py", line 953, in run_commands
    self.run_command(cmd)
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/command/install.py", line 563, in run
    self.run_command('build')
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/cmd.py", line 326, in run_command
    self.distribution.run_command(command)
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/command/build.py", line 127, in run
    self.run_command(cmd_name)
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/cmd.py", line 326, in run_command
    self.distribution.run_command(command)
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/dist.py", line 972, in run_command
    cmd_obj.run()
  File "/scratch/palmieri/12659/sage-5.0.beta12-gcc/local/lib/python/distutils/command/build_ext.py", line 340, in run
    self.build_extensions()
  File "setup.py", line 318, in build_extensions
    raise RuntimeError, "only in-place builds are currently supported"
RuntimeError: only in-place builds are currently supported
```
This doesn't stop the build, but do we need to worry about it? If not, we should suppress it.

Also, as mentioned above, I took an existing Sage installation, applied the patch to devel/sage, and ran `sage --sdist ...`. I got the same error message.  Also, in the existing Sage installation, while `devel/sage/sage/version.py` was correct, `devel/sage/build/sage/version.py` was not. `local/lib/python/site-packages/sage` linked to `build/sage/`, and this is what led to the incorrect sage-banner that I mentioned earlier. Should the installation instructions include forcibly relinking `local/lib/.../sage` to the correct thing, if applying to an existing Sage installation?



---

archive/issue_comments_147676.json:
```json
{
    "body": "I think the scripts patch should be this instead (that is, removing the old link in a different part of the script):\n\n```diff\ndiff --git a/sage-build b/sage-build\n--- a/sage-build\n+++ b/sage-build\n@@ -15,6 +15,11 @@ build() {\n       echo \"sage: Building and installing modified Sage library files.\"\n       echo \"\"\n \n+      # Remove this link. It will be recreated automatically; removing\n+      # it now allows for the transition to build Sage in place (trac\n+      # #12659), because it will replace a link to\n+      # devel/sage/build/sage with a link to devel/sage/sage.\n+      rm -f \"$SAGE_LOCAL/lib/python/site-packages/sage\"\n       # install c_lib\n       # we're doing this here instead of setup.py for historical\n       # reasons:\n```\nThis doesn't help with the error message in my previous comment, but it might take care of the other issue.",
    "created_at": "2012-03-30T20:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147676",
    "user": "https://github.com/jhpalmieri"
}
```

I think the scripts patch should be this instead (that is, removing the old link in a different part of the script):

```diff
diff --git a/sage-build b/sage-build
--- a/sage-build
+++ b/sage-build
@@ -15,6 +15,11 @@ build() {
       echo "sage: Building and installing modified Sage library files."
       echo ""
 
+      # Remove this link. It will be recreated automatically; removing
+      # it now allows for the transition to build Sage in place (trac
+      # #12659), because it will replace a link to
+      # devel/sage/build/sage with a link to devel/sage/sage.
+      rm -f "$SAGE_LOCAL/lib/python/site-packages/sage"
       # install c_lib
       # we're doing this here instead of setup.py for historical
       # reasons:
```
This doesn't help with the error message in my previous comment, but it might take care of the other issue.



---

archive/issue_comments_147677.json:
```json
{
    "body": "I've updated trac_12659-script.patch which should fix all of the outstanding problems mentioned on this ticket.",
    "created_at": "2012-08-13T10:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147677",
    "user": "https://github.com/mwhansen"
}
```

I've updated trac_12659-script.patch which should fix all of the outstanding problems mentioned on this ticket.



---

archive/issue_comments_147678.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-08-13T10:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147678",
    "user": "https://github.com/mwhansen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_147679.json:
```json
{
    "body": "I was wrong -- one doctest fails (due to a warning being shown) without the patch at #13363 added.",
    "created_at": "2012-08-13T21:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147679",
    "user": "https://github.com/mwhansen"
}
```

I was wrong -- one doctest fails (due to a warning being shown) without the patch at #13363 added.



---

archive/issue_comments_147680.json:
```json
{
    "body": "Just for esthetics: could you fix the spacing in [attachment:trac_12659-script.patch]?\n\nThe patches look okay to me, and it seems to work, but it would be nice if someone who knew the build process (in particular, setup.py for the Sage library) better took a look at this.",
    "created_at": "2012-08-20T22:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147680",
    "user": "https://github.com/jhpalmieri"
}
```

Just for esthetics: could you fix the spacing in [attachment:trac_12659-script.patch]?

The patches look okay to me, and it seems to work, but it would be nice if someone who knew the build process (in particular, setup.py for the Sage library) better took a look at this.



---

archive/issue_comments_147681.json:
```json
{
    "body": "Fixed up the spacing.",
    "created_at": "2012-08-20T23:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147681",
    "user": "https://github.com/mwhansen"
}
```

Fixed up the spacing.



---

archive/issue_comments_147682.json:
```json
{
    "body": "Attachment [trac_12659-script.patch](tarball://root/attachments/some-uuid/ticket12659/trac_12659-script.patch) by @mwhansen created at 2012-08-20 23:06:41",
    "created_at": "2012-08-20T23:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147682",
    "user": "https://github.com/mwhansen"
}
```

Attachment [trac_12659-script.patch](tarball://root/attachments/some-uuid/ticket12659/trac_12659-script.patch) by @mwhansen created at 2012-08-20 23:06:41



---

archive/issue_comments_147683.json:
```json
{
    "body": "I am testing this ticket (and a bunch of others) on the buildbot.  Upgrading fails: everything builds but Sage doesn't start up:\n\n```\nTesting that Sage starts...\n[2012-09-05 05:12:26] \nTraceback (most recent call last):\n  File \"/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/bin/sage-eval\", line 4, in <module>\n    from sage.all import *\n  File \"/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/lib/python2.7/site-packages/sage/all.py\", line 73, in <module>\n    from sage.matrix.all     import *\n  File \"/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/lib/python2.7/site-packages/sage/matrix/all.py\", line 1, in <module>\n    from matrix_space import MatrixSpace, is_MatrixSpace\n  File \"/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py\", line 33, in <module>\n    import matrix\n  File \"matrix.pyx\", line 1, in init sage.matrix.matrix (sage/matrix/matrix.c:2076)\n  File \"matrix2.pyx\", line 1, in init sage.matrix.matrix2 (sage/matrix/matrix2.c:70164)\n  File \"matrix1.pyx\", line 1, in init sage.matrix.matrix1 (sage/matrix/matrix1.c:13377)\n  File \"mutability.pxd\", line 15, in init sage.matrix.matrix0 (sage/matrix/matrix0.c:29424)\nValueError: PyCapsule_GetPointer called with invalid PyCapsule object\nSage failed to start up.\n```\nRunning `./sage -ba-force` solves the problem.",
    "created_at": "2012-09-05T12:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147683",
    "user": "https://github.com/jdemeyer"
}
```

I am testing this ticket (and a bunch of others) on the buildbot.  Upgrading fails: everything builds but Sage doesn't start up:

```
Testing that Sage starts...
[2012-09-05 05:12:26] 
Traceback (most recent call last):
  File "/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/bin/sage-eval", line 4, in <module>
    from sage.all import *
  File "/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/lib/python2.7/site-packages/sage/all.py", line 73, in <module>
    from sage.matrix.all     import *
  File "/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/lib/python2.7/site-packages/sage/matrix/all.py", line 1, in <module>
    from matrix_space import MatrixSpace, is_MatrixSpace
  File "/release/buildbot/sage/sage-1/sage_upgrade_4.5/build/sage-5.4.beta1/local/lib/python2.7/site-packages/sage/matrix/matrix_space.py", line 33, in <module>
    import matrix
  File "matrix.pyx", line 1, in init sage.matrix.matrix (sage/matrix/matrix.c:2076)
  File "matrix2.pyx", line 1, in init sage.matrix.matrix2 (sage/matrix/matrix2.c:70164)
  File "matrix1.pyx", line 1, in init sage.matrix.matrix1 (sage/matrix/matrix1.c:13377)
  File "mutability.pxd", line 15, in init sage.matrix.matrix0 (sage/matrix/matrix0.c:29424)
ValueError: PyCapsule_GetPointer called with invalid PyCapsule object
Sage failed to start up.
```
Running `./sage -ba-force` solves the problem.



---

archive/issue_comments_147684.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-09-05T20:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147684",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_034305.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-07T13:09:07Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34305"
}
```



---

archive/issue_comments_147685.json:
```json
{
    "body": "Wontfix because of #14570 I assume?",
    "created_at": "2013-06-07T13:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147685",
    "user": "https://github.com/jdemeyer"
}
```

Wontfix because of #14570 I assume?



---

archive/issue_comments_147686.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-06-07T13:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147686",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_147687.json:
```json
{
    "body": "I think that #14570 is orthogonal to this.",
    "created_at": "2013-06-07T16:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147687",
    "user": "https://github.com/mwhansen"
}
```

I think that #14570 is orthogonal to this.



---

archive/issue_comments_147688.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-06-08T08:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147688",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_events_034306.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-08T08:35:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34306"
}
```



---

archive/issue_events_034307.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-06-08T08:35:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34307"
}
```



---

archive/issue_events_034308.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34308"
}
```



---

archive/issue_events_034309.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34309"
}
```



---

archive/issue_events_034310.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34310"
}
```



---

archive/issue_events_034311.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34311"
}
```



---

archive/issue_events_034312.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34312"
}
```



---

archive/issue_events_034313.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34313"
}
```



---

archive/issue_comments_147689.json:
```json
{
    "body": "As I mentionned on sage-devel, I recently noticed some preliminary\nwork in src/setup.py toward compiling the Sage library in place,\ninstead of putting the produced .so and copies of the .py files in\nsrc/build.\n\nCompiling in place means saving 15s of `sage -b` each time I just\nmodify Python code, and I do that all the time; so we are speaking of\ndozen of minutes per day. So I have been dreaming of it for\nyears. Besides, it would also remove one of the regular source of\nconfusions for our new contributors.\n\nSo I explored this further, and with very minimal further changes ,\nthis apparently seems to work smoothly: I haven't yet run all tests,\nbut Sage starts, the documentation compiles, etc.\n\nSee branch u/nthiery/compile_library_inplace:\n\nhttp://git.sagemath.org/sage.git/commit/?h=u/nthiery/compile_library_inplace\n\nI can't wait until I can use this for real Sage development. But for\nthis, I basically need to get this feature into Sage. It would be\nadventurous to enable this feature by default for all users at this\npoint. On the other hand, we should allow the adventurous of us to use\nthis extensively to chase out the bugs.\n\nWhat would be the right approach to make this feature configurable\nwhen one compiles Sage for the first time? Using just an environment\nvariable set by the user is not good, since a given user might have\nSage installations configured differently. Some piece of information\nmust be stored somewhere at configuration time.\n\nI am happy to use a different ticket for this if this is deemed\npreferable.\n\nCheers,\n                         Nicolas",
    "created_at": "2014-07-03T21:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147689",
    "user": "https://github.com/nthiery"
}
```

As I mentionned on sage-devel, I recently noticed some preliminary
work in src/setup.py toward compiling the Sage library in place,
instead of putting the produced .so and copies of the .py files in
src/build.

Compiling in place means saving 15s of `sage -b` each time I just
modify Python code, and I do that all the time; so we are speaking of
dozen of minutes per day. So I have been dreaming of it for
years. Besides, it would also remove one of the regular source of
confusions for our new contributors.

So I explored this further, and with very minimal further changes ,
this apparently seems to work smoothly: I haven't yet run all tests,
but Sage starts, the documentation compiles, etc.

See branch u/nthiery/compile_library_inplace:

http://git.sagemath.org/sage.git/commit/?h=u/nthiery/compile_library_inplace

I can't wait until I can use this for real Sage development. But for
this, I basically need to get this feature into Sage. It would be
adventurous to enable this feature by default for all users at this
point. On the other hand, we should allow the adventurous of us to use
this extensively to chase out the bugs.

What would be the right approach to make this feature configurable
when one compiles Sage for the first time? Using just an environment
variable set by the user is not good, since a given user might have
Sage installations configured differently. Some piece of information
must be stored somewhere at configuration time.

I am happy to use a different ticket for this if this is deemed
preferable.

Cheers,
                         Nicolas



---

archive/issue_events_034314.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34314"
}
```



---

archive/issue_events_034315.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34315"
}
```



---

archive/issue_comments_147690.json:
```json
{
    "body": "This isn't *just* an issue of efficiency.   Based on my experience, probably hundreds of potential sage developers have been confused by precisely the thing that just confused you.  I remember Robert Miller running around at one Sage days going crazy because it seemed like everybody was massively confused by the fact there are multiple copies of arith.py (etc.).    If I had any employees who could work on Sage, this would definitely be a good thing to put in a top 5 list of ticket priorities.",
    "created_at": "2015-05-28T17:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147690",
    "user": "https://github.com/williamstein"
}
```

This isn't *just* an issue of efficiency.   Based on my experience, probably hundreds of potential sage developers have been confused by precisely the thing that just confused you.  I remember Robert Miller running around at one Sage days going crazy because it seemed like everybody was massively confused by the fact there are multiple copies of arith.py (etc.).    If I had any employees who could work on Sage, this would definitely be a good thing to put in a top 5 list of ticket priorities.



---

archive/issue_comments_147691.json:
```json
{
    "body": "+1",
    "created_at": "2015-05-28T17:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147691",
    "user": "https://github.com/kcrisman"
}
```

+1



---

archive/issue_comments_147692.json:
```json
{
    "body": "I wouldn't like the clutter of `.pyc` and `.so` files in the source directory. If the source directory would be kept as clean as it currently is, +1. Otherwise, -1.",
    "created_at": "2015-05-28T18:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147692",
    "user": "https://github.com/jdemeyer"
}
```

I wouldn't like the clutter of `.pyc` and `.so` files in the source directory. If the source directory would be kept as clean as it currently is, +1. Otherwise, -1.



---

archive/issue_comments_147693.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> I wouldn't like the clutter of `.pyc` and `.so` files in the source directory. If the source directory would be kept as clean as it currently is, +1. Otherwise, -1\n\n\nHow about making links to .py files in SAGELOCAL rather than copying them into SAGELOCAL ?\n\nWhy was copying chosen in the 1st place, I wonder...",
    "created_at": "2015-06-01T09:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147693",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:45 jdemeyer]:
> I wouldn't like the clutter of `.pyc` and `.so` files in the source directory. If the source directory would be kept as clean as it currently is, +1. Otherwise, -1


How about making links to .py files in SAGELOCAL rather than copying them into SAGELOCAL ?

Why was copying chosen in the 1st place, I wonder...



---

archive/issue_comments_147694.json:
```json
{
    "body": "Replying to [comment:46 dimpase]:\n> Why was copying chosen in the 1st place, I wonder...\n\nPortability?",
    "created_at": "2015-06-01T09:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147694",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:46 dimpase]:
> Why was copying chosen in the 1st place, I wonder...

Portability?



---

archive/issue_comments_147695.json:
```json
{
    "body": "Copying wasn't chosen by us but by Python - it's just how setup.py install works.\n\nThe so and pyc files would definitely be in tree for this ticket and I believe this change would avoid tons of confusion. \nBeing in tree is the entire point of being able to work on and run the source directly rather than copying\nIt to a target location before build.  Maybe jereon not wanting to run the source files directly is why this\nTicket never got in?  I don't know. \n\n- sent from a phone",
    "created_at": "2015-06-01T09:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147695",
    "user": "https://github.com/williamstein"
}
```

Copying wasn't chosen by us but by Python - it's just how setup.py install works.

The so and pyc files would definitely be in tree for this ticket and I believe this change would avoid tons of confusion. 
Being in tree is the entire point of being able to work on and run the source directly rather than copying
It to a target location before build.  Maybe jereon not wanting to run the source files directly is why this
Ticket never got in?  I don't know. 

- sent from a phone



---

archive/issue_comments_147696.json:
```json
{
    "body": "Replying to [comment:48 was]:\n> The so and pyc files would definitely be in tree for this ticket and I believe this change would avoid tons of confusion.\n\nWhat kind of confusion are you talking about? Perhaps the confusion can be fixed in a different way?\n\n> Maybe jereon not wanting to run the source files directly is why this\n> Ticket never got in?  I don't know.\n\nNo, it never got in Sage because it never actually worked.",
    "created_at": "2015-06-01T09:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147696",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:48 was]:
> The so and pyc files would definitely be in tree for this ticket and I believe this change would avoid tons of confusion.

What kind of confusion are you talking about? Perhaps the confusion can be fixed in a different way?

> Maybe jereon not wanting to run the source files directly is why this
> Ticket never got in?  I don't know.

No, it never got in Sage because it never actually worked.



---

archive/issue_comments_147697.json:
```json
{
    "body": "Replying to [comment:48 was]:\n> Copying wasn't chosen by us but by Python - it's just how setup.py install works.\n\n\nwell, what does prevent us to add an extra step of replacing copies with links?\n(This might not work well on native Windows, but we don't need to support this...)\n\nThis would combine the advantage of not having multiple copies of py files lying around (and not needing to `sage -b` every time you modify a .py file in Sage library), and\nretaining .pyc and .so-free source directory.\n\n> \n> The so and pyc files would definitely be in tree for this ticket and I believe this change would avoid tons of confusion.",
    "created_at": "2015-06-01T10:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147697",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:48 was]:
> Copying wasn't chosen by us but by Python - it's just how setup.py install works.


well, what does prevent us to add an extra step of replacing copies with links?
(This might not work well on native Windows, but we don't need to support this...)

This would combine the advantage of not having multiple copies of py files lying around (and not needing to `sage -b` every time you modify a .py file in Sage library), and
retaining .pyc and .so-free source directory.

> 
> The so and pyc files would definitely be in tree for this ticket and I believe this change would avoid tons of confusion.



---

archive/issue_comments_147698.json:
```json
{
    "body": "Replying to [comment:43 was]:\n> If I had any employees who could work on Sage, this would definitely\n> be a good thing to put in a top 5 list of ticket priorities.\n\n\nWe will definitely consider this in ODK. Actually the main reason we\ndid not put an explicit task about this is that I was (and still am)\nhoping it would be finished before that. Writing the grant distracted\nme away of working on it ...\n\nCheers,\n                                    Nicolas",
    "created_at": "2015-06-01T16:04:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147698",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:43 was]:
> If I had any employees who could work on Sage, this would definitely
> be a good thing to put in a top 5 list of ticket priorities.


We will definitely consider this in ODK. Actually the main reason we
did not put an explicit task about this is that I was (and still am)
hoping it would be finished before that. Writing the grant distracted
me away of working on it ...

Cheers,
                                    Nicolas



---

archive/issue_comments_147699.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> > Maybe jereon not wanting to run the source files directly is why this\n> > Ticket never got in?  I don't know.\n\n> No, it never got in Sage because it never actually worked.\n\nWell, see [comment:41]; it seemed pretty close from working. But of course the devil might be in the last bits to be polished.",
    "created_at": "2015-06-01T16:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147699",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:49 jdemeyer]:
> > Maybe jereon not wanting to run the source files directly is why this
> > Ticket never got in?  I don't know.

> No, it never got in Sage because it never actually worked.

Well, see [comment:41]; it seemed pretty close from working. But of course the devil might be in the last bits to be polished.



---

archive/issue_comments_147700.json:
```json
{
    "body": "I still don't understand what the problem is that this ticket is trying to fix.",
    "created_at": "2015-09-16T08:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147700",
    "user": "https://github.com/jdemeyer"
}
```

I still don't understand what the problem is that this ticket is trying to fix.



---

archive/issue_comments_147701.json:
```json
{
    "body": "Let's close this ticket as outdated. For a new approach to in-place builds / editable installs, see #30371.",
    "created_at": "2020-08-15T14:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147701",
    "user": "https://github.com/mkoeppe"
}
```

Let's close this ticket as outdated. For a new approach to in-place builds / editable installs, see #30371.



---

archive/issue_comments_147702.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-15T14:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147702",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_034316.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-15T14:26:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34316"
}
```



---

archive/issue_events_034317.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-15T14:26:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34317"
}
```



---

archive/issue_comments_147703.json:
```json
{
    "body": "Okay.",
    "created_at": "2020-08-16T03:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147703",
    "user": "https://github.com/jhpalmieri"
}
```

Okay.



---

archive/issue_comments_147704.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-16T03:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147704",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_147705.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-09-13T09:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12487#issuecomment-147705",
    "user": "https://github.com/fchapoton"
}
```

Resolution: invalid



---

archive/issue_events_034318.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-09-13T09:20:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12487",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12487#event-34318"
}
```
