# Issue 12267: multiply defined labels when using sagetex with multline

archive/issues_012095.json:
```json
{
    "body": "the following, distilled from a real example:\n\n```\n\n\\documentclass{article}\n\\usepackage{amsmath,amsthm,sagetex}\n\\begin{document}\n\\begin{sagesilent}\nd=4\n\\end{sagesilent}\n\\begin{multline}\n\\sage{(d)}=\\\\ \\sage{d}\n\\end{multline}\n\\end{document}\n```\nproduces the following sagetex.sout file:\n\n```\n% This file was *autogenerated* from s.sagetex.sage with\n % sagetex.py version 2011/05/27 v2.3.1\n\\newlabel{@sageinline0}{{%\n4}{}{}{}{}}\n\\newlabel{@sageinline1}{{%\n4}{}{}{}{}}\n\\newlabel{@sageinline0}{{%\n4}{}{}{}{}}\n\\newlabel{@sageinline1}{{%\n4}{}{}{}{}}\n%34f836090e6dc538159452d641440313% md5sum of corresponding .sage file (minus \"goboom\" and pause/unpause lines)\n```\nwhich clearly has spurrious parts, resulting in\n\n```\n...\nLaTeX Warning: Label `@sageinline0' multiply defined.\nLaTeX Warning: Label `@sageinline1' multiply defined.\n...\n```\nwhen running LaTeX for the 2nd, etc times.\n\nThis is fixed by the new SageTeX spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.3.p1.spkg. \n\n\nAssignee: @dandrake\n\nCC:  @dandrake @novoselt\n\nResolution: fixed\n\nAuthor: Dan Drake\n\nReviewer: Dmitrii Pasechnik\n\nMerged: sage-5.0.beta2\n\nIssue created by migration from https://trac.sagemath.org/ticket/12267\n\n",
    "closed_at": "2012-01-29T11:18:03Z",
    "created_at": "2012-01-05T17:14:50Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "multiply defined labels when using sagetex with multline",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12267",
    "user": "https://github.com/dimpase"
}
```
the following, distilled from a real example:

```

\documentclass{article}
\usepackage{amsmath,amsthm,sagetex}
\begin{document}
\begin{sagesilent}
d=4
\end{sagesilent}
\begin{multline}
\sage{(d)}=\\ \sage{d}
\end{multline}
\end{document}
```
produces the following sagetex.sout file:

```
% This file was *autogenerated* from s.sagetex.sage with
 % sagetex.py version 2011/05/27 v2.3.1
\newlabel{@sageinline0}{{%
4}{}{}{}{}}
\newlabel{@sageinline1}{{%
4}{}{}{}{}}
\newlabel{@sageinline0}{{%
4}{}{}{}{}}
\newlabel{@sageinline1}{{%
4}{}{}{}{}}
%34f836090e6dc538159452d641440313% md5sum of corresponding .sage file (minus "goboom" and pause/unpause lines)
```
which clearly has spurrious parts, resulting in

```
...
LaTeX Warning: Label `@sageinline0' multiply defined.
LaTeX Warning: Label `@sageinline1' multiply defined.
...
```
when running LaTeX for the 2nd, etc times.

This is fixed by the new SageTeX spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.3.p1.spkg. 


Assignee: @dandrake

CC:  @dandrake @novoselt

Resolution: fixed

Author: Dan Drake

Reviewer: Dmitrii Pasechnik

Merged: sage-5.0.beta2

Issue created by migration from https://trac.sagemath.org/ticket/12267





---

archive/issue_comments_172449.json:
```json
{
    "body": "<a id='comment:1'></a>This should be fixed: https://bitbucket.org/ddrake/sagetex/changeset/3840ae05d2a7\n\nWhat version of Sage / SageTeX are you using?",
    "created_at": "2012-01-06T02:14:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172449",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:1'></a>This should be fixed: https://bitbucket.org/ddrake/sagetex/changeset/3840ae05d2a7

What version of Sage / SageTeX are you using?



---

archive/issue_events_032757.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2012-01-06T02:37:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "milestone": "sage-4.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12267#event-32757"
}
```



---

archive/issue_comments_172450.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2012-01-06T02:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172450",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_172451.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 ddrake]:\n> This should be fixed: https://bitbucket.org/ddrake/sagetex/changeset/3840ae05d2a7\n> \n> What version of Sage / SageTeX are you using?\n\n\n2011/05/27 v2.3.1, in Sage 4.8.alpha4. Apparently you have  not merged that fix into Sage proper, nor even \"quite\" applied it on bitbucket, as cloning your repo by doing `hg clone https://bitbucket.org/ddrake/sagetex` from there also creates 2011/05/27 v2.3.1.",
    "created_at": "2012-01-06T02:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172451",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>Replying to [comment:1 ddrake]:
> This should be fixed: https://bitbucket.org/ddrake/sagetex/changeset/3840ae05d2a7
> 
> What version of Sage / SageTeX are you using?


2011/05/27 v2.3.1, in Sage 4.8.alpha4. Apparently you have  not merged that fix into Sage proper, nor even "quite" applied it on bitbucket, as cloning your repo by doing `hg clone https://bitbucket.org/ddrake/sagetex` from there also creates 2011/05/27 v2.3.1.



---

archive/issue_comments_172452.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 dimpase]:\n> 2011/05/27 v2.3.1, in Sage 4.8.alpha4. Apparently you have  not merged that fix into Sage proper, nor even \"quite\" applied it on bitbucket, as cloning your repo by doing `hg clone https://bitbucket.org/ddrake/sagetex` from there also creates 2011/05/27 v2.3.1. \n\n\nThat's just version numbers; when you clone the repo, you get all the changesets on bitbucket, which includes that one. I just haven't updated the version numbers, which I suppose I should have.\n\n4.8.alpha6 includes that changeset, so I'll look to see if something else is going on.",
    "created_at": "2012-01-06T04:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172452",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:3'></a>Replying to [comment:2 dimpase]:
> 2011/05/27 v2.3.1, in Sage 4.8.alpha4. Apparently you have  not merged that fix into Sage proper, nor even "quite" applied it on bitbucket, as cloning your repo by doing `hg clone https://bitbucket.org/ddrake/sagetex` from there also creates 2011/05/27 v2.3.1. 


That's just version numbers; when you clone the repo, you get all the changesets on bitbucket, which includes that one. I just haven't updated the version numbers, which I suppose I should have.

4.8.alpha6 includes that changeset, so I'll look to see if something else is going on.



---

archive/issue_comments_172453.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 ddrake]:\n> Replying to [comment:2 dimpase]:\n> > 2011/05/27 v2.3.1, in Sage 4.8.alpha4. Apparently you have  not merged that fix into Sage proper, nor even \"quite\" applied it on bitbucket, as cloning your repo by doing `hg clone https://bitbucket.org/ddrake/sagetex` from there also creates 2011/05/27 v2.3.1. \n\n> \n> That's just version numbers; when you clone the repo, you get all the changesets on bitbucket, which includes that one. I just haven't updated the version numbers, which I suppose I should have.\n> \n> 4.8.alpha6 includes that changeset, so I'll look to see if something else is going on. \n\n\nI can confirm that the bitbucket clone generates (via latex sagetex.ins) the same sagetex.sty as the one in Sage 4.8.alpha4.\nThus something did not get propagated somewhere...",
    "created_at": "2012-01-06T04:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172453",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>Replying to [comment:3 ddrake]:
> Replying to [comment:2 dimpase]:
> > 2011/05/27 v2.3.1, in Sage 4.8.alpha4. Apparently you have  not merged that fix into Sage proper, nor even "quite" applied it on bitbucket, as cloning your repo by doing `hg clone https://bitbucket.org/ddrake/sagetex` from there also creates 2011/05/27 v2.3.1. 

> 
> That's just version numbers; when you clone the repo, you get all the changesets on bitbucket, which includes that one. I just haven't updated the version numbers, which I suppose I should have.
> 
> 4.8.alpha6 includes that changeset, so I'll look to see if something else is going on. 


I can confirm that the bitbucket clone generates (via latex sagetex.ins) the same sagetex.sty as the one in Sage 4.8.alpha4.
Thus something did not get propagated somewhere...



---

archive/issue_comments_172454.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 dimpase]:\n> Thus something did not get propagated somewhere...\n\n\nNo, this isn't an issue of propagation. This is a new bug. And it's very interesting. Here's part of the `.sage` file that gets generated:\n\n```\ntry:\n _st_.inline(0, latex((d)))\nexcept:\n _st_.goboom(9)\ntry:\n _st_.inline(1, latex(d))\nexcept:\n _st_.goboom(9)\ntry:\n _st_.inline(0, latex((d)))\nexcept:\n _st_.goboom(9)\ntry:\n _st_.inline(1, latex(d))\nexcept:\n _st_.goboom(9)\n```\n\nIt does just `d`, and then `(d)`. Intriguing.\n\nWhat I do know is the those environments in the AMS classes evaluate their arguments in very strange ways, so this may be hard to pin down without knowing that code very well (which I certainly don't).",
    "created_at": "2012-01-06T04:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172454",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:5'></a>Replying to [comment:4 dimpase]:
> Thus something did not get propagated somewhere...


No, this isn't an issue of propagation. This is a new bug. And it's very interesting. Here's part of the `.sage` file that gets generated:

```
try:
 _st_.inline(0, latex((d)))
except:
 _st_.goboom(9)
try:
 _st_.inline(1, latex(d))
except:
 _st_.goboom(9)
try:
 _st_.inline(0, latex((d)))
except:
 _st_.goboom(9)
try:
 _st_.inline(1, latex(d))
except:
 _st_.goboom(9)
```

It does just `d`, and then `(d)`. Intriguing.

What I do know is the those environments in the AMS classes evaluate their arguments in very strange ways, so this may be hard to pin down without knowing that code very well (which I certainly don't).



---

archive/issue_comments_172455.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 ddrake]:\n> It does just `d`, and then `(d)`. Intriguing.\n\n\n*facepalm* Uh, not if I look again at your `.tex` file...nevermind about that.",
    "created_at": "2012-01-06T04:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172455",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:6'></a>Replying to [comment:5 ddrake]:
> It does just `d`, and then `(d)`. Intriguing.


*facepalm* Uh, not if I look again at your `.tex` file...nevermind about that.



---

archive/issue_comments_172456.json:
```json
{
    "body": "<a id='comment:7'></a>Aha!\n\nI can equal Rob Beezer's one-character patch. In fact, just a single bit needs to be changed: an `=` must be `<` (ASCII 0x3D to 0x3C; the least-significant bit gets flipped).\n\nThe problem is in my check to see if we've seen this label before; I didn't imagine that someone would (legitimately) use the same label twice in a single line. So `inline()` needs to check if the label it's asked to write is *less than or equal to*, instead of just equal to, the maximum label we've already written.",
    "created_at": "2012-01-06T05:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172456",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:7'></a>Aha!

I can equal Rob Beezer's one-character patch. In fact, just a single bit needs to be changed: an `=` must be `<` (ASCII 0x3D to 0x3C; the least-significant bit gets flipped).

The problem is in my check to see if we've seen this label before; I didn't imagine that someone would (legitimately) use the same label twice in a single line. So `inline()` needs to check if the label it's asked to write is *less than or equal to*, instead of just equal to, the maximum label we've already written.



---

archive/issue_comments_172457.json:
```json
{
    "body": "<a id='comment:8'></a>This should be fixed by https://bitbucket.org/ddrake/sagetex/changeset/6cc763c2b649.\n\nYou can try this yourself: in $SAGE_ROOT/local/lib/python/site-packages/sagetex.py, go to line 81 and change the `==` to `<=`.\n\nI suppose I should prep a new spkg and get that merged. Let me look into that.",
    "created_at": "2012-01-06T06:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172457",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:8'></a>This should be fixed by https://bitbucket.org/ddrake/sagetex/changeset/6cc763c2b649.

You can try this yourself: in $SAGE_ROOT/local/lib/python/site-packages/sagetex.py, go to line 81 and change the `==` to `<=`.

I suppose I should prep a new spkg and get that merged. Let me look into that.



---

archive/issue_comments_172458.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 ddrake]:\n> This should be fixed by https://bitbucket.org/ddrake/sagetex/changeset/6cc763c2b649.\n> \n> You can try this yourself: in $SAGE_ROOT/local/lib/python/site-packages/sagetex.py, go to line 81 and change the `==` to `<=`.\n> \n> I suppose I should prep a new spkg and get that merged. Let me look into that. \n\n\nOK, it looks good (and works with my \"real\" latex file). One thing about the new package: it would be good if the date and version in .sty file reflect the reality better than presently --- as you mention yourself in a comment above.",
    "created_at": "2012-01-07T07:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172458",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:8 ddrake]:
> This should be fixed by https://bitbucket.org/ddrake/sagetex/changeset/6cc763c2b649.
> 
> You can try this yourself: in $SAGE_ROOT/local/lib/python/site-packages/sagetex.py, go to line 81 and change the `==` to `<=`.
> 
> I suppose I should prep a new spkg and get that merged. Let me look into that. 


OK, it looks good (and works with my "real" latex file). One thing about the new package: it would be good if the date and version in .sty file reflect the reality better than presently --- as you mention yourself in a comment above.



---

archive/issue_comments_172459.json:
```json
{
    "body": "<a id='comment:10'></a>While working on this, I uncovered a more serious bug: I was using a single variable (`max_counter_seen`) but had two different label names -- `sageinline` and `sagecmdline`. So after doing, say, 5 \"inlines\", `max_counter_seen` would be 5, and then if you did a sagecmdline, it would see a counter of 1 and not do anything!\n\nSo, we need to keep track of the label name as well as the maximum counter we've seen.\n\nI also improved the version mismatch checking so that it works with arbitrarily old versions of `sagetex.sty`, so in particular people with Debian's TeXLive 2009 packages will be warned of version mismatches. This fixes #8035.\n\nNew spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.3.p1.spkg.",
    "created_at": "2012-01-16T06:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172459",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:10'></a>While working on this, I uncovered a more serious bug: I was using a single variable (`max_counter_seen`) but had two different label names -- `sageinline` and `sagecmdline`. So after doing, say, 5 "inlines", `max_counter_seen` would be 5, and then if you did a sagecmdline, it would see a counter of 1 and not do anything!

So, we need to keep track of the label name as well as the maximum counter we've seen.

I also improved the version mismatch checking so that it works with arbitrarily old versions of `sagetex.sty`, so in particular people with Debian's TeXLive 2009 packages will be warned of version mismatches. This fixes #8035.

New spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.3.p1.spkg.



---

archive/issue_comments_172460.json:
```json
{
    "body": "Changing author from \"\" to \"Dan Drake\"",
    "created_at": "2012-01-16T06:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172460",
    "user": "https://github.com/dandrake"
}
```

Changing author from "" to "Dan Drake"



---

archive/issue_comments_172461.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-01-16T06:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172461",
    "user": "https://github.com/dandrake"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_172462.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -38,3 +38,5 @@\n ```\n when running LaTeX for the 2nd, etc times.\n \n+This is fixed by the new SageTeX spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.3.p1.spkg. \n+\n``````\n",
    "created_at": "2012-01-16T07:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172462",
    "user": "https://github.com/dandrake"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -38,3 +38,5 @@
 ```
 when running LaTeX for the 2nd, etc times.
 
+This is fixed by the new SageTeX spkg: http://sage.math.washington.edu/home/drake/code/sage/st/sagetex-2.3.3.p1.spkg. 
+
``````




---

archive/issue_comments_172463.json:
```json
{
    "body": "Changing assignee from @jasongrout to @dandrake.",
    "created_at": "2012-01-16T07:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172463",
    "user": "https://github.com/dandrake"
}
```

Changing assignee from @jasongrout to @dandrake.



---

archive/issue_comments_172464.json:
```json
{
    "body": "<a id='comment:12'></a>Here are the key patches to look at to review the changes:\n\nhttps://bitbucket.org/ddrake/sagetex/changeset/38ad59143e7e for new version checking. The new system does not rely on special bits written to the `.sage` file; rather, the SageTeX module looks for keyword arguments -- and if it doesn't get them, it knows it has an old version.\n\nhttps://bitbucket.org/ddrake/sagetex/changeset/1603bbb82390 for the new label stuff. I now use a (special subclass of) dictionary to keep track of the counters and their corresponding labels. (You'll need to use \"side-by-side view to look at `py-and-sty.dtx`, for some reason.)",
    "created_at": "2012-01-16T07:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172464",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:12'></a>Here are the key patches to look at to review the changes:

https://bitbucket.org/ddrake/sagetex/changeset/38ad59143e7e for new version checking. The new system does not rely on special bits written to the `.sage` file; rather, the SageTeX module looks for keyword arguments -- and if it doesn't get them, it knows it has an old version.

https://bitbucket.org/ddrake/sagetex/changeset/1603bbb82390 for the new label stuff. I now use a (special subclass of) dictionary to keep track of the counters and their corresponding labels. (You'll need to use "side-by-side view to look at `py-and-sty.dtx`, for some reason.)



---

archive/issue_comments_172465.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-21T06:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172465",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_172466.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 ddrake]:\n> Here are the key patches to look at to review the changes:\n> \n> https://bitbucket.org/ddrake/sagetex/changeset/38ad59143e7e for new version checking. The new system does not rely on special bits written to the `.sage` file; rather, the SageTeX module looks for keyword arguments -- and if it doesn't get them, it knows it has an old version.\n> \n> https://bitbucket.org/ddrake/sagetex/changeset/1603bbb82390 for the new label stuff. I now use a (special subclass of) dictionary to keep track of the counters and their corresponding labels. (You'll need to use \"side-by-side view to look at `py-and-sty.dtx`, for some reason.)\n\n\nLooks good to me, positive review.\n\nWhile I am at is, it occurred to me: how  about  integrating installing the (La)TeX part of the spkg into the corresponding subtree of TeX Live. Indeed, `texconfig conf | grep TEXMFLOCAL` provides you with the location of the local portion of texmf, where one can put the stuff as you please (provided you have the right permissions, of course --- otherwise one can use TEXMFHOME location instead), and them run `texhash`...",
    "created_at": "2012-01-21T06:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172466",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>Replying to [comment:12 ddrake]:
> Here are the key patches to look at to review the changes:
> 
> https://bitbucket.org/ddrake/sagetex/changeset/38ad59143e7e for new version checking. The new system does not rely on special bits written to the `.sage` file; rather, the SageTeX module looks for keyword arguments -- and if it doesn't get them, it knows it has an old version.
> 
> https://bitbucket.org/ddrake/sagetex/changeset/1603bbb82390 for the new label stuff. I now use a (special subclass of) dictionary to keep track of the counters and their corresponding labels. (You'll need to use "side-by-side view to look at `py-and-sty.dtx`, for some reason.)


Looks good to me, positive review.

While I am at is, it occurred to me: how  about  integrating installing the (La)TeX part of the spkg into the corresponding subtree of TeX Live. Indeed, `texconfig conf | grep TEXMFLOCAL` provides you with the location of the local portion of texmf, where one can put the stuff as you please (provided you have the right permissions, of course --- otherwise one can use TEXMFHOME location instead), and them run `texhash`...



---

archive/issue_comments_172467.json:
```json
{
    "body": "<a id='comment:15'></a>Personally, I think that the best way to use SageTeX is to copy sagetex.sty into the folder with the main *.tex file. This eliminates or at least reduces issues with version incompatibility and allows easy distribution of such papers - you can send everything in that folder to your colleague and it will compile without necessity to have Sage or SageTeX installed.",
    "created_at": "2012-01-21T16:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172467",
    "user": "https://github.com/novoselt"
}
```

<a id='comment:15'></a>Personally, I think that the best way to use SageTeX is to copy sagetex.sty into the folder with the main *.tex file. This eliminates or at least reduces issues with version incompatibility and allows easy distribution of such papers - you can send everything in that folder to your colleague and it will compile without necessity to have Sage or SageTeX installed.



---

archive/issue_comments_172468.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dmitrii Pasechnik\"",
    "created_at": "2012-01-21T16:25:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172468",
    "user": "https://github.com/novoselt"
}
```

Changing reviewer from "" to "Dmitrii Pasechnik"



---

archive/issue_comments_172469.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:14 dimpase]:\n> While I am at is, it occurred to me: how  about  integrating installing the (La)TeX part of the spkg into the corresponding subtree of TeX Live. Indeed, `texconfig conf | grep TEXMFLOCAL` provides you with the location of the local portion of texmf, where one can put the stuff as you please (provided you have the right permissions, of course --- otherwise one can use TEXMFHOME location instead), and them run `texhash`...\n\n\nThat's a nice idea, but doing that automatically poses several problems: first, Sage does not mess with anything outside SAGE_ROOT when building. Second, while it wouldn't be too difficult to get TEXMFLOCAL and install, that directory tree will likely be owned by root, and we could try to run `sudo`...but would that work on Solaris?\n\nI could write a little script that automates that installation. Does that sound like a good idea? Although I do wonder how users will find the script...",
    "created_at": "2012-01-22T02:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172469",
    "user": "https://github.com/dandrake"
}
```

<a id='comment:16'></a>Replying to [comment:14 dimpase]:
> While I am at is, it occurred to me: how  about  integrating installing the (La)TeX part of the spkg into the corresponding subtree of TeX Live. Indeed, `texconfig conf | grep TEXMFLOCAL` provides you with the location of the local portion of texmf, where one can put the stuff as you please (provided you have the right permissions, of course --- otherwise one can use TEXMFHOME location instead), and them run `texhash`...


That's a nice idea, but doing that automatically poses several problems: first, Sage does not mess with anything outside SAGE_ROOT when building. Second, while it wouldn't be too difficult to get TEXMFLOCAL and install, that directory tree will likely be owned by root, and we could try to run `sudo`...but would that work on Solaris?

I could write a little script that automates that installation. Does that sound like a good idea? Although I do wonder how users will find the script...



---

archive/issue_comments_172470.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 ddrake]:\n> Replying to [comment:14 dimpase]:\n> > While I am at is, it occurred to me: how  about  integrating installing the (La)TeX part of the spkg into the corresponding subtree of TeX Live. Indeed, `texconfig conf | grep TEXMFLOCAL` provides you with the location of the local portion of texmf, where one can put the stuff as you please (provided you have the right permissions, of course --- otherwise one can use TEXMFHOME location instead), and them run `texhash`...\n\n> \n> That's a nice idea, but doing that automatically poses several problems: first, Sage does not mess with anything outside SAGE_ROOT when building. Second, while it wouldn't be too difficult to get TEXMFLOCAL and install, that directory tree will likely be owned by root, and we could try to run `sudo`...but would that work on Solaris?\n> \n> I could write a little script that automates that installation. Does that sound like a good idea? Although I do wonder how users will find the script... \n\n\nSage itself has install_scripts().\nMaybe the script you propose should be a part of it?",
    "created_at": "2012-01-23T10:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172470",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>Replying to [comment:16 ddrake]:
> Replying to [comment:14 dimpase]:
> > While I am at is, it occurred to me: how  about  integrating installing the (La)TeX part of the spkg into the corresponding subtree of TeX Live. Indeed, `texconfig conf | grep TEXMFLOCAL` provides you with the location of the local portion of texmf, where one can put the stuff as you please (provided you have the right permissions, of course --- otherwise one can use TEXMFHOME location instead), and them run `texhash`...

> 
> That's a nice idea, but doing that automatically poses several problems: first, Sage does not mess with anything outside SAGE_ROOT when building. Second, while it wouldn't be too difficult to get TEXMFLOCAL and install, that directory tree will likely be owned by root, and we could try to run `sudo`...but would that work on Solaris?
> 
> I could write a little script that automates that installation. Does that sound like a good idea? Although I do wonder how users will find the script... 


Sage itself has install_scripts().
Maybe the script you propose should be a part of it?



---

archive/issue_events_032758.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-01-29T11:18:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12267#event-32758"
}
```



---

archive/issue_comments_172471.json:
```json
{
    "body": "Changing merged from \"\" to \"sage-5.0.beta2\"",
    "created_at": "2012-01-29T11:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172471",
    "user": "https://github.com/jdemeyer"
}
```

Changing merged from "" to "sage-5.0.beta2"



---

archive/issue_comments_172472.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-01-29T11:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-172472",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
