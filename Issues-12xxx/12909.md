# Issue 12909: gdmodule: don't use /sw and /usr/local paths

archive/issues_012737.json:
```json
{
    "body": "The `gdmodule` spkg should not use `/sw/include` as include path, as some Fink stuff there can interfere badly with Sage.  Analogously, we shouldn't use `/usr/local/include`.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gdmodule-0.56.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gdmodule-0.56.p8.spkg)\n([attachment:gdmodule-0.56.p7-p8.diff diff])\n\n### gdmodule-0.56.p8 (Robert Bradshaw, Jeroen Demeyer, 6 May 2012)\n* Trac #12909: Setup.py: don't use non-system prefixes\n  /sw and /usr/local to look for include files or libraries.\n* Use standard template for spkg-install, use patch for patching.\n* Restore upstream sources.  The pre-existing changes to src/Setup.py\n  have been moved to Setup.py.patch\n* _gdmodule.c: Undo change of #include <gd.h> to #include \"gd.h\"\n\n\nAssignee: tbd\n\nReviewer: Volker Braun\n\nAuthor: Robert Bradshaw, Jeroen Demeyer\n\nMerged: sage-5.0.rc1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12909\n\n",
    "closed_at": "2012-05-08T20:30:17Z",
    "created_at": "2012-05-05T21:02:25Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "gdmodule: don't use /sw and /usr/local paths",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12909",
    "user": "https://github.com/jdemeyer"
}
```
The `gdmodule` spkg should not use `/sw/include` as include path, as some Fink stuff there can interfere badly with Sage.  Analogously, we shouldn't use `/usr/local/include`.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/gdmodule-0.56.p8.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/gdmodule-0.56.p8.spkg)
([attachment:gdmodule-0.56.p7-p8.diff diff])

### gdmodule-0.56.p8 (Robert Bradshaw, Jeroen Demeyer, 6 May 2012)
* Trac #12909: Setup.py: don't use non-system prefixes
  /sw and /usr/local to look for include files or libraries.
* Use standard template for spkg-install, use patch for patching.
* Restore upstream sources.  The pre-existing changes to src/Setup.py
  have been moved to Setup.py.patch
* _gdmodule.c: Undo change of #include <gd.h> to #include "gd.h"


Assignee: tbd

Reviewer: Volker Braun

Author: Robert Bradshaw, Jeroen Demeyer

Merged: sage-5.0.rc1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12909





---

archive/issue_comments_152361.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-05T22:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152361",
    "user": "https://github.com/robertwb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_152362.json:
```json
{
    "body": "<a id='comment:1'></a>New spkg up at http://sage.math.washington.edu/home/robertwb/patches/gdmodule-0.56.p8.spkg",
    "created_at": "2012-05-05T22:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152362",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>New spkg up at http://sage.math.washington.edu/home/robertwb/patches/gdmodule-0.56.p8.spkg



---

archive/issue_comments_152363.json:
```json
{
    "body": "<a id='comment:2'></a>```\nrobertwb-macbookpro:standard robertwb$ diff -u -r gdmodule-0.56.p7 gdmodule-0.56.p8 | grep -v '/.hg'\ndiff -u -r gdmodule-0.56.p7/patches/Setup.py gdmodule-0.56.p8/patches/Setup.py\n--- gdmodule-0.56.p7/patches/Setup.py\t2012-05-05 15:14:01.000000000 -0700\n+++ gdmodule-0.56.p8/patches/Setup.py\t2012-05-05 15:15:00.000000000 -0700\n@@ -41,7 +41,7 @@\n \n libdirs = dirtest([\n     os.environ[\"SAGE_LOCAL\"]+\"/lib\",\n-    \"/usr/local/lib\", \"/sw/lib\", \"/usr/lib\",\n+    \"/usr/local/lib\", \"/usr/lib\",\n     \"/usr/lib/X11\", \"/usr/X11R6/lib\",\n     \"/opt/gnome/lib\",\n ])\n@@ -51,7 +51,7 @@\n \n incdirs = dirtest([\n     os.environ[\"SAGE_LOCAL\"]+\"/include\",\n-    \"/usr/local/include\", \"/sw/include\", \"/usr/include\",\n+    \"/usr/local/include\", \"/usr/include\",\n     \"/usr/include/X11\", \"/usr/X11R6/include\",\n     \"/opt/gnome/include\",\n ])\ndiff -u -r gdmodule-0.56.p7/patches/Setup.py.patch gdmodule-0.56.p8/patches/Setup.py.patch\n--- gdmodule-0.56.p7/patches/Setup.py.patch\t2012-05-05 15:14:01.000000000 -0700\n+++ gdmodule-0.56.p8/patches/Setup.py.patch\t2012-05-05 15:15:46.000000000 -0700\n@@ -1,5 +1,23 @@\n---- ../src/Setup.py\t2007-01-10 10:23:03.000000000 -0800\n-+++ Setup.py\t2010-04-06 11:16:30.316434351 -0700\n+--- ../src/Setup.py\t2012-05-05 15:14:14.000000000 -0700\n++++ Setup.py\t2012-05-05 15:15:00.000000000 -0700\n+@@ -41,7 +41,7 @@\n+ \n+ libdirs = dirtest([\n+     os.environ[\"SAGE_LOCAL\"]+\"/lib\",\n+-    \"/usr/local/lib\", \"/sw/lib\", \"/usr/lib\",\n++    \"/usr/local/lib\", \"/usr/lib\",\n+     \"/usr/lib/X11\", \"/usr/X11R6/lib\",\n+     \"/opt/gnome/lib\",\n+ ])\n+@@ -51,7 +51,7 @@\n+ \n+ incdirs = dirtest([\n+     os.environ[\"SAGE_LOCAL\"]+\"/include\",\n+-    \"/usr/local/include\", \"/sw/include\", \"/usr/include\",\n++    \"/usr/local/include\", \"/usr/include\",\n+     \"/usr/include/X11\", \"/usr/X11R6/include\",\n+     \"/opt/gnome/include\",\n+ ])\n @@ -61,13 +61,12 @@\n  import os\n  if os.uname()[0][:6] == \"CYGWIN\":\n```",
    "created_at": "2012-05-05T22:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152363",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:2'></a>```
robertwb-macbookpro:standard robertwb$ diff -u -r gdmodule-0.56.p7 gdmodule-0.56.p8 | grep -v '/.hg'
diff -u -r gdmodule-0.56.p7/patches/Setup.py gdmodule-0.56.p8/patches/Setup.py
--- gdmodule-0.56.p7/patches/Setup.py	2012-05-05 15:14:01.000000000 -0700
+++ gdmodule-0.56.p8/patches/Setup.py	2012-05-05 15:15:00.000000000 -0700
@@ -41,7 +41,7 @@
 
 libdirs = dirtest([
     os.environ["SAGE_LOCAL"]+"/lib",
-    "/usr/local/lib", "/sw/lib", "/usr/lib",
+    "/usr/local/lib", "/usr/lib",
     "/usr/lib/X11", "/usr/X11R6/lib",
     "/opt/gnome/lib",
 ])
@@ -51,7 +51,7 @@
 
 incdirs = dirtest([
     os.environ["SAGE_LOCAL"]+"/include",
-    "/usr/local/include", "/sw/include", "/usr/include",
+    "/usr/local/include", "/usr/include",
     "/usr/include/X11", "/usr/X11R6/include",
     "/opt/gnome/include",
 ])
diff -u -r gdmodule-0.56.p7/patches/Setup.py.patch gdmodule-0.56.p8/patches/Setup.py.patch
--- gdmodule-0.56.p7/patches/Setup.py.patch	2012-05-05 15:14:01.000000000 -0700
+++ gdmodule-0.56.p8/patches/Setup.py.patch	2012-05-05 15:15:46.000000000 -0700
@@ -1,5 +1,23 @@
---- ../src/Setup.py	2007-01-10 10:23:03.000000000 -0800
-+++ Setup.py	2010-04-06 11:16:30.316434351 -0700
+--- ../src/Setup.py	2012-05-05 15:14:14.000000000 -0700
++++ Setup.py	2012-05-05 15:15:00.000000000 -0700
+@@ -41,7 +41,7 @@
+ 
+ libdirs = dirtest([
+     os.environ["SAGE_LOCAL"]+"/lib",
+-    "/usr/local/lib", "/sw/lib", "/usr/lib",
++    "/usr/local/lib", "/usr/lib",
+     "/usr/lib/X11", "/usr/X11R6/lib",
+     "/opt/gnome/lib",
+ ])
+@@ -51,7 +51,7 @@
+ 
+ incdirs = dirtest([
+     os.environ["SAGE_LOCAL"]+"/include",
+-    "/usr/local/include", "/sw/include", "/usr/include",
++    "/usr/local/include", "/usr/include",
+     "/usr/include/X11", "/usr/X11R6/include",
+     "/opt/gnome/include",
+ ])
 @@ -61,13 +61,12 @@
  import os
  if os.uname()[0][:6] == "CYGWIN":
```



---

archive/issue_comments_152364.json:
```json
{
    "body": "<a id='comment:4'></a>I did some further clean-up of the SPKG, needs review.",
    "created_at": "2012-05-05T23:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152364",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>I did some further clean-up of the SPKG, needs review.



---

archive/issue_comments_152365.json:
```json
{
    "body": "<a id='comment:7'></a>Looks good to me. Positive review if you commit the changes...",
    "created_at": "2012-05-07T14:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152365",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>Looks good to me. Positive review if you commit the changes...



---

archive/issue_comments_152366.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-07T14:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152366",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_152367.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 vbraun]:\n> Looks good to me. Positive review if you commit the changes...\n\nDone.",
    "created_at": "2012-05-07T14:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152367",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:7 vbraun]:
> Looks good to me. Positive review if you commit the changes...

Done.



---

archive/issue_comments_152368.json:
```json
{
    "body": "<a id='comment:10'></a>libdirs field in setup.py still has /usr/local/lib in it.\nIs it on purpose?",
    "created_at": "2012-05-07T15:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152368",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>libdirs field in setup.py still has /usr/local/lib in it.
Is it on purpose?



---

archive/issue_comments_152369.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 dimpase]:\n> libdirs field in setup.py still has /usr/local/lib in it.\n> Is it on purpose?\n\n\nNo, that's a mistake.",
    "created_at": "2012-05-07T15:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152369",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 dimpase]:
> libdirs field in setup.py still has /usr/local/lib in it.
> Is it on purpose?


No, that's a mistake.



---

archive/issue_comments_152370.json:
```json
{
    "body": "Attachment [gdmodule-0.56.p7-p8.diff](tarball://root/attachments/some-uuid/ticket12909/gdmodule-0.56.p7-p8.diff) by @jdemeyer created at 2012-05-07 15:19:32",
    "created_at": "2012-05-07T15:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152370",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [gdmodule-0.56.p7-p8.diff](tarball://root/attachments/some-uuid/ticket12909/gdmodule-0.56.p7-p8.diff) by @jdemeyer created at 2012-05-07 15:19:32



---

archive/issue_comments_152371.json:
```json
{
    "body": "<a id='comment:12'></a>Fixed.",
    "created_at": "2012-05-07T15:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152371",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Fixed.



---

archive/issue_events_035276.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-05-08T20:30:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12909#event-35276"
}
```



---

archive/issue_comments_152372.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-05-08T20:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12909#issuecomment-152372",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
