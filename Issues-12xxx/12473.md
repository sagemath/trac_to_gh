# Issue 12473: Remove nested functions in ratpoints

archive/issues_012301.json:
```json
{
    "body": "these won't work for most other compilers besides GCC.\n\nAssignee: GeorgSWeber\n\nCC:  @kiwifb\n\nUpstream: Reported upstream. No feedback yet.\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Dima Pasechnik\n\nBranch: dae689cd2b3f68a703fc8c00ae8bb942d653e464\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/12473\n\n",
    "closed_at": "2016-10-03T22:41:58Z",
    "created_at": "2012-02-08T16:00:54Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Remove nested functions in ratpoints",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12473",
    "user": "https://github.com/ohanar"
}
```
these won't work for most other compilers besides GCC.

Assignee: GeorgSWeber

CC:  @kiwifb

Upstream: Reported upstream. No feedback yet.

Reviewer: Fran√ßois Bissey

Author: Dima Pasechnik

Branch: dae689cd2b3f68a703fc8c00ae8bb942d653e464

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/12473





---

archive/issue_events_033613.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33613"
}
```



---

archive/issue_events_033614.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33614"
}
```



---

archive/issue_events_033615.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33615"
}
```



---

archive/issue_events_033616.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33616"
}
```



---

archive/issue_events_033617.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33617"
}
```



---

archive/issue_events_033618.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33618"
}
```



---

archive/issue_events_033619.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33619"
}
```



---

archive/issue_events_033620.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-09-24T00:15:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33620"
}
```



---

archive/issue_events_033621.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2016-09-24T00:15:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33621"
}
```



---

archive/issue_comments_153424.json:
```json
{
    "body": "<a id='comment:5'></a>here is a fix : http://users.ox.ac.uk/~coml0531/sage/ratpoints-2.1.3.tar.bz2\n(I moved the only nested function outside; it works with gcc, and passes the tests (in sage)). Wonder how it goes with clang...\n\nStill needs a bit of cleaning.",
    "created_at": "2016-09-24T00:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153424",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>here is a fix : http://users.ox.ac.uk/~coml0531/sage/ratpoints-2.1.3.tar.bz2
(I moved the only nested function outside; it works with gcc, and passes the tests (in sage)). Wonder how it goes with clang...

Still needs a bit of cleaning.



---

archive/issue_comments_153425.json:
```json
{
    "body": "<a id='comment:6'></a>Seems to works. I'll work on turning into a patch later.",
    "created_at": "2016-09-24T02:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153425",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>Seems to works. I'll work on turning into a patch later.



---

archive/issue_comments_153426.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-25T17:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153426",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_153427.json:
```json
{
    "body": "<a id='comment:7'></a>here is a cleaned up patch, with more const qualifiers added.\n\n---\nNew commits:",
    "created_at": "2016-09-25T17:32:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153427",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>here is a cleaned up patch, with more const qualifiers added.

---
New commits:



---

archive/issue_comments_153428.json:
```json
{
    "body": "<a id='comment:8'></a>Just touching `spkg-install` since `-fnested-functions` is not needed anywhere anymore.\n\n---\nNew commits:",
    "created_at": "2016-09-29T21:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153428",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:8'></a>Just touching `spkg-install` since `-fnested-functions` is not needed anywhere anymore.

---
New commits:



---

archive/issue_comments_153429.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-29T21:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153429",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153430.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks!",
    "created_at": "2016-09-29T21:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153430",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Thanks!



---

archive/issue_comments_153431.json:
```json
{
    "body": "<a id='comment:12'></a>I meant to do that ;)",
    "created_at": "2016-09-29T21:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153431",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>I meant to do that ;)



---

archive/issue_comments_153432.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-09-30T11:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153432",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_153433.json:
```json
{
    "body": "<a id='comment:13'></a>You should bump the package version number if you make non-trivial changes.",
    "created_at": "2016-09-30T11:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153433",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>You should bump the package version number if you make non-trivial changes.



---

archive/issue_comments_153434.json:
```json
{
    "body": "Changing component from build to packages: standard.",
    "created_at": "2016-09-30T11:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153434",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from build to packages: standard.



---

archive/issue_comments_153435.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-these won't work for most other compilers\n+these won't work for most other compilers besides GCC.\n \n Comment: 1\n \n``````\n",
    "created_at": "2016-09-30T11:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153435",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-these won't work for most other compilers
+these won't work for most other compilers besides GCC.
 
 Comment: 1
 
``````




---

archive/issue_comments_153436.json:
```json
{
    "body": "<a id='comment:15'></a>Actually, I have the feeling something is missing on this branch, since it *only* changes `CCFLAGS` but nothing else.",
    "created_at": "2016-09-30T11:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153436",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>Actually, I have the feeling something is missing on this branch, since it *only* changes `CCFLAGS` but nothing else.



---

archive/issue_comments_153437.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 jdemeyer]:\n> Actually, I have the feeling something is missing on this branch, since it *only* changes `CCFLAGS` but nothing else.\n\n\nFrancois, the ball is in your court now... (you didn't ask for a review too :))",
    "created_at": "2016-09-30T16:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153437",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Replying to [comment:15 jdemeyer]:
> Actually, I have the feeling something is missing on this branch, since it *only* changes `CCFLAGS` but nothing else.


Francois, the ball is in your court now... (you didn't ask for a review too :))



---

archive/issue_comments_153438.json:
```json
{
    "body": "<a id='comment:17'></a>Yes indeed, it looks like I messed up when importing Dima's branch.\n\nAs for the version bump. Yes I know we could do that. But really we didn't change any functionality, we just made it possible to compile with other compilers. But OK the patch is not trivial.",
    "created_at": "2016-09-30T19:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153438",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:17'></a>Yes indeed, it looks like I messed up when importing Dima's branch.

As for the version bump. Yes I know we could do that. But really we didn't change any functionality, we just made it possible to compile with other compilers. But OK the patch is not trivial.



---

archive/issue_comments_153439.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-01T02:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_153440.json:
```json
{
    "body": "<a id='comment:19'></a>Should all be better now.",
    "created_at": "2016-10-01T02:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153440",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:19'></a>Should all be better now.



---

archive/issue_comments_153441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-01T02:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153441",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153442.json:
```json
{
    "body": "<a id='comment:20'></a>OK, looks good.",
    "created_at": "2016-10-01T15:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153442",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>OK, looks good.



---

archive/issue_comments_153443.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-01T15:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153443",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153444.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:17 fbissey]:\n> As for the version bump. Yes I know we could do that. But really we didn't change any functionality, we just made it possible to compile with other compilers. But OK the patch is not trivial.\n\n\nThe reason I asked for this is mainly to increase testing coverage. If you bump the version, then everybody who upgrades Sage will rebuild the package with the new patch.",
    "created_at": "2016-10-01T17:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153444",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>Replying to [comment:17 fbissey]:
> As for the version bump. Yes I know we could do that. But really we didn't change any functionality, we just made it possible to compile with other compilers. But OK the patch is not trivial.


The reason I asked for this is mainly to increase testing coverage. If you bump the version, then everybody who upgrades Sage will rebuild the package with the new patch.



---

archive/issue_events_033622.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-10-03T22:41:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12473#event-33622"
}
```



---

archive/issue_comments_153445.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-03T22:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153445",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_153446.json:
```json
{
    "body": "<a id='comment:24'></a>Just commenting that the functionality that `ratpoints` provides should be replaced with PARI. It seems that PARI is slowly replacing all number-theoretical packages inside Sage. This already happened with `genus2red` and it should be possible for `lcalc` and `ratpoints` too.",
    "created_at": "2018-01-12T14:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153446",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Just commenting that the functionality that `ratpoints` provides should be replaced with PARI. It seems that PARI is slowly replacing all number-theoretical packages inside Sage. This already happened with `genus2red` and it should be possible for `lcalc` and `ratpoints` too.



---

archive/issue_comments_153447.json:
```json
{
    "body": "<a id='comment:25'></a>replacing sounds a bit drastic; adding another backend?",
    "created_at": "2018-01-12T22:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153447",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>replacing sounds a bit drastic; adding another backend?



---

archive/issue_comments_153448.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 dimpase]:\n> replacing sounds a bit drastic; adding another backend?\n\n\nHonestly, it doesn't. Reducing your number of dependencies because another one, better maintained, can provide the same functionality is not controversial in my opinion. Who doesn't like less maintenance.",
    "created_at": "2018-01-13T02:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153448",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:26'></a>Replying to [comment:25 dimpase]:
> replacing sounds a bit drastic; adding another backend?


Honestly, it doesn't. Reducing your number of dependencies because another one, better maintained, can provide the same functionality is not controversial in my opinion. Who doesn't like less maintenance.



---

archive/issue_comments_153449.json:
```json
{
    "body": "<a id='comment:27'></a>ratpoints implements a very tricky mathematics, not something anybody can write. Having more than one implementation is a blessing.",
    "created_at": "2018-01-13T10:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153449",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>ratpoints implements a very tricky mathematics, not something anybody can write. Having more than one implementation is a blessing.



---

archive/issue_comments_153450.json:
```json
{
    "body": "<a id='comment:28'></a>I opened #24531 for that, by the way.",
    "created_at": "2018-01-14T09:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153450",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>I opened #24531 for that, by the way.



---

archive/issue_comments_153451.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 dimpase]:\n> ratpoints implements a very tricky mathematics, not something anybody can write.\n\n\nThe PARI developers are not just \"anybody\" :-) I trust that they know number theory. Besides, the way that I understand things, the code in PARI is actually based on this `ratpoints` package. They didn't write it from scratch.",
    "created_at": "2018-01-14T14:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153451",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:29'></a>Replying to [comment:27 dimpase]:
> ratpoints implements a very tricky mathematics, not something anybody can write.


The PARI developers are not just "anybody" :-) I trust that they know number theory. Besides, the way that I understand things, the code in PARI is actually based on this `ratpoints` package. They didn't write it from scratch.



---

archive/issue_comments_153452.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:26 fbissey]:\n> Replying to [comment:25 dimpase]:\n> > replacing sounds a bit drastic; adding another backend?\n\n> \n> Honestly, it doesn't. Reducing your number of dependencies because another one, better maintained\n\n\n\"better\" maintained? I don't think that `ratpoints` is maintained *at all* given that the latest release is from 2011.",
    "created_at": "2018-01-14T14:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12473",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12473#issuecomment-153452",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>Replying to [comment:26 fbissey]:
> Replying to [comment:25 dimpase]:
> > replacing sounds a bit drastic; adding another backend?

> 
> Honestly, it doesn't. Reducing your number of dependencies because another one, better maintained


"better" maintained? I don't think that `ratpoints` is maintained *at all* given that the latest release is from 2011.
