# Issue 12347: make install broken in Sage 4.8

archive/issues_012175.json:
```json
{
    "assignees": [],
    "body": "when I compile Sage 4.8 from source in say `/tmp/sage-4.8`, then\nI do `make install DESTDIR=/usr/local/sage-4.8`, and I run the binary `/usr/local/sage-4.8/bin/sage` I get:\n\n```\n[zimmerma@coing ~]$ /usr/local/sage-4.8/bin/sage\n************************************************************************\nYou must compile Sage first using 'make' in the Sage root directory.\n(If you have already compiled Sage, you must set the SAGE_ROOT variable\nin the file '/usr/local/sage-4.8/bin/sage').\n************************************************************************\n```\nThis way of compiling and installing Sage worked before, up to Sage 4.7.2.\n\nA fix is to add the line\n\n```\nSAGE_ROOT=\"/usr/local/sage-4.8/sage\n```\nin the script `/usr/local/sage-4.8/bin/sage`. This was done\nautomatically by `make install` up to 4.7.2, and was broken in Sage 4.8.\n\nPaul\n\n---\nHard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.\n\n1. Apply [attachment: trac_12347-remove-sage-hardcode.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347-remove-sage-hardcode.patch.gz) to `SAGE_ROOT/local/bin`\n\n2. Apply [attachment: trac_12347.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz) to `SAGE_ROOT`\n\nAssignee: **@sagetrac-GeorgSWeber**\n\nReviewer: **Jeroen Demeyer, Paul Zimmermann**\n\nAuthor: **Punarbasu Purkayastha**\n\nMerged: **sage-5.0.beta14**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/12347_\n\n",
    "closed_at": "2012-04-19T08:10:27Z",
    "created_at": "2012-01-24T08:00:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.0",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "make install broken in Sage 4.8",
    "type": "issue",
    "updated_at": "2012-04-19T08:10:27Z",
    "url": "https://github.com/sagemath/sage/issues/12347",
    "user": "https://github.com/zimmermann6"
}
```
when I compile Sage 4.8 from source in say `/tmp/sage-4.8`, then
I do `make install DESTDIR=/usr/local/sage-4.8`, and I run the binary `/usr/local/sage-4.8/bin/sage` I get:

```
[zimmerma@coing ~]$ /usr/local/sage-4.8/bin/sage
************************************************************************
You must compile Sage first using 'make' in the Sage root directory.
(If you have already compiled Sage, you must set the SAGE_ROOT variable
in the file '/usr/local/sage-4.8/bin/sage').
************************************************************************
```
This way of compiling and installing Sage worked before, up to Sage 4.7.2.

A fix is to add the line

```
SAGE_ROOT="/usr/local/sage-4.8/sage
```
in the script `/usr/local/sage-4.8/bin/sage`. This was done
automatically by `make install` up to 4.7.2, and was broken in Sage 4.8.

Paul

---
Hard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.

1. Apply [attachment: trac_12347-remove-sage-hardcode.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347-remove-sage-hardcode.patch.gz) to `SAGE_ROOT/local/bin`

2. Apply [attachment: trac_12347.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz) to `SAGE_ROOT`

Assignee: **@sagetrac-GeorgSWeber**

Reviewer: **Jeroen Demeyer, Paul Zimmermann**

Author: **Punarbasu Purkayastha**

Merged: **sage-5.0.beta14**

_Issue created by migration from https://trac.sagemath.org/ticket/12347_





---

archive/issue_events_153927.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-01-24T08:00:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "milestone_number": null,
    "milestone_title": "sage-5.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153927"
}
```



---

archive/issue_events_153928.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-01-24T08:00:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153928"
}
```



---

archive/issue_events_153929.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-01-24T08:00:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153929"
}
```



---

archive/issue_events_153930.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-01-24T08:00:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153930"
}
```



---

archive/issue_comments_136654.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThe sage directory is relocatable and so simply moving the directory from `/tmp/sage-4.8` to `/usr/local/sage-4.8` will enable you to run sage again. After moving the folder you should also run sage just once ( `/usr/local/sage-4.8/sage` ) so that it resolves all the paths.\n\nAs for make install being broken, it seems to happen because there is no `SAGE_ROOT=\".....\"` in the file anymore and so that hard coding doesn't get done any more. A simple fix should be this patch to the Makefile in your `/tmp/sage-4.8/Makefile`:\n\n```diff\n--- Makefile.old\t2012-01-24 20:37:40.000000000 +0800\n+++ Makefile\t2012-01-24 20:42:38.000000000 +0800\n@@ -149,7 +149,7 @@\n \tmkdir -p $(DESTDIR)/sage\n \tmkdir -p $(DESTDIR)/bin/\n \tcp -rpv * $(DESTDIR)/sage/\n-\tpython local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n+\tsed -i -e \"s@^#SAGE_ROOT=/path/.*$@SAGE_ROOT=$(DESTDIR)/sage@;q\" \"$(DESTDIR)/sage/sage\"\n \tcp $(DESTDIR)/sage/sage $(DESTDIR)/bin/\n \tcd $(DESTDIR)/bin/; ./sage -c\n\n```",
    "created_at": "2012-01-24T12:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136654",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:1" align="right">Comment 1</div>

The sage directory is relocatable and so simply moving the directory from `/tmp/sage-4.8` to `/usr/local/sage-4.8` will enable you to run sage again. After moving the folder you should also run sage just once ( `/usr/local/sage-4.8/sage` ) so that it resolves all the paths.

As for make install being broken, it seems to happen because there is no `SAGE_ROOT="....."` in the file anymore and so that hard coding doesn't get done any more. A simple fix should be this patch to the Makefile in your `/tmp/sage-4.8/Makefile`:

```diff
--- Makefile.old	2012-01-24 20:37:40.000000000 +0800
+++ Makefile	2012-01-24 20:42:38.000000000 +0800
@@ -149,7 +149,7 @@
 	mkdir -p $(DESTDIR)/sage
 	mkdir -p $(DESTDIR)/bin/
 	cp -rpv * $(DESTDIR)/sage/
-	python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
+	sed -i -e "s@^#SAGE_ROOT=/path/.*$@SAGE_ROOT=$(DESTDIR)/sage@;q" "$(DESTDIR)/sage/sage"
 	cp $(DESTDIR)/sage/sage $(DESTDIR)/bin/
 	cd $(DESTDIR)/bin/; ./sage -c

```



---

archive/issue_comments_136655.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nHmm.. using @ is not a good idea there. The correct patch should be:\n\n```diff\n--- Makefile.old\t2012-01-20 13:38:18.000000000 +0800\n+++ Makefile\t2012-01-24 20:51:23.000000000 +0800\n@@ -149,7 +149,7 @@\n \tmkdir -p $(DESTDIR)/sage\n \tmkdir -p $(DESTDIR)/bin/\n \tcp -rpv * $(DESTDIR)/sage/\n-\tpython local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n+\tsed -i -e \"s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\\\"$(DESTDIR)/sage\\\"|;q\" \"$(DESTDIR)/sage/sage\"\n \tcp $(DESTDIR)/sage/sage $(DESTDIR)/bin/\n \tcd $(DESTDIR)/bin/; ./sage -c\n \n```",
    "created_at": "2012-01-24T12:52:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136655",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:2" align="right">Comment 2</div>

Hmm.. using @ is not a good idea there. The correct patch should be:

```diff
--- Makefile.old	2012-01-20 13:38:18.000000000 +0800
+++ Makefile	2012-01-24 20:51:23.000000000 +0800
@@ -149,7 +149,7 @@
 	mkdir -p $(DESTDIR)/sage
 	mkdir -p $(DESTDIR)/bin/
 	cp -rpv * $(DESTDIR)/sage/
-	python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
+	sed -i -e "s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\"$(DESTDIR)/sage\"|;q" "$(DESTDIR)/sage/sage"
 	cp $(DESTDIR)/sage/sage $(DESTDIR)/bin/
 	cd $(DESTDIR)/bin/; ./sage -c
 
```



---

archive/issue_comments_136656.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nI tried your patch and got:\n\n```\nsed -i -e \"s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\\\"/usr/local/sage-4.8a/sage\\\"|;q\" \"/usr/local/sage-4.8a/sage/sage\"\nsed: -e expression #1, char 62: unterminated `s' command\nmake: *** [install] Error 1\n```\nDid you really test your patch?\n\n```\n[root@coing sage-4.8]# diff Makefile.orig Makefile\n152c152\n<       python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n---\n>       sed -i -e \"s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\\\"$(DESTDIR)/sage\\\"|;q\" \"$(DESTDIR)/sage/sage\"\n```\nPaul",
    "created_at": "2012-01-25T11:25:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136656",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:3" align="right">Comment 3</div>

I tried your patch and got:

```
sed -i -e "s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\"/usr/local/sage-4.8a/sage\"|;q" "/usr/local/sage-4.8a/sage/sage"
sed: -e expression #1, char 62: unterminated `s' command
make: *** [install] Error 1
```
Did you really test your patch?

```
[root@coing sage-4.8]# diff Makefile.orig Makefile
152c152
<       python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
---
>       sed -i -e "s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\"$(DESTDIR)/sage\"|;q" "$(DESTDIR)/sage/sage"
```
Paul



---

archive/issue_comments_136657.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nSigh. Sorry for the trouble. I don't have sage-4.8 built yet. So, I can't test this as \"make install\". But I did test this sed expression before putting it here (that's how I caught the `@` problem).\n\nI see from\n\n```\nsed -i -e \"s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\\\"/usr/local/sage-4.8a/sage\\\"|;q\"\n```\nthat the `$|` was eaten away by the make process (it is not stripped away when run on the terminal). This is why you are getting that sed error. Can you try it without the `$`? Then the patch will look like this:\n\n```diff\n--- Makefile\t2012-01-20 13:38:18.000000000 +0800\n+++ /home/punarbasu/Makefile\t2012-01-24 20:51:23.000000000 +0800\n@@ -149,7 +149,7 @@\n \tmkdir -p $(DESTDIR)/sage\n \tmkdir -p $(DESTDIR)/bin/\n \tcp -rpv * $(DESTDIR)/sage/\n-\tpython local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n+\tsed -i -e \"s|^#SAGE_ROOT=/path/.*|SAGE_ROOT=\\\"$(DESTDIR)/sage\\\"|;q\" \"$(DESTDIR)/sage/sage\"\n \tcp $(DESTDIR)/sage/sage $(DESTDIR)/bin/\n \tcd $(DESTDIR)/bin/; ./sage -c\n \n```",
    "created_at": "2012-01-25T16:16:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136657",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:4" align="right">Comment 4</div>

Sigh. Sorry for the trouble. I don't have sage-4.8 built yet. So, I can't test this as "make install". But I did test this sed expression before putting it here (that's how I caught the `@` problem).

I see from

```
sed -i -e "s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\"/usr/local/sage-4.8a/sage\"|;q"
```
that the `$|` was eaten away by the make process (it is not stripped away when run on the terminal). This is why you are getting that sed error. Can you try it without the `$`? Then the patch will look like this:

```diff
--- Makefile	2012-01-20 13:38:18.000000000 +0800
+++ /home/punarbasu/Makefile	2012-01-24 20:51:23.000000000 +0800
@@ -149,7 +149,7 @@
 	mkdir -p $(DESTDIR)/sage
 	mkdir -p $(DESTDIR)/bin/
 	cp -rpv * $(DESTDIR)/sage/
-	python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
+	sed -i -e "s|^#SAGE_ROOT=/path/.*|SAGE_ROOT=\"$(DESTDIR)/sage\"|;q" "$(DESTDIR)/sage/sage"
 	cp $(DESTDIR)/sage/sage $(DESTDIR)/bin/
 	cd $(DESTDIR)/bin/; ./sage -c
 
```



---

archive/issue_comments_136658.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nit still does not work. With the change of comment [comment:4], the `$(DESTDIR)/bin/sage` file contains a single line:\n\n```\ntarte% cat /tmp/sage-4.8/bin/sage\n#!/usr/bin/env bash\n```\nPaul",
    "created_at": "2012-01-25T16:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136658",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:5" align="right">Comment 5</div>

it still does not work. With the change of comment [comment:4], the `$(DESTDIR)/bin/sage` file contains a single line:

```
tarte% cat /tmp/sage-4.8/bin/sage
#!/usr/bin/env bash
```
Paul



---

archive/issue_comments_136659.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nOk. I will leave it up to someone else to come up with a fix to the python file `local/bin/sage-hardcode_sage_root`. I will check this ticket again after I have downloaded and built sage-4.8.\n\nThanks for your patience and feedback.",
    "created_at": "2012-01-25T17:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136659",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:6" align="right">Comment 6</div>

Ok. I will leave it up to someone else to come up with a fix to the python file `local/bin/sage-hardcode_sage_root`. I will check this ticket again after I have downloaded and built sage-4.8.

Thanks for your patience and feedback.



---

archive/issue_comments_136660.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nOk. Here is a fix for the hard coding of the path. The simplest fix is to not do any hard coding at all!\n\nPlease apply [attachment: trac_12347.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz) to `SAGE_ROOT` (the directory where the `Makefile` is present). If the review is positive then we should also remove `SAGE_ROOT/local/bin/sage-hardcode_sage_root` from the tree since it is no longer needed.\n\nI also ran into some problems with `cp`, in particular with this line in the `Makefile`:\n\n```\ncp -rpv * $(DESTDIR)/sage/\n```\nOn the system that I tried this, cp actually errored out with error status 2. The last few lines of the make output are as follows:\n\n```\n$ make DESTDIR=\"/tmp/sage-install\" install\n\n.... tons of copying stuff ....\n\n`spkg/logs/matplotlib-1.0.1.p0.log' -> `/tmp/sage-install/sage/spkg/logs/matplotlib-1.0.1.p0.log'\n`spkg/logs/sqlite-3.7.5.p0.log' -> `/tmp/sage-install/sage/spkg/logs/sqlite-3.7.5.p0.log'\n`start.log' -> `/tmp/sage-install/sage/start.log'\n`tmp' -> `/tmp/sage-install/sage/tmp'\nmake: *** [install] Error 1\n```\nI can not fathom why it errors out. As a workaround, I changed the `cp` command to include `-u` and the cp finishes fine after invoking the make command once again:\n\n```\n$ make DESTDIR=\"/tmp/sage-install\" install\necho \"Experimental use only!\"\nExperimental use only!\nif [ \"/tmp/sage-install\" = \"\" ]; then \\\n\t\techo \"Set DESTDIR\"; \\\n\t\texit 1; \\\n\tfi\nmkdir -p /tmp/sage-install\nmkdir -p /tmp/sage-install/sage\nmkdir -p /tmp/sage-install/bin/\ncp -rpuv * /tmp/sage-install/sage/\n`Makefile' -> `/tmp/sage-install/sage/Makefile'\ncd /tmp/sage-install/bin; ln -sfn ../sage/sage ./sage; ./sage -c\nThe Sage installation tree may have moved\n(from /home/punarbasu/Installations/sage-4.8 to /tmp/sage-install/sage).\nChanging various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\nDone resetting paths.\n```",
    "created_at": "2012-01-28T12:59:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136660",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:7" align="right">Comment 7</div>

Ok. Here is a fix for the hard coding of the path. The simplest fix is to not do any hard coding at all!

Please apply [attachment: trac_12347.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz) to `SAGE_ROOT` (the directory where the `Makefile` is present). If the review is positive then we should also remove `SAGE_ROOT/local/bin/sage-hardcode_sage_root` from the tree since it is no longer needed.

I also ran into some problems with `cp`, in particular with this line in the `Makefile`:

```
cp -rpv * $(DESTDIR)/sage/
```
On the system that I tried this, cp actually errored out with error status 2. The last few lines of the make output are as follows:

```
$ make DESTDIR="/tmp/sage-install" install

.... tons of copying stuff ....

`spkg/logs/matplotlib-1.0.1.p0.log' -> `/tmp/sage-install/sage/spkg/logs/matplotlib-1.0.1.p0.log'
`spkg/logs/sqlite-3.7.5.p0.log' -> `/tmp/sage-install/sage/spkg/logs/sqlite-3.7.5.p0.log'
`start.log' -> `/tmp/sage-install/sage/start.log'
`tmp' -> `/tmp/sage-install/sage/tmp'
make: *** [install] Error 1
```
I can not fathom why it errors out. As a workaround, I changed the `cp` command to include `-u` and the cp finishes fine after invoking the make command once again:

```
$ make DESTDIR="/tmp/sage-install" install
echo "Experimental use only!"
Experimental use only!
if [ "/tmp/sage-install" = "" ]; then \
		echo "Set DESTDIR"; \
		exit 1; \
	fi
mkdir -p /tmp/sage-install
mkdir -p /tmp/sage-install/sage
mkdir -p /tmp/sage-install/bin/
cp -rpuv * /tmp/sage-install/sage/
`Makefile' -> `/tmp/sage-install/sage/Makefile'
cd /tmp/sage-install/bin; ln -sfn ../sage/sage ./sage; ./sage -c
The Sage installation tree may have moved
(from /home/punarbasu/Installations/sage-4.8 to /tmp/sage-install/sage).
Changing various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Done resetting paths.
```



---

archive/issue_events_153931.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-01-28T12:59:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153931"
}
```



---

archive/issue_comments_136661.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nYou shouldn't use the options `-u`, `-v`, or `-R` for cp.  Re `-r`, the man page for cp on OS X says\n\n```\n     Historic versions of the cp utility had a -r option.  This implementation supports that\n     option; however, its use is strongly discouraged, as it does not correctly copy special\n     files, symbolic links, or fifo's.\n```\nThe OS X version of cp doesn't recognize the `-u` option at all.  The Solaris version of cp doesn't support `-u` or `-v`.\n\nMake sure to only use Posix-standard options; I think [this web page](http://pwet.fr/man/linux/commandes/posix/cp) is accurate.\n\nAlong the same lines, on Solaris (and perhaps other platforms), `ln -f` doesn't behave the way it does on linux; see the comment on line 71 of the file SAGE_ROOT/local/bin/sage-build.",
    "created_at": "2012-01-28T15:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136661",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">Comment 8</div>

You shouldn't use the options `-u`, `-v`, or `-R` for cp.  Re `-r`, the man page for cp on OS X says

```
     Historic versions of the cp utility had a -r option.  This implementation supports that
     option; however, its use is strongly discouraged, as it does not correctly copy special
     files, symbolic links, or fifo's.
```
The OS X version of cp doesn't recognize the `-u` option at all.  The Solaris version of cp doesn't support `-u` or `-v`.

Make sure to only use Posix-standard options; I think [this web page](http://pwet.fr/man/linux/commandes/posix/cp) is accurate.

Along the same lines, on Solaris (and perhaps other platforms), `ln -f` doesn't behave the way it does on linux; see the comment on line 71 of the file SAGE_ROOT/local/bin/sage-build.



---

archive/issue_events_153932.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T15:58:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153932"
}
```



---

archive/issue_events_153933.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T15:58:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153933"
}
```



---

archive/issue_comments_136662.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\n@jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. The options `-r`, `-v` were all present from before. `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.\n\nIf `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?",
    "created_at": "2012-01-28T16:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136662",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:9" align="right">Comment 9</div>

@jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. The options `-r`, `-v` were all present from before. `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.

If `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?



---

archive/issue_comments_136663.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@ppurka](#comment%3A9):\n> @jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. \n\nSolaris is a supported platform for Sage on which the `-u` option is not recognized, so it doesn't matter too much why you added it: it's not going to work.\n\n> The options `-r`, `-v` were all present from before. \n\nBut while you're fixing other things, you might as well fix this.  Just use `-R` or `-pR` instead.\n\n> `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.\n\nSame comment as before: it's not going to work this way, so you should do it a different way.  (For example, first run 'rm -f ...' on the link, then do 'ln -s ...'.)\n\n> If `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?\n\nI think that 'cp -pR' is reliable on all platforms.  Note also that the 'make install' option says \"Experimental use only!\", so I don't think it's been well-maintained or supported, or even used much, which is why, for example, the `-v` option for cp wasn't removed earlier.  But if you're working on this, you should do it right, so that it works on all supported platforms.  Using POSIX-standard commands should be completely reliable; every platform's version of 'cp' should support the POSIX-standard options for cp.",
    "created_at": "2012-01-28T16:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136663",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@ppurka](#comment%3A9):
> @jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. 

Solaris is a supported platform for Sage on which the `-u` option is not recognized, so it doesn't matter too much why you added it: it's not going to work.

> The options `-r`, `-v` were all present from before. 

But while you're fixing other things, you might as well fix this.  Just use `-R` or `-pR` instead.

> `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.

Same comment as before: it's not going to work this way, so you should do it a different way.  (For example, first run 'rm -f ...' on the link, then do 'ln -s ...'.)

> If `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?

I think that 'cp -pR' is reliable on all platforms.  Note also that the 'make install' option says "Experimental use only!", so I don't think it's been well-maintained or supported, or even used much, which is why, for example, the `-v` option for cp wasn't removed earlier.  But if you're working on this, you should do it right, so that it works on all supported platforms.  Using POSIX-standard commands should be completely reliable; every platform's version of 'cp' should support the POSIX-standard options for cp.



---

archive/issue_comments_136664.json:
```json
{
    "body": "Attachment: **[trac_12347-remove-sage-hardcode.patch.gz](https://github.com/sagemath/sage/files/ticket12347/trac_12347-remove-sage-hardcode.patch.gz)**\n\nRemove unnecessary file. Apply to `SAGE_ROOT/local/bin`",
    "created_at": "2012-01-28T19:32:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136664",
    "user": "https://github.com/ppurka"
}
```

Attachment: **[trac_12347-remove-sage-hardcode.patch.gz](https://github.com/sagemath/sage/files/ticket12347/trac_12347-remove-sage-hardcode.patch.gz)**

Remove unnecessary file. Apply to `SAGE_ROOT/local/bin`



---

archive/issue_comments_136665.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nUpdated the patches.\n\nNow I see why cp failed:\n\n```\n...stallations/sage-4.8> make DESTDIR=\"/tmp/sage-xxxx\" install |& tee -i -a ~/tmp/log-new.txt\necho \"Experimental use only!\"\nExperimental use only!\nif [ \"/tmp/sage-xxxx\" = \"\" ]; then \\\n\t\techo \"Set DESTDIR\"; \\\n\t\texit 1; \\\n\tfi\nmkdir -p /tmp/sage-xxxx\nmkdir -p /tmp/sage-xxxx/sage\nmkdir -p /tmp/sage-xxxx/bin/\ncp -Rp * /tmp/sage-xxxx/sage/\ncp: reading `local/lib/libpari.a': Input/output error\nmake: *** [install] Error 1\n```\nRebuilding pari makes this bug go away\n\n```\n~/Installations/sage-4.8> ./sage -f spkg/standard/pari-2.5.0.p3.spkg >& ~/tmp/pari.txt\n~/Installations/sage-4.8> cp local/lib/libpari.a /tmp\n~/Installations/sage-4.8> \n```",
    "created_at": "2012-01-28T19:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136665",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:11" align="right">Comment 11</div>

Updated the patches.

Now I see why cp failed:

```
...stallations/sage-4.8> make DESTDIR="/tmp/sage-xxxx" install |& tee -i -a ~/tmp/log-new.txt
echo "Experimental use only!"
Experimental use only!
if [ "/tmp/sage-xxxx" = "" ]; then \
		echo "Set DESTDIR"; \
		exit 1; \
	fi
mkdir -p /tmp/sage-xxxx
mkdir -p /tmp/sage-xxxx/sage
mkdir -p /tmp/sage-xxxx/bin/
cp -Rp * /tmp/sage-xxxx/sage/
cp: reading `local/lib/libpari.a': Input/output error
make: *** [install] Error 1
```
Rebuilding pari makes this bug go away

```
~/Installations/sage-4.8> ./sage -f spkg/standard/pari-2.5.0.p3.spkg >& ~/tmp/pari.txt
~/Installations/sage-4.8> cp local/lib/libpari.a /tmp
~/Installations/sage-4.8> 
```



---

archive/issue_comments_136666.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,3 +20,10 @@\n automatically by `make install` up to 4.7.2, and was broken in Sage 4.8.\n \n Paul\n+\n+---\n+Hard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.\n+\n+1. Apply [attachment: trac_12347-remove-sage-hardcode.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347-remove-sage-hardcode.patch.gz) to `SAGE_ROOT/local/bin`\n+\n+2. Apply [attachment: trac_12347.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz) to `SAGE_ROOT`\n``````\n",
    "created_at": "2012-01-28T19:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136666",
    "user": "https://github.com/ppurka"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,3 +20,10 @@
 automatically by `make install` up to 4.7.2, and was broken in Sage 4.8.
 
 Paul
+
+---
+Hard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.
+
+1. Apply [attachment: trac_12347-remove-sage-hardcode.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347-remove-sage-hardcode.patch.gz) to `SAGE_ROOT/local/bin`
+
+2. Apply [attachment: trac_12347.patch](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz) to `SAGE_ROOT`
``````




---

archive/issue_comments_136667.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nis the patch ready for review? No work issues were added in comment [comment:8].\n\nPaul",
    "created_at": "2012-01-30T15:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136667",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:12" align="right">Comment 12</div>

is the patch ready for review? No work issues were added in comment [comment:8].

Paul



---

archive/issue_comments_136668.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nSorry, forgot to set it to needs_review.",
    "created_at": "2012-01-30T15:20:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136668",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:13" align="right">Comment 13</div>

Sorry, forgot to set it to needs_review.



---

archive/issue_events_153934.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-01-30T15:20:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153934"
}
```



---

archive/issue_events_153935.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-01-30T15:20:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153935"
}
```



---

archive/issue_events_153936.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-06T12:23:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153936"
}
```



---

archive/issue_events_153937.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-06T12:23:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153937"
}
```



---

archive/issue_comments_136669.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nReplace\n\n```\ncd $(DESTDIR)/bin; ln -s ../sage/sage ./sage; ./sage -c\n```\nby\n\n```\n-rm -f $(DESTDIR)/bin/sage\nln -s ../sage/sage $(DESTDIR)/bin/sage\n$(DESTDIR)/bin/sage -c   # Need to run sage-location\n```",
    "created_at": "2012-04-06T12:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136669",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">Comment 14</div>

Replace

```
cd $(DESTDIR)/bin; ln -s ../sage/sage ./sage; ./sage -c
```
by

```
-rm -f $(DESTDIR)/bin/sage
ln -s ../sage/sage $(DESTDIR)/bin/sage
$(DESTDIR)/bin/sage -c   # Need to run sage-location
```



---

archive/issue_comments_136670.json:
```json
{
    "body": "Author: **Punarbasu Purkayastha**",
    "created_at": "2012-04-06T12:23:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136670",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Punarbasu Purkayastha**



---

archive/issue_comments_136671.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nupdated.",
    "created_at": "2012-04-06T15:41:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136671",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:15" align="right">Comment 15</div>

updated.



---

archive/issue_events_153938.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-10T12:39:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153938"
}
```



---

archive/issue_events_153939.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-10T12:39:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153939"
}
```



---

archive/issue_comments_136672.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nJust one more thing: it would be better to first delete `$(DESTDIR)/sage/` for two reasons:\n1. if there already was a previous version, there might be some kind of conflict (although I cannot immediately think of a concrete problem that could occur).\n2. some program in the old version might still be running (considering `sage-cleaner`, this is less unlikely than you might think at first).",
    "created_at": "2012-04-11T17:36:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136672",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">Comment 17</div>

Just one more thing: it would be better to first delete `$(DESTDIR)/sage/` for two reasons:
1. if there already was a previous version, there might be some kind of conflict (although I cannot immediately think of a concrete problem that could occur).
2. some program in the old version might still be running (considering `sage-cleaner`, this is less unlikely than you might think at first).



---

archive/issue_events_153940.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-11T17:37:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153940"
}
```



---

archive/issue_events_153941.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-11T17:37:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153941"
}
```



---

archive/issue_comments_136673.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2012-04-11T17:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136673",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_comments_136674.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nUpdated the patch. I guess we could write some logic to detect if a sage process is running, but it would not be robust enough and would bloat the install part.\n\nI updated the patch to not proceed with the installation if the `$(DESTDIR)/sage` is a file or symlink. It will (hopefully) prevent accidents. :)",
    "created_at": "2012-04-13T14:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136674",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:19" align="right">Comment 19</div>

Updated the patch. I guess we could write some logic to detect if a sage process is running, but it would not be robust enough and would bloat the install part.

I updated the patch to not proceed with the installation if the `$(DESTDIR)/sage` is a file or symlink. It will (hopefully) prevent accidents. :)



---

archive/issue_events_153942.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-13T14:40:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153942"
}
```



---

archive/issue_events_153943.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-13T14:40:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153943"
}
```



---

archive/issue_comments_136675.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\n\"`[ -e`\" isn't portable.  \"`[ -f`\" is portable.\n\nWhy do you talk about symlinks in your comment?  I don't see that in your code.\n\nI would simply remove the whole `elif` block.  `mkdir -p \"$(DESTDIR)\"/sage` should fail anyway if `\"$(DESTDIR)\"/sage` is a non-directory.",
    "created_at": "2012-04-13T14:51:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136675",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">Comment 21</div>

"`[ -e`" isn't portable.  "`[ -f`" is portable.

Why do you talk about symlinks in your comment?  I don't see that in your code.

I would simply remove the whole `elif` block.  `mkdir -p "$(DESTDIR)"/sage` should fail anyway if `"$(DESTDIR)"/sage` is a non-directory.



---

archive/issue_comments_136676.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nMention in a comment that the \"`[ -d`\" test is meant to exclude the case that \"$(DESTDIR)\"/sage is an existing file, not a directory.",
    "created_at": "2012-04-13T14:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136676",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:22" align="right">Comment 22</div>

Mention in a comment that the "`[ -d`" test is meant to exclude the case that "$(DESTDIR)"/sage is an existing file, not a directory.



---

archive/issue_comments_136677.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@jdemeyer](#comment%3A21):\n> Why do you talk about symlinks in your comment?  I don't see that in your code.\n\nWell, `-e` checks for both. I didn't know it wasn't portable. You are correct that mkdir will fail. I hadn't thought of that.",
    "created_at": "2012-04-13T15:16:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136677",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@jdemeyer](#comment%3A21):
> Why do you talk about symlinks in your comment?  I don't see that in your code.

Well, `-e` checks for both. I didn't know it wasn't portable. You are correct that mkdir will fail. I hadn't thought of that.



---

archive/issue_comments_136678.json:
```json
{
    "body": "Apply to SAGE_ROOT",
    "created_at": "2012-04-13T15:20:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136678",
    "user": "https://github.com/ppurka"
}
```

Apply to SAGE_ROOT



---

archive/issue_comments_136679.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nAttachment: **[trac_12347.patch.gz](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz)**\n\nUpdated.",
    "created_at": "2012-04-13T15:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136679",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:24" align="right">Comment 24</div>

Attachment: **[trac_12347.patch.gz](https://github.com/sagemath/sage/files/ticket12347/trac_12347.patch.gz)**

Updated.



---

archive/issue_comments_136680.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nActually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).",
    "created_at": "2012-04-13T15:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136680",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:25" align="right">Comment 25</div>

Actually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).



---

archive/issue_comments_136681.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@ppurka](#comment%3A25):\n> Actually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).\n\nMaybe it \"should be\", but it isn't.",
    "created_at": "2012-04-13T15:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136681",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@ppurka](#comment%3A25):
> Actually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).

Maybe it "should be", but it isn't.



---

archive/issue_comments_136682.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nFor shell script portability discussions, I often refer to the GNU autoconf manual: [http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell](http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell).\n\nQuoting from there:\n> But occasionally you may find it necessary to check whether some arbitrary file exists. To do so, use \u2018test -f\u2019 or \u2018test -r\u2019. Do not use \u2018test -x\u2019, because 4.3BSD does not have it. Do not use \u2018test -e\u2019 either, because Solaris /bin/sh lacks it. To test for symbolic links on systems that have them, use \u2018test -h\u2019 rather than \u2018test -L\u2019; either form conforms to Posix 1003.1-2001, but older shells like Solaris 8 /bin/sh support only -h.",
    "created_at": "2012-04-13T15:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136682",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:27" align="right">Comment 27</div>

For shell script portability discussions, I often refer to the GNU autoconf manual: [http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell](http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell).

Quoting from there:
> But occasionally you may find it necessary to check whether some arbitrary file exists. To do so, use test -f or test -r. Do not use test -x, because 4.3BSD does not have it. Do not use test -e either, because Solaris /bin/sh lacks it. To test for symbolic links on systems that have them, use test -h rather than test -L; either form conforms to Posix 1003.1-2001, but older shells like Solaris 8 /bin/sh support only -h.



---

archive/issue_comments_136683.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nThanks!",
    "created_at": "2012-04-13T15:48:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136683",
    "user": "https://github.com/ppurka"
}
```

<div id="comment:28" align="right">Comment 28</div>

Thanks!



---

archive/issue_comments_136684.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nthe patches apply successfully to sage-5.0.beta13 and `make install` works.\nMy only comment after looking at the patch: shouldn't we check also if $(DESTDIR)/bin\nalready exists?\n\nPaul",
    "created_at": "2012-04-16T14:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136684",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:29" align="right">Comment 29</div>

the patches apply successfully to sage-5.0.beta13 and `make install` works.
My only comment after looking at the patch: shouldn't we check also if $(DESTDIR)/bin
already exists?

Paul



---

archive/issue_comments_136685.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@zimmermann6](#comment%3A29):\n> shouldn't we check also if $(DESTDIR)/bin already exists?\n\nWhy?  What would you propose?",
    "created_at": "2012-04-16T14:47:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136685",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@zimmermann6](#comment%3A29):
> shouldn't we check also if $(DESTDIR)/bin already exists?

Why?  What would you propose?



---

archive/issue_comments_136686.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nif we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin\nwith a previous installation of Sage. What will then happen? I propose to remove\n$(DESTDIR)/bin if it exists and is a directory.\n\nPaul",
    "created_at": "2012-04-16T15:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136686",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:31" align="right">Comment 31</div>

if we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin
with a previous installation of Sage. What will then happen? I propose to remove
$(DESTDIR)/bin if it exists and is a directory.

Paul



---

archive/issue_comments_136687.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@zimmermann6](#comment%3A31):\n> if we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin\n> with a previous installation of Sage. What will then happen?\n\nNothing bad will happen.  The file or symbolic link `$(DESTDIR)/bin/sage` will be deleted and recreated as symbolic link to `$(DESTDIR)/sage/sage`.",
    "created_at": "2012-04-16T15:15:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136687",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@zimmermann6](#comment%3A31):
> if we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin
> with a previous installation of Sage. What will then happen?

Nothing bad will happen.  The file or symbolic link `$(DESTDIR)/bin/sage` will be deleted and recreated as symbolic link to `$(DESTDIR)/sage/sage`.



---

archive/issue_comments_136688.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nok, then I give a positive review.\n\nPaul",
    "created_at": "2012-04-16T15:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136688",
    "user": "https://github.com/zimmermann6"
}
```

<div id="comment:33" align="right">Comment 33</div>

ok, then I give a positive review.

Paul



---

archive/issue_events_153944.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-04-16T15:22:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153944"
}
```



---

archive/issue_events_153945.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-04-16T15:22:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153945"
}
```



---

archive/issue_comments_136689.json:
```json
{
    "body": "Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Paul Zimmermann**",
    "created_at": "2012-04-16T15:22:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136689",
    "user": "https://github.com/zimmermann6"
}
```

Changed reviewer from **Jeroen Demeyer** to **Jeroen Demeyer, Paul Zimmermann**



---

archive/issue_comments_136690.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@zimmermann6](#comment%3A33):\n> ok, then I give a positive review.\n\nAgreed.",
    "created_at": "2012-04-16T15:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136690",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@zimmermann6](#comment%3A33):
> ok, then I give a positive review.

Agreed.



---

archive/issue_comments_136691.json:
```json
{
    "body": "Merged: **sage-5.0.beta14**",
    "created_at": "2012-04-19T08:10:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/12347#issuecomment-136691",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.0.beta14**



---

archive/issue_events_153946.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T08:10:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153946"
}
```



---

archive/issue_events_153947.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T08:10:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/12347",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/12347#event-153947"
}
```
