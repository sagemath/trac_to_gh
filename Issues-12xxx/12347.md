# Issue 12347: make install broken in Sage 4.8

archive/issues_012175.json:
```json
{
    "body": "when I compile Sage 4.8 from source in say `/tmp/sage-4.8`, then\nI do `make install DESTDIR=/usr/local/sage-4.8`, and I run the binary `/usr/local/sage-4.8/bin/sage` I get:\n\n```\n[zimmerma@coing ~]$ /usr/local/sage-4.8/bin/sage\n************************************************************************\nYou must compile Sage first using 'make' in the Sage root directory.\n(If you have already compiled Sage, you must set the SAGE_ROOT variable\nin the file '/usr/local/sage-4.8/bin/sage').\n************************************************************************\n```\nThis way of compiling and installing Sage worked before, up to Sage 4.7.2.\n\nA fix is to add the line\n\n```\nSAGE_ROOT=\"/usr/local/sage-4.8/sage\n```\nin the script `/usr/local/sage-4.8/bin/sage`. This was done\nautomatically by `make install` up to 4.7.2, and was broken in Sage 4.8.\n\nPaul\n\n---\nHard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.\n\n1. Apply [attachment:trac_12347-remove-sage-hardcode.patch] to `SAGE_ROOT/local/bin`\n\n2. Apply [attachment:trac_12347.patch] to `SAGE_ROOT`\n\n**Assignee:** GeorgSWeber\n\n**Reviewer:** Jeroen Demeyer, Paul Zimmermann\n\n**Author:** Punarbasu Purkayastha\n\n**Merged:** sage-5.0.beta14\n\nIssue created by migration from https://trac.sagemath.org/ticket/12347\n\n",
    "closed_at": "2012-04-19T08:10:27Z",
    "created_at": "2012-01-24T08:00:59Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "make install broken in Sage 4.8",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12347",
    "user": "https://github.com/zimmermann6"
}
```
when I compile Sage 4.8 from source in say `/tmp/sage-4.8`, then
I do `make install DESTDIR=/usr/local/sage-4.8`, and I run the binary `/usr/local/sage-4.8/bin/sage` I get:

```
[zimmerma@coing ~]$ /usr/local/sage-4.8/bin/sage
************************************************************************
You must compile Sage first using 'make' in the Sage root directory.
(If you have already compiled Sage, you must set the SAGE_ROOT variable
in the file '/usr/local/sage-4.8/bin/sage').
************************************************************************
```
This way of compiling and installing Sage worked before, up to Sage 4.7.2.

A fix is to add the line

```
SAGE_ROOT="/usr/local/sage-4.8/sage
```
in the script `/usr/local/sage-4.8/bin/sage`. This was done
automatically by `make install` up to 4.7.2, and was broken in Sage 4.8.

Paul

---
Hard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.

1. Apply [attachment:trac_12347-remove-sage-hardcode.patch] to `SAGE_ROOT/local/bin`

2. Apply [attachment:trac_12347.patch] to `SAGE_ROOT`

**Assignee:** GeorgSWeber

**Reviewer:** Jeroen Demeyer, Paul Zimmermann

**Author:** Punarbasu Purkayastha

**Merged:** sage-5.0.beta14

Issue created by migration from https://trac.sagemath.org/ticket/12347





---

archive/issue_comments_138218.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe sage directory is relocatable and so simply moving the directory from `/tmp/sage-4.8` to `/usr/local/sage-4.8` will enable you to run sage again. After moving the folder you should also run sage just once ( `/usr/local/sage-4.8/sage` ) so that it resolves all the paths.\n\nAs for make install being broken, it seems to happen because there is no `SAGE_ROOT=\".....\"` in the file anymore and so that hard coding doesn't get done any more. A simple fix should be this patch to the Makefile in your `/tmp/sage-4.8/Makefile`:\n\n```diff\n--- Makefile.old\t2012-01-24 20:37:40.000000000 +0800\n+++ Makefile\t2012-01-24 20:42:38.000000000 +0800\n@@ -149,7 +149,7 @@\n \tmkdir -p $(DESTDIR)/sage\n \tmkdir -p $(DESTDIR)/bin/\n \tcp -rpv * $(DESTDIR)/sage/\n-\tpython local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n+\tsed -i -e \"s@^#SAGE_ROOT=/path/.*$@SAGE_ROOT=$(DESTDIR)/sage@;q\" \"$(DESTDIR)/sage/sage\"\n \tcp $(DESTDIR)/sage/sage $(DESTDIR)/bin/\n \tcd $(DESTDIR)/bin/; ./sage -c\n\n```",
    "created_at": "2012-01-24T12:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138218",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:1'></a>
The sage directory is relocatable and so simply moving the directory from `/tmp/sage-4.8` to `/usr/local/sage-4.8` will enable you to run sage again. After moving the folder you should also run sage just once ( `/usr/local/sage-4.8/sage` ) so that it resolves all the paths.

As for make install being broken, it seems to happen because there is no `SAGE_ROOT="....."` in the file anymore and so that hard coding doesn't get done any more. A simple fix should be this patch to the Makefile in your `/tmp/sage-4.8/Makefile`:

```diff
--- Makefile.old	2012-01-24 20:37:40.000000000 +0800
+++ Makefile	2012-01-24 20:42:38.000000000 +0800
@@ -149,7 +149,7 @@
 	mkdir -p $(DESTDIR)/sage
 	mkdir -p $(DESTDIR)/bin/
 	cp -rpv * $(DESTDIR)/sage/
-	python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
+	sed -i -e "s@^#SAGE_ROOT=/path/.*$@SAGE_ROOT=$(DESTDIR)/sage@;q" "$(DESTDIR)/sage/sage"
 	cp $(DESTDIR)/sage/sage $(DESTDIR)/bin/
 	cd $(DESTDIR)/bin/; ./sage -c

```



---

archive/issue_comments_138219.json:
```json
{
    "body": "<a id='comment:2'></a>\nHmm.. using @ is not a good idea there. The correct patch should be:\n\n```diff\n--- Makefile.old\t2012-01-20 13:38:18.000000000 +0800\n+++ Makefile\t2012-01-24 20:51:23.000000000 +0800\n@@ -149,7 +149,7 @@\n \tmkdir -p $(DESTDIR)/sage\n \tmkdir -p $(DESTDIR)/bin/\n \tcp -rpv * $(DESTDIR)/sage/\n-\tpython local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n+\tsed -i -e \"s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\\\"$(DESTDIR)/sage\\\"|;q\" \"$(DESTDIR)/sage/sage\"\n \tcp $(DESTDIR)/sage/sage $(DESTDIR)/bin/\n \tcd $(DESTDIR)/bin/; ./sage -c\n \n```",
    "created_at": "2012-01-24T12:52:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138219",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:2'></a>
Hmm.. using @ is not a good idea there. The correct patch should be:

```diff
--- Makefile.old	2012-01-20 13:38:18.000000000 +0800
+++ Makefile	2012-01-24 20:51:23.000000000 +0800
@@ -149,7 +149,7 @@
 	mkdir -p $(DESTDIR)/sage
 	mkdir -p $(DESTDIR)/bin/
 	cp -rpv * $(DESTDIR)/sage/
-	python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
+	sed -i -e "s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\"$(DESTDIR)/sage\"|;q" "$(DESTDIR)/sage/sage"
 	cp $(DESTDIR)/sage/sage $(DESTDIR)/bin/
 	cd $(DESTDIR)/bin/; ./sage -c
 
```



---

archive/issue_comments_138220.json:
```json
{
    "body": "<a id='comment:3'></a>\nI tried your patch and got:\n\n```\nsed -i -e \"s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\\\"/usr/local/sage-4.8a/sage\\\"|;q\" \"/usr/local/sage-4.8a/sage/sage\"\nsed: -e expression #1, char 62: unterminated `s' command\nmake: *** [install] Error 1\n```\nDid you really test your patch?\n\n```\n[root@coing sage-4.8]# diff Makefile.orig Makefile\n152c152\n<       python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n---\n>       sed -i -e \"s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\\\"$(DESTDIR)/sage\\\"|;q\" \"$(DESTDIR)/sage/sage\"\n```\nPaul",
    "created_at": "2012-01-25T11:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138220",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:3'></a>
I tried your patch and got:

```
sed -i -e "s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\"/usr/local/sage-4.8a/sage\"|;q" "/usr/local/sage-4.8a/sage/sage"
sed: -e expression #1, char 62: unterminated `s' command
make: *** [install] Error 1
```
Did you really test your patch?

```
[root@coing sage-4.8]# diff Makefile.orig Makefile
152c152
<       python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
---
>       sed -i -e "s|^#SAGE_ROOT=/path/.*$|SAGE_ROOT=\"$(DESTDIR)/sage\"|;q" "$(DESTDIR)/sage/sage"
```
Paul



---

archive/issue_comments_138221.json:
```json
{
    "body": "<a id='comment:4'></a>\nSigh. Sorry for the trouble. I don't have sage-4.8 built yet. So, I can't test this as \"make install\". But I did test this sed expression before putting it here (that's how I caught the `@` problem).\n\nI see from\n\n```\nsed -i -e \"s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\\\"/usr/local/sage-4.8a/sage\\\"|;q\"\n```\nthat the `$|` was eaten away by the make process (it is not stripped away when run on the terminal). This is why you are getting that sed error. Can you try it without the `$`? Then the patch will look like this:\n\n```diff\n--- Makefile\t2012-01-20 13:38:18.000000000 +0800\n+++ /home/punarbasu/Makefile\t2012-01-24 20:51:23.000000000 +0800\n@@ -149,7 +149,7 @@\n \tmkdir -p $(DESTDIR)/sage\n \tmkdir -p $(DESTDIR)/bin/\n \tcp -rpv * $(DESTDIR)/sage/\n-\tpython local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage \"$(DESTDIR)\"/sage\n+\tsed -i -e \"s|^#SAGE_ROOT=/path/.*|SAGE_ROOT=\\\"$(DESTDIR)/sage\\\"|;q\" \"$(DESTDIR)/sage/sage\"\n \tcp $(DESTDIR)/sage/sage $(DESTDIR)/bin/\n \tcd $(DESTDIR)/bin/; ./sage -c\n \n```",
    "created_at": "2012-01-25T16:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138221",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:4'></a>
Sigh. Sorry for the trouble. I don't have sage-4.8 built yet. So, I can't test this as "make install". But I did test this sed expression before putting it here (that's how I caught the `@` problem).

I see from

```
sed -i -e "s|^#SAGE_ROOT=/path/.*SAGE_ROOT=\"/usr/local/sage-4.8a/sage\"|;q"
```
that the `$|` was eaten away by the make process (it is not stripped away when run on the terminal). This is why you are getting that sed error. Can you try it without the `$`? Then the patch will look like this:

```diff
--- Makefile	2012-01-20 13:38:18.000000000 +0800
+++ /home/punarbasu/Makefile	2012-01-24 20:51:23.000000000 +0800
@@ -149,7 +149,7 @@
 	mkdir -p $(DESTDIR)/sage
 	mkdir -p $(DESTDIR)/bin/
 	cp -rpv * $(DESTDIR)/sage/
-	python local/bin/sage-hardcode_sage_root $(DESTDIR)/sage/sage "$(DESTDIR)"/sage
+	sed -i -e "s|^#SAGE_ROOT=/path/.*|SAGE_ROOT=\"$(DESTDIR)/sage\"|;q" "$(DESTDIR)/sage/sage"
 	cp $(DESTDIR)/sage/sage $(DESTDIR)/bin/
 	cd $(DESTDIR)/bin/; ./sage -c
 
```



---

archive/issue_comments_138222.json:
```json
{
    "body": "<a id='comment:5'></a>\nit still does not work. With the change of comment [comment:4], the `$(DESTDIR)/bin/sage` file contains a single line:\n\n```\ntarte% cat /tmp/sage-4.8/bin/sage\n#!/usr/bin/env bash\n```\nPaul",
    "created_at": "2012-01-25T16:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138222",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:5'></a>
it still does not work. With the change of comment [comment:4], the `$(DESTDIR)/bin/sage` file contains a single line:

```
tarte% cat /tmp/sage-4.8/bin/sage
#!/usr/bin/env bash
```
Paul



---

archive/issue_comments_138223.json:
```json
{
    "body": "<a id='comment:6'></a>\nOk. I will leave it up to someone else to come up with a fix to the python file `local/bin/sage-hardcode_sage_root`. I will check this ticket again after I have downloaded and built sage-4.8.\n\nThanks for your patience and feedback.",
    "created_at": "2012-01-25T17:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138223",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:6'></a>
Ok. I will leave it up to someone else to come up with a fix to the python file `local/bin/sage-hardcode_sage_root`. I will check this ticket again after I have downloaded and built sage-4.8.

Thanks for your patience and feedback.



---

archive/issue_comments_138224.json:
```json
{
    "body": "<a id='comment:7'></a>\nOk. Here is a fix for the hard coding of the path. The simplest fix is to not do any hard coding at all!\n\nPlease apply [attachment:trac_12347.patch] to `SAGE_ROOT` (the directory where the `Makefile` is present). If the review is positive then we should also remove `SAGE_ROOT/local/bin/sage-hardcode_sage_root` from the tree since it is no longer needed.\n\nI also ran into some problems with `cp`, in particular with this line in the `Makefile`:\n\n```\ncp -rpv * $(DESTDIR)/sage/\n```\nOn the system that I tried this, cp actually errored out with error status 2. The last few lines of the make output are as follows:\n\n```\n$ make DESTDIR=\"/tmp/sage-install\" install\n\n.... tons of copying stuff ....\n\n`spkg/logs/matplotlib-1.0.1.p0.log' -> `/tmp/sage-install/sage/spkg/logs/matplotlib-1.0.1.p0.log'\n`spkg/logs/sqlite-3.7.5.p0.log' -> `/tmp/sage-install/sage/spkg/logs/sqlite-3.7.5.p0.log'\n`start.log' -> `/tmp/sage-install/sage/start.log'\n`tmp' -> `/tmp/sage-install/sage/tmp'\nmake: *** [install] Error 1\n```\nI can not fathom why it errors out. As a workaround, I changed the `cp` command to include `-u` and the cp finishes fine after invoking the make command once again:\n\n```\n$ make DESTDIR=\"/tmp/sage-install\" install\necho \"Experimental use only!\"\nExperimental use only!\nif [ \"/tmp/sage-install\" = \"\" ]; then \\\n\t\techo \"Set DESTDIR\"; \\\n\t\texit 1; \\\n\tfi\nmkdir -p /tmp/sage-install\nmkdir -p /tmp/sage-install/sage\nmkdir -p /tmp/sage-install/bin/\ncp -rpuv * /tmp/sage-install/sage/\n`Makefile' -> `/tmp/sage-install/sage/Makefile'\ncd /tmp/sage-install/bin; ln -sfn ../sage/sage ./sage; ./sage -c\nThe Sage installation tree may have moved\n(from /home/punarbasu/Installations/sage-4.8 to /tmp/sage-install/sage).\nChanging various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\nDone resetting paths.\n```",
    "created_at": "2012-01-28T12:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138224",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:7'></a>
Ok. Here is a fix for the hard coding of the path. The simplest fix is to not do any hard coding at all!

Please apply [attachment:trac_12347.patch] to `SAGE_ROOT` (the directory where the `Makefile` is present). If the review is positive then we should also remove `SAGE_ROOT/local/bin/sage-hardcode_sage_root` from the tree since it is no longer needed.

I also ran into some problems with `cp`, in particular with this line in the `Makefile`:

```
cp -rpv * $(DESTDIR)/sage/
```
On the system that I tried this, cp actually errored out with error status 2. The last few lines of the make output are as follows:

```
$ make DESTDIR="/tmp/sage-install" install

.... tons of copying stuff ....

`spkg/logs/matplotlib-1.0.1.p0.log' -> `/tmp/sage-install/sage/spkg/logs/matplotlib-1.0.1.p0.log'
`spkg/logs/sqlite-3.7.5.p0.log' -> `/tmp/sage-install/sage/spkg/logs/sqlite-3.7.5.p0.log'
`start.log' -> `/tmp/sage-install/sage/start.log'
`tmp' -> `/tmp/sage-install/sage/tmp'
make: *** [install] Error 1
```
I can not fathom why it errors out. As a workaround, I changed the `cp` command to include `-u` and the cp finishes fine after invoking the make command once again:

```
$ make DESTDIR="/tmp/sage-install" install
echo "Experimental use only!"
Experimental use only!
if [ "/tmp/sage-install" = "" ]; then \
		echo "Set DESTDIR"; \
		exit 1; \
	fi
mkdir -p /tmp/sage-install
mkdir -p /tmp/sage-install/sage
mkdir -p /tmp/sage-install/bin/
cp -rpuv * /tmp/sage-install/sage/
`Makefile' -> `/tmp/sage-install/sage/Makefile'
cd /tmp/sage-install/bin; ln -sfn ../sage/sage ./sage; ./sage -c
The Sage installation tree may have moved
(from /home/punarbasu/Installations/sage-4.8 to /tmp/sage-install/sage).
Changing various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Done resetting paths.
```



---

archive/issue_events_103313.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-01-28T12:59:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103313"
}
```



---

archive/issue_comments_138225.json:
```json
{
    "body": "<a id='comment:8'></a>\nYou shouldn't use the options `-u`, `-v`, or `-R` for cp.  Re `-r`, the man page for cp on OS X says\n\n```\n     Historic versions of the cp utility had a -r option.  This implementation supports that\n     option; however, its use is strongly discouraged, as it does not correctly copy special\n     files, symbolic links, or fifo's.\n```\nThe OS X version of cp doesn't recognize the `-u` option at all.  The Solaris version of cp doesn't support `-u` or `-v`.\n\nMake sure to only use Posix-standard options; I think [this web page](http://pwet.fr/man/linux/commandes/posix/cp) is accurate.\n\nAlong the same lines, on Solaris (and perhaps other platforms), `ln -f` doesn't behave the way it does on linux; see the comment on line 71 of the file SAGE_ROOT/local/bin/sage-build.",
    "created_at": "2012-01-28T15:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138225",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
You shouldn't use the options `-u`, `-v`, or `-R` for cp.  Re `-r`, the man page for cp on OS X says

```
     Historic versions of the cp utility had a -r option.  This implementation supports that
     option; however, its use is strongly discouraged, as it does not correctly copy special
     files, symbolic links, or fifo's.
```
The OS X version of cp doesn't recognize the `-u` option at all.  The Solaris version of cp doesn't support `-u` or `-v`.

Make sure to only use Posix-standard options; I think [this web page](http://pwet.fr/man/linux/commandes/posix/cp) is accurate.

Along the same lines, on Solaris (and perhaps other platforms), `ln -f` doesn't behave the way it does on linux; see the comment on line 71 of the file SAGE_ROOT/local/bin/sage-build.



---

archive/issue_events_103314.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T15:58:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103314"
}
```



---

archive/issue_events_103315.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2012-01-28T15:58:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103315"
}
```



---

archive/issue_comments_138226.json:
```json
{
    "body": "<a id='comment:9'></a>\n@jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. The options `-r`, `-v` were all present from before. `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.\n\nIf `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?",
    "created_at": "2012-01-28T16:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138226",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:9'></a>
@jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. The options `-r`, `-v` were all present from before. `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.

If `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?



---

archive/issue_comments_138227.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [ppurka](#comment%3A9):\n> @jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. \n\n\nSolaris is a supported platform for Sage on which the `-u` option is not recognized, so it doesn't matter too much why you added it: it's not going to work.\n\n> The options `-r`, `-v` were all present from before. \n\n\nBut while you're fixing other things, you might as well fix this.  Just use `-R` or `-pR` instead.\n\n> `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.\n\n\nSame comment as before: it's not going to work this way, so you should do it a different way.  (For example, first run 'rm -f ...' on the link, then do 'ln -s ...'.)\n\n> If `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?\n\n\nI think that 'cp -pR' is reliable on all platforms.  Note also that the 'make install' option says \"Experimental use only!\", so I don't think it's been well-maintained or supported, or even used much, which is why, for example, the `-v` option for cp wasn't removed earlier.  But if you're working on this, you should do it right, so that it works on all supported platforms.  Using POSIX-standard commands should be completely reliable; every platform's version of 'cp' should support the POSIX-standard options for cp.",
    "created_at": "2012-01-28T16:50:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138227",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
Replying to [ppurka](#comment%3A9):
> @jhpalmieri: I added -u to make sure that the second time `make install` is run, cp does not go around copying the files all over again. 


Solaris is a supported platform for Sage on which the `-u` option is not recognized, so it doesn't matter too much why you added it: it's not going to work.

> The options `-r`, `-v` were all present from before. 


But while you're fixing other things, you might as well fix this.  Just use `-R` or `-pR` instead.

> `ln -f` was needed in case the user ran `make install` yet again, otherwise ln would give error. If the first invocation of make install doesn't fail, then there is no need to use -f with ln.


Same comment as before: it's not going to work this way, so you should do it a different way.  (For example, first run 'rm -f ...' on the link, then do 'ln -s ...'.)

> If `cp` is unreliable then what is the alternative (it is actually quite reliable on linux with the `-a` option, that is, it copies symlinks properly)? Alternatively, can we assume that `rsync` is available on all platforms and use rsync instead?


I think that 'cp -pR' is reliable on all platforms.  Note also that the 'make install' option says "Experimental use only!", so I don't think it's been well-maintained or supported, or even used much, which is why, for example, the `-v` option for cp wasn't removed earlier.  But if you're working on this, you should do it right, so that it works on all supported platforms.  Using POSIX-standard commands should be completely reliable; every platform's version of 'cp' should support the POSIX-standard options for cp.



---

archive/attachments_016577.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12347-remove-sage-hardcode.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12347/trac_12347-remove-sage-hardcode.patch",
    "created_at": "2012-01-28T19:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_138228.json:
```json
{
    "body": "Remove unnecessary file. Apply to `SAGE_ROOT/local/bin`",
    "created_at": "2012-01-28T19:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138228",
    "user": "https://github.com/ppurka"
}
```

Remove unnecessary file. Apply to `SAGE_ROOT/local/bin`



---

archive/issue_comments_138229.json:
```json
{
    "body": "<a id='comment:11'></a>\nUpdated the patches.\n\nNow I see why cp failed:\n\n```\n...stallations/sage-4.8> make DESTDIR=\"/tmp/sage-xxxx\" install |& tee -i -a ~/tmp/log-new.txt\necho \"Experimental use only!\"\nExperimental use only!\nif [ \"/tmp/sage-xxxx\" = \"\" ]; then \\\n\t\techo \"Set DESTDIR\"; \\\n\t\texit 1; \\\n\tfi\nmkdir -p /tmp/sage-xxxx\nmkdir -p /tmp/sage-xxxx/sage\nmkdir -p /tmp/sage-xxxx/bin/\ncp -Rp * /tmp/sage-xxxx/sage/\ncp: reading `local/lib/libpari.a': Input/output error\nmake: *** [install] Error 1\n```\nRebuilding pari makes this bug go away\n\n```\n~/Installations/sage-4.8> ./sage -f spkg/standard/pari-2.5.0.p3.spkg >& ~/tmp/pari.txt\n~/Installations/sage-4.8> cp local/lib/libpari.a /tmp\n~/Installations/sage-4.8> \n```",
    "created_at": "2012-01-28T19:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138229",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:11'></a>
Updated the patches.

Now I see why cp failed:

```
...stallations/sage-4.8> make DESTDIR="/tmp/sage-xxxx" install |& tee -i -a ~/tmp/log-new.txt
echo "Experimental use only!"
Experimental use only!
if [ "/tmp/sage-xxxx" = "" ]; then \
		echo "Set DESTDIR"; \
		exit 1; \
	fi
mkdir -p /tmp/sage-xxxx
mkdir -p /tmp/sage-xxxx/sage
mkdir -p /tmp/sage-xxxx/bin/
cp -Rp * /tmp/sage-xxxx/sage/
cp: reading `local/lib/libpari.a': Input/output error
make: *** [install] Error 1
```
Rebuilding pari makes this bug go away

```
~/Installations/sage-4.8> ./sage -f spkg/standard/pari-2.5.0.p3.spkg >& ~/tmp/pari.txt
~/Installations/sage-4.8> cp local/lib/libpari.a /tmp
~/Installations/sage-4.8> 
```



---

archive/issue_comments_138230.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -20,3 +20,10 @@\n automatically by `make install` up to 4.7.2, and was broken in Sage 4.8.\n \n Paul\n+\n+---\n+Hard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.\n+\n+1. Apply [attachment:trac_12347-remove-sage-hardcode.patch] to `SAGE_ROOT/local/bin`\n+\n+2. Apply [attachment:trac_12347.patch] to `SAGE_ROOT`\n``````\n",
    "created_at": "2012-01-28T19:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138230",
    "user": "https://github.com/ppurka"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -20,3 +20,10 @@
 automatically by `make install` up to 4.7.2, and was broken in Sage 4.8.
 
 Paul
+
+---
+Hard coding of SAGE_ROOT is removed from `make install` now. We simply do a symbolic link.
+
+1. Apply [attachment:trac_12347-remove-sage-hardcode.patch] to `SAGE_ROOT/local/bin`
+
+2. Apply [attachment:trac_12347.patch] to `SAGE_ROOT`
``````




---

archive/issue_comments_138231.json:
```json
{
    "body": "<a id='comment:12'></a>\nis the patch ready for review? No work issues were added in comment [comment:8].\n\nPaul",
    "created_at": "2012-01-30T15:14:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138231",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'></a>
is the patch ready for review? No work issues were added in comment [comment:8].

Paul



---

archive/issue_comments_138232.json:
```json
{
    "body": "<a id='comment:13'></a>\nSorry, forgot to set it to needs_review.",
    "created_at": "2012-01-30T15:20:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138232",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:13'></a>
Sorry, forgot to set it to needs_review.



---

archive/issue_events_103316.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-01-30T15:20:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103316"
}
```



---

archive/issue_events_103317.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-01-30T15:20:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103317"
}
```



---

archive/issue_events_103318.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-06T12:23:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103318"
}
```



---

archive/issue_events_103319.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-06T12:23:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103319"
}
```



---

archive/issue_comments_138233.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplace\n\n```\ncd $(DESTDIR)/bin; ln -s ../sage/sage ./sage; ./sage -c\n```\nby\n\n```\n-rm -f $(DESTDIR)/bin/sage\nln -s ../sage/sage $(DESTDIR)/bin/sage\n$(DESTDIR)/bin/sage -c   # Need to run sage-location\n```",
    "created_at": "2012-04-06T12:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138233",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replace

```
cd $(DESTDIR)/bin; ln -s ../sage/sage ./sage; ./sage -c
```
by

```
-rm -f $(DESTDIR)/bin/sage
ln -s ../sage/sage $(DESTDIR)/bin/sage
$(DESTDIR)/bin/sage -c   # Need to run sage-location
```



---

archive/issue_comments_138234.json:
```json
{
    "body": "**Author:** Punarbasu Purkayastha",
    "created_at": "2012-04-06T12:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138234",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Punarbasu Purkayastha



---

archive/issue_comments_138235.json:
```json
{
    "body": "<a id='comment:15'></a>\nupdated.",
    "created_at": "2012-04-06T15:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138235",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:15'></a>
updated.



---

archive/issue_events_103320.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-10T12:39:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103320"
}
```



---

archive/issue_events_103321.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-10T12:39:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103321"
}
```



---

archive/issue_comments_138236.json:
```json
{
    "body": "<a id='comment:17'></a>\nJust one more thing: it would be better to first delete `$(DESTDIR)/sage/` for two reasons:\n1. if there already was a previous version, there might be some kind of conflict (although I cannot immediately think of a concrete problem that could occur).\n2. some program in the old version might still be running (considering `sage-cleaner`, this is less unlikely than you might think at first).",
    "created_at": "2012-04-11T17:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138236",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'></a>
Just one more thing: it would be better to first delete `$(DESTDIR)/sage/` for two reasons:
1. if there already was a previous version, there might be some kind of conflict (although I cannot immediately think of a concrete problem that could occur).
2. some program in the old version might still be running (considering `sage-cleaner`, this is less unlikely than you might think at first).



---

archive/issue_events_103322.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-11T17:37:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103322"
}
```



---

archive/issue_events_103323.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-11T17:37:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103323"
}
```



---

archive/issue_comments_138237.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2012-04-11T17:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138237",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_138238.json:
```json
{
    "body": "<a id='comment:19'></a>\nUpdated the patch. I guess we could write some logic to detect if a sage process is running, but it would not be robust enough and would bloat the install part.\n\nI updated the patch to not proceed with the installation if the `$(DESTDIR)/sage` is a file or symlink. It will (hopefully) prevent accidents. :)",
    "created_at": "2012-04-13T14:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138238",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:19'></a>
Updated the patch. I guess we could write some logic to detect if a sage process is running, but it would not be robust enough and would bloat the install part.

I updated the patch to not proceed with the installation if the `$(DESTDIR)/sage` is a file or symlink. It will (hopefully) prevent accidents. :)



---

archive/issue_events_103324.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-13T14:40:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103324"
}
```



---

archive/issue_events_103325.json:
```json
{
    "actor": "https://github.com/ppurka",
    "created_at": "2012-04-13T14:40:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103325"
}
```



---

archive/issue_comments_138239.json:
```json
{
    "body": "<a id='comment:21'></a>\n\"`[ -e`\" isn't portable.  \"`[ -f`\" is portable.\n\nWhy do you talk about symlinks in your comment?  I don't see that in your code.\n\nI would simply remove the whole `elif` block.  `mkdir -p \"$(DESTDIR)\"/sage` should fail anyway if `\"$(DESTDIR)\"/sage` is a non-directory.",
    "created_at": "2012-04-13T14:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138239",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
"`[ -e`" isn't portable.  "`[ -f`" is portable.

Why do you talk about symlinks in your comment?  I don't see that in your code.

I would simply remove the whole `elif` block.  `mkdir -p "$(DESTDIR)"/sage` should fail anyway if `"$(DESTDIR)"/sage` is a non-directory.



---

archive/issue_comments_138240.json:
```json
{
    "body": "<a id='comment:22'></a>\nMention in a comment that the \"`[ -d`\" test is meant to exclude the case that \"$(DESTDIR)\"/sage is an existing file, not a directory.",
    "created_at": "2012-04-13T14:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138240",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Mention in a comment that the "`[ -d`" test is meant to exclude the case that "$(DESTDIR)"/sage is an existing file, not a directory.



---

archive/issue_comments_138241.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jdemeyer](#comment%3A21):\n> Why do you talk about symlinks in your comment?  I don't see that in your code.\n\n\nWell, `-e` checks for both. I didn't know it wasn't portable. You are correct that mkdir will fail. I hadn't thought of that.",
    "created_at": "2012-04-13T15:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138241",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:23'></a>
Replying to [jdemeyer](#comment%3A21):
> Why do you talk about symlinks in your comment?  I don't see that in your code.


Well, `-e` checks for both. I didn't know it wasn't portable. You are correct that mkdir will fail. I hadn't thought of that.



---

archive/issue_comments_138242.json:
```json
{
    "body": "Apply to SAGE_ROOT",
    "created_at": "2012-04-13T15:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138242",
    "user": "https://github.com/ppurka"
}
```

Apply to SAGE_ROOT



---

archive/attachments_016578.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_12347.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket12347/trac_12347.patch",
    "created_at": "2012-04-13T15:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/ppurka"
}
```



---

archive/issue_comments_138243.json:
```json
{
    "body": "<a id='comment:24'></a>\nUpdated.",
    "created_at": "2012-04-13T15:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138243",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:24'></a>
Updated.



---

archive/issue_comments_138244.json:
```json
{
    "body": "<a id='comment:25'></a>\nActually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).",
    "created_at": "2012-04-13T15:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138244",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:25'></a>
Actually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).



---

archive/issue_comments_138245.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [ppurka](#comment%3A25):\n> Actually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).\n\n\nMaybe it \"should be\", but it isn't.",
    "created_at": "2012-04-13T15:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138245",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [ppurka](#comment%3A25):
> Actually `-e` should be portable, going by [this page](http://www.unix.com/man-page/POSIX/1/test/).


Maybe it "should be", but it isn't.



---

archive/issue_comments_138246.json:
```json
{
    "body": "<a id='comment:27'></a>\nFor shell script portability discussions, I often refer to the GNU autoconf manual: [http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell](http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell).\n\nQuoting from there:\n> But occasionally you may find it necessary to check whether some arbitrary file exists. To do so, use \u2018test -f\u2019 or \u2018test -r\u2019. Do not use \u2018test -x\u2019, because 4.3BSD does not have it. Do not use \u2018test -e\u2019 either, because Solaris /bin/sh lacks it. To test for symbolic links on systems that have them, use \u2018test -h\u2019 rather than \u2018test -L\u2019; either form conforms to Posix 1003.1-2001, but older shells like Solaris 8 /bin/sh support only -h.\n",
    "created_at": "2012-04-13T15:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138246",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>
For shell script portability discussions, I often refer to the GNU autoconf manual: [http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell](http://www.gnu.org/savannah-checkouts/gnu/autoconf/manual/autoconf-2.68/html_node/Portable-Shell.html#Portable-Shell).

Quoting from there:
> But occasionally you may find it necessary to check whether some arbitrary file exists. To do so, use ‘test -f’ or ‘test -r’. Do not use ‘test -x’, because 4.3BSD does not have it. Do not use ‘test -e’ either, because Solaris /bin/sh lacks it. To test for symbolic links on systems that have them, use ‘test -h’ rather than ‘test -L’; either form conforms to Posix 1003.1-2001, but older shells like Solaris 8 /bin/sh support only -h.




---

archive/issue_comments_138247.json:
```json
{
    "body": "<a id='comment:28'></a>\nThanks!",
    "created_at": "2012-04-13T15:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138247",
    "user": "https://github.com/ppurka"
}
```

<a id='comment:28'></a>
Thanks!



---

archive/issue_comments_138248.json:
```json
{
    "body": "<a id='comment:29'></a>\nthe patches apply successfully to sage-5.0.beta13 and `make install` works.\nMy only comment after looking at the patch: shouldn't we check also if $(DESTDIR)/bin\nalready exists?\n\nPaul",
    "created_at": "2012-04-16T14:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138248",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:29'></a>
the patches apply successfully to sage-5.0.beta13 and `make install` works.
My only comment after looking at the patch: shouldn't we check also if $(DESTDIR)/bin
already exists?

Paul



---

archive/issue_comments_138249.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [zimmerma](#comment%3A29):\n> shouldn't we check also if $(DESTDIR)/bin already exists?\n\nWhy?  What would you propose?",
    "created_at": "2012-04-16T14:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138249",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:30'></a>
Replying to [zimmerma](#comment%3A29):
> shouldn't we check also if $(DESTDIR)/bin already exists?

Why?  What would you propose?



---

archive/issue_comments_138250.json:
```json
{
    "body": "<a id='comment:31'></a>\nif we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin\nwith a previous installation of Sage. What will then happen? I propose to remove\n$(DESTDIR)/bin if it exists and is a directory.\n\nPaul",
    "created_at": "2012-04-16T15:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138250",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:31'></a>
if we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin
with a previous installation of Sage. What will then happen? I propose to remove
$(DESTDIR)/bin if it exists and is a directory.

Paul



---

archive/issue_comments_138251.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [zimmerma](#comment%3A31):\n> if we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin\n> with a previous installation of Sage. What will then happen?\n\nNothing bad will happen.  The file or symbolic link `$(DESTDIR)/bin/sage` will be deleted and recreated as symbolic link to `$(DESTDIR)/sage/sage`.",
    "created_at": "2012-04-16T15:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138251",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Replying to [zimmerma](#comment%3A31):
> if we assume that $(DESTDIR)/sage can already exist, the same can happen for $(DESTDIR)/bin
> with a previous installation of Sage. What will then happen?

Nothing bad will happen.  The file or symbolic link `$(DESTDIR)/bin/sage` will be deleted and recreated as symbolic link to `$(DESTDIR)/sage/sage`.



---

archive/issue_comments_138252.json:
```json
{
    "body": "<a id='comment:33'></a>\nok, then I give a positive review.\n\nPaul",
    "created_at": "2012-04-16T15:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138252",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:33'></a>
ok, then I give a positive review.

Paul



---

archive/issue_events_103326.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-04-16T15:22:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103326"
}
```



---

archive/issue_events_103327.json:
```json
{
    "actor": "https://github.com/zimmermann6",
    "created_at": "2012-04-16T15:22:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103327"
}
```



---

archive/issue_comments_138253.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Paul Zimmermann\".",
    "created_at": "2012-04-16T15:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138253",
    "user": "https://github.com/zimmermann6"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Paul Zimmermann".



---

archive/issue_comments_138254.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [zimmerma](#comment%3A33):\n> ok, then I give a positive review.\n\nAgreed.",
    "created_at": "2012-04-16T15:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138254",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
Replying to [zimmerma](#comment%3A33):
> ok, then I give a positive review.

Agreed.



---

archive/issue_comments_138255.json:
```json
{
    "body": "**Merged:** sage-5.0.beta14",
    "created_at": "2012-04-19T08:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12347#issuecomment-138255",
    "user": "https://github.com/jdemeyer"
}
```

**Merged:** sage-5.0.beta14



---

archive/issue_events_103328.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T08:10:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103328"
}
```



---

archive/issue_events_103329.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-04-19T08:10:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12347",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12347#event-103329"
}
```
