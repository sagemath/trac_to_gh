# Issue 12548: In MPFR, don't delete old libraries

archive/issues_012376.json:
```json
{
    "body": "libmpfr (and libmpfr and libmpc, #12515) are run-time dependencies of `gcc` (#12369).  These therefore become build-time dependencies of Sage.  When these libraries are deleted during installation of mpfr, gcc stops working, causing build failures in parallel builds.\n\nSince there is no clear reason why the old libraries should be deleted, we simply don't delete them.  The mpir `spkg-install` already doesn't delete libraries and mpc will be fixed in #12515.\n\n**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpfr-2.4.2.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpfr-2.4.2.p2.spkg)\n\nAssignee: tbd\n\nCC:  jpflori\n\nResolution: fixed\n\nAuthor: Jeroen Demeyer\n\nReviewer: John Palmieri\n\nMerged: sage-5.0.beta6\n\nIssue created by migration from https://trac.sagemath.org/ticket/12548\n\n",
    "closed_at": "2012-02-27T11:23:25Z",
    "created_at": "2012-02-20T08:22:03Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "In MPFR, don't delete old libraries",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12548",
    "user": "https://github.com/jdemeyer"
}
```
libmpfr (and libmpfr and libmpc, #12515) are run-time dependencies of `gcc` (#12369).  These therefore become build-time dependencies of Sage.  When these libraries are deleted during installation of mpfr, gcc stops working, causing build failures in parallel builds.

Since there is no clear reason why the old libraries should be deleted, we simply don't delete them.  The mpir `spkg-install` already doesn't delete libraries and mpc will be fixed in #12515.

**spkg**: [http://boxen.math.washington.edu/home/jdemeyer/spkg/mpfr-2.4.2.p2.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/mpfr-2.4.2.p2.spkg)

Assignee: tbd

CC:  jpflori

Resolution: fixed

Author: Jeroen Demeyer

Reviewer: John Palmieri

Merged: sage-5.0.beta6

Issue created by migration from https://trac.sagemath.org/ticket/12548





---

archive/issue_comments_145682.json:
```json
{
    "body": "Diff for the mpfr spkg, for review only",
    "created_at": "2012-02-20T09:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145682",
    "user": "https://github.com/jdemeyer"
}
```

Diff for the mpfr spkg, for review only



---

archive/issue_comments_145683.json:
```json
{
    "body": "<a id='comment:2'></a>Attachment [mpfr-2.4.2.p2.diff](tarball://root/attachments/some-uuid/ticket12548/mpfr-2.4.2.p2.diff) by @jdemeyer created at 2012-02-20 10:05:26",
    "created_at": "2012-02-20T10:05:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145683",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Attachment [mpfr-2.4.2.p2.diff](tarball://root/attachments/some-uuid/ticket12548/mpfr-2.4.2.p2.diff) by @jdemeyer created at 2012-02-20 10:05:26



---

archive/issue_comments_145684.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-21T10:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145684",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_145685.json:
```json
{
    "body": "<a id='comment:4'></a>Looks good to me. Why even delete the headers?",
    "created_at": "2012-02-23T19:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145685",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>Looks good to me. Why even delete the headers?



---

archive/issue_comments_145686.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-23T19:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145686",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_145687.json:
```json
{
    "body": "<a id='comment:5'></a>Isn't the point of deleting the old librairies to not have tons of old librairies inside lib/ if Sage keeps on getting updated?\n\nYou might argue that it's not a big deal, because Sage is already so big, but...\n\nAnd wasn't #12366 sufficient for building gcc?",
    "created_at": "2012-02-24T11:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145687",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

<a id='comment:5'></a>Isn't the point of deleting the old librairies to not have tons of old librairies inside lib/ if Sage keeps on getting updated?

You might argue that it's not a big deal, because Sage is already so big, but...

And wasn't #12366 sufficient for building gcc?



---

archive/issue_comments_145688.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:5 jpflori]:\n> Isn't the point of deleting the old librairies to not have tons of old librairies inside lib/ if Sage keeps on getting updated?\nProbably.  But this wouldn't work here, as deleting the old mpir/mpfr/mpc libraries would mean that gcc stops working.  There are work-arounds, but they would make the build/upgrade process a lot more complicated.\n\n> And wasn't #12366 sufficient for building gcc?\n\nFor *serial* builds, #12366 is sufficient.  The problem with *parallel* builds is that there is a cerain time between the deleting of the old mpfr libraries and the installation of the new mpfr libraries.  During that time, a gcc in a parallel build wouldn't work anymore.",
    "created_at": "2012-02-24T13:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145688",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:5 jpflori]:
> Isn't the point of deleting the old librairies to not have tons of old librairies inside lib/ if Sage keeps on getting updated?
Probably.  But this wouldn't work here, as deleting the old mpir/mpfr/mpc libraries would mean that gcc stops working.  There are work-arounds, but they would make the build/upgrade process a lot more complicated.

> And wasn't #12366 sufficient for building gcc?

For *serial* builds, #12366 is sufficient.  The problem with *parallel* builds is that there is a cerain time between the deleting of the old mpfr libraries and the installation of the new mpfr libraries.  During that time, a gcc in a parallel build wouldn't work anymore.



---

archive/issue_comments_145689.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-27T11:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12548#issuecomment-145689",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_033874.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-27T11:23:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12548",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12548#event-33874"
}
```
