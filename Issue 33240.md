# Issue 33240: Conversion problem between multivariate Laurent polynomial ring and its field of fraction

Issue created by migration from https://trac.sagemath.org/ticket/33477

Original creator: soehms

Original creation time: 2022-03-07 17:58:24

CC:  tscrim

Keywords: multivariate Laurent polynomial conversion fraction field localization

The issue is explained by the following example:


```sage
sage: R.<u, v> = LaurentPolynomialRing(ZZ)
sage: F = FractionField(R)
sage: R(F(1/u))
Traceback (most recent call last)
...
TypeError: fraction must have unit denominator
```


This has been fixed for univariate Laurent polynomial rings in #26425.

Here we will extend that fix to the multivariate case. Since in the meantime localization of integral domains is available, we will take care that it will work for localizations, as well.




---

Comment by soehms created at 2022-03-07 18:02:22

Changing status from new to needs_review.


---

Comment by soehms created at 2022-03-07 18:02:22

New commits:


---

Comment by git created at 2022-03-07 18:19:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-03-08 01:20:13

I am not sure I agree with removing the check `isinstance(x, FractionFieldElement):` with checking the parent and possibly building a transient fraction field. I have a feeling this could make the code slower because of this (although I don't have any evidence for this). Since this is a Laurent polynomial, I think we are okay to make some assumptions about what the fraction field elements will be. I am also not opposed to this, but perhaps you can give a bit of justification? This would also allow more separation with checking against a localization too.


---

Comment by soehms created at 2022-03-08 07:41:45

Replying to [comment:6 tscrim]:
> ... but perhaps you can give a bit of justification? 

I don't have a justification for this other than to treat both cases in one. Then I took it for redundant in view of the parent's check.

> This would also allow more separation with checking against a localization too.

Do you have something in mind like the following?


```python
...
        elif isinstance(x, FractionFieldElement):
            res = from_fraction_field(self, x)
            ...
        elif isinstance(x, LocalizationElement):
            res = from_localization(self, x)
...
```



---

Comment by tscrim created at 2022-03-08 08:46:21

That's right, I was thinking of something like that.


---

Comment by git created at 2022-03-09 07:40:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by soehms created at 2022-03-09 07:41:26

Replying to [comment:8 tscrim]:
> That's right, I was thinking of something like that.

Here now the implementation according to this suggestion!


---

Comment by tscrim created at 2022-03-10 07:14:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-03-10 07:14:02

Thank you. LGTM.


---

Comment by soehms created at 2022-03-10 17:31:26

Replying to [comment:11 tscrim]:
> Thank you. LGTM.

Thanks, as well.


---

Comment by vbraun created at 2022-03-20 18:59:23

Resolution: fixed
