# Issue 22910: py3: little cleanup of six and unicode

archive/issues_022910.json:
```json
{
    "body": "CC:  jdemeyer tscrim jhpalmieri\n\nvarious small changes, split off from #23044\n\nIssue created by migration from https://trac.sagemath.org/ticket/23147\n\n",
    "created_at": "2017-06-06T09:53:49Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "py3: little cleanup of six and unicode",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22910",
    "user": "chapoton"
}
```
CC:  jdemeyer tscrim jhpalmieri

various small changes, split off from #23044

Issue created by migration from https://trac.sagemath.org/ticket/23147





---

archive/issue_comments_320536.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-06-06T09:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320536",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_320537.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-06-06T18:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320537",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_320538.json:
```json
{
    "body": "Make this change and I'll be happy with it:\n\n```diff\ndiff --git a/src/sage/algebras/commutative_dga.py b/src/sage/algebras/commutative_dga.py\nindex e571a51c30..a5071198f1 100644\n--- a/src/sage/algebras/commutative_dga.py\n+++ b/src/sage/algebras/commutative_dga.py\n@@ -71,7 +71,7 @@ AUTHORS:\n # (at your option) any later version.\n #                  http://www.gnu.org/licenses/\n #*****************************************************************************\n-from __future__ import print_function, absolute_import\n+from __future__ import print_function\n from six import string_types\n \n from sage.misc.six import with_metaclass\n```\n",
    "created_at": "2017-06-06T21:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320538",
    "user": "jhpalmieri"
}
```

Make this change and I'll be happy with it:

```diff
diff --git a/src/sage/algebras/commutative_dga.py b/src/sage/algebras/commutative_dga.py
index e571a51c30..a5071198f1 100644
--- a/src/sage/algebras/commutative_dga.py
+++ b/src/sage/algebras/commutative_dga.py
@@ -71,7 +71,7 @@ AUTHORS:
 # (at your option) any later version.
 #                  http://www.gnu.org/licenses/
 #*****************************************************************************
-from __future__ import print_function, absolute_import
+from __future__ import print_function
 from six import string_types
 
 from sage.misc.six import with_metaclass
```




---

archive/issue_comments_320539.json:
```json
{
    "body": "Thanks for the review.\n\nConcerning your suggestion, sorry, but why ?\n\nIdeally, we should have this \"absolute_import\" in all of our .py files, to help for the transition for python3 and prevent possible regressions. Adding this should do no harm at all, once the file has been checked.",
    "created_at": "2017-06-07T05:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320539",
    "user": "chapoton"
}
```

Thanks for the review.

Concerning your suggestion, sorry, but why ?

Ideally, we should have this "absolute_import" in all of our .py files, to help for the transition for python3 and prevent possible regressions. Adding this should do no harm at all, once the file has been checked.



---

archive/issue_comments_320540.json:
```json
{
    "body": "I didn't see the point to it. It is not necessary for `from six import ...` since we're not in the `sage.misc` directory. So why add extra lines that are not needed? But I don't care that much.",
    "created_at": "2017-06-07T14:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320540",
    "user": "jhpalmieri"
}
```

I didn't see the point to it. It is not necessary for `from six import ...` since we're not in the `sage.misc` directory. So why add extra lines that are not needed? But I don't care that much.



---

archive/issue_comments_320541.json:
```json
{
    "body": "You are right. So maybe we should rather move on to work on something else, no ?",
    "created_at": "2017-06-07T14:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320541",
    "user": "chapoton"
}
```

You are right. So maybe we should rather move on to work on something else, no ?



---

archive/issue_comments_320542.json:
```json
{
    "body": "So ? positive review ?",
    "created_at": "2017-06-08T19:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320542",
    "user": "chapoton"
}
```

So ? positive review ?



---

archive/issue_comments_320543.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-06-08T20:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320543",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_320544.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-11T09:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320544",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_320545.json:
```json
{
    "body": "This part doesn't make a lot of sense to me:\n\n\n```diff\n@@ -1635,7 +1636,7 @@ def _sage_getdoc_unformatted(obj):\n     # not a 'getset_descriptor' or similar.\n     if not isinstance(r, string_types):\n         return ''\n-    elif isinstance(r, unicode):\n+    elif isinstance(r, text_type):  # unicode (py2) = str (py3)\n         return r.encode('utf-8', 'ignore')\n     else:\n         return r\n```\n\n\nnot your patch specifically--replacing `unicode` with `text_type` makes sense.  But the `r.encode` that was there in the first place isn't right.  It actually causes a crash for me at startup, because the return value from this function is later consumed by code that's expected text, not bytes.  In other words, this code might have made slight sense from a Python 2 perspective, but for Python 3 it only makes sense here to leave `str` as `str`.",
    "created_at": "2017-09-05T14:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320545",
    "user": "embray"
}
```

This part doesn't make a lot of sense to me:


```diff
@@ -1635,7 +1636,7 @@ def _sage_getdoc_unformatted(obj):
     # not a 'getset_descriptor' or similar.
     if not isinstance(r, string_types):
         return ''
-    elif isinstance(r, unicode):
+    elif isinstance(r, text_type):  # unicode (py2) = str (py3)
         return r.encode('utf-8', 'ignore')
     else:
         return r
```


not your patch specifically--replacing `unicode` with `text_type` makes sense.  But the `r.encode` that was there in the first place isn't right.  It actually causes a crash for me at startup, because the return value from this function is later consumed by code that's expected text, not bytes.  In other words, this code might have made slight sense from a Python 2 perspective, but for Python 3 it only makes sense here to leave `str` as `str`.



---

archive/issue_comments_320546.json:
```json
{
    "body": "indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)",
    "created_at": "2017-09-05T14:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320546",
    "user": "chapoton"
}
```

indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)



---

archive/issue_comments_320547.json:
```json
{
    "body": "Replying to [comment:11 chapoton]:\n> indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)\n\nRight. I see now that you did this in your branch.",
    "created_at": "2017-09-05T15:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22910",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22910#issuecomment-320547",
    "user": "embray"
}
```

Replying to [comment:11 chapoton]:
> indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)

Right. I see now that you did this in your branch.
