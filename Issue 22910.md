# Issue 22910: py3: little cleanup of six and unicode

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2017-06-06 09:53:49

CC:  jdemeyer tscrim jhpalmieri

various small changes, split off from #23044


---

Comment by chapoton created at 2017-06-06 09:54:31

New commits:


---

Comment by chapoton created at 2017-06-06 18:05:24

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2017-06-06 21:18:15

Make this change and I'll be happy with it:

```diff
diff --git a/src/sage/algebras/commutative_dga.py b/src/sage/algebras/commutative_dga.py
index e571a51c30..a5071198f1 100644
--- a/src/sage/algebras/commutative_dga.py
+++ b/src/sage/algebras/commutative_dga.py
`@``@` -71,7 +71,7 `@``@` AUTHORS:
 # (at your option) any later version.
 #                  http://www.gnu.org/licenses/
 #*****************************************************************************
-from __future__ import print_function, absolute_import
+from __future__ import print_function
 from six import string_types
 
 from sage.misc.six import with_metaclass
```



---

Comment by chapoton created at 2017-06-07 05:56:47

Thanks for the review.

Concerning your suggestion, sorry, but why ?

Ideally, we should have this "absolute_import" in all of our .py files, to help for the transition for python3 and prevent possible regressions. Adding this should do no harm at all, once the file has been checked.


---

Comment by jhpalmieri created at 2017-06-07 14:46:10

I didn't see the point to it. It is not necessary for `from six import ...` since we're not in the `sage.misc` directory. So why add extra lines that are not needed? But I don't care that much.


---

Comment by chapoton created at 2017-06-07 14:48:38

You are right. So maybe we should rather move on to work on something else, no ?


---

Comment by chapoton created at 2017-06-08 19:03:41

So ? positive review ?


---

Comment by jhpalmieri created at 2017-06-08 20:23:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-11 09:13:19

Resolution: fixed


---

Comment by embray created at 2017-09-05 14:19:35

This part doesn't make a lot of sense to me:


```diff
`@``@` -1635,7 +1636,7 `@``@` def _sage_getdoc_unformatted(obj):
     # not a 'getset_descriptor' or similar.
     if not isinstance(r, string_types):
         return ''
-    elif isinstance(r, unicode):
+    elif isinstance(r, text_type):  # unicode (py2) = str (py3)
         return r.encode('utf-8', 'ignore')
     else:
         return r
```


not your patch specifically--replacing `unicode` with `text_type` makes sense.  But the `r.encode` that was there in the first place isn't right.  It actually causes a crash for me at startup, because the return value from this function is later consumed by code that's expected text, not bytes.  In other words, this code might have made slight sense from a Python 2 perspective, but for Python 3 it only makes sense here to leave `str` as `str`.


---

Comment by chapoton created at 2017-09-05 14:21:48

indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)


---

Comment by embray created at 2017-09-05 15:44:15

Replying to [comment:11 chapoton]:
> indeed, one should do the contrary (add decode in the other part, but this causes doctests failures..)

Right. I see now that you did this in your branch.
