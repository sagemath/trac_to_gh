# Issue 18283: Matrix morphism addition ignores bases

Issue created by migration from Trac.

Original creator: rbeezer

Original creation time: 2015-05-26 18:07:16

CC:  rud roed

Keywords: matrix morphism sum addition

When two module or vector space morphisms are added, the `matrix_morphism` module simply adds their matrix representations, *even if the representations have wildly different bases.*  To wit,

`S, T, R` are all versions of the identity linear transformation, so `S+T, S+R` should just be `2I`.


```
sage: u = vector([1,2])
sage: S = linear_transformation(QQ^2, QQ^2, [[1,0],[0,1]])
sage: T = linear_transformation(QQ^2, QQ^2, [[1,0],[0,1]])
sage: good = ((S+T)(u) == S(u) + T(u))
sage: B  = [vector([0,1]), vector([1,0])]
sage: V = (QQ^2).subspace_with_basis(B)
sage: R = T.restrict_domain(V)
sage: bad = ((S+R)(u) == S(u) + R(u))
sage: ugly = (S+R).matrix()
sage: good, bad, ugly
(
             [1 1]
True, False, [1 1]
)
```



---

Comment by rbeezer created at 2015-05-26 18:09:08

Packaging up a fix now.  The result (sum) will have the bases from `self`, meaning that the matrix representation of `right` will need to change.


---

Comment by mkoeppe created at 2020-08-17 15:51:16

Changing priority from minor to critical.


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by roed created at 2021-08-03 20:36:55

I think the issue is that `S` and `R` don't have the same domain.  We should either raise an error in this case, or compose with the coercion map `V -> QQ^2`.


---

Comment by @mjungmath created at 2021-12-19 11:27:20

Replying to [comment:5 roed]:
> I think the issue is that `S` and `R` don't have the same domain.  We should either raise an error in this case, or compose with the coercion map `V -> QQ^2`.

The problem I see here is that there is really no preferred coercion:


```
sage: S = linear_transformation(QQ^2, QQ^2, [[1,0],[0,1]])
sage: T = linear_transformation(QQ^2, QQ^2, [[1,0],[0,1]])
sage: B  = [vector([0,1]), vector([1,0])]
sage: V = (QQ^2).subspace_with_basis(B)
sage: R = T.restrict_domain(V)
sage: S+R
Free module morphism defined by the matrix
[1 1]
[1 1]
Domain: Vector space of dimension 2 over Rational Field
Codomain: Vector space of dimension 2 over Rational Field
sage: R+S
Free module morphism defined by the matrix
[1 1]
[1 1]
Domain: Vector space of degree 2 and dimension 2 over Rational Field
User basis matrix:
[0 1]
[1 0]
```


I'd opt for an error message.


---

Comment by @mjungmath created at 2021-12-19 11:44:09

But in any case, the coercion needs to be fixed. In fact, nothing happens to `R` or `S` when coerced.
