# Issue 29798: Invariants of Ternary Cubic Forms do not live in the base ring

Issue created by migration from https://trac.sagemath.org/ticket/30035

Original creator: @davidac897

Original creation time: 2020-07-01 01:42:08

CC:  mstreng kohel florian sijsling jnoordsij

Keywords: invariant theory

It seems that invariants of ternary cubic forms (and I assume other kinds of forms, but I didn't try) live in the polynomial ring, not in the base ring. Therefore, I get this, which shouldn't happen:



```
R.<a,b,c> = QQ[]
RR.<x,y,z> = QQ[]

f = 1994893*a^3 + 4498037*a^2*b + 3358044*a*b^2 + 830875*b^3 + 7859654*a^2*c + 11828845*a*b*c + 4420000*b^2*c + 10319781*a*c^2 + 7775375*b*c^2 + 4515625*c^3
ff = x^3 + 11*x^2*y - 14*x*y^2 + y^3 + 11*x^2*z + 135*x*y*z - 160*y^2*z - 14*x*z^2 + 3*y*z^2 + z^3


T = invariant_theory.ternary_cubic(f)
TT = invariant_theory.ternary_cubic(ff)

T.S_invariant(); TT.S_invariant(); T.S_invariant() == TT.S_invariant();  T.S_invariant() == QQ(TT.S_invariant())
```


produces outputs of -705911761/1296, -705911761/1296, False, True.



---

Comment by chapoton created at 2020-07-01 08:52:11

The problem comes from `scaled_coeffs`:


```
sage: [parent(u) for u in T.scaled_coeffs()]
[Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field]
```

and then from `coeffs`

```
sage: [parent(u) for u in T.coeffs()]
[Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field]
```

which calls
`_extract_coefficients`


---

Comment by chapoton created at 2020-07-01 09:39:52

This seems from deep inside the invariant code. The choice not to separate true variables of the cubic forms and variables for the coefficients seems to be very wrong, and a serious flaw in the design.


---

Comment by chapoton created at 2020-07-01 10:30:53

New commits:


---

Comment by chapoton created at 2020-07-01 10:30:53

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-07-01 10:31:10

This still needs a doctest.


---

Comment by git created at 2020-07-01 12:37:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-07-01 12:37:48

now with doctest


---

Comment by chapoton created at 2020-07-01 19:56:30

green bot, needs review


---

Comment by chapoton created at 2020-08-13 11:07:46

GREEN BOT, **please review** !


---

Comment by slabbe created at 2020-08-14 12:23:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-08-23 16:28:01

Resolution: fixed
