# Issue 18445: Add SetSystem.is_connected()

Issue created by migration from Trac.

Original creator: Rudi

Original creation time: 2015-06-11 19:11:22

Assignee: Rudi

CC:  chaoxu vdelecroix

Add a routine for testing connectivity of a SetSystem.


---

Comment by Rudi created at 2015-06-11 19:33:43

First try.

```
sage: from sage.matroids.set_system import SetSystem
sage: M = Matroid(MatrixSpace(GF(2), 500,1000).random_element())
sage: B = M.basis()
sage: %time FC = [M.fundamental_cocircuit(B,e) for e in B]
CPU times: user 27.5 ms, sys: 3.13 ms, total: 30.7 ms
Wall time: 30.4 ms
sage: %time S = SetSystem(list(M.groundset()), FC)
CPU times: user 5.06 ms, sys: 106 µs, total: 5.17 ms
Wall time: 5.18 ms
sage: timeit("S.is_connected()")
625 loops, best of 3: 12.8 µs per loop
```

----
New commits:


---

Comment by ncohen created at 2015-06-11 20:47:04

`Hypergraph.is_connected()` `:-/`

Guys, we are doing this work twice `:-/`

Nathann


---

Comment by Rudi created at 2015-06-11 21:45:38

Replying to [comment:3 ncohen]:
> `Hypergraph.is_connected()` `:-/`
> 
> Guys, we are doing this work twice `:-/`

I'm helping to speed up the code in this ticket #18539, for that we just need a fast connectivity checker. I tried Sage's Hypergraph first, but look at this (same example as above):

```
sage: %time S = Hypergraph(points = list(M.groundset()), blocks =FC)
CPU times: user 1.17 s, sys: 20.9 ms, total: 1.19 s
Wall time: 1.18 s
sage: %time S.is_connected()
CPU times: user 50.7 s, sys: 593 ms, total: 51.3 s
Wall time: 50.7 s
True
```

Compared to SetSystem, the Hypergraph I want takes 200 times longer to construct, and finding out if it is connected takes about 4 million times longer. 

So what would you do in this case?


---

Comment by ncohen created at 2015-06-11 21:47:27

> Compared to SetSystem, the Hypergraph I want takes 200 times longer to construct, and finding out if it is connected takes about 4 million times longer. 
> 
> So what would you do in this case?

You got me wrong: I did not claim that Hypergraph's version was faster (just look at the code, you will see why it is slow), but I hope that I do not need to convince you that having two class with the same purpose (Hypergraph and SetSystem) and developping them in parallel is a very very bad idea.

Nathann


---

Comment by Rudi created at 2015-06-11 22:15:30

Replying to [comment:5 ncohen]:
> You got me wrong: I did not claim that Hypergraph's version was faster (just look at the code, you will see why it is slow), but I hope that I do not need to convince you that having two class with the same purpose (Hypergraph and SetSystem) and developping them in parallel is a very very bad idea.

I agree, but what would you suggest? I do not want to open up SetSystem for public use and on the other hand, to get what I want from Hypergraph I would need to make changes to it's internal datastructure, using bitsets from the ground up. This would affect nearly every line of code in 'incidence_structures.py'. Apart from it being a bit of work, I hesitate to make such radical changes to other people's work. What there is probably works well for the application it was written for.

So who are working that part of sage right now? They might want to consider re-implementing this stuff using bitsets themselves. Bitsets simply work for this kind of thing.


---

Comment by ncohen created at 2015-06-11 22:35:32

> I agree, but what would you suggest? I do not want to open up SetSystem for public use and on the other hand, to get what I want from Hypergraph I would need to make changes to it's internal datastructure, using bitsets from the ground up. This would affect nearly every line of code in 'incidence_structures.py'. Apart from it being a bit of work, I hesitate to make such radical changes to other people's work. What there is probably works well for the application it was written for.

HMmmm... Makes sense, but still.. Maybe we could have at least some generic class for the high-level functions `:-/`

> So who are working that part of sage right now? They might want to consider re-implementing this stuff using bitsets themselves. Bitsets simply work for this kind of thing.

Not if you store 3-uniform hypergraphs on a large ground set. You would waste a lot of memory. It's like for graphs, you would need different data structures for different purposes `:-/`

Nathann


---

Comment by Rudi created at 2015-06-12 05:52:17

Replying to [comment:7 ncohen]:

== ==

> > So who are working that part of sage right now? They might want to consider re-implementing this stuff using bitsets themselves. Bitsets simply work for this kind of thing.
> 
> Not if you store 3-uniform hypergraphs on a large ground set. You would waste a lot of memory. It's like for graphs, you would need different data structures for different purposes `:-/`

Hmm, that's true. You need a sparse data structure too. So how about just replacing that incidence-matrix in there with one over GF(2)? There's dense and sparse versions of such matrices. I think I also saw a data_structures/bitset_matrix.pxi , perhaps use that for the dense version.


---

Comment by ncohen created at 2015-06-12 07:38:29

> Hmm, that's true. You need a sparse data structure too. So how about just replacing that incidence-matrix in there with one over GF(2)? There's dense and sparse versions of such matrices. I think I also saw a data_structures/bitset_matrix.pxi , perhaps use that for the dense version.

If you think that by doing that we can unify the two classes then why not?


---

Comment by Rudi created at 2015-06-12 17:16:45

Replying to [comment:9 ncohen]:
> If you think that by doing that we can unify the two classes then why not?
Replacing the incidence matrix would be a good start for speeding up the existing Hypergraph, but it will take a very long time before I can replace Setsystem. Not because the code would remain inefficient (it won't) but because I need something in the matroid code that on a very low level agrees with that code. (My SetSystems are really just a thinly veiled arrays of bitsets, which I use to avoid unnecessary translation between bitsets and python sets in the matroid code.)

The alternative is that I at some point write a new class Hypergraph from the ground up, and then we work afterwards to make that class mimick the interface of the current class Hypergraph. Would that work for you?


---

Comment by ncohen created at 2015-06-12 18:42:13

> The alternative is that I at some point write a new class Hypergraph from the ground up, and then we work afterwards to make that class mimick the interface of the current class Hypergraph. Would that work for you?  

Hmmm.. Do you think we could settle that with having some high-level Hypergraph classes, and some low-level hypergraph classes? That's how it works for graphs at the moment:


```
sage: graphs.PetersenGraph()._backend
<type 'sage.graphs.base.sparse_graph.SparseGraphBackend'>
```


This way we would have data-structure-specific code in data-structure-specific files, and high-level code in high-level files?

Nathann


---

Comment by Rudi created at 2015-06-12 19:22:28

Replying to [comment:11 ncohen]:

> Hmmm.. Do you think we could settle that with having some high-level Hypergraph classes, and some low-level hypergraph classes? 
Sounds right. So how about I come up with a barebones HypergraphDense (or whatever name you like) at some point, and then we talk about how to integrate this in a parent class Hypergraph?


---

Comment by ncohen created at 2015-06-12 21:16:55

Yo !

> Sounds right. So how about I come up with a barebones HypergraphDense (or whatever name you like) at some point, and then we talk about how to integrate this in a parent class Hypergraph?

Hmmmm... Assuming that you did not mean "parent" like in "`Parent/Element`", then yes `:-P`
But let's discuss the design a bit, first.

I am looking at `matroid/set_system` at the moment, and it seems that most of what you have inside are private methods. It really does not look like it should be used from the outside indeed `O_o`

Is there any reason why `SetSystemIterator` is a class? Could that be because it was written before 'yield' became a Cython keyword?

Nathann


---

Comment by ncohen created at 2015-06-12 21:34:13

Hello again,

I agree with this ticket, and added a small commit at `public/18682`. It is only style and doc:
- The first line of the docstring must be a short sentence
- A link toward `SetSystem` instead of plain text
- Comments in the code

It was a bit hard to read at first, for many variables hide their meaning:
- `_len` is the number of subsets (it could have been the number of points)
- `_temp` is a shipped bitset of size "number of points"

Anyway. If that's okay with you, then you can set this ticket to `positive_review`.

Nathann


---

Comment by Rudi created at 2015-06-13 08:06:07

Replying to [comment:14 ncohen]:
> Hello again,
> 
> I agree with this ticket, and added a small commit at `public/18682`. It is only style and doc:
> - The first line of the docstring must be a short sentence
> - A link toward `SetSystem` instead of plain text
> - Comments in the code
> 

Agreed.

> It was a bit hard to read at first, for many variables hide their meaning:
> - `_len` is the number of subsets (it could have been the number of points)
> - `_temp` is a shipped bitset of size "number of points"
> 
The style is pretty terrible, I'll grant you that. I was learning python/cython while I was writing the whole thing, so there are several things I would do differently if I had to start over. 

This in perhaps one of the reasons why making a entirely fresh start for Hypergraph (as opposed to re-using SetSystem) is a good idea. This SetSystem class essentially popped out of work on matroids and became much more of a separate entity than I had intended when I started writing the whole matroid code. So now it looks independent, but really isn't, with all kinds of backdoors for the matroid code I have to preserve.

On the positive side, I always did a lot of experimenting to see what actually gave the best efficiency. That experience should be reusable (even if it does create some uglyness in the code at times).

> Anyway. If that's okay with you, then you can set this ticket to `positive_review`.
>
I will, thanks. My first review before I even asked for one! :)


---

Comment by Rudi created at 2015-06-13 08:06:07

Changing status from new to needs_review.


---

Comment by Rudi created at 2015-06-13 08:06:52

First let's see how the patchbot likes it..


---

Comment by ncohen created at 2015-06-13 10:07:32

It likes it.


---

Comment by Rudi created at 2015-06-13 15:33:02

Changing status from needs_review to positive_review.


---

Comment by Rudi created at 2015-06-13 15:33:02

Great!


---

Comment by ncohen created at 2015-06-13 16:18:21

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2015-06-13 16:18:21

Could you add my commit to your branch?


---

Comment by Rudi created at 2015-06-13 17:53:17

Replying to [comment:19 ncohen]:
> Could you add my commit to your branch?
Sorry, I thought you had already committed these changes to this branch. 

I'm afraid I'm too much of a git novice to know how to pull/merge your commit in public/18682. What git command do I give?


---

Comment by ncohen created at 2015-06-13 23:17:54

Helloooooooooo,

> I'm afraid I'm too much of a git novice to know how to pull/merge your commit in public/18682. What git command do I give?

The most trivial method to do it is simply to change the branch's name to public/18682, though that's how you would learn the least.

You have several other ways to do it. The first would be, as you say, to merge my branch with yours. This would mean:

```
git pull trac public/18682
```


In theory, that should create a merge commit atop your branch and atop mine, containing the changes of both. In practice, as my branch is merely yours with an additional commit, that would just move your branch's tip where mine is.

You can then push your branch, as usual, at its current location.

Nathann


---

Comment by git created at 2015-06-14 12:44:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-14 12:46:43

Changing status from needs_work to positive_review.


---

Comment by ncohen created at 2015-06-14 13:07:14

Perfect!


---

Comment by Rudi created at 2015-06-14 13:15:18

Replying to [comment:24 ncohen]:
> Perfect!

I had a good teacher :)

So if I want to politely propose a change in the work someone else did on a ticket, then this the way to go, push my modified branch somewhere else as in `git trac push public/some_name`? Excellent, I was wondering about that before.


---

Comment by ncohen created at 2015-06-14 13:21:42

Helloooooooo,

> So if I want to politely propose a change in the work someone else did on a ticket, then this the way to go, push my modified branch somewhere else as in `git trac push public/some_name`? Excellent, I was wondering about that before. 

That's how I work, and I believe that it is indeed the "most polite way" to proceed. I always find it a bit unpleasant when I see that the branch's name has been changed by somebody else who pushed commits I don't like on a ticket I'm working on, sometimes without even explaining what they do.

By pushing that stuff to another branch, you propose them to the author and if he likes them he can merge them to his ticket. If he does not like them, you can either forget about them or propose them on another ticket of your own.

Nathann


---

Comment by vbraun created at 2015-06-14 21:43:33

Resolution: fixed
