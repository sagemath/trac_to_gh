# Issue 31488: Implement meet, join, etc. methods for posets

Issue created by migration from https://trac.sagemath.org/ticket/31725

Original creator: yzh

Original creation time: 2021-04-24 23:45:21

CC:  mkoeppe chapoton tscrim slelievre

Keywords: poset, hasse_diagram

Similar methods `_meet`, `_join` exist in `Poset._hasse_diagram` but not yet in `Poset` itself. To make them methods of `Poset`, one needs apply the `_element_to_vertex` and `_vertex_to_element` conversions.

In addition, `Poset` has the method `common_upper_covers`. We propose to implement the method `common_lower_covers` as well, for symmetry and completeness.


---

Comment by tscrim created at 2021-04-25 03:47:52

I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.

+1 for adding a `common_lower_covers` method.
----
New commits:


---

Comment by yzh created at 2021-04-25 04:29:57

Replying to [comment:4 tscrim]:
> I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.
> 
> +1 for adding a `common_lower_covers` method.

In fact, I meant `FinitePoset.meet(x, y)` for two given elements x and y in the poset, even for poset such that `poset.has_bottom()` is `False`. Now reading the code more carefully, I realize that this is not exactly the same as `poset._hasse_diagram._meet`, which gives the `meet_matrix` in the case of a meet-semilattice and raises an error otherwise.


---

Comment by yzh created at 2021-04-25 04:45:00

I'm also wondering if ``@`lazy_attribute HasseDiagram._meet` (and also `_join`) raises Error and refuses to compute the matrix too often. I think it would be better to set the xy-entry of the meet matrix to `None` when the meet of x, y doesn't exists, and then push the checks for the `ValueError("not a meet-semilattice...")` and `LatticeError('meet')` to where it needs.


---

Comment by git created at 2021-04-25 09:12:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-04-25 10:57:44

Question: Why is the following not allowed?

```
sage: E = LatticePoset({})
sage: Poset({0: [1]}).is_lattice()
True
sage: P = MeetSemilattice({0: [1]})
sage: E.is_sublattice(P)
Traceback (most recent call last):
...
TypeError: other is not a lattice
```



---

Comment by git created at 2021-04-25 11:25:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-04-25 11:25:57

Changing status from new to needs_review.


---

Comment by git created at 2021-04-25 11:59:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-04-26 00:33:49

The semilattice check can be quite slow with your proposal as it is done every time the `meet_matrix()` is called. I think you should define a new attribute `_semilattice_failure = None` on initialization. Then when `_meet` is called, it sets this attribute to an invalid pair (and perhaps `()` if successful). Then the check in `meet_matrix()` becomes:

```python
if (n != 0) and (not self.has_bottom()):
    raise ValueError("not a meet-semilattice: no bottom element")
# call the attribute to build the matrix and sets _semilattice_failure
mt = self._meet
if self._semilattice_failure:
    x, y = self._is_meet_semilattice
    raise LatticeError('meet', x, y)
```



---

Comment by git created at 2021-04-26 03:43:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by yzh created at 2021-04-26 03:45:29

Thanks, Travis! I made the change according to your suggestion.


---

Comment by tscrim created at 2021-04-28 02:33:05

I like your solution. Thank you. LGTM.


---

Comment by tscrim created at 2021-04-28 02:33:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-06-19 20:58:03

Resolution: fixed
