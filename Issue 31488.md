# Issue 31488: Implement meet, join, etc. methods for posets

archive/issues_031488.json:
```json
{
    "body": "CC:  @mkoeppe @fchapoton @tscrim @slel\n\nKeywords: poset, hasse_diagram\n\nSimilar methods `_meet`, `_join` exist in `Poset._hasse_diagram` but not yet in `Poset` itself. To make them methods of `Poset`, one needs apply the `_element_to_vertex` and `_vertex_to_element` conversions.\n\nIn addition, `Poset` has the method `common_upper_covers`. We propose to implement the method `common_lower_covers` as well, for symmetry and completeness.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31725\n\n",
    "created_at": "2021-04-24T23:45:21Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Implement meet, join, etc. methods for posets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31488",
    "user": "https://github.com/yuan-zhou"
}
```
CC:  @mkoeppe @fchapoton @tscrim @slel

Keywords: poset, hasse_diagram

Similar methods `_meet`, `_join` exist in `Poset._hasse_diagram` but not yet in `Poset` itself. To make them methods of `Poset`, one needs apply the `_element_to_vertex` and `_vertex_to_element` conversions.

In addition, `Poset` has the method `common_upper_covers`. We propose to implement the method `common_lower_covers` as well, for symmetry and completeness.

Issue created by migration from https://trac.sagemath.org/ticket/31725





---

archive/issue_comments_449807.json:
```json
{
    "body": "I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.\n\n+1 for adding a `common_lower_covers` method.\n----\nNew commits:",
    "created_at": "2021-04-25T03:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449807",
    "user": "https://github.com/tscrim"
}
```

I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.

+1 for adding a `common_lower_covers` method.
----
New commits:



---

archive/issue_comments_449808.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.\n> \n> +1 for adding a `common_lower_covers` method.\n\nIn fact, I meant `FinitePoset.meet(x, y)` for two given elements x and y in the poset, even for poset such that `poset.has_bottom()` is `False`. Now reading the code more carefully, I realize that this is not exactly the same as `poset._hasse_diagram._meet`, which gives the `meet_matrix` in the case of a meet-semilattice and raises an error otherwise.",
    "created_at": "2021-04-25T04:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449808",
    "user": "https://github.com/yuan-zhou"
}
```

Replying to [comment:4 tscrim]:
> I don't understand why we need a `_meet` and `_join` method in `FinitePoset`. Those are implementation details in the backend.
> 
> +1 for adding a `common_lower_covers` method.

In fact, I meant `FinitePoset.meet(x, y)` for two given elements x and y in the poset, even for poset such that `poset.has_bottom()` is `False`. Now reading the code more carefully, I realize that this is not exactly the same as `poset._hasse_diagram._meet`, which gives the `meet_matrix` in the case of a meet-semilattice and raises an error otherwise.



---

archive/issue_comments_449809.json:
```json
{
    "body": "I'm also wondering if ``@`lazy_attribute HasseDiagram._meet` (and also `_join`) raises Error and refuses to compute the matrix too often. I think it would be better to set the xy-entry of the meet matrix to `None` when the meet of x, y doesn't exists, and then push the checks for the `ValueError(\"not a meet-semilattice...\")` and `LatticeError('meet')` to where it needs.",
    "created_at": "2021-04-25T04:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449809",
    "user": "https://github.com/yuan-zhou"
}
```

I'm also wondering if ``@`lazy_attribute HasseDiagram._meet` (and also `_join`) raises Error and refuses to compute the matrix too often. I think it would be better to set the xy-entry of the meet matrix to `None` when the meet of x, y doesn't exists, and then push the checks for the `ValueError("not a meet-semilattice...")` and `LatticeError('meet')` to where it needs.



---

archive/issue_comments_449810.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-25T09:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449811.json:
```json
{
    "body": "Question: Why is the following not allowed?\n\n```\nsage: E = LatticePoset({})\nsage: Poset({0: [1]}).is_lattice()\nTrue\nsage: P = MeetSemilattice({0: [1]})\nsage: E.is_sublattice(P)\nTraceback (most recent call last):\n...\nTypeError: other is not a lattice\n```\n",
    "created_at": "2021-04-25T10:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449811",
    "user": "https://github.com/yuan-zhou"
}
```

Question: Why is the following not allowed?

```
sage: E = LatticePoset({})
sage: Poset({0: [1]}).is_lattice()
True
sage: P = MeetSemilattice({0: [1]})
sage: E.is_sublattice(P)
Traceback (most recent call last):
...
TypeError: other is not a lattice
```




---

archive/issue_comments_449812.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-25T11:25:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449813.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-04-25T11:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449813",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_449814.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-25T11:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449815.json:
```json
{
    "body": "The semilattice check can be quite slow with your proposal as it is done every time the `meet_matrix()` is called. I think you should define a new attribute `_semilattice_failure = None` on initialization. Then when `_meet` is called, it sets this attribute to an invalid pair (and perhaps `()` if successful). Then the check in `meet_matrix()` becomes:\n\n```python\nif (n != 0) and (not self.has_bottom()):\n    raise ValueError(\"not a meet-semilattice: no bottom element\")\n# call the attribute to build the matrix and sets _semilattice_failure\nmt = self._meet\nif self._semilattice_failure:\n    x, y = self._is_meet_semilattice\n    raise LatticeError('meet', x, y)\n```\n",
    "created_at": "2021-04-26T00:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449815",
    "user": "https://github.com/tscrim"
}
```

The semilattice check can be quite slow with your proposal as it is done every time the `meet_matrix()` is called. I think you should define a new attribute `_semilattice_failure = None` on initialization. Then when `_meet` is called, it sets this attribute to an invalid pair (and perhaps `()` if successful). Then the check in `meet_matrix()` becomes:

```python
if (n != 0) and (not self.has_bottom()):
    raise ValueError("not a meet-semilattice: no bottom element")
# call the attribute to build the matrix and sets _semilattice_failure
mt = self._meet
if self._semilattice_failure:
    x, y = self._is_meet_semilattice
    raise LatticeError('meet', x, y)
```




---

archive/issue_comments_449816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-26T03:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_449817.json:
```json
{
    "body": "Thanks, Travis! I made the change according to your suggestion.",
    "created_at": "2021-04-26T03:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449817",
    "user": "https://github.com/yuan-zhou"
}
```

Thanks, Travis! I made the change according to your suggestion.



---

archive/issue_comments_449818.json:
```json
{
    "body": "I like your solution. Thank you. LGTM.",
    "created_at": "2021-04-28T02:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449818",
    "user": "https://github.com/tscrim"
}
```

I like your solution. Thank you. LGTM.



---

archive/issue_comments_449819.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-28T02:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449819",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_028755.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-06-19T20:58:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31488#event-28755"
}
```



---

archive/issue_comments_449820.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-19T20:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31488",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31488#issuecomment-449820",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
