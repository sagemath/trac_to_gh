# Issue 29631: Make sage docbuild a script package

Issue created by migration from https://trac.sagemath.org/ticket/29868

Original creator: mkoeppe

Original creation time: 2020-06-15 15:57:37

CC:  isuruf fbissey arojas @timokau nbruin dimpase jhpalmieri @mwageringel @zlscherr

Similar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.


---

Comment by mkoeppe created at 2020-12-06 17:42:54

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-04-14 04:32:48

Input and help from docbuild experts is very welcome.


---

Comment by mkoeppe created at 2021-04-15 00:49:20

Some questions: 

- Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?

- Is there a way to only generate the doctrees but not build HTML or PDF?

- Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?


---

Comment by fbissey created at 2021-04-15 01:33:59

Replying to [comment:16 mkoeppe]:
> Some questions: 
> 
> - Is there a way to only generate the doctrees but not build HTML or PDF?

I do believe there is a sphinx option for doing just that.

> 
> - Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?

As far as I know they need to be able to run the sage library. In particular all graphs/plots are generated during the documentation build.


---

Comment by fbissey created at 2021-04-15 04:34:20

Replying to [comment:17 fbissey]:
> Replying to [comment:16 mkoeppe]:
> > Some questions: 
> > 
> > - Is there a way to only generate the doctrees but not build HTML or PDF?
> 
> I do believe there is a sphinx option for doing just that.
> 

I cannot find such an option anymore. If it existed. There is an option to say where the doctrees should be stored and found, but nothing on producing it in isolation.


---

Comment by jhpalmieri created at 2021-04-15 05:14:54

Well, `./sage --docbuild all inventory` builds the inventory files and the doctree files, but not html or pdf.


---

Comment by jhpalmieri created at 2021-04-15 05:20:14

Replying to [comment:16 mkoeppe]:
> Some questions: 
> 
> - Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?

The `autodoc` procedure does this, with `sage/monoids/free_monoid.py` as input. (Edit: or maybe just `src/doc/en/reference/monoids/index.rst` as input?) I'm not sure precisely how this is done, but the file `sage_docbuild/ext/sage_autodoc.py` is certainly relevant. (This is Sage's fork of the Sphinx autodoc module.)


---

Comment by jhpalmieri created at 2021-04-15 05:24:10

No, I'm wrong about that. It's done in `sage_docbuild/__init__.py`, in the `write_auto_rest_file` method.


---

Comment by mkoeppe created at 2022-01-12 02:54:47

According to #33064#comment:19, there is no need to install doctrees in `SAGE_LOCAL`, not even for introspection (`sage.misc.sphinxify`)
