# Issue 29631: Make sage docbuild a script package

archive/issues_029631.json:
```json
{
    "body": "CC:  @isuruf @kiwifb @antonio-rojas @timokau @nbruin @dimpase @jhpalmieri @mwageringel @zlscherr\n\nSimilar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29868\n\n",
    "created_at": "2020-06-15T15:57:37Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Make sage docbuild a script package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29631",
    "user": "@mkoeppe"
}
```
CC:  @isuruf @kiwifb @antonio-rojas @timokau @nbruin @dimpase @jhpalmieri @mwageringel @zlscherr

Similar to #29411, which makes sagelib a script package, we make the sage docbuild a script package.

Issue created by migration from https://trac.sagemath.org/ticket/29868





---

archive/issue_comments_420906.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420906",
    "user": "@mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_420907.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420907",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_420908.json:
```json
{
    "body": "Input and help from docbuild experts is very welcome.",
    "created_at": "2021-04-14T04:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420908",
    "user": "@mkoeppe"
}
```

Input and help from docbuild experts is very welcome.



---

archive/issue_comments_420909.json:
```json
{
    "body": "Some questions: \n\n- Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?\n\n- Is there a way to only generate the doctrees but not build HTML or PDF?\n\n- Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?",
    "created_at": "2021-04-15T00:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420909",
    "user": "@mkoeppe"
}
```

Some questions: 

- Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?

- Is there a way to only generate the doctrees but not build HTML or PDF?

- Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?



---

archive/issue_comments_420910.json:
```json
{
    "body": "Replying to [comment:16 mkoeppe]:\n> Some questions: \n> \n> - Is there a way to only generate the doctrees but not build HTML or PDF?\n\nI do believe there is a sphinx option for doing just that.\n\n> \n> - Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?\n\nAs far as I know they need to be able to run the sage library. In particular all graphs/plots are generated during the documentation build.",
    "created_at": "2021-04-15T01:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420910",
    "user": "@kiwifb"
}
```

Replying to [comment:16 mkoeppe]:
> Some questions: 
> 
> - Is there a way to only generate the doctrees but not build HTML or PDF?

I do believe there is a sphinx option for doing just that.

> 
> - Do the HTML and PDF builds need to be able to run the Sage library, or can they build these formats if given only the doctrees?

As far as I know they need to be able to run the sage library. In particular all graphs/plots are generated during the documentation build.



---

archive/issue_comments_420911.json:
```json
{
    "body": "Replying to [comment:17 fbissey]:\n> Replying to [comment:16 mkoeppe]:\n> > Some questions: \n> > \n> > - Is there a way to only generate the doctrees but not build HTML or PDF?\n> \n> I do believe there is a sphinx option for doing just that.\n> \n\nI cannot find such an option anymore. If it existed. There is an option to say where the doctrees should be stored and found, but nothing on producing it in isolation.",
    "created_at": "2021-04-15T04:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420911",
    "user": "@kiwifb"
}
```

Replying to [comment:17 fbissey]:
> Replying to [comment:16 mkoeppe]:
> > Some questions: 
> > 
> > - Is there a way to only generate the doctrees but not build HTML or PDF?
> 
> I do believe there is a sphinx option for doing just that.
> 

I cannot find such an option anymore. If it existed. There is an option to say where the doctrees should be stored and found, but nothing on producing it in isolation.



---

archive/issue_comments_420912.json:
```json
{
    "body": "Well, `./sage --docbuild all inventory` builds the inventory files and the doctree files, but not html or pdf.",
    "created_at": "2021-04-15T05:14:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420912",
    "user": "@jhpalmieri"
}
```

Well, `./sage --docbuild all inventory` builds the inventory files and the doctree files, but not html or pdf.



---

archive/issue_comments_420913.json:
```json
{
    "body": "Replying to [comment:16 mkoeppe]:\n> Some questions: \n> \n> - Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?\n\nThe `autodoc` procedure does this, with `sage/monoids/free_monoid.py` as input. (Edit: or maybe just `src/doc/en/reference/monoids/index.rst` as input?) I'm not sure precisely how this is done, but the file `sage_docbuild/ext/sage_autodoc.py` is certainly relevant. (This is Sage's fork of the Sphinx autodoc module.)",
    "created_at": "2021-04-15T05:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420913",
    "user": "@jhpalmieri"
}
```

Replying to [comment:16 mkoeppe]:
> Some questions: 
> 
> - Who generates files such as `src/doc/en/reference/monoids/sage/monoids/free_monoid.rst`, and should they be part of what `sagemath-doc-src` installs (and thus ships with the wheel)?

The `autodoc` procedure does this, with `sage/monoids/free_monoid.py` as input. (Edit: or maybe just `src/doc/en/reference/monoids/index.rst` as input?) I'm not sure precisely how this is done, but the file `sage_docbuild/ext/sage_autodoc.py` is certainly relevant. (This is Sage's fork of the Sphinx autodoc module.)



---

archive/issue_comments_420914.json:
```json
{
    "body": "No, I'm wrong about that. It's done in `sage_docbuild/__init__.py`, in the `write_auto_rest_file` method.",
    "created_at": "2021-04-15T05:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420914",
    "user": "@jhpalmieri"
}
```

No, I'm wrong about that. It's done in `sage_docbuild/__init__.py`, in the `write_auto_rest_file` method.



---

archive/issue_comments_420915.json:
```json
{
    "body": "According to #33064#comment:19, there is no need to install doctrees in `SAGE_LOCAL`, not even for introspection (`sage.misc.sphinxify`)",
    "created_at": "2022-01-12T02:54:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29631",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29631#issuecomment-420915",
    "user": "@mkoeppe"
}
```

According to #33064#comment:19, there is no need to install doctrees in `SAGE_LOCAL`, not even for introspection (`sage.misc.sphinxify`)
