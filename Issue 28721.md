# Issue 28721: spkg-configure.m4 for nauty

archive/issues_028721.json:
```json
{
    "body": "CC:  @embray @dimpase\n\nThe nauty package has no dependencies within sage, and we only communicate with it via popen() for now, so this should be relatively easy to pick up from the system. As far as I can tell, the following three files are the only places where a nauty executable is called:\n\n1. src/sage/graphs/digraph_generators.py (directg, gentourng)\n2. src/sage/graphs/graph_generators.py (geng)\n3. src/sage/graphs/hypergraph_generators.py (genbg)\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28958\n\n",
    "closed_at": "2020-01-20T21:18:28Z",
    "created_at": "2020-01-06T14:45:10Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "spkg-configure.m4 for nauty",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28721",
    "user": "https://github.com/orlitzky"
}
```
CC:  @embray @dimpase

The nauty package has no dependencies within sage, and we only communicate with it via popen() for now, so this should be relatively easy to pick up from the system. As far as I can tell, the following three files are the only places where a nauty executable is called:

1. src/sage/graphs/digraph_generators.py (directg, gentourng)
2. src/sage/graphs/graph_generators.py (geng)
3. src/sage/graphs/hypergraph_generators.py (genbg)


Issue created by migration from https://trac.sagemath.org/ticket/28958





---

archive/issue_comments_405171.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-06T14:55:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405171",
    "user": "https://github.com/orlitzky"
}
```

New commits:



---

archive/issue_comments_405172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-06T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405172",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_405173.json:
```json
{
    "body": "I've left out the header/library check because the library situation in ticket 27952 is still a mess, and nothing else uses the library right now. If this gets merged we can leave a note on that ticket that spkg-configure.m4 for nauty needs to be updated along with normaliz.",
    "created_at": "2020-01-06T14:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405173",
    "user": "https://github.com/orlitzky"
}
```

I've left out the header/library check because the library situation in ticket 27952 is still a mess, and nothing else uses the library right now. If this gets merged we can leave a note on that ticket that spkg-configure.m4 for nauty needs to be updated along with normaliz.



---

archive/issue_comments_405174.json:
```json
{
    "body": "This needs a version check, otherwise the configure script might find an old nauty version.\nRecent versions of nauty has a `-version` argument which we can use for checking the nauty version.",
    "created_at": "2020-01-06T15:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405174",
    "user": "https://github.com/isuruf"
}
```

This needs a version check, otherwise the configure script might find an old nauty version.
Recent versions of nauty has a `-version` argument which we can use for checking the nauty version.



---

archive/issue_comments_405175.json:
```json
{
    "body": "If anything, we should be doing feature tests and not version tests. Do we use any features of nauty that aren't present in a version that still exists somewhere? Debian only goes back to v2.5, but I suppose sage could be using a feature that was introduced between 2.5 and 2.6.",
    "created_at": "2020-01-06T16:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405175",
    "user": "https://github.com/orlitzky"
}
```

If anything, we should be doing feature tests and not version tests. Do we use any features of nauty that aren't present in a version that still exists somewhere? Debian only goes back to v2.5, but I suppose sage could be using a feature that was introduced between 2.5 and 2.6.



---

archive/issue_comments_405176.json:
```json
{
    "body": "The last time we upgraded Nauty was four years ago in #19919. That ticket didn't modify any of these source files, so the API we use hasn't changed in a meaningful way for even longer than that.",
    "created_at": "2020-01-06T18:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405176",
    "user": "https://github.com/orlitzky"
}
```

The last time we upgraded Nauty was four years ago in #19919. That ticket didn't modify any of these source files, so the API we use hasn't changed in a meaningful way for even longer than that.



---

archive/issue_comments_405177.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-07T03:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405177",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405178.json:
```json
{
    "body": "This seems to be too distro-specific.\nNote that e.g. on Debian and Ubuntu the executabes in question get prefix `nauty-`, cf.\nhttps://packages.debian.org/buster/amd64/nauty/filelist\n\nOne can e.g. test for these, and install prefix-less links into `$SAGE_LOCAL/bin`.",
    "created_at": "2020-01-07T11:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405178",
    "user": "https://github.com/dimpase"
}
```

This seems to be too distro-specific.
Note that e.g. on Debian and Ubuntu the executabes in question get prefix `nauty-`, cf.
https://packages.debian.org/buster/amd64/nauty/filelist

One can e.g. test for these, and install prefix-less links into `$SAGE_LOCAL/bin`.



---

archive/issue_comments_405179.json:
```json
{
    "body": "by the way, how about writing a loop? :-)\n\n```m4\nSAGE_SPKG_CONFIGURE([nauty], [\n  m4_foreach([nautyprog], [directg, gentourng, geng, genbg], [\n    AC_PATH_PROG(nautyprog[_CHECK],[nautyprog])\n    AS_IF([test x\"[]$nautyprog[_CHECK]\" = x],[sage_spkg_install_nauty=yes])\n  ])\n])\n```",
    "created_at": "2020-01-07T13:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405179",
    "user": "https://github.com/dimpase"
}
```

by the way, how about writing a loop? :-)

```m4
SAGE_SPKG_CONFIGURE([nauty], [
  m4_foreach([nautyprog], [directg, gentourng, geng, genbg], [
    AC_PATH_PROG(nautyprog[_CHECK],[nautyprog])
    AS_IF([test x"[]$nautyprog[_CHECK]" = x],[sage_spkg_install_nauty=yes])
  ])
])
```



---

archive/issue_comments_405180.json:
```json
{
    "body": "Replying to [comment:8 dimpase]:\n> by the way, how about writing a loop? :-)\n> \n>     AS_IF([test x\"[]$nautyprog[_CHECK]\" = x],[sage_spkg_install_nauty=yes])\n> \n\n\nThe loop is a little more succinct, but I have no idea what that line actually does =)\n\nWhy the empty brackets before the variable name? I tried to get away with something similar, but without different variables for geng_CHECK, directg_CHECK, etc. it doesn't work. The configure script incorrectly caches the check result based on the variable name:\n\n```\nconfigure: === checking whether to install the nauty SPKG ===\nchecking for directg... yes\nchecking for gentourng... (cached) yes\nchecking for geng... (cached) yes\nchecking for genbg... (cached) yes\n```\n\nSince the checks are presently very simple, I don't think it's worth increasing the magic level tenfold to eliminate a few easy-to-read lines. But maybe that equation changes when the test becomes more complicated. See my next comment...",
    "created_at": "2020-01-07T15:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405180",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:8 dimpase]:
> by the way, how about writing a loop? :-)
> 
>     AS_IF([test x"[]$nautyprog[_CHECK]" = x],[sage_spkg_install_nauty=yes])
> 


The loop is a little more succinct, but I have no idea what that line actually does =)

Why the empty brackets before the variable name? I tried to get away with something similar, but without different variables for geng_CHECK, directg_CHECK, etc. it doesn't work. The configure script incorrectly caches the check result based on the variable name:

```
configure: === checking whether to install the nauty SPKG ===
checking for directg... yes
checking for gentourng... (cached) yes
checking for geng... (cached) yes
checking for genbg... (cached) yes
```

Since the checks are presently very simple, I don't think it's worth increasing the magic level tenfold to eliminate a few easy-to-read lines. But maybe that equation changes when the test becomes more complicated. See my next comment...



---

archive/issue_comments_405181.json:
```json
{
    "body": "I thought I put `[]` after `$`.\nAt least this is what is said in https://www.gnu.org/software/autoconf/manual/autoconf-2.69/html_node/Quoting-and-Parameters.html#Quoting-and-Parameters",
    "created_at": "2020-01-07T15:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405181",
    "user": "https://github.com/dimpase"
}
```

I thought I put `[]` after `$`.
At least this is what is said in https://www.gnu.org/software/autoconf/manual/autoconf-2.69/html_node/Quoting-and-Parameters.html#Quoting-and-Parameters



---

archive/issue_comments_405182.json:
```json
{
    "body": "Replying to [comment:7 dimpase]:\n> This seems to be too distro-specific.\n> Note that e.g. on Debian and Ubuntu the executabes in question get prefix `nauty-`, cf.\n> https://packages.debian.org/buster/amd64/nauty/filelist\n> \n> One can e.g. test for these, and install prefix-less links into `$SAGE_LOCAL/bin`.\n>  \n\n\nThe usual way to handle this is to test for both names, e.g. \"directg\" and \"nauty-directg\", and then to put the resulting path into a variable like NAUTY_DIRECTG. You then tell autoconf to substitute that value into a file,\n\n```\nAC_OUTPUT([ ... src/sage/graphs/digraph_generators.py ])\n```\n\nrename that file to src/sage/graphs/digraph_generators.py.in, and finally replace the hard-coded executable name with the variable:\n\n```\nsub = subprocess.Popen('@NAUTY_DIRECTG@ {0}'.format(options),\n```\n\nIt would be a little ugly to separate those file names (e.g. src/sage/graphs/digraph_generators.py) from the rest of spkg-configure.m4, since they need to go in the top-level configure.ac, but I don't foresee any other technical problems if this sounds acceptable.",
    "created_at": "2020-01-07T15:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405182",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:7 dimpase]:
> This seems to be too distro-specific.
> Note that e.g. on Debian and Ubuntu the executabes in question get prefix `nauty-`, cf.
> https://packages.debian.org/buster/amd64/nauty/filelist
> 
> One can e.g. test for these, and install prefix-less links into `$SAGE_LOCAL/bin`.
>  


The usual way to handle this is to test for both names, e.g. "directg" and "nauty-directg", and then to put the resulting path into a variable like NAUTY_DIRECTG. You then tell autoconf to substitute that value into a file,

```
AC_OUTPUT([ ... src/sage/graphs/digraph_generators.py ])
```

rename that file to src/sage/graphs/digraph_generators.py.in, and finally replace the hard-coded executable name with the variable:

```
sub = subprocess.Popen('@NAUTY_DIRECTG@ {0}'.format(options),
```

It would be a little ugly to separate those file names (e.g. src/sage/graphs/digraph_generators.py) from the rest of spkg-configure.m4, since they need to go in the top-level configure.ac, but I don't foresee any other technical problems if this sounds acceptable.



---

archive/issue_comments_405183.json:
```json
{
    "body": "Replying to [comment:8 dimpase]:\n> by the way, how about writing a loop? :-)\n> \n> ```m4\n> SAGE_SPKG_CONFIGURE([nauty], [\n>   m4_foreach([nautyprog], [directg, gentourng, geng, genbg], [\n>     AC_PATH_PROG(nautyprog[_CHECK],[nautyprog])\n>     AS_IF([test x\"[]$nautyprog[_CHECK]\" = x],[sage_spkg_install_nauty=yes])\n>   ])\n> ])\n> ```\n\n\nthe bonus question is to explain quoting in AC_PATH_PROG call. I must say I don't quite know the answer.",
    "created_at": "2020-01-07T15:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405183",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:8 dimpase]:
> by the way, how about writing a loop? :-)
> 
> ```m4
> SAGE_SPKG_CONFIGURE([nauty], [
>   m4_foreach([nautyprog], [directg, gentourng, geng, genbg], [
>     AC_PATH_PROG(nautyprog[_CHECK],[nautyprog])
>     AS_IF([test x"[]$nautyprog[_CHECK]" = x],[sage_spkg_install_nauty=yes])
>   ])
> ])
> ```


the bonus question is to explain quoting in AC_PATH_PROG call. I must say I don't quite know the answer.



---

archive/issue_comments_405184.json:
```json
{
    "body": "Change the `AS_IF` call to  to `AS_IF([test x\"[]$n...` does work too.",
    "created_at": "2020-01-07T16:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405184",
    "user": "https://github.com/dimpase"
}
```

Change the `AS_IF` call to  to `AS_IF([test x"[]$n...` does work too.



---

archive/issue_comments_405185.json:
```json
{
    "body": "Replying to [comment:11 mjo]:\n> Replying to [comment:7 dimpase]:\n> > This seems to be too distro-specific.\n> > Note that e.g. on Debian and Ubuntu the executabes in question get prefix `nauty-`, cf.\n> > https://packages.debian.org/buster/amd64/nauty/filelist\n> > \n> > One can e.g. test for these, and install prefix-less links into `$SAGE_LOCAL/bin`.\n> >  \n\n> \n> The usual way to handle this is to test for both names, e.g. \"directg\" and \"nauty-directg\", and then to put the resulting path into a variable like NAUTY_DIRECTG. You then tell autoconf to substitute that value into a file,\n> \n> \n> ```\n> AC_OUTPUT([ ... src/sage/graphs/digraph_generators.py ])\n> ```\n> \n> rename that file to src/sage/graphs/digraph_generators.py.in, and finally replace the hard-coded executable name with the variable:\n> \n> \n> ```\n> sub = subprocess.Popen('@NAUTY_DIRECTG@ {0}'.format(options),\n> ```\n> \n> It would be a little ugly to separate those file names (e.g. src/sage/graphs/digraph_generators.py) from the rest of spkg-configure.m4, since they need to go in the top-level configure.ac, but I don't foresee any other technical problems if this sounds acceptable.\n\n\nThere is considerable resistance by (binary) distro people to this sort of solution.\nI'd rather add an env. var. named like `SAGE_NAUTY_BIN_PREFIX` to `src/bin/sage-env-config`, which would be either `''` or `'nauty-'` and use it to compose names of executables.",
    "created_at": "2020-01-07T16:13:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405185",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 mjo]:
> Replying to [comment:7 dimpase]:
> > This seems to be too distro-specific.
> > Note that e.g. on Debian and Ubuntu the executabes in question get prefix `nauty-`, cf.
> > https://packages.debian.org/buster/amd64/nauty/filelist
> > 
> > One can e.g. test for these, and install prefix-less links into `$SAGE_LOCAL/bin`.
> >  

> 
> The usual way to handle this is to test for both names, e.g. "directg" and "nauty-directg", and then to put the resulting path into a variable like NAUTY_DIRECTG. You then tell autoconf to substitute that value into a file,
> 
> 
> ```
> AC_OUTPUT([ ... src/sage/graphs/digraph_generators.py ])
> ```
> 
> rename that file to src/sage/graphs/digraph_generators.py.in, and finally replace the hard-coded executable name with the variable:
> 
> 
> ```
> sub = subprocess.Popen('@NAUTY_DIRECTG@ {0}'.format(options),
> ```
> 
> It would be a little ugly to separate those file names (e.g. src/sage/graphs/digraph_generators.py) from the rest of spkg-configure.m4, since they need to go in the top-level configure.ac, but I don't foresee any other technical problems if this sounds acceptable.


There is considerable resistance by (binary) distro people to this sort of solution.
I'd rather add an env. var. named like `SAGE_NAUTY_BIN_PREFIX` to `src/bin/sage-env-config`, which would be either `''` or `'nauty-'` and use it to compose names of executables.



---

archive/issue_comments_405186.json:
```json
{
    "body": "I'm testing a branch with necessary for !Debian/Fedora etc adjustments for `nauty-` prefix",
    "created_at": "2020-01-07T21:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405186",
    "user": "https://github.com/dimpase"
}
```

I'm testing a branch with necessary for !Debian/Fedora etc adjustments for `nauty-` prefix



---

archive/issue_comments_405187.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-07T21:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405187",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405188.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-01-07T21:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405188",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405189.json:
```json
{
    "body": "here it is, please have a look\n\n---\nNew commits:",
    "created_at": "2020-01-07T21:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405189",
    "user": "https://github.com/dimpase"
}
```

here it is, please have a look

---
New commits:



---

archive/issue_comments_405190.json:
```json
{
    "body": "Replying to [comment:15 dimpase]:\n> I'm testing a branch with necessary for !Debian/Fedora etc adjustments for `nauty-` prefix\n\n\nThanks, I was busy with symmetrica all day...\n\n> There is considerable resistance by (binary) distro people to this sort of solution. I'd rather add an env. var.\n\n\nWhich part is objectionable? If one env var is OK, how about four env vars?\n\nThat would let us get away with only performing autoconf substitution in a single file (sage-env-config.in), but would result in a simpler implementation and would be more flexible if we ever meet a distro that uses different prefixes for different executables (e.g. if they only rename the ones that clash).\n\nAside from that, your version looks like it works but we wind up checking for geng twice:\n\n```\nconfigure: === checking whether to install the nauty SPKG ===\nchecking for geng... /usr/bin/geng\nchecking for directg... no\nchecking for gentourng... /usr/bin/gentourng\nchecking for geng... /usr/bin/geng\nchecking for genbg... /usr/bin/genbg\n```",
    "created_at": "2020-01-07T22:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405190",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:15 dimpase]:
> I'm testing a branch with necessary for !Debian/Fedora etc adjustments for `nauty-` prefix


Thanks, I was busy with symmetrica all day...

> There is considerable resistance by (binary) distro people to this sort of solution. I'd rather add an env. var.


Which part is objectionable? If one env var is OK, how about four env vars?

That would let us get away with only performing autoconf substitution in a single file (sage-env-config.in), but would result in a simpler implementation and would be more flexible if we ever meet a distro that uses different prefixes for different executables (e.g. if they only rename the ones that clash).

Aside from that, your version looks like it works but we wind up checking for geng twice:

```
configure: === checking whether to install the nauty SPKG ===
checking for geng... /usr/bin/geng
checking for directg... no
checking for gentourng... /usr/bin/gentourng
checking for geng... /usr/bin/geng
checking for genbg... /usr/bin/genbg
```



---

archive/issue_comments_405191.json:
```json
{
    "body": "Replying to [comment:17 mjo]:\n> Replying to [comment:15 dimpase]:\n> > I'm testing a branch with necessary for !Debian/Fedora etc adjustments for `nauty-` prefix\n\n> \n> Thanks, I was busy with symmetrica all day...\n> \n> > There is considerable resistance by (binary) distro people to this sort of solution. I'd rather add an env. var.\n\n> \n> Which part is objectionable? If one env var is OK, how about four env vars?\n\n\nthey say they don't use `./configure` to configure Sage.\nThis means they are OK with env vars, but not OK with `src/sage/foo/bar.py.in` files with templates.\n\n\n> \n> That would let us get away with only performing autoconf substitution in a single file (sage-env-config.in), but would result in a simpler implementation and would be more flexible if we ever meet a distro that uses different prefixes for different executables (e.g. if they only rename the ones that clash).\n> \n> Aside from that, your version looks like it works but we wind up checking for geng twice:\n\n\nyes, the 1st check is to figure out whether the `nauty-` prefix is there, or not.\nI can remove `geng` from the list from the `foreach` loop, but this will make the\nwhole thing a bit more cryptic.\n\n> \n> \n> ```\n> configure: === checking whether to install the nauty SPKG ===\n> checking for geng... /usr/bin/geng\n> checking for directg... no\n> checking for gentourng... /usr/bin/gentourng\n> checking for geng... /usr/bin/geng\n> checking for genbg... /usr/bin/genbg\n> ```",
    "created_at": "2020-01-07T22:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405191",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:17 mjo]:
> Replying to [comment:15 dimpase]:
> > I'm testing a branch with necessary for !Debian/Fedora etc adjustments for `nauty-` prefix

> 
> Thanks, I was busy with symmetrica all day...
> 
> > There is considerable resistance by (binary) distro people to this sort of solution. I'd rather add an env. var.

> 
> Which part is objectionable? If one env var is OK, how about four env vars?


they say they don't use `./configure` to configure Sage.
This means they are OK with env vars, but not OK with `src/sage/foo/bar.py.in` files with templates.


> 
> That would let us get away with only performing autoconf substitution in a single file (sage-env-config.in), but would result in a simpler implementation and would be more flexible if we ever meet a distro that uses different prefixes for different executables (e.g. if they only rename the ones that clash).
> 
> Aside from that, your version looks like it works but we wind up checking for geng twice:


yes, the 1st check is to figure out whether the `nauty-` prefix is there, or not.
I can remove `geng` from the list from the `foreach` loop, but this will make the
whole thing a bit more cryptic.

> 
> 
> ```
> configure: === checking whether to install the nauty SPKG ===
> checking for geng... /usr/bin/geng
> checking for directg... no
> checking for gentourng... /usr/bin/gentourng
> checking for geng... /usr/bin/geng
> checking for genbg... /usr/bin/genbg
> ```



---

archive/issue_comments_405192.json:
```json
{
    "body": "For what it's worth, here's what the spkg-configure.m4 looks like with four environment variables instead of one:\n\n```\nSAGE_SPKG_CONFIGURE([nauty], [\n\n  AC_PATH_PROGS([DIRECTG_PATH],[directg nauty-directg])\n  AS_IF([test x\"$DIRECTG_PATH\" = \"x\"],\n        [sage_spkg_install_nauty=yes DIRECTG_PATH=directg])\n  AC_SUBST(DIRECTG_PATH)\n\n  AC_PATH_PROGS([GENTOURNG_PATH],[gentourng nauty-gentourng])\n  AS_IF([test x\"$GENTOURNG_PATH\" = \"x\"],\n        [sage_spkg_install_nauty=yes GENTOURNG_PATH=gentourng])\n  AC_SUBST(GENTOURNG_PATH)\n\n  AC_PATH_PROGS([GENG_PATH],[geng nauty-geng])\n  AS_IF([test x\"$GENG_PATH\" = \"x\"],\n        [sage_spkg_install_nauty=yes GENG_PATH=geng])\n  AC_SUBST(GENG_PATH)\n\n  AC_PATH_PROGS([GENBG_PATH],[genbg nauty-genbg])\n  AS_IF([test x\"$GENBG_PATH\" = \"x\"],\n        [sage_spkg_install_nauty=yes GENBG_PATH=genbg])\n  AC_SUBST(GENBG_PATH)\n\n])\n```\n\nThe rest of the changes are straight-forward; you'd just import the paths instead of the prefix and execute them directly.",
    "created_at": "2020-01-07T23:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405192",
    "user": "https://github.com/orlitzky"
}
```

For what it's worth, here's what the spkg-configure.m4 looks like with four environment variables instead of one:

```
SAGE_SPKG_CONFIGURE([nauty], [

  AC_PATH_PROGS([DIRECTG_PATH],[directg nauty-directg])
  AS_IF([test x"$DIRECTG_PATH" = "x"],
        [sage_spkg_install_nauty=yes DIRECTG_PATH=directg])
  AC_SUBST(DIRECTG_PATH)

  AC_PATH_PROGS([GENTOURNG_PATH],[gentourng nauty-gentourng])
  AS_IF([test x"$GENTOURNG_PATH" = "x"],
        [sage_spkg_install_nauty=yes GENTOURNG_PATH=gentourng])
  AC_SUBST(GENTOURNG_PATH)

  AC_PATH_PROGS([GENG_PATH],[geng nauty-geng])
  AS_IF([test x"$GENG_PATH" = "x"],
        [sage_spkg_install_nauty=yes GENG_PATH=geng])
  AC_SUBST(GENG_PATH)

  AC_PATH_PROGS([GENBG_PATH],[genbg nauty-genbg])
  AS_IF([test x"$GENBG_PATH" = "x"],
        [sage_spkg_install_nauty=yes GENBG_PATH=genbg])
  AC_SUBST(GENBG_PATH)

])
```

The rest of the changes are straight-forward; you'd just import the paths instead of the prefix and execute them directly.



---

archive/issue_comments_405193.json:
```json
{
    "body": "This is not complete - it does not take into account the situation where nothing in the 2nd parameter of `SAGE_SPKG_CONFIGURE` is run, something that happens if `./configure` is run with the option `--without-system-nauty`.\n\nSo one needs four `AC_SUBST` calls in the 5th parameter of `SAGE_SPKG_CONFIGURE`, as well.\n\nThere is also a possibility that some of programs in question will be prefixed, and some will be not, potentially adding to confusion...",
    "created_at": "2020-01-08T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405193",
    "user": "https://github.com/dimpase"
}
```

This is not complete - it does not take into account the situation where nothing in the 2nd parameter of `SAGE_SPKG_CONFIGURE` is run, something that happens if `./configure` is run with the option `--without-system-nauty`.

So one needs four `AC_SUBST` calls in the 5th parameter of `SAGE_SPKG_CONFIGURE`, as well.

There is also a possibility that some of programs in question will be prefixed, and some will be not, potentially adding to confusion...



---

archive/issue_comments_405194.json:
```json
{
    "body": "Also, imagine people writing !Sage/Python code using other nauty utilities, not covered by the list of four. With your proposal, they'd be for a nasty surprise of having to modify not only Python, but also m4 macros...",
    "created_at": "2020-01-08T08:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405194",
    "user": "https://github.com/dimpase"
}
```

Also, imagine people writing !Sage/Python code using other nauty utilities, not covered by the list of four. With your proposal, they'd be for a nasty surprise of having to modify not only Python, but also m4 macros...



---

archive/issue_comments_405195.json:
```json
{
    "body": "This one should work, although I haven't actually tried to run Sage after building it (it takes 8+ hours on my workstation):\n\nhttps://git.sagemath.org/sage.git/diff?id=u/mjo/ticket/28958&id2=develop\n\nThat supports mismatched prefixes, and --with-system-nauty=no.\n\n\nReplying to [comment:21 dimpase]:\n> Also, imagine people writing !Sage/Python code using other nauty utilities, not covered by the list of four. With your proposal, they'd be for a nasty surprise of having to modify not only Python, but also m4 macros...\n\n\nThose four are the only ones used by the Sage library, which is the only thing we're testing for here (whether or not we're going to use the system copy of nauty from within the sage library). If you popen() another path in your own program (from nauty or otherwise), then it's up to you to ensure that something lives there.",
    "created_at": "2020-01-08T18:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405195",
    "user": "https://github.com/orlitzky"
}
```

This one should work, although I haven't actually tried to run Sage after building it (it takes 8+ hours on my workstation):

https://git.sagemath.org/sage.git/diff?id=u/mjo/ticket/28958&id2=develop

That supports mismatched prefixes, and --with-system-nauty=no.


Replying to [comment:21 dimpase]:
> Also, imagine people writing !Sage/Python code using other nauty utilities, not covered by the list of four. With your proposal, they'd be for a nasty surprise of having to modify not only Python, but also m4 macros...


Those four are the only ones used by the Sage library, which is the only thing we're testing for here (whether or not we're going to use the system copy of nauty from within the sage library). If you popen() another path in your own program (from nauty or otherwise), then it's up to you to ensure that something lives there.



---

archive/issue_comments_405196.json:
```json
{
    "body": "Replying to [comment:22 mjo]:\n\n> Replying to [comment:21 dimpase]:\n> > Also, imagine people writing !Sage/Python code using other nauty utilities, not covered by the list of four. With your proposal, they'd be for a nasty surprise of having to modify not only Python, but also m4 macros...\n\n> \n> Those four are the only ones used by the Sage library, which is the only thing we're testing for here (whether or not we're going to use the system copy of nauty from within the sage library). If you popen() another path in your own program (from nauty or otherwise), then it's up to you to ensure that something lives there.\n\n\nfrom point of view of Sage the distribution, Sage provides a working copy of nauty, not just these four programs. Your approach breaks more of nauty than mine.",
    "created_at": "2020-01-08T19:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405196",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:22 mjo]:

> Replying to [comment:21 dimpase]:
> > Also, imagine people writing !Sage/Python code using other nauty utilities, not covered by the list of four. With your proposal, they'd be for a nasty surprise of having to modify not only Python, but also m4 macros...

> 
> Those four are the only ones used by the Sage library, which is the only thing we're testing for here (whether or not we're going to use the system copy of nauty from within the sage library). If you popen() another path in your own program (from nauty or otherwise), then it's up to you to ensure that something lives there.


from point of view of Sage the distribution, Sage provides a working copy of nauty, not just these four programs. Your approach breaks more of nauty than mine.



---

archive/issue_comments_405197.json:
```json
{
    "body": "Replying to [comment:23 dimpase]:\n> \n> from point of view of Sage the distribution, Sage provides a working copy of nauty, not just these four programs. Your approach breaks more of nauty than mine.\n> \n\n\nWith either the system copy or the spkg, users get a completely functional copy of nauty, don't they? It was not my intention to break that. Can you give me an example of what goes wrong in my approach that doesn't with yours?",
    "created_at": "2020-01-08T20:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405197",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:23 dimpase]:
> 
> from point of view of Sage the distribution, Sage provides a working copy of nauty, not just these four programs. Your approach breaks more of nauty than mine.
> 


With either the system copy or the spkg, users get a completely functional copy of nauty, don't they? It was not my intention to break that. Can you give me an example of what goes wrong in my approach that doesn't with yours?



---

archive/issue_comments_405198.json:
```json
{
    "body": "Suppose one wrote some Sage code using nauty's `amtog` script, calling it in `subprocess.Popen(\"amtog...`,or whatever. Now, this will break on Debian's nauty, as it is called\n`nauty-amtog` there. \n\nWith my patch, the problem can be fixed in Python by mimicking what's done in, say,  `src/sage/graphs/digraph_generators.py` :\n\n```python\nfrom sage.env import SAGE_NAUTY_BINS_PREFIX as nautyprefix\n...\nsubprocess.Popen(nautyprefix+\"amtog...\n```\n\nWith your patch, one would need either to do executable discovery in Python (ugly), extract the correct prefix from, say, `DIRECTG_PATH` (cursing the patch's author) and use it as above, or modify your patch by adding `amtog` to the list of four (tricky and might just be infeasible, as it modifies Sage sources).",
    "created_at": "2020-01-09T05:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405198",
    "user": "https://github.com/dimpase"
}
```

Suppose one wrote some Sage code using nauty's `amtog` script, calling it in `subprocess.Popen("amtog...`,or whatever. Now, this will break on Debian's nauty, as it is called
`nauty-amtog` there. 

With my patch, the problem can be fixed in Python by mimicking what's done in, say,  `src/sage/graphs/digraph_generators.py` :

```python
from sage.env import SAGE_NAUTY_BINS_PREFIX as nautyprefix
...
subprocess.Popen(nautyprefix+"amtog...
```

With your patch, one would need either to do executable discovery in Python (ugly), extract the correct prefix from, say, `DIRECTG_PATH` (cursing the patch's author) and use it as above, or modify your patch by adding `amtog` to the list of four (tricky and might just be infeasible, as it modifies Sage sources).



---

archive/issue_comments_405199.json:
```json
{
    "body": "Replying to [comment:25 dimpase]:\n> Suppose one wrote some Sage code using nauty's `amtog` script, calling it in `subprocess.Popen(\"amtog...`,or whatever. Now, this will break on Debian's nauty, as it is called\n> `nauty-amtog` there. \n\n\n> \n> With my patch, the problem can be fixed in Python by mimicking what's done \n\n\nRelying on these dependencies to be satisfied transitively can't possible work in sage-the-distribution, or any other linuxy distribution. The way we design these spkg-configure tests is to test for only the features used by the sage library. With nauty, we test for the four programs the sage library uses. With e.g. zlib, we test for a version of zlib that works with the sage library.\n\nIf someone wants to write a program that works \"in sage\" but which uses nauty or zlib, they can't depend on a particular interface being presented by those two package just because they \"come from sage.\" Consider that,\n\n1. Multiple versions of nauty and zlib (and everything else) can wind up installed to satisfy the sage dependency. New executables get added to nauty in new versions, and our configure check will match any version. If the user wants to ensure that an executable is there with a specific name, that's too much to ask -- he can't even be sure that the executable is there at all! Likewise if you want to use the public API of the zlib that comes with sage. If you want to use a newer function, you can't rely on sage's zlib to provide it, because sage will happily detect and use an old version of zlib.\n2. You can't fix the first problem even if you detect an exact version in spkg-configure. Different versions of sage install different versions of its dependencies anyway, so if you build against \"sage\", then you're back to the problem you started with: now you need to know what version of sage is installed as a proxy for the version of the library/programs that are installed.\n\nThis is no different than it is for any other linux distribution that provides a bunch of software. If you code against \"debian\", and if you use a feature in a library on debian, your program is still responsible for testing the existence of that feature. There's nothing debian can do for you to present an immutable API, and sage is the same.\n\n> \n> With your patch, one would need either to do executable discovery in Python (ugly), extract the correct prefix from, say, `DIRECTG_PATH` (cursing the patch's author) and use it as above, or modify your patch by adding `amtog` to the list of four (tricky and might just be infeasible, as it modifies Sage sources).\n\n\nYou've left out the best option =)\n\nIf someone writes a program against sagelib and against features of nauty that aren't a part of sagelib, then their build system has to ensure that those features are present. This is no different than writing any program that's supposed to work on any other distribution. If your code uses amtog, your build system should check for amtog.\n\nWith all that said... I don't really care if we promise more than we can deliver. I don't like that it makes the test a lot uglier than it has to be, and that we check for geng twice, but if it works (I'll build your branch tonight) I'm willing to thumbs-up it.",
    "created_at": "2020-01-09T21:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405199",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:25 dimpase]:
> Suppose one wrote some Sage code using nauty's `amtog` script, calling it in `subprocess.Popen("amtog...`,or whatever. Now, this will break on Debian's nauty, as it is called
> `nauty-amtog` there. 


> 
> With my patch, the problem can be fixed in Python by mimicking what's done 


Relying on these dependencies to be satisfied transitively can't possible work in sage-the-distribution, or any other linuxy distribution. The way we design these spkg-configure tests is to test for only the features used by the sage library. With nauty, we test for the four programs the sage library uses. With e.g. zlib, we test for a version of zlib that works with the sage library.

If someone wants to write a program that works "in sage" but which uses nauty or zlib, they can't depend on a particular interface being presented by those two package just because they "come from sage." Consider that,

1. Multiple versions of nauty and zlib (and everything else) can wind up installed to satisfy the sage dependency. New executables get added to nauty in new versions, and our configure check will match any version. If the user wants to ensure that an executable is there with a specific name, that's too much to ask -- he can't even be sure that the executable is there at all! Likewise if you want to use the public API of the zlib that comes with sage. If you want to use a newer function, you can't rely on sage's zlib to provide it, because sage will happily detect and use an old version of zlib.
2. You can't fix the first problem even if you detect an exact version in spkg-configure. Different versions of sage install different versions of its dependencies anyway, so if you build against "sage", then you're back to the problem you started with: now you need to know what version of sage is installed as a proxy for the version of the library/programs that are installed.

This is no different than it is for any other linux distribution that provides a bunch of software. If you code against "debian", and if you use a feature in a library on debian, your program is still responsible for testing the existence of that feature. There's nothing debian can do for you to present an immutable API, and sage is the same.

> 
> With your patch, one would need either to do executable discovery in Python (ugly), extract the correct prefix from, say, `DIRECTG_PATH` (cursing the patch's author) and use it as above, or modify your patch by adding `amtog` to the list of four (tricky and might just be infeasible, as it modifies Sage sources).


You've left out the best option =)

If someone writes a program against sagelib and against features of nauty that aren't a part of sagelib, then their build system has to ensure that those features are present. This is no different than writing any program that's supposed to work on any other distribution. If your code uses amtog, your build system should check for amtog.

With all that said... I don't really care if we promise more than we can deliver. I don't like that it makes the test a lot uglier than it has to be, and that we check for geng twice, but if it works (I'll build your branch tonight) I'm willing to thumbs-up it.



---

archive/issue_comments_405200.json:
```json
{
    "body": "As I already said, removing `geng,` from the 2nd line of `spkg-configure.m4` will remove double-testing for `geng`. But it's a minor point.",
    "created_at": "2020-01-10T14:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405200",
    "user": "https://github.com/dimpase"
}
```

As I already said, removing `geng,` from the 2nd line of `spkg-configure.m4` will remove double-testing for `geng`. But it's a minor point.



---

archive/issue_comments_405201.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-10T17:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405201",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405202.json:
```json
{
    "body": "God help the next person that needs to debug that m4 file, but it seems to work =P",
    "created_at": "2020-01-10T17:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405202",
    "user": "https://github.com/orlitzky"
}
```

God help the next person that needs to debug that m4 file, but it seems to work =P



---

archive/issue_comments_405203.json:
```json
{
    "body": "Clever, but not helpful with distros (non debian) where `SAGE_NAUTY_BINS_PREFIX` is most likely undefined [in gentoo I got rid of `sage-env` altogether and I fell much better for it]. It being undefined means that in `env.py` \n\n```\nvar('SAGE_NAUTY_BINS_PREFIX')\n```\nsets it to `None`, which is not a string which has the following kind of consequences\n\n```\nsage -t --long /usr/lib/python3.7/site-packages/sage/graphs/line_graph.pyx\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/graphs/line_graph.pyx\", line 435, in sage.graphs.line_graph.root_graph\nFailed example:\n    for i,g in enumerate(graphs(6)): # long time\n      if not g.is_connected():       # long time\n        continue                     # long time\n      test(g)                        # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.line_graph.root_graph[2]>\", line 1, in <module>\n        for i,g in enumerate(graphs(Integer(6))): # long time\n      File \"/usr/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 739, in __call__\n        for g in graphs.nauty_geng(vertices):\n      File \"/usr/lib/python3.7/site-packages/sage/graphs/graph_generators.py\", line 926, in nauty_geng\n        sp = subprocess.Popen(nautyprefix+\"geng {0}\".format(options), shell=True,\n    TypeError: unsupported operand type(s) for +: 'NoneType' and 'str'\n**********************************************************************\n```\nI guess defaulting to an empty string in `env.py` would do the trick.\n\nI am happy for such correction to be in a follow up ticket.",
    "created_at": "2020-01-12T02:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405203",
    "user": "https://github.com/kiwifb"
}
```

Clever, but not helpful with distros (non debian) where `SAGE_NAUTY_BINS_PREFIX` is most likely undefined [in gentoo I got rid of `sage-env` altogether and I fell much better for it]. It being undefined means that in `env.py` 

```
var('SAGE_NAUTY_BINS_PREFIX')
```
sets it to `None`, which is not a string which has the following kind of consequences

```
sage -t --long /usr/lib/python3.7/site-packages/sage/graphs/line_graph.pyx
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/graphs/line_graph.pyx", line 435, in sage.graphs.line_graph.root_graph
Failed example:
    for i,g in enumerate(graphs(6)): # long time
      if not g.is_connected():       # long time
        continue                     # long time
      test(g)                        # long time
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.line_graph.root_graph[2]>", line 1, in <module>
        for i,g in enumerate(graphs(Integer(6))): # long time
      File "/usr/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 739, in __call__
        for g in graphs.nauty_geng(vertices):
      File "/usr/lib/python3.7/site-packages/sage/graphs/graph_generators.py", line 926, in nauty_geng
        sp = subprocess.Popen(nautyprefix+"geng {0}".format(options), shell=True,
    TypeError: unsupported operand type(s) for +: 'NoneType' and 'str'
**********************************************************************
```
I guess defaulting to an empty string in `env.py` would do the trick.

I am happy for such correction to be in a follow up ticket.



---

archive/issue_comments_405204.json:
```json
{
    "body": "I'm seeing various failures on buildbots (where nauty is not system-wide installed)",
    "created_at": "2020-01-12T08:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405204",
    "user": "https://github.com/vbraun"
}
```

I'm seeing various failures on buildbots (where nauty is not system-wide installed)



---

archive/issue_comments_405205.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-12T08:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405205",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405206.json:
```json
{
    "body": "Replying to [comment:30 vbraun]:\n> I'm seeing various failures on buildbots (where nauty is not system-wide installed)\n\n\nI think that make my argument for a default in `env.py` stronger. Using\n\n```\nvar('SAGE_NAUTY_BINS_PREFIX',    '')\n```\nis enough to fix the issue for me and I am sure it would make Volker's bots happy.",
    "created_at": "2020-01-12T08:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405206",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:30 vbraun]:
> I'm seeing various failures on buildbots (where nauty is not system-wide installed)


I think that make my argument for a default in `env.py` stronger. Using

```
var('SAGE_NAUTY_BINS_PREFIX',    '')
```
is enough to fix the issue for me and I am sure it would make Volker's bots happy.



---

archive/issue_comments_405207.json:
```json
{
    "body": "```\nsage: from sage.env import SAGE_NAUTY_BINS_PREFIX as nautyprefix\nsage: nautyprefix\n'@SAGE_NAUTY_BINS_PREFIX@'\n```",
    "created_at": "2020-01-12T09:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405207",
    "user": "https://github.com/vbraun"
}
```

```
sage: from sage.env import SAGE_NAUTY_BINS_PREFIX as nautyprefix
sage: nautyprefix
'@SAGE_NAUTY_BINS_PREFIX@'
```



---

archive/issue_comments_405208.json:
```json
{
    "body": "Replying to [comment:32 vbraun]:\n> {{{\n> sage: from sage.env import SAGE_NAUTY_BINS_PREFIX as nautyprefix\n> sage: nautyprefix\n> '`@`SAGE_NAUTY_BINS_PREFIX`@`'\n> }}}\n\nthis looks like an issue with improperly updated `./configure`.",
    "created_at": "2020-01-12T09:09:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405208",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:32 vbraun]:
> {{{
> sage: from sage.env import SAGE_NAUTY_BINS_PREFIX as nautyprefix
> sage: nautyprefix
> '`@`SAGE_NAUTY_BINS_PREFIX`@`'
> }}}

this looks like an issue with improperly updated `./configure`.



---

archive/issue_comments_405209.json:
```json
{
    "body": "OK,  a default in `env.py` won't fix that :)  I am not even sure how that happen. An improperly updated configure could do that I guess.",
    "created_at": "2020-01-12T09:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405209",
    "user": "https://github.com/kiwifb"
}
```

OK,  a default in `env.py` won't fix that :)  I am not even sure how that happen. An improperly updated configure could do that I guess.



---

archive/issue_comments_405210.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-01-12T09:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405211.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-01-12T09:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405211",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_405212.json:
```json
{
    "body": "rebased over the latest beta, and added the fix from comment:31\n\nmodulo a possible release process issue wrt `./configure` all is fine.",
    "created_at": "2020-01-12T09:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405212",
    "user": "https://github.com/dimpase"
}
```

rebased over the latest beta, and added the fix from comment:31

modulo a possible release process issue wrt `./configure` all is fine.



---

archive/issue_comments_405213.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-20T21:18:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405213",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_073334.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-20T21:18:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28721#event-73334"
}
```



---

archive/issue_comments_405214.json:
```json
{
    "body": "New versions of normaliz (#27952) use libnauty as well. Provided by libnauty-dev on Debian. Not sure which other distributions provide the library too.\n\nShould we be adding a test for libnauty to `build/pkgs/nauty/spkg-configure.m4`?\nAlternatively, I could imagine creating a script package `libnauty` (depending on `nauty`) with its own `spkg-configure.m4`.\nThoughts?",
    "created_at": "2020-02-25T19:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405214",
    "user": "https://github.com/mkoeppe"
}
```

New versions of normaliz (#27952) use libnauty as well. Provided by libnauty-dev on Debian. Not sure which other distributions provide the library too.

Should we be adding a test for libnauty to `build/pkgs/nauty/spkg-configure.m4`?
Alternatively, I could imagine creating a script package `libnauty` (depending on `nauty`) with its own `spkg-configure.m4`.
Thoughts?



---

archive/issue_comments_405215.json:
```json
{
    "body": "Replying to [comment:38 mkoeppe]:\n> New versions of normaliz (#27952) use libnauty as well. Provided by libnauty-dev on Debian. Not sure which other distributions provide the library too.\n> \n> Should we be adding a test for libnauty to `build/pkgs/nauty/spkg-configure.m4`?\n\n\nThat sounds right to me. There's even a pkg-config file if you're lucky.",
    "created_at": "2020-02-25T19:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405215",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:38 mkoeppe]:
> New versions of normaliz (#27952) use libnauty as well. Provided by libnauty-dev on Debian. Not sure which other distributions provide the library too.
> 
> Should we be adding a test for libnauty to `build/pkgs/nauty/spkg-configure.m4`?


That sounds right to me. There's even a pkg-config file if you're lucky.



---

archive/issue_comments_405216.json:
```json
{
    "body": "Replying to [comment:39 mjo]:\n> There's even a pkg-config file if you're lucky.\n\nNo such luck. Upstream nauty does not even have a proper build system; Debian replaces it with autotools, but does not provide `.pc`.",
    "created_at": "2020-02-26T01:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405216",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:39 mjo]:
> There's even a pkg-config file if you're lucky.

No such luck. Upstream nauty does not even have a proper build system; Debian replaces it with autotools, but does not provide `.pc`.



---

archive/issue_comments_405217.json:
```json
{
    "body": "Replying to [comment:38 mkoeppe]:\n> New versions of normaliz (#27952) use libnauty as well. Provided by libnauty-dev on Debian. Not sure which other distributions provide the library too.\n\n\nFedora & Co do, see\nhttps://rpmfind.net/linux/rpm2html/search.php?query=libnauty\n> \n> Should we be adding a test for libnauty to `build/pkgs/nauty/spkg-configure.m4`?\n> Alternatively, I could imagine creating a script package `libnauty` (depending on `nauty`) with its own `spkg-configure.m4`.\n> Thoughts?\n\n\nyes, this seems to be more reasonable, as libnauty is only used in optional packages",
    "created_at": "2020-02-26T14:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28721#issuecomment-405217",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:38 mkoeppe]:
> New versions of normaliz (#27952) use libnauty as well. Provided by libnauty-dev on Debian. Not sure which other distributions provide the library too.


Fedora & Co do, see
https://rpmfind.net/linux/rpm2html/search.php?query=libnauty
> 
> Should we be adding a test for libnauty to `build/pkgs/nauty/spkg-configure.m4`?
> Alternatively, I could imagine creating a script package `libnauty` (depending on `nauty`) with its own `spkg-configure.m4`.
> Thoughts?


yes, this seems to be more reasonable, as libnauty is only used in optional packages
