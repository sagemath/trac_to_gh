# Issue 11196: can't coerce pari to rational function field

Issue created by migration from https://trac.sagemath.org/ticket/11368

Original creator: katestange

Original creation time: 2011-05-23 04:12:19

Assignee: robertwb

CC:  katestange

Keywords: coercion pari rational fraction_field

The following fails

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: S = R.fraction_field()
sage: S(pari((x+y)/y))
TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field 
```

However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).


---

Comment by katestange created at 2011-05-23 04:16:01

I think it is probably related that the following fails: (with R and S as above)

```
S('(x+y)/y')
```

with the same error.  Again, polynomial coercion like

```
S('x+y')
```

succeeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)


---

Comment by katestange created at 2011-05-23 04:16:01

Changing keywords from "coercion pari rational fraction_field" to "coercion pari rational fraction_field string".


---

Comment by pbruin created at 2013-10-30 16:41:32

In newer Sage  versions (for example 5.13.beta0), the example `S('(x+y)/y')` works correctly, but the original example (converting from PARI) still fails.


---

Comment by pbruin created at 2013-12-20 14:19:13

The problem seems to be this:

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: a=pari((x+y)/y); a
1/y*x + 1
sage: a.numerator()
1/y*x + 1
sage: a.denominator()
1
```

Note that the following does work:

```
sage: b=pari((x+y)/x); b
(x + y)/x
sage: b.numerator()
x + y
sage: b.denominator()
x
```

Note also that the PARI types are different:

```
sage: a.type()
't_POL'
sage: b.type()
't_RFRAC'
```

This difference arises because PARI treats multivariate polynomials as iterated univariate polynomials.  To PARI, _a_ lives in *Q*(_y_)[_x_], and _b_ in Frac(*Q*[_y_][_x_]).

The solution is probably to convert PARI elements of type `t_POL` coefficientwise into _S_.


---

Comment by pbruin created at 2013-12-20 17:45:15

Changing status from new to needs_review.


---

Comment by mstreng created at 2013-12-23 14:19:35

I'll review this as my first git review.
----
New commits:


---

Comment by mstreng created at 2013-12-24 21:10:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-05 02:56:49

Resolution: fixed
