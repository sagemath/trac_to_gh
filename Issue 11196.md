# Issue 11196: can't coerce pari to rational function field

archive/issues_011196.json:
```json
{
    "body": "Assignee: robertwb\n\nCC:  katestange\n\nKeywords: coercion pari rational fraction_field\n\nThe following fails\n\n```\nsage: R.<x,y> = PolynomialRing(QQ)\nsage: S = R.fraction_field()\nsage: S(pari((x+y)/y))\nTypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field \n```\n\nHowever, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).\n\nIssue created by migration from https://trac.sagemath.org/ticket/11368\n\n",
    "created_at": "2011-05-23T04:12:19Z",
    "labels": [
        "coercion",
        "minor",
        "bug"
    ],
    "title": "can't coerce pari to rational function field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11196",
    "user": "katestange"
}
```
Assignee: robertwb

CC:  katestange

Keywords: coercion pari rational fraction_field

The following fails

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: S = R.fraction_field()
sage: S(pari((x+y)/y))
TypeError: no canonical coercion from Fraction Field of Multivariate Polynomial Ring in x, y over Rational Field to Rational Field 
```

However, if you replace (x+y)/y with x+y, it works (in other words, polynomials work but rational functions don't).

Issue created by migration from https://trac.sagemath.org/ticket/11368





---

archive/issue_comments_123135.json:
```json
{
    "body": "I think it is probably related that the following fails: (with R and S as above)\n\n```\nS('(x+y)/y')\n```\n\nwith the same error.  Again, polynomial coercion like\n\n```\nS('x+y')\n```\n\nsucceeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)",
    "created_at": "2011-05-23T04:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123135",
    "user": "katestange"
}
```

I think it is probably related that the following fails: (with R and S as above)

```
S('(x+y)/y')
```

with the same error.  Again, polynomial coercion like

```
S('x+y')
```

succeeds.  (If someone finds that this is a different problem, please put in a separate ticket, but I'm guessing it's related.)



---

archive/issue_comments_123136.json:
```json
{
    "body": "Changing keywords from \"coercion pari rational fraction_field\" to \"coercion pari rational fraction_field string\".",
    "created_at": "2011-05-23T04:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123136",
    "user": "katestange"
}
```

Changing keywords from "coercion pari rational fraction_field" to "coercion pari rational fraction_field string".



---

archive/issue_comments_123137.json:
```json
{
    "body": "In newer Sage  versions (for example 5.13.beta0), the example `S('(x+y)/y')` works correctly, but the original example (converting from PARI) still fails.",
    "created_at": "2013-10-30T16:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123137",
    "user": "pbruin"
}
```

In newer Sage  versions (for example 5.13.beta0), the example `S('(x+y)/y')` works correctly, but the original example (converting from PARI) still fails.



---

archive/issue_comments_123138.json:
```json
{
    "body": "The problem seems to be this:\n\n```\nsage: R.<x,y> = PolynomialRing(QQ)\nsage: a=pari((x+y)/y); a\n1/y*x + 1\nsage: a.numerator()\n1/y*x + 1\nsage: a.denominator()\n1\n```\n\nNote that the following does work:\n\n```\nsage: b=pari((x+y)/x); b\n(x + y)/x\nsage: b.numerator()\nx + y\nsage: b.denominator()\nx\n```\n\nNote also that the PARI types are different:\n\n```\nsage: a.type()\n't_POL'\nsage: b.type()\n't_RFRAC'\n```\n\nThis difference arises because PARI treats multivariate polynomials as iterated univariate polynomials.  To PARI, *a* lives in **Q**(*y*)[*x*], and *b* in Frac(**Q**[*y*][*x*]).\n\nThe solution is probably to convert PARI elements of type `t_POL` coefficientwise into *S*.",
    "created_at": "2013-12-20T14:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123138",
    "user": "pbruin"
}
```

The problem seems to be this:

```
sage: R.<x,y> = PolynomialRing(QQ)
sage: a=pari((x+y)/y); a
1/y*x + 1
sage: a.numerator()
1/y*x + 1
sage: a.denominator()
1
```

Note that the following does work:

```
sage: b=pari((x+y)/x); b
(x + y)/x
sage: b.numerator()
x + y
sage: b.denominator()
x
```

Note also that the PARI types are different:

```
sage: a.type()
't_POL'
sage: b.type()
't_RFRAC'
```

This difference arises because PARI treats multivariate polynomials as iterated univariate polynomials.  To PARI, *a* lives in **Q**(*y*)[*x*], and *b* in Frac(**Q**[*y*][*x*]).

The solution is probably to convert PARI elements of type `t_POL` coefficientwise into *S*.



---

archive/issue_comments_123139.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-20T17:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123139",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_123140.json:
```json
{
    "body": "I'll review this as my first git review.\n----\nNew commits:",
    "created_at": "2013-12-23T14:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123140",
    "user": "mstreng"
}
```

I'll review this as my first git review.
----
New commits:



---

archive/issue_comments_123141.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-24T21:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123141",
    "user": "mstreng"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_123142.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-05T02:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11196",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11196#issuecomment-123142",
    "user": "vbraun"
}
```

Resolution: fixed
