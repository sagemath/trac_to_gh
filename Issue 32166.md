# Issue 32166: tweak tox.yml

Issue created by migration from https://trac.sagemath.org/ticket/32403

Original creator: chapoton

Original creation time: 2021-08-21 18:20:15

CC:  mkoeppe slelievre @davewittemorris @kliem dimpase

so that it uses upstream_url


---

Comment by chapoton created at 2021-08-21 18:21:11

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-08-21 18:21:11

New commits:


---

Comment by mkoeppe created at 2021-08-21 18:42:28

No, a major point of the "make dist" workflow is actually to check that the release manager has uploaded all files to the mirror!


---

Comment by chapoton created at 2021-08-21 18:48:38

so we are not able to use it for cases like #32372 ?


---

Comment by mkoeppe created at 2021-08-21 19:13:36

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-08-21 19:13:36

It was designed to fail on branches that add/upgrade packages - until the release manager uploads the package tarball.

But I concede that this is at least poorly documented and does not serve us well any more in this form. 

We can use your change (so that the failure goes away). I would add here on the same ticket a new workflow that only runs on release tags, not other branches or tags, to run the old "make dist" without --enable-download-from-upstream-url.


---

Comment by mkoeppe created at 2021-08-21 20:06:21

The new workflow that is launched on release tags only has successfully run here: https://github.com/mkoeppe/sage/runs/3390524672?check_suite_focus=true
----
New commits:


---

Comment by mkoeppe created at 2021-08-21 20:06:21

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-08-21 20:12:45

(commented on wrong ticket)


---

Comment by chapoton created at 2021-08-22 06:12:53

ok for me, but somebody more knowledgeable should be consulted


---

Comment by dimpase created at 2021-08-27 09:36:24

lgtm


---

Comment by chapoton created at 2021-08-27 15:36:29

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2021-08-27 15:36:29

I will interpret that as a positive review


---

Comment by vbraun created at 2021-09-13 22:19:07

Resolution: fixed
