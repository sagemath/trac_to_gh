# Issue 12984: The is_old method from sage.modular.modform.element.ModularFormElement doesn't work correctly

Issue created by migration from https://trac.sagemath.org/ticket/13156

Original creator: Snark

Original creation time: 2012-06-23 15:25:00

Assignee: craigcitro


```
sage: E=ModularForms(3,12).cuspidal_subspace()
sage: f=E.gens()[0]
sage: g=f-f
sage: g.is_old()
False
```


This is definitely a case where sage returns a wrong answer.


---

Comment by davidloeffler created at 2013-07-22 17:42:03

I traced this back to a problem with the `__call__` method's membership testing code for modular forms subspaces. The problem is that it expects imprecise q-expansions, and fails badly when given the zero q-expansion as argument.


---

Comment by davidloeffler created at 2013-07-22 17:44:20

Test case for the underlying bug:

```

sage: R.<q> = QQ[[]]                                           
sage: ModularForms(2, 8)(q^20 + q^120)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-101-f1640b98a1fd> in <module>()
----> 1 ModularForms(Integer(2), Integer(8))(q**Integer(20) + q**Integer(120))

/storage/masiao/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/modular/modform/space.pyc in __call__(self, x, check)
   1147                 x_potential = self.free_module().linear_combination_of_basis(x_potential)
   1148                 x_potential = element.ModularFormElement(self, x_potential)
-> 1149                 for i in range(int(W.degree()), x.prec()):
   1150                     if x_potential[i] != x[i]:
   1151                         raise ValueError, "q-expansion does not correspond to a form in self"

TypeError: range() integer end argument expected, got PlusInfinity.
```



---

Comment by davidloeffler created at 2013-07-22 17:44:20

Changing keywords from "" to "sd51".


---

Comment by davidloeffler created at 2013-07-23 12:06:30

patch against 5.11.beta3


---

Comment by davidloeffler created at 2013-07-23 12:06:51

Changing status from new to needs_review.


---

Attachment


---

Comment by AlexGhitza created at 2013-07-23 12:55:43

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-07-31 12:53:31

Resolution: fixed
