# Issue 32764: Invoke manifolds with structure more conveniently

archive/issues_032764.json:
```json
{
    "body": "CC:  egourgoulhon tscrim @tobiasdiez\n\nAs discussed in #30362, [comment:77](https://trac.sagemath.org/ticket/30362#comment:77), we add `TopologicalManifold`, `DifferentiableManifold`, `RiemannianManifold` etc. to the `manifolds` namespace.\n\nThis shall represent an additional and more convenient syntax opposed to `Manifold(..., structure=...)`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33001\n\n",
    "created_at": "2021-12-09T07:33:29Z",
    "labels": [
        "manifolds",
        "major",
        "enhancement"
    ],
    "title": "Invoke manifolds with structure more conveniently",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32764",
    "user": "@mjungmath"
}
```
CC:  egourgoulhon tscrim @tobiasdiez

As discussed in #30362, [comment:77](https://trac.sagemath.org/ticket/30362#comment:77), we add `TopologicalManifold`, `DifferentiableManifold`, `RiemannianManifold` etc. to the `manifolds` namespace.

This shall represent an additional and more convenient syntax opposed to `Manifold(..., structure=...)`.

Issue created by migration from https://trac.sagemath.org/ticket/33001





---

archive/issue_comments_467255.json:
```json
{
    "body": "-1 on adding classes such as `TopologicalManifold` to `manifolds`; to my understanding `manifolds`, like `polytopes`, `groups`, `algebras`, is intended to provide a \"catalog\" of examples, not a general \"namespace\".",
    "created_at": "2021-12-09T17:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467255",
    "user": "mkoeppe"
}
```

-1 on adding classes such as `TopologicalManifold` to `manifolds`; to my understanding `manifolds`, like `polytopes`, `groups`, `algebras`, is intended to provide a "catalog" of examples, not a general "namespace".



---

archive/issue_comments_467256.json:
```json
{
    "body": "Alright, I see. That makes sense. What about something like `Manifold.Topological(...)`?",
    "created_at": "2021-12-09T18:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467256",
    "user": "@mjungmath"
}
```

Alright, I see. That makes sense. What about something like `Manifold.Topological(...)`?



---

archive/issue_comments_467257.json:
```json
{
    "body": "I'd rather suggest to look into having certain keyword arguments trigger a choice of structure.\n\n```\nsage: Manifold(2, 'M', diff_degree=7)\nValueError: diff_degree = 7 is not compatible with a smooth structure\n```\n\nInstead, this could perhaps imply `structure='differentiable'`.\n\n\n```\nsage: Manifold(2, 'M', metric_name='g')\n2-dimensional differentiable manifold M\n```\n\nInstead, this should probably select `structure='Riemannian'`.\n\nIt would also be good if users could pass a `category` keyword to select the structure. In this direction, also for example the Riemannian structure is not yet reflected in the categories:\n\n```\nsage: E = EuclideanSpace(2)\nsage: E.category()\nJoin of Category of smooth manifolds over Real Field with 53 bits of precision and Category of connected manifolds over Real Field with 53 bits of precision and Category of complete metric spaces\n```\n\nThis is something that we should extend along the way.",
    "created_at": "2021-12-09T19:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467257",
    "user": "mkoeppe"
}
```

I'd rather suggest to look into having certain keyword arguments trigger a choice of structure.

```
sage: Manifold(2, 'M', diff_degree=7)
ValueError: diff_degree = 7 is not compatible with a smooth structure
```

Instead, this could perhaps imply `structure='differentiable'`.


```
sage: Manifold(2, 'M', metric_name='g')
2-dimensional differentiable manifold M
```

Instead, this should probably select `structure='Riemannian'`.

It would also be good if users could pass a `category` keyword to select the structure. In this direction, also for example the Riemannian structure is not yet reflected in the categories:

```
sage: E = EuclideanSpace(2)
sage: E.category()
Join of Category of smooth manifolds over Real Field with 53 bits of precision and Category of connected manifolds over Real Field with 53 bits of precision and Category of complete metric spaces
```

This is something that we should extend along the way.



---

archive/issue_comments_467258.json:
```json
{
    "body": "I agree with Matthias. I would not be opposed to `manifolds.Topological`, but I like having default behavior depend on extra parameters. +1 on adding more categories (although we have to differentiate be `metric_function` and `metric_tensor`) and having the category information yield the structure. Of course, in all cases, if the user explicitly passes `structure`, that should take priority or raise an error if there is a conflict.",
    "created_at": "2021-12-09T23:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467258",
    "user": "tscrim"
}
```

I agree with Matthias. I would not be opposed to `manifolds.Topological`, but I like having default behavior depend on extra parameters. +1 on adding more categories (although we have to differentiate be `metric_function` and `metric_tensor`) and having the category information yield the structure. Of course, in all cases, if the user explicitly passes `structure`, that should take priority or raise an error if there is a conflict.



---

archive/issue_comments_467259.json:
```json
{
    "body": "I agree. The categorical approach is the most natural one.\n\nI think we should get rid of the structure implementation as it is right now and entirely jump over to categories. This would also have the great advantage that we can combine structures such as symplectic and Riemannian structures, which are not mutually exclusive.\n\nAlso this default behavior on extra parameters is a good idea.",
    "created_at": "2021-12-10T07:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467259",
    "user": "@mjungmath"
}
```

I agree. The categorical approach is the most natural one.

I think we should get rid of the structure implementation as it is right now and entirely jump over to categories. This would also have the great advantage that we can combine structures such as symplectic and Riemannian structures, which are not mutually exclusive.

Also this default behavior on extra parameters is a good idea.



---

archive/issue_comments_467260.json:
```json
{
    "body": "I am fairly -1 on pushing the full structure into the categories. This was a very conscious design decision in full view of what could be done with categories.\n\n1. It makes it difficult to easily change. Right now, it is trivial if someone wants to promote/demote the structure of a manifold. (You change a parameter and do not have to create an entire new object, which is relatively expensive for manifolds.)\n2. It allows for something easy to transfer information across different base rings.\n3. It is easy to have extra parameterizations. For example, the classes of C<sup>k</sup> manifolds.\n\nIt is meant to work in conjunction with the categories.",
    "created_at": "2021-12-10T08:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467260",
    "user": "tscrim"
}
```

I am fairly -1 on pushing the full structure into the categories. This was a very conscious design decision in full view of what could be done with categories.

1. It makes it difficult to easily change. Right now, it is trivial if someone wants to promote/demote the structure of a manifold. (You change a parameter and do not have to create an entire new object, which is relatively expensive for manifolds.)
2. It allows for something easy to transfer information across different base rings.
3. It is easy to have extra parameterizations. For example, the classes of C<sup>k</sup> manifolds.

It is meant to work in conjunction with the categories.



---

archive/issue_comments_467261.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n> I am fairly -1 on pushing the full structure into the categories. This was a very conscious design decision in full view of what could be done with categories.\n> \n> 1. It makes it difficult to easily change. Right now, it is trivial if someone wants to promote/demote the structure of a manifold. (You change a parameter and do not have to create an entire new object, which is relatively expensive for manifolds.)\n> 2. It allows for something easy to transfer information across different base rings.\n> 3. It is easy to have extra parameterizations. For example, the classes of C<sup>k</sup> manifolds.\n> \n> It is meant to work in conjunction with the categories.\n\nCan you elaborate on 1, please?\n\nAs for 2, do you have an example where the structure design makes things easier opposed to categories?\n\nI see the point in 3.\n\nNevertheless, we should rethink the design in some way. We have Riemannian manifolds, which are represented by the class `PseudoRiemannianManifold` and carry the structure `RiemannianStructure`. With #30362 we get new structures, namely Poisson/symplectic structures. But now, a manifold can have a Riemannian structure *and* a symplectic structure. Which base class do we use? Which structure? Do we want to combine structures? If so, how? I just see that the category framework already comes with the benefit of joint categories. It might be easier to use that preexisting architecture.",
    "created_at": "2021-12-10T09:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467261",
    "user": "@mjungmath"
}
```

Replying to [comment:6 tscrim]:
> I am fairly -1 on pushing the full structure into the categories. This was a very conscious design decision in full view of what could be done with categories.
> 
> 1. It makes it difficult to easily change. Right now, it is trivial if someone wants to promote/demote the structure of a manifold. (You change a parameter and do not have to create an entire new object, which is relatively expensive for manifolds.)
> 2. It allows for something easy to transfer information across different base rings.
> 3. It is easy to have extra parameterizations. For example, the classes of C<sup>k</sup> manifolds.
> 
> It is meant to work in conjunction with the categories.

Can you elaborate on 1, please?

As for 2, do you have an example where the structure design makes things easier opposed to categories?

I see the point in 3.

Nevertheless, we should rethink the design in some way. We have Riemannian manifolds, which are represented by the class `PseudoRiemannianManifold` and carry the structure `RiemannianStructure`. With #30362 we get new structures, namely Poisson/symplectic structures. But now, a manifold can have a Riemannian structure *and* a symplectic structure. Which base class do we use? Which structure? Do we want to combine structures? If so, how? I just see that the category framework already comes with the benefit of joint categories. It might be easier to use that preexisting architecture.



---

archive/issue_comments_467262.json:
```json
{
    "body": "Replying to [comment:7 gh-mjungmath]:\n> Replying to [comment:6 tscrim]:\n> > I am fairly -1 on pushing the full structure into the categories. This was a very conscious design decision in full view of what could be done with categories.\n> > \n> > 1. It makes it difficult to easily change. Right now, it is trivial if someone wants to promote/demote the structure of a manifold. (You change a parameter and do not have to create an entire new object, which is relatively expensive for manifolds.)\n> > 2. It allows for something easy to transfer information across different base rings.\n> > 3. It is easy to have extra parameterizations. For example, the classes of C<sup>k</sup> manifolds.\n> > \n> > It is meant to work in conjunction with the categories.\n> \n> Can you elaborate on 1, please?\n\nIf you have a manifold `M` with structure `S`, and you realize that it should have structure `T`. This becomes a very simple change of swapping `S` for `T`. In particular, you want to change the smoothness. (Admittedly, I don't think we have a good hook for doing this.)\n\n> As for 2, do you have an example where the structure design makes things easier opposed to categories?\n\nYou want information preserved for manifolds over `CC` and over `RR`. These will lie in different categories. It also gets around not having a clear specification of `RR` (e.g., no dependency on precision or the particular implementation). It is also better to identify information with attributes rather than methods (e.g., the chart class) for speed and readability.\n\n> Nevertheless, we should rethink the design in some way. We have Riemannian manifolds, which are represented by the class `PseudoRiemannianManifold` and carry the structure `RiemannianStructure`. With #30362 we get new structures, namely Poisson/symplectic structures. But now, a manifold can have a Riemannian structure *and* a symplectic structure. Which base class do we use? Which structure? Do we want to combine structures? If so, how? I just see that the category framework already comes with the benefit of joint categories. It might be easier to use that preexisting architecture.\n\nDon't conflate structures and base classes. They are different and serve different roles. Don't try and force a square peg into a round hole. Right now there is not a combinatorial explosion of cases, so we don't need to use a backhoe when all we need is a shovel either. If you need a combined structure, then make a combined structure.",
    "created_at": "2021-12-11T04:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467262",
    "user": "tscrim"
}
```

Replying to [comment:7 gh-mjungmath]:
> Replying to [comment:6 tscrim]:
> > I am fairly -1 on pushing the full structure into the categories. This was a very conscious design decision in full view of what could be done with categories.
> > 
> > 1. It makes it difficult to easily change. Right now, it is trivial if someone wants to promote/demote the structure of a manifold. (You change a parameter and do not have to create an entire new object, which is relatively expensive for manifolds.)
> > 2. It allows for something easy to transfer information across different base rings.
> > 3. It is easy to have extra parameterizations. For example, the classes of C<sup>k</sup> manifolds.
> > 
> > It is meant to work in conjunction with the categories.
> 
> Can you elaborate on 1, please?

If you have a manifold `M` with structure `S`, and you realize that it should have structure `T`. This becomes a very simple change of swapping `S` for `T`. In particular, you want to change the smoothness. (Admittedly, I don't think we have a good hook for doing this.)

> As for 2, do you have an example where the structure design makes things easier opposed to categories?

You want information preserved for manifolds over `CC` and over `RR`. These will lie in different categories. It also gets around not having a clear specification of `RR` (e.g., no dependency on precision or the particular implementation). It is also better to identify information with attributes rather than methods (e.g., the chart class) for speed and readability.

> Nevertheless, we should rethink the design in some way. We have Riemannian manifolds, which are represented by the class `PseudoRiemannianManifold` and carry the structure `RiemannianStructure`. With #30362 we get new structures, namely Poisson/symplectic structures. But now, a manifold can have a Riemannian structure *and* a symplectic structure. Which base class do we use? Which structure? Do we want to combine structures? If so, how? I just see that the category framework already comes with the benefit of joint categories. It might be easier to use that preexisting architecture.

Don't conflate structures and base classes. They are different and serve different roles. Don't try and force a square peg into a round hole. Right now there is not a combinatorial explosion of cases, so we don't need to use a backhoe when all we need is a shovel either. If you need a combined structure, then make a combined structure.



---

archive/issue_comments_467263.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> If you have a manifold `M` with structure `S`, and you realize that it should have structure `T`. This becomes a very simple change of swapping `S` for `T`. In particular, you want to change the smoothness. (Admittedly, I don't think we have a good hook for doing this.)\n\nWhy can't you just swap the category accordingly? As far as I see it, this is the same concept.\n\n> You want information preserved for manifolds over `CC` and over `RR`. These will lie in different categories. It also gets around not having a clear specification of `RR` (e.g., no dependency on precision or the particular implementation). It is also better to identify information with attributes rather than methods (e.g., the chart class) for speed and readability.\n\nThat's a good argument. I think, though, this can easily be circumvented by using a category base class that is not build upon a \"base ring\" structure.\n\n> Don't conflate structures and base classes. They are different and serve different roles. Don't try and force a square peg into a round hole. Right now there is not a combinatorial explosion of cases, so we don't need to use a backhoe when all we need is a shovel either. If you need a combined structure, then make a combined structure.\n\nWell, that is my point. Base classes and structures *are* different, and yet we have a Riemannian manifold base class *and* structure.\n\nThough I'd prefer categories; if we stay with the structure design, I'd feel more comfortable if we'd implement joins of structures. This is far more flexible and robust for future structures. It's getting harder to change the architecture when the \"combinatorial explosion of cases\" is already too high.",
    "created_at": "2021-12-11T08:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467263",
    "user": "@mjungmath"
}
```

Replying to [comment:8 tscrim]:
> If you have a manifold `M` with structure `S`, and you realize that it should have structure `T`. This becomes a very simple change of swapping `S` for `T`. In particular, you want to change the smoothness. (Admittedly, I don't think we have a good hook for doing this.)

Why can't you just swap the category accordingly? As far as I see it, this is the same concept.

> You want information preserved for manifolds over `CC` and over `RR`. These will lie in different categories. It also gets around not having a clear specification of `RR` (e.g., no dependency on precision or the particular implementation). It is also better to identify information with attributes rather than methods (e.g., the chart class) for speed and readability.

That's a good argument. I think, though, this can easily be circumvented by using a category base class that is not build upon a "base ring" structure.

> Don't conflate structures and base classes. They are different and serve different roles. Don't try and force a square peg into a round hole. Right now there is not a combinatorial explosion of cases, so we don't need to use a backhoe when all we need is a shovel either. If you need a combined structure, then make a combined structure.

Well, that is my point. Base classes and structures *are* different, and yet we have a Riemannian manifold base class *and* structure.

Though I'd prefer categories; if we stay with the structure design, I'd feel more comfortable if we'd implement joins of structures. This is far more flexible and robust for future structures. It's getting harder to change the architecture when the "combinatorial explosion of cases" is already too high.



---

archive/issue_comments_467264.json:
```json
{
    "body": "Replying to [comment:9 gh-mjungmath]:\n> Replying to [comment:8 tscrim]:\n> > If you have a manifold `M` with structure `S`, and you realize that it should have structure `T`. This becomes a very simple change of swapping `S` for `T`. In particular, you want to change the smoothness. (Admittedly, I don't think we have a good hook for doing this.)\n> \n> Why can't you just swap the category accordingly? As far as I see it, this is the same concept.\n\nBecause categories are strongly tied to the creation of the object (and its elements) as it creates a dynamic subclass. In fact, strictly speaking, the differentiable structure of a manifold  can give different objects in the category of differentiable manifolds (although we have actually pushed this data into the manifold itself).\n\n> > You want information preserved for manifolds over `CC` and over `RR`. These will lie in different categories. It also gets around not having a clear specification of `RR` (e.g., no dependency on precision or the particular implementation). It is also better to identify information with attributes rather than methods (e.g., the chart class) for speed and readability.\n> \n> That's a good argument. I think, though, this can easily be circumvented by using a category base class that is not build upon a \"base ring\" structure.\n\nCategories carry mathematical information. You cannot separate the base ring.\n\n> > Don't conflate structures and base classes. They are different and serve different roles. Don't try and force a square peg into a round hole. Right now there is not a combinatorial explosion of cases, so we don't need to use a backhoe when all we need is a shovel either. If you need a combined structure, then make a combined structure.\n> \n> Well, that is my point. Base classes and structures *are* different, and yet we have a Riemannian manifold base class *and* structure.\n\nYou cannot get around having a base class when you want extra methods, at least without a performance penalty or monkey-patching. However, it can have a range of structures attached to it.\n\n> Though I'd prefer categories; if we stay with the structure design, I'd feel more comfortable if we'd implement joins of structures. This is far more flexible and robust for future structures. It's getting harder to change the architecture when the \"combinatorial explosion of cases\" is already too high.\n\nThat is a fallacy as good OOP design means you do not care about how the backend is implemented. This sounds like the engineer's paradox: spend 30% more time making something 10% faster.",
    "created_at": "2021-12-11T08:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467264",
    "user": "tscrim"
}
```

Replying to [comment:9 gh-mjungmath]:
> Replying to [comment:8 tscrim]:
> > If you have a manifold `M` with structure `S`, and you realize that it should have structure `T`. This becomes a very simple change of swapping `S` for `T`. In particular, you want to change the smoothness. (Admittedly, I don't think we have a good hook for doing this.)
> 
> Why can't you just swap the category accordingly? As far as I see it, this is the same concept.

Because categories are strongly tied to the creation of the object (and its elements) as it creates a dynamic subclass. In fact, strictly speaking, the differentiable structure of a manifold  can give different objects in the category of differentiable manifolds (although we have actually pushed this data into the manifold itself).

> > You want information preserved for manifolds over `CC` and over `RR`. These will lie in different categories. It also gets around not having a clear specification of `RR` (e.g., no dependency on precision or the particular implementation). It is also better to identify information with attributes rather than methods (e.g., the chart class) for speed and readability.
> 
> That's a good argument. I think, though, this can easily be circumvented by using a category base class that is not build upon a "base ring" structure.

Categories carry mathematical information. You cannot separate the base ring.

> > Don't conflate structures and base classes. They are different and serve different roles. Don't try and force a square peg into a round hole. Right now there is not a combinatorial explosion of cases, so we don't need to use a backhoe when all we need is a shovel either. If you need a combined structure, then make a combined structure.
> 
> Well, that is my point. Base classes and structures *are* different, and yet we have a Riemannian manifold base class *and* structure.

You cannot get around having a base class when you want extra methods, at least without a performance penalty or monkey-patching. However, it can have a range of structures attached to it.

> Though I'd prefer categories; if we stay with the structure design, I'd feel more comfortable if we'd implement joins of structures. This is far more flexible and robust for future structures. It's getting harder to change the architecture when the "combinatorial explosion of cases" is already too high.

That is a fallacy as good OOP design means you do not care about how the backend is implemented. This sounds like the engineer's paradox: spend 30% more time making something 10% faster.



---

archive/issue_comments_467265.json:
```json
{
    "body": "My remark originally was that I find `TopologicalManifold('M')` easier to write and remember than `Manifold('M', structure='topological')`. What about exposing the different classes in `mainfold/all`?\nAt least for a start the initialization code such as\nhttps://github.com/sagemath/sage/blob/develop/src/sage/manifolds/manifold.py#L2960-L2970\nshould go in the corresponding constructor of `Topological(Sub)Manifold` in my opinion so that `Manifold` is really only choosing the proper class to initialize based on the parameters provided. Then one can choose if one prefers to import TopologicalManifold and uses it directly, or is the Manifold constructor.\n\nI cannot really contribute to the category vs structure discussion as I'm not familiar enough with the category framework. (If someone wants to enlighten me: what are the practical consequences of viewing `\\C` as a complex manifold vs as a real manifold?)\nFrom a mathematical perspective, the 'structure' is often easy to define whereas the relevant category may depend on the applications one has in mind (e.g. https://en.wikipedia.org/wiki/Symplectic_category).",
    "created_at": "2021-12-12T16:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467265",
    "user": "@tobiasdiez"
}
```

My remark originally was that I find `TopologicalManifold('M')` easier to write and remember than `Manifold('M', structure='topological')`. What about exposing the different classes in `mainfold/all`?
At least for a start the initialization code such as
https://github.com/sagemath/sage/blob/develop/src/sage/manifolds/manifold.py#L2960-L2970
should go in the corresponding constructor of `Topological(Sub)Manifold` in my opinion so that `Manifold` is really only choosing the proper class to initialize based on the parameters provided. Then one can choose if one prefers to import TopologicalManifold and uses it directly, or is the Manifold constructor.

I cannot really contribute to the category vs structure discussion as I'm not familiar enough with the category framework. (If someone wants to enlighten me: what are the practical consequences of viewing `\C` as a complex manifold vs as a real manifold?)
From a mathematical perspective, the 'structure' is often easy to define whereas the relevant category may depend on the applications one has in mind (e.g. https://en.wikipedia.org/wiki/Symplectic_category).



---

archive/issue_comments_467266.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> I'd rather suggest to look into having certain keyword arguments trigger a choice of structure.\n\nImplemented now\n----\nNew commits:",
    "created_at": "2021-12-12T23:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467266",
    "user": "mkoeppe"
}
```

Replying to [comment:3 mkoeppe]:
> I'd rather suggest to look into having certain keyword arguments trigger a choice of structure.

Implemented now
----
New commits:



---

archive/issue_comments_467267.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-13T00:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467267",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467268.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-13T00:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467268",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467269.json:
```json
{
    "body": "Replying to [comment:11 gh-tobiasdiez]:\n> for a start the initialization code such as\n> https://github.com/sagemath/sage/blob/develop/src/sage/manifolds/manifold.py#L2960-L2970\n> should go in the corresponding constructor of `Topological(Sub)Manifold` in my opinion so that `Manifold` is really only choosing the proper class to initialize based on the parameters provided.\n\nDone",
    "created_at": "2021-12-13T00:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467269",
    "user": "mkoeppe"
}
```

Replying to [comment:11 gh-tobiasdiez]:
> for a start the initialization code such as
> https://github.com/sagemath/sage/blob/develop/src/sage/manifolds/manifold.py#L2960-L2970
> should go in the corresponding constructor of `Topological(Sub)Manifold` in my opinion so that `Manifold` is really only choosing the proper class to initialize based on the parameters provided.

Done



---

archive/issue_comments_467270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-13T00:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467270",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467271.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-13T00:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467271",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_467272.json:
```json
{
    "body": "Replying to [comment:11 gh-tobiasdiez]:\n> My remark originally was that I find `TopologicalManifold('M')` easier to write and remember than `Manifold('M', structure='topological')`. What about exposing the different classes in `mainfold/all`?\n> At least for a start the initialization code such as\n> https://github.com/sagemath/sage/blob/develop/src/sage/manifolds/manifold.py#L2960-L2970\n> should go in the corresponding constructor of `Topological(Sub)Manifold` in my opinion so that `Manifold` is really only choosing the proper class to initialize based on the parameters provided. Then one can choose if one prefers to import TopologicalManifold and uses it directly, or is the Manifold constructor.\n\nI am **very** strong -1 on adding a bunch of things that pollute the global namespace when there is a generic concept (here a \"manifold\") and a global entry point. Not only does it create more imports at startup (even if done lazily, it still means more objects), more maintenance if names change, and more documentation fragmentation (it makes it much easier to decide where to put, e.g., construction information). (If you find it easier, then you can add it to your `init.sage` file.) We also cannot fully move that code to the initialization because at that point it is too late to decide whether or not we are a submanifold (or decide our structure). The safety checks could be moved if desired.",
    "created_at": "2021-12-13T01:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467272",
    "user": "tscrim"
}
```

Replying to [comment:11 gh-tobiasdiez]:
> My remark originally was that I find `TopologicalManifold('M')` easier to write and remember than `Manifold('M', structure='topological')`. What about exposing the different classes in `mainfold/all`?
> At least for a start the initialization code such as
> https://github.com/sagemath/sage/blob/develop/src/sage/manifolds/manifold.py#L2960-L2970
> should go in the corresponding constructor of `Topological(Sub)Manifold` in my opinion so that `Manifold` is really only choosing the proper class to initialize based on the parameters provided. Then one can choose if one prefers to import TopologicalManifold and uses it directly, or is the Manifold constructor.

I am **very** strong -1 on adding a bunch of things that pollute the global namespace when there is a generic concept (here a "manifold") and a global entry point. Not only does it create more imports at startup (even if done lazily, it still means more objects), more maintenance if names change, and more documentation fragmentation (it makes it much easier to decide where to put, e.g., construction information). (If you find it easier, then you can add it to your `init.sage` file.) We also cannot fully move that code to the initialization because at that point it is too late to decide whether or not we are a submanifold (or decide our structure). The safety checks could be moved if desired.



---

archive/issue_comments_467273.json:
```json
{
    "body": "The dispatching based on `ambient` could of course also be done in a `__classcall__` method, but I haven't made this change on the branch.",
    "created_at": "2021-12-13T01:24:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467273",
    "user": "mkoeppe"
}
```

The dispatching based on `ambient` could of course also be done in a `__classcall__` method, but I haven't made this change on the branch.



---

archive/issue_comments_467274.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> \n> I am **very** strong -1 on adding a bunch of things that pollute the global namespace when there is a generic concept (here a \"manifold\") and a global entry point. Not only does it create more imports at startup (even if done lazily, it still means more objects), more maintenance if names change, and more documentation fragmentation (it makes it much easier to decide where to put, e.g., construction information). (If you find it easier, then you can add it to your `init.sage` file.) We also cannot fully move that code to the initialization because at that point it is too late to decide whether or not we are a submanifold (or decide our structure). The safety checks could be moved if desired.\n\nI fully agree with all the above points.",
    "created_at": "2021-12-13T09:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467274",
    "user": "egourgoulhon"
}
```

Replying to [comment:20 tscrim]:
> 
> I am **very** strong -1 on adding a bunch of things that pollute the global namespace when there is a generic concept (here a "manifold") and a global entry point. Not only does it create more imports at startup (even if done lazily, it still means more objects), more maintenance if names change, and more documentation fragmentation (it makes it much easier to decide where to put, e.g., construction information). (If you find it easier, then you can add it to your `init.sage` file.) We also cannot fully move that code to the initialization because at that point it is too late to decide whether or not we are a submanifold (or decide our structure). The safety checks could be moved if desired.

I fully agree with all the above points.



---

archive/issue_comments_467275.json:
```json
{
    "body": "Replying to [comment:20 tscrim]:\n> I am **very** strong -1 on adding a bunch of things that pollute the global namespace when there is a generic concept (here a \"manifold\") and a global entry point. \n\nFair enough!\n\n> We also cannot fully move that code to the initialization because at that point it is too late to decide whether or not we are a submanifold (or decide our structure).\n\nI agree with the submanifold part, but why is it not possible to decide about the structure? It seems to me that the structure of a topological manifold is completely determined by the base field (and similarly for diff manifolds). One could probably even remove the structure constructor argument of `TopologicalManifold`, as its currently only used by the `Manifold` constructor and by subclasses. The latter can also directly set the variable `_structure` as they see fit. Has the advantage to make the whole structure thing an implementation detail that users of the class don't need to care about.",
    "created_at": "2021-12-13T12:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467275",
    "user": "@tobiasdiez"
}
```

Replying to [comment:20 tscrim]:
> I am **very** strong -1 on adding a bunch of things that pollute the global namespace when there is a generic concept (here a "manifold") and a global entry point. 

Fair enough!

> We also cannot fully move that code to the initialization because at that point it is too late to decide whether or not we are a submanifold (or decide our structure).

I agree with the submanifold part, but why is it not possible to decide about the structure? It seems to me that the structure of a topological manifold is completely determined by the base field (and similarly for diff manifolds). One could probably even remove the structure constructor argument of `TopologicalManifold`, as its currently only used by the `Manifold` constructor and by subclasses. The latter can also directly set the variable `_structure` as they see fit. Has the advantage to make the whole structure thing an implementation detail that users of the class don't need to care about.



---

archive/issue_comments_467276.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-21T05:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467276",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_467277.json:
```json
{
    "body": "LGTM.",
    "created_at": "2022-02-21T05:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467277",
    "user": "tscrim"
}
```

LGTM.



---

archive/issue_comments_467278.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-02-21T06:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467278",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_467279.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32764",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32764#issuecomment-467279",
    "user": "vbraun"
}
```

Resolution: fixed
