# Issue 27995: py3: fix doctests in doctest/test

Issue created by migration from https://trac.sagemath.org/ticket/28232

Original creator: @mwageringel

Original creation time: 2019-07-22 23:27:18

This ticket fixes the last Python 3 doctest failure in doctest/test.py.

The problem is that the doctest dispatcher relies on internals of the multiprocessing library, which slightly changed in Python 3; see the [relevant file](https://github.com/python/cpython/blob/3.7/Lib/multiprocessing/process.py#L365). Because of that, until now with Python 3, the master doctest process waits for its children to exit before exiting itself, even though it is not supposed to.

I also adjusted the affected doctest so that it checks for what was initially intended. This got lost when the minimum `die_timeout` of subprocesses got increased from 20 to 60 seconds, but this also means the doctest now lasts 40 seconds longer than before.



---

Comment by @mwageringel created at 2019-07-22 23:35:52

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2019-07-22 23:35:52

New commits:


---

Comment by jhpalmieri created at 2019-07-23 02:26:00

Nice work. Looks good to me.


---

Comment by jhpalmieri created at 2019-07-23 02:26:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-07-29 21:54:22

Resolution: fixed
