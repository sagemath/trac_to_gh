# Issue 22531: sqlite3 module fails to build for Python 2.7.13 on Cygwin

archive/issues_022531.json:
```json
{
    "body": "Python 2.7.13 (updated in #22037) appears to build successfully on Cygwin, but in fact causes failures much later due to the sqlite module failing to link:\n\n```\ngcc -shared -Wl,--enable-auto-image-base -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/connection.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cursor.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/microprotocols.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/module.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/prepare_protocol.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/row.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/statement.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/util.o -L/usr/lib -L/home/embray/src/sagemath/sage-cygwin/local/lib -L/usr/local/lib -L. -L. -lsqlite3 -lpython2.7 -o build/lib.cygwin-2.8.0-x86_64-2.7-pydebug/_sqlite3.dll\nbuild/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.o: In function `pysqlite_new_node':\n/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38: undefined reference to `__imp__Py_RefTotal'\n/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38:(.text+0x3d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `__imp__Py_RefTotal'\n/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38: undefined reference to `__imp__Py_RefTotal'\n/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38:(.text+0x4b): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `__imp__Py_RefTotal'\n```\n\nfollowed by several hundred lines of similar symbol resolution failures.  This only started with 2.7.13, and was not a problem on 2.7.12.\n\nA related issue is the fact that the build is considered successful.  We should figure out how to make it fail if an \"optional\" extension module that we need fails to build.  Not sure yet exactly how to make it do that.\n\nWill investigate what changed between 2.7.12 and 2.7.13 to make the sqlite module build fail.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22768\n\n",
    "created_at": "2017-04-06T15:06:59Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sqlite3 module fails to build for Python 2.7.13 on Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22531",
    "user": "https://github.com/embray"
}
```
Python 2.7.13 (updated in #22037) appears to build successfully on Cygwin, but in fact causes failures much later due to the sqlite module failing to link:

```
gcc -shared -Wl,--enable-auto-image-base -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/connection.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cursor.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/microprotocols.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/module.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/prepare_protocol.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/row.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/statement.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/util.o -L/usr/lib -L/home/embray/src/sagemath/sage-cygwin/local/lib -L/usr/local/lib -L. -L. -lsqlite3 -lpython2.7 -o build/lib.cygwin-2.8.0-x86_64-2.7-pydebug/_sqlite3.dll
build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.o: In function `pysqlite_new_node':
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38: undefined reference to `__imp__Py_RefTotal'
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38:(.text+0x3d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `__imp__Py_RefTotal'
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38: undefined reference to `__imp__Py_RefTotal'
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38:(.text+0x4b): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `__imp__Py_RefTotal'
```

followed by several hundred lines of similar symbol resolution failures.  This only started with 2.7.13, and was not a problem on 2.7.12.

A related issue is the fact that the build is considered successful.  We should figure out how to make it fail if an "optional" extension module that we need fails to build.  Not sure yet exactly how to make it do that.

Will investigate what changed between 2.7.12 and 2.7.13 to make the sqlite module build fail.

Issue created by migration from https://trac.sagemath.org/ticket/22768





---

archive/issue_comments_313692.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2017-04-10T15:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22531#issuecomment-313692",
    "user": "https://github.com/embray"
}
```

Changing priority from major to minor.



---

archive/issue_events_059259.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2017-04-11T12:41:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22531#event-59259"
}
```



---

archive/issue_comments_313693.json:
```json
{
    "body": "This would be good to fix but I don't think it needs to be in the current release mileston.",
    "created_at": "2017-04-11T12:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22531#issuecomment-313693",
    "user": "https://github.com/embray"
}
```

This would be good to fix but I don't think it needs to be in the current release mileston.



---

archive/issue_comments_313694.json:
```json
{
    "body": "outdated, should close",
    "created_at": "2021-09-07T08:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22531#issuecomment-313694",
    "user": "https://github.com/mkoeppe"
}
```

outdated, should close



---

archive/issue_events_059260.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:52:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22531#event-59260"
}
```



---

archive/issue_events_059261.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-07T08:52:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22531#event-59261"
}
```



---

archive/issue_comments_313695.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-07T08:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22531#issuecomment-313695",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.
