# Issue 22531: sqlite3 module fails to build for Python 2.7.13 on Cygwin

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2017-04-06 15:06:59

Python 2.7.13 (updated in #22037) appears to build successfully on Cygwin, but in fact causes failures much later due to the sqlite module failing to link:


```
gcc -shared -Wl,--enable-auto-image-base -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib -L/home/embray/src/sagemath/sage-cygwin/local/lib -Wl,-rpath,/home/embray/src/sagemath/sage-cygwin/local/lib build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/connection.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cursor.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/microprotocols.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/module.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/prepare_protocol.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/row.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/statement.o build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/util.o -L/usr/lib -L/home/embray/src/sagemath/sage-cygwin/local/lib -L/usr/local/lib -L. -L. -lsqlite3 -lpython2.7 -o build/lib.cygwin-2.8.0-x86_64-2.7-pydebug/_sqlite3.dll
build/temp.cygwin-2.8.0-x86_64-2.7-pydebug/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.o: In function `pysqlite_new_node':
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38: undefined reference to `__imp__Py_RefTotal'
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38:(.text+0x3d): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `__imp__Py_RefTotal'
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38: undefined reference to `__imp__Py_RefTotal'
/home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/python2-2.7.13.p0/src/Modules/_sqlite/cache.c:38:(.text+0x4b): relocation truncated to fit: R_X86_64_PC32 against undefined symbol `__imp__Py_RefTotal'
```


followed by several hundred lines of similar symbol resolution failures.  This only started with 2.7.13, and was not a problem on 2.7.12.

A related issue is the fact that the build is considered successful.  We should figure out how to make it fail if an "optional" extension module that we need fails to build.  Not sure yet exactly how to make it do that.

Will investigate what changed between 2.7.12 and 2.7.13 to make the sqlite module build fail.


---

Comment by embray created at 2017-04-10 15:59:52

Changing priority from major to minor.


---

Comment by embray created at 2017-04-11 12:41:13

This would be good to fix but I don't think it needs to be in the current release mileston.


---

Comment by mkoeppe created at 2021-09-07 08:52:17

outdated, should close


---

Comment by mkoeppe created at 2021-09-07 08:52:17

Changing status from new to needs_review.
