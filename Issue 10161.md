# Issue 10161: sage-location: "update" library files the first time this is run

archive/issues_010161.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @nexttime\n\nIf you build Sage but do not run it, then the script sage-location does not get run, so the file sage-location.txt does not get written.  So if you move the Sage install directory before running it, the paths in the files SAGE_ROOT/local/lib/*.la are not correct.  The attached patch updates the paths in those files if the file sage-location.txt does not exist.\n\n(I'm marking this \"minor\" since it's not likely to happen at all frequently.  When it does happen, it can screw things up pretty badly, though.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/10162\n\n",
    "created_at": "2010-10-23T21:14:10Z",
    "labels": [
        "component: build",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "sage-location: \"update\" library files the first time this is run",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10161",
    "user": "https://github.com/jhpalmieri"
}
```
Assignee: GeorgSWeber

CC:  @nexttime

If you build Sage but do not run it, then the script sage-location does not get run, so the file sage-location.txt does not get written.  So if you move the Sage install directory before running it, the paths in the files SAGE_ROOT/local/lib/*.la are not correct.  The attached patch updates the paths in those files if the file sage-location.txt does not exist.

(I'm marking this "minor" since it's not likely to happen at all frequently.  When it does happen, it can screw things up pretty badly, though.)

Issue created by migration from https://trac.sagemath.org/ticket/10162





---

archive/issue_comments_102723.json:
```json
{
    "body": "scripts repo",
    "created_at": "2010-10-23T21:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102723",
    "user": "https://github.com/jhpalmieri"
}
```

scripts repo



---

archive/issue_comments_102724.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-23T21:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102724",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_102725.json:
```json
{
    "body": "Attachment [trac_10162-sage-location.patch](tarball://root/attachments/some-uuid/ticket10162/trac_10162-sage-location.patch) by @jhpalmieri created at 2010-10-23 21:15:14",
    "created_at": "2010-10-23T21:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102725",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_10162-sage-location.patch](tarball://root/attachments/some-uuid/ticket10162/trac_10162-sage-location.patch) by @jhpalmieri created at 2010-10-23 21:15:14



---

archive/issue_comments_102726.json:
```json
{
    "body": "Except that the file's name is `sage-current-location.txt`...\n\nGood catch by the way, I assumed it was an even larger, perhaps OS-related problem.",
    "created_at": "2010-10-23T22:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102726",
    "user": "https://github.com/nexttime"
}
```

Except that the file's name is `sage-current-location.txt`...

Good catch by the way, I assumed it was an even larger, perhaps OS-related problem.



---

archive/issue_comments_102727.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-10-23T22:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102727",
    "user": "https://github.com/nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_102728.json:
```json
{
    "body": "Personal note (or to whom it may concern): ;-)\n\n* Open a follow-up to also improve `sage-sage`:\n  * Check exit code of `sage-location` before running `sage-upgrade`, too.\n  * Call `sage-location` also before running `sage-spkg`.\n  * Trap `SIGINT` while running `sage-location`(?) (such that we end up in a defined state in case it gets interrupted; perhaps requires further modification of `sage-location` as well)\n\n* Open a follow-up to make `sage-location` a bit verbose? (aids debugging)\n\n(I'm happy with **this** ticket as is, therefore further changes like the above should IMHO be made on follow-up tickets.)",
    "created_at": "2010-10-26T23:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102728",
    "user": "https://github.com/nexttime"
}
```

Personal note (or to whom it may concern): ;-)

* Open a follow-up to also improve `sage-sage`:
  * Check exit code of `sage-location` before running `sage-upgrade`, too.
  * Call `sage-location` also before running `sage-spkg`.
  * Trap `SIGINT` while running `sage-location`(?) (such that we end up in a defined state in case it gets interrupted; perhaps requires further modification of `sage-location` as well)

* Open a follow-up to make `sage-location` a bit verbose? (aids debugging)

(I'm happy with **this** ticket as is, therefore further changes like the above should IMHO be made on follow-up tickets.)



---

archive/issue_comments_102729.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-11-01T10:17:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102729",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_102730.json:
```json
{
    "body": "See #10202 for a follow-up (regarding **when** `sage-location` is called [first], and especially patching / \"initializing\" pkg-config's `.pc` files).",
    "created_at": "2010-11-02T17:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10161#issuecomment-102730",
    "user": "https://github.com/nexttime"
}
```

See #10202 for a follow-up (regarding **when** `sage-location` is called [first], and especially patching / "initializing" pkg-config's `.pc` files).
