# Issue 11630: Generation of Lucas sequences modulo an integer

archive/issues_011630.json:
```json
{
    "body": "Assignee: @aghitza\n\nCC:  jpflori @robertwb @zimmermann6\n\nKeywords: Lucas sequence\n\nThe Lucas sequence modulo an integer n is given by `V_k = PV_{k-1} - Q V_{k-2} mod n` with `V_0 = 2 and V_1 = P`. This is not implemented in Sage. There are algorithms `fast_lucas` and `slow_lucas` that compute this sequence only for the special case `Q=1`.\n\n```\nsage: from sage.rings.finite_rings.integer_mod import fast_lucas\nsage: [fast_lucas(i, Mod(8,11)) for i in range(15)]\n[2, 8, 7, 4, 3, 9, 3, 4, 7, 8, 2, 8, 7, 4, 3]\n```\n\n```\nsage: from sage.rings.finite_rings.integer_mod import slow_lucas\nsage: [slow_lucas(i, Mod(8,11)) for i in range(15)]\n[2, 8, 7, 4, 3, 9, 3, 4, 7, 8, 2, 8, 7, 4, 3]\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/11802\n\n",
    "created_at": "2011-09-15T15:43:45Z",
    "labels": [
        "component: basic arithmetic",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Generation of Lucas sequences modulo an integer",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11630",
    "user": "https://trac.sagemath.org/admin/accounts/users/somindu"
}
```
Assignee: @aghitza

CC:  jpflori @robertwb @zimmermann6

Keywords: Lucas sequence

The Lucas sequence modulo an integer n is given by `V_k = PV_{k-1} - Q V_{k-2} mod n` with `V_0 = 2 and V_1 = P`. This is not implemented in Sage. There are algorithms `fast_lucas` and `slow_lucas` that compute this sequence only for the special case `Q=1`.

```
sage: from sage.rings.finite_rings.integer_mod import fast_lucas
sage: [fast_lucas(i, Mod(8,11)) for i in range(15)]
[2, 8, 7, 4, 3, 9, 3, 4, 7, 8, 2, 8, 7, 4, 3]
```

```
sage: from sage.rings.finite_rings.integer_mod import slow_lucas
sage: [slow_lucas(i, Mod(8,11)) for i in range(15)]
[2, 8, 7, 4, 3, 9, 3, 4, 7, 8, 2, 8, 7, 4, 3]
```

Issue created by migration from https://trac.sagemath.org/ticket/11802





---

archive/issue_comments_131231.json:
```json
{
    "body": "Attachment [trac11802.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802.patch) by somindu created at 2011-09-15 15:58:54",
    "created_at": "2011-09-15T15:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131231",
    "user": "https://trac.sagemath.org/admin/accounts/users/somindu"
}
```

Attachment [trac11802.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802.patch) by somindu created at 2011-09-15 15:58:54



---

archive/issue_comments_131232.json:
```json
{
    "body": "Attachment [trac11802-f.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802-f.patch) by somindu created at 2011-09-16 10:01:57\n\nAdd the patches for function `lucas(k,p,q,n)` which generates Lucas sequence V_k mod n (k >= 0) defined by `V_k = PV_{k-1} - QV_{k-2} with V_0 = 2 and V_1 = P`.\n\nTests::\n\n```\n        sage: from sage.rings.finite_rings.integer_mod import lucas\n        sage: p = randint(0,100000)\n        sage: q = randint(0,100000)\n        sage: n = randint(0,100)\n        sage: all([lucas(k,p,q,n)[0] == Mod(lucas_number2(k,p,q),n)\n        ...        for k in Integers(20)])\n        True\n```\n\n```\n        sage: from sage.rings.finite_rings.integer_mod import lucas\n        sage: p = randint(0,100000)\n        sage: q = randint(0,100000)\n        sage: n = randint(0,100)\n        sage: k = randint(0,100)\n        sage: lucas(k,p,q,n) == [Mod(lucas_number2(k,p,q),n),Mod(q^(int(k/2)),n)]\n        True\n```\n\nExamples::\n\n```\n        sage: [lucas(k,4,5,11)[0] for k in range(30)]\n        [2, 4, 6, 4, 8, 1, 8, 5, 2, 5, 10, 4, 10, 9, 8, 9, 7, 5, 7, 3, 10, 3, 6, 9, 6, 1, 7, 1, 2, 3]\n\n        sage: lucas(20,4,5,11)\n        [10, 1]\n```",
    "created_at": "2011-09-16T10:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131232",
    "user": "https://trac.sagemath.org/admin/accounts/users/somindu"
}
```

Attachment [trac11802-f.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802-f.patch) by somindu created at 2011-09-16 10:01:57

Add the patches for function `lucas(k,p,q,n)` which generates Lucas sequence V_k mod n (k >= 0) defined by `V_k = PV_{k-1} - QV_{k-2} with V_0 = 2 and V_1 = P`.

Tests::

```
        sage: from sage.rings.finite_rings.integer_mod import lucas
        sage: p = randint(0,100000)
        sage: q = randint(0,100000)
        sage: n = randint(0,100)
        sage: all([lucas(k,p,q,n)[0] == Mod(lucas_number2(k,p,q),n)
        ...        for k in Integers(20)])
        True
```

```
        sage: from sage.rings.finite_rings.integer_mod import lucas
        sage: p = randint(0,100000)
        sage: q = randint(0,100000)
        sage: n = randint(0,100)
        sage: k = randint(0,100)
        sage: lucas(k,p,q,n) == [Mod(lucas_number2(k,p,q),n),Mod(q^(int(k/2)),n)]
        True
```

Examples::

```
        sage: [lucas(k,4,5,11)[0] for k in range(30)]
        [2, 4, 6, 4, 8, 1, 8, 5, 2, 5, 10, 4, 10, 9, 8, 9, 7, 5, 7, 3, 10, 3, 6, 9, 6, 1, 7, 1, 2, 3]

        sage: lucas(20,4,5,11)
        [10, 1]
```



---

archive/issue_comments_131233.json:
```json
{
    "body": "Changing keywords from \"Lucas sequence\" to \"Lucas sequence ecc2011\".",
    "created_at": "2011-09-16T12:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131233",
    "user": "https://github.com/zimmermann6"
}
```

Changing keywords from "Lucas sequence" to "Lucas sequence ecc2011".



---

archive/issue_comments_131234.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-09-16T12:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131234",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_131235.json:
```json
{
    "body": "The code looks ok to me.\n\nNot sure that we should keep both the code in fast_lucas just for the case Q=1 and lucas function for the generic case.\n\nOf course the specialized version for Q=1 is faster, so it might be a reason to keep it, even if I'm more inclined not to.\n\nI provided two \"reviewer\" patches and if Robert has any preference, let him decide.",
    "created_at": "2011-09-16T13:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131235",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The code looks ok to me.

Not sure that we should keep both the code in fast_lucas just for the case Q=1 and lucas function for the generic case.

Of course the specialized version for Q=1 is faster, so it might be a reason to keep it, even if I'm more inclined not to.

I provided two "reviewer" patches and if Robert has any preference, let him decide.



---

archive/issue_comments_131236.json:
```json
{
    "body": "Attachment [trac11802-reviewer.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802-reviewer.patch) by jpflori created at 2011-09-16 13:08:21\n\nPatch with both functions.",
    "created_at": "2011-09-16T13:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131236",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [trac11802-reviewer.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802-reviewer.patch) by jpflori created at 2011-09-16 13:08:21

Patch with both functions.



---

archive/issue_comments_131237.json:
```json
{
    "body": "Attachment [trac11802-reviewer-cut.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802-reviewer-cut.patch) by jpflori created at 2011-09-16 13:08:52\n\nPatch where fast_lucas is just a wrapper to the new implementation.",
    "created_at": "2011-09-16T13:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131237",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [trac11802-reviewer-cut.patch](tarball://root/attachments/some-uuid/ticket11802/trac11802-reviewer-cut.patch) by jpflori created at 2011-09-16 13:08:52

Patch where fast_lucas is just a wrapper to the new implementation.



---

archive/issue_events_031063.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11630#event-31063"
}
```



---

archive/issue_comments_131238.json:
```json
{
    "body": "Probably needs to be rebased `O_o`\n\nNathann",
    "created_at": "2013-12-26T19:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131238",
    "user": "https://github.com/nathanncohen"
}
```

Probably needs to be rebased `O_o`

Nathann



---

archive/issue_comments_131239.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-26T19:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131239",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_131240.json:
```json
{
    "body": "Sure.\nWhat's your opiinon about comment:4?",
    "created_at": "2013-12-27T09:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131240",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Sure.
What's your opiinon about comment:4?



---

archive/issue_comments_131241.json:
```json
{
    "body": "Well I know absolutely nothing about Lucas number, so I do not know how useful this is when `Q=1` `O_o`\n\nThis being said, it looks like there are two `lucas_*` functions in combinat \n\n```\nsage: sage.combinat.combinat.lucas_number1\n<function sage.combinat.combinat.lucas_number1>\nsage: sage.combinat.combinat.lucas_number2\n<function sage.combinat.combinat.lucas_number2>\n```\nAnd all lucas functions should probably be linked toward each other (with `.. seealso::` sections) if not implemented at the same place. If they do not do the same job already.\n\nPerhaps it would even be better to change the current `lucas_*` functions so that one can compute the numbers themselves, or modulo something depending on the input.\n\nThen again, having `slow_lucas`, `fast_lucas` and `lucas` definitely looks too much. Couldn't all three implementations be available in the same function ? With a flag to decide which one should be used ? All the code could be in the same function by the way..\n\nAnd well. Given that this code is 2yo, perhaps an email should be sent to sage-devel to find guys who know what this code does and review it. 2years is a long time `^^;`\n\nNathann",
    "created_at": "2013-12-27T10:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131241",
    "user": "https://github.com/nathanncohen"
}
```

Well I know absolutely nothing about Lucas number, so I do not know how useful this is when `Q=1` `O_o`

This being said, it looks like there are two `lucas_*` functions in combinat 

```
sage: sage.combinat.combinat.lucas_number1
<function sage.combinat.combinat.lucas_number1>
sage: sage.combinat.combinat.lucas_number2
<function sage.combinat.combinat.lucas_number2>
```
And all lucas functions should probably be linked toward each other (with `.. seealso::` sections) if not implemented at the same place. If they do not do the same job already.

Perhaps it would even be better to change the current `lucas_*` functions so that one can compute the numbers themselves, or modulo something depending on the input.

Then again, having `slow_lucas`, `fast_lucas` and `lucas` definitely looks too much. Couldn't all three implementations be available in the same function ? With a flag to decide which one should be used ? All the code could be in the same function by the way..

And well. Given that this code is 2yo, perhaps an email should be sent to sage-devel to find guys who know what this code does and review it. 2years is a long time `^^;`

Nathann



---

archive/issue_comments_131242.json:
```json
{
    "body": "I more or less know what the code does (and on top of that need it for some computations and quite sure other people could benefit from it), it's just I've been too lazy to refactor since it was originally written by some nice students at ECC 2011.\n\nMaybe Paul would be interested and he surely knows what this is about.",
    "created_at": "2013-12-27T10:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131242",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I more or less know what the code does (and on top of that need it for some computations and quite sure other people could benefit from it), it's just I've been too lazy to refactor since it was originally written by some nice students at ECC 2011.

Maybe Paul would be interested and he surely knows what this is about.



---

archive/issue_comments_131243.json:
```json
{
    "body": "Here's a branch version of this (no rebasing was required) and I fixed up some docstring formatting and deprecated `slow_lucas()` (see below).\n\nCurrently in Sage, `slow_lucas` uses the recursive definition which works for arbitrary integers, whereas the fast `Q=1` and general both only work in modular arithmetic? Although from the code, there doesn't seem to be anything that explicitly uses `n`, so I would (naively) think that this could work for general integers. I haven't tested this; please correct me if I'm wrong. Also I vote to keep the specialized `Q=1` implementation since it is faster.\n\nI've deprecated `slow_lucas` since the more general `BinaryRecurrenceSequence` is faster:\n\n```\nsage: from sage.rings.finite_rings.integer_mod import slow_lucas\nsage: %timeit L = [slow_lucas(k,1,-1) for k in range(20)]\n10 loops, best of 3: 16.4 ms per loop\nsage: %timeit L = [slow_lucas(k,1,-1) for k in range(20)]\n10 loops, best of 3: 16 ms per loop\n\nsage: %timeit B = BinaryRecurrenceSequence(1, 1, 2, 1)\n100000 loops, best of 3: 4.67 us per loop\nsage: B = BinaryRecurrenceSequence(1, 1, 2, 1)\nsage: %timeit LB = [B(k) for k in range(20)]\n1 loops, best of 3: 15.1 ms per loop\nsage: %timeit LB = [B(k) for k in range(20)] # There's caching going on\n100 loops, best of 3: 7.7 ms per loop\n```\n\nBest,\n\nTravis\n\n---\nNew commits:",
    "created_at": "2013-12-27T18:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131243",
    "user": "https://github.com/tscrim"
}
```

Here's a branch version of this (no rebasing was required) and I fixed up some docstring formatting and deprecated `slow_lucas()` (see below).

Currently in Sage, `slow_lucas` uses the recursive definition which works for arbitrary integers, whereas the fast `Q=1` and general both only work in modular arithmetic? Although from the code, there doesn't seem to be anything that explicitly uses `n`, so I would (naively) think that this could work for general integers. I haven't tested this; please correct me if I'm wrong. Also I vote to keep the specialized `Q=1` implementation since it is faster.

I've deprecated `slow_lucas` since the more general `BinaryRecurrenceSequence` is faster:

```
sage: from sage.rings.finite_rings.integer_mod import slow_lucas
sage: %timeit L = [slow_lucas(k,1,-1) for k in range(20)]
10 loops, best of 3: 16.4 ms per loop
sage: %timeit L = [slow_lucas(k,1,-1) for k in range(20)]
10 loops, best of 3: 16 ms per loop

sage: %timeit B = BinaryRecurrenceSequence(1, 1, 2, 1)
100000 loops, best of 3: 4.67 us per loop
sage: B = BinaryRecurrenceSequence(1, 1, 2, 1)
sage: %timeit LB = [B(k) for k in range(20)]
1 loops, best of 3: 15.1 ms per loop
sage: %timeit LB = [B(k) for k in range(20)] # There's caching going on
100 loops, best of 3: 7.7 ms per loop
```

Best,

Travis

---
New commits:



---

archive/issue_comments_131244.json:
```json
{
    "body": "Thanks for the gitification.\n\nI'm mostly happy with the code.\nAnd with Travis changes.\nLet's keep the two fast functions and deprecate the slow one.\nI just think we should rename the fast_lucas function to something like lucas_q1.",
    "created_at": "2013-12-28T20:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131244",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Thanks for the gitification.

I'm mostly happy with the code.
And with Travis changes.
Let's keep the two fast functions and deprecate the slow one.
I just think we should rename the fast_lucas function to something like lucas_q1.



---

archive/issue_comments_131245.json:
```json
{
    "body": "And to answer Travis question, the three functions are only meant for modular integers I think, they live in integer_mod.pyx, though the old one worked for arbirtrary inputs and the math definition completely makes sense.",
    "created_at": "2013-12-28T20:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131245",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

And to answer Travis question, the three functions are only meant for modular integers I think, they live in integer_mod.pyx, though the old one worked for arbirtrary inputs and the math definition completely makes sense.



---

archive/issue_comments_131246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-29T07:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_131247.json:
```json
{
    "body": "Okay, I've renamed the function (and deprecated the old name just incase). Anything else that we should do?",
    "created_at": "2013-12-29T07:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131247",
    "user": "https://github.com/tscrim"
}
```

Okay, I've renamed the function (and deprecated the old name just incase). Anything else that we should do?



---

archive/issue_comments_131248.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2013-12-29T16:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131248",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_131249.json:
```json
{
    "body": "Looks good to me, let's merge it.",
    "created_at": "2013-12-29T16:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131249",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Looks good to me, let's merge it.



---

archive/issue_comments_131250.json:
```json
{
    "body": "> Maybe Paul would be interested and he surely knows what this is about.\n\n\nsorry with the change to git I am unable to figure out what is the diff with respect to Sage 6.0.\nThus I can only give general comments:\n\n1) it makes no sense to have a `slow_lucas` and a `fast_lucas` function. The philosophy in Sage is to use `algorithm='recurrence'` or `algorithm='matrix_exponentiation'` instead (for example).\n\n2) I don't see why the case Q<>1 could not be implemented either by the recurrence or the matrix\nexponentiation.\n\n3) instead of separate functions for ZZ and IntegerModRing(n), it would be nicer to have a single function with an option `ring=ZZ` (default) and `ring=IntegerModRing(15)`.\n\nPaul",
    "created_at": "2014-01-03T09:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131250",
    "user": "https://github.com/zimmermann6"
}
```

> Maybe Paul would be interested and he surely knows what this is about.


sorry with the change to git I am unable to figure out what is the diff with respect to Sage 6.0.
Thus I can only give general comments:

1) it makes no sense to have a `slow_lucas` and a `fast_lucas` function. The philosophy in Sage is to use `algorithm='recurrence'` or `algorithm='matrix_exponentiation'` instead (for example).

2) I don't see why the case Q<>1 could not be implemented either by the recurrence or the matrix
exponentiation.

3) instead of separate functions for ZZ and IntegerModRing(n), it would be nicer to have a single function with an option `ring=ZZ` (default) and `ring=IntegerModRing(15)`.

Paul



---

archive/issue_comments_131251.json:
```json
{
    "body": "Thanks for the suggestions Paul.\nAll of them make sense, ... but note that the code was already structured as it is now witht he fast/slow and Q=1(only for fast)/Q=whatever(only for slow) before this ticket.\nThis ticket mostly provides a fast and general implementation.\nSo I suggest to move the refactoring to a follow up ticket (hopefully one of us will take care of it).\nIf that suits you, I'll open the follow up ticket.",
    "created_at": "2014-01-03T09:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131251",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Thanks for the suggestions Paul.
All of them make sense, ... but note that the code was already structured as it is now witht he fast/slow and Q=1(only for fast)/Q=whatever(only for slow) before this ticket.
This ticket mostly provides a fast and general implementation.
So I suggest to move the refactoring to a follow up ticket (hopefully one of us will take care of it).
If that suits you, I'll open the follow up ticket.



---

archive/issue_comments_131252.json:
```json
{
    "body": "> If that suits you, I'll open the follow up ticket. \n\n\nyes please proceed!\n\nPaul",
    "created_at": "2014-01-03T09:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131252",
    "user": "https://github.com/zimmermann6"
}
```

> If that suits you, I'll open the follow up ticket. 


yes please proceed!

Paul



---

archive/issue_comments_131253.json:
```json
{
    "body": "Replying to [comment:16 zimmerma]:\n> sorry with the change to git I am unable to figure out what is the diff with respect to Sage 6.0.\n\n\nIn trac, you can click on the branch (and wait until all time ends) and see the diff wrt the current beta version (which is the `develop` branch). You can also view the diff from the commits by `git diff <sha1_commit1> <sha1_commit2>`, for example: `git diff \u200b7c11ef2\t\u200bd8c854c` should give you everything that was changed in this ticket.\n\nBest,\n\nTravis",
    "created_at": "2014-01-03T15:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131253",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:16 zimmerma]:
> sorry with the change to git I am unable to figure out what is the diff with respect to Sage 6.0.


In trac, you can click on the branch (and wait until all time ends) and see the diff wrt the current beta version (which is the `develop` branch). You can also view the diff from the commits by `git diff <sha1_commit1> <sha1_commit2>`, for example: `git diff ​7c11ef2	​d8c854c` should give you everything that was changed in this ticket.

Best,

Travis



---

archive/issue_comments_131254.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-05T00:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11630#issuecomment-131254",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_031064.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-01-05T00:32:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11630",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11630#event-31064"
}
```
