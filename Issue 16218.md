# Issue 16218: Update zeromq and pyzmq to recent version and new git layout

archive/issues_016218.json:
```json
{
    "body": "CC:  @seblabbe @vbraun @williamstein @dimpase\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16455\n\n",
    "created_at": "2014-06-07T13:39:25Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Update zeromq and pyzmq to recent version and new git layout",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16218",
    "user": "tmonteil"
}
```
CC:  @seblabbe @vbraun @williamstein @dimpase



Issue created by migration from https://trac.sagemath.org/ticket/16455





---

archive/issue_comments_211923.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-07T14:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211923",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211924.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211924",
    "user": "tmonteil"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_211925.json:
```json
{
    "body": "Sebastien, i modified the patch that could not be applied anymore, please can you check whether this still works on Darwin ?",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211925",
    "user": "tmonteil"
}
```

Sebastien, i modified the patch that could not be applied anymore, please can you check whether this still works on Darwin ?



---

archive/issue_comments_211926.json:
```json
{
    "body": "Changing keywords from \"\" to \"ipython\".",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211926",
    "user": "tmonteil"
}
```

Changing keywords from "" to "ipython".



---

archive/issue_comments_211927.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211927",
    "user": "tmonteil"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_211928.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-07T15:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211928",
    "user": "tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211929.json:
```json
{
    "body": "For what it is worth, I strongly support including IPython notebook (and deps) in Sage standard.  -- William",
    "created_at": "2014-06-07T16:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211929",
    "user": "@williamstein"
}
```

For what it is worth, I strongly support including IPython notebook (and deps) in Sage standard.  -- William



---

archive/issue_comments_211930.json:
```json
{
    "body": "I get this after installing your branch :\n\n\n```\n10 slabbe@pol ~/Applications/sage-review $ ./sage -f http://download.zeromq.org/zeromq-4.0.4.tar.gz\nAttempting to download package zeromq-4.0.4.tar.gz\n>>> Trying to download http://download.zeromq.org/zeromq-4.0.4.tar.gz\n[............................................................]\nzeromq-4.0.4.tar.gz\n====================================================\nExtracting package /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz\n-rw-r--r--  1 slabbe  staff  2149732 Jun 10 08:55 /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz\nFinished extraction\n/Users/slabbe/Applications/sage-review/src/bin/sage-spkg: line 594: cd: zeromq-4.0.4.tar.gz: No such file or directory\nError: after extracting, the directory zeromq-4.0.4.tar.gz does not exist\n```\n",
    "created_at": "2014-06-10T06:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211930",
    "user": "@seblabbe"
}
```

I get this after installing your branch :


```
10 slabbe@pol ~/Applications/sage-review $ ./sage -f http://download.zeromq.org/zeromq-4.0.4.tar.gz
Attempting to download package zeromq-4.0.4.tar.gz
>>> Trying to download http://download.zeromq.org/zeromq-4.0.4.tar.gz
[............................................................]
zeromq-4.0.4.tar.gz
====================================================
Extracting package /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz
-rw-r--r--  1 slabbe  staff  2149732 Jun 10 08:55 /Users/slabbe/Applications/sage-review/upstream/zeromq-4.0.4.tar.gz
Finished extraction
/Users/slabbe/Applications/sage-review/src/bin/sage-spkg: line 594: cd: zeromq-4.0.4.tar.gz: No such file or directory
Error: after extracting, the directory zeromq-4.0.4.tar.gz does not exist
```




---

archive/issue_comments_211931.json:
```json
{
    "body": "The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.",
    "created_at": "2014-06-10T09:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211931",
    "user": "tmonteil"
}
```

The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.



---

archive/issue_comments_211932.json:
```json
{
    "body": "Replying to [comment:7 tmonteil]:\n> The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.\n\nBut the above put the tarball in the upstream directory. So that means I can do :\n\n\n```\n./sage -i http://download.zeromq.org/zeromq-4.0.4.tar.gz   # download in upstream\n./sage -i zeromq\n```\n",
    "created_at": "2014-06-10T09:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211932",
    "user": "@seblabbe"
}
```

Replying to [comment:7 tmonteil]:
> The tarball you found at `http://download.zeromq.org/zeromq-4.0.4.tar.gz` is not a sage package, it is the source code of zeromq. You have to put this tarball on your `/Users/slabbe/Applications/sage-review/upstream/` directory, and then do `./sage -f zeromq`.

But the above put the tarball in the upstream directory. So that means I can do :


```
./sage -i http://download.zeromq.org/zeromq-4.0.4.tar.gz   # download in upstream
./sage -i zeromq
```




---

archive/issue_comments_211933.json:
```json
{
    "body": "The first command will lead to an error, since it not only tries to download the tarball in upstream/, but also tries to install it as a sage spkg, explaining your error, hence you should consider using wget ot curl for that part of the review. Of course, once the ticket is merged, there is no need to download the tarball manually since sage will find it at http://sagemath.org/packages/upstream/\n\nThat said, after that error, the second command should work, since zeromq-4.0.4.tar.gz is now in the upstream/ directory.",
    "created_at": "2014-06-10T09:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211933",
    "user": "tmonteil"
}
```

The first command will lead to an error, since it not only tries to download the tarball in upstream/, but also tries to install it as a sage spkg, explaining your error, hence you should consider using wget ot curl for that part of the review. Of course, once the ticket is merged, there is no need to download the tarball manually since sage will find it at http://sagemath.org/packages/upstream/

That said, after that error, the second command should work, since zeromq-4.0.4.tar.gz is now in the upstream/ directory.



---

archive/issue_comments_211934.json:
```json
{
    "body": "Ok, so I just tested and it does work on my machine. I also managed to open the ipython notebook with these.\n\nI also tested without the buildutils patch on pyzmq, and `sage -i pyzmq` also worked. Indeed, I remembered I read somewhere (maybe on sage-devel) that my patch was now useless since the problem was fixed in a later release... I tried to find where I read that, but I was not able.",
    "created_at": "2014-06-10T09:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211934",
    "user": "@seblabbe"
}
```

Ok, so I just tested and it does work on my machine. I also managed to open the ipython notebook with these.

I also tested without the buildutils patch on pyzmq, and `sage -i pyzmq` also worked. Indeed, I remembered I read somewhere (maybe on sage-devel) that my patch was now useless since the problem was fixed in a later release... I tried to find where I read that, but I was not able.



---

archive/issue_comments_211935.json:
```json
{
    "body": "OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.",
    "created_at": "2014-06-10T09:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211935",
    "user": "tmonteil"
}
```

OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.



---

archive/issue_comments_211936.json:
```json
{
    "body": "With the following modifications:\n\n\n```\n~/Applications/sage-review $ git diff\ndiff --git a/build/pkgs/pyzmq/spkg-install b/build/pkgs/pyzmq/spkg-install\nindex c7e1216..269f055 100755\n--- a/build/pkgs/pyzmq/spkg-install\n+++ b/build/pkgs/pyzmq/spkg-install\n@@ -13,16 +13,6 @@ echo \"include_dirs = $SAGE_LOCAL/include/\" >> src/setup.cfg\n \n cd src\n \n-# Apply patches.  See SPKG.txt for information about what each patch\n-# does.\n-for patch in ../patches/*.patch; do\n-    patch -p1 <\"$patch\"\n-    if [ $? -ne 0 ]; then\n-        echo >&2 \"Error applying '$patch'\"\n-        exit 1\n-    fi\n-done\n-\n # Configure and install\n python setup.py configure --zmq=\"$SAGE_LOCAL\"\n python setup.py install\n```\n\n\nI confirm that it works:\n\n\n```\n./sage -f pyzmq\nFound local metadata for pyzmq-14.3.0\n\n[...]\n\nSuccessfully installed pyzmq-14.3.0\nDeleting temporary build directory\nFinished installing pyzmq-14.3.0.spkg\n```\n",
    "created_at": "2014-06-10T09:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211936",
    "user": "@seblabbe"
}
```

With the following modifications:


```
~/Applications/sage-review $ git diff
diff --git a/build/pkgs/pyzmq/spkg-install b/build/pkgs/pyzmq/spkg-install
index c7e1216..269f055 100755
--- a/build/pkgs/pyzmq/spkg-install
+++ b/build/pkgs/pyzmq/spkg-install
@@ -13,16 +13,6 @@ echo "include_dirs = $SAGE_LOCAL/include/" >> src/setup.cfg
 
 cd src
 
-# Apply patches.  See SPKG.txt for information about what each patch
-# does.
-for patch in ../patches/*.patch; do
-    patch -p1 <"$patch"
-    if [ $? -ne 0 ]; then
-        echo >&2 "Error applying '$patch'"
-        exit 1
-    fi
-done
-
 # Configure and install
 python setup.py configure --zmq="$SAGE_LOCAL"
 python setup.py install
```


I confirm that it works:


```
./sage -f pyzmq
Found local metadata for pyzmq-14.3.0

[...]

Successfully installed pyzmq-14.3.0
Deleting temporary build directory
Finished installing pyzmq-14.3.0.spkg
```




---

archive/issue_comments_211937.json:
```json
{
    "body": "remove the patch for pyzmq",
    "created_at": "2014-06-10T09:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211937",
    "user": "@seblabbe"
}
```

remove the patch for pyzmq



---

archive/issue_comments_211938.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-10T09:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211938",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_211939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-10T10:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211940.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-10T10:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211940",
    "user": "tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_211941.json:
```json
{
    "body": "One question before giving a positive review. Can the spkg-install of pyzmq check that zeromq spkg was installed before? But maybe it is not a good idea, and it is better to let the installation breaks by itself....",
    "created_at": "2014-06-10T12:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211941",
    "user": "@seblabbe"
}
```

One question before giving a positive review. Can the spkg-install of pyzmq check that zeromq spkg was installed before? But maybe it is not a good idea, and it is better to let the installation breaks by itself....



---

archive/issue_comments_211942.json:
```json
{
    "body": "Changing component from packages: standard to packages: optional.",
    "created_at": "2014-06-10T13:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211942",
    "user": "tmonteil"
}
```

Changing component from packages: standard to packages: optional.



---

archive/issue_comments_211943.json:
```json
{
    "body": "To my understanding, the dependencies are set via the `build/deps` file, but it seems to be reserved to standard packages only. Volker, is this correct ?\n\nThat said, since those packages are optional for more than one year and many people want them to become standard, i plan to make a ticket for that.",
    "created_at": "2014-06-10T13:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211943",
    "user": "tmonteil"
}
```

To my understanding, the dependencies are set via the `build/deps` file, but it seems to be reserved to standard packages only. Volker, is this correct ?

That said, since those packages are optional for more than one year and many people want them to become standard, i plan to make a ticket for that.



---

archive/issue_comments_211944.json:
```json
{
    "body": "We don't have a dependency mechanism for optional packaeges yet. But please don't roll your own just for zeromq...",
    "created_at": "2014-06-10T13:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211944",
    "user": "@vbraun"
}
```

We don't have a dependency mechanism for optional packaeges yet. But please don't roll your own just for zeromq...



---

archive/issue_comments_211945.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-10T15:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211945",
    "user": "@seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211946.json:
```json
{
    "body": "Some optional packages do some dependency checking in their spkg-install, for example the p_group_cohomology package does this:\n\n```sh\nSMALL_GROUPS=`echo \"SmallGroup(13,1); quit;\" | gap -b -T | grep \"13\"`\nif [ \"$SMALL_GROUPS\" = \"\" ]; then\n   echo \"It seems that GAP's SmallGroups library is missing.\"\n   echo \"One way to install it is by doing\"\n   echo \"    sage: install_package('database_gap')\"\n   echo \"in a Sage session.\"\n   exit 1\nfi\n```\n\nWill installation of pyzmq fail gracefully if zeromq is missing, or is it better to have a check like this?",
    "created_at": "2014-06-10T17:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211946",
    "user": "@jhpalmieri"
}
```

Some optional packages do some dependency checking in their spkg-install, for example the p_group_cohomology package does this:

```sh
SMALL_GROUPS=`echo "SmallGroup(13,1); quit;" | gap -b -T | grep "13"`
if [ "$SMALL_GROUPS" = "" ]; then
   echo "It seems that GAP's SmallGroups library is missing."
   echo "One way to install it is by doing"
   echo "    sage: install_package('database_gap')"
   echo "in a Sage session."
   exit 1
fi
```

Will installation of pyzmq fail gracefully if zeromq is missing, or is it better to have a check like this?



---

archive/issue_comments_211947.json:
```json
{
    "body": "someone installing pyzmq before zeromq will get something like :\n\n\n```\n******************************************\nConfigure: Autodetecting ZMQ settings...\n    Custom ZMQ dir:       /Users/slabbe/Applications/sage-git/local\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/slabbe/Applications/sage-git/local/include -Izmq/utils -Izmq/core -Izmq/devices -c detect/vers.c -o detect/vers.o\ndetect/vers.c:3:17: fatal error: zmq.h: No such file or directory\ncompilation terminated.\nFatal: \n    Failed to compile ZMQ test program.  Please check to make sure:\n\n    * You have a C compiler installed\n    * A development version of Python is installed (including header files)\n    * A development version of ZMQ >= 2.1.4 is installed (including header files)\n    * If ZMQ is not in a default location, supply the argument --zmq=<path>\n    * If you did recently install ZMQ to a default location, \n      try rebuilding the ld cache with `sudo ldconfig`\n      or specify zmq's location with `--zmq=/usr/local`\n    \nerror: command 'gcc' failed with exit status 1\n******************************************\n\nreal\t0m0.622s\nuser\t0m0.259s\nsys\t0m0.335s\n************************************************************************\nError installing package pyzmq-2.1.11.p1\n************************************************************************\n```\n",
    "created_at": "2014-06-10T18:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211947",
    "user": "@seblabbe"
}
```

someone installing pyzmq before zeromq will get something like :


```
******************************************
Configure: Autodetecting ZMQ settings...
    Custom ZMQ dir:       /Users/slabbe/Applications/sage-git/local
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I/Users/slabbe/Applications/sage-git/local/include -Izmq/utils -Izmq/core -Izmq/devices -c detect/vers.c -o detect/vers.o
detect/vers.c:3:17: fatal error: zmq.h: No such file or directory
compilation terminated.
Fatal: 
    Failed to compile ZMQ test program.  Please check to make sure:

    * You have a C compiler installed
    * A development version of Python is installed (including header files)
    * A development version of ZMQ >= 2.1.4 is installed (including header files)
    * If ZMQ is not in a default location, supply the argument --zmq=<path>
    * If you did recently install ZMQ to a default location, 
      try rebuilding the ld cache with `sudo ldconfig`
      or specify zmq's location with `--zmq=/usr/local`
    
error: command 'gcc' failed with exit status 1
******************************************

real	0m0.622s
user	0m0.259s
sys	0m0.335s
************************************************************************
Error installing package pyzmq-2.1.11.p1
************************************************************************
```




---

archive/issue_comments_211948.json:
```json
{
    "body": "Anyway, these two packages are aimed to become standard soon if I understand correctly, so their dependencies will be set via the `build/deps` as mentionned before. So I believe it OK like that without any dependency checking.",
    "created_at": "2014-06-10T18:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211948",
    "user": "@seblabbe"
}
```

Anyway, these two packages are aimed to become standard soon if I understand correctly, so their dependencies will be set via the `build/deps` as mentionned before. So I believe it OK like that without any dependency checking.



---

archive/issue_comments_211949.json:
```json
{
    "body": "delete invisible space",
    "created_at": "2014-06-17T19:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211949",
    "user": "@vbraun"
}
```

delete invisible space



---

archive/issue_comments_211950.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-18T12:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211950",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_211951.json:
```json
{
    "body": "> OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.\n\nWho confirmed that this was useless?  This will still not work on older Macs - see the **actual note that was in the SPKG.txt**!!!\n\n```\n   - patches/buildutils.patch: This patches the file src/buildutils/detect.py.\n     It remove the option -arch for gcc which was broken on MacOSX 10.5.8.\n     The reason to this is that Sage's gcc spkg does not build a compiler\n     which understands the option -arch of Apple's clone of gcc.\n     https://groups.google.com/forum/?fromgroups#!topic/sage-devel/CuZNKclprIQ\n     http://trac.sagemath.org/sage_trac/ticket/13313\n```\n\nAnd now that this is standard with all the big changes at the end of 6.4, it breaks some of them.  And since the machine I am currently trying to build Sage on does not have git, nor has git built yet, I will have to type this entire patch in BY HAND, or nearly so.",
    "created_at": "2014-12-13T23:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211951",
    "user": "@kcrisman"
}
```

> OK, once you confirm that the patch is not needed anymore, i will remove it from the branch.

Who confirmed that this was useless?  This will still not work on older Macs - see the **actual note that was in the SPKG.txt**!!!

```
   - patches/buildutils.patch: This patches the file src/buildutils/detect.py.
     It remove the option -arch for gcc which was broken on MacOSX 10.5.8.
     The reason to this is that Sage's gcc spkg does not build a compiler
     which understands the option -arch of Apple's clone of gcc.
     https://groups.google.com/forum/?fromgroups#!topic/sage-devel/CuZNKclprIQ
     http://trac.sagemath.org/sage_trac/ticket/13313
```

And now that this is standard with all the big changes at the end of 6.4, it breaks some of them.  And since the machine I am currently trying to build Sage on does not have git, nor has git built yet, I will have to type this entire patch in BY HAND, or nearly so.



---

archive/issue_comments_211952.json:
```json
{
    "body": "> Who confirmed that this was useless?\n\nMe. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.\n\nI am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.\n\nS\u00e9bastien",
    "created_at": "2014-12-15T14:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211952",
    "user": "@seblabbe"
}
```

> Who confirmed that this was useless?

Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.

I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.

SÃ©bastien



---

archive/issue_comments_211953.json:
```json
{
    "body": "> Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.\nOh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.\n> I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.\nI apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.\n\nI think that the question is in when they add these flags.  What do you get for\n\n```\nimport platform\nplatform.architecture()\n```\n\non my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer? In principle if you don't have the patch but you get `if platform.architecture()[0]=='32bit':` then you should be getting the bad Apple-gcc-only flags.",
    "created_at": "2014-12-15T14:53:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211953",
    "user": "@kcrisman"
}
```

> Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.
Oh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.
> I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.
I apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.

I think that the question is in when they add these flags.  What do you get for

```
import platform
platform.architecture()
```

on my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer? In principle if you don't have the patch but you get `if platform.architecture()[0]=='32bit':` then you should be getting the bad Apple-gcc-only flags.



---

archive/issue_comments_211954.json:
```json
{
    "body": "`@`kcrisman: I pinged Sebastien on that ticket because he was the author of the patch and i have no mac to test. If there is some problem with some particular version of OSX, i think this is worth opening a new ticket for that issue now, or the information you will provide on the current thread will be less visible there.",
    "created_at": "2014-12-15T15:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211954",
    "user": "tmonteil"
}
```

`@`kcrisman: I pinged Sebastien on that ticket because he was the author of the patch and i have no mac to test. If there is some problem with some particular version of OSX, i think this is worth opening a new ticket for that issue now, or the information you will provide on the current thread will be less visible there.



---

archive/issue_comments_211955.json:
```json
{
    "body": "Naturally, just wanting to confirm before opening a new ticket.  See #17510.",
    "created_at": "2014-12-15T15:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211955",
    "user": "@kcrisman"
}
```

Naturally, just wanting to confirm before opening a new ticket.  See #17510.



---

archive/issue_comments_211956.json:
```json
{
    "body": "No problem. I should have thought of adding you in cc of this ticket by the time of the review, since I remember that #13313 was also useful for you.",
    "created_at": "2014-12-15T16:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211956",
    "user": "@seblabbe"
}
```

No problem. I should have thought of adding you in cc of this ticket by the time of the review, since I remember that #13313 was also useful for you.



---

archive/issue_comments_211957.json:
```json
{
    "body": "Replying to [comment:27 kcrisman]:\n> > Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.\n> Oh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.\n> > I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.\n> I apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.\n> \n> I think that the question is in when they add these flags.  What do you get for\n> {{{\n> import platform\n> platform.architecture()\n> }}}\n> on my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer?\n\nWhen I reported that (cf the link to sage-devel in #13313) I tried that on an PPC OSX 10.5.8 machine, which is 32-bit all the way. I don't think I did build anything with SAGE64.",
    "created_at": "2014-12-15T21:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16218#issuecomment-211957",
    "user": "@dimpase"
}
```

Replying to [comment:27 kcrisman]:
> > Me. My machine is a MacOSX 10.5.8. I have read that note in the SPKG. When I did the review, I confirmed that the patch was needed with the earlier spkg but not with the new one which I gave a positive review.
> Oh!  And indeed if I had been more careful I would have seen that you were responsible for #13313 and so knew what you were talking about.
> > I am sorry for having cause you trouble today. Maybe we should add more documentation in the patch to re-add saying for what machine exactly it is mandatory. Because to me, it is not needed for 10.5.8 anymore.
> I apologize also, because I was snippy in my comment.  I had left the machine compiling all night, only to discover this (relatively early) error.
> 
> I think that the question is in when they add these flags.  What do you get for
> {{{
> import platform
> platform.architecture()
> }}}
> on my Lion computer (10.7) I get `('64bit', '')`.  I will see what I get on my other one.  My guess is that probably Dima's machine was already building a 64-bit Python (see e.g. [the SAGE64 flag](http://www.sagemath.org/doc/installation/source.html)), and that in the meantime maybe your 10.5 computer also is doing that, maybe we are building Python 64-bit by default or you are using `SAGE64='yes'` all the time on that computer?

When I reported that (cf the link to sage-devel in #13313) I tried that on an PPC OSX 10.5.8 machine, which is 32-bit all the way. I don't think I did build anything with SAGE64.
