# Issue 20687: Error in plot - force use of aspect ratio

archive/issues_020687.json:
```json
{
    "body": "CC:  @kcrisman @egunawan @tscrim @alauve @paulmasson\n\nIt seems as though when using plot() we are forced to have an aspect ratio of automatic whether we want that or not. Example:\n\nIf we define a class\n\n```\nclass something:\n    def plot(self):\n        G = Graphics()\n        G.set_aspect_ratio(1)\n        return G\n```\n\n\nwhen we do something.plot() the aspect ratio is correctly set to 1. But when we do plot(something) the aspect ratio gets converted to automatic. This is due to the native way that plot is handled:\n\nfile: src/sage/plot/plot.py\n\n```\n@options(alpha=1, thickness=1, fill=False, fillcolor='automatic', fillalpha=0.5, rgbcolor=(0,0,1), plot_points=200, adaptive_tolerance=0.01, adaptive_recursion=5, detect_poles = False, exclude = None, legend_label=None, __original_opts=True, aspect_ratio='automatic')\ndef plot(funcs, *args, **kwds):\n      G_kwds = Graphics._extract_kwds_for_show(kwds, ignore=['xmin', 'xmax'])\n  \n      original_opts = kwds.pop('__original_opts', {})\n      do_show = kwds.pop('show',False)\n  \n      from sage.structure.element import is_Vector\n      if kwds.get('parametric',False) and is_Vector(funcs):\n          funcs = tuple(funcs)\n  \n  \n      if hasattr(funcs, 'plot'):\n          G = funcs.plot(*args, **original_opts)\n      # if we are using the generic plotting method\n      else:\n          # Other things - deleted for clarity\n  \n      G._set_extra_kwds(G_kwds)\n      if do_show:\n          G.show()\n      return G\n```\n\n\nNotice how the last option in `@`options is aspect_ratio='automatic'. The reason that this is the only one with an issue is the comination of Graphics._extract_kwds_for_show and G._set_extra_kwds.\n\nWhen using Graphics._extract_kwds_for_show we are doing the following:\nfile: src/sage/plot/graphics.py\n\n```\n    SHOW_OPTIONS = dict(# axes options\n                        axes=None, axes_labels=None, axes_labels_size=None,\n                        axes_pad=None, base=None, scale=None,\n                        xmin=None, xmax=None, ymin=None, ymax=None,\n                        # Figure options\n                        aspect_ratio=None, dpi=DEFAULT_DPI, fig_tight=True,\n                        figsize=None, fontsize=None, frame=False,\n                        title=None, title_pos=None, transparent=False,\n                        # Grid options\n                        gridlines=None, gridlinesstyle=None,\n                        hgridlinesstyle=None, vgridlinesstyle=None,\n                        # Legend options\n                        legend_options={}, show_legend=None,\n                        # Ticks options\n                        ticks=None, tick_formatter=None, ticks_integer=False,\n                        # Text options\n                        typeset='default')\n\n    def _extract_kwds_for_show(cls, kwds, ignore=[]):\n        result = {} \n        for option in cls.SHOW_OPTIONS:\n            if option not in ignore:\n                try:\n                    result[option] = kwds.pop(option)\n                except KeyError:\n                    pass\n        return result\n```\n\n\nAs you can see, we always grab these additional kwds, in particular we grab the 'aspect_ratio' kwd. This means that when G._set_extra_kwds gets called, the aspect ratio is changing AFTER we have already set it in our something.plot() method.\n\nIt seems as though this is not working as expected and/or there is some non-intuitive way to get around this issue.\n\nRecommendations:\n- We should only be doing _set_extra_kwds if we are NOT using the plot method of an object\n- Or we should have some way to override this property so that if we are setting an aspect ratio, then it does not get forcibly overwritten as is happening now.\n\n\nI'm thinking of doing the second one, where I do something of the following nature:\n\n\n```\n      if hasattr(funcs, 'plot'):\n          G = funcs.plot(*args, **original_opts)\n          for ext in G._extra_kwds \n              if ext in G_kwds:\n                   delete G_kwds[ext]\n```\n\n\nLike this, if we are ever setting something beforehand, we are not unintentionally removing it as we are now.\nThoughts would be beneficial on this ticket as plot is a fairly common tool that is used in multiple places and so I don't want to alter something that might break other things especially if there does actually exist something that would get around this issue that I don't know about and/or if someone has a different idea of how to approach it.\n\nThank you.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20924\n\n",
    "created_at": "2016-07-02T17:41:51Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Error in plot - force use of aspect ratio",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20687",
    "user": "https://github.com/thecaligarmo"
}
```
CC:  @kcrisman @egunawan @tscrim @alauve @paulmasson

It seems as though when using plot() we are forced to have an aspect ratio of automatic whether we want that or not. Example:

If we define a class

```
class something:
    def plot(self):
        G = Graphics()
        G.set_aspect_ratio(1)
        return G
```


when we do something.plot() the aspect ratio is correctly set to 1. But when we do plot(something) the aspect ratio gets converted to automatic. This is due to the native way that plot is handled:

file: src/sage/plot/plot.py

```
@options(alpha=1, thickness=1, fill=False, fillcolor='automatic', fillalpha=0.5, rgbcolor=(0,0,1), plot_points=200, adaptive_tolerance=0.01, adaptive_recursion=5, detect_poles = False, exclude = None, legend_label=None, __original_opts=True, aspect_ratio='automatic')
def plot(funcs, *args, **kwds):
      G_kwds = Graphics._extract_kwds_for_show(kwds, ignore=['xmin', 'xmax'])
  
      original_opts = kwds.pop('__original_opts', {})
      do_show = kwds.pop('show',False)
  
      from sage.structure.element import is_Vector
      if kwds.get('parametric',False) and is_Vector(funcs):
          funcs = tuple(funcs)
  
  
      if hasattr(funcs, 'plot'):
          G = funcs.plot(*args, **original_opts)
      # if we are using the generic plotting method
      else:
          # Other things - deleted for clarity
  
      G._set_extra_kwds(G_kwds)
      if do_show:
          G.show()
      return G
```


Notice how the last option in `@`options is aspect_ratio='automatic'. The reason that this is the only one with an issue is the comination of Graphics._extract_kwds_for_show and G._set_extra_kwds.

When using Graphics._extract_kwds_for_show we are doing the following:
file: src/sage/plot/graphics.py

```
    SHOW_OPTIONS = dict(# axes options
                        axes=None, axes_labels=None, axes_labels_size=None,
                        axes_pad=None, base=None, scale=None,
                        xmin=None, xmax=None, ymin=None, ymax=None,
                        # Figure options
                        aspect_ratio=None, dpi=DEFAULT_DPI, fig_tight=True,
                        figsize=None, fontsize=None, frame=False,
                        title=None, title_pos=None, transparent=False,
                        # Grid options
                        gridlines=None, gridlinesstyle=None,
                        hgridlinesstyle=None, vgridlinesstyle=None,
                        # Legend options
                        legend_options={}, show_legend=None,
                        # Ticks options
                        ticks=None, tick_formatter=None, ticks_integer=False,
                        # Text options
                        typeset='default')

    def _extract_kwds_for_show(cls, kwds, ignore=[]):
        result = {} 
        for option in cls.SHOW_OPTIONS:
            if option not in ignore:
                try:
                    result[option] = kwds.pop(option)
                except KeyError:
                    pass
        return result
```


As you can see, we always grab these additional kwds, in particular we grab the 'aspect_ratio' kwd. This means that when G._set_extra_kwds gets called, the aspect ratio is changing AFTER we have already set it in our something.plot() method.

It seems as though this is not working as expected and/or there is some non-intuitive way to get around this issue.

Recommendations:
- We should only be doing _set_extra_kwds if we are NOT using the plot method of an object
- Or we should have some way to override this property so that if we are setting an aspect ratio, then it does not get forcibly overwritten as is happening now.


I'm thinking of doing the second one, where I do something of the following nature:


```
      if hasattr(funcs, 'plot'):
          G = funcs.plot(*args, **original_opts)
          for ext in G._extra_kwds 
              if ext in G_kwds:
                   delete G_kwds[ext]
```


Like this, if we are ever setting something beforehand, we are not unintentionally removing it as we are now.
Thoughts would be beneficial on this ticket as plot is a fairly common tool that is used in multiple places and so I don't want to alter something that might break other things especially if there does actually exist something that would get around this issue that I don't know about and/or if someone has a different idea of how to approach it.

Thank you.

Issue created by migration from https://trac.sagemath.org/ticket/20924





---

archive/issue_comments_285490.json:
```json
{
    "body": "Here's a minimal example of this behavior:\n\n```\nsage: G = graphs.PetersenGraph()\nsage: p = G.plot()\nsage: p.aspect_ratio()\n1.0\nsage: pp = plot(G)\nsage: pp.aspect_ratio()\n'automatic'\n```\n\nAlthough the `plot` for graph seems to have some other issues in that it ignores, e.g., `aspect_ratio`.",
    "created_at": "2016-07-02T18:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285490",
    "user": "https://github.com/tscrim"
}
```

Here's a minimal example of this behavior:

```
sage: G = graphs.PetersenGraph()
sage: p = G.plot()
sage: p.aspect_ratio()
1.0
sage: pp = plot(G)
sage: pp.aspect_ratio()
'automatic'
```

Although the `plot` for graph seems to have some other issues in that it ignores, e.g., `aspect_ratio`.



---

archive/issue_comments_285491.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-15T20:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285491",
    "user": "https://github.com/thecaligarmo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285492.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-08-15T20:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285492",
    "user": "https://github.com/thecaligarmo"
}
```

New commits:



---

archive/issue_comments_285493.json:
```json
{
    "body": "You will need to add your (real) name to the authors' fields, and I think you should add a doctest showing the behavior has changed by looking at the `aspect_ratio` of a plot (say, the MWE (minimal working example) above).",
    "created_at": "2016-08-15T22:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285493",
    "user": "https://github.com/tscrim"
}
```

You will need to add your (real) name to the authors' fields, and I think you should add a doctest showing the behavior has changed by looking at the `aspect_ratio` of a plot (say, the MWE (minimal working example) above).



---

archive/issue_comments_285494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-18T14:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285495.json:
```json
{
    "body": "I've gone ahead and merged with the latest develop, as well as added the doctest.",
    "created_at": "2016-08-18T14:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285495",
    "user": "https://github.com/thecaligarmo"
}
```

I've gone ahead and merged with the latest develop, as well as added the doctest.



---

archive/issue_comments_285496.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-18T20:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285496",
    "user": "https://github.com/paulmasson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285497.json:
```json
{
    "body": "This is a nice clean way to preserve keywords. Works as expected for objects with plot methods.\n\nDoctests pass and documentation builds. Looks good to me unless Travis has something else to add.",
    "created_at": "2016-08-18T20:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285497",
    "user": "https://github.com/paulmasson"
}
```

This is a nice clean way to preserve keywords. Works as expected for objects with plot methods.

Doctests pass and documentation builds. Looks good to me unless Travis has something else to add.



---

archive/issue_comments_285498.json:
```json
{
    "body": "grammar: \"If we already have certain items already set,\"  --> delete the first \"already\"\n\nzap whitespace: I notice one line with lots of extra space characters on it. perhaps there are more.",
    "created_at": "2016-08-18T20:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285498",
    "user": "https://github.com/alauve"
}
```

grammar: "If we already have certain items already set,"  --> delete the first "already"

zap whitespace: I notice one line with lots of extra space characters on it. perhaps there are more.



---

archive/issue_comments_285499.json:
```json
{
    "body": "Positive review from me when everyone else is ready.",
    "created_at": "2016-08-18T21:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285499",
    "user": "https://github.com/paulmasson"
}
```

Positive review from me when everyone else is ready.



---

archive/issue_comments_285500.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2016-08-18T21:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285500",
    "user": "https://github.com/paulmasson"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_285501.json:
```json
{
    "body": "`@`aram.dermenjian Thank you\n\nOne other small nitpick: It would be good to also replace `kwds` -> `keywords` in the explanation.",
    "created_at": "2016-08-18T22:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285501",
    "user": "https://github.com/tscrim"
}
```

`@`aram.dermenjian Thank you

One other small nitpick: It would be good to also replace `kwds` -> `keywords` in the explanation.



---

archive/issue_comments_285502.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-19T11:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285502",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285503.json:
```json
{
    "body": "The desired changes have been made (Fixed grammar, fixed the extra white space line, and expanded kwds to keywords) Let me know if there are any other things needing to be changed.",
    "created_at": "2016-08-19T13:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285503",
    "user": "https://github.com/thecaligarmo"
}
```

The desired changes have been made (Fixed grammar, fixed the extra white space line, and expanded kwds to keywords) Let me know if there are any other things needing to be changed.



---

archive/issue_comments_285504.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-19T23:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285504",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285505.json:
```json
{
    "body": "LGTM. Thanks.",
    "created_at": "2016-08-19T23:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285505",
    "user": "https://github.com/tscrim"
}
```

LGTM. Thanks.



---

archive/issue_comments_285506.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-21T23:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20687#issuecomment-285506",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019637.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-08-21T23:39:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20687",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20687#event-19637"
}
```
