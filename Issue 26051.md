# Issue 26051: upgrade matplotlib to 2.2.3

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2018-09-15 04:08:40

CC:  arojas fbissey @timokau infinity0 kcrisman saraedum slelievre thansen

This fixes compilation errors with clang 6.0.1

tarball (created using spkg-src) at 
http://users.ox.ac.uk/~coml0531/sage/matplotlib-2.2.3.tar.bz2


---

Comment by dimpase created at 2018-09-15 04:18:25

Changing status from new to needs_review.


---

Comment by dimpase created at 2018-09-15 04:18:25

New commits:


---

Comment by Konrad127123 created at 2018-11-07 12:07:19

Building `cvxopt` with `SAGE_CHECK="yes"` still fails when running headless (#24657). Not sure if that's strictly a `cvxopt` or a `matplotlib` issue.


---

Comment by dimpase created at 2018-11-27 17:43:44

I don't think cvxopt (which needs to be updated) has to be dealt with here. Can we proceed with this update?


---

Comment by fbissey created at 2018-11-27 19:50:31

I expressed my opinion on `cvxopt` so called test failures in #24657. I heard nothing back. And I definitely think we should proceed.


---

Comment by slelievre created at 2018-12-21 11:20:50

Changing keywords from "" to "upgrade, matplotlib".


---

Comment by chapoton created at 2019-01-01 15:24:32

sagemath depends on python 2 version of matplotlib (which was removed from debian unstable)

https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=917428


---

Comment by slelievre created at 2019-01-01 16:54:31

See also [discussions on debian-science-sagemath](https://alioth-lists.debian.net/pipermail/debian-science-sagemath/2018-December/thread.html).


---

Comment by thansen created at 2019-01-02 08:22:13

Replying to [comment:8 chapoton]:
> sagemath depends on python 2 version of matplotlib (which was removed from debian unstable)
> 
> https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=917428

The python 2 version of matplotlib was just moved to a new package (matplotlib2), so it's fine. False alarm.


---

Comment by @dimpase created at 2019-01-20 22:38:29

ping?


---

Comment by jdemeyer created at 2019-01-25 09:54:57

I would prefer to add the patches removing `np.isscalar` which will otherwise cause breakage with the numpy upgrade.

Can you look into that or should I?


---

Comment by jdemeyer created at 2019-01-25 09:55:31

There is this matplotlib PR, but I don't know if it is sufficient: https://github.com/matplotlib/matplotlib/pull/12070


---

Comment by jdemeyer created at 2019-01-28 12:09:00

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2019-01-28 12:25:00

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2019-01-28 12:25:00

I don't understand what numpy upgrade that might cause anything to matplotlib is meant.
Things still seem to work here with Sage 8.7.beta1.

I don't think it's a good idea to try to backport stuff just to hopefully fix bugs we don't see yet.


---

Comment by jdemeyer created at 2019-01-28 12:41:02

New commits:


---

Comment by jdemeyer created at 2019-01-28 12:44:22

Replying to [comment:15 dimpase]:
> I don't understand what numpy upgrade that might cause anything to matplotlib is meant.

I mean the numpy upgrade to 1.16.0 at #27000.

> I don't think it's a good idea to try to backport stuff just to hopefully fix bugs we don't see yet.

Why not? If this issue is blocking #27000, it should be addressed.


---

Comment by dimpase created at 2019-01-28 13:53:54

looks good.


---

Comment by dimpase created at 2019-01-28 13:53:54

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2019-01-28 14:12:13

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2019-01-28 14:12:13

This needs more `isscalar` fixes.


---

Comment by dimpase created at 2019-01-28 14:28:04

Do you mean `np.asscalar` ?
Indeed, with `numpy 1.16` I see

```
    DeprecationWarning: np.asscalar(a) is deprecated since NumPy v1.16, use a.item() instead
```



---

Comment by dimpase created at 2019-01-28 14:35:31

In fact, I don't get why you need to do anything with isscalar:

```
sage: import numpy as np
sage: np.version.version
'1.16.0'
sage: np.isscalar(1)
True
```


The problem is in asscalar!


```
sage: import numpy as np
sage: np.version.version
'1.16.0'
sage: np.asscalar(np.array([24]))
/home/scratch2/dimpase/sage/sage/local/lib/python2.7/site-packages/numpy/lib/type_check.py:546: DeprecationWarning: np.asscalar(a) is deprecated since NumPy v1.16, use a.item() instead
  'a.item() instead', DeprecationWarning, stacklevel=1)
24
```



---

Comment by jdemeyer created at 2019-01-28 16:00:38

`isscalar` vs `asscalar`: it's just a 1 bit difference. Somebody in matplotlib didn't pay attention during their coding theory course :-)

The relevant PR is https://github.com/matplotlib/matplotlib/pull/12508


---

Comment by git created at 2019-01-28 16:26:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-01-28 16:29:21

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2019-01-28 17:42:57

OK, works, also with numpy from #27000


---

Comment by dimpase created at 2019-01-28 17:43:19

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-01-30 19:18:19

Resolution: fixed
