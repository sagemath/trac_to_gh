# Issue 13264: Elliptic Curve Enumeration by height

archive/issues_013264.json:
```json
{
    "body": "Assignee: spice\n\nKeywords: Elliptic curves, enumeration\n\nAdd functionality to Sage that allows one to enumerate elliptic curves over Q by height for a range of Weierstrass families of curve.\n\nThis code has grown from work with Wei Ho, who desired a way to enumerate curves over Q by height (where the height of a curve is a function of the coefficients in its Weierstrass model) so that the average value of some datum (e.g.rank, 2-Selmer size) could be computed for curves up to a given height. This code introduces a class, CurveEnumerator(), that computes lists of curves ordered by height for this purpose.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13436\n\n",
    "created_at": "2012-09-06T17:42:52Z",
    "labels": [
        "elliptic curves",
        "minor",
        "enhancement"
    ],
    "title": "Elliptic Curve Enumeration by height",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13264",
    "user": "spice"
}
```
Assignee: spice

Keywords: Elliptic curves, enumeration

Add functionality to Sage that allows one to enumerate elliptic curves over Q by height for a range of Weierstrass families of curve.

This code has grown from work with Wei Ho, who desired a way to enumerate curves over Q by height (where the height of a curve is a function of the coefficients in its Weierstrass model) so that the average value of some datum (e.g.rank, 2-Selmer size) could be computed for curves up to a given height. This code introduces a class, CurveEnumerator(), that computes lists of curves ordered by height for this purpose.

Issue created by migration from https://trac.sagemath.org/ticket/13436





---

archive/issue_comments_162612.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-09-17T21:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162612",
    "user": "spice"
}
```

Attachment



---

archive/issue_comments_162613.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-09-17T22:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162613",
    "user": "spice"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_162614.json:
```json
{
    "body": "Version 1.0 patch posted. All new code (except for an added import statement in sage.schemes.elliptic_curves.all) is in a new file, curve_enumerator.py, in the sage.schemes.elliptic_curves directory. It's thoroughly documented and doctested, so hopefully its logic will straightforward enough to follow.",
    "created_at": "2012-09-17T22:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162614",
    "user": "spice"
}
```

Version 1.0 patch posted. All new code (except for an added import statement in sage.schemes.elliptic_curves.all) is in a new file, curve_enumerator.py, in the sage.schemes.elliptic_curves directory. It's thoroughly documented and doctested, so hopefully its logic will straightforward enough to follow.



---

archive/issue_comments_162615.json:
```json
{
    "body": "For the three_selmer function, you need a doctest.\n\n```\nsage: magma('2+2')  # optional - magma\n```\n\n\nThen\n\n```\nsage -t --only_optional=magma curve_enumerator.py \n```\n\nto test.",
    "created_at": "2012-09-25T18:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162615",
    "user": "was"
}
```

For the three_selmer function, you need a doctest.

```
sage: magma('2+2')  # optional - magma
```


Then

```
sage -t --only_optional=magma curve_enumerator.py 
```

to test.



---

archive/issue_comments_162616.json:
```json
{
    "body": "Fix some docstring formatitng, e.g., the funny indent:\n\n```\n    def heights(self, lowerbound, upperbound):  \n        \"\"\"\n        Return a list of permissable curve heights in the specified range\n         (bounds inclusive), and for each height the equation coefficients\n         that produce curves of that height.\n```\n\n\nThis should output \"100%\":\n\n```\n...elliptic_curves$ sage -coverage curve_enumerator.py \n----------------------------------------------------------------------\ncurve_enumerator.py\nERROR: Please add a `TestSuite(s).run()` doctest.\nSCORE curve_enumerator.py: 87% (35 of 40)\n\nMissing documentation:\n\t * __init__(self):\n\t * __repr__(self):\n\t * _coeffs_to_a_invariants(self, c):\n\n\nMissing doctests:\n\t * __init__(self):\n\t * three_selmer(self, curves, rank=True, reduced=False, output_filename=None, problems_filename=None, \\ proof=True, return_data=True, print_timing=True):\n```\n",
    "created_at": "2012-09-25T18:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162616",
    "user": "was"
}
```

Fix some docstring formatitng, e.g., the funny indent:

```
    def heights(self, lowerbound, upperbound):  
        """
        Return a list of permissable curve heights in the specified range
         (bounds inclusive), and for each height the equation coefficients
         that produce curves of that height.
```


This should output "100%":

```
...elliptic_curves$ sage -coverage curve_enumerator.py 
----------------------------------------------------------------------
curve_enumerator.py
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE curve_enumerator.py: 87% (35 of 40)

Missing documentation:
	 * __init__(self):
	 * __repr__(self):
	 * _coeffs_to_a_invariants(self, c):


Missing doctests:
	 * __init__(self):
	 * three_selmer(self, curves, rank=True, reduced=False, output_filename=None, problems_filename=None, \ proof=True, return_data=True, print_timing=True):
```




---

archive/issue_comments_162617.json:
```json
{
    "body": "* Here: `over Q up` I would put ``\\\\QQ`` or at `QQ`. \n\n* Either: Or: -- maybe instead a sublist of two things?\n\n* weird formatting:\n\n```\nsage: C = EllipticCurveEnumerator(family=\"short_weierstrass\")\nsage: C.n_torsion?\n\n       * \"rank\"              -- (Default True): Compute the rank versus\n         size of the curve's torsion/n-torsion subgroup. If True, the\n         n-torsion rank is computed (i.e. 0, 1 or 2). If set to False, the\n         size of the n-torsion subgroup is computed instead (i.e. n^rank)\n    \n         * \"output_filename\" -- (Default None): If not None, the string\n    \n         name of the file to which the output will be saved.\n```\n\n\n*  Restructure code so that this is natural:\n\n```\nv = EllipticCurveEnumerator(family=\"short_weierstrass\", height=1000).ranks()\n```\n \n\nWill need caching:\n\n```\nsage: from sage.misc.cachefunc import cached_method\nsage: cached_method?\n```\n",
    "created_at": "2012-09-25T18:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162617",
    "user": "was"
}
```

* Here: `over Q up` I would put ``\\QQ`` or at `QQ`. 

* Either: Or: -- maybe instead a sublist of two things?

* weird formatting:

```
sage: C = EllipticCurveEnumerator(family="short_weierstrass")
sage: C.n_torsion?

       * "rank"              -- (Default True): Compute the rank versus
         size of the curve's torsion/n-torsion subgroup. If True, the
         n-torsion rank is computed (i.e. 0, 1 or 2). If set to False, the
         size of the n-torsion subgroup is computed instead (i.e. n^rank)
    
         * "output_filename" -- (Default None): If not None, the string
    
         name of the file to which the output will be saved.
```


*  Restructure code so that this is natural:

```
v = EllipticCurveEnumerator(family="short_weierstrass", height=1000).ranks()
```
 

Will need caching:

```
sage: from sage.misc.cachefunc import cached_method
sage: cached_method?
```




---

archive/issue_comments_162618.json:
```json
{
    "body": "There are three `AssertionErrors` that should be `ValueErrors`.\n\nalso `two_selmer` and `three_selmer` have an extra space for the OUTPUT portion of the docstring.",
    "created_at": "2012-09-25T19:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162618",
    "user": "ohanar"
}
```

There are three `AssertionErrors` that should be `ValueErrors`.

also `two_selmer` and `three_selmer` have an extra space for the OUTPUT portion of the docstring.



---

archive/issue_comments_162619.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-09-25T19:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162619",
    "user": "ohanar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_162620.json:
```json
{
    "body": "I have uploaded a patch that cleans up the documentation.\n\nStill needs works, I think",
    "created_at": "2013-05-17T21:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162620",
    "user": "chapoton"
}
```

I have uploaded a patch that cleans up the documentation.

Still needs works, I think



---

archive/issue_comments_162621.json:
```json
{
    "body": "could please someone with magma add the missing doctest for \"three_selmer\" ?",
    "created_at": "2013-05-18T12:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162621",
    "user": "chapoton"
}
```

could please someone with magma add the missing doctest for "three_selmer" ?



---

archive/issue_comments_162622.json:
```json
{
    "body": "I applied the patches to 5.10 and ran the doctest and report the result here.\n\n```\nsage: C = EllipticCurveEnumerator(family=\"short_weierstrass\") \nsage: L = C.coefficients_over_height_range(4, 4)                                                               \nsage: R, P = C.three_selmer(L, rank=True,return_data=True,print_timing=False)                                  \nsage: R                                                                                                        \n[(4, [0, 0, 0, -1, -2], 1),\n (4, [0, 0, 0, -1, 2], 0),\n (4, [0, 0, 0, 0, -2], 1),\n (4, [0, 0, 0, 0, 2], 1),\n (4, [0, 0, 0, 1, -2], 0),\n (4, [0, 0, 0, 1, 2], 0)]\nsage: P                                                                                                        \n[]\n```\n",
    "created_at": "2013-07-05T20:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162622",
    "user": "cremona"
}
```

I applied the patches to 5.10 and ran the doctest and report the result here.

```
sage: C = EllipticCurveEnumerator(family="short_weierstrass") 
sage: L = C.coefficients_over_height_range(4, 4)                                                               
sage: R, P = C.three_selmer(L, rank=True,return_data=True,print_timing=False)                                  
sage: R                                                                                                        
[(4, [0, 0, 0, -1, -2], 1),
 (4, [0, 0, 0, -1, 2], 0),
 (4, [0, 0, 0, 0, -2], 1),
 (4, [0, 0, 0, 0, 2], 1),
 (4, [0, 0, 0, 1, -2], 0),
 (4, [0, 0, 0, 1, 2], 0)]
sage: P                                                                                                        
[]
```




---

archive/issue_comments_162623.json:
```json
{
    "body": "Attachment\n\nthanks for the help !",
    "created_at": "2013-07-06T15:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162623",
    "user": "chapoton"
}
```

Attachment

thanks for the help !



---

archive/issue_comments_162624.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-05T09:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162624",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_162625.json:
```json
{
    "body": "Thanks for converting this to git and fixing the docstring formatting (which I will trust has been done properly)!\n\nAuthors:  can you remove the place(s) where there are comments \"this should be checked\" or \"todo\"?  And in several similar places you can delete the comment that some integers must be Sage integers or ... some rather frivolous consequence will occur?\n\nI see that you have carefully allowed for the unavoidable fact that there will be \"problem curves\" and have an option output filename for these.  But I don't think that any of the doctests illustrate this -- please add one or more doctests which do.  Meanwhile I am trying the functions out.",
    "created_at": "2014-01-11T15:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162625",
    "user": "cremona"
}
```

Thanks for converting this to git and fixing the docstring formatting (which I will trust has been done properly)!

Authors:  can you remove the place(s) where there are comments "this should be checked" or "todo"?  And in several similar places you can delete the comment that some integers must be Sage integers or ... some rather frivolous consequence will occur?

I see that you have carefully allowed for the unavoidable fact that there will be "problem curves" and have an option output filename for these.  But I don't think that any of the doctests illustrate this -- please add one or more doctests which do.  Meanwhile I am trying the functions out.



---

archive/issue_comments_162626.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-07T13:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162626",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_162627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-03T07:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162627",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_162628.json:
```json
{
    "body": "There is still one failing doctest, that I do not understand.",
    "created_at": "2015-06-03T19:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162628",
    "user": "chapoton"
}
```

There is still one failing doctest, that I do not understand.



---

archive/issue_comments_162629.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-05T20:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162629",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_162630.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-13T19:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162630",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_162631.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-29T18:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162631",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_162632.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-01T16:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13264",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13264#issuecomment-162632",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:
