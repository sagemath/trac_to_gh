# Issue 21422: AsymptoticRing.coefficients_of_generating_function: hardcoded exponents in QQ

archive/issues_021422.json:
```json
{
    "body": "CC:  behackl dkrenn\n\nKeywords: singularity analysis\n\nThe method `AsymptoticRing.coefficients_of_generating_function` enforces exponents to be in `QQ`:\n\n\n```\nsage: R.<n> = AsymptoticRing('n^QQbar', QQbar)\nsage: R.coefficients_of_generating_function(lambda z: (1-z)^(1/2), [1], 1)\n-1/2/sqrt(pi)*n^(-3/2) + O(n^(-5/2))\nsage: R.coefficients_of_generating_function(lambda z: (1-z)^QQbar(sqrt(2)), [1], 1)\nTraceback (most recent call last):\n...\nValueError: Cannot include T^(-1.414213562373095?) with parent Exact Term Monoid\nT^(Algebraic Field) * log(T)^(Algebraic Field) with coefficients in Symbolic\nRing in Asymptotic Ring <T^QQ * log(T)^QQ> over Symbolic Ring\n> *previous* ValueError: T^(-1.414213562373095?) is not in Growth Group T^QQ * log(T)^QQ\n```\n\n\nThe problem is that the singular expansion is always constructed in\n\n```\nA = AsymptoticRing('T^QQ * log(T)^QQ', coefficient_ring=SR,\n                   default_prec=precision)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21659\n\n",
    "created_at": "2016-10-07T09:51:33Z",
    "labels": [
        "asymptotic expansions",
        "major",
        "bug"
    ],
    "title": "AsymptoticRing.coefficients_of_generating_function: hardcoded exponents in QQ",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21422",
    "user": "cheuberg"
}
```
CC:  behackl dkrenn

Keywords: singularity analysis

The method `AsymptoticRing.coefficients_of_generating_function` enforces exponents to be in `QQ`:


```
sage: R.<n> = AsymptoticRing('n^QQbar', QQbar)
sage: R.coefficients_of_generating_function(lambda z: (1-z)^(1/2), [1], 1)
-1/2/sqrt(pi)*n^(-3/2) + O(n^(-5/2))
sage: R.coefficients_of_generating_function(lambda z: (1-z)^QQbar(sqrt(2)), [1], 1)
Traceback (most recent call last):
...
ValueError: Cannot include T^(-1.414213562373095?) with parent Exact Term Monoid
T^(Algebraic Field) * log(T)^(Algebraic Field) with coefficients in Symbolic
Ring in Asymptotic Ring <T^QQ * log(T)^QQ> over Symbolic Ring
> *previous* ValueError: T^(-1.414213562373095?) is not in Growth Group T^QQ * log(T)^QQ
```


The problem is that the singular expansion is always constructed in

```
A = AsymptoticRing('T^QQ * log(T)^QQ', coefficient_ring=SR,
                   default_prec=precision)
```


Issue created by migration from https://trac.sagemath.org/ticket/21659





---

archive/issue_comments_297389.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-07T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21422#issuecomment-297389",
    "user": "cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_297390.json:
```json
{
    "body": "Here is a first version of a fix. Unfortunately, some workaround is needed due to the fact that `gamma(QQbar(1/2))` does not work, see [post on sage-devel](https://groups.google.com/d/msg/sage-devel/jqs3LNeKq5M/v24xFt1zAgAJ).\n\nWhat I do not understand is that\n\n```\nsage: B.<n> = AsymptoticRing('n^QQbar', SR)\nsage: B.coefficients_of_generating_function(\n....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\n0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))\n```\n\nworks but\n\n```\nsage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)\nsage: B.coefficients_of_generating_function(\n....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\nTraceback (most recent call last)\n...\nTypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n> *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n>> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.\n>>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).\n>>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.\n>>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field\n```\n\ndoes not.\n----\nNew commits:",
    "created_at": "2016-10-07T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21422#issuecomment-297390",
    "user": "cheuberg"
}
```

Here is a first version of a fix. Unfortunately, some workaround is needed due to the fact that `gamma(QQbar(1/2))` does not work, see [post on sage-devel](https://groups.google.com/d/msg/sage-devel/jqs3LNeKq5M/v24xFt1zAgAJ).

What I do not understand is that

```
sage: B.<n> = AsymptoticRing('n^QQbar', SR)
sage: B.coefficients_of_generating_function(
....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))
```

works but

```
sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)
sage: B.coefficients_of_generating_function(
....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
Traceback (most recent call last)
...
TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
>> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.
>>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).
>>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.
>>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field
```

does not.
----
New commits:



---

archive/issue_comments_297391.json:
```json
{
    "body": "Replying to [comment:2 cheuberg]:\n> What I do not understand is that\n> {{{\n> sage: B.<n> = AsymptoticRing('n^QQbar', SR)\n> sage: B.coefficients_of_generating_function(\n> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\n> 0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))\n> }}}\n> works but\n> {{{\n> sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)\n> sage: B.coefficients_of_generating_function(\n> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)\n> Traceback (most recent call last)\n> ...\n> TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n> > *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.\n> >> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.\n> >>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).\n> >>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.\n> >>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field\n> }}}\n> does not.\n\nThis is independent of singularity analysis; see #21665.",
    "created_at": "2016-10-08T05:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21422#issuecomment-297391",
    "user": "cheuberg"
}
```

Replying to [comment:2 cheuberg]:
> What I do not understand is that
> {{{
> sage: B.<n> = AsymptoticRing('n^QQbar', SR)
> sage: B.coefficients_of_generating_function(
> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
> 0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))
> }}}
> works but
> {{{
> sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)
> sage: B.coefficients_of_generating_function(
> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
> Traceback (most recent call last)
> ...
> TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> > *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> >> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.
> >>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).
> >>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.
> >>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field
> }}}
> does not.

This is independent of singularity analysis; see #21665.



---

archive/issue_comments_297392.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-25T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21422#issuecomment-297392",
    "user": "cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_297393.json:
```json
{
    "body": "The problem with QQbar(1/2) seems to be fixed in https://github.com/pynac/pynac/issues/201 ,\nso wait for #21963.",
    "created_at": "2016-11-25T06:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21422#issuecomment-297393",
    "user": "cheuberg"
}
```

The problem with QQbar(1/2) seems to be fixed in https://github.com/pynac/pynac/issues/201 ,
so wait for #21963.



---

archive/issue_comments_297394.json:
```json
{
    "body": "Merged in [SageMath](SageMath) 8.6\n----\nNew commits:",
    "created_at": "2019-06-07T16:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21422",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21422#issuecomment-297394",
    "user": "dkrenn"
}
```

Merged in [SageMath](SageMath) 8.6
----
New commits:
