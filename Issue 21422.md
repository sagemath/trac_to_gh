# Issue 21422: AsymptoticRing.coefficients_of_generating_function: hardcoded exponents in QQ

Issue created by migration from Trac.

Original creator: cheuberg

Original creation time: 2016-10-07 09:51:33

CC:  behackl dkrenn

Keywords: singularity analysis

The method `AsymptoticRing.coefficients_of_generating_function` enforces exponents to be in `QQ`:


```
sage: R.<n> = AsymptoticRing('n^QQbar', QQbar)
sage: R.coefficients_of_generating_function(lambda z: (1-z)^(1/2), [1], 1)
-1/2/sqrt(pi)*n^(-3/2) + O(n^(-5/2))
sage: R.coefficients_of_generating_function(lambda z: (1-z)^QQbar(sqrt(2)), [1], 1)
Traceback (most recent call last):
...
ValueError: Cannot include T^(-1.414213562373095?) with parent Exact Term Monoid
T^(Algebraic Field) * log(T)^(Algebraic Field) with coefficients in Symbolic
Ring in Asymptotic Ring <T^QQ * log(T)^QQ> over Symbolic Ring
> *previous* ValueError: T^(-1.414213562373095?) is not in Growth Group T^QQ * log(T)^QQ
```


The problem is that the singular expansion is always constructed in

```
A = AsymptoticRing('T^QQ * log(T)^QQ', coefficient_ring=SR,
                   default_prec=precision)
```



---

Comment by cheuberg created at 2016-10-07 11:50:58

Changing status from new to needs_review.


---

Comment by cheuberg created at 2016-10-07 11:50:58

Here is a first version of a fix. Unfortunately, some workaround is needed due to the fact that `gamma(QQbar(1/2))` does not work, see [post on sage-devel](https://groups.google.com/d/msg/sage-devel/jqs3LNeKq5M/v24xFt1zAgAJ).

What I do not understand is that

```
sage: B.<n> = AsymptoticRing('n^QQbar', SR)
sage: B.coefficients_of_generating_function(
....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))
```

works but

```
sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)
sage: B.coefficients_of_generating_function(
....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
Traceback (most recent call last)
...
TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
>> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.
>>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).
>>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.
>>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field
```

does not.
----
New commits:


---

Comment by cheuberg created at 2016-10-08 05:04:40

Replying to [comment:2 cheuberg]:
> What I do not understand is that
> {{{
> sage: B.<n> = AsymptoticRing('n^QQbar', SR)
> sage: B.coefficients_of_generating_function(
> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
> 0.384695296551923*n^(-2.414213562373095?) + O(n^(-3.414213562373095?))
> }}}
> works but
> {{{
> sage: B.<n> = AsymptoticRing('QQbar^n * n^QQbar', SR)
> sage: B.coefficients_of_generating_function(
> ....:     lambda z: (1-z)^QQbar(sqrt(2)), [1], precision=1, exponent_ring=QQbar)
> Traceback (most recent call last)
> ...
> TypeError: Cannot apply the substitution rules {Z: n} on 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> > *previous* ValueError: Cannot substitute in 0.384695296551923*Z^(-2.414213562373095?) + 0.656715949434358*Z^(-3.414213562373095?) + 0.979573650974364*Z^(-4.414213562373095?) + O(Z^(-5.414213562373095?)) in Asymptotic Ring <Z^(Algebraic Field)> over Symbolic Ring.
> >> *previous* ValueError: Cannot substitute in O(Z^(-5.414213562373095?)) in O-Term Monoid Z^(Algebraic Field) with implicit coefficients in Symbolic Ring.
> >>> *previous* ValueError: Cannot substitute in Z^(-5.414213562373095?) in Growth Group Z^(Algebraic Field).
> >>>> *previous* ValueError: Cannot take n to the exponent -5.414213562373095?.
> >>>>> *previous* TypeError: no canonical coercion from Algebraic Field to Rational Field
> }}}
> does not.

This is independent of singularity analysis; see #21665.


---

Comment by cheuberg created at 2016-11-25 06:48:23

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2016-11-25 06:48:23

The problem with QQbar(1/2) seems to be fixed in https://github.com/pynac/pynac/issues/201 ,
so wait for #21963.


---

Comment by dkrenn created at 2019-06-07 16:22:04

Merged in [SageMath](SageMath) 8.6
----
New commits:
