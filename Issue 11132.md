# Issue 11132: Problems with S-class groups of number fields

Issue created by migration from https://trac.sagemath.org/ticket/11304

Original creator: fwclarke

Original creation time: 2011-05-06 08:40:19

Assignee: davidloeffler

CC:  jdemeyer cremona rlm

Keywords: S-class groups

There are some serious problems at present with the code for S-class groups.  They only emerge when the class groups isÂ non-cyclic.  For example,


```
sage: K.<a> = QuadraticField(-105)
sage: C = K.class_group(); C
Class group of order 8 with structure C2 x C2 x C2 of Number Field in a with defining polynomial x^2 + 105
sage: S = (K.ideal(11, a + 7),)
sage: K.S_class_group(S)
Traceback (most recent call last):
...
IndexError: Argument length (= 3) must be 2.
```

This problem arises when the class group and the S-class group have differing numbers of generators.  It arises essentially because generators of S-class groups are created as `FractionalIdealClass` elements rather than `SFractionalIdealClass` elements.

But there is a more serious problem.  The Pari data for the S-class group which we failed to construct above can be obtained as


```
sage: SC_data = K._S_class_group_and_units(S)[1]; SC_data
[(Fractional ideal (10, a + 5), 2, 10), (Fractional ideal (6, a + 3), 2, 6)]
```

so that if


```
sage: P, Q = [u[0] for u in SC_data]
```

the S-classes of the ideals `P` and `Q` (each of order 2) generate the S-class group.  However,


```
sage: P._S_ideal_class_log(S)
[0, 0]
```

which cannot be correct.


---

Attachment

apply after patches from #11234


---

Comment by fwclarke created at 2011-06-03 07:51:17

Changing status from new to needs_review.


---

Comment by fwclarke created at 2011-06-03 07:51:17

The patch rectifies the defects.  It also incorporates enhancements for both class groups and S-class groups.

In particular:

The computation of S-class groups is made faster when the ideals in S are all principal.

The computation of ideal_class_logs is speeded up by setting a pari flag.

The code for S-class groups is made more compatible with that for class groups.


---

Comment by cremona created at 2011-06-03 13:52:55

Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.

I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.


---

Comment by mstreng created at 2011-07-04 22:24:39

Replying to [comment:2 cremona]:
> Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.
> 
> I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.

As Robert doesn't seem to reply, do you want to give this a positive review, or have someone else review it too?


---

Comment by cremona created at 2011-07-05 16:04:43

Let's give it a positive review, since I clearly thought it deserved that 5 weeks ago!
Marco, you can add your name as reviewer if appropriate.


---

Comment by cremona created at 2011-07-05 16:04:43

Changing status from needs_review to positive_review.


---

Comment by rlm created at 2011-07-24 06:07:06

Replying to [comment:3 mstreng]:
> Replying to [comment:2 cremona]:
> > Looks good to me, and applies fine to 4.7.1.alpha1 and all tests pass.
> > 
> > I've added rlm to the CC list since I think he implemented this originally, and hope he'll take a look too.
> 
> As Robert doesn't seem to reply, do you want to give this a positive review, or have someone else review it too?

Sorry for the delay, but I can add that the changes here look good to me too.


---

Comment by jdemeyer created at 2011-08-03 14:38:00

Resolution: fixed
