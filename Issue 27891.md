# Issue 27891: Fail to compile dochtml when upgrading Sagemath

Issue created by migration from https://trac.sagemath.org/ticket/28128

Original creator: @fwjmath

Original creation time: 2019-07-07 12:01:18

Keywords: encoding

On a Linux machine (Ubuntu 19.04) with Chinese locale, upgrading Sagemath through command line `./sage -upgrade` (therefore probably the same situation for cloning directly from Github) will fail on error of the sort:


```
WARNING: html_static_path 指向的 '/home/fwjmath/sagemath/src/doc/it/a_tour_of_sage/static' 不存在
```


More precisely, it raises an `OSError` with an unprintable object, which is in fact a unicode string, precisely the same warning string above.

However, it is clear that this is an error to be ignored, as showed by the function `_init_chatter` in `sage/local/lib/python2.7/site-packages/sage_setup/docbuild/sphinxbuild.py`. The error message above is a Chinese translation of one of the errors to be ignored. However, since the ignore list depends on an exact matching of error message, with localized error messages, sphinx does not ignore them properly. 

This is again an upstream problem related to python version and proper utf-8 treatment. Therefore, quick solution should not be expected. However, failing dochtml blocks compilation of functional parts, rendering the software useless. I would propose defering the compilation of references till the end to mitigate the adverse effect. 

**Workaround**:

There seems to be no "fast-and-clean" workaround out of it, because a thorough fix would require probably switching to python 3 entirely, or a reworking of how sphinx ignores errors. If the aim is only to get Sagemath compile, I propose the following: comment out the line of raising errors in the function `raise_errors` in the same file mentioned above. This suppresses all errors, and compilation will continue even with an error. 


---

Comment by chapoton created at 2019-07-07 14:38:25

- If the doc does not build, just use "make build" instead of "make"

- You can already compile and use sage with python3, as explained on top of #15530


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2020-06-14 19:38:42

This is likely outdated now that we have switched to Python 3.


---

Comment by mkoeppe created at 2020-06-14 19:38:42

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-09-12 06:41:17

Resolution: invalid
