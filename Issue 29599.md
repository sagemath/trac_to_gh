# Issue 29599: normaliz backend isn't ready for generators

archive/issues_029599.json:
```json
{
    "body": "CC:  @jplab @laisrast\n\nKeywords: polytopes, dilation\n\n\n```\nsage: P = polytopes.simplex(backend='normaliz')\nsage: K.<sqrt2> = QuadraticField(2)\nsage: P.dilation(sqrt2)\nTraceback (most recent call last):\n...\nAttributeError: 'generator' object has no attribute 'list'\n```\n\n\nThe reason for this is simple. With optimization in #29200, it seems that generators are passed down to the normaliz backend and this isn't ready for this yet (when converting the data to the normaliz field).\n\nIssue created by migration from https://trac.sagemath.org/ticket/29836\n\n",
    "created_at": "2020-06-10T09:13:13Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "normaliz backend isn't ready for generators",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29599",
    "user": "https://github.com/kliem"
}
```
CC:  @jplab @laisrast

Keywords: polytopes, dilation


```
sage: P = polytopes.simplex(backend='normaliz')
sage: K.<sqrt2> = QuadraticField(2)
sage: P.dilation(sqrt2)
Traceback (most recent call last):
...
AttributeError: 'generator' object has no attribute 'list'
```


The reason for this is simple. With optimization in #29200, it seems that generators are passed down to the normaliz backend and this isn't ready for this yet (when converting the data to the normaliz field).

Issue created by migration from https://trac.sagemath.org/ticket/29836





---

archive/issue_comments_419762.json:
```json
{
    "body": "I just marked this as critical, because this is regression.",
    "created_at": "2020-06-10T09:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419762",
    "user": "https://github.com/kliem"
}
```

I just marked this as critical, because this is regression.



---

archive/issue_comments_419763.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-10T09:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419763",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_419764.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-10T09:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419764",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_419765.json:
```json
{
    "body": "missing the # optional tag",
    "created_at": "2020-06-10T15:09:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419765",
    "user": "https://github.com/fchapoton"
}
```

missing the # optional tag



---

archive/issue_comments_419766.json:
```json
{
    "body": "and you could use\n\n```\nisinstance(thing, (A, B, C))\n```\n",
    "created_at": "2020-06-10T15:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419766",
    "user": "https://github.com/fchapoton"
}
```

and you could use

```
isinstance(thing, (A, B, C))
```




---

archive/issue_comments_419767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-10T15:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419767",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419768.json:
```json
{
    "body": "Replying to [comment:4 chapoton]:\n> and you could use\n> {{{\n> isinstance(thing, (A, B, C))\n> }}}\n\nMuch better. Thanks.",
    "created_at": "2020-06-10T15:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419768",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:4 chapoton]:
> and you could use
> {{{
> isinstance(thing, (A, B, C))
> }}}

Much better. Thanks.



---

archive/issue_comments_419769.json:
```json
{
    "body": "Probably `Polyhedron_base` should get some `_test_...` methods to make sure that methods are tested with all backends instead of relying on coverage by copy-paste doctests.",
    "created_at": "2020-06-10T18:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419769",
    "user": "https://github.com/mkoeppe"
}
```

Probably `Polyhedron_base` should get some `_test_...` methods to make sure that methods are tested with all backends instead of relying on coverage by copy-paste doctests.



---

archive/issue_comments_419770.json:
```json
{
    "body": "That would probably a good thing to do. I'm not familiar with TestSuite at all, but that should probably make things better.",
    "created_at": "2020-06-10T18:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419770",
    "user": "https://github.com/kliem"
}
```

That would probably a good thing to do. I'm not familiar with TestSuite at all, but that should probably make things better.



---

archive/issue_comments_419771.json:
```json
{
    "body": "Take a look at `sage.numerical.backends.GenericBackend`. Some time ago I did a similar thing for the MIP backends there. There's also `LoggingBackend`, which provides a semiautomatic way to make `_test...` methods from existing doctests.",
    "created_at": "2020-06-10T18:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419771",
    "user": "https://github.com/mkoeppe"
}
```

Take a look at `sage.numerical.backends.GenericBackend`. Some time ago I did a similar thing for the MIP backends there. There's also `LoggingBackend`, which provides a semiautomatic way to make `_test...` methods from existing doctests.



---

archive/issue_comments_419772.json:
```json
{
    "body": "Thank you for the reference. I will do this, but better in a separate ticket.",
    "created_at": "2020-06-10T19:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419772",
    "user": "https://github.com/kliem"
}
```

Thank you for the reference. I will do this, but better in a separate ticket.



---

archive/issue_comments_419773.json:
```json
{
    "body": "I opened #29842 for this.",
    "created_at": "2020-06-10T19:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419773",
    "user": "https://github.com/kliem"
}
```

I opened #29842 for this.



---

archive/issue_comments_419774.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-10T19:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419774",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419775.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-06-10T19:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419775",
    "user": "https://github.com/kliem"
}
```

Thank you.



---

archive/issue_comments_419776.json:
```json
{
    "body": "In \n\n```\n+            sage: P = polytopes.simplex(backend='normaliz')  # optional - pynormaliz\n+            sage: K.<sqrt2> = QuadraticField(2)              # optional - pynormaliz\n+            sage: P.dilation(sqrt2)\n```\n\nthe last line needs to be optional as well. If you don't have `pynormalize` you get a nice `NameError: name P is not defined` message in your doctests.",
    "created_at": "2020-06-14T23:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419776",
    "user": "https://github.com/kiwifb"
}
```

In 

```
+            sage: P = polytopes.simplex(backend='normaliz')  # optional - pynormaliz
+            sage: K.<sqrt2> = QuadraticField(2)              # optional - pynormaliz
+            sage: P.dilation(sqrt2)
```

the last line needs to be optional as well. If you don't have `pynormalize` you get a nice `NameError: name P is not defined` message in your doctests.



---

archive/issue_comments_419777.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-06-14T23:06:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419777",
    "user": "https://github.com/kiwifb"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_419778.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-15T05:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419779.json:
```json
{
    "body": "Thanks for catching that.",
    "created_at": "2020-06-15T05:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419779",
    "user": "https://github.com/kliem"
}
```

Thanks for catching that.



---

archive/issue_comments_419780.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-15T05:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419780",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_419781.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-15T06:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419781",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419782.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-23T22:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29599",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29599#issuecomment-419782",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
