# Issue 29599: normaliz backend isn't ready for generators

Issue created by migration from https://trac.sagemath.org/ticket/29836

Original creator: @kliem

Original creation time: 2020-06-10 09:13:13

CC:  jipilab @laisrast

Keywords: polytopes, dilation


```
sage: P = polytopes.simplex(backend='normaliz')
sage: K.<sqrt2> = QuadraticField(2)
sage: P.dilation(sqrt2)
Traceback (most recent call last):
...
AttributeError: 'generator' object has no attribute 'list'
```


The reason for this is simple. With optimization in #29200, it seems that generators are passed down to the normaliz backend and this isn't ready for this yet (when converting the data to the normaliz field).


---

Comment by @kliem created at 2020-06-10 09:14:07

I just marked this as critical, because this is regression.


---

Comment by @kliem created at 2020-06-10 09:18:51

New commits:


---

Comment by @kliem created at 2020-06-10 09:18:51

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-06-10 15:09:45

missing the # optional tag


---

Comment by chapoton created at 2020-06-10 15:10:46

and you could use

```
isinstance(thing, (A, B, C))
```



---

Comment by git created at 2020-06-10 15:15:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-06-10 15:17:48

Replying to [comment:4 chapoton]:
> and you could use
> {{{
> isinstance(thing, (A, B, C))
> }}}

Much better. Thanks.


---

Comment by mkoeppe created at 2020-06-10 18:01:22

Probably `Polyhedron_base` should get some `_test_...` methods to make sure that methods are tested with all backends instead of relying on coverage by copy-paste doctests.


---

Comment by @kliem created at 2020-06-10 18:47:59

That would probably a good thing to do. I'm not familiar with TestSuite at all, but that should probably make things better.


---

Comment by mkoeppe created at 2020-06-10 18:52:15

Take a look at `sage.numerical.backends.GenericBackend`. Some time ago I did a similar thing for the MIP backends there. There's also `LoggingBackend`, which provides a semiautomatic way to make `_test...` methods from existing doctests.


---

Comment by @kliem created at 2020-06-10 19:18:47

Thank you for the reference. I will do this, but better in a separate ticket.


---

Comment by @kliem created at 2020-06-10 19:20:25

I opened #29842 for this.


---

Comment by mkoeppe created at 2020-06-10 19:31:52

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-06-10 19:41:52

Thank you.


---

Comment by fbissey created at 2020-06-14 23:06:58

In 

```
+            sage: P = polytopes.simplex(backend='normaliz')  # optional - pynormaliz
+            sage: K.<sqrt2> = QuadraticField(2)              # optional - pynormaliz
+            sage: P.dilation(sqrt2)
```

the last line needs to be optional as well. If you don't have `pynormalize` you get a nice `NameError: name P is not defined` message in your doctests.


---

Comment by fbissey created at 2020-06-14 23:06:58

Changing status from positive_review to needs_work.


---

Comment by git created at 2020-06-15 05:42:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-06-15 05:44:22

Thanks for catching that.


---

Comment by @kliem created at 2020-06-15 05:44:22

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-06-15 06:44:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-06-23 22:17:47

Resolution: fixed
