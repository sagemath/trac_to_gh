# Issue 18350: cartesian products of growth groups

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2015-06-02 14:36:41

CC:  behackl cheuberg

This implements cartesian products (via #18223) of growth groups (see #17600; or meta ticket #17601).


---

Comment by dkrenn created at 2015-06-02 14:37:06

Changing type from PLEASE CHANGE to enhancement.


---

Comment by behackl created at 2015-07-23 16:49:16

Last 10 new commits:


---

Comment by behackl created at 2015-07-23 16:52:06

Changing component from statistics to symbolics.


---

Comment by behackl created at 2015-07-23 16:52:06

Changing keywords from "" to "asymptotics, gsoc15".


---

Comment by git created at 2015-08-11 15:20:52

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-13 20:07:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-14 14:16:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-21 10:30:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-21 18:31:44

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-22 10:45:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-09-02 14:07:32

Changing status from new to needs_review.


---

Comment by git created at 2015-09-09 15:13:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-09-09 15:14:17

Merge in 6.9.beta5


---

Comment by dkrenn created at 2015-09-15 17:28:06

Changing component from symbolics to asymptotic expansions.


---

Comment by behackl created at 2015-09-16 21:07:03

Merged latest positively reviewed dependencies (#17600, #18930) into this branch and resolved some small merge conflicts.
----
Last 10 new commits:


---

Comment by cheuberg created at 2015-09-28 11:56:51

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2015-09-28 11:56:51

I reviewed this ticket, but without reviewing the dependency on #18223, so consider this as a conditional review.

I added a few reviewer commits. There is still a merge conflict with 6.9.rc0 caused by #17715.

Here are my other comments.

1. Introduction
  - I suggest to add a section heading before the note box (e.g. "Creation of Growth Groups") and to downgrade the note box to be an introductory paragraph of this section.
  - Last sentence: "It is mathematically nonsense": explain how the order of factors of a single variable matters.
2. `Variable.__init__`: `ValueError` "is not a valid name": not tested
3. `Variable.extract_variable_names`:
   - I am surprised that a more or less complete symbolic expression parser is needed here. Would it not be simpler to use `SR(s)` and then call `.variables()`, possibly on subexpressions in order to detect duplicates? It seems that `SR(s)` would create the symbolic variables on the fly, but does not inject them into the global name space, so this seems to be what is needed here.
   - I do not think the following is intentional:

```
sage: Variable.extract_variable_names('a + (b + c) + d')
('b', 'c', 'd')
```

   - Why does the regular expression for number contain a `$` but no `^`?
4. `GenericGrowthGroup.gens_monomial`: Replace "is only implemented for" by "must be implemented in"
5. `MonomialGrowthGroup`: Is the following intentionally allowed:

```
sage: from sage.rings.asymptotic.growth_group import MonomialGrowthGroup
sage: MonomialGrowthGroup(ZZ, 'x+y')
Growth Group x+y^ZZ
```

6. `MonomialGrowthGroup._convert_`:
   - Is the following intentional:

```
sage: import sage.rings.asymptotic.growth_group as agg
sage: P = agg.MonomialGrowthGroup(ZZ, 'x')
sage: P(1)
1
sage: P('x^2')
x^2
sage: P('1')
Traceback (most recent call last):
...
ValueError: Cannot convert 1.
sage: G('x^)42(')
x^42
```

   - As in 3a, couldn't the string parsing be done by the symbolic ring?
7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.
8. Add one or more links from `growth_group.py` to `growth_group_cartesian.py`.
9. `CartesianProductFactory`:
   - indicate (somewhere, probably at a more prominent place) what order is chosen automatically (apparently, lexicographic if the variables are equal, component-wise otherwise). That would also explain why order does matter (cf. 1b).
   - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.
   - (continuation of b while reading the code): apparently, sets of variables of the factors must be equal or disjoint.
   - mark doctests as indirect
10. `GenericProduct`: mark doctests as indirect.
11. Check links `~sage.sets.cartesian_product.CartesianProductPosets` and `sage.sets.cartesian_product.CartesianProductPosets.Element` (do not work for me, possibly time intensive recreation of documentation would help).
12. `GenericProduct._coerce_map_from_`: don't the factors coerce into the product?

```
sage: from sage.rings.asymptotic.growth_group import GrowthGroup
sage: G = GrowthGroup('x^ZZ')
sage: H = GrowthGroup('log(x)^ZZ')
sage: K = cartesian_product([G, H])
sage: K.has_coerce_map_from(G)
False
sage: K.has_coerce_map_from(H)
False
```

13. Expand documentation of `UnivariateProduct` and `MultivariateProduct`: at least, include a link to `GenericProduct` and explain the choice of order.
----
New commits:


---

Comment by behackl created at 2015-09-28 14:43:08

Merged `6.9.rc0` into this branch.
----
Last 10 new commits:


---

Comment by git created at 2015-09-28 19:57:20

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by behackl created at 2015-09-28 19:59:10

Replying to [comment:18 cheuberg]:
> I reviewed this ticket, but without reviewing the dependency on #18223, so consider this as a conditional review.
> 
> I added a few reviewer commits. There is still a merge conflict with 6.9.rc0 caused by #17715.
> 

Hello Clemens! Thank you for your review!

The merge conflict with `6.9.rc0` has been resolved.

> Here are my other comments.
> 
> 1. Introduction
>   - I suggest to add a section heading before the note box (e.g. "Creation of Growth Groups") and to downgrade the note box to be an introductory paragraph of this section.
>   - Last sentence: "It is mathematically nonsense": explain how the order of factors of a single variable matters.

Done and done.

> 2. `Variable.__init__`: `ValueError` "is not a valid name": not tested

Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).

> 3. `Variable.extract_variable_names`:
>    - I am surprised that a more or less complete symbolic expression parser is needed here. Would it not be simpler to use `SR(s)` and then call `.variables()`, possibly on subexpressions in order to detect duplicates? It seems that `SR(s)` would create the symbolic variables on the fly, but does not inject them into the global name space, so this seems to be what is needed here.

Changed this parser to the symbolic ring.

>    - I do not think the following is intentional:
> {{{
> sage: Variable.extract_variable_names('a + (b + c) + d')
> ('b', 'c', 'd')
> }}}

Indeed, this was not intentional. With the symbolic ring as the variable parser, this does not happen. I've added this as a doctest.

>    - Why does the regular expression for number contain a `$` but no `^`?

This is now irrelevant.

> 4. `GenericGrowthGroup.gens_monomial`: Replace "is only implemented for" by "must be implemented in"

Done.

> 5. `MonomialGrowthGroup`: Is the following intentionally allowed:
> {{{
> sage: from sage.rings.asymptotic.growth_group import MonomialGrowthGroup
> sage: MonomialGrowthGroup(ZZ, 'x+y')
> Growth Group x+y^ZZ
> }}}

Yes, this is intentional. On this ticket, the representation is ugly, but this is fixed in #19083.

> 6. `MonomialGrowthGroup._convert_`:
>    - Is the following intentional:
> {{{
> sage: import sage.rings.asymptotic.growth_group as agg
> sage: P = agg.MonomialGrowthGroup(ZZ, 'x')
> sage: P(1)
> 1
> sage: P('x^2')
> x^2
> sage: P('1')
> Traceback (most recent call last):
> ...
> ValueError: Cannot convert 1.
> sage: G('x^)42(')
> x^42
> }}}

The first two statements work as intended. The others are fixed here.

>    - As in 3a, couldn't the string parsing be done by the symbolic ring?

Yes. Done.

> 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.

Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.

> 8. Add one or more links from `growth_group.py` to `growth_group_cartesian.py`.

We took extensive care with respect to the documentation on #19083. There, some links have been added.

> 9. `CartesianProductFactory`:
>    - indicate (somewhere, probably at a more prominent place) what order is chosen automatically (apparently, lexicographic if the variables are equal, component-wise otherwise). That would also explain why order does matter (cf. 1b).

I've added a note-block to the docstring of the class.

>    - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.

I understand the confusion. However, I think that the error message is quite helpful in this case:

```
sage: cartesian_product([A, E]); G
Traceback (most recent call last):
...
ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.
```


Mainly, this is because the cartesian product cannot decide which order to use in this case. Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.

>    - (continuation of b while reading the code): apparently, sets of variables of the factors must be equal or disjoint.

I've added this remark to the note-block in the docstring of the factory.

>    - mark doctests as indirect

Done.

> 10. `GenericProduct`: mark doctests as indirect.

Done.

> 11. Check links `~sage.sets.cartesian_product.CartesianProductPosets` and `sage.sets.cartesian_product.CartesianProductPosets.Element` (do not work for me, possibly time intensive recreation of documentation would help).

I corrected the links (we shifted some code in #18223), they work for me now -- however, that should not have affected you. (Sometimes, the documentation really wants to be built from scratch. `:-)`)

> 12. `GenericProduct._coerce_map_from_`: don't the factors coerce into the product?
> {{{
> sage: from sage.rings.asymptotic.growth_group import GrowthGroup
> sage: G = GrowthGroup('x^ZZ')
> sage: H = GrowthGroup('log(x)^ZZ')
> sage: K = cartesian_product([G, H])
> sage: K.has_coerce_map_from(G)
> False
> sage: K.has_coerce_map_from(H)
> False
> }}}

No, not in general. However, due to our special structure (and as soon as we actually disallow copies of the same growth group in a cartesian product) this can be implemented. This should be handled in our coercion ticket, #19073.

> 13. Expand documentation of `UnivariateProduct` and `MultivariateProduct`: at least, include a link to `GenericProduct` and explain the choice of order.

Done.


---

Comment by cheuberg created at 2015-09-29 07:07:33

Replying to [comment:21 behackl]:
> Replying to [comment:18 cheuberg]:
> > 2. `Variable.__init__`: `ValueError` "is not a valid name": not tested
> 
> Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).

I do not think so: `extract_variable_names` is only called when `repr is None`, the removed code was only called when `repr is not None`. Indeed, the following does now work:

```
sage: from sage.rings.asymptotic.growth_group import Variable
sage: Variable("(:-)", repr="icecream").var_bases
('(:-)',)
```


> > 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.
> 
> Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.

I see.

The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.



> > 9. `CartesianProductFactory`:
> >    - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.
> 
> I understand the confusion. However, I think that the error message is quite helpful in this case:
> {{{
> sage: cartesian_product([A, E]); G
> Traceback (most recent call last):
> ...
> ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.
> }}}
> 
> Mainly, this is because the cartesian product cannot decide which order to use in this case.
perhaps rephrase error message along the lines of "factors must have equal or disjoint variables"?

> Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.

that might be hard.


---

Comment by git created at 2015-09-29 07:09:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-09-29 08:15:08

Replying to [comment:22 cheuberg]:
> Replying to [comment:21 behackl]:
> > Replying to [comment:18 cheuberg]:
> > > 2. `Variable.__init__`: `ValueError` "is not a valid name": not tested
> > 
> > Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).
> 
> I do not think so: `extract_variable_names` is only called when `repr is None`, the removed code was only called when `repr is not None`. Indeed, the following does now work:
> {{{
> sage: from sage.rings.asymptotic.growth_group import Variable
> sage: Variable("(:-)", repr="icecream").var_bases
> ('(:-)',)
> }}}
> 

Mea culpa, I misread the code. I've reverted the commit.

> > > 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.
> > 
> > Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.
> 
> I see.
> 
> The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.
> 
> 

Minor discrepancies like this are fixed on the cleanup ticket #19083. No need to introduce additional merge conflicts here.

> 
> > > 9. `CartesianProductFactory`:
> > >    - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.
> > 
> > I understand the confusion. However, I think that the error message is quite helpful in this case:
> > {{{
> > sage: cartesian_product([A, E]); G
> > Traceback (most recent call last):
> > ...
> > ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.
> > }}}
> > 
> > Mainly, this is because the cartesian product cannot decide which order to use in this case.
> perhaps rephrase error message along the lines of "factors must have equal or disjoint variables"?
> 

Done; improved the error message.

> > Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.
> 
> that might be hard.
> 

Turns out that this is very true. We will start with disallowing certain products like `x^ZZ * x^ZZ` and `x^ZZ * x^QQ` in the cleanup ticket. Altering the factory here only produces more merge conflicts with #19083 (the entire factory is rewritten there, meaning that the code would have to be written twice).
----
New commits:


---

Comment by behackl created at 2015-09-29 08:15:08

Changing status from needs_work to needs_review.


---

Comment by cheuberg created at 2015-09-29 08:49:06

Replying to [comment:25 behackl]:
> Replying to [comment:22 cheuberg]:
> > The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.
> 
> Minor discrepancies like this are fixed on the cleanup ticket #19083. No need to introduce additional merge conflicts here.

ok.

> > > Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.
> > 
> > that might be hard.
> > 
> 
> Turns out that this is very true. We will start with disallowing certain products like `x^ZZ * x^ZZ` and `x^ZZ * x^QQ` in the cleanup ticket. Altering the factory here only produces more merge conflicts with #19083 (the entire factory is rewritten there, meaning that the code would have to be written twice).

ok.

This is a conditional positive review from my side: conditional on the dependency #18223.


---

Comment by dkrenn created at 2015-09-30 13:51:27

Replying to [comment:26 cheuberg]:
> This is a conditional positive review from my side: conditional on the dependency #18223.

Merged in #18223 and adapted code. Please cross-review...and set it to positive ;)
----
New commits:


---

Comment by cheuberg created at 2015-09-30 14:45:00

Changing status from needs_review to positive_review.


---

Comment by cheuberg created at 2015-09-30 14:45:00

Replying to [comment:28 dkrenn]:
> Replying to [comment:26 cheuberg]:
> > This is a conditional positive review from my side: conditional on the dependency #18223.
> 
> Merged in #18223 and adapted code. Please cross-review...and set it to positive ;)

Done.


---

Comment by vbraun created at 2015-10-20 22:35:29

This ticket depends on a "duplicate" ticket. It will not be merged until #18586 is merged, i.e. most likely never.


---

Comment by vbraun created at 2015-10-21 16:55:05

Resolution: fixed
