# Issue 18350: cartesian products of growth groups

archive/issues_018350.json:
```json
{
    "body": "CC:  @behackl @cheuberg\n\nKeywords: asymptotics, gsoc15\n\nThis implements cartesian products (via #18223) of growth groups (see #17600; or meta ticket #17601).\n\nIn particular, the factory for growth groups introduced in #18930 is extended such that cartesian products can also be generated.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18587\n\n",
    "closed_at": "2015-10-21T16:55:05Z",
    "created_at": "2015-06-02T14:36:41Z",
    "labels": [
        "component: asymptotic expansions"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "cartesian products of growth groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18350",
    "user": "https://github.com/dkrenn"
}
```
CC:  @behackl @cheuberg

Keywords: asymptotics, gsoc15

This implements cartesian products (via #18223) of growth groups (see #17600; or meta ticket #17601).

In particular, the factory for growth groups introduced in #18930 is extended such that cartesian products can also be generated.


Issue created by migration from https://trac.sagemath.org/ticket/18587





---

archive/issue_comments_248743.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2015-06-02T14:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248743",
    "user": "https://github.com/dkrenn"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_248744.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-07-23T16:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248744",
    "user": "https://github.com/behackl"
}
```

Last 10 new commits:



---

archive/issue_comments_248745.json:
```json
{
    "body": "Changing component from statistics to symbolics.",
    "created_at": "2015-07-23T16:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248745",
    "user": "https://github.com/behackl"
}
```

Changing component from statistics to symbolics.



---

archive/issue_comments_248746.json:
```json
{
    "body": "Changing keywords from \"\" to \"asymptotics, gsoc15\".",
    "created_at": "2015-07-23T16:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248746",
    "user": "https://github.com/behackl"
}
```

Changing keywords from "" to "asymptotics, gsoc15".



---

archive/issue_comments_248747.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-08-11T15:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_248748.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-13T20:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248749.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-14T14:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248750.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-21T10:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248751.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-08-21T18:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248751",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_248752.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-22T10:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248753.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-02T14:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248753",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-09T15:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248754",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248755.json:
```json
{
    "body": "Merge in 6.9.beta5",
    "created_at": "2015-09-09T15:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248755",
    "user": "https://github.com/dkrenn"
}
```

Merge in 6.9.beta5



---

archive/issue_comments_248756.json:
```json
{
    "body": "Changing component from symbolics to asymptotic expansions.",
    "created_at": "2015-09-15T17:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248756",
    "user": "https://github.com/dkrenn"
}
```

Changing component from symbolics to asymptotic expansions.



---

archive/issue_comments_248757.json:
```json
{
    "body": "Merged latest positively reviewed dependencies (#17600, #18930) into this branch and resolved some small merge conflicts.\n\n---\nLast 10 new commits:",
    "created_at": "2015-09-16T21:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248757",
    "user": "https://github.com/behackl"
}
```

Merged latest positively reviewed dependencies (#17600, #18930) into this branch and resolved some small merge conflicts.

---
Last 10 new commits:



---

archive/issue_comments_248758.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-28T11:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248758",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248759.json:
```json
{
    "body": "I reviewed this ticket, but without reviewing the dependency on #18223, so consider this as a conditional review.\n\nI added a few reviewer commits. There is still a merge conflict with 6.9.rc0 caused by #17715.\n\nHere are my other comments.\n\n1. Introduction\n   - I suggest to add a section heading before the note box (e.g. \"Creation of Growth Groups\") and to downgrade the note box to be an introductory paragraph of this section.\n   - Last sentence: \"It is mathematically nonsense\": explain how the order of factors of a single variable matters.\n2. `Variable.__init__`: `ValueError` \"is not a valid name\": not tested\n3. `Variable.extract_variable_names`:\n   - I am surprised that a more or less complete symbolic expression parser is needed here. Would it not be simpler to use `SR(s)` and then call `.variables()`, possibly on subexpressions in order to detect duplicates? It seems that `SR(s)` would create the symbolic variables on the fly, but does not inject them into the global name space, so this seems to be what is needed here.\n   - I do not think the following is intentional:\n\n```\nsage: Variable.extract_variable_names('a + (b + c) + d')\n('b', 'c', 'd')\n```\n- Why does the regular expression for number contain a `$` but no `^`?\n4. `GenericGrowthGroup.gens_monomial`: Replace \"is only implemented for\" by \"must be implemented in\"\n5. `MonomialGrowthGroup`: Is the following intentionally allowed:\n\n```\nsage: from sage.rings.asymptotic.growth_group import MonomialGrowthGroup\nsage: MonomialGrowthGroup(ZZ, 'x+y')\nGrowth Group x+y^ZZ\n```\n6. `MonomialGrowthGroup._convert_`:\n   - Is the following intentional:\n\n```\nsage: import sage.rings.asymptotic.growth_group as agg\nsage: P = agg.MonomialGrowthGroup(ZZ, 'x')\nsage: P(1)\n1\nsage: P('x^2')\nx^2\nsage: P('1')\nTraceback (most recent call last):\n...\nValueError: Cannot convert 1.\nsage: G('x^)42(')\nx^42\n```\n- As in 3a, couldn't the string parsing be done by the symbolic ring?\n7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.\n8. Add one or more links from `growth_group.py` to `growth_group_cartesian.py`.\n9. `CartesianProductFactory`:\n   - indicate (somewhere, probably at a more prominent place) what order is chosen automatically (apparently, lexicographic if the variables are equal, component-wise otherwise). That would also explain why order does matter (cf. 1b).\n   - the example with \"do not have disjoint variables\" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.\n   - (continuation of b while reading the code): apparently, sets of variables of the factors must be equal or disjoint.\n   - mark doctests as indirect\n10. `GenericProduct`: mark doctests as indirect.\n21. Check links `~sage.sets.cartesian_product.CartesianProductPosets` and `sage.sets.cartesian_product.CartesianProductPosets.Element` (do not work for me, possibly time intensive recreation of documentation would help).\n32. `GenericProduct._coerce_map_from_`: don't the factors coerce into the product?\n\n```\nsage: from sage.rings.asymptotic.growth_group import GrowthGroup\nsage: G = GrowthGroup('x^ZZ')\nsage: H = GrowthGroup('log(x)^ZZ')\nsage: K = cartesian_product([G, H])\nsage: K.has_coerce_map_from(G)\nFalse\nsage: K.has_coerce_map_from(H)\nFalse\n```\n13. Expand documentation of `UnivariateProduct` and `MultivariateProduct`: at least, include a link to `GenericProduct` and explain the choice of order.\n  \n---\nNew commits:",
    "created_at": "2015-09-28T11:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248759",
    "user": "https://github.com/cheuberg"
}
```

I reviewed this ticket, but without reviewing the dependency on #18223, so consider this as a conditional review.

I added a few reviewer commits. There is still a merge conflict with 6.9.rc0 caused by #17715.

Here are my other comments.

1. Introduction
   - I suggest to add a section heading before the note box (e.g. "Creation of Growth Groups") and to downgrade the note box to be an introductory paragraph of this section.
   - Last sentence: "It is mathematically nonsense": explain how the order of factors of a single variable matters.
2. `Variable.__init__`: `ValueError` "is not a valid name": not tested
3. `Variable.extract_variable_names`:
   - I am surprised that a more or less complete symbolic expression parser is needed here. Would it not be simpler to use `SR(s)` and then call `.variables()`, possibly on subexpressions in order to detect duplicates? It seems that `SR(s)` would create the symbolic variables on the fly, but does not inject them into the global name space, so this seems to be what is needed here.
   - I do not think the following is intentional:

```
sage: Variable.extract_variable_names('a + (b + c) + d')
('b', 'c', 'd')
```
- Why does the regular expression for number contain a `$` but no `^`?
4. `GenericGrowthGroup.gens_monomial`: Replace "is only implemented for" by "must be implemented in"
5. `MonomialGrowthGroup`: Is the following intentionally allowed:

```
sage: from sage.rings.asymptotic.growth_group import MonomialGrowthGroup
sage: MonomialGrowthGroup(ZZ, 'x+y')
Growth Group x+y^ZZ
```
6. `MonomialGrowthGroup._convert_`:
   - Is the following intentional:

```
sage: import sage.rings.asymptotic.growth_group as agg
sage: P = agg.MonomialGrowthGroup(ZZ, 'x')
sage: P(1)
1
sage: P('x^2')
x^2
sage: P('1')
Traceback (most recent call last):
...
ValueError: Cannot convert 1.
sage: G('x^)42(')
x^42
```
- As in 3a, couldn't the string parsing be done by the symbolic ring?
7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.
8. Add one or more links from `growth_group.py` to `growth_group_cartesian.py`.
9. `CartesianProductFactory`:
   - indicate (somewhere, probably at a more prominent place) what order is chosen automatically (apparently, lexicographic if the variables are equal, component-wise otherwise). That would also explain why order does matter (cf. 1b).
   - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.
   - (continuation of b while reading the code): apparently, sets of variables of the factors must be equal or disjoint.
   - mark doctests as indirect
10. `GenericProduct`: mark doctests as indirect.
21. Check links `~sage.sets.cartesian_product.CartesianProductPosets` and `sage.sets.cartesian_product.CartesianProductPosets.Element` (do not work for me, possibly time intensive recreation of documentation would help).
32. `GenericProduct._coerce_map_from_`: don't the factors coerce into the product?

```
sage: from sage.rings.asymptotic.growth_group import GrowthGroup
sage: G = GrowthGroup('x^ZZ')
sage: H = GrowthGroup('log(x)^ZZ')
sage: K = cartesian_product([G, H])
sage: K.has_coerce_map_from(G)
False
sage: K.has_coerce_map_from(H)
False
```
13. Expand documentation of `UnivariateProduct` and `MultivariateProduct`: at least, include a link to `GenericProduct` and explain the choice of order.
  
---
New commits:



---

archive/issue_events_052192.json:
```json
{
    "actor": "https://github.com/cheuberg",
    "created_at": "2015-09-28T11:56:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "milestone": "sage-6.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18350#event-52192"
}
```



---

archive/issue_comments_248760.json:
```json
{
    "body": "Merged `6.9.rc0` into this branch.\n\n---\nLast 10 new commits:",
    "created_at": "2015-09-28T14:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248760",
    "user": "https://github.com/behackl"
}
```

Merged `6.9.rc0` into this branch.

---
Last 10 new commits:



---

archive/issue_comments_248761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-09-28T19:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_248762.json:
```json
{
    "body": "Replying to [comment:18 cheuberg]:\n> I reviewed this ticket, but without reviewing the dependency on #18223, so consider this as a conditional review.\n> \n> I added a few reviewer commits. There is still a merge conflict with 6.9.rc0 caused by #17715.\n> \n\n\nHello Clemens! Thank you for your review!\n\nThe merge conflict with `6.9.rc0` has been resolved.\n\n> Here are my other comments.\n> \n> 1. Introduction\n>    - I suggest to add a section heading before the note box (e.g. \"Creation of Growth Groups\") and to downgrade the note box to be an introductory paragraph of this section.\n>    - Last sentence: \"It is mathematically nonsense\": explain how the order of factors of a single variable matters.\n\n\nDone and done.\n\n> 2. `Variable.__init__`: `ValueError` \"is not a valid name\": not tested\n\n\nRemoved this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).\n\n> 3. `Variable.extract_variable_names`:\n>    - I am surprised that a more or less complete symbolic expression parser is needed here. Would it not be simpler to use `SR(s)` and then call `.variables()`, possibly on subexpressions in order to detect duplicates? It seems that `SR(s)` would create the symbolic variables on the fly, but does not inject them into the global name space, so this seems to be what is needed here.\n\n\nChanged this parser to the symbolic ring.\n\n>    - I do not think the following is intentional:\n \n> {{{\n> sage: Variable.extract_variable_names('a + (b + c) + d')\n> ('b', 'c', 'd')\n> }}}\n\n\nIndeed, this was not intentional. With the symbolic ring as the variable parser, this does not happen. I've added this as a doctest.\n\n>    - Why does the regular expression for number contain a `$` but no `^`?\n\n\nThis is now irrelevant.\n\n> 4. `GenericGrowthGroup.gens_monomial`: Replace \"is only implemented for\" by \"must be implemented in\"\n\n\nDone.\n\n> 5. `MonomialGrowthGroup`: Is the following intentionally allowed:\n> \n> ```\n> sage: from sage.rings.asymptotic.growth_group import MonomialGrowthGroup\n> sage: MonomialGrowthGroup(ZZ, 'x+y')\n> Growth Group x+y^ZZ\n> ```\n\n\nYes, this is intentional. On this ticket, the representation is ugly, but this is fixed in #19083.\n\n> 6. `MonomialGrowthGroup._convert_`:\n>    - Is the following intentional:\n> \n> ```\n> sage: import sage.rings.asymptotic.growth_group as agg\n> sage: P = agg.MonomialGrowthGroup(ZZ, 'x')\n> sage: P(1)\n> 1\n> sage: P('x^2')\n> x^2\n> sage: P('1')\n> Traceback (most recent call last):\n> ...\n> ValueError: Cannot convert 1.\n> sage: G('x^)42(')\n> x^42\n> ```\n\n\nThe first two statements work as intended. The others are fixed here.\n\n>    - As in 3a, couldn't the string parsing be done by the symbolic ring?\n\n\nYes. Done.\n\n> 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.\n\n\nUnfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.\n\n> 8. Add one or more links from `growth_group.py` to `growth_group_cartesian.py`.\n\n\nWe took extensive care with respect to the documentation on #19083. There, some links have been added.\n\n> 9. `CartesianProductFactory`:\n>    - indicate (somewhere, probably at a more prominent place) what order is chosen automatically (apparently, lexicographic if the variables are equal, component-wise otherwise). That would also explain why order does matter (cf. 1b).\n\n\nI've added a note-block to the docstring of the class.\n\n>    - the example with \"do not have disjoint variables\" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.\n\n\nI understand the confusion. However, I think that the error message is quite helpful in this case:\n\n```\nsage: cartesian_product([A, E]); G\nTraceback (most recent call last):\n...\nValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.\n```\n\nMainly, this is because the cartesian product cannot decide which order to use in this case. Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.\n\n>    - (continuation of b while reading the code): apparently, sets of variables of the factors must be equal or disjoint.\n\n\nI've added this remark to the note-block in the docstring of the factory.\n\n>    - mark doctests as indirect\n\n\nDone.\n\n> 10. `GenericProduct`: mark doctests as indirect.\n\n\nDone.\n\n> 11. Check links `~sage.sets.cartesian_product.CartesianProductPosets` and `sage.sets.cartesian_product.CartesianProductPosets.Element` (do not work for me, possibly time intensive recreation of documentation would help).\n\n\nI corrected the links (we shifted some code in #18223), they work for me now -- however, that should not have affected you. (Sometimes, the documentation really wants to be built from scratch. `:-)`)\n\n> 12. `GenericProduct._coerce_map_from_`: don't the factors coerce into the product?\n> \n> ```\n> sage: from sage.rings.asymptotic.growth_group import GrowthGroup\n> sage: G = GrowthGroup('x^ZZ')\n> sage: H = GrowthGroup('log(x)^ZZ')\n> sage: K = cartesian_product([G, H])\n> sage: K.has_coerce_map_from(G)\n> False\n> sage: K.has_coerce_map_from(H)\n> False\n> ```\n\n\nNo, not in general. However, due to our special structure (and as soon as we actually disallow copies of the same growth group in a cartesian product) this can be implemented. This should be handled in our coercion ticket, #19073.\n\n> 13. Expand documentation of `UnivariateProduct` and `MultivariateProduct`: at least, include a link to `GenericProduct` and explain the choice of order.\n\n\nDone.",
    "created_at": "2015-09-28T19:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248762",
    "user": "https://github.com/behackl"
}
```

Replying to [comment:18 cheuberg]:
> I reviewed this ticket, but without reviewing the dependency on #18223, so consider this as a conditional review.
> 
> I added a few reviewer commits. There is still a merge conflict with 6.9.rc0 caused by #17715.
> 


Hello Clemens! Thank you for your review!

The merge conflict with `6.9.rc0` has been resolved.

> Here are my other comments.
> 
> 1. Introduction
>    - I suggest to add a section heading before the note box (e.g. "Creation of Growth Groups") and to downgrade the note box to be an introductory paragraph of this section.
>    - Last sentence: "It is mathematically nonsense": explain how the order of factors of a single variable matters.


Done and done.

> 2. `Variable.__init__`: `ValueError` "is not a valid name": not tested


Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).

> 3. `Variable.extract_variable_names`:
>    - I am surprised that a more or less complete symbolic expression parser is needed here. Would it not be simpler to use `SR(s)` and then call `.variables()`, possibly on subexpressions in order to detect duplicates? It seems that `SR(s)` would create the symbolic variables on the fly, but does not inject them into the global name space, so this seems to be what is needed here.


Changed this parser to the symbolic ring.

>    - I do not think the following is intentional:
 
> {{{
> sage: Variable.extract_variable_names('a + (b + c) + d')
> ('b', 'c', 'd')
> }}}


Indeed, this was not intentional. With the symbolic ring as the variable parser, this does not happen. I've added this as a doctest.

>    - Why does the regular expression for number contain a `$` but no `^`?


This is now irrelevant.

> 4. `GenericGrowthGroup.gens_monomial`: Replace "is only implemented for" by "must be implemented in"


Done.

> 5. `MonomialGrowthGroup`: Is the following intentionally allowed:
> 
> ```
> sage: from sage.rings.asymptotic.growth_group import MonomialGrowthGroup
> sage: MonomialGrowthGroup(ZZ, 'x+y')
> Growth Group x+y^ZZ
> ```


Yes, this is intentional. On this ticket, the representation is ugly, but this is fixed in #19083.

> 6. `MonomialGrowthGroup._convert_`:
>    - Is the following intentional:
> 
> ```
> sage: import sage.rings.asymptotic.growth_group as agg
> sage: P = agg.MonomialGrowthGroup(ZZ, 'x')
> sage: P(1)
> 1
> sage: P('x^2')
> x^2
> sage: P('1')
> Traceback (most recent call last):
> ...
> ValueError: Cannot convert 1.
> sage: G('x^)42(')
> x^42
> ```


The first two statements work as intended. The others are fixed here.

>    - As in 3a, couldn't the string parsing be done by the symbolic ring?


Yes. Done.

> 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.


Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.

> 8. Add one or more links from `growth_group.py` to `growth_group_cartesian.py`.


We took extensive care with respect to the documentation on #19083. There, some links have been added.

> 9. `CartesianProductFactory`:
>    - indicate (somewhere, probably at a more prominent place) what order is chosen automatically (apparently, lexicographic if the variables are equal, component-wise otherwise). That would also explain why order does matter (cf. 1b).


I've added a note-block to the docstring of the class.

>    - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.


I understand the confusion. However, I think that the error message is quite helpful in this case:

```
sage: cartesian_product([A, E]); G
Traceback (most recent call last):
...
ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.
```

Mainly, this is because the cartesian product cannot decide which order to use in this case. Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.

>    - (continuation of b while reading the code): apparently, sets of variables of the factors must be equal or disjoint.


I've added this remark to the note-block in the docstring of the factory.

>    - mark doctests as indirect


Done.

> 10. `GenericProduct`: mark doctests as indirect.


Done.

> 11. Check links `~sage.sets.cartesian_product.CartesianProductPosets` and `sage.sets.cartesian_product.CartesianProductPosets.Element` (do not work for me, possibly time intensive recreation of documentation would help).


I corrected the links (we shifted some code in #18223), they work for me now -- however, that should not have affected you. (Sometimes, the documentation really wants to be built from scratch. `:-)`)

> 12. `GenericProduct._coerce_map_from_`: don't the factors coerce into the product?
> 
> ```
> sage: from sage.rings.asymptotic.growth_group import GrowthGroup
> sage: G = GrowthGroup('x^ZZ')
> sage: H = GrowthGroup('log(x)^ZZ')
> sage: K = cartesian_product([G, H])
> sage: K.has_coerce_map_from(G)
> False
> sage: K.has_coerce_map_from(H)
> False
> ```


No, not in general. However, due to our special structure (and as soon as we actually disallow copies of the same growth group in a cartesian product) this can be implemented. This should be handled in our coercion ticket, #19073.

> 13. Expand documentation of `UnivariateProduct` and `MultivariateProduct`: at least, include a link to `GenericProduct` and explain the choice of order.


Done.



---

archive/issue_comments_248763.json:
```json
{
    "body": "Replying to [comment:21 behackl]:\n> Replying to [comment:18 cheuberg]:\n> > 2. `Variable.__init__`: `ValueError` \"is not a valid name\": not tested\n  \n> \n> Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).\n\n\nI do not think so: `extract_variable_names` is only called when `repr is None`, the removed code was only called when `repr is not None`. Indeed, the following does now work:\n\n```\nsage: from sage.rings.asymptotic.growth_group import Variable\nsage: Variable(\"(:-)\", repr=\"icecream\").var_bases\n('(:-)',)\n```\n\n> > 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.\n  \n> \n> Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.\n\n\nI see.\n\nThe current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.\n\n\n\n> > 9. `CartesianProductFactory`:\n> >    - the example with \"do not have disjoint variables\" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.\n  \n> \n> I understand the confusion. However, I think that the error message is quite helpful in this case:\n> \n> ```\n> sage: cartesian_product([A, E]); G\n> Traceback (most recent call last):\n> ...\n> ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.\n> ```\n> \n> Mainly, this is because the cartesian product cannot decide which order to use in this case.\n\nperhaps rephrase error message along the lines of \"factors must have equal or disjoint variables\"?\n\n> Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.\n\n\nthat might be hard.",
    "created_at": "2015-09-29T07:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248763",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:21 behackl]:
> Replying to [comment:18 cheuberg]:
> > 2. `Variable.__init__`: `ValueError` "is not a valid name": not tested
  
> 
> Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).


I do not think so: `extract_variable_names` is only called when `repr is None`, the removed code was only called when `repr is not None`. Indeed, the following does now work:

```
sage: from sage.rings.asymptotic.growth_group import Variable
sage: Variable("(:-)", repr="icecream").var_bases
('(:-)',)
```

> > 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.
  
> 
> Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.


I see.

The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.



> > 9. `CartesianProductFactory`:
> >    - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.
  
> 
> I understand the confusion. However, I think that the error message is quite helpful in this case:
> 
> ```
> sage: cartesian_product([A, E]); G
> Traceback (most recent call last):
> ...
> ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.
> ```
> 
> Mainly, this is because the cartesian product cannot decide which order to use in this case.

perhaps rephrase error message along the lines of "factors must have equal or disjoint variables"?

> Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.


that might be hard.



---

archive/issue_comments_248764.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-29T07:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248764",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248765.json:
```json
{
    "body": "Replying to [comment:22 cheuberg]:\n> Replying to [comment:21 behackl]:\n> > Replying to [comment:18 cheuberg]:\n> > > 2. `Variable.__init__`: `ValueError` \"is not a valid name\": not tested\n  \n> > \n> > Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).\n\n> \n> I do not think so: `extract_variable_names` is only called when `repr is None`, the removed code was only called when `repr is not None`. Indeed, the following does now work:\n> \n> ```\n> sage: from sage.rings.asymptotic.growth_group import Variable\n> sage: Variable(\"(:-)\", repr=\"icecream\").var_bases\n> ('(:-)',)\n> ```\n> \n\n\nMea culpa, I misread the code. I've reverted the commit.\n\n> > > 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.\n  \n> > \n> > Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.\n\n> \n> I see.\n> \n> The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.\n> \n> \n\n\nMinor discrepancies like this are fixed on the cleanup ticket #19083. No need to introduce additional merge conflicts here.\n\n> \n> > > 9. `CartesianProductFactory`:\n> > >    - the example with \"do not have disjoint variables\" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.\n  \n> > \n> > I understand the confusion. However, I think that the error message is quite helpful in this case:\n> > \n> > ```\n> > sage: cartesian_product([A, E]); G\n> > Traceback (most recent call last):\n> > ...\n> > ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.\n> > ```\n> > \n> > Mainly, this is because the cartesian product cannot decide which order to use in this case.\n\n> perhaps rephrase error message along the lines of \"factors must have equal or disjoint variables\"?\n> \n\n\nDone; improved the error message.\n\n> > Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.\n\n> \n> that might be hard.\n> \n\n\nTurns out that this is very true. We will start with disallowing certain products like `x^ZZ * x^ZZ` and `x^ZZ * x^QQ` in the cleanup ticket. Altering the factory here only produces more merge conflicts with #19083 (the entire factory is rewritten there, meaning that the code would have to be written twice).\n\n---\nNew commits:",
    "created_at": "2015-09-29T08:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248765",
    "user": "https://github.com/behackl"
}
```

Replying to [comment:22 cheuberg]:
> Replying to [comment:21 behackl]:
> > Replying to [comment:18 cheuberg]:
> > > 2. `Variable.__init__`: `ValueError` "is not a valid name": not tested
  
> > 
> > Removed this particular piece of code; the check is not necessary: the parser only allows strings that are valid identifiers (see my answer to 3.).

> 
> I do not think so: `extract_variable_names` is only called when `repr is None`, the removed code was only called when `repr is not None`. Indeed, the following does now work:
> 
> ```
> sage: from sage.rings.asymptotic.growth_group import Variable
> sage: Variable("(:-)", repr="icecream").var_bases
> ('(:-)',)
> ```
> 


Mea culpa, I misread the code. I've reverted the commit.

> > > 7. `GrowthGroupFactory.create_key_and_extra_argument`: Again, my suggestion is to delegate the string parsing to the symbolic ring. Note that `SR('x^ZZ')` happily accepts `ZZ` as a variable, so I imagine that postprocessing here would not involve big problems. I do not read this string parser here before the decision on its eventual fate.
  
> > 
> > Unfortunately, I think that this should not be parsed by the symbolic ring: the cartesian product which we model with `*` is not commutative: if the same variable is used, the growth groups are ordered lexicographically. By using the symbolic ring, the input order might be destroyed/ignored.

> 
> I see.
> 
> The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.
> 
> 


Minor discrepancies like this are fixed on the cleanup ticket #19083. No need to introduce additional merge conflicts here.

> 
> > > 9. `CartesianProductFactory`:
> > >    - the example with "do not have disjoint variables" is somewhat puzzeling, because the cartesian product of `A` and `B` was allowed.
  
> > 
> > I understand the confusion. However, I think that the error message is quite helpful in this case:
> > 
> > ```
> > sage: cartesian_product([A, E]); G
> > Traceback (most recent call last):
> > ...
> > ValueError: Growth groups (Growth Group x^ZZ, Growth Group x^ZZ * y^ZZ) do not have pairwise disjoint variables.
> > ```
> > 
> > Mainly, this is because the cartesian product cannot decide which order to use in this case.

> perhaps rephrase error message along the lines of "factors must have equal or disjoint variables"?
> 


Done; improved the error message.

> > Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.

> 
> that might be hard.
> 


Turns out that this is very true. We will start with disallowing certain products like `x^ZZ * x^ZZ` and `x^ZZ * x^QQ` in the cleanup ticket. Altering the factory here only produces more merge conflicts with #19083 (the entire factory is rewritten there, meaning that the code would have to be written twice).

---
New commits:



---

archive/issue_comments_248766.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-29T08:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248766",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248767.json:
```json
{
    "body": "Replying to [comment:25 behackl]:\n> Replying to [comment:22 cheuberg]:\n> > The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.\n\n> \n> Minor discrepancies like this are fixed on the cleanup ticket #19083. No need to introduce additional merge conflicts here.\n\n\nok.\n\n> > > Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.\n\n> > \n> > that might be hard.\n> > \n\n> \n> Turns out that this is very true. We will start with disallowing certain products like `x^ZZ * x^ZZ` and `x^ZZ * x^QQ` in the cleanup ticket. Altering the factory here only produces more merge conflicts with #19083 (the entire factory is rewritten there, meaning that the code would have to be written twice).\n\n\nok.\n\nThis is a conditional positive review from my side: conditional on the dependency #18223.",
    "created_at": "2015-09-29T08:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248767",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:25 behackl]:
> Replying to [comment:22 cheuberg]:
> > The current code makes some effort to recognize `**` in `create_key_and_extra_args`, but `**` is not recognized in `create_object`.

> 
> Minor discrepancies like this are fixed on the cleanup ticket #19083. No need to introduce additional merge conflicts here.


ok.

> > > Also, I think that we should restrict building cartesian products of growth groups such that a factor may only occur once (currently, `x^ZZ * x^ZZ` is possible). I'll discuss this with Daniel.

> > 
> > that might be hard.
> > 

> 
> Turns out that this is very true. We will start with disallowing certain products like `x^ZZ * x^ZZ` and `x^ZZ * x^QQ` in the cleanup ticket. Altering the factory here only produces more merge conflicts with #19083 (the entire factory is rewritten there, meaning that the code would have to be written twice).


ok.

This is a conditional positive review from my side: conditional on the dependency #18223.



---

archive/issue_comments_248768.json:
```json
{
    "body": "Replying to [comment:26 cheuberg]:\n> This is a conditional positive review from my side: conditional on the dependency #18223.\n\n\nMerged in #18223 and adapted code. Please cross-review...and set it to positive ;)\n\n---\nNew commits:",
    "created_at": "2015-09-30T13:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248768",
    "user": "https://github.com/dkrenn"
}
```

Replying to [comment:26 cheuberg]:
> This is a conditional positive review from my side: conditional on the dependency #18223.


Merged in #18223 and adapted code. Please cross-review...and set it to positive ;)

---
New commits:



---

archive/issue_comments_248769.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-30T14:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248769",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248770.json:
```json
{
    "body": "Replying to [comment:28 dkrenn]:\n> Replying to [comment:26 cheuberg]:\n> > This is a conditional positive review from my side: conditional on the dependency #18223.\n\n> \n> Merged in #18223 and adapted code. Please cross-review...and set it to positive ;)\n\n\nDone.",
    "created_at": "2015-09-30T14:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248770",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:28 dkrenn]:
> Replying to [comment:26 cheuberg]:
> > This is a conditional positive review from my side: conditional on the dependency #18223.

> 
> Merged in #18223 and adapted code. Please cross-review...and set it to positive ;)


Done.



---

archive/issue_comments_248771.json:
```json
{
    "body": "This ticket depends on a \"duplicate\" ticket. It will not be merged until #18586 is merged, i.e. most likely never.",
    "created_at": "2015-10-20T22:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248771",
    "user": "https://github.com/vbraun"
}
```

This ticket depends on a "duplicate" ticket. It will not be merged until #18586 is merged, i.e. most likely never.



---

archive/issue_events_052193.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-10-21T16:55:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18350#event-52193"
}
```



---

archive/issue_comments_248772.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-21T16:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18350#issuecomment-248772",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
