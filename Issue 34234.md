# Issue 34234: Allow for tensor_product of a FiniteRankFreeModule dual

Issue created by migration from https://trac.sagemath.org/ticket/34471

Original creator: egourgoulhon

Original creation time: 2022-09-01 10:03:54

CC:  mkoeppe tscrim

Since Sage 9.7.rc0, `FiniteRankFreeModule`'s are endowed with a `tensor_product` method, thanks to #31276. However, this does not work with the dual:

```
sage: M = FiniteRankFreeModule(ZZ, 2, name='M')
sage: M.tensor_product(M.tensor_module(1,1))  # OK
Free module of type-(2,1) tensors on the Rank-2 free module M 
 over the Integer Ring
sage: M.tensor_product(M.dual())
...
AttributeError: 'ExtPowerDualFreeModule_with_category' object has 
 no attribute 'tensor_type'
```

The method `ExtPowerDualFreeModule.tensor_type` is implemented here, 
which fixes the issue:

```
sage: M.tensor_product(M.dual())
Free module of type-(1,1) tensors on the Rank-2 free module M 
 over the Integer Ring
```



---

Comment by egourgoulhon created at 2022-09-01 10:08:42

New commits:


---

Comment by egourgoulhon created at 2022-09-01 10:08:42

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-09-01 14:58:23

Is this needed when #34474 is merged?


---

Comment by mkoeppe created at 2022-09-01 15:36:39

I'd suggest to do #30241 (a separate implementation class for the dual) instead.


---

Comment by egourgoulhon created at 2022-09-01 16:54:28

Replying to [comment:3 mkoeppe]:
> Is this needed when #34474 is merged?
Only if you plan to do `M.tensor_product(M.tensor_module(0, 1))`. 
You well get an error then.


---

Comment by git created at 2022-09-02 09:51:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-09-02 09:55:46

Replying to [comment:4 mkoeppe]:
> I'd suggest to do #30241 (a separate implementation class for the dual) instead.
This makes sense. On the other hand, it does not harm to endow the classes `ExtPowerFreeModule` and `ExtPowerDualFreeModule` with a method `tensor_type()`. Even, this permits a slight simplification of the code of `TensorFreeModule._coerce_map_from_`, as shown in the latest commit.


---

Comment by mkoeppe created at 2022-09-02 15:44:07

Replying to [comment:7 egourgoulhon]:
> On the other hand, it does not harm to endow the classes `ExtPowerFreeModule` and `ExtPowerDualFreeModule` with a method `tensor_type()`.

It does make `tensor_product` return a wrong result instead of giving an error when one of the factors is an exterior power


---

Comment by mkoeppe created at 2022-09-02 20:57:48

I would propose to close this in favor of #30241


---

Comment by egourgoulhon created at 2022-09-02 21:38:12

Replying to [comment:8 mkoeppe]:
> Replying to [comment:7 egourgoulhon]:
> > On the other hand, it does not harm to endow the classes `ExtPowerFreeModule` and `ExtPowerDualFreeModule` with a method `tensor_type()`.
> 
> It does make `tensor_product` return a wrong result instead of giving an error when one of the factors is an exterior power
Ah yes!


---

Comment by egourgoulhon created at 2022-09-02 21:39:16

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2022-09-02 21:39:16

Replying to [comment:9 mkoeppe]:
> I would propose to close this in favor of #30241 
Agreed


---

Comment by mkoeppe created at 2022-11-14 19:36:43

Resolution: invalid
