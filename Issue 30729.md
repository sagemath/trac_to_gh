# Issue 30729: another wave of cleanup for pbori

Issue created by migration from https://trac.sagemath.org/ticket/30966

Original creator: chapoton

Original creation time: 2020-11-26 09:06:41

CC:  tscrim slelievre

after suggestions of lgtm and flake8


---

Comment by chapoton created at 2020-11-26 09:07:18

New commits:


---

Comment by chapoton created at 2020-11-26 09:07:18

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-11-27 10:54:11

bot is morally green, please review (should be rather easy)


---

Comment by slelievre created at 2020-11-27 13:06:13

Good changes.

Below are some ideas for further changes in the immediate
vicinity of proposed changes; but clearly out of scope,
and none needs be done here.

One could fix more mutable default arguments for the
`__init__` method of the class `Multiblock` in
`src/sage/rings/polynomial/pbori/blocks.py`... but
also elsewhere:


```bash
$ git grep "def .*=\[" .
```


One could refactor the `dimacs_encode_clause` method of the
`CNFEncoder` class in `src/sage/rings/polynomial/pbori/cnf.py`,
suppressing the auxiliary `get_sign` function and favouring
iterators over lists:


```diff
     def dimacs_encode_clause(self, c):
-        def get_sign(value):
-            if value == 1:
-                return 1
-            return -1
-
-        items = sorted(c.items(), reverse=True)
-        return " ".join([str(v) for v in [
-            get_sign(value) * self.to_dimacs_index(variable)
-            for (variable, value) in items] + [0]])
+        vv = (self.to_dimacs_index(variable) if value == 1
+              else -self.to_dimacs_index(variable)
+              for (variable, value) in sorted(c.items(), reverse=True))
+        return " ".join(str(v) for v in vv) + " 0"
```


In `src/sage/rings/polynomial/pbori/gbcore.py`, replacing
`_` by `_` in a string seems pointless... so maybe change:

```diff
     for key in options:
         newkey = key
-        for prefix in ['', 'use_', 'opt_allow_', 'opt_']:
+        for prefix in ['use_', 'opt_allow_', 'opt_']:
             newkey = newkey.replace(prefix, '')
         filtered[newkey] = options[key]
```



---

Comment by slelievre created at 2020-11-27 13:06:13

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-11-27 13:37:17

Salut,
en fait pbori est un bazar total, presque sans documentation, et c'est un code orphelin qui a été mis dans sage récemment, sans satisfaire aucun de nos critères habituels de qualité. Maintenant, quelqu'un doit nettoyer tout ça.


---

Comment by fbissey created at 2020-12-07 00:52:56

Replying to [comment:4 chapoton]:
> Salut,
> en fait pbori est un bazar total, presque sans documentation, et c'est un code orphelin qui a été mis dans sage récemment, sans satisfaire aucun de nos critères habituels de qualité. Maintenant, quelqu'un doit nettoyer tout ça.

Et tu peux pointer le doigt vers moi. Mais le code est mort autrement. Il a reçu bien plus d'attention depuis qu'il est dans sage que dans les 4 dernières années. J'est encore la responsabilité de la "library", 15 styles de code différents dans le même fichier sans problème, manque de documentation, tout a fait similaire :(


---

Comment by vbraun created at 2020-12-13 00:42:10

Resolution: fixed
