# Issue 30531: Restore deprecation warnings for imports from collections vs collections.abc

Issue created by migration from https://trac.sagemath.org/ticket/30768

Original creator: slelievre

Original creation time: 2020-10-13 22:28:40

Since #28012 we correctly import "collections
abstract base classes" from collections.abc.

This ticket is for the next step: unsilence the
corresponding deprecation warnings.

We postponed doing that since some of our dependencies
had not updated their imports yet.

See [#28012 - comment 23](https://trac.sagemath.org/ticket/28012#comment:23) for the discussion.


---

Comment by slelievre created at 2020-10-13 22:30:29

The required change is:


```diff
diff --git a/src/sage/all.py b/src/sage/all.py
--- a/src/sage/all.py
+++ b/src/sage/all.py
@@ -306,10 +306,6 @@ warnings.filters.remove(('ignore', None, DeprecationWarning, None, 0))
 # Ignore all deprecations from IPython etc.
 warnings.filterwarnings('ignore', category=DeprecationWarning,
     module='.*(IPython|ipykernel|jupyter_client|jupyter_core|nbformat|notebook|ipywidgets|storemagic)')
-# Ignore collections.abc warnings, there are a lot of them but they are
-# harmless.
-warnings.filterwarnings('ignore', category=DeprecationWarning,
-    message='.*collections[.]abc.*')
 # However, be sure to keep OUR deprecation warnings
 warnings.filterwarnings('default', category=DeprecationWarning,
     message=r'[\s\S]*See https\?://trac.sagemath.org/[0-9]* for details.')
```



---

Comment by chapoton created at 2020-10-14 18:48:38

voila une branche
----
New commits:


---

Comment by chapoton created at 2021-08-12 11:19:44

**urllib3** seems to be the main source of problems

EDIT:

but this seems to comes from **urllib3** from inside **requests**

updating **requests** seem to fix a lot of them

requests should be upgraded in #31280

EDIT:

updating **request** apparently fixes all doctests


---

Comment by mkoeppe created at 2021-08-12 20:26:44

The update of requests (with unvendored urllib3) is now split out to #32372


---

Comment by mkoeppe created at 2021-08-12 20:28:09

Rebased on top of #32372
----
New commits:


---

Comment by mkoeppe created at 2021-08-12 20:33:40

Have you tracked down what versions of urllib3 / requests did the fix? We will need to put corresponding version lower bounds into `build/pkgs/urllib3/install-requires.txt` and `build/pkgs/requests/install-requires.txt`


---

Comment by mkoeppe created at 2021-08-13 01:55:49

According to https://docs.python-requests.org/en/master/community/updates/#id11, `requests` 2.19.0 did "Migrate to using collections.abc for 3.7 compatibility"; 2.16.0 did the unvendoring of urllib3 etc. 
`requests` main branch sets the constraint urllib3>=1.21.1,<1.27 in  https://github.com/psf/requests/blob/main/setup.py; the lower bound has not changed since 2.16.0


---

Comment by git created at 2021-08-13 04:30:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slelievre created at 2021-08-29 21:30:26

Is this ready for review?


---

Comment by chapoton created at 2021-08-30 07:32:52

yes, but depending on #32372


---

Comment by chapoton created at 2021-09-14 11:42:26

now this should be ready to go


---

Comment by chapoton created at 2021-09-14 11:42:26

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-09-15 16:26:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-09-19 09:59:10

Resolution: fixed
