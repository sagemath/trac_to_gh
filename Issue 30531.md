# Issue 30531: Restore deprecation warnings for imports from collections vs collections.abc

archive/issues_030531.json:
```json
{
    "body": "Since #28012 we correctly import \"collections\nabstract base classes\" from collections.abc.\n\nThis ticket is for the next step: unsilence the\ncorresponding deprecation warnings.\n\nWe postponed doing that since some of our dependencies\nhad not updated their imports yet.\n\nSee [#28012 - comment 23](https://trac.sagemath.org/ticket/28012#comment:23) for the discussion.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30768\n\n",
    "created_at": "2020-10-13T22:28:40Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Restore deprecation warnings for imports from collections vs collections.abc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30531",
    "user": "https://github.com/slel"
}
```
Since #28012 we correctly import "collections
abstract base classes" from collections.abc.

This ticket is for the next step: unsilence the
corresponding deprecation warnings.

We postponed doing that since some of our dependencies
had not updated their imports yet.

See [#28012 - comment 23](https://trac.sagemath.org/ticket/28012#comment:23) for the discussion.

Issue created by migration from https://trac.sagemath.org/ticket/30768





---

archive/issue_comments_435531.json:
```json
{
    "body": "The required change is:\n\n\n```diff\ndiff --git a/src/sage/all.py b/src/sage/all.py\n--- a/src/sage/all.py\n+++ b/src/sage/all.py\n@@ -306,10 +306,6 @@ warnings.filters.remove(('ignore', None, DeprecationWarning, None, 0))\n # Ignore all deprecations from IPython etc.\n warnings.filterwarnings('ignore', category=DeprecationWarning,\n     module='.*(IPython|ipykernel|jupyter_client|jupyter_core|nbformat|notebook|ipywidgets|storemagic)')\n-# Ignore collections.abc warnings, there are a lot of them but they are\n-# harmless.\n-warnings.filterwarnings('ignore', category=DeprecationWarning,\n-    message='.*collections[.]abc.*')\n # However, be sure to keep OUR deprecation warnings\n warnings.filterwarnings('default', category=DeprecationWarning,\n     message=r'[\\s\\S]*See https\\?://trac.sagemath.org/[0-9]* for details.')\n```\n",
    "created_at": "2020-10-13T22:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435531",
    "user": "https://github.com/slel"
}
```

The required change is:


```diff
diff --git a/src/sage/all.py b/src/sage/all.py
--- a/src/sage/all.py
+++ b/src/sage/all.py
@@ -306,10 +306,6 @@ warnings.filters.remove(('ignore', None, DeprecationWarning, None, 0))
 # Ignore all deprecations from IPython etc.
 warnings.filterwarnings('ignore', category=DeprecationWarning,
     module='.*(IPython|ipykernel|jupyter_client|jupyter_core|nbformat|notebook|ipywidgets|storemagic)')
-# Ignore collections.abc warnings, there are a lot of them but they are
-# harmless.
-warnings.filterwarnings('ignore', category=DeprecationWarning,
-    message='.*collections[.]abc.*')
 # However, be sure to keep OUR deprecation warnings
 warnings.filterwarnings('default', category=DeprecationWarning,
     message=r'[\s\S]*See https\?://trac.sagemath.org/[0-9]* for details.')
```




---

archive/issue_comments_435532.json:
```json
{
    "body": "voila une branche\n----\nNew commits:",
    "created_at": "2020-10-14T18:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435532",
    "user": "https://github.com/fchapoton"
}
```

voila une branche
----
New commits:



---

archive/issue_comments_435533.json:
```json
{
    "body": "**urllib3** seems to be the main source of problems\n\nEDIT:\n\nbut this seems to comes from **urllib3** from inside **requests**\n\nupdating **requests** seem to fix a lot of them\n\nrequests should be upgraded in #31280\n\nEDIT:\n\nupdating **request** apparently fixes all doctests",
    "created_at": "2021-08-12T11:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435533",
    "user": "https://github.com/fchapoton"
}
```

**urllib3** seems to be the main source of problems

EDIT:

but this seems to comes from **urllib3** from inside **requests**

updating **requests** seem to fix a lot of them

requests should be upgraded in #31280

EDIT:

updating **request** apparently fixes all doctests



---

archive/issue_comments_435534.json:
```json
{
    "body": "The update of requests (with unvendored urllib3) is now split out to #32372",
    "created_at": "2021-08-12T20:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435534",
    "user": "https://github.com/mkoeppe"
}
```

The update of requests (with unvendored urllib3) is now split out to #32372



---

archive/issue_comments_435535.json:
```json
{
    "body": "Rebased on top of #32372\n----\nNew commits:",
    "created_at": "2021-08-12T20:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435535",
    "user": "https://github.com/mkoeppe"
}
```

Rebased on top of #32372
----
New commits:



---

archive/issue_comments_435536.json:
```json
{
    "body": "Have you tracked down what versions of urllib3 / requests did the fix? We will need to put corresponding version lower bounds into `build/pkgs/urllib3/install-requires.txt` and `build/pkgs/requests/install-requires.txt`",
    "created_at": "2021-08-12T20:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435536",
    "user": "https://github.com/mkoeppe"
}
```

Have you tracked down what versions of urllib3 / requests did the fix? We will need to put corresponding version lower bounds into `build/pkgs/urllib3/install-requires.txt` and `build/pkgs/requests/install-requires.txt`



---

archive/issue_comments_435537.json:
```json
{
    "body": "According to https://docs.python-requests.org/en/master/community/updates/#id11, `requests` 2.19.0 did \"Migrate to using collections.abc for 3.7 compatibility\"; 2.16.0 did the unvendoring of urllib3 etc. \n`requests` main branch sets the constraint urllib3>=1.21.1,<1.27 in  https://github.com/psf/requests/blob/main/setup.py; the lower bound has not changed since 2.16.0",
    "created_at": "2021-08-13T01:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435537",
    "user": "https://github.com/mkoeppe"
}
```

According to https://docs.python-requests.org/en/master/community/updates/#id11, `requests` 2.19.0 did "Migrate to using collections.abc for 3.7 compatibility"; 2.16.0 did the unvendoring of urllib3 etc. 
`requests` main branch sets the constraint urllib3>=1.21.1,<1.27 in  https://github.com/psf/requests/blob/main/setup.py; the lower bound has not changed since 2.16.0



---

archive/issue_comments_435538.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-13T04:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_435539.json:
```json
{
    "body": "Is this ready for review?",
    "created_at": "2021-08-29T21:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435539",
    "user": "https://github.com/slel"
}
```

Is this ready for review?



---

archive/issue_comments_435540.json:
```json
{
    "body": "yes, but depending on #32372",
    "created_at": "2021-08-30T07:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435540",
    "user": "https://github.com/fchapoton"
}
```

yes, but depending on #32372



---

archive/issue_comments_435541.json:
```json
{
    "body": "now this should be ready to go",
    "created_at": "2021-09-14T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435541",
    "user": "https://github.com/fchapoton"
}
```

now this should be ready to go



---

archive/issue_comments_435542.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-14T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435542",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_435543.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-15T16:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435543",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_435544.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-19T09:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-435544",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_028037.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-09-19T09:59:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30531#event-28037"
}
```
