# Issue 24877: Cannot plot Cone that is a halfplane in 2d

archive/issues_024877.json:
```json
{
    "body": "CC:  novoselt jipilab mkoeppe mjo\n\nKeywords: Cone, plot\n\n\n```\nsage: halfplane = Cone([(1,0), (0,1), (-1,0)])\nsage: halfplane.plot() \n```\n\nraises `UnboundLocalError`: local variable 'r1' referenced before assignment.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25114\n\n",
    "created_at": "2018-04-06T22:46:09Z",
    "labels": [
        "geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Cannot plot Cone that is a halfplane in 2d",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24877",
    "user": "yzh"
}
```
CC:  novoselt jipilab mkoeppe mjo

Keywords: Cone, plot


```
sage: halfplane = Cone([(1,0), (0,1), (-1,0)])
sage: halfplane.plot() 
```

raises `UnboundLocalError`: local variable 'r1' referenced before assignment.

Issue created by migration from https://trac.sagemath.org/ticket/25114





---

archive/issue_comments_349623.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-07T21:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349623",
    "user": "yzh"
}
```

New commits:



---

archive/issue_comments_349624.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-07T21:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349624",
    "user": "yzh"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_349625.json:
```json
{
    "body": "Changing keywords from \"Cone, plot\" to \"Cone, plot, IMA-PolyGeom\".",
    "created_at": "2018-04-07T21:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349625",
    "user": "yzh"
}
```

Changing keywords from "Cone, plot" to "Cone, plot, IMA-PolyGeom".



---

archive/issue_comments_349626.json:
```json
{
    "body": "While this may fix the plotting issue, it hides the real problem:\n\n```\nsage: N = ToricLattice(2); N\n2-d lattice N\nsage: NQ = N.base_extend(QQ); NQ\nVector space of dimension 2 over Rational Field\nsage: r = N.gen(0); r\nN(1, 0)\nsage: S = N.submodule([r]); S\nSublattice <N(1, 0)>\nsage: SQ = S.base_extend(QQ); SQ\n \nVector space of degree 2 and dimension 1 over Rational Field\nBasis matrix:\n[1 0]\nsage: r in N, r in NQ\n(True, True)\nsage: r in S, r in SQ\n(True, False)\n```\n\nWhy is there this difference in behaviour of vector spaces and subspaces? The original code likely worked for halfplanes when it was written and there is no reason for it to stop.",
    "created_at": "2018-04-07T23:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349626",
    "user": "novoselt"
}
```

While this may fix the plotting issue, it hides the real problem:

```
sage: N = ToricLattice(2); N
2-d lattice N
sage: NQ = N.base_extend(QQ); NQ
Vector space of dimension 2 over Rational Field
sage: r = N.gen(0); r
N(1, 0)
sage: S = N.submodule([r]); S
Sublattice <N(1, 0)>
sage: SQ = S.base_extend(QQ); SQ
 
Vector space of degree 2 and dimension 1 over Rational Field
Basis matrix:
[1 0]
sage: r in N, r in NQ
(True, True)
sage: r in S, r in SQ
(True, False)
```

Why is there this difference in behaviour of vector spaces and subspaces? The original code likely worked for halfplanes when it was written and there is no reason for it to stop.



---

archive/issue_comments_349627.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-07T23:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349627",
    "user": "novoselt"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_349628.json:
```json
{
    "body": "Replying to [comment:3 novoselt]:\n> While this may fix the plotting issue, it hides the real problem:\n> {{{\n> sage: N = ToricLattice(2); N\n> 2-d lattice N\n> sage: NQ = N.base_extend(QQ); NQ\n> Vector space of dimension 2 over Rational Field\n> sage: r = N.gen(0); r\n> N(1, 0)\n> sage: S = N.submodule([r]); S\n> Sublattice <N(1, 0)>\n> sage: SQ = S.base_extend(QQ); SQ\n>  \n> Vector space of degree 2 and dimension 1 over Rational Field\n> Basis matrix:\n> [1 0]\n> sage: r in N, r in NQ\n> (True, True)\n> sage: r in S, r in SQ\n> (True, False)\n> }}}\n> Why is there this difference in behaviour of vector spaces and subspaces? The original code likely worked for halfplanes when it was written and there is no reason for it to stop.\n\nLooking at the file `src/sage/structure/parent.pyx` in the `__contains__` function, it returns `False` because:\n\n\n```\nsage: type(r)\n<class 'sage.geometry.toric_lattice_element.ToricLatticeElement'>\nsage: r2 = SQ(r); r2\n(1, 0)\nsage: type(r2)\n<class 'sage.modules.vector_rational_dense.Vector_rational_dense'>\n```\n\n\nand\n\n```\nsage: r2 == r\nFalse\n```\n\n\nNow, should this return `True`? I am not sure how to fix this...",
    "created_at": "2020-03-01T12:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349628",
    "user": "jipilab"
}
```

Replying to [comment:3 novoselt]:
> While this may fix the plotting issue, it hides the real problem:
> {{{
> sage: N = ToricLattice(2); N
> 2-d lattice N
> sage: NQ = N.base_extend(QQ); NQ
> Vector space of dimension 2 over Rational Field
> sage: r = N.gen(0); r
> N(1, 0)
> sage: S = N.submodule([r]); S
> Sublattice <N(1, 0)>
> sage: SQ = S.base_extend(QQ); SQ
>  
> Vector space of degree 2 and dimension 1 over Rational Field
> Basis matrix:
> [1 0]
> sage: r in N, r in NQ
> (True, True)
> sage: r in S, r in SQ
> (True, False)
> }}}
> Why is there this difference in behaviour of vector spaces and subspaces? The original code likely worked for halfplanes when it was written and there is no reason for it to stop.

Looking at the file `src/sage/structure/parent.pyx` in the `__contains__` function, it returns `False` because:


```
sage: type(r)
<class 'sage.geometry.toric_lattice_element.ToricLatticeElement'>
sage: r2 = SQ(r); r2
(1, 0)
sage: type(r2)
<class 'sage.modules.vector_rational_dense.Vector_rational_dense'>
```


and

```
sage: r2 == r
False
```


Now, should this return `True`? I am not sure how to fix this...



---

archive/issue_comments_349629.json:
```json
{
    "body": "pushing these forward to 9.2",
    "created_at": "2020-04-14T06:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349629",
    "user": "mkoeppe"
}
```

pushing these forward to 9.2



---

archive/issue_comments_349630.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349630",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_349631.json:
```json
{
    "body": "Is it possible to make the plotting work at least? It's a bit annoying to have encountered this same error after each reinstallation of Sage.",
    "created_at": "2021-03-25T05:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349631",
    "user": "yzh"
}
```

Is it possible to make the plotting work at least? It's a bit annoying to have encountered this same error after each reinstallation of Sage.



---

archive/issue_comments_349632.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-25T07:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349632",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_349633.json:
```json
{
    "body": "Replying to [comment:9 yzh]:\n> Is it possible to make the plotting work at least? It's a bit annoying to have encountered this same error after each reinstallation of Sage.\n\nI was juuuust about to agree with you. But the underlying problem here is serious. Equality is not transitive:\n\n\n```\nsage: N = ToricLattice(2)                                                       \nsage: NQ = N.base_extend(QQ)                                                    \nsage: r = N.gen(0)                                                              \nsage: S = N.submodule([r])                                                      \nsage: SQ = S.base_extend(QQ)                                                    \nsage: r == S(r)                                                                 \nTrue\nsage: S(r) == SQ(r)                                                             \nTrue\nsage: r == SQ(r)                                                                \nFalse\n```\n",
    "created_at": "2021-03-25T12:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349633",
    "user": "mjo"
}
```

Replying to [comment:9 yzh]:
> Is it possible to make the plotting work at least? It's a bit annoying to have encountered this same error after each reinstallation of Sage.

I was juuuust about to agree with you. But the underlying problem here is serious. Equality is not transitive:


```
sage: N = ToricLattice(2)                                                       
sage: NQ = N.base_extend(QQ)                                                    
sage: r = N.gen(0)                                                              
sage: S = N.submodule([r])                                                      
sage: SQ = S.base_extend(QQ)                                                    
sage: r == S(r)                                                                 
True
sage: S(r) == SQ(r)                                                             
True
sage: r == SQ(r)                                                                
False
```




---

archive/issue_comments_349634.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24877",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24877#issuecomment-349634",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
