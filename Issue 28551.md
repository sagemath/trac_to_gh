# Issue 28551: MR38: Fix documentation of spkg-configure.m4 and make output more verbose

Issue created by migration from https://trac.sagemath.org/ticket/28788

Original creator: galois

Original creation time: 2019-11-22 15:09:48

CC:  embray jhpalmieri mkoeppe

Julian RÃ¼th ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/38:
----









---

Comment by saraedum created at 2019-11-22 15:13:49

Changing component from PLEASE CHANGE to build: configure.


---

Comment by saraedum created at 2019-11-22 15:13:49

Changing type from PLEASE CHANGE to enhancement.


---

Comment by saraedum created at 2019-11-22 15:13:49

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2019-11-22 15:13:49

Changing priority from major to minor.


---

Comment by galois created at 2019-11-22 15:22:34

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2019-11-22 15:25:19

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2019-11-22 15:28:22

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by saraedum created at 2019-11-22 15:33:09

I made some remarks on [GitLab](GitLab). Looking forward to comments at https://gitlab.com/sagemath/sage/merge_requests/38.


---

Comment by jhpalmieri created at 2019-11-22 22:04:03

`config.log` is still misleading:

```
result: no
no suitable system package found for SPKG rw
configure:20250: make will build and install the following SPKGs...
     4ti2-1.6.7.p0
     alabaster-0.7.12
     appnope-0.1.0.p0
     arb-2.16.0.p0 (no suitable system package)
     atlas-3.10.2.p3
     ...
     bzip2-1.0.6-20150304.p0 (using system package; will not be installed)
     ...
```

`4ti2` and `atlas` are optional, and so they will not in fact be installed unless explicitly instructed via a command like `make 4ti2`. The package `bzip2` is listed in this group of packages that `make` will build and installed, but with a note saying that it won't be installed. (Note also that `make bzip2` will install `bzip2`, even though there is a valid system package.)

Also it would help to have a divider between the last test ("no suitable system package found for SPKG rw") and the start of the summary.

I would prefer to see something like

```
checking for library containing calculate_level... no
configure: no suitable system package found for SPKG rw
------------
configure: build status for each package:
   4ti2-1.6.7.p0: optional; not installed by default
   alabaster-0.7.12: will be installed
   appnope-0.1.0.p0: will be installed
   arb-2.16.0.p0: no suitable system package; will be installed
   atlas-3.10.2.p3: optional; not installed by default
   ...
   bzip2-1.0.6-20150304.p0: using system package; will not be installed
   ...
```



---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-01-22 22:16:32

Related: #28095 - Add `--enable-OPTIONALSPKG` options to configure


---

Comment by galois created at 2020-02-06 21:38:16

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by galois created at 2020-02-06 21:46:35

New commits added to merge request.  I updated the commit SHA-1.  New commits:


---

Comment by mkoeppe created at 2020-02-06 22:08:22

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2020-02-06 22:08:22

This is a great improvement and seems to work fine on top of current develop.
I'm setting this to positive review, although I have suggestions for improvements:

- I find the trailing "##" quite distracting.
- The final output would look much cleaner if tabulated
- For standard packages without `spkg-configure.m4` it says;
  {{{
  testpath-0.4.2: does not support check for system package yet; will be installed
  }}}
  even if it is already installed; whereas for those with `spkg-configure.m4` it says
  {{{
  zeromq-4.2.5: already installed
  }}}
- Perhaps it should also be pointed out that "some" version is installed (but `make` may install a different version).


---

Comment by jhpalmieri created at 2020-02-07 05:03:05

Changing status from positive_review to needs_work.


---

Comment by jhpalmieri created at 2020-02-07 05:03:05

I get a merge failure with 9.1.beta3. Once fixed, please feel free to set back to positive review.


---

Comment by jhpalmieri created at 2020-02-07 05:16:18

Actually, I have another request. The output in the ticket description, including

```
configure: will use system package and not install SPKG zeromq
## ------------------------------ ##
## build status for each package: ##
## ------------------------------ ##
    4ti2-1.6.7.p0: does not support check for system package yet; optional, will not be installed unless requested
```

is what is printed on the screen, but the `config.log` file shows

```
configure:25323: will use system package and not install SPKG zeromq
configure:28740: result:     4ti2-1.6.7.p0: does not support check for system package yet; optional, will not be installed unless requested
```

with no text separating the last test from the summary. Can you add some text there so I can easily search `config.log` to find the spot where the summary starts?

Indeed, perhaps all of the summary text ("checking whether [SageMath](SageMath) should install SPKG tachyon", etc.) should be included in the log file, not just on the screen.


---

Comment by jhpalmieri created at 2020-02-07 17:52:06

To explain a bit more about my last comment: I am much more likely to look through the log file than to see the mass of text whiz by on the screen, so (assuming I'm not the only one) the log file should have formatting at least as good as what's on the screen.


---

Comment by mkoeppe created at 2020-02-07 20:48:26

I agree, everything that is printed on the screen should also appear in the log file.


---

Comment by saraedum created at 2020-02-07 21:51:32

I won't continue on this one. If you are unhappy with autoconf defaults, feel free to work around them.


---

Comment by jhpalmieri created at 2020-02-08 06:12:13

mkoeppe: I don't know autoconf syntax, but if you can do the last fixes, I can review.


---

Comment by git created at 2020-02-09 21:58:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-02-09 22:02:17

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-02-09 22:07:37

Replying to [comment:23 jhpalmieri]:
> mkoeppe: I don't know autoconf syntax, but if you can do the last fixes, I can review.
Ready for review.


---

Comment by jhpalmieri created at 2020-02-09 22:32:51

Looks good to me, thanks! And thanks very much to saraedum for leading the efforts on this. Sorry to be so picky.


---

Comment by jhpalmieri created at 2020-02-09 22:33:36

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-02-09 22:35:58

Thank you!


---

Comment by vbraun created at 2020-02-11 21:06:00

Resolution: fixed


---

Comment by mkoeppe created at 2020-02-17 01:25:17

Follow up: #29211
