# Issue 28551: MR38: Fix documentation of spkg-configure.m4 and make output more verbose

archive/issues_028551.json:
```json
{
    "body": "CC:  embray jhpalmieri mkoeppe\n\nJulian R\u00fcth ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/38:\n----\n\n\n\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28788\n\n",
    "created_at": "2019-11-22T15:09:48Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "MR38: Fix documentation of spkg-configure.m4 and make output more verbose",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28551",
    "user": "galois"
}
```
CC:  embray jhpalmieri mkoeppe

Julian RÃ¼th ([`@`saraedum](https://gitlab.com/saraedum)) opened a merge request at https://gitlab.com/sagemath/sage/merge_requests/38:
----








Issue created by migration from https://trac.sagemath.org/ticket/28788





---

archive/issue_comments_403148.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build: configure.",
    "created_at": "2019-11-22T15:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403148",
    "user": "saraedum"
}
```

Changing component from PLEASE CHANGE to build: configure.



---

archive/issue_comments_403149.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-11-22T15:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403149",
    "user": "saraedum"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_403150.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-22T15:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403150",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_403151.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2019-11-22T15:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403151",
    "user": "saraedum"
}
```

Changing priority from major to minor.



---

archive/issue_comments_403152.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2019-11-22T15:22:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403152",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_403153.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2019-11-22T15:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403153",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_403154.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2019-11-22T15:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403154",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_403155.json:
```json
{
    "body": "I made some remarks on [GitLab](GitLab). Looking forward to comments at https://gitlab.com/sagemath/sage/merge_requests/38.",
    "created_at": "2019-11-22T15:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403155",
    "user": "saraedum"
}
```

I made some remarks on [GitLab](GitLab). Looking forward to comments at https://gitlab.com/sagemath/sage/merge_requests/38.



---

archive/issue_comments_403156.json:
```json
{
    "body": "`config.log` is still misleading:\n\n```\nresult: no\nno suitable system package found for SPKG rw\nconfigure:20250: make will build and install the following SPKGs...\n     4ti2-1.6.7.p0\n     alabaster-0.7.12\n     appnope-0.1.0.p0\n     arb-2.16.0.p0 (no suitable system package)\n     atlas-3.10.2.p3\n     ...\n     bzip2-1.0.6-20150304.p0 (using system package; will not be installed)\n     ...\n```\n\n`4ti2` and `atlas` are optional, and so they will not in fact be installed unless explicitly instructed via a command like `make 4ti2`. The package `bzip2` is listed in this group of packages that `make` will build and installed, but with a note saying that it won't be installed. (Note also that `make bzip2` will install `bzip2`, even though there is a valid system package.)\n\nAlso it would help to have a divider between the last test (\"no suitable system package found for SPKG rw\") and the start of the summary.\n\nI would prefer to see something like\n\n```\nchecking for library containing calculate_level... no\nconfigure: no suitable system package found for SPKG rw\n------------\nconfigure: build status for each package:\n   4ti2-1.6.7.p0: optional; not installed by default\n   alabaster-0.7.12: will be installed\n   appnope-0.1.0.p0: will be installed\n   arb-2.16.0.p0: no suitable system package; will be installed\n   atlas-3.10.2.p3: optional; not installed by default\n   ...\n   bzip2-1.0.6-20150304.p0: using system package; will not be installed\n   ...\n```\n",
    "created_at": "2019-11-22T22:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403156",
    "user": "jhpalmieri"
}
```

`config.log` is still misleading:

```
result: no
no suitable system package found for SPKG rw
configure:20250: make will build and install the following SPKGs...
     4ti2-1.6.7.p0
     alabaster-0.7.12
     appnope-0.1.0.p0
     arb-2.16.0.p0 (no suitable system package)
     atlas-3.10.2.p3
     ...
     bzip2-1.0.6-20150304.p0 (using system package; will not be installed)
     ...
```

`4ti2` and `atlas` are optional, and so they will not in fact be installed unless explicitly instructed via a command like `make 4ti2`. The package `bzip2` is listed in this group of packages that `make` will build and installed, but with a note saying that it won't be installed. (Note also that `make bzip2` will install `bzip2`, even though there is a valid system package.)

Also it would help to have a divider between the last test ("no suitable system package found for SPKG rw") and the start of the summary.

I would prefer to see something like

```
checking for library containing calculate_level... no
configure: no suitable system package found for SPKG rw
------------
configure: build status for each package:
   4ti2-1.6.7.p0: optional; not installed by default
   alabaster-0.7.12: will be installed
   appnope-0.1.0.p0: will be installed
   arb-2.16.0.p0: no suitable system package; will be installed
   atlas-3.10.2.p3: optional; not installed by default
   ...
   bzip2-1.0.6-20150304.p0: using system package; will not be installed
   ...
```




---

archive/issue_comments_403157.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403157",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_403158.json:
```json
{
    "body": "Related: #28095 - Add `--enable-OPTIONALSPKG` options to configure",
    "created_at": "2020-01-22T22:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403158",
    "user": "mkoeppe"
}
```

Related: #28095 - Add `--enable-OPTIONALSPKG` options to configure



---

archive/issue_comments_403159.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2020-02-06T21:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403159",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_403160.json:
```json
{
    "body": "New commits added to merge request.  I updated the commit SHA-1.  New commits:",
    "created_at": "2020-02-06T21:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403160",
    "user": "galois"
}
```

New commits added to merge request.  I updated the commit SHA-1.  New commits:



---

archive/issue_comments_403161.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-02-06T22:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403161",
    "user": "mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_403162.json:
```json
{
    "body": "This is a great improvement and seems to work fine on top of current develop.\nI'm setting this to positive review, although I have suggestions for improvements:\n\n- I find the trailing \"##\" quite distracting.\n- The final output would look much cleaner if tabulated\n- For standard packages without `spkg-configure.m4` it says;\n  {{{\n  testpath-0.4.2: does not support check for system package yet; will be installed\n  }}}\n  even if it is already installed; whereas for those with `spkg-configure.m4` it says\n  {{{\n  zeromq-4.2.5: already installed\n  }}}\n- Perhaps it should also be pointed out that \"some\" version is installed (but `make` may install a different version).",
    "created_at": "2020-02-06T22:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403162",
    "user": "mkoeppe"
}
```

This is a great improvement and seems to work fine on top of current develop.
I'm setting this to positive review, although I have suggestions for improvements:

- I find the trailing "##" quite distracting.
- The final output would look much cleaner if tabulated
- For standard packages without `spkg-configure.m4` it says;
  {{{
  testpath-0.4.2: does not support check for system package yet; will be installed
  }}}
  even if it is already installed; whereas for those with `spkg-configure.m4` it says
  {{{
  zeromq-4.2.5: already installed
  }}}
- Perhaps it should also be pointed out that "some" version is installed (but `make` may install a different version).



---

archive/issue_comments_403163.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-02-07T05:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403163",
    "user": "jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_403164.json:
```json
{
    "body": "I get a merge failure with 9.1.beta3. Once fixed, please feel free to set back to positive review.",
    "created_at": "2020-02-07T05:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403164",
    "user": "jhpalmieri"
}
```

I get a merge failure with 9.1.beta3. Once fixed, please feel free to set back to positive review.



---

archive/issue_comments_403165.json:
```json
{
    "body": "Actually, I have another request. The output in the ticket description, including\n\n```\nconfigure: will use system package and not install SPKG zeromq\n## ------------------------------ ##\n## build status for each package: ##\n## ------------------------------ ##\n    4ti2-1.6.7.p0: does not support check for system package yet; optional, will not be installed unless requested\n```\n\nis what is printed on the screen, but the `config.log` file shows\n\n```\nconfigure:25323: will use system package and not install SPKG zeromq\nconfigure:28740: result:     4ti2-1.6.7.p0: does not support check for system package yet; optional, will not be installed unless requested\n```\n\nwith no text separating the last test from the summary. Can you add some text there so I can easily search `config.log` to find the spot where the summary starts?\n\nIndeed, perhaps all of the summary text (\"checking whether [SageMath](SageMath) should install SPKG tachyon\", etc.) should be included in the log file, not just on the screen.",
    "created_at": "2020-02-07T05:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403165",
    "user": "jhpalmieri"
}
```

Actually, I have another request. The output in the ticket description, including

```
configure: will use system package and not install SPKG zeromq
## ------------------------------ ##
## build status for each package: ##
## ------------------------------ ##
    4ti2-1.6.7.p0: does not support check for system package yet; optional, will not be installed unless requested
```

is what is printed on the screen, but the `config.log` file shows

```
configure:25323: will use system package and not install SPKG zeromq
configure:28740: result:     4ti2-1.6.7.p0: does not support check for system package yet; optional, will not be installed unless requested
```

with no text separating the last test from the summary. Can you add some text there so I can easily search `config.log` to find the spot where the summary starts?

Indeed, perhaps all of the summary text ("checking whether [SageMath](SageMath) should install SPKG tachyon", etc.) should be included in the log file, not just on the screen.



---

archive/issue_comments_403166.json:
```json
{
    "body": "To explain a bit more about my last comment: I am much more likely to look through the log file than to see the mass of text whiz by on the screen, so (assuming I'm not the only one) the log file should have formatting at least as good as what's on the screen.",
    "created_at": "2020-02-07T17:52:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403166",
    "user": "jhpalmieri"
}
```

To explain a bit more about my last comment: I am much more likely to look through the log file than to see the mass of text whiz by on the screen, so (assuming I'm not the only one) the log file should have formatting at least as good as what's on the screen.



---

archive/issue_comments_403167.json:
```json
{
    "body": "I agree, everything that is printed on the screen should also appear in the log file.",
    "created_at": "2020-02-07T20:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403167",
    "user": "mkoeppe"
}
```

I agree, everything that is printed on the screen should also appear in the log file.



---

archive/issue_comments_403168.json:
```json
{
    "body": "I won't continue on this one. If you are unhappy with autoconf defaults, feel free to work around them.",
    "created_at": "2020-02-07T21:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403168",
    "user": "saraedum"
}
```

I won't continue on this one. If you are unhappy with autoconf defaults, feel free to work around them.



---

archive/issue_comments_403169.json:
```json
{
    "body": "mkoeppe: I don't know autoconf syntax, but if you can do the last fixes, I can review.",
    "created_at": "2020-02-08T06:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403169",
    "user": "jhpalmieri"
}
```

mkoeppe: I don't know autoconf syntax, but if you can do the last fixes, I can review.



---

archive/issue_comments_403170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-09T21:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403170",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_403171.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-09T22:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403171",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_403172.json:
```json
{
    "body": "Replying to [comment:23 jhpalmieri]:\n> mkoeppe: I don't know autoconf syntax, but if you can do the last fixes, I can review.\nReady for review.",
    "created_at": "2020-02-09T22:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403172",
    "user": "mkoeppe"
}
```

Replying to [comment:23 jhpalmieri]:
> mkoeppe: I don't know autoconf syntax, but if you can do the last fixes, I can review.
Ready for review.



---

archive/issue_comments_403173.json:
```json
{
    "body": "Looks good to me, thanks! And thanks very much to saraedum for leading the efforts on this. Sorry to be so picky.",
    "created_at": "2020-02-09T22:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403173",
    "user": "jhpalmieri"
}
```

Looks good to me, thanks! And thanks very much to saraedum for leading the efforts on this. Sorry to be so picky.



---

archive/issue_comments_403174.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-09T22:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403174",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_403175.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-02-09T22:35:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403175",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_403176.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-11T21:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403176",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_403177.json:
```json
{
    "body": "Follow up: #29211",
    "created_at": "2020-02-17T01:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28551#issuecomment-403177",
    "user": "mkoeppe"
}
```

Follow up: #29211
