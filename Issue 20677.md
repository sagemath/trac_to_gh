# Issue 20677: Upgrade to GAP 4.8.4

archive/issues_020677.json:
```json
{
    "body": "CC:  @dimpase @kiwifb @vbraun @jdemeyer @tscrim\n\nGAP 4.8.4 was released on 2016-06-04.\n\nRelease announcement:\nhttp://mail.gap-system.org/pipermail/forum/2016/005253.html\n\nGAP 4.8.4 page\nhttp://gap-system.org/Releases/4.8.4.html\n\nChangelog:\nhttp://www.gap-system.org/Manuals/doc/changes/chap2.html#X85F7B6F17D29A589\n\nIssue created by migration from https://trac.sagemath.org/ticket/20914\n\n",
    "created_at": "2016-06-30T21:30:12Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Upgrade to GAP 4.8.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20677",
    "user": "https://github.com/slel"
}
```
CC:  @dimpase @kiwifb @vbraun @jdemeyer @tscrim

GAP 4.8.4 was released on 2016-06-04.

Release announcement:
http://mail.gap-system.org/pipermail/forum/2016/005253.html

GAP 4.8.4 page
http://gap-system.org/Releases/4.8.4.html

Changelog:
http://www.gap-system.org/Manuals/doc/changes/chap2.html#X85F7B6F17D29A589

Issue created by migration from https://trac.sagemath.org/ticket/20914





---

archive/issue_events_056025.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2017-01-07T10:48:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "milestone": "sage-7.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20677#event-56025"
}
```



---

archive/issue_comments_285272.json:
```json
{
    "body": "Debian has patches for 4.8.6 update of libgap and gap, see\nhttps://groups.google.com/d/msg/sage-packaging/O2PAsuAELMA/vKCdnu3RBAAJ\n\nso we just should take them. Due to miscommunication with the Debian people, I only found out by chance, as I saw them asking what a GAP-related Sage doctest would output for GAP 4.8.6 in place of 4.8.3 :-)",
    "created_at": "2017-01-22T09:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285272",
    "user": "https://github.com/dimpase"
}
```

Debian has patches for 4.8.6 update of libgap and gap, see
https://groups.google.com/d/msg/sage-packaging/O2PAsuAELMA/vKCdnu3RBAAJ

so we just should take them. Due to miscommunication with the Debian people, I only found out by chance, as I saw them asking what a GAP-related Sage doctest would output for GAP 4.8.6 in place of 4.8.3 :-)



---

archive/issue_comments_285273.json:
```json
{
    "body": "a 1st try for update; already includes the patch from #22116, but still needs few doctest fixes, due to changes in random sources, mostly.",
    "created_at": "2017-01-23T19:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285273",
    "user": "https://github.com/dimpase"
}
```

a 1st try for update; already includes the patch from #22116, but still needs few doctest fixes, due to changes in random sources, mostly.



---

archive/issue_comments_285274.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-23T23:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285275.json:
```json
{
    "body": "libgap is built using [modified upstream](https://bitbucket.org/vbraun/libgap/pull-requests/12) with manually adding `src/libgap.map` to the tarball as mentioned [here](https://bitbucket.org/lfos/libgap/issues/1). A proper (upstream) fix should be via automake config, I presume.",
    "created_at": "2017-01-23T23:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285275",
    "user": "https://github.com/dimpase"
}
```

libgap is built using [modified upstream](https://bitbucket.org/vbraun/libgap/pull-requests/12) with manually adding `src/libgap.map` to the tarball as mentioned [here](https://bitbucket.org/lfos/libgap/issues/1). A proper (upstream) fix should be via automake config, I presume.



---

archive/issue_comments_285276.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-24T10:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285277.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-01-24T10:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285277",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_285278.json:
```json
{
    "body": "What do you expect from me? As I mentioned on #22116, I disagree with `build/pkgs/gap_packages/patches/guava_leon.patch`",
    "created_at": "2017-01-24T10:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285278",
    "user": "https://github.com/jdemeyer"
}
```

What do you expect from me? As I mentioned on #22116, I disagree with `build/pkgs/gap_packages/patches/guava_leon.patch`



---

archive/issue_comments_285279.json:
```json
{
    "body": "I also wonder why you need the change to `build/pkgs/database_gap/spkg-install`. I don't know enough about GAP to know when `gap_reset_workspace()` is needed, but I think that you should give justification for that removal.",
    "created_at": "2017-01-24T10:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285279",
    "user": "https://github.com/jdemeyer"
}
```

I also wonder why you need the change to `build/pkgs/database_gap/spkg-install`. I don't know enough about GAP to know when `gap_reset_workspace()` is needed, but I think that you should give justification for that removal.



---

archive/issue_comments_285280.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> What do you expect from me? As I mentioned on #22116, I disagree with `build/pkgs/gap_packages/patches/guava_leon.patch`\n\n\nThis is now [upstream](https://github.com/osj1961/guava/commit/e688be9144820efc11f09cd1080b39e59689ea27) and will be in the next release of Guava.",
    "created_at": "2017-01-24T11:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285280",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:9 jdemeyer]:
> What do you expect from me? As I mentioned on #22116, I disagree with `build/pkgs/gap_packages/patches/guava_leon.patch`


This is now [upstream](https://github.com/osj1961/guava/commit/e688be9144820efc11f09cd1080b39e59689ea27) and will be in the next release of Guava.



---

archive/issue_comments_285281.json:
```json
{
    "body": "Replying to [comment:11 dimpase]:\n> Replying to [comment:9 jdemeyer]:\n> > What do you expect from me? As I mentioned on #22116, I disagree with `build/pkgs/gap_packages/patches/guava_leon.patch`\n\n> \n> This is now upstream and will be in the next release of Guava.\n\n\nThen please update the patch file with a pointer to upstream. For reference, also add it on this Trac page.",
    "created_at": "2017-01-24T11:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285281",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 dimpase]:
> Replying to [comment:9 jdemeyer]:
> > What do you expect from me? As I mentioned on #22116, I disagree with `build/pkgs/gap_packages/patches/guava_leon.patch`

> 
> This is now upstream and will be in the next release of Guava.


Then please update the patch file with a pointer to upstream. For reference, also add it on this Trac page.



---

archive/issue_comments_285282.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-01-24T11:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285282",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_285283.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> I also wonder why you need the change to `build/pkgs/database_gap/spkg-install`. I don't know enough about GAP to know when `gap_reset_workspace()` is needed, but I think that you should give justification for that removal.\n\n\nIt is safe to omit this call. In fact,\n`gap_reset_workspace()` needs some work. It has not really been touched in 5 years,\nand it hangs on me now and then.\nI do not want to do it on this ticket - it has been iffy for a while already.",
    "created_at": "2017-01-24T11:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285283",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:10 jdemeyer]:
> I also wonder why you need the change to `build/pkgs/database_gap/spkg-install`. I don't know enough about GAP to know when `gap_reset_workspace()` is needed, but I think that you should give justification for that removal.


It is safe to omit this call. In fact,
`gap_reset_workspace()` needs some work. It has not really been touched in 5 years,
and it hangs on me now and then.
I do not want to do it on this ticket - it has been iffy for a while already.



---

archive/issue_comments_285284.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-01-24T11:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285284",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285285.json:
```json
{
    "body": "I have opened #22244 to deal with `gap_reset_workspace()` and GAP packages in more detail.",
    "created_at": "2017-01-24T12:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285285",
    "user": "https://github.com/dimpase"
}
```

I have opened #22244 to deal with `gap_reset_workspace()` and GAP packages in more detail.



---

archive/issue_comments_285286.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-01-24T12:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285286",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_285287.json:
```json
{
    "body": "If you are planning to deal with it anyway on #22244, why not leave the `gap_reset_workspace` as it is in this ticket?",
    "created_at": "2017-01-24T18:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285287",
    "user": "https://github.com/jdemeyer"
}
```

If you are planning to deal with it anyway on #22244, why not leave the `gap_reset_workspace` as it is in this ticket?



---

archive/issue_comments_285288.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> If you are planning to deal with it anyway on #22244, why not leave the `gap_reset_workspace` as it is in this ticket?\n\n\nCause it causes `spkg-install` hang indefinitely on one of my systems.",
    "created_at": "2017-01-25T14:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285288",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:16 jdemeyer]:
> If you are planning to deal with it anyway on #22244, why not leave the `gap_reset_workspace` as it is in this ticket?


Cause it causes `spkg-install` hang indefinitely on one of my systems.



---

archive/issue_comments_285289.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> Cause it causes `spkg-install` hang indefinitely on one of my systems.\n\n\nWell, then that problem should be fixed instead of hiding it under the carpet.",
    "created_at": "2017-01-25T15:34:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285289",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 dimpase]:
> Cause it causes `spkg-install` hang indefinitely on one of my systems.


Well, then that problem should be fixed instead of hiding it under the carpet.



---

archive/issue_comments_285290.json:
```json
{
    "body": "Replying to [comment:18 jdemeyer]:\n> Replying to [comment:17 dimpase]:\n> > Cause it causes `spkg-install` hang indefinitely on one of my systems.\n\n> \n> Well, then that problem should be fixed instead of hiding it under the carpet.\n\n\nIt is not a problem not to have that call in `spkg-install`.\nIt merely means that  some later GAP startup will be slower, once.\n(And yes we will look at it in #22244)\nBy the way, there is no such call in `spkg-install` of `gap_packages`.",
    "created_at": "2017-01-25T15:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285290",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:18 jdemeyer]:
> Replying to [comment:17 dimpase]:
> > Cause it causes `spkg-install` hang indefinitely on one of my systems.

> 
> Well, then that problem should be fixed instead of hiding it under the carpet.


It is not a problem not to have that call in `spkg-install`.
It merely means that  some later GAP startup will be slower, once.
(And yes we will look at it in #22244)
By the way, there is no such call in `spkg-install` of `gap_packages`.



---

archive/issue_comments_285291.json:
```json
{
    "body": "Regardless, I feel that the removal of `gap_reset_workspace` is orthogonal to the issue of this ticket and should be handled separately.",
    "created_at": "2017-01-30T15:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285291",
    "user": "https://github.com/jdemeyer"
}
```

Regardless, I feel that the removal of `gap_reset_workspace` is orthogonal to the issue of this ticket and should be handled separately.



---

archive/issue_comments_285292.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-02T12:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285292",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285293.json:
```json
{
    "body": "I've added the branch from #22272, rebased over the latest beta, and reverted the removal of gap_reset_workspace (commit 35c8fea). I do not see the hang I dealt with by adding the latter commit anymore (perhaps it's the effect of #22272 ?). Anyway, I hope this makes everyone happy :-)",
    "created_at": "2017-02-02T12:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285293",
    "user": "https://github.com/dimpase"
}
```

I've added the branch from #22272, rebased over the latest beta, and reverted the removal of gap_reset_workspace (commit 35c8fea). I do not see the hang I dealt with by adding the latter commit anymore (perhaps it's the effect of #22272 ?). Anyway, I hope this makes everyone happy :-)



---

archive/issue_comments_285294.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-02-03T10:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285294",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_285295.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-03T10:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285296.json:
```json
{
    "body": "What remains to fix is the following, less obvious:\n\n```\nFile \"src/sage/combinat/root_system/weyl_group.py\", line 175, in sage.combinat.root_system.weyl_group.WeylGroup\nFailed example:\n    TestSuite(WeylGroup([\"A\",3,1])).run() # long time\nExpected nothing\nGot:\n    Failure in _test_enumerated_set_contains:\n    Traceback (most recent call last):\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 293, in run\n        test_method(tester = tester)\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/categories/enumerated_sets.py\", line 949, in _test_enumerated_set_contains\n        for w in self:\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/groups/libgap_mixin.py\", line 342, in __iter__\n        iterator = self.gap().Iterator()\n      File \"sage/libs/gap/element.pyx\", line 2168, in sage.libs.gap.element.GapElement_MethodProxy.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:17497)\n        return GapElement_Function.__call__(self, self.first_argument)\n      File \"sage/libs/gap/element.pyx\", line 2052, in sage.libs.gap.element.GapElement_Function.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:16881)\n        raise ValueError('libGAP: ' + str(msg))\n    ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments\n    ------------------------------------------------------------\n    The following tests failed: _test_enumerated_set_contains\n**********************************************************************\nFile \"src/sage/combinat/root_system/weyl_group.py\", line 214, in sage.combinat.root_system.weyl_group.WeylGroup.__init__\nFailed example:\n    TestSuite(W).run() # long time\nExpected nothing\nGot:\n    Failure in _test_enumerated_set_contains:\n    Traceback (most recent call last):\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 293, in run\n        test_method(tester = tester)\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/categories/enumerated_sets.py\", line 949, in _test_enumerated_set_contains\n        for w in self:\n      File \"/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/groups/libgap_mixin.py\", line 342, in __iter__\n        iterator = self.gap().Iterator()\n      File \"sage/libs/gap/element.pyx\", line 2168, in sage.libs.gap.element.GapElement_MethodProxy.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:17497)\n        return GapElement_Function.__call__(self, self.first_argument)\n      File \"sage/libs/gap/element.pyx\", line 2052, in sage.libs.gap.element.GapElement_Function.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:16881)\n        raise ValueError('libGAP: ' + str(msg))\n    ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments\n    ------------------------------------------------------------\n    The following tests failed: _test_enumerated_set_contains\n**********************************************************************\n2 items had failures:\n   1 of  46 in sage.combinat.root_system.weyl_group.WeylGroup\n   1 of   6 in sage.combinat.root_system.weyl_group.WeylGroup.__init__\n    [203 tests, 2 failures, 16.77 s]\n```\n\n---\nNew commits:",
    "created_at": "2017-02-03T11:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285296",
    "user": "https://github.com/dimpase"
}
```

What remains to fix is the following, less obvious:

```
File "src/sage/combinat/root_system/weyl_group.py", line 175, in sage.combinat.root_system.weyl_group.WeylGroup
Failed example:
    TestSuite(WeylGroup(["A",3,1])).run() # long time
Expected nothing
Got:
    Failure in _test_enumerated_set_contains:
    Traceback (most recent call last):
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 293, in run
        test_method(tester = tester)
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/categories/enumerated_sets.py", line 949, in _test_enumerated_set_contains
        for w in self:
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/groups/libgap_mixin.py", line 342, in __iter__
        iterator = self.gap().Iterator()
      File "sage/libs/gap/element.pyx", line 2168, in sage.libs.gap.element.GapElement_MethodProxy.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:17497)
        return GapElement_Function.__call__(self, self.first_argument)
      File "sage/libs/gap/element.pyx", line 2052, in sage.libs.gap.element.GapElement_Function.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:16881)
        raise ValueError('libGAP: ' + str(msg))
    ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments
    ------------------------------------------------------------
    The following tests failed: _test_enumerated_set_contains
**********************************************************************
File "src/sage/combinat/root_system/weyl_group.py", line 214, in sage.combinat.root_system.weyl_group.WeylGroup.__init__
Failed example:
    TestSuite(W).run() # long time
Expected nothing
Got:
    Failure in _test_enumerated_set_contains:
    Traceback (most recent call last):
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 293, in run
        test_method(tester = tester)
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/categories/enumerated_sets.py", line 949, in _test_enumerated_set_contains
        for w in self:
      File "/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/groups/libgap_mixin.py", line 342, in __iter__
        iterator = self.gap().Iterator()
      File "sage/libs/gap/element.pyx", line 2168, in sage.libs.gap.element.GapElement_MethodProxy.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:17497)
        return GapElement_Function.__call__(self, self.first_argument)
      File "sage/libs/gap/element.pyx", line 2052, in sage.libs.gap.element.GapElement_Function.__call__ (/home/dima/Sage/sage-dev/src/build/cythonized/sage/libs/gap/element.c:16881)
        raise ValueError('libGAP: ' + str(msg))
    ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments
    ------------------------------------------------------------
    The following tests failed: _test_enumerated_set_contains
**********************************************************************
2 items had failures:
   1 of  46 in sage.combinat.root_system.weyl_group.WeylGroup
   1 of   6 in sage.combinat.root_system.weyl_group.WeylGroup.__init__
    [203 tests, 2 failures, 16.77 s]
```

---
New commits:



---

archive/issue_comments_285297.json:
```json
{
    "body": "Just 2 cents in case this helps the debugging: this group wraps an\ninfinite gap matrix group.\n\n```\nsage: W = WeylGroup([\"A\",3,1])\nsage: W.generators()\n(\n[-1  1  0  1]  [ 1  0  0  0]  [ 1  0  0  0]  [ 1  0  0  0]\n[ 0  1  0  0]  [ 1 -1  1  0]  [ 0  1  0  0]  [ 0  1  0  0]\n[ 0  0  1  0]  [ 0  0  1  0]  [ 0  1 -1  1]  [ 0  0  1  0]\n[ 0  0  0  1], [ 0  0  0  1], [ 0  0  0  1], [ 1  0  1 -1]\n)\nsage: W._gap_()\n<matrix group with 4 generators>\nsage: W._gap_().GeneratorsOfGroup()\n[ [ [ -1, 1, 0, 1 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 1, -1, 1, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 1, -1, 1 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 1, 0, 1, -1 ] ] ]\n```\n\nThe gap matrix group can be constructed with:\n\n```\ngap> G := Group([ [ [ -1, 1, 0, 1 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 1, -1, 1, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 1, -1, 1 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 1, 0, 1, -1 ] ] ])\n```\n\nI am a bit confused by the call of the \"Enumerator\" gap function,\nsince the Sage sources seem to contain no reference to it (although I\ndo not have the very latest develop under hand).",
    "created_at": "2017-02-03T13:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285297",
    "user": "https://github.com/nthiery"
}
```

Just 2 cents in case this helps the debugging: this group wraps an
infinite gap matrix group.

```
sage: W = WeylGroup(["A",3,1])
sage: W.generators()
(
[-1  1  0  1]  [ 1  0  0  0]  [ 1  0  0  0]  [ 1  0  0  0]
[ 0  1  0  0]  [ 1 -1  1  0]  [ 0  1  0  0]  [ 0  1  0  0]
[ 0  0  1  0]  [ 0  0  1  0]  [ 0  1 -1  1]  [ 0  0  1  0]
[ 0  0  0  1], [ 0  0  0  1], [ 0  0  0  1], [ 1  0  1 -1]
)
sage: W._gap_()
<matrix group with 4 generators>
sage: W._gap_().GeneratorsOfGroup()
[ [ [ -1, 1, 0, 1 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 1, -1, 1, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 1, -1, 1 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 1, 0, 1, -1 ] ] ]
```

The gap matrix group can be constructed with:

```
gap> G := Group([ [ [ -1, 1, 0, 1 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 1, -1, 1, 0 ], [ 0, 0, 1, 0 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 1, -1, 1 ], [ 0, 0, 0, 1 ] ], [ [ 1, 0, 0, 0 ], [ 0, 1, 0, 0 ], [ 0, 0, 1, 0 ], [ 1, 0, 1, -1 ] ] ])
```

I am a bit confused by the call of the "Enumerator" gap function,
since the Sage sources seem to contain no reference to it (although I
do not have the very latest develop under hand).



---

archive/issue_comments_285298.json:
```json
{
    "body": "Replying to [comment:26 nthiery]:\n> Just 2 cents in case this helps the debugging: this group wraps an\n> infinite gap matrix group.\n\n\nBut what exactly is `TestSuite()` calling?\nIs there a way to trace this up? In the log above there is `line 949, in _test_enumerated_set_contains` so it looks as if some kind of enumeration is attempted.\n\n> I am a bit confused by the call of the \"Enumerator\" gap function,\n> since the Sage sources seem to contain no reference to it (although I\n> do not have the very latest develop under hand).\n\n\nanyways, GAP's `Enumerator` does not apply to infinite objects, and it was never possible.",
    "created_at": "2017-02-03T14:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285298",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:26 nthiery]:
> Just 2 cents in case this helps the debugging: this group wraps an
> infinite gap matrix group.


But what exactly is `TestSuite()` calling?
Is there a way to trace this up? In the log above there is `line 949, in _test_enumerated_set_contains` so it looks as if some kind of enumeration is attempted.

> I am a bit confused by the call of the "Enumerator" gap function,
> since the Sage sources seem to contain no reference to it (although I
> do not have the very latest develop under hand).


anyways, GAP's `Enumerator` does not apply to infinite objects, and it was never possible.



---

archive/issue_comments_285299.json:
```json
{
    "body": "Replying to [comment:27 dimpase]:\n> Replying to [comment:26 nthiery]:\n> > Just 2 cents in case this helps the debugging: this group wraps an\n> > infinite gap matrix group.\n\n> \n> But what exactly is `TestSuite()` calling?\n> Is there a way to trace this up? In the log above there is `line 949, in _test_enumerated_set_contains` so it looks as if some kind of enumeration is attempted.\n\n\nI am trying to run \n\n```\nsage: W = WeylGroup([\"A\",3,1])\nsage: sage: W._test_enumerated_set_contains()\n```\nbut it just never finishes (other `._test_`-things seem to run fine). Is it the real bug here?\nHow does one find out what actually is called here?",
    "created_at": "2017-02-03T17:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285299",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:27 dimpase]:
> Replying to [comment:26 nthiery]:
> > Just 2 cents in case this helps the debugging: this group wraps an
> > infinite gap matrix group.

> 
> But what exactly is `TestSuite()` calling?
> Is there a way to trace this up? In the log above there is `line 949, in _test_enumerated_set_contains` so it looks as if some kind of enumeration is attempted.


I am trying to run 

```
sage: W = WeylGroup(["A",3,1])
sage: sage: W._test_enumerated_set_contains()
```
but it just never finishes (other `._test_`-things seem to run fine). Is it the real bug here?
How does one find out what actually is called here?



---

archive/issue_comments_285300.json:
```json
{
    "body": "My guess is there is not a way for iterating through infinite matrix groups by using a finite set of specified generators using GAP. This does not work in 7.6.beta1:\n\n```sage\nsage: G = GL(6, ZZ)\nsage: it = iter(G)\nsage: [it.next() for _ in range(6)]\n```\nalthough it should because\n\n```sage\nsage: G.gens()\n(\n[0 1 0 0 0 0]  [0 1 0 0 0 0]  [-1  0  0  0  0  0]  [1 1 0 0 0 0]\n[0 0 1 0 0 0]  [1 0 0 0 0 0]  [ 0  1  0  0  0  0]  [0 1 0 0 0 0]\n[0 0 0 1 0 0]  [0 0 1 0 0 0]  [ 0  0  1  0  0  0]  [0 0 1 0 0 0]\n[0 0 0 0 1 0]  [0 0 0 1 0 0]  [ 0  0  0  1  0  0]  [0 0 0 1 0 0]\n[0 0 0 0 0 1]  [0 0 0 0 1 0]  [ 0  0  0  0  1  0]  [0 0 0 0 1 0]\n[1 0 0 0 0 0], [0 0 0 0 0 1], [ 0  0  0  0  0  1], [0 0 0 0 0 1]\n)\n```\nDoes that work here?\nHowever, we have the category `FinitelyGeneratedSemigroups`, which contains a default implementation of such an iterator using `RecursivelyEnumeratedSet`.\n\nIn the case at hand `WeylGroups` is a subcategory of `FinitelyGeneratedSemigroups` (which is a subcategory of `EnumeratedSets`), so I suspect what is missing is for the generic (GAP) group iterator to lift the iteration up to the category if it doesn't know how to iterate directly in GAP.",
    "created_at": "2017-02-03T21:11:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285300",
    "user": "https://github.com/tscrim"
}
```

My guess is there is not a way for iterating through infinite matrix groups by using a finite set of specified generators using GAP. This does not work in 7.6.beta1:

```sage
sage: G = GL(6, ZZ)
sage: it = iter(G)
sage: [it.next() for _ in range(6)]
```
although it should because

```sage
sage: G.gens()
(
[0 1 0 0 0 0]  [0 1 0 0 0 0]  [-1  0  0  0  0  0]  [1 1 0 0 0 0]
[0 0 1 0 0 0]  [1 0 0 0 0 0]  [ 0  1  0  0  0  0]  [0 1 0 0 0 0]
[0 0 0 1 0 0]  [0 0 1 0 0 0]  [ 0  0  1  0  0  0]  [0 0 1 0 0 0]
[0 0 0 0 1 0]  [0 0 0 1 0 0]  [ 0  0  0  1  0  0]  [0 0 0 1 0 0]
[0 0 0 0 0 1]  [0 0 0 0 1 0]  [ 0  0  0  0  1  0]  [0 0 0 0 1 0]
[1 0 0 0 0 0], [0 0 0 0 0 1], [ 0  0  0  0  0  1], [0 0 0 0 0 1]
)
```
Does that work here?
However, we have the category `FinitelyGeneratedSemigroups`, which contains a default implementation of such an iterator using `RecursivelyEnumeratedSet`.

In the case at hand `WeylGroups` is a subcategory of `FinitelyGeneratedSemigroups` (which is a subcategory of `EnumeratedSets`), so I suspect what is missing is for the generic (GAP) group iterator to lift the iteration up to the category if it doesn't know how to iterate directly in GAP.



---

archive/issue_comments_285301.json:
```json
{
    "body": "With 7.6.beta2, this works:\n\n```\nsage: W = WeylGroup([\"A\",3,1])\nsage: for w in W: print w\n   (... neverending list ...)\n```\nWith the branch here:\n\n```\nsage: W = WeylGroup([\"A\",3,1])\nsage: for w in W: print w\ngap: cannot extend the workspace any more!!!\n   (at which point Sage silently quits)\n```",
    "created_at": "2017-02-03T21:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285301",
    "user": "https://github.com/jhpalmieri"
}
```

With 7.6.beta2, this works:

```
sage: W = WeylGroup(["A",3,1])
sage: for w in W: print w
   (... neverending list ...)
```
With the branch here:

```
sage: W = WeylGroup(["A",3,1])
sage: for w in W: print w
gap: cannot extend the workspace any more!!!
   (at which point Sage silently quits)
```



---

archive/issue_comments_285302.json:
```json
{
    "body": "Replying to [comment:27 dimpase]:\n> Replying to [comment:26 nthiery]:\n> > Just 2 cents in case this helps the debugging: this group wraps an\n> > infinite gap matrix group.\n\n> \n> But what exactly is `TestSuite()` calling?\n\n\nIn this case, I believe it is calling `_test_enumerated_set_contains` as defined in `categories/enumerated_sets.py`. That method has a loop which starts with `for w in self:`. For the group in question, the iterator can't be constructed.",
    "created_at": "2017-02-03T21:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285302",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:27 dimpase]:
> Replying to [comment:26 nthiery]:
> > Just 2 cents in case this helps the debugging: this group wraps an
> > infinite gap matrix group.

> 
> But what exactly is `TestSuite()` calling?


In this case, I believe it is calling `_test_enumerated_set_contains` as defined in `categories/enumerated_sets.py`. That method has a loop which starts with `for w in self:`. For the group in question, the iterator can't be constructed.



---

archive/issue_comments_285303.json:
```json
{
    "body": "Replying to [comment:31 jhpalmieri]:\n> With 7.6.beta2, this works:\n> \n> ```\n> sage: W = WeylGroup([\"A\",3,1])\n> sage: for w in W: print w\n>    (... neverending list ...)\n> ```\n\n\nI believe this invokes `W.__iter__`, right?\nAnd the latter is in `sage/groups/libgap_mixin.py` (cf. `W.__iter__??`)\nSo this is merely calling `self.gap().Iterator()`. And the latter does not actually work in Sage 7.5; one gets \n\n```\nValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments\n```\nwhereas with the branch here it does \"work\" - it runs out of memory...\n\nThat is, I believe that the category framework (or something like this) does try to call that `W.__iter__`, and upon failing (with the old GAP) actually does something that makes sense, namely `sage/groups/matrix_gps/matrix_group.py` has the lines\n\n```\nif not self.is_finite():\n    # use implementation from category framework\n    for g in super(Group, self).__iter__():\n          yield g\n    return\n```\nwhere the code in `sage/categories/coxeter_group.py` is called to do the right thing.\n\n\nWhereas with the new GAP one does not get a `ValueError` and proceeds with running out of memory (actual running done  by GAP).\n\nSo, somewhere, something must forbid this execution path, but I don't know where and how. All help is welcome. If the fix is not going to happen in GAP-related\ncode, I'd be inclined to press ahead with this ticket, declaring this issue a known (Sage) bug.",
    "created_at": "2017-02-03T23:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285303",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:31 jhpalmieri]:
> With 7.6.beta2, this works:
> 
> ```
> sage: W = WeylGroup(["A",3,1])
> sage: for w in W: print w
>    (... neverending list ...)
> ```


I believe this invokes `W.__iter__`, right?
And the latter is in `sage/groups/libgap_mixin.py` (cf. `W.__iter__??`)
So this is merely calling `self.gap().Iterator()`. And the latter does not actually work in Sage 7.5; one gets 

```
ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments
```
whereas with the branch here it does "work" - it runs out of memory...

That is, I believe that the category framework (or something like this) does try to call that `W.__iter__`, and upon failing (with the old GAP) actually does something that makes sense, namely `sage/groups/matrix_gps/matrix_group.py` has the lines

```
if not self.is_finite():
    # use implementation from category framework
    for g in super(Group, self).__iter__():
          yield g
    return
```
where the code in `sage/categories/coxeter_group.py` is called to do the right thing.


Whereas with the new GAP one does not get a `ValueError` and proceeds with running out of memory (actual running done  by GAP).

So, somewhere, something must forbid this execution path, but I don't know where and how. All help is welcome. If the fix is not going to happen in GAP-related
code, I'd be inclined to press ahead with this ticket, declaring this issue a known (Sage) bug.



---

archive/issue_comments_285304.json:
```json
{
    "body": "In plain 7.6.beta2, `W.__iter__()` calls the `__iter__` method from `sage/groups/matrix_groups/matrix_group.py`, but that method has been deleted in the current branch. Isn't that the problem?",
    "created_at": "2017-02-04T00:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285304",
    "user": "https://github.com/jhpalmieri"
}
```

In plain 7.6.beta2, `W.__iter__()` calls the `__iter__` method from `sage/groups/matrix_groups/matrix_group.py`, but that method has been deleted in the current branch. Isn't that the problem?



---

archive/issue_comments_285305.json:
```json
{
    "body": "Replying to [comment:33 dimpase]:\n> Replying to [comment:31 jhpalmieri]:\n> > With 7.6.beta2, this works:\n> > \n> > ```\n> > sage: W = WeylGroup([\"A\",3,1])\n> > sage: for w in W: print w\n> >    (... neverending list ...)\n> > ```\n\n> \n> I believe this invokes `W.__iter__`, right?\n> And the latter is in `sage/groups/libgap_mixin.py` (cf. `W.__iter__??`)\n> So this is merely calling `self.gap().Iterator()`. And the latter does not actually work in Sage 7.5; one gets \n> \n> ```\n> ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments\n> ```\n> whereas with the branch here it does \"work\" - it runs out of memory...\n\n\nI would suspect this is a GAP problem by trying to put the entire (matrix) group into memory as a list under an assumption that it is a finite group. Well, our `RecursiveEnumeratedSet` iterator runs into the same problem, but it will at least output things along the way...\n\n> That is, I believe that the category framework (or something like this) does try to call that `W.__iter__`, and upon failing (with the old GAP) actually does something that makes sense, namely `sage/groups/matrix_gps/matrix_group.py` has the lines\n> \n> ```\n> if not self.is_finite():\n>     # use implementation from category framework\n>     for g in super(Group, self).__iter__():\n>           yield g\n>     return\n> ```\n> where the code in `sage/categories/coxeter_group.py` is called to do the right thing.\n\n\nIt's actually the reverse that happens: code in the categories is the last called in the MRO. In particular, the first call is to the lines copied above, and for non-finite groups (or at least those not known to be finite), then call up to the corresponding `__iter__` implemented in the category (if there is one).\n\nSee comment:29 for why it used to work for Weyl groups.\n\n> Whereas with the new GAP one does not get a `ValueError` and proceeds with running out of memory (actual running done  by GAP).\n\n\nYou deleted the code above that would call up to the category framework, where it was not using GAP to do the iteration.\n\n> So, somewhere, something must forbid this execution path, but I don't know where and how. All help is welcome. If the fix is not going to happen in GAP-related\n> code, I'd be inclined to press ahead with this ticket, declaring this issue a known (Sage) bug.\n\n\nYou probably need to restore part of the `__iter__`, specifically the code quoted above.\n\nTL;DR - As [comment:34 John said], the problem is removing `__iter__` from `sage/groups/matrix_groups/matrix_group.py`.",
    "created_at": "2017-02-04T05:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285305",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:33 dimpase]:
> Replying to [comment:31 jhpalmieri]:
> > With 7.6.beta2, this works:
> > 
> > ```
> > sage: W = WeylGroup(["A",3,1])
> > sage: for w in W: print w
> >    (... neverending list ...)
> > ```

> 
> I believe this invokes `W.__iter__`, right?
> And the latter is in `sage/groups/libgap_mixin.py` (cf. `W.__iter__??`)
> So this is merely calling `self.gap().Iterator()`. And the latter does not actually work in Sage 7.5; one gets 
> 
> ```
> ValueError: libGAP: Error, no method found! Error, no 3rd choice method found for `Enumerator' on 1 arguments
> ```
> whereas with the branch here it does "work" - it runs out of memory...


I would suspect this is a GAP problem by trying to put the entire (matrix) group into memory as a list under an assumption that it is a finite group. Well, our `RecursiveEnumeratedSet` iterator runs into the same problem, but it will at least output things along the way...

> That is, I believe that the category framework (or something like this) does try to call that `W.__iter__`, and upon failing (with the old GAP) actually does something that makes sense, namely `sage/groups/matrix_gps/matrix_group.py` has the lines
> 
> ```
> if not self.is_finite():
>     # use implementation from category framework
>     for g in super(Group, self).__iter__():
>           yield g
>     return
> ```
> where the code in `sage/categories/coxeter_group.py` is called to do the right thing.


It's actually the reverse that happens: code in the categories is the last called in the MRO. In particular, the first call is to the lines copied above, and for non-finite groups (or at least those not known to be finite), then call up to the corresponding `__iter__` implemented in the category (if there is one).

See comment:29 for why it used to work for Weyl groups.

> Whereas with the new GAP one does not get a `ValueError` and proceeds with running out of memory (actual running done  by GAP).


You deleted the code above that would call up to the category framework, where it was not using GAP to do the iteration.

> So, somewhere, something must forbid this execution path, but I don't know where and how. All help is welcome. If the fix is not going to happen in GAP-related
> code, I'd be inclined to press ahead with this ticket, declaring this issue a known (Sage) bug.


You probably need to restore part of the `__iter__`, specifically the code quoted above.

TL;DR - As [comment:34 John said], the problem is removing `__iter__` from `sage/groups/matrix_groups/matrix_group.py`.



---

archive/issue_comments_285306.json:
```json
{
    "body": "Oh, I see. Thanks. Sorry for taking so long to get it. I removed too mich in this [commit](https://git.sagemath.org/sage.git/commit/?id=2d86709b234fa2797c2f18371a508fa8573960e2). I will reinstate the part that deals with infinite groups.\n\nHowever this is still less than ideal. In the finite case for groups that have a fast category framework iterator (e.g. large finite Coxeter groups) one should not call GAP, either. Should this be dealt with on a follow-up ticket, or is there a quick way to add the corresponding filter?",
    "created_at": "2017-02-04T09:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285306",
    "user": "https://github.com/dimpase"
}
```

Oh, I see. Thanks. Sorry for taking so long to get it. I removed too mich in this [commit](https://git.sagemath.org/sage.git/commit/?id=2d86709b234fa2797c2f18371a508fa8573960e2). I will reinstate the part that deals with infinite groups.

However this is still less than ideal. In the finite case for groups that have a fast category framework iterator (e.g. large finite Coxeter groups) one should not call GAP, either. Should this be dealt with on a follow-up ticket, or is there a quick way to add the corresponding filter?



---

archive/issue_comments_285307.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-04T18:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285307",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-04T23:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285309.json:
```json
{
    "body": "Replying to [comment:36 dimpase]:\n> However this is still less than ideal. In the finite case for groups that have a fast category framework iterator (e.g. large finite Coxeter groups) one should not call GAP, either. Should this be dealt with on a follow-up ticket, or is there a quick way to add the corresponding filter?\n\n\nThe category iterator is not just for Coxeter groups, but any group with a finite generating set. Have you run timings (and memory usage) comparing the GAP iterator with the one from the category?\n\nAt least for Coxeter groups, we can do a check on the rank if there is some cutoff point.",
    "created_at": "2017-02-04T23:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285309",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:36 dimpase]:
> However this is still less than ideal. In the finite case for groups that have a fast category framework iterator (e.g. large finite Coxeter groups) one should not call GAP, either. Should this be dealt with on a follow-up ticket, or is there a quick way to add the corresponding filter?


The category iterator is not just for Coxeter groups, but any group with a finite generating set. Have you run timings (and memory usage) comparing the GAP iterator with the one from the category?

At least for Coxeter groups, we can do a check on the rank if there is some cutoff point.



---

archive/issue_comments_285310.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-05T01:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285310",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285311.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-02-05T12:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285311",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_285312.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-02-05T14:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285312",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_285313.json:
```json
{
    "body": "Testsuite fails:\n\n```\n########> Diff in /Users/buildslave-sage/slave/sage_git/build/local/gap/latest\\\n1045/tst/testinstall/grpmat.tst, line 32:\n1046# Input is:\n1047Size( AutomorphismGroup( G ) );\n1048# Expected output:\n104924\n1050# But found:\n1051#I  autpgrp package is not available. Check that the name is correct\n1052#I  and it is present in one of the GAP root directories (see '??RootPaths')\n```",
    "created_at": "2017-02-05T14:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285313",
    "user": "https://github.com/vbraun"
}
```

Testsuite fails:

```
########> Diff in /Users/buildslave-sage/slave/sage_git/build/local/gap/latest\
1045/tst/testinstall/grpmat.tst, line 32:
1046# Input is:
1047Size( AutomorphismGroup( G ) );
1048# Expected output:
104924
1050# But found:
1051#I  autpgrp package is not available. Check that the name is correct
1052#I  and it is present in one of the GAP root directories (see '??RootPaths')
```



---

archive/issue_comments_285314.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-02-05T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285314",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_285315.json:
```json
{
    "body": "Replying to [comment:42 vbraun]:\n> Testsuite fails:\n> \n> ```\n> ########> Diff in /Users/buildslave-sage/slave/sage_git/build/local/gap/latest\\\n> 1045/tst/testinstall/grpmat.tst, line 32:\n> ...\n> 1051#I  autpgrp package is not available. Check that the name is correct\n> 1052#I  and it is present in one of the GAP root directories (see '??RootPaths')\n> ```\n\nAs far as I am concerned, this is not a bug, but a decision we made at some point to ship only the very minimal default GAP configuration.\nAs you most probably know, GAP assumes quite a few packages to be installed and autoloaded by default; this is patched away by \n\u200b`ba1e2ae` \"we don't have these packages installed by default\"\n\n\nSage's GAP does not install `autpgrp` by default, and does not autoload it if it is available. Suppose it is available (i.e. `gap_packages` is installed); then\nbefore running `GAP_ROOT/tst/testinstall.g` one has to load `autpgrp` manually.\nI.e.\n\n```\ngap> LoadPackage(\"autpgrp\");;\ngap> Read(\"testinstall.g\");\n```\nwill make everything pass (on my system at least).",
    "created_at": "2017-02-05T17:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285315",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:42 vbraun]:
> Testsuite fails:
> 
> ```
> ########> Diff in /Users/buildslave-sage/slave/sage_git/build/local/gap/latest\
> 1045/tst/testinstall/grpmat.tst, line 32:
> ...
> 1051#I  autpgrp package is not available. Check that the name is correct
> 1052#I  and it is present in one of the GAP root directories (see '??RootPaths')
> ```

As far as I am concerned, this is not a bug, but a decision we made at some point to ship only the very minimal default GAP configuration.
As you most probably know, GAP assumes quite a few packages to be installed and autoloaded by default; this is patched away by 
​`ba1e2ae` "we don't have these packages installed by default"


Sage's GAP does not install `autpgrp` by default, and does not autoload it if it is available. Suppose it is available (i.e. `gap_packages` is installed); then
before running `GAP_ROOT/tst/testinstall.g` one has to load `autpgrp` manually.
I.e.

```
gap> LoadPackage("autpgrp");;
gap> Read("testinstall.g");
```
will make everything pass (on my system at least).



---

archive/issue_comments_285316.json:
```json
{
    "body": "Still I'd prefer to have a passing testsuite so that the buildbots can actuall run the tests. Can we just grep out tst/testinstall/grpmat.tst in spkg-check?",
    "created_at": "2017-02-05T19:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285316",
    "user": "https://github.com/vbraun"
}
```

Still I'd prefer to have a passing testsuite so that the buildbots can actuall run the tests. Can we just grep out tst/testinstall/grpmat.tst in spkg-check?



---

archive/issue_comments_285317.json:
```json
{
    "body": "I guess it is annoying because of the newline; How about deleting grpmat.tst from the install then?",
    "created_at": "2017-02-05T20:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285317",
    "user": "https://github.com/vbraun"
}
```

I guess it is annoying because of the newline; How about deleting grpmat.tst from the install then?



---

archive/issue_comments_285318.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-02-05T21:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285318",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_285319.json:
```json
{
    "body": "Replying to [comment:46 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> |                                                                                                                                           |                                                 |\n> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|\n> |[8b8bff3](https://git.sagemath.org/sage.git/commit/?id=8b8bff3979932022c2cbccd519689351b4c9170d)|`fake the output of GAP test needing autpgrp pkg`|\n\n\nthis should do the trick - I just fake the output of the test in question.",
    "created_at": "2017-02-05T21:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285319",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:46 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> |                                                                                                                                           |                                                 |
> |-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------|
> |[8b8bff3](https://git.sagemath.org/sage.git/commit/?id=8b8bff3979932022c2cbccd519689351b4c9170d)|`fake the output of GAP test needing autpgrp pkg`|


this should do the trick - I just fake the output of the test in question.



---

archive/issue_events_056026.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-02-06T23:11:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20677#event-56026"
}
```



---

archive/issue_comments_285320.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-02-06T23:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20677#issuecomment-285320",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
