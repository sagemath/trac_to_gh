# Issue 23268: Lattice precision for p-adics

archive/issues_023268.json:
```json
{
    "body": "CC:  @roed314 tristanvaccon @saraedum @mezzarobba swewers\n\nKeywords: sd87\n\nIn several recent papers, David Roe, Tristan Vaccon and I explain that lattices allow a sharp track of precision: if f is a function we want to evaluate and x is an input given with some uncertainty modeled by a lattice H, then the uncertainty on the output f(x) is exactly df_x(H).\n\nFor much more details, I refer to my lecture notes http://xavier.toonywood.org/papers/publis/course-padic.pdf\n\nThe aim of this ticket is to propose to implement these ideas in [SageMath](SageMath). \nMore precisely, I propose to create a new parent `QpLP` (LP for \"lattice precision\") for which the precision is tracked using lattices. This leads to some difficulties:\n- Since a lattice does not in general split properly, the precision datum is a global object which must be handled by the parent (and not by its elements). For this reason, the parent has to manage the precision itself for all its elements. In particular, he has to maintain an up-to-date list of all its elements (and should be then informed whenever one of its elements is collected by the garbage collector).\n- If f is not surjective, df_x(H) is no longer a lattice. However, dealing with general Zp-submodules (and not only lattices) is more complicated for several reasons (the first one is that they are not exact objects whereas lattices are). For this reason, we introduce a `working_precision_cap` and feel free to add to our precision lattice any multiple of `p^working_precision_cap` if needed.\n\n## About implementation\n\nThe pseudo-code below gives some hints about the implementation I have in mind. Comments are welcome! \n\n\n```\n\n# The parent\n############\n\nclass pAdicFieldLattice(pAdicRingBaseGeneric):\n    # Internal variables:\n    #  . self._working_precision_cap\n    #    a cap for the working precision\n    #    meaning that the precision lattice always contains p^(self._working_precision_cap)\n    #  . self._elements\n    #    list of weak references of elements in this parent\n    #  . self._precision_lattice\n    #    a matrix over ZZ representing the lattice of precision\n    #    (its columns are indexed by self._elements)\n\n    def __init__(self, p, working_precision_cap, print_mode):\n        # Initialize variables here\n\n    def _echelonize(self):\n        # Echelonize the matrix giving the precision lattice\n\n    def _add_element(self, elt, prec):\n        # A new element in the parent has just been created\n        # We should:\n        #  . add a weak reference to it to the list self._elements\n        #  . add a column to self._precision_lattice\n        #    and update this matrix according to prec \n        #    (and possibly the working precision cap)\n        # NOTE: prec be either an integer or a formal linear combinaison\n        # of the precision on the other elements of this parent\n\n    def _del_element(self, elt):\n        # The element elt has just been garbage collected\n        # We should:\n        #  . remove it to the list self._elements\n        #  . remove the corresponding column of self._precision_lattice\n\n    def precision_absolute(self, elt):\n        # Return the (optimal) absolute precision of the element elt\n        # This precision can be read off on self._precision_lattice:\n        # it is the smallest valuation of an entry of the column of\n        # self._precision_lattice corresponding to the element elt\n\n    def working_precision(self, elt):\n        # Return the working precision of the element elt\n        # This precision can be read off on the precision lattice:\n        # it is the smallest integer n for which the precision\n        # lattice contains p^n*[elt] where [elt] denotes the \n        # basis vector corresponding to elt\n\n    def _element_constructor_(self, x, prec):\n        # We ask for the creation of an element in this parent\n        # We should:\n        #  . create this element (called elt hereafter) from x\n        #    Note: elt is an instance of the class pAdicLatticeElement below\n        #  . call the method _new_element(elt, prec)\n        #  . install a callback so that when elt will be collected\n        #    by the garbage collector, the method _del_element will\n        #    be called\n\nQpLP = pAdicFieldLattice\n\n\n# The elements\n##############\n\nclass pAdicLatticeElement(Element):\n    # Internal variable:\n    #  . self._approximation\n    #    an approximation of this p-adic number\n    #    it is defined modulo p^(working_precision)\n\n    def working_precision(self):\n        return self.parent().working_precision(self)\n\n    def approximation(self):\n        # We should:\n        #  . reduce self._approximation modulo p^(self.working_precision())\n        #    (and update self._approximation accordingly)\n        #  . return the result\n\n    def precision_absolute(self):\n        return self.parent().precision_absolute(self)\n\n    def valuation(self, secure=False):\n        # We should:\n        #  . compute the valuation of self.approximation()\n        #  . compare it to the self.precision_absolute()\n        #  . if the former is less than the latter, we return the former\n        #  . otherwise, if secure is False, we return the latter\n        #               if secure is True, we raise an error\n\n    def precision_relative(self, secure=False):\n        return self.precision_absolute() - self.valuation(secure=secure)\n\n    def _repr_(self):\n        # Print like this:\n        #   self.approximation() + O(p^self.precision_absolute())\n\n\n    def _add_(self, other):\n        # We should:\n        #  . compute app = self.approximation() + other.approximation()\n        #  . create a new element from app and the precision given by the differential:\n        #    dapp = dself + dother\n\n    def _mul_(self, other):\n        # We should:\n        #  . compute app = self.approximation() * other.approximation()\n        #  . create a new element from app and the precision given by the differential:\n        #    dapp = self*dother + other*dself\n\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23505\n\n",
    "created_at": "2017-07-21T05:39:49Z",
    "labels": [
        "padics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Lattice precision for p-adics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23268",
    "user": "@xcaruso"
}
```
CC:  @roed314 tristanvaccon @saraedum @mezzarobba swewers

Keywords: sd87

In several recent papers, David Roe, Tristan Vaccon and I explain that lattices allow a sharp track of precision: if f is a function we want to evaluate and x is an input given with some uncertainty modeled by a lattice H, then the uncertainty on the output f(x) is exactly df_x(H).

For much more details, I refer to my lecture notes http://xavier.toonywood.org/papers/publis/course-padic.pdf

The aim of this ticket is to propose to implement these ideas in [SageMath](SageMath). 
More precisely, I propose to create a new parent `QpLP` (LP for "lattice precision") for which the precision is tracked using lattices. This leads to some difficulties:
- Since a lattice does not in general split properly, the precision datum is a global object which must be handled by the parent (and not by its elements). For this reason, the parent has to manage the precision itself for all its elements. In particular, he has to maintain an up-to-date list of all its elements (and should be then informed whenever one of its elements is collected by the garbage collector).
- If f is not surjective, df_x(H) is no longer a lattice. However, dealing with general Zp-submodules (and not only lattices) is more complicated for several reasons (the first one is that they are not exact objects whereas lattices are). For this reason, we introduce a `working_precision_cap` and feel free to add to our precision lattice any multiple of `p^working_precision_cap` if needed.

## About implementation

The pseudo-code below gives some hints about the implementation I have in mind. Comments are welcome! 


```

# The parent
############

class pAdicFieldLattice(pAdicRingBaseGeneric):
    # Internal variables:
    #  . self._working_precision_cap
    #    a cap for the working precision
    #    meaning that the precision lattice always contains p^(self._working_precision_cap)
    #  . self._elements
    #    list of weak references of elements in this parent
    #  . self._precision_lattice
    #    a matrix over ZZ representing the lattice of precision
    #    (its columns are indexed by self._elements)

    def __init__(self, p, working_precision_cap, print_mode):
        # Initialize variables here

    def _echelonize(self):
        # Echelonize the matrix giving the precision lattice

    def _add_element(self, elt, prec):
        # A new element in the parent has just been created
        # We should:
        #  . add a weak reference to it to the list self._elements
        #  . add a column to self._precision_lattice
        #    and update this matrix according to prec 
        #    (and possibly the working precision cap)
        # NOTE: prec be either an integer or a formal linear combinaison
        # of the precision on the other elements of this parent

    def _del_element(self, elt):
        # The element elt has just been garbage collected
        # We should:
        #  . remove it to the list self._elements
        #  . remove the corresponding column of self._precision_lattice

    def precision_absolute(self, elt):
        # Return the (optimal) absolute precision of the element elt
        # This precision can be read off on self._precision_lattice:
        # it is the smallest valuation of an entry of the column of
        # self._precision_lattice corresponding to the element elt

    def working_precision(self, elt):
        # Return the working precision of the element elt
        # This precision can be read off on the precision lattice:
        # it is the smallest integer n for which the precision
        # lattice contains p^n*[elt] where [elt] denotes the 
        # basis vector corresponding to elt

    def _element_constructor_(self, x, prec):
        # We ask for the creation of an element in this parent
        # We should:
        #  . create this element (called elt hereafter) from x
        #    Note: elt is an instance of the class pAdicLatticeElement below
        #  . call the method _new_element(elt, prec)
        #  . install a callback so that when elt will be collected
        #    by the garbage collector, the method _del_element will
        #    be called

QpLP = pAdicFieldLattice


# The elements
##############

class pAdicLatticeElement(Element):
    # Internal variable:
    #  . self._approximation
    #    an approximation of this p-adic number
    #    it is defined modulo p^(working_precision)

    def working_precision(self):
        return self.parent().working_precision(self)

    def approximation(self):
        # We should:
        #  . reduce self._approximation modulo p^(self.working_precision())
        #    (and update self._approximation accordingly)
        #  . return the result

    def precision_absolute(self):
        return self.parent().precision_absolute(self)

    def valuation(self, secure=False):
        # We should:
        #  . compute the valuation of self.approximation()
        #  . compare it to the self.precision_absolute()
        #  . if the former is less than the latter, we return the former
        #  . otherwise, if secure is False, we return the latter
        #               if secure is True, we raise an error

    def precision_relative(self, secure=False):
        return self.precision_absolute() - self.valuation(secure=secure)

    def _repr_(self):
        # Print like this:
        #   self.approximation() + O(p^self.precision_absolute())


    def _add_(self, other):
        # We should:
        #  . compute app = self.approximation() + other.approximation()
        #  . create a new element from app and the precision given by the differential:
        #    dapp = dself + dother

    def _mul_(self, other):
        # We should:
        #  . compute app = self.approximation() * other.approximation()
        #  . create a new element from app and the precision given by the differential:
        #    dapp = self*dother + other*dself

```


Issue created by migration from https://trac.sagemath.org/ticket/23505





---

archive/issue_comments_325614.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-07-22T04:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325614",
    "user": "@xcaruso"
}
```

New commits:



---

archive/issue_comments_325615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-22T04:09:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325615",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325616.json:
```json
{
    "body": "I've worked more on my implementation and, at least, it seems now to be usable.\n\nIt still requires a lot of work (convert to Cython, write templates, write doctests, rewrite completely the class `pRational` which is a hack, etc). I however post it because I think that some people might have fun  playing with it and discovering what lattice precision can do. Enjoy :-)\n\n`@`mmezzarobba: I add your name in Cc because I think that you could be interested. If you're not, feel free to remove it.",
    "created_at": "2017-08-01T23:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325616",
    "user": "@xcaruso"
}
```

I've worked more on my implementation and, at least, it seems now to be usable.

It still requires a lot of work (convert to Cython, write templates, write doctests, rewrite completely the class `pRational` which is a hack, etc). I however post it because I think that some people might have fun  playing with it and discovering what lattice precision can do. Enjoy :-)

`@`mmezzarobba: I add your name in Cc because I think that you could be interested. If you're not, feel free to remove it.



---

archive/issue_comments_325617.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2017-08-01T23:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325617",
    "user": "@xcaruso"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_325618.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-01T23:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325618",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325619.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-02T09:04:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325619",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325620.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-02T09:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325620",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325621.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-21T04:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325621",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325622.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-22T18:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325622",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-30T03:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325623",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325624.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-19T19:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325624",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325625.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-20T17:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325625",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325626.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-23T06:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325626",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-06T10:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325627",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325628.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-07T17:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325628",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325629.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-17T14:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325629",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325630.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-18T16:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325630",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325631.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-21T08:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325631",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325632.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-05T06:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325632",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325633.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-05T06:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325633",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325634.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-06T16:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325634",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325635.json:
```json
{
    "body": "I guess that this ticket is now more or less ready for a first review.",
    "created_at": "2018-02-06T16:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325635",
    "user": "@xcaruso"
}
```

I guess that this ticket is now more or less ready for a first review.



---

archive/issue_comments_325636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-06T16:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325636",
    "user": "@xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_325637.json:
```json
{
    "body": "I would be happy to help with reviewing this. Since this is quite a lot of code, would you mind to push the code to github/gitlab where it is much easier to comment on lines of code? I can also push it to a repository there myself if you don't mind.",
    "created_at": "2018-02-07T13:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325637",
    "user": "@saraedum"
}
```

I would be happy to help with reviewing this. Since this is quite a lot of code, would you mind to push the code to github/gitlab where it is much easier to comment on lines of code? I can also push it to a repository there myself if you don't mind.



---

archive/issue_comments_325638.json:
```json
{
    "body": "Do you document somewhere why this does not follow the usual linkage pattern used elsewhere in the p-adics code?",
    "created_at": "2018-02-07T13:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325638",
    "user": "@saraedum"
}
```

Do you document somewhere why this does not follow the usual linkage pattern used elsewhere in the p-adics code?



---

archive/issue_comments_325639.json:
```json
{
    "body": "Replying to [comment:31 saraedum]:\n> Do you document somewhere why this does not follow the usual linkage pattern used elsewhere in the p-adics code?\n\nI think the main answer is that it just hasn't been switched to the linkage pattern, but it should be.  The pRational will take some work to make this happen.  I'll be busy in the next few weeks working on an ANTS paper, but we can talk about this in Rennes.  In the mean time, I think if you want to push the code to github/gitlab that should be fine.",
    "created_at": "2018-02-07T17:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325639",
    "user": "@roed314"
}
```

Replying to [comment:31 saraedum]:
> Do you document somewhere why this does not follow the usual linkage pattern used elsewhere in the p-adics code?

I think the main answer is that it just hasn't been switched to the linkage pattern, but it should be.  The pRational will take some work to make this happen.  I'll be busy in the next few weeks working on an ANTS paper, but we can talk about this in Rennes.  In the mean time, I think if you want to push the code to github/gitlab that should be fine.



---

archive/issue_comments_325640.json:
```json
{
    "body": "I pushed Xavier's code to https://gitlab.com/saraedum/sage/merge_requests/1/diffs for easier review.\n----\nNew commits:",
    "created_at": "2018-02-09T19:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325640",
    "user": "@saraedum"
}
```

I pushed Xavier's code to https://gitlab.com/saraedum/sage/merge_requests/1/diffs for easier review.
----
New commits:



---

archive/issue_comments_325641.json:
```json
{
    "body": "see patchbot report for several issues (including important python3 compatibility)",
    "created_at": "2018-02-12T12:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325641",
    "user": "@fchapoton"
}
```

see patchbot report for several issues (including important python3 compatibility)



---

archive/issue_comments_325642.json:
```json
{
    "body": "I'm getting a maximum recursion depth exceeded:\n\n```\nsage: Q2 = QpLC(2,print_mode='digits')\nsage: R.<x,y,z> = PolynomialRing(Q2, order = 'invlex')\nsage: F = [ Q2(2,10)*x + Q2(1,10)*z,\n....:      Q2(1,10)*x^2 + Q2(1,10)*y^2 - Q2(2,10)*z^2,\n....:      Q2(4,10)*y^2 + Q2(1,10)*y*z + Q2(8,10)*z^2 ]\nsage: from sage.rings.polynomial.toy_buchberger import buchberger_improved\nsage: g = buchberger_improved(ideal(F));\nsage: g.sort()\nsage: L.number_of_diffused_digits([g[1].coefficient(x^2),\n....:                              g[2].coefficient(x^2),g[3].coefficient(x)])\n/home/user/sage-8.1/local/lib/python2.7/site-packages/sage/rings/padics/lattice_precision.pyc in number_of_diffused_digits(self, elements)\n    563             17\n    564         \"\"\"\n--> 565         M = self.precision_lattice(elements)\n    566         n = M.nrows()\n    567         if M.ncols() > n:\n/home/user/sage-8.1/local/lib/python2.7/site-packages/sage/rings/padics/lattice_precision.pyc in precision_lattice(self, elements)\n   1551             elements = self._elements\n   1552         else:\n-> 1553             elements = list_of_padics(elements)\n   1554         n = len(self._elements)\n   1555         rows = [ ]; val = 0\n/home/user/sage-8.1/local/lib/python2.7/site-packages/sage/rings/padics/lattice_precision.pyc in list_of_padics(elements)\n    234     ans = [ ]\n    235     for x in elements:\n--> 236         ans += list_of_padics(x)\n    237     return ans\n    238 \n```\n",
    "created_at": "2018-02-20T05:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325642",
    "user": "@roed314"
}
```

I'm getting a maximum recursion depth exceeded:

```
sage: Q2 = QpLC(2,print_mode='digits')
sage: R.<x,y,z> = PolynomialRing(Q2, order = 'invlex')
sage: F = [ Q2(2,10)*x + Q2(1,10)*z,
....:      Q2(1,10)*x^2 + Q2(1,10)*y^2 - Q2(2,10)*z^2,
....:      Q2(4,10)*y^2 + Q2(1,10)*y*z + Q2(8,10)*z^2 ]
sage: from sage.rings.polynomial.toy_buchberger import buchberger_improved
sage: g = buchberger_improved(ideal(F));
sage: g.sort()
sage: L.number_of_diffused_digits([g[1].coefficient(x^2),
....:                              g[2].coefficient(x^2),g[3].coefficient(x)])
/home/user/sage-8.1/local/lib/python2.7/site-packages/sage/rings/padics/lattice_precision.pyc in number_of_diffused_digits(self, elements)
    563             17
    564         """
--> 565         M = self.precision_lattice(elements)
    566         n = M.nrows()
    567         if M.ncols() > n:
/home/user/sage-8.1/local/lib/python2.7/site-packages/sage/rings/padics/lattice_precision.pyc in precision_lattice(self, elements)
   1551             elements = self._elements
   1552         else:
-> 1553             elements = list_of_padics(elements)
   1554         n = len(self._elements)
   1555         rows = [ ]; val = 0
/home/user/sage-8.1/local/lib/python2.7/site-packages/sage/rings/padics/lattice_precision.pyc in list_of_padics(elements)
    234     ans = [ ]
    235     for x in elements:
--> 236         ans += list_of_padics(x)
    237     return ans
    238 
```




---

archive/issue_comments_325643.json:
```json
{
    "body": "Replying to [comment:36 roed]:\n> I'm getting a maximum recursion depth exceeded:\n\nThe reason is that (1) `coefficient` returns a multivariate polynomial and (2) if P is a multivariate polynomial, `list(P)` contains some multivariate polynomials in it as well.\n\nThe last commit fixes the bug. But I'm not sure that it's the correct way to do this.\n\n\n```\nsage: Q2 = QpLC(2,print_mode='digits')\nsage: L = Q2.precision()\nsage: R.<x,y,z> = PolynomialRing(Q2, order = 'invlex')\nsage: F = [ Q2(2,10)*x + Q2(1,10)*z,\n....:       Q2(1,10)*x^2 + Q2(1,10)*y^2 - Q2(2,10)*z^2,\n....:       Q2(4,10)*y^2 + Q2(1,10)*y*z + Q2(8,10)*z^2 ]\nsage: from sage.rings.polynomial.toy_buchberger import buchberger_improved\nsage: g = buchberger_improved(ideal(F));\nsage: g.sort()\nsage: L.number_of_diffused_digits([g[1].coefficient(x^2),\n                                   g[2].coefficient(x^2),\n                                   g[3].coefficient(x)])\n0\n```\n",
    "created_at": "2018-02-21T19:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325643",
    "user": "@xcaruso"
}
```

Replying to [comment:36 roed]:
> I'm getting a maximum recursion depth exceeded:

The reason is that (1) `coefficient` returns a multivariate polynomial and (2) if P is a multivariate polynomial, `list(P)` contains some multivariate polynomials in it as well.

The last commit fixes the bug. But I'm not sure that it's the correct way to do this.


```
sage: Q2 = QpLC(2,print_mode='digits')
sage: L = Q2.precision()
sage: R.<x,y,z> = PolynomialRing(Q2, order = 'invlex')
sage: F = [ Q2(2,10)*x + Q2(1,10)*z,
....:       Q2(1,10)*x^2 + Q2(1,10)*y^2 - Q2(2,10)*z^2,
....:       Q2(4,10)*y^2 + Q2(1,10)*y*z + Q2(8,10)*z^2 ]
sage: from sage.rings.polynomial.toy_buchberger import buchberger_improved
sage: g = buchberger_improved(ideal(F));
sage: g.sort()
sage: L.number_of_diffused_digits([g[1].coefficient(x^2),
                                   g[2].coefficient(x^2),
                                   g[3].coefficient(x)])
0
```




---

archive/issue_comments_325644.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-23T20:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325644",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_325645.json:
```json
{
    "body": "You need to fix all the patchbot's warnings, including the incompatibilities with python3.",
    "created_at": "2018-02-23T20:22:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325645",
    "user": "@fchapoton"
}
```

You need to fix all the patchbot's warnings, including the incompatibilities with python3.



---

archive/issue_comments_325646.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T03:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325646",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_325647.json:
```json
{
    "body": "`@`caruso: I merged your commits into the repository on gitlab. (I had sent you the instructions on how to push to gitlab several times on zulip but apparently zulip has silently not been working for quite a while\u2026so, to push your changes there in the future: `git fetch git`@`gitlab.com:saraedum/sage.git t/23505/lattice_precision && git merge FETCH_HEAD && git push git`@`gitlab.com:saraedum/sage.git HEAD:t/23505/lattice_precision`. There are also more convenient commands for this, I can show you later.)",
    "created_at": "2018-02-26T07:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325647",
    "user": "@saraedum"
}
```

`@`caruso: I merged your commits into the repository on gitlab. (I had sent you the instructions on how to push to gitlab several times on zulip but apparently zulip has silently not been working for quite a while…so, to push your changes there in the future: `git fetch git`@`gitlab.com:saraedum/sage.git t/23505/lattice_precision && git merge FETCH_HEAD && git push git`@`gitlab.com:saraedum/sage.git HEAD:t/23505/lattice_precision`. There are also more convenient commands for this, I can show you later.)



---

archive/issue_comments_325648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-02-27T00:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325648",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_325649.json:
```json
{
    "body": "IMHO, not a good idea at all to merge the \"binder\" branch with this ticket. The patchbots will not longer look at it, because it is now unsafe.",
    "created_at": "2018-02-27T09:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325649",
    "user": "@fchapoton"
}
```

IMHO, not a good idea at all to merge the "binder" branch with this ticket. The patchbots will not longer look at it, because it is now unsafe.



---

archive/issue_comments_325650.json:
```json
{
    "body": "I agree, I merged them accidentally.\nI will remove them later. For now, the ticket is not quite ready for review; I just wanted to check whether the patchbot is happy with my changes.",
    "created_at": "2018-02-27T09:33:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325650",
    "user": "@xcaruso"
}
```

I agree, I merged them accidentally.
I will remove them later. For now, the ticket is not quite ready for review; I just wanted to check whether the patchbot is happy with my changes.



---

archive/issue_comments_325651.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-27T10:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325651",
    "user": "@xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325652.json:
```json
{
    "body": "As I said, as long as the branch is messed up, patchbots will refuse to run..",
    "created_at": "2018-02-27T10:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325652",
    "user": "@fchapoton"
}
```

As I said, as long as the branch is messed up, patchbots will refuse to run..



---

archive/issue_comments_325653.json:
```json
{
    "body": "`@`chapoton: Thanks for clarifying how the patchbots work here. We'll take the binder out at the end and squash the other commits. We use the CI integration because we are developing this on [GitLab](GitLab) and also because we wanted to see a sandbox environment to play with this.\n\n`@`caruso: I'll run doctests on [GitLab](GitLab), they should be available in a couple of hours.",
    "created_at": "2018-02-27T10:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325653",
    "user": "@saraedum"
}
```

`@`chapoton: Thanks for clarifying how the patchbots work here. We'll take the binder out at the end and squash the other commits. We use the CI integration because we are developing this on [GitLab](GitLab) and also because we wanted to see a sandbox environment to play with this.

`@`caruso: I'll run doctests on [GitLab](GitLab), they should be available in a couple of hours.



---

archive/issue_comments_325654.json:
```json
{
    "body": "Ok. Thanks to both of you!",
    "created_at": "2018-02-27T10:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325654",
    "user": "@xcaruso"
}
```

Ok. Thanks to both of you!



---

archive/issue_comments_325655.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-03-06T00:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325655",
    "user": "@saraedum"
}
```

New commits:



---

archive/issue_comments_325656.json:
```json
{
    "body": "This has a positive review, once https://gitlab.com/saraedum/sage/-/jobs/55854321 has completed without errors.",
    "created_at": "2018-03-06T00:40:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325656",
    "user": "@saraedum"
}
```

This has a positive review, once https://gitlab.com/saraedum/sage/-/jobs/55854321 has completed without errors.



---

archive/issue_comments_325657.json:
```json
{
    "body": "Replying to [comment:56 saraedum]:\n> This has a positive review, once https://gitlab.com/saraedum/sage/-/jobs/55854321 has completed without errors.\n\nJob's log exceeded limit of 4194304 bytes.",
    "created_at": "2018-03-06T00:44:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325657",
    "user": "@roed314"
}
```

Replying to [comment:56 saraedum]:
> This has a positive review, once https://gitlab.com/saraedum/sage/-/jobs/55854321 has completed without errors.

Job's log exceeded limit of 4194304 bytes.



---

archive/issue_comments_325658.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/interacts/test_jupyter.rst\n**********************************************************************\nFile \"src/sage/interacts/test_jupyter.rst\", line 288, in sage.interacts.test_jupyter\nFailed example:\n    test(interacts.statistics.coin)\nExpected:\n    Interactive function <function coin at ...> with 2 widgets\n      n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)\n      interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)\n    doctest:...: UserWarning: Attempting to set identical bottom==top results\n    in singular transformations; automatically expanding.\n    bottom=0.0, top=0.0\nGot:\n    doctest:... UserWarning: Attempting to set identical bottom==top results\n    in singular transformations; automatically expanding.\n    bottom=0.0, top=0.0\n    Interactive function <function coin at 0x7fb48b00d7d0> with 2 widgets\n      n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)\n      interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)\n```\n\n\nShould we fix this?",
    "created_at": "2018-03-06T07:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325658",
    "user": "@xcaruso"
}
```


```
sage -t --long src/sage/interacts/test_jupyter.rst
**********************************************************************
File "src/sage/interacts/test_jupyter.rst", line 288, in sage.interacts.test_jupyter
Failed example:
    test(interacts.statistics.coin)
Expected:
    Interactive function <function coin at ...> with 2 widgets
      n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)
      interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)
    doctest:...: UserWarning: Attempting to set identical bottom==top results
    in singular transformations; automatically expanding.
    bottom=0.0, top=0.0
Got:
    doctest:... UserWarning: Attempting to set identical bottom==top results
    in singular transformations; automatically expanding.
    bottom=0.0, top=0.0
    Interactive function <function coin at 0x7fb48b00d7d0> with 2 widgets
      n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)
      interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)
```


Should we fix this?



---

archive/issue_comments_325659.json:
```json
{
    "body": "patchbot here is still not 100% happy",
    "created_at": "2018-03-06T07:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325659",
    "user": "@fchapoton"
}
```

patchbot here is still not 100% happy



---

archive/issue_comments_325660.json:
```json
{
    "body": "I fixed some failures but I think that this ticket is not responsible for the doctest failure in `interacts/test_jupyter.rst`. What should I do with it?\n----\nNew commits:",
    "created_at": "2018-03-06T07:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325660",
    "user": "@xcaruso"
}
```

I fixed some failures but I think that this ticket is not responsible for the doctest failure in `interacts/test_jupyter.rst`. What should I do with it?
----
New commits:



---

archive/issue_comments_325661.json:
```json
{
    "body": "I am not sure what this is about. I don't think that's a problem coming from the changes here, so we should not fix it here.\n\nReplying to [comment:58 caruso]:\n> {{{\n> sage -t --long src/sage/interacts/test_jupyter.rst\n> **********************************************************************\n> File \"src/sage/interacts/test_jupyter.rst\", line 288, in sage.interacts.test_jupyter\n> Failed example:\n>     test(interacts.statistics.coin)\n> Expected:\n>     Interactive function <function coin at ...> with 2 widgets\n>       n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)\n>       interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)\n>     doctest:...: UserWarning: Attempting to set identical bottom==top results\n>     in singular transformations; automatically expanding.\n>     bottom=0.0, top=0.0\n> Got:\n>     doctest:... UserWarning: Attempting to set identical bottom==top results\n>     in singular transformations; automatically expanding.\n>     bottom=0.0, top=0.0\n>     Interactive function <function coin at 0x7fb48b00d7d0> with 2 widgets\n>       n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)\n>       interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)\n> }}}\n> \n> Should we fix this?",
    "created_at": "2018-03-06T08:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325661",
    "user": "@saraedum"
}
```

I am not sure what this is about. I don't think that's a problem coming from the changes here, so we should not fix it here.

Replying to [comment:58 caruso]:
> {{{
> sage -t --long src/sage/interacts/test_jupyter.rst
> **********************************************************************
> File "src/sage/interacts/test_jupyter.rst", line 288, in sage.interacts.test_jupyter
> Failed example:
>     test(interacts.statistics.coin)
> Expected:
>     Interactive function <function coin at ...> with 2 widgets
>       n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)
>       interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)
>     doctest:...: UserWarning: Attempting to set identical bottom==top results
>     in singular transformations; automatically expanding.
>     bottom=0.0, top=0.0
> Got:
>     doctest:... UserWarning: Attempting to set identical bottom==top results
>     in singular transformations; automatically expanding.
>     bottom=0.0, top=0.0
>     Interactive function <function coin at 0x7fb48b00d7d0> with 2 widgets
>       n: IntSlider(value=1000, description=u'Number of Tosses', max=10000, min=2, step=100)
>       interval: IntRangeSlider(value=(0, 0), description=u'Plotting range (y)', max=1)
> }}}
> 
> Should we fix this?



---

archive/issue_comments_325662.json:
```json
{
    "body": "So now, only the failure in `interacts/test_jupyter.rst` remains...",
    "created_at": "2018-03-06T10:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325662",
    "user": "@xcaruso"
}
```

So now, only the failure in `interacts/test_jupyter.rst` remains...



---

archive/issue_comments_325663.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-06T14:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325663",
    "user": "@saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_325664.json:
```json
{
    "body": "The PDF reference manual builds. The German \"A Tour of Sage\" fails to build but I can't imagine that this ticket is responsible for this:\n\n```\n[a_tour_of] loading translations [de]... done\n[a_tour_of] Compiling the master document\n[a_tour_of] building [mo]: targets for 0 po files that are out of date\n[a_tour_of] building [latex]: all documents\n[a_tour_of] Merging environment/index files...\n[a_tour_of] ... done (0 todos, 1 index, 0 citations, 0 modules)\n[a_tour_of] Saved pickle file: citations.pickle\n[a_tour_of] processing a_tour_of_sage.tex...index\n[a_tour_of] resolving references...\n[a_tour_of] writing... done\n[a_tour_of] copying images... [ 50%] sin_plot.png\n[a_tour_of] copying images... [100%] eigen_plot.png\n[a_tour_of] copying TeX support files...\n[a_tour_of] done\n[a_tour_of] build succeeded.\nlatexmk -pdf -dvi- -ps-  'a_tour_of_sage.tex'\nLatexmk: applying rule 'pdflatex'...\nThis is pdfTeX, Version 3.14159265-2.6-1.40.16 (TeX Live 2015/Debian) (preloaded format=pdflatex)\n restricted \\write18 enabled.\nentering extended mode\n(./a_tour_of_sage.tex\nLaTeX2e <2016/02/01>\nBabel <3.9q> and hyphenation patterns for 3 language(s) loaded.\n(./sphinxmanual.cls\nDocument Class: sphinxmanual 2017/03/26 v1.6 Document class (Sphinx manual)\n(/usr/share/texlive/texmf-dist/tex/latex/base/report.cls\nDocument Class: report 2014/09/29 v1.4h Standard LaTeX document class\n(/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo)))\n(/usr/share/texlive/texmf-dist/tex/latex/base/inputenc.sty\n(/usr/share/texlive/texmf-dist/tex/latex/base/utf8.def\n(/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.dfu)\n(/usr/share/texlive/texmf-dist/tex/latex/base/ot1enc.dfu)\n(/usr/share/texlive/texmf-dist/tex/latex/base/omsenc.dfu)))\n(/usr/share/texlive/texmf-dist/tex/latex/cmap/cmap.sty)\n(/usr/share/texlive/texmf-dist/tex/latex/base/fontenc.sty\n(/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.def)<<t1.cmap>>)\n(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsmath.sty\nFor additional information on amsmath, use the `?' option.\n(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amstext.sty\n(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsgen.sty))\n(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsbsy.sty)\n(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsopn.sty))\n(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amssymb.sty\n(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amsfonts.sty))\n(/usr/share/texlive/texmf-dist/tex/generic/babel/babel.sty\n\n! Package babel Error: You haven't specified a language option.\n\nSee the babel package documentation for explanation.\nType  H <return>  for immediate help.\n ...\n\nl.343 ...ry to proceed from here, type x to quit.}\n\n?\n! Emergency stop.\n ...\n\nl.343 ...ry to proceed from here, type x to quit.}\n\n!  ==> Fatal error occurred, no output PDF file produced!\nTranscript written on a_tour_of_sage.log.\nLatexmk: Errors, so I did not complete making targets\nMakefile:33: recipe for target 'a_tour_of_sage.pdf' failed\n```\n",
    "created_at": "2018-03-06T14:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325664",
    "user": "@saraedum"
}
```

The PDF reference manual builds. The German "A Tour of Sage" fails to build but I can't imagine that this ticket is responsible for this:

```
[a_tour_of] loading translations [de]... done
[a_tour_of] Compiling the master document
[a_tour_of] building [mo]: targets for 0 po files that are out of date
[a_tour_of] building [latex]: all documents
[a_tour_of] Merging environment/index files...
[a_tour_of] ... done (0 todos, 1 index, 0 citations, 0 modules)
[a_tour_of] Saved pickle file: citations.pickle
[a_tour_of] processing a_tour_of_sage.tex...index
[a_tour_of] resolving references...
[a_tour_of] writing... done
[a_tour_of] copying images... [ 50%] sin_plot.png
[a_tour_of] copying images... [100%] eigen_plot.png
[a_tour_of] copying TeX support files...
[a_tour_of] done
[a_tour_of] build succeeded.
latexmk -pdf -dvi- -ps-  'a_tour_of_sage.tex'
Latexmk: applying rule 'pdflatex'...
This is pdfTeX, Version 3.14159265-2.6-1.40.16 (TeX Live 2015/Debian) (preloaded format=pdflatex)
 restricted \write18 enabled.
entering extended mode
(./a_tour_of_sage.tex
LaTeX2e <2016/02/01>
Babel <3.9q> and hyphenation patterns for 3 language(s) loaded.
(./sphinxmanual.cls
Document Class: sphinxmanual 2017/03/26 v1.6 Document class (Sphinx manual)
(/usr/share/texlive/texmf-dist/tex/latex/base/report.cls
Document Class: report 2014/09/29 v1.4h Standard LaTeX document class
(/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo)))
(/usr/share/texlive/texmf-dist/tex/latex/base/inputenc.sty
(/usr/share/texlive/texmf-dist/tex/latex/base/utf8.def
(/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.dfu)
(/usr/share/texlive/texmf-dist/tex/latex/base/ot1enc.dfu)
(/usr/share/texlive/texmf-dist/tex/latex/base/omsenc.dfu)))
(/usr/share/texlive/texmf-dist/tex/latex/cmap/cmap.sty)
(/usr/share/texlive/texmf-dist/tex/latex/base/fontenc.sty
(/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.def)<<t1.cmap>>)
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsmath.sty
For additional information on amsmath, use the `?' option.
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amstext.sty
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsgen.sty))
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsbsy.sty)
(/usr/share/texlive/texmf-dist/tex/latex/amsmath/amsopn.sty))
(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amssymb.sty
(/usr/share/texlive/texmf-dist/tex/latex/amsfonts/amsfonts.sty))
(/usr/share/texlive/texmf-dist/tex/generic/babel/babel.sty

! Package babel Error: You haven't specified a language option.

See the babel package documentation for explanation.
Type  H <return>  for immediate help.
 ...

l.343 ...ry to proceed from here, type x to quit.}

?
! Emergency stop.
 ...

l.343 ...ry to proceed from here, type x to quit.}

!  ==> Fatal error occurred, no output PDF file produced!
Transcript written on a_tour_of_sage.log.
Latexmk: Errors, so I did not complete making targets
Makefile:33: recipe for target 'a_tour_of_sage.pdf' failed
```




---

archive/issue_comments_325665.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-08T00:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325665",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_325666.json:
```json
{
    "body": "There are issues with python3 division in lattice_precision:\n\n```\nsource ./local/bin/sage-env\npython -Qnew ./local/bin/sage-runtests src/sage/rings/padics\n```\n\nreports many failing doctests.\nThis can be seen also when adding\n\n```\nfrom __future__ import division\n```\n\nin the file.",
    "created_at": "2018-04-30T09:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325666",
    "user": "@fchapoton"
}
```

There are issues with python3 division in lattice_precision:

```
source ./local/bin/sage-env
python -Qnew ./local/bin/sage-runtests src/sage/rings/padics
```

reports many failing doctests.
This can be seen also when adding

```
from __future__ import division
```

in the file.



---

archive/issue_comments_325667.json:
```json
{
    "body": "and you also introduced some \"has_key\", so please review #25280",
    "created_at": "2018-05-02T09:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325667",
    "user": "@fchapoton"
}
```

and you also introduced some "has_key", so please review #25280



---

archive/issue_comments_325668.json:
```json
{
    "body": "Replying to [comment:66 chapoton]:\n> There are issues with python3 division in lattice_precision:\n> {{{\n> source ./local/bin/sage-env\n> python -Qnew ./local/bin/sage-runtests src/sage/rings/padics\n> }}}\n> reports many failing doctests.\n> This can be seen also when adding\n> {{{\n> from __future__ import division\n> }}}\n> in the file.\n\nAdding the line:\n\n`__truediv__ = __div__`\n\nin the defintion of the class `pRational` resolves this issue. Is it the right way to fix this or should I do something else?",
    "created_at": "2018-05-02T21:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325668",
    "user": "@xcaruso"
}
```

Replying to [comment:66 chapoton]:
> There are issues with python3 division in lattice_precision:
> {{{
> source ./local/bin/sage-env
> python -Qnew ./local/bin/sage-runtests src/sage/rings/padics
> }}}
> reports many failing doctests.
> This can be seen also when adding
> {{{
> from __future__ import division
> }}}
> in the file.

Adding the line:

`__truediv__ = __div__`

in the defintion of the class `pRational` resolves this issue. Is it the right way to fix this or should I do something else?



---

archive/issue_comments_325669.json:
```json
{
    "body": "code from this ticket seems to trigger `TimeOut` errors on several machines running sage 8.3.b0, please investigate !\n\nhttps://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-05-11%2012:03:31?short",
    "created_at": "2018-05-12T07:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325669",
    "user": "@fchapoton"
}
```

code from this ticket seems to trigger `TimeOut` errors on several machines running sage 8.3.b0, please investigate !

https://patchbot.sagemath.org/log/0/Ubuntu/18.04/x86_64/4.15.0-20-generic/petitbonum/2018-05-11%2012:03:31?short



---

archive/issue_comments_325670.json:
```json
{
    "body": "Thanks for pointing this out. I created a followup #25431.",
    "created_at": "2018-05-23T11:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325670",
    "user": "@saraedum"
}
```

Thanks for pointing this out. I created a followup #25431.



---

archive/issue_comments_325671.json:
```json
{
    "body": "The file `padic_lattice_element.py` is now one of the last 3 files (see #26212) having more than 100 failing doctests in python3:\n\n```\nsage -t --long src/sage/rings/padics/padic_lattice_element.py  # 167 doctests failed\n```\n\nIt would be appreciated if the authors of this code could handle the task of making all this compatible with python3.",
    "created_at": "2018-10-27T16:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325671",
    "user": "@fchapoton"
}
```

The file `padic_lattice_element.py` is now one of the last 3 files (see #26212) having more than 100 failing doctests in python3:

```
sage -t --long src/sage/rings/padics/padic_lattice_element.py  # 167 doctests failed
```

It would be appreciated if the authors of this code could handle the task of making all this compatible with python3.



---

archive/issue_comments_325672.json:
```json
{
    "body": "I'll take a look.  I've opened #26576.",
    "created_at": "2018-10-28T02:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325672",
    "user": "@roed314"
}
```

I'll take a look.  I've opened #26576.



---

archive/issue_comments_325673.json:
```json
{
    "body": "I'd be happy to contribute as well but I don't know so much about Python3 (which explains why this ticket has so many failures...)\n\nIn particular, what should I do if I want to run doctests with the python3 interpretor. Do I need to install a new copy of sage compiled with python3 or is there something more clever?",
    "created_at": "2018-10-28T03:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325673",
    "user": "@xcaruso"
}
```

I'd be happy to contribute as well but I don't know so much about Python3 (which explains why this ticket has so many failures...)

In particular, what should I do if I want to run doctests with the python3 interpretor. Do I need to install a new copy of sage compiled with python3 or is there something more clever?



---

archive/issue_comments_325674.json:
```json
{
    "body": "There are these doctests errors:\n\n```\nFile \"src/sage/rings/padics/padic_lattice_element.py\", line 31, in sage.rings.padics.padic_lattice_element\nFailed example:\n    R = QpLF(2) # py3\nExpected:\n    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.\n    See http://trac.sagemath.org/23505 for details.\nGot:\n    <BLANKLINE>\n```\n\n\nSo it there anything \"experimental\" left almost 2 years since this ticket has been closed?\nCan these tags or whatever be removed?",
    "created_at": "2020-01-14T14:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23268#issuecomment-325674",
    "user": "@dimpase"
}
```

There are these doctests errors:

```
File "src/sage/rings/padics/padic_lattice_element.py", line 31, in sage.rings.padics.padic_lattice_element
Failed example:
    R = QpLF(2) # py3
Expected:
    doctest:...: FutureWarning: This class/method/function is marked as experimental. It, its functionality or its interface might change without a formal deprecation.
    See http://trac.sagemath.org/23505 for details.
Got:
    <BLANKLINE>
```


So it there anything "experimental" left almost 2 years since this ticket has been closed?
Can these tags or whatever be removed?
