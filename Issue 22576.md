# Issue 22576: Pass number of variables to var

archive/issues_022576.json:
```json
{
    "body": "CC:  @nbruin @kcrisman @tscrim\n\nKeywords: symbolic, vector\n\nExtend the functionality of `var` by allowing to specify the number of variables:\n \n\n```\nsage:\u00a0var('x',\u00a04)\n(x0,\u00a0x1,\u00a0x2,\u00a0x3)\n```\n\n\nThis ticket is a follow-up of #22809. It is related to #11576.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22813\n\n",
    "created_at": "2017-04-14T22:15:25Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Pass number of variables to var",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22576",
    "user": "@mforets"
}
```
CC:  @nbruin @kcrisman @tscrim

Keywords: symbolic, vector

Extend the functionality of `var` by allowing to specify the number of variables:
 

```
sage: var('x', 4)
(x0, x1, x2, x3)
```


This ticket is a follow-up of #22809. It is related to #11576.

Issue created by migration from https://trac.sagemath.org/ticket/22813





---

archive/issue_comments_314877.json:
```json
{
    "body": "> Replying to nbruin : var(*args) already means the same thing as for a in args: var(a), so the signature is not available for different interpretation.\n\nif we parse the arg by the length we get the desired behavior:\n\n\n```\n    if len(args)==1:\n        name = args[0]\n    elif len(args)==2:\n        name = args[0]\n        num_vars = args[1]\n        if num_vars > 1:\n            name = [name + str(i) for i in range(num_vars)]\n    else:\n        name = args\n```\n\n\ndoes it have some other undesired effects? \n\nwith the current set of tests in `var.pyx`, it seems to pass.",
    "created_at": "2017-04-14T22:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314877",
    "user": "@mforets"
}
```

> Replying to nbruin : var(*args) already means the same thing as for a in args: var(a), so the signature is not available for different interpretation.

if we parse the arg by the length we get the desired behavior:


```
    if len(args)==1:
        name = args[0]
    elif len(args)==2:
        name = args[0]
        num_vars = args[1]
        if num_vars > 1:
            name = [name + str(i) for i in range(num_vars)]
    else:
        name = args
```


does it have some other undesired effects? 

with the current set of tests in `var.pyx`, it seems to pass.



---

archive/issue_comments_314878.json:
```json
{
    "body": "Problem: `var(\"x\",\"y\")`, as long as `\"y\">1`(which is true at the moment). Problem in python: duck typing. The second argument could be \"stringy\" or \"integery\" or both. In the \"both\" case, there's no way to choose.",
    "created_at": "2017-04-14T22:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314878",
    "user": "@nbruin"
}
```

Problem: `var("x","y")`, as long as `"y">1`(which is true at the moment). Problem in python: duck typing. The second argument could be "stringy" or "integery" or both. In the "both" case, there's no way to choose.



---

archive/issue_comments_314879.json:
```json
{
    "body": "IIRC `'y' > 1` will fail in Python3. However, you could do `isinstance(args[1], str)` to get around the ducktyping. It's not like any of this code needs to be super fast/lightweight.",
    "created_at": "2017-04-14T23:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314879",
    "user": "@tscrim"
}
```

IIRC `'y' > 1` will fail in Python3. However, you could do `isinstance(args[1], str)` to get around the ducktyping. It's not like any of this code needs to be super fast/lightweight.



---

archive/issue_comments_314880.json:
```json
{
    "body": "Added the numeric 2nd argument, following `@`tscrim's recommendation.\n\nLet me suggest to add functionality for handling more than one variable. Note that the behavior below is a replica of SymPy's symbols constructor, check `from sympy import symbols`.\n\n\n\n```\nIt is possible to handle several variables if we pass a list of names as first argument::\n\n    sage: var(['x', 'y'], 2)\n    ((x0, x1), (y0, y1))\n```\n\n\nand\n\n\n```\nThe input variable name(s) is taken as initial subindex::\n\nsage: var(['x1', 'y2'], 2)\n((x1, x2), (y2, y3))\n```\n\n\nWhat are your thoughts?\n----\nNew commits:",
    "created_at": "2017-04-15T07:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314880",
    "user": "@mforets"
}
```

Added the numeric 2nd argument, following `@`tscrim's recommendation.

Let me suggest to add functionality for handling more than one variable. Note that the behavior below is a replica of SymPy's symbols constructor, check `from sympy import symbols`.



```
It is possible to handle several variables if we pass a list of names as first argument::

    sage: var(['x', 'y'], 2)
    ((x0, x1), (y0, y1))
```


and


```
The input variable name(s) is taken as initial subindex::

sage: var(['x1', 'y2'], 2)
((x1, x2), (y2, y3))
```


What are your thoughts?
----
New commits:



---

archive/issue_comments_314881.json:
```json
{
    "body": "There is, of course, the danger that this could overwrite someone's already-defined variables - say, if\n\n```\nx3=end_of_computation_of_last_twin_prime_pair # Fields Medal in hand!\nvar('x',5) # oops\n```\n\nthough of course that can happen anyway, this is just more silent about it.  Perhaps a check to see whether any of the variables about to be produced is already defined?  Though we don't currently do that and the same danger exists... this is just more implicit, which isn't very Pythonic.\n\nNone of this should be construed as not supporting the goal of this ticket, I'm just raising questions.",
    "created_at": "2017-04-15T12:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314881",
    "user": "@kcrisman"
}
```

There is, of course, the danger that this could overwrite someone's already-defined variables - say, if

```
x3=end_of_computation_of_last_twin_prime_pair # Fields Medal in hand!
var('x',5) # oops
```

though of course that can happen anyway, this is just more silent about it.  Perhaps a check to see whether any of the variables about to be produced is already defined?  Though we don't currently do that and the same danger exists... this is just more implicit, which isn't very Pythonic.

None of this should be construed as not supporting the goal of this ticket, I'm just raising questions.



---

archive/issue_comments_314882.json:
```json
{
    "body": "I would expect `var('y1', 2)` to give me `y10, y11`, so having that be the initial value would be very surprising. So -1 on parsing out the number of the variable to be the start index.",
    "created_at": "2017-04-15T15:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314882",
    "user": "@tscrim"
}
```

I would expect `var('y1', 2)` to give me `y10, y11`, so having that be the initial value would be very surprising. So -1 on parsing out the number of the variable to be the start index.



---

archive/issue_comments_314883.json:
```json
{
    "body": "fair enough about naming conventions or handy constructions. as far as i'm concerned, this ticket is ready for peer-review!",
    "created_at": "2017-04-15T19:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314883",
    "user": "@mforets"
}
```

fair enough about naming conventions or handy constructions. as far as i'm concerned, this ticket is ready for peer-review!



---

archive/issue_comments_314884.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-15T19:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314884",
    "user": "@mforets"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314885.json:
```json
{
    "body": "Replying to [comment:6 kcrisman]:\n> There is, of course, the danger that this could overwrite someone's already-defined variables\n\nI think that's one of the reasons why this doesn't belong in the top-level `var`. I could see why people would want to have a shorthand for\n\n```\nlambda x,n: tuple(SR.symbol(\"%s%s\"%(x,i)) for in range(n))\n```\n\nor perhaps even\n\n```\nlambda x,n,m: tuple(tuple(SR.symbol(\"%s%s_%s\"%(x,i,j)) for j in range(m)) for i in range(n))\n```\n\nbut you'd probably want to bind the result to a single symbol, say `X`, so that you can spell variables programmatically via `X[i]` or `X[i][j]`.\nThis is also the approach taken in\n\n```\nsage: R.<X>=InfinitePolynomialRing(QQ)\n```\n\nwhere you need to use `X[0],X[1]` etc.\n\nIn other words, generating indexed symbolic variables is probably not suitable for injection at all.",
    "created_at": "2017-04-15T21:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314885",
    "user": "@nbruin"
}
```

Replying to [comment:6 kcrisman]:
> There is, of course, the danger that this could overwrite someone's already-defined variables

I think that's one of the reasons why this doesn't belong in the top-level `var`. I could see why people would want to have a shorthand for

```
lambda x,n: tuple(SR.symbol("%s%s"%(x,i)) for in range(n))
```

or perhaps even

```
lambda x,n,m: tuple(tuple(SR.symbol("%s%s_%s"%(x,i,j)) for j in range(m)) for i in range(n))
```

but you'd probably want to bind the result to a single symbol, say `X`, so that you can spell variables programmatically via `X[i]` or `X[i][j]`.
This is also the approach taken in

```
sage: R.<X>=InfinitePolynomialRing(QQ)
```

where you need to use `X[0],X[1]` etc.

In other words, generating indexed symbolic variables is probably not suitable for injection at all.



---

archive/issue_comments_314886.json:
```json
{
    "body": "Replying to [comment:9 nbruin]:\n> Replying to [comment:6 kcrisman]:\n> > There is, of course, the danger that this could overwrite someone's already-defined variables\n> \n> I think that's one of the reasons why this doesn't belong in the top-level `var`. I could see why people would want to have a shorthand for\n> {{{\n> lambda x,n: tuple(SR.symbol(\"%s%s\"%(x,i)) for in range(n))\n> }}}\n> or perhaps even\n> {{{\n> lambda x,n,m: tuple(tuple(SR.symbol(\"%s%s_%s\"%(x,i,j)) for j in range(m)) for i in range(n))\n> }}}\n> but you'd probably want to bind the result to a single symbol, say `X`, so that you can spell variables programmatically via `X[i]` or `X[i][j]`.\n> This is also the approach taken in\n> {{{\n> sage: R.<X>=InfinitePolynomialRing(QQ)\n> }}}\n> where you need to use `X[0],X[1]` etc.\n> \n> In other words, generating indexed symbolic variables is probably not suitable for injection at all.\n\nOK, it makes sense. Moreover it also answers my previous question if there is a technical reason why `var` wasn't defined to work with vectors/matrices already in Sage (.. I was comparing to Matlab's `sym('x', m, n)` command, but that one only returns the object, it does no injection).\n\nI guess this is wontfix?",
    "created_at": "2017-04-17T05:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314886",
    "user": "@mforets"
}
```

Replying to [comment:9 nbruin]:
> Replying to [comment:6 kcrisman]:
> > There is, of course, the danger that this could overwrite someone's already-defined variables
> 
> I think that's one of the reasons why this doesn't belong in the top-level `var`. I could see why people would want to have a shorthand for
> {{{
> lambda x,n: tuple(SR.symbol("%s%s"%(x,i)) for in range(n))
> }}}
> or perhaps even
> {{{
> lambda x,n,m: tuple(tuple(SR.symbol("%s%s_%s"%(x,i,j)) for j in range(m)) for i in range(n))
> }}}
> but you'd probably want to bind the result to a single symbol, say `X`, so that you can spell variables programmatically via `X[i]` or `X[i][j]`.
> This is also the approach taken in
> {{{
> sage: R.<X>=InfinitePolynomialRing(QQ)
> }}}
> where you need to use `X[0],X[1]` etc.
> 
> In other words, generating indexed symbolic variables is probably not suitable for injection at all.

OK, it makes sense. Moreover it also answers my previous question if there is a technical reason why `var` wasn't defined to work with vectors/matrices already in Sage (.. I was comparing to Matlab's `sym('x', m, n)` command, but that one only returns the object, it does no injection).

I guess this is wontfix?



---

archive/issue_comments_314887.json:
```json
{
    "body": "Perhaps what we want is the output of `var('x', 3)` to inject the tuple `x` of variables `(x0, x1, x2)`. This would be in line with polynomial rings and what we do with other calls to `var`.",
    "created_at": "2017-04-17T14:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314887",
    "user": "@tscrim"
}
```

Perhaps what we want is the output of `var('x', 3)` to inject the tuple `x` of variables `(x0, x1, x2)`. This would be in line with polynomial rings and what we do with other calls to `var`.



---

archive/issue_comments_314888.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-21T09:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314888",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314889.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> Perhaps what we want is the output of `var('x', 3)` to inject the tuple `x` of variables `(x0, x1, x2)`. This would be in line with polynomial rings and what we do with other calls to `var`.\n\nGood, i've uploaded an attempt to implement it. Feedback welcome. The behavior is now:\n\n\n```\nsage:\u00a0x\u00a0=\u00a0var('x',\u00a03)\nsage:\u00a0x\n(x0,\u00a0x1,\u00a0x2)\nsage:\u00a0x1\n---------------------------------------------------------------------------\nNameError\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0Traceback\u00a0(most\u00a0recent\u00a0call\u00a0last)\n<ipython-input-21-e8a5da2185eb>\u00a0in\u00a0<module>()\n---->\u00a01\u00a0x1\n\u00a0\nNameError:\u00a0name\u00a0'x1'\u00a0is\u00a0not\u00a0defined\n```\n \n\nBTW this is related to #11576, a summary follows. There are pointers to use cases where this notation is useful. There are also many technical hints explaining that one would prefer to exploit Ginac's indexed expressions. There are patches, the last one with a doctests failure reported in sage 5.10. \n\nAs far as i can see, a random user would still need, currently, the convoluted `a = var(','.join('a%s'%i for i in range(4))); a`, hence comparable to `a = var('a', 4)` in terms of performance (?).",
    "created_at": "2017-04-21T10:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314889",
    "user": "@mforets"
}
```

Replying to [comment:11 tscrim]:
> Perhaps what we want is the output of `var('x', 3)` to inject the tuple `x` of variables `(x0, x1, x2)`. This would be in line with polynomial rings and what we do with other calls to `var`.

Good, i've uploaded an attempt to implement it. Feedback welcome. The behavior is now:


```
sage: x = var('x', 3)
sage: x
(x0, x1, x2)
sage: x1
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-21-e8a5da2185eb> in <module>()
----> 1 x1
 
NameError: name 'x1' is not defined
```
 

BTW this is related to #11576, a summary follows. There are pointers to use cases where this notation is useful. There are also many technical hints explaining that one would prefer to exploit Ginac's indexed expressions. There are patches, the last one with a doctests failure reported in sage 5.10. 

As far as i can see, a random user would still need, currently, the convoluted `a = var(','.join('a%s'%i for i in range(4))); a`, hence comparable to `a = var('a', 4)` in terms of performance (?).



---

archive/issue_comments_314890.json:
```json
{
    "body": "Instead of checking for a string and assuming it's a number otherwise, I'd rather do it the other way around: check for a number with `operator.index()`. If that fails, assume it's a string.\n\nI also dislike the `if num_vars > 1`: why special-case `num_vars == 0` and `num_vars == 1`? There should also be a check for negative numbers like `var(x, -23)`.",
    "created_at": "2017-04-21T12:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314890",
    "user": "@jdemeyer"
}
```

Instead of checking for a string and assuming it's a number otherwise, I'd rather do it the other way around: check for a number with `operator.index()`. If that fails, assume it's a string.

I also dislike the `if num_vars > 1`: why special-case `num_vars == 0` and `num_vars == 1`? There should also be a check for negative numbers like `var(x, -23)`.



---

archive/issue_comments_314891.json:
```json
{
    "body": "Hi,\n\nReplying to [comment:14 jdemeyer]:\n> Instead of checking for a string and assuming it's a number otherwise, I'd rather do it the other way around: check for a number with `operator.index()`. If that fails, assume it's a string.\n> \n\ndo you mean `if hasattr(args[1], '__index__')`? \n\n> I also dislike the `if num_vars > 1`: why special-case `num_vars == 0` and `num_vars == 1`? There should also be a check for negative numbers like `var(x, -23)`.\n\nthis was intended for the case `var('x', 1)`, which should return i suppose `x0`. in this situation, passing a list is wrong because the command `SR.var(['x0'])` is not ok (gives `TypeError: unhashable type: 'list'`). so i didn't know if there is a way to bypass this issue without making the 2 cases.\n\nwith those changes, the `if` becomes:\n\n\n```\n    got_number = False\n    if len(args)==1:\n        name = args[0]\n    elif len(args)==2:\n        if hasattr(args[1], '__index__'):\n            got_number = True\n            num_vars = args[1]\n            if num_vars == 1:\n                name = (args[0] + '0')\n            elif num_vars > 1:\n                name = [args[0] + str(i) for i in range(num_vars)]\n            else:\n                raise ValueError(\"The number number of variables should be at least 1\")\n        else:\n            name = args\n    else:\n        name = args\n```\n",
    "created_at": "2017-04-21T16:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314891",
    "user": "@mforets"
}
```

Hi,

Replying to [comment:14 jdemeyer]:
> Instead of checking for a string and assuming it's a number otherwise, I'd rather do it the other way around: check for a number with `operator.index()`. If that fails, assume it's a string.
> 

do you mean `if hasattr(args[1], '__index__')`? 

> I also dislike the `if num_vars > 1`: why special-case `num_vars == 0` and `num_vars == 1`? There should also be a check for negative numbers like `var(x, -23)`.

this was intended for the case `var('x', 1)`, which should return i suppose `x0`. in this situation, passing a list is wrong because the command `SR.var(['x0'])` is not ok (gives `TypeError: unhashable type: 'list'`). so i didn't know if there is a way to bypass this issue without making the 2 cases.

with those changes, the `if` becomes:


```
    got_number = False
    if len(args)==1:
        name = args[0]
    elif len(args)==2:
        if hasattr(args[1], '__index__'):
            got_number = True
            num_vars = args[1]
            if num_vars == 1:
                name = (args[0] + '0')
            elif num_vars > 1:
                name = [args[0] + str(i) for i in range(num_vars)]
            else:
                raise ValueError("The number number of variables should be at least 1")
        else:
            name = args
    else:
        name = args
```




---

archive/issue_comments_314892.json:
```json
{
    "body": "Replying to [comment:15 mforets]:\n> do you mean `if hasattr(args[1], '__index__')`? \nI'm pretty sure he rather meant\n\n```\ntry:\n  num_vars = operator.index(args[1])\n  ...\nexcept TypeError:\n  name = args\n```\n",
    "created_at": "2017-04-21T16:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314892",
    "user": "@nbruin"
}
```

Replying to [comment:15 mforets]:
> do you mean `if hasattr(args[1], '__index__')`? 
I'm pretty sure he rather meant

```
try:
  num_vars = operator.index(args[1])
  ...
except TypeError:
  name = args
```




---

archive/issue_comments_314893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-21T19:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314893",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_314894.json:
```json
{
    "body": "Replying to [comment:16 nbruin]:\n> Replying to [comment:15 mforets]:\n> > do you mean `if hasattr(args[1], '__index__')`? \n> I'm pretty sure he rather meant\n> {{{\n> try:\n>   num_vars = operator.index(args[1])\n>   ...\n> except TypeError:\n>   name = args\n> }}}\n\nok. for the `import operator` statement, in other files this is done at the script level (here, `var.pyx`), while at others it is at the function level (here, `def var`). assuming that the condition is that to be on top it should be used by more than 1 function, i've put it inside `def var`.\n\nupdated version with:\n\n- case of 1 variable : \n\n\n```\nsage: polygens(QQ, 'x', 1)    # returns a tuple\n(x,)\nsage: var('x', 1)    # returns a tuple, too\n(x0,)\nsage: var('x')    # usual, does not return a tuple\nx\n```\n\n\n- check tuple is injected properly :\n\n\n```\nsage: var('z', 2)\n(z0, z1)\nsage: z\n(z0, z1)\n```\n\n\ncritics/corrections welcome",
    "created_at": "2017-04-21T19:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314894",
    "user": "@mforets"
}
```

Replying to [comment:16 nbruin]:
> Replying to [comment:15 mforets]:
> > do you mean `if hasattr(args[1], '__index__')`? 
> I'm pretty sure he rather meant
> {{{
> try:
>   num_vars = operator.index(args[1])
>   ...
> except TypeError:
>   name = args
> }}}

ok. for the `import operator` statement, in other files this is done at the script level (here, `var.pyx`), while at others it is at the function level (here, `def var`). assuming that the condition is that to be on top it should be used by more than 1 function, i've put it inside `def var`.

updated version with:

- case of 1 variable : 


```
sage: polygens(QQ, 'x', 1)    # returns a tuple
(x,)
sage: var('x', 1)    # returns a tuple, too
(x0,)
sage: var('x')    # usual, does not return a tuple
x
```


- check tuple is injected properly :


```
sage: var('z', 2)
(z0, z1)
sage: z
(z0, z1)
```


critics/corrections welcome



---

archive/issue_comments_314895.json:
```json
{
    "body": "Style in python prefers imports on top (see PEP-8). There are reasons to deviate, and reasons not to. The answer at\n[stackoverflow](http://stackoverflow.com/questions/128478/should-python-import-statements-always-be-at-the-top-of-a-module) seems pretty comprehensive and sensible.\n\nMost imports in functions in sage are to avoid expensive imports on startup and to avoid some circular import problems with `from ... import ...` statements. I don't think that applies here, so the import should go on top.",
    "created_at": "2017-04-21T19:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314895",
    "user": "@nbruin"
}
```

Style in python prefers imports on top (see PEP-8). There are reasons to deviate, and reasons not to. The answer at
[stackoverflow](http://stackoverflow.com/questions/128478/should-python-import-statements-always-be-at-the-top-of-a-module) seems pretty comprehensive and sensible.

Most imports in functions in sage are to avoid expensive imports on startup and to avoid some circular import problems with `from ... import ...` statements. I don't think that applies here, so the import should go on top.



---

archive/issue_comments_314896.json:
```json
{
    "body": "I'm -1 on this injection and the place where this change happens. First the place:\n\n`SR.var` is the main routine, which works side-effect free. Any API changes should be done there (and I think `SR.var('x',3)` would not get too much in the way). The top-level `var` only differs from `SR.var` in order to support binding injection.\n\nNext the kind of injection.\n\nWith `var('z',2)` the return value is `(z0,z1)`, while the binding is to the name indicated by the string `z`. I think in most cases people who use this would want to do `z=SR.var('z',2)`, which expresses the result perfectly and also reflects how a significant number of examples in our documentation use `var` (as in `x=var('x')`). However, it is not obvious to me that people would automatically expect `var('z',2)` to have that effect. I expect that half of them would expect `z0,z1` to be bound, because that is what `var('z0,z1')` does and it has the same return value.\nThat's confusing.\n\nHence: generating variable sequences is fine, but the \"right\" injection behaviour here is even less clear than in a simple `var`. Starting afresh, I would not expect `var` to have its injection behaviour at all. Some magic command like `%var x` or a preprocessor construct is a much more natural syntax vehicle for it. In this case, I don't see one obvious way of extending `var`'s injection behaviour in a natural way, so I think this shouldn't be done at all.\n\nFirst put it in SR.var and see what usage arises. Perhaps practical experience shows how (if at all) injection should work.",
    "created_at": "2017-04-21T20:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314896",
    "user": "@nbruin"
}
```

I'm -1 on this injection and the place where this change happens. First the place:

`SR.var` is the main routine, which works side-effect free. Any API changes should be done there (and I think `SR.var('x',3)` would not get too much in the way). The top-level `var` only differs from `SR.var` in order to support binding injection.

Next the kind of injection.

With `var('z',2)` the return value is `(z0,z1)`, while the binding is to the name indicated by the string `z`. I think in most cases people who use this would want to do `z=SR.var('z',2)`, which expresses the result perfectly and also reflects how a significant number of examples in our documentation use `var` (as in `x=var('x')`). However, it is not obvious to me that people would automatically expect `var('z',2)` to have that effect. I expect that half of them would expect `z0,z1` to be bound, because that is what `var('z0,z1')` does and it has the same return value.
That's confusing.

Hence: generating variable sequences is fine, but the "right" injection behaviour here is even less clear than in a simple `var`. Starting afresh, I would not expect `var` to have its injection behaviour at all. Some magic command like `%var x` or a preprocessor construct is a much more natural syntax vehicle for it. In this case, I don't see one obvious way of extending `var`'s injection behaviour in a natural way, so I think this shouldn't be done at all.

First put it in SR.var and see what usage arises. Perhaps practical experience shows how (if at all) injection should work.



---

archive/issue_comments_314897.json:
```json
{
    "body": "Replying to [comment:20 nbruin]:\n> First put it in SR.var and see what usage arises. Perhaps practical experience shows how (if at all) injection should work.\n\nok! i'm ready to write the code for SR.var (new ticket). do you mind creating it? (i don't know if doing that right now is ok or on the contrary it is too soon to take that decision..)\n\nfor the full discussion, true, now i see that you want to avoid `var('z', 2)` and `var('z0, z1')` behaving differently.",
    "created_at": "2017-04-23T09:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314897",
    "user": "@mforets"
}
```

Replying to [comment:20 nbruin]:
> First put it in SR.var and see what usage arises. Perhaps practical experience shows how (if at all) injection should work.

ok! i'm ready to write the code for SR.var (new ticket). do you mind creating it? (i don't know if doing that right now is ok or on the contrary it is too soon to take that decision..)

for the full discussion, true, now i see that you want to avoid `var('z', 2)` and `var('z0, z1')` behaving differently.



---

archive/issue_comments_314898.json:
```json
{
    "body": "Replying to [comment:20 nbruin]:\n> First put it in SR.var and see what usage arises. Perhaps practical experience shows how (if at all) injection should work.\n\nThanks. This is #22909.",
    "created_at": "2017-04-30T10:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314898",
    "user": "@mforets"
}
```

Replying to [comment:20 nbruin]:
> First put it in SR.var and see what usage arises. Perhaps practical experience shows how (if at all) injection should work.

Thanks. This is #22909.



---

archive/issue_comments_314899.json:
```json
{
    "body": "Is this is **invalid/wontfix**? Who does that? Thanks.",
    "created_at": "2017-05-25T11:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314899",
    "user": "@mforets"
}
```

Is this is **invalid/wontfix**? Who does that? Thanks.



---

archive/issue_comments_314900.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-05-25T11:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314900",
    "user": "@mforets"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_314901.json:
```json
{
    "body": "You would set the milestone to invald/wontfix, but I am not sure that is what we want to do at this point. #22909 is a different issue and having this would be useful. I think there is still some discussion to be had as I feel the injection issue is no worse than the current situation. I think we should come to a bit more of a consensus before rendering this ticket invalid.",
    "created_at": "2017-05-25T21:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314901",
    "user": "@tscrim"
}
```

You would set the milestone to invald/wontfix, but I am not sure that is what we want to do at this point. #22909 is a different issue and having this would be useful. I think there is still some discussion to be had as I feel the injection issue is no worse than the current situation. I think we should come to a bit more of a consensus before rendering this ticket invalid.



---

archive/issue_comments_314902.json:
```json
{
    "body": "Replying to [comment:24 tscrim]:\n> You would set the milestone to invald/wontfix, but I am not sure that is what we want to do at this point. #22909 is a different issue and having this would be useful. I think there is still some discussion to be had as I feel the injection issue is no worse than the current situation. I think we should come to a bit more of a consensus before rendering this ticket invalid.\n\nThat's fine. If a new discussion takes place, it would be nice if it kicks off with a summary of the several threads on this topic that exist in sage-devel, sage-support and ask.sage (plus those in a couple of old tickets). I don't plan to do this, at least not at the moment.",
    "created_at": "2017-05-27T13:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314902",
    "user": "@mforets"
}
```

Replying to [comment:24 tscrim]:
> You would set the milestone to invald/wontfix, but I am not sure that is what we want to do at this point. #22909 is a different issue and having this would be useful. I think there is still some discussion to be had as I feel the injection issue is no worse than the current situation. I think we should come to a bit more of a consensus before rendering this ticket invalid.

That's fine. If a new discussion takes place, it would be nice if it kicks off with a summary of the several threads on this topic that exist in sage-devel, sage-support and ask.sage (plus those in a couple of old tickets). I don't plan to do this, at least not at the moment.



---

archive/issue_comments_314903.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-03-13T14:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314903",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_314904.json:
```json
{
    "body": "This is fixed by #22909 (albeit requesting using the `n=` keyword...).\n\n==> marking as duplicate and requesting review in order to solve...",
    "created_at": "2021-03-13T14:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314904",
    "user": "@EmmanuelCharpentier"
}
```

This is fixed by #22909 (albeit requesting using the `n=` keyword...).

==> marking as duplicate and requesting review in order to solve...



---

archive/issue_comments_314905.json:
```json
{
    "body": "As you can see from the discussion, at least Travis thought this wasn't 100% resolved, since this ticket is now about injection into the global namespace of the `SR.var` from #22909.\n\nOf course, we could also close this as undesirable or something not to work on now but rather if it comes up again.  Marcelo and Nils seemed to agree with me that maybe that wasn't bad.  See if Travis responds (he's usually pretty aware of relevant ticket changes he's cc:ed on) otherwise I this we can indeed close this, though as wontfix rather than a dup.",
    "created_at": "2021-03-13T22:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314905",
    "user": "@kcrisman"
}
```

As you can see from the discussion, at least Travis thought this wasn't 100% resolved, since this ticket is now about injection into the global namespace of the `SR.var` from #22909.

Of course, we could also close this as undesirable or something not to work on now but rather if it comes up again.  Marcelo and Nils seemed to agree with me that maybe that wasn't bad.  See if Travis responds (he's usually pretty aware of relevant ticket changes he's cc:ed on) otherwise I this we can indeed close this, though as wontfix rather than a dup.



---

archive/issue_comments_314906.json:
```json
{
    "body": "Replying to [comment:27 kcrisman]:\n> As you can see from the discussion, at least Travis thought this wasn't 100% resolved, since this ticket is now about injection into the global namespace of the `SR.var` from #22909.\n\nThe current behavior seems OK :\n\n\n```\nsage: var(\"z\", n=2)\n(z0, z1)\nsage: z0\nz0\nsage: z\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-10-3a710d2a84f8> in <module>\n----> 1 z\n\nNameError: name 'z' is not defined\n```\n\n\nUsers can always do `z=var(\"z\", n=2` if needed, but might prefer `Z=var(\"z\", n=2` or {{{, if only for pedagogical reasons.\n\nFurthermore, we have so far just a trick to define a bunch of symbolic variables easily, but no mathematical properties associated with this bunch.\n\nWe could want to do something like `z=vector(var(\"z\", n=2))`, but is this really what we mean ? It seems to me that this //restricts// the possible (or at least the easy) use cases of these indexed variables, since it implies that those symbolic variables have common properties (e. g. their possible values have the same parent...).\n\nSuch an addition would be extremely tempting, however, if we could create \"symbolic variables of a fixed type\", which do not exist currently in Sage (e. g. there is no way to create a polynomial with, say, rational coefficients designated by names rather than values...).\n \n> Of course, we could also close this as undesirable or something not to work on now but rather if it comes up again.  Marcelo and Nils seemed to agree with me that maybe that wasn't bad.  See if Travis responds (he's usually pretty aware of relevant ticket changes he's cc:ed on) otherwise I this we can indeed close this, though as wontfix rather than a dup.\n\nAs far as I know, this the same closure `(\"duplicate/invalid/wontfix\")`...",
    "created_at": "2021-03-13T23:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314906",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:27 kcrisman]:
> As you can see from the discussion, at least Travis thought this wasn't 100% resolved, since this ticket is now about injection into the global namespace of the `SR.var` from #22909.

The current behavior seems OK :


```
sage: var("z", n=2)
(z0, z1)
sage: z0
z0
sage: z
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-10-3a710d2a84f8> in <module>
----> 1 z

NameError: name 'z' is not defined
```


Users can always do `z=var("z", n=2` if needed, but might prefer `Z=var("z", n=2` or {{{, if only for pedagogical reasons.

Furthermore, we have so far just a trick to define a bunch of symbolic variables easily, but no mathematical properties associated with this bunch.

We could want to do something like `z=vector(var("z", n=2))`, but is this really what we mean ? It seems to me that this //restricts// the possible (or at least the easy) use cases of these indexed variables, since it implies that those symbolic variables have common properties (e. g. their possible values have the same parent...).

Such an addition would be extremely tempting, however, if we could create "symbolic variables of a fixed type", which do not exist currently in Sage (e. g. there is no way to create a polynomial with, say, rational coefficients designated by names rather than values...).
 
> Of course, we could also close this as undesirable or something not to work on now but rather if it comes up again.  Marcelo and Nils seemed to agree with me that maybe that wasn't bad.  See if Travis responds (he's usually pretty aware of relevant ticket changes he's cc:ed on) otherwise I this we can indeed close this, though as wontfix rather than a dup.

As far as I know, this the same closure `("duplicate/invalid/wontfix")`...



---

archive/issue_comments_314907.json:
```json
{
    "body": "I wouldn't say the current behaviour is \"OK\", but it's a fact that we already have that:\n\n```\nsage: var(\"z\",n=2)\nsage: z0,z1\n```\n\nso it's already injecting the (individual) variables. As I explained above, I expect that this is one of 3 outcomes:\n- `var(\"z\",n=2)` should bind the names of the symbols it creates, or\n- `var(\"z\",n=2)` should bind `z` to a tuple so that `z[0]` and `z[1]` are the desired symbols, or\n- `var(\"z\",n=2)` shouldn't bind anything because we don't know what to bind: the names `z0,z1` aren't explicitly mentioned, so those should be out-of-bounds, and `z` isn't really created as a symbol itself.\nPersonally I think: `var(...)` shouldn't support `n=...` at all because it's unclear what it should do. People should be steered to `SR.var` which forces people to perform the desired binding behaviour. That ship has sailed, though. And if people get confused by `var` then we can just say:  use `SR.var` instead.\n\nso +1 on closing as duplicate/wontfix",
    "created_at": "2021-03-14T21:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314907",
    "user": "@nbruin"
}
```

I wouldn't say the current behaviour is "OK", but it's a fact that we already have that:

```
sage: var("z",n=2)
sage: z0,z1
```

so it's already injecting the (individual) variables. As I explained above, I expect that this is one of 3 outcomes:
- `var("z",n=2)` should bind the names of the symbols it creates, or
- `var("z",n=2)` should bind `z` to a tuple so that `z[0]` and `z[1]` are the desired symbols, or
- `var("z",n=2)` shouldn't bind anything because we don't know what to bind: the names `z0,z1` aren't explicitly mentioned, so those should be out-of-bounds, and `z` isn't really created as a symbol itself.
Personally I think: `var(...)` shouldn't support `n=...` at all because it's unclear what it should do. People should be steered to `SR.var` which forces people to perform the desired binding behaviour. That ship has sailed, though. And if people get confused by `var` then we can just say:  use `SR.var` instead.

so +1 on closing as duplicate/wontfix



---

archive/issue_comments_314908.json:
```json
{
    "body": "I agree with Nils that the behavior needs to be better specified, which means there needs to be better documentation. So I am okay with closing this as duplicate, but we might want to consider update the documentation of `var()` to make it clear what the behavior is. We can argue later about what the behavior should be.\n\nWhich, getting towards that later argument, I see Nils point about binding. I typically want the tuple and utilize that because I will later on iterate over the variables. So I might lean towards that behavior rather than injecting the individual variables. However, I can see a lot of cases where I would instead just use the individual variables, which I feel would be more in line with a less programming-friendly user. There is some advantage to the current behavior that you can have the best of both worlds with `z = var('z', n=5)`.",
    "created_at": "2021-03-15T01:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314908",
    "user": "@tscrim"
}
```

I agree with Nils that the behavior needs to be better specified, which means there needs to be better documentation. So I am okay with closing this as duplicate, but we might want to consider update the documentation of `var()` to make it clear what the behavior is. We can argue later about what the behavior should be.

Which, getting towards that later argument, I see Nils point about binding. I typically want the tuple and utilize that because I will later on iterate over the variables. So I might lean towards that behavior rather than injecting the individual variables. However, I can see a lot of cases where I would instead just use the individual variables, which I feel would be more in line with a less programming-friendly user. There is some advantage to the current behavior that you can have the best of both worlds with `z = var('z', n=5)`.



---

archive/issue_comments_314909.json:
```json
{
    "body": "Okay.  Then let's close this one, and Travis can you open a new ticket that describes exactly what you are thinking of?  I don't have a horse in this race other than making sure everything is meta-documented on Trac :-)",
    "created_at": "2021-03-15T17:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314909",
    "user": "@kcrisman"
}
```

Okay.  Then let's close this one, and Travis can you open a new ticket that describes exactly what you are thinking of?  I don't have a horse in this race other than making sure everything is meta-documented on Trac :-)



---

archive/issue_comments_314910.json:
```json
{
    "body": "We can just refer to this ticket for now until we have a more concrete proposal. I am also stretched a little too thin right now to put much effort into this.",
    "created_at": "2021-03-22T04:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314910",
    "user": "@tscrim"
}
```

We can just refer to this ticket for now until we have a more concrete proposal. I am also stretched a little too thin right now to put much effort into this.



---

archive/issue_comments_314911.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-22T04:59:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314911",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314912.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-06-24T20:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22576#issuecomment-314912",
    "user": "@mkoeppe"
}
```

Resolution: invalid
