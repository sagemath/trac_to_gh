# Issue 26493: random chordal graphs generator

Issue created by migration from Trac.

Original creator: dcoudert

Original creation time: 2018-11-21 14:17:43

CC:  tscrim

Implement the random chordal graphs generator proposed in https://arxiv.org/abs/1810.13326

It is based on the intersection graph of randomly selected subtrees of a random tree.


---

Comment by dcoudert created at 2018-11-21 14:23:20

New commits:


---

Comment by dcoudert created at 2018-11-21 14:23:20

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-11-23 10:17:47

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2018-11-23 10:17:47

I'm currently discussing with one of the Authors of the algorithm about some details, in particular what to do when a subtree is selected twice. I will update the code accordingly.


---

Comment by git created at 2018-11-23 17:18:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-11-23 19:57:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-11-23 20:00:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-23 20:03:33

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2018-11-23 20:03:33

I have modified the code so that we can find several times the same subtree.


---

Comment by tscrim created at 2018-11-24 02:12:12

`ALGORITHM` is not like `.. NOTE::`, so you should just go

```
def foo():
    """
    1-line.

    ALGORITHM:

    The algorithm goes here.

    EXAMPLES:

        sage: foo()
    """
```


Is it worthwhile to have those extra sanity checks in the hidden functions `_growing_subtrees`, `_connecting_nodes`, and `_pruned_tree`? Since they are not part of the API, I think it is safe(r) to assume valid input. Although I guess these methods you're also doing input sanitizing, so maybe it is okay. Perhaps these should not be hidden (and hence, shown in the documentation)?

Also you probably do not want to use things from `math`. I think is better to do, e.g., `Integer(n).log(2)` because of overflow and maybe numerical instability.

LGTM otherwise.


---

Comment by git created at 2018-11-24 10:00:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-24 10:06:34

I have corrected the `ALGORITHMS` blocks and moved sanity checks into the main method. I'm now also using `Integer`.

The methods for selecting subtrees are not shown in the documentation. I could move them inside method `RandomChordalGraph` if you think it's better.


---

Comment by tscrim created at 2018-11-24 17:38:33

Replying to [comment:11 dcoudert]:
> I have corrected the `ALGORITHMS` blocks and moved sanity checks into the main method. I'm now also using `Integer`.

Thank you.

> The methods for selecting subtrees are not shown in the documentation. I could move them inside method `RandomChordalGraph` if you think it's better.

I am wondering if they should be shown (i.e., removing the leading underscore `_`). I think what you currently have is better (and easier to understand and maintain), but it is more of a question if there is a net benefit to exposing them in the documentation. They seem like they could be useful outside of this algorithm, but I haven't looked at it closely. I was hoping for your quick opinion on the matter.


---

Comment by dcoudert created at 2018-11-24 18:14:56

One difficulty is that graph generators are exposed in documentation only via file `graph_generators.py`. So removing the `_` is not enough to expose these methods.

I also agree that these methods could be useful elsewhere, for instance if we have a class or sets of algorithms dedicated to trees. So far we only have a generator.


---

Comment by tscrim created at 2018-11-24 18:20:30

Replying to [comment:13 dcoudert]:
> One difficulty is that graph generators are exposed in documentation only via file `graph_generators.py`. So removing the `_` is not enough to expose these methods.

I do not want to expose these as part of the API via the global namespace, but it is available here:

http://doc.sagemath.org/html/en/reference/graphs/sage/graphs/graph_generators.html

That is all I want to do, to make these functions part of the API via the documentation. So it is sufficient to just remove the `_`.


---

Comment by dcoudert created at 2018-11-24 18:23:22

Actually, we must remove `_` and do the proper imports in `graph_generators.py` to add the method in the documentation, but not as members of `graphs`.


---

Comment by tscrim created at 2018-11-24 18:44:04

Replying to [comment:15 dcoudert]:
> Actually, we must remove `_` and do the proper imports in `graph_generators.py` to add the method in the documentation, but not as members of `graphs`.

Right, I do not want them to be members of `graphs`.


---

Comment by git created at 2018-11-24 19:17:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-24 19:20:41

I this commit, I'm trying to add the helper method to the doc of `graph_generators`, but the html output is (no compilation error):

```
sage.graphs.graph_generators.pruned_tree
staticmethod(function) -> method

Convert a function to be a static method.

A static method does not receive an implicit first argument. To declare a static method, use this idiom:

class C:
`@`staticmethod def f(arg1, arg2, …):

…
It can be called either on the class (e.g. C.f()) or on an instance (e.g. C().f()). The instance is ignored except for its class.

Static methods in Python are similar to those found in Java or C++. For a more advanced concept, see the classmethod builtin.
```

Any help to properly include the helper methods is more than welcome :P


---

Comment by git created at 2018-11-25 10:54:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-25 10:58:32

I have removed my unsuccessful trials (`staticmethod` is for class members only).

I don't know how to expose the methods inside the documentation of `graph-generators` but not in `graphs.<tab>`.


---

Comment by tscrim created at 2018-11-25 13:29:00

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-11-25 13:29:00

Ah, sorry, I got mixed up. I forgot the main code is added to `random.py`, which is where the doc should go but that is not currently included. Sorry about that. At least this is ready if we ever include `graphs/random.py` in the doc (which we probably should at some point, but that is a separate ticket).

Thank you.


---

Comment by dcoudert created at 2018-11-25 13:39:15

Links to helper methods are not correct...


---

Comment by dcoudert created at 2018-11-25 13:39:15

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-11-25 13:39:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-11-25 13:41:20

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2018-11-25 13:41:20

Now links are correct and ready if we ever include `random.py` in the doc. I prefer to let you double check, just in case ;)


---

Comment by tscrim created at 2018-11-25 13:50:23

Whoops. Good catch. `^^;;`


---

Comment by tscrim created at 2018-11-25 13:50:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-11-27 23:48:03

Resolution: fixed


---

Comment by vbraun created at 2018-11-30 00:57:38

I take it this is no minus sign:

```
[docpdf] l.40779 ...\). In each of the subsequent \(k_i −
[docpdf]                                                    1\) iterations, it
[docpdf] ? 
[docpdf] ! Emergency stop.
[docpdf]  ...                                              
```



---

Comment by vbraun created at 2018-11-30 00:57:38

Changing status from closed to new.


---

Comment by vbraun created at 2018-11-30 00:57:38

Resolution changed from fixed to 


---

Comment by dcoudert created at 2018-11-30 07:17:47

Right, sorry for that, and I found several of them. Should be OK now.
----
New commits:


---

Comment by dcoudert created at 2018-11-30 07:17:47

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-12-01 00:26:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-12-02 12:36:28

Resolution: fixed


---

Comment by chapoton created at 2018-12-03 18:57:46

I am getting this on 8.5.b6:

```
sage -t --long --warn-long 55.0 src/sage/graphs/generators/random.py
**********************************************************************
File "src/sage/graphs/generators/random.py", line 907, in sage.graphs.generators.random.connecting_nodes
Failed example:
    S = connecting_nodes(T, 5)
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generators.random.connecting_nodes[2]>", line 1, in <module>
        S = connecting_nodes(T, Integer(5))
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/graphs/generators/random.py", line 973, in connecting_nodes
        S.append(Ti)
    UnboundLocalError: local variable 'Ti' referenced before assignment
```



---

Comment by dcoudert created at 2018-12-03 20:42:49

Ouch. I see how to fix that. I will open a ticket to fix it.


---

Comment by vbraun created at 2018-12-05 23:55:44

I made #26841
