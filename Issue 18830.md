# Issue 18830: Incomplete sentences in the automatically generated documentation

Issue created by migration from https://trac.sagemath.org/ticket/19067

Original creator: ncohen

Original creation time: 2015-08-21 08:11:31

CC:  jmantysalo jsrn

This branch fixes the following bug reported by Jori on #19061


```
sage: def a():
....:     r'''
....:     Here is a very very very long sentence
....:     that spans on several lines.
....:
....:     EXAMP...
....:     '''
....:     print "hey"
sage: 'Here is a very very very long sentence that spans on several lines' in gen_rest_table_index([a])
False
sage: 'Here is a very very very long sentence' in gen_rest_table_index([a])
True
```


Nathann


---

Comment by ncohen created at 2015-08-21 08:12:53

Changing status from new to needs_review.


---

Comment by git created at 2015-08-21 08:13:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2015-08-21 08:28:11


```
[combinat ] reading sources... [100%] sage/combinat/yang_baxter_graph
[combinat ] loading cross citations...
[combinat ] /home/jm58660/sage/local/lib/python2.7/site-packages/sage/combinat/designs/difference_family.py:docstring of sage.combinat.designs.difference_family:8: ERROR: "csv-table" widths do not match the number of columns in table (6).
[combinat ] .. csv-table::
[combinat ] :class: contentstable
[combinat ] :widths: 30, 70
[combinat ] :delim: |
[combinat ] :func:`~sage.combinat.designs.difference_family.block_stabilizer` | Compute the left stabilizer of the block ``B`` under the action of ``G``.
```


A bug? I don't know.

Should this be marked as dependency to #19061? It is quite meaningless without this, even if technically not dependig.


---

Comment by git created at 2015-08-21 09:21:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-08-21 09:24:02

The problem was caused by a | character that appeared in the description of a function. The trouble is that | is the splitting character in those docstrings.

It is fixed.

> Should this be marked as dependency to #19061?

With this last commit, I ready to bet that this ticket is now in conflict with #19061. I will have to fix the conflicts with a merge, but I would prefer this branch to be reviewed first, in order to avoid having to merge and re-merge things several times in case this review requires other changes.

Nathann


---

Comment by jmantysalo created at 2015-09-01 07:48:31

This seems to fail if I change one-line description


```
Returns the value of the M\"obius function - -
```



```
Returns the value of the Möbius function - -
```


in `hasse_diagram.py`.


---

Comment by jmantysalo created at 2015-09-01 07:48:31

Changing status from needs_review to needs_work.


---

Comment by jmantysalo created at 2015-09-01 09:02:34

Changing status from needs_work to needs_review.


---

Comment by jmantysalo created at 2015-09-01 09:02:34

Duh. This is a bug, but not related to this ticket. Sorry.


---

Comment by git created at 2015-09-01 09:10:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2015-09-03 12:21:45

Do I understand correctly that the problem with `|` will come back if a docstring contains ``@``? I don't like that much, especially now that ``@`` is becoming a Python operator!


---

Comment by ncohen created at 2015-09-03 14:26:07

> Do I understand correctly that the problem with `|` will come back if a docstring contains ``@``?
Only if the first line of the docstring contains it.

> I don't like that much, especially now that ``@`` is becoming a Python operator!

Well, then we will have to find a way around, i.e. expose a parameter to change the delimiter manually, if needed. This being said, I am no magician: I looked at the table of ASCII characters and tried to figure out one that I could use. I picked that one because I thought it was okay, but it can be whatever else you prefer.

Nathann


---

Comment by jmantysalo created at 2015-09-04 03:36:17

Replying to [comment:10 ncohen]:

> I looked at the table of ASCII characters and tried to figure out one that I could use.

Just to confirm: the character is required to be in ASCII, not even ISO-8859-1?

Can it be non-printing character, i.e. some code between 1 and 31?


---

Comment by ncohen created at 2015-09-04 05:35:47

> Just to confirm: the character is required to be in ASCII, not even ISO-8859-1?
> 
> Can it be non-printing character, i.e. some code between 1 and 31?

I do not know more than you do on this matter.


---

Comment by mmezzarobba created at 2015-09-04 08:33:44

I guess the natural choice would be U+001F (ASCII unit separator), but it doesn't seem to work:

```
...
[graphs   ] Exception occurred:
[graphs   ] File "/home/marc/co/sage/local/lib/python2.7/site-packages/docutils/parsers/rst/directives/__init__.py", line 303, in unicode_code
[graphs   ] if code.isdigit():                  # decimal number
[graphs   ] AttributeError: 'NoneType' object has no attribute 'isdigit'
...
```



---

Comment by mmezzarobba created at 2015-09-07 08:32:38

...So I guess the fix on this ticket is better than nothing. But what about also adding a warning in the documentation of `rest_index_of_methods.py`?


---

Comment by git created at 2015-09-07 08:46:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-07 08:46:48

> ...So I guess the fix on this ticket is better than nothing. But what about also adding a warning in the documentation of `rest_index_of_methods.py`?

Is it okay like that?

Nathann


---

Comment by jmantysalo created at 2015-09-07 09:46:51

Could be better, if you would also warn against using non-accii characters in oneliners.

(Think if _I_ happen to found a great theorem! And then Sage can not handle "Return Mäntysalo's foo of the bar"! Not even have a warning! `;=)`)


---

Comment by ncohen created at 2015-09-07 09:52:03

> Could be better, if you would also warn against using non-accii characters in oneliners.

I do not think that this branch has any effect on the matter. If you experience that it does, please propose a commit.

Nathann


---

Comment by jmantysalo created at 2015-09-07 10:28:25

Replying to [comment:18 ncohen]:
> > Could be better, if you would also warn against using non-accii characters in oneliners.
> 
> I do not think that this branch has any effect on the matter.

True. That is what I noticed in comment 7. But should there be a warning about non-ascii characters, now when there is about ``@``?

Not a big deal, of course. So don't let this prevent giving positive review.


---

Comment by ncohen created at 2015-09-07 10:38:29

> True. That is what I noticed in comment 7. But should there be a warning about non-ascii characters, now when there is about ``@``?

Could you say clearly which kind of warning you expect to see? I cannot guess it.

Nathann


---

Comment by jmantysalo created at 2015-09-07 10:44:13

Hmmm... something like

"First sentence in the documentation of a function may not contain the '`@`' character, nor any non-ascii character.

First restriction is because the ReST tables returned by this function use '`@`' as a delimiter for  cells. Second restriction follows from Sphinx internals."


---

Comment by ncohen created at 2015-09-07 10:57:30

> "First sentence in the documentation of a function may not contain the '`@`' character, nor any non-ascii character.
> 
> First restriction is because the ReST tables returned by this function use '`@`' as a delimiter for  cells. Second restriction follows from Sphinx internals."

The management of non-ascii characters has *nothing* to do with this branch. If you write a non-ascii character in the documentation of a function, sphinx will complain even if this code is not used. Similarly, if you add `# -*- coding: utf-8 -*-` at the beginning of your files, then non-ascii characters will work well, regadless of whether you use this code or not.

Nathann


---

Comment by jmantysalo created at 2015-09-07 11:23:59

Replying to [comment:22 ncohen]:

> Similarly, if you add `# -*- coding: utf-8 -*-` at the beginning of your files, then non-ascii characters will work well, regadless of whether you use this code or not.

Now I understood. There was `# -*- coding: utf-8 -*-` at `posets.py` but not in `hasse_diagram.py`. And I thank that the reason for the difference was that latter one uses `{INDEX_OF_FUNCTIONS}`.

Sorry.


---

Comment by ncohen created at 2015-09-07 11:35:02

<shakes hands>

No prob. Sphinx is a mess anyway.


---

Comment by mmezzarobba created at 2015-09-09 12:57:25

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-09-09 13:01:04

Thank you!

Nathann


---

Comment by vbraun created at 2015-09-09 22:14:47

PDF documentation doesn't build


---

Comment by vbraun created at 2015-09-09 22:14:47

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-09-09 23:26:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-09 23:28:32

Changing status from needs_work to positive_review.


---

Comment by ncohen created at 2015-09-09 23:34:50

That came from a `\\` instead of `\` in `coding/guava.py`.

The thing is that the docstrings of the code constructors do not respect the convention that the first line must be a short sentence describing the function, and as a result the first paragraph contains a *LOT* of text (including some latex).

Previously, only one (broken) sentence was displayed in the index. At least now the "sentence" is complete.

Nathann


---

Comment by jmantysalo created at 2015-09-10 05:10:33

Replying to [comment:30 ncohen]:

> The thing is that the docstrings of the code constructors do not respect the convention that the first line must be a short sentence describing the function - -

A meta-ticket about that? Do you have an easy way to get a list of those? I mean something like "oneliners with more than one dot" or "oneliners with more then 150 characters"?


---

Comment by ncohen created at 2015-09-10 06:31:14

> A meta-ticket about that?

I do not want to see a meta-ticket again in my life.

> Do you have an easy way to get a list of those?

No. I guess it has to be written "from scratch", or else it must be some long regexp.

> I mean something like "oneliners with more than one dot" or "oneliners with more then 150 characters"?

Something line that.

Nathann


---

Comment by jsrn created at 2015-09-10 07:08:16

Most of the doc in `sage/coding` "needs a bit of work" to put it mildly. But I guess that's for a different ticket, and that your fix to make things compile is all that should go into this one...


---

Comment by jmantysalo created at 2015-09-10 08:20:04

Replying to [comment:32 ncohen]:

> No. I guess it has to be written "from scratch", or else it must be some long regexp.

What? Long regexp? Those are always fun!

But actually this is easier with some bash magic. Here is one example:


```
(while egrep -m 1 '^    def [^_]'; do head -10 | egrep -m 1 -B 10 '^$' | tr '\n' ' '; echo; done) <
src/sage/combinat/posets/posets.py | tr -d '`' | egrep '.{250,}' -B 1 | egrep '^    def [^_]'
```


This founds `level_sets()` and `coxeter_transformation()`.


---

Comment by vbraun created at 2015-09-10 19:46:24

Resolution: fixed
