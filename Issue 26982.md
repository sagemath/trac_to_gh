# Issue 26982: bootstrap should fail gracefully, if there is no pkg-config available

archive/issues_026982.json:
```json
{
    "body": "CC:  @embray @vbraun @jdemeyer\n\n./bootstrap requires pkg-config to run properly. It should switch to downloading configure spkg not only if there are no autotools, but also if there is no pkg-config.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27219\n\n",
    "created_at": "2019-02-04T20:15:58Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "bootstrap should fail gracefully, if there is no pkg-config available",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26982",
    "user": "https://github.com/dimpase"
}
```
CC:  @embray @vbraun @jdemeyer

./bootstrap requires pkg-config to run properly. It should switch to downloading configure spkg not only if there are no autotools, but also if there is no pkg-config.

Issue created by migration from https://trac.sagemath.org/ticket/27219





---

archive/issue_comments_379429.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-04T22:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379429",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_379430.json:
```json
{
    "body": "OK, Volker, how about this?",
    "created_at": "2019-02-04T22:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379430",
    "user": "https://github.com/dimpase"
}
```

OK, Volker, how about this?



---

archive/issue_comments_379431.json:
```json
{
    "body": "IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.",
    "created_at": "2019-02-06T23:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379431",
    "user": "https://github.com/vbraun"
}
```

IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.



---

archive/issue_comments_379432.json:
```json
{
    "body": "Replying to [comment:2 vbraun]:\n> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.\n\nPKG.m4 - macros are a part of pkg-config. (a sufficiently new one - we can add a version check in bootstrap...)\n\nWe can also add a call to `PKG_PROG_PKG_CONFIG` to `configure.ac`.\n\nIt is of course perfectly possible to have a mangled install of pkg-config, without the needed m4 macros.",
    "created_at": "2019-02-07T01:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379432",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:2 vbraun]:
> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.

PKG.m4 - macros are a part of pkg-config. (a sufficiently new one - we can add a version check in bootstrap...)

We can also add a call to `PKG_PROG_PKG_CONFIG` to `configure.ac`.

It is of course perfectly possible to have a mangled install of pkg-config, without the needed m4 macros.



---

archive/issue_comments_379433.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-07T06:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379433",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_379434.json:
```json
{
    "body": "Replying to [comment:2 vbraun]:\n> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.\n\nI agree. The right thing to check then is whether the macro `PKG_CHECK_MODULES` is expanded.",
    "created_at": "2019-02-07T06:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379434",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 vbraun]:
> IMHO whether or not there is a pkg-config binary isn't the same as autoconf understanding PKG_CHECK_MODULES.

I agree. The right thing to check then is whether the macro `PKG_CHECK_MODULES` is expanded.



---

archive/issue_comments_379435.json:
```json
{
    "body": "Also, what goes wrong when `pkg-config` is not installed? The bug report should say that.",
    "created_at": "2019-02-07T06:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379435",
    "user": "https://github.com/jdemeyer"
}
```

Also, what goes wrong when `pkg-config` is not installed? The bug report should say that.



---

archive/issue_comments_379436.json:
```json
{
    "body": "`m4_pattern_forbid` may be the correct solution here. See https://www.gnu.org/software/autoconf/manual/autoconf.html#Forbidden-Patterns",
    "created_at": "2019-02-07T06:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379436",
    "user": "https://github.com/jdemeyer"
}
```

`m4_pattern_forbid` may be the correct solution here. See https://www.gnu.org/software/autoconf/manual/autoconf.html#Forbidden-Patterns



---

archive/issue_comments_379437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-07T10:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379437",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_379438.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-07T10:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379438",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379439.json:
```json
{
    "body": "from the latest commit message:\n\n```\n    check that pkg-config and its m4 macros are installed\n    \n    use m4_ifndef() in configure.ac to check that PKG_PROG_PKG_CONFIG\n    is provided.\n    \n    just in case, also check that pkg-config is present\n    \n    calling PKG_PROG_PKG_CONFIG in configure.ac\n    \n    renaming of clashing with PKG_* m4 names in m4/*\n    (otherwise PKG_PROG_PKG_CONFIG cannot be mentioned at all)\n\n```\n\ntook a while to figure out weird errors caused by m4 vars name clashes.",
    "created_at": "2019-02-07T10:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379439",
    "user": "https://github.com/dimpase"
}
```

from the latest commit message:

```
    check that pkg-config and its m4 macros are installed
    
    use m4_ifndef() in configure.ac to check that PKG_PROG_PKG_CONFIG
    is provided.
    
    just in case, also check that pkg-config is present
    
    calling PKG_PROG_PKG_CONFIG in configure.ac
    
    renaming of clashing with PKG_* m4 names in m4/*
    (otherwise PKG_PROG_PKG_CONFIG cannot be mentioned at all)

```

took a while to figure out weird errors caused by m4 vars name clashes.



---

archive/issue_comments_379440.json:
```json
{
    "body": "Not 100% sure whether we ought to call `PKG_PROG_PKG_CONFIG`. I do this in the current branch,\nI suppose it cannot hurt.",
    "created_at": "2019-02-07T10:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379440",
    "user": "https://github.com/dimpase"
}
```

Not 100% sure whether we ought to call `PKG_PROG_PKG_CONFIG`. I do this in the current branch,
I suppose it cannot hurt.



---

archive/issue_comments_379441.json:
```json
{
    "body": "What currently happens is \n\n```\nchecking whether g++ supports C++11 features with -std=gnu++11... yes\nchecking for gcc option to accept ISO C99... none needed\nchecking if gcc accepts -dumpversion option... yes\nchecking gcc version... 5.4.0\nchecking if g++ accepts -dumpversion option... yes\nchecking g++ version... 5.4.0\nconfigure: === checking whether to install the libffi SPKG ===\n./configure: line 9026: syntax error near unexpected token `LIBFFI,'\n./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'\nIf you would like to try to build Sage anyway (to help porting),\nexport the variable 'SAGE_PORT' to something non-empty.\nMakefile:39: recipe for target 'build/make/Makefile' failed\nmake[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'\nmake[1]: *** [build/make/Makefile] Error 1\nMakefile:31: recipe for target 'build-clean' failed\nmake: *** [build-clean] Error 2\nprogram finished with exit code 2\n```\n",
    "created_at": "2019-02-07T11:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379441",
    "user": "https://github.com/vbraun"
}
```

What currently happens is 

```
checking whether g++ supports C++11 features with -std=gnu++11... yes
checking for gcc option to accept ISO C99... none needed
checking if gcc accepts -dumpversion option... yes
checking gcc version... 5.4.0
checking if g++ accepts -dumpversion option... yes
checking g++ version... 5.4.0
configure: === checking whether to install the libffi SPKG ===
./configure: line 9026: syntax error near unexpected token `LIBFFI,'
./configure: line 9026: `        PKG_CHECK_MODULES(LIBFFI, libffi, ,'
If you would like to try to build Sage anyway (to help porting),
export the variable 'SAGE_PORT' to something non-empty.
Makefile:39: recipe for target 'build/make/Makefile' failed
make[1]: Leaving directory '/var/lib/buildbot/slave/sage_git/build'
make[1]: *** [build/make/Makefile] Error 1
Makefile:31: recipe for target 'build-clean' failed
make: *** [build-clean] Error 2
program finished with exit code 2
```




---

archive/issue_comments_379442.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-07T12:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379442",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_379443.json:
```json
{
    "body": "Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.\n\nWhat's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.",
    "created_at": "2019-02-07T12:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379443",
    "user": "https://github.com/jdemeyer"
}
```

Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.

What's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.



---

archive/issue_comments_379444.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-07T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379444",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_379445.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-07T12:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_379446.json:
```json
{
    "body": "OK, so this should be the correct fix, merging cleanly with #27114, too.",
    "created_at": "2019-02-07T12:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379446",
    "user": "https://github.com/dimpase"
}
```

OK, so this should be the correct fix, merging cleanly with #27114, too.



---

archive/issue_comments_379447.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.\n> \n> What's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.\n\nGenerating configure needs pkg-config since #27114, which uses PKG_* m4 macros, why not?\nThe resulting ./configure does not need pkg-config, it can do without just fine.",
    "created_at": "2019-02-07T12:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379447",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:11 jdemeyer]:
> Right, so all that you need is something like `m4_pattern_forbid([^PKG_])`.
> 
> What's the point of checking for `pkgconf` in `bootstrap`? Generating the `./configure` script should be orthogonal to whether or not `pkgconf` is installed.

Generating configure needs pkg-config since #27114, which uses PKG_* m4 macros, why not?
The resulting ./configure does not need pkg-config, it can do without just fine.



---

archive/issue_comments_379448.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-07T12:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379448",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379449.json:
```json
{
    "body": "oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...",
    "created_at": "2019-02-07T12:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379449",
    "user": "https://github.com/dimpase"
}
```

oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...



---

archive/issue_comments_379450.json:
```json
{
    "body": "Replying to [comment:16 dimpase]:\n> Generating configure needs pkg-config since #27219\n\nYou need to distinguish between *generating* `configure` and *running* configure. In this ticket, we are only concerned with the `bootstrap` script which runs `autoconf` to *generate* `configure`.\n\nNow `autoconf` is a macro processor, so it would be surprising that it would run `pkg-config`. Even if it does, what happens if `pkg-config` is not installed? I would assume that it fails gracefully, so I still don't see the point of the extra `pkg-config --version` check.",
    "created_at": "2019-02-07T12:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379450",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:16 dimpase]:
> Generating configure needs pkg-config since #27219

You need to distinguish between *generating* `configure` and *running* configure. In this ticket, we are only concerned with the `bootstrap` script which runs `autoconf` to *generate* `configure`.

Now `autoconf` is a macro processor, so it would be surprising that it would run `pkg-config`. Even if it does, what happens if `pkg-config` is not installed? I would assume that it fails gracefully, so I still don't see the point of the extra `pkg-config --version` check.



---

archive/issue_comments_379451.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-02-07T12:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379451",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_379452.json:
```json
{
    "body": "By the way, if you want to use `m4_ifndef`, at least make sure that error message is correct:\n\n```\nm4_ifndef([PKG_PROG_PKG_CONFIG],\n    [m4_fatal([Could not locate the pkg-config autoconf macros.\n    These are usually located in /usr/share/aclocal/pkg.m4. If your\n    macros are in a different location, try setting the environment\n    variable ACLOCAL=\"aclocal -I/other/macro/dir\" before running\n    autoreconf/autogen.sh.])])\n```\n\nThe script in Sage is called `bootstrap`.",
    "created_at": "2019-02-07T12:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379452",
    "user": "https://github.com/jdemeyer"
}
```

By the way, if you want to use `m4_ifndef`, at least make sure that error message is correct:

```
m4_ifndef([PKG_PROG_PKG_CONFIG],
    [m4_fatal([Could not locate the pkg-config autoconf macros.
    These are usually located in /usr/share/aclocal/pkg.m4. If your
    macros are in a different location, try setting the environment
    variable ACLOCAL="aclocal -I/other/macro/dir" before running
    autoreconf/autogen.sh.])])
```

The script in Sage is called `bootstrap`.



---

archive/issue_comments_379453.json:
```json
{
    "body": "Replying to [comment:18 dimpase]:\n> oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...\n\nIn general, your commit history on this ticket is a mess, so I suggest to rebase and squash.",
    "created_at": "2019-02-07T12:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379453",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 dimpase]:
> oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...

In general, your commit history on this ticket is a mess, so I suggest to rebase and squash.



---

archive/issue_comments_379454.json:
```json
{
    "body": "I am certainly distinguishing between generating and running configure. Generating configure only needs m4 macros, this is correct. \n\nWould you like me to take out from bootstrap the test for `pkg-config` presence?",
    "created_at": "2019-02-07T12:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379454",
    "user": "https://github.com/dimpase"
}
```

I am certainly distinguishing between generating and running configure. Generating configure only needs m4 macros, this is correct. 

Would you like me to take out from bootstrap the test for `pkg-config` presence?



---

archive/issue_comments_379455.json:
```json
{
    "body": "Replying to [comment:21 jdemeyer]:\n> Replying to [comment:18 dimpase]:\n> > oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...\n> \n> In general, your commit history on this ticket is a mess, so I suggest to rebase and squash.\n\nthe problem is that for this to work, I need changes to `m4/sage_spkg_collect.m4`\nakin to ones done on #27114. (I first did my own, without using #27114, only to find out that merging #27114 gets painful with them; so I decided to use a part of #27114, but haven't done it quite right...).\n\nAfter I'm done here, #27114 will have to be rebased on top of this one.",
    "created_at": "2019-02-07T13:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379455",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:21 jdemeyer]:
> Replying to [comment:18 dimpase]:
> > oops, sorry, I should have put in the old version of libffi/spkg-configure.m4...
> 
> In general, your commit history on this ticket is a mess, so I suggest to rebase and squash.

the problem is that for this to work, I need changes to `m4/sage_spkg_collect.m4`
akin to ones done on #27114. (I first did my own, without using #27114, only to find out that merging #27114 gets painful with them; so I decided to use a part of #27114, but haven't done it quite right...).

After I'm done here, #27114 will have to be rebased on top of this one.



---

archive/issue_comments_379456.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-07T13:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379456",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_379457.json:
```json
{
    "body": "I hope I have addressed all the issues raised, including the messy branches. Sorry, it took a while to get right.",
    "created_at": "2019-02-07T13:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379457",
    "user": "https://github.com/dimpase"
}
```

I hope I have addressed all the issues raised, including the messy branches. Sorry, it took a while to get right.



---

archive/issue_comments_379458.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-02-07T13:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379458",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_379459.json:
```json
{
    "body": "Indeed, this is more or less what I meant.\n\nFor the record, the message when the `pkg-config` macros are not installed:\n\n```\nconfigure.ac:219: error: Could not locate the pkg-config autoconf macros.\n    These are usually located in /usr/share/aclocal/pkg.m4. If your\n    macros are in a different location, try setting the environment\n    variable ACLOCAL=\"aclocal -I/other/macro/dir\" before running\n    ./bootstrap\nconfigure.ac:219: the top level\nautom4te: /usr/bin/m4 failed with exit status: 1\naclocal-1.15: error: echo failed with exit status: 1\nBootstrap failed. Either install pkg-config m4 macros for autotools or run bootstrap with                                                                               \nthe -d option to download the auto-generated files instead.                                                                                                             \n```\n\n\nSo it fails correctly.",
    "created_at": "2019-02-07T14:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379459",
    "user": "https://github.com/jdemeyer"
}
```

Indeed, this is more or less what I meant.

For the record, the message when the `pkg-config` macros are not installed:

```
configure.ac:219: error: Could not locate the pkg-config autoconf macros.
    These are usually located in /usr/share/aclocal/pkg.m4. If your
    macros are in a different location, try setting the environment
    variable ACLOCAL="aclocal -I/other/macro/dir" before running
    ./bootstrap
configure.ac:219: the top level
autom4te: /usr/bin/m4 failed with exit status: 1
aclocal-1.15: error: echo failed with exit status: 1
Bootstrap failed. Either install pkg-config m4 macros for autotools or run bootstrap with                                                                               
the -d option to download the auto-generated files instead.                                                                                                             
```


So it fails correctly.



---

archive/issue_comments_379460.json:
```json
{
    "body": "One more detail: it would be better to reserve a specific exit code for that case. I'll prepare a review commit.",
    "created_at": "2019-02-07T14:17:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379460",
    "user": "https://github.com/jdemeyer"
}
```

One more detail: it would be better to reserve a specific exit code for that case. I'll prepare a review commit.



---

archive/issue_comments_379461.json:
```json
{
    "body": "I'm happy with this now. Feel free to set to positive review if you agree.\n----\nNew commits:",
    "created_at": "2019-02-07T14:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379461",
    "user": "https://github.com/jdemeyer"
}
```

I'm happy with this now. Feel free to set to positive review if you agree.
----
New commits:



---

archive/issue_comments_379462.json:
```json
{
    "body": "looks good to me, thanks!",
    "created_at": "2019-02-07T14:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379462",
    "user": "https://github.com/dimpase"
}
```

looks good to me, thanks!



---

archive/issue_comments_379463.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-07T14:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379463",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_379464.json:
```json
{
    "body": "I've been AFK, else I would've chimed in sooner.  But this looks good to me now.\n\nIndeed, there's no need to actually have `pkg-config` to build anything, just the `PKG_` macros that are typically installed alongside pkg-config.  I had also just suggested adding a copy of `pkg.m4` to our `m4/` directory but I like this even better (I see no reason a build machine, except maybe on OSX, shouldn't have pkg-config installed anyways).",
    "created_at": "2019-02-07T14:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379464",
    "user": "https://github.com/embray"
}
```

I've been AFK, else I would've chimed in sooner.  But this looks good to me now.

Indeed, there's no need to actually have `pkg-config` to build anything, just the `PKG_` macros that are typically installed alongside pkg-config.  I had also just suggested adding a copy of `pkg.m4` to our `m4/` directory but I like this even better (I see no reason a build machine, except maybe on OSX, shouldn't have pkg-config installed anyways).



---

archive/issue_comments_379465.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-08T23:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26982#issuecomment-379465",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_025049.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-02-08T23:21:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26982",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26982#event-25049"
}
```
