# Issue 10169: Speed up the computation of Bell numbers

Issue created by migration from https://trac.sagemath.org/ticket/10170

Original creator: gerbicz

Original creation time: 2010-10-25 14:37:03

Assignee: sage-combinat

CC:  sage-combinat

Keywords: bell number

For large n values use the formula: bell(n)=exp(-1)*sum(k=0,infinity,k**n/k!)

Currently my code beats all known implementations, also sage's code which wraps GAP's Bell is slow and using lots of memory, and unable to compute bell_number(n) if n is large.

Some timings on Amd 2.1 GHz:

n       time (Wall time)

300     0.01 sec.

1000    0.03 sec.

3000    0.18 sec.

10000   2.88 sec.

30000   46.79 sec.

100000  819.37 sec.

Compare these with another programs:
http://fredrik-j.blogspot.com/2009/03/computing-generalized-bell-numbers.html


---

Attachment


---

Attachment

Hello and thanks for the patch!  I'm curious, have you compared your solution with wrapping mpmath directly?  For example,


``` 
sage: import mpmath
sage: mpmath.bell?
```


Also, this ticket is basically a dup of #7812, so one of these (maybe that one, since this has a patch) should be closed.  

Finally, don't forget to set the status as 'needs_review' once you've added a patch!

Thanks,
Jason


---

Comment by jbandlow created at 2010-10-25 14:51:57

Changing status from new to needs_info.


---

Comment by gerbicz created at 2010-10-25 15:18:27

Replying to [comment:1 jbandlow]:
> Hello and thanks for the patch!  I'm curious, have you compared your solution with wrapping mpmath directly?  For example,
> 
> {{{ 
> sage: import mpmath
> sage: mpmath.bell?
> }}}

Yes, but times are not saved I will rerun them: here are the timings for mpmath:

n  time (Wall time)

300 0.02 sec.

1000 0.06 sec.

3000 0.41 sec.

10000 10.26 sec.

30000 168.27 sec.

100000 (still computing)

So here mpmath is about 2-4 times slower, and seems that using more memory than my code.


---

Comment by gerbicz created at 2010-10-25 15:18:27

Changing status from needs_info to needs_review.


---

Comment by gerbicz created at 2010-10-25 15:53:19

Replying to [comment:2 gerbicz]:

> 100000 (still computing)

it took 2383 sec. for mpmath.


---

Comment by allmar created at 2010-11-01 20:23:20

Changing status from needs_review to needs_work.


---

Comment by allmar created at 2010-11-01 20:23:20

Patch will not apply to sage 4.5.3


---

Comment by tscrim created at 2013-03-09 22:13:53

I've uploaded a new version of the patch which also adds mpmath (so #7812 can be closed as a duplicate after this patch is done). I've also come across an error in calling with the `'mpmath'` agrument and started #14247.

For patchbot:

Apply: trac_10170-bell_number_improvements-ts.patch


---

Comment by tscrim created at 2013-03-09 22:13:53

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2013-03-19 15:22:30

I've folded in the changes from #14247 and marked that as a duplicate since there's no need for a separate ticket.

For patchbot:

Apply: trac_10170-bell_number_improvements-ts.patch


---

Comment by ncohen created at 2013-03-24 19:27:31

Hmmm... Looks nice, but shouldn't this be in that module ?

http://www.sagemath.org/doc/reference/combinat/sage/combinat/expnums.html

Nathann


---

Comment by tscrim created at 2013-03-28 21:38:11

From my 10 minutes of googling, no, it should not be. The exponential numbers seem to be a generalization of the Bell numbers and I don't know that this implementation can be generalized to that (and hence go into that module). My guess is that it's probably yes, but I'll leave that to someone with more expertise to answer.


---

Comment by ncohen created at 2013-03-29 11:25:05

At the line where you define `E_1` and `E_2` they appear to be perfectly equal. Is that intended ? `O_o`

Nathann


---

Comment by gerbicz created at 2013-03-29 11:58:58

That is not true, in fact: E_2=exp(-1)*E_1 as you can read in my original bell_proof.txt

About exponential numbers: that is a different problem. Here we compute only a single Bell number not the first n Bell numbers and there the algorithm is optimal (O(n*n) time), the same question for Bell numbers is an open problem.


---

Comment by ncohen created at 2013-03-29 12:46:14

> That is not true, in fact: 

I have no idea, but this is what is written in the patch.

Nathann


---

Comment by gerbicz created at 2013-03-29 13:34:45

Yes, there is a missing parentheses in line 255 in the patch.


---

Comment by tscrim created at 2013-03-29 13:43:12

Folded in mpmath patch


---

Attachment

Fixed.


---

Comment by bsalisbury1 created at 2013-04-19 18:07:53

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-04-28 10:32:18

Resolution: fixed
