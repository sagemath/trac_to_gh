# Issue 10169: Speed up the computation of Bell numbers

archive/issues_010169.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat\n\nKeywords: bell number\n\nFor large n values use the formula: bell(n)=exp(-1)*sum(k=0,infinity,k**n/k!)\n\nCurrently my code beats all known implementations, also sage's code which wraps GAP's Bell is slow and using lots of memory, and unable to compute bell_number(n) if n is large.\n\nSome timings on Amd 2.1 GHz:\n\nn       time (Wall time)\n\n300     0.01 sec.\n\n1000    0.03 sec.\n\n3000    0.18 sec.\n\n10000   2.88 sec.\n\n30000   46.79 sec.\n\n100000  819.37 sec.\n\nCompare these with another programs:\nhttp://fredrik-j.blogspot.com/2009/03/computing-generalized-bell-numbers.html\n\nIssue created by migration from https://trac.sagemath.org/ticket/10170\n\n",
    "created_at": "2010-10-25T14:37:03Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Speed up the computation of Bell numbers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10169",
    "user": "gerbicz"
}
```
Assignee: sage-combinat

CC:  sage-combinat

Keywords: bell number

For large n values use the formula: bell(n)=exp(-1)*sum(k=0,infinity,k**n/k!)

Currently my code beats all known implementations, also sage's code which wraps GAP's Bell is slow and using lots of memory, and unable to compute bell_number(n) if n is large.

Some timings on Amd 2.1 GHz:

n       time (Wall time)

300     0.01 sec.

1000    0.03 sec.

3000    0.18 sec.

10000   2.88 sec.

30000   46.79 sec.

100000  819.37 sec.

Compare these with another programs:
http://fredrik-j.blogspot.com/2009/03/computing-generalized-bell-numbers.html

Issue created by migration from https://trac.sagemath.org/ticket/10170





---

archive/issue_comments_103055.json:
```json
{
    "body": "Attachment [trac10170-bell_number_improvement.patch](tarball://root/attachments/some-uuid/ticket10170/trac10170-bell_number_improvement.patch) by gerbicz created at 2010-10-25 14:38:23",
    "created_at": "2010-10-25T14:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103055",
    "user": "gerbicz"
}
```

Attachment [trac10170-bell_number_improvement.patch](tarball://root/attachments/some-uuid/ticket10170/trac10170-bell_number_improvement.patch) by gerbicz created at 2010-10-25 14:38:23



---

archive/issue_comments_103056.json:
```json
{
    "body": "Attachment [bell_proof.txt](tarball://root/attachments/some-uuid/ticket10170/bell_proof.txt) by @jbandlow created at 2010-10-25 14:51:57\n\nHello and thanks for the patch!  I'm curious, have you compared your solution with wrapping mpmath directly?  For example,\n\n\n``` \nsage: import mpmath\nsage: mpmath.bell?\n```\n\n\nAlso, this ticket is basically a dup of #7812, so one of these (maybe that one, since this has a patch) should be closed.  \n\nFinally, don't forget to set the status as 'needs_review' once you've added a patch!\n\nThanks,\nJason",
    "created_at": "2010-10-25T14:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103056",
    "user": "@jbandlow"
}
```

Attachment [bell_proof.txt](tarball://root/attachments/some-uuid/ticket10170/bell_proof.txt) by @jbandlow created at 2010-10-25 14:51:57

Hello and thanks for the patch!  I'm curious, have you compared your solution with wrapping mpmath directly?  For example,


``` 
sage: import mpmath
sage: mpmath.bell?
```


Also, this ticket is basically a dup of #7812, so one of these (maybe that one, since this has a patch) should be closed.  

Finally, don't forget to set the status as 'needs_review' once you've added a patch!

Thanks,
Jason



---

archive/issue_comments_103057.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2010-10-25T14:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103057",
    "user": "@jbandlow"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_103058.json:
```json
{
    "body": "Replying to [comment:1 jbandlow]:\n> Hello and thanks for the patch!  I'm curious, have you compared your solution with wrapping mpmath directly?  For example,\n> \n> {{{ \n> sage: import mpmath\n> sage: mpmath.bell?\n> }}}\n\nYes, but times are not saved I will rerun them: here are the timings for mpmath:\n\nn  time (Wall time)\n\n300 0.02 sec.\n\n1000 0.06 sec.\n\n3000 0.41 sec.\n\n10000 10.26 sec.\n\n30000 168.27 sec.\n\n100000 (still computing)\n\nSo here mpmath is about 2-4 times slower, and seems that using more memory than my code.",
    "created_at": "2010-10-25T15:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103058",
    "user": "gerbicz"
}
```

Replying to [comment:1 jbandlow]:
> Hello and thanks for the patch!  I'm curious, have you compared your solution with wrapping mpmath directly?  For example,
> 
> {{{ 
> sage: import mpmath
> sage: mpmath.bell?
> }}}

Yes, but times are not saved I will rerun them: here are the timings for mpmath:

n  time (Wall time)

300 0.02 sec.

1000 0.06 sec.

3000 0.41 sec.

10000 10.26 sec.

30000 168.27 sec.

100000 (still computing)

So here mpmath is about 2-4 times slower, and seems that using more memory than my code.



---

archive/issue_comments_103059.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2010-10-25T15:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103059",
    "user": "gerbicz"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_103060.json:
```json
{
    "body": "Replying to [comment:2 gerbicz]:\n\n> 100000 (still computing)\n\nit took 2383 sec. for mpmath.",
    "created_at": "2010-10-25T15:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103060",
    "user": "gerbicz"
}
```

Replying to [comment:2 gerbicz]:

> 100000 (still computing)

it took 2383 sec. for mpmath.



---

archive/issue_comments_103061.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-11-01T20:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103061",
    "user": "allmar"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_103062.json:
```json
{
    "body": "Patch will not apply to sage 4.5.3",
    "created_at": "2010-11-01T20:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103062",
    "user": "allmar"
}
```

Patch will not apply to sage 4.5.3



---

archive/issue_comments_103063.json:
```json
{
    "body": "I've uploaded a new version of the patch which also adds mpmath (so #7812 can be closed as a duplicate after this patch is done). I've also come across an error in calling with the `'mpmath'` agrument and started #14247.\n\nFor patchbot:\n\nApply: trac_10170-bell_number_improvements-ts.patch",
    "created_at": "2013-03-09T22:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103063",
    "user": "@tscrim"
}
```

I've uploaded a new version of the patch which also adds mpmath (so #7812 can be closed as a duplicate after this patch is done). I've also come across an error in calling with the `'mpmath'` agrument and started #14247.

For patchbot:

Apply: trac_10170-bell_number_improvements-ts.patch



---

archive/issue_comments_103064.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-03-09T22:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103064",
    "user": "@tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_103065.json:
```json
{
    "body": "I've folded in the changes from #14247 and marked that as a duplicate since there's no need for a separate ticket.\n\nFor patchbot:\n\nApply: trac_10170-bell_number_improvements-ts.patch",
    "created_at": "2013-03-19T15:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103065",
    "user": "@tscrim"
}
```

I've folded in the changes from #14247 and marked that as a duplicate since there's no need for a separate ticket.

For patchbot:

Apply: trac_10170-bell_number_improvements-ts.patch



---

archive/issue_comments_103066.json:
```json
{
    "body": "Hmmm... Looks nice, but shouldn't this be in that module ?\n\nhttp://www.sagemath.org/doc/reference/combinat/sage/combinat/expnums.html\n\nNathann",
    "created_at": "2013-03-24T19:27:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103066",
    "user": "@nathanncohen"
}
```

Hmmm... Looks nice, but shouldn't this be in that module ?

http://www.sagemath.org/doc/reference/combinat/sage/combinat/expnums.html

Nathann



---

archive/issue_comments_103067.json:
```json
{
    "body": "From my 10 minutes of googling, no, it should not be. The exponential numbers seem to be a generalization of the Bell numbers and I don't know that this implementation can be generalized to that (and hence go into that module). My guess is that it's probably yes, but I'll leave that to someone with more expertise to answer.",
    "created_at": "2013-03-28T21:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103067",
    "user": "@tscrim"
}
```

From my 10 minutes of googling, no, it should not be. The exponential numbers seem to be a generalization of the Bell numbers and I don't know that this implementation can be generalized to that (and hence go into that module). My guess is that it's probably yes, but I'll leave that to someone with more expertise to answer.



---

archive/issue_comments_103068.json:
```json
{
    "body": "At the line where you define `E_1` and `E_2` they appear to be perfectly equal. Is that intended ? `O_o`\n\nNathann",
    "created_at": "2013-03-29T11:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103068",
    "user": "@nathanncohen"
}
```

At the line where you define `E_1` and `E_2` they appear to be perfectly equal. Is that intended ? `O_o`

Nathann



---

archive/issue_comments_103069.json:
```json
{
    "body": "That is not true, in fact: E_2=exp(-1)*E_1 as you can read in my original bell_proof.txt\n\nAbout exponential numbers: that is a different problem. Here we compute only a single Bell number not the first n Bell numbers and there the algorithm is optimal (O(n*n) time), the same question for Bell numbers is an open problem.",
    "created_at": "2013-03-29T11:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103069",
    "user": "gerbicz"
}
```

That is not true, in fact: E_2=exp(-1)*E_1 as you can read in my original bell_proof.txt

About exponential numbers: that is a different problem. Here we compute only a single Bell number not the first n Bell numbers and there the algorithm is optimal (O(n*n) time), the same question for Bell numbers is an open problem.



---

archive/issue_comments_103070.json:
```json
{
    "body": "> That is not true, in fact: \n\nI have no idea, but this is what is written in the patch.\n\nNathann",
    "created_at": "2013-03-29T12:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103070",
    "user": "@nathanncohen"
}
```

> That is not true, in fact: 

I have no idea, but this is what is written in the patch.

Nathann



---

archive/issue_comments_103071.json:
```json
{
    "body": "Yes, there is a missing parentheses in line 255 in the patch.",
    "created_at": "2013-03-29T13:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103071",
    "user": "gerbicz"
}
```

Yes, there is a missing parentheses in line 255 in the patch.



---

archive/issue_comments_103072.json:
```json
{
    "body": "Folded in mpmath patch",
    "created_at": "2013-03-29T13:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103072",
    "user": "@tscrim"
}
```

Folded in mpmath patch



---

archive/issue_comments_103073.json:
```json
{
    "body": "Attachment [trac_10170-bell_number_improvements-ts.patch](tarball://root/attachments/some-uuid/ticket10170/trac_10170-bell_number_improvements-ts.patch) by @tscrim created at 2013-03-29 13:43:28\n\nFixed.",
    "created_at": "2013-03-29T13:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103073",
    "user": "@tscrim"
}
```

Attachment [trac_10170-bell_number_improvements-ts.patch](tarball://root/attachments/some-uuid/ticket10170/trac_10170-bell_number_improvements-ts.patch) by @tscrim created at 2013-03-29 13:43:28

Fixed.



---

archive/issue_comments_103074.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-19T18:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103074",
    "user": "@bsalisbury1"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103075.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-28T10:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10169",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10169#issuecomment-103075",
    "user": "@jdemeyer"
}
```

Resolution: fixed
