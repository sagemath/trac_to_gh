# Issue 30382: update opensuse.txt across build/pkgs/

Issue created by migration from https://trac.sagemath.org/ticket/30619

Original creator: @jengelh

Original creation time: 2020-09-20 10:47:03

CC:  @kliem dimpase jhpalmieri slabbe

[commit to be attached]


---

Comment by @jengelh created at 2020-09-20 10:57:25

(singleton repository with write permissions for everyone‽ No bot seems to add a note to the ticket when a push occurs. Very strange, this Trac system.)


```
    e4a917d10ec495da90818eeaa60b7711c2e3cf25        refs/heads/u/gh-jengelh/30619
```


A number of third-party packages are available, or will be Real-Soon-Now™, in openSUSE. Add their package names or virtual names according to the txt file scheme of the other distros.


---

Comment by chapoton created at 2020-09-20 11:47:55

New commits:


---

Comment by chapoton created at 2020-09-20 14:00:57

you need to write your real name in the Author field above here, and to set the ticket to needs review


---

Comment by mkoeppe created at 2020-09-20 16:02:34

Thanks for this contribution.

We would also like to add CI infrastructure for testing the build on opensuse using Docker. This would follow the same steps as #30044 (for voidlinux).


---

Comment by git created at 2020-09-20 23:06:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-09-21 00:21:36

Next, need the following two files

```
sed: ./build/pkgs/opensuse.txt: No such file or directory
sed: ./build/pkgs/opensuse-bootstrap.txt: No such file or directory
```

----
New commits:


---

Comment by git created at 2020-09-22 20:02:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-22 20:04:24

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-09-22 22:47:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-09-22 22:49:44


```
No provider of 'arb-devel' found.
No provider of 'brial-devel' found.
No provider of 'cddlib-tools' found.
No provider of 'cliquer' found.
No provider of 'cliquer-devel' found.
No provider of 'edge-addition-planarity-suite' found.
No provider of 'giac-devel' found.
No provider of 'libbraiding-devel' found.
No provider of 'pkgconfig(cddlib)' found.
No provider of 'pkgconfig(gd)' found.
No provider of 'pkgconfig(gf2x)' found.
No provider of 'pkgconfig(m4rie)' found.
No provider of 'pkgconfig(readline)' found.
No provider of 'ppl-devel' found.
No provider of 'sympow' found.

...

configure: notice: the following SPKGs did not find equivalent system packages: arb brial bzip2 cbc cddlib cliquer cmake coxeter3 eclib ecm fflas_ffpack flint flintqs fplll freetype gc gf2x giac givaro gp2c isl lcalc libatomic_ops libbraiding libgd libnauty libpng libsemigroups lrcalc m4ri m4rie ninja_build openssl palp pandoc pari pari_elldata pari_galdata pari_galpol pari_nftables pari_seadata pari_seadata_small pcre perl_cpan_polymake_prereq perl_term_readline_gnu planarity ppl python3 r readline rw symmetrica sympow zeromq zn_poly
checking for the package system in use... opensuse
configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
configure:   $ sudo zypper install arb-devel brial-devel "pkgconfig(bzip2)" cddlib-tools "pkgconfig(cddlib)" cliquer cliquer-devel cmake coxeter "pkgconfig(fflas-ffpack)" flint-devel "pkgconfig(fplll)" "pkgconfig(freetype2)" "pkgconfig(bdw-gc)" "pkgconfig(gf2x)" giac-devel "pkgconfig(givaro)" gp2c "pkgconfig(isl)" "pkgconfig(atomic_ops)" libbraiding-devel gd "pkgconfig(gd)" "pkgconfig(libpng16)" "pkgconfig(libsemigroups)" "pkgconfig(m4ri)" "pkgconfig(m4rie)" ninja "pkgconfig(ssl)" pandoc pari-devel pari-gp pari-elldata pari-galdata pari-galpol pari-nftables pari-seadata "pkgconfig(libpcre)" "pkgconfig(libpcreposix)" "pkgconfig(libpcrecpp)" "perl(Term::ReadLine::Gnu)" edge-addition-planarity-suite ppl-devel python3-devel R-base "pkgconfig(readline)" sympow "pkgconfig(libzmq)" zn_poly-devel

```



---

Comment by mkoeppe created at 2020-09-24 00:20:34

Changing status from new to needs_review.


---

Comment by git created at 2020-09-25 16:09:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-11-16 02:24:48

Jan, what's the status of OpenSuSE packaging now?


---

Comment by @jengelh created at 2020-11-16 09:42:19

Changes needed: -pkgconfig(gd) +pkgconfig(gdlib) -linbox -pkgconfig(ssl) +pkgconfig(libssl)
[see branch]

Packages that did not make it into the distro: latte polymake


---

Comment by mkoeppe created at 2020-11-16 19:52:34

Something went wrong - I have fixed the branch name
----
New commits:


---

Comment by mkoeppe created at 2020-11-16 19:54:47

Thanks for the update, I'll test it.


---

Comment by mkoeppe created at 2020-11-17 00:05:50

With `tox -e docker-opensuse-standard` (which uses `opensuse/leap:latest`, i.e., 15.2), I am getting:

```
No provider of 'arb-devel' found.
No provider of 'brial-devel' found.
No provider of 'cddlib-tools' found.
No provider of 'cliquer' found.
No provider of 'cliquer-devel' found.
No provider of 'edge-addition-planarity-suite' found.
No provider of 'giac-devel' found.
No provider of 'libbraiding-devel' found.
No provider of 'pkgconfig(cddlib)' found.
No provider of 'pkgconfig(gf2x)' found.
No provider of 'pkgconfig(m4rie)' found.
No provider of 'pkgconfig(readline)' found.
No provider of 'ppl-devel' found.
No provider of 'sympow' found.
....
Error installing ppl-1.2.p1
....
for ball in ppl-user-1.2-html.tar.gz ppl-user-c-interface-1.2-html.tar.gz   ; do \
  test -f $ball || test -f ./$ball \
    || false || make $ball; \
  dir=`basename $ball .tar.gz`; \
  /bin/bash ../mkinstalldirs /sage/local/var/tmp/sage/build/ppl-1.2.p1/inst/sage/local/share/doc/ppl/$dir; \
  gunzip -c `if test -f $ball; then echo .; else echo .; fi`/$ball | tar xf - ; \
  if test -d $dir/ocamldoc; then \
    /bin/bash ../mkinstalldirs /sage/local/var/tmp/sage/build/ppl-1.2.p1/inst/sage/local/share/doc/ppl/$dir/ocamldoc; \
    for file in $dir/ocamldoc/*; do \
      /usr/bin/install -c -m 644 $file \
        /sage/local/var/tmp/sage/build/ppl-1.2.p1/inst/sage/local/share/doc/ppl/$dir/ocamldoc/`basename $file`; \
    done; \
  fi; \
  for file in $dir/*; do \
    /usr/bin/install -c -m 644 $file /sage/local/var/tmp/sage/build/ppl-1.2.p1/inst/sage/local/share/doc/ppl/$dir/`basename $file`; \
  done; \
done
mkdir -p -- /sage/local/var/tmp/sage/build/ppl-1.2.p1/inst/sage/local/share/doc/ppl/ppl-user-1.2-html
/bin/bash: line 5: gunzip: command not found
tar: This does not look like a tar archive
tar: Exiting with failure status due to previous errors
/usr/bin/install: cannot stat 'ppl-user-1.2-html/*': No such file or directory
mkdir -p -- /sage/local/var/tmp/sage/build/ppl-1.2.p1/inst/sage/local/share/doc/ppl/ppl-user-c-interface-1.2-html
/bin/bash: line 5: gunzip: command not found
tar: This does not look like a tar archive
tar: Exiting with failure status due to previous errors
```


----
Last 10 new commits:


---

Comment by git created at 2020-11-17 00:13:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-17 01:23:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-17 05:09:01

`tox -e docker-opensuse-tumbleweed-standard` gives:

```
configure: notice: the following SPKGs did not find equivalent system packages: _recommended cbc cddlib cmake coxeter3 eclib ecm flintqs giac gp2c isl lcalc libsemigroups lrcalc ninja_build openssl palp pandoc pari pari_elldata pari_galdata pari_galpol pari_nftables pari_seadata pari_seadata_small perl_cpan_polymake_prereq perl_term_readline_gnu planarity rw symmetrica sympow tox zn_poly
checking for the package system in use... opensuse
configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
configure:   $ sudo zypper install cddlib-tools "pkgconfig(cddlib)" cmake coxeter giac-devel gp2c "pkgconfig(isl)" "pkgconfig(libsemigroups)" ninja "pkgconfig(libssl)" pandoc pari-devel pari-gp pari-elldata pari-galdata pari-galpol pari-nftables pari-seadata "perl(Term::ReadLine::Gnu)" edge-addition-planarity-suite sympow zn_poly-devel
```

In particular, pari is missing some of its database packages and therefore Sage rejects system pari (and hence also giac). Also openssl is not found, perhaps the change to `"pkgconfig(libssl)"` was not so great. 

But overall this is looking OK. Follow-up tickets can refine this.


---

Comment by @jengelh created at 2020-11-17 08:39:47

Leap does not receive new packages until the next release (15.3 / somewhere in 2021).

>pari is missing some of its database packages

Like, which ones? From the name alone, shipping seadata-small seems unnecessary when seadata is present.

>"notice: the following SPKGs did not find equivalent system packages: [...] cmake [...]"

Gotta wonder how it can miss these. How does one debug that? docker being docker, the state is gone after tox is aborted.

Somehow, cmake is not even listed, tho:


```
tox -e docker-opensuse-tumbleweed-standard
...
Step 2/42 : FROM ${BASE_IMAGE} as with-system-packages
 ---> a1c2b1e3e974
Step 3/42 : ENV PACKAGES="binutils make m4 perl python3 tar bc gcc ca-certificates gzip gettext-tools autoconf automake libtool pkgconfig arb-devel boost-devel brial-devel bzip2 "pkgconfig(bzip2)" cddlib-tools "pkgconfig(cddlib)" cliquer cliquer-devel curl "pkgconfig(libcurl)" "pkgconfig(fflas-ffpack)" flint-devel "pkgconfig(fplll)" "pkgconfig(freetype2)" "pkgconfig(bdw-gc)" gcc-c++ "pkgconfig(gf2x)" gfan gcc-fortran giac-devel git "pkgconfig(givaro)" glpk glpk-devel gmp-devel "pkgconfig(gsl)" iml-devel "pkgconfig(atomic_ops)" libbraiding-devel "pkgconfig(libffi)" gd "pkgconfig(gdlib)" "pkgconfig(libpng16)" "pkgconfig(m4ri)" "pkgconfig(m4rie)" mpc-devel mpfi-devel "pkgconfig(mpfr)" libmpir-devel nauty nauty-devel "pkgconfig(ncurses)" "pkgconfig(ncursesw)" ntl-devel openblas-devel pari-devel pari-gp pari-galdata patch "pkgconfig(libpcre)" "pkgconfig(libpcreposix)" "pkgconfig(libpcrecpp)" pkgconf edge-addition-planarity-suite ppl-devel python3-devel R-base readline-devel "pkgconfig(readline)" "pkgconfig(sqlite3)" suitesparse-devel sympow tachyon xz "pkgconfig(liblzma)" yasm "pkgconfig(libzmq)" "pkgconfig(zlib)" zn_poly-devel"
```



---

Comment by mkoeppe created at 2020-11-17 16:12:37

`cmake` is an optional package, and the `-standard` configuration does not include the system packages for that, so this is normal. (The system package advice message recommends it anyway.)


---

Comment by mkoeppe created at 2020-11-17 16:14:43

Replying to [comment:29 gh-jengelh]:
> Leap does not receive new packages until the next release (15.3 / somewhere in 2021).
> 
> >pari is missing some of its database packages
> 
> Like, which ones? 

From configure output:

```
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG pari...
checking whether any of gmp mpir readline is installed as or will be installed as SPKG... no
checking for gp... /usr/bin/gp
checking for gphelp... /usr/bin/gphelp
checking whether gphelp has access to the documentation... yes
checking is pari_elldata installed? ... no; cannot use system pari/GP without elldata package
configure: Install elldata package and reconfigure.
configure: Otherwise Sage will build its own pari/GP.
checking is pari_galdata installed? ... yes
checking is pari_galpol installed? ... no; cannot use system pari/GP without galpol package
configure: Install galpol package and reconfigure.
configure: Otherwise Sage will build its own pari/GP.
checking is pari_seadata installed? ... no; cannot use system pari/GP without seadata package
configure: Install seadata package and reconfigure.
configure: Otherwise Sage will build its own pari/GP.
checking whether hyperellcharpoly bug is fixed... yes
checking whether bnfisunit bug of pari 2.11.3 is fixed... no; cannot use system pari/GP with known bug
configure: Upgrade your system package and reconfigure.
configure: Otherwise Sage will build its own pari/GP.
checking whether qfisom bug of pari 2.11.2 is fixed... yes
configure: no suitable system package found for SPKG pari
```



> From the name alone, shipping seadata-small seems unnecessary when seadata is present.

That's right.


---

Comment by mkoeppe created at 2020-11-17 16:27:02

Replying to [comment:29 gh-jengelh]:
> How does one debug that? docker being docker, the state is gone after tox is aborted.

You can do `tox -e docker-opensuse-tumbleweed-standard -- config.status` and it will stop after the configure run.


---

Comment by mkoeppe created at 2020-11-23 23:44:04

I consider this branch good enough for merging. Could another reviewer please take a look?


---

Comment by @kliem created at 2020-11-24 08:52:58

https://github.com/kliem/sage/runs/1446694212?check_suite_focus=true


---

Comment by @kliem created at 2020-11-24 13:36:17

Ok. Looks pretty good to me.

For some reason now all the runs fail, but pretty for down:

https://github.com/kliem/sage/actions/runs/380694690

I don't think the problem is related to this ticket here.


---

Comment by mkoeppe created at 2020-11-24 17:35:13

I think the build failures may be from the missing dependency of sagelib on giac, fixed in #30858 but not yet in a release


---

Comment by @kliem created at 2020-11-24 19:09:54

LGTM.


---

Comment by @kliem created at 2020-11-24 19:09:54

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-11-24 19:11:46

Thanks!


---

Comment by dimpase created at 2020-11-30 19:13:58

it does not merge cleanly in the current beta, I get

```
CONFLICT (file location): build/pkgs/itsdangerous/distros/conda.txt added in 527a652fcdca673b5d85c1abfb31453ad57b72f8 inside a directory that was renamed in HEAD, suggesting it should perhaps be moved to build/pkgs/texttable/distros/conda.txt.
Auto-merging build/bin/sage-print-system-package-command
Automatic merge failed; fix conflicts and then commit the result.
```



---

Comment by git created at 2020-11-30 19:18:35

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2020-11-30 19:18:35

Changing status from positive_review to needs_review.


---

Comment by dimpase created at 2020-11-30 19:19:09

also, `./boostrap` shows

```
src/doc/bootstrap:100: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt
Warning: build/pkgs/pathpy/type is missing.
Warning: build/pkgs/python_openid/type is missing.
```


is this really ready?
----
New commits:


---

Comment by mkoeppe created at 2020-11-30 19:19:48

Try again now


---

Comment by mkoeppe created at 2020-11-30 19:21:02

I think you must have set nonstandard merge settings that are causing this trouble


---

Comment by git created at 2020-11-30 19:22:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-30 19:22:34

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-11-30 19:57:12

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2020-11-30 19:57:12

by the way, on tumbleweed I still get a request to install

```
cddlib-tools "pkgconfig(cddlib)" coxeter edge-addition-planarity-suite sympow
```

even though they are installed. 

In fact, `sympow` is buggy - the 1st test from spkg-configure fails.

`cddlib` is not picked up as `cdd.h` is expected in `/usr/include`, but is installed in `/usr/include/cddlib`.

`coxeter` has as upstream an old https://github.com/tscrim/coxeter - and does not install headers, oops...

And `edge-addition-planarity-suite-devel` is missing, and `edge-addition-planarity-suite` does not install headers.

The latter should be fixed.


```diff
diff --git a/build/pkgs/planarity/distros/opensuse.txt b/build/pkgs/planarity/distros/opensuse.txt
index ee639f9c63..634b142c65 100644
--- a/build/pkgs/planarity/distros/opensuse.txt
+++ b/build/pkgs/planarity/distros/opensuse.txt
@@ -1 +1,2 @@
 edge-addition-planarity-suite
+edge-addition-planarity-suite-devel
```



---

Comment by mkoeppe created at 2020-11-30 19:59:18

Replying to [comment:46 dimpase]:
> And `edge-addition-planarity-suite-devel` is missing, and `edge-addition-planarity-suite` does not install headers.
> 
> The latter should be fixed.

Please push a fix for this one to the ticket.


---

Comment by mkoeppe created at 2020-11-30 20:00:10

The cddlib header issues are best taken care of in #29413


---

Comment by @jengelh created at 2020-11-30 20:13:19

>cddlib is not picked up as cdd.h is expected in /usr/include, but is installed in /usr/include/cddlib.

This is how cddlib 0.94l installs itself. Since cddlib.pc does not specify any `-I` other than the default `-I${includedir}`, the developers mean that cdd.h is now to be included through a `#include <cddlib/cdd.h>` line, rather than { `#include <cdd.h>` plus some forced -I injection in the project making use of cdd}.

>coxeter has as upstream an old ​https://github.com/tscrim/coxeter - and does not install headers, oops... 

Surely this is an upstream problem, is it not?


```
21:12 a4:../coxeter/coxeter-3.1+git7 » make install DESTDIR=$PWD/rt
make: *** No rule to make target 'install'.  Stop.
```



---

Comment by git created at 2020-11-30 20:59:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-30 21:01:07

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2020-11-30 21:01:07

I would think other changes are beyond the scope of this ticket.


---

Comment by dimpase created at 2020-11-30 22:09:43

on tumbleweed (that is, with gcc 10)
the sagelib interface to lcalc does not build

```
[sagelib-9.3.beta2] In file included from /home/dima/tracmirror/local/include/Lfunction/L.h:537,
[sagelib-9.3.beta2]                  from build/cythonized/sage/libs/lcalc/lcalc_sage.h:1,
[sagelib-9.3.beta2]                  from build/cythonized/sage/libs/lcalc/lcalc_Lfunction.cpp:674:
[sagelib-9.3.beta2] /home/dima/tracmirror/local/include/Lfunction/Lvalue.h: In member function �~@~XComplex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = std::complex<double>]�~@~Y:
[sagelib-9.3.beta2] /home/dima/tracmirror/local/include/Lfunction/Lvalue.h:489:5: error: control reaches end of non-void function [-Werror=return-type]
[sagelib-9.3.beta2]   489 |     }
[sagelib-9.3.beta2]       |     ^
[sagelib-9.3.beta2] /home/dima/tracmirror/local/include/Lfunction/Lvalue.h: In member function �~@~XComplex L_function<ttype>::value_via_Riemann_sum(Complex, const char*) [with ttype = int]�~@~Y:
```



---

Comment by dimpase created at 2020-11-30 22:18:45

let's open another ticket to fix lcalc on gcc-10.
Basically, the problem is that the function
`template <class ttype> Complex L_function <ttype>::value_via_gamma_sum(..)`
does a bunch of conditional returns, but there is no "final" `else`, so compiler
is right to be unhappy.


---

Comment by dimpase created at 2020-11-30 22:18:45

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-11-30 22:20:06

please see #30987


---

Comment by mkoeppe created at 2020-11-30 22:20:48

For `lcalc`, see also #28015 (Drop lcalc)


---

Comment by fbissey created at 2020-12-13 02:37:43

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2020-12-13 02:37:43

We removed `python_openid` earlier in the 9.3 cycle :) do not re-add bits of it with this ticket.

```
Warning: build/pkgs/python_openid/type is missing.
Warning: build/pkgs/python_openid/type is missing.
Warning: build/pkgs/python_openid/type is missing.
Warning: build/pkgs/python_openid/type is missing.
Warning: build/pkgs/python_openid/type is missing.
Warning: build/pkgs/python_openid/type is missing.
```

that's when bootstrapping the documentation. And rightly so

```
fbissey@moonloop /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999 $ ll build/pkgs/python_openid/
total 0
drwxr-xr-x   3 fbissey fbissey   60 Dec 13 15:30 .
drwxr-xr-x 303 fbissey fbissey 6.4K Dec 13 15:30 ..
drwxr-xr-x   2 fbissey fbissey   60 Dec 13 15:30 distros
fbissey@moonloop /dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999 $ ll build/pkgs/python_openid/distros/
total 4.0K
drwxr-xr-x 2 fbissey fbissey 60 Dec 13 15:30 .
drwxr-xr-x 3 fbissey fbissey 60 Dec 13 15:30 ..
-rw-r--r-- 1 fbissey fbissey 23 Dec 13 15:30 opensuse.txt
```



---

Comment by git created at 2020-12-13 05:15:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-13 05:16:33

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2020-12-13 05:16:33

The ticket is already merged in Volker's branch, but here we go...


---

Comment by fbissey created at 2020-12-13 05:18:51

Replying to [comment:58 mkoeppe]:
> The ticket is already merged in Volker's branch, but here we go...

He probably won't see it then. We should be ready to have a follow up to clean.


---

Comment by vbraun created at 2020-12-14 23:53:26

Resolution: fixed
