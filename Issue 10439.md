# Issue 10439: spkg/install: implement newest_version using a shell function

archive/issues_010439.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  @nexttime\n\nKeywords: scripts install newest_version\n\nThe shell script `newest_version` should become a shell function in `spkg/install`.  It should also do some error checking, since currently a non-existing package will not signal *any* error.  A shell function should simply exit with an error message.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10492\n\n",
    "created_at": "2010-12-18T13:08:09Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "spkg/install: implement newest_version using a shell function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10439",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: GeorgSWeber

CC:  @nexttime

Keywords: scripts install newest_version

The shell script `newest_version` should become a shell function in `spkg/install`.  It should also do some error checking, since currently a non-existing package will not signal *any* error.  A shell function should simply exit with an error message.

Issue created by migration from https://trac.sagemath.org/ticket/10492





---

archive/issue_comments_107480.json:
```json
{
    "body": "Changing component from build to scripts.",
    "created_at": "2010-12-18T16:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107480",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from build to scripts.



---

archive/issue_comments_107481.json:
```json
{
    "body": "It would be nice if a shell function `newest_version()` would also be available for other spkg to check that required versions of dependencies are available. So I'd like it to be in 3rd file `install-functions` (or so) that is sourced by `install`. Perhaps with a better name, for example `requires_version(mpir,1,1,2)`...\n\nMoreover, the current `newest_version` script does not check that it is called from `$SAGE_ROOT/spkg`. If it is called from the wrong directory, I get\n\n```\n/home/vbraun/Sage/sage/spkg/standard\n[vbraun@volker-two standard]$ ./newest_version mpir\nmpir-1.2.2.p2\n```\n\non Linux and \n\n```\nvbraun@t2:standard$ pwd\n/home/vbraun/t2/sage-4.6.1-sunos-32bit-5.10-sun4v-SunOS/spkg/standard\nvbraun@t2:standard$ ./newest_version mpir\n```\n\n(no output) on t2/Solaris.",
    "created_at": "2011-01-20T22:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107481",
    "user": "https://github.com/vbraun"
}
```

It would be nice if a shell function `newest_version()` would also be available for other spkg to check that required versions of dependencies are available. So I'd like it to be in 3rd file `install-functions` (or so) that is sourced by `install`. Perhaps with a better name, for example `requires_version(mpir,1,1,2)`...

Moreover, the current `newest_version` script does not check that it is called from `$SAGE_ROOT/spkg`. If it is called from the wrong directory, I get

```
/home/vbraun/Sage/sage/spkg/standard
[vbraun@volker-two standard]$ ./newest_version mpir
mpir-1.2.2.p2
```

on Linux and 

```
vbraun@t2:standard$ pwd
/home/vbraun/t2/sage-4.6.1-sunos-32bit-5.10-sun4v-SunOS/spkg/standard
vbraun@t2:standard$ ./newest_version mpir
```

(no output) on t2/Solaris.



---

archive/issue_comments_107482.json:
```json
{
    "body": "Changing keywords from \"scripts install newest_version\" to \"scripts install newest_version deps Makefile\".",
    "created_at": "2012-01-31T11:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107482",
    "user": "https://github.com/jdemeyer"
}
```

Changing keywords from "scripts install newest_version" to "scripts install newest_version deps Makefile".



---

archive/issue_comments_107483.json:
```json
{
    "body": "Changing component from scripts to build.",
    "created_at": "2012-01-31T11:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107483",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from scripts to build.



---

archive/issue_comments_107484.json:
```json
{
    "body": "Attachment [10492_no_more_newest_version.patch](tarball://root/attachments/some-uuid/ticket10492/10492_no_more_newest_version.patch) by @jdemeyer created at 2012-02-07 23:19:42",
    "created_at": "2012-02-07T23:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107484",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10492_no_more_newest_version.patch](tarball://root/attachments/some-uuid/ticket10492/10492_no_more_newest_version.patch) by @jdemeyer created at 2012-02-07 23:19:42



---

archive/issue_comments_107485.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-02T08:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107485",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_107486.json:
```json
{
    "body": "Is the code in data/extcode/debian dead? It uses `newest_version`, but is it relevant anymore?\n\nOtherwise, the changes here make sense, and I've been using this (via #12369) for some time now with no problems. I'll test on a few more systems, and then (pending the answer to my question) I can give it a positive review.",
    "created_at": "2012-03-05T21:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107486",
    "user": "https://github.com/jhpalmieri"
}
```

Is the code in data/extcode/debian dead? It uses `newest_version`, but is it relevant anymore?

Otherwise, the changes here make sense, and I've been using this (via #12369) for some time now with no problems. I'll test on a few more systems, and then (pending the answer to my question) I can give it a positive review.



---

archive/issue_comments_107487.json:
```json
{
    "body": "I think that `make distclean` should delete `spkg/Makefile`.",
    "created_at": "2012-03-06T06:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107487",
    "user": "https://github.com/jhpalmieri"
}
```

I think that `make distclean` should delete `spkg/Makefile`.



---

archive/issue_comments_107488.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-06T06:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107488",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_107489.json:
```json
{
    "body": "For Debian, see #12470.  Yes, it's unused.",
    "created_at": "2012-03-06T09:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107489",
    "user": "https://github.com/jdemeyer"
}
```

For Debian, see #12470.  Yes, it's unused.



---

archive/issue_comments_107490.json:
```json
{
    "body": "Attachment [10492_deps_to_Makefile.patch](tarball://root/attachments/some-uuid/ticket10492/10492_deps_to_Makefile.patch) by @jdemeyer created at 2012-03-06 09:43:31",
    "created_at": "2012-03-06T09:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107490",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [10492_deps_to_Makefile.patch](tarball://root/attachments/some-uuid/ticket10492/10492_deps_to_Makefile.patch) by @jdemeyer created at 2012-03-06 09:43:31



---

archive/issue_comments_107491.json:
```json
{
    "body": "Replying to [comment:11 jhpalmieri]:\n> I think that `make distclean` should delete `spkg/Makefile`.\n\nYes, it should.  Fixed.",
    "created_at": "2012-03-06T09:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107491",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 jhpalmieri]:
> I think that `make distclean` should delete `spkg/Makefile`.

Yes, it should.  Fixed.



---

archive/issue_comments_107492.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-06T09:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107492",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_107493.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-03-06T23:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107493",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_107494.json:
```json
{
    "body": "Thanks for the review!\n\nLooks like the whole build system will be cleaned up nicely in sage-5.0 (#11073, #12479, #10492,...)",
    "created_at": "2012-03-06T23:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107494",
    "user": "https://github.com/jdemeyer"
}
```

Thanks for the review!

Looks like the whole build system will be cleaned up nicely in sage-5.0 (#11073, #12479, #10492,...)



---

archive/issue_comments_107495.json:
```json
{
    "body": "It would be nicer (and more appropriate) to use `basename` (which is POSIX) in `newest_version*()`.\n\n\n\n\nAny reason to *copy* `spkg/standard/deps` rather than include it by the generated `Makefile`?",
    "created_at": "2012-03-20T12:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107495",
    "user": "https://github.com/nexttime"
}
```

It would be nicer (and more appropriate) to use `basename` (which is POSIX) in `newest_version*()`.




Any reason to *copy* `spkg/standard/deps` rather than include it by the generated `Makefile`?



---

archive/issue_comments_107496.json:
```json
{
    "body": "It turns out that this change breaks the optional Sage package `database_gap`, since that package uses the `newest_version` script. See #12712.",
    "created_at": "2012-03-20T20:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107496",
    "user": "https://github.com/jhpalmieri"
}
```

It turns out that this change breaks the optional Sage package `database_gap`, since that package uses the `newest_version` script. See #12712.



---

archive/issue_comments_107497.json:
```json
{
    "body": "Replying to [comment:17 leif]:\n> Any reason to *copy* `spkg/standard/deps` rather than include it by the generated `Makefile`?\n\n1) because it looks cleaner to me to have just one Makefile.\n\n2) because I was worried about the portability of including files inside Makefiles.",
    "created_at": "2012-03-20T22:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107497",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 leif]:
> Any reason to *copy* `spkg/standard/deps` rather than include it by the generated `Makefile`?

1) because it looks cleaner to me to have just one Makefile.

2) because I was worried about the portability of including files inside Makefiles.



---

archive/issue_comments_107498.json:
```json
{
    "body": "Replying to [comment:20 jdemeyer]:\n> Replying to [comment:17 leif]:\n> > Any reason to *copy* `spkg/standard/deps` rather than include it by the generated `Makefile`?\n> \n> 1) because it looks cleaner to me to have just one Makefile.\n\nWell, after copying, we still have two... ;-)\n\n\n\n\n> 2) because I was worried about the portability of including files inside Makefiles.\n\nThen you should avoid looking at the eclib package, which does (really) horrible things... B)\n\n(Sage won't build with anything else but GNU `make` anyway, and this will not change in the foreseeable future, since many upstream packages rely on GNU `make` as well.)",
    "created_at": "2012-03-20T23:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107498",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:20 jdemeyer]:
> Replying to [comment:17 leif]:
> > Any reason to *copy* `spkg/standard/deps` rather than include it by the generated `Makefile`?
> 
> 1) because it looks cleaner to me to have just one Makefile.

Well, after copying, we still have two... ;-)




> 2) because I was worried about the portability of including files inside Makefiles.

Then you should avoid looking at the eclib package, which does (really) horrible things... B)

(Sage won't build with anything else but GNU `make` anyway, and this will not change in the foreseeable future, since many upstream packages rely on GNU `make` as well.)



---

archive/issue_comments_107499.json:
```json
{
    "body": "Any nice idea of how one could pass some flags just to the top-level `make`, but not to the instances building spkgs?  (I'm thinking of `-k`.)",
    "created_at": "2012-03-21T10:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107499",
    "user": "https://github.com/nexttime"
}
```

Any nice idea of how one could pass some flags just to the top-level `make`, but not to the instances building spkgs?  (I'm thinking of `-k`.)



---

archive/issue_comments_107500.json:
```json
{
    "body": "Replying to [comment:22 leif]:\n> Any nice idea of how one could pass some flags just to the top-level `make`, but not to the instances building spkgs?  (I'm thinking of `-k`.)\n\nAssuming that `spkg/Makefile` exists:\n\n```\ncd spkg\nMAKE=\"make -S\" make -k\n```\n\n(not tested)",
    "created_at": "2012-03-21T11:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107500",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:22 leif]:
> Any nice idea of how one could pass some flags just to the top-level `make`, but not to the instances building spkgs?  (I'm thinking of `-k`.)

Assuming that `spkg/Makefile` exists:

```
cd spkg
MAKE="make -S" make -k
```

(not tested)



---

archive/issue_comments_107501.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-03-23T15:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10439#issuecomment-107501",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_010568.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2012-03-23T15:19:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10439",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10439#event-10568"
}
```
