# Issue 28244: free_module method for finite fields, number fields and p-adics

Issue created by migration from https://trac.sagemath.org/ticket/28481

Original creator: roed

Original creation time: 2019-09-12 19:10:58

CC:  saraedum caruso

In support of the ring extension classes in #21413, we want to generalize the functionality of the `vector_space` method to free modules over other rings.  This ticket renames the method to `free_module` and implements it for p-adic extensions.


---

Comment by roed created at 2019-09-12 23:16:45

Changing keywords from "" to "padicBordeaux".


---

Comment by roed created at 2019-09-12 23:16:45

New commits:


---

Comment by roed created at 2019-09-12 23:16:45

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-09-13 01:24:15

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2019-09-13 01:24:15

The `free_module` in `padic_extension_generic.py` does not have any doctests.

About this comment

```
# We could have used morphisms in the category
# FiniteDimensionalModulesWithBasis over Qp(p)
# But this would require making p-adic fields
# part of this category which has a lot of side
# effects (adding methods which will show up
# in tab completion for example).  For now we
# just stick with Map.
```

having extra methods via tab completion is a good thing, especially as they are all still applicable to the objects. That specific reason really is not a good argument for not doing that, but are there other side effects that cause problems?


```diff
-            - ``basis`` -- a basis of the field as a vector space
-              over the subfield.  If not given, one is chosen automatically.
+            - ``basis`` -- a basis of the field as a vector space
+              over the subfield; f not given, one is chosen automatically
 
-            - ``map`` -- whether to return maps from and to the vector space.
+            - ``map`` -- whether to return maps from and to the vector space
```


```diff
-        - ``basis`` -- a basis for the vector space (ignored)
+        - ``basis`` -- (ignored) a basis for the vector space
 
-        - ``map`` -- whether to return maps to and from the vector space (default True)
+        - ``map`` -- (default: ``True``) whether to return maps to and from the vector space
```


```diff
-        - ``base`` -- a subfield (default: ``None``), the returned vector
+        - ``base`` -- a subfield (default: ``None``); the returned vector
           space is over this subfield `R`, which defaults to the base field of this
-          function field.
+          function field
 
-        - ``basis`` -- a basis for this field over the base.
 
         - ``maps`` -- boolean (default ``True``), whether to return
-          `R`-linear maps to and from `V`.
+          `R`-linear maps to and from `V`
```


```diff
-        - ``basis`` -- a list of elements giving a basis over the subfield (optional)
+        - ``basis`` -- (optional) a list of elements giving a basis over the subfield
 
+        - ``map`` -- whether to return isomorphisms to and from the vector space (default ``True``)
+        - ``map`` -- (default: ``True``) whether to return isomorphisms to and from the vector space
```

Also `Returns` -> `Return`.


---

Comment by git created at 2019-09-13 08:24:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-13 08:26:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2019-09-13 08:30:26

Changing status from needs_work to needs_review.


---

Comment by roed created at 2019-09-13 08:30:26

Replying to [comment:4 tscrim]:
> The `free_module` in `padic_extension_generic.py` does not have any doctests.

Thanks; fixed.

> About this comment
> {{{
> # We could have used morphisms in the category
> # FiniteDimensionalModulesWithBasis over Qp(p)
> # But this would require making p-adic fields
> # part of this category which has a lot of side
> # effects (adding methods which will show up
> # in tab completion for example).  For now we
> # just stick with Map.
> }}}
> having extra methods via tab completion is a good thing, especially as they are all still applicable to the objects. That specific reason really is not a good argument for not doing that, but are there other side effects that cause problems?

Yep.

* If I add `ModulesWithBasis(Qp(5)).Finite()` as a base ring for `Qq(125)` I get errors on object creation.  It's not clear to me how much work it would be to address all the issues introduced by this change, and I'm not interested in doing so at the moment when I have higher priority things to work on.
* The `dimension()` method of the `ModulesWithBasis` category doesn't take a base field.  Two-step extensions are vector spaces both over their base field and over `Qp`; I don't think it would be possible to have both.  But #21413 is exactly about creating relative extensions where we need to work with different base fields.


---

Comment by tscrim created at 2019-09-13 09:25:53

Replying to [comment:7 roed]:
> Replying to [comment:4 tscrim]:
> > About this comment
> > {{{
> > # We could have used morphisms in the category
> > # FiniteDimensionalModulesWithBasis over Qp(p)
> > # But this would require making p-adic fields
> > # part of this category which has a lot of side
> > # effects (adding methods which will show up
> > # in tab completion for example).  For now we
> > # just stick with Map.
> > }}}
> > having extra methods via tab completion is a good thing, especially as they are all still applicable to the objects. That specific reason really is not a good argument for not doing that, but are there other side effects that cause problems?
> 
> Yep.

Thanks for the explanations. Do you think you could change the above comment to state one of them you gave? Once done, then positive review.

> * If I add `ModulesWithBasis(Qp(5)).Finite()` as a base ring for `Qq(125)` I get errors on object creation.  It's not clear to me how much work it would be to address all the issues introduced by this change, and I'm not interested in doing so at the moment when I have higher priority things to work on.

No problem. It is something beyond the current ticket and not important for your applications. It is something I could look into too when I have more time as well.

> * The `dimension()` method of the `ModulesWithBasis` category doesn't take a base field.  Two-step extensions are vector spaces both over their base field and over `Qp`; I don't think it would be possible to have both.  But #21413 is exactly about creating relative extensions where we need to work with different base fields.

In the mathematical sense, the category stores this information (i.e., it is an R-module, so it returns the dimension as an R-module), although we have partially removed this information. However, that is a bit tangential to this issue. I don't know the code, but your implementation of `dimension` should be overriding that. If instead it something coming from the two categories, then you will unfortunately just need to make it explicit somewhere. Or we just add that as an optional argument to the `ModulesWithBasis` category that is generally ignored as it is something that makes sense for all objects in that category. However, this should be done on a later ticket.


---

Comment by git created at 2019-09-13 13:39:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2019-09-13 14:50:41

I'm not sure that checking equality with `rich_to_bool(op,0)` will always work.

In the doctest of the `_call_` method in the class `MapOneStepToFreeModule`, the variable `a` is used two times with a different meaning.


---

Comment by git created at 2019-09-13 15:15:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2019-09-13 15:15:18

Thanks; fixed.


---

Comment by caruso created at 2019-09-13 15:40:26

LGTM if patch bot is happy


---

Comment by caruso created at 2019-09-13 20:48:55

Maybe, for convenience:
- `free_module` should be implemented when `base` is `self` (in which case `V = K` and maps in both directions are the identity)
- `free_module` should be implemented when `base` is `self.base_ring()` (and not just `None`); this is currently not the case for number fields and p-adic fields
- `free_module` should be implemented when `self` is `Qp` or `QQ`


---

Comment by caruso created at 2019-09-13 20:49:41

Changing status from needs_review to needs_work.


---

Comment by caruso created at 2019-09-13 20:50:50

By the way, the patchbot reported small issues (pyflakes + one method not documented)


---

Comment by git created at 2019-09-14 00:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-14 00:22:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2019-09-14 00:23:14

I think I fixed the doctest and pyflakes errors.  Setting to Needs Review so that the patchbot can check.  I haven't addressed Xavier's most recent comments yet....


---

Comment by roed created at 2019-09-14 00:23:14

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-09-14 08:05:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-14 20:40:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by caruso created at 2019-09-15 04:19:23

Thanks


---

Comment by caruso created at 2019-09-15 04:19:23

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-03 17:57:29

Resolution: fixed
