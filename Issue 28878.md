# Issue 28878: Fix deprecation warnings with scipy 1.4

archive/issues_028878.json:
```json
{
    "body": "CC:  fbissey @timokau isuruf\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29115\n\n",
    "created_at": "2020-01-31T07:13:32Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Fix deprecation warnings with scipy 1.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28878",
    "user": "arojas"
}
```
CC:  fbissey @timokau isuruf



Issue created by migration from https://trac.sagemath.org/ticket/29115





---

archive/issue_comments_408787.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-31T07:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408787",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408788.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-31T07:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408788",
    "user": "arojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_408789.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2020-01-31T07:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408789",
    "user": "arojas"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_408790.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-01-31T07:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408790",
    "user": "arojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_408791.json:
```json
{
    "body": "I was just going to look at scipy 1.4 (in fact I have doctest run going on). \n\nNote that setting the reviewers field doesn't actually cc people.",
    "created_at": "2020-01-31T07:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408791",
    "user": "fbissey"
}
```

I was just going to look at scipy 1.4 (in fact I have doctest run going on). 

Note that setting the reviewers field doesn't actually cc people.



---

archive/issue_comments_408792.json:
```json
{
    "body": "oops",
    "created_at": "2020-01-31T07:26:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408792",
    "user": "arojas"
}
```

oops



---

archive/issue_comments_408793.json:
```json
{
    "body": "You are talking about networkx, is it safe and better to move to a newer version in your experience? I have 2.4 available in my tree. We'll have to look at matplotlib as well - considering the last two upgrades that may not be fun.",
    "created_at": "2020-01-31T07:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408793",
    "user": "fbissey"
}
```

You are talking about networkx, is it safe and better to move to a newer version in your experience? I have 2.4 available in my tree. We'll have to look at matplotlib as well - considering the last two upgrades that may not be fun.



---

archive/issue_comments_408794.json:
```json
{
    "body": "Replying to [comment:6 fbissey]:\n> You are talking about networkx, is it safe and better to move to a newer version in your experience? I have 2.4 available in my tree. We'll have to look at matplotlib as well - considering the last two upgrades that may not be fun.\n\nThe deprecation warning fixes in networkx and in this ticket are orthogonal - both need to be applied eventually. The networkx fix is not yet in any stable release and the patch is huge and doesn't apply over the latest release [1] - I don't think it's worth the effort of trying to rebase it.\n\nThe upgrade to networkx 2.4 it pretty straightforward - there is just one test failure (caused by an expected deprecation warning that no longer happens, ironically). The matplotlib upgrade is also quite painless - there are just a couple of minor test failures related to pixel metric changes, one of which is an issue already with the current version (just not detected by doctests, cf. #28449)\n\nAll of these upgrades are python3-only, so I guess they need to wait for the outcome of the python2-support-in-9.1 discussion. \n\n[1] https://github.com/networkx/networkx/commit/ea19baaff252468f5a911260430e057393d9637d",
    "created_at": "2020-01-31T08:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408794",
    "user": "arojas"
}
```

Replying to [comment:6 fbissey]:
> You are talking about networkx, is it safe and better to move to a newer version in your experience? I have 2.4 available in my tree. We'll have to look at matplotlib as well - considering the last two upgrades that may not be fun.

The deprecation warning fixes in networkx and in this ticket are orthogonal - both need to be applied eventually. The networkx fix is not yet in any stable release and the patch is huge and doesn't apply over the latest release [1] - I don't think it's worth the effort of trying to rebase it.

The upgrade to networkx 2.4 it pretty straightforward - there is just one test failure (caused by an expected deprecation warning that no longer happens, ironically). The matplotlib upgrade is also quite painless - there are just a couple of minor test failures related to pixel metric changes, one of which is an issue already with the current version (just not detected by doctests, cf. #28449)

All of these upgrades are python3-only, so I guess they need to wait for the outcome of the python2-support-in-9.1 discussion. 

[1] https://github.com/networkx/networkx/commit/ea19baaff252468f5a911260430e057393d9637d



---

archive/issue_comments_408795.json:
```json
{
    "body": "Sounds good to know overall. I was very worried about matplotlib, I did the last two major upgrades in sage and neither was what I would call painless. I have been taking a bit of a step back for a while, it's good to know you are still very active.",
    "created_at": "2020-01-31T08:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408795",
    "user": "fbissey"
}
```

Sounds good to know overall. I was very worried about matplotlib, I did the last two major upgrades in sage and neither was what I would call painless. I have been taking a bit of a step back for a while, it's good to know you are still very active.



---

archive/issue_comments_408796.json:
```json
{
    "body": "OK the networkx stuff in `graphs/generic_graph.py` is real ugly.\n\nBut I think we should be able to fix this one in this ticket \n\n```\nsage -t --long /usr/share/doc/sage-9999/html/en/thematic_tutorials/_sources/numerical_sage/scipy.rst\n**********************************************************************\nFile \"/usr/share/doc/sage-9999/html/en/thematic_tutorials/_sources/numerical_sage/scipy.rst\", line 98, in scipy\nFailed example:\n    x= scipy.arange(0,100,.1)\nExpected nothing\nGot:\n    doctest:warning\n      File \"/usr/lib/python-exec/python3.7/sage-runtests\", line 179, in <module>\n        err = DC.run()\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/control.py\", line 1228, in run\n        self.run_doctests()\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/control.py\", line 929, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2033, in dispatch\n        self.parallel_dispatch()\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1925, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2200, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.7/multiprocessing/process.py\", line 112, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\n        code = process_obj._bootstrap()\n      File \"/usr/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\n        self.run()\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2172, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2504, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2553, in _run\n        result = runner.run(test)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 897, in run\n        return self._run(test, compileflags, out)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest scipy[4]>\", line 1, in <module>\n        x= scipy.arange(Integer(0),Integer(100),RealNumber('.1'))\n      File \"/usr/lib/python3.7/site-packages/scipy/_lib/deprecation.py\", line 19, in call\n        stacklevel=stacklevel)\n      File \"/usr/lib/python3.7/warnings.py\", line 110, in _showwarnmsg\n        msg.file, msg.line)\n    :\n    DeprecationWarning: scipy.arange is deprecated and will be removed in SciPy 2.0.0, use numpy.arange instead\n**********************************************************************\n1 item had failures:\n   1 of  14 in scipy\n    [11 tests, 1 failure, 1.11 s]\n```\n\nIt is part of a code block\n\n```\n    sage: import scipy\n    sage: from scipy import integrate\n    sage: def f_1(y,t):\n    ....:    return[y[1],-y[0]-10*y[1]*(y[0]**2-1)]\n    sage: def j_1(y,t):\n    ....:    return [ [0, 1.0],[-2.0*10*y[0]*y[1]-1.0,-10*(y[0]*y[0]-1.0)] ]\n    sage: x= scipy.arange(0,100,.1)\n    sage: y=integrate.odeint(f_1,[1,0],x,Dfun=j_1)\n```\n\nI think it is totally fine to add an import of numpy and do the suggested replacement.",
    "created_at": "2020-01-31T09:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408796",
    "user": "fbissey"
}
```

OK the networkx stuff in `graphs/generic_graph.py` is real ugly.

But I think we should be able to fix this one in this ticket 

```
sage -t --long /usr/share/doc/sage-9999/html/en/thematic_tutorials/_sources/numerical_sage/scipy.rst
**********************************************************************
File "/usr/share/doc/sage-9999/html/en/thematic_tutorials/_sources/numerical_sage/scipy.rst", line 98, in scipy
Failed example:
    x= scipy.arange(0,100,.1)
Expected nothing
Got:
    doctest:warning
      File "/usr/lib/python-exec/python3.7/sage-runtests", line 179, in <module>
        err = DC.run()
      File "/usr/lib/python3.7/site-packages/sage/doctest/control.py", line 1228, in run
        self.run_doctests()
      File "/usr/lib/python3.7/site-packages/sage/doctest/control.py", line 929, in run_doctests
        self.dispatcher.dispatch()
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2033, in dispatch
        self.parallel_dispatch()
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1925, in parallel_dispatch
        w.start()  # This might take some time
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2200, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.7/multiprocessing/process.py", line 112, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.7/multiprocessing/context.py", line 223, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.7/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.7/multiprocessing/popen_fork.py", line 20, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.7/multiprocessing/popen_fork.py", line 74, in _launch
        code = process_obj._bootstrap()
      File "/usr/lib/python3.7/multiprocessing/process.py", line 297, in _bootstrap
        self.run()
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2172, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2504, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2553, in _run
        result = runner.run(test)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 897, in run
        return self._run(test, compileflags, out)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest scipy[4]>", line 1, in <module>
        x= scipy.arange(Integer(0),Integer(100),RealNumber('.1'))
      File "/usr/lib/python3.7/site-packages/scipy/_lib/deprecation.py", line 19, in call
        stacklevel=stacklevel)
      File "/usr/lib/python3.7/warnings.py", line 110, in _showwarnmsg
        msg.file, msg.line)
    :
    DeprecationWarning: scipy.arange is deprecated and will be removed in SciPy 2.0.0, use numpy.arange instead
**********************************************************************
1 item had failures:
   1 of  14 in scipy
    [11 tests, 1 failure, 1.11 s]
```

It is part of a code block

```
    sage: import scipy
    sage: from scipy import integrate
    sage: def f_1(y,t):
    ....:    return[y[1],-y[0]-10*y[1]*(y[0]**2-1)]
    sage: def j_1(y,t):
    ....:    return [ [0, 1.0],[-2.0*10*y[0]*y[1]-1.0,-10*(y[0]*y[0]-1.0)] ]
    sage: x= scipy.arange(0,100,.1)
    sage: y=integrate.odeint(f_1,[1,0],x,Dfun=j_1)
```

I think it is totally fine to add an import of numpy and do the suggested replacement.



---

archive/issue_comments_408797.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-31T19:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408797",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408798.json:
```json
{
    "body": "Replying to [comment:9 fbissey]:\n> OK the networkx stuff in `graphs/generic_graph.py` is real ugly.\n> \n> But I think we should be able to fix this one in this ticket \n\nThanks, I always forget that there are tests in the docs too (those get installed with a .txt suffix for some reason so they are not picked up by the tester by default)",
    "created_at": "2020-01-31T19:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408798",
    "user": "arojas"
}
```

Replying to [comment:9 fbissey]:
> OK the networkx stuff in `graphs/generic_graph.py` is real ugly.
> 
> But I think we should be able to fix this one in this ticket 

Thanks, I always forget that there are tests in the docs too (those get installed with a .txt suffix for some reason so they are not picked up by the tester by default)



---

archive/issue_comments_408799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-31T19:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408799",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_408800.json:
```json
{
    "body": "Replying to [comment:11 arojas]:\n> Replying to [comment:9 fbissey]:\n> > OK the networkx stuff in `graphs/generic_graph.py` is real ugly.\n> > \n> > But I think we should be able to fix this one in this ticket \n> \n> Thanks, I always forget that there are tests in the docs too (those get installed with a .txt suffix for some reason so they are not picked up by the tester by default)\n\nYes that's one issue that started noticing at least a couple of years ago. I have a section in my install script to deal with all sort of unwanted results. I am not particularly sophisticated about that one\n\n```\n\t\t# restore .rst.txt file to .rst\n\t\tfor i in `find build_doc -name \\*.rst.txt`; do\n\t\t\tmv \"${i}\" \"${i%.txt}\"\n\t\tdone\n```\n\nbut now I am testing them too.",
    "created_at": "2020-01-31T19:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408800",
    "user": "fbissey"
}
```

Replying to [comment:11 arojas]:
> Replying to [comment:9 fbissey]:
> > OK the networkx stuff in `graphs/generic_graph.py` is real ugly.
> > 
> > But I think we should be able to fix this one in this ticket 
> 
> Thanks, I always forget that there are tests in the docs too (those get installed with a .txt suffix for some reason so they are not picked up by the tester by default)

Yes that's one issue that started noticing at least a couple of years ago. I have a section in my install script to deal with all sort of unwanted results. I am not particularly sophisticated about that one

```
		# restore .rst.txt file to .rst
		for i in `find build_doc -name \*.rst.txt`; do
			mv "${i}" "${i%.txt}"
		done
```

but now I am testing them too.



---

archive/issue_comments_408801.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-31T19:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408801",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_408802.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-11T21:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408802",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_408803.json:
```json
{
    "body": "networkx warnings are fixed in their trunk, but not in the latest release (2.4).",
    "created_at": "2020-05-30T22:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408803",
    "user": "dimpase"
}
```

networkx warnings are fixed in their trunk, but not in the latest release (2.4).



---

archive/issue_comments_408804.json:
```json
{
    "body": "see also #29766",
    "created_at": "2020-05-31T08:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28878",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28878#issuecomment-408804",
    "user": "dimpase"
}
```

see also #29766
