# Issue 28878: Fix deprecation warnings with scipy 1.4

Issue created by migration from https://trac.sagemath.org/ticket/29115

Original creator: arojas

Original creation time: 2020-01-31 07:13:32

CC:  fbissey @timokau isuruf




---

Comment by git created at 2020-01-31 07:18:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2020-01-31 07:21:18

Changing status from new to needs_review.


---

Comment by arojas created at 2020-01-31 07:21:18

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by arojas created at 2020-01-31 07:21:18

Changing type from PLEASE CHANGE to enhancement.


---

Comment by fbissey created at 2020-01-31 07:25:38

I was just going to look at scipy 1.4 (in fact I have doctest run going on). 

Note that setting the reviewers field doesn't actually cc people.


---

Comment by arojas created at 2020-01-31 07:26:27

oops


---

Comment by fbissey created at 2020-01-31 07:53:57

You are talking about networkx, is it safe and better to move to a newer version in your experience? I have 2.4 available in my tree. We'll have to look at matplotlib as well - considering the last two upgrades that may not be fun.


---

Comment by arojas created at 2020-01-31 08:43:11

Replying to [comment:6 fbissey]:
> You are talking about networkx, is it safe and better to move to a newer version in your experience? I have 2.4 available in my tree. We'll have to look at matplotlib as well - considering the last two upgrades that may not be fun.

The deprecation warning fixes in networkx and in this ticket are orthogonal - both need to be applied eventually. The networkx fix is not yet in any stable release and the patch is huge and doesn't apply over the latest release [1] - I don't think it's worth the effort of trying to rebase it.

The upgrade to networkx 2.4 it pretty straightforward - there is just one test failure (caused by an expected deprecation warning that no longer happens, ironically). The matplotlib upgrade is also quite painless - there are just a couple of minor test failures related to pixel metric changes, one of which is an issue already with the current version (just not detected by doctests, cf. #28449)

All of these upgrades are python3-only, so I guess they need to wait for the outcome of the python2-support-in-9.1 discussion. 

[1] https://github.com/networkx/networkx/commit/ea19baaff252468f5a911260430e057393d9637d


---

Comment by fbissey created at 2020-01-31 08:47:19

Sounds good to know overall. I was very worried about matplotlib, I did the last two major upgrades in sage and neither was what I would call painless. I have been taking a bit of a step back for a while, it's good to know you are still very active.


---

Comment by fbissey created at 2020-01-31 09:25:19

OK the networkx stuff in `graphs/generic_graph.py` is real ugly.

But I think we should be able to fix this one in this ticket 

```
sage -t --long /usr/share/doc/sage-9999/html/en/thematic_tutorials/_sources/numerical_sage/scipy.rst
**********************************************************************
File "/usr/share/doc/sage-9999/html/en/thematic_tutorials/_sources/numerical_sage/scipy.rst", line 98, in scipy
Failed example:
    x= scipy.arange(0,100,.1)
Expected nothing
Got:
    doctest:warning
      File "/usr/lib/python-exec/python3.7/sage-runtests", line 179, in <module>
        err = DC.run()
      File "/usr/lib/python3.7/site-packages/sage/doctest/control.py", line 1228, in run
        self.run_doctests()
      File "/usr/lib/python3.7/site-packages/sage/doctest/control.py", line 929, in run_doctests
        self.dispatcher.dispatch()
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2033, in dispatch
        self.parallel_dispatch()
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1925, in parallel_dispatch
        w.start()  # This might take some time
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2200, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.7/multiprocessing/process.py", line 112, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.7/multiprocessing/context.py", line 223, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.7/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.7/multiprocessing/popen_fork.py", line 20, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.7/multiprocessing/popen_fork.py", line 74, in _launch
        code = process_obj._bootstrap()
      File "/usr/lib/python3.7/multiprocessing/process.py", line 297, in _bootstrap
        self.run()
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2172, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2504, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 2553, in _run
        result = runner.run(test)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 897, in run
        return self._run(test, compileflags, out)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest scipy[4]>", line 1, in <module>
        x= scipy.arange(Integer(0),Integer(100),RealNumber('.1'))
      File "/usr/lib/python3.7/site-packages/scipy/_lib/deprecation.py", line 19, in call
        stacklevel=stacklevel)
      File "/usr/lib/python3.7/warnings.py", line 110, in _showwarnmsg
        msg.file, msg.line)
    :
    DeprecationWarning: scipy.arange is deprecated and will be removed in SciPy 2.0.0, use numpy.arange instead
**********************************************************************
1 item had failures:
   1 of  14 in scipy
    [11 tests, 1 failure, 1.11 s]
```

It is part of a code block

```
    sage: import scipy
    sage: from scipy import integrate
    sage: def f_1(y,t):
    ....:    return[y[1],-y[0]-10*y[1]*(y[0]**2-1)]
    sage: def j_1(y,t):
    ....:    return [ [0, 1.0],[-2.0*10*y[0]*y[1]-1.0,-10*(y[0]*y[0]-1.0)] ]
    sage: x= scipy.arange(0,100,.1)
    sage: y=integrate.odeint(f_1,[1,0],x,Dfun=j_1)
```

I think it is totally fine to add an import of numpy and do the suggested replacement.


---

Comment by git created at 2020-01-31 19:09:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2020-01-31 19:11:49

Replying to [comment:9 fbissey]:
> OK the networkx stuff in `graphs/generic_graph.py` is real ugly.
> 
> But I think we should be able to fix this one in this ticket 

Thanks, I always forget that there are tests in the docs too (those get installed with a .txt suffix for some reason so they are not picked up by the tester by default)


---

Comment by git created at 2020-01-31 19:13:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2020-01-31 19:19:55

Replying to [comment:11 arojas]:
> Replying to [comment:9 fbissey]:
> > OK the networkx stuff in `graphs/generic_graph.py` is real ugly.
> > 
> > But I think we should be able to fix this one in this ticket 
> 
> Thanks, I always forget that there are tests in the docs too (those get installed with a .txt suffix for some reason so they are not picked up by the tester by default)

Yes that's one issue that started noticing at least a couple of years ago. I have a section in my install script to deal with all sort of unwanted results. I am not particularly sophisticated about that one

```
		# restore .rst.txt file to .rst
		for i in `find build_doc -name \*.rst.txt`; do
			mv "${i}" "${i%.txt}"
		done
```

but now I am testing them too.


---

Comment by fbissey created at 2020-01-31 19:22:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-11 21:06:24

Resolution: fixed


---

Comment by dimpase created at 2020-05-30 22:18:25

networkx warnings are fixed in their trunk, but not in the latest release (2.4).


---

Comment by dimpase created at 2020-05-31 08:28:52

see also #29766
