# Issue 12961: BooleanMonomial.index() SEGFAULT on constant monomials

archive/issues_012961.json:
```json
{
    "body": "Assignee: malb\n\nCC:  malb alexanderdreyer polybori\n\n\n```\nsage: R.<x,y> = BooleanPolynomialRing()\nsage: R(1).lm().index()\n```\n\ncrashes miserably (from inside polybori, as I understand) with:\n\n```\n\n/usr/local/sage/local/lib/libcsage.so(print_backtrace+0x3b)[0x1cd9d3]\n/usr/local/sage/local/lib/libcsage.so(sigdie+0x17)[0x1cda13]\n/usr/local/sage/local/lib/libcsage.so(sage_signal_handler+0x20d)[0x1cd598]\n[0xc27400]\n/usr/local/sage/local/lib/python2.6/site-packages/sage/rings/polynomial/pbori.so(+0x13d90)[0x5235d90]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x482e)[0x2a55ee]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCode+0x63)[0x2a70c3]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x50c9)[0x2a5e89]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x59e1)[0x2a67a1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCode+0x63)[0x2a70c3]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyRun_FileExFlags+0xb1)[0x2c6f91]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyRun_SimpleFileExFlags+0xdc)[0x2c71cc]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(PyRun_AnyFileExFlags+0x7a)[0x2c75fa]\n/usr/local/sage/local/lib/libpython2.6.so.1.0(Py_Main+0xc7d)[0x2d3c4d]\npython(main+0x27)[0x8048657]\n/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf3)[0x405113]\n\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off(). You might\nwant to run Sage under gdb with 'sage -gdb' to debug this.\nSage will now terminate.\n------------------------------------------------------------------------\n```\n\n\nThis seems to be a bug in PolyBori. The patch I propose just checks that the monomial is not constant before calling the polybori function. This is a workaround though\n\nIssue created by migration from https://trac.sagemath.org/ticket/13133\n\n",
    "created_at": "2012-06-18T22:38:45Z",
    "labels": [
        "commutative algebra",
        "minor",
        "bug"
    ],
    "title": "BooleanMonomial.index() SEGFAULT on constant monomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12961",
    "user": "Bouillaguet"
}
```
Assignee: malb

CC:  malb alexanderdreyer polybori


```
sage: R.<x,y> = BooleanPolynomialRing()
sage: R(1).lm().index()
```

crashes miserably (from inside polybori, as I understand) with:

```

/usr/local/sage/local/lib/libcsage.so(print_backtrace+0x3b)[0x1cd9d3]
/usr/local/sage/local/lib/libcsage.so(sigdie+0x17)[0x1cda13]
/usr/local/sage/local/lib/libcsage.so(sage_signal_handler+0x20d)[0x1cd598]
[0xc27400]
/usr/local/sage/local/lib/python2.6/site-packages/sage/rings/polynomial/pbori.so(+0x13d90)[0x5235d90]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x482e)[0x2a55ee]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCode+0x63)[0x2a70c3]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x50c9)[0x2a5e89]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x59e1)[0x2a67a1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalFrameEx+0x4370)[0x2a5130]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCodeEx+0x7d1)[0x2a6fa1]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyEval_EvalCode+0x63)[0x2a70c3]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyRun_FileExFlags+0xb1)[0x2c6f91]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyRun_SimpleFileExFlags+0xdc)[0x2c71cc]
/usr/local/sage/local/lib/libpython2.6.so.1.0(PyRun_AnyFileExFlags+0x7a)[0x2c75fa]
/usr/local/sage/local/lib/libpython2.6.so.1.0(Py_Main+0xc7d)[0x2d3c4d]
python(main+0x27)[0x8048657]
/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf3)[0x405113]

------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off(). You might
want to run Sage under gdb with 'sage -gdb' to debug this.
Sage will now terminate.
------------------------------------------------------------------------
```


This seems to be a bug in PolyBori. The patch I propose just checks that the monomial is not constant before calling the polybori function. This is a workaround though

Issue created by migration from https://trac.sagemath.org/ticket/13133





---

archive/issue_comments_156442.json:
```json
{
    "body": "Confirmed, this is a bug of both Sage's interface (it should not call `firstIndex()` in this case) as well as upstream PolyBoRi (it should not crash on inconsistent user commands). The patch solved the problem very well, but you should use `is_one()` instead of `degree()==0`. This performs better (degree() needs to count first).",
    "created_at": "2012-06-19T07:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156442",
    "user": "AlexanderDreyer"
}
```

Confirmed, this is a bug of both Sage's interface (it should not call `firstIndex()` in this case) as well as upstream PolyBoRi (it should not crash on inconsistent user commands). The patch solved the problem very well, but you should use `is_one()` instead of `degree()==0`. This performs better (degree() needs to count first).



---

archive/issue_comments_156443.json:
```json
{
    "body": "I expected the bug to also occur with the zero monomial, and there is no is_constant() method that I could have used. However, the bug does not occur with zero, because \"zero\" is not a monomial : \n\n```\nsage: R(0).lm().parent()\nBoolean PolynomialRing in x, y\nsage: R(1).lm().parent()\nMonomialMonoid of Boolean PolynomialRing in x, y\n```\n\nI wonder if this behavior is the best possible, but it does make sense. Patch updated",
    "created_at": "2012-06-19T07:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156443",
    "user": "Bouillaguet"
}
```

I expected the bug to also occur with the zero monomial, and there is no is_constant() method that I could have used. However, the bug does not occur with zero, because "zero" is not a monomial : 

```
sage: R(0).lm().parent()
Boolean PolynomialRing in x, y
sage: R(1).lm().parent()
MonomialMonoid of Boolean PolynomialRing in x, y
```

I wonder if this behavior is the best possible, but it does make sense. Patch updated



---

archive/issue_comments_156444.json:
```json
{
    "body": "patch fixing the problem (with doctest)",
    "created_at": "2012-06-19T07:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156444",
    "user": "Bouillaguet"
}
```

patch fixing the problem (with doctest)



---

archive/issue_comments_156445.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-19T07:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156445",
    "user": "AlexanderDreyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_156446.json:
```json
{
    "body": "Attachment\n\nReplying to [comment:2 Bouillaguet]:\n> I expected the bug to also occur with the zero monomial, and there is no is_constant() method that I could have used. However, the bug does not occur with zero, because \"zero\" is not a monomial : \nThis is exactly the reason why there is no `is_constant()` routine.\n\n> {{{\n> sage: R(0).lm().parent()\n> Boolean PolynomialRing in x, y\n> sage: R(1).lm().parent()\n> MonomialMonoid of Boolean PolynomialRing in x, y\n> }}}\n> I wonder if this behavior is the best possible, but it does make sense. Patch updated\nThis is the best compromise: PolyBoRi's original interface throws a ValueError when accessing  zero polynomial leading monomials. (As you pointed out, there are no zero monomials.) But this would not be consistent with other polynomial types in Sage (e. g. Singular polynomials used for `QQ[]`). But these return polynomials (not monomials) anyway, so zero is not an issue there.\n\n\nThe patch is fine, I'll give it a positive review and update the pending spkg for PolyBoRi 0.8.2 at #13124 soon.",
    "created_at": "2012-06-19T07:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156446",
    "user": "AlexanderDreyer"
}
```

Attachment

Replying to [comment:2 Bouillaguet]:
> I expected the bug to also occur with the zero monomial, and there is no is_constant() method that I could have used. However, the bug does not occur with zero, because "zero" is not a monomial : 
This is exactly the reason why there is no `is_constant()` routine.

> {{{
> sage: R(0).lm().parent()
> Boolean PolynomialRing in x, y
> sage: R(1).lm().parent()
> MonomialMonoid of Boolean PolynomialRing in x, y
> }}}
> I wonder if this behavior is the best possible, but it does make sense. Patch updated
This is the best compromise: PolyBoRi's original interface throws a ValueError when accessing  zero polynomial leading monomials. (As you pointed out, there are no zero monomials.) But this would not be consistent with other polynomial types in Sage (e. g. Singular polynomials used for `QQ[]`). But these return polynomials (not monomials) anyway, so zero is not an issue there.


The patch is fine, I'll give it a positive review and update the pending spkg for PolyBoRi 0.8.2 at #13124 soon.



---

archive/issue_comments_156447.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-19T07:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156447",
    "user": "AlexanderDreyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_156448.json:
```json
{
    "body": "I also fixed #13124 accordingly. Without your patch, we'd have this then:\n\n```\nsage: R.<x,y> = BooleanPolynomialRing()\nsage: R(1).lm().index()\n2147483647\n```\n\n(final line platform dependent)",
    "created_at": "2012-06-19T08:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156448",
    "user": "AlexanderDreyer"
}
```

I also fixed #13124 accordingly. Without your patch, we'd have this then:

```
sage: R.<x,y> = BooleanPolynomialRing()
sage: R(1).lm().index()
2147483647
```

(final line platform dependent)



---

archive/issue_comments_156449.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-23T21:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12961",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12961#issuecomment-156449",
    "user": "jdemeyer"
}
```

Resolution: fixed
