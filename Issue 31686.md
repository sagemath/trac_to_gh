# Issue 31686: The inverse of the inverse should be self in CoordChange

Issue created by migration from https://trac.sagemath.org/ticket/31923

Original creator: egourgoulhon

Original creation time: 2021-06-07 14:52:16

CC:  tscrim @mjungmath mkoeppe

Keywords: chart, transition_map

When initializing the inverse of a transition map between two charts, either by the method `CoordChange.inverse` (computation of the inverse) or by `CoordChange.set_inverse` (inverse provided by the user), the attribute `_inverse` of `self` is set to the inverse object (for caching). Obviously, by symmetry, the attribute `_inverse` of the inverse should be set to `self`, but it is not. As a consequence, we have in Sage 9.3:

```
sage: E.<x,y> = EuclideanSpace()
sage: cart = E.cartesian_coordinates()
sage: polar = E.polar_coordinates()
sage: polar_to_cart = E.coord_change(polar, cart)
sage: polar_to_cart.display()
x = r*cos(ph)
y = r*sin(ph)
sage: cart_to_polar = E.coord_change(cart, polar)
sage: cart_to_polar.display()
r = sqrt(x^2 + y^2)
ph = arctan2(y, x)
sage: polar_to_cart.inverse() is cart_to_polar
True
```

So far so good, but

```
sage: cart_to_polar.inverse() is polar_to_cart
...
ValueError: no solution found; use set_inverse() to set the inverse manually
}}} 

This is fixed in this ticket by the following one-line addition to the code of `CoordChange.inverse` and `CoordChange.set_inverse`:
{{{
self._inverse._inverse = self
}}}
Besides, this ticket improves a little bit the documentation of `CoordChange.inverse`.



---

Comment by egourgoulhon created at 2021-06-07 14:56:28

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2021-06-07 14:56:28

New commits:


---

Comment by @mjungmath created at 2021-06-07 15:09:15

LGTM.

Green bot => Green light


---

Comment by egourgoulhon created at 2021-06-07 15:28:21

Thank you for this superfast review!


---

Comment by egourgoulhon created at 2021-06-09 18:46:49

Replying to [comment:2 gh-mjungmath]:
> 
> Green bot => Green light

Well, no bot at all... I wonder why no patchbot has visited this ticket after two days. Maybe they are super busy at the moment...


---

Comment by @mjungmath created at 2021-06-10 08:59:19

Mh, indeed. :-/

Maybe you can push the changes into another branch again to trigger the patchbot?


---

Comment by egourgoulhon created at 2021-06-10 12:26:19

Replying to [comment:5 gh-mjungmath]:
> Mh, indeed. :-/
> 
> Maybe you can push the changes into another branch again to trigger the patchbot?

Done. Let's see...


---

Comment by tscrim created at 2021-06-10 12:30:23

IMO, that won't change anything.


---

Comment by egourgoulhon created at 2021-06-10 12:48:30

The ticket appears now at the top of the list at https://patchbot.sagemath.org/, but the order in this list is probably just the last modification time and not the priority for patchbots.


---

Comment by egourgoulhon created at 2021-06-10 20:49:31

Replying to [comment:8 tscrim]:
> IMO, that won't change anything.

You were right, Travis, as always ;-)


---

Comment by slelievre created at 2021-06-11 07:08:35

Patchbots seem to be having a hard time with #31928,
see ticket:31928#comment:1.


---

Comment by egourgoulhon created at 2021-06-13 16:25:07

The patchbot came eventually and is morally green: it reports only one doctest failure in `src/sage/misc/package.py`, which is the issue mentioned by Samuel in comment:11 and is not connected with the current ticket.


---

Comment by egourgoulhon created at 2021-06-17 20:18:14

On behalf of Michael, in view of comment:4 and comment:12.


---

Comment by egourgoulhon created at 2021-06-17 20:18:14

Changing status from needs_review to positive_review.


---

Comment by @mjungmath created at 2021-06-17 20:30:57

Replying to [comment:13 egourgoulhon]:
> On behalf of Michael, in view of comment:4 and comment:12.

thumbs up!


---

Comment by vbraun created at 2021-06-29 17:40:20

Resolution: fixed
