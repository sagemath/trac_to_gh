# Issue 21495: Move runtime documentation python modules into sagelib

archive/issues_021495.json:
```json
{
    "body": "CC:  hivert isuruf fbissey jhpalmieri arojas\n\nThis would make life easier for binary distros. At the moment we (Debian) don't install SAGE_SRC or SAGE_DOC_SRC anywhere, but some (but not all) of the files here are needed at runtime for functionality such as '?'-suffix syntax.\n\nI think it would be cleaner, both for Debian as well as Sage upstream, to move the following files like this:\n\n- src/doc/common/* -> src/sage/doc/common/*\n- src/doc/en/introspect/* -> src/sage/doc/introspect/*\n\nThis would also allow you to remove the sys.path and os.environ hacks that are currently in place everywhere, as well as to remove the `OMIT = [\"introspect\"]` exception in src/sage_setup/docbuild/build_options.py.\n\nDoes this sound sensible? If so I can do this for our Debian packaging already, test it, and send in an initial patch.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21732\n\n",
    "created_at": "2016-10-19T22:00:42Z",
    "labels": [
        "documentation",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Move runtime documentation python modules into sagelib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21495",
    "user": "infinity0"
}
```
CC:  hivert isuruf fbissey jhpalmieri arojas

This would make life easier for binary distros. At the moment we (Debian) don't install SAGE_SRC or SAGE_DOC_SRC anywhere, but some (but not all) of the files here are needed at runtime for functionality such as '?'-suffix syntax.

I think it would be cleaner, both for Debian as well as Sage upstream, to move the following files like this:

- src/doc/common/* -> src/sage/doc/common/*
- src/doc/en/introspect/* -> src/sage/doc/introspect/*

This would also allow you to remove the sys.path and os.environ hacks that are currently in place everywhere, as well as to remove the `OMIT = ["introspect"]` exception in src/sage_setup/docbuild/build_options.py.

Does this sound sensible? If so I can do this for our Debian packaging already, test it, and send in an initial patch.

Issue created by migration from https://trac.sagemath.org/ticket/21732





---

archive/issue_comments_298354.json:
```json
{
    "body": "Putting the documentation as top-level directory of the project is the standard thing to do with Sphinx. We aren't quite using Sphinx in the standard way as there is a lot of Sage customization, but still... I see no reason to be even more different.\n\nJust saying \"it would make our lives easier to do X\" is not a good explanation. You really need to justify better why you want to do X.",
    "created_at": "2016-10-20T06:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298354",
    "user": "jdemeyer"
}
```

Putting the documentation as top-level directory of the project is the standard thing to do with Sphinx. We aren't quite using Sphinx in the standard way as there is a lot of Sage customization, but still... I see no reason to be even more different.

Just saying "it would make our lives easier to do X" is not a good explanation. You really need to justify better why you want to do X.



---

archive/issue_comments_298355.json:
```json
{
    "body": "Why is reducing development cost not a good explanation? None of the files I mentioned are actual direct sphinx config files, they are all meant to be included or used by something else. So they are already not being used in a \"standard Sphinx way\".",
    "created_at": "2016-10-20T07:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298355",
    "user": "infinity0"
}
```

Why is reducing development cost not a good explanation? None of the files I mentioned are actual direct sphinx config files, they are all meant to be included or used by something else. So they are already not being used in a "standard Sphinx way".



---

archive/issue_comments_298356.json:
```json
{
    "body": "Changing the title back because the ticket is not about moving all documentation sources.",
    "created_at": "2016-10-20T07:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298356",
    "user": "infinity0"
}
```

Changing the title back because the ticket is not about moving all documentation sources.



---

archive/issue_comments_298357.json:
```json
{
    "body": "Replying to [comment:2 infinity0]:\n> Why is reducing development cost not a good explanation?\n\nIf you use an argument of the form \"I want X because it helps Y\" and we both agree that Y is a good thing, you still need to explain why X helps with Y. And I am totally missing that.\n\nAnd this title is totally confusing me, I hardly see how it relates to moving `src/doc/common`. It might relate to moving the `introspect` doc, but then the title covers only a part of the ticket.",
    "created_at": "2016-10-20T07:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298357",
    "user": "jdemeyer"
}
```

Replying to [comment:2 infinity0]:
> Why is reducing development cost not a good explanation?

If you use an argument of the form "I want X because it helps Y" and we both agree that Y is a good thing, you still need to explain why X helps with Y. And I am totally missing that.

And this title is totally confusing me, I hardly see how it relates to moving `src/doc/common`. It might relate to moving the `introspect` doc, but then the title covers only a part of the ticket.



---

archive/issue_comments_298358.json:
```json
{
    "body": "It reduces development cost because you no longer have to track SAGE_DOC_SRC in many places and hack it into `sys.path` from `os.environ`. You can just do `from sage.doc.common import conf` or `from sage.doc.introspect import conf`. This helps with tickets like #21495 which is what we ideally need in Debian (but currently need to hack the equivalent functionality in via patches).\n\nIn additional to reducing development cost, this change (or something similar) is *necessary* for binary distributions because we normally don't install things like SAGE_SRC or SAGE_DOC_SRC onto end user machines, yet the files I mentioned are needed at runtime - and only these files, not the other `conf.py` files or doc sources.",
    "created_at": "2016-10-20T07:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298358",
    "user": "infinity0"
}
```

It reduces development cost because you no longer have to track SAGE_DOC_SRC in many places and hack it into `sys.path` from `os.environ`. You can just do `from sage.doc.common import conf` or `from sage.doc.introspect import conf`. This helps with tickets like #21495 which is what we ideally need in Debian (but currently need to hack the equivalent functionality in via patches).

In additional to reducing development cost, this change (or something similar) is *necessary* for binary distributions because we normally don't install things like SAGE_SRC or SAGE_DOC_SRC onto end user machines, yet the files I mentioned are needed at runtime - and only these files, not the other `conf.py` files or doc sources.



---

archive/issue_comments_298359.json:
```json
{
    "body": "\n```\n$ git grep SAGE_DOC_SRC -- src/sage\n[..]\nsrc/sage/misc/sagedoc.py:    sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath\n[..]\nsrc/sage/misc/sphinxify.py:    confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')\n```\n\n\nare the relevant lines.",
    "created_at": "2016-10-20T07:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298359",
    "user": "infinity0"
}
```


```
$ git grep SAGE_DOC_SRC -- src/sage
[..]
src/sage/misc/sagedoc.py:    sys.path = [os.path.join(SAGE_DOC_SRC, 'common')] + oldpath
[..]
src/sage/misc/sphinxify.py:    confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')
```


are the relevant lines.



---

archive/issue_comments_298360.json:
```json
{
    "body": "Replying to [comment:5 infinity0]:\n> It reduces development cost because you no longer have to track SAGE_DOC_SRC in many places and hack it into `sys.path` from `os.environ`. You can just do `from sage.doc.common import conf` or `from sage.doc.introspect import conf`. This helps with tickets like #21495 which is what we ideally need in Debian (but currently need to hack the equivalent functionality in via patches).\n\nThis explanation should be in the ticket description. There is no way I could figure out the above paragraph from just reading the description.",
    "created_at": "2016-10-20T12:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298360",
    "user": "jdemeyer"
}
```

Replying to [comment:5 infinity0]:
> It reduces development cost because you no longer have to track SAGE_DOC_SRC in many places and hack it into `sys.path` from `os.environ`. You can just do `from sage.doc.common import conf` or `from sage.doc.introspect import conf`. This helps with tickets like #21495 which is what we ideally need in Debian (but currently need to hack the equivalent functionality in via patches).

This explanation should be in the ticket description. There is no way I could figure out the above paragraph from just reading the description.



---

archive/issue_comments_298361.json:
```json
{
    "body": "Alright, sorry, I'll take some more time writing future tickets. I've edited the description now, hopefully it's OK.",
    "created_at": "2016-10-20T17:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298361",
    "user": "infinity0"
}
```

Alright, sorry, I'll take some more time writing future tickets. I've edited the description now, hopefully it's OK.



---

archive/issue_comments_298362.json:
```json
{
    "body": "At least I understand the problem now. Still, I don't know the best way to fix it.",
    "created_at": "2016-10-21T13:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298362",
    "user": "jdemeyer"
}
```

At least I understand the problem now. Still, I don't know the best way to fix it.



---

archive/issue_comments_298363.json:
```json
{
    "body": "I agree that sage at runtime should not refer to anything in SAGE_DOC_SRC.\nWhatever is needed from there should be installed in an appropriate place in SAGE_LOCAL.",
    "created_at": "2016-10-23T07:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298363",
    "user": "mkoeppe"
}
```

I agree that sage at runtime should not refer to anything in SAGE_DOC_SRC.
Whatever is needed from there should be installed in an appropriate place in SAGE_LOCAL.



---

archive/issue_comments_298364.json:
```json
{
    "body": "I noticed this recently too--glad to see there's already an issue for it.  I agree, using a location in `SAGE_LOCAL` would be best.",
    "created_at": "2016-12-07T14:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298364",
    "user": "embray"
}
```

I noticed this recently too--glad to see there's already an issue for it.  I agree, using a location in `SAGE_LOCAL` would be best.



---

archive/issue_comments_298365.json:
```json
{
    "body": "I'm starting to agree it would be good if this common doc stuff just went in a `sage.misc.docs` sub-package or something.  As it is common/conf.py imports from sage so it already has a dependency on it anyways.\n\nThis would be a good move toward the previously-discussed ideal of making it easier for third-party packages to use Sage's documentation utilities.\n\nAnother options which I've brought up before is to move all docs-related utilities to a separate sage_documention package (to which `sage_setup.docbuild` would also be moved).  This would necessarily be a runtime dependency of sage for docstring sphinxifying to work.",
    "created_at": "2016-12-12T14:07:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298365",
    "user": "embray"
}
```

I'm starting to agree it would be good if this common doc stuff just went in a `sage.misc.docs` sub-package or something.  As it is common/conf.py imports from sage so it already has a dependency on it anyways.

This would be a good move toward the previously-discussed ideal of making it easier for third-party packages to use Sage's documentation utilities.

Another options which I've brought up before is to move all docs-related utilities to a separate sage_documention package (to which `sage_setup.docbuild` would also be moved).  This would necessarily be a runtime dependency of sage for docstring sphinxifying to work.



---

archive/issue_comments_298366.json:
```json
{
    "body": "I'm working on a possible solution to this, but I believe that any reasonable solution should depend on #22061 at a minimum.",
    "created_at": "2016-12-15T13:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298366",
    "user": "embray"
}
```

I'm working on a possible solution to this, but I believe that any reasonable solution should depend on #22061 at a minimum.



---

archive/issue_comments_298367.json:
```json
{
    "body": "Here's my attempt at solving this.  It included a few other changes that I felt were needed (in addition to #22061), but that are not directly relevant either, so might be worth moving to another ticket.\n\nI don't feel strongly about the choice of `sage.misc.docs`, but I am convinced that these files should be somewhere (for now) in the `sage` package.\n----\nNew commits:",
    "created_at": "2016-12-16T13:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298367",
    "user": "embray"
}
```

Here's my attempt at solving this.  It included a few other changes that I felt were needed (in addition to #22061), but that are not directly relevant either, so might be worth moving to another ticket.

I don't feel strongly about the choice of `sage.misc.docs`, but I am convinced that these files should be somewhere (for now) in the `sage` package.
----
New commits:



---

archive/issue_comments_298368.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-16T13:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298368",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298369.json:
```json
{
    "body": "In here https://git.sagemath.org/sage.git/diff/src/sage/misc/sphinxify.py?id=2983351b1116ed29f08d5fc95c6c11dbcddeec64 and possible some of the other changes, don't we want SAGE_LOCAL instead of SAGE_SRC? (Assuming we don't want to always install SAGE_SRC at runtime.)",
    "created_at": "2016-12-16T23:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298369",
    "user": "infinity0"
}
```

In here https://git.sagemath.org/sage.git/diff/src/sage/misc/sphinxify.py?id=2983351b1116ed29f08d5fc95c6c11dbcddeec64 and possible some of the other changes, don't we want SAGE_LOCAL instead of SAGE_SRC? (Assuming we don't want to always install SAGE_SRC at runtime.)



---

archive/issue_comments_298370.json:
```json
{
    "body": "er, I mean SAGE_LIB instead of SAGE_LOCAL (or SAGE_SRC)",
    "created_at": "2016-12-16T23:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298370",
    "user": "infinity0"
}
```

er, I mean SAGE_LIB instead of SAGE_LOCAL (or SAGE_SRC)



---

archive/issue_comments_298371.json:
```json
{
    "body": "Replying to [comment:17 infinity0]:\n> In here https://git.sagemath.org/sage.git/diff/src/sage/misc/sphinxify.py?id=2983351b1116ed29f08d5fc95c6c11dbcddeec64 and possible some of the other changes, don't we want SAGE_LOCAL instead of SAGE_SRC? (Assuming we don't want to always install SAGE_SRC at runtime.)\n\nYes, this is true.  Actually, I have another branch where I'm trying to improve runtime dependency on SAGE_SRC (or, more specifically, SAGE_SRC is set to the same as SAGE_LIB when not running out of the source tree).\n\nI guess this change is a holdover from that.  But at the same time I did this work as a prerequisite for fixing the other runtime dependencies on SAGE_DOC_SRC and SAGE_SRC, so I guess there's an interdependency between the two.\n\nMaybe, for the sake of making this ticket make sense on its own, I'll bring in some of the changes from my other branch too.",
    "created_at": "2016-12-19T10:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298371",
    "user": "embray"
}
```

Replying to [comment:17 infinity0]:
> In here https://git.sagemath.org/sage.git/diff/src/sage/misc/sphinxify.py?id=2983351b1116ed29f08d5fc95c6c11dbcddeec64 and possible some of the other changes, don't we want SAGE_LOCAL instead of SAGE_SRC? (Assuming we don't want to always install SAGE_SRC at runtime.)

Yes, this is true.  Actually, I have another branch where I'm trying to improve runtime dependency on SAGE_SRC (or, more specifically, SAGE_SRC is set to the same as SAGE_LIB when not running out of the source tree).

I guess this change is a holdover from that.  But at the same time I did this work as a prerequisite for fixing the other runtime dependencies on SAGE_DOC_SRC and SAGE_SRC, so I guess there's an interdependency between the two.

Maybe, for the sake of making this ticket make sense on its own, I'll bring in some of the changes from my other branch too.



---

archive/issue_comments_298372.json:
```json
{
    "body": "See also [sagenb PR 416](https://github.com/sagemath/sagenb/pull/416).  Perhaps an update ticket for that is needed too.",
    "created_at": "2016-12-21T13:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298372",
    "user": "kcrisman"
}
```

See also [sagenb PR 416](https://github.com/sagemath/sagenb/pull/416).  Perhaps an update ticket for that is needed too.



---

archive/issue_comments_298373.json:
```json
{
    "body": "Replying to [comment:20 kcrisman]:\n> See also [sagenb PR 416](https://github.com/sagemath/sagenb/pull/416).  Perhaps an update ticket for that is needed too.\n\nYou mean, to update the sagenb version in the distribution?",
    "created_at": "2016-12-21T14:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298373",
    "user": "embray"
}
```

Replying to [comment:20 kcrisman]:
> See also [sagenb PR 416](https://github.com/sagemath/sagenb/pull/416).  Perhaps an update ticket for that is needed too.

You mean, to update the sagenb version in the distribution?



---

archive/issue_comments_298374.json:
```json
{
    "body": "> > See also [sagenb PR 416](https://github.com/sagemath/sagenb/pull/416).  Perhaps an update ticket for that is needed too.\n> \n> You mean, to update the sagenb version in the distribution?\n\nCorrect.",
    "created_at": "2016-12-21T14:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298374",
    "user": "kcrisman"
}
```

> > See also [sagenb PR 416](https://github.com/sagemath/sagenb/pull/416).  Perhaps an update ticket for that is needed too.
> 
> You mean, to update the sagenb version in the distribution?

Correct.



---

archive/issue_comments_298375.json:
```json
{
    "body": "Another possibility would be to keep a symlink to `sage/misc/docs/introspect` in its old location (`$SAGE_DOC_SRC/en/introspect`).  That would at least preserve backwards-compat, I think.",
    "created_at": "2016-12-21T14:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298375",
    "user": "embray"
}
```

Another possibility would be to keep a symlink to `sage/misc/docs/introspect` in its old location (`$SAGE_DOC_SRC/en/introspect`).  That would at least preserve backwards-compat, I think.



---

archive/issue_comments_298376.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-13T16:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298376",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298377.json:
```json
{
    "body": "Does not merge.",
    "created_at": "2017-03-13T16:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298377",
    "user": "jdemeyer"
}
```

Does not merge.



---

archive/issue_comments_298378.json:
```json
{
    "body": "Changing keywords from \"\" to \"days85\".",
    "created_at": "2017-03-13T16:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298378",
    "user": "jdemeyer"
}
```

Changing keywords from "" to "days85".



---

archive/issue_comments_298379.json:
```json
{
    "body": "I Handled the (trivial) merge.\n\nFlorent\n----\nNew commits:",
    "created_at": "2017-03-13T17:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298379",
    "user": "hivert"
}
```

I Handled the (trivial) merge.

Florent
----
New commits:



---

archive/issue_comments_298380.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-13T17:04:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298380",
    "user": "hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_298381.json:
```json
{
    "body": "needs rebase on 7.6.rc0",
    "created_at": "2017-03-13T19:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298381",
    "user": "chapoton"
}
```

needs rebase on 7.6.rc0



---

archive/issue_comments_298382.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-13T19:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298382",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298383.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-14T16:02:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298383",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298384.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-14T16:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298384",
    "user": "hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_298385.json:
```json
{
    "body": "I've reviewed this patch and it look quite good to me (though I'm not very competent about the necessity of this changes for better packaging in distros). I still have a few remark\n\n- I agree with the comment in the head of commit [1e372a8](https://git.sagemath.org/sage.git/commit/?id=1e372a8e0cd5cab6523f6cafba7698bfa0761a07) that the moving of ``module_list.py`` into ``sage_setup`` should go into another ticket.\n\n- I would have put thing under something like ``sage/doc-conf`` or ``sage/doc-script``. I'm not too happy putting this in misc...\n\n- In `sage_setup/docbuild/__init__.py`, it says:\n  {{{\n  The sphinx subprocesses are configured in conf.py\n  }}}\n  I'd rather put here a comment explaining where to find this `conf.py` and why it was moved there.\n\n- Finally, we should take the opportunity to update `python.inv`.\n\nI'm not sure I'm completely competent to put a positive review here. And I'd rather have someone else looking quickly.",
    "created_at": "2017-03-14T17:12:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298385",
    "user": "hivert"
}
```

I've reviewed this patch and it look quite good to me (though I'm not very competent about the necessity of this changes for better packaging in distros). I still have a few remark

- I agree with the comment in the head of commit [1e372a8](https://git.sagemath.org/sage.git/commit/?id=1e372a8e0cd5cab6523f6cafba7698bfa0761a07) that the moving of ``module_list.py`` into ``sage_setup`` should go into another ticket.

- I would have put thing under something like ``sage/doc-conf`` or ``sage/doc-script``. I'm not too happy putting this in misc...

- In `sage_setup/docbuild/__init__.py`, it says:
  {{{
  The sphinx subprocesses are configured in conf.py
  }}}
  I'd rather put here a comment explaining where to find this `conf.py` and why it was moved there.

- Finally, we should take the opportunity to update `python.inv`.

I'm not sure I'm completely competent to put a positive review here. And I'd rather have someone else looking quickly.



---

archive/issue_comments_298386.json:
```json
{
    "body": "Erik suggested in [This is the Trac macro *comment:19* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:19-macro) that he might make some further tweaks, are these still planned Erik?",
    "created_at": "2017-03-14T17:19:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298386",
    "user": "infinity0"
}
```

Erik suggested in [This is the Trac macro *comment:19* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#comment:19-macro) that he might make some further tweaks, are these still planned Erik?



---

archive/issue_comments_298387.json:
```json
{
    "body": "This is a case of me not even remembering what I was doing 3 months ago, so I'll have to take a bit to remind myself.\n\nI do remember that I was working on the larger task of eliminating any runtime dependencies on `SAGE_SRC` (or, put more accurately, allowing `SAGE_SRC` to point to `site-packages/sage` in some cases).",
    "created_at": "2017-03-14T17:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298387",
    "user": "embray"
}
```

This is a case of me not even remembering what I was doing 3 months ago, so I'll have to take a bit to remind myself.

I do remember that I was working on the larger task of eliminating any runtime dependencies on `SAGE_SRC` (or, put more accurately, allowing `SAGE_SRC` to point to `site-packages/sage` in some cases).



---

archive/issue_comments_298388.json:
```json
{
    "body": "I think I see what I meant now in [comment:19].  It will make more sense if I post a ticket for my other branch with the follow-up work.  I think the question was whether or not to include the one change you mentioned in [comment:17] that doesn't otherwise seem obvious on its own.",
    "created_at": "2017-03-14T17:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298388",
    "user": "embray"
}
```

I think I see what I meant now in [comment:19].  It will make more sense if I post a ticket for my other branch with the follow-up work.  I think the question was whether or not to include the one change you mentioned in [comment:17] that doesn't otherwise seem obvious on its own.



---

archive/issue_comments_298389.json:
```json
{
    "body": "I don't see why this needs to make so much changes to the Sage build system which look unrelated to the documentation. I think those changes should certainly be on a new ticket.",
    "created_at": "2017-03-14T17:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298389",
    "user": "jdemeyer"
}
```

I don't see why this needs to make so much changes to the Sage build system which look unrelated to the documentation. I think those changes should certainly be on a new ticket.



---

archive/issue_comments_298390.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-14T17:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298390",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298391.json:
```json
{
    "body": "And then a bikeshed issue: I would suggest `src/sage/docs` instead of `src/sage/misc/docs`.",
    "created_at": "2017-03-14T17:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298391",
    "user": "jdemeyer"
}
```

And then a bikeshed issue: I would suggest `src/sage/docs` instead of `src/sage/misc/docs`.



---

archive/issue_comments_298392.json:
```json
{
    "body": "hivert wasn't crazy about putting it in `misc.docs` either.  `sage.docs` works for me.",
    "created_at": "2017-03-14T17:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298392",
    "user": "embray"
}
```

hivert wasn't crazy about putting it in `misc.docs` either.  `sage.docs` works for me.



---

archive/issue_comments_298393.json:
```json
{
    "body": "Replying to [comment:35 jdemeyer]:\n> I don't see why this needs to make so much changes to the Sage build system which look unrelated to the documentation. I think those changes should certainly be on a new ticket.\n\nThe other changes are necessary because of the poor way we currently handle non-Python files in packages, and I made some improvements there.  You're right though that it's not directly related; rather it was a prerequisite.  I could create a separate ticket if you prefer and move those changes.  Then this ticket would become dependent on the new ticket.",
    "created_at": "2017-03-14T17:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298393",
    "user": "embray"
}
```

Replying to [comment:35 jdemeyer]:
> I don't see why this needs to make so much changes to the Sage build system which look unrelated to the documentation. I think those changes should certainly be on a new ticket.

The other changes are necessary because of the poor way we currently handle non-Python files in packages, and I made some improvements there.  You're right though that it's not directly related; rather it was a prerequisite.  I could create a separate ticket if you prefer and move those changes.  Then this ticket would become dependent on the new ticket.



---

archive/issue_comments_298394.json:
```json
{
    "body": "Replying to [comment:38 embray]:\n> Replying to [comment:35 jdemeyer]:\n> > I don't see why this needs to make so much changes to the Sage build system which look unrelated to the documentation. I think those changes should certainly be on a new ticket.\n> \n> The other changes are necessary because of the poor way we currently handle non-Python files in packages, and I made some improvements there.\n\nI'm not really convinced that you need to make such big changes (like moving `module_list.py`). But if you do make those changes, I think they should be on a different ticket.",
    "created_at": "2017-03-14T18:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298394",
    "user": "jdemeyer"
}
```

Replying to [comment:38 embray]:
> Replying to [comment:35 jdemeyer]:
> > I don't see why this needs to make so much changes to the Sage build system which look unrelated to the documentation. I think those changes should certainly be on a new ticket.
> 
> The other changes are necessary because of the poor way we currently handle non-Python files in packages, and I made some improvements there.

I'm not really convinced that you need to make such big changes (like moving `module_list.py`). But if you do make those changes, I think they should be on a different ticket.



---

archive/issue_comments_298395.json:
```json
{
    "body": "I am not sure why I wasn't on this ticket before. Off course I suffer from this and my changes are much more minimalistic overall. I have to check more of the stuff to see if it is really useful to sage-on-distro in general. \nNote that moving `module_list.py` makes me scratch my head? Why? Like all the files in the `src` folder it is not actually installed. More consistency? May be. Breaking every sage-on-distro patch against `module_list.py`? Yes. Not difficult to deal with, just annoying.",
    "created_at": "2017-03-14T20:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298395",
    "user": "fbissey"
}
```

I am not sure why I wasn't on this ticket before. Off course I suffer from this and my changes are much more minimalistic overall. I have to check more of the stuff to see if it is really useful to sage-on-distro in general. 
Note that moving `module_list.py` makes me scratch my head? Why? Like all the files in the `src` folder it is not actually installed. More consistency? May be. Breaking every sage-on-distro patch against `module_list.py`? Yes. Not difficult to deal with, just annoying.



---

archive/issue_comments_298396.json:
```json
{
    "body": "Overall I like the changes that pertains to the documentation. Like Jeroen I would prefer the other bits touching setup.py, find.py and so on. I would prefer it being another ticket with a separate rational. If it is necessary I need more info. I can be very stupid that way.\n\nSpeaking of hacks, a related issue that beeped on my radar reading the ticket. We replaced SAGE_DOC_SRC by SAGE_SRC in a few place, including sphinxify.py. Me and probably most of the other distros point SAGE_SRC to SAGE_LIB at runtime. However it is not desirable to point to your sources at runtime. We may need a better mechanism in a follow up ticket.",
    "created_at": "2017-03-15T08:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298396",
    "user": "fbissey"
}
```

Overall I like the changes that pertains to the documentation. Like Jeroen I would prefer the other bits touching setup.py, find.py and so on. I would prefer it being another ticket with a separate rational. If it is necessary I need more info. I can be very stupid that way.

Speaking of hacks, a related issue that beeped on my radar reading the ticket. We replaced SAGE_DOC_SRC by SAGE_SRC in a few place, including sphinxify.py. Me and probably most of the other distros point SAGE_SRC to SAGE_LIB at runtime. However it is not desirable to point to your sources at runtime. We may need a better mechanism in a follow up ticket.



---

archive/issue_comments_298397.json:
```json
{
    "body": "I knew I had forgotten something. There is a lot of stuff in `sage/misc` I think stuff is coherent enough that it could go in `sage/docs` rather than `sage/misc/docs` but I am not going to insist on it if it takes to much time to move things.",
    "created_at": "2017-03-15T09:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298397",
    "user": "fbissey"
}
```

I knew I had forgotten something. There is a lot of stuff in `sage/misc` I think stuff is coherent enough that it could go in `sage/docs` rather than `sage/misc/docs` but I am not going to insist on it if it takes to much time to move things.



---

archive/issue_comments_298398.json:
```json
{
    "body": "Replying to [comment:42 fbissey]:\n> I knew I had forgotten something. There is a lot of stuff in `sage/misc` I think stuff is coherent enough that it could go in `sage/docs` rather than `sage/misc/docs`\n\nI agree but let's do that in a new ticket. There is already too much happening in this ticket. I suggest to move the files from `src/doc` to `src/sage/docs` but to keep the existing doc-related files in `src/sage/misc` for now.",
    "created_at": "2017-03-15T09:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298398",
    "user": "jdemeyer"
}
```

Replying to [comment:42 fbissey]:
> I knew I had forgotten something. There is a lot of stuff in `sage/misc` I think stuff is coherent enough that it could go in `sage/docs` rather than `sage/misc/docs`

I agree but let's do that in a new ticket. There is already too much happening in this ticket. I suggest to move the files from `src/doc` to `src/sage/docs` but to keep the existing doc-related files in `src/sage/misc` for now.



---

archive/issue_comments_298399.json:
```json
{
    "body": "Okay, well, there were definitely good reasons for the other changes, but it was long enough ago now that I don't remember what they all were.  Let me see if I can break it off to a separate ticket where I explain them better.\n\nMoving `module_list.py` *might* not have been necessary, but I don't recall (eventually I think it should go away entirely but that's another subject).",
    "created_at": "2017-03-15T10:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298399",
    "user": "embray"
}
```

Okay, well, there were definitely good reasons for the other changes, but it was long enough ago now that I don't remember what they all were.  Let me see if I can break it off to a separate ticket where I explain them better.

Moving `module_list.py` *might* not have been necessary, but I don't recall (eventually I think it should go away entirely but that's another subject).



---

archive/issue_comments_298400.json:
```json
{
    "body": "jdemeyer: You had mentioned that there was some other work you were doing that this ticket should depend on?  Is there a branch for that posted yet, that I could base on?  Or is mainly just a matter of naming the package in sage `sage.doc` (or is it `sage.docs`)?",
    "created_at": "2017-03-20T12:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298400",
    "user": "embray"
}
```

jdemeyer: You had mentioned that there was some other work you were doing that this ticket should depend on?  Is there a branch for that posted yet, that I could base on?  Or is mainly just a matter of naming the package in sage `sage.doc` (or is it `sage.docs`)?



---

archive/issue_comments_298401.json:
```json
{
    "body": "Replying to [comment:45 embray]:\n> jdemeyer: You had mentioned that there was some other work you were doing that this ticket should depend on?  Is there a branch for that posted yet, that I could base on?  Or is mainly just a matter of naming the package in sage `sage.doc` (or is it `sage.docs`)?\n\nThere is at least #22611, which creates the `sage.docs` directory.\n\nYou should also be aware of #22252 which affects docbuilding. Depending on how well `git` can deal with renames, this will probably not actually conflict.",
    "created_at": "2017-03-20T13:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298401",
    "user": "jdemeyer"
}
```

Replying to [comment:45 embray]:
> jdemeyer: You had mentioned that there was some other work you were doing that this ticket should depend on?  Is there a branch for that posted yet, that I could base on?  Or is mainly just a matter of naming the package in sage `sage.doc` (or is it `sage.docs`)?

There is at least #22611, which creates the `sage.docs` directory.

You should also be aware of #22252 which affects docbuilding. Depending on how well `git` can deal with renames, this will probably not actually conflict.



---

archive/issue_comments_298402.json:
```json
{
    "body": "Right, I think you had mentioned both of those.  Thanks!",
    "created_at": "2017-03-20T14:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298402",
    "user": "embray"
}
```

Right, I think you had mentioned both of those.  Thanks!



---

archive/issue_comments_298403.json:
```json
{
    "body": "New branch for this ticket based on #22655, which separates out the build changes to be considered separately.  This now just makes the code moves suggested in the description of the ticket.\n\nTo be clear, nothing substantive changed in these files except to update some imports, and remove bits of code that were previously needed to manipulate `sys.path`.  Now functions like `sphinxify` can work without `SAGE_DOC_SRC` needing to be installed somewhere on the system.\n----\nNew commits:",
    "created_at": "2017-03-21T09:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298403",
    "user": "embray"
}
```

New branch for this ticket based on #22655, which separates out the build changes to be considered separately.  This now just makes the code moves suggested in the description of the ticket.

To be clear, nothing substantive changed in these files except to update some imports, and remove bits of code that were previously needed to manipulate `sys.path`.  Now functions like `sphinxify` can work without `SAGE_DOC_SRC` needing to be installed somewhere on the system.
----
New commits:



---

archive/issue_comments_298404.json:
```json
{
    "body": "Also, as already noted, this will likely conflict with #22611, but I'm fine waiting for that to be merged first.",
    "created_at": "2017-03-21T09:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298404",
    "user": "embray"
}
```

Also, as already noted, this will likely conflict with #22611, but I'm fine waiting for that to be merged first.



---

archive/issue_comments_298405.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-22T13:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298405",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_298406.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-01T06:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298406",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298407.json:
```json
{
    "body": "does not apply",
    "created_at": "2017-04-01T06:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298407",
    "user": "chapoton"
}
```

does not apply



---

archive/issue_comments_298408.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-11T20:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298408",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_298409.json:
```json
{
    "body": "This ticket appears to be outdated, as #25786 (Fix introspection with ? when doc source is not available) and other tickets seem to have done the described moves. I propose to close this ticket.",
    "created_at": "2020-02-11T20:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298409",
    "user": "mkoeppe"
}
```

This ticket appears to be outdated, as #25786 (Fix introspection with ? when doc source is not available) and other tickets seem to have done the described moves. I propose to close this ticket.



---

archive/issue_comments_298410.json:
```json
{
    "body": "It looks okay to me to close this, but the distro people should take a look.",
    "created_at": "2020-02-11T22:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298410",
    "user": "jhpalmieri"
}
```

It looks okay to me to close this, but the distro people should take a look.



---

archive/issue_comments_298411.json:
```json
{
    "body": "I used to have to move python files in sage-on-gentoo to make the doc work. Not anymore. Although I still copy `doc/common/themes` in place so there may still be something to do. For some reason we seem to produce a lot of cruft and strange things in the doc on distros but that should be a different ticket.",
    "created_at": "2020-02-12T08:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298411",
    "user": "fbissey"
}
```

I used to have to move python files in sage-on-gentoo to make the doc work. Not anymore. Although I still copy `doc/common/themes` in place so there may still be something to do. For some reason we seem to produce a lot of cruft and strange things in the doc on distros but that should be a different ticket.



---

archive/issue_comments_298412.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-12T08:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298412",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_298413.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-02-19T12:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21495",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21495#issuecomment-298413",
    "user": "chapoton"
}
```

Resolution: invalid
