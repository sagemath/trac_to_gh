# Issue 32912: use lazy_string() for string formatting when creating exceptions

archive/issues_032912.json:
```json
{
    "body": "...to avoid eagerly calling costly `_repr_()` methods\n\nIssue created by migration from https://trac.sagemath.org/ticket/33149\n\n",
    "created_at": "2022-01-11T17:35:46Z",
    "labels": [
        "component: performance"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "use lazy_string() for string formatting when creating exceptions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32912",
    "user": "https://github.com/mezzarobba"
}
```
...to avoid eagerly calling costly `_repr_()` methods

Issue created by migration from https://trac.sagemath.org/ticket/33149





---

archive/issue_comments_468887.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-11T17:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468887",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_468888.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-01-11T17:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468888",
    "user": "https://github.com/mezzarobba"
}
```

New commits:



---

archive/issue_events_087584.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-11T18:41:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32912#event-87584"
}
```



---

archive/issue_comments_468889.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-17T10:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_468890.json:
```json
{
    "body": "rebased",
    "created_at": "2022-02-17T10:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468890",
    "user": "https://github.com/mezzarobba"
}
```

rebased



---

archive/issue_comments_468891.json:
```json
{
    "body": "The patchbot says that you have at least the following problem\n\n```\nsage -t --long --random-seed=74790637899039575115911607402196642312 src/sage/geometry/cone.py\n**********************************************************************\nFile \"src/sage/geometry/cone.py\", line 576, in sage.geometry.cone._ambient_space_point\nFailed example:\n    _ambient_space_point(c, vector(AA,[1/2,1/sqrt(3)]))\nException raised:\n    Traceback (most recent call last):\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/geometry/cone.py\", line 606, in try_base_extend\n        return L.base_extend(ring)(data)\n      File \"sage/structure/parent.pyx\", line 897, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9445)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 161, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4729)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 156, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4621)\n        return C._element_constructor(x)\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/modules/free_module.py\", line 5769, in _element_constructor_\n        return FreeModule_generic_field._element_constructor_(self, e, *args, **kwds)\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/modules/free_module.py\", line 1118, in _element_constructor_\n        return self.element_class(self, x, coerce, copy)\n      File \"sage/modules/vector_rational_dense.pyx\", line 151, in sage.modules.vector_rational_dense.Vector_rational_dense.__init__ (build/cythonized/sage/modules/vector_rational_dense.c:3749)\n        z = Rational(x[i])\n      File \"sage/rings/rational.pyx\", line 538, in sage.rings.rational.Rational.__init__ (build/cythonized/sage/rings/rational.cpp:6524)\n        self.__set_value(x, base)\n      File \"sage/rings/rational.pyx\", line 626, in sage.rings.rational.Rational.__set_value (build/cythonized/sage/rings/rational.cpp:7652)\n        set_from_Rational(self, x._rational_())\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/rings/qqbar.py\", line 5618, in _rational_\n        raise ValueError(lazy_string((\"Cannot coerce irrational Algebraic Real %s to Rational\", self)))\n    ValueError: <unprintable ValueError object>\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.cone._ambient_space_point[8]>\", line 1, in <module>\n        _ambient_space_point(c, vector(AA,[Integer(1)/Integer(2),Integer(1)/sqrt(Integer(3))]))\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/geometry/cone.py\", line 628, in _ambient_space_point\n        p = try_base_extend(ring)\n      File \"/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/geometry/cone.py\", line 610, in try_base_extend\n        if str(ex).startswith(\"Cannot coerce\"):\n      File \"sage/misc/lazy_string.pyx\", line 314, in sage.misc.lazy_string._LazyString.__str__ (build/cythonized/sage/misc/lazy_string.c:2632)\n        return str(self.val())\n      File \"sage/misc/lazy_string.pyx\", line 215, in sage.misc.lazy_string._LazyString.val (build/cythonized/sage/misc/lazy_string.c:2163)\n        return PyObject_Call(f, self.args, self.kwargs)\n    TypeError: 'tuple' object is not callable\n**********************************************************************\n```",
    "created_at": "2022-02-19T18:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468891",
    "user": "https://github.com/videlec"
}
```

The patchbot says that you have at least the following problem

```
sage -t --long --random-seed=74790637899039575115911607402196642312 src/sage/geometry/cone.py
**********************************************************************
File "src/sage/geometry/cone.py", line 576, in sage.geometry.cone._ambient_space_point
Failed example:
    _ambient_space_point(c, vector(AA,[1/2,1/sqrt(3)]))
Exception raised:
    Traceback (most recent call last):
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/geometry/cone.py", line 606, in try_base_extend
        return L.base_extend(ring)(data)
      File "sage/structure/parent.pyx", line 897, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9445)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 161, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4729)
        raise
      File "sage/structure/coerce_maps.pyx", line 156, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4621)
        return C._element_constructor(x)
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/modules/free_module.py", line 5769, in _element_constructor_
        return FreeModule_generic_field._element_constructor_(self, e, *args, **kwds)
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/modules/free_module.py", line 1118, in _element_constructor_
        return self.element_class(self, x, coerce, copy)
      File "sage/modules/vector_rational_dense.pyx", line 151, in sage.modules.vector_rational_dense.Vector_rational_dense.__init__ (build/cythonized/sage/modules/vector_rational_dense.c:3749)
        z = Rational(x[i])
      File "sage/rings/rational.pyx", line 538, in sage.rings.rational.Rational.__init__ (build/cythonized/sage/rings/rational.cpp:6524)
        self.__set_value(x, base)
      File "sage/rings/rational.pyx", line 626, in sage.rings.rational.Rational.__set_value (build/cythonized/sage/rings/rational.cpp:7652)
        set_from_Rational(self, x._rational_())
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/rings/qqbar.py", line 5618, in _rational_
        raise ValueError(lazy_string(("Cannot coerce irrational Algebraic Real %s to Rational", self)))
    ValueError: <unprintable ValueError object>

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.cone._ambient_space_point[8]>", line 1, in <module>
        _ambient_space_point(c, vector(AA,[Integer(1)/Integer(2),Integer(1)/sqrt(Integer(3))]))
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/geometry/cone.py", line 628, in _ambient_space_point
        p = try_base_extend(ring)
      File "/amd/compute/sagebot/sage/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/sage/geometry/cone.py", line 610, in try_base_extend
        if str(ex).startswith("Cannot coerce"):
      File "sage/misc/lazy_string.pyx", line 314, in sage.misc.lazy_string._LazyString.__str__ (build/cythonized/sage/misc/lazy_string.c:2632)
        return str(self.val())
      File "sage/misc/lazy_string.pyx", line 215, in sage.misc.lazy_string._LazyString.val (build/cythonized/sage/misc/lazy_string.c:2163)
        return PyObject_Call(f, self.args, self.kwargs)
    TypeError: 'tuple' object is not callable
**********************************************************************
```



---

archive/issue_comments_468892.json:
```json
{
    "body": "Thank you! I wonder how I missed these failures...",
    "created_at": "2022-02-20T11:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468892",
    "user": "https://github.com/mezzarobba"
}
```

Thank you! I wonder how I missed these failures...



---

archive/issue_comments_468893.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-20T11:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_468894.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-20T15:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468894",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_468895.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-21T21:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32912#issuecomment-468895",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_087585.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-21T21:56:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32912",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32912#event-87585"
}
```
