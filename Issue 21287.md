# Issue 21287: configure.ac: Get rid of file descriptor 7 hack

Issue created by migration from https://trac.sagemath.org/ticket/21524

Original creator: mkoeppe

Original creation time: 2016-09-17 23:53:45

build/make/Makefile should be written within an AC_CONFIG_COMMANDS procedure, not at configure time.


---

Comment by jdemeyer created at 2016-09-18 11:13:19

The title "Get rid of file descriptor 7 hack" is different from the description "build/make/Makefile should be written within an AC_CONFIG_COMMANDS procedure". Do you want to fix both things here? Can you please clarify?

And honestly, I think there is nothing wrong with the "file descriptor 7 hack". `autoconf` itself uses similar hacks internally.


---

Comment by mkoeppe created at 2016-09-18 17:37:49

I've updated the title


---

Comment by mkoeppe created at 2016-09-18 20:29:46

I agree, there's nothing wrong with using a file descriptor to write to a file ;)


---

Comment by embray created at 2017-07-19 11:57:17

Does it necessarily need to use `AC_CONFIG_COMMANDS`?  Most of the stuff that writes `build/make/Makefile` could just as easily be moved into its own macro in a separate file in the `m4/` directory.

As I see it the main goal here is to simplify the configure.ac by moving more functionality into separate files.  But moving the existing code into an m4 macro would take less work, and has the advantage that it would have full access to any other variables set in other parts of the `configure` script, without having to explicitly pass them on to an external command.


---

Comment by embray created at 2017-07-19 12:39:48

On second thought, I can see why this way would be better, as it's more in spirit with how configure is supposed to work w.r.t. generating files.  I'll have to give that some more thought.  Maybe there aren't so many variables that need to be passed in.


---

Comment by embray created at 2017-07-20 15:25:56

Changing priority from minor to major.


---

Comment by embray created at 2017-07-20 15:25:56

Here's my proposed solution to this (I updated the ticket to mention `AC_CONFIG_FILE` since that's what this uses).

This adds a `build/make/Makefile.in` template that is used to generated `build/make/Makefile` in `config.status`.  The `configure` script now just collects values for some variables that are inserted into the Makefile template.  I tried to keep as much actual Makefile syntax out of the output variables as possible, sticking mostly to just lists of package names that are operated over.  Most of the rules for building packages are generated by the Makefile itself in `$(eval ...)` loops.  The end result I think is actually cleaner and easier to understand.

If any of this should be controversial, it may be the use of some more advanced GNU make constructs, the portability of which I'm not sure.  This was tested with GNU make 3.81 (about 11 years old), and 4.2.1 (very recent).  That said, it's using some relatively advanced GNU make features that may not be available in other makes.  I think it's still _better_, but if need be more of the Makefile generation could be pushed back into `configure`, but still provided via output variables, instead of writing directly to a file.

Increased the priority since I have other build system work that would likely depend on this, and also because it makes some non-trivial performance improvements, especially on Cygwin.
----
New commits:


---

Comment by embray created at 2017-07-20 15:26:21

Changing status from new to needs_review.


---

Comment by embray created at 2017-09-08 08:14:10

Weird that the patchbot is failing due to Numpy of all things.  I wonder if it has something more to do with the fact that it's building in a temp dir (since this is an "unsafe" ticket) than anything to do with the patch itself, but I'll have to see if I can reproduce...


```
[numpy-1.12.1] Traceback (most recent call last):
[numpy-1.12.1]   File "<stdin>", line 3, in <module>
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/__init__.py", line 142, in <module>
[numpy-1.12.1]     from . import add_newdocs
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/add_newdocs.py", line 13, in <module>
[numpy-1.12.1]     from numpy.lib import add_newdoc
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/lib/__init__.py", line 18, in <module>
[numpy-1.12.1]     from .polynomial import *
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/lib/polynomial.py", line 20, in <module>
[numpy-1.12.1]     from numpy.linalg import eigvals, lstsq, inv
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/__init__.py", line 51, in <module>
[numpy-1.12.1]     from .linalg import *
[numpy-1.12.1]   File "/tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/linalg.py", line 29, in <module>
[numpy-1.12.1]     from numpy.linalg import lapack_lite, _umath_linalg
[numpy-1.12.1] ImportError: /tmp/tmp4YcJD2-sage-git-temp-21524/local/lib/python2.7/site-packages/numpy/linalg/lapack_lite.so: undefined symbol: zungqr_
```



---

Comment by saraedum created at 2018-01-14 01:56:53

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-01-16 17:11:07

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-01-16 17:14:31

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-01-30 11:57:07

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-01-30 15:56:20

Why? This makes the `Makefile` much harder to understand for no obvious benefit...


---

Comment by jdemeyer created at 2018-01-30 16:03:50

Personally, I find this horrible. I highly value the debuggability of an explicit `Makefile`.

Of course, that's a very subjective thing so I'm keeping the needs_review status.


---

Comment by embray created at 2018-01-30 17:25:15

I explained all of this in my e-mail...


---

Comment by jdemeyer created at 2018-01-31 15:01:19

Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.


---

Comment by saraedum created at 2018-01-31 15:01:49

I think the proposed changes are an improvement. I find the proposed setup easier to read, understand, and modify than the previous echos in configure. It also feels closer to the intended way of using autoconf. I am not sure if the resulting Makefile is harder to read, I don't really see why, in any case, I can see why we would like to get rid of the `echo` hack which makes it quite annoying to edit `configure` imho.

Some comments (apart from these minor issues, I would not mind setting this to positive review):

* I might be totally misunderstanding something but the following comment does not actually apply to the `Makefile.in`, does it?

```
+# This file has been automatically generated by
+#   /home/embray/src/sagemath/sage/config.status
+# You should not edit it by hand
```

    I think that some general comment about sage-the-distribution would be nice here and some comment on what transforms this file to which other file.
* I don't really understand the following comment

```
+    # If $need_to_install_{PKG_NAME} is set to no, then set inst_<pkgname> to
+    # some dummy file to skip the installation.
```

    So, I guess `pkgname` and `PKG_NAME` are the same? But where is `inst_<pkgname>` being set below? (Only indirectly in `Makefile.in`, right?)
* I don't see where you are obscuring anything here. (You copied it over and it should probably go into the `.in` file.)

```
+    # Below we have to obscure A""M_V_at, or autoconf would complain:
+    # "error: possibly undefined macro: A""M_V_at"
```

* I would like the `configure.ac` to contain a `#` comment at the top which explains how this all works, in particular how this differs from a standard autoconf/automake setup.


---

Comment by saraedum created at 2018-01-31 15:11:27

I think this should be for followup ticket. It's taken about half a year to get from Erik's commits to somebody reviewing this. If we do a complete rewrite of this, I think this is going to take forever. (Btw, you agreed to fix up #20382 11 months ago. It's easy to get distracted and not move at all…. We should not strive for absolute perfection here but go with improvements that introduce good code. And then get better in the next iteration…)

Replying to [comment:20 jdemeyer]:
> Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.


---

Comment by embray created at 2018-01-31 15:57:55

Replying to [comment:20 jdemeyer]:
> Allow me to reboot this discussion in a hopefully constructive way... what would you think of using some high-level programming like Python to write the `build/make/Makefile`? That would solve the problem that `configure.ac` is a slow mess. On the other hand, we could write actual `Makefile` rules instead of using macros.

It's funny you suggest that.  I've actually been working off-and-on in my spare time on my own Python implementation of make.  It has a name but until I feel ready to post the code it's a secret :-)  It supports POSIX-compatible Makefiles but it also has its own pure-Python format that lets you write make rules in Python, including all the high-level constructs thereof.

In the meantime I don't really see how that would solve anything though.


---

Comment by jdemeyer created at 2018-01-31 16:03:10

Replying to [comment:23 embray]:
> In the meantime I don't really see how that would solve anything though.

It would solve exactly the same issues as the ones that you are fixing in your branch, just in a different way.


---

Comment by jdemeyer created at 2018-01-31 16:04:21

Replying to [comment:23 embray]:
> It's funny you suggest that.  I've actually been working off-and-on in my spare time on my own Python implementation of make.

I would be more interested in the converse: turn any Python `setup.py` into `Makefile` rules.


---

Comment by embray created at 2018-01-31 16:34:12

It would still be much slower just by involving Python.  It would still be an (actual!) abuse of autoconf.


---

Comment by embray created at 2018-01-31 16:51:22

Replying to [comment:21 saraedum]:
> Some comments (apart from these minor issues, I would not mind setting this to positive review):
> 
> * I might be totally misunderstanding something but the following comment does not actually apply to the `Makefile.in`, does it?
> {{{
> +# This file has been automatically generated by
> +#   /home/embray/src/sagemath/sage/config.status
> +# You should not edit it by hand
> }}}

Oops, I'm not sure how that got there since I wrote this six months ago :) It might be that I started from editing a generated file exactly as it says not to do. But let me double-check that `config.status` isn't _actually_ putting that there because that would be a bug, and a bad one at that.

>     I think that some general comment about sage-the-distribution would be nice here and some comment on what transforms this file to which other file.

That would help, though I'm not sure where to put it.  It would be nice to have some documentation about though, as it took me a while to wrap my head around too. It's a bit hard to follow that the top-level `Makefile` calls `build/make/install` which calls `make` again but with `build/make/Makefile`, which in turn calls `sage-spkg` to actually build/install packages.  I don't have too much of a problem with that aspect of the process but it's not obvious.

> * I don't really understand the following comment
> {{{
> +    # If $need_to_install_{PKG_NAME} is set to no, then set inst_<pkgname> to
> +    # some dummy file to skip the installation.
> }}}
>     So, I guess `pkgname` and `PKG_NAME` are the same? But where is `inst_<pkgname>` being set below? (Only indirectly in `Makefile.in`, right?)

Yes, maybe this could be spelled more consistently.

This definitely deserves better documentation (most of how this works is carried over from the existing Makefile--I really didn't change much...)  The actual physical (as in, a real file) targets associate with each package are the "stamp" files installed to `$SAGE_LOCAL/var/lib/sage/installed/<pkg_name>-<pkg_version>`.  Within the Makefile the paths to these files are stored in variables named `$(inst_<pkg_name>)`.

What this is referring to is that for packages which are not actually installed into Sage (e.g. we use the system version), instead of pointing to a real stamp file, the `$(inst_<pkg_name>)` just points to a dummy file indicating "yes, this dependency is satisfied".  This way we don't need to _remove_ that package as a dependency of any other package.  It's just trivially satisfied.

Anyways, I'll see if I can make that comment clearer.

> * I don't see where you are obscuring anything here. (You copied it over and it should probably go into the `.in` file.)
> {{{
> +    # Below we have to obscure A""M_V_at, or autoconf would complain:
> +    # "error: possibly undefined macro: A""M_V_at"
> }}}

Carried over from the original configure.ac.  It's not relevant now anywhere so can just be deleted.

> * I would like the `configure.ac` to contain a `#` comment at the top which explains how this all works, in particular how this differs from a standard autoconf/automake setup.

Okay, maybe that's a decent place to put it...


---

Comment by embray created at 2018-01-31 16:52:13

Changing status from needs_review to needs_work.


---

Comment by mjo created at 2018-01-31 21:39:54

While I agree that the templates are a bit incomprehensible, overall I like this change. The separation between configure.ac and Makefile.in makes it more clear what the build is trying to do, with less of a focus on how it's done. I think that in the future, it will be easier to replace chunks of either file, because we won't have to worry about unintended side effects buried in the shell code.

Other ideas:

1. Our Makefile.in is now GNU-Make-specific. Should we call it GNUMakefile.in to avoid insane errors on systems where "make" isn't GNU?
2. We should detect `SHELL` rather than setting it to /bin/bash, because there are systems where it lives in e.g. /usr/bin/bash (https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)
3. Is Bash needed for the makefile at all? If we replace "source" with ".", does anything else crash with POSIX sh?


---

Comment by jdemeyer created at 2018-02-01 11:49:44

Replying to [comment:27 embray]:
> It would still be much slower just by involving Python.

Why do you think that? It just needs to read of bunch of files and do some string manipulation. It should be easy.

> It would still be an (actual!) abuse of autoconf.

I'm not denying that...

Still, I think it would be fast, work well and produce readable output. So I think that you should at least seriously consider it.


---

Comment by embray created at 2018-02-01 12:29:50

Let's give this a try for now (modulo other review comments). I sympathize with your concerns but I strongly _suspect_ that they will prove overstated.  If it turns into a concrete problem somehow then I'll reconsider.


---

Comment by embray created at 2018-02-01 12:40:45

Replying to [comment:30 mjo]:
> While I agree that the templates are a bit incomprehensible, overall I like this change. The separation between configure.ac and Makefile.in makes it more clear what the build is trying to do, with less of a focus on how it's done. I think that in the future, it will be easier to replace chunks of either file, because we won't have to worry about unintended side effects buried in the shell code.

I'm going to try to do a bit of reformatting to make it a little easier to read.

> Other ideas:
> 
> 1. Our Makefile.in is now GNU-Make-specific. Should we call it GNUMakefile.in to avoid insane errors on systems where "make" isn't GNU?

One thing I'll point out that I haven't explicitly mentioned yet: I asked a few people about this before doing the work (I forget who) but at the time everyone seemed to agree that it would be fine to require GNU make, as there are other packages in Sage that require it, so building the full Sage-the-distribution doesn't work with any other make implementation anyways.

I suppose we could do that though.

> 2. We should detect `SHELL` rather than setting it to /bin/bash, because there are systems where it lives in e.g. /usr/bin/bash (https://www.freedesktop.org/wiki/Software/systemd/TheCaseForTheUsrMerge/)

Right; originally we had ` SHELL = `command -v bash` ` here.  I'll fix that.

> 3. Is Bash needed for the makefile at all? If we replace "source" with ".", does anything else crash with POSIX sh?

I'm not sure it's necessarily strictly needed for the makefile itself, but it in turn calls scripts that require bash, so I don't see any advantage in not just forcing bash in the makefile as well.


---

Comment by embray created at 2018-02-01 13:07:19

One other issue I noticed while working on cleaning this up and adding better debugging tools, is that this doesn't currently handle order-only prerequisites correctly.  This was definitely obscured before, but will be easy to fix.


---

Comment by git created at 2018-02-01 14:18:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-02-01 14:25:43

Last commit made the templates look a bit less noisy.  For example, before:


```
define NORMAL_PACKAGE_templ
$$(INST)/$(1)-$$(vers_$(1)): $$(foreach dep,$$(deps_$(1)),$$(inst_$$(dep)))
	+$(AM_V_at)sage-logger -p '$(SAGE_SPKG) $(1)-$$(vers_$(1))' '$(SAGE_LOGS)/$(1)-$$(vers_$(1)).log'
 
$(1): $$(INST)/$(1)-$$(vers_$(1))
 
$(1)-clean:
	rm -rf $$(INST)/$(1)-$$(vers_$(1))
endef
```


and after:


```
define NORMAL_PACKAGE_templ
$$(INST)/$(1)-$(2): $(3)
	+$(AM_V_at)sage-logger -p '$$(SAGE_SPKG) $(1)-$(2)' '$$(SAGE_LOGS)/$(1)-$(2).log'
 
$(1): $$(INST)/$(1)-$(2)
 
$(1)-clean:
	rm -rf $$(INST)/$(1)-$(2)
endef
```


I also added the `DEBUG_RULES` flag that I mentioned on sage-devel.  If you run the generated makefile in dry-run mode with this flag defined you can see exactly what the templates are outputting:


```
$ make -f build/make/Makefile -n DEBUG_RULES=1
# Rules for standard packages
$(INST)/4ti2-1.6.7:   $(inst_zlib)  $(inst_mpir)  $(inst_glpk)
        +sage-logger -p '$(SAGE_SPKG) 4ti2-1.6.7' '$(SAGE_LOGS)/4ti2-1.6.7.log'

4ti2: $(INST)/4ti2-1.6.7

4ti2-clean:
        rm -rf $(INST)/4ti2-1.6.7

$(INST)/alabaster-0.7.10:   $(inst_python2)  |  $(inst_pip)
        +sage-logger -p '$(SAGE_SPKG) alabaster-0.7.10' '$(SAGE_LOGS)/alabaster-0.7.10.log'
...
```



---

Comment by git created at 2018-02-01 14:39:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-01 15:13:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-01 16:26:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2018-02-01 17:28:38

Replying to [comment:32 embray]:
> I sympathize with your concerns but I strongly _suspect_ that they will prove overstated.

I really hope that you are right and that this won't turn in a "I told you so" scenario.

I'll stop protesting for now. There is not much to discuss further anyway, we each know the other's opinions.


---

Comment by embray created at 2018-02-02 12:32:55

Replying to [comment:40 jdemeyer]:
> Replying to [comment:32 embray]:
> > I sympathize with your concerns but I strongly _suspect_ that they will prove overstated.
> 
> I really hope that you are right and that this won't turn in a "I told you so" scenario.

If it does, I promise that I'll graciously accept that you were right :)


---

Comment by embray created at 2018-02-02 12:33:41

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-02-02 12:33:41

Also, I think that I've addressed most of the other review comments so far....


---

Comment by git created at 2018-02-16 16:33:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-02-16 16:33:40

Rebased to incorporate #24729


---

Comment by git created at 2018-02-19 16:54:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-02-19 16:55:09

Rebased again and incorporated #24703.


---

Comment by chapoton created at 2018-03-03 07:41:10

needs rebase


---

Comment by chapoton created at 2018-03-03 07:41:10

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-03-05 11:05:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-03-05 11:06:16

The longer this stays open the harder it is to keep it maintained because it will conflict with anything that modifies `configure.ac`.


---

Comment by embray created at 2018-03-05 11:06:16

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2018-03-05 12:33:37

Ok. Reviewing this now…


---

Comment by saraedum created at 2018-03-05 12:42:48

Thanks for this very nice summary in the README. If you have checked that this actually works, feel free to set this to positive review.


---

Comment by embray created at 2018-03-06 12:40:11

There's one last change I would like to make, though it shouldn't substantially alter anything.  I just want to move all the stuff that collects the packages into its own macro, and move it to a separate file.

I already did this in another branch, but it doesn't make particular sense to leave out of this ticket.


---

Comment by git created at 2018-03-06 13:05:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-03-06 13:07:34

Will be interesting to see how the buildbots do with this.


---

Comment by embray created at 2018-03-06 13:07:34

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-03-06 14:01:53

Changing status from positive_review to needs_work.


---

Comment by embray created at 2018-03-06 14:01:53

There appears to be a bug in outputting the package versions during the configure checks.  This might have been introduced in my last rebase...


---

Comment by git created at 2018-03-06 14:04:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-03-06 14:05:09

Changing status from needs_work to positive_review.


---

Comment by saraedum created at 2018-03-07 11:14:47

Ok. Your recent changes look good to me.


---

Comment by vbraun created at 2018-03-08 00:02:51

Resolution: fixed


---

Comment by jhpalmieri created at 2018-03-12 18:54:51

This completely breaks upgrading Sage, it seems to me. On three different OS X machines with 8.2.beta7 installed, upgrading to 8.2.beta8, or in particular just using this branch, results in a bad `build/make/Makefile`: lines like

```
deps_4ti2 =  $(SAGE_LOCAL)/bin/gcczlib $(MP_LIBRARY) glpk
deps_alabaster =  $(SAGE_LOCAL)/bin/gcc$(PYTHON) | pip
deps_appnope =  $(SAGE_LOCAL)/bin/gcc$(PYTHON) | pip
```

Please fix this.


---

Comment by embray created at 2018-03-12 19:25:31

Changing status from closed to new.


---

Comment by embray created at 2018-03-12 19:25:31

Resolution changed from fixed to 


---

Comment by embray created at 2018-03-12 19:25:31

Indeed, it looks like a bug introduced upon the last rebase.  I didn't catch it because it only affects if you are using Sage's `gcc` spkg.


---

Comment by embray created at 2018-03-12 19:30:42

Actually it appears the problem might come from #24703 in the first place, since it seems to misplace the space in the `GCC_DEP` variable...


---

Comment by embray created at 2018-03-12 19:31:53

Replying to [comment:62 embray]:
> Actually it appears the problem might come from #24703 in the first place, since it seems to misplace the space in the `GCC_DEP` variable...

I take that back--the missing space is in my code.


---

Comment by embray created at 2018-03-12 19:35:13

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-03-12 19:42:39

Resolution: fixed


---

Comment by jdemeyer created at 2018-03-12 19:42:39

You cannot just re-open a ticket. Only the release manager should do that.


---

Comment by jdemeyer created at 2018-03-12 19:48:47

Especially this ticket must not be re-opened since it has already been released. Just open a new ticket to fix it.


---

Comment by embray created at 2018-03-12 19:49:35

It's not in the latest beta yet.


---

Comment by embray created at 2018-03-12 19:51:38

Oops, apparently it is.  If I had thought otherwise I wouldn't have reopened.  Strange--I just checked too any I didn't see it.


---

Comment by embray created at 2018-03-12 19:54:41

Followup in #24961.


---

Comment by jhpalmieri created at 2018-03-13 02:25:35

Thanks for the quick diagnosis, by the way!


---

Comment by embray created at 2018-03-13 14:39:04

Replying to [comment:70 jhpalmieri]:
> Thanks for the quick diagnosis, by the way!

No, thank you for pointing it out.


---

Comment by jdemeyer created at 2018-03-17 07:35:11

Why is this making changes to `build/pkgs/gcc/spkg-install`? That might have broken building Sage from scratch if GCC is built.


---

Comment by jdemeyer created at 2018-03-17 18:18:54

This might have broken `$(SAGERUNTIME)`: #24995


---

Comment by embray created at 2018-03-21 16:52:39

Replying to [comment:72 jdemeyer]:
> Why is this making changes to `build/pkgs/gcc/spkg-install`? That might have broken building Sage from scratch if GCC is built.

I just noticed this comment.  That was _not_ intentional.  Probably a mis-resolved conflict (though I don't know why since I never made any edits to that file in the first place).


---

Comment by jdemeyer created at 2018-04-17 09:54:06

`DUMMY_PACKAGES` seems broken: #25188


---

Comment by jdemeyer created at 2018-06-08 08:36:08

What was the purpose of this change:

```diff
@@ -58,11 +58,11 @@ all-sage: \
 # option to make forces all targets to be built unconditionally)
 download-for-sdist: base
        env SAGE_INSTALL_FETCH_ONLY=yes $(MAKE) -B SAGERUNTIME= \
-               $(SDIST_PACKAGES)
+               $(SDIST_PACKAGE_INSTS)
 
```


It has broken sdists, see #25319.
