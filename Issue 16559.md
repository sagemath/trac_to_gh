# Issue 16559: OSX App fails on 10.6

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-08-11 12:20:07

CC:  iandrus

From the buildbot (this works on 10.9):

```
Analyze AppController.m
    cd /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app
    setenv LANG en_US.US-ASCII
    /Developer/usr/bin/clang -x objective-c -arch i386 -fmessage-length=0 -pipe -fdiagnostics-print-source-range-info -std=gnu99 -Wno-trigraphs -fpascal-strings -O0 -Wreturn-type -Wunused-variable -fasm-blocks -mfix-and-continue -mmacosx-version-min=10.4 -gdwarf-2 -iquote /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-generated-files.hmap -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-own-target-headers.hmap -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-all-target-headers.hmap -iquote /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-project-headers.hmap -F/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Debug -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Debug/include -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/DerivedSources/i386 -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/DerivedSources -include /var/folders/Sq/SqJYMP6AF4KcJqFvHjeBeU+++VY/-Caches-/com.apple.Xcode.537/SharedPrecompiledHeaders/Sage_Prefix-dokpneuepjvknfdgtpkznyzrxbub/Sage_Prefix.pch --analyze /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m -o /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/StaticAnalyzer/normal/i386/AppController.plist

/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:199:13: error: use of undeclared identifier 'NSModalResponse'
Analyzer skipped this file due to parse errors
             NSModalResponse resp = [alert runModal];
             ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:200:17: error: use of undeclared identifier 'resp'
use of undeclared identifier 'resp'
             if (resp == NSModalResponseOK) {
                 ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:200:25: error: use of undeclared identifier 'NSModalResponseOK'
use of undeclared identifier 'NSModalResponseOK'
             if (resp == NSModalResponseOK) {
                         ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:362:9: error: use of undeclared identifier 'NSModalResponse'
use of undeclared identifier 'NSModalResponse'
         NSModalResponse resp = [alert runModal];
         ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:363:13: error: use of undeclared identifier 'resp'
use of undeclared identifier 'resp'
         if (resp == NSModalResponseOK) {// Quit
             ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:363:21: error: use of undeclared identifier 'NSModalResponseOK'
use of undeclared identifier 'NSModalResponseOK'
         if (resp == NSModalResponseOK) {// Quit
                     ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:366:21: error: use of undeclared identifier 'resp'
use of undeclared identifier 'resp'
         } else if ( resp == NSModalResponseCancel ) { // Continue
                     ^
/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m:366:29: error: use of undeclared identifier 'NSModalResponseCancel'
use of undeclared identifier 'NSModalResponseCancel'
         } else if ( resp == NSModalResponseCancel ) { // Continue
                             ^
8 errors generated.
CompileC build/Sage.build/Debug/Sage.build/Objects-normal/i386/AppDelegate.o AppDelegate.m normal i386 objective-c com.apple.compilers.gcc.4_2
    cd /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app
    setenv LANG en_US.US-ASCII
    /Developer/usr/bin/gcc-4.2 -x objective-c -arch i386 -fmessage-length=0 -pipe -std=gnu99 -Wno-trigraphs -fpascal-strings -fasm-blocks -O0 -Wreturn-type -Wunused-variable -mfix-and-continue -mmacosx-version-min=10.4 -gdwarf-2 -iquote /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-generated-files.hmap -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-own-target-headers.hmap -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-all-target-headers.hmap -iquote /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Sage-project-headers.hmap -F/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Debug -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Debug/include -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/DerivedSources/i386 -I/Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/DerivedSources -include /var/folders/Sq/SqJYMP6AF4KcJqFvHjeBeU+++VY/-Caches-/com.apple.Xcode.537/SharedPrecompiledHeaders/Sage_Prefix-gxeuizjduvirzagieqssinllffch/Sage_Prefix.pch -c /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppDelegate.m -o /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Objects-normal/i386/AppDelegate.o

PhaseScriptExecution "Run Script" build/Sage.build/Debug/Sage.build/Script-1967A8B911D6696A00ABC39D.sh
    cd /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app
    /bin/sh -c /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/build/Sage.build/Debug/Sage.build/Script-1967A8B911D6696A00ABC39D.sh

** BUILD FAILED **


The following build commands failed:
Sage:
	CompileC build/Sage.build/Debug/Sage.build/Objects-normal/i386/AppController.o /Users/buildbot/build/sage/bsd-1/sage_git/build/src/mac-app/AppController.m normal i386 objective-c com.apple.compilers.gcc.4_2
(1 failure)
```



---

Comment by kcrisman created at 2014-08-12 02:34:36

I have an error in building on OS X 10.7 as well.  It's similar but not identical - see [here](http://boxen.math.washington.edu/home/kcrisman/MacAppBuildError.txt).  In particular, it seems to have a slightly better error message about what is wrong.

```
/Users/.../Downloads/sage/src/mac-app/AppController.m:199:13: error: use of undeclared identifier 'NSModalResponse'; did you mean 'NSURLResponse'?
            NSModalResponse resp = [alert runModal];
            ^
```

Looks like [this commit](http://git.sagemath.org/sage.git/commit/?h=eb134581fc1b354948e99e150e6c5fdd63cd9120) is the "problem".  In particular, `NSModalResponse` is ["available in OS X v10.9 and later"](https://developer.apple.com/library/mac/documentation/Cocoa/Reference/ApplicationKit/Classes/NSApplication_Class/Reference/Reference.html#//apple_ref/c/tdef/NSModalResponse).


---

Comment by kcrisman created at 2014-08-12 02:38:00

Clearly a blocker.  If Ivan and/or others can check this out soon enough, maybe we can even release 6.3.1 or something.  I don't know if there is an easy way to replicate this functionality without it, though.  So did no one test this #15732 on anything except Mavericks?   I specifically said that I didn't test it, and assumed someone else did on something else - trust but verify, I guess :(


---

Comment by kcrisman created at 2014-08-12 02:38:00

Changing priority from major to blocker.


---

Comment by iandrus created at 2014-08-12 03:33:46

Changing status from new to needs_review.


---

Comment by iandrus created at 2014-08-12 03:33:46

New commits:


---

Comment by iandrus created at 2014-08-12 03:36:40

Hopefully this fixes it.  Sadly I can't test on anything but Mavericks.


---

Comment by kcrisman created at 2014-08-12 03:46:11

Thanks, I'll try that right now.


---

Comment by kcrisman created at 2014-08-12 05:38:22


```
** BUILD SUCCEEDED **

Copying Sage.app
/Users/.../Downloads/sage/src/bin/sage-bdist: line 106: cd: 6.3: No such file or directory
```

So good news, but I don't understand why this `cd` error is happening.  I suppose I am inside of 6.3 already (`./sage -bdist 6.3` and see `TMP_DIR` in `src/bin/sage-bdist`) but this never happened before.  Anyway, I'm making the dmg "by hand", hopefully all will be well.


---

Comment by kcrisman created at 2014-08-12 05:56:09

Oh, I see.  Yet another not-well-advertised change, and of course with no Trac # in the git log.  Guess I haven't `bdist`ed in a while.

And indeed `SAGE_VERSION` is gotten from elsewhere now.  But NO CHANGES TO THE DOCUMENTATION and even http://sagemath.org/doc/installation/source.html?highlight=bdist still has the old syntax.  **Not acceptable.**


---

Comment by kcrisman created at 2014-08-12 08:59:38

The fix seems to work, modulo my garbled input to `sage -bdist`, and at least on 10.7.  Ivan, it works correctly for 10.9?  Volker, if this also works for you (and I would check that the bdisted app actually runs, just in case - we had some examples of an app that built but didn't run a while back, I think) then this can have positive review.

In which event either I can upload my 10.7 binary or you can bdist one from the buildbot.  I guess we wouldn't really need a big announcement, since this only affects building binaries; in a pinch we could even upload these as 6.3, though I guess 6.3.1 won't really say much to most people.


---

Comment by kcrisman created at 2014-08-14 13:36:50

Hello!  I'm offering a 10.7 binary :-) but I don't want to upload it unless I have to as it might take a while.  If Volker can just quick check on his buildbot as he has time, then this is ready to go, I think.


---

Comment by iandrus created at 2014-08-15 18:14:30

Sorry, I forgot to say that I have tested on 10.9 including `sage -bdist` and things are working.


---

Comment by kcrisman created at 2014-08-20 13:36:28

Sounds like bsd.math is down for a while, so I say this will have to be enough for positive review.  What do you all think?  (I will eventually be able to try on 10.4 but it may be several days, and that has other issues anyway; I don't have access to 10.6.)

[Another take:](http://www.computerworld.com/s/article/9246609/Apple_retires_Snow_Leopard_from_support_leaves_1_in_5_Macs_vulnerable_to_attacks)
> "Let's face it, Apple doesn't go out of their way to ensure users are aware when products are going end of life," said Andrew Storms, director of DevOps at security company CloudPassage, in a December interview.


---

Comment by vbraun created at 2014-08-20 15:01:09

lgtm


---

Comment by vbraun created at 2014-08-20 15:01:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-20 20:21:53

Resolution: fixed
