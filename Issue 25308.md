# Issue 25308: Bug in placing_triangulation in geometry/triangulation/point_configuration.py

archive/issues_025308.json:
```json
{
    "body": "Assignee: @guenterrote\n\nThe method placing_triangulation() accepts\nan optional argument \"point_order\" for specifying the order in which points\nare \"placed\".\nThe function starts by computing a spanning simplex in a greedy way\nby the method \"contained_simplex()\".\nHowever, that auxiliary method \"contained_simplex()\"\nignores the point_order.\nIt might (and often will) compute an initial simplex\nthat is wrong.\n\n(The method \"contained_simplex()\" always includes the last point\nin the order (as given by the points() method) and then\nadds points one by one, trying to get a large volume.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/25545\n\n",
    "closed_at": "2018-09-02T09:37:03Z",
    "created_at": "2018-06-08T15:46:40Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Bug in placing_triangulation in geometry/triangulation/point_configuration.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25308",
    "user": "https://github.com/guenterrote"
}
```
Assignee: @guenterrote

The method placing_triangulation() accepts
an optional argument "point_order" for specifying the order in which points
are "placed".
The function starts by computing a spanning simplex in a greedy way
by the method "contained_simplex()".
However, that auxiliary method "contained_simplex()"
ignores the point_order.
It might (and often will) compute an initial simplex
that is wrong.

(The method "contained_simplex()" always includes the last point
in the order (as given by the points() method) and then
adds points one by one, trying to get a large volume.)

Issue created by migration from https://trac.sagemath.org/ticket/25545





---

archive/issue_comments_356414.json:
```json
{
    "body": "Set assignee to @guenterrote.",
    "created_at": "2018-06-22T19:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356414",
    "user": "https://github.com/guenterrote"
}
```

Set assignee to @guenterrote.



---

archive/issue_comments_356415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-22T20:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356416.json:
```json
{
    "body": "I have added an optional parameter \"point_order\" to the method contained_simplex().\nplacing_triangulation() will use this parameter when a  \"point_order\" is specified\nfor placing_triangulation().\n\n---\nNew commits:",
    "created_at": "2018-06-22T20:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356416",
    "user": "https://github.com/guenterrote"
}
```

I have added an optional parameter "point_order" to the method contained_simplex().
placing_triangulation() will use this parameter when a  "point_order" is specified
for placing_triangulation().

---
New commits:



---

archive/issue_comments_356417.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-22T20:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356417",
    "user": "https://github.com/guenterrote"
}
```

Changing status from new to needs_review.



---

archive/issue_events_064042.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-07-31T23:40:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25308#event-64042"
}
```



---

archive/issue_comments_356418.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-31T23:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356418",
    "user": "https://github.com/bryangingechen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_356419.json:
```json
{
    "body": "`sage -t src/sage/geometry/triangulation/point_configuration.py` is giving me 15 failed tests. See also the patchbot. Here are some more minor comments.\n\nFirst, regarding `contained_simplex()`:\n- The algorithm can be made slightly more efficient by reversing `points` when it is constructed (one-time cost of `O(N)` time, where `N = len(points)`; in fact, this only needs to be done if `point_order` is used) and then using `pop()` inside the `while` loop (`O(1)` time called `dim` times). The current implementation with `pop(0)` inside the `while` loop will take `O(N*dim`) time. Granted, I haven't benchmarked, and I don't know if anyone uses this function on large enough point configurations that this will matter, so I defer to your judgment on this.\n- `if len(points)==0` and `if len(edges)>0 and ...` can be written in a more \"pythonic\" way as `if not points` and `if edges and ...`, respectively.\n\nIn `placing_triangulation()`:\n- The two `assert` statements should be replaced with more helpful error messages.\n- There is some extra whitespace inside some of the brackets. See https://www.python.org/dev/peps/pep-0008/#pet-peeves",
    "created_at": "2018-07-31T23:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356419",
    "user": "https://github.com/bryangingechen"
}
```

`sage -t src/sage/geometry/triangulation/point_configuration.py` is giving me 15 failed tests. See also the patchbot. Here are some more minor comments.

First, regarding `contained_simplex()`:
- The algorithm can be made slightly more efficient by reversing `points` when it is constructed (one-time cost of `O(N)` time, where `N = len(points)`; in fact, this only needs to be done if `point_order` is used) and then using `pop()` inside the `while` loop (`O(1)` time called `dim` times). The current implementation with `pop(0)` inside the `while` loop will take `O(N*dim`) time. Granted, I haven't benchmarked, and I don't know if anyone uses this function on large enough point configurations that this will matter, so I defer to your judgment on this.
- `if len(points)==0` and `if len(edges)>0 and ...` can be written in a more "pythonic" way as `if not points` and `if edges and ...`, respectively.

In `placing_triangulation()`:
- The two `assert` statements should be replaced with more helpful error messages.
- There is some extra whitespace inside some of the brackets. See https://www.python.org/dev/peps/pep-0008/#pet-peeves



---

archive/issue_comments_356420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-27T20:29:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356420",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356421.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-27T20:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356421",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356422.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-27T20:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356422",
    "user": "https://github.com/guenterrote"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_356423.json:
```json
{
    "body": "I changed back from pop(0) to pop(), as suggested, which, incidentally, fixed many\nof the test examples. I only had to modify a few of them.\n\nI also added an error message to the assert statement. (I also removed another\nassert statement that I had added, because I understood that it is\nredundant after the first assert statement)",
    "created_at": "2018-08-27T20:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356423",
    "user": "https://github.com/guenterrote"
}
```

I changed back from pop(0) to pop(), as suggested, which, incidentally, fixed many
of the test examples. I only had to modify a few of them.

I also added an error message to the assert statement. (I also removed another
assert statement that I had added, because I understood that it is
redundant after the first assert statement)



---

archive/issue_comments_356424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-27T21:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356425.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2018-08-31T23:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356425",
    "user": "https://github.com/bryangingechen"
}
```

Looks good to me!



---

archive/issue_comments_356426.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-31T23:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356426",
    "user": "https://github.com/bryangingechen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_064043.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-02T09:37:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25308#event-64043"
}
```



---

archive/issue_comments_356427.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-02T09:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25308",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25308#issuecomment-356427",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
