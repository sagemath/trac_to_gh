# Issue 28189: With Python 3 build, do not install python2

Issue created by migration from https://trac.sagemath.org/ticket/28426

Original creator: jhpalmieri

Original creation time: 2019-08-29 21:57:37

CC:  jdemeyer chapoton embray fbissey slelievre arojas isuruf

When Sage is built with Python 3, there is no need to build Python 2, so let's skip it.


---

Comment by jhpalmieri created at 2019-08-29 22:00:37

With this branch and a Python 3 build, I get two new doctest failures:

```
sage -t --warn-long 60.3 src/sage/doctest/control.py
**********************************************************************
File "src/sage/doctest/control.py", line 630, in sage.doctest.control.DocTestController.test_safe_directory
Failed example:
    DC.test_safe_directory(d)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: refusing to run doctests...
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   9 in sage.doctest.control.DocTestController.test_safe_directory
    [204 tests, 1 failure, 4.24 s]
sage -t --warn-long 60.3 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 412, in sage.tests.cmdline.test_executable
Failed example:
    print(err)
Expected:
    ...
    RuntimeError: refusing to run doctests...
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/tests/cmdline.py", line 416, in sage.tests.cmdline.test_executable
Failed example:
    print(err)
Expected:
    ...
    RuntimeError: refusing to run doctests...
Got:
    <BLANKLINE>
**********************************************************************
1 item had failures:
   2 of 245 in sage.tests.cmdline.test_executable
    [244 tests, 2 failures, 69.42 s]
----------------------------------------------------------------------
sage -t --warn-long 60.3 src/sage/doctest/control.py  # 1 doctest failed
sage -t --warn-long 60.3 src/sage/tests/cmdline.py  # 2 doctests failed
----------------------------------------------------------------------
```

Should these be marked `# py2`?
----
New commits:


---

Comment by chapoton created at 2019-08-31 08:25:28

see the discussion in #27529 about the same failing doctests


---

Comment by jhpalmieri created at 2019-08-31 16:57:08

Replying to [comment:4 chapoton]:
> see the discussion in #27529 about the same failing doctests

One [comment there](https://trac.sagemath.org/ticket/27529#comment:25) was that if `python` is `python3`, then the tests would work. I just created a symlink `python -> python3` here, and the tests still fail. I think either marking the tests as `py2`, or removing them (#26457) would be good. Or would #25358 help?


---

Comment by chapoton created at 2019-09-01 07:01:17

Let us just tag them with #py2.


---

Comment by git created at 2019-09-03 17:43:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2019-09-03 19:22:28

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-09-03 19:22:28

Okay, ready for review.


---

Comment by chapoton created at 2019-09-10 14:38:03

This looks good to me. I would like to have more opinions from experts, in particular people packaging sage for various Linux distributions.

And this will have to wait for 9.0.beta1, I think.


---

Comment by embray created at 2019-09-18 11:26:12

I agree this should wait for 9.0 at the earliest, but +1 in principle.  No reason to burden people with two Pythons.


---

Comment by chapoton created at 2019-09-18 15:21:01

So can we switch to positive review ? No packager did react.


---

Comment by DavidLowry created at 2019-09-19 18:31:06

For what it's worth, this also looks good to me and works on a minimal arch setup and an ubuntu 19.04 setup.


---

Comment by chapoton created at 2019-09-24 19:03:08

I am setting to positive, for entry in 9.0.beta0


---

Comment by chapoton created at 2019-09-24 19:03:08

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2019-09-26 16:48:04

I'm wondering about a followup ticket, but I don't know if this would be a good idea: currently, the script `sage-python23` checks for the value of `SAGE_PYTHON3` to decide which version of Python to run, and the same is true when running `sage --python`. Should we (a) actively delete `local/bin/python` when building with Python 3 (relevant in the case of updating existing installations of Sage), and then (b) have `sage-python23` and `sage --python` run `SAGE_LOCAL/bin/python` if if exists, `SAGE_LOCAL/bin/python3` otherwise? Is it good to not depend on the environment variable `SAGE_PYTHON3`?

If we ever hope to use a system version of Python, I guess this would be a bad idea.


---

Comment by vbraun created at 2019-10-03 17:57:53

Resolution: fixed
