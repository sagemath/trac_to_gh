# Issue 24234: Don't put non-built Cython extensions in sage_build_cython.extensions

Issue created by migration from https://trac.sagemath.org/ticket/24471

Original creator: jdemeyer

Original creation time: 2018-01-04 13:11:24

CC:  embray

The `OptionalExtension` mechanism (see `src/sage_setup/optional_extension.py`) allows for Cython modules to be cythonized but not compiled by distutils (by some logic in the `sage_build_ext` build command).

Instead of just skipping the build of those extensions, they should really never be added to `ext_modules` in the first place. This affects `clean_install_dir` because optional-but-non-built extensions should not be importable.


---

Comment by jdemeyer created at 2018-01-04 13:21:20

New commits:


---

Comment by jdemeyer created at 2018-01-04 13:21:20

Changing status from new to needs_review.


---

Comment by embray created at 2018-01-05 12:29:28

Makes sense to me.  It might be nice to have a test for this but that would involve adding more tests for `sage_setup` in general--something I know we've been meaning to do for a while.


---

Comment by jdemeyer created at 2018-01-05 12:54:02

Replying to [comment:5 embray]:
> It might be nice to have a test for this but that would involve adding more tests for `sage_setup` in general

The problem is that it's not really possible to test `sage_setup` without `setup.py`. So that would require that most logic of `setup.py` would be moved to the `sage_setup` module such that it can be imported for testing. I agree that this makes sense, but not for this ticket.


---

Comment by embray created at 2018-01-05 13:22:58

Yep.


---

Comment by embray created at 2018-01-05 13:22:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-01-13 11:52:15

Resolution: fixed
