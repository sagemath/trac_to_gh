# Issue 16478: Remove "nonbreaking spaces" from .rst files

Issue created by migration from https://trac.sagemath.org/ticket/16715

Original creator: strogdon

Original creation time: 2014-07-25 16:28:53

CC:  fbissey

For reference see sage-devel comment:

https://groups.google.com/forum/#!topic/sage-devel/W-fPceNbp0w

Certain .rst files (src/doc/fr/tour_coercion.rst in particular) contain nonbreaking spaces that can cause docutils to fail when generating html docs. Failures are known to be present with docutils-0.11. An octal dump (od -c) of tour_coercion.rst reveals the spaces:

```
0013340   n   n   e   a   u   ,       e   l   l   e   s       n   e    
0013360   s   o   n   t       p   a   s       d   e       t   y   p   e
0013400       `   `   R   i   n   g   E   l   e   m   e   n   t   `   `
0013420 302 240   :  \n  \n   :   :  \n  \n                   s   a   g
0013440   e   :       M       =       M   a   t   r   i   x   (   Z   Z
0013460   ,   2   ,   2   )   ;       M  \n                   [   0    
0013500   0   ]  \n                   [   0       0   ]  \n            
0013520       s   a   g   e   :       i   s   i   n   s   t   a   n   c
```


The 302 is octal for a "circumflex capital A" and the 240 is octal for a "nonbreaking space" and it is these characters that cause docutils-0.11 to fail. With docutils-0.11 the failure presents as

```
$ rst2html.py src/doc/fr/tutorial/tour_coercion.rst > /dev/null
src/doc/fr/tutorial/tour_coercion.rst:149: (WARNING/2) Inline literal start-string without end-string.
```

From a unicode compliant terminal line 149 starts as

```
Le type ``RingElement`` ne correspond pas parfaitement à la notion
mathématique d'élément d'anneau. Par exemple, bien que les matrices carrées
appartiennent à un anneau, elles ne sont pas de type ``RingElement`` :
```

where the nonbreaking space appears between the ```` and `:`.


---

Comment by strogdon created at 2014-07-25 16:33:21

I'm not sure how pervasive these spaces are nor am I certain of the best way to remove them? These spaces appear to be present at other places in `src/doc/fr/tutorial/tour_coercion.rst` and are probably only an issue with non-English .rst files.


---

Comment by strogdon created at 2014-07-25 18:05:55

Changing component from PLEASE CHANGE to documentation.


---

Comment by chapoton created at 2014-07-25 19:12:29

Here is a way to see them all:

```
grep --color='auto' -P -n "\xA0" *.rst
```



---

Comment by fbissey created at 2014-07-25 20:21:12

Replying to [comment:4 chapoton]:
> Here is a way to see them all:
> {{{
> grep --color='auto' -P -n "\xA0" *.rst
> }}}
> 
Bonus points if you have a sed comand that would get rid of them.


---

Comment by chapoton created at 2014-07-25 20:24:14

found something here :

http://lifehacker.com/5810026/quickly-find-and-replace-text-across-multiple-documents-via-the-command-line

namely

```
perl -pi -w -e 's/SEARCH_FOR/REPLACE_WITH/g;' *.rst
```

The following seems to work very well :

```
perl -pi -w -e 's/\xC2\xA0/ /g;' *.rst
```



---

Comment by fbissey created at 2014-07-25 20:26:30

I will try later.


---

Comment by vbraun created at 2014-07-25 22:41:07

Note that the files are UTF-8 encoded. Hence the U+00A0 codepoint is encoded in a 3-byte sequence.


---

Comment by chapoton created at 2014-07-26 11:56:39

Hello,

I did the search-and-replace in all the French documentation. It looks ok, I think.

Should it be done on the other languages also ?
----
New commits:


---

Comment by strogdon created at 2014-07-26 12:59:35

Before I check things did you try, for example,

```
rst2html.py src/doc/fr/tutorial/tour_coercion.rst > out.html
```

to see if there are any WARNINGS and then load out.html in a browser to see if it appears consistent? I could have done something wrong here but when I remove just the nonbreaking spaces I'm left with a file that is not utf-8.


---

Comment by strogdon created at 2014-07-26 13:14:55

Of course there will not be WARNINGS if the rst2html.py that's shipped with vanilla Sage is used. I will try to test later today.


---

Comment by strogdon created at 2014-07-26 13:33:18

I've fetched things locally and the files look really good. But I'll test later today.


---

Comment by strogdon created at 2014-07-27 18:08:10

Everything seems fine here. And the WARNING disappears when building against docutils-0.11 (sage-on-gentoo). I see, if I've done things correctly, only two other .rst files where the space occurs. They are

```
ru/tutorial/index.rst:7:Sage — это бесплатное и свободно распространяемое математическое программное
ru/tutorial/introduction.rst:5:Данное учебное пособие — лучший способ познакомиться с Sage за несколько
```

I can see the spaces in these files and the above perl script does remove them. I think it would be good to replace these files as well.

Are there any thoughts on how to prevent this sort of thing in the future? Or does one just deal with it whenever it interferes with building the html docs?


---

Comment by git created at 2014-07-27 19:10:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-07-27 19:14:13

I have taken care of the russian case. :)

I do not know how to prevent this in the future. There is already a patchbot plugin which warns when a new unicode character is introduced, but it does not tell whether this is the "unbreakable space" or something else like "éàùèö".


---

Comment by strogdon created at 2014-07-27 20:25:51

Changing status from new to needs_review.


---

Comment by strogdon created at 2014-07-27 20:27:07

I believe this fixes things.


---

Comment by strogdon created at 2014-07-27 20:27:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-07-28 14:10:00

Resolution: fixed
