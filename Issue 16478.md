# Issue 16478: Remove "nonbreaking spaces" from .rst files

archive/issues_016478.json:
```json
{
    "body": "CC:  @kiwifb\n\nFor reference see sage-devel comment:\n\nhttps://groups.google.com/forum/#!topic/sage-devel/W-fPceNbp0w\n\nCertain .rst files (src/doc/fr/tour_coercion.rst in particular) contain nonbreaking spaces that can cause docutils to fail when generating html docs. Failures are known to be present with docutils-0.11. An octal dump (od -c) of tour_coercion.rst reveals the spaces:\n\n```\n0013340   n   n   e   a   u   ,       e   l   l   e   s       n   e    \n0013360   s   o   n   t       p   a   s       d   e       t   y   p   e\n0013400       `   `   R   i   n   g   E   l   e   m   e   n   t   `   `\n0013420 302 240   :  \\n  \\n   :   :  \\n  \\n                   s   a   g\n0013440   e   :       M       =       M   a   t   r   i   x   (   Z   Z\n0013460   ,   2   ,   2   )   ;       M  \\n                   [   0    \n0013500   0   ]  \\n                   [   0       0   ]  \\n            \n0013520       s   a   g   e   :       i   s   i   n   s   t   a   n   c\n```\n\n\nThe 302 is octal for a \"circumflex capital A\" and the 240 is octal for a \"nonbreaking space\" and it is these characters that cause docutils-0.11 to fail. With docutils-0.11 the failure presents as\n\n```\n$ rst2html.py src/doc/fr/tutorial/tour_coercion.rst > /dev/null\nsrc/doc/fr/tutorial/tour_coercion.rst:149: (WARNING/2) Inline literal start-string without end-string.\n```\n\nFrom a unicode compliant terminal line 149 starts as\n\n```\nLe type ``RingElement`` ne correspond pas parfaitement \u00e0 la notion\nmath\u00e9matique d'\u00e9l\u00e9ment d'anneau. Par exemple, bien que les matrices carr\u00e9es\nappartiennent \u00e0 un anneau, elles ne sont pas de type ``RingElement``\u00a0:\n```\n\nwhere the nonbreaking space appears between the ```` and `:`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16715\n\n",
    "created_at": "2014-07-25T16:28:53Z",
    "labels": [
        "component: please change",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Remove \"nonbreaking spaces\" from .rst files",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16478",
    "user": "https://github.com/strogdon"
}
```
CC:  @kiwifb

For reference see sage-devel comment:

https://groups.google.com/forum/#!topic/sage-devel/W-fPceNbp0w

Certain .rst files (src/doc/fr/tour_coercion.rst in particular) contain nonbreaking spaces that can cause docutils to fail when generating html docs. Failures are known to be present with docutils-0.11. An octal dump (od -c) of tour_coercion.rst reveals the spaces:

```
0013340   n   n   e   a   u   ,       e   l   l   e   s       n   e    
0013360   s   o   n   t       p   a   s       d   e       t   y   p   e
0013400       `   `   R   i   n   g   E   l   e   m   e   n   t   `   `
0013420 302 240   :  \n  \n   :   :  \n  \n                   s   a   g
0013440   e   :       M       =       M   a   t   r   i   x   (   Z   Z
0013460   ,   2   ,   2   )   ;       M  \n                   [   0    
0013500   0   ]  \n                   [   0       0   ]  \n            
0013520       s   a   g   e   :       i   s   i   n   s   t   a   n   c
```


The 302 is octal for a "circumflex capital A" and the 240 is octal for a "nonbreaking space" and it is these characters that cause docutils-0.11 to fail. With docutils-0.11 the failure presents as

```
$ rst2html.py src/doc/fr/tutorial/tour_coercion.rst > /dev/null
src/doc/fr/tutorial/tour_coercion.rst:149: (WARNING/2) Inline literal start-string without end-string.
```

From a unicode compliant terminal line 149 starts as

```
Le type ``RingElement`` ne correspond pas parfaitement à la notion
mathématique d'élément d'anneau. Par exemple, bien que les matrices carrées
appartiennent à un anneau, elles ne sont pas de type ``RingElement`` :
```

where the nonbreaking space appears between the ```` and `:`.

Issue created by migration from https://trac.sagemath.org/ticket/16715





---

archive/issue_comments_216411.json:
```json
{
    "body": "I'm not sure how pervasive these spaces are nor am I certain of the best way to remove them? These spaces appear to be present at other places in `src/doc/fr/tutorial/tour_coercion.rst` and are probably only an issue with non-English .rst files.",
    "created_at": "2014-07-25T16:33:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216411",
    "user": "https://github.com/strogdon"
}
```

I'm not sure how pervasive these spaces are nor am I certain of the best way to remove them? These spaces appear to be present at other places in `src/doc/fr/tutorial/tour_coercion.rst` and are probably only an issue with non-English .rst files.



---

archive/issue_comments_216412.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to documentation.",
    "created_at": "2014-07-25T18:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216412",
    "user": "https://github.com/strogdon"
}
```

Changing component from PLEASE CHANGE to documentation.



---

archive/issue_comments_216413.json:
```json
{
    "body": "Here is a way to see them all:\n\n```\ngrep --color='auto' -P -n \"\\xA0\" *.rst\n```\n",
    "created_at": "2014-07-25T19:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216413",
    "user": "https://github.com/fchapoton"
}
```

Here is a way to see them all:

```
grep --color='auto' -P -n "\xA0" *.rst
```




---

archive/issue_comments_216414.json:
```json
{
    "body": "Replying to [comment:4 chapoton]:\n> Here is a way to see them all:\n> {{{\n> grep --color='auto' -P -n \"\\xA0\" *.rst\n> }}}\n> \nBonus points if you have a sed comand that would get rid of them.",
    "created_at": "2014-07-25T20:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216414",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:4 chapoton]:
> Here is a way to see them all:
> {{{
> grep --color='auto' -P -n "\xA0" *.rst
> }}}
> 
Bonus points if you have a sed comand that would get rid of them.



---

archive/issue_comments_216415.json:
```json
{
    "body": "found something here :\n\nhttp://lifehacker.com/5810026/quickly-find-and-replace-text-across-multiple-documents-via-the-command-line\n\nnamely\n\n```\nperl -pi -w -e 's/SEARCH_FOR/REPLACE_WITH/g;' *.rst\n```\n\nThe following seems to work very well :\n\n```\nperl -pi -w -e 's/\\xC2\\xA0/ /g;' *.rst\n```\n",
    "created_at": "2014-07-25T20:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216415",
    "user": "https://github.com/fchapoton"
}
```

found something here :

http://lifehacker.com/5810026/quickly-find-and-replace-text-across-multiple-documents-via-the-command-line

namely

```
perl -pi -w -e 's/SEARCH_FOR/REPLACE_WITH/g;' *.rst
```

The following seems to work very well :

```
perl -pi -w -e 's/\xC2\xA0/ /g;' *.rst
```




---

archive/issue_comments_216416.json:
```json
{
    "body": "I will try later.",
    "created_at": "2014-07-25T20:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216416",
    "user": "https://github.com/kiwifb"
}
```

I will try later.



---

archive/issue_comments_216417.json:
```json
{
    "body": "Note that the files are UTF-8 encoded. Hence the U+00A0 codepoint is encoded in a 3-byte sequence.",
    "created_at": "2014-07-25T22:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216417",
    "user": "https://github.com/vbraun"
}
```

Note that the files are UTF-8 encoded. Hence the U+00A0 codepoint is encoded in a 3-byte sequence.



---

archive/issue_comments_216418.json:
```json
{
    "body": "Hello,\n\nI did the search-and-replace in all the French documentation. It looks ok, I think.\n\nShould it be done on the other languages also ?\n----\nNew commits:",
    "created_at": "2014-07-26T11:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216418",
    "user": "https://github.com/fchapoton"
}
```

Hello,

I did the search-and-replace in all the French documentation. It looks ok, I think.

Should it be done on the other languages also ?
----
New commits:



---

archive/issue_comments_216419.json:
```json
{
    "body": "Before I check things did you try, for example,\n\n```\nrst2html.py src/doc/fr/tutorial/tour_coercion.rst > out.html\n```\n\nto see if there are any WARNINGS and then load out.html in a browser to see if it appears consistent? I could have done something wrong here but when I remove just the nonbreaking spaces I'm left with a file that is not utf-8.",
    "created_at": "2014-07-26T12:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216419",
    "user": "https://github.com/strogdon"
}
```

Before I check things did you try, for example,

```
rst2html.py src/doc/fr/tutorial/tour_coercion.rst > out.html
```

to see if there are any WARNINGS and then load out.html in a browser to see if it appears consistent? I could have done something wrong here but when I remove just the nonbreaking spaces I'm left with a file that is not utf-8.



---

archive/issue_comments_216420.json:
```json
{
    "body": "Of course there will not be WARNINGS if the rst2html.py that's shipped with vanilla Sage is used. I will try to test later today.",
    "created_at": "2014-07-26T13:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216420",
    "user": "https://github.com/strogdon"
}
```

Of course there will not be WARNINGS if the rst2html.py that's shipped with vanilla Sage is used. I will try to test later today.



---

archive/issue_comments_216421.json:
```json
{
    "body": "I've fetched things locally and the files look really good. But I'll test later today.",
    "created_at": "2014-07-26T13:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216421",
    "user": "https://github.com/strogdon"
}
```

I've fetched things locally and the files look really good. But I'll test later today.



---

archive/issue_comments_216422.json:
```json
{
    "body": "Everything seems fine here. And the WARNING disappears when building against docutils-0.11 (sage-on-gentoo). I see, if I've done things correctly, only two other .rst files where the space occurs. They are\n\n```\nru/tutorial/index.rst:7:Sage\u00a0\u2014 \u044d\u0442\u043e \u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e\u0435 \u0438 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u043e \u0440\u0430\u0441\u043f\u0440\u043e\u0441\u0442\u0440\u0430\u043d\u044f\u0435\u043c\u043e\u0435 \u043c\u0430\u0442\u0435\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u043e\u0433\u0440\u0430\u043c\u043c\u043d\u043e\u0435\nru/tutorial/introduction.rst:5:\u0414\u0430\u043d\u043d\u043e\u0435 \u0443\u0447\u0435\u0431\u043d\u043e\u0435 \u043f\u043e\u0441\u043e\u0431\u0438\u0435\u00a0\u2014 \u043b\u0443\u0447\u0448\u0438\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u043f\u043e\u0437\u043d\u0430\u043a\u043e\u043c\u0438\u0442\u044c\u0441\u044f \u0441 Sage \u0437\u0430 \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e\n```\n\nI can see the spaces in these files and the above perl script does remove them. I think it would be good to replace these files as well.\n\nAre there any thoughts on how to prevent this sort of thing in the future? Or does one just deal with it whenever it interferes with building the html docs?",
    "created_at": "2014-07-27T18:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216422",
    "user": "https://github.com/strogdon"
}
```

Everything seems fine here. And the WARNING disappears when building against docutils-0.11 (sage-on-gentoo). I see, if I've done things correctly, only two other .rst files where the space occurs. They are

```
ru/tutorial/index.rst:7:Sage — это бесплатное и свободно распространяемое математическое программное
ru/tutorial/introduction.rst:5:Данное учебное пособие — лучший способ познакомиться с Sage за несколько
```

I can see the spaces in these files and the above perl script does remove them. I think it would be good to replace these files as well.

Are there any thoughts on how to prevent this sort of thing in the future? Or does one just deal with it whenever it interferes with building the html docs?



---

archive/issue_comments_216423.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-27T19:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216423",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_216424.json:
```json
{
    "body": "I have taken care of the russian case. :)\n\nI do not know how to prevent this in the future. There is already a patchbot plugin which warns when a new unicode character is introduced, but it does not tell whether this is the \"unbreakable space\" or something else like \"\u00e9\u00e0\u00f9\u00e8\u00f6\".",
    "created_at": "2014-07-27T19:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216424",
    "user": "https://github.com/fchapoton"
}
```

I have taken care of the russian case. :)

I do not know how to prevent this in the future. There is already a patchbot plugin which warns when a new unicode character is introduced, but it does not tell whether this is the "unbreakable space" or something else like "éàùèö".



---

archive/issue_comments_216425.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-27T20:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216425",
    "user": "https://github.com/strogdon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_216426.json:
```json
{
    "body": "I believe this fixes things.",
    "created_at": "2014-07-27T20:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216426",
    "user": "https://github.com/strogdon"
}
```

I believe this fixes things.



---

archive/issue_comments_216427.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-07-27T20:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216427",
    "user": "https://github.com/strogdon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_216428.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-07-28T14:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16478#issuecomment-216428",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_015976.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-07-28T14:10:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16478",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16478#event-15976"
}
```
