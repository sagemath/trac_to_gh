# Issue 10846: Bad sign in integral()

archive/issues_010846.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  mjo\n\nKeywords: integral\n\nHere is the problem (tested on 4.6.2) :\n\n\n```\nsage: i = integral(e^(-1/x^2),x,0,1)\nsage: i.numerical_approx()          \n-0.0890738558907803\n```\n\n\nThis should be a positive number since the map is positive.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10923\n\n",
    "created_at": "2011-03-12T22:04:19Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Bad sign in integral()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10846",
    "user": "tmonteil"
}
```
Assignee: burcin

CC:  mjo

Keywords: integral

Here is the problem (tested on 4.6.2) :


```
sage: i = integral(e^(-1/x^2),x,0,1)
sage: i.numerical_approx()          
-0.0890738558907803
```


This should be a positive number since the map is positive.

Issue created by migration from https://trac.sagemath.org/ticket/10923





---

archive/issue_comments_115044.json:
```json
{
    "body": "This is probably a bug in Maxima. \n\n```\nsage: integral(e^(-1/x^2),x,0,1)\n-1/2*gamma(-1/2, 1)\nsage: integral(e^(-1/x^2),x,0,1).n()\n-0.0890738558907803\nsage: n(1/2*gamma(-1/2,1))\n0.0890738558907803\nsage: numerical_integral(e^(-1/x^2),0,1)\n(0.08907385589078036, 1.4474177932169952e-15)\n```\n\nSo probably a minus sign got in there somehow.\n\nThis is now Maxima bug 3211937.",
    "created_at": "2011-03-14T20:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115044",
    "user": "kcrisman"
}
```

This is probably a bug in Maxima. 

```
sage: integral(e^(-1/x^2),x,0,1)
-1/2*gamma(-1/2, 1)
sage: integral(e^(-1/x^2),x,0,1).n()
-0.0890738558907803
sage: n(1/2*gamma(-1/2,1))
0.0890738558907803
sage: numerical_integral(e^(-1/x^2),0,1)
(0.08907385589078036, 1.4474177932169952e-15)
```

So probably a minus sign got in there somehow.

This is now Maxima bug 3211937.



---

archive/issue_comments_115045.json:
```json
{
    "body": "Thanks for reporting this to Maxima.\n\nBy the way, here is a direct link to [the related maxima bug](http://sourceforge.net/tracker/?func=detail&aid=3211937&group_id=4933&atid=104933)).",
    "created_at": "2011-03-14T23:04:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115045",
    "user": "tmonteil"
}
```

Thanks for reporting this to Maxima.

By the way, here is a direct link to [the related maxima bug](http://sourceforge.net/tracker/?func=detail&aid=3211937&group_id=4933&atid=104933)).



---

archive/issue_comments_115046.json:
```json
{
    "body": "Apparently this is now fixed.  See the bug report above.  \n\nSo this will need a doctest when we upgrade our Maxima.",
    "created_at": "2011-03-30T15:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115046",
    "user": "kcrisman"
}
```

Apparently this is now fixed.  See the bug report above.  

So this will need a doctest when we upgrade our Maxima.



---

archive/issue_comments_115047.json:
```json
{
    "body": "To be applied when Maxima will be updated.",
    "created_at": "2011-03-31T23:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115047",
    "user": "tmonteil"
}
```

To be applied when Maxima will be updated.



---

archive/issue_comments_115048.json:
```json
{
    "body": "Attachment [trac_10923_test_integral-tm.patch](tarball://root/attachments/some-uuid/ticket10923/trac_10923_test_integral-tm.patch) by tmonteil created at 2011-03-31 23:52:11\n\nAs you suggested, i added a doctest to ensure that the correct integral is computed.",
    "created_at": "2011-03-31T23:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115048",
    "user": "tmonteil"
}
```

Attachment [trac_10923_test_integral-tm.patch](tarball://root/attachments/some-uuid/ticket10923/trac_10923_test_integral-tm.patch) by tmonteil created at 2011-03-31 23:52:11

As you suggested, i added a doctest to ensure that the correct integral is computed.



---

archive/issue_comments_115049.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2011-04-01T01:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115049",
    "user": "kcrisman"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_115050.json:
```json
{
    "body": "Great.  Once we get a Maxima in with this, I'll be sure to review the patch :)\n\nPutting as 'needs info' because of waiting for that, which will likely be a little while since we just upgraded.",
    "created_at": "2011-04-01T01:54:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115050",
    "user": "kcrisman"
}
```

Great.  Once we get a Maxima in with this, I'll be sure to review the patch :)

Putting as 'needs info' because of waiting for that, which will likely be a little while since we just upgraded.



---

archive/issue_comments_115051.json:
```json
{
    "body": "I've confirmed that this is fixed in maxima-5.24.0.",
    "created_at": "2011-12-13T18:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115051",
    "user": "mjo"
}
```

I've confirmed that this is fixed in maxima-5.24.0.



---

archive/issue_comments_115052.json:
```json
{
    "body": "This does not apply on sage-4.8.alpha5.  We just tried it at Sage Days 35.5.",
    "created_at": "2012-01-09T16:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115052",
    "user": "kcrisman"
}
```

This does not apply on sage-4.8.alpha5.  We just tried it at Sage Days 35.5.



---

archive/issue_comments_115053.json:
```json
{
    "body": "Changing keywords from \"integral\" to \"integral sd35.5\".",
    "created_at": "2012-01-09T16:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115053",
    "user": "kcrisman"
}
```

Changing keywords from "integral" to "integral sd35.5".



---

archive/issue_comments_115054.json:
```json
{
    "body": "We don't get such a nice answer, anyway, so the doctest from the patch would fail. With maxima-5.24,\n\n\n```\nsage: integral(e^(-1/x^2),x,0,1).full_simplify()\n((e*erf(1) - e)*sqrt(pi) + 1)*e^(-1)\n```\n\n\nI can update the patch; should we test that the numerical approximation is close to what it should be, or should we check for the symbolic result?",
    "created_at": "2012-01-09T17:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115054",
    "user": "mjo"
}
```

We don't get such a nice answer, anyway, so the doctest from the patch would fail. With maxima-5.24,


```
sage: integral(e^(-1/x^2),x,0,1).full_simplify()
((e*erf(1) - e)*sqrt(pi) + 1)*e^(-1)
```


I can update the patch; should we test that the numerical approximation is close to what it should be, or should we check for the symbolic result?



---

archive/issue_comments_115055.json:
```json
{
    "body": "So are you participating remotely at [Sage Days 35.5](http://wiki.sagemath.org/days35.5)?\n\nWe should probably test both, though of course this is not as pretty.\n\n```\nsage: ((e*erf(1) - e)*sqrt(pi) + 1)*e^(-1)\n((e*erf(1) - e)*sqrt(pi) + 1)*e^(-1)\nsage: _.n()\n0.0890738558907804\n```\n\nI never know what incomplete gamma is supposed to give in terms of \"normal\" functions.",
    "created_at": "2012-01-09T18:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115055",
    "user": "kcrisman"
}
```

So are you participating remotely at [Sage Days 35.5](http://wiki.sagemath.org/days35.5)?

We should probably test both, though of course this is not as pretty.

```
sage: ((e*erf(1) - e)*sqrt(pi) + 1)*e^(-1)
((e*erf(1) - e)*sqrt(pi) + 1)*e^(-1)
sage: _.n()
0.0890738558907804
```

I never know what incomplete gamma is supposed to give in terms of "normal" functions.



---

archive/issue_comments_115056.json:
```json
{
    "body": "Is \"participating remotely\" the same thing as \"goofing off at work\"? If so, I'm doing it. One more question: is there a good way to test almost-equals, for the numerical approximation? Or do I just do `abs(x - y) < epsilon`?",
    "created_at": "2012-01-09T19:03:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115056",
    "user": "mjo"
}
```

Is "participating remotely" the same thing as "goofing off at work"? If so, I'm doing it. One more question: is there a good way to test almost-equals, for the numerical approximation? Or do I just do `abs(x - y) < epsilon`?



---

archive/issue_comments_115057.json:
```json
{
    "body": "Hmm.  Yes, there is something new to do this much better.   See #10952.",
    "created_at": "2012-01-09T20:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115057",
    "user": "kcrisman"
}
```

Hmm.  Yes, there is something new to do this much better.   See #10952.



---

archive/issue_comments_115058.json:
```json
{
    "body": "Replying to [comment:11 kcrisman]:\n> Hmm.  Yes, there is something new to do this much better.   See #10952.\n\nThanks for this tip. I have a documentation bug open at #12281 for these doctest options if you guys get bored up there at sage days!",
    "created_at": "2012-01-09T20:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115058",
    "user": "mjo"
}
```

Replying to [comment:11 kcrisman]:
> Hmm.  Yes, there is something new to do this much better.   See #10952.

Thanks for this tip. I have a documentation bug open at #12281 for these doctest options if you guys get bored up there at sage days!



---

archive/issue_comments_115059.json:
```json
{
    "body": "Attachment [sage-trac_10923.patch](tarball://root/attachments/some-uuid/ticket10923/sage-trac_10923.patch) by mjo created at 2012-01-09 21:09:42\n\nUpdated patch for maxima-5.24 against sage-4.8.alpha6.",
    "created_at": "2012-01-09T21:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115059",
    "user": "mjo"
}
```

Attachment [sage-trac_10923.patch](tarball://root/attachments/some-uuid/ticket10923/sage-trac_10923.patch) by mjo created at 2012-01-09 21:09:42

Updated patch for maxima-5.24 against sage-4.8.alpha6.



---

archive/issue_comments_115060.json:
```json
{
    "body": "There you go. I threw in a few orders of magnitude more tolerance than I think we need to account for platform differences.",
    "created_at": "2012-01-09T21:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115060",
    "user": "mjo"
}
```

There you go. I threw in a few orders of magnitude more tolerance than I think we need to account for platform differences.



---

archive/issue_comments_115061.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-01-09T21:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115061",
    "user": "mjo"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_115062.json:
```json
{
    "body": "Michael, can you post the location of your Maxima-5.24 spkg so we can test this patch?",
    "created_at": "2012-01-10T16:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115062",
    "user": "benjaminfjones"
}
```

Michael, can you post the location of your Maxima-5.24 spkg so we can test this patch?



---

archive/issue_comments_115063.json:
```json
{
    "body": "Replying to [comment:14 benjaminfjones]:\n> Michael, can you post the location of your Maxima-5.24 spkg so we can test this patch?\n\nYup:\n\n  http://michael.orlitzky.com/sage/maxima-5.24.0.p0.spkg",
    "created_at": "2012-01-10T16:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115063",
    "user": "mjo"
}
```

Replying to [comment:14 benjaminfjones]:
> Michael, can you post the location of your Maxima-5.24 spkg so we can test this patch?

Yup:

  http://michael.orlitzky.com/sage/maxima-5.24.0.p0.spkg



---

archive/issue_comments_115064.json:
```json
{
    "body": "I can verify that the issue is solved after building the maxima-5.24 spkg that Michael provided and then applying the patch [attachment:sage-trac_10923.patch]. \n\n\n```\nsage: i = integral(e^(-1/x^2),x,0,1)\nsage: i.numerical_approx()\n0.0890738558907802\n```\n\n\nDoctests in the affected file all pass. I'm running all tests now, but  pending that, I give the ticket a positive review.",
    "created_at": "2012-01-10T20:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115064",
    "user": "benjaminfjones"
}
```

I can verify that the issue is solved after building the maxima-5.24 spkg that Michael provided and then applying the patch [attachment:sage-trac_10923.patch]. 


```
sage: i = integral(e^(-1/x^2),x,0,1)
sage: i.numerical_approx()
0.0890738558907802
```


Doctests in the affected file all pass. I'm running all tests now, but  pending that, I give the ticket a positive review.



---

archive/issue_comments_115065.json:
```json
{
    "body": "OK, `make ptestlong` finished. There were failures, but none of them are due to this ticket specifically as far as I can tell. They are all due to the maxima-5.24 spkg I believe. I need to look into #12094 to be sure but it's too late to do that tonight..",
    "created_at": "2012-01-11T05:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115065",
    "user": "benjaminfjones"
}
```

OK, `make ptestlong` finished. There were failures, but none of them are due to this ticket specifically as far as I can tell. They are all due to the maxima-5.24 spkg I believe. I need to look into #12094 to be sure but it's too late to do that tonight..



---

archive/issue_comments_115066.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-28T02:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115066",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_115067.json:
```json
{
    "body": "Yes, this all works fine.",
    "created_at": "2012-01-28T02:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115067",
    "user": "kcrisman"
}
```

Yes, this all works fine.



---

archive/issue_comments_115068.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-06T21:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115068",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_115069.json:
```json
{
    "body": "Something in this patch seems to trigger a doctesting bug. Try\n\n```\n./sage -t -only-optional=magma \"devel/sage/sage/symbolic/integration/integral.py\"\n```\n\nSee [sage release](http://groups.google.com/group/sage-release/browse_thread/thread/7a3905744b6c6e9f)",
    "created_at": "2012-02-10T19:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115069",
    "user": "mstreng"
}
```

Something in this patch seems to trigger a doctesting bug. Try

```
./sage -t -only-optional=magma "devel/sage/sage/symbolic/integration/integral.py"
```

See [sage release](http://groups.google.com/group/sage-release/browse_thread/thread/7a3905744b6c6e9f)



---

archive/issue_comments_115070.json:
```json
{
    "body": "See #12493 for followup.",
    "created_at": "2012-02-10T19:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10846",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10846#issuecomment-115070",
    "user": "kcrisman"
}
```

See #12493 for followup.
