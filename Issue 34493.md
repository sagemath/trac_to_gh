# Issue 34493: Rebase sage_autodoc to sphinx 5.3.0

Issue created by migration from https://trac.sagemath.org/ticket/34730

Original creator: klee

Original creation time: 2022-11-08 05:35:53

CC:  fbissey




---

Comment by klee created at 2022-11-08 05:38:32

Changing type from PLEASE CHANGE to enhancement.


---

Comment by klee created at 2022-11-08 05:38:32

Changing component from PLEASE CHANGE to documentation.


---

Comment by klee created at 2022-11-08 05:40:01

Changing status from new to needs_review.


---

Comment by klee created at 2022-11-08 05:40:01

Setting "needs review" to build the documentation for further check.


---

Comment by klee created at 2022-11-08 11:17:09

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-11-08 12:38:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-11-08 12:39:11

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-11-09 03:18:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-11-09 21:24:32

Do you have a ticket for sphinx 5.3.0 or is it backward compatible?


---

Comment by klee created at 2022-11-09 22:07:56

Replying to [comment:13 François Bissey]:
> Do you have a ticket for sphinx 5.3.0 or is it backward compatible?

There is no difference between `autodoc`s of sphinx 5.2.3 and 5.3.0.


---

Comment by klee created at 2022-11-09 22:16:43

Moreover, as our old sage_autodoc (that is based on sphinx 1.8.x) still works with sphinx 5.2.3, autodoc extension seems pretty independent from the version of sphinx.


---

Comment by fbissey created at 2022-11-09 22:20:01

I am fairly it has been touched here and there. But because of the ticket title I was wondering if we were doing something specific for sphinx 5.3.0. I have not checked we are compatible with sphinx 5.3.0 for example (and presumably if Antonio Rojas tested it, he didn't find/report any issues).


---

Comment by klee created at 2022-11-10 00:16:13

Replying to [comment:16 François Bissey]:
> I am fairly it has been touched here and there. But because of the ticket title I was wondering if we were doing something specific for sphinx 5.3.0. 

I just used the latest from sphinx 5.x series.


---

Comment by klee created at 2022-11-10 00:18:44

Replying to [comment:16 François Bissey]:
> I have not checked we are compatible with sphinx 5.3.0 for example (and presumably if Antonio Rojas tested it, he didn't find/report any issues).

When I did the rebase for sphinx 1.8.x, there were many regressions, which Jeroen Demeyer detected and reported to me. If there are none (or few) this time, that is because of the efforts made then. This time it is not that difficult. Next time, hopefully it would be even easier :)


---

Comment by @tobiasdiez created at 2022-11-10 10:55:42

LGTM.

Since you are now familiar with the code, can you maybe list the major changes of sage's autodoc in #30893 with a proposal for how to remove the modification.


---

Comment by @tobiasdiez created at 2022-11-10 10:55:42

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-11-10 14:07:18

Replying to [comment:19 Tobias Diez]:
> LGTM.

Thanks.

> Since you are now familiar with the code, 

Well.., it was basically trial-and-errors with bits of understanding here and there :)

> can you maybe list the major changes of sage's autodoc in #30893 with a proposal for how to remove the modification.

I marked in the code where modifications are made. It is easy to list them:

1. skipping lazy imports to avoid deprecation warnings
2. providing argspecs for decorators (sage_wraps)
3. dealing with nested classes
4. dealing with cached function(methods) callers
5. dealing with classcall metaclass  
6. dealing with class aliases
7. using argspecs instead of signature 

but sorry no proposal for how to remove them. All looks difficult. I am not sure if the aim of eventual removal of sage_autodoc is really achievable. 

After #26254 merged, switching to signature seems the most urgent thing.


---

Comment by @tobiasdiez created at 2022-11-10 20:50:47

Thanks for the summary, I've added it to #30893.


---

Comment by vbraun created at 2022-11-15 23:42:58

Resolution: fixed
