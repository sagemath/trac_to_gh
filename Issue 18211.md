# Issue 18211: Add test if a matroid is binary

Issue created by migration from https://trac.sagemath.org/ticket/18448

Original creator: Rudi

Original creation time: 2015-05-19 11:51:48

CC:  stefan




---

Comment by Rudi created at 2015-05-20 08:36:53

All done. I also noted that BinaryMatroid._is_isomorphism() did not revert to _is_field_isomorphism if both matroids were binary, repaired that omission.
----
New commits:


---

Comment by Rudi created at 2015-05-20 08:36:53

Changing component from PLEASE CHANGE to matroid theory.


---

Comment by Rudi created at 2015-05-20 08:36:53

Changing type from PLEASE CHANGE to enhancement.


---

Comment by Rudi created at 2015-05-20 08:36:53

Changing status from new to needs_review.


---

Comment by Rudi created at 2015-05-20 08:36:53

Changing priority from major to minor.


---

Comment by Rudi created at 2015-05-25 09:26:13

Set assignee to Rudi.


---

Comment by git created at 2015-05-25 10:27:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-05-25 19:42:17

According to the patchbot, there is a doctest problem in "src/sage/interfaces/expect.py". 

My patch does not even go near "src/sage/interfaces/expect.py". So what could be the problem here?


---

Comment by vdelecroix created at 2015-05-25 21:07:34

Replying to [comment:6 Rudi]:
> According to the patchbot, there is a doctest problem in "src/sage/interfaces/expect.py". 
> 
> My patch does not even go near "src/sage/interfaces/expect.py". So what could be the problem here?

No worries. This is completely independent of your ticket! Singular is causing randoml troubles in expect (at least on the patchbot librae). This is a known issue.


---

Comment by Rudi created at 2015-05-25 21:32:56

Replying to [comment:7 vdelecroix]:
> No worries. This is completely independent of your ticket! Singular is causing randoml troubles in expect (at least on the patchbot librae). This is a known issue.

Thanks for the reassurance. I've been having the strangest problems working on patches this last week. Glad to hear it's not all due to my own ignorance ;).


---

Comment by tscrim created at 2015-05-31 06:36:23

From looking through it, there are a couple of things to fix:

- Instead of `type(self) == BinaryMatroid`, you should do `isinstance(self, BinaryMatriod)` (or even better, for `is_binary`, I would just overwrite this method in that class which returns `True`).
- You need to fix the documentation of your methods. For example, the `INPUT:` block should only have one colon. You can look at the other nearby methods or ask me if you have any questions. I'd also add some latex formating to things using single backticks, e.g., ``|X\B| \leq 1``.


---

Comment by git created at 2015-05-31 09:35:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-05-31 09:57:43

Hi Travis,

thanks for the feedback.

> - Instead of `type(self) == BinaryMatroid`, you should do `isinstance(self, BinaryMatriod)` (or even better, for `is_binary`, I would just overwrite this method in that class which returns `True`).

I overwrote the method for BinaryMatroid and RegularMatroid, completely agree that this is a better solution. 

Why is `isinstance(self, BinaryMatroid)` preferred over over `type(self) == BinaryMatroid`? For a class like BinaryMatroid that has no derived classes, both seem to accomplish the exact same thing.

> - You need to fix the documentation of your methods. For example, the `INPUT:` block should only have one colon. You can look at the other nearby methods or ask me if you have any questions. I'd also add some latex formating to things using single backticks, e.g., ``|X\B| \leq 1``.

I improved the docstring, with an eye on adjacent methods.

I wrote dozens of docstrings just before we added the matroid monster patch (essentialy all the docstrings were written after we wrote all the code), but apparently the rules for proper docstring writing have escaped me (or perhaps Stefan repaired my bad formatting during the review, so that I never even realized all my errors). Anyway, I should learn to do it properly.  I'll take a look at the developer guide.


---

Comment by tscrim created at 2015-05-31 17:50:22

Replying to [comment:11 Rudi]:
> thanks for the feedback.

Thanks for your work.

> Why is `isinstance(self, BinaryMatroid)` preferred over over `type(self) == BinaryMatroid`? For a class like BinaryMatroid that has no derived classes, both seem to accomplish the exact same thing.

Because then it checks for subclasses, i.e., if X is an instance of a subclass of `BinaryMatroid`, then `isinstance(X, BinaryMatroid)` returns `True`, whereas `type(X) == BinaryMatroid` returns `False`. Suppose a user has implemented a subclass in private code, then it should work for those subclasses too (since they are suppose to behave as a `BinaryMatroid` would).

> > - You need to fix the documentation of your methods. For example, the `INPUT:` block should only have one colon. You can look at the other nearby methods or ask me if you have any questions. I'd also add some latex formating to things using single backticks, e.g., ``|X\B| \leq 1``.
> 
> I improved the docstring, with an eye on adjacent methods.
> 
> I wrote dozens of docstrings just before we added the matroid monster patch (essentialy all the docstrings were written after we wrote all the code), but apparently the rules for proper docstring writing have escaped me (or perhaps Stefan repaired my bad formatting during the review, so that I never even realized all my errors). Anyway, I should learn to do it properly.  I'll take a look at the developer guide. 

It's a lot better (and overall, your documentation is good), but there's still some work to do:

- The indentation on all blocks with only a single colon should be the same as the base:

```
INPUT:

- ``randomized_tests`` -- (default: 1) some description here
```

- You should have (with 2 colons, space, and empty line):

```
.. SEEALSO::

    :meth:`M.is_binary() <sage.matroids.matroid.Matroid.is_binary>`
```

- The `EXAMPLES::` block should be followed by an empty line.
- Change `<=` to `\leq` (for the interactive doc, we make this substitution, but it will look better in the compiled doc).
- For the `BinaryMatroid.is_binary` and for `RegularMatroid`, I would just say the `randomized_tests` input is ignored.


---

Comment by git created at 2015-05-31 18:35:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-05-31 18:38:55

Replying to [comment:12 tscrim]:

> - The indentation on all blocks with only a single colon should be the same as the base:
> {{{
> INPUT:
> 
> - ``randomized_tests`` -- (default: 1) some description here
> }}}
> - You should have (with 2 colons, space, and empty line):
> {{{
> .. SEEALSO::
> 
>     :meth:`M.is_binary() <sage.matroids.matroid.Matroid.is_binary>`
> }}}
> - The `EXAMPLES::` block should be followed by an empty line.
> - Change `<=` to `\leq` (for the interactive doc, we make this substitution, but it will look better in the compiled doc).
> - For the `BinaryMatroid.is_binary` and for `RegularMatroid`, I would just say the `randomized_tests` input is ignored.

Check. 

Thanks again for your help.


---

Comment by tscrim created at 2015-06-02 06:09:27

Two more things. Once fixed you can set a positive review on my behalf.

- You have a `.. SEEALSO:` (missing a colon).
- Your algorithm blocks should be at same indentation level as the `ALGORITHM:`.

Thanks!


---

Comment by git created at 2015-06-03 06:43:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-03 06:45:34

Changing status from needs_review to positive_review.


---

Comment by git created at 2015-06-03 06:48:21

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-06-03 06:48:21

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by Rudi created at 2015-06-03 06:53:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-06-03 21:24:45

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-06-03 21:24:45

Docs don't build


---

Comment by tscrim created at 2015-06-03 21:28:42

Whoops. The problem is this `|X\B|`, where it gets interpreted by latex as a command `\B`, instead I think this should be `|X \setminus B|`.


---

Comment by git created at 2015-06-03 21:33:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-03 21:35:46

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2015-06-03 21:39:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-06-06 13:07:20

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-06-06 13:07:20

Documentation still doesn't build


---

Comment by tscrim created at 2015-06-06 19:23:03

Another problem was that there was an item that was misaligned.

I made `local_binary_matroid` into a public function since it seems to be more useful than a simple helper function. I also moved the import into the function since it was circular and I couldn't get the doc to build otherwise.

Can you check that the doc also builds for you too? If so, and you agree with my changes, then we can set this back to positive review.
----
New commits:


---

Comment by tscrim created at 2015-06-06 19:23:03

Changing status from needs_work to needs_review.


---

Comment by Rudi created at 2015-06-06 20:47:44

Hi Travis,

I was not able to trace that misaligned item myself, so thanks for making those changes. Building docs is not going smoothly on my machine, though it may have nothing to do with this patch:

```
[ -f local/etc/sage-started.txt ] || local/bin/sage-starts
build/pipestatus "./sage --docbuild --no-pdf-links all html  2>&1" "tee -a logs/dochtml.log"
Traceback (most recent call last):
  File "/Users/rudi/Documents/Development/sage-6.7/src/doc/common/builder.py", line 16, in <module>
    import sphinx.cmdline
  File "/Users/rudi/Documents/Development/sage-6.7/local/lib/python2.7/site-packages/Sphinx-1.2.2-py2.7.egg/sphinx/cmdline.py", line 18, in <module>
    from docutils.utils import SystemMessage
  File "/Users/rudi/Documents/Development/sage-6.7/local/lib/python2.7/site-packages/docutils/utils/__init__.py", line 20, in <module>
    import docutils.io
  File "/Users/rudi/Documents/Development/sage-6.7/local/lib/python2.7/site-packages/docutils/io.py", line 18, in <module>
    from docutils.utils.error_reporting import locale_encoding, ErrorString, ErrorOutput
  File "/Users/rudi/Documents/Development/sage-6.7/local/lib/python2.7/site-packages/docutils/utils/error_reporting.py", line 47, in <module>
    locale_encoding = locale.getlocale()[1] or locale.getdefaultlocale()[1]
  File "/Users/rudi/Documents/Development/sage-6.7/local/lib/python/locale.py", line 543, in getdefaultlocale
    return _parse_localename(localename)
  File "/Users/rudi/Documents/Development/sage-6.7/local/lib/python/locale.py", line 475, in _parse_localename
    raise ValueError, 'unknown locale: %s' % localename
ValueError: unknown locale: UTF-8
make: *** [doc-html] Error 1
```


About making _local_binary_matroid() public... Well now that you bring this up, I agree that getting the actual binary representation itself may be useful to the user too. But with this pair of methods, if the user now wants a verified binary representation, they need to run both methods, one repeating the work of the other. And there would be two public methods in the interface dealing with one issue.

Also,  next up are ternary and quaternary matroids. For quaternary matroids the situation is more subtle. Unlike `local_binary_matroid`, the `local_quaternary_matroid` method may arrive at the conclusion that there is no quaternary representation. My idea was to let it output `None` in such cases. So then you would have very similar public methods behaving slightly different.

There may be another solution. I could rewrite `is_binary()` to a method `binary_representation()`, which outputs a `BinaryMatroid` equal to `self`, or `None` if no such binary matroid exists. The changes would be minimal. The user could still do `if M.binary_representation():` if they only care about existence. 

What do you think about this? If I promise not to mess up the docstrings this time ...

Cheers,
Rudi


---

Comment by vbraun created at 2015-06-06 20:58:15

Just "UTF-8" is not a valid locale. I'm guessing you are using OSX since that has a long-standing bug there. You need something like

```
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
```



---

Comment by Rudi created at 2015-06-06 21:15:05

Replying to [comment:28 vbraun]:
> Just "UTF-8" is not a valid locale. I'm guessing you are using OSX since that has a long-standing bug there. You need something like
> {{{
> export LC_ALL=en_US.UTF-8
> export LANG=en_US.UTF-8
> }}}
Yes, I am on OSX. Sorry, should have mentioned this. Those two command did the job. The docs build without any problems now.


---

Comment by tscrim created at 2015-06-07 00:36:26

Replying to [comment:27 Rudi]:
> About making _local_binary_matroid() public... Well now that you bring this up, I agree that getting the actual binary representation itself may be useful to the user too. But with this pair of methods, if the user now wants a verified binary representation, they need to run both methods, one repeating the work of the other. And there would be two public methods in the interface dealing with one issue.

From my (somewhat limited) understanding, every matroid has a local binary matroid, but it may not be isomorphic to the original matroid. So there are separate concerns (and IMO the user should know from the documentation to call `is_binary` if that is what they really want to check).

> Also,  next up are ternary and quaternary matroids. For quaternary matroids the situation is more subtle. Unlike `local_binary_matroid`, the `local_quaternary_matroid` method may arrive at the conclusion that there is no quaternary representation. My idea was to let it output `None` in such cases. So then you would have very similar public methods behaving slightly different.

You could either return `None` or raise an error. Both are acceptable to me. Yet this is for a follow-up ticket.

> There may be another solution. I could rewrite `is_binary()` to a method `binary_representation()`, which outputs a `BinaryMatroid` equal to `self`, or `None` if no such binary matroid exists. The changes would be minimal. The user could still do `if M.binary_representation():` if they only care about existence. 

It actually would work to have 3 methods, one for the local (if my understanding is wrong, then we'd remove this method), `binary_representation()` and `is_binary()`, where we cache the output of `binary_representation()`, and `is_binary` just calls `bool(self.binary_representation())` (or if raising an error sounds better, a try-catch statement).


---

Comment by Rudi created at 2015-06-07 11:09:06

Replying to [comment:30 tscrim]:

> > There may be another solution. I could rewrite `is_binary()` to a method `binary_representation()`, which outputs a `BinaryMatroid` equal to `self`, or `None` if no such binary matroid exists. The changes would be minimal. The user could still do `if M.binary_representation():` if they only care about existence. 
> 
> It actually would work to have 3 methods, one for the local (if my understanding is wrong, then we'd remove this method), `binary_representation()` and `is_binary()`, where we cache the output of `binary_representation()`, and `is_binary` just calls `bool(self.binary_representation())` (or if raising an error sounds better, a try-catch statement).
But then we would have 3 public methods. I'm trying to reduce that number to 1, if I can do so  without losing functionality.

I think that once you have computed `self.binary_representation()`, computing `bool(self.binary_representation())` has nothing to do with `class Matroids` anymore, the user can do that themselves. I also prefer to avoid caching if I can do so without complicating things, since I feel the user should be in control of memory usage as much as possible (they may one day want to keep as many matroids in memory as possible, without having a need for all this cached information).  So to my mind, having the method `binary_representation` makes the method `is_binary` redundant. The converse is not true, so that is why I would want to replace `is_binary` with `binary_representation`.

It is true that any matroid has a `local binary matroid` relative to a basis, but I'm not so sure if this concept appears anywhere in the literature under that name (or any name, it's just an intermediate object). What matters for the user is that they can bypass verification if they already know that the matroid is binary. So I could perhaps fit binary_representation with an optional input `verify = True`, so that if you set `verify = False` you skip the isomorphism testing at the end. Effectively, you then just get the `local_binary_matroid` passed on without extra work. So then I would also prefer to keep a hidden `_local_binary_matroid`.

Stefan, if you are tuned to this channel, how do you feel about this? I think we at some point discussed a general policy of not having more than one public method dealing with very similar functionality in Matroid, if possible. But how about this particular function?


---

Comment by Rudi created at 2015-06-13 17:46:14

How about this?
----
New commits:


---

Comment by kdilks created at 2015-06-15 06:16:15

In `matroid.pyx`, in the documentation for the method `binary_matroid`, under `INPUT:`, the second entry (corresponding to 'verify') has an extra space. Documentation builds after making that change.


---

Comment by git created at 2015-06-15 08:17:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by Rudi created at 2015-06-15 08:19:04

Replying to [comment:34 kdilks]:
> In `matroid.pyx`, in the documentation for the method `binary_matroid`, under `INPUT:`, the second entry (corresponding to 'verify') has an extra space. Documentation builds after making that change.

Thank you for catching that. Docs now build on my machine.


---

Comment by tscrim created at 2015-06-17 05:44:39

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2015-06-17 05:44:39

Sorry for taking so long to get back to this. If you think `local_binary_matroid` should be hidden and structure the code this way, then I won't object as I don't have a big stake in this. So positive review.


---

Comment by Rudi created at 2015-06-17 08:31:23

Replying to [comment:37 tscrim]:
> Sorry for taking so long to get back to this. If you think `local_binary_matroid` should be hidden and structure the code this way, then I won't object as I don't have a big stake in this. So positive review.

Great! And no problem that it took a bit longer. Your criticism helped me a lot throughout and you simply were right that the interface could be better before. So thanks for giving me the opportunity to rethink it, and for doing this extra long review.


---

Comment by vbraun created at 2015-06-18 17:58:04

Resolution: fixed
