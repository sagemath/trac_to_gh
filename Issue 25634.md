# Issue 25634: Add option to control GC during doctests

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2018-07-18 07:28:57

A new option `--gc` is proposed to the Sage doctesting framework. It can be used to control garbage collection as follows:

- `--gc=default`: Python default

- `--gc=always`: run `gc.collect()` before every single test

- `--gc=never`: completely disable GC during doctests

I would have found this useful several times for debugging GC-related failures or for more consistent timing of tests.


---

Comment by jdemeyer created at 2018-07-21 09:36:10

New commits:


---

Comment by jdemeyer created at 2018-07-21 09:36:10

Changing status from new to needs_review.


---

Comment by git created at 2018-07-21 12:27:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-21 15:08:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-07-23 01:49:31

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-07-23 01:49:31

Everything seems to work well, and it is definitely a useful feature. (The `--gc` option is ignored when not running a `-t` option, which I think is okay. I am just noting this behavior here for the record.)

One thing I think that is missing is to have this this documented in `sage --advanced`.


---

Comment by git created at 2018-07-23 08:25:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-07-23 08:29:44

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-07-23 11:07:19

Sorry to nitpick, but I think for the `--advanced`, we try to keep it at 70 chars/line, so I would format it as:

```
                           --gc=GC - control garbarge collection (ALWAYS:
                                     collect garbage before every test;
                                     NEVER: disable gc; DEFAULT: Python
                                     default)
```

or possibly

```
                           --gc=GC - control garbarge collection
                                     (ALWAYS: collect garbage before
                                     every test; NEVER: disable gc;
                                     DEFAULT: Python default)
```



---

Comment by git created at 2018-07-26 14:45:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-07-26 22:50:20

Thank you.


---

Comment by tscrim created at 2018-07-26 22:50:20

Changing keywords from "" to "sagedays@icerm".


---

Comment by tscrim created at 2018-07-26 22:50:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-05 08:16:08

Resolution: fixed
