# Issue 10303: PolynomialRing_field.lagrange_polynomial doesn't always return a polynomial

archive/issues_010303.json:
```json
{
    "body": "Assignee: @mguaypaq\n\nCC:  mvngu\n\nKeywords: polynomial ring, lagrange polynomial\n\nThe function `PolynomialRing_field.lagrange_polynomial` sometimes returns an element of the coefficient ring or even a python int instead of an element of the polynomial ring. This can lead to problems if the caller was expecting a polynomial.\n\n\n```\nsage: R, t = FractionField(QQ['t']).objgen(); R.rename('R')\nsage: S, x = R['x'].objgen(); S.rename('S')\nsage: S.lagrange_polynomial([(2, 3 * t), (4, t + 1)]).parent()\nS\nsage: S.lagrange_polynomial([(2, 3 * t)]).parent()\nR\nsage: type(S.lagrange_polynomial([]))\n<type 'int'>\n```\n\n\nThe return value is a python int if the list of points was empty, an element of the base ring if the list of points had one point, and an element of the polynomial ring if the list of points had more than one point.\n\nThere are similar problems with the base case for the `algorithm='neville'` version:\n\n\n```\nsage: S.lagrange_polynomial([(2, 3 * t), (4, t + 1)], algorithm='neville')\n[t + 1, (-t + 1/2)*x + 5*t - 1]\nsage: [poly.parent() for poly in _]\n[R, S]\nsage: S.lagrange_polynomial([(2, 3 * t)], algorithm='neville')\n[3*t]\nsage: [poly.parent() for poly in _]\n[R]\nsage: S.lagrange_polynomial([], algorithm='neville')\n0\nsage: type(_)\n<type 'int'>\n```\n\n\nNote that in this case, the return value is not even a list when the list of points was empty.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10304\n\n",
    "created_at": "2010-11-21T05:23:53Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "PolynomialRing_field.lagrange_polynomial doesn't always return a polynomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10303",
    "user": "https://github.com/mguaypaq"
}
```
Assignee: @mguaypaq

CC:  mvngu

Keywords: polynomial ring, lagrange polynomial

The function `PolynomialRing_field.lagrange_polynomial` sometimes returns an element of the coefficient ring or even a python int instead of an element of the polynomial ring. This can lead to problems if the caller was expecting a polynomial.


```
sage: R, t = FractionField(QQ['t']).objgen(); R.rename('R')
sage: S, x = R['x'].objgen(); S.rename('S')
sage: S.lagrange_polynomial([(2, 3 * t), (4, t + 1)]).parent()
S
sage: S.lagrange_polynomial([(2, 3 * t)]).parent()
R
sage: type(S.lagrange_polynomial([]))
<type 'int'>
```


The return value is a python int if the list of points was empty, an element of the base ring if the list of points had one point, and an element of the polynomial ring if the list of points had more than one point.

There are similar problems with the base case for the `algorithm='neville'` version:


```
sage: S.lagrange_polynomial([(2, 3 * t), (4, t + 1)], algorithm='neville')
[t + 1, (-t + 1/2)*x + 5*t - 1]
sage: [poly.parent() for poly in _]
[R, S]
sage: S.lagrange_polynomial([(2, 3 * t)], algorithm='neville')
[3*t]
sage: [poly.parent() for poly in _]
[R]
sage: S.lagrange_polynomial([], algorithm='neville')
0
sage: type(_)
<type 'int'>
```


Note that in this case, the return value is not even a list when the list of points was empty.

Issue created by migration from https://trac.sagemath.org/ticket/10304





---

archive/issue_comments_105389.json:
```json
{
    "body": "Attachment [trac_10304_lagrange_poly_in_self.patch](tarball://root/attachments/some-uuid/ticket10304/trac_10304_lagrange_poly_in_self.patch) by @mguaypaq created at 2010-11-21 05:38:05",
    "created_at": "2010-11-21T05:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105389",
    "user": "https://github.com/mguaypaq"
}
```

Attachment [trac_10304_lagrange_poly_in_self.patch](tarball://root/attachments/some-uuid/ticket10304/trac_10304_lagrange_poly_in_self.patch) by @mguaypaq created at 2010-11-21 05:38:05



---

archive/issue_comments_105390.json:
```json
{
    "body": "I've put up a patch that should fix the problem, at least in the case of `algorithm='divided_difference'`, and includes a new doctest to verify this.\n\nFor the `algorithm='neville'` case, I've taken the liberty of rewriting the code, to clean it up and unify it a bit in addition to fixing the original problem. However:\n* This changes the default value of `previous_row` from `None` to `[]`. I doubt this would break anything, but it is a slight change in the function signature.\n* In the case of an empty list of points, I wasn't sure whether to return `[]` or `[0]`. The former is more consistent with the `previous_row` option, but the latter preserves the property that the last element of the returned list is the interpolating polynomial (as opposed to non-existent). I opted for the first one, but there's definitely a choice to be made here. (I'll note that neither choice is really backwards-incompatible, since the method used to fail in this case.)\n\nMinh, I've put you on CC, since (I think) you wrote the original code for the `algorithm='neville'` part. Do you approve of the changes?",
    "created_at": "2010-11-21T05:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105390",
    "user": "https://github.com/mguaypaq"
}
```

I've put up a patch that should fix the problem, at least in the case of `algorithm='divided_difference'`, and includes a new doctest to verify this.

For the `algorithm='neville'` case, I've taken the liberty of rewriting the code, to clean it up and unify it a bit in addition to fixing the original problem. However:
* This changes the default value of `previous_row` from `None` to `[]`. I doubt this would break anything, but it is a slight change in the function signature.
* In the case of an empty list of points, I wasn't sure whether to return `[]` or `[0]`. The former is more consistent with the `previous_row` option, but the latter preserves the property that the last element of the returned list is the interpolating polynomial (as opposed to non-existent). I opted for the first one, but there's definitely a choice to be made here. (I'll note that neither choice is really backwards-incompatible, since the method used to fail in this case.)

Minh, I've put you on CC, since (I think) you wrote the original code for the `algorithm='neville'` part. Do you approve of the changes?



---

archive/issue_comments_105391.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-11-21T05:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105391",
    "user": "https://github.com/mguaypaq"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_105392.json:
```json
{
    "body": "Attachment [trac-10304_reviewer.patch](tarball://root/attachments/some-uuid/ticket10304/trac-10304_reviewer.patch) by mvngu created at 2010-11-21 14:09:36\n\nI'm happy with most of [attachment:trac_10304_lagrange_poly_in_self.patch], but here are some problems with that patch:\n\n* A standard idiom in Python is to avoid using a mutable object for a default value. Using a mutable object (such as a list) as a default value can introduce subtle and difficult to track bugs. See [this blog post](http://effbot.org/zone/default-values.htm) for an explanation of why one should avoid using mutable values for default arguments. See this section in the Python Language Reference for an official explanation about avoiding the use of mutable objects for default values.\n \n* When you provide doctests that purports to illustrate that a bug has been fixed, you need to provide the corresponding ticket number in the documentation of the doctests.\n \n* The docstring you introduce doesn't use proper ReST syntax.\n\nThe reviewer patch [attachment:trac-10304_reviewer.patch] fixes all of the above issues. If you're OK with my patch, then set the ticket to positive review. See the ticket description for instructions on which patches to apply and in which order.",
    "created_at": "2010-11-21T14:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105392",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Attachment [trac-10304_reviewer.patch](tarball://root/attachments/some-uuid/ticket10304/trac-10304_reviewer.patch) by mvngu created at 2010-11-21 14:09:36

I'm happy with most of [attachment:trac_10304_lagrange_poly_in_self.patch], but here are some problems with that patch:

* A standard idiom in Python is to avoid using a mutable object for a default value. Using a mutable object (such as a list) as a default value can introduce subtle and difficult to track bugs. See [this blog post](http://effbot.org/zone/default-values.htm) for an explanation of why one should avoid using mutable values for default arguments. See this section in the Python Language Reference for an official explanation about avoiding the use of mutable objects for default values.
 
* When you provide doctests that purports to illustrate that a bug has been fixed, you need to provide the corresponding ticket number in the documentation of the doctests.
 
* The docstring you introduce doesn't use proper ReST syntax.

The reviewer patch [attachment:trac-10304_reviewer.patch] fixes all of the above issues. If you're OK with my patch, then set the ticket to positive review. See the ticket description for instructions on which patches to apply and in which order.



---

archive/issue_comments_105393.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-23T00:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105393",
    "user": "https://github.com/mguaypaq"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_105394.json:
```json
{
    "body": "I thought the use of a mutable default was safe, since it is always copied, never modified. But since there's an idiom against this, I'm happy to comply! And thanks for fixing the documentation issues.\n\nPositive review for the reviewer patch.",
    "created_at": "2010-11-23T00:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105394",
    "user": "https://github.com/mguaypaq"
}
```

I thought the use of a mutable default was safe, since it is always copied, never modified. But since there's an idiom against this, I'm happy to comply! And thanks for fixing the documentation issues.

Positive review for the reviewer patch.



---

archive/issue_events_010424.json:
```json
{
    "actor": "@jdemeyer",
    "created_at": "2010-12-02T16:11:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10303#event-10424"
}
```



---

archive/issue_comments_105395.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-12-02T16:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10303#issuecomment-105395",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
