# Issue 23809: py3 : fixing exit

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2017-10-14 13:13:06

CC:  jdemeyer tscrim jhpalmieri embray

now that sage starts with python3


---

Comment by chapoton created at 2017-10-14 13:13:36

New commits:


---

Comment by chapoton created at 2017-10-14 13:13:36

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-10-14 18:27:07

green bot, please review


---

Comment by jdemeyer created at 2017-10-16 11:57:26

Can you tell what goes wrong _without_ this patch? I don't like to fix bugs that I do not understand.


---

Comment by chapoton created at 2017-10-16 14:12:43

I will not have access to a python3-build of sage until next week-end.

As far as I remember, when typing "exit", it complains that it was expecting bytes or str and not a lazy string.

You can try and see with the experimental branch (see the recent sage-devel thread)


---

Comment by embray created at 2017-10-16 14:25:19

This seems fine for now, but it got me thinking--instead of using `str(lazy_str)` everywhere (not that there are many examples of this, but I'm sure there are a few) we could kill all birds at once by defining `__fspath__` on `lazy_string`.  That way, `lazy_string`s can be used transparently with `os.path` and any other interfaces that support the `PathLike` ABC (which most path-related interfaces on Python 3 now do, at least in the stdlib).


---

Comment by jhpalmieri created at 2017-10-16 18:58:20

Is this just a matter of adding `__fspath__ = __str__` in the `_LazyString` class?


---

Comment by chapoton created at 2017-10-17 06:55:18

so, is this a positive review ?


---

Comment by chapoton created at 2017-10-18 07:04:01

bot is green..


---

Comment by embray created at 2017-10-18 13:16:44

Replying to [comment:6 jhpalmieri]:
> Is this just a matter of adding `__fspath__ = __str__` in the `_LazyString` class?

I think so.  I suggest we try this instead of the explicit fix in this ticket.


---

Comment by git created at 2017-10-18 14:56:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2017-10-18 14:57:01

Please try this version with Python 3 instead. If it doesn't work, then positive review for your solution.


---

Comment by jdemeyer created at 2017-10-18 15:22:04

I would much prefer

```python
def __fspath__(self):
    """
    Docstring here
    """
    return str(self)
```


This works better with inheritance and it allows adding a docstring.


---

Comment by git created at 2017-10-18 15:55:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2017-10-18 15:56:14

How about this?


---

Comment by jdemeyer created at 2017-10-18 18:22:11

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2017-10-18 18:22:11

Isn't the whole point of this ticket that `os.path.join(SAGE_TMP, 'hello')` should work _without_ adding `str()`?


---

Comment by jhpalmieri created at 2017-10-18 19:52:25

Sorry, I think the doctest should not include `str`. My mistake.


---

Comment by jhpalmieri created at 2017-10-18 19:57:17

Changing status from needs_info to needs_review.


---

Comment by git created at 2017-10-18 19:58:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-10-19 07:58:14

There is a syntax error in doctests


---

Comment by git created at 2017-10-19 14:29:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2017-10-19 14:30:23

You're right, I keep making mistakes here.


---

Comment by embray created at 2017-10-19 14:31:43

Looks good to me, but I'll let Frédéric sign off on it since he's in a better position to test it.


---

Comment by chapoton created at 2017-10-19 17:58:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-10-21 19:01:12

Resolution: fixed
