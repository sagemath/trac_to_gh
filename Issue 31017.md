# Issue 31017: Do not perform unnecesssary subdivisions in matrices

Issue created by migration from https://trac.sagemath.org/ticket/31254

Original creator: tscrim

Original creation time: 2021-01-17 01:33:05

CC:  chapoton

Keywords: matrix, subdivisions


```
sage: A = matrix.identity(QQ, 4)                                                
sage: A._subdivisions                                                           
sage: A2 = A.change_ring(RDF)                                                     
sage: A2._subdivisions                                                          
( [ 0, 4 ], [ 0, 4 ] )
```

We should also disregard when being passed no subdivisions:

```
sage: A = matrix.identity(QQ, 4)
sage: A._subdivisions
sage: A.subdivide(A.subdivisions())
sage: A._subdivisions
( [ 0, 4 ], [ 0, 4 ] )
```



---

Comment by tscrim created at 2021-01-17 01:59:21

This should take care of everything.
----
New commits:


---

Comment by tscrim created at 2021-01-17 01:59:21

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2021-01-17 10:19:25

Oh, now I see that I had not fully understood the problem before, but I agree with the goal of this ticket now. This branch also fixes the problem in #31234, but nevertheless it still seems to be consistent to return a mutable matrix there. Sorry that I rushed it a bit.


---

Comment by tscrim created at 2021-01-18 00:16:24

This would be another fix to #31234, but I like the consistency there. Plus I see this as a slightly different issue.


---

Comment by git created at 2021-01-18 00:17:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-01-18 00:18:29

Here is a fix to the only doctest failure due to my standardization of the error message.


---

Comment by tscrim created at 2021-01-21 06:52:49

Green patchbot.


---

Comment by @mwageringel created at 2021-01-21 08:22:22

Thank you for solving this so quickly. This looks good to me â€“ I just have a very small suggestion:


```diff
-        if row_lines == [] and col_lines == []:
+        if not row_lines and not col_lines:
```



---

Comment by git created at 2021-01-21 09:11:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-01-21 09:12:48

Good point. I added parentheses around each to make it extra clear about the test. Doctests pass for me.


---

Comment by tscrim created at 2021-01-22 00:22:15

Green patchbot (style issues are unrelated to the changes here).


---

Comment by @mwageringel created at 2021-01-22 08:32:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-01-31 20:53:29

Resolution: fixed
