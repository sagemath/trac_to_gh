# Issue 11677: ppl.pyx test takes a very long time contrary to what is claimed

Issue created by migration from https://trac.sagemath.org/ticket/11849

Original creator: jdemeyer

Original creation time: 2011-09-26 09:15:39

Assignee: was

CC:  vbraun leif

From the file `sage/libs/ppl.pyx` starting at line 112:

```
The computation finishes without noticeable delay on my desktop
(timeit measures it to be 35msec). Cddlib needs about 3 minutes on the
same hardware::

    sage: basis = range(0,6)
    sage: x = [ Variable(i) for i in basis ]
    sage: gs = [ tuple(coeff) for coeff in permutations(basis) ]
    sage: Polyhedron(vertices=gs)   # long time
    A 5-dimensional polyhedron in QQ^6 defined as the convex hull of 720 vertices.
```


Contrary to the claim that this takes milliseconds, it actually takes minutes.  This regularly causes timeouts when testing Sage on Skynet.

On sage.math.washington.edu, sage-4.7.2.alpha0:

```
sage: from sage.libs.ppl import Variable, Generator_System, point, C_Polyhedron
sage: basis = range(0,6)
sage: x = [ Variable(i) for i in basis ]
sage: gs = [ tuple(coeff) for coeff in permutations(basis) ]
sage: time Polyhedron(vertices=gs)
A 5-dimensional polyhedron in QQ^6 defined as the convex hull of 720 vertices.

Time: CPU 0.14 s, Wall: 218.94 s
```



---

Comment by jdemeyer created at 2011-09-26 09:24:25

Changing keywords from "" to "Parma Polyhedra Library".


---

Comment by vbraun created at 2011-09-26 09:54:24

You are looking at the wrong code. The 

```
sage: Polyhedron(vertices=gs)   # long time
```

call takes a very long time, as stated. The PPL computation is a few lines above, and completes within miliseconds:

```
sage: C_Polyhedron(gs)
```

We could turn the `Polyhedron()` call into a shorter `# long time` example. 

Also, I have some patches on trac to switch `Polyhedron` to PPL, as well.


---

Comment by jdemeyer created at 2011-09-26 13:44:52

Replying to [comment:2 vbraun]:
> sage: C_Polyhedron(gs)
> }}}
> We could turn the `Polyhedron()` call into a shorter `# long time` example.
Yes, please do that.  I think you should aim for something taking at most 10 seconds or so on `sage.math`.

Also, I would rephrase the paragraph starting from line 112 as

```
The above computation (using PPL) finishes without noticeable delay (timeit measures it to be 5ms on sage.math). Below we do the same computation with cddlib, which needs about 10 seconds on the same hardware::

    sage: basis = range(0,6)
    sage: x = [ Variable(i) for i in basis ]
    sage: gs = [ tuple(coeff) for coeff in permutations(basis) ]
    sage: Polyhedron(vertices=gs)   # long time (10s on sage.math, 2011)
    A 5-dimensional polyhedron in QQ^6 defined as the convex hull of 720 vertices.
```



---

Comment by vbraun created at 2011-09-26 21:15:32

Initial patch


---

Comment by vbraun created at 2011-09-26 21:17:46

Changing status from new to needs_review.


---

Attachment

The attached patch switches to an computationally easier doctest problem. Now it should complete in < 5.


---

Comment by jdemeyer created at 2011-09-27 07:15:37

positive_review modulo the reviewer patch.


---

Comment by jdemeyer created at 2011-09-27 07:15:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2011-09-27 08:14:40

Great, thanks!


---

Comment by leif created at 2011-09-27 17:39:38

Resolution: fixed


---

Comment by vbraun created at 2011-09-29 15:39:45

Changing keywords from "Parma Polyhedra Library" to "sd34 Parma Polyhedra Library".


---

Attachment


---

Comment by jdemeyer created at 2011-10-04 08:01:56

Fixed commit message of my reviewer patch.
