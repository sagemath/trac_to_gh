# Issue 30532: Unify graph backends

Issue created by migration from https://trac.sagemath.org/ticket/30769

Original creator: @kliem

Original creation time: 2020-10-14 09:08:45

CC:  vdelecroix dimpase dcoudert slelievre

Keywords: graph backend

This is a follow up to #28896.

We further unify the behavior of dense and sparse (dynamic) graph backends.

Adding and deleting edges now share common methods.

In particular, `DenseCGraph` and `SparseCGraph` also behave the same in the following way now:

- adding an arc will add both directions, if the graph is undirected
- deleting an arc will delete both directions, ...

Note that this ticket is also a step towards #28259:

Comparison:


```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  
sage: import igraph                                                                                                                                                                                                                                                                                                                                                        
sage: g = igraph.Graph()                                                                                                                                                                                                                                                                                                                                                   
sage: g.add_vertices(1001)                                                                                                                                                                                                                                                                                                                                                 
sage: %time g.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
CPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms
Wall time: 10.6 ms
```


Before:


```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  
sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                                
sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
CPU times: user 69 ms, sys: 38 µs, total: 69 ms
Wall time: 68.7 ms
sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                 
sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
CPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms
Wall time: 32 ms
```


After:


```
sage: set_random_seed(0)                                                                                                                                                                                                                                                                                                                                                   
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  
sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                                
sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
CPU times: user 32.8 ms, sys: 38 µs, total: 32.8 ms
Wall time: 32.8 ms
sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                 
sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
CPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms
Wall time: 14.6 ms
```



---

Comment by @kliem created at 2020-10-14 09:10:06

Note that I waited about a second between creating the graphs and timing each time. If you hit the next time too fast, I got a slowdown in each case.


---

Comment by @kliem created at 2020-10-14 09:10:12

Changing status from new to needs_review.


---

Comment by slelievre created at 2020-10-14 10:12:05

Replying to [comment:1 gh-kliem]:
> Note that I waited about a second between creating the graphs
> and timing each time. If you hit the next `%time` too fast,
> I got a slowdown in each case.

I added corresponding `sleep(1)` lines to the code blocks
in the ticket description.  : )


---

Comment by git created at 2020-10-14 12:50:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-14 19:44:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dcoudert created at 2020-10-15 09:27:04

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-10-15 09:27:04

For me this patch is good to go. Thank you.


---

Comment by @kliem created at 2020-10-15 09:27:52

Thank you for reviewing.


---

Comment by vbraun created at 2020-11-01 00:42:37

Resolution: fixed
