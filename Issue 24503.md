# Issue 24503: py3: numerous string fixes to sage.numerical.backends

archive/issues_024503.json:
```json
{
    "body": "Trying to make progress on my backlog of Python 3 fixes I haven't made tickets for...\n\nThis one is slightly questionable in that there were many `cpdef` functions in this package that take `char *` arguments, and I changed them to take non-typed arguments (effectively `str`).\n\nI'm not exactly sure what implication this has for the C interfaces that were exported for these methods, or if we care.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24740\n\n",
    "created_at": "2018-02-15T14:50:51Z",
    "labels": [
        "python3",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "py3: numerous string fixes to sage.numerical.backends",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24503",
    "user": "embray"
}
```
Trying to make progress on my backlog of Python 3 fixes I haven't made tickets for...

This one is slightly questionable in that there were many `cpdef` functions in this package that take `char *` arguments, and I changed them to take non-typed arguments (effectively `str`).

I'm not exactly sure what implication this has for the C interfaces that were exported for these methods, or if we care.

Issue created by migration from https://trac.sagemath.org/ticket/24740





---

archive/issue_comments_343767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-15T14:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343767",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_343768.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-15T14:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343768",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_343769.json:
```json
{
    "body": "Replying to [ticket:24740 embray]:\n> This one is slightly questionable in that there were many `cpdef` functions in this package that take `char *` arguments, and I changed them to take non-typed arguments (effectively `str`).\n\nThey don't seem to be performance-critical methods, so I'm fine with it.\n\nOne potential problem for reviewing this ticket is that it involves several external packages, some of which are not even free to install.",
    "created_at": "2018-02-27T09:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343769",
    "user": "jdemeyer"
}
```

Replying to [ticket:24740 embray]:
> This one is slightly questionable in that there were many `cpdef` functions in this package that take `char *` arguments, and I changed them to take non-typed arguments (effectively `str`).

They don't seem to be performance-critical methods, so I'm fine with it.

One potential problem for reviewing this ticket is that it involves several external packages, some of which are not even free to install.



---

archive/issue_comments_343770.json:
```json
{
    "body": "This ticket makes me think of a general problem with `str_to_bytes`: I think you should always accept `bytes` for filenames (Python generally does that). So it might be a good idea to allow `str_to_bytes` to accept `bytes` input (I said this before but you refused that). What do you think?",
    "created_at": "2018-02-27T09:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343770",
    "user": "jdemeyer"
}
```

This ticket makes me think of a general problem with `str_to_bytes`: I think you should always accept `bytes` for filenames (Python generally does that). So it might be a good idea to allow `str_to_bytes` to accept `bytes` input (I said this before but you refused that). What do you think?



---

archive/issue_comments_343771.json:
```json
{
    "body": "In `src/sage/numerical/backends/gurobi_backend.pyx` I see a `if name` which should be `if name is not None`",
    "created_at": "2018-02-27T09:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343771",
    "user": "jdemeyer"
}
```

In `src/sage/numerical/backends/gurobi_backend.pyx` I see a `if name` which should be `if name is not None`



---

archive/issue_comments_343772.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-27T09:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343772",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_343773.json:
```json
{
    "body": "Several \"vertex\" methods in `glpk_graph_backend.pyx` used a take a `char*` as argument. To me, it's not obvious to me that the canonical replacement is `str` (as opposed to `bytes`). In any case, it feels wrong to disallow `bytes`.",
    "created_at": "2018-02-27T09:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343773",
    "user": "jdemeyer"
}
```

Several "vertex" methods in `glpk_graph_backend.pyx` used a take a `char*` as argument. To me, it's not obvious to me that the canonical replacement is `str` (as opposed to `bytes`). In any case, it feels wrong to disallow `bytes`.



---

archive/issue_comments_343774.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> This ticket makes me think of a general problem with `str_to_bytes`: I think you should always accept `bytes` for filenames (Python generally does that). So it might be a good idea to allow `str_to_bytes` to accept `bytes` input (I said this before but you refused that). What do you think?\n\nThat would actually be bad because it would break most cases which explicitly should not accept bytes.  Specifically for filenames, it's better to just make a special case for accepting bytes.  Though I don't think high-level file handling functions need accept bytes in most cases either unless there were an explicit reason to.",
    "created_at": "2018-02-27T11:56:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343774",
    "user": "embray"
}
```

Replying to [comment:4 jdemeyer]:
> This ticket makes me think of a general problem with `str_to_bytes`: I think you should always accept `bytes` for filenames (Python generally does that). So it might be a good idea to allow `str_to_bytes` to accept `bytes` input (I said this before but you refused that). What do you think?

That would actually be bad because it would break most cases which explicitly should not accept bytes.  Specifically for filenames, it's better to just make a special case for accepting bytes.  Though I don't think high-level file handling functions need accept bytes in most cases either unless there were an explicit reason to.



---

archive/issue_comments_343775.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Several \"vertex\" methods in `glpk_graph_backend.pyx` used a take a `char*` as argument. To me, it's not obvious to me that the canonical replacement is `str` (as opposed to `bytes`). In any case, it feels wrong to disallow `bytes`.\n\nI can't say I'm 100% clear on that myself since it's not obvious that this code is even used anywhere in Sage.  But it's duplicating the Sage Graph API and I don't see what makes you think it should accept bytes.",
    "created_at": "2018-02-27T12:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343775",
    "user": "embray"
}
```

Replying to [comment:6 jdemeyer]:
> Several "vertex" methods in `glpk_graph_backend.pyx` used a take a `char*` as argument. To me, it's not obvious to me that the canonical replacement is `str` (as opposed to `bytes`). In any case, it feels wrong to disallow `bytes`.

I can't say I'm 100% clear on that myself since it's not obvious that this code is even used anywhere in Sage.  But it's duplicating the Sage Graph API and I don't see what makes you think it should accept bytes.



---

archive/issue_comments_343776.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> Replying to [ticket:24740 embray]:\n> > This one is slightly questionable in that there were many `cpdef` functions in this package that take `char *` arguments, and I changed them to take non-typed arguments (effectively `str`).\n> \n> They don't seem to be performance-critical methods, so I'm fine with it.\n> \n> One potential problem for reviewing this ticket is that it involves several external packages, some of which are not even free to install.\n\nIt is a problem, and some of these modules are not well tested because of it.  Though in the cases I've changed it should be fairly clear that it's the right approach in general (i.e. we are passing python `str`s to interfaces that expect `char *`).",
    "created_at": "2018-02-27T12:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343776",
    "user": "embray"
}
```

Replying to [comment:3 jdemeyer]:
> Replying to [ticket:24740 embray]:
> > This one is slightly questionable in that there were many `cpdef` functions in this package that take `char *` arguments, and I changed them to take non-typed arguments (effectively `str`).
> 
> They don't seem to be performance-critical methods, so I'm fine with it.
> 
> One potential problem for reviewing this ticket is that it involves several external packages, some of which are not even free to install.

It is a problem, and some of these modules are not well tested because of it.  Though in the cases I've changed it should be fairly clear that it's the right approach in general (i.e. we are passing python `str`s to interfaces that expect `char *`).



---

archive/issue_comments_343777.json:
```json
{
    "body": "I believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343777",
    "user": "embray"
}
```

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_comments_343778.json:
```json
{
    "body": "Replying to [comment:7 embray]:\n> Specifically for filenames, it's better to just make a special case for accepting bytes.\n\nHow about a new function `filename_to_bytes()`? I never liked the look of `str_to_bytes(fname, FS_ENCODING, 'surrogateescape')` anyway, `filename_to_bytes(fname)` would look much better.",
    "created_at": "2018-08-07T12:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343778",
    "user": "jdemeyer"
}
```

Replying to [comment:7 embray]:
> Specifically for filenames, it's better to just make a special case for accepting bytes.

How about a new function `filename_to_bytes()`? I never liked the look of `str_to_bytes(fname, FS_ENCODING, 'surrogateescape')` anyway, `filename_to_bytes(fname)` would look much better.



---

archive/issue_comments_343779.json:
```json
{
    "body": "How does this ticket now relate to #26020?  It wasn't clear to me why it needed to broken into a separate ticket in the first place.\n\nAre we still going to add `filename_to_bytes()`?  I like the idea but it should probably be done separately.",
    "created_at": "2018-08-16T11:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343779",
    "user": "embray"
}
```

How does this ticket now relate to #26020?  It wasn't clear to me why it needed to broken into a separate ticket in the first place.

Are we still going to add `filename_to_bytes()`?  I like the idea but it should probably be done separately.



---

archive/issue_comments_343780.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2018-08-16T11:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343780",
    "user": "embray"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_343781.json:
```json
{
    "body": "These changes look fine to me (but I haven't tested anything).",
    "created_at": "2018-10-07T22:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343781",
    "user": "mkoeppe"
}
```

These changes look fine to me (but I haven't tested anything).



---

archive/issue_comments_343782.json:
```json
{
    "body": "`@`embray, will you be able to finish this one and #24741 ?",
    "created_at": "2018-11-23T16:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343782",
    "user": "chapoton"
}
```

`@`embray, will you be able to finish this one and #24741 ?



---

archive/issue_comments_343783.json:
```json
{
    "body": "Sorry, yeah, I'll take care of it.  I think I stalled on this one because Jeroen had made some comments earlier, which seemed to suggest a course of action he preferred, and I was waiting for confirmation from him but it never came.  I'll just clean up the existing fixes here and worry about the `filename_to_bytes()` thing later.",
    "created_at": "2018-11-28T08:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343783",
    "user": "embray"
}
```

Sorry, yeah, I'll take care of it.  I think I stalled on this one because Jeroen had made some comments earlier, which seemed to suggest a course of action he preferred, and I was waiting for confirmation from him but it never came.  I'll just clean up the existing fixes here and worry about the `filename_to_bytes()` thing later.



---

archive/issue_comments_343784.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2018-12-07T19:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343784",
    "user": "chapoton"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_343785.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-10T13:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343785",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343786.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-10T13:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343786",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_343787.json:
```json
{
    "body": "I just rebased the existing branch on 8.5.beta6.\n\nI can see that there's a case to be made for still allowing some of these methods to accept filenames as bytes, but I think this is fine for now until and unless a specific need for it arises.",
    "created_at": "2018-12-10T13:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343787",
    "user": "embray"
}
```

I just rebased the existing branch on 8.5.beta6.

I can see that there's a case to be made for still allowing some of these methods to accept filenames as bytes, but I think this is fine for now until and unless a specific need for it arises.



---

archive/issue_comments_343788.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-12-13T11:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343788",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_343789.json:
```json
{
    "body": "the import of `char_to_str` seem not to be used in `backends/coin_backend.pyx`",
    "created_at": "2018-12-13T11:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343789",
    "user": "chapoton"
}
```

the import of `char_to_str` seem not to be used in `backends/coin_backend.pyx`



---

archive/issue_comments_343790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-13T11:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_343791.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-13T11:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343791",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_343792.json:
```json
{
    "body": "in src/sage/numerical/backends/cvxopt_sdp_backend.pyx,\nthe INPUT field must be modified\n\nsame in src/sage/numerical/backends/generic_sdp_backend.pyx\n\notherwise, looks good to me (as far as I can tell)",
    "created_at": "2018-12-13T15:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343792",
    "user": "chapoton"
}
```

in src/sage/numerical/backends/cvxopt_sdp_backend.pyx,
the INPUT field must be modified

same in src/sage/numerical/backends/generic_sdp_backend.pyx

otherwise, looks good to me (as far as I can tell)



---

archive/issue_comments_343793.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-12-13T15:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343793",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_343794.json:
```json
{
    "body": "Ah, very true (not that many people are likely to read that, but best to be consistent).",
    "created_at": "2018-12-13T16:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343794",
    "user": "embray"
}
```

Ah, very true (not that many people are likely to read that, but best to be consistent).



---

archive/issue_comments_343795.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-13T16:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343795",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_343796.json:
```json
{
    "body": "No, they're fine.  I checked the code and it doesn't need updating in those cases.  For some reason they already correctly read `str` instead of `char *`.",
    "created_at": "2018-12-13T16:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343796",
    "user": "embray"
}
```

No, they're fine.  I checked the code and it doesn't need updating in those cases.  For some reason they already correctly read `str` instead of `char *`.



---

archive/issue_comments_343797.json:
```json
{
    "body": "oh, well. Let it be.\n\n`@`vbraun: probably safer to keep this one for 8.6.beta0",
    "created_at": "2018-12-13T18:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343797",
    "user": "chapoton"
}
```

oh, well. Let it be.

`@`vbraun: probably safer to keep this one for 8.6.beta0



---

archive/issue_comments_343798.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-13T18:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343798",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_343799.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-23T23:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343799",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_343800.json:
```json
{
    "body": "Maybe the problem described in ticket #26999 was produced by the numerous string fixes made here. Can you take a look?",
    "created_at": "2019-01-03T10:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24503",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24503#issuecomment-343800",
    "user": "slabbe"
}
```

Maybe the problem described in ticket #26999 was produced by the numerous string fixes made here. Can you take a look?
